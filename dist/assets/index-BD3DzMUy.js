import{r as le,a as h1,R as ui,N as k0,b as m1,O as p1,c as f1,g as g1,u as Hr,d as nc,L as pf,B as x1,e as y1,f as Js}from"./vendor-BeIN97dW.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))x(v);new MutationObserver(v=>{for(const N of v)if(N.type==="childList")for(const E of N.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&x(E)}).observe(document,{childList:!0,subtree:!0});function g(v){const N={};return v.integrity&&(N.integrity=v.integrity),v.referrerPolicy&&(N.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?N.credentials="include":v.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function x(v){if(v.ep)return;v.ep=!0;const N=g(v);fetch(v.href,N)}})();var A0={exports:{}},Yh={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _1=le,b1=Symbol.for("react.element"),v1=Symbol.for("react.fragment"),w1=Object.prototype.hasOwnProperty,j1=_1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,N1={key:!0,ref:!0,__self:!0,__source:!0};function M0(c,d,g){var x,v={},N=null,E=null;g!==void 0&&(N=""+g),d.key!==void 0&&(N=""+d.key),d.ref!==void 0&&(E=d.ref);for(x in d)w1.call(d,x)&&!N1.hasOwnProperty(x)&&(v[x]=d[x]);if(c&&c.defaultProps)for(x in d=c.defaultProps,d)v[x]===void 0&&(v[x]=d[x]);return{$$typeof:b1,type:c,key:N,ref:E,props:v,_owner:j1.current}}Yh.Fragment=v1;Yh.jsx=M0;Yh.jsxs=M0;A0.exports=Yh;var t=A0.exports,P0,Ly=h1;P0=Ly.createRoot,Ly.hydrateRoot;class Yo{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(d){const g={listener:d};return this.listeners.add(g),this.onSubscribe(),()=>{this.listeners.delete(g),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const Ku=typeof window>"u"||"Deno"in window;function Xi(){}function S1(c,d){return typeof c=="function"?c(d):c}function ff(c){return typeof c=="number"&&c>=0&&c!==1/0}function Ry(c,d){return c.filter(g=>!d.includes(g))}function T1(c,d,g){const x=c.slice(0);return x[d]=g,x}function I0(c,d){return Math.max(c+(d||0)-Date.now(),0)}function tc(c,d,g){return Yu(c)?typeof d=="function"?{...g,queryKey:c,queryFn:d}:{...d,queryKey:c}:c}function E1(c,d,g){return Yu(c)?{...d,mutationKey:c}:typeof c=="function"?{...d,mutationFn:c}:{...c}}function Xa(c,d,g){return Yu(c)?[{...d,queryKey:c},g]:[c||{},d]}function zy(c,d){const{type:g="all",exact:x,fetchStatus:v,predicate:N,queryKey:E,stale:k}=c;if(Yu(E)){if(x){if(d.queryHash!==Lf(E,d.options))return!1}else if(!zh(d.queryKey,E))return!1}if(g!=="all"){const n=d.isActive();if(g==="active"&&!n||g==="inactive"&&n)return!1}return!(typeof k=="boolean"&&d.isStale()!==k||typeof v<"u"&&v!==d.state.fetchStatus||N&&!N(d))}function Oy(c,d){const{exact:g,fetching:x,predicate:v,mutationKey:N}=c;if(Yu(N)){if(!d.options.mutationKey)return!1;if(g){if(Ya(d.options.mutationKey)!==Ya(N))return!1}else if(!zh(d.options.mutationKey,N))return!1}return!(typeof x=="boolean"&&d.state.status==="loading"!==x||v&&!v(d))}function Lf(c,d){return((d==null?void 0:d.queryKeyHashFn)||Ya)(c)}function Ya(c){return JSON.stringify(c,(d,g)=>gf(g)?Object.keys(g).sort().reduce((x,v)=>(x[v]=g[v],x),{}):g)}function zh(c,d){return D0(c,d)}function D0(c,d){return c===d?!0:typeof c!=typeof d?!1:c&&d&&typeof c=="object"&&typeof d=="object"?!Object.keys(d).some(g=>!D0(c[g],d[g])):!1}function L0(c,d){if(c===d)return c;const g=Fy(c)&&Fy(d);if(g||gf(c)&&gf(d)){const x=g?c.length:Object.keys(c).length,v=g?d:Object.keys(d),N=v.length,E=g?[]:{};let k=0;for(let n=0;n<N;n++){const M=g?n:v[n];E[M]=L0(c[M],d[M]),E[M]===c[M]&&k++}return x===N&&k===x?c:E}return d}function Oh(c,d){if(c&&!d||d&&!c)return!1;for(const g in c)if(c[g]!==d[g])return!1;return!0}function Fy(c){return Array.isArray(c)&&c.length===Object.keys(c).length}function gf(c){if(!By(c))return!1;const d=c.constructor;if(typeof d>"u")return!0;const g=d.prototype;return!(!By(g)||!g.hasOwnProperty("isPrototypeOf"))}function By(c){return Object.prototype.toString.call(c)==="[object Object]"}function Yu(c){return Array.isArray(c)}function R0(c){return new Promise(d=>{setTimeout(d,c)})}function Uy(c){R0(0).then(c)}function C1(){if(typeof AbortController=="function")return new AbortController}function xf(c,d,g){return g.isDataEqual!=null&&g.isDataEqual(c,d)?c:typeof g.structuralSharing=="function"?g.structuralSharing(c,d):g.structuralSharing!==!1?L0(c,d):d}class k1 extends Yo{constructor(){super(),this.setup=d=>{if(!Ku&&window.addEventListener){const g=()=>d();return window.addEventListener("visibilitychange",g,!1),window.addEventListener("focus",g,!1),()=>{window.removeEventListener("visibilitychange",g),window.removeEventListener("focus",g)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.cleanup)==null||d.call(this),this.cleanup=void 0}}setEventListener(d){var g;this.setup=d,(g=this.cleanup)==null||g.call(this),this.cleanup=d(x=>{typeof x=="boolean"?this.setFocused(x):this.onFocus()})}setFocused(d){this.focused!==d&&(this.focused=d,this.onFocus())}onFocus(){this.listeners.forEach(({listener:d})=>{d()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const Fh=new k1,Vy=["online","offline"];class A1 extends Yo{constructor(){super(),this.setup=d=>{if(!Ku&&window.addEventListener){const g=()=>d();return Vy.forEach(x=>{window.addEventListener(x,g,!1)}),()=>{Vy.forEach(x=>{window.removeEventListener(x,g)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.cleanup)==null||d.call(this),this.cleanup=void 0}}setEventListener(d){var g;this.setup=d,(g=this.cleanup)==null||g.call(this),this.cleanup=d(x=>{typeof x=="boolean"?this.setOnline(x):this.onOnline()})}setOnline(d){this.online!==d&&(this.online=d,this.onOnline())}onOnline(){this.listeners.forEach(({listener:d})=>{d()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const Bh=new A1;function M1(c){return Math.min(1e3*2**c,3e4)}function em(c){return(c??"online")==="online"?Bh.isOnline():!0}class z0{constructor(d){this.revert=d==null?void 0:d.revert,this.silent=d==null?void 0:d.silent}}function Mh(c){return c instanceof z0}function O0(c){let d=!1,g=0,x=!1,v,N,E;const k=new Promise((Y,ge)=>{N=Y,E=ge}),n=Y=>{x||(V(new z0(Y)),c.abort==null||c.abort())},M=()=>{d=!0},z=()=>{d=!1},q=()=>!Fh.isFocused()||c.networkMode!=="always"&&!Bh.isOnline(),U=Y=>{x||(x=!0,c.onSuccess==null||c.onSuccess(Y),v==null||v(),N(Y))},V=Y=>{x||(x=!0,c.onError==null||c.onError(Y),v==null||v(),E(Y))},G=()=>new Promise(Y=>{v=ge=>{const oe=x||!q();return oe&&Y(ge),oe},c.onPause==null||c.onPause()}).then(()=>{v=void 0,x||c.onContinue==null||c.onContinue()}),H=()=>{if(x)return;let Y;try{Y=c.fn()}catch(ge){Y=Promise.reject(ge)}Promise.resolve(Y).then(U).catch(ge=>{var oe,se;if(x)return;const de=(oe=c.retry)!=null?oe:3,ae=(se=c.retryDelay)!=null?se:M1,Se=typeof ae=="function"?ae(g,ge):ae,Ce=de===!0||typeof de=="number"&&g<de||typeof de=="function"&&de(g,ge);if(d||!Ce){V(ge);return}g++,c.onFail==null||c.onFail(g,ge),R0(Se).then(()=>{if(q())return G()}).then(()=>{d?V(ge):H()})})};return em(c.networkMode)?H():G().then(H),{promise:k,cancel:n,continue:()=>(v==null?void 0:v())?k:Promise.resolve(),cancelRetry:M,continueRetry:z}}const Rf=console;function P1(){let c=[],d=0,g=z=>{z()},x=z=>{z()};const v=z=>{let q;d++;try{q=z()}finally{d--,d||k()}return q},N=z=>{d?c.push(z):Uy(()=>{g(z)})},E=z=>(...q)=>{N(()=>{z(...q)})},k=()=>{const z=c;c=[],z.length&&Uy(()=>{x(()=>{z.forEach(q=>{g(q)})})})};return{batch:v,batchCalls:E,schedule:N,setNotifyFunction:z=>{g=z},setBatchNotifyFunction:z=>{x=z}}}const Xs=P1();class F0{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ff(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(d){this.cacheTime=Math.max(this.cacheTime||0,d??(Ku?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class I1 extends F0{constructor(d){super(),this.abortSignalConsumed=!1,this.defaultOptions=d.defaultOptions,this.setOptions(d.options),this.observers=[],this.cache=d.cache,this.logger=d.logger||Rf,this.queryKey=d.queryKey,this.queryHash=d.queryHash,this.initialState=d.state||D1(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(d){this.options={...this.defaultOptions,...d},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(d,g){const x=xf(this.state.data,d,this.options);return this.dispatch({data:x,type:"success",dataUpdatedAt:g==null?void 0:g.updatedAt,manual:g==null?void 0:g.manual}),x}setState(d,g){this.dispatch({type:"setState",state:d,setStateOptions:g})}cancel(d){var g;const x=this.promise;return(g=this.retryer)==null||g.cancel(d),x?x.then(Xi).catch(Xi):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(d=>d.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(d=>d.getCurrentResult().isStale)}isStaleByTime(d=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!I0(this.state.dataUpdatedAt,d)}onFocus(){var d;const g=this.observers.find(x=>x.shouldFetchOnWindowFocus());g&&g.refetch({cancelRefetch:!1}),(d=this.retryer)==null||d.continue()}onOnline(){var d;const g=this.observers.find(x=>x.shouldFetchOnReconnect());g&&g.refetch({cancelRefetch:!1}),(d=this.retryer)==null||d.continue()}addObserver(d){this.observers.includes(d)||(this.observers.push(d),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:d}))}removeObserver(d){this.observers.includes(d)&&(this.observers=this.observers.filter(g=>g!==d),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:d}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(d,g){var x,v;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&g!=null&&g.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var N;return(N=this.retryer)==null||N.continueRetry(),this.promise}}if(d&&this.setOptions(d),!this.options.queryFn){const V=this.observers.find(G=>G.options.queryFn);V&&this.setOptions(V.options)}const E=C1(),k={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},n=V=>{Object.defineProperty(V,"signal",{enumerable:!0,get:()=>{if(E)return this.abortSignalConsumed=!0,E.signal}})};n(k);const M=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(k)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'"),z={fetchOptions:g,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:M};if(n(z),(x=this.options.behavior)==null||x.onFetch(z),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==((v=z.fetchOptions)==null?void 0:v.meta)){var q;this.dispatch({type:"fetch",meta:(q=z.fetchOptions)==null?void 0:q.meta})}const U=V=>{if(Mh(V)&&V.silent||this.dispatch({type:"error",error:V}),!Mh(V)){var G,H,Y,ge;(G=(H=this.cache.config).onError)==null||G.call(H,V,this),(Y=(ge=this.cache.config).onSettled)==null||Y.call(ge,this.state.data,V,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=O0({fn:z.fetchFn,abort:E==null?void 0:E.abort.bind(E),onSuccess:V=>{var G,H,Y,ge;if(typeof V>"u"){U(new Error(this.queryHash+" data is undefined"));return}this.setData(V),(G=(H=this.cache.config).onSuccess)==null||G.call(H,V,this),(Y=(ge=this.cache.config).onSettled)==null||Y.call(ge,V,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:U,onFail:(V,G)=>{this.dispatch({type:"failed",failureCount:V,error:G})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:z.options.retry,retryDelay:z.options.retryDelay,networkMode:z.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(d){const g=x=>{var v,N;switch(d.type){case"failed":return{...x,fetchFailureCount:d.failureCount,fetchFailureReason:d.error};case"pause":return{...x,fetchStatus:"paused"};case"continue":return{...x,fetchStatus:"fetching"};case"fetch":return{...x,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:(v=d.meta)!=null?v:null,fetchStatus:em(this.options.networkMode)?"fetching":"paused",...!x.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...x,data:d.data,dataUpdateCount:x.dataUpdateCount+1,dataUpdatedAt:(N=d.dataUpdatedAt)!=null?N:Date.now(),error:null,isInvalidated:!1,status:"success",...!d.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const E=d.error;return Mh(E)&&E.revert&&this.revertState?{...this.revertState,fetchStatus:"idle"}:{...x,error:E,errorUpdateCount:x.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:x.fetchFailureCount+1,fetchFailureReason:E,fetchStatus:"idle",status:"error"};case"invalidate":return{...x,isInvalidated:!0};case"setState":return{...x,...d.state}}};this.state=g(this.state),Xs.batch(()=>{this.observers.forEach(x=>{x.onQueryUpdate(d)}),this.cache.notify({query:this,type:"updated",action:d})})}}function D1(c){const d=typeof c.initialData=="function"?c.initialData():c.initialData,g=typeof d<"u",x=g?typeof c.initialDataUpdatedAt=="function"?c.initialDataUpdatedAt():c.initialDataUpdatedAt:0;return{data:d,dataUpdateCount:0,dataUpdatedAt:g?x??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:g?"success":"loading",fetchStatus:"idle"}}class L1 extends Yo{constructor(d){super(),this.config=d||{},this.queries=[],this.queriesMap={}}build(d,g,x){var v;const N=g.queryKey,E=(v=g.queryHash)!=null?v:Lf(N,g);let k=this.get(E);return k||(k=new I1({cache:this,logger:d.getLogger(),queryKey:N,queryHash:E,options:d.defaultQueryOptions(g),state:x,defaultOptions:d.getQueryDefaults(N)}),this.add(k)),k}add(d){this.queriesMap[d.queryHash]||(this.queriesMap[d.queryHash]=d,this.queries.push(d),this.notify({type:"added",query:d}))}remove(d){const g=this.queriesMap[d.queryHash];g&&(d.destroy(),this.queries=this.queries.filter(x=>x!==d),g===d&&delete this.queriesMap[d.queryHash],this.notify({type:"removed",query:d}))}clear(){Xs.batch(()=>{this.queries.forEach(d=>{this.remove(d)})})}get(d){return this.queriesMap[d]}getAll(){return this.queries}find(d,g){const[x]=Xa(d,g);return typeof x.exact>"u"&&(x.exact=!0),this.queries.find(v=>zy(x,v))}findAll(d,g){const[x]=Xa(d,g);return Object.keys(x).length>0?this.queries.filter(v=>zy(x,v)):this.queries}notify(d){Xs.batch(()=>{this.listeners.forEach(({listener:g})=>{g(d)})})}onFocus(){Xs.batch(()=>{this.queries.forEach(d=>{d.onFocus()})})}onOnline(){Xs.batch(()=>{this.queries.forEach(d=>{d.onOnline()})})}}class R1 extends F0{constructor(d){super(),this.defaultOptions=d.defaultOptions,this.mutationId=d.mutationId,this.mutationCache=d.mutationCache,this.logger=d.logger||Rf,this.observers=[],this.state=d.state||B0(),this.setOptions(d.options),this.scheduleGc()}setOptions(d){this.options={...this.defaultOptions,...d},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(d){this.dispatch({type:"setState",state:d})}addObserver(d){this.observers.includes(d)||(this.observers.push(d),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:d}))}removeObserver(d){this.observers=this.observers.filter(g=>g!==d),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:d})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var d,g;return(d=(g=this.retryer)==null?void 0:g.continue())!=null?d:this.execute()}async execute(){const d=()=>{var Ce;return this.retryer=O0({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(fe,Ie)=>{this.dispatch({type:"failed",failureCount:fe,error:Ie})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(Ce=this.options.retry)!=null?Ce:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},g=this.state.status==="loading";try{var x,v,N,E,k,n,M,z;if(!g){var q,U,V,G;this.dispatch({type:"loading",variables:this.options.variables}),await((q=(U=this.mutationCache.config).onMutate)==null?void 0:q.call(U,this.state.variables,this));const fe=await((V=(G=this.options).onMutate)==null?void 0:V.call(G,this.state.variables));fe!==this.state.context&&this.dispatch({type:"loading",context:fe,variables:this.state.variables})}const Ce=await d();return await((x=(v=this.mutationCache.config).onSuccess)==null?void 0:x.call(v,Ce,this.state.variables,this.state.context,this)),await((N=(E=this.options).onSuccess)==null?void 0:N.call(E,Ce,this.state.variables,this.state.context)),await((k=(n=this.mutationCache.config).onSettled)==null?void 0:k.call(n,Ce,null,this.state.variables,this.state.context,this)),await((M=(z=this.options).onSettled)==null?void 0:M.call(z,Ce,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:Ce}),Ce}catch(Ce){try{var H,Y,ge,oe,se,de,ae,Se;throw await((H=(Y=this.mutationCache.config).onError)==null?void 0:H.call(Y,Ce,this.state.variables,this.state.context,this)),await((ge=(oe=this.options).onError)==null?void 0:ge.call(oe,Ce,this.state.variables,this.state.context)),await((se=(de=this.mutationCache.config).onSettled)==null?void 0:se.call(de,void 0,Ce,this.state.variables,this.state.context,this)),await((ae=(Se=this.options).onSettled)==null?void 0:ae.call(Se,void 0,Ce,this.state.variables,this.state.context)),Ce}finally{this.dispatch({type:"error",error:Ce})}}}dispatch(d){const g=x=>{switch(d.type){case"failed":return{...x,failureCount:d.failureCount,failureReason:d.error};case"pause":return{...x,isPaused:!0};case"continue":return{...x,isPaused:!1};case"loading":return{...x,context:d.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!em(this.options.networkMode),status:"loading",variables:d.variables};case"success":return{...x,data:d.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...x,data:void 0,error:d.error,failureCount:x.failureCount+1,failureReason:d.error,isPaused:!1,status:"error"};case"setState":return{...x,...d.state}}};this.state=g(this.state),Xs.batch(()=>{this.observers.forEach(x=>{x.onMutationUpdate(d)}),this.mutationCache.notify({mutation:this,type:"updated",action:d})})}}function B0(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class z1 extends Yo{constructor(d){super(),this.config=d||{},this.mutations=[],this.mutationId=0}build(d,g,x){const v=new R1({mutationCache:this,logger:d.getLogger(),mutationId:++this.mutationId,options:d.defaultMutationOptions(g),state:x,defaultOptions:g.mutationKey?d.getMutationDefaults(g.mutationKey):void 0});return this.add(v),v}add(d){this.mutations.push(d),this.notify({type:"added",mutation:d})}remove(d){this.mutations=this.mutations.filter(g=>g!==d),this.notify({type:"removed",mutation:d})}clear(){Xs.batch(()=>{this.mutations.forEach(d=>{this.remove(d)})})}getAll(){return this.mutations}find(d){return typeof d.exact>"u"&&(d.exact=!0),this.mutations.find(g=>Oy(d,g))}findAll(d){return this.mutations.filter(g=>Oy(d,g))}notify(d){Xs.batch(()=>{this.listeners.forEach(({listener:g})=>{g(d)})})}resumePausedMutations(){var d;return this.resuming=((d=this.resuming)!=null?d:Promise.resolve()).then(()=>{const g=this.mutations.filter(x=>x.state.isPaused);return Xs.batch(()=>g.reduce((x,v)=>x.then(()=>v.continue().catch(Xi)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function yf(){return{onFetch:c=>{c.fetchFn=()=>{var d,g,x,v,N,E;const k=(d=c.fetchOptions)==null||(g=d.meta)==null?void 0:g.refetchPage,n=(x=c.fetchOptions)==null||(v=x.meta)==null?void 0:v.fetchMore,M=n==null?void 0:n.pageParam,z=(n==null?void 0:n.direction)==="forward",q=(n==null?void 0:n.direction)==="backward",U=((N=c.state.data)==null?void 0:N.pages)||[],V=((E=c.state.data)==null?void 0:E.pageParams)||[];let G=V,H=!1;const Y=Se=>{Object.defineProperty(Se,"signal",{enumerable:!0,get:()=>{var Ce;if((Ce=c.signal)!=null&&Ce.aborted)H=!0;else{var fe;(fe=c.signal)==null||fe.addEventListener("abort",()=>{H=!0})}return c.signal}})},ge=c.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+c.options.queryHash+"'")),oe=(Se,Ce,fe,Ie)=>(G=Ie?[Ce,...G]:[...G,Ce],Ie?[fe,...Se]:[...Se,fe]),se=(Se,Ce,fe,Ie)=>{if(H)return Promise.reject("Cancelled");if(typeof fe>"u"&&!Ce&&Se.length)return Promise.resolve(Se);const ke={queryKey:c.queryKey,pageParam:fe,meta:c.options.meta};Y(ke);const et=ge(ke);return Promise.resolve(et).then(Ne=>oe(Se,fe,Ne,Ie))};let de;if(!U.length)de=se([]);else if(z){const Se=typeof M<"u",Ce=Se?M:_f(c.options,U);de=se(U,Se,Ce)}else if(q){const Se=typeof M<"u",Ce=Se?M:U0(c.options,U);de=se(U,Se,Ce,!0)}else{G=[];const Se=typeof c.options.getNextPageParam>"u";de=(k&&U[0]?k(U[0],0,U):!0)?se([],Se,V[0]):Promise.resolve(oe([],V[0],U[0]));for(let fe=1;fe<U.length;fe++)de=de.then(Ie=>{if(k&&U[fe]?k(U[fe],fe,U):!0){const et=Se?V[fe]:_f(c.options,Ie);return se(Ie,Se,et)}return Promise.resolve(oe(Ie,V[fe],U[fe]))})}return de.then(Se=>({pages:Se,pageParams:G}))}}}}function _f(c,d){return c.getNextPageParam==null?void 0:c.getNextPageParam(d[d.length-1],d)}function U0(c,d){return c.getPreviousPageParam==null?void 0:c.getPreviousPageParam(d[0],d)}function O1(c,d){if(c.getNextPageParam&&Array.isArray(d)){const g=_f(c,d);return typeof g<"u"&&g!==null&&g!==!1}}function F1(c,d){if(c.getPreviousPageParam&&Array.isArray(d)){const g=U0(c,d);return typeof g<"u"&&g!==null&&g!==!1}}class V0{constructor(d={}){this.queryCache=d.queryCache||new L1,this.mutationCache=d.mutationCache||new z1,this.logger=d.logger||Rf,this.defaultOptions=d.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=Fh.subscribe(()=>{Fh.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=Bh.subscribe(()=>{Bh.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var d,g;this.mountCount--,this.mountCount===0&&((d=this.unsubscribeFocus)==null||d.call(this),this.unsubscribeFocus=void 0,(g=this.unsubscribeOnline)==null||g.call(this),this.unsubscribeOnline=void 0)}isFetching(d,g){const[x]=Xa(d,g);return x.fetchStatus="fetching",this.queryCache.findAll(x).length}isMutating(d){return this.mutationCache.findAll({...d,fetching:!0}).length}getQueryData(d,g){var x;return(x=this.queryCache.find(d,g))==null?void 0:x.state.data}ensureQueryData(d,g,x){const v=tc(d,g,x),N=this.getQueryData(v.queryKey);return N?Promise.resolve(N):this.fetchQuery(v)}getQueriesData(d){return this.getQueryCache().findAll(d).map(({queryKey:g,state:x})=>{const v=x.data;return[g,v]})}setQueryData(d,g,x){const v=this.queryCache.find(d),N=v==null?void 0:v.state.data,E=S1(g,N);if(typeof E>"u")return;const k=tc(d),n=this.defaultQueryOptions(k);return this.queryCache.build(this,n).setData(E,{...x,manual:!0})}setQueriesData(d,g,x){return Xs.batch(()=>this.getQueryCache().findAll(d).map(({queryKey:v})=>[v,this.setQueryData(v,g,x)]))}getQueryState(d,g){var x;return(x=this.queryCache.find(d,g))==null?void 0:x.state}removeQueries(d,g){const[x]=Xa(d,g),v=this.queryCache;Xs.batch(()=>{v.findAll(x).forEach(N=>{v.remove(N)})})}resetQueries(d,g,x){const[v,N]=Xa(d,g,x),E=this.queryCache,k={type:"active",...v};return Xs.batch(()=>(E.findAll(v).forEach(n=>{n.reset()}),this.refetchQueries(k,N)))}cancelQueries(d,g,x){const[v,N={}]=Xa(d,g,x);typeof N.revert>"u"&&(N.revert=!0);const E=Xs.batch(()=>this.queryCache.findAll(v).map(k=>k.cancel(N)));return Promise.all(E).then(Xi).catch(Xi)}invalidateQueries(d,g,x){const[v,N]=Xa(d,g,x);return Xs.batch(()=>{var E,k;if(this.queryCache.findAll(v).forEach(M=>{M.invalidate()}),v.refetchType==="none")return Promise.resolve();const n={...v,type:(E=(k=v.refetchType)!=null?k:v.type)!=null?E:"active"};return this.refetchQueries(n,N)})}refetchQueries(d,g,x){const[v,N]=Xa(d,g,x),E=Xs.batch(()=>this.queryCache.findAll(v).filter(n=>!n.isDisabled()).map(n=>{var M;return n.fetch(void 0,{...N,cancelRefetch:(M=N==null?void 0:N.cancelRefetch)!=null?M:!0,meta:{refetchPage:v.refetchPage}})}));let k=Promise.all(E).then(Xi);return N!=null&&N.throwOnError||(k=k.catch(Xi)),k}fetchQuery(d,g,x){const v=tc(d,g,x),N=this.defaultQueryOptions(v);typeof N.retry>"u"&&(N.retry=!1);const E=this.queryCache.build(this,N);return E.isStaleByTime(N.staleTime)?E.fetch(N):Promise.resolve(E.state.data)}prefetchQuery(d,g,x){return this.fetchQuery(d,g,x).then(Xi).catch(Xi)}fetchInfiniteQuery(d,g,x){const v=tc(d,g,x);return v.behavior=yf(),this.fetchQuery(v)}prefetchInfiniteQuery(d,g,x){return this.fetchInfiniteQuery(d,g,x).then(Xi).catch(Xi)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(d){this.defaultOptions=d}setQueryDefaults(d,g){const x=this.queryDefaults.find(v=>Ya(d)===Ya(v.queryKey));x?x.defaultOptions=g:this.queryDefaults.push({queryKey:d,defaultOptions:g})}getQueryDefaults(d){if(!d)return;const g=this.queryDefaults.find(x=>zh(d,x.queryKey));return g==null?void 0:g.defaultOptions}setMutationDefaults(d,g){const x=this.mutationDefaults.find(v=>Ya(d)===Ya(v.mutationKey));x?x.defaultOptions=g:this.mutationDefaults.push({mutationKey:d,defaultOptions:g})}getMutationDefaults(d){if(!d)return;const g=this.mutationDefaults.find(x=>zh(d,x.mutationKey));return g==null?void 0:g.defaultOptions}defaultQueryOptions(d){if(d!=null&&d._defaulted)return d;const g={...this.defaultOptions.queries,...this.getQueryDefaults(d==null?void 0:d.queryKey),...d,_defaulted:!0};return!g.queryHash&&g.queryKey&&(g.queryHash=Lf(g.queryKey,g)),typeof g.refetchOnReconnect>"u"&&(g.refetchOnReconnect=g.networkMode!=="always"),typeof g.useErrorBoundary>"u"&&(g.useErrorBoundary=!!g.suspense),g}defaultMutationOptions(d){return d!=null&&d._defaulted?d:{...this.defaultOptions.mutations,...this.getMutationDefaults(d==null?void 0:d.mutationKey),...d,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}class zf extends Yo{constructor(d,g){super(),this.client=d,this.options=g,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(g)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),qy(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return bf(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return bf(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(d,g){const x=this.options,v=this.currentQuery;if(this.options=this.client.defaultQueryOptions(d),Oh(x,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=x.queryKey),this.updateQuery();const N=this.hasListeners();N&&$y(this.currentQuery,v,this.options,x)&&this.executeFetch(),this.updateResult(g),N&&(this.currentQuery!==v||this.options.enabled!==x.enabled||this.options.staleTime!==x.staleTime)&&this.updateStaleTimeout();const E=this.computeRefetchInterval();N&&(this.currentQuery!==v||this.options.enabled!==x.enabled||E!==this.currentRefetchInterval)&&this.updateRefetchInterval(E)}getOptimisticResult(d){const g=this.client.getQueryCache().build(this.client,d),x=this.createResult(g,d);return U1(this,x,d)&&(this.currentResult=x,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),x}getCurrentResult(){return this.currentResult}trackResult(d){const g={};return Object.keys(d).forEach(x=>{Object.defineProperty(g,x,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(x),d[x])})}),g}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:d,...g}={}){return this.fetch({...g,meta:{refetchPage:d}})}fetchOptimistic(d){const g=this.client.defaultQueryOptions(d),x=this.client.getQueryCache().build(this.client,g);return x.isFetchingOptimistic=!0,x.fetch().then(()=>this.createResult(x,g))}fetch(d){var g;return this.executeFetch({...d,cancelRefetch:(g=d.cancelRefetch)!=null?g:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(d){this.updateQuery();let g=this.currentQuery.fetch(this.options,d);return d!=null&&d.throwOnError||(g=g.catch(Xi)),g}updateStaleTimeout(){if(this.clearStaleTimeout(),Ku||this.currentResult.isStale||!ff(this.options.staleTime))return;const g=I0(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},g)}computeRefetchInterval(){var d;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(d=this.options.refetchInterval)!=null?d:!1}updateRefetchInterval(d){this.clearRefetchInterval(),this.currentRefetchInterval=d,!(Ku||this.options.enabled===!1||!ff(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||Fh.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(d,g){const x=this.currentQuery,v=this.options,N=this.currentResult,E=this.currentResultState,k=this.currentResultOptions,n=d!==x,M=n?d.state:this.currentQueryInitialState,z=n?this.currentResult:this.previousQueryResult,{state:q}=d;let{dataUpdatedAt:U,error:V,errorUpdatedAt:G,fetchStatus:H,status:Y}=q,ge=!1,oe=!1,se;if(g._optimisticResults){const fe=this.hasListeners(),Ie=!fe&&qy(d,g),ke=fe&&$y(d,x,g,v);(Ie||ke)&&(H=em(d.options.networkMode)?"fetching":"paused",U||(Y="loading")),g._optimisticResults==="isRestoring"&&(H="idle")}if(g.keepPreviousData&&!q.dataUpdatedAt&&z!=null&&z.isSuccess&&Y!=="error")se=z.data,U=z.dataUpdatedAt,Y=z.status,ge=!0;else if(g.select&&typeof q.data<"u")if(N&&q.data===(E==null?void 0:E.data)&&g.select===this.selectFn)se=this.selectResult;else try{this.selectFn=g.select,se=g.select(q.data),se=xf(N==null?void 0:N.data,se,g),this.selectResult=se,this.selectError=null}catch(fe){this.selectError=fe}else se=q.data;if(typeof g.placeholderData<"u"&&typeof se>"u"&&Y==="loading"){let fe;if(N!=null&&N.isPlaceholderData&&g.placeholderData===(k==null?void 0:k.placeholderData))fe=N.data;else if(fe=typeof g.placeholderData=="function"?g.placeholderData():g.placeholderData,g.select&&typeof fe<"u")try{fe=g.select(fe),this.selectError=null}catch(Ie){this.selectError=Ie}typeof fe<"u"&&(Y="success",se=xf(N==null?void 0:N.data,fe,g),oe=!0)}this.selectError&&(V=this.selectError,se=this.selectResult,G=Date.now(),Y="error");const de=H==="fetching",ae=Y==="loading",Se=Y==="error";return{status:Y,fetchStatus:H,isLoading:ae,isSuccess:Y==="success",isError:Se,isInitialLoading:ae&&de,data:se,dataUpdatedAt:U,error:V,errorUpdatedAt:G,failureCount:q.fetchFailureCount,failureReason:q.fetchFailureReason,errorUpdateCount:q.errorUpdateCount,isFetched:q.dataUpdateCount>0||q.errorUpdateCount>0,isFetchedAfterMount:q.dataUpdateCount>M.dataUpdateCount||q.errorUpdateCount>M.errorUpdateCount,isFetching:de,isRefetching:de&&!ae,isLoadingError:Se&&q.dataUpdatedAt===0,isPaused:H==="paused",isPlaceholderData:oe,isPreviousData:ge,isRefetchError:Se&&q.dataUpdatedAt!==0,isStale:Of(d,g),refetch:this.refetch,remove:this.remove}}updateResult(d){const g=this.currentResult,x=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,Oh(x,g))return;this.currentResult=x;const v={cache:!0},N=()=>{if(!g)return!0;const{notifyOnChangeProps:E}=this.options,k=typeof E=="function"?E():E;if(k==="all"||!k&&!this.trackedProps.size)return!0;const n=new Set(k??this.trackedProps);return this.options.useErrorBoundary&&n.add("error"),Object.keys(this.currentResult).some(M=>{const z=M;return this.currentResult[z]!==g[z]&&n.has(z)})};(d==null?void 0:d.listeners)!==!1&&N()&&(v.listeners=!0),this.notify({...v,...d})}updateQuery(){const d=this.client.getQueryCache().build(this.client,this.options);if(d===this.currentQuery)return;const g=this.currentQuery;this.currentQuery=d,this.currentQueryInitialState=d.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(g==null||g.removeObserver(this),d.addObserver(this))}onQueryUpdate(d){const g={};d.type==="success"?g.onSuccess=!d.manual:d.type==="error"&&!Mh(d.error)&&(g.onError=!0),this.updateResult(g),this.hasListeners()&&this.updateTimers()}notify(d){Xs.batch(()=>{if(d.onSuccess){var g,x,v,N;(g=(x=this.options).onSuccess)==null||g.call(x,this.currentResult.data),(v=(N=this.options).onSettled)==null||v.call(N,this.currentResult.data,null)}else if(d.onError){var E,k,n,M;(E=(k=this.options).onError)==null||E.call(k,this.currentResult.error),(n=(M=this.options).onSettled)==null||n.call(M,void 0,this.currentResult.error)}d.listeners&&this.listeners.forEach(({listener:z})=>{z(this.currentResult)}),d.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function B1(c,d){return d.enabled!==!1&&!c.state.dataUpdatedAt&&!(c.state.status==="error"&&d.retryOnMount===!1)}function qy(c,d){return B1(c,d)||c.state.dataUpdatedAt>0&&bf(c,d,d.refetchOnMount)}function bf(c,d,g){if(d.enabled!==!1){const x=typeof g=="function"?g(c):g;return x==="always"||x!==!1&&Of(c,d)}return!1}function $y(c,d,g,x){return g.enabled!==!1&&(c!==d||x.enabled===!1)&&(!g.suspense||c.state.status!=="error")&&Of(c,g)}function Of(c,d){return c.isStaleByTime(d.staleTime)}function U1(c,d,g){return g.keepPreviousData?!1:g.placeholderData!==void 0?d.isPlaceholderData:!Oh(c.getCurrentResult(),d)}class V1 extends Yo{constructor(d,g){super(),this.client=d,this.queries=[],this.result=[],this.observers=[],this.observersMap={},g&&this.setQueries(g)}onSubscribe(){this.listeners.size===1&&this.observers.forEach(d=>{d.subscribe(g=>{this.onUpdate(d,g)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.observers.forEach(d=>{d.destroy()})}setQueries(d,g){this.queries=d,Xs.batch(()=>{const x=this.observers,v=this.findMatchingObservers(this.queries);v.forEach(M=>M.observer.setOptions(M.defaultedQueryOptions,g));const N=v.map(M=>M.observer),E=Object.fromEntries(N.map(M=>[M.options.queryHash,M])),k=N.map(M=>M.getCurrentResult()),n=N.some((M,z)=>M!==x[z]);x.length===N.length&&!n||(this.observers=N,this.observersMap=E,this.result=k,this.hasListeners()&&(Ry(x,N).forEach(M=>{M.destroy()}),Ry(N,x).forEach(M=>{M.subscribe(z=>{this.onUpdate(M,z)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(d=>d.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(d){return this.findMatchingObservers(d).map(g=>g.observer.getOptimisticResult(g.defaultedQueryOptions))}findMatchingObservers(d){const g=this.observers,x=new Map(g.map(V=>[V.options.queryHash,V])),v=d.map(V=>this.client.defaultQueryOptions(V)),N=v.flatMap(V=>{const G=x.get(V.queryHash);return G!=null?[{defaultedQueryOptions:V,observer:G}]:[]}),E=new Set(N.map(V=>V.defaultedQueryOptions.queryHash)),k=v.filter(V=>!E.has(V.queryHash)),n=new Set(N.map(V=>V.observer)),M=g.filter(V=>!n.has(V)),z=V=>{const G=this.client.defaultQueryOptions(V),H=this.observersMap[G.queryHash];return H??new zf(this.client,G)},q=k.map((V,G)=>{if(V.keepPreviousData){const H=M[G];if(H!==void 0)return{defaultedQueryOptions:V,observer:H}}return{defaultedQueryOptions:V,observer:z(V)}}),U=(V,G)=>v.indexOf(V.defaultedQueryOptions)-v.indexOf(G.defaultedQueryOptions);return N.concat(q).sort(U)}onUpdate(d,g){const x=this.observers.indexOf(d);x!==-1&&(this.result=T1(this.result,x,g),this.notify())}notify(){Xs.batch(()=>{this.listeners.forEach(({listener:d})=>{d(this.result)})})}}class q1 extends zf{constructor(d,g){super(d,g)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(d,g){super.setOptions({...d,behavior:yf()},g)}getOptimisticResult(d){return d.behavior=yf(),super.getOptimisticResult(d)}fetchNextPage({pageParam:d,...g}={}){return this.fetch({...g,meta:{fetchMore:{direction:"forward",pageParam:d}}})}fetchPreviousPage({pageParam:d,...g}={}){return this.fetch({...g,meta:{fetchMore:{direction:"backward",pageParam:d}}})}createResult(d,g){var x,v,N,E,k,n;const{state:M}=d,z=super.createResult(d,g),{isFetching:q,isRefetching:U}=z,V=q&&((x=M.fetchMeta)==null||(v=x.fetchMore)==null?void 0:v.direction)==="forward",G=q&&((N=M.fetchMeta)==null||(E=N.fetchMore)==null?void 0:E.direction)==="backward";return{...z,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:O1(g,(k=M.data)==null?void 0:k.pages),hasPreviousPage:F1(g,(n=M.data)==null?void 0:n.pages),isFetchingNextPage:V,isFetchingPreviousPage:G,isRefetching:U&&!V&&!G}}}let $1=class extends Yo{constructor(d,g){super(),this.client=d,this.setOptions(g),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(d){var g;const x=this.options;this.options=this.client.defaultMutationOptions(d),Oh(x,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(g=this.currentMutation)==null||g.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.currentMutation)==null||d.removeObserver(this)}}onMutationUpdate(d){this.updateResult();const g={listeners:!0};d.type==="success"?g.onSuccess=!0:d.type==="error"&&(g.onError=!0),this.notify(g)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(d,g){return this.mutateOptions=g,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof d<"u"?d:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const d=this.currentMutation?this.currentMutation.state:B0(),g=d.status==="loading",x={...d,isLoading:g,isPending:g,isSuccess:d.status==="success",isError:d.status==="error",isIdle:d.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=x}notify(d){Xs.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(d.onSuccess){var g,x,v,N;(g=(x=this.mutateOptions).onSuccess)==null||g.call(x,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(v=(N=this.mutateOptions).onSettled)==null||v.call(N,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(d.onError){var E,k,n,M;(E=(k=this.mutateOptions).onError)==null||E.call(k,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(n=(M=this.mutateOptions).onSettled)==null||n.call(M,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}d.listeners&&this.listeners.forEach(({listener:z})=>{z(this.currentResult)})})}};var q0={exports:{}},$0={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rc=le;function G1(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var Z1=typeof Object.is=="function"?Object.is:G1,W1=rc.useState,H1=rc.useEffect,X1=rc.useLayoutEffect,K1=rc.useDebugValue;function Q1(c,d){var g=d(),x=W1({inst:{value:g,getSnapshot:d}}),v=x[0].inst,N=x[1];return X1(function(){v.value=g,v.getSnapshot=d,Jp(v)&&N({inst:v})},[c,g,d]),H1(function(){return Jp(v)&&N({inst:v}),c(function(){Jp(v)&&N({inst:v})})},[c]),K1(g),g}function Jp(c){var d=c.getSnapshot;c=c.value;try{var g=d();return!Z1(c,g)}catch{return!0}}function J1(c,d){return d()}var Y1=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?J1:Q1;$0.useSyncExternalStore=rc.useSyncExternalStore!==void 0?rc.useSyncExternalStore:Y1;q0.exports=$0;var ej=q0.exports;const Ff=ej.useSyncExternalStore,Gy=le.createContext(void 0),G0=le.createContext(!1);function Z0(c,d){return c||(d&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=Gy),window.ReactQueryClientContext):Gy)}const tm=({context:c}={})=>{const d=le.useContext(Z0(c,le.useContext(G0)));if(!d)throw new Error("No QueryClient set, use QueryClientProvider to set one");return d},W0=({client:c,children:d,context:g,contextSharing:x=!1})=>{le.useEffect(()=>(c.mount(),()=>{c.unmount()}),[c]);const v=Z0(g,x);return le.createElement(G0.Provider,{value:!g&&x},le.createElement(v.Provider,{value:c},d))},H0=le.createContext(!1),X0=()=>le.useContext(H0);H0.Provider;function tj(){let c=!1;return{clearReset:()=>{c=!1},reset:()=>{c=!0},isReset:()=>c}}const sj=le.createContext(tj()),K0=()=>le.useContext(sj);function Q0(c,d){return typeof c=="function"?c(...d):!!c}const J0=(c,d)=>{(c.suspense||c.useErrorBoundary)&&(d.isReset()||(c.retryOnMount=!1))},Y0=c=>{le.useEffect(()=>{c.clearReset()},[c])},e_=({result:c,errorResetBoundary:d,useErrorBoundary:g,query:x})=>c.isError&&!d.isReset()&&!c.isFetching&&Q0(g,[c.error,x]),t_=c=>{c.suspense&&typeof c.staleTime!="number"&&(c.staleTime=1e3)},s_=(c,d)=>c.isLoading&&c.isFetching&&!d,vf=(c,d,g)=>(c==null?void 0:c.suspense)&&s_(d,g),wf=(c,d,g)=>d.fetchOptimistic(c).then(({data:x})=>{c.onSuccess==null||c.onSuccess(x),c.onSettled==null||c.onSettled(x,null)}).catch(x=>{g.clearReset(),c.onError==null||c.onError(x),c.onSettled==null||c.onSettled(void 0,x)});function rj({queries:c,context:d}){const g=tm({context:d}),x=X0(),v=K0(),N=le.useMemo(()=>c.map(U=>{const V=g.defaultQueryOptions(U);return V._optimisticResults=x?"isRestoring":"optimistic",V}),[c,g,x]);N.forEach(U=>{t_(U),J0(U,v)}),Y0(v);const[E]=le.useState(()=>new V1(g,N)),k=E.getOptimisticResult(N);Ff(le.useCallback(U=>x?()=>{}:E.subscribe(Xs.batchCalls(U)),[E,x]),()=>E.getCurrentResult(),()=>E.getCurrentResult()),le.useEffect(()=>{E.setQueries(N,{listeners:!1})},[N,E]);const M=k.some((U,V)=>vf(N[V],U,x))?k.flatMap((U,V)=>{const G=N[V],H=E.getObservers()[V];if(G&&H){if(vf(G,U,x))return wf(G,H,v);s_(U,x)&&wf(G,H,v)}return[]}):[];if(M.length>0)throw Promise.all(M);const z=E.getQueries(),q=k.find((U,V)=>{var G,H;return e_({result:U,errorResetBoundary:v,useErrorBoundary:(G=(H=N[V])==null?void 0:H.useErrorBoundary)!=null?G:!1,query:z[V]})});if(q!=null&&q.error)throw q.error;return k}function r_(c,d){const g=tm({context:c.context}),x=X0(),v=K0(),N=g.defaultQueryOptions(c);N._optimisticResults=x?"isRestoring":"optimistic",N.onError&&(N.onError=Xs.batchCalls(N.onError)),N.onSuccess&&(N.onSuccess=Xs.batchCalls(N.onSuccess)),N.onSettled&&(N.onSettled=Xs.batchCalls(N.onSettled)),t_(N),J0(N,v),Y0(v);const[E]=le.useState(()=>new d(g,N)),k=E.getOptimisticResult(N);if(Ff(le.useCallback(n=>{const M=x?()=>{}:E.subscribe(Xs.batchCalls(n));return E.updateResult(),M},[E,x]),()=>E.getCurrentResult(),()=>E.getCurrentResult()),le.useEffect(()=>{E.setOptions(N,{listeners:!1})},[N,E]),vf(N,k,x))throw wf(N,E,v);if(e_({result:k,errorResetBoundary:v,useErrorBoundary:N.useErrorBoundary,query:E.getCurrentQuery()}))throw k.error;return N.notifyOnChangeProps?k:E.trackResult(k)}function ij(c,d,g){const x=tc(c,d,g);return r_(x,zf)}function nj(c,d,g){const x=E1(c,d),v=tm({context:x.context}),[N]=le.useState(()=>new $1(v,x));le.useEffect(()=>{N.setOptions(x)},[N,x]);const E=Ff(le.useCallback(n=>N.subscribe(Xs.batchCalls(n)),[N]),()=>N.getCurrentResult(),()=>N.getCurrentResult()),k=le.useCallback((n,M)=>{N.mutate(n,M).catch(aj)},[N]);if(E.error&&Q0(N.options.useErrorBoundary,[E.error]))throw E.error;return{...E,mutate:k,mutateAsync:E.mutate}}function aj(){}function oj(c,d,g){const x=tc(c,d,g);return r_(x,q1)}let lj={data:""},cj=c=>typeof window=="object"?((c?c.querySelector("#_goober"):window._goober)||Object.assign((c||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:c||lj,uj=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,dj=/\/\*[^]*?\*\/|  +/g,Zy=/\n+/g,Ka=(c,d)=>{let g="",x="",v="";for(let N in c){let E=c[N];N[0]=="@"?N[1]=="i"?g=N+" "+E+";":x+=N[1]=="f"?Ka(E,N):N+"{"+Ka(E,N[1]=="k"?"":d)+"}":typeof E=="object"?x+=Ka(E,d?d.replace(/([^,])+/g,k=>N.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,n=>/&/.test(n)?n.replace(/&/g,k):k?k+" "+n:n)):N):E!=null&&(N=/^--/.test(N)?N:N.replace(/[A-Z]/g,"-$&").toLowerCase(),v+=Ka.p?Ka.p(N,E):N+":"+E+";")}return g+(d&&v?d+"{"+v+"}":v)+x},ua={},i_=c=>{if(typeof c=="object"){let d="";for(let g in c)d+=g+i_(c[g]);return d}return c},hj=(c,d,g,x,v)=>{let N=i_(c),E=ua[N]||(ua[N]=(n=>{let M=0,z=11;for(;M<n.length;)z=101*z+n.charCodeAt(M++)>>>0;return"go"+z})(N));if(!ua[E]){let n=N!==c?c:(M=>{let z,q,U=[{}];for(;z=uj.exec(M.replace(dj,""));)z[4]?U.shift():z[3]?(q=z[3].replace(Zy," ").trim(),U.unshift(U[0][q]=U[0][q]||{})):U[0][z[1]]=z[2].replace(Zy," ").trim();return U[0]})(c);ua[E]=Ka(v?{["@keyframes "+E]:n}:n,g?"":"."+E)}let k=g&&ua.g?ua.g:null;return g&&(ua.g=ua[E]),((n,M,z,q)=>{q?M.data=M.data.replace(q,n):M.data.indexOf(n)===-1&&(M.data=z?n+M.data:M.data+n)})(ua[E],d,x,k),E},mj=(c,d,g)=>c.reduce((x,v,N)=>{let E=d[N];if(E&&E.call){let k=E(g),n=k&&k.props&&k.props.className||/^go/.test(k)&&k;E=n?"."+n:k&&typeof k=="object"?k.props?"":Ka(k,""):k===!1?"":k}return x+v+(E??"")},"");function sm(c){let d=this||{},g=c.call?c(d.p):c;return hj(g.unshift?g.raw?mj(g,[].slice.call(arguments,1),d.p):g.reduce((x,v)=>Object.assign(x,v&&v.call?v(d.p):v),{}):g,cj(d.target),d.g,d.o,d.k)}let n_,jf,Nf;sm.bind({g:1});let ma=sm.bind({k:1});function pj(c,d,g,x){Ka.p=d,n_=c,jf=g,Nf=x}function to(c,d){let g=this||{};return function(){let x=arguments;function v(N,E){let k=Object.assign({},N),n=k.className||v.className;g.p=Object.assign({theme:jf&&jf()},k),g.o=/ *go\d+/.test(n),k.className=sm.apply(g,x)+(n?" "+n:"");let M=c;return c[0]&&(M=k.as||c,delete k.as),Nf&&M[0]&&Nf(k),n_(M,k)}return v}}var fj=c=>typeof c=="function",Uh=(c,d)=>fj(c)?c(d):c,gj=(()=>{let c=0;return()=>(++c).toString()})(),a_=(()=>{let c;return()=>{if(c===void 0&&typeof window<"u"){let d=matchMedia("(prefers-reduced-motion: reduce)");c=!d||d.matches}return c}})(),xj=20,o_=(c,d)=>{switch(d.type){case 0:return{...c,toasts:[d.toast,...c.toasts].slice(0,xj)};case 1:return{...c,toasts:c.toasts.map(N=>N.id===d.toast.id?{...N,...d.toast}:N)};case 2:let{toast:g}=d;return o_(c,{type:c.toasts.find(N=>N.id===g.id)?1:0,toast:g});case 3:let{toastId:x}=d;return{...c,toasts:c.toasts.map(N=>N.id===x||x===void 0?{...N,dismissed:!0,visible:!1}:N)};case 4:return d.toastId===void 0?{...c,toasts:[]}:{...c,toasts:c.toasts.filter(N=>N.id!==d.toastId)};case 5:return{...c,pausedAt:d.time};case 6:let v=d.time-(c.pausedAt||0);return{...c,pausedAt:void 0,toasts:c.toasts.map(N=>({...N,pauseDuration:N.pauseDuration+v}))}}},Ph=[],Zo={toasts:[],pausedAt:void 0},el=c=>{Zo=o_(Zo,c),Ph.forEach(d=>{d(Zo)})},yj={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},_j=(c={})=>{let[d,g]=le.useState(Zo),x=le.useRef(Zo);le.useEffect(()=>(x.current!==Zo&&g(Zo),Ph.push(g),()=>{let N=Ph.indexOf(g);N>-1&&Ph.splice(N,1)}),[]);let v=d.toasts.map(N=>{var E,k,n;return{...c,...c[N.type],...N,removeDelay:N.removeDelay||((E=c[N.type])==null?void 0:E.removeDelay)||(c==null?void 0:c.removeDelay),duration:N.duration||((k=c[N.type])==null?void 0:k.duration)||(c==null?void 0:c.duration)||yj[N.type],style:{...c.style,...(n=c[N.type])==null?void 0:n.style,...N.style}}});return{...d,toasts:v}},bj=(c,d="blank",g)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:d,ariaProps:{role:"status","aria-live":"polite"},message:c,pauseDuration:0,...g,id:(g==null?void 0:g.id)||gj()}),ed=c=>(d,g)=>{let x=bj(d,c,g);return el({type:2,toast:x}),x.id},Wr=(c,d)=>ed("blank")(c,d);Wr.error=ed("error");Wr.success=ed("success");Wr.loading=ed("loading");Wr.custom=ed("custom");Wr.dismiss=c=>{el({type:3,toastId:c})};Wr.remove=c=>el({type:4,toastId:c});Wr.promise=(c,d,g)=>{let x=Wr.loading(d.loading,{...g,...g==null?void 0:g.loading});return typeof c=="function"&&(c=c()),c.then(v=>{let N=d.success?Uh(d.success,v):void 0;return N?Wr.success(N,{id:x,...g,...g==null?void 0:g.success}):Wr.dismiss(x),v}).catch(v=>{let N=d.error?Uh(d.error,v):void 0;N?Wr.error(N,{id:x,...g,...g==null?void 0:g.error}):Wr.dismiss(x)}),c};var vj=(c,d)=>{el({type:1,toast:{id:c,height:d}})},wj=()=>{el({type:5,time:Date.now()})},Wu=new Map,jj=1e3,Nj=(c,d=jj)=>{if(Wu.has(c))return;let g=setTimeout(()=>{Wu.delete(c),el({type:4,toastId:c})},d);Wu.set(c,g)},Sj=c=>{let{toasts:d,pausedAt:g}=_j(c);le.useEffect(()=>{if(g)return;let N=Date.now(),E=d.map(k=>{if(k.duration===1/0)return;let n=(k.duration||0)+k.pauseDuration-(N-k.createdAt);if(n<0){k.visible&&Wr.dismiss(k.id);return}return setTimeout(()=>Wr.dismiss(k.id),n)});return()=>{E.forEach(k=>k&&clearTimeout(k))}},[d,g]);let x=le.useCallback(()=>{g&&el({type:6,time:Date.now()})},[g]),v=le.useCallback((N,E)=>{let{reverseOrder:k=!1,gutter:n=8,defaultPosition:M}=E||{},z=d.filter(V=>(V.position||M)===(N.position||M)&&V.height),q=z.findIndex(V=>V.id===N.id),U=z.filter((V,G)=>G<q&&V.visible).length;return z.filter(V=>V.visible).slice(...k?[U+1]:[0,U]).reduce((V,G)=>V+(G.height||0)+n,0)},[d]);return le.useEffect(()=>{d.forEach(N=>{if(N.dismissed)Nj(N.id,N.removeDelay);else{let E=Wu.get(N.id);E&&(clearTimeout(E),Wu.delete(N.id))}})},[d]),{toasts:d,handlers:{updateHeight:vj,startPause:wj,endPause:x,calculateOffset:v}}},Tj=ma`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Ej=ma`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Cj=ma`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,kj=to("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Tj} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Ej} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${c=>c.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Cj} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Aj=ma`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Mj=to("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${c=>c.secondary||"#e0e0e0"};
  border-right-color: ${c=>c.primary||"#616161"};
  animation: ${Aj} 1s linear infinite;
`,Pj=ma`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Ij=ma`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Dj=to("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Pj} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Ij} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${c=>c.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Lj=to("div")`
  position: absolute;
`,Rj=to("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,zj=ma`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Oj=to("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${zj} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Fj=({toast:c})=>{let{icon:d,type:g,iconTheme:x}=c;return d!==void 0?typeof d=="string"?le.createElement(Oj,null,d):d:g==="blank"?null:le.createElement(Rj,null,le.createElement(Mj,{...x}),g!=="loading"&&le.createElement(Lj,null,g==="error"?le.createElement(kj,{...x}):le.createElement(Dj,{...x})))},Bj=c=>`
0% {transform: translate3d(0,${c*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Uj=c=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${c*-150}%,-1px) scale(.6); opacity:0;}
`,Vj="0%{opacity:0;} 100%{opacity:1;}",qj="0%{opacity:1;} 100%{opacity:0;}",$j=to("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Gj=to("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Zj=(c,d)=>{let g=c.includes("top")?1:-1,[x,v]=a_()?[Vj,qj]:[Bj(g),Uj(g)];return{animation:d?`${ma(x)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${ma(v)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Wj=le.memo(({toast:c,position:d,style:g,children:x})=>{let v=c.height?Zj(c.position||d||"top-center",c.visible):{opacity:0},N=le.createElement(Fj,{toast:c}),E=le.createElement(Gj,{...c.ariaProps},Uh(c.message,c));return le.createElement($j,{className:c.className,style:{...v,...g,...c.style}},typeof x=="function"?x({icon:N,message:E}):le.createElement(le.Fragment,null,N,E))});pj(le.createElement);var Hj=({id:c,className:d,style:g,onHeightUpdate:x,children:v})=>{let N=le.useCallback(E=>{if(E){let k=()=>{let n=E.getBoundingClientRect().height;x(c,n)};k(),new MutationObserver(k).observe(E,{subtree:!0,childList:!0,characterData:!0})}},[c,x]);return le.createElement("div",{ref:N,className:d,style:g},v)},Xj=(c,d)=>{let g=c.includes("top"),x=g?{top:0}:{bottom:0},v=c.includes("center")?{justifyContent:"center"}:c.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:a_()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${d*(g?1:-1)}px)`,...x,...v}},Kj=sm`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Ah=16,Qj=({reverseOrder:c,position:d="top-center",toastOptions:g,gutter:x,children:v,containerStyle:N,containerClassName:E})=>{let{toasts:k,handlers:n}=Sj(g);return le.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Ah,left:Ah,right:Ah,bottom:Ah,pointerEvents:"none",...N},className:E,onMouseEnter:n.startPause,onMouseLeave:n.endPause},k.map(M=>{let z=M.position||d,q=n.calculateOffset(M,{reverseOrder:c,gutter:x,defaultPosition:d}),U=Xj(z,q);return le.createElement(Hj,{id:M.id,key:M.id,onHeightUpdate:n.updateHeight,className:M.visible?Kj:"",style:U},M.type==="custom"?Uh(M.message,M):v?v(M):le.createElement(Wj,{toast:M,position:z}))}))},It=Wr;function Jj(c){return c}function Yj(c){return c.length===0?Jj:c.length===1?c[0]:function(g){return c.reduce((x,v)=>v(x),g)}}function l_(c){const d={subscribe(g){let x=null,v=!1,N=!1,E=!1;function k(){if(x===null){E=!0;return}N||(N=!0,typeof x=="function"?x():x&&x.unsubscribe())}return x=c({next(n){var M;v||(M=g.next)==null||M.call(g,n)},error(n){var M;v||(v=!0,(M=g.error)==null||M.call(g,n),k())},complete(){var n;v||(v=!0,(n=g.complete)==null||n.call(g),k())}}),E&&k(),{unsubscribe:k}},pipe(...g){return Yj(g)(d)}};return d}function eN(c){return d=>{let g=0,x=null;const v=[];function N(){x||(x=d.subscribe({next(k){var n;for(const M of v)(n=M.next)==null||n.call(M,k)},error(k){var n;for(const M of v)(n=M.error)==null||n.call(M,k)},complete(){var k;for(const n of v)(k=n.complete)==null||k.call(n)}}))}function E(){if(g===0&&x){const k=x;x=null,k.unsubscribe()}}return{subscribe(k){return g++,v.push(k),N(),{unsubscribe(){g--,E();const n=v.findIndex(M=>M===k);n>-1&&v.splice(n,1)}}}}}}class Bf extends Error{constructor(d){super(d),this.name="ObservableAbortError",Object.setPrototypeOf(this,Bf.prototype)}}function tN(c){let d;return{promise:new Promise((x,v)=>{let N=!1;function E(){N||(N=!0,v(new Bf("This operation was aborted.")),k.unsubscribe())}const k=c.subscribe({next(n){N=!0,x(n),E()},error(n){N=!0,v(n),E()},complete(){N=!0,E()}});d=E}),abort:d}}function sN(c){return l_(d=>{function g(v=0,N=c.op){const E=c.links[v];if(!E)throw new Error("No more links to execute - did you forget to add an ending link?");return E({op:N,next(n){return g(v+1,n)}})}return g().subscribe(d)})}function c_(c){const d=Object.create(null);for(const g in c){const x=c[g];d[x]=g}return d}const u_={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};c_(u_);c_(u_);const d_=()=>{};function h_(c,d){return new Proxy(d_,{get(x,v){if(!(typeof v!="string"||v==="then"))return h_(c,[...d,v])},apply(x,v,N){const E=d[d.length-1]==="apply";return c({args:E?N.length>=2?N[1]:[]:N,path:E?d.slice(0,-1):d})}})}const rm=c=>h_(c,[]),Uf=c=>new Proxy(d_,{get(d,g){if(!(typeof g!="string"||g==="then"))return c(g)}});function rN(c){return!!c&&!Array.isArray(c)&&typeof c=="object"}class iN extends Error{}function nN(c){if(c instanceof Error)return c;const d=typeof c;if(!(d==="undefined"||d==="function"||c===null)){if(d!=="object")return new Error(String(c));if(rN(c)){const g=new iN;for(const x in c)g[x]=c[x];return g}}}function Vh(c){return!!c&&!Array.isArray(c)&&typeof c=="object"}function aN(c,d){if("error"in c){const x=d.transformer.deserialize(c.error);return{ok:!1,error:{...c,error:x}}}return{ok:!0,result:{...c.result,...(!c.result.type||c.result.type==="data")&&{type:"data",data:d.transformer.deserialize(c.result.data)}}}}class Yp extends Error{constructor(){super("Unable to transform response from server")}}function oN(c,d){let g;try{g=aN(c,d)}catch{throw new Yp}if(!g.ok&&(!Vh(g.error.error)||typeof g.error.error.code!="number"))throw new Yp;if(g.ok&&!Vh(g.result))throw new Yp;return g}function lN(c){return c instanceof Vn||c instanceof Error&&c.name==="TRPCClientError"}function cN(c){return Vh(c)&&Vh(c.error)&&typeof c.error.code=="number"&&typeof c.error.message=="string"}class Vn extends Error{static from(d,g={}){const x=d;return lN(x)?(g.meta&&(x.meta={...x.meta,...g.meta}),x):cN(x)?new Vn(x.error.message,{...g,result:x}):x instanceof Error?new Vn(x.message,{...g,cause:nN(x)}):new Vn("Unknown error",{...g,cause:x})}constructor(d,g){var v,N;const x=g==null?void 0:g.cause;super(d,{cause:x}),this.meta=g==null?void 0:g.meta,this.cause=x,this.shape=(v=g==null?void 0:g.result)==null?void 0:v.error,this.data=(N=g==null?void 0:g.result)==null?void 0:N.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,Vn.prototype)}}const Wy=c=>typeof c=="function";function uN(c){if(c)return c;if(typeof window<"u"&&Wy(window.fetch))return window.fetch;if(typeof globalThis<"u"&&Wy(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}function dN(c){return c||(typeof window<"u"&&window.AbortController?window.AbortController:typeof globalThis<"u"&&globalThis.AbortController?globalThis.AbortController:null)}function hN(c){return{url:c.url.toString().replace(/\/$/,""),fetch:c.fetch,AbortController:dN(c.AbortController)}}function mN(c){const d={};for(let g=0;g<c.length;g++){const x=c[g];d[g]=x}return d}const pN={query:"GET",mutation:"POST"};function m_(c){return"input"in c?c.runtime.transformer.serialize(c.input):mN(c.inputs.map(d=>c.runtime.transformer.serialize(d)))}const p_=c=>{let d=c.url+"/"+c.path;const g=[];if("inputs"in c&&g.push("batch=1"),c.type==="query"){const x=m_(c);x!==void 0&&g.push(`input=${encodeURIComponent(JSON.stringify(x))}`)}return g.length&&(d+="?"+g.join("&")),d},fN=c=>{if(c.type==="query")return;const d=m_(c);return d!==void 0?JSON.stringify(d):void 0},gN=c=>yN({...c,contentTypeHeader:"application/json",getUrl:p_,getBody:fN});async function xN(c,d){const g=c.getUrl(c),x=c.getBody(c),{type:v}=c,N=await c.headers();/* istanbul ignore if -- @preserve */if(v==="subscription")throw new Error("Subscriptions should use wsLink");const E={...c.contentTypeHeader?{"content-type":c.contentTypeHeader}:{},...c.batchModeHeader?{"trpc-batch-mode":c.batchModeHeader}:{},...N};return uN(c.fetch)(g,{method:pN[v],signal:d==null?void 0:d.signal,body:x,headers:E})}function yN(c){const d=c.AbortController?new c.AbortController:null,g={};let x=!1;return{promise:new Promise((E,k)=>{xN(c,d).then(n=>(g.response=n,x=!0,n.json())).then(n=>{g.responseJSON=n,E({json:n,meta:g})}).catch(n=>{x=!0,k(Vn.from(n,{meta:g}))})}),cancel:()=>{x||d==null||d.abort()}}}const ef=()=>{throw new Error("Something went wrong. Please submit an issue at https://github.com/trpc/trpc/issues/new")};function tf(c){let d=null,g=null;const x=()=>{clearTimeout(g),g=null,d=null};function v(k){var z,q;const n=[[]];let M=0;for(;;){const U=k[M];if(!U)break;const V=n[n.length-1];if(U.aborted){(z=U.reject)==null||z.call(U,new Error("Aborted")),M++;continue}if(c.validate(V.concat(U).map(H=>H.key))){V.push(U),M++;continue}if(V.length===0){(q=U.reject)==null||q.call(U,new Error("Input is too big for a single dispatch")),M++;continue}n.push([])}return n}function N(){const k=v(d);x();for(const n of k){if(!n.length)continue;const M={items:n,cancel:ef};for(const V of n)V.batch=M;const z=(V,G)=>{var Y;const H=M.items[V];(Y=H.resolve)==null||Y.call(H,G),H.batch=null,H.reject=null,H.resolve=null},{promise:q,cancel:U}=c.fetch(M.items.map(V=>V.key),z);M.cancel=U,q.then(V=>{var G;for(let H=0;H<V.length;H++){const Y=V[H];z(H,Y)}for(const H of M.items)(G=H.reject)==null||G.call(H,new Error("Missing result")),H.batch=null}).catch(V=>{var G;for(const H of M.items)(G=H.reject)==null||G.call(H,V),H.batch=null})}}function E(k){const n={aborted:!1,key:k,batch:null,resolve:ef,reject:ef},M=new Promise((q,U)=>{n.reject=U,n.resolve=q,d||(d=[]),d.push(n)});return g||(g=setTimeout(N)),{promise:M,cancel:()=>{var q;n.aborted=!0,(q=n.batch)!=null&&q.items.every(U=>U.aborted)&&(n.batch.cancel(),n.batch=null)}}}return{load:E}}function _N(c){return function(g){const x=hN(g),v=g.maxURLLength??1/0;return N=>{const E=q=>{const U=G=>{if(v===1/0)return!0;const H=G.map(oe=>oe.path).join(","),Y=G.map(oe=>oe.input);return p_({...x,runtime:N,type:q,path:H,inputs:Y}).length<=v},V=c({...x,runtime:N,type:q,opts:g});return{validate:U,fetch:V}},k=tf(E("query")),n=tf(E("mutation")),M=tf(E("subscription")),z={query:k,subscription:M,mutation:n};return({op:q})=>l_(U=>{const V=z[q.type],{promise:G,cancel:H}=V.load(q);let Y;return G.then(ge=>{Y=ge;const oe=oN(ge.json,N);if(!oe.ok){U.error(Vn.from(oe.error,{meta:ge.meta}));return}U.next({context:ge.meta,result:oe.result}),U.complete()}).catch(ge=>{U.error(Vn.from(ge,{meta:Y==null?void 0:Y.meta}))}),()=>{H()}})}}}const bN=c=>d=>{const g=d.map(E=>E.path).join(","),x=d.map(E=>E.input),{promise:v,cancel:N}=gN({...c,path:g,inputs:x,headers(){return c.opts.headers?typeof c.opts.headers=="function"?c.opts.headers({opList:d}):c.opts.headers:{}}});return{promise:v.then(E=>(Array.isArray(E.json)?E.json:d.map(()=>E.json)).map(M=>({meta:E.meta,json:M}))),cancel:N}},vN=_N(bN);class wN{$request({type:d,input:g,path:x,context:v={}}){return sN({links:this.links,op:{id:++this.requestId,type:d,path:x,input:g,context:v}}).pipe(eN())}requestAsPromise(d){const g=this.$request(d),{promise:x,abort:v}=tN(g);return new Promise((E,k)=>{var n;(n=d.signal)==null||n.addEventListener("abort",v),x.then(M=>{E(M.result.data)}).catch(M=>{k(Vn.from(M))})})}query(d,g,x){return this.requestAsPromise({type:"query",path:d,input:g,context:x==null?void 0:x.context,signal:x==null?void 0:x.signal})}mutation(d,g,x){return this.requestAsPromise({type:"mutation",path:d,input:g,context:x==null?void 0:x.context,signal:x==null?void 0:x.signal})}subscription(d,g,x){return this.$request({type:"subscription",path:d,input:g,context:x==null?void 0:x.context}).subscribe({next(N){var E,k,n;N.result.type==="started"?(E=x.onStarted)==null||E.call(x):N.result.type==="stopped"?(k=x.onStopped)==null||k.call(x):(n=x.onData)==null||n.call(x,N.result.data)},error(N){var E;(E=x.onError)==null||E.call(x,N)},complete(){var N;(N=x.onComplete)==null||N.call(x)}})}constructor(d){this.requestId=0;const g=(()=>{const x=d.transformer;return x?"input"in x?d.transformer:{input:x,output:x}:{input:{serialize:v=>v,deserialize:v=>v},output:{serialize:v=>v,deserialize:v=>v}}})();this.runtime={transformer:{serialize:x=>g.input.serialize(x),deserialize:x=>g.output.deserialize(x)},combinedTransformer:g},this.links=d.links.map(x=>x(this.runtime))}}function jN(c){return new wN(c)}const NN={query:"query",mutate:"mutation",subscribe:"subscription"},SN=c=>NN[c];function TN(c){return Uf(d=>c.hasOwnProperty(d)?c[d]:d==="__untypedClient"?c:rm(({path:g,args:x})=>{const v=[d,...g],N=SN(v.pop()),E=v.join(".");return c[N](E,...x)}))}function pr(c,d){const g=Array.isArray(c)?c:[c],[x,v]=g,N=typeof x!="string"||x===""?[]:x.split(".");return!v&&(!d||d==="any")?N.length?[N]:[]:[N,{...typeof v<"u"&&{input:v},...d&&d!=="any"&&{type:d}}]}function qh(c,d){return c.length?d===void 0?[c]:[c,d]:[]}function EN(c,d){return rm(g=>{const x=g.args,v=[c,...g.path],N=v.pop(),E=v.join(".");if(N==="useMutation")return d[N](E,...x);const[k,...n]=x,M=qh(E,k);if(N==="getQueryKey")return pr(M,n[0]??"any");if(N==="_def")return{path:v};if(N.startsWith("useSuspense")){const z=n[0]||{},U=d[N==="useSuspenseQuery"?"useQuery":"useInfiniteQuery"](M,{...z,suspense:!0,enabled:!0});return[U.data,U]}return d[N](M,...n)})}const CN=["client","ssrContext","ssrState","abortOnUnmount"],kN=le.createContext(null);function AN(c){return Uf(d=>{const g=d;return g==="client"?TN(c.client):CN.includes(g)?c[g]:rm(({path:x,args:v})=>{const N=[d,...x],E=N.pop(),k=N.join("."),n=V=>{if(["setData","setInfiniteData"].includes(V)){const[ge,oe,...se]=v;return{queryKey:qh(k,ge),updater:oe,rest:se}}const[G,...H]=v;return{queryKey:qh(k,G),rest:H}},{queryKey:M,rest:z,updater:q}=n(E);return{fetch:()=>c.fetchQuery(M,...z),fetchInfinite:()=>c.fetchInfiniteQuery(M,...z),prefetch:()=>c.prefetchQuery(M,...z),prefetchInfinite:()=>c.prefetchInfiniteQuery(M,...z),ensureData:()=>c.ensureQueryData(M,...z),invalidate:()=>c.invalidateQueries(M,...z),reset:()=>c.resetQueries(M,...z),refetch:()=>c.refetchQueries(M,...z),cancel:()=>c.cancelQuery(M,...z),setData:()=>{c.setQueryData(M,q,...z)},setInfiniteData:()=>{c.setInfiniteQueryData(M,q,...z)},getData:()=>c.getQueryData(M),getInfiniteData:()=>c.getInfiniteQueryData(M)}[E]()})})}function MN(c){return rm(d=>{const g=d.path.join("."),[x,v]=d.args;return{queryKey:qh(g,x),queryFn:()=>c.query(g,x,v==null?void 0:v.trpc),...v}})}function Za(c,d){const[g,x]=c;return[g,x,d==null?void 0:d.trpc]}function sf(c){const{path:d}=c;return le.useMemo(()=>({path:d}),[d])}function PN(c){const d=G=>G.originalFn(),g=kN,x=c==null?void 0:c.reactQueryContext,v=G=>jN(G),N=G=>{const{abortOnUnmount:H=!1,client:Y,queryClient:ge,ssrContext:oe}=G,[se,de]=le.useState(G.ssrState??!1);return le.useEffect(()=>{de(ae=>ae?"mounted":!1)},[]),ui.createElement(g.Provider,{value:{abortOnUnmount:H,queryClient:ge,client:Y,ssrContext:oe??null,ssrState:se,fetchQuery:le.useCallback((ae,Se)=>ge.fetchQuery({...Se,queryKey:pr(ae,"query"),queryFn:()=>Y.query(...Za(ae,Se))}),[Y,ge]),fetchInfiniteQuery:le.useCallback((ae,Se)=>ge.fetchInfiniteQuery({...Se,queryKey:pr(ae,"infinite"),queryFn:({pageParam:Ce})=>{const[fe,Ie]=ae,ke={...Ie,cursor:Ce};return Y.query(...Za([fe,ke],Se))}}),[Y,ge]),prefetchQuery:le.useCallback((ae,Se)=>ge.prefetchQuery({...Se,queryKey:pr(ae,"query"),queryFn:()=>Y.query(...Za(ae,Se))}),[Y,ge]),prefetchInfiniteQuery:le.useCallback((ae,Se)=>ge.prefetchInfiniteQuery({...Se,queryKey:pr(ae,"infinite"),queryFn:({pageParam:Ce})=>{const[fe,Ie]=ae,ke={...Ie,cursor:Ce};return Y.query(...Za([fe,ke],Se))}}),[Y,ge]),ensureQueryData:le.useCallback((ae,Se)=>ge.ensureQueryData({...Se,queryKey:pr(ae,"query"),queryFn:()=>Y.query(...Za(ae,Se))}),[Y,ge]),invalidateQueries:le.useCallback((ae,Se,Ce)=>ge.invalidateQueries({...Se,queryKey:pr(ae,"any")},Ce),[ge]),resetQueries:le.useCallback((...ae)=>{const[Se,Ce,fe]=ae;return ge.resetQueries({...Ce,queryKey:pr(Se,"any")},fe)},[ge]),refetchQueries:le.useCallback((...ae)=>{const[Se,Ce,fe]=ae;return ge.refetchQueries({...Ce,queryKey:pr(Se,"any")},fe)},[ge]),cancelQuery:le.useCallback(ae=>ge.cancelQueries({queryKey:pr(ae,"any")}),[ge]),setQueryData:le.useCallback((...ae)=>{const[Se,...Ce]=ae;return ge.setQueryData(pr(Se,"query"),...Ce)},[ge]),getQueryData:le.useCallback((...ae)=>{const[Se,...Ce]=ae;return ge.getQueryData(pr(Se,"query"),...Ce)},[ge]),setInfiniteQueryData:le.useCallback((...ae)=>{const[Se,...Ce]=ae;return ge.setQueryData(pr(Se,"infinite"),...Ce)},[ge]),getInfiniteQueryData:le.useCallback((...ae)=>{const[Se,...Ce]=ae;return ge.getQueryData(pr(Se,"infinite"),...Ce)},[ge])}},G.children)};function E(){return ui.useContext(g)}function k(G,H,Y){var se;const{queryClient:ge,ssrState:oe}=E();return oe&&oe!=="mounted"&&((se=ge.getQueryCache().find(pr(G,H)))==null?void 0:se.state.status)==="error"?{retryOnMount:!1,...Y}:Y}function n(G,H){var ke,et;const Y=E();if(!Y)throw new Error("Unable to retrieve application context. Did you forget to wrap your App inside `withTRPC` HoC?");const{abortOnUnmount:ge,client:oe,ssrState:se,queryClient:de,prefetchQuery:ae}=Y,Se=de.getQueryDefaults(pr(G,"query"));typeof window>"u"&&se==="prepass"&&((ke=H==null?void 0:H.trpc)==null?void 0:ke.ssr)!==!1&&((H==null?void 0:H.enabled)??(Se==null?void 0:Se.enabled))!==!1&&!de.getQueryCache().find(pr(G,"query"))&&ae(G,H);const Ce=k(G,"query",{...Se,...H}),fe=((et=H==null?void 0:H.trpc)==null?void 0:et.abortOnUnmount)??(c==null?void 0:c.abortOnUnmount)??ge,Ie=ij({...Ce,queryKey:pr(G,"query"),queryFn:Pe=>{const Ne={...Ce,trpc:{...Ce==null?void 0:Ce.trpc,...fe?{signal:Pe.signal}:{}}};return oe.query(...Za(G,Ne))},context:x});return Ie.trpc=sf({path:G[0]}),Ie}function M(G,H){const{client:Y}=E(),ge=tm({context:x}),oe=Array.isArray(G)?G[0]:G,se=ge.getMutationDefaults([oe.split(".")]),de=nj({...H,mutationKey:[oe.split(".")],mutationFn:ae=>Y.mutation(...Za([oe,ae],H)),context:x,onSuccess(...ae){return d({originalFn:()=>{var Ce,fe;return((Ce=H==null?void 0:H.onSuccess)==null?void 0:Ce.call(H,...ae))??((fe=se==null?void 0:se.onSuccess)==null?void 0:fe.call(se,...ae))},queryClient:ge,meta:(H==null?void 0:H.meta)??(se==null?void 0:se.meta)??{}})}});return de.trpc=sf({path:oe}),de}/* istanbul ignore next -- @preserve */function z(G,H){const Y=(H==null?void 0:H.enabled)??!0,ge=Ya(G),{client:oe}=E(),se=le.useRef(H);se.current=H,le.useEffect(()=>{if(!Y)return;const[de,ae]=G;let Se=!1;const Ce=oe.subscription(de,ae??void 0,{onStarted:()=>{var fe,Ie;Se||(Ie=(fe=se.current).onStarted)==null||Ie.call(fe)},onData:fe=>{Se||se.current.onData(fe)},onError:fe=>{var Ie,ke;Se||(ke=(Ie=se.current).onError)==null||ke.call(Ie,fe)}});return()=>{Se=!0,Ce.unsubscribe()}},[ge,Y])}function q(G,H){var et,Pe;const[Y,ge]=G,{client:oe,ssrState:se,prefetchInfiniteQuery:de,queryClient:ae,abortOnUnmount:Se}=E(),Ce=ae.getQueryDefaults(pr(G,"infinite"));typeof window>"u"&&se==="prepass"&&((et=H==null?void 0:H.trpc)==null?void 0:et.ssr)!==!1&&((H==null?void 0:H.enabled)??(Ce==null?void 0:Ce.enabled))!==!1&&!ae.getQueryCache().find(pr(G,"infinite"))&&de(G,{...Ce,...H});const fe=k(G,"infinite",{...Ce,...H}),Ie=((Pe=H==null?void 0:H.trpc)==null?void 0:Pe.abortOnUnmount)??Se,ke=oj({...fe,queryKey:pr(G,"infinite"),queryFn:Ne=>{const it={...fe,trpc:{...fe==null?void 0:fe.trpc,...Ie?{signal:Ne.signal}:{}}},ft={...ge??{},cursor:Ne.pageParam??(H==null?void 0:H.initialCursor)};return oe.query(...Za([Y,ft],it))},context:x});return ke.trpc=sf({path:Y}),ke}return{Provider:N,createClient:v,useContext:E,useUtils:E,useQuery:n,useQueries:(G,H)=>{var Se;const{ssrState:Y,queryClient:ge,prefetchQuery:oe,client:se}=E(),de=MN(se),ae=G(de);if(typeof window>"u"&&Y==="prepass")for(const Ce of ae){const fe=Ce;((Se=fe.trpc)==null?void 0:Se.ssr)!==!1&&!ge.getQueryCache().find(pr(fe.queryKey,"query"))&&oe(fe.queryKey,fe)}return rj({queries:ae.map(Ce=>({...Ce,queryKey:pr(Ce.queryKey,"query")})),context:H})},useMutation:M,useSubscription:z,useDehydratedState:(G,H)=>le.useMemo(()=>H&&G.runtime.transformer.deserialize(H),[H,G]),useInfiniteQuery:q}}function IN(c){return PN(c)}function DN(c){return Uf(d=>d==="useContext"||d==="useUtils"?()=>{const g=c.useUtils();return le.useMemo(()=>AN(g),[g])}:c.hasOwnProperty(d)?c[d]:EN(d,c))}function LN(c){const d=IN(c);return DN(d)}const kt=LN(),RN=kt.createClient({links:[vN({url:"/api/v1/trpc",headers:async()=>{try{const c=localStorage.getItem("auth_token");return c?{Authorization:`Bearer ${c}`}:{}}catch(c){return console.warn("Failed to get auth token for tRPC:",c),{}}}})]}),f_=le.createContext(void 0),im=()=>{const c=le.useContext(f_);if(c===void 0)throw new Error("useAuth must be used within an AuthProvider");return c},zN=({children:c})=>{const[d,g]=le.useState({user:null,loading:!0,error:null}),x=kt.auth.login.useMutation(),v=kt.auth.register.useMutation(),N=kt.auth.logout.useMutation(),E=kt.auth.me.useMutation(),k=async(q,U)=>{g(V=>({...V,loading:!0,error:null}));try{const V=await x.mutateAsync({email:q,password:U});localStorage.setItem("auth_token",V.session.access_token),localStorage.setItem("refresh_token",V.session.refresh_token),g({user:V.user,loading:!1,error:null})}catch(V){throw g(G=>({...G,loading:!1,error:V.message||"Authentication failed"})),V}},n=async(q,U,V)=>{g(G=>({...G,loading:!0,error:null}));try{const G=await v.mutateAsync({email:q,password:U,name:V});g(H=>({...H,loading:!1,error:null}))}catch(G){throw g(H=>({...H,loading:!1,error:G.message||"Registration failed"})),G}},M=async()=>{g(q=>({...q,loading:!0}));try{await N.mutateAsync()}catch{}localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),g({user:null,loading:!1,error:null})};le.useEffect(()=>{(async()=>{if(!localStorage.getItem("auth_token")){g(V=>({...V,loading:!1}));return}try{const V=await E.mutateAsync();g({user:V.user,loading:!1,error:null})}catch{localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),g({user:null,loading:!1,error:null})}})()},[]);const z={...d,signIn:k,signOut:M,register:n};return t.jsx(f_.Provider,{value:z,children:c})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ON={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FN=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Lt=(c,d)=>{const g=le.forwardRef(({color:x="currentColor",size:v=24,strokeWidth:N=2,absoluteStrokeWidth:E,className:k="",children:n,...M},z)=>le.createElement("svg",{ref:z,...ON,width:v,height:v,stroke:x,strokeWidth:E?Number(N)*24/Number(v):N,className:["lucide",`lucide-${FN(c)}`,k].join(" "),...M},[...d.map(([q,U])=>le.createElement(q,U)),...Array.isArray(n)?n:[n]]));return g.displayName=`${c}`,g};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hy=Lt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nm=Lt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=Lt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=Lt("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=Lt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_=Lt("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BN=Lt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=Lt("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=Lt("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=Lt("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=Lt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VN=Lt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Lt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qN=Lt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const am=Lt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=Lt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=Lt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $N=Lt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ki=Lt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GN=Lt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZN=Lt("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qf=Lt("Cylinder",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5v14a9 3 0 0 0 18 0V5",key:"aqi0yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=Lt("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $f=Lt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WN=Lt("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const om=Lt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_=Lt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qu=Lt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_=Lt("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"8ur5zv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=Lt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XN=Lt("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=Lt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=Lt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QN=Lt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JN=Lt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=Lt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=Lt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eS=Lt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=Lt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_=Lt("Package2",[["path",{d:"M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z",key:"1ront0"}],["path",{d:"m3 9 2.45-4.9A2 2 0 0 1 7.24 3h9.52a2 2 0 0 1 1.8 1.1L21 9",key:"19h2x1"}],["path",{d:"M12 3v6",key:"1holv5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=Lt("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tS=Lt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=Lt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=Lt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rS=Lt("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=Lt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=Lt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N_=Lt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sf=Lt("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=Lt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iS=Lt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nS=Lt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lm=Lt("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ai=Lt("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $h=Lt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=Lt("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=Lt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xy=Lt("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=Lt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=Lt("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cm=Lt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ic=Lt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=Lt("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gf=Lt("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oS=Lt("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=Lt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=Lt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lS=Lt("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),cS=({children:c})=>{const{user:d,adminUser:g,loading:x}=im();return x?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}):!d||!g?t.jsx(k0,{to:"/login",replace:!0}):t.jsx(t.Fragment,{children:c})},uS=({onMenuClick:c})=>{const{adminUser:d,signOut:g}=im(),x=async()=>{try{await g()}catch(v){console.error("Error signing out:",v)}};return t.jsxs("header",{className:"bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:c,className:"lg:hidden p-2 rounded-md hover:bg-gray-100 transition-colors",children:t.jsx(YN,{className:"h-6 w-6 text-gray-600"})}),t.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"LPG Order Management"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(cm,{className:"h-4 w-4"}),t.jsxs("div",{className:"flex flex-col items-end",children:[t.jsx("span",{className:"font-medium text-gray-900",children:d==null?void 0:d.name}),t.jsx("span",{className:"text-xs capitalize",children:d==null?void 0:d.role})]})]})}),t.jsxs("button",{onClick:x,className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:[t.jsx(QN,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Sign Out"})]})]})]})},dS=[{name:"Dashboard",href:"/",icon:XN},{name:"Customers",href:"/customers",icon:ic},{name:"Products",href:"/products",icon:fs},{name:"Warehouses",href:"/warehouses",icon:Gn},{name:"Inventory",href:"/inventory",icon:Ko},{name:"Trucks",href:"/trucks",icon:wr},{name:"Fleet Capacity",href:"/trucks/capacity",icon:Sn},{name:"Pricing",href:"/pricing",icon:$n},{name:"Orders",href:"/orders",icon:lm},{name:"Transfers",href:"/transfers",icon:Vf}],hS=({isOpen:c,onClose:d})=>t.jsxs(t.Fragment,{children:[c&&t.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden",onClick:d}),t.jsxs("aside",{className:`
          fixed top-0 left-0 z-50 h-full w-64 bg-gray-900 transform transition-transform duration-300 ease-in-out
          ${c?"translate-x-0":"-translate-x-full"}
          lg:translate-x-0 lg:static lg:z-auto lg:flex-shrink-0
        `,children:[t.jsxs("div",{className:"flex items-center justify-between p-4 lg:hidden border-b border-gray-700",children:[t.jsx("span",{className:"text-lg font-semibold text-white",children:"Menu"}),t.jsx("button",{onClick:d,className:"p-2 rounded-md hover:bg-gray-800 transition-colors",children:t.jsx(Ys,{className:"h-5 w-5 text-gray-300"})})]}),t.jsx("div",{className:"hidden lg:flex items-center justify-center h-16 bg-gray-800 border-b border-gray-700",children:t.jsx("span",{className:"text-lg font-semibold text-white",children:"LPG Admin"})}),t.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-y-auto",children:dS.map(g=>t.jsxs(m1,{to:g.href,onClick:d,className:({isActive:x})=>`flex items-center space-x-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${x?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-800"}`,children:[t.jsx(g.icon,{className:"h-5 w-5"}),t.jsx("span",{children:g.name})]},g.name))})]})]}),mS=()=>{const[c,d]=le.useState(!1);return t.jsxs("div",{className:"h-screen flex overflow-hidden bg-gray-50",children:[t.jsx(hS,{isOpen:c,onClose:()=>d(!1)}),t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[t.jsx(uS,{onMenuClick:()=>d(!c)}),t.jsx("main",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"p-6",children:t.jsx(p1,{})})})]})]})},pS=()=>{const{user:c,signIn:d,loading:g,error:x}=im(),[v,N]=le.useState({email:"",password:""}),[E,k]=le.useState(!1);if(c)return t.jsx(k0,{to:"/",replace:!0});const n=async z=>{z.preventDefault(),k(!0);try{await d(v.email,v.password)}catch{}finally{k(!1)}},M=z=>{N(q=>({...q,[z.target.name]:z.target.value}))};return g?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"max-w-md w-full space-y-8",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mx-auto h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center",children:t.jsx(v_,{className:"h-8 w-8 text-white"})}),t.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Admin Portal"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"LPG Order Management System"})]}),t.jsxs("form",{className:"mt-8 space-y-6",onSubmit:n,children:[x&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(nm,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-600",children:x})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),t.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:v.email,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter your email"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),t.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:v.password,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter your password"})]})]}),t.jsx("button",{type:"submit",disabled:E,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:E?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Signing in..."})]}):"Sign In"})]}),t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-xs text-gray-500",children:"Authorized personnel only. Please contact your administrator if you need access."})})]})})},fS=(c="month")=>kt.analytics.getDashboardStats.useQuery({period:c},{retry:1,staleTime:6e4,refetchInterval:5*60*1e3}),gS=()=>{const{adminUser:c}=im(),{data:d,isLoading:g,refetch:x}=fS(),v=[{name:"Active Customers",value:g?"...":((d==null?void 0:d.activeCustomers)||0).toLocaleString(),total:g?"...":((d==null?void 0:d.totalCustomers)||0).toLocaleString(),change:g?"...":`${(d==null?void 0:d.totalCustomers)||0} total`,changeType:"neutral",icon:ic},{name:"Active Products",value:g?"...":((d==null?void 0:d.activeProducts)||0).toLocaleString(),total:g?"...":((d==null?void 0:d.totalProducts)||0).toLocaleString(),change:g?"...":`${(d==null?void 0:d.totalProducts)||0} total`,changeType:"neutral",icon:fs},{name:"Total Cylinders",value:g?"...":((d==null?void 0:d.totalCylinders)||0).toLocaleString(),change:g?"...":"across all warehouses",changeType:"positive",icon:Sn},{name:"Warehouses",value:g?"...":((d==null?void 0:d.totalWarehouses)||0).toLocaleString(),change:g?"...":"storage locations",changeType:"neutral",icon:Gn}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),t.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",c==null?void 0:c.name,"!"]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>x(),disabled:g,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(tl,{className:`h-4 w-4 ${g?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsx(Ko,{className:"h-8 w-8 text-blue-600"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:v.map(N=>t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:N.name}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.value})]}),t.jsx("div",{className:"p-3 bg-blue-50 rounded-full",children:t.jsx(N.icon,{className:"h-6 w-6 text-blue-600"})})]}),t.jsx("div",{className:"mt-4 flex items-center",children:t.jsx("span",{className:"text-sm text-gray-500",children:N.change})})]},N.name))}),!g&&d&&d.lowStockProducts>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-5 w-5 text-red-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Low Stock Alert"}),t.jsxs("p",{className:"text-sm text-red-700",children:[d.lowStockProducts," product",d.lowStockProducts>1?"s have":" has"," low stock levels (10 available)"]})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("button",{onClick:()=>window.location.href="/orders",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(lm,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"New Order"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Create a new customer order"})]}),t.jsxs("button",{onClick:()=>window.location.href="/customers",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(ic,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"Add Customer"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Register a new customer"})]}),t.jsxs("button",{onClick:()=>window.location.href="/inventory",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(fs,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"Manage Inventory"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Update product stock levels"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),t.jsx(Hy,{className:"h-5 w-5 text-gray-400"})]}),t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Hy,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"Recent activity tracking coming soon"})]})]})]})},S_=(c={})=>kt.customers.list.useQuery({search:c.search,status:c.status,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Customers fetch error:",d),It.error("Failed to load customers")}}),xS=c=>kt.customers.getById.useQuery({customer_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Customer fetch error:",d),It.error("Failed to load customer details")}}),yS=()=>{const c=kt.useContext();return kt.customers.create.useMutation({onSuccess:d=>{console.log("Customer created successfully:",d),c.customers.list.invalidate(),It.success("Customer created successfully")},onError:d=>{console.error("Create customer error:",d),It.error(d.message||"Failed to create customer")}})},T_=()=>{const c=kt.useContext();return kt.customers.update.useMutation({onSuccess:d=>{console.log("Customer updated successfully:",d),c.customers.list.invalidate(),c.customers.getById.invalidate({customer_id:d.id}),It.success("Customer updated successfully")},onError:d=>{console.error("Update customer error:",d),It.error(d.message||"Failed to update customer")}})},_S=()=>{const c=kt.useContext();return kt.customers.delete.useMutation({onSuccess:()=>{console.log("Customer deleted successfully"),c.customers.list.invalidate(),It.success("Customer deleted successfully")},onError:d=>{console.error("Delete customer error:",d),It.error(d.message||"Failed to delete customer")}})},bS=({customers:c,loading:d=!1,onView:g,onDelete:x,onStatusChange:v})=>{const N=E=>new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return console.log("CustomerTable render:",{customers:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading customers..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(ic,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No customers found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load customers. Please check your connection.":"Get started by adding your first customer."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Customers (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credit Terms"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(E=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:E.name}),E.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",E.external_id]}),E.tax_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Tax ID: ",E.tax_id]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[E.email&&t.jsx("div",{className:"mb-1",children:E.email}),E.phone&&t.jsx("div",{className:"text-gray-500",children:E.phone}),!E.email&&!E.phone&&t.jsx("span",{className:"text-gray-400",children:"No contact info"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("select",{value:E.account_status,onChange:k=>v(E,k.target.value),className:`block w-full pl-3 pr-10 py-2 text-sm border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${E.account_status==="active"?"bg-green-50 text-green-700 border-green-200":E.account_status==="credit_hold"?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-red-50 text-red-700 border-red-200"}`,children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[E.credit_terms_days," days"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(E.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(E),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View/Edit customer",children:t.jsx(ai,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>x(E),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete customer",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},E.id))})]})})]})},vS=({filters:c,onFiltersChange:d})=>{const g=v=>{d({...c,search:v.target.value||void 0,page:1})},x=v=>{d({...c,account_status:v.target.value||void 0,page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name, email, or tax ID...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.account_status||"",onChange:x,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]})})]})})},ac=({currentPage:c,totalPages:d,totalCount:g,onPageChange:x})=>{if(d<=1)return null;const N=(()=>{const k=[],n=[];for(let M=Math.max(2,c-2);M<=Math.min(d-1,c+2);M++)k.push(M);return c-2>2?n.push(1,"..."):n.push(1),n.push(...k),c+2<d-1?n.push("...",d):n.push(d),n})();return t.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[t.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[t.jsx("button",{onClick:()=>x(c-1),disabled:c===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),t.jsx("button",{onClick:()=>x(c+1),disabled:c===d,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),t.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[t.jsx("div",{children:t.jsxs("p",{className:"text-sm text-gray-700",children:["Showing"," ",t.jsx("span",{className:"font-medium",children:Math.min((c-1)*50+1,g)})," ","to"," ",t.jsx("span",{className:"font-medium",children:Math.min(c*50,g)})," ","of ",t.jsx("span",{className:"font-medium",children:g})," results"]})}),t.jsx("div",{children:t.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[t.jsx("button",{onClick:()=>x(c-1),disabled:c===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(y_,{className:"h-5 w-5"})}),N.map((E,k)=>t.jsx(ui.Fragment,{children:E==="..."?t.jsx("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:"..."}):t.jsx("button",{onClick:()=>x(E),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${c===E?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:E})},k)),t.jsx("button",{onClick:()=>x(c+1),disabled:c===d,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(__,{className:"h-5 w-5"})})]})})]})]})};var td=c=>c.type==="checkbox",Wo=c=>c instanceof Date,di=c=>c==null;const E_=c=>typeof c=="object";var br=c=>!di(c)&&!Array.isArray(c)&&E_(c)&&!Wo(c),wS=c=>br(c)&&c.target?td(c.target)?c.target.checked:c.target.value:c,jS=c=>c.substring(0,c.search(/\.\d+(\.|$)/))||c,NS=(c,d)=>c.has(jS(d)),SS=c=>{const d=c.constructor&&c.constructor.prototype;return br(d)&&d.hasOwnProperty("isPrototypeOf")},Zf=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function ii(c){let d;const g=Array.isArray(c),x=typeof FileList<"u"?c instanceof FileList:!1;if(c instanceof Date)d=new Date(c);else if(c instanceof Set)d=new Set(c);else if(!(Zf&&(c instanceof Blob||x))&&(g||br(c)))if(d=g?[]:{},!g&&!SS(c))d=c;else for(const v in c)c.hasOwnProperty(v)&&(d[v]=ii(c[v]));else return c;return d}var um=c=>Array.isArray(c)?c.filter(Boolean):[],kr=c=>c===void 0,Ut=(c,d,g)=>{if(!d||!br(c))return g;const x=um(d.split(/[,[\].]+?/)).reduce((v,N)=>di(v)?v:v[N],c);return kr(x)||x===c?kr(c[d])?g:c[d]:x},Un=c=>typeof c=="boolean",Wf=c=>/^\w*$/.test(c),C_=c=>um(c.replace(/["|']|\]/g,"").split(/\.|\[/)),Hs=(c,d,g)=>{let x=-1;const v=Wf(d)?[d]:C_(d),N=v.length,E=N-1;for(;++x<N;){const k=v[x];let n=g;if(x!==E){const M=c[k];n=br(M)||Array.isArray(M)?M:isNaN(+v[x+1])?{}:[]}if(k==="__proto__"||k==="constructor"||k==="prototype")return;c[k]=n,c=c[k]}};const Ky={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},wn={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},da={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ui.createContext(null);var TS=(c,d,g,x=!0)=>{const v={defaultValues:d._defaultValues};for(const N in c)Object.defineProperty(v,N,{get:()=>{const E=N;return d._proxyFormState[E]!==wn.all&&(d._proxyFormState[E]=!x||wn.all),c[E]}});return v};const ES=typeof window<"u"?le.useLayoutEffect:le.useEffect;var qn=c=>typeof c=="string",CS=(c,d,g,x,v)=>qn(c)?(x&&d.watch.add(c),Ut(g,c,v)):Array.isArray(c)?c.map(N=>(x&&d.watch.add(N),Ut(g,N))):(x&&(d.watchAll=!0),g),kS=(c,d,g,x,v)=>d?{...g[c],types:{...g[c]&&g[c].types?g[c].types:{},[x]:v||!0}}:{},Hu=c=>Array.isArray(c)?c:[c],Qy=()=>{let c=[];return{get observers(){return c},next:v=>{for(const N of c)N.next&&N.next(v)},subscribe:v=>(c.push(v),{unsubscribe:()=>{c=c.filter(N=>N!==v)}}),unsubscribe:()=>{c=[]}}},Tf=c=>di(c)||!E_(c);function Ja(c,d){if(Tf(c)||Tf(d))return c===d;if(Wo(c)&&Wo(d))return c.getTime()===d.getTime();const g=Object.keys(c),x=Object.keys(d);if(g.length!==x.length)return!1;for(const v of g){const N=c[v];if(!x.includes(v))return!1;if(v!=="ref"){const E=d[v];if(Wo(N)&&Wo(E)||br(N)&&br(E)||Array.isArray(N)&&Array.isArray(E)?!Ja(N,E):N!==E)return!1}}return!0}var wi=c=>br(c)&&!Object.keys(c).length,Hf=c=>c.type==="file",jn=c=>typeof c=="function",Gh=c=>{if(!Zf)return!1;const d=c?c.ownerDocument:0;return c instanceof(d&&d.defaultView?d.defaultView.HTMLElement:HTMLElement)},k_=c=>c.type==="select-multiple",Xf=c=>c.type==="radio",AS=c=>Xf(c)||td(c),rf=c=>Gh(c)&&c.isConnected;function MS(c,d){const g=d.slice(0,-1).length;let x=0;for(;x<g;)c=kr(c)?x++:c[d[x++]];return c}function PS(c){for(const d in c)if(c.hasOwnProperty(d)&&!kr(c[d]))return!1;return!0}function Lr(c,d){const g=Array.isArray(d)?d:Wf(d)?[d]:C_(d),x=g.length===1?c:MS(c,g),v=g.length-1,N=g[v];return x&&delete x[N],v!==0&&(br(x)&&wi(x)||Array.isArray(x)&&PS(x))&&Lr(c,g.slice(0,-1)),c}var A_=c=>{for(const d in c)if(jn(c[d]))return!0;return!1};function Zh(c,d={}){const g=Array.isArray(c);if(br(c)||g)for(const x in c)Array.isArray(c[x])||br(c[x])&&!A_(c[x])?(d[x]=Array.isArray(c[x])?[]:{},Zh(c[x],d[x])):di(c[x])||(d[x]=!0);return d}function M_(c,d,g){const x=Array.isArray(c);if(br(c)||x)for(const v in c)Array.isArray(c[v])||br(c[v])&&!A_(c[v])?kr(d)||Tf(g[v])?g[v]=Array.isArray(c[v])?Zh(c[v],[]):{...Zh(c[v])}:M_(c[v],di(d)?{}:d[v],g[v]):g[v]=!Ja(c[v],d[v]);return g}var Vu=(c,d)=>M_(c,d,Zh(d));const Jy={value:!1,isValid:!1},Yy={value:!0,isValid:!0};var P_=c=>{if(Array.isArray(c)){if(c.length>1){const d=c.filter(g=>g&&g.checked&&!g.disabled).map(g=>g.value);return{value:d,isValid:!!d.length}}return c[0].checked&&!c[0].disabled?c[0].attributes&&!kr(c[0].attributes.value)?kr(c[0].value)||c[0].value===""?Yy:{value:c[0].value,isValid:!0}:Yy:Jy}return Jy},I_=(c,{valueAsNumber:d,valueAsDate:g,setValueAs:x})=>kr(c)?c:d?c===""?NaN:c&&+c:g&&qn(c)?new Date(c):x?x(c):c;const e0={isValid:!1,value:null};var D_=c=>Array.isArray(c)?c.reduce((d,g)=>g&&g.checked&&!g.disabled?{isValid:!0,value:g.value}:d,e0):e0;function t0(c){const d=c.ref;return Hf(d)?d.files:Xf(d)?D_(c.refs).value:k_(d)?[...d.selectedOptions].map(({value:g})=>g):td(d)?P_(c.refs).value:I_(kr(d.value)?c.ref.value:d.value,c)}var IS=(c,d,g,x)=>{const v={};for(const N of c){const E=Ut(d,N);E&&Hs(v,N,E._f)}return{criteriaMode:g,names:[...c],fields:v,shouldUseNativeValidation:x}},Wh=c=>c instanceof RegExp,qu=c=>kr(c)?c:Wh(c)?c.source:br(c)?Wh(c.value)?c.value.source:c.value:c,s0=c=>({isOnSubmit:!c||c===wn.onSubmit,isOnBlur:c===wn.onBlur,isOnChange:c===wn.onChange,isOnAll:c===wn.all,isOnTouch:c===wn.onTouched});const r0="AsyncFunction";var DS=c=>!!c&&!!c.validate&&!!(jn(c.validate)&&c.validate.constructor.name===r0||br(c.validate)&&Object.values(c.validate).find(d=>d.constructor.name===r0)),LS=c=>c.mount&&(c.required||c.min||c.max||c.maxLength||c.minLength||c.pattern||c.validate),i0=(c,d,g)=>!g&&(d.watchAll||d.watch.has(c)||[...d.watch].some(x=>c.startsWith(x)&&/^\.\w+/.test(c.slice(x.length))));const Xu=(c,d,g,x)=>{for(const v of g||Object.keys(c)){const N=Ut(c,v);if(N){const{_f:E,...k}=N;if(E){if(E.refs&&E.refs[0]&&d(E.refs[0],v)&&!x)return!0;if(E.ref&&d(E.ref,E.name)&&!x)return!0;if(Xu(k,d))break}else if(br(k)&&Xu(k,d))break}}};function n0(c,d,g){const x=Ut(c,g);if(x||Wf(g))return{error:x,name:g};const v=g.split(".");for(;v.length;){const N=v.join("."),E=Ut(d,N),k=Ut(c,N);if(E&&!Array.isArray(E)&&g!==N)return{name:g};if(k&&k.type)return{name:N,error:k};if(k&&k.root&&k.root.type)return{name:`${N}.root`,error:k.root};v.pop()}return{name:g}}var RS=(c,d,g,x)=>{g(c);const{name:v,...N}=c;return wi(N)||Object.keys(N).length>=Object.keys(d).length||Object.keys(N).find(E=>d[E]===(!x||wn.all))},zS=(c,d,g)=>!c||!d||c===d||Hu(c).some(x=>x&&(g?x===d:x.startsWith(d)||d.startsWith(x))),OS=(c,d,g,x,v)=>v.isOnAll?!1:!g&&v.isOnTouch?!(d||c):(g?x.isOnBlur:v.isOnBlur)?!c:(g?x.isOnChange:v.isOnChange)?c:!0,FS=(c,d)=>!um(Ut(c,d)).length&&Lr(c,d),BS=(c,d,g)=>{const x=Hu(Ut(c,g));return Hs(x,"root",d[g]),Hs(c,g,x),c},Ih=c=>qn(c);function a0(c,d,g="validate"){if(Ih(c)||Array.isArray(c)&&c.every(Ih)||Un(c)&&!c)return{type:g,message:Ih(c)?c:"",ref:d}}var ec=c=>br(c)&&!Wh(c)?c:{value:c,message:""},o0=async(c,d,g,x,v,N)=>{const{ref:E,refs:k,required:n,maxLength:M,minLength:z,min:q,max:U,pattern:V,validate:G,name:H,valueAsNumber:Y,mount:ge}=c._f,oe=Ut(g,H);if(!ge||d.has(H))return{};const se=k?k[0]:E,de=Pe=>{v&&se.reportValidity&&(se.setCustomValidity(Un(Pe)?"":Pe||""),se.reportValidity())},ae={},Se=Xf(E),Ce=td(E),fe=Se||Ce,Ie=(Y||Hf(E))&&kr(E.value)&&kr(oe)||Gh(E)&&E.value===""||oe===""||Array.isArray(oe)&&!oe.length,ke=kS.bind(null,H,x,ae),et=(Pe,Ne,it,ft=da.maxLength,tt=da.minLength)=>{const Mt=Pe?Ne:it;ae[H]={type:Pe?ft:tt,message:Mt,ref:E,...ke(Pe?ft:tt,Mt)}};if(N?!Array.isArray(oe)||!oe.length:n&&(!fe&&(Ie||di(oe))||Un(oe)&&!oe||Ce&&!P_(k).isValid||Se&&!D_(k).isValid)){const{value:Pe,message:Ne}=Ih(n)?{value:!!n,message:n}:ec(n);if(Pe&&(ae[H]={type:da.required,message:Ne,ref:se,...ke(da.required,Ne)},!x))return de(Ne),ae}if(!Ie&&(!di(q)||!di(U))){let Pe,Ne;const it=ec(U),ft=ec(q);if(!di(oe)&&!isNaN(oe)){const tt=E.valueAsNumber||oe&&+oe;di(it.value)||(Pe=tt>it.value),di(ft.value)||(Ne=tt<ft.value)}else{const tt=E.valueAsDate||new Date(oe),Mt=zs=>new Date(new Date().toDateString()+" "+zs),Tt=E.type=="time",At=E.type=="week";qn(it.value)&&oe&&(Pe=Tt?Mt(oe)>Mt(it.value):At?oe>it.value:tt>new Date(it.value)),qn(ft.value)&&oe&&(Ne=Tt?Mt(oe)<Mt(ft.value):At?oe<ft.value:tt<new Date(ft.value))}if((Pe||Ne)&&(et(!!Pe,it.message,ft.message,da.max,da.min),!x))return de(ae[H].message),ae}if((M||z)&&!Ie&&(qn(oe)||N&&Array.isArray(oe))){const Pe=ec(M),Ne=ec(z),it=!di(Pe.value)&&oe.length>+Pe.value,ft=!di(Ne.value)&&oe.length<+Ne.value;if((it||ft)&&(et(it,Pe.message,Ne.message),!x))return de(ae[H].message),ae}if(V&&!Ie&&qn(oe)){const{value:Pe,message:Ne}=ec(V);if(Wh(Pe)&&!oe.match(Pe)&&(ae[H]={type:da.pattern,message:Ne,ref:E,...ke(da.pattern,Ne)},!x))return de(Ne),ae}if(G){if(jn(G)){const Pe=await G(oe,g),Ne=a0(Pe,se);if(Ne&&(ae[H]={...Ne,...ke(da.validate,Ne.message)},!x))return de(Ne.message),ae}else if(br(G)){let Pe={};for(const Ne in G){if(!wi(Pe)&&!x)break;const it=a0(await G[Ne](oe,g),se,Ne);it&&(Pe={...it,...ke(Ne,it.message)},de(it.message),x&&(ae[H]=Pe))}if(!wi(Pe)&&(ae[H]={ref:se,...Pe},!x))return ae}}return de(!0),ae};const US={mode:wn.onSubmit,reValidateMode:wn.onChange,shouldFocusError:!0};function VS(c={}){let d={...US,...c},g={submitCount:0,isDirty:!1,isReady:!1,isLoading:jn(d.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:d.errors||{},disabled:d.disabled||!1};const x={};let v=br(d.defaultValues)||br(d.values)?ii(d.defaultValues||d.values)||{}:{},N=d.shouldUnregister?{}:ii(v),E={action:!1,mount:!1,watch:!1},k={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},n,M=0;const z={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let q={...z};const U={array:Qy(),state:Qy()},V=d.criteriaMode===wn.all,G=be=>Ue=>{clearTimeout(M),M=setTimeout(be,Ue)},H=async be=>{if(!d.disabled&&(z.isValid||q.isValid||be)){const Ue=d.resolver?wi((await Ce()).errors):await Ie(x,!0);Ue!==g.isValid&&U.state.next({isValid:Ue})}},Y=(be,Ue)=>{!d.disabled&&(z.isValidating||z.validatingFields||q.isValidating||q.validatingFields)&&((be||Array.from(k.mount)).forEach(He=>{He&&(Ue?Hs(g.validatingFields,He,Ue):Lr(g.validatingFields,He))}),U.state.next({validatingFields:g.validatingFields,isValidating:!wi(g.validatingFields)}))},ge=(be,Ue=[],He,wt,pt=!0,xt=!0)=>{if(wt&&He&&!d.disabled){if(E.action=!0,xt&&Array.isArray(Ut(x,be))){const Ot=He(Ut(x,be),wt.argA,wt.argB);pt&&Hs(x,be,Ot)}if(xt&&Array.isArray(Ut(g.errors,be))){const Ot=He(Ut(g.errors,be),wt.argA,wt.argB);pt&&Hs(g.errors,be,Ot),FS(g.errors,be)}if((z.touchedFields||q.touchedFields)&&xt&&Array.isArray(Ut(g.touchedFields,be))){const Ot=He(Ut(g.touchedFields,be),wt.argA,wt.argB);pt&&Hs(g.touchedFields,be,Ot)}(z.dirtyFields||q.dirtyFields)&&(g.dirtyFields=Vu(v,N)),U.state.next({name:be,isDirty:et(be,Ue),dirtyFields:g.dirtyFields,errors:g.errors,isValid:g.isValid})}else Hs(N,be,Ue)},oe=(be,Ue)=>{Hs(g.errors,be,Ue),U.state.next({errors:g.errors})},se=be=>{g.errors=be,U.state.next({errors:g.errors,isValid:!1})},de=(be,Ue,He,wt)=>{const pt=Ut(x,be);if(pt){const xt=Ut(N,be,kr(He)?Ut(v,be):He);kr(xt)||wt&&wt.defaultChecked||Ue?Hs(N,be,Ue?xt:t0(pt._f)):it(be,xt),E.mount&&H()}},ae=(be,Ue,He,wt,pt)=>{let xt=!1,Ot=!1;const hs={name:be};if(!d.disabled){if(!He||wt){(z.isDirty||q.isDirty)&&(Ot=g.isDirty,g.isDirty=hs.isDirty=et(),xt=Ot!==hs.isDirty);const as=Ja(Ut(v,be),Ue);Ot=!!Ut(g.dirtyFields,be),as?Lr(g.dirtyFields,be):Hs(g.dirtyFields,be,!0),hs.dirtyFields=g.dirtyFields,xt=xt||(z.dirtyFields||q.dirtyFields)&&Ot!==!as}if(He){const as=Ut(g.touchedFields,be);as||(Hs(g.touchedFields,be,He),hs.touchedFields=g.touchedFields,xt=xt||(z.touchedFields||q.touchedFields)&&as!==He)}xt&&pt&&U.state.next(hs)}return xt?hs:{}},Se=(be,Ue,He,wt)=>{const pt=Ut(g.errors,be),xt=(z.isValid||q.isValid)&&Un(Ue)&&g.isValid!==Ue;if(d.delayError&&He?(n=G(()=>oe(be,He)),n(d.delayError)):(clearTimeout(M),n=null,He?Hs(g.errors,be,He):Lr(g.errors,be)),(He?!Ja(pt,He):pt)||!wi(wt)||xt){const Ot={...wt,...xt&&Un(Ue)?{isValid:Ue}:{},errors:g.errors,name:be};g={...g,...Ot},U.state.next(Ot)}},Ce=async be=>{Y(be,!0);const Ue=await d.resolver(N,d.context,IS(be||k.mount,x,d.criteriaMode,d.shouldUseNativeValidation));return Y(be),Ue},fe=async be=>{const{errors:Ue}=await Ce(be);if(be)for(const He of be){const wt=Ut(Ue,He);wt?Hs(g.errors,He,wt):Lr(g.errors,He)}else g.errors=Ue;return Ue},Ie=async(be,Ue,He={valid:!0})=>{for(const wt in be){const pt=be[wt];if(pt){const{_f:xt,...Ot}=pt;if(xt){const hs=k.array.has(xt.name),as=pt._f&&DS(pt._f);as&&z.validatingFields&&Y([wt],!0);const ir=await o0(pt,k.disabled,N,V,d.shouldUseNativeValidation&&!Ue,hs);if(as&&z.validatingFields&&Y([wt]),ir[xt.name]&&(He.valid=!1,Ue))break;!Ue&&(Ut(ir,xt.name)?hs?BS(g.errors,ir,xt.name):Hs(g.errors,xt.name,ir[xt.name]):Lr(g.errors,xt.name))}!wi(Ot)&&await Ie(Ot,Ue,He)}}return He.valid},ke=()=>{for(const be of k.unMount){const Ue=Ut(x,be);Ue&&(Ue._f.refs?Ue._f.refs.every(He=>!rf(He)):!rf(Ue._f.ref))&&gr(be)}k.unMount=new Set},et=(be,Ue)=>!d.disabled&&(be&&Ue&&Hs(N,be,Ue),!Ja(zs(),v)),Pe=(be,Ue,He)=>CS(be,k,{...E.mount?N:kr(Ue)?v:qn(be)?{[be]:Ue}:Ue},He,Ue),Ne=be=>um(Ut(E.mount?N:v,be,d.shouldUnregister?Ut(v,be,[]):[])),it=(be,Ue,He={})=>{const wt=Ut(x,be);let pt=Ue;if(wt){const xt=wt._f;xt&&(!xt.disabled&&Hs(N,be,I_(Ue,xt)),pt=Gh(xt.ref)&&di(Ue)?"":Ue,k_(xt.ref)?[...xt.ref.options].forEach(Ot=>Ot.selected=pt.includes(Ot.value)):xt.refs?td(xt.ref)?xt.refs.forEach(Ot=>{(!Ot.defaultChecked||!Ot.disabled)&&(Array.isArray(pt)?Ot.checked=!!pt.find(hs=>hs===Ot.value):Ot.checked=pt===Ot.value||!!pt)}):xt.refs.forEach(Ot=>Ot.checked=Ot.value===pt):Hf(xt.ref)?xt.ref.value="":(xt.ref.value=pt,xt.ref.type||U.state.next({name:be,values:ii(N)})))}(He.shouldDirty||He.shouldTouch)&&ae(be,pt,He.shouldTouch,He.shouldDirty,!0),He.shouldValidate&&At(be)},ft=(be,Ue,He)=>{for(const wt in Ue){if(!Ue.hasOwnProperty(wt))return;const pt=Ue[wt],xt=be+"."+wt,Ot=Ut(x,xt);(k.array.has(be)||br(pt)||Ot&&!Ot._f)&&!Wo(pt)?ft(xt,pt,He):it(xt,pt,He)}},tt=(be,Ue,He={})=>{const wt=Ut(x,be),pt=k.array.has(be),xt=ii(Ue);Hs(N,be,xt),pt?(U.array.next({name:be,values:ii(N)}),(z.isDirty||z.dirtyFields||q.isDirty||q.dirtyFields)&&He.shouldDirty&&U.state.next({name:be,dirtyFields:Vu(v,N),isDirty:et(be,xt)})):wt&&!wt._f&&!di(xt)?ft(be,xt,He):it(be,xt,He),i0(be,k)&&U.state.next({...g}),U.state.next({name:E.mount?be:void 0,values:ii(N)})},Mt=async be=>{E.mount=!0;const Ue=be.target;let He=Ue.name,wt=!0;const pt=Ut(x,He),xt=as=>{wt=Number.isNaN(as)||Wo(as)&&isNaN(as.getTime())||Ja(as,Ut(N,He,as))},Ot=s0(d.mode),hs=s0(d.reValidateMode);if(pt){let as,ir;const Li=Ue.type?t0(pt._f):wS(be),Or=be.type===Ky.BLUR||be.type===Ky.FOCUS_OUT,Cn=!LS(pt._f)&&!d.resolver&&!Ut(g.errors,He)&&!pt._f.deps||OS(Or,Ut(g.touchedFields,He),g.isSubmitted,hs,Ot),Ji=i0(He,k,Or);Hs(N,He,Li),Or?(pt._f.onBlur&&pt._f.onBlur(be),n&&n(0)):pt._f.onChange&&pt._f.onChange(be);const Ti=ae(He,Li,Or),Ri=!wi(Ti)||Ji;if(!Or&&U.state.next({name:He,type:be.type,values:ii(N)}),Cn)return(z.isValid||q.isValid)&&(d.mode==="onBlur"?Or&&H():Or||H()),Ri&&U.state.next({name:He,...Ji?{}:Ti});if(!Or&&Ji&&U.state.next({...g}),d.resolver){const{errors:zi}=await Ce([He]);if(xt(Li),wt){const Yi=n0(g.errors,x,He),en=n0(zi,x,Yi.name||He);as=en.error,He=en.name,ir=wi(zi)}}else Y([He],!0),as=(await o0(pt,k.disabled,N,V,d.shouldUseNativeValidation))[He],Y([He]),xt(Li),wt&&(as?ir=!1:(z.isValid||q.isValid)&&(ir=await Ie(x,!0)));wt&&(pt._f.deps&&At(pt._f.deps),Se(He,ir,as,Ti))}},Tt=(be,Ue)=>{if(Ut(g.errors,Ue)&&be.focus)return be.focus(),1},At=async(be,Ue={})=>{let He,wt;const pt=Hu(be);if(d.resolver){const xt=await fe(kr(be)?be:pt);He=wi(xt),wt=be?!pt.some(Ot=>Ut(xt,Ot)):He}else be?(wt=(await Promise.all(pt.map(async xt=>{const Ot=Ut(x,xt);return await Ie(Ot&&Ot._f?{[xt]:Ot}:Ot)}))).every(Boolean),!(!wt&&!g.isValid)&&H()):wt=He=await Ie(x);return U.state.next({...!qn(be)||(z.isValid||q.isValid)&&He!==g.isValid?{}:{name:be},...d.resolver||!be?{isValid:He}:{},errors:g.errors}),Ue.shouldFocus&&!wt&&Xu(x,Tt,be?pt:k.mount),wt},zs=be=>{const Ue={...E.mount?N:v};return kr(be)?Ue:qn(be)?Ut(Ue,be):be.map(He=>Ut(Ue,He))},ts=(be,Ue)=>({invalid:!!Ut((Ue||g).errors,be),isDirty:!!Ut((Ue||g).dirtyFields,be),error:Ut((Ue||g).errors,be),isValidating:!!Ut(g.validatingFields,be),isTouched:!!Ut((Ue||g).touchedFields,be)}),Vt=be=>{be&&Hu(be).forEach(Ue=>Lr(g.errors,Ue)),U.state.next({errors:be?g.errors:{}})},sr=(be,Ue,He)=>{const wt=(Ut(x,be,{_f:{}})._f||{}).ref,pt=Ut(g.errors,be)||{},{ref:xt,message:Ot,type:hs,...as}=pt;Hs(g.errors,be,{...as,...Ue,ref:wt}),U.state.next({name:be,errors:g.errors,isValid:!1}),He&&He.shouldFocus&&wt&&wt.focus&&wt.focus()},bs=(be,Ue)=>jn(be)?U.state.subscribe({next:He=>be(Pe(void 0,Ue),He)}):Pe(be,Ue,!0),fr=be=>U.state.subscribe({next:Ue=>{zS(be.name,Ue.name,be.exact)&&RS(Ue,be.formState||z,zr,be.reRenderRoot)&&be.callback({values:{...N},...g,...Ue})}}).unsubscribe,$r=be=>(E.mount=!0,q={...q,...be.formState},fr({...be,formState:q})),gr=(be,Ue={})=>{for(const He of be?Hu(be):k.mount)k.mount.delete(He),k.array.delete(He),Ue.keepValue||(Lr(x,He),Lr(N,He)),!Ue.keepError&&Lr(g.errors,He),!Ue.keepDirty&&Lr(g.dirtyFields,He),!Ue.keepTouched&&Lr(g.touchedFields,He),!Ue.keepIsValidating&&Lr(g.validatingFields,He),!d.shouldUnregister&&!Ue.keepDefaultValue&&Lr(v,He);U.state.next({values:ii(N)}),U.state.next({...g,...Ue.keepDirty?{isDirty:et()}:{}}),!Ue.keepIsValid&&H()},_r=({disabled:be,name:Ue})=>{(Un(be)&&E.mount||be||k.disabled.has(Ue))&&(be?k.disabled.add(Ue):k.disabled.delete(Ue))},Xr=(be,Ue={})=>{let He=Ut(x,be);const wt=Un(Ue.disabled)||Un(d.disabled);return Hs(x,be,{...He||{},_f:{...He&&He._f?He._f:{ref:{name:be}},name:be,mount:!0,...Ue}}),k.mount.add(be),He?_r({disabled:Un(Ue.disabled)?Ue.disabled:d.disabled,name:be}):de(be,!0,Ue.value),{...wt?{disabled:Ue.disabled||d.disabled}:{},...d.progressive?{required:!!Ue.required,min:qu(Ue.min),max:qu(Ue.max),minLength:qu(Ue.minLength),maxLength:qu(Ue.maxLength),pattern:qu(Ue.pattern)}:{},name:be,onChange:Mt,onBlur:Mt,ref:pt=>{if(pt){Xr(be,Ue),He=Ut(x,be);const xt=kr(pt.value)&&pt.querySelectorAll&&pt.querySelectorAll("input,select,textarea")[0]||pt,Ot=AS(xt),hs=He._f.refs||[];if(Ot?hs.find(as=>as===xt):xt===He._f.ref)return;Hs(x,be,{_f:{...He._f,...Ot?{refs:[...hs.filter(rf),xt,...Array.isArray(Ut(v,be))?[{}]:[]],ref:{type:xt.type,name:be}}:{ref:xt}}}),de(be,!1,void 0,xt)}else He=Ut(x,be,{}),He._f&&(He._f.mount=!1),(d.shouldUnregister||Ue.shouldUnregister)&&!(NS(k.array,be)&&E.action)&&k.unMount.add(be)}}},Rr=()=>d.shouldFocusError&&Xu(x,Tt,k.mount),Si=be=>{Un(be)&&(U.state.next({disabled:be}),Xu(x,(Ue,He)=>{const wt=Ut(x,He);wt&&(Ue.disabled=wt._f.disabled||be,Array.isArray(wt._f.refs)&&wt._f.refs.forEach(pt=>{pt.disabled=wt._f.disabled||be}))},0,!1))},Qt=(be,Ue)=>async He=>{let wt;He&&(He.preventDefault&&He.preventDefault(),He.persist&&He.persist());let pt=ii(N);if(U.state.next({isSubmitting:!0}),d.resolver){const{errors:xt,values:Ot}=await Ce();g.errors=xt,pt=Ot}else await Ie(x);if(k.disabled.size)for(const xt of k.disabled)Hs(pt,xt,void 0);if(Lr(g.errors,"root"),wi(g.errors)){U.state.next({errors:{}});try{await be(pt,He)}catch(xt){wt=xt}}else Ue&&await Ue({...g.errors},He),Rr(),setTimeout(Rr);if(U.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:wi(g.errors)&&!wt,submitCount:g.submitCount+1,errors:g.errors}),wt)throw wt},Ii=(be,Ue={})=>{Ut(x,be)&&(kr(Ue.defaultValue)?tt(be,ii(Ut(v,be))):(tt(be,Ue.defaultValue),Hs(v,be,ii(Ue.defaultValue))),Ue.keepTouched||Lr(g.touchedFields,be),Ue.keepDirty||(Lr(g.dirtyFields,be),g.isDirty=Ue.defaultValue?et(be,ii(Ut(v,be))):et()),Ue.keepError||(Lr(g.errors,be),z.isValid&&H()),U.state.next({...g}))},rr=(be,Ue={})=>{const He=be?ii(be):v,wt=ii(He),pt=wi(be),xt=pt?v:wt;if(Ue.keepDefaultValues||(v=He),!Ue.keepValues){if(Ue.keepDirtyValues){const Ot=new Set([...k.mount,...Object.keys(Vu(v,N))]);for(const hs of Array.from(Ot))Ut(g.dirtyFields,hs)?Hs(xt,hs,Ut(N,hs)):tt(hs,Ut(xt,hs))}else{if(Zf&&kr(be))for(const Ot of k.mount){const hs=Ut(x,Ot);if(hs&&hs._f){const as=Array.isArray(hs._f.refs)?hs._f.refs[0]:hs._f.ref;if(Gh(as)){const ir=as.closest("form");if(ir){ir.reset();break}}}}for(const Ot of k.mount)tt(Ot,Ut(xt,Ot))}N=ii(xt),U.array.next({values:{...xt}}),U.state.next({values:{...xt}})}k={mount:Ue.keepDirtyValues?k.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},E.mount=!z.isValid||!!Ue.keepIsValid||!!Ue.keepDirtyValues,E.watch=!!d.shouldUnregister,U.state.next({submitCount:Ue.keepSubmitCount?g.submitCount:0,isDirty:pt?!1:Ue.keepDirty?g.isDirty:!!(Ue.keepDefaultValues&&!Ja(be,v)),isSubmitted:Ue.keepIsSubmitted?g.isSubmitted:!1,dirtyFields:pt?{}:Ue.keepDirtyValues?Ue.keepDefaultValues&&N?Vu(v,N):g.dirtyFields:Ue.keepDefaultValues&&be?Vu(v,be):Ue.keepDirty?g.dirtyFields:{},touchedFields:Ue.keepTouched?g.touchedFields:{},errors:Ue.keepErrors?g.errors:{},isSubmitSuccessful:Ue.keepIsSubmitSuccessful?g.isSubmitSuccessful:!1,isSubmitting:!1})},Di=(be,Ue)=>rr(jn(be)?be(N):be,Ue),Ms=(be,Ue={})=>{const He=Ut(x,be),wt=He&&He._f;if(wt){const pt=wt.refs?wt.refs[0]:wt.ref;pt.focus&&(pt.focus(),Ue.shouldSelect&&jn(pt.select)&&pt.select())}},zr=be=>{g={...g,...be}},ns={control:{register:Xr,unregister:gr,getFieldState:ts,handleSubmit:Qt,setError:sr,_subscribe:fr,_runSchema:Ce,_focusError:Rr,_getWatch:Pe,_getDirty:et,_setValid:H,_setFieldArray:ge,_setDisabledField:_r,_setErrors:se,_getFieldArray:Ne,_reset:rr,_resetDefaultValues:()=>jn(d.defaultValues)&&d.defaultValues().then(be=>{Di(be,d.resetOptions),U.state.next({isLoading:!1})}),_removeUnmounted:ke,_disableForm:Si,_subjects:U,_proxyFormState:z,get _fields(){return x},get _formValues(){return N},get _state(){return E},set _state(be){E=be},get _defaultValues(){return v},get _names(){return k},set _names(be){k=be},get _formState(){return g},get _options(){return d},set _options(be){d={...d,...be}}},subscribe:$r,trigger:At,register:Xr,handleSubmit:Qt,watch:bs,setValue:tt,getValues:zs,reset:Di,resetField:Ii,clearErrors:Vt,unregister:gr,setError:sr,setFocus:Ms,getFieldState:ts};return{...ns,formControl:ns}}function Tn(c={}){const d=ui.useRef(void 0),g=ui.useRef(void 0),[x,v]=ui.useState({isDirty:!1,isValidating:!1,isLoading:jn(c.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:c.errors||{},disabled:c.disabled||!1,isReady:!1,defaultValues:jn(c.defaultValues)?void 0:c.defaultValues});d.current||(d.current={...c.formControl?c.formControl:VS(c),formState:x},c.formControl&&c.defaultValues&&!jn(c.defaultValues)&&c.formControl.reset(c.defaultValues,c.resetOptions));const N=d.current.control;return N._options=c,ES(()=>{const E=N._subscribe({formState:N._proxyFormState,callback:()=>v({...N._formState}),reRenderRoot:!0});return v(k=>({...k,isReady:!0})),N._formState.isReady=!0,E},[N]),ui.useEffect(()=>N._disableForm(c.disabled),[N,c.disabled]),ui.useEffect(()=>{c.mode&&(N._options.mode=c.mode),c.reValidateMode&&(N._options.reValidateMode=c.reValidateMode)},[N,c.mode,c.reValidateMode]),ui.useEffect(()=>{c.errors&&(N._setErrors(c.errors),N._focusError())},[N,c.errors]),ui.useEffect(()=>{c.shouldUnregister&&N._subjects.state.next({values:N._getWatch()})},[N,c.shouldUnregister]),ui.useEffect(()=>{if(N._proxyFormState.isDirty){const E=N._getDirty();E!==x.isDirty&&N._subjects.state.next({isDirty:E})}},[N,x.isDirty]),ui.useEffect(()=>{c.values&&!Ja(c.values,g.current)?(N._reset(c.values,N._options.resetOptions),g.current=c.values,v(E=>({...E}))):N._resetDefaultValues()},[N,c.values]),ui.useEffect(()=>{N._state.mount||(N._setValid(),N._state.mount=!0),N._state.watch&&(N._state.watch=!1,N._subjects.state.next({...N._formState})),N._removeUnmounted()}),d.current.formState=TS(x,N),d.current}function L_(c,d){return function(){return c.apply(d,arguments)}}const{toString:qS}=Object.prototype,{getPrototypeOf:Kf}=Object,{iterator:dm,toStringTag:R_}=Symbol,hm=(c=>d=>{const g=qS.call(d);return c[g]||(c[g]=g.slice(8,-1).toLowerCase())})(Object.create(null)),En=c=>(c=c.toLowerCase(),d=>hm(d)===c),mm=c=>d=>typeof d===c,{isArray:oc}=Array,Ju=mm("undefined");function $S(c){return c!==null&&!Ju(c)&&c.constructor!==null&&!Ju(c.constructor)&&ji(c.constructor.isBuffer)&&c.constructor.isBuffer(c)}const z_=En("ArrayBuffer");function GS(c){let d;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?d=ArrayBuffer.isView(c):d=c&&c.buffer&&z_(c.buffer),d}const ZS=mm("string"),ji=mm("function"),O_=mm("number"),pm=c=>c!==null&&typeof c=="object",WS=c=>c===!0||c===!1,Dh=c=>{if(hm(c)!=="object")return!1;const d=Kf(c);return(d===null||d===Object.prototype||Object.getPrototypeOf(d)===null)&&!(R_ in c)&&!(dm in c)},HS=En("Date"),XS=En("File"),KS=En("Blob"),QS=En("FileList"),JS=c=>pm(c)&&ji(c.pipe),YS=c=>{let d;return c&&(typeof FormData=="function"&&c instanceof FormData||ji(c.append)&&((d=hm(c))==="formdata"||d==="object"&&ji(c.toString)&&c.toString()==="[object FormData]"))},eT=En("URLSearchParams"),[tT,sT,rT,iT]=["ReadableStream","Request","Response","Headers"].map(En),nT=c=>c.trim?c.trim():c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function sd(c,d,{allOwnKeys:g=!1}={}){if(c===null||typeof c>"u")return;let x,v;if(typeof c!="object"&&(c=[c]),oc(c))for(x=0,v=c.length;x<v;x++)d.call(null,c[x],x,c);else{const N=g?Object.getOwnPropertyNames(c):Object.keys(c),E=N.length;let k;for(x=0;x<E;x++)k=N[x],d.call(null,c[k],k,c)}}function F_(c,d){d=d.toLowerCase();const g=Object.keys(c);let x=g.length,v;for(;x-- >0;)if(v=g[x],d===v.toLowerCase())return v;return null}const Ho=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,B_=c=>!Ju(c)&&c!==Ho;function Ef(){const{caseless:c}=B_(this)&&this||{},d={},g=(x,v)=>{const N=c&&F_(d,v)||v;Dh(d[N])&&Dh(x)?d[N]=Ef(d[N],x):Dh(x)?d[N]=Ef({},x):oc(x)?d[N]=x.slice():d[N]=x};for(let x=0,v=arguments.length;x<v;x++)arguments[x]&&sd(arguments[x],g);return d}const aT=(c,d,g,{allOwnKeys:x}={})=>(sd(d,(v,N)=>{g&&ji(v)?c[N]=L_(v,g):c[N]=v},{allOwnKeys:x}),c),oT=c=>(c.charCodeAt(0)===65279&&(c=c.slice(1)),c),lT=(c,d,g,x)=>{c.prototype=Object.create(d.prototype,x),c.prototype.constructor=c,Object.defineProperty(c,"super",{value:d.prototype}),g&&Object.assign(c.prototype,g)},cT=(c,d,g,x)=>{let v,N,E;const k={};if(d=d||{},c==null)return d;do{for(v=Object.getOwnPropertyNames(c),N=v.length;N-- >0;)E=v[N],(!x||x(E,c,d))&&!k[E]&&(d[E]=c[E],k[E]=!0);c=g!==!1&&Kf(c)}while(c&&(!g||g(c,d))&&c!==Object.prototype);return d},uT=(c,d,g)=>{c=String(c),(g===void 0||g>c.length)&&(g=c.length),g-=d.length;const x=c.indexOf(d,g);return x!==-1&&x===g},dT=c=>{if(!c)return null;if(oc(c))return c;let d=c.length;if(!O_(d))return null;const g=new Array(d);for(;d-- >0;)g[d]=c[d];return g},hT=(c=>d=>c&&d instanceof c)(typeof Uint8Array<"u"&&Kf(Uint8Array)),mT=(c,d)=>{const x=(c&&c[dm]).call(c);let v;for(;(v=x.next())&&!v.done;){const N=v.value;d.call(c,N[0],N[1])}},pT=(c,d)=>{let g;const x=[];for(;(g=c.exec(d))!==null;)x.push(g);return x},fT=En("HTMLFormElement"),gT=c=>c.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(g,x,v){return x.toUpperCase()+v}),l0=(({hasOwnProperty:c})=>(d,g)=>c.call(d,g))(Object.prototype),xT=En("RegExp"),U_=(c,d)=>{const g=Object.getOwnPropertyDescriptors(c),x={};sd(g,(v,N)=>{let E;(E=d(v,N,c))!==!1&&(x[N]=E||v)}),Object.defineProperties(c,x)},yT=c=>{U_(c,(d,g)=>{if(ji(c)&&["arguments","caller","callee"].indexOf(g)!==-1)return!1;const x=c[g];if(ji(x)){if(d.enumerable=!1,"writable"in d){d.writable=!1;return}d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+g+"'")})}})},_T=(c,d)=>{const g={},x=v=>{v.forEach(N=>{g[N]=!0})};return oc(c)?x(c):x(String(c).split(d)),g},bT=()=>{},vT=(c,d)=>c!=null&&Number.isFinite(c=+c)?c:d;function wT(c){return!!(c&&ji(c.append)&&c[R_]==="FormData"&&c[dm])}const jT=c=>{const d=new Array(10),g=(x,v)=>{if(pm(x)){if(d.indexOf(x)>=0)return;if(!("toJSON"in x)){d[v]=x;const N=oc(x)?[]:{};return sd(x,(E,k)=>{const n=g(E,v+1);!Ju(n)&&(N[k]=n)}),d[v]=void 0,N}}return x};return g(c,0)},NT=En("AsyncFunction"),ST=c=>c&&(pm(c)||ji(c))&&ji(c.then)&&ji(c.catch),V_=((c,d)=>c?setImmediate:d?((g,x)=>(Ho.addEventListener("message",({source:v,data:N})=>{v===Ho&&N===g&&x.length&&x.shift()()},!1),v=>{x.push(v),Ho.postMessage(g,"*")}))(`axios@${Math.random()}`,[]):g=>setTimeout(g))(typeof setImmediate=="function",ji(Ho.postMessage)),TT=typeof queueMicrotask<"u"?queueMicrotask.bind(Ho):typeof process<"u"&&process.nextTick||V_,ET=c=>c!=null&&ji(c[dm]),Ke={isArray:oc,isArrayBuffer:z_,isBuffer:$S,isFormData:YS,isArrayBufferView:GS,isString:ZS,isNumber:O_,isBoolean:WS,isObject:pm,isPlainObject:Dh,isReadableStream:tT,isRequest:sT,isResponse:rT,isHeaders:iT,isUndefined:Ju,isDate:HS,isFile:XS,isBlob:KS,isRegExp:xT,isFunction:ji,isStream:JS,isURLSearchParams:eT,isTypedArray:hT,isFileList:QS,forEach:sd,merge:Ef,extend:aT,trim:nT,stripBOM:oT,inherits:lT,toFlatObject:cT,kindOf:hm,kindOfTest:En,endsWith:uT,toArray:dT,forEachEntry:mT,matchAll:pT,isHTMLForm:fT,hasOwnProperty:l0,hasOwnProp:l0,reduceDescriptors:U_,freezeMethods:yT,toObjectSet:_T,toCamelCase:gT,noop:bT,toFiniteNumber:vT,findKey:F_,global:Ho,isContextDefined:B_,isSpecCompliantForm:wT,toJSONObject:jT,isAsyncFn:NT,isThenable:ST,setImmediate:V_,asap:TT,isIterable:ET};function cs(c,d,g,x,v){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=c,this.name="AxiosError",d&&(this.code=d),g&&(this.config=g),x&&(this.request=x),v&&(this.response=v,this.status=v.status?v.status:null)}Ke.inherits(cs,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ke.toJSONObject(this.config),code:this.code,status:this.status}}});const q_=cs.prototype,$_={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(c=>{$_[c]={value:c}});Object.defineProperties(cs,$_);Object.defineProperty(q_,"isAxiosError",{value:!0});cs.from=(c,d,g,x,v,N)=>{const E=Object.create(q_);return Ke.toFlatObject(c,E,function(n){return n!==Error.prototype},k=>k!=="isAxiosError"),cs.call(E,c.message,d,g,x,v),E.cause=c,E.name=c.name,N&&Object.assign(E,N),E};const CT=null;function Cf(c){return Ke.isPlainObject(c)||Ke.isArray(c)}function G_(c){return Ke.endsWith(c,"[]")?c.slice(0,-2):c}function c0(c,d,g){return c?c.concat(d).map(function(v,N){return v=G_(v),!g&&N?"["+v+"]":v}).join(g?".":""):d}function kT(c){return Ke.isArray(c)&&!c.some(Cf)}const AT=Ke.toFlatObject(Ke,{},null,function(d){return/^is[A-Z]/.test(d)});function fm(c,d,g){if(!Ke.isObject(c))throw new TypeError("target must be an object");d=d||new FormData,g=Ke.toFlatObject(g,{metaTokens:!0,dots:!1,indexes:!1},!1,function(H,Y){return!Ke.isUndefined(Y[H])});const x=g.metaTokens,v=g.visitor||z,N=g.dots,E=g.indexes,n=(g.Blob||typeof Blob<"u"&&Blob)&&Ke.isSpecCompliantForm(d);if(!Ke.isFunction(v))throw new TypeError("visitor must be a function");function M(G){if(G===null)return"";if(Ke.isDate(G))return G.toISOString();if(Ke.isBoolean(G))return G.toString();if(!n&&Ke.isBlob(G))throw new cs("Blob is not supported. Use a Buffer instead.");return Ke.isArrayBuffer(G)||Ke.isTypedArray(G)?n&&typeof Blob=="function"?new Blob([G]):Buffer.from(G):G}function z(G,H,Y){let ge=G;if(G&&!Y&&typeof G=="object"){if(Ke.endsWith(H,"{}"))H=x?H:H.slice(0,-2),G=JSON.stringify(G);else if(Ke.isArray(G)&&kT(G)||(Ke.isFileList(G)||Ke.endsWith(H,"[]"))&&(ge=Ke.toArray(G)))return H=G_(H),ge.forEach(function(se,de){!(Ke.isUndefined(se)||se===null)&&d.append(E===!0?c0([H],de,N):E===null?H:H+"[]",M(se))}),!1}return Cf(G)?!0:(d.append(c0(Y,H,N),M(G)),!1)}const q=[],U=Object.assign(AT,{defaultVisitor:z,convertValue:M,isVisitable:Cf});function V(G,H){if(!Ke.isUndefined(G)){if(q.indexOf(G)!==-1)throw Error("Circular reference detected in "+H.join("."));q.push(G),Ke.forEach(G,function(ge,oe){(!(Ke.isUndefined(ge)||ge===null)&&v.call(d,ge,Ke.isString(oe)?oe.trim():oe,H,U))===!0&&V(ge,H?H.concat(oe):[oe])}),q.pop()}}if(!Ke.isObject(c))throw new TypeError("data must be an object");return V(c),d}function u0(c){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(c).replace(/[!'()~]|%20|%00/g,function(x){return d[x]})}function Qf(c,d){this._pairs=[],c&&fm(c,this,d)}const Z_=Qf.prototype;Z_.append=function(d,g){this._pairs.push([d,g])};Z_.toString=function(d){const g=d?function(x){return d.call(this,x,u0)}:u0;return this._pairs.map(function(v){return g(v[0])+"="+g(v[1])},"").join("&")};function MT(c){return encodeURIComponent(c).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function W_(c,d,g){if(!d)return c;const x=g&&g.encode||MT;Ke.isFunction(g)&&(g={serialize:g});const v=g&&g.serialize;let N;if(v?N=v(d,g):N=Ke.isURLSearchParams(d)?d.toString():new Qf(d,g).toString(x),N){const E=c.indexOf("#");E!==-1&&(c=c.slice(0,E)),c+=(c.indexOf("?")===-1?"?":"&")+N}return c}class d0{constructor(){this.handlers=[]}use(d,g,x){return this.handlers.push({fulfilled:d,rejected:g,synchronous:x?x.synchronous:!1,runWhen:x?x.runWhen:null}),this.handlers.length-1}eject(d){this.handlers[d]&&(this.handlers[d]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(d){Ke.forEach(this.handlers,function(x){x!==null&&d(x)})}}const H_={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},PT=typeof URLSearchParams<"u"?URLSearchParams:Qf,IT=typeof FormData<"u"?FormData:null,DT=typeof Blob<"u"?Blob:null,LT={isBrowser:!0,classes:{URLSearchParams:PT,FormData:IT,Blob:DT},protocols:["http","https","file","blob","url","data"]},Jf=typeof window<"u"&&typeof document<"u",kf=typeof navigator=="object"&&navigator||void 0,RT=Jf&&(!kf||["ReactNative","NativeScript","NS"].indexOf(kf.product)<0),zT=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",OT=Jf&&window.location.href||"http://localhost",FT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Jf,hasStandardBrowserEnv:RT,hasStandardBrowserWebWorkerEnv:zT,navigator:kf,origin:OT},Symbol.toStringTag,{value:"Module"})),ni={...FT,...LT};function BT(c,d){return fm(c,new ni.classes.URLSearchParams,Object.assign({visitor:function(g,x,v,N){return ni.isNode&&Ke.isBuffer(g)?(this.append(x,g.toString("base64")),!1):N.defaultVisitor.apply(this,arguments)}},d))}function UT(c){return Ke.matchAll(/\w+|\[(\w*)]/g,c).map(d=>d[0]==="[]"?"":d[1]||d[0])}function VT(c){const d={},g=Object.keys(c);let x;const v=g.length;let N;for(x=0;x<v;x++)N=g[x],d[N]=c[N];return d}function X_(c){function d(g,x,v,N){let E=g[N++];if(E==="__proto__")return!0;const k=Number.isFinite(+E),n=N>=g.length;return E=!E&&Ke.isArray(v)?v.length:E,n?(Ke.hasOwnProp(v,E)?v[E]=[v[E],x]:v[E]=x,!k):((!v[E]||!Ke.isObject(v[E]))&&(v[E]=[]),d(g,x,v[E],N)&&Ke.isArray(v[E])&&(v[E]=VT(v[E])),!k)}if(Ke.isFormData(c)&&Ke.isFunction(c.entries)){const g={};return Ke.forEachEntry(c,(x,v)=>{d(UT(x),v,g,0)}),g}return null}function qT(c,d,g){if(Ke.isString(c))try{return(d||JSON.parse)(c),Ke.trim(c)}catch(x){if(x.name!=="SyntaxError")throw x}return(0,JSON.stringify)(c)}const rd={transitional:H_,adapter:["xhr","http","fetch"],transformRequest:[function(d,g){const x=g.getContentType()||"",v=x.indexOf("application/json")>-1,N=Ke.isObject(d);if(N&&Ke.isHTMLForm(d)&&(d=new FormData(d)),Ke.isFormData(d))return v?JSON.stringify(X_(d)):d;if(Ke.isArrayBuffer(d)||Ke.isBuffer(d)||Ke.isStream(d)||Ke.isFile(d)||Ke.isBlob(d)||Ke.isReadableStream(d))return d;if(Ke.isArrayBufferView(d))return d.buffer;if(Ke.isURLSearchParams(d))return g.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),d.toString();let k;if(N){if(x.indexOf("application/x-www-form-urlencoded")>-1)return BT(d,this.formSerializer).toString();if((k=Ke.isFileList(d))||x.indexOf("multipart/form-data")>-1){const n=this.env&&this.env.FormData;return fm(k?{"files[]":d}:d,n&&new n,this.formSerializer)}}return N||v?(g.setContentType("application/json",!1),qT(d)):d}],transformResponse:[function(d){const g=this.transitional||rd.transitional,x=g&&g.forcedJSONParsing,v=this.responseType==="json";if(Ke.isResponse(d)||Ke.isReadableStream(d))return d;if(d&&Ke.isString(d)&&(x&&!this.responseType||v)){const E=!(g&&g.silentJSONParsing)&&v;try{return JSON.parse(d)}catch(k){if(E)throw k.name==="SyntaxError"?cs.from(k,cs.ERR_BAD_RESPONSE,this,null,this.response):k}}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ni.classes.FormData,Blob:ni.classes.Blob},validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ke.forEach(["delete","get","head","post","put","patch"],c=>{rd.headers[c]={}});const $T=Ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),GT=c=>{const d={};let g,x,v;return c&&c.split(`
`).forEach(function(E){v=E.indexOf(":"),g=E.substring(0,v).trim().toLowerCase(),x=E.substring(v+1).trim(),!(!g||d[g]&&$T[g])&&(g==="set-cookie"?d[g]?d[g].push(x):d[g]=[x]:d[g]=d[g]?d[g]+", "+x:x)}),d},h0=Symbol("internals");function $u(c){return c&&String(c).trim().toLowerCase()}function Lh(c){return c===!1||c==null?c:Ke.isArray(c)?c.map(Lh):String(c)}function ZT(c){const d=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let x;for(;x=g.exec(c);)d[x[1]]=x[2];return d}const WT=c=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(c.trim());function nf(c,d,g,x,v){if(Ke.isFunction(x))return x.call(this,d,g);if(v&&(d=g),!!Ke.isString(d)){if(Ke.isString(x))return d.indexOf(x)!==-1;if(Ke.isRegExp(x))return x.test(d)}}function HT(c){return c.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(d,g,x)=>g.toUpperCase()+x)}function XT(c,d){const g=Ke.toCamelCase(" "+d);["get","set","has"].forEach(x=>{Object.defineProperty(c,x+g,{value:function(v,N,E){return this[x].call(this,d,v,N,E)},configurable:!0})})}class Ni{constructor(d){d&&this.set(d)}set(d,g,x){const v=this;function N(k,n,M){const z=$u(n);if(!z)throw new Error("header name must be a non-empty string");const q=Ke.findKey(v,z);(!q||v[q]===void 0||M===!0||M===void 0&&v[q]!==!1)&&(v[q||n]=Lh(k))}const E=(k,n)=>Ke.forEach(k,(M,z)=>N(M,z,n));if(Ke.isPlainObject(d)||d instanceof this.constructor)E(d,g);else if(Ke.isString(d)&&(d=d.trim())&&!WT(d))E(GT(d),g);else if(Ke.isObject(d)&&Ke.isIterable(d)){let k={},n,M;for(const z of d){if(!Ke.isArray(z))throw TypeError("Object iterator must return a key-value pair");k[M=z[0]]=(n=k[M])?Ke.isArray(n)?[...n,z[1]]:[n,z[1]]:z[1]}E(k,g)}else d!=null&&N(g,d,x);return this}get(d,g){if(d=$u(d),d){const x=Ke.findKey(this,d);if(x){const v=this[x];if(!g)return v;if(g===!0)return ZT(v);if(Ke.isFunction(g))return g.call(this,v,x);if(Ke.isRegExp(g))return g.exec(v);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,g){if(d=$u(d),d){const x=Ke.findKey(this,d);return!!(x&&this[x]!==void 0&&(!g||nf(this,this[x],x,g)))}return!1}delete(d,g){const x=this;let v=!1;function N(E){if(E=$u(E),E){const k=Ke.findKey(x,E);k&&(!g||nf(x,x[k],k,g))&&(delete x[k],v=!0)}}return Ke.isArray(d)?d.forEach(N):N(d),v}clear(d){const g=Object.keys(this);let x=g.length,v=!1;for(;x--;){const N=g[x];(!d||nf(this,this[N],N,d,!0))&&(delete this[N],v=!0)}return v}normalize(d){const g=this,x={};return Ke.forEach(this,(v,N)=>{const E=Ke.findKey(x,N);if(E){g[E]=Lh(v),delete g[N];return}const k=d?HT(N):String(N).trim();k!==N&&delete g[N],g[k]=Lh(v),x[k]=!0}),this}concat(...d){return this.constructor.concat(this,...d)}toJSON(d){const g=Object.create(null);return Ke.forEach(this,(x,v)=>{x!=null&&x!==!1&&(g[v]=d&&Ke.isArray(x)?x.join(", "):x)}),g}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([d,g])=>d+": "+g).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d,...g){const x=new this(d);return g.forEach(v=>x.set(v)),x}static accessor(d){const x=(this[h0]=this[h0]={accessors:{}}).accessors,v=this.prototype;function N(E){const k=$u(E);x[k]||(XT(v,E),x[k]=!0)}return Ke.isArray(d)?d.forEach(N):N(d),this}}Ni.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ke.reduceDescriptors(Ni.prototype,({value:c},d)=>{let g=d[0].toUpperCase()+d.slice(1);return{get:()=>c,set(x){this[g]=x}}});Ke.freezeMethods(Ni);function af(c,d){const g=this||rd,x=d||g,v=Ni.from(x.headers);let N=x.data;return Ke.forEach(c,function(k){N=k.call(g,N,v.normalize(),d?d.status:void 0)}),v.normalize(),N}function K_(c){return!!(c&&c.__CANCEL__)}function lc(c,d,g){cs.call(this,c??"canceled",cs.ERR_CANCELED,d,g),this.name="CanceledError"}Ke.inherits(lc,cs,{__CANCEL__:!0});function Q_(c,d,g){const x=g.config.validateStatus;!g.status||!x||x(g.status)?c(g):d(new cs("Request failed with status code "+g.status,[cs.ERR_BAD_REQUEST,cs.ERR_BAD_RESPONSE][Math.floor(g.status/100)-4],g.config,g.request,g))}function KT(c){const d=/^([-+\w]{1,25})(:?\/\/|:)/.exec(c);return d&&d[1]||""}function QT(c,d){c=c||10;const g=new Array(c),x=new Array(c);let v=0,N=0,E;return d=d!==void 0?d:1e3,function(n){const M=Date.now(),z=x[N];E||(E=M),g[v]=n,x[v]=M;let q=N,U=0;for(;q!==v;)U+=g[q++],q=q%c;if(v=(v+1)%c,v===N&&(N=(N+1)%c),M-E<d)return;const V=z&&M-z;return V?Math.round(U*1e3/V):void 0}}function JT(c,d){let g=0,x=1e3/d,v,N;const E=(M,z=Date.now())=>{g=z,v=null,N&&(clearTimeout(N),N=null),c.apply(null,M)};return[(...M)=>{const z=Date.now(),q=z-g;q>=x?E(M,z):(v=M,N||(N=setTimeout(()=>{N=null,E(v)},x-q)))},()=>v&&E(v)]}const Hh=(c,d,g=3)=>{let x=0;const v=QT(50,250);return JT(N=>{const E=N.loaded,k=N.lengthComputable?N.total:void 0,n=E-x,M=v(n),z=E<=k;x=E;const q={loaded:E,total:k,progress:k?E/k:void 0,bytes:n,rate:M||void 0,estimated:M&&k&&z?(k-E)/M:void 0,event:N,lengthComputable:k!=null,[d?"download":"upload"]:!0};c(q)},g)},m0=(c,d)=>{const g=c!=null;return[x=>d[0]({lengthComputable:g,total:c,loaded:x}),d[1]]},p0=c=>(...d)=>Ke.asap(()=>c(...d)),YT=ni.hasStandardBrowserEnv?((c,d)=>g=>(g=new URL(g,ni.origin),c.protocol===g.protocol&&c.host===g.host&&(d||c.port===g.port)))(new URL(ni.origin),ni.navigator&&/(msie|trident)/i.test(ni.navigator.userAgent)):()=>!0,eE=ni.hasStandardBrowserEnv?{write(c,d,g,x,v,N){const E=[c+"="+encodeURIComponent(d)];Ke.isNumber(g)&&E.push("expires="+new Date(g).toGMTString()),Ke.isString(x)&&E.push("path="+x),Ke.isString(v)&&E.push("domain="+v),N===!0&&E.push("secure"),document.cookie=E.join("; ")},read(c){const d=document.cookie.match(new RegExp("(^|;\\s*)("+c+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove(c){this.write(c,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function tE(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}function sE(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}function J_(c,d,g){let x=!tE(d);return c&&(x||g==!1)?sE(c,d):d}const f0=c=>c instanceof Ni?{...c}:c;function Qo(c,d){d=d||{};const g={};function x(M,z,q,U){return Ke.isPlainObject(M)&&Ke.isPlainObject(z)?Ke.merge.call({caseless:U},M,z):Ke.isPlainObject(z)?Ke.merge({},z):Ke.isArray(z)?z.slice():z}function v(M,z,q,U){if(Ke.isUndefined(z)){if(!Ke.isUndefined(M))return x(void 0,M,q,U)}else return x(M,z,q,U)}function N(M,z){if(!Ke.isUndefined(z))return x(void 0,z)}function E(M,z){if(Ke.isUndefined(z)){if(!Ke.isUndefined(M))return x(void 0,M)}else return x(void 0,z)}function k(M,z,q){if(q in d)return x(M,z);if(q in c)return x(void 0,M)}const n={url:N,method:N,data:N,baseURL:E,transformRequest:E,transformResponse:E,paramsSerializer:E,timeout:E,timeoutMessage:E,withCredentials:E,withXSRFToken:E,adapter:E,responseType:E,xsrfCookieName:E,xsrfHeaderName:E,onUploadProgress:E,onDownloadProgress:E,decompress:E,maxContentLength:E,maxBodyLength:E,beforeRedirect:E,transport:E,httpAgent:E,httpsAgent:E,cancelToken:E,socketPath:E,responseEncoding:E,validateStatus:k,headers:(M,z,q)=>v(f0(M),f0(z),q,!0)};return Ke.forEach(Object.keys(Object.assign({},c,d)),function(z){const q=n[z]||v,U=q(c[z],d[z],z);Ke.isUndefined(U)&&q!==k||(g[z]=U)}),g}const Y_=c=>{const d=Qo({},c);let{data:g,withXSRFToken:x,xsrfHeaderName:v,xsrfCookieName:N,headers:E,auth:k}=d;d.headers=E=Ni.from(E),d.url=W_(J_(d.baseURL,d.url,d.allowAbsoluteUrls),c.params,c.paramsSerializer),k&&E.set("Authorization","Basic "+btoa((k.username||"")+":"+(k.password?unescape(encodeURIComponent(k.password)):"")));let n;if(Ke.isFormData(g)){if(ni.hasStandardBrowserEnv||ni.hasStandardBrowserWebWorkerEnv)E.setContentType(void 0);else if((n=E.getContentType())!==!1){const[M,...z]=n?n.split(";").map(q=>q.trim()).filter(Boolean):[];E.setContentType([M||"multipart/form-data",...z].join("; "))}}if(ni.hasStandardBrowserEnv&&(x&&Ke.isFunction(x)&&(x=x(d)),x||x!==!1&&YT(d.url))){const M=v&&N&&eE.read(N);M&&E.set(v,M)}return d},rE=typeof XMLHttpRequest<"u",iE=rE&&function(c){return new Promise(function(g,x){const v=Y_(c);let N=v.data;const E=Ni.from(v.headers).normalize();let{responseType:k,onUploadProgress:n,onDownloadProgress:M}=v,z,q,U,V,G;function H(){V&&V(),G&&G(),v.cancelToken&&v.cancelToken.unsubscribe(z),v.signal&&v.signal.removeEventListener("abort",z)}let Y=new XMLHttpRequest;Y.open(v.method.toUpperCase(),v.url,!0),Y.timeout=v.timeout;function ge(){if(!Y)return;const se=Ni.from("getAllResponseHeaders"in Y&&Y.getAllResponseHeaders()),ae={data:!k||k==="text"||k==="json"?Y.responseText:Y.response,status:Y.status,statusText:Y.statusText,headers:se,config:c,request:Y};Q_(function(Ce){g(Ce),H()},function(Ce){x(Ce),H()},ae),Y=null}"onloadend"in Y?Y.onloadend=ge:Y.onreadystatechange=function(){!Y||Y.readyState!==4||Y.status===0&&!(Y.responseURL&&Y.responseURL.indexOf("file:")===0)||setTimeout(ge)},Y.onabort=function(){Y&&(x(new cs("Request aborted",cs.ECONNABORTED,c,Y)),Y=null)},Y.onerror=function(){x(new cs("Network Error",cs.ERR_NETWORK,c,Y)),Y=null},Y.ontimeout=function(){let de=v.timeout?"timeout of "+v.timeout+"ms exceeded":"timeout exceeded";const ae=v.transitional||H_;v.timeoutErrorMessage&&(de=v.timeoutErrorMessage),x(new cs(de,ae.clarifyTimeoutError?cs.ETIMEDOUT:cs.ECONNABORTED,c,Y)),Y=null},N===void 0&&E.setContentType(null),"setRequestHeader"in Y&&Ke.forEach(E.toJSON(),function(de,ae){Y.setRequestHeader(ae,de)}),Ke.isUndefined(v.withCredentials)||(Y.withCredentials=!!v.withCredentials),k&&k!=="json"&&(Y.responseType=v.responseType),M&&([U,G]=Hh(M,!0),Y.addEventListener("progress",U)),n&&Y.upload&&([q,V]=Hh(n),Y.upload.addEventListener("progress",q),Y.upload.addEventListener("loadend",V)),(v.cancelToken||v.signal)&&(z=se=>{Y&&(x(!se||se.type?new lc(null,c,Y):se),Y.abort(),Y=null)},v.cancelToken&&v.cancelToken.subscribe(z),v.signal&&(v.signal.aborted?z():v.signal.addEventListener("abort",z)));const oe=KT(v.url);if(oe&&ni.protocols.indexOf(oe)===-1){x(new cs("Unsupported protocol "+oe+":",cs.ERR_BAD_REQUEST,c));return}Y.send(N||null)})},nE=(c,d)=>{const{length:g}=c=c?c.filter(Boolean):[];if(d||g){let x=new AbortController,v;const N=function(M){if(!v){v=!0,k();const z=M instanceof Error?M:this.reason;x.abort(z instanceof cs?z:new lc(z instanceof Error?z.message:z))}};let E=d&&setTimeout(()=>{E=null,N(new cs(`timeout ${d} of ms exceeded`,cs.ETIMEDOUT))},d);const k=()=>{c&&(E&&clearTimeout(E),E=null,c.forEach(M=>{M.unsubscribe?M.unsubscribe(N):M.removeEventListener("abort",N)}),c=null)};c.forEach(M=>M.addEventListener("abort",N));const{signal:n}=x;return n.unsubscribe=()=>Ke.asap(k),n}},aE=function*(c,d){let g=c.byteLength;if(g<d){yield c;return}let x=0,v;for(;x<g;)v=x+d,yield c.slice(x,v),x=v},oE=async function*(c,d){for await(const g of lE(c))yield*aE(g,d)},lE=async function*(c){if(c[Symbol.asyncIterator]){yield*c;return}const d=c.getReader();try{for(;;){const{done:g,value:x}=await d.read();if(g)break;yield x}}finally{await d.cancel()}},g0=(c,d,g,x)=>{const v=oE(c,d);let N=0,E,k=n=>{E||(E=!0,x&&x(n))};return new ReadableStream({async pull(n){try{const{done:M,value:z}=await v.next();if(M){k(),n.close();return}let q=z.byteLength;if(g){let U=N+=q;g(U)}n.enqueue(new Uint8Array(z))}catch(M){throw k(M),M}},cancel(n){return k(n),v.return()}},{highWaterMark:2})},gm=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",eb=gm&&typeof ReadableStream=="function",cE=gm&&(typeof TextEncoder=="function"?(c=>d=>c.encode(d))(new TextEncoder):async c=>new Uint8Array(await new Response(c).arrayBuffer())),tb=(c,...d)=>{try{return!!c(...d)}catch{return!1}},uE=eb&&tb(()=>{let c=!1;const d=new Request(ni.origin,{body:new ReadableStream,method:"POST",get duplex(){return c=!0,"half"}}).headers.has("Content-Type");return c&&!d}),x0=64*1024,Af=eb&&tb(()=>Ke.isReadableStream(new Response("").body)),Xh={stream:Af&&(c=>c.body)};gm&&(c=>{["text","arrayBuffer","blob","formData","stream"].forEach(d=>{!Xh[d]&&(Xh[d]=Ke.isFunction(c[d])?g=>g[d]():(g,x)=>{throw new cs(`Response type '${d}' is not supported`,cs.ERR_NOT_SUPPORT,x)})})})(new Response);const dE=async c=>{if(c==null)return 0;if(Ke.isBlob(c))return c.size;if(Ke.isSpecCompliantForm(c))return(await new Request(ni.origin,{method:"POST",body:c}).arrayBuffer()).byteLength;if(Ke.isArrayBufferView(c)||Ke.isArrayBuffer(c))return c.byteLength;if(Ke.isURLSearchParams(c)&&(c=c+""),Ke.isString(c))return(await cE(c)).byteLength},hE=async(c,d)=>{const g=Ke.toFiniteNumber(c.getContentLength());return g??dE(d)},mE=gm&&(async c=>{let{url:d,method:g,data:x,signal:v,cancelToken:N,timeout:E,onDownloadProgress:k,onUploadProgress:n,responseType:M,headers:z,withCredentials:q="same-origin",fetchOptions:U}=Y_(c);M=M?(M+"").toLowerCase():"text";let V=nE([v,N&&N.toAbortSignal()],E),G;const H=V&&V.unsubscribe&&(()=>{V.unsubscribe()});let Y;try{if(n&&uE&&g!=="get"&&g!=="head"&&(Y=await hE(z,x))!==0){let ae=new Request(d,{method:"POST",body:x,duplex:"half"}),Se;if(Ke.isFormData(x)&&(Se=ae.headers.get("content-type"))&&z.setContentType(Se),ae.body){const[Ce,fe]=m0(Y,Hh(p0(n)));x=g0(ae.body,x0,Ce,fe)}}Ke.isString(q)||(q=q?"include":"omit");const ge="credentials"in Request.prototype;G=new Request(d,{...U,signal:V,method:g.toUpperCase(),headers:z.normalize().toJSON(),body:x,duplex:"half",credentials:ge?q:void 0});let oe=await fetch(G,U);const se=Af&&(M==="stream"||M==="response");if(Af&&(k||se&&H)){const ae={};["status","statusText","headers"].forEach(Ie=>{ae[Ie]=oe[Ie]});const Se=Ke.toFiniteNumber(oe.headers.get("content-length")),[Ce,fe]=k&&m0(Se,Hh(p0(k),!0))||[];oe=new Response(g0(oe.body,x0,Ce,()=>{fe&&fe(),H&&H()}),ae)}M=M||"text";let de=await Xh[Ke.findKey(Xh,M)||"text"](oe,c);return!se&&H&&H(),await new Promise((ae,Se)=>{Q_(ae,Se,{data:de,headers:Ni.from(oe.headers),status:oe.status,statusText:oe.statusText,config:c,request:G})})}catch(ge){throw H&&H(),ge&&ge.name==="TypeError"&&/Load failed|fetch/i.test(ge.message)?Object.assign(new cs("Network Error",cs.ERR_NETWORK,c,G),{cause:ge.cause||ge}):cs.from(ge,ge&&ge.code,c,G)}}),Mf={http:CT,xhr:iE,fetch:mE};Ke.forEach(Mf,(c,d)=>{if(c){try{Object.defineProperty(c,"name",{value:d})}catch{}Object.defineProperty(c,"adapterName",{value:d})}});const y0=c=>`- ${c}`,pE=c=>Ke.isFunction(c)||c===null||c===!1,sb={getAdapter:c=>{c=Ke.isArray(c)?c:[c];const{length:d}=c;let g,x;const v={};for(let N=0;N<d;N++){g=c[N];let E;if(x=g,!pE(g)&&(x=Mf[(E=String(g)).toLowerCase()],x===void 0))throw new cs(`Unknown adapter '${E}'`);if(x)break;v[E||"#"+N]=x}if(!x){const N=Object.entries(v).map(([k,n])=>`adapter ${k} `+(n===!1?"is not supported by the environment":"is not available in the build"));let E=d?N.length>1?`since :
`+N.map(y0).join(`
`):" "+y0(N[0]):"as no adapter specified";throw new cs("There is no suitable adapter to dispatch the request "+E,"ERR_NOT_SUPPORT")}return x},adapters:Mf};function of(c){if(c.cancelToken&&c.cancelToken.throwIfRequested(),c.signal&&c.signal.aborted)throw new lc(null,c)}function _0(c){return of(c),c.headers=Ni.from(c.headers),c.data=af.call(c,c.transformRequest),["post","put","patch"].indexOf(c.method)!==-1&&c.headers.setContentType("application/x-www-form-urlencoded",!1),sb.getAdapter(c.adapter||rd.adapter)(c).then(function(x){return of(c),x.data=af.call(c,c.transformResponse,x),x.headers=Ni.from(x.headers),x},function(x){return K_(x)||(of(c),x&&x.response&&(x.response.data=af.call(c,c.transformResponse,x.response),x.response.headers=Ni.from(x.response.headers))),Promise.reject(x)})}const rb="1.10.0",xm={};["object","boolean","number","function","string","symbol"].forEach((c,d)=>{xm[c]=function(x){return typeof x===c||"a"+(d<1?"n ":" ")+c}});const b0={};xm.transitional=function(d,g,x){function v(N,E){return"[Axios v"+rb+"] Transitional option '"+N+"'"+E+(x?". "+x:"")}return(N,E,k)=>{if(d===!1)throw new cs(v(E," has been removed"+(g?" in "+g:"")),cs.ERR_DEPRECATED);return g&&!b0[E]&&(b0[E]=!0,console.warn(v(E," has been deprecated since v"+g+" and will be removed in the near future"))),d?d(N,E,k):!0}};xm.spelling=function(d){return(g,x)=>(console.warn(`${x} is likely a misspelling of ${d}`),!0)};function fE(c,d,g){if(typeof c!="object")throw new cs("options must be an object",cs.ERR_BAD_OPTION_VALUE);const x=Object.keys(c);let v=x.length;for(;v-- >0;){const N=x[v],E=d[N];if(E){const k=c[N],n=k===void 0||E(k,N,c);if(n!==!0)throw new cs("option "+N+" must be "+n,cs.ERR_BAD_OPTION_VALUE);continue}if(g!==!0)throw new cs("Unknown option "+N,cs.ERR_BAD_OPTION)}}const Rh={assertOptions:fE,validators:xm},Bn=Rh.validators;class Xo{constructor(d){this.defaults=d||{},this.interceptors={request:new d0,response:new d0}}async request(d,g){try{return await this._request(d,g)}catch(x){if(x instanceof Error){let v={};Error.captureStackTrace?Error.captureStackTrace(v):v=new Error;const N=v.stack?v.stack.replace(/^.+\n/,""):"";try{x.stack?N&&!String(x.stack).endsWith(N.replace(/^.+\n.+\n/,""))&&(x.stack+=`
`+N):x.stack=N}catch{}}throw x}}_request(d,g){typeof d=="string"?(g=g||{},g.url=d):g=d||{},g=Qo(this.defaults,g);const{transitional:x,paramsSerializer:v,headers:N}=g;x!==void 0&&Rh.assertOptions(x,{silentJSONParsing:Bn.transitional(Bn.boolean),forcedJSONParsing:Bn.transitional(Bn.boolean),clarifyTimeoutError:Bn.transitional(Bn.boolean)},!1),v!=null&&(Ke.isFunction(v)?g.paramsSerializer={serialize:v}:Rh.assertOptions(v,{encode:Bn.function,serialize:Bn.function},!0)),g.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?g.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:g.allowAbsoluteUrls=!0),Rh.assertOptions(g,{baseUrl:Bn.spelling("baseURL"),withXsrfToken:Bn.spelling("withXSRFToken")},!0),g.method=(g.method||this.defaults.method||"get").toLowerCase();let E=N&&Ke.merge(N.common,N[g.method]);N&&Ke.forEach(["delete","get","head","post","put","patch","common"],G=>{delete N[G]}),g.headers=Ni.concat(E,N);const k=[];let n=!0;this.interceptors.request.forEach(function(H){typeof H.runWhen=="function"&&H.runWhen(g)===!1||(n=n&&H.synchronous,k.unshift(H.fulfilled,H.rejected))});const M=[];this.interceptors.response.forEach(function(H){M.push(H.fulfilled,H.rejected)});let z,q=0,U;if(!n){const G=[_0.bind(this),void 0];for(G.unshift.apply(G,k),G.push.apply(G,M),U=G.length,z=Promise.resolve(g);q<U;)z=z.then(G[q++],G[q++]);return z}U=k.length;let V=g;for(q=0;q<U;){const G=k[q++],H=k[q++];try{V=G(V)}catch(Y){H.call(this,Y);break}}try{z=_0.call(this,V)}catch(G){return Promise.reject(G)}for(q=0,U=M.length;q<U;)z=z.then(M[q++],M[q++]);return z}getUri(d){d=Qo(this.defaults,d);const g=J_(d.baseURL,d.url,d.allowAbsoluteUrls);return W_(g,d.params,d.paramsSerializer)}}Ke.forEach(["delete","get","head","options"],function(d){Xo.prototype[d]=function(g,x){return this.request(Qo(x||{},{method:d,url:g,data:(x||{}).data}))}});Ke.forEach(["post","put","patch"],function(d){function g(x){return function(N,E,k){return this.request(Qo(k||{},{method:d,headers:x?{"Content-Type":"multipart/form-data"}:{},url:N,data:E}))}}Xo.prototype[d]=g(),Xo.prototype[d+"Form"]=g(!0)});class Yf{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let g;this.promise=new Promise(function(N){g=N});const x=this;this.promise.then(v=>{if(!x._listeners)return;let N=x._listeners.length;for(;N-- >0;)x._listeners[N](v);x._listeners=null}),this.promise.then=v=>{let N;const E=new Promise(k=>{x.subscribe(k),N=k}).then(v);return E.cancel=function(){x.unsubscribe(N)},E},d(function(N,E,k){x.reason||(x.reason=new lc(N,E,k),g(x.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const g=this._listeners.indexOf(d);g!==-1&&this._listeners.splice(g,1)}toAbortSignal(){const d=new AbortController,g=x=>{d.abort(x)};return this.subscribe(g),d.signal.unsubscribe=()=>this.unsubscribe(g),d.signal}static source(){let d;return{token:new Yf(function(v){d=v}),cancel:d}}}function gE(c){return function(g){return c.apply(null,g)}}function xE(c){return Ke.isObject(c)&&c.isAxiosError===!0}const Pf={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Pf).forEach(([c,d])=>{Pf[d]=c});function ib(c){const d=new Xo(c),g=L_(Xo.prototype.request,d);return Ke.extend(g,Xo.prototype,d,{allOwnKeys:!0}),Ke.extend(g,d,null,{allOwnKeys:!0}),g.create=function(v){return ib(Qo(c,v))},g}const Mr=ib(rd);Mr.Axios=Xo;Mr.CanceledError=lc;Mr.CancelToken=Yf;Mr.isCancel=K_;Mr.VERSION=rb;Mr.toFormData=fm;Mr.AxiosError=cs;Mr.Cancel=Mr.CanceledError;Mr.all=function(d){return Promise.all(d)};Mr.spread=gE;Mr.isAxiosError=xE;Mr.mergeConfig=Qo;Mr.AxiosHeaders=Ni;Mr.formToJSON=c=>X_(Ke.isHTMLForm(c)?new FormData(c):c);Mr.getAdapter=sb.getAdapter;Mr.HttpStatusCode=Pf;Mr.default=Mr;var nb={exports:{}};(function(c,d){var g={};(function(x,v){c.exports=v()})(f1,function(){var x,v,N;function E(n,M){if(!x)x=M;else if(!v)v=M;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+x+")(sharedChunk); ("+v+")(sharedChunk); self.onerror = null;",q={};x(q),N=M(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(N.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}E(["exports"],function(n){var M=typeof self<"u"?self:{},z="2.15.0";let q;const U={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(q==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{q=g.API_URL_REGEX!=null?new RegExp(g.API_URL_REGEX):s}catch{q=s}}return q},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!U.API_URL)return null;try{const s=new URL(U.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(s){!Y&&H&&(ge?oe(s):G=s)}};let G,H,Y=!1,ge=!1;function oe(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,H),s.isContextLost())return;V.supported=!0}catch{}s.deleteTexture(e),Y=!0}M.document&&(H=M.document.createElement("img"),H.onload=function(){G&&oe(G),G=null,ge=!0},H.onerror=function(){Y=!0,G=null},H.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const se="01";function de(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ae=Se;function Se(s,e,r,a){this.cx=3*s,this.bx=3*(r-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=e,this.p2x=r,this.p2y=a}Se.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,e){if(e===void 0&&(e=1e-6),s<0)return 0;if(s>1)return 1;for(var r=s,a=0;a<8;a++){var l=this.sampleCurveX(r)-s;if(Math.abs(l)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var p=0,y=1;for(r=s,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-s)<e));a++)s>l?p=r:y=r,r=.5*(y-p)+p;return r},solve:function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))}};var Ce=de(ae),fe=Ie;function Ie(s,e){this.x=s,this.y=e}Ie.prototype={clone:function(){return new Ie(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,e){return this.clone()._rotateAround(s,e)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var e=s.x-this.x,r=s.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult:function(s){var e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var e=Math.cos(s),r=Math.sin(s),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(s,e){var r=Math.cos(s),a=Math.sin(s),l=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ie.convert=function(s){return s instanceof Ie?s:Array.isArray(s)?new Ie(s[0],s[1]):s};var ke=de(fe);const et=Math.PI/180,Pe=180/Math.PI;function Ne(s){return s*et}function it(s){return s*Pe}const ft=[[0,0],[1,0],[1,1],[0,1]];function tt(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,r=e*s;return 4*(s<.5?r:3*(s-e)+r-.75)}function Mt(s,e,r,a){const l=new Ce(s,e,r,a);return function(h){return l.solve(h)}}const Tt=Mt(.25,.1,.25,1);function At(s,e,r){return Math.min(r,Math.max(e,s))}function zs(s,e,r){return(r=At((r-s)/(e-s),0,1))*r*(3-2*r)}function ts(s,e,r){const a=r-e,l=((s-e)%a+a)%a+e;return l===e?r:l}function Vt(s,e,r){if(!s.length)return r(null,[]);let a=s.length;const l=new Array(s.length);let h=null;s.forEach((p,y)=>{e(p,(b,w)=>{b&&(h=b),l[y]=w,--a==0&&r(h,l)})})}function sr(s){const e=[];for(const r in s)e.push(s[r]);return e}function bs(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}let fr=1;function $r(){return fr++}function gr(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function _r(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Xr(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Rr(s,e){s.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Si(s,e){return s.indexOf(e,s.length-e.length)!==-1}function Qt(s,e,r){const a={};for(const l in s)a[l]=e.call(this,s[l],l,s);return a}function Ii(s,e,r){const a={};for(const l in s)e.call(r||this,s[l],l,s)&&(a[l]=s[l]);return a}function rr(s){return Array.isArray(s)?s.map(rr):typeof s=="object"&&s?Qt(s,rr):s}const Di={};function Ms(s){Di[s]||(typeof console<"u"&&console.warn(s),Di[s]=!0)}function zr(s,e,r){return(r.y-s.y)*(e.x-s.x)>(e.y-s.y)*(r.x-s.x)}function bt(s){let e=0;for(let r,a,l=0,h=s.length,p=h-1;l<h;p=l++)r=s[l],a=s[p],e+=(a.x-r.x)*(r.y+a.y);return e}function ns(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function be(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,h)=>{const p=l||h;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Ue=null;function He(s){if(Ue==null){const e=s.navigator?s.navigator.userAgent:null;Ue=!!s.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ue}function wt(s){try{const e=M[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function pt(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}const xt="mapbox-tiles";let Ot=500,hs=50,as,ir;function Li(){try{return M.caches}catch{}}function Or(){Li()&&!as&&(as=M.caches.open(xt))}function Cn(s){const e=s.indexOf("?");if(e<0)return s;const r=function(l){const h=l.indexOf("?");return h>0?l.slice(h+1).split("&"):[]}(s),a=r.filter(l=>{const h=l.split("=");return h[0]==="language"||h[0]==="worldview"});return a.length?`${s.slice(0,e)}?${a.join("&")}`:s.slice(0,e)}let Ji=1/0;const Ti={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ti);class Ri extends Error{constructor(e,r,a){r===401&&Le(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const zi=ns()?()=>self.worker&&self.worker.referrer:()=>(M.location.protocol==="blob:"?M.parent:M).location.href,Yi=function(s,e){if(!(/^file:/.test(r=s.url)||/^file:/.test(zi())&&!/^\w+:/.test(r))){if(M.fetch&&M.Request&&M.AbortController&&M.Request.prototype.hasOwnProperty("signal"))return function(a,l){const h=new M.AbortController,p=new M.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:zi(),referrerPolicy:a.referrerPolicy,signal:h.signal});let y=!1,b=!1;const w=(T=p.url).indexOf("sku=")>0&&Le(T);var T;a.type==="json"&&p.headers.set("Accept","application/json");const A=(L,R,B)=>{if(b)return;if(L&&L.message!=="SecurityError"&&Ms(L.toString()),R&&B)return P(R);const X=Date.now();M.fetch(p).then(re=>{if(re.ok){const pe=w?re.clone():null;return P(re,pe,X)}return l(new Ri(re.statusText,re.status,a.url))}).catch(re=>{re.name!=="AbortError"&&l(new Error(`${re.message} ${a.url}`))})},P=(L,R,B)=>{(a.type==="arrayBuffer"?L.arrayBuffer():a.type==="json"?L.json():L.text()).then(X=>{b||(R&&B&&function(re,pe,ie){if(Or(),!as)return;const he={status:pe.status,statusText:pe.statusText,headers:new M.Headers};pe.headers.forEach((Be,ze)=>he.headers.set(ze,Be));const ye=be(pe.headers.get("Cache-Control")||"");if(ye["no-store"])return;ye["max-age"]&&he.headers.set("Expires",new Date(ie+1e3*ye["max-age"]).toUTCString());const xe=he.headers.get("Expires");xe&&(new Date(xe).getTime()-ie<42e4||function(Be,ze){if(ir===void 0)try{new Response(new ReadableStream),ir=!0}catch{ir=!1}ir?ze(Be.body):Be.blob().then(ze)}(pe,Be=>{const ze=new M.Response(Be,he);Or(),as&&as.then(We=>We.put(Cn(re.url),ze)).catch(We=>Ms(We.message))}))}(p,R,B),y=!0,l(null,X,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(X=>{b||l(new Error(X.message))})};return w?function(L,R){if(Or(),!as)return R(null);const B=Cn(L.url);as.then(X=>{X.match(B).then(re=>{const pe=function(ie){if(!ie)return!1;const he=new Date(ie.headers.get("Expires")||0),ye=be(ie.headers.get("Cache-Control")||"");return he>Date.now()&&!ye["no-cache"]}(re);X.delete(B),pe&&X.put(B,re.clone()),R(null,re,pe)}).catch(R)}).catch(R)}(p,A):A(null,null),{cancel:()=>{b=!0,y||h.abort()}}}(s,e);if(ns()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var r;return function(a,l){const h=new M.XMLHttpRequest;h.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in a.headers)h.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=a.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(a.type==="json")try{p=JSON.parse(h.response)}catch(y){return l(y)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else l(new Ri(h.statusText,h.status,a.url))},h.send(a.body),{cancel:()=>h.abort()}}(s,e)},en=function(s,e){return Yi(bs(s,{type:"arrayBuffer"}),e)};function sl(s){const e=M.document.createElement("a");return e.href=s,e.protocol===M.document.location.protocol&&e.host===M.document.location.host}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let $,Z;$=[],Z=0;const ue=function(s,e){if(V.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Z>=U.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return $.push(h),h}Z++;let r=!1;const a=()=>{if(!r)for(r=!0,Z--;$.length&&Z<U.MAX_PARALLEL_IMAGE_REQUESTS;){const h=$.shift(),{requestParameters:p,callback:y,cancelled:b}=h;b||(h.cancel=ue(p,y).cancel)}},l=en(s,(h,p,y,b)=>{a(),h?e(h):p&&(M.createImageBitmap?function(w,T){const A=new M.Blob([new Uint8Array(w)],{type:"image/png"});M.createImageBitmap(A).then(P=>{T(null,P)}).catch(P=>{T(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,T)=>e(w,T,y,b)):function(w,T){const A=new M.Image,P=M.URL;A.onload=()=>{T(null,A),P.revokeObjectURL(A.src),A.onload=null,M.requestAnimationFrame(()=>{A.src=me})},A.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new M.Blob([new Uint8Array(w)],{type:"image/png"});A.src=w.byteLength?P.createObjectURL(L):me}(p,(w,T)=>e(w,T,y,b)))});return{cancel:()=>{l.cancel(),a()}}},_e="NO_ACCESS_TOKEN";function Ee(s){return s.indexOf("mapbox:")===0}function Le(s){return U.API_URL_REGEX.test(s)}function De(s){return U.API_CDN_URL_REGEX.test(s)}function Te(s){return U.API_STYLE_REGEX.test(s)&&!$e(s)}function $e(s){return U.API_SPRITE_REGEX.test(s)}const mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gt(s){const e=s.match(mt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ut(s){const e=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${e}`}const Wt="mapbox.eventData";function Jt(s){if(!s)return null;const e=s.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(M.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ht{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Jt(U.ACCESS_TOKEN);let a="";return a=r&&r.u?M.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,h)=>String.fromCharCode(+("0x"+h)))):U.ACCESS_TOKEN||"",e?`${Wt}.${e}:${a}`:`${Wt}:${a}`}fetchEventData(){const e=wt("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const l=M.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const h=M.localStorage.getItem(a);h&&(this.anonId=h)}catch{Ms("Unable to read from LocalStorage")}}saveEventData(){const e=wt("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{M.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&M.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Ms("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,l){if(!U.EVENTS_URL)return;const h=gt(U.EVENTS_URL);h.params.push(`access_token=${l||U.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},y=r?bs(p,r):p,b={url:ut(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(w,T){return Yi(bs(w,{method:"POST"}),T)}(b,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(l)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Yt=new class extends Ht{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,e){U.EVENTS_URL&&U.ACCESS_TOKEN&&Array.isArray(s)&&s.some(r=>Ee(r)||Le(r))&&this.queueRequest(Date.now(),e)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Jt(U.ACCESS_TOKEN),r=e?e.u:U.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;Xr(this.anonId)||(this.anonId=gr(),a=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),p=new Date(l),y=(l-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||h.getDate()!==p.getDate()}else a=!0;a?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:se,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},s):this.processRequests()}},ls=Yt.postTurnstileEvent.bind(Yt),Us=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,e,r,a){this.skuToken=e,this.errorCb=a,U.EVENTS_URL&&(r||U.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},r):this.errorCb(new Error(_e)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Xr(this.anonId)||(this.anonId=gr()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:se,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},s))}},nr=Us.postMapLoadEvent.bind(Us),Fr=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(s,e){U.EVENTS_URL&&(s||U.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),a=function(l){const h=M.performance.getEntriesByType("resource"),p=M.performance.getEntriesByType("mark"),y=function(P){const L={};if(P){for(const R in P)if(R!=="other")for(const B of P[R]){const X=`${R}ResolveRangeMin`,re=`${R}ResolveRangeMax`,pe=`${R}RequestCount`,ie=`${R}RequestCachedCount`;L[X]=Math.min(L[X]||1/0,B.startTime),L[re]=Math.max(L[re]||-1/0,B.responseEnd);const he=ye=>{L[ye]===void 0&&(L[ye]=0),++L[ye]};B.transferSize!==void 0&&B.transferSize===0&&he(ie),he(pe)}}return L}(function(P,L){const R={};if(P)for(const B of P){const X=L(B);R[X]===void 0&&(R[X]=[]),R[X].push(B)}return R}(h,nd)),b=M.devicePixelRatio,w=M.navigator.connection||M.navigator.mozConnection||M.navigator.webkitConnection,T={counters:[],metadata:[],attributes:[]},A=(P,L,R)=>{R!=null&&P.push({name:L,value:R.toString()})};for(const P in y)A(T.counters,P,y[P]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(A(T.counters,"interactionRangeMin",l.interactionRange[0]),A(T.counters,"interactionRangeMax",l.interactionRange[1])),p)for(const P of Object.keys(ga)){const L=ga[P],R=p.find(B=>B.name===L);R&&A(T.counters,L,R.startTime)}return A(T.counters,"visibilityHidden",l.visibilityHidden),A(T.attributes,"style",function(P){if(P)for(const L of P){const R=L.name.split("?")[0];if(Te(R)){const B=R.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(h)),A(T.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),A(T.attributes,"fogEnabled",l.fogEnabled?"true":"false"),A(T.attributes,"projection",l.projection),A(T.attributes,"zoom",l.zoom),A(T.metadata,"devicePixelRatio",b),A(T.metadata,"connectionEffectiveType",w?w.effectiveType:void 0),A(T.metadata,"navigatorUserAgent",M.navigator.userAgent),A(T.metadata,"screenWidth",M.screen.width),A(T.metadata,"screenHeight",M.screen.height),A(T.metadata,"windowWidth",M.innerWidth),A(T.metadata,"windowHeight",M.innerHeight),A(T.metadata,"mapWidth",l.width/b),A(T.metadata,"mapHeight",l.height/b),A(T.metadata,"webglRenderer",l.renderer),A(T.metadata,"webglVendor",l.vendor),A(T.metadata,"sdkVersion",z),A(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(r);for(const l of a.metadata);for(const l of a.counters);for(const l of a.attributes);this.postEvent(e,a,()=>{},s)}},xr=Fr.postPerformanceEvent.bind(Fr),Oi=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,e,r,a){if(!U.API_URL||!U.SESSION_PATH)return;const l=gt(U.API_URL+U.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${a||U.ACCESS_TOKEN||""}`);const h={url:ut(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,y){return Yi(bs(p,{method:"GET"}),y)}(h,p=>{this.pendingRequest=null,r(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(s,e,r,a){this.skuToken=e,this.errorCb=a,U.SESSION_PATH&&U.API_URL&&(r||U.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},r):this.errorCb(new Error(_e)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},s)}},jr=Oi.getSessionAPI.bind(Oi),Gr=new Set,ga={create:"create",load:"load",fullLoad:"fullLoad"},_m={mark(s){M.performance.mark(s)},measure(s,e,r){M.performance.measure(s,e,r)}};function nd(s){const e=s.name.split("?")[0];return De(e)&&e.includes("mapbox-gl.js")?"javascript":De(e)&&e.includes("mapbox-gl.css")?"css":function(r){return U.API_FONTS_REGEX.test(r)}(e)?"fontRange":$e(e)?"sprite":Te(e)?"style":function(r){return U.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}const ys=M.performance;function dc(s){const e=s?s.url.toString():void 0;return ys.getEntriesByName(e)}let io,hc,rl,Fi;const tn={now:()=>rl!==void 0?rl:M.performance.now(),setNow(s){rl=s},restoreNow(){rl=void 0},frame(s){const e=M.requestAnimationFrame(s);return{cancel:()=>M.cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:r,height:a}=s;Fi||(Fi=M.document.createElement("canvas"));const l=Fi.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>Fi.width||a>Fi.height)&&(Fi.width=r,Fi.height=a),l.clearRect(-e,-e,r+2*e,a+2*e),l.drawImage(s,0,0,r,a),l.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:s=>(io||(io=M.document.createElement("a")),io.href=s,io.href),get devicePixelRatio(){return M.devicePixelRatio},get prefersReducedMotion(){return!!M.matchMedia&&(hc==null&&(hc=M.matchMedia("(prefers-reduced-motion: reduce)")),hc.matches)}};function mc(s,e,r){r[s]&&r[s].indexOf(e)!==-1||(r[s]=r[s]||[],r[s].push(e))}function pc(s,e,r){if(r&&r[s]){const a=r[s].indexOf(e);a!==-1&&r[s].splice(a,1)}}class Zn{constructor(e,r={}){bs(this,r),this.type=e}}class sn extends Zn{constructor(e,r={}){super("error",bs({error:e},r))}}class no{on(e,r){return this._listeners=this._listeners||{},mc(e,r,this._listeners),this}off(e,r){return pc(e,r,this._listeners),pc(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},mc(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Zn(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of l)y.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of h)pc(a,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(bs(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof sn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function rn(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}function ar(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Nr(s){if(Array.isArray(s))return s.map(Nr);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const r in s)e[r]=Nr(s[r]);return e}return ar(s)}class ad extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Bi=ad;class fc{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,l]of r)this.bindings[a]=l}concat(e){return new fc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var od=fc;const xa={kind:"null"},jt={kind:"number"},os={kind:"string"},ss={kind:"boolean"},oi={kind:"color"},Ei={kind:"object"},rs={kind:"value"},li={kind:"collator"},ao={kind:"formatted"},Wn={kind:"resolvedImage"};function mi(s,e){return{kind:"array",itemType:s,N:e}}function Fs(s){if(s.kind==="array"){const e=Fs(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const ld=[xa,jt,os,ss,oi,ao,Ei,mi(rs),Wn];function nn(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!nn(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const r of ld)if(!nn(r,e))return null}}return`Expected ${Fs(s)} but found ${Fs(e)} instead.`}function oo(s,e){return e.some(r=>r.kind===s.kind)}function lo(s,e){return e.some(r=>r==="null"?s===null:r==="array"?Array.isArray(s):r==="object"?s&&!Array.isArray(s)&&typeof s=="object":r===typeof s)}var gc,cd={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function co(s){return(s=Math.round(s))<0?0:s>255?255:s}function uo(s){return co(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function il(s){return(e=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:e>1?1:e;var e}function ya(s,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?s+(e-s)*r*6:2*r<1?e:3*r<2?s+(e-s)*(2/3-r)*6:s}try{gc={}.parseCSSColor=function(s){var e,r=s.replace(/ /g,"").toLowerCase();if(r in cd)return cd[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),l=r.indexOf(")");if(a!==-1&&l+1===r.length){var h=r.substr(0,a),p=r.substr(a+1,l-(a+1)).split(","),y=1;switch(h){case"rgba":if(p.length!==4)return null;y=il(p.pop());case"rgb":return p.length!==3?null:[uo(p[0]),uo(p[1]),uo(p[2]),y];case"hsla":if(p.length!==4)return null;y=il(p.pop());case"hsl":if(p.length!==3)return null;var b=(parseFloat(p[0])%360+360)%360/360,w=il(p[1]),T=il(p[2]),A=T<=.5?T*(w+1):T+w-T*w,P=2*T-A;return[co(255*ya(P,A,b+1/3)),co(255*ya(P,A,b)),co(255*ya(P,A,b-1/3)),y];default:return null}}return null}}catch{}class Kr{constructor(e,r,a,l=1){this.r=e,this.g=r,this.b=a,this.a=l}static parse(e){if(!e)return;if(e instanceof Kr)return e;if(typeof e!="string")return;const r=gc(e);return r?new Kr(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${l})`}toArray(){const{r:e,g:r,b:a,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*a/l,l]}toArray01(){const{r:e,g:r,b:a,a:l}=this;return l===0?[0,0,0,0]:[e/l,r/l,a/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:l}=this;return[e,r,a,l]}}Kr.black=new Kr(0,0,0,1),Kr.white=new Kr(1,1,1,1),Kr.transparent=new Kr(0,0,0,0),Kr.red=new Kr(1,0,0,1),Kr.blue=new Kr(0,0,1,1);var Ks=Kr;class xc{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yc{constructor(e,r,a,l,h){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=l,this.textColor=h}}class Qr{constructor(e){this.sections=e}static fromString(e){return new Qr([new yc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Qr?e:Qr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class pi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new pi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function ud(s,e,r,a){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[s,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[s,e,r,a]:[s,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ho(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Ks||s instanceof xc||s instanceof Qr||s instanceof pi)return!0;if(Array.isArray(s)){for(const e of s)if(!ho(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!ho(s[e]))return!1;return!0}return!1}function Gs(s){if(s===null)return xa;if(typeof s=="string")return os;if(typeof s=="boolean")return ss;if(typeof s=="number")return jt;if(s instanceof Ks)return oi;if(s instanceof xc)return li;if(s instanceof Qr)return ao;if(s instanceof pi)return Wn;if(Array.isArray(s)){const e=s.length;let r;for(const a of s){const l=Gs(a);if(r){if(r===l)continue;r=rs;break}r=l}return mi(r||rs,e)}return Ei}function mo(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Ks||s instanceof Qr||s instanceof pi?s.toString():JSON.stringify(s)}class _c{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ho(e[1]))return r.error("invalid value");const a=e[1];let l=Gs(a);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new _c(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ks?["rgba"].concat(this.value.toArray()):this.value instanceof Qr?this.value.serialize():this.value}}var Hn=_c,Pr=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const bc={string:os,number:jt,boolean:ss,object:Ei};class vc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,l=1;const h=e[0];if(h==="array"){let y,b;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in bc)||w==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=bc[w],l++}else y=rs;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],l++}a=mi(y,b)}else a=bc[h];const p=[];for(;l<e.length;l++){const y=r.parse(e[l],l,rs);if(!y)return null;p.push(y)}return new vc(a,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!nn(this.type,Gs(a)))return a;if(r===this.args.length-1)throw new Pr(`Expected value to be of type ${Fs(this.type)}, but found ${Fs(Gs(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(a=>a.serialize()))}}var an=vc;class kn{constructor(e){this.type=ao,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,jt),!b))return null;let w=null;if(y["text-font"]&&(w=r.parse(y["text-font"],1,mi(os)),!w))return null;let T=null;if(y["text-color"]&&(T=r.parse(y["text-color"],1,oi),!T))return null;const A=l[l.length-1];A.scale=b,A.font=w,A.textColor=T}else{const b=r.parse(e[p],1,rs);if(!b)return null;const w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:b,scale:null,font:null,textColor:null})}}return new kn(l)}evaluate(e){return new Qr(this.sections.map(r=>{const a=r.content.evaluate(e);return Gs(a)===Wn?new yc("",a,null,null,null):new yc(mo(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class nl{constructor(e){this.type=Wn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,os);return a?new nl(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=pi.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const bm={"to-boolean":ss,"to-color":oi,"to-number":jt,"to-string":os};class wc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=bm[a],h=[];for(let p=1;p<e.length;p++){const y=r.parse(e[p],p,rs);if(!y)return null;h.push(y)}return new wc(l,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const l of this.args){if(r=l.evaluate(e),a=null,r instanceof Ks)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ud(r[0],r[1],r[2],r[3]),!a))return new Ks(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Pr(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Pr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Qr.fromString(mo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?pi.fromString(mo(this.args[0].evaluate(e))):mo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new kn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new nl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var _a=wc;const Ui=["Unknown","Point","LineString","Polygon"];var jc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ui[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-s[0])+this.featureDistanceData.bearing[1]*(a*e-s[1])}return 0}parseColor(s){let e=this._parseColorCache[s];return e||(e=this._parseColorCache[s]=Ks.parse(s)),e}};class Xn{constructor(e,r,a,l){this.name=e,this.type=r,this._evaluate=a,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],l=Xn.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let b=null;for(const[w,T]of y){b=new kc(r.registry,r.path,null,r.scope);const A=[];let P=!1;for(let L=1;L<e.length;L++){const R=e[L],B=Array.isArray(w)?w[L-1]:w.type,X=b.parse(R,1+A.length,B);if(!X){P=!0;break}A.push(X)}if(!P)if(Array.isArray(w)&&w.length!==A.length)b.error(`Expected ${w.length} arguments, but found ${A.length} instead.`);else{for(let L=0;L<A.length;L++){const R=Array.isArray(w)?w[L]:w.type,B=A[L];b.concat(L+1).checkSubtype(R,B.type)}if(b.errors.length===0)return new Xn(a,h,T,A)}}if(y.length===1)r.errors.push(...b.errors);else{const w=(y.length?y:p).map(([A])=>{return P=A,Array.isArray(P)?`(${P.map(Fs).join(", ")})`:`(${Fs(P.type)}...)`;var P}).join(" | "),T=[];for(let A=1;A<e.length;A++){const P=r.parse(e[A],1+T.length);if(!P)return null;T.push(Fs(P.type))}r.error(`Expected arguments of type ${w}, but found (${T.join(", ")}) instead.`)}return null}static register(e,r){Xn.definitions=r;for(const a in r)e[a]=Xn}}var on=Xn;class po{constructor(e,r,a){this.type=li,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const l=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ss);if(!l)return null;const h=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ss);if(!h)return null;let p=null;return a.locale&&(p=r.parse(a.locale,1,os),!p)?null:new po(l,h,p)}evaluate(e){return new xc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ln=8192;function al(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function ba(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function fo(s,e){const r=(180+s[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*ln),Math.round(a*l*ln)]}function dd(s,e,r){const a=s[0]-e[0],l=s[1]-e[1],h=s[0]-r[0],p=s[1]-r[1];return a*p-h*l==0&&a*h<=0&&l*p<=0}function ol(s,e){let r=!1;for(let p=0,y=e.length;p<y;p++){const b=e[p];for(let w=0,T=b.length;w<T-1;w++){if(dd(s,b[w],b[w+1]))return!1;(l=b[w])[1]>(a=s)[1]!=(h=b[w+1])[1]>a[1]&&a[0]<(h[0]-l[0])*(a[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var a,l,h;return r}function Nc(s,e){for(let r=0;r<e.length;r++)if(ol(s,e[r]))return!0;return!1}function Sc(s,e,r,a){const l=a[0]-r[0],h=a[1]-r[1],p=(s[0]-r[0])*h-l*(s[1]-r[1]),y=(e[0]-r[0])*h-l*(e[1]-r[1]);return p>0&&y<0||p<0&&y>0}function va(s,e,r){for(const w of r)for(let T=0;T<w.length-1;++T)if((y=[(p=w[T+1])[0]-(h=w[T])[0],p[1]-h[1]])[0]*(b=[(l=e)[0]-(a=s)[0],l[1]-a[1]])[1]-y[1]*b[0]!=0&&Sc(a,l,h,p)&&Sc(h,p,a,l))return!0;var a,l,h,p,y,b;return!1}function _s(s,e){for(let r=0;r<s.length;++r)if(!ol(s[r],e))return!1;for(let r=0;r<s.length-1;++r)if(va(s[r],s[r+1],e))return!1;return!0}function vm(s,e){for(let r=0;r<e.length;r++)if(_s(s,e[r]))return!0;return!1}function Tc(s,e,r){const a=[];for(let l=0;l<s.length;l++){const h=[];for(let p=0;p<s[l].length;p++){const y=fo(s[l][p],r);al(e,y),h.push(y)}a.push(h)}return a}function hd(s,e,r){const a=[];for(let l=0;l<s.length;l++){const h=Tc(s[l],e,r);a.push(h)}return a}function Ec(s,e,r,a){if(s[0]<r[0]||s[0]>r[2]){const l=.5*a;let h=s[0]-r[0]>l?-a:r[0]-s[0]>l?a:0;h===0&&(h=s[0]-r[2]>l?-a:r[2]-s[0]>l?a:0),s[0]+=h}al(e,s)}function md(s,e,r,a){const l=Math.pow(2,a.z)*ln,h=[a.x*ln,a.y*ln],p=[];if(!s)return p;for(const y of s)for(const b of y){const w=[b.x+h[0],b.y+h[1]];Ec(w,e,r,l),p.push(w)}return p}function Cc(s,e,r,a){const l=Math.pow(2,a.z)*ln,h=[a.x*ln,a.y*ln],p=[];if(!s)return p;for(const b of s){const w=[];for(const T of b){const A=[T.x+h[0],T.y+h[1]];al(e,A),w.push(A)}p.push(w)}if(e[2]-e[0]<=l/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of p)for(const w of b)Ec(w,e,r,l)}var y;return p}class wa{constructor(e,r){this.type=ss,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ho(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let l=0;l<a.features.length;++l){const h=a.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new wa(a,a.features[l].geometry)}else if(a.type==="Feature"){const l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new wa(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new wa(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=Tc(a.coordinates,h,p),b=md(r.geometry(),l,h,p);if(!ba(l,h))return!1;for(const w of b)if(!ol(w,y))return!1}if(a.type==="MultiPolygon"){const y=hd(a.coordinates,h,p),b=md(r.geometry(),l,h,p);if(!ba(l,h))return!1;for(const w of b)if(!Nc(w,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=Tc(a.coordinates,h,p),b=Cc(r.geometry(),l,h,p);if(!ba(l,h))return!1;for(const w of b)if(!_s(w,y))return!1}if(a.type==="MultiPolygon"){const y=hd(a.coordinates,h,p),b=Cc(r.geometry(),l,h,p);if(!ba(l,h))return!1;for(const w of b)if(!vm(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ll=wa;function ja(s){if(s instanceof on&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof ll)return!1;let e=!0;return s.eachChild(r=>{e&&!ja(r)&&(e=!1)}),e}function cn(s){if(s instanceof on&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(r=>{e&&!cn(r)&&(e=!1)}),e}function Kn(s,e){if(s instanceof on&&e.indexOf(s.name)>=0)return!1;let r=!0;return s.eachChild(a=>{r&&!Kn(a,e)&&(r=!1)}),r}class cl{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new cl(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var pd=cl;class go{constructor(e,r=[],a,l=new od,h=[]){this.registry=e,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=h,this.expectedType=a}parse(e,r,a,l,h={}){return r?this.concat(r,a,l)._parse(e,h):this._parse(e,h)}_parse(e,r){function a(l,h,p){return p==="assert"?new an(h,[l]):p==="coerce"?new _a(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,b=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else p=a(p,y,r.typeAnnotation||"coerce");else p=a(p,y,r.typeAnnotation||"assert")}if(!(p instanceof Hn)&&p.type.kind!=="resolvedImage"&&Ac(p)){const y=new jc;try{p=new Hn(p.type,p.evaluate(y))}catch(b){return this.error(b.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const l=typeof e=="number"?this.path.concat(e):this.path,h=a?this.scope.concat(a):this.scope;return new go(this.registry,l,r||null,h,this.errors)}error(e,...r){const a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Bi(a,e))}checkSubtype(e,r){const a=nn(e,r);return a&&this.error(a),a}}var kc=go;function Ac(s){if(s instanceof pd)return Ac(s.boundExpression);if(s instanceof on&&s.name==="error"||s instanceof po||s instanceof ll)return!1;const e=s instanceof _a||s instanceof an;let r=!0;return s.eachChild(a=>{r=e?r&&Ac(a):r&&a instanceof Hn}),!!r&&ja(s)&&Kn(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ul(s,e){const r=s.length-1;let a,l,h=0,p=r,y=0;for(;h<=p;)if(y=Math.floor((h+p)/2),a=s[y],l=s[y+1],a<=e){if(y===r||e<l)return y;h=y+1}else{if(!(a>e))throw new Pr("Input is not a number.");p=y-1}return 0}class dl{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of a)this.labels.push(l),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,jt);if(!a)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],b=e[p+1],w=p,T=p+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const A=r.parse(b,T,h);if(!A)return null;h=h||A.type,l.push([y,A])}return new dl(h,a,l)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const h=r.length;return l>=r[h-1]?a[h-1].evaluate(e):a[ul(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var Mc=dl;function ds(s,e,r){return s*(1-r)+e*r}var xo=Object.freeze({__proto__:null,array:function(s,e,r){return s.map((a,l)=>ds(a,e[l],r))},color:function(s,e,r){return new Ks(ds(s.r,e.r,r),ds(s.g,e.g,r),ds(s.b,e.b,r),ds(s.a,e.a,r))},number:ds});const fd=.95047,Pc=1.08883,gd=4/29,Qn=6/29,Ic=3*Qn*Qn,wm=Qn*Qn*Qn,jm=Math.PI/180,Nm=180/Math.PI;function Dc(s){return s>wm?Math.pow(s,1/3):s/Ic+gd}function Lc(s){return s>Qn?s*s*s:Ic*(s-gd)}function Rc(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function hl(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function xd(s){const e=hl(s.r),r=hl(s.g),a=hl(s.b),l=Dc((.4124564*e+.3575761*r+.1804375*a)/fd),h=Dc((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*h-16,a:500*(l-h),b:200*(h-Dc((.0193339*e+.119192*r+.9503041*a)/Pc)),alpha:s.a}}function yd(s){let e=(s.l+16)/116,r=isNaN(s.a)?e:e+s.a/500,a=isNaN(s.b)?e:e-s.b/200;return e=1*Lc(e),r=fd*Lc(r),a=Pc*Lc(a),new Ks(Rc(3.2404542*r-1.5371385*e-.4985314*a),Rc(-.969266*r+1.8760108*e+.041556*a),Rc(.0556434*r-.2040259*e+1.0572252*a),s.alpha)}function Sm(s,e,r){const a=e-s;return s+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const yo={forward:xd,reverse:yd,interpolate:function(s,e,r){return{l:ds(s.l,e.l,r),a:ds(s.a,e.a,r),b:ds(s.b,e.b,r),alpha:ds(s.alpha,e.alpha,r)}}},Na={forward:function(s){const{l:e,a:r,b:a}=xd(s),l=Math.atan2(a,r)*Nm;return{h:l<0?l+360:l,c:Math.sqrt(r*r+a*a),l:e,alpha:s.a}},reverse:function(s){const e=s.h*jm,r=s.c;return yd({l:s.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:s.alpha})},interpolate:function(s,e,r){return{h:Sm(s.h,e.h,r),c:ds(s.c,e.c,r),l:ds(s.l,e.l,r),alpha:ds(s.alpha,e.alpha,r)}}};var zc=Object.freeze({__proto__:null,hcl:Na,lab:yo});class _o{constructor(e,r,a,l,h){this.type=e,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of h)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,r,a,l){let h=0;if(e.name==="exponential")h=Oc(r,e.base,a,l);else if(e.name==="linear")h=Oc(r,1,a,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new Ce(p[0],p[1],p[2],p[3]).solve(Oc(r,1,a,l))}return h}static parse(e,r){let[a,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(T=>typeof T!="number"||T<0||T>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,jt),!h)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=oi:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let w=0;w<p.length;w+=2){const T=p[w],A=p[w+1],P=w+3,L=w+4;if(typeof T!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(y.length&&y[y.length-1][0]>=T)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const R=r.parse(A,L,b);if(!R)return null;b=b||R.type,y.push([T,R])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new _o(b,a,l,h,y):r.error(`Type ${Fs(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const h=r.length;if(l>=r[h-1])return a[h-1].evaluate(e);const p=ul(r,l),y=_o.interpolationFactor(this.interpolation,l,r[p],r[p+1]),b=a[p].evaluate(e),w=a[p+1].evaluate(e);return this.operator==="interpolate"?xo[this.type.kind.toLowerCase()](b,w,y):this.operator==="interpolate-hcl"?Na.reverse(Na.interpolate(Na.forward(b),Na.forward(w),y)):yo.reverse(yo.interpolate(yo.forward(b),yo.forward(w),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function Oc(s,e,r,a){const l=a-r,h=s-r;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}var Vi=_o;class ml{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const l=r.expectedType;l&&l.kind!=="value"&&(a=l);const h=[];for(const y of e.slice(1)){const b=r.parse(y,1+h.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,h.push(b)}const p=l&&h.some(y=>nn(l,y.type));return new ml(p?rs:a,h)}evaluate(e){let r,a=null,l=0;for(const h of this.args){if(l++,a=h.evaluate(e),a&&a instanceof pi&&!a.available&&(r||(r=a),a=null,l===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Fc=ml;class pl{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const y=r.parse(e[h+1],h+1);if(!y)return null;a.push([p,y])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return l?new pl(a,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}var _d=pl;class Bc{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,jt),l=r.parse(e[2],2,mi(r.expectedType||rs));return a&&l?new Bc(l.type.itemType,a,l):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Pr(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Pr(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Pr(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Tm=Bc;class Uc{constructor(e,r){this.type=ss,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,rs);return a&&l?oo(a.type,[ss,os,jt,xa,rs])?new Uc(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!lo(r,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(Gs(r))} instead.`);if(!lo(a,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${Fs(Gs(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var fl=Uc;class bo{constructor(e,r,a){this.type=jt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,rs);if(!a||!l)return null;if(!oo(a.type,[ss,os,jt,xa,rs]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(a.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,jt);return h?new bo(a,l,h):null}return new bo(a,l)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!lo(r,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(Gs(r))} instead.`);if(!lo(a,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${Fs(Gs(a))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return a.indexOf(r,l)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var bd=bo;class Vc{constructor(e,r,a,l,h,p){this.inputType=e,this.type=r,this.input=a,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},p=[];for(let w=2;w<e.length-1;w+=2){let T=e[w];const A=e[w+1];Array.isArray(T)||(T=[T]);const P=r.concat(w);if(T.length===0)return P.error("Expected at least one branch label.");for(const R of T){if(typeof R!="number"&&typeof R!="string")return P.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,Gs(R)))return null}else a=Gs(R);if(h[String(R)]!==void 0)return P.error("Branch labels must be unique.");h[String(R)]=p.length}const L=r.parse(A,w,l);if(!L)return null;l=l||L.type,p.push(L)}const y=r.parse(e[1],1,rs);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,l);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new Vc(a,l,y,h,p,b):null}evaluate(e){const r=this.input.evaluate(e);return(Gs(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],l={};for(const p of r){const y=l[this.cases[p]];y===void 0?(l[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[y][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of a)e.push(y.length===1?h(y[0]):y.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Em=Vc;class qc{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const y=r.parse(e[p],p,ss);if(!y)return null;const b=r.parse(e[p+1],p+1,a);if(!b)return null;l.push([y,b]),a=a||b.type}const h=r.parse(e[e.length-1],e.length-1,a);return h?new qc(a,l,h):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var vd=qc;class vo{constructor(e,r,a,l){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,jt);if(!a||!l)return null;if(!oo(a.type,[mi(rs),os,rs]))return r.error(`Expected first argument to be of type array or string, but found ${Fs(a.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,jt);return h?new vo(a.type,a,l,h):null}return new vo(a.type,a,l)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!lo(r,["string","array"]))throw new Pr(`Expected first argument to be of type array or string, but found ${Fs(Gs(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(a,l)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var wd=vo;function gl(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jd(s,e,r,a){return a.compare(e,r)===0}function Sa(s,e,r){const a=s!=="=="&&s!=="!=";return class ab{constructor(h,p,y){this.type=ss,this.lhs=h,this.rhs=p,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const y=h[0];let b=p.parse(h[1],1,rs);if(!b)return null;if(!gl(y,b.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Fs(b.type)}'.`);let w=p.parse(h[2],2,rs);if(!w)return null;if(!gl(y,w.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Fs(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Fs(b.type)}' and '${Fs(w.type)}'.`);a&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new an(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new an(b.type,[w])));let T=null;if(h.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(h[3],3,li),!T)return null}return new ab(b,w,T)}evaluate(h){const p=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(a&&this.hasUntypedArgument){const b=Gs(p),w=Gs(y);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new Pr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Gs(p),w=Gs(y);if(b.kind!=="string"||w.kind!=="string")return e(h,p,y)}return this.collator?r(h,p,y,this.collator.evaluate(h)):e(h,p,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[s];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const Cm=Sa("==",function(s,e,r){return e===r},jd),km=Sa("!=",function(s,e,r){return e!==r},function(s,e,r,a){return!jd(0,e,r,a)}),Am=Sa("<",function(s,e,r){return e<r},function(s,e,r,a){return a.compare(e,r)<0}),Mm=Sa(">",function(s,e,r){return e>r},function(s,e,r,a){return a.compare(e,r)>0}),Pm=Sa("<=",function(s,e,r){return e<=r},function(s,e,r,a){return a.compare(e,r)<=0}),Nd=Sa(">=",function(s,e,r){return e>=r},function(s,e,r,a){return a.compare(e,r)>=0});class xl{constructor(e,r,a,l,h,p){this.type=os,this.number=e,this.locale=r,this.currency=a,this.unit=l,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,jt);if(!a)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,os),!h))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,os),!p))return null;let y=null;if(l.unit&&(y=r.parse(l.unit,1,os),!y))return null;let b=null;if(l["min-fraction-digits"]&&(b=r.parse(l["min-fraction-digits"],1,jt),!b))return null;let w=null;return l["max-fraction-digits"]&&(w=r.parse(l["max-fraction-digits"],1,jt),!w)?null:new xl(a,h,p,y,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ta{constructor(e){this.type=jt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Fs(a.type)} instead.`):new Ta(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Pr(`Expected value to be of type string or array, but found ${Fs(Gs(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Sd={"==":Cm,"!=":km,">":Mm,"<":Am,">=":Nd,"<=":Pm,array:an,at:Tm,boolean:an,case:vd,coalesce:Fc,collator:po,format:kn,image:nl,in:fl,"index-of":bd,interpolate:Vi,"interpolate-hcl":Vi,"interpolate-lab":Vi,length:Ta,let:_d,literal:Hn,match:Em,number:an,"number-format":xl,object:an,slice:wd,step:Mc,string:an,"to-boolean":_a,"to-color":_a,"to-number":_a,"to-string":_a,var:pd,within:ll};function Td(s,[e,r,a,l]){e=e.evaluate(s),r=r.evaluate(s),a=a.evaluate(s);const h=l?l.evaluate(s):1,p=ud(e,r,a,h);if(p)throw new Pr(p);return new Ks(e/255*h,r/255*h,a/255*h,h)}function un(s,e){return s in e}function yl(s,e){const r=e[s];return r===void 0?null:r}function fi(s){return{type:s}}on.register(Sd,{error:[{kind:"error"},[os],(s,[e])=>{throw new Pr(e.evaluate(s))}],typeof:[os,[rs],(s,[e])=>Fs(Gs(e.evaluate(s)))],"to-rgba":[mi(jt,4),[oi],(s,[e])=>e.evaluate(s).toArray()],rgb:[oi,[jt,jt,jt],Td],rgba:[oi,[jt,jt,jt,jt],Td],has:{type:ss,overloads:[[[os],(s,[e])=>un(e.evaluate(s),s.properties())],[[os,Ei],(s,[e,r])=>un(e.evaluate(s),r.evaluate(s))]]},get:{type:rs,overloads:[[[os],(s,[e])=>yl(e.evaluate(s),s.properties())],[[os,Ei],(s,[e,r])=>yl(e.evaluate(s),r.evaluate(s))]]},"feature-state":[rs,[os],(s,[e])=>yl(e.evaluate(s),s.featureState||{})],properties:[Ei,[],s=>s.properties()],"geometry-type":[os,[],s=>s.geometryType()],id:[rs,[],s=>s.id()],zoom:[jt,[],s=>s.globals.zoom],pitch:[jt,[],s=>s.globals.pitch||0],"distance-from-center":[jt,[],s=>s.distanceFromCenter()],"heatmap-density":[jt,[],s=>s.globals.heatmapDensity||0],"line-progress":[jt,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[jt,[],s=>s.globals.skyRadialProgress||0],accumulated:[rs,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[jt,fi(jt),(s,e)=>{let r=0;for(const a of e)r+=a.evaluate(s);return r}],"*":[jt,fi(jt),(s,e)=>{let r=1;for(const a of e)r*=a.evaluate(s);return r}],"-":{type:jt,overloads:[[[jt,jt],(s,[e,r])=>e.evaluate(s)-r.evaluate(s)],[[jt],(s,[e])=>-e.evaluate(s)]]},"/":[jt,[jt,jt],(s,[e,r])=>e.evaluate(s)/r.evaluate(s)],"%":[jt,[jt,jt],(s,[e,r])=>e.evaluate(s)%r.evaluate(s)],ln2:[jt,[],()=>Math.LN2],pi:[jt,[],()=>Math.PI],e:[jt,[],()=>Math.E],"^":[jt,[jt,jt],(s,[e,r])=>Math.pow(e.evaluate(s),r.evaluate(s))],sqrt:[jt,[jt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[jt,[jt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[jt,[jt],(s,[e])=>Math.log(e.evaluate(s))],log2:[jt,[jt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[jt,[jt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[jt,[jt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[jt,[jt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[jt,[jt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[jt,[jt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[jt,[jt],(s,[e])=>Math.atan(e.evaluate(s))],min:[jt,fi(jt),(s,e)=>Math.min(...e.map(r=>r.evaluate(s)))],max:[jt,fi(jt),(s,e)=>Math.max(...e.map(r=>r.evaluate(s)))],abs:[jt,[jt],(s,[e])=>Math.abs(e.evaluate(s))],round:[jt,[jt],(s,[e])=>{const r=e.evaluate(s);return r<0?-Math.round(-r):Math.round(r)}],floor:[jt,[jt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[jt,[jt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[ss,[os,rs],(s,[e,r])=>s.properties()[e.value]===r.value],"filter-id-==":[ss,[rs],(s,[e])=>s.id()===e.value],"filter-type-==":[ss,[os],(s,[e])=>s.geometryType()===e.value],"filter-<":[ss,[os,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[ss,[os,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[ss,[os,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[ss,[os,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[ss,[rs],(s,[e])=>e.value in s.properties()],"filter-has-id":[ss,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ss,[mi(os)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[ss,[mi(rs)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[ss,[os,mi(rs)],(s,[e,r])=>r.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[ss,[os,mi(rs)],(s,[e,r])=>function(a,l,h,p){for(;h<=p;){const y=h+p>>1;if(l[y]===a)return!0;l[y]>a?p=y-1:h=y+1}return!1}(s.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ss,overloads:[[[ss,ss],(s,[e,r])=>e.evaluate(s)&&r.evaluate(s)],[fi(ss),(s,e)=>{for(const r of e)if(!r.evaluate(s))return!1;return!0}]]},any:{type:ss,overloads:[[[ss,ss],(s,[e,r])=>e.evaluate(s)||r.evaluate(s)],[fi(ss),(s,e)=>{for(const r of e)if(r.evaluate(s))return!0;return!1}]]},"!":[ss,[ss],(s,[e])=>!e.evaluate(s)],"is-supported-script":[ss,[os],(s,[e])=>{const r=s.globals&&s.globals.isSupportedScript;return!r||r(e.evaluate(s))}],upcase:[os,[os],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[os,[os],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[os,fi(rs),(s,e)=>e.map(r=>mo(r.evaluate(s))).join("")],"resolved-locale":[os,[li],(s,[e])=>e.evaluate(s).resolvedLocale()]});var wo=Sd;function Ed(s){return{result:"success",value:s}}function Jn(s){return{result:"error",value:s}}function Ea(s){return s["property-type"]==="data-driven"}function _l(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function bl(s){return!!s.expression&&s.expression.interpolated}function ms(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function jo(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Cd(s){return s}function vl(s,e){const r=e.type==="color",a=s.stops&&typeof s.stops[0][0]=="object",l=a||!(a||s.property!==void 0),h=s.type||(bl(e)?"exponential":"interval");if(r&&((s=rn({},s)).stops&&(s.stops=s.stops.map(w=>[w[0],Ks.parse(w[1])])),s.default=Ks.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!zc[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let p,y,b;if(h==="exponential")p=dn;else if(h==="interval")p=wl;else if(h==="categorical"){p=kd,y=Object.create(null);for(const w of s.stops)y[w[0]]=w[1];b=typeof s.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=Ad}if(a){const w={},T=[];for(let L=0;L<s.stops.length;L++){const R=s.stops[L],B=R[0].zoom;w[B]===void 0&&(w[B]={zoom:B,type:s.type,property:s.property,default:s.default,stops:[]},T.push(B)),w[B].stops.push([R[0].value,R[1]])}const A=[];for(const L of T)A.push([w[L].zoom,vl(w[L],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Vi.interpolationFactor.bind(void 0,P),zoomStops:A.map(L=>L[0]),evaluate:({zoom:L},R)=>dn({stops:A,base:s.base},e,L).evaluate(L,R)}}if(l){const w=h==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Vi.interpolationFactor.bind(void 0,w),zoomStops:s.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(s,e,T,y,b)}}return{kind:"source",evaluate(w,T){const A=T&&T.properties?T.properties[s.property]:void 0;return A===void 0?Ca(s.default,e.default):p(s,e,A,y,b)}}}function Ca(s,e,r){return s!==void 0?s:e!==void 0?e:r!==void 0?r:void 0}function kd(s,e,r,a,l){return Ca(typeof r===l?a[r]:void 0,s.default,e.default)}function wl(s,e,r){if(ms(r)!=="number")return Ca(s.default,e.default);const a=s.stops.length;if(a===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[a-1][0])return s.stops[a-1][1];const l=ul(s.stops.map(h=>h[0]),r);return s.stops[l][1]}function dn(s,e,r){const a=s.base!==void 0?s.base:1;if(ms(r)!=="number")return Ca(s.default,e.default);const l=s.stops.length;if(l===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[l-1][0])return s.stops[l-1][1];const h=ul(s.stops.map(T=>T[0]),r),p=function(T,A,P,L){const R=L-P,B=T-P;return R===0?0:A===1?B/R:(Math.pow(A,B)-1)/(Math.pow(A,R)-1)}(r,a,s.stops[h][0],s.stops[h+1][0]),y=s.stops[h][1],b=s.stops[h+1][1];let w=xo[e.type]||Cd;if(s.colorSpace&&s.colorSpace!=="rgb"){const T=zc[s.colorSpace];w=(A,P)=>T.reverse(T.interpolate(T.forward(A),T.forward(P),p))}return typeof y.evaluate=="function"?{evaluate(...T){const A=y.evaluate.apply(void 0,T),P=b.evaluate.apply(void 0,T);if(A!==void 0&&P!==void 0)return w(A,P,p)}}:w(y,b,p)}function Ad(s,e,r){return e.type==="color"?r=Ks.parse(r):e.type==="formatted"?r=Qr.fromString(r.toString()):e.type==="resolvedImage"?r=pi.fromString(r.toString()):ms(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Ca(r,s.default,e.default)}class jl{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new jc,this._defaultValue=r?function(a){return a.type==="color"&&(jo(a.default)||Array.isArray(a.default))?new Ks(0,0,0,0):a.type==="color"?Ks.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,l,h,p,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,l,h,p,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Pr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function ka(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in wo}function Aa(s,e){const r=new kc(wo,[],e?function(l){const h={color:oi,string:os,number:jt,enum:os,boolean:ss,formatted:ao,resolvedImage:Wn};return l.type==="array"?mi(h[l.value]||rs,l.length):h[l.type]}(e):void 0),a=r.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Ed(new jl(a,e)):Jn(r.errors)}class $c{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!cn(r.expression)}evaluateWithoutErrorHandling(e,r,a,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,h,p)}evaluate(e,r,a,l,h,p){return this._styleExpression.evaluate(e,r,a,l,h,p)}}class No{constructor(e,r,a,l){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!cn(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,a,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,h,p)}evaluate(e,r,a,l,h,p){return this._styleExpression.evaluate(e,r,a,l,h,p)}interpolationFactor(e,r,a){return this.interpolationType?Vi.interpolationFactor(this.interpolationType,e,r,a):0}}function So(s,e){if((s=Aa(s,e)).result==="error")return s;const r=s.value.expression,a=ja(r);if(!a&&!Ea(e))return Jn([new Bi("","data expressions not supported")]);const l=Kn(r,["zoom","pitch","distance-from-center"]);if(!l&&!_l(e))return Jn([new Bi("","zoom expressions not supported")]);const h=Sl(r);return h||l?h instanceof Bi?Jn([h]):h instanceof Vi&&!bl(e)?Jn([new Bi("",'"interpolate" expressions cannot be used with this property')]):Ed(h?new No(a?"camera":"composite",s.value,h.labels,h instanceof Vi?h.interpolation:void 0):new $c(a?"constant":"source",s.value)):Jn([new Bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Nl{constructor(e,r){this._parameters=e,this._specification=r,rn(this,vl(this._parameters,this._specification))}static deserialize(e){return new Nl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Sl(s){let e=null;if(s instanceof _d)e=Sl(s.result);else if(s instanceof Fc){for(const r of s.args)if(e=Sl(r),e)break}else(s instanceof Mc||s instanceof Vi)&&s.input instanceof on&&s.input.name==="zoom"&&(e=s);return e instanceof Bi||s.eachChild(r=>{const a=Sl(r);a instanceof Bi?e=a:!e&&a?e=new Bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Nt{constructor(e,r,a,l){this.message=(e?`${e}: `:"")+a,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ci(s){const e=s.key,r=s.value,a=s.valueSpec||{},l=s.objectElementValidators||{},h=s.style,p=s.styleSpec;let y=[];const b=ms(r);if(b!=="object")return[new Nt(e,r,`object expected, ${b} found`)];for(const w in r){const T=w.split(".")[0];let A;l[T]?A=l[T]:a[T]?A=Br:l["*"]?A=l["*"]:a["*"]&&(A=Br),A?y=y.concat(A({key:(e&&`${e}.`)+w,value:r[w],valueSpec:a[T]||a["*"],style:h,styleSpec:p,object:r,objectKey:w},r)):y.push(new Nt(e,r[w],`unknown property "${w}"`))}for(const w in a)l[w]||a[w].required&&a[w].default===void 0&&r[w]===void 0&&y.push(new Nt(e,r,`missing required property "${w}"`));return y}function Md(s){const e=s.value,r=s.valueSpec,a=s.style,l=s.styleSpec,h=s.key,p=s.arrayElementValidator||Br;if(ms(e)!=="array")return[new Nt(h,e,`array expected, ${ms(e)} found`)];if(r.length&&e.length!==r.length)return[new Nt(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Nt(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(y.function=r.function),ms(r.value)==="object"&&(y=r.value);let b=[];for(let w=0;w<e.length;w++)b=b.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:y,style:a,styleSpec:l,key:`${h}[${w}]`}));return b}function To(s){const e=s.key,r=s.value,a=s.valueSpec;let l=ms(r);if(l==="number"&&r!=r&&(l="NaN"),l!=="number")return[new Nt(e,r,`number expected, ${l} found`)];if("minimum"in a){let h=a.minimum;if(ms(a.minimum)==="array"&&(h=a.minimum[s.arrayIndex]),r<h)return[new Nt(e,r,`${r} is less than the minimum value ${h}`)]}if("maximum"in a){let h=a.maximum;if(ms(a.maximum)==="array"&&(h=a.maximum[s.arrayIndex]),r>h)return[new Nt(e,r,`${r} is greater than the maximum value ${h}`)]}return[]}function Eo(s){const e=s.valueSpec,r=ar(s.value.type);let a,l,h,p={};const y=r!=="categorical"&&s.value.property===void 0,b=!y,w=ms(s.value.stops)==="array"&&ms(s.value.stops[0])==="array"&&ms(s.value.stops[0][0])==="object",T=Ci({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new Nt(L.key,L.value,'identity function may not have a "stops" property')];let R=[];const B=L.value;return R=R.concat(Md({key:L.key,value:B,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:A})),ms(B)==="array"&&B.length===0&&R.push(new Nt(L.key,B,"array must have at least one stop")),R},default:function(L){return Br({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&y&&T.push(new Nt(s.key,s.value,'missing required property "property"')),r==="identity"||s.value.stops||T.push(new Nt(s.key,s.value,'missing required property "stops"')),r==="exponential"&&s.valueSpec.expression&&!bl(s.valueSpec)&&T.push(new Nt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(b&&!Ea(s.valueSpec)?T.push(new Nt(s.key,s.value,"property functions not supported")):y&&!_l(s.valueSpec)&&T.push(new Nt(s.key,s.value,"zoom functions not supported"))),r!=="categorical"&&!w||s.value.property!==void 0||T.push(new Nt(s.key,s.value,'"property" property is required')),T;function A(L){let R=[];const B=L.value,X=L.key;if(ms(B)!=="array")return[new Nt(X,B,`array expected, ${ms(B)} found`)];if(B.length!==2)return[new Nt(X,B,`array length 2 expected, length ${B.length} found`)];if(w){if(ms(B[0])!=="object")return[new Nt(X,B,`object expected, ${ms(B[0])} found`)];if(B[0].zoom===void 0)return[new Nt(X,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new Nt(X,B,"object stop key must have value")];const re=ar(B[0].zoom);if(typeof re!="number")return[new Nt(X,B[0].zoom,"stop zoom values must be numbers")];if(h&&h>re)return[new Nt(X,B[0].zoom,"stop zoom values must appear in ascending order")];re!==h&&(h=re,l=void 0,p={}),R=R.concat(Ci({key:`${X}[0]`,value:B[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:To,value:P}}))}else R=R.concat(P({key:`${X}[0]`,value:B[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},B));return ka(Nr(B[1]))?R.concat([new Nt(`${X}[1]`,B[1],"expressions are not allowed in function stops.")]):R.concat(Br({key:`${X}[1]`,value:B[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function P(L,R){const B=ms(L.value),X=ar(L.value),re=L.value!==null?L.value:R;if(a){if(B!==a)return[new Nt(L.key,re,`${B} stop domain type must match previous stop domain type ${a}`)]}else a=B;if(B!=="number"&&B!=="string"&&B!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new Nt(L.key,re,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&r!=="categorical"){let pe=`number expected, ${B} found`;return Ea(e)&&r===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(L.key,re,pe)]}return r!=="categorical"||B!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&B==="number"&&typeof X=="number"&&typeof l=="number"&&l!==void 0&&X<l?[new Nt(L.key,re,"stop domain values must appear in ascending order")]:(l=X,r==="categorical"&&X in p?[new Nt(L.key,re,"stop domain values must be unique")]:(p[X]=!0,[])):[new Nt(L.key,re,`integer expected, found ${String(X)}`)]}}function Sr(s){const e=(s.expressionContext==="property"?So:Aa)(Nr(s.value),s.valueSpec);if(e.result==="error")return e.value.map(a=>new Nt(`${s.key}${a.key}`,s.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!r.outputDefined())return[new Nt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!cn(r))return[new Nt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return Co(r,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Kn(r,["zoom","feature-state"]))return[new Nt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!ja(r))return[new Nt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Co(s,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)r.delete(l);if(r.size===0)return[];const a=[];return s instanceof on&&r.has(s.name)?[new Nt(e.key,e.value,`["${s.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(s.eachChild(l=>{a.push(...Co(l,e))}),a)}function Tl(s){const e=s.key,r=s.value,a=s.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(ar(r))===-1&&l.push(new Nt(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ar(r))===-1&&l.push(new Nt(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Gc(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Gc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function El(s,e="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gc(s)||(s=Pa(s));const r=s;let a=!0;try{a=function(w){if(!Ma(w))return w;let T=Nr(w);return Cl(T),T=Pd(T),T}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=Ze[`filter_${e}`],h=Aa(a,l);let p=null;if(h.result==="error")throw new Error(h.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,T,A)=>h.value.evaluate(w,T,{},A);let y=null,b=null;if(a!==r){const w=Aa(r,l);if(w.result==="error")throw new Error(w.value.map(T=>`${T.key}: ${T.message}`).join(", "));y=(T,A,P,L,R)=>w.value.evaluate(T,A,{},P,void 0,void 0,L,R),b=!ja(w.value.expression)}return{filter:p,dynamicFilter:y||void 0,needGeometry:Id(a),needFeature:!!b}}function Pd(s){if(!Array.isArray(s))return s;const e=function(r){if(Zc.has(r[0])){for(let a=1;a<r.length;a++)if(Ma(r[a]))return!0}return r}(s);return e===!0?e:e.map(r=>Pd(r))}function Cl(s){let e=!1;const r=[];if(s[0]==="case"){for(let a=1;a<s.length-1;a+=2)e=e||Ma(s[a]),r.push(s[a+1]);r.push(s[s.length-1])}else if(s[0]==="match"){e=e||Ma(s[1]);for(let a=2;a<s.length-1;a+=2)r.push(s[a+1]);r.push(s[s.length-1])}else if(s[0]==="step"){e=e||Ma(s[1]);for(let a=1;a<s.length-1;a+=2)r.push(s[a+1])}e&&(s.length=0,s.push("any",...r));for(let a=1;a<s.length;a++)Cl(s[a])}function Ma(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<s.length;r++)if(Ma(s[r]))return!0;return!1}const Zc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Im(s,e){return s<e?-1:s>e?1:0}function Id(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let e=1;e<s.length;e++)if(Id(s[e]))return!0;return!1}function Pa(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Wc(s[1],s[2],"=="):e==="!="?kl(Wc(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Wc(s[1],s[2],e):e==="any"?(r=s.slice(1),["any"].concat(r.map(Pa))):e==="all"?["all"].concat(s.slice(1).map(Pa)):e==="none"?["all"].concat(s.slice(1).map(Pa).map(kl)):e==="in"?Hc(s[1],s.slice(2)):e==="!in"?kl(Hc(s[1],s.slice(2))):e==="has"?Xc(s[1]):e==="!has"?kl(Xc(s[1])):e!=="within"||s;var r}function Wc(s,e,r){switch(s){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,s,e]}}function Hc(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",s,["literal",e.sort(Im)]]:["filter-in-small",s,["literal",e]]}}function Xc(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function kl(s){return["!",s]}function ko(s){return Gc(Nr(s.value))?Sr(rn({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Ao(s)}function Ao(s){const e=s.value,r=s.key;if(ms(e)!=="array")return[new Nt(r,e,`array expected, ${ms(e)} found`)];const a=s.styleSpec;let l,h=[];if(e.length<1)return[new Nt(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Tl({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:s.style,styleSpec:s.styleSpec})),ar(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ar(e[1])==="$type"&&h.push(new Nt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Nt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=ms(e[1]),l!=="string"&&h.push(new Nt(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=ms(e[p]),ar(e[1])==="$type"?h=h.concat(Tl({key:`${r}[${p}]`,value:e[p],valueSpec:a.geometry_type,style:s.style,styleSpec:s.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Nt(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Ao({key:`${r}[${p}]`,value:e[p],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":l=ms(e[1]),e.length!==2?h.push(new Nt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Nt(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=ms(e[1]),e.length!==2?h.push(new Nt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new Nt(`${r}[1]`,e[1],`object expected, ${l} found`))}return h}function Kc(s,e){const r=s.key,a=s.style,l=s.styleSpec,h=s.value,p=s.objectKey,y=l[`${e}_${s.layerType}`];if(!y)return[];const b=p.match(/^(.*)-transition$/);if(e==="paint"&&b&&y[b[1]]&&y[b[1]].transition)return Br({key:r,value:h,valueSpec:l.transition,style:a,styleSpec:l});const w=s.valueSpec||y[p];if(!w)return[new Nt(r,h,`unknown property "${p}"`)];let T;if(ms(h)==="string"&&Ea(w)&&!w.tokens&&(T=/^{([^}]+)}$/.exec(h))){const P=`\`{ "type": "identity", "property": ${T?JSON.stringify(T[1]):'"_"'} }\``;return[new Nt(r,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: ${P}.`)]}const A=[];return s.layerType==="symbol"&&(p==="text-field"&&a&&!a.glyphs&&A.push(new Nt(r,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&jo(Nr(h))&&ar(h.type)==="identity"&&A.push(new Nt(r,h,'"text-font" does not support identity functions'))),A.concat(Br({key:s.key,value:h,valueSpec:w,style:a,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function Dd(s){return Kc(s,"paint")}function Qc(s){return Kc(s,"layout")}function Ld(s){let e=[];const r=s.value,a=s.key,l=s.style,h=s.styleSpec;r.type||r.ref||e.push(new Nt(a,r,'either "type" or "ref" is required'));let p=ar(r.type);const y=ar(r.ref);if(r.id){const b=ar(r.id);for(let w=0;w<s.arrayIndex;w++){const T=l.layers[w];ar(T.id)===b&&e.push(new Nt(a,r.id,`duplicate layer id "${r.id}", previously used at line ${T.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&e.push(new Nt(a,r[w],`"${w}" is prohibited for ref layers`))}),l.layers.forEach(w=>{ar(w.id)===y&&(b=w)}),b?b.ref?e.push(new Nt(a,r.ref,"ref cannot reference another ref layer")):p=ar(b.type):typeof y=="string"&&e.push(new Nt(a,r.ref,`ref layer "${y}" not found`))}else if(p!=="background"&&p!=="sky")if(r.source){const b=l.sources&&l.sources[r.source],w=b&&ar(b.type);b?w==="vector"&&p==="raster"?e.push(new Nt(a,r.source,`layer "${r.id}" requires a raster source`)):w==="raster"&&p!=="raster"?e.push(new Nt(a,r.source,`layer "${r.id}" requires a vector source`)):w!=="vector"||r["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new Nt(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||w==="geojson"&&b.lineMetrics||e.push(new Nt(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Nt(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Nt(a,r.source,`source "${r.source}" not found`))}else e.push(new Nt(a,r,'missing required property "source"'));return e=e.concat(Ci({key:a,value:r,valueSpec:h.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Br({key:`${a}.type`,value:r.type,valueSpec:h.layer.type,style:s.style,styleSpec:s.styleSpec,object:r,objectKey:"type"}),filter:b=>ko(rn({layerType:p},b)),layout:b=>Ci({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Qc(rn({layerType:p},w))}}),paint:b=>Ci({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Dd(rn({layerType:p},w))}})}})),e}function An(s){const e=s.value,r=s.key,a=ms(e);return a!=="string"?[new Nt(r,e,`string expected, ${a} found`)]:[]}const Rd={promoteId:function({key:s,value:e}){if(ms(e)==="string")return An({key:s,value:e});{const r=[];for(const a in e)r.push(...An({key:`${s}.${a}`,value:e[a]}));return r}}};function zd(s){const e=s.value,r=s.key,a=s.styleSpec,l=s.style;if(!e.type)return[new Nt(r,e,'"type" is required')];const h=ar(e.type);let p;switch(h){case"vector":case"raster":case"raster-dem":return p=Ci({key:r,value:e,valueSpec:a[`source_${h.replace("-","_")}`],style:s.style,styleSpec:a,objectElementValidators:Rd}),p;case"geojson":if(p=Ci({key:r,value:e,valueSpec:a.source_geojson,style:l,styleSpec:a,objectElementValidators:Rd}),e.cluster)for(const y in e.clusterProperties){const[b,w]=e.clusterProperties[y],T=typeof b=="string"?[b,["accumulated"],["get",y]]:b;p.push(...Sr({key:`${r}.${y}.map`,value:w,expressionContext:"cluster-map"})),p.push(...Sr({key:`${r}.${y}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return p;case"video":return Ci({key:r,value:e,valueSpec:a.source_video,style:l,styleSpec:a});case"image":return Ci({key:r,value:e,valueSpec:a.source_image,style:l,styleSpec:a});case"canvas":return[new Nt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tl({key:`${r}.type`,value:e.type,valueSpec:{values:Dm(a)},style:l,styleSpec:a})}}function Dm(s){return s.source.reduce((e,r)=>{const a=s[r];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Od(s){const e=s.value,r=s.styleSpec,a=r.light,l=s.style;let h=[];const p=ms(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Nt("light",e,`object expected, ${p} found`)]),h;for(const y in e){const b=y.match(/^(.*)-transition$/);h=h.concat(b&&a[b[1]]&&a[b[1]].transition?Br({key:y,value:e[y],valueSpec:r.transition,style:l,styleSpec:r}):a[y]?Br({key:y,value:e[y],valueSpec:a[y],style:l,styleSpec:r}):[new Nt(y,e[y],`unknown property "${y}"`)])}return h}function Jc(s){const e=s.value,r=s.key,a=s.style,l=s.styleSpec,h=l.terrain;let p=[];const y=ms(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new Nt("terrain",e,`object expected, ${y} found`)]),p;for(const b in e){const w=b.match(/^(.*)-transition$/);p=p.concat(w&&h[w[1]]&&h[w[1]].transition?Br({key:b,value:e[b],valueSpec:l.transition,style:a,styleSpec:l}):h[b]?Br({key:b,value:e[b],valueSpec:h[b],style:a,styleSpec:l}):[new Nt(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],w=b&&ar(b.type);b?w!=="raster-dem"&&p.push(new Nt(r,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):p.push(new Nt(r,e.source,`source "${e.source}" not found`))}else p.push(new Nt(r,e,'terrain is missing required property "source"'));return p}function Fd(s){const e=s.value,r=s.style,a=s.styleSpec,l=a.fog;let h=[];const p=ms(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Nt("fog",e,`object expected, ${p} found`)]),h;for(const y in e){const b=y.match(/^(.*)-transition$/);h=h.concat(b&&l[b[1]]&&l[b[1]].transition?Br({key:y,value:e[y],valueSpec:a.transition,style:r,styleSpec:a}):l[y]?Br({key:y,value:e[y],valueSpec:l[y],style:r,styleSpec:a}):[new Nt(y,e[y],`unknown property "${y}"`)])}return h}const Bd={"*":()=>[],array:Md,boolean:function(s){const e=s.value,r=s.key,a=ms(e);return a!=="boolean"?[new Nt(r,e,`boolean expected, ${a} found`)]:[]},number:To,color:function(s){const e=s.key,r=s.value,a=ms(r);return a!=="string"?[new Nt(e,r,`color expected, ${a} found`)]:gc(r)===null?[new Nt(e,r,`color expected, "${r}" found`)]:[]},enum:Tl,filter:ko,function:Eo,layer:Ld,object:Ci,source:zd,light:Od,terrain:Jc,fog:Fd,string:An,formatted:function(s){return An(s).length===0?[]:Sr(s)},resolvedImage:function(s){return An(s).length===0?[]:Sr(s)},projection:function(s){const e=s.value,r=s.styleSpec,a=r.projection,l=s.style;let h=[];const p=ms(e);if(p==="object")for(const y in e)h=h.concat(Br({key:y,value:e[y],valueSpec:a[y],style:l,styleSpec:r}));else p!=="string"&&(h=h.concat([new Nt("projection",e,`object or string expected, ${p} found`)]));return h}};function Br(s){const e=s.value,r=s.valueSpec,a=s.styleSpec;return r.expression&&jo(ar(e))?Eo(s):r.expression&&ka(Nr(e))?Sr(s):r.type&&Bd[r.type]?Bd[r.type](s):Ci(rn({},s,{valueSpec:r.type?a[r.type]:r}))}function Lm(s){const e=s.value,r=s.key,a=An(s);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Nt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Nt(r,e,'"glyphs" url must include a "{range}" token'))),a}function Ud(s,e=Ze){return gi(Br({key:"",value:s,valueSpec:e.$root,styleSpec:e,style:s,objectElementValidators:{glyphs:Lm,"*":()=>[]}}))}const Rm=s=>gi(Dd(s)),zm=s=>gi(Qc(s));function gi(s){return s.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Vd(s,e){let r=!1;if(e&&e.length)for(const a of e)s.fire(new sn(new Error(a.message))),r=!0;return r}var Om=qi,ki=3;function qi(s,e,r){var a=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var l=new Int32Array(this.arrayBuffer);s=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var h=0;h<this.d*this.d;h++){var p=l[ki+h],y=l[ki+h+1];a.push(p===y?null:l.subarray(p,y))}var b=l[ki+a.length+1];this.keys=l.subarray(l[ki+a.length],b),this.bboxes=l.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=s,this.padding=r,this.scale=e/s,this.uid=0;var T=r/e*s;this.min=-T,this.max=s+T}qi.prototype.insert=function(s,e,r,a,l){this._forEachCell(e,r,a,l,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l)},qi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qi.prototype._insertCell=function(s,e,r,a,l,h){this.cells[l].push(h)},qi.prototype.query=function(s,e,r,a,l){var h=this.min,p=this.max;if(s<=h&&e<=h&&p<=r&&p<=a&&!l)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(s,e,r,a,this._queryCell,y,{},l),y},qi.prototype._queryCell=function(s,e,r,a,l,h,p,y){var b=this.cells[l];if(b!==null)for(var w=this.keys,T=this.bboxes,A=0;A<b.length;A++){var P=b[A];if(p[P]===void 0){var L=4*P;(y?y(T[L+0],T[L+1],T[L+2],T[L+3]):s<=T[L+2]&&e<=T[L+3]&&r>=T[L+0]&&a>=T[L+1])?(p[P]=!0,h.push(w[P])):p[P]=!1}}},qi.prototype._forEachCell=function(s,e,r,a,l,h,p,y){for(var b=this._convertToCellCoord(s),w=this._convertToCellCoord(e),T=this._convertToCellCoord(r),A=this._convertToCellCoord(a),P=b;P<=T;P++)for(var L=w;L<=A;L++){var R=this.d*L+P;if((!y||y(this._convertFromCellCoord(P),this._convertFromCellCoord(L),this._convertFromCellCoord(P+1),this._convertFromCellCoord(L+1)))&&l.call(this,s,e,r,a,R,h,p,y))return}},qi.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},qi.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},qi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,e=ki+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var h=e,p=0;p<s.length;p++){var y=s[p];l[ki+p]=h,l.set(y,h),h+=y.length}return l[ki+s.length]=h,l.set(this.keys,h),l[ki+s.length+1]=h+=this.keys.length,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer};var Yn=de(Om);const Al={};function St(s,e,r={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writeable:!1}),Al[e]={klass:s,omit:r.omit||[]}}St(Object,"Object"),Yn.serialize=function(s,e){const r=s.toArrayBuffer();return e&&e.push(r),{buffer:r}},Yn.deserialize=function(s){return new Yn(s.buffer)},Object.defineProperty(Yn,"name",{value:"Grid"}),St(Yn,"Grid"),St(Ks,"Color"),St(Error,"Error"),St(Ri,"AJAXError"),St(pi,"ResolvedImage"),St(Nl,"StylePropertyFunction"),St(jl,"StyleExpression",{omit:["_evaluator"]}),St(No,"ZoomDependentExpression"),St($c,"ZoomConstantExpression"),St(on,"CompoundExpression",{omit:["_evaluate"]});for(const s in wo)Al[wo[s]._classRegistryKey]||St(wo[s],`Expression${s}`);function Yc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function eu(s){return M.ImageBitmap&&s instanceof M.ImageBitmap}function Ia(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Yc(s)||eu(s))return e&&e.push(s),s;if(ArrayBuffer.isView(s)){const r=s;return e&&e.push(r.buffer),r}if(s instanceof M.ImageData)return e&&e.push(s.data.buffer),s;if(Array.isArray(s)){const r=[];for(const a of s)r.push(Ia(a,e));return r}if(typeof s=="object"){const r=s.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const l=r.serialize?r.serialize(s,e):{};if(!r.serialize){for(const h in s)s.hasOwnProperty(h)&&(Al[a].omit.indexOf(h)>=0||(l[h]=Ia(s[h],e)));s instanceof Error&&(l.message=s.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(l.$name=a),l}throw new Error("can't serialize object of type "+typeof s)}function ea(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Yc(s)||eu(s)||ArrayBuffer.isView(s)||s instanceof M.ImageData)return s;if(Array.isArray(s))return s.map(ea);if(typeof s=="object"){const e=s.$name||"Object",{klass:r}=Al[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(s);const a=Object.create(r.prototype);for(const l of Object.keys(s))l!=="$name"&&(a[l]=ea(s[l]));return a}throw new Error("can't deserialize object of type "+typeof s)}const vt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function tu(s){for(const e of s)if(su(e.charCodeAt(0)))return!0;return!1}function Fm(s){for(const e of s)if(!qd(e.charCodeAt(0)))return!1;return!0}function qd(s){return!(vt.Arabic(s)||vt["Arabic Supplement"](s)||vt["Arabic Extended-A"](s)||vt["Arabic Presentation Forms-A"](s)||vt["Arabic Presentation Forms-B"](s))}function su(s){return!(s!==746&&s!==747&&(s<4352||!(vt["Bopomofo Extended"](s)||vt.Bopomofo(s)||vt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||vt["CJK Compatibility Ideographs"](s)||vt["CJK Compatibility"](s)||vt["CJK Radicals Supplement"](s)||vt["CJK Strokes"](s)||!(!vt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||vt["CJK Unified Ideographs Extension A"](s)||vt["CJK Unified Ideographs"](s)||vt["Enclosed CJK Letters and Months"](s)||vt["Hangul Compatibility Jamo"](s)||vt["Hangul Jamo Extended-A"](s)||vt["Hangul Jamo Extended-B"](s)||vt["Hangul Jamo"](s)||vt["Hangul Syllables"](s)||vt.Hiragana(s)||vt["Ideographic Description Characters"](s)||vt.Kanbun(s)||vt["Kangxi Radicals"](s)||vt["Katakana Phonetic Extensions"](s)||vt.Katakana(s)&&s!==12540||!(!vt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!vt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||vt["Unified Canadian Aboriginal Syllabics"](s)||vt["Unified Canadian Aboriginal Syllabics Extended"](s)||vt["Vertical Forms"](s)||vt["Yijing Hexagram Symbols"](s)||vt["Yi Syllables"](s)||vt["Yi Radicals"](s))))}function $d(s){return!(su(s)||function(e){return!!(vt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||vt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||vt["Letterlike Symbols"](e)||vt["Number Forms"](e)||vt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||vt["Control Pictures"](e)&&e!==9251||vt["Optical Character Recognition"](e)||vt["Enclosed Alphanumerics"](e)||vt["Geometric Shapes"](e)||vt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||vt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vt["CJK Symbols and Punctuation"](e)||vt.Katakana(e)||vt["Private Use Area"](e)||vt["CJK Compatibility Forms"](e)||vt["Small Form Variants"](e)||vt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Gd(s){return s>=1424&&s<=2303||vt["Arabic Presentation Forms-A"](s)||vt["Arabic Presentation Forms-B"](s)}function Bm(s,e){return!(!e&&Gd(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||vt.Khmer(s))}function Um(s){for(const e of s)if(Gd(e.charCodeAt(0)))return!0;return!1}const ru="deferred",iu="loading",nu="loaded";let Da=null,u="unavailable",i=null;const o=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(u="error"),Da&&Da(s)};function m(){f.fire(new Zn("pluginStateChange",{pluginStatus:u,pluginURL:i}))}const f=new no,_=function(){return u},j=function(){if(u!==ru||!i)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");u=iu,m(),i&&en({url:i},s=>{s?o(s):(u=nu,m())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>u===nu||S.applyArabicShaping!=null,isLoading:()=>u===iu,setState(s){u=s.pluginStatus,i=s.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>i};class C{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,a){for(const l of r)if(!Bm(l.charCodeAt(0),a))return!1;return!0}(e,S.isLoaded())}}class D{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,l){if(jo(a))return new Nl(a,l);if(ka(a)){const h=So(a,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=a;return typeof a=="string"&&l.type==="color"&&(h=Ks.parse(a)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class I{constructor(e){this.property=e,this.value=new D(e,void 0)}transitioned(e,r){return new W(this.property,this.value,r,bs({},e.transition,this.transition),e.now)}untransitioned(){return new W(this.property,this.value,null,{},0)}}class O{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return rr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].value=new D(this._values[e].property,r===null?void 0:rr(r))}getTransition(e){return rr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].transition=rr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const a=new Q(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(e,r._values[l]);return a}untransitioned(){const e=new Q(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class W{constructor(e,r,a,l,h){const p=l.delay||0,y=l.duration||0;h=h||0,this.property=e,this.value=r,this.begin=h+p,this.end=this.begin+y,e.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const l=e.now||0,h=this.value.possiblyEvaluate(e,r,a),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,r,a);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,a),h,tt(y))}}return h}}class Q{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const l=new te(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,a);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return rr(this._values[e].value)}setValue(e,r){this._values[e]=new D(this._values[e].property,r===null?void 0:rr(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const l=new te(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,a);return l}}class J{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,l){return this.property.evaluate(this.value,this.parameters,e,r,a,l)}}class te{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class F{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const l=xo[this.specification.type];return l?l(e,r,a):e}}class K{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,l){return new J(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,l)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new J(this,{kind:"constant",value:void 0},e.parameters);const l=xo[this.specification.type];return l?new J(this,{kind:"constant",value:l(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,l,h,p){return e.kind==="constant"?e.value:e.evaluate(r,a,l,h,p)}}class ne{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,l){return!!e.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class ce{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new C(0,{});for(const a in e){const l=e[a];l.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new D(l,void 0),p=this.defaultTransitionablePropertyValues[a]=new I(l);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate(r)}}}function ve(s,e){return 256*(s=At(Math.floor(s),0,255))+At(Math.floor(e),0,255)}St(K,"DataDrivenProperty"),St(F,"DataConstantProperty"),St(ne,"ColorRampProperty");const je={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class we{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Me{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ae(s,e=1){let r=0,a=0;return{members:s.map(l=>{const h=je[l.type].BYTES_PER_ELEMENT,p=r=Fe(r,Math.max(e,h)),y=l.components||1;return a=Math.max(a,h),r+=h*y,{name:l.name,type:l.type,components:y,offset:p}}),size:Fe(r,Math.max(a,e)),alignment:e}}function Fe(s,e){return Math.ceil(s/e)*e}class at extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=a,e}}at.prototype.bytesPerElement=4,St(at,"StructArrayLayout2i4");class Re extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=a,this.int16[h+2]=l,e}}Re.prototype.bytesPerElement=6,St(Re,"StructArrayLayout3i6");class Qe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=l,this.int16[p+3]=h,e}}Qe.prototype.bytesPerElement=8,St(Qe,"StructArrayLayout4i8");class Ve extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,l,h,p,y)}emplace(e,r,a,l,h,p,y,b){const w=6*e,T=12*e,A=3*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.uint8[T+4]=l,this.uint8[T+5]=h,this.uint8[T+6]=p,this.uint8[T+7]=y,this.float32[A+2]=b,e}}Ve.prototype.bytesPerElement=12,St(Ve,"StructArrayLayout2i4ub1f12");class nt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=l,this.float32[p+3]=h,e}}nt.prototype.bytesPerElement=16,St(nt,"StructArrayLayout4f16");class Oe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=6*e,b=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=a,this.uint16[y+2]=l,this.uint16[y+3]=h,this.float32[b+2]=p,e}}Oe.prototype.bytesPerElement=12,St(Oe,"StructArrayLayout4ui1f12");class Xe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=l,this.uint16[p+3]=h,e}}Xe.prototype.bytesPerElement=8,St(Xe,"StructArrayLayout4ui8");class lt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,l,h,p)}emplace(e,r,a,l,h,p,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+3]=h,this.int16[b+4]=p,this.int16[b+5]=y,e}}lt.prototype.bytesPerElement=12,St(lt,"StructArrayLayout6i12");class st extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,w,T,A,P){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,l,h,p,y,b,w,T,A,P)}emplace(e,r,a,l,h,p,y,b,w,T,A,P,L){const R=12*e;return this.int16[R+0]=r,this.int16[R+1]=a,this.int16[R+2]=l,this.int16[R+3]=h,this.uint16[R+4]=p,this.uint16[R+5]=y,this.uint16[R+6]=b,this.uint16[R+7]=w,this.int16[R+8]=T,this.int16[R+9]=A,this.int16[R+10]=P,this.int16[R+11]=L,e}}st.prototype.bytesPerElement=24,St(st,"StructArrayLayout4i4ui4i24");class ct extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,l,h,p)}emplace(e,r,a,l,h,p,y){const b=10*e,w=5*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=l,this.float32[w+2]=h,this.float32[w+3]=p,this.float32[w+4]=y,e}}ct.prototype.bytesPerElement=20,St(ct,"StructArrayLayout3i3f20");class Dt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Dt.prototype.bytesPerElement=4,St(Dt,"StructArrayLayout1ul4");class qt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,w,T,A,P,L){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,a,l,h,p,y,b,w,T,A,P,L)}emplace(e,r,a,l,h,p,y,b,w,T,A,P,L,R){const B=20*e,X=10*e;return this.int16[B+0]=r,this.int16[B+1]=a,this.int16[B+2]=l,this.int16[B+3]=h,this.int16[B+4]=p,this.float32[X+3]=y,this.float32[X+4]=b,this.float32[X+5]=w,this.float32[X+6]=T,this.int16[B+14]=A,this.uint32[X+8]=P,this.uint16[B+18]=L,this.uint16[B+19]=R,e}}qt.prototype.bytesPerElement=40,St(qt,"StructArrayLayout5i4f1i1ul2ui40");class Et extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,l,h,p,y)}emplace(e,r,a,l,h,p,y,b){const w=8*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=l,this.int16[w+4]=h,this.int16[w+5]=p,this.int16[w+6]=y,this.int16[w+7]=b,e}}Et.prototype.bytesPerElement=16,St(Et,"StructArrayLayout3i2i2i16");class Ft extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=l,this.int16[b+6]=h,this.int16[b+7]=p,e}}Ft.prototype.bytesPerElement=16,St(Ft,"StructArrayLayout2f1f2i16");class is extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=12*e,y=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=a,this.float32[y+1]=l,this.float32[y+2]=h,e}}is.prototype.bytesPerElement=12,St(is,"StructArrayLayout2ub2f12");class es extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=a,this.float32[h+2]=l,e}}es.prototype.bytesPerElement=12,St(es,"StructArrayLayout3f12");class Pt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=a,this.uint16[h+2]=l,e}}Pt.prototype.bytesPerElement=6,St(Pt,"StructArrayLayout3ui6");class vs extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,w,T,A,P,L,R,B,X,re,pe,ie,he,ye){const xe=this.length;return this.resize(xe+1),this.emplace(xe,e,r,a,l,h,p,y,b,w,T,A,P,L,R,B,X,re,pe,ie,he,ye)}emplace(e,r,a,l,h,p,y,b,w,T,A,P,L,R,B,X,re,pe,ie,he,ye,xe){const Be=30*e,ze=15*e,We=60*e;return this.int16[Be+0]=r,this.int16[Be+1]=a,this.int16[Be+2]=l,this.float32[ze+2]=h,this.float32[ze+3]=p,this.uint16[Be+8]=y,this.uint16[Be+9]=b,this.uint32[ze+5]=w,this.uint32[ze+6]=T,this.uint32[ze+7]=A,this.uint16[Be+16]=P,this.uint16[Be+17]=L,this.uint16[Be+18]=R,this.float32[ze+10]=B,this.float32[ze+11]=X,this.uint8[We+48]=re,this.uint8[We+49]=pe,this.uint8[We+50]=ie,this.uint32[ze+13]=he,this.int16[Be+28]=ye,this.uint8[We+58]=xe,e}}vs.prototype.bytesPerElement=60,St(vs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ws extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,w,T,A,P,L,R,B,X,re,pe,ie,he,ye,xe,Be,ze,We,ot,qe,Je,Ye,rt){const dt=this.length;return this.resize(dt+1),this.emplace(dt,e,r,a,l,h,p,y,b,w,T,A,P,L,R,B,X,re,pe,ie,he,ye,xe,Be,ze,We,ot,qe,Je,Ye,rt)}emplace(e,r,a,l,h,p,y,b,w,T,A,P,L,R,B,X,re,pe,ie,he,ye,xe,Be,ze,We,ot,qe,Je,Ye,rt,dt){const Ge=38*e,yt=19*e;return this.int16[Ge+0]=r,this.int16[Ge+1]=a,this.int16[Ge+2]=l,this.float32[yt+2]=h,this.float32[yt+3]=p,this.int16[Ge+8]=y,this.int16[Ge+9]=b,this.int16[Ge+10]=w,this.int16[Ge+11]=T,this.int16[Ge+12]=A,this.int16[Ge+13]=P,this.uint16[Ge+14]=L,this.uint16[Ge+15]=R,this.uint16[Ge+16]=B,this.uint16[Ge+17]=X,this.uint16[Ge+18]=re,this.uint16[Ge+19]=pe,this.uint16[Ge+20]=ie,this.uint16[Ge+21]=he,this.uint16[Ge+22]=ye,this.uint16[Ge+23]=xe,this.uint16[Ge+24]=Be,this.uint16[Ge+25]=ze,this.uint16[Ge+26]=We,this.uint16[Ge+27]=ot,this.uint16[Ge+28]=qe,this.uint32[yt+15]=Je,this.float32[yt+16]=Ye,this.float32[yt+17]=rt,this.float32[yt+18]=dt,e}}ws.prototype.bytesPerElement=76,St(ws,"StructArrayLayout3i2f6i15ui1ul3f76");class js extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}js.prototype.bytesPerElement=4,St(js,"StructArrayLayout1f4");class Ns extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=l,this.float32[y+3]=h,this.float32[y+4]=p,e}}Ns.prototype.bytesPerElement=20,St(Ns,"StructArrayLayout5f20");class Ur extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=l,this.uint16[p+4]=h,e}}Ur.prototype.bytesPerElement=12,St(Ur,"StructArrayLayout1ul3ui12");class Tr extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=a,e}}Tr.prototype.bytesPerElement=4,St(Tr,"StructArrayLayout2ui4");class xi extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}xi.prototype.bytesPerElement=2,St(xi,"StructArrayLayout1ui2");class $i extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=a,e}}$i.prototype.bytesPerElement=8,St($i,"StructArrayLayout2f8");class Bs extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Bs.prototype.size=40;class Ss extends qt{get(e){return new Bs(this,e)}}St(Ss,"CollisionBoxArray");class gs extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}gs.prototype.size=60;class or extends vs{get(e){return new gs(this,e)}}St(or,"PlacedSymbolArray");class Zr extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Zr.prototype.size=76;class Os extends ws{get(e){return new Zr(this,e)}}St(Os,"SymbolInstanceArray");class Jr extends js{getoffsetX(e){return this.float32[1*e+0]}}St(Jr,"GlyphOffsetArray");class Ml extends at{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}St(Ml,"SymbolLineVertexArray");class ta extends we{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ta.prototype.size=12;class Mo extends Ur{get(e){return new ta(this,e)}}St(Mo,"FeatureIndexArray");class hn extends Tr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}St(hn,"FillExtrusionCentroidArray");const Mn=Ae([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),sa=Ae([{name:"a_dash",components:4,type:"Uint16"}]);var Pl={exports:{}},Po={exports:{}};Po.exports=function(s,e){var r,a,l,h,p,y,b,w;for(a=s.length-(r=3&s.length),l=e,p=3432918353,y=461845907,w=0;w<a;)b=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24,++w,l=27492+(65535&(h=5*(65535&(l=(l^=b=(65535&(b=(b=(65535&b)*p+(((b>>>16)*p&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&s.charCodeAt(w+2))<<16;case 2:b^=(255&s.charCodeAt(w+1))<<8;case 1:l^=b=(65535&(b=(b=(65535&(b^=255&s.charCodeAt(w)))*p+(((b>>>16)*p&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return l^=s.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var au=Po.exports,ng={exports:{}};ng.exports=function(s,e){for(var r,a=s.length,l=e^a,h=0;a>=4;)r=1540483477*(65535&(r=255&s.charCodeAt(h)|(255&s.charCodeAt(++h))<<8|(255&s.charCodeAt(++h))<<16|(255&s.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++h;switch(a){case 3:l^=(255&s.charCodeAt(h+2))<<16;case 2:l^=(255&s.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&s.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var ag=au,Ob=ng.exports;Pl.exports=ag,Pl.exports.murmur3=ag,Pl.exports.murmur2=Ob;var Vm=de(Pl.exports);class Zd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,l){this.ids.push(og(e)),this.positions.push(r,a,l)}getPositions(e){const r=og(e);let a=0,l=this.ids.length-1;for(;a<l;){const p=a+l>>1;this.ids[p]>=r?l=p:a=p+1}const h=[];for(;this.ids[a]===r;)h.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return h}static serialize(e,r){const a=new Float64Array(e.ids),l=new Uint32Array(e.positions);return qm(a,l,0,a.length-1),r&&r.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(e){const r=new Zd;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function og(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Vm(String(s))}function qm(s,e,r,a){for(;r<a;){const l=s[r+a>>1];let h=r-1,p=a+1;for(;;){do h++;while(s[h]<l);do p--;while(s[p]>l);if(h>=p)break;Wd(s,h,p),Wd(e,3*h,3*p),Wd(e,3*h+1,3*p+1),Wd(e,3*h+2,3*p+2)}p-r<a-p?(qm(s,e,r,p),r=p+1):(qm(s,e,p+1,a),a=p)}}function Wd(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}St(Zd,"FeaturePositionMap");class ra{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class Hd extends ra{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class lg extends ra{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class cg extends ra{constructor(e){super(e),this.current=Ks.transparent}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Fb=new Float32Array(16),Bb=new Float32Array(9),Ub=new Float32Array(4);function $m(s){return[ve(255*s.r,255*s.g),ve(255*s.b,255*s.a)]}class ou{constructor(e,r,a){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(e,r,a,l,h){r.set(e,h,l.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new cg(e):new Hd(e)}}class Il{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,l,h){const p=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;p&&r.set(e,h,p)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new lg(e):new Hd(e)}}class ia{constructor(e,r,a,l){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,a,l,h,p){const y=this.paintVertexArray.length,b=this.expression.evaluate(new C(0),r,{},h,l,p);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,a,l,h){const p=this.expression.evaluate({zoom:0},a,l,void 0,h);this._setPaintValue(e,r,p)}_setPaintValue(e,r,a){if(this.type==="color"){const l=$m(a);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mn{constructor(e,r,a,l,h,p){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,a,l,h,p){const y=this.expression.evaluate(new C(this.zoom),r,{},h,l,p),b=this.expression.evaluate(new C(this.zoom+1),r,{},h,l,p),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,b)}updatePaintArray(e,r,a,l,h){const p=this.expression.evaluate({zoom:this.zoom},a,l,void 0,h),y=this.expression.evaluate({zoom:this.zoom+1},a,l,void 0,h);this._setPaintValue(e,r,p,y)}_setPaintValue(e,r,a,l){if(this.type==="color"){const h=$m(a),p=$m(l);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,l,h){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=At(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(e,h,y)}getBinding(e,r){return new Hd(e)}}class La{constructor(e,r,a,l,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(a==="array"?sa:Mn).members;for(let p=0;p<r.length;++p);this.paintVertexArray=new l}populatePaintArray(e,r,a){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,l,h,p){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,r,a,l){if(!l||!a)return;const h=l[a];if(!h)return;const{tl:p,br:y,pixelRatio:b}=h;for(let w=e;w<r;w++)this.paintVertexArray.emplace(w,p[0],p[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ra{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!a(h))continue;const p=e.paint.get(h);if(!(p instanceof J&&Ea(p.property.specification)))continue;const y=qb(h,e.type),b=p.value,w=p.property.specification.type,T=!!p.property.useIntegerZoom,A=h==="line-dasharray"||h.endsWith("pattern"),P=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||P)if(b.kind==="source"||P||A){const L=ug(h,w,"source");this.binders[h]=A?new La(b,y,w,L,e.id):new ia(b,y,w,L),l.push(`/a_${h}`)}else{const L=ug(h,w,"composite");this.binders[h]=new mn(b,y,w,T,r,L),l.push(`/z_${h}`)}else this.binders[h]=A?new Il(b.value,y):new ou(b.value,y,w),l.push(`/u_${h}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof ia||r instanceof mn?r.maxValue:0}populatePaintArrays(e,r,a,l,h,p){for(const y in this.binders){const b=this.binders[y];(b instanceof ia||b instanceof mn||b instanceof La)&&b.populatePaintArray(e,r,a,l,h,p)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof Il&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,l,h,p){let y=!1;for(const b in e){const w=r.getPositions(b);for(const T of w){const A=a.feature(T.index);for(const P in this.binders){const L=this.binders[P];if((L instanceof ia||L instanceof mn||L instanceof La)&&L.expression.isStateDependent===!0){const R=l.paint.get(P);L.expression=R.value,L.updatePaintArray(T.start,T.end,A,e[b],h,p),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof ou||a instanceof Il)&&e.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof ia||a instanceof mn||a instanceof La)for(let l=0;l<a.paintVertexAttributes.length;l++)e.push(a.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof ou||a instanceof Il||a instanceof mn)for(const l of a.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof ou||l instanceof Il||l instanceof mn)for(const h of l.uniformNames)r.push({name:h,property:a,binding:l.getBinding(e,h)})}return r}setUniforms(e,r,a,l,h){for(const{name:p,property:y,binding:b}of a)this.binders[y].setUniform(e,b,h,l.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof ia||r instanceof mn||r instanceof La)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof ia||a instanceof mn||a instanceof La)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof ia||r instanceof mn||r instanceof La)&&r.destroy()}}}class Io{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ra(l,r,a);this.needsUpload=!1,this._featureMap=new Zd,this._bufferOffset=0}populatePaintArrays(e,r,a,l,h,p,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,l,h,p,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,l,h){for(const p of a)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,l,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Vb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function qb(s,e){return Vb[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const $b={"line-pattern":{source:Oe,composite:Oe},"fill-pattern":{source:Oe,composite:Oe},"fill-extrusion-pattern":{source:Oe,composite:Oe},"line-dasharray":{source:Xe,composite:Xe}},Gb={color:{source:$i,composite:nt},number:{source:js,composite:$i}};function ug(s,e,r){const a=$b[s];return a&&a[r]||Gb[e][r]}St(ou,"ConstantBinder"),St(Il,"PatternConstantBinder"),St(ia,"SourceExpressionBinder"),St(La,"PatternCompositeBinder"),St(mn,"CompositeExpressionBinder"),St(Ra,"ProgramConfiguration",{omit:["_buffers"]}),St(Io,"ProgramConfigurationSet");const dg="-transition";class pn extends no{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ee(r.layout)),r.paint)){this._transitionablePaint=new O(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new te(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(zm,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Si(e,dg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Rm,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(Si(e,dg))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.value.isDataDriven(),p=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,b=y.isDataDriven(),w=Si(e,"pattern")||e==="line-dasharray";return b||h||w||this._handleOverridablePaintPropertyUpdate(e,p,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ii(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,l,h={}){return(!h||h.validate!==!1)&&Vd(this,e.call(Ud,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:Ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof J&&Ea(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=El(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Zb=Ae([{name:"a_pos",components:2,type:"Int16"}],4),Wb=Ae([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class lr{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,l){let h=this.segments[this.segments.length-1];return e>lr.MAX_VERTEX_ARRAY_LENGTH&&Ms(`Max vertices per segment is ${lr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>lr.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,l){return new lr([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}lr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,St(lr,"SegmentVector");var zt=8192;class za{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ts?new Ts(e.lng,e.lat):Ts.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ts?new Ts(e.lng,e.lat):Ts.convert(e),this}extend(e){const r=this._sw,a=this._ne;let l,h;if(e instanceof Ts)l=e,h=e;else{if(!(e instanceof za))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(za.convert(e)):this.extend(Ts.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Ts.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return r||a?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new Ts(l.lng,l.lat),this._ne=new Ts(h.lng,h.lat)),this}getCenter(){return new Ts((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ts(this.getWest(),this.getNorth())}getSouthEast(){return new Ts(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=Ts.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return!e||e instanceof za?e:new za(e)}}var Xd=1e-6,yi=typeof Float32Array<"u"?Float32Array:Array;function hg(){var s=new yi(9);return yi!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function mg(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=e[6],T=e[7],A=e[8],P=r[0],L=r[1],R=r[2],B=r[3],X=r[4],re=r[5],pe=r[6],ie=r[7],he=r[8];return s[0]=P*a+L*p+R*w,s[1]=P*l+L*y+R*T,s[2]=P*h+L*b+R*A,s[3]=B*a+X*p+re*w,s[4]=B*l+X*y+re*T,s[5]=B*h+X*b+re*A,s[6]=pe*a+ie*p+he*w,s[7]=pe*l+ie*y+he*T,s[8]=pe*h+ie*b+he*A,s}function fn(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Gm(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=e[4],y=e[5],b=e[6],w=e[7],T=e[8],A=e[9],P=e[10],L=e[11],R=e[12],B=e[13],X=e[14],re=e[15],pe=r*y-a*p,ie=r*b-l*p,he=r*w-h*p,ye=a*b-l*y,xe=a*w-h*y,Be=l*w-h*b,ze=T*B-A*R,We=T*X-P*R,ot=T*re-L*R,qe=A*X-P*B,Je=A*re-L*B,Ye=P*re-L*X,rt=pe*Ye-ie*Je+he*qe+ye*ot-xe*We+Be*ze;return rt?(s[0]=(y*Ye-b*Je+w*qe)*(rt=1/rt),s[1]=(l*Je-a*Ye-h*qe)*rt,s[2]=(B*Be-X*xe+re*ye)*rt,s[3]=(P*xe-A*Be-L*ye)*rt,s[4]=(b*ot-p*Ye-w*We)*rt,s[5]=(r*Ye-l*ot+h*We)*rt,s[6]=(X*he-R*Be-re*ie)*rt,s[7]=(T*Be-P*he+L*ie)*rt,s[8]=(p*Je-y*ot+w*ze)*rt,s[9]=(a*ot-r*Je-h*ze)*rt,s[10]=(R*xe-B*he+re*pe)*rt,s[11]=(A*he-T*xe-L*pe)*rt,s[12]=(y*We-p*qe-b*ze)*rt,s[13]=(r*qe-a*We+l*ze)*rt,s[14]=(B*ie-R*ye-X*pe)*rt,s[15]=(T*ye-A*ie+P*pe)*rt,s):null}function Do(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=e[6],T=e[7],A=e[8],P=e[9],L=e[10],R=e[11],B=e[12],X=e[13],re=e[14],pe=e[15],ie=r[0],he=r[1],ye=r[2],xe=r[3];return s[0]=ie*a+he*y+ye*A+xe*B,s[1]=ie*l+he*b+ye*P+xe*X,s[2]=ie*h+he*w+ye*L+xe*re,s[3]=ie*p+he*T+ye*R+xe*pe,s[4]=(ie=r[4])*a+(he=r[5])*y+(ye=r[6])*A+(xe=r[7])*B,s[5]=ie*l+he*b+ye*P+xe*X,s[6]=ie*h+he*w+ye*L+xe*re,s[7]=ie*p+he*T+ye*R+xe*pe,s[8]=(ie=r[8])*a+(he=r[9])*y+(ye=r[10])*A+(xe=r[11])*B,s[9]=ie*l+he*b+ye*P+xe*X,s[10]=ie*h+he*w+ye*L+xe*re,s[11]=ie*p+he*T+ye*R+xe*pe,s[12]=(ie=r[12])*a+(he=r[13])*y+(ye=r[14])*A+(xe=r[15])*B,s[13]=ie*l+he*b+ye*P+xe*X,s[14]=ie*h+he*w+ye*L+xe*re,s[15]=ie*p+he*T+ye*R+xe*pe,s}function lu(s,e,r){var a,l,h,p,y,b,w,T,A,P,L,R,B=r[0],X=r[1],re=r[2];return e===s?(s[12]=e[0]*B+e[4]*X+e[8]*re+e[12],s[13]=e[1]*B+e[5]*X+e[9]*re+e[13],s[14]=e[2]*B+e[6]*X+e[10]*re+e[14],s[15]=e[3]*B+e[7]*X+e[11]*re+e[15]):(l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=e[6],T=e[7],A=e[8],P=e[9],L=e[10],R=e[11],s[0]=a=e[0],s[1]=l,s[2]=h,s[3]=p,s[4]=y,s[5]=b,s[6]=w,s[7]=T,s[8]=A,s[9]=P,s[10]=L,s[11]=R,s[12]=a*B+y*X+A*re+e[12],s[13]=l*B+b*X+P*re+e[13],s[14]=h*B+w*X+L*re+e[14],s[15]=p*B+T*X+R*re+e[15]),s}function Lo(s,e,r){var a=r[0],l=r[1],h=r[2];return s[0]=e[0]*a,s[1]=e[1]*a,s[2]=e[2]*a,s[3]=e[3]*a,s[4]=e[4]*l,s[5]=e[5]*l,s[6]=e[6]*l,s[7]=e[7]*l,s[8]=e[8]*h,s[9]=e[9]*h,s[10]=e[10]*h,s[11]=e[11]*h,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function Zm(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[4],p=e[5],y=e[6],b=e[7],w=e[8],T=e[9],A=e[10],P=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=h*l+w*a,s[5]=p*l+T*a,s[6]=y*l+A*a,s[7]=b*l+P*a,s[8]=w*l-h*a,s[9]=T*l-p*a,s[10]=A*l-y*a,s[11]=P*l-b*a,s}function Kd(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],y=e[2],b=e[3],w=e[8],T=e[9],A=e[10],P=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=h*l-w*a,s[1]=p*l-T*a,s[2]=y*l-A*a,s[3]=b*l-P*a,s[8]=h*a+w*l,s[9]=p*a+T*l,s[10]=y*a+A*l,s[11]=b*a+P*l,s}function pg(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function fg(s,e,r){var a,l,h,p=r[0],y=r[1],b=r[2],w=Math.hypot(p,y,b);return w<Xd?null:(p*=w=1/w,y*=w,b*=w,a=Math.sin(e),l=Math.cos(e),s[0]=p*p*(h=1-l)+l,s[1]=y*p*h+b*a,s[2]=b*p*h-y*a,s[3]=0,s[4]=p*y*h-b*a,s[5]=y*y*h+l,s[6]=b*y*h+p*a,s[7]=0,s[8]=p*b*h+y*a,s[9]=y*b*h-p*a,s[10]=b*b*h+l,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});var Hb=Do;function Wm(){var s=new yi(3);return yi!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function gg(s){var e=new yi(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function cu(s){return Math.hypot(s[0],s[1],s[2])}function Dl(s,e,r){var a=new yi(3);return a[0]=s,a[1]=e,a[2]=r,a}function na(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s[2]=e[2]+r[2],s}function Hm(s,e,r){return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],s}function xg(s,e,r){return s[0]=e[0]*r[0],s[1]=e[1]*r[1],s[2]=e[2]*r[2],s}function uu(s,e,r){return s[0]=Math.min(e[0],r[0]),s[1]=Math.min(e[1],r[1]),s[2]=Math.min(e[2],r[2]),s}function du(s,e,r){return s[0]=Math.max(e[0],r[0]),s[1]=Math.max(e[1],r[1]),s[2]=Math.max(e[2],r[2]),s}function Ai(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s}function hu(s,e,r,a){return s[0]=e[0]+r[0]*a,s[1]=e[1]+r[1]*a,s[2]=e[2]+r[2]*a,s}function Yr(s,e){var r=e[0],a=e[1],l=e[2],h=r*r+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),s[0]=e[0]*h,s[1]=e[1]*h,s[2]=e[2]*h,s}function Gi(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Xm(s,e,r){var a=e[0],l=e[1],h=e[2],p=r[0],y=r[1],b=r[2];return s[0]=l*b-h*y,s[1]=h*p-a*b,s[2]=a*y-l*p,s}function Qs(s,e,r){var a=e[0],l=e[1],h=e[2],p=r[3]*a+r[7]*l+r[11]*h+r[15];return s[0]=(r[0]*a+r[4]*l+r[8]*h+r[12])/(p=p||1),s[1]=(r[1]*a+r[5]*l+r[9]*h+r[13])/p,s[2]=(r[2]*a+r[6]*l+r[10]*h+r[14])/p,s}function yg(s,e,r){var a=r[0],l=r[1],h=r[2],p=e[0],y=e[1],b=e[2],w=l*b-h*y,T=h*p-a*b,A=a*y-l*p,P=l*A-h*T,L=h*w-a*A,R=a*T-l*w,B=2*r[3];return T*=B,A*=B,L*=2,R*=2,s[0]=p+(w*=B)+(P*=2),s[1]=y+T+L,s[2]=b+A+R,s}var mu,gn=Hm,Xb=xg,Kb=cu;function _g(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s[3]=e[3]*r,s}function bg(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=r*r+a*a+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),s[0]=r*p,s[1]=a*p,s[2]=l*p,s[3]=h*p,s}function Ro(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3];return s[0]=r[0]*a+r[4]*l+r[8]*h+r[12]*p,s[1]=r[1]*a+r[5]*l+r[9]*h+r[13]*p,s[2]=r[2]*a+r[6]*l+r[10]*h+r[14]*p,s[3]=r[3]*a+r[7]*l+r[11]*h+r[15]*p,s}function vg(){var s=new yi(4);return yi!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function wg(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function jg(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b+p*y,s[1]=l*b+h*y,s[2]=h*b-l*y,s[3]=p*b-a*y,s}function Ng(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b-h*y,s[1]=l*b+p*y,s[2]=h*b+a*y,s[3]=p*b-l*y,s}Wm(),mu=new yi(4),yi!=Float32Array&&(mu[0]=0,mu[1]=0,mu[2]=0,mu[3]=0);var Qb=bg;Wm(),Dl(1,0,0),Dl(0,1,0),vg(),vg(),hg();const Jb=Ae([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Sg}=Jb,Tg=Ae([{name:"a_pos_3",components:3,type:"Int16"}]);var pu=Ae([{name:"a_pos",type:"Int16",components:2}]);class Km{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const l=Gi(r,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/l;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,r,a){if(function(L,R){var B=L[0],X=L[1],re=L[2],pe=R[0],ie=R[1],he=R[2];return Math.abs(B-pe)<=Xd*Math.max(1,Math.abs(B),Math.abs(pe))&&Math.abs(X-ie)<=Xd*Math.max(1,Math.abs(X),Math.abs(ie))&&Math.abs(re-he)<=Xd*Math.max(1,Math.abs(re),Math.abs(he))}(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[l,h,p]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],T=l*l+h*h+p*p,A=2*(y*l+b*h+w*p),P=A*A-4*T*(y*y+b*b+w*w-r*r);if(P<0){const L=Math.max(-A/2,0),R=y+l*L,B=b+h*L,X=w+p*L,re=Math.hypot(R,B,X);return a[0]=R*r/re,a[1]=B*r/re,a[2]=X*r/re,!1}{const L=(-A-Math.sqrt(P))/(2*T);if(L<0){const R=Math.hypot(y,b,w);return a[0]=y*r/R,a[1]=b*r/R,a[2]=w*r/R,!1}return a[0]=y+l*L,a[1]=b+h*L,a[2]=w+p*L,!0}}}class Qm{constructor(e,r,a,l,h){this.TL=e,this.TR=r,this.BR=a,this.BL=l,this.horizon=h}static fromInvProjectionMatrix(e,r,a){const l=[-1,1,1],h=[1,1,1],p=[1,-1,1],y=[-1,-1,1],b=Qs(l,l,e),w=Qs(h,h,e),T=Qs(p,p,e),A=Qs(y,y,e);return new Qm(b,w,T,A,r/a)}}class Jm{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a,l){const h=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const w=Ro([],b,e),T=1/w[3]/r*h;return function(A,P,L){return A[0]=P[0]*L[0],A[1]=P[1]*L[1],A[2]=P[2]*L[2],A[3]=P[3]*L[3],A}(w,w,[T,T,l?1/w[3]:T,T])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const w=Yr([],Xm([],gn([],p[b[0]],p[b[1]]),gn([],p[b[2]],p[b[1]]))),T=-Gi(w,p[b[1]]);return w.concat(T)});return new Jm(p,y)}}class ei{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const l of e)uu(r,r,l),du(a,a,l);return new ei(r,a)}static applyTransform(e,r){const a=e.getCorners();for(let l=0;l<a.length;++l)Qs(a[l],a[l],r);return ei.fromPoints(a)}constructor(e,r){this.min=e,this.max=r,this.center=Ai([],na([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=gg(this.min),l=gg(this.max);for(let h=0;h<r.length;h++)a[h]=r[h]?this.min[h]:this.center[h],l[h]=r[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new ei(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let a=!0;for(let l=0;l<e.planes.length;l++){const h=e.planes[l];let p=0;for(let y=0;y<r.length;y++)p+=Gi(h,r[y])+h[3]>=0;if(p===0)return 0;p!==r.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let h=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][l]-this.min[l];h=Math.min(h,b),p=Math.max(p,b)}if(p<0||h>this.max[l]-this.min[l])return 0}return 1}}const Ym=5,Eg=6,Pn=zt/Math.PI/2,Yb=16383,zo=64,fu=[zo,32,16],Zi=-Pn,Wi=Pn,ev=[new ei([Zi,Zi,Zi],[Wi,Wi,Wi]),new ei([Zi,Zi,Zi],[0,0,Wi]),new ei([0,Zi,Zi],[Wi,0,Wi]),new ei([Zi,0,Zi],[0,Wi,Wi]),new ei([0,0,Zi],[Wi,Wi,Wi])];function Qd(s){return s*Pn/yu}function Cg(s,e,r,a=!0){const l=Ai([],s._camera.position,s.worldSize),h=[e,r,1,1];Ro(h,h,s.pixelMatrixInverse),_g(h,h,1/h[3]);const p=Yr([],gn([],h,l)),y=s.globeMatrix,b=[y[12],y[13],y[14]],w=gn([],b,l),T=cu(w),A=Yr([],w),P=s.worldSize/(2*Math.PI),L=Gi(A,p),R=Math.asin(P/T);if(R<Math.acos(L)){if(!a)return null;const ot=[],qe=[];Ai(ot,p,T/L),Yr(qe,gn(qe,ot,w)),Yr(p,na(p,w,Ai(p,qe,Math.tan(R)*T)))}const B=[];new Km(l,p).closestPointOnSphere(b,P,B);const X=Yr([],pt(y,0)),re=Yr([],pt(y,1)),pe=Yr([],pt(y,2)),ie=Gi(X,B),he=Gi(re,B),ye=Gi(pe,B),xe=it(Math.asin(-he/P));let Be=it(Math.atan2(ie,ye));Be=s.center.lng+function(ot,qe){const Je=(qe-ot+180)%360-180;return Je<-180?Je+360:Je}(s.center.lng,Be);const ze=Dn(Be),We=At(Ln(xe),0,1);return new Ol(ze,We)}class tv{constructor(e,r,a){this.a=gn([],e,a),this.b=gn([],r,a),this.center=a;const l=Yr([],this.a),h=Yr([],this.b);this.angle=Math.acos(Gi(l,h))}}function ep(s,e){if(s.angle===0)return null;let r;return r=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),r<0||r>1?null:function(a,l,h,p){const y=Math.sin(h);return a*(Math.sin((1-p)*h)/y)+l*(Math.sin(p*h)/y)}(s.a[e],s.b[e],s.angle,At(r,0,1))+s.center[e]}function In(s){if(s.z<=1)return ev[s.z+2*s.y+s.x];const e=tp(Jd(s));return ei.fromPoints(e)}function Oo(s,e,r){return Ai(s,s,1-r),hu(s,s,e,r)}function kg(s,e){const r=zl(e.zoom);if(r===0)return In(s);const a=Jd(s),l=tp(a),h=Dn(a.getWest())*e.worldSize,p=Dn(a.getEast())*e.worldSize,y=Ln(a.getNorth())*e.worldSize,b=Ln(a.getSouth())*e.worldSize,w=[h,y,0],T=[p,y,0],A=[h,b,0],P=[p,b,0],L=Gm([],e.globeMatrix);return Qs(w,w,L),Qs(T,T,L),Qs(A,A,L),Qs(P,P,L),l[0]=Oo(l[0],A,r),l[1]=Oo(l[1],P,r),l[2]=Oo(l[2],T,r),l[3]=Oo(l[3],w,r),ei.fromPoints(l)}function Ag(s,e,r){for(const a of s)Qs(a,a,e),Ai(a,a,r)}function sv(s,e,r){const a=e/s.worldSize,l=s.globeMatrix;if(r.z<=1){const ze=In(r).getCorners();return Ag(ze,l,a),ei.fromPoints(ze)}const h=Jd(r),p=tp(h);Ag(p,l,a);const y=Number.MAX_VALUE,b=[-y,-y,-y],w=[y,y,y];if(h.contains(s.center)){for(const ot of p)uu(w,w,ot),du(b,b,ot);b[2]=0;const ze=s.point,We=[ze.x*a,ze.y*a,0];return uu(w,w,We),du(b,b,We),new ei(w,b)}const T=[l[12]*a,l[13]*a,l[14]*a],A=h.getCenter(),P=At(s.center.lat,-qr,qr),L=At(A.lat,-qr,qr),R=Dn(s.center.lng),B=Ln(P);let X=R-Dn(A.lng);const re=B-Ln(L);X>.5?X-=1:X<-.5&&(X+=1);let pe=0;Math.abs(X)>Math.abs(re)?pe=X>=0?1:3:(pe=re>=0?0:2,hu(T,T,[l[4]*a,l[5]*a,l[6]*a],-Math.sin(Ne(re>=0?h.getSouth():h.getNorth()))*Pn));const ie=p[pe],he=p[(pe+1)%4],ye=new tv(ie,he,T),xe=[ep(ye,0)||ie[0],ep(ye,1)||ie[1],ep(ye,2)||ie[2]],Be=zl(s.zoom);if(Be>0){const ze=function({x:ot,y:qe,z:Je},Ye,rt,dt,Ge){const yt=1/(1<<Je);let Ct=ot*yt,_t=Ct+yt,$t=qe*yt,ht=$t+yt,Rt=0;const Gt=(Ct+_t)/2-dt;return Gt>.5?Rt=-1:Gt<-.5&&(Rt=1),Ct=((Ct+Rt)*Ye-(dt*=Ye))*rt+dt,_t=((_t+Rt)*Ye-dt)*rt+dt,$t=($t*Ye-(Ge*=Ye))*rt+Ge,ht=(ht*Ye-Ge)*rt+Ge,[[Ct,ht,0],[_t,ht,0],[_t,$t,0],[Ct,$t,0]]}(r,e,s._pixelsPerMercatorPixel,R,B);for(let ot=0;ot<p.length;ot++)Oo(p[ot],ze[ot],Be);const We=na([],ze[pe],ze[(pe+1)%4]);Ai(We,We,.5),Oo(xe,We,Be)}for(const ze of p)uu(w,w,ze),du(b,b,ze);return w[2]=Math.min(ie[2],he[2]),uu(w,w,xe),du(b,b,xe),new ei(w,b)}function Jd({x:s,y:e,z:r}){const a=1/(1<<r),l=new Ts(Mi(s*a),Vr((e+1)*a)),h=new Ts(Mi((s+1)*a),Vr(e*a));return new za(l,h)}function tp(s){const e=Ne(s.getNorth()),r=Ne(s.getSouth()),a=Math.cos(e),l=Math.cos(r),h=Math.sin(e),p=Math.sin(r),y=s.getWest(),b=s.getEast();return[Ll(l,p,y),Ll(l,p,b),Ll(a,h,b),Ll(a,h,y)]}function Ll(s,e,r,a=Pn){return r=Ne(r),[s*Math.sin(r)*a,-e*a,s*Math.cos(r)*a]}function Rl(s,e,r){return Ll(Math.cos(Ne(s)),Math.sin(Ne(s)),e,r)}function gu(s,e,r,a){const l=1<<r.z,h=(s/zt+r.x)/l;return Rl(Vr((e/zt+r.y)/l),Mi(h),a)}function Yd({min:s,max:e}){return Yb/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const Mg=new Float64Array(16);function xu(s){const e=Yd(s),r=pg(Mg,[e,e,e]);return lu(r,r,((a=[])[0]=-(l=s.min)[0],a[1]=-l[1],a[2]=-l[2],a));var a,l}function sp(s){const e=(a=s.min,(r=Mg)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r);var r,a;const l=1/Yd(s);return Lo(e,e,[l,l,l])}function Pg(s,e,r,a,l){const h=function(b){const w=zt/(2*Math.PI);return b/(2*Math.PI)/w}(r),p=[s,e,-r/(2*Math.PI)],y=fn(new Float64Array(16));return lu(y,y,p),Lo(y,y,[h,h,h]),Zm(y,y,Ne(-l)),Kd(y,y,Ne(-a)),y}function zl(s){return zs(Ym,Eg,s)}function Ig(s,e){const r=Rl(e.lat,e.lng),a=function(R){const B=Rl(R._center.lat,R._center.lng);let X=Xm([],Dl(0,1,0),B);const re=fg([],-R.angle,B);X=Qs(X,X,re),fg(re,-R._pitch,X);const pe=Yr([],B);return Ai(pe,pe,Qd(R.cameraToCenterDistance/R.pixelsPerMeter)),Qs(pe,pe,re),na([],B,pe)}(s);return p=(l=Hm([],a,r))[0],y=l[1],b=l[2],w=(h=r)[0],T=h[1],A=h[2],L=(P=Math.sqrt(p*p+y*y+b*b)*Math.sqrt(w*w+T*T+A*A))&&Gi(l,h)/P,Math.acos(Math.min(Math.max(L,-1),1));var l,h,p,y,b,w,T,A,P,L}function rp(s,e){return Ig(s,e)>Math.PI/2*1.01}const Dg=Ne(85),rv=Math.cos(Dg),iv=Math.sin(Dg),yu=63710088e-1,Lg=2*Math.PI*yu;class Oa{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oa(ts(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,l=e.lat*r,h=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return yu*Math.acos(Math.min(h,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new za(new Oa(this.lng-a,this.lat-r),new Oa(this.lng+a,this.lat+r))}toEcef(e){const r=Qd(e);return Rl(this.lat,this.lng,Pn+r)}static convert(e){if(e instanceof Oa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ts=Oa;function ip(s){return Lg*Math.cos(s*Math.PI/180)}function Dn(s){return(180+s)/360}function Ln(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function xn(s,e){return s/ip(e)}function Mi(s){return 360*s-180}function Vr(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Rg(s,e){return s*ip(Vr(e))}const qr=85.051129;function zg(s){return 1/Math.cos(s*Math.PI/180)}class Ol{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Ts.convert(e);return new Ol(Dn(a.lng),Ln(a.lat),xn(r,a.lat))}toLngLat(){return new Ts(Mi(this.x),Vr(this.y))}toAltitude(){return Rg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Lg*zg(Vr(this.y))}}function np(s,e,r,a,l,h,p,y,b){const w=(e+a)/2,T=(r+l)/2,A=new ke(w,T);y(A),function(P,L,R,B,X,re){const pe=R-X,ie=B-re;return Math.abs((B-L)*pe-(R-P)*ie)/Math.hypot(pe,ie)}(A.x,A.y,h.x,h.y,p.x,p.y)>=b?(np(s,e,r,w,T,h,A,y,b),np(s,w,T,a,l,A,p,y,b)):s.push(p)}function Og(s,e,r){let a=s[0],l=a.x,h=a.y;e(a);const p=[a];for(let y=1;y<s.length;y++){const b=s[y],{x:w,y:T}=b;e(b),np(p,l,h,w,T,a,b,e,r),l=w,h=T,a=b}return p}function ap(s,e,r,a){if(a(e,r)){const l=e.add(r)._mult(.5);ap(s,e,l,a),ap(s,l,r,a)}else s.push(r)}function nv(s,e){let r=s[0];const a=[r];for(let l=1;l<s.length;l++){const h=s[l];ap(a,r,h,e),r=h}return a}const op=Math.pow(2,14)-1,Fg=-op-1;function av(s,e){const r=Math.round(s.x*e),a=Math.round(s.y*e);return s.x=At(r,Fg,op),s.y=At(a,Fg,op),(r<s.x||r>s.x+1||a<s.y||a>s.y+1)&&Ms("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function aa(s,e,r){const a=s.loadGeometry(),l=s.extent,h=zt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:b,y:w,projection:T}=r,A=P=>{const L=Mi((e.x+P.x/l)/p),R=Vr((e.y+P.y/l)/p),B=T.project(L,R);P.x=(B.x*y-b)*l,P.y=(B.y*y-w)*l};for(let P=0;P<a.length;P++)if(s.type!==1)a[P]=Og(a[P],A,1);else{const L=[];for(const R of a[P])R.x<0||R.x>=l||R.y<0||R.y>=l||(A(R),L.push(R));a[P]=L}}for(const p of a)for(const y of p)av(y,h);return a}function Fo(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?aa(s):[]}}function eh(s,e,r,a,l){s.emplaceBack(2*e+(a+1)/2,2*r+(l+1)/2)}function th(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class lp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new at,this.indexArray=new Pt,this.segments=new lr,this.programConfigurations=new Io(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,l){const h=this.layers[0],p=[];let y=null;h.type==="circle"&&(y=h.layout.get("circle-sort-key"));for(const{feature:w,id:T,index:A,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,R=Fo(w,L);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),R,a))continue;const B=y?y.evaluate(R,{},a):void 0,X={id:T,properties:w.properties,type:w.type,sourceLayerIndex:P,index:A,geometry:L?R.geometry:aa(w,a,l),patterns:{},sortKey:B};p.push(X)}y&&p.sort((w,T)=>w.sortKey-T.sortKey);let b=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new lt,b=l.projection);for(const w of p){const{geometry:T,index:A,sourceLayerIndex:P}=w,L=e[A].feature;this.addFeature(w,T,A,r.availableImages,a,b),r.featureIndex.insert(L,T,A,P,this.index)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Wb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,l,h,p){for(const y of r)for(const b of y){const w=b.x,T=b.y;if(w<0||w>=zt||T<0||T>=zt)continue;if(p){const L=p.projectTilePoint(w,T,h),R=p.upVector(h,w,T),B=this.globeExtVertexArray;th(B,L,R),th(B,L,R),th(B,L,R),th(B,L,R)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=A.vertexLength;eh(this.layoutVertexArray,w,T,-1,-1),eh(this.layoutVertexArray,w,T,1,-1),eh(this.layoutVertexArray,w,T,1,1),eh(this.layoutVertexArray,w,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},l,h)}}function Bg(s,e){for(let r=0;r<s.length;r++)if(Bo(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(Bo(s,e[r]))return!0;return!!cp(s,e)}function ov(s,e,r){return!!Bo(s,e)||!!up(e,s,r)}function Ug(s,e){if(s.length===1)return qg(e,s[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let l=0;l<a.length;l++)if(Bo(s,a[l]))return!0}for(let r=0;r<s.length;r++)if(qg(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(cp(s,e[r]))return!0;return!1}function lv(s,e,r){if(s.length>1){if(cp(s,e))return!0;for(let a=0;a<e.length;a++)if(up(e[a],s,r))return!0}for(let a=0;a<s.length;a++)if(up(s[a],e,r))return!0;return!1}function cp(s,e){if(s.length===0||e.length===0)return!1;for(let r=0;r<s.length-1;r++){const a=s[r],l=s[r+1];for(let h=0;h<e.length-1;h++)if(cv(a,l,e[h],e[h+1]))return!0}return!1}function cv(s,e,r,a){return zr(s,r,a)!==zr(e,r,a)&&zr(s,e,r)!==zr(s,e,a)}function up(s,e,r){const a=r*r;if(e.length===1)return s.distSqr(e[0])<a;for(let l=1;l<e.length;l++)if(Vg(s,e[l-1],e[l])<a)return!0;return!1}function Vg(s,e,r){const a=e.distSqr(r);if(a===0)return s.distSqr(e);const l=((s.x-e.x)*(r.x-e.x)+(s.y-e.y)*(r.y-e.y))/a;return s.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function qg(s,e){let r,a,l,h=!1;for(let p=0;p<s.length;p++){r=s[p];for(let y=0,b=r.length-1;y<r.length;b=y++)a=r[y],l=r[b],a.y>e.y!=l.y>e.y&&e.x<(l.x-a.x)*(e.y-a.y)/(l.y-a.y)+a.x&&(h=!h)}return h}function Bo(s,e){let r=!1;for(let a=0,l=s.length-1;a<s.length;l=a++){const h=s[a],p=s[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(r=!r)}return r}function $g(s,e,r,a,l){for(const p of s)if(e<=p.x&&r<=p.y&&a>=p.x&&l>=p.y)return!0;const h=[new ke(e,r),new ke(e,l),new ke(a,l),new ke(a,r)];if(s.length>2){for(const p of h)if(Bo(s,p))return!0}for(let p=0;p<s.length-1;p++)if(uv(s[p],s[p+1],h))return!0;return!1}function uv(s,e,r){const a=r[0],l=r[2];if(s.x<a.x&&e.x<a.x||s.x>l.x&&e.x>l.x||s.y<a.y&&e.y<a.y||s.y>l.y&&e.y>l.y)return!1;const h=zr(s,e,r[0]);return h!==zr(s,e,r[1])||h!==zr(s,e,r[2])||h!==zr(s,e,r[3])}function Fl(s,e,r){const a=e.paint.get(s).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(s)}function sh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Gg(s,e,r,a,l){if(!e[0]&&!e[1])return s;const h=ke.convert(e)._mult(l);r==="viewport"&&h._rotate(-a);const p=[];for(let y=0;y<s.length;y++)p.push(s[y].sub(h));return p}function Zg(s,e,r,a){const l=ke.convert(s)._mult(a);return e==="viewport"&&l._rotate(-r),l}St(lp,"CircleBucket",{omit:["layers"]});const dv=new ce({"circle-sort-key":new K(Ze.layout_circle["circle-sort-key"])});var hv={paint:new ce({"circle-radius":new K(Ze.paint_circle["circle-radius"]),"circle-color":new K(Ze.paint_circle["circle-color"]),"circle-blur":new K(Ze.paint_circle["circle-blur"]),"circle-opacity":new K(Ze.paint_circle["circle-opacity"]),"circle-translate":new F(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new F(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new F(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new F(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new K(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new K(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new K(Ze.paint_circle["circle-stroke-opacity"])}),layout:dv};function Wg(s,e,r,a,l,h,p,y,b){if(h&&s.queryGeometry.isAboveHorizon)return!1;h&&(b*=s.pixelToTileUnitsFactor);const w=s.tileID.canonical,T=r.projection.upVectorScale(w,r.center.lat,r.worldSize).metersToTile;for(const A of e)for(const P of A){const L=P.add(y),R=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(L.x,L.y,!0):0,B=r.projection.projectTilePoint(L.x,L.y,w);if(R>0){const ie=r.projection.upVector(w,L.x,L.y);B.x+=ie[0]*T*R,B.y+=ie[1]*T*R,B.z+=ie[2]*T*R}const X=h?L:mv(B.x,B.y,B.z,a),re=h?s.tilespaceRays.map(ie=>fv(ie,R)):s.queryGeometry.screenGeometry,pe=Ro([],[B.x,B.y,B.z,1],a);if(!p&&h?b*=pe[3]/r.cameraToCenterDistance:p&&!h&&(b*=r.cameraToCenterDistance/pe[3]),h){const ie=Vr((P.y/zt+w.y)/(1<<w.z));b/=r.projection.pixelsPerMeter(ie,1)/xn(1,ie)}if(ov(re,X,b))return!0}return!1}function mv(s,e,r,a){const l=Ro([],[s,e,r,1],a);return new ke(l[0]/l[3],l[1]/l[3])}const Hg=Dl(0,0,0),pv=Dl(0,0,1);function fv(s,e){const r=Wm();return Hg[2]=e,s.intersectsPlane(Hg,pv,r),new ke(r[0],r[1])}class Xg extends lp{}function Kg(s,{width:e,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*a)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*a);return s.width=e,s.height=r,s.data=l,s}function Qg(s,e,r){const{width:a,height:l}=e;a===s.width&&l===s.height||(dp(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,a),height:Math.min(s.height,l)},r),s.width=a,s.height=l,s.data=e.data)}function dp(s,e,r,a,l,h){if(l.width===0||l.height===0)return e;if(l.width>s.width||l.height>s.height||r.x>s.width-l.width||r.y>s.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||a.x>e.width-l.width||a.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=s.data,y=e.data;for(let b=0;b<l.height;b++){const w=((r.y+b)*s.width+r.x)*h,T=((a.y+b)*e.width+a.x)*h;for(let A=0;A<l.width*h;A++)y[T+A]=p[w+A]}return e}St(Xg,"HeatmapBucket",{omit:["layers"]});class oa{constructor(e,r){Kg(this,e,1,r)}resize(e){Qg(this,new oa(e),1)}clone(){return new oa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,h){dp(e,r,a,l,h,1)}}class _i{constructor(e,r){Kg(this,e,4,r)}resize(e){Qg(this,new _i(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _i({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,h){dp(e,r,a,l,h,4)}}St(oa,"AlphaImage"),St(_i,"RGBAImage");var gv={paint:new ce({"heatmap-radius":new K(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new K(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new F(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ne(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new F(Ze.paint_heatmap["heatmap-opacity"])})};function hp(s){const e={},r=s.resolution||256,a=s.clips?s.clips.length:1,l=s.image||new _i({width:r,height:a}),h=(p,y,b)=>{e[s.evaluationKey]=b;const w=s.expression.evaluate(e);l.data[p+y+0]=Math.floor(255*w.r/w.a),l.data[p+y+1]=Math.floor(255*w.g/w.a),l.data[p+y+2]=Math.floor(255*w.b/w.a),l.data[p+y+3]=Math.floor(255*w.a)};if(s.clips)for(let p=0,y=0;p<a;++p,y+=4*r)for(let b=0,w=0;b<r;b++,w+=4){const T=b/(r-1),{start:A,end:P}=s.clips[p];h(y,w,A*(1-T)+P*T)}else for(let p=0,y=0;p<r;p++,y+=4)h(0,y,p/(r-1));return l}var xv={paint:new ce({"hillshade-illumination-direction":new F(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new F(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new F(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new F(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new F(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new F(Ze.paint_hillshade["hillshade-accent-color"])})};const yv=Ae([{name:"a_pos",components:2,type:"Int16"}],4),{members:_v}=yv;var mp={exports:{}};function rh(s,e,r){r=r||2;var a,l,h,p,y,b,w,T=e&&e.length,A=T?e[0]*r:s.length,P=Jg(s,0,A,r,!0),L=[];if(!P||P.next===P.prev)return L;if(T&&(P=function(B,X,re,pe){var ie,he,ye,xe=[];for(ie=0,he=X.length;ie<he;ie++)(ye=Jg(B,X[ie]*pe,ie<he-1?X[ie+1]*pe:B.length,pe,!1))===ye.next&&(ye.steiner=!0),xe.push(Ev(ye));for(xe.sort(Nv),ie=0;ie<xe.length;ie++)re=Sv(xe[ie],re);return re}(s,e,P,r)),s.length>80*r){a=h=s[0],l=p=s[1];for(var R=r;R<A;R+=r)(y=s[R])<a&&(a=y),(b=s[R+1])<l&&(l=b),y>h&&(h=y),b>p&&(p=b);w=(w=Math.max(h-a,p-l))!==0?32767/w:0}return _u(P,L,r,a,l,w,0),L}function Jg(s,e,r,a,l){var h,p;if(l===gp(s,e,r,a)>0)for(h=e;h<r;h+=a)p=tx(h,s[h],s[h+1],p);else for(h=r-a;h>=e;h-=a)p=tx(h,s[h],s[h+1],p);return p&&ih(p,p.next)&&(vu(p),p=p.next),p}function Uo(s,e){if(!s)return s;e||(e=s);var r,a=s;do if(r=!1,a.steiner||!ih(a,a.next)&&cr(a.prev,a,a.next)!==0)a=a.next;else{if(vu(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function _u(s,e,r,a,l,h,p){if(s){!p&&h&&function(T,A,P,L){var R=T;do R.z===0&&(R.z=pp(R.x,R.y,A,P,L)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==T);R.prevZ.nextZ=null,R.prevZ=null,function(B){var X,re,pe,ie,he,ye,xe,Be,ze=1;do{for(re=B,B=null,he=null,ye=0;re;){for(ye++,pe=re,xe=0,X=0;X<ze&&(xe++,pe=pe.nextZ);X++);for(Be=ze;xe>0||Be>0&&pe;)xe!==0&&(Be===0||!pe||re.z<=pe.z)?(ie=re,re=re.nextZ,xe--):(ie=pe,pe=pe.nextZ,Be--),he?he.nextZ=ie:B=ie,ie.prevZ=he,he=ie;re=pe}he.nextZ=null,ze*=2}while(ye>1)}(R)}(s,a,l,h);for(var y,b,w=s;s.prev!==s.next;)if(y=s.prev,b=s.next,h?vv(s,a,l,h):bv(s))e.push(y.i/r|0),e.push(s.i/r|0),e.push(b.i/r|0),vu(s),s=b.next,w=b.next;else if((s=b)===w){p?p===1?_u(s=wv(Uo(s),e,r),e,r,a,l,h,2):p===2&&jv(s,e,r,a,l,h):_u(Uo(s),e,r,a,l,h,1);break}}}function bv(s){var e=s.prev,r=s,a=s.next;if(cr(e,r,a)>=0)return!1;for(var l=e.x,h=r.x,p=a.x,y=e.y,b=r.y,w=a.y,T=l<h?l<p?l:p:h<p?h:p,A=y<b?y<w?y:w:b<w?b:w,P=l>h?l>p?l:p:h>p?h:p,L=y>b?y>w?y:w:b>w?b:w,R=a.next;R!==e;){if(R.x>=T&&R.x<=P&&R.y>=A&&R.y<=L&&Bl(l,y,h,b,p,w,R.x,R.y)&&cr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function vv(s,e,r,a){var l=s.prev,h=s,p=s.next;if(cr(l,h,p)>=0)return!1;for(var y=l.x,b=h.x,w=p.x,T=l.y,A=h.y,P=p.y,L=y<b?y<w?y:w:b<w?b:w,R=T<A?T<P?T:P:A<P?A:P,B=y>b?y>w?y:w:b>w?b:w,X=T>A?T>P?T:P:A>P?A:P,re=pp(L,R,e,r,a),pe=pp(B,X,e,r,a),ie=s.prevZ,he=s.nextZ;ie&&ie.z>=re&&he&&he.z<=pe;){if(ie.x>=L&&ie.x<=B&&ie.y>=R&&ie.y<=X&&ie!==l&&ie!==p&&Bl(y,T,b,A,w,P,ie.x,ie.y)&&cr(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,he.x>=L&&he.x<=B&&he.y>=R&&he.y<=X&&he!==l&&he!==p&&Bl(y,T,b,A,w,P,he.x,he.y)&&cr(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ie&&ie.z>=re;){if(ie.x>=L&&ie.x<=B&&ie.y>=R&&ie.y<=X&&ie!==l&&ie!==p&&Bl(y,T,b,A,w,P,ie.x,ie.y)&&cr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;he&&he.z<=pe;){if(he.x>=L&&he.x<=B&&he.y>=R&&he.y<=X&&he!==l&&he!==p&&Bl(y,T,b,A,w,P,he.x,he.y)&&cr(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function wv(s,e,r){var a=s;do{var l=a.prev,h=a.next.next;!ih(l,h)&&Yg(l,a,a.next,h)&&bu(l,h)&&bu(h,l)&&(e.push(l.i/r|0),e.push(a.i/r|0),e.push(h.i/r|0),vu(a),vu(a.next),a=s=h),a=a.next}while(a!==s);return Uo(a)}function jv(s,e,r,a,l,h){var p=s;do{for(var y=p.next.next;y!==p.prev;){if(p.i!==y.i&&Cv(p,y)){var b=ex(p,y);return p=Uo(p,p.next),b=Uo(b,b.next),_u(p,e,r,a,l,h,0),void _u(b,e,r,a,l,h,0)}y=y.next}p=p.next}while(p!==s)}function Nv(s,e){return s.x-e.x}function Sv(s,e){var r=function(l,h){var p,y=h,b=l.x,w=l.y,T=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var A=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(A<=b&&A>T&&(T=A,p=y.x<y.next.x?y:y.next,A===b))return p}y=y.next}while(y!==h);if(!p)return null;var P,L=p,R=p.x,B=p.y,X=1/0;y=p;do b>=y.x&&y.x>=R&&b!==y.x&&Bl(w<B?b:T,w,R,B,w<B?T:b,w,y.x,y.y)&&(P=Math.abs(w-y.y)/(b-y.x),bu(y,l)&&(P<X||P===X&&(y.x>p.x||y.x===p.x&&Tv(p,y)))&&(p=y,X=P)),y=y.next;while(y!==L);return p}(s,e);if(!r)return e;var a=ex(r,s);return Uo(a,a.next),Uo(r,r.next)}function Tv(s,e){return cr(s.prev,s,e.prev)<0&&cr(e.next,s,s.next)<0}function pp(s,e,r,a,l){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-r)*l|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ev(s){var e=s,r=s;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==s);return r}function Bl(s,e,r,a,l,h,p,y){return(l-p)*(e-y)>=(s-p)*(h-y)&&(s-p)*(a-y)>=(r-p)*(e-y)&&(r-p)*(h-y)>=(l-p)*(a-y)}function Cv(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(r,a){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&Yg(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(s,e)&&(bu(s,e)&&bu(e,s)&&function(r,a){var l=r,h=!1,p=(r.x+a.x)/2,y=(r.y+a.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&p<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(s,e)&&(cr(s.prev,s,e.prev)||cr(s,e.prev,e))||ih(s,e)&&cr(s.prev,s,s.next)>0&&cr(e.prev,e,e.next)>0)}function cr(s,e,r){return(e.y-s.y)*(r.x-e.x)-(e.x-s.x)*(r.y-e.y)}function ih(s,e){return s.x===e.x&&s.y===e.y}function Yg(s,e,r,a){var l=ah(cr(s,e,r)),h=ah(cr(s,e,a)),p=ah(cr(r,a,s)),y=ah(cr(r,a,e));return l!==h&&p!==y||!(l!==0||!nh(s,r,e))||!(h!==0||!nh(s,a,e))||!(p!==0||!nh(r,s,a))||!(y!==0||!nh(r,e,a))}function nh(s,e,r){return e.x<=Math.max(s.x,r.x)&&e.x>=Math.min(s.x,r.x)&&e.y<=Math.max(s.y,r.y)&&e.y>=Math.min(s.y,r.y)}function ah(s){return s>0?1:s<0?-1:0}function bu(s,e){return cr(s.prev,s,s.next)<0?cr(s,e,s.next)>=0&&cr(s,s.prev,e)>=0:cr(s,e,s.prev)<0||cr(s,s.next,e)<0}function ex(s,e){var r=new fp(s.i,s.x,s.y),a=new fp(e.i,e.x,e.y),l=s.next,h=e.prev;return s.next=e,e.prev=s,r.next=l,l.prev=r,a.next=r,r.prev=a,h.next=a,a.prev=h,a}function tx(s,e,r,a){var l=new fp(s,e,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function vu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function fp(s,e,r){this.i=s,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gp(s,e,r,a){for(var l=0,h=e,p=r-a;h<r;h+=a)l+=(s[p]-s[h])*(s[h+1]+s[p+1]),p=h;return l}mp.exports=rh,mp.exports.default=rh,rh.deviation=function(s,e,r,a){var l=e&&e.length,h=Math.abs(gp(s,0,l?e[0]*r:s.length,r));if(l)for(var p=0,y=e.length;p<y;p++)h-=Math.abs(gp(s,e[p]*r,p<y-1?e[p+1]*r:s.length,r));var b=0;for(p=0;p<a.length;p+=3){var w=a[p]*r,T=a[p+1]*r,A=a[p+2]*r;b+=Math.abs((s[w]-s[A])*(s[T+1]-s[w+1])-(s[w]-s[T])*(s[A+1]-s[w+1]))}return h===0&&b===0?0:Math.abs((b-h)/h)},rh.flatten=function(s){for(var e=s[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,l=0;l<s.length;l++){for(var h=0;h<s[l].length;h++)for(var p=0;p<e;p++)r.vertices.push(s[l][h][p]);l>0&&r.holes.push(a+=s[l-1].length)}return r};var xp=de(mp.exports);function kv(s,e,r,a,l){sx(s,e,r,a||s.length-1,l||Av)}function sx(s,e,r,a,l){for(;a>r;){if(a-r>600){var h=a-r+1,p=e-r+1,y=Math.log(h),b=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*b*(h-b)/h)*(p-h/2<0?-1:1);sx(s,e,Math.max(r,Math.floor(e-p*b/h+w)),Math.min(a,Math.floor(e+(h-p)*b/h+w)),l)}var T=s[e],A=r,P=a;for(wu(s,r,e),l(s[a],T)>0&&wu(s,r,a);A<P;){for(wu(s,A,P),A++,P--;l(s[A],T)<0;)A++;for(;l(s[P],T)>0;)P--}l(s[r],T)===0?wu(s,r,P):wu(s,++P,a),P<=e&&(r=P+1),e<=P&&(a=P-1)}}function wu(s,e,r){var a=s[e];s[e]=s[r],s[r]=a}function Av(s,e){return s<e?-1:s>e?1:0}function yp(s,e){const r=s.length;if(r<=1)return[s];const a=[];let l,h;for(let p=0;p<r;p++){const y=bt(s[p]);y!==0&&(s[p].area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(l&&a.push(l),l=[s[p]]):l.push(s[p]))}if(l&&a.push(l),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(kv(a[p],e,1,a[p].length-1,Mv),a[p]=a[p].slice(0,e));return a}function Mv(s,e){return e.area-s.area}function _p(s,e,r){const a=r.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${s}-pattern`);p.isConstant()||(l=!0);const y=p.constantOr(null);y&&(l=!0,a[y]=!0)}return l}function bp(s,e,r,a,l){const h=l.patternDependencies;for(const p of e){const y=p.paint.get(`${s}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:a},r,{},l.availableImages);b=b&&b.name?b.name:b,h[b]=!0,r.patterns[p.id]=b}}return r}class oh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new at,this.indexArray=new Pt,this.indexArray2=new Tr,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new lr,this.segments2=new lr,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,a,l){this.hasPattern=_p("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:b,index:w,sourceLayerIndex:T}of e){const A=this.layers[0]._featureFilter.needGeometry,P=Fo(y,A);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),P,a))continue;const L=h?h.evaluate(P,{},a,r.availableImages):void 0,R={id:b,properties:y.properties,type:y.type,sourceLayerIndex:T,index:w,geometry:A?P.geometry:aa(y,a,l),patterns:{},sortKey:L};p.push(R)}h&&p.sort((y,b)=>y.sortKey-b.sortKey);for(const y of p){const{geometry:b,index:w,sourceLayerIndex:T}=y;if(this.hasPattern){const A=bp("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(y,b,w,a,{},r.availableImages);r.featureIndex.insert(e[w].feature,b,w,T,this.index)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}addFeatures(e,r,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_v),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,l,h,p=[]){for(const y of yp(r,500)){let b=0;for(const R of y)b+=R.length;const w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),T=w.vertexLength,A=[],P=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&P.push(A.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),X=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(X+R.length-1,X),A.push(R[0].x),A.push(R[0].y);for(let re=1;re<R.length;re++)this.layoutVertexArray.emplaceBack(R[re].x,R[re].y),this.indexArray2.emplaceBack(X+re-1,X+re),A.push(R[re].x),A.push(R[re].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const L=xp(A,P);for(let R=0;R<L.length;R+=3)this.indexArray.emplaceBack(T+L[R],T+L[R+1],T+L[R+2]);w.vertexLength+=b,w.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}}St(oh,"FillBucket",{omit:["layers","patternFeatures"]});const Pv=new ce({"fill-sort-key":new K(Ze.layout_fill["fill-sort-key"])});var Iv={paint:new ce({"fill-antialias":new F(Ze.paint_fill["fill-antialias"]),"fill-opacity":new K(Ze.paint_fill["fill-opacity"]),"fill-color":new K(Ze.paint_fill["fill-color"]),"fill-outline-color":new K(Ze.paint_fill["fill-outline-color"]),"fill-translate":new F(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new F(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new K(Ze.paint_fill["fill-pattern"])}),layout:Pv};const Dv=Ae([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Lv=Ae([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Rv=Ae([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:zv}=Dv;var lh={},Ov=fe,rx=Ul;function Ul(s,e,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=s,this._geometry=-1,this._keys=a,this._values=l,s.readFields(Fv,this,e)}function Fv(s,e,r){s==1?e.id=r.readVarint():s==2?function(a,l){for(var h=a.readVarint()+a.pos;a.pos<h;){var p=l._keys[a.readVarint()],y=l._values[a.readVarint()];l.properties[p]=y}}(r,e):s==3?e.type=r.readVarint():s==4&&(e._geometry=r.pos)}function Bv(s){for(var e,r,a=0,l=0,h=s.length,p=h-1;l<h;p=l++)a+=((r=s[p]).x-(e=s[l]).x)*(e.y+r.y);return a}Ul.types=["Unknown","Point","LineString","Polygon"],Ul.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var e,r=s.readVarint()+s.pos,a=1,l=0,h=0,p=0,y=[];s.pos<r;){if(l<=0){var b=s.readVarint();a=7&b,l=b>>3}if(l--,a===1||a===2)h+=s.readSVarint(),p+=s.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new Ov(h,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Ul.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var e=s.readVarint()+s.pos,r=1,a=0,l=0,h=0,p=1/0,y=-1/0,b=1/0,w=-1/0;s.pos<e;){if(a<=0){var T=s.readVarint();r=7&T,a=T>>3}if(a--,r===1||r===2)(l+=s.readSVarint())<p&&(p=l),l>y&&(y=l),(h+=s.readSVarint())<b&&(b=h),h>w&&(w=h);else if(r!==7)throw new Error("unknown command "+r)}return[p,b,y,w]},Ul.prototype.toGeoJSON=function(s,e,r){var a,l,h=this.extent*Math.pow(2,r),p=this.extent*s,y=this.extent*e,b=this.loadGeometry(),w=Ul.types[this.type];function T(L){for(var R=0;R<L.length;R++){var B=L[R];L[R]=[360*(B.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(a=0;a<b.length;a++)A[a]=b[a][0];T(b=A);break;case 2:for(a=0;a<b.length;a++)T(b[a]);break;case 3:for(b=function(L){var R=L.length;if(R<=1)return[L];for(var B,X,re=[],pe=0;pe<R;pe++){var ie=Bv(L[pe]);ie!==0&&(X===void 0&&(X=ie<0),X===ie<0?(B&&re.push(B),B=[L[pe]]):B.push(L[pe]))}return B&&re.push(B),re}(b),a=0;a<b.length;a++)for(l=0;l<b[a].length;l++)T(b[a][l])}b.length===1?b=b[0]:w="Multi"+w;var P={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(P.id=this.id),P};var Uv=rx,ix=nx;function nx(s,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Vv,this,e),this.length=this._features.length}function Vv(s,e,r){s===15?e.version=r.readVarint():s===1?e.name=r.readString():s===5?e.extent=r.readVarint():s===2?e._features.push(r.pos):s===3?e._keys.push(r.readString()):s===4&&e._values.push(function(a){for(var l=null,h=a.readVarint()+a.pos;a.pos<h;){var p=a.readVarint()>>3;l=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return l}(r))}nx.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var e=this._pbf.readVarint()+this._pbf.pos;return new Uv(this._pbf,e,this.extent,this._keys,this._values)};var qv=ix;function $v(s,e,r){if(s===3){var a=new qv(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var vp=lh.VectorTile=function(s,e){this.layers=s.readFields($v,{},e)},ch=lh.VectorTileFeature=rx;function uh(s,e,r,a){const l=[],h=a===0?(p,y,b,w,T,A)=>{p.push(new ke(A,b+(A-y)/(w-y)*(T-b)))}:(p,y,b,w,T,A)=>{p.push(new ke(y+(A-b)/(T-b)*(w-y),A))};for(const p of s){const y=[];for(const b of p){if(b.length<=2)continue;const w=[];for(let P=0;P<b.length-1;P++){const L=b[P].x,R=b[P].y,B=b[P+1].x,X=b[P+1].y,re=a===0?L:R,pe=a===0?B:X;re<e?pe>e&&h(w,L,R,B,X,e):re>r?pe<r&&h(w,L,R,B,X,r):w.push(b[P]),pe<e&&re>=e&&h(w,L,R,B,X,e),pe>r&&re<=r&&h(w,L,R,B,X,r)}let T=b[b.length-1];const A=a===0?T.x:T.y;A>=e&&A<=r&&w.push(T),w.length&&(T=w[w.length-1],w[0].x===T.x&&w[0].y===T.y||w.push(w[0]),y.push(w))}y.length&&l.push(y)}return l}lh.VectorTileLayer=ix;const Gv=ch.types,Zv=Math.pow(2,13);function ju(s,e,r,a,l,h,p,y){s.emplaceBack((e<<1)+p,(r<<1)+h,(Math.floor(a*Zv)<<1)+l,Math.round(y))}function Nu(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class ax{constructor(){this.acc=new ke(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ke(e.x,e.y),this.max=new ke(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,l=this.max;e.x<a.x?a.x=e.x:e.x>l.x&&(l.x=e.x),e.y<a.y?a.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===zt)&&e.x===r.x)!=((e.y===0||e.y===zt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,ds(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>zt!=e.x>zt&&this.addBorderIntersection(1,ds(r.y,e.y,(zt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,ds(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>zt!=e.y>zt&&this.addBorderIntersection(3,ds(r.x,e.x,(zt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((r,a)=>r+a.edges,0);return e!==0?this.acc.div(e)._round():new ke(0,0)}span(){return new ke(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Su{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Qe,this.centroidVertexArray=new hn,this.indexArray=new Pt,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new lr,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,a,l){this.features=[],this.hasPattern=_p("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(h){const p=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*p/(p*p+1)/zt/(1<<h.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:h,id:p,index:y,sourceLayerIndex:b}of e){const w=this.layers[0]._featureFilter.needGeometry,T=Fo(h,w);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),T,a))continue;const A={id:p,sourceLayerIndex:b,index:y,geometry:w?T.geometry:aa(h,a,l),properties:h.properties,type:h.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(bp("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,y,a,{},r.availableImages,l),r.featureIndex.insert(h,A.geometry,y,b,this.index,P)}this.sortBorders()}addFeatures(e,r,a,l,h){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,r,a,l,h)}this.sortBorders()}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Rv.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Lv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,l,h,p,y){const b=[new ke(0,0),new ke(zt,zt)],w=y.projection,T=w.name==="globe",A=this.enableTerrain&&!T?new ax:null,P=Gv[e.type]==="Polygon";T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new lt);const L=yp(r,500);for(let re=L.length-1;re>=0;re--){const pe=L[re];(pe.length===0||(R=pe[0]).every(ie=>ie.x<=0)||R.every(ie=>ie.x>=zt)||R.every(ie=>ie.y<=0)||R.every(ie=>ie.y>=zt))&&L.splice(re,1)}var R;let B;if(T)B=mx(L,b,l);else{B=[];for(const re of L)B.push({polygon:re,bounds:b})}const X=P?this.edgeRadius:0;for(const{polygon:re,bounds:pe}of B){let ie=0,he=0;for(const xe of re)P&&!xe[0].equals(xe[xe.length-1])&&xe.push(xe[0]),he+=P?xe.length-1:xe.length;const ye=this.segments.prepareSegment((P?5:4)*he,this.layoutVertexArray,this.indexArray);if(P){const xe=[],Be=[];ie=ye.vertexLength;for(const We of re){let ot,qe;We.length&&We!==re[0]&&Be.push(xe.length/2),ot=We[1].sub(We[0])._perp()._unit();for(let Je=1;Je<We.length;Je++){const Ye=We[Je],rt=We[Je===We.length-1?1:Je+1];let{x:dt,y:Ge}=Ye;if(X){qe=rt.sub(Ye)._perp()._unit();const yt=ot.add(qe)._unit(),Ct=X*Math.min(4,1/(ot.x*yt.x+ot.y*yt.y));dt+=Ct*yt.x,Ge+=Ct*yt.y,ot=qe}ju(this.layoutVertexArray,dt,Ge,0,0,1,1,0),ye.vertexLength++,xe.push(Ye.x,Ye.y),T&&Nu(this.layoutVertexExtArray,w.projectTilePoint(dt,Ge,l),w.upVector(l,dt,Ge))}}const ze=xp(xe,Be);for(let We=0;We<ze.length;We+=3)this.indexArray.emplaceBack(ie+ze[We],ie+ze[We+2],ie+ze[We+1]),ye.primitiveLength++}for(const xe of re){A&&xe.length&&A.startRing(xe[0]);let Be,ze,We,ot=xe.length>4&&ux(xe[xe.length-2],xe[0],xe[1]),qe=X?Wv(xe[xe.length-2],xe[0],xe[1],X):0;ze=xe[1].sub(xe[0])._perp()._unit();let Je=!0;for(let Ye=1,rt=0;Ye<xe.length;Ye++){let dt=xe[Ye-1],Ge=xe[Ye];const yt=xe[Ye===xe.length-1?1:Ye+1];if(A&&P&&A.currentPolyCount.top++,cx(Ge,dt,pe)){X&&(ze=yt.sub(Ge)._perp()._unit(),Je=!Je);continue}A&&A.append(Ge,dt);const Ct=Ge.sub(dt)._perp(),_t=Ct.x/(Math.abs(Ct.x)+Math.abs(Ct.y)),$t=Ct.y>0?1:0,ht=dt.dist(Ge);if(rt+ht>32768&&(rt=0),X){We=yt.sub(Ge)._perp()._unit();let Zt=lx(dt,Ge,yt,ox(ze,We),X);isNaN(Zt)&&(Zt=0);const Bt=Ge.sub(dt)._unit();dt=dt.add(Bt.mult(qe))._round(),Ge=Ge.add(Bt.mult(-Zt))._round(),qe=Zt,ze=We}const Rt=ye.vertexLength,Gt=xe.length>4&&ux(dt,Ge,yt);let ps=dx(rt,ot,Je);if(ju(this.layoutVertexArray,dt.x,dt.y,_t,$t,0,0,ps),ju(this.layoutVertexArray,dt.x,dt.y,_t,$t,0,1,ps),rt+=ht,ps=dx(rt,Gt,!Je),ot=Gt,ju(this.layoutVertexArray,Ge.x,Ge.y,_t,$t,0,0,ps),ju(this.layoutVertexArray,Ge.x,Ge.y,_t,$t,0,1,ps),ye.vertexLength+=4,this.indexArray.emplaceBack(Rt+0,Rt+1,Rt+2),this.indexArray.emplaceBack(Rt+1,Rt+3,Rt+2),ye.primitiveLength+=2,X){const Zt=ie+(Ye===1?xe.length-2:Ye-2),Bt=Ye===1?ie:Zt+1;if(this.indexArray.emplaceBack(Rt+1,Zt,Rt+3),this.indexArray.emplaceBack(Zt,Bt,Rt+3),ye.primitiveLength+=2,Be===void 0&&(Be=Rt),!cx(yt,xe[Ye],pe)){const Rs=Ye===xe.length-1?Be:ye.vertexLength;this.indexArray.emplaceBack(Rt+2,Rt+3,Rs),this.indexArray.emplaceBack(Rt+3,Rs+1,Rs),this.indexArray.emplaceBack(Rt+3,Bt,Rs+1),ye.primitiveLength+=3}Je=!Je}if(T){const Zt=this.layoutVertexExtArray,Bt=w.projectTilePoint(dt.x,dt.y,l),Rs=w.projectTilePoint(Ge.x,Ge.y,l),Xt=w.upVector(l,dt.x,dt.y),Kt=w.upVector(l,Ge.x,Ge.y);Nu(Zt,Bt,Xt),Nu(Zt,Bt,Xt),Nu(Zt,Rs,Kt),Nu(Zt,Rs,Kt)}}P&&(ie+=xe.length-1)}}if(A&&A.polyCount.length>0){if(A.borders){A.vertexArrayOffset=this.centroidVertexArray.length;const re=A.borders,pe=this.featuresOnBorder.push(A)-1;for(let ie=0;ie<4;ie++)re[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(pe)}this.encodeCentroid(A.borders?void 0:A.centroid(),A)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,r,a=!0){let l,h;if(e)if(e.y!==0){const y=r.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else l=Math.ceil(7*(e.x+450)),h=0;else l=0,h=+a;let p=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(p++,l,h);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(p++,0,h),this.centroidVertexArray.emplace(p++,l,h)}}}function ox(s,e){const r=s.add(e)._unit();return s.x*r.x+s.y*r.y}function Wv(s,e,r,a){const l=e.sub(s)._perp()._unit(),h=r.sub(e)._perp()._unit();return lx(s,e,r,ox(l,h),a)}function lx(s,e,r,a,l){const h=Math.sqrt(1-a*a);return Math.min(s.dist(e)/3,e.dist(r)/3,l*h/a)}function cx(s,e,r){return s.x<r[0].x&&e.x<r[0].x||s.x>r[1].x&&e.x>r[1].x||s.y<r[0].y&&e.y<r[0].y||s.y>r[1].y&&e.y>r[1].y}function ux(s,e,r){if(s.x<0||s.x>=zt||e.x<0||e.x>=zt||r.x<0||r.x>=zt)return!1;const a=r.sub(e),l=a.perp(),h=s.sub(e);return(a.x*h.x+a.y*h.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(h.x*h.x+h.y*h.y))>-.866&&l.x*h.x+l.y*h.y<0}function dx(s,e,r){const a=e?2|s:-3&s;return r?1|a:-2&a}function hx(){const s=Math.PI/32,e=Math.tan(s),r=yu;return r*Math.sqrt(1+2*e*e)-r}function mx(s,e,r){const a=1<<r.z,l=Mi(r.x/a),h=Mi((r.x+1)/a),p=Vr(r.y/a),y=Vr((r.y+1)/a);return function(b,w,T,A,P=0,L){const R=[];if(!b.length||!T||!A)return R;const B=(xe,Be)=>{for(const ze of xe)R.push({polygon:ze,bounds:Be})},X=Math.ceil(Math.log2(T)),re=Math.ceil(Math.log2(A)),pe=X-re,ie=[];for(let xe=0;xe<Math.abs(pe);xe++)ie.push(pe>0?0:1);for(let xe=0;xe<Math.min(X,re);xe++)ie.push(0),ie.push(1);let he=b;if(he=uh(he,w[0].y-P,w[1].y+P,1),he=uh(he,w[0].x-P,w[1].x+P,0),!he.length)return R;const ye=[];for(ie.length?ye.push({polygons:he,bounds:w,depth:0}):B(he,w);ye.length;){const xe=ye.pop(),Be=xe.depth,ze=ie[Be],We=xe.bounds[0],ot=xe.bounds[1],qe=ze===0?We.x:We.y,Je=ze===0?ot.x:ot.y,Ye=L?L(ze,qe,Je):.5*(qe+Je),rt=uh(xe.polygons,qe-P,Ye+P,ze),dt=uh(xe.polygons,Ye-P,Je+P,ze);if(rt.length){const Ge=[We,new ke(ze===0?Ye:ot.x,ze===1?Ye:ot.y)];ie.length>Be+1?ye.push({polygons:rt,bounds:Ge,depth:Be+1}):B(rt,Ge)}if(dt.length){const Ge=[new ke(ze===0?Ye:We.x,ze===1?Ye:We.y),ot];ie.length>Be+1?ye.push({polygons:dt,bounds:Ge,depth:Be+1}):B(dt,Ge)}}return R}(s,e,Math.ceil((h-l)/11.25),Math.ceil((p-y)/11.25),1,(b,w,T)=>{if(b===0)return .5*(w+T);{const A=Vr((r.y+w/zt)/a);return(Ln(.5*(Vr((r.y+T/zt)/a)+A))*a-r.y)*zt}})}St(Su,"FillExtrusionBucket",{omit:["layers","features"]}),St(ax,"PartMetadata");const Hv=new ce({"fill-extrusion-edge-radius":new F(Ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Xv={paint:new ce({"fill-extrusion-opacity":new F(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new K(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new F(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new F(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new K(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new K(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new K(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new F(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new F(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new F(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new F(Ze["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Hv};function px(s,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[s*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class dh{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Tu(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=function(h,p,y){var b=px(256*h,256*(p=Math.pow(2,y)-p-1),y),w=px(256*(h+1),256*(p+1),y);return b[0]+","+b[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),l=function(h,p,y){let b,w="";for(let T=h;T>0;T--)b=1<<T-1,w+=(p&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fx{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Tu(e,r.z,r.z,r.x,r.y)}}class ti{constructor(e,r,a,l,h){this.overscaledZ=e,this.wrap=r,this.canonical=new dh(a,+l,+h),this.key=r===0&&e===a?this.canonical.key:Tu(r,e,a,l,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new ti(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ti(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Tu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Tu(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ti(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new ti(r,this.wrap,r,a,l),new ti(r,this.wrap,r,a+1,l),new ti(r,this.wrap,r,a,l+1),new ti(r,this.wrap,r,a+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ti(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ti(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Tu(s,e,r,a,l){const h=1<<Math.min(r,22);let p=h*(l%h)+a%h;return s&&r<22&&(p+=h*h*((s<0?-2*s-1:2*s)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}St(dh,"CanonicalTileID"),St(ti,"OverscaledTileID",{omit:["projMatrix"]});class Vl extends ke{constructor(e,r,a){super(e,r),this.z=a}}function Eu(s,e){return s.x*e.x+s.y*e.y}function gx(s,e){if(s.length===1){let r=0;const a=e[r++];let l;for(;!l||a.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const h=e[r],p=s[0],y=l.sub(a),b=h.sub(a),w=p.sub(a),T=Eu(y,y),A=Eu(y,b),P=Eu(b,b),L=Eu(w,y),R=Eu(w,b),B=T*P-A*A,X=(P*L-A*R)/B,re=(T*R-A*L)/B,pe=a.z*(1-X-re)+l.z*X+h.z*re;if(isFinite(pe))return pe}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function xx(s,e,r,a,l,h,p,y){const b=p*l.getElevationAt(s,e,!0,!0),w=h[0]!==0,T=w?h[1]===0?p*(h[0]/7-450):p*function(A,P,L){const R=Math.floor(P[0]/8),B=Math.floor(P[1]/8),X=10*(P[0]-8*R),re=10*(P[1]-8*B),pe=A.getElevationAt(R,B,!0,!0),ie=A.getMeterToDEM(L),he=Math.floor(.5*(X*ie-1)),ye=Math.floor(.5*(re*ie-1)),xe=A.tileCoordToPixel(R,B),Be=2*he+1,ze=2*ye+1,We=function(dt,Ge,yt,Ct,_t){return[dt.getElevationAtPixel(Ge,yt,!0),dt.getElevationAtPixel(Ge+_t,yt,!0),dt.getElevationAtPixel(Ge,yt+_t,!0),dt.getElevationAtPixel(Ge+Ct,yt+_t,!0)]}(A,xe.x-he,xe.y-ye,Be,ze),ot=Math.abs(We[0]-We[1]),qe=Math.abs(We[2]-We[3]),Je=Math.abs(We[0]-We[2])+Math.abs(We[1]-We[3]),Ye=Math.min(.25,.5*ie*(ot+qe)/Be),rt=Math.min(.25,.5*ie*Je/ze);return pe+Math.max(Ye*X,rt*re)}(l,h,y):b;return{base:b+(r===0)?-1:r,top:w?Math.max(T+a,b+r+2):b+a}}const Kv=Ae([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Qv}=Kv,Jv=Ae([{name:"a_packed",components:4,type:"Float32"}]),{members:Yv}=Jv,ew=ch.types,tw=Math.cos(Math.PI/180*37.5);class hh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ve,this.layoutVertexArray2=new nt,this.indexArray=new Pt,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new lr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,l){this.hasPattern=_p("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:T,id:A,index:P,sourceLayerIndex:L}of e){const R=this.layers[0]._featureFilter.needGeometry,B=Fo(T,R);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),B,a))continue;const X=h?h.evaluate(B,{},a):void 0,re={id:A,properties:T.properties,type:T.type,sourceLayerIndex:L,index:P,geometry:R?B.geometry:aa(T,a,l),patterns:{},sortKey:X};p.push(re)}h&&p.sort((T,A)=>T.sortKey-A.sortKey);const{lineAtlas:y,featureIndex:b}=r,w=this.addConstantDashes(y);for(const T of p){const{geometry:A,index:P,sourceLayerIndex:L}=T;if(w&&this.addFeatureDashes(T,y),this.hasPattern){const R=bp("line",this.layers,T,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(T,A,P,a,y.positions,r.availableImages);b.insert(e[P].feature,A,P,L,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind!=="constant"||h.kind!=="constant")r=!0;else{const p=h.value,y=l.value;if(!y)continue;e.addDash(y,p)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(h.kind==="constant"&&p.kind==="constant")continue;let y,b;if(h.kind==="constant"){if(y=h.value,!y)continue}else y=h.evaluate({zoom:a},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),r.addDash(y,b),e.patterns[l.id]=r.getKey(y,b)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}addFeatures(e,r,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Yv)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,l,h,p){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),T=y.get("line-miter-limit"),A=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of r)this.addLine(P,e,b,w,T,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}addLine(e,r,a,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<e.length-1;re++)this.totalDistance+=e[re].dist(e[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=ew[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(y?3:2))return;a==="bevel"&&(h=1.05);const T=this.overscaling<=16?15*zt/(512*this.overscaling):0,A=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let P,L,R,B,X;this.e1=this.e2=-1,y&&(P=e[b-2],X=e[w].sub(P)._unit()._perp());for(let re=w;re<b;re++){if(R=re===b-1?y?e[w+1]:void 0:e[re+1],R&&e[re].equals(R))continue;X&&(B=X),P&&(L=P),P=e[re],X=R?R.sub(P)._unit()._perp():B,B=B||X;let pe=B.add(X);pe.x===0&&pe.y===0||pe._unit();const ie=B.x*X.x+B.y*X.y,he=pe.x*X.x+pe.y*X.y,ye=he!==0?1/he:1/0,xe=2*Math.sqrt(2-2*he),Be=he<tw&&L&&R,ze=B.x*X.y-B.y*X.x>0;if(Be&&re>w){const qe=P.dist(L);if(qe>2*T){const Je=P.sub(P.sub(L)._mult(T/qe)._round());this.updateDistance(L,Je),this.addCurrentVertex(Je,B,0,0,A),L=Je}}const We=L&&R;let ot=We?a:y?"butt":l;if(We&&ot==="round"&&(ye<p?ot="miter":ye<=2&&(ot="fakeround")),ot==="miter"&&ye>h&&(ot="bevel"),ot==="bevel"&&(ye>2&&(ot="flipbevel"),ye<h&&(ot="miter")),L&&this.updateDistance(L,P),ot==="miter")pe._mult(ye),this.addCurrentVertex(P,pe,0,0,A);else if(ot==="flipbevel"){if(ye>100)pe=X.mult(-1);else{const qe=ye*B.add(X).mag()/B.sub(X).mag();pe._perp()._mult(qe*(ze?-1:1))}this.addCurrentVertex(P,pe,0,0,A),this.addCurrentVertex(P,pe.mult(-1),0,0,A)}else if(ot==="bevel"||ot==="fakeround"){const qe=-Math.sqrt(ye*ye-1),Je=ze?qe:0,Ye=ze?0:qe;if(L&&this.addCurrentVertex(P,B,Je,Ye,A),ot==="fakeround"){const rt=Math.round(180*xe/Math.PI/20);for(let dt=1;dt<rt;dt++){let Ge=dt/rt;if(Ge!==.5){const Ct=Ge-.5;Ge+=Ge*Ct*(Ge-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Ct*Ct+(.848013+ie*(.215638*ie-1.06021)))}const yt=X.sub(B)._mult(Ge)._add(B)._unit()._mult(ze?-1:1);this.addHalfVertex(P,yt.x,yt.y,!1,ze,0,A)}}R&&this.addCurrentVertex(P,X,-Je,-Ye,A)}else if(ot==="butt")this.addCurrentVertex(P,pe,0,0,A);else if(ot==="square"){const qe=L?1:-1;L||this.addCurrentVertex(P,pe,qe,qe,A),this.addCurrentVertex(P,pe,0,0,A),L&&this.addCurrentVertex(P,pe,qe,qe,A)}else ot==="round"&&(L&&(this.addCurrentVertex(P,B,0,0,A),this.addCurrentVertex(P,B,1,1,A,!0)),R&&(this.addCurrentVertex(P,X,-1,-1,A,!0),this.addCurrentVertex(P,X,0,0,A)));if(Be&&re<b-1){const qe=P.dist(R);if(qe>2*T){const Je=P.add(R.sub(P)._mult(T/qe)._round());this.updateDistance(P,Je),this.addCurrentVertex(Je,X,0,0,A),P=Je}}}}addCurrentVertex(e,r,a,l,h,p=!1){const y=r.y*l-r.x,b=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,p,!1,a,h),this.addHalfVertex(e,y,b,p,!0,-l,h)}addHalfVertex({x:e,y:r},a,l,h,p,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}St(hh,"LineBucket",{omit:["layers","patternFeatures"]});const sw=new ce({"line-cap":new K(Ze.layout_line["line-cap"]),"line-join":new K(Ze.layout_line["line-join"]),"line-miter-limit":new F(Ze.layout_line["line-miter-limit"]),"line-round-limit":new F(Ze.layout_line["line-round-limit"]),"line-sort-key":new K(Ze.layout_line["line-sort-key"])});var yx={paint:new ce({"line-opacity":new K(Ze.paint_line["line-opacity"]),"line-color":new K(Ze.paint_line["line-color"]),"line-translate":new F(Ze.paint_line["line-translate"]),"line-translate-anchor":new F(Ze.paint_line["line-translate-anchor"]),"line-width":new K(Ze.paint_line["line-width"]),"line-gap-width":new K(Ze.paint_line["line-gap-width"]),"line-offset":new K(Ze.paint_line["line-offset"]),"line-blur":new K(Ze.paint_line["line-blur"]),"line-dasharray":new K(Ze.paint_line["line-dasharray"]),"line-pattern":new K(Ze.paint_line["line-pattern"]),"line-gradient":new ne(Ze.paint_line["line-gradient"]),"line-trim-offset":new F(Ze.paint_line["line-trim-offset"])}),layout:sw};const _x=new class extends K{possiblyEvaluate(s,e){return e=new C(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(s,e)}evaluate(s,e,r,a){return e=bs({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(s,e,r,a)}}(yx.paint.properties["line-width"].specification);function bx(s,e){return e>0?e+2*s:s}_x.useIntegerZoom=!0;const rw=Ae([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iw=Ae([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),nw=Ae([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ae([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const aw=Ae([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ow=Ae([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ae([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vx=Ae([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lw=Ae([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ae([{name:"triangle",components:3,type:"Uint16"}]),Ae([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ae([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ae([{type:"Float32",name:"offsetX"}]),Ae([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ir=24;const yn=128;function wp(s,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new C(s+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:l}=r;let h=0;for(;h<a.length&&a[h]<=s;)h++;h=Math.max(0,h-1);let p=h;for(;p<a.length&&a[p]<s+1;)p++;p=Math.min(a.length-1,p);const y=a[h],b=a[p];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new C(y)),maxSize:r.evaluate(new C(b)),interpolationType:l}}}function mh(s,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:l}){return s.kind==="source"?a/yn:s.kind==="composite"?ds(a/yn,l/yn,r):e}function ql(s,e){let r=0,a=0;if(s.kind==="constant")a=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=s,y=l?At(Vi.interpolationFactor(l,e,h,p),0,1):0;s.kind==="camera"?a=ds(s.minSize,s.maxSize,y):r=y}return{uSizeT:r,uSize:a}}var cw=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:yn,evaluateSizeForFeature:mh,evaluateSizeForZoom:ql,getSizeData:wp});function uw(s,e,r){return s.sections.forEach(a=>{a.text=function(l,h,p){const y=h.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),S.applyArabicShaping&&(l=S.applyArabicShaping(l)),l}(a.text,e,r)}),s}const Cu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function dw(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function hw(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var wx=Ps,jx=function(s,e,r,a,l){var h,p,y=8*l-a-1,b=(1<<y)-1,w=b>>1,T=-7,A=l-1,P=-1,L=s[e+A];for(A+=P,h=L&(1<<-T)-1,L>>=-T,T+=y;T>0;h=256*h+s[e+A],A+=P,T-=8);for(p=h&(1<<-T)-1,h>>=-T,T+=a;T>0;p=256*p+s[e+A],A+=P,T-=8);if(h===0)h=1-w;else{if(h===b)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,a),h-=w}return(L?-1:1)*p*Math.pow(2,h-a)},Nx=function(s,e,r,a,l,h){var p,y,b,w=8*h-l-1,T=(1<<w)-1,A=T>>1,P=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=0,R=1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-p))<1&&(p--,b*=2),(e+=p+A>=1?P/b:P*Math.pow(2,1-A))*b>=2&&(p++,b/=2),p+A>=T?(y=0,p=T):p+A>=1?(y=(e*b-1)*Math.pow(2,l),p+=A):(y=e*Math.pow(2,A-1)*Math.pow(2,l),p=0));l>=8;s[r+L]=255&y,L+=R,y/=256,l-=8);for(p=p<<l|y,w+=l;w>0;s[r+L]=255&p,L+=R,p/=256,w-=8);s[r+L-R]|=128*B};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Ps(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Ps.Varint=0,Ps.Fixed64=1,Ps.Bytes=2,Ps.Fixed32=5;var jp=4294967296,Sx=1/jp,Tx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function la(s){return s.type===Ps.Bytes?s.readVarint()+s.pos:s.pos+1}function $l(s,e,r){return r?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function Ex(s,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=s;l--)r.buf[l+a]=r.buf[l]}function mw(s,e){for(var r=0;r<s.length;r++)e.writeVarint(s[r])}function pw(s,e){for(var r=0;r<s.length;r++)e.writeSVarint(s[r])}function fw(s,e){for(var r=0;r<s.length;r++)e.writeFloat(s[r])}function gw(s,e){for(var r=0;r<s.length;r++)e.writeDouble(s[r])}function xw(s,e){for(var r=0;r<s.length;r++)e.writeBoolean(s[r])}function yw(s,e){for(var r=0;r<s.length;r++)e.writeFixed32(s[r])}function _w(s,e){for(var r=0;r<s.length;r++)e.writeSFixed32(s[r])}function bw(s,e){for(var r=0;r<s.length;r++)e.writeFixed64(s[r])}function vw(s,e){for(var r=0;r<s.length;r++)e.writeSFixed64(s[r])}function ph(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+16777216*s[e+3]}function Gl(s,e,r){s[r]=e,s[r+1]=e>>>8,s[r+2]=e>>>16,s[r+3]=e>>>24}function Cx(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+(s[e+3]<<24)}Ps.prototype={destroy:function(){this.buf=null},readFields:function(s,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,h=this.pos;this.type=7&a,s(l,e,this),this.pos===h&&this.skip(a)}return e},readMessage:function(s,e){return this.readFields(s,e,this.readVarint()+this.pos)},readFixed32:function(){var s=ph(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Cx(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=ph(this.buf,this.pos)+ph(this.buf,this.pos+4)*jp;return this.pos+=8,s},readSFixed64:function(){var s=ph(this.buf,this.pos)+Cx(this.buf,this.pos+4)*jp;return this.pos+=8,s},readFloat:function(){var s=jx(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=jx(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(l,h,p){var y,b,w=p.buf;if(y=(112&(b=w[p.pos++]))>>4,b<128||(y|=(127&(b=w[p.pos++]))<<3,b<128)||(y|=(127&(b=w[p.pos++]))<<10,b<128)||(y|=(127&(b=w[p.pos++]))<<17,b<128)||(y|=(127&(b=w[p.pos++]))<<24,b<128)||(y|=(1&(b=w[p.pos++]))<<31,b<128))return $l(l,y,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&Tx?function(r,a,l){return Tx.decode(r.subarray(a,l))}(this.buf,e,s):function(r,a,l){for(var h="",p=a;p<l;){var y,b,w,T=r[p],A=null,P=T>239?4:T>223?3:T>191?2:1;if(p+P>l)break;P===1?T<128&&(A=T):P===2?(192&(y=r[p+1]))==128&&(A=(31&T)<<6|63&y)<=127&&(A=null):P===3?(b=r[p+2],(192&(y=r[p+1]))==128&&(192&b)==128&&((A=(15&T)<<12|(63&y)<<6|63&b)<=2047||A>=55296&&A<=57343)&&(A=null)):P===4&&(b=r[p+2],w=r[p+3],(192&(y=r[p+1]))==128&&(192&b)==128&&(192&w)==128&&((A=(15&T)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,P=1):A>65535&&(A-=65536,h+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),h+=String.fromCharCode(A),p+=P}return h}(this.buf,e,s)},readBytes:function(){var s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e},readPackedVarint:function(s,e){if(this.type!==Ps.Bytes)return s.push(this.readVarint(e));var r=la(this);for(s=s||[];this.pos<r;)s.push(this.readVarint(e));return s},readPackedSVarint:function(s){if(this.type!==Ps.Bytes)return s.push(this.readSVarint());var e=la(this);for(s=s||[];this.pos<e;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Ps.Bytes)return s.push(this.readBoolean());var e=la(this);for(s=s||[];this.pos<e;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Ps.Bytes)return s.push(this.readFloat());var e=la(this);for(s=s||[];this.pos<e;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Ps.Bytes)return s.push(this.readDouble());var e=la(this);for(s=s||[];this.pos<e;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Ps.Bytes)return s.push(this.readFixed32());var e=la(this);for(s=s||[];this.pos<e;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Ps.Bytes)return s.push(this.readSFixed32());var e=la(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Ps.Bytes)return s.push(this.readFixed64());var e=la(this);for(s=s||[];this.pos<e;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Ps.Bytes)return s.push(this.readSFixed64());var e=la(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed64());return s},skip:function(s){var e=7&s;if(e===Ps.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ps.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ps.Fixed32)this.pos+=4;else{if(e!==Ps.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(s,e){this.writeVarint(s<<3|e)},realloc:function(s){for(var e=this.length||16;e<this.pos+s;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Gl(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Gl(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Gl(this.buf,-1&s,this.pos),Gl(this.buf,Math.floor(s*Sx),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Gl(this.buf,-1&s,this.pos),Gl(this.buf,Math.floor(s*Sx),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(e,r){var a,l;if(e>=0?(a=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,p,y){y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,y.buf[y.pos]=127&(h>>>=7)}(a,0,r),function(h,p){var y=(7&h)<<4;p.buf[p.pos++]|=y|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,r)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var e=this.pos;this.pos=function(a,l,h){for(var p,y,b=0;b<l.length;b++){if((p=l.charCodeAt(b))>55295&&p<57344){if(!y){p>56319||b+1===l.length?(a[h++]=239,a[h++]=191,a[h++]=189):y=p;continue}if(p<56320){a[h++]=239,a[h++]=191,a[h++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(a[h++]=239,a[h++]=191,a[h++]=189,y=null);p<128?a[h++]=p:(p<2048?a[h++]=p>>6|192:(p<65536?a[h++]=p>>12|224:(a[h++]=p>>18|240,a[h++]=p>>12&63|128),a[h++]=p>>6&63|128),a[h++]=63&p|128)}return h}(this.buf,s,this.pos);var r=this.pos-e;r>=128&&Ex(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(s){this.realloc(4),Nx(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Nx(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var e=s.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=s[r]},writeRawMessage:function(s,e){this.pos++;var r=this.pos;s(e,this);var a=this.pos-r;a>=128&&Ex(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(s,e,r){this.writeTag(s,Ps.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(s,e){e.length&&this.writeMessage(s,mw,e)},writePackedSVarint:function(s,e){e.length&&this.writeMessage(s,pw,e)},writePackedBoolean:function(s,e){e.length&&this.writeMessage(s,xw,e)},writePackedFloat:function(s,e){e.length&&this.writeMessage(s,fw,e)},writePackedDouble:function(s,e){e.length&&this.writeMessage(s,gw,e)},writePackedFixed32:function(s,e){e.length&&this.writeMessage(s,yw,e)},writePackedSFixed32:function(s,e){e.length&&this.writeMessage(s,_w,e)},writePackedFixed64:function(s,e){e.length&&this.writeMessage(s,bw,e)},writePackedSFixed64:function(s,e){e.length&&this.writeMessage(s,vw,e)},writeBytesField:function(s,e){this.writeTag(s,Ps.Bytes),this.writeBytes(e)},writeFixed32Field:function(s,e){this.writeTag(s,Ps.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(s,e){this.writeTag(s,Ps.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(s,e){this.writeTag(s,Ps.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(s,e){this.writeTag(s,Ps.Fixed64),this.writeSFixed64(e)},writeVarintField:function(s,e){this.writeTag(s,Ps.Varint),this.writeVarint(e)},writeSVarintField:function(s,e){this.writeTag(s,Ps.Varint),this.writeSVarint(e)},writeStringField:function(s,e){this.writeTag(s,Ps.Bytes),this.writeString(e)},writeFloatField:function(s,e){this.writeTag(s,Ps.Fixed32),this.writeFloat(e)},writeDoubleField:function(s,e){this.writeTag(s,Ps.Fixed64),this.writeDouble(e)},writeBooleanField:function(s,e){this.writeVarintField(s,!!e)}};var fh=de(wx);const Np=3;function ww(s,e,r){e.glyphs=[],s===1&&r.readMessage(jw,e)}function jw(s,e,r){if(s===3){const{id:a,bitmap:l,width:h,height:p,left:y,top:b,advance:w}=r.readMessage(Nw,{});e.glyphs.push({id:a,bitmap:new oa({width:h+2*Np,height:p+2*Np},l),metrics:{width:h,height:p,left:y,top:b,advance:w}})}else s===4?e.ascender=r.readSVarint():s===5&&(e.descender=r.readSVarint())}function Nw(s,e,r){s===1?e.id=r.readVarint():s===2?e.bitmap=r.readBytes():s===3?e.width=r.readVarint():s===4?e.height=r.readVarint():s===5?e.left=r.readSVarint():s===6?e.top=r.readSVarint():s===7&&(e.advance=r.readVarint())}const kx=Np;function Sp(s){let e=0,r=0;for(const p of s)e+=p.w*p.h,r=Math.max(r,p.w);s.sort((p,y)=>y.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,h=0;for(const p of s)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===b.w&&p.h===b.h){const w=a.pop();y<a.length&&(a[y]=w)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(a.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}const ci=1;class Tp{constructor(e,{pixelRatio:r,version:a,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+ci,this.paddedRect.y+ci]}get br(){return[this.paddedRect.x+this.paddedRect.w-ci,this.paddedRect.y+this.paddedRect.h-ci]}get displaySize(){return[(this.paddedRect.w-2*ci)/this.pixelRatio,(this.paddedRect.h-2*ci)/this.pixelRatio]}}class Ax{constructor(e,r){const a={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,a,h),this.addImages(r,l,h);const{w:p,h:y}=Sp(h),b=new _i({width:p||1,height:y||1});for(const w in e){const T=e[w],A=a[w].paddedRect;_i.copy(T.data,b,{x:0,y:0},{x:A.x+ci,y:A.y+ci},T.data)}for(const w in r){const T=r[w],A=l[w].paddedRect,P=A.x+ci,L=A.y+ci,R=T.data.width,B=T.data.height;_i.copy(T.data,b,{x:0,y:0},{x:P,y:L},T.data),_i.copy(T.data,b,{x:0,y:B-1},{x:P,y:L-1},{width:R,height:1}),_i.copy(T.data,b,{x:0,y:0},{x:P,y:L+B},{width:R,height:1}),_i.copy(T.data,b,{x:R-1,y:0},{x:P-1,y:L},{width:1,height:B}),_i.copy(T.data,b,{x:0,y:0},{x:P+R,y:L},{width:1,height:B})}this.image=b,this.iconPositions=a,this.patternPositions=l}addImages(e,r,a){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2*ci,h:h.data.height+2*ci};a.push(p),r[l]=new Tp(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,h]=e.tl;a.update(r.data,void 0,{x:l,y:h})}}St(Tp,"ImagePosition"),St(Ax,"ImageAtlas");const Pi={horizontal:1,vertical:2,horizontalOnly:3},Mx=-17;class ku{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new ku;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new ku;return r.imageName=e,r}}class Zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new Zl;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?a.addImageSection(h):a.addTextSection(h,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,a){let l="";for(let h=0;h<r.length;h++){const p=r.charCodeAt(h+1)||null,y=r.charCodeAt(h-1)||null;l+=!a&&(p&&$d(p)&&!Cu[r[h+1]]||y&&$d(y)&&!Cu[r[h-1]])||!Cu[r[h]]?r[h]:Cu[r[h]]}return l}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&gh[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&gh[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Zl;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(ku.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ms("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(ku.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ms("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ep(s,e,r,a,l,h,p,y,b,w,T,A,P,L,R){const B=Zl.fromFeature(s,l);A===Pi.vertical&&B.verticalizePunctuation(P);let X=[];const re=function(xe,Be,ze,We,ot,qe){if(!xe)return[];const Je=[],Ye=function(yt,Ct,_t,$t,ht,Rt){let Gt=0;for(let ps=0;ps<yt.length();ps++){const Zt=yt.getSection(ps);Gt+=Px(yt.getCharCode(ps),Zt,$t,ht,Ct,Rt)}return Gt/Math.max(1,Math.ceil(Gt/_t))}(xe,Be,ze,We,ot,qe),rt=xe.text.indexOf("")>=0;let dt=0;for(let yt=0;yt<xe.length();yt++){const Ct=xe.getSection(yt),_t=xe.getCharCode(yt);if(gh[_t]||(dt+=Px(_t,Ct,We,ot,Be,qe)),yt<xe.length()-1){const $t=!((Ge=_t)<11904||!(vt["Bopomofo Extended"](Ge)||vt.Bopomofo(Ge)||vt["CJK Compatibility Forms"](Ge)||vt["CJK Compatibility Ideographs"](Ge)||vt["CJK Compatibility"](Ge)||vt["CJK Radicals Supplement"](Ge)||vt["CJK Strokes"](Ge)||vt["CJK Symbols and Punctuation"](Ge)||vt["CJK Unified Ideographs Extension A"](Ge)||vt["CJK Unified Ideographs"](Ge)||vt["Enclosed CJK Letters and Months"](Ge)||vt["Halfwidth and Fullwidth Forms"](Ge)||vt.Hiragana(Ge)||vt["Ideographic Description Characters"](Ge)||vt["Kangxi Radicals"](Ge)||vt["Katakana Phonetic Extensions"](Ge)||vt.Katakana(Ge)||vt["Vertical Forms"](Ge)||vt["Yi Radicals"](Ge)||vt["Yi Syllables"](Ge)));(Sw[_t]||$t||Ct.imageName)&&Je.push(Dx(yt+1,dt,Ye,Je,Tw(_t,xe.getCharCode(yt+1),$t&&rt),!1))}}var Ge;return Lx(Dx(xe.length(),dt,Ye,Je,0,!0))}(B,w,h,e,a,L),{processBidirectionalText:pe,processStyledBidirectionalText:ie}=S;if(pe&&B.sections.length===1){const xe=pe(B.toString(),re);for(const Be of xe){const ze=new Zl;ze.text=Be,ze.sections=B.sections;for(let We=0;We<Be.length;We++)ze.sectionIndex.push(0);X.push(ze)}}else if(ie){const xe=ie(B.text,B.sectionIndex,re);for(const Be of xe){const ze=new Zl;ze.text=Be[0],ze.sectionIndex=Be[1],ze.sections=B.sections,X.push(ze)}}else X=function(xe,Be){const ze=[],We=xe.text;let ot=0;for(const qe of Be)ze.push(xe.substring(ot,qe)),ot=qe;return ot<We.length&&ze.push(xe.substring(ot,We.length)),ze}(B,re);const he=[],ye={positionedLines:he,text:B.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(xe,Be,ze,We,ot,qe,Je,Ye,rt,dt,Ge,yt){let Ct=0,_t=0,$t=0;const ht=Ye==="right"?1:Ye==="left"?0:.5;let Rt=!1;for(const Xt of ot){const Kt=Xt.getSections();for(const Es of Kt){if(Es.imageName)continue;const Is=Be[Es.fontStack];if(Is&&(Rt=Is.ascender!==void 0&&Is.descender!==void 0,!Rt))break}if(!Rt)break}let Gt=0;for(const Xt of ot){Xt.trim();const Kt=Xt.getMaxScale(),Es=(Kt-1)*Ir,Is={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Gt]=Is;const Ds=Is.positionedGlyphs;let Cs=0;if(!Xt.length()){_t+=qe,++Gt;continue}let Vs=0,Zs=0;for(let ks=0;ks<Xt.length();ks++){const yr=Xt.getSection(ks),dr=Xt.getSectionIndex(ks),qs=Xt.getCharCode(ks);let xs=yr.scale,hr=null,Ls=null,si=null,mr=Ir,Dr=0;const Er=!(rt===Pi.horizontal||!Ge&&!su(qs)||Ge&&(gh[qs]||(ps=qs,vt.Arabic(ps)||vt["Arabic Supplement"](ps)||vt["Arabic Extended-A"](ps)||vt["Arabic Presentation Forms-A"](ps)||vt["Arabic Presentation Forms-B"](ps))));if(yr.imageName){const ri=We[yr.imageName];if(!ri)continue;si=yr.imageName,xe.iconsInText=xe.iconsInText||!0,Ls=ri.paddedRect;const Cr=ri.displaySize;xs=xs*Ir/yt,hr={width:Cr[0],height:Cr[1],left:ci,top:-kx,advance:Er?Cr[1]:Cr[0],localGlyph:!1},Dr=Rt?-hr.height*xs:Mx+Kt*Ir-Cr[1]*xs,mr=hr.advance;const vn=(Er?Cr[0]:Cr[1])*xs-Ir*Kt;vn>0&&vn>Cs&&(Cs=vn)}else{const ri=ze[yr.fontStack];if(!ri)continue;ri[qs]&&(Ls=ri[qs]);const Cr=Be[yr.fontStack];if(!Cr)continue;const vn=Cr.glyphs[qs];if(!vn)continue;if(hr=vn.metrics,mr=qs!==8203?Ir:0,Rt){const Yl=Cr.ascender!==void 0?Math.abs(Cr.ascender):0,Fu=Cr.descender!==void 0?Math.abs(Cr.descender):0,Bu=(Yl+Fu)*xs;Vs<Bu&&(Vs=Bu,Zs=(Yl-Fu)/2*xs),Dr=-Yl*xs}else Dr=Mx+(Kt-xs)*Ir}Er?(xe.verticalizable=!0,Ds.push({glyph:qs,imageName:si,x:Ct,y:_t+Dr,vertical:Er,scale:xs,localGlyph:hr.localGlyph,fontStack:yr.fontStack,sectionIndex:dr,metrics:hr,rect:Ls}),Ct+=mr*xs+dt):(Ds.push({glyph:qs,imageName:si,x:Ct,y:_t+Dr,vertical:Er,scale:xs,localGlyph:hr.localGlyph,fontStack:yr.fontStack,sectionIndex:dr,metrics:hr,rect:Ls}),Ct+=hr.advance*xs+dt)}Ds.length!==0&&($t=Math.max(Ct-dt,$t),Rt?Rx(Ds,ht,Cs,Zs,qe*Kt/2):Rx(Ds,ht,Cs,0,qe/2)),Ct=0;const ur=qe*Kt+Cs;Is.lineOffset=Math.max(Cs,Es),_t+=ur,++Gt}var ps;const Zt=_t,{horizontalAlign:Bt,verticalAlign:Rs}=Cp(Je);(function(Xt,Kt,Es,Is,Ds,Cs){const Vs=(Kt-Es)*Ds,Zs=-Cs*Is;for(const ur of Xt)for(const ks of ur.positionedGlyphs)ks.x+=Vs,ks.y+=Zs})(xe.positionedLines,ht,Bt,Rs,$t,Zt),xe.top+=-Rs*Zt,xe.bottom=xe.top+Zt,xe.left+=-Bt*$t,xe.right=xe.left+$t,xe.hasBaseline=Rt}(ye,e,r,a,X,p,y,b,A,w,P,R),!function(xe){for(const Be of xe)if(Be.positionedGlyphs.length!==0)return!1;return!0}(he)&&ye}const gh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Px(s,e,r,a,l,h){if(e.imageName){const p=a[e.imageName];return p?p.displaySize[0]*e.scale*Ir/h+l:0}{const p=r[e.fontStack],y=p&&p.glyphs[s];return y?y.metrics.advance*e.scale+l:0}}function Ix(s,e,r,a){const l=Math.pow(s-e,2);return a?s<e?l/2:2*l:l+Math.abs(r)*r}function Tw(s,e,r){let a=0;return s===10&&(a-=1e4),r&&(a+=150),s!==40&&s!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Dx(s,e,r,a,l,h){let p=null,y=Ix(e,r,l,h);for(const b of a){const w=Ix(e-b.x,r,l,h)+b.badness;w<=y&&(p=b,y=w)}return{index:s,x:e,priorBreak:p,badness:y}}function Lx(s){return s?Lx(s.priorBreak).concat(s.index):[]}function Cp(s){let e=.5,r=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Rx(s,e,r,a,l){if(!(e||r||a||l))return;const h=s.length-1,p=s[h],y=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=h;b++)s[b].x-=y,s[b].y+=r+a+l}function Ew(s,e,r){const{horizontalAlign:a,verticalAlign:l}=Cp(r),h=e[0]-s.displaySize[0]*a,p=e[1]-s.displaySize[1]*l;return{image:s,top:p,bottom:p+s.displaySize[1],left:h,right:h+s.displaySize[0]}}function zx(s,e,r,a,l,h){const p=s.image;let y;if(p.content){const X=p.content,re=p.pixelRatio||1;y=[X[0]/re,X[1]/re,p.displaySize[0]-X[2]/re,p.displaySize[1]-X[3]/re]}const b=e.left*h,w=e.right*h;let T,A,P,L;r==="width"||r==="both"?(L=l[0]+b-a[3],A=l[0]+w+a[1]):(L=l[0]+(b+w-p.displaySize[0])/2,A=L+p.displaySize[0]);const R=e.top*h,B=e.bottom*h;return r==="height"||r==="both"?(T=l[1]+R-a[0],P=l[1]+B+a[2]):(T=l[1]+(R+B-p.displaySize[1])/2,P=T+p.displaySize[1]),{image:p,top:T,right:A,bottom:P,left:L,collisionPadding:y}}class ca extends ke{constructor(e,r,a,l,h){super(e,r),this.angle=l,this.z=a,h!==void 0&&(this.segment=h)}clone(){return new ca(this.x,this.y,this.z,this.angle,this.segment)}}function Ox(s,e,r,a,l){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,y=0;for(;y>-r/2;){if(p--,p<0)return!1;y-=s[p].dist(h),h=s[p]}y+=s[p].dist(s[p+1]),p++;const b=[];let w=0;for(;y<r/2;){const T=s[p],A=s[p+1];if(!A)return!1;let P=s[p-1].angleTo(T)-T.angleTo(A);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:P}),w+=P;y-b[0].distance>a;)w-=b.shift().angleDelta;if(w>l)return!1;p++,y+=T.dist(A)}return!0}function Fx(s){let e=0;for(let r=0;r<s.length-1;r++)e+=s[r].dist(s[r+1]);return e}function Bx(s,e,r){return s?.6*e*r:0}function Ux(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function Cw(s,e,r,a,l,h){const p=Bx(r,l,h),y=Ux(r,a)*h;let b=0;const w=Fx(s)/2;for(let T=0;T<s.length-1;T++){const A=s[T],P=s[T+1],L=A.dist(P);if(b+L>w){const R=(w-b)/L,B=ds(A.x,P.x,R),X=ds(A.y,P.y,R),re=new ca(B,X,0,P.angleTo(A),T);return!p||Ox(s,re,y,p,e)?re:void 0}b+=L}}function kw(s,e,r,a,l,h,p,y,b){const w=Bx(a,h,p),T=Ux(a,l),A=T*p,P=s[0].x===0||s[0].x===b||s[0].y===0||s[0].y===b;return e-A<e/4&&(e=A+e/4),Vx(s,P?e/2*y%e:(T/2+2*h)*p*y%e,e,w,r,A,P,!1,b)}function Vx(s,e,r,a,l,h,p,y,b){const w=h/2,T=Fx(s);let A=0,P=e-r,L=[];for(let R=0;R<s.length-1;R++){const B=s[R],X=s[R+1],re=B.dist(X),pe=X.angleTo(B);for(;P+r<A+re;){P+=r;const ie=(P-A)/re,he=ds(B.x,X.x,ie),ye=ds(B.y,X.y,ie);if(he>=0&&he<b&&ye>=0&&ye<b&&P-w>=0&&P+w<=T){const xe=new ca(he,ye,0,pe,R);xe._round(),a&&!Ox(s,xe,h,a,l)||L.push(xe)}}A+=re}return y||L.length||p||(L=Vx(s,A/2,r,a,l,h,p,!0,b)),L}function qx(s,e,r,a,l){const h=[];for(let p=0;p<s.length;p++){const y=s[p];let b;for(let w=0;w<y.length-1;w++){let T=y[w],A=y[w+1];T.x<e&&A.x<e||(T.x<e?T=new ke(e,T.y+(e-T.x)/(A.x-T.x)*(A.y-T.y))._round():A.x<e&&(A=new ke(e,T.y+(e-T.x)/(A.x-T.x)*(A.y-T.y))._round()),T.y<r&&A.y<r||(T.y<r?T=new ke(T.x+(r-T.y)/(A.y-T.y)*(A.x-T.x),r)._round():A.y<r&&(A=new ke(T.x+(r-T.y)/(A.y-T.y)*(A.x-T.x),r)._round()),T.x>=a&&A.x>=a||(T.x>=a?T=new ke(a,T.y+(a-T.x)/(A.x-T.x)*(A.y-T.y))._round():A.x>=a&&(A=new ke(a,T.y+(a-T.x)/(A.x-T.x)*(A.y-T.y))._round()),T.y>=l&&A.y>=l||(T.y>=l?T=new ke(T.x+(l-T.y)/(A.y-T.y)*(A.x-T.x),l)._round():A.y>=l&&(A=new ke(T.x+(l-T.y)/(A.y-T.y)*(A.x-T.x),l)._round()),b&&T.equals(b[b.length-1])||(b=[T],h.push(b)),b.push(A)))))}}return h}St(ca,"Anchor");const Au=1e20;function $x(s,e,r,a,l,h,p,y,b){for(let w=e;w<e+a;w++)Gx(s,r*h+w,h,l,p,y,b);for(let w=r;w<r+l;w++)Gx(s,w*h+e,1,a,p,y,b)}function Gx(s,e,r,a,l,h,p){h[0]=0,p[0]=-Au,p[1]=Au,l[0]=s[e];for(let y=1,b=0,w=0;y<a;y++){l[y]=s[e+y*r];const T=y*y;do{const A=h[b];w=(l[y]-l[A]+T-A*A)/(y-A)/2}while(w<=p[b]&&--b>-1);b++,h[b]=y,p[b]=w,p[b+1]=Au}for(let y=0,b=0;y<a;y++){for(;p[b+1]<y;)b++;const w=h[b],T=y-w;s[e+y*r]=l[w]+T*T}}const _n=2,kp={none:0,ideographs:1,all:2};class Wl{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const a=[];for(const l in e)for(const h of e[l])a.push({stack:l,id:h});Vt(a,({stack:l,id:h},p)=>{let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[h];if(b!==void 0)return void p(null,{stack:l,id:h,glyph:b});if(b=this._tinySDF(y,l,h),b)return y.glyphs[h]=b,void p(null,{stack:l,id:h,glyph:b});const w=Math.floor(h/256);if(256*w>65535)return void p(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void p(null,{stack:l,id:h,glyph:b});let T=y.requests[w];T||(T=y.requests[w]=[],Wl.loadGlyphRange(l,w,this.url,this.requestManager,(A,P)=>{if(P){y.ascender=P.ascender,y.descender=P.descender;for(const L in P.glyphs)this._doesCharSupportLocalGlyph(+L)||(y.glyphs[+L]=P.glyphs[+L]);y.ranges[w]=!0}for(const L of T)L(A,P);delete y.requests[w]})),T.push((A,P)=>{A?p(A):P&&p(null,{stack:l,id:h,glyph:P.glyphs[h]||null})})},(l,h)=>{if(l)r(l);else if(h){const p={};for(const{stack:y,id:b,glyph:w}of h)p[y]===void 0&&(p[y]={}),p[y].glyphs===void 0&&(p[y].glyphs={}),p[y].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},p[y].ascender=this.entries[y].ascender,p[y].descender=this.entries[y].descender;r(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==kp.none&&(this.localGlyphMode===kp.all?!!this.localFontFamily:!!this.localFontFamily&&(vt["CJK Unified Ideographs"](e)||vt["Hangul Syllables"](e)||vt.Hiragana(e)||vt.Katakana(e)||vt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,a){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let B="400";/bold/i.test(r)?B="900":/medium/i.test(r)?B="500":/light/i.test(r)&&(B="200"),h=e.tinySDF=new Wl.TinySDF({fontFamily:l,fontWeight:B,fontSize:24*_n,buffer:3*_n,radius:8*_n}),h.fontWeight=B}if(this.localGlyphs[h.fontWeight][a])return this.localGlyphs[h.fontWeight][a];const p=String.fromCharCode(a),{data:y,width:b,height:w,glyphWidth:T,glyphHeight:A,glyphLeft:P,glyphTop:L,glyphAdvance:R}=h.draw(p);return this.localGlyphs[h.fontWeight][a]={id:a,bitmap:new oa({width:b,height:w},y),metrics:{width:T/_n,height:A/_n,left:P/_n,top:L/_n-27,advance:R/_n,localGlyph:!0}}}}Wl.loadGlyphRange=function(s,e,r,a,l){const h=256*e,p=h+255,y=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",s).replace("{range}",`${h}-${p}`),Ti.Glyphs);en(y,(b,w)=>{if(b)l(b);else if(w){const T={},A=function(P){return new fh(P).readFields(ww,{})}(w);for(const P of A.glyphs)T[P.id]=P;l(null,{glyphs:T,ascender:A.ascender,descender:A.descender})}})},Wl.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const y=this.size=s+4*e,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${h} ${s}px ${l}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(s),p=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),b=Math.min(this.size-this.buffer,p+Math.ceil(a)),w=y+2*this.buffer,T=b+2*this.buffer,A=Math.max(w*T,0),P=new Uint8ClampedArray(A),L={data:P,width:w,height:T,glyphWidth:y,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return L;const{ctx:R,buffer:B,gridInner:X,gridOuter:re}=this;R.clearRect(B,B,y,b),R.fillText(s,B,B+p);const pe=R.getImageData(B,B,y,b);re.fill(Au,0,A),X.fill(0,0,A);for(let ie=0;ie<b;ie++)for(let he=0;he<y;he++){const ye=pe.data[4*(ie*y+he)+3]/255;if(ye===0)continue;const xe=(ie+B)*w+he+B;if(ye===1)re[xe]=0,X[xe]=Au;else{const Be=.5-ye;re[xe]=Be>0?Be*Be:0,X[xe]=Be<0?Be*Be:0}}$x(re,0,0,w,T,w,this.f,this.v,this.z),$x(X,B,B,y,b,w,this.f,this.v,this.z);for(let ie=0;ie<A;ie++){const he=Math.sqrt(re[ie])-Math.sqrt(X[ie]);P[ie]=Math.round(255-255*(he/this.radius+this.cutoff))}return L}};const Hl=ci;function Zx(s,e,r,a){const l=[],h=s.image,p=h.pixelRatio,y=h.paddedRect.w-2*Hl,b=h.paddedRect.h-2*Hl,w=s.right-s.left,T=s.bottom-s.top,A=h.stretchX||[[0,y]],P=h.stretchY||[[0,b]],L=(qe,Je)=>qe+Je[1]-Je[0],R=A.reduce(L,0),B=P.reduce(L,0),X=y-R,re=b-B;let pe=0,ie=R,he=0,ye=B,xe=0,Be=X,ze=0,We=re;if(h.content&&a){const qe=h.content;pe=xh(A,0,qe[0]),he=xh(P,0,qe[1]),ie=xh(A,qe[0],qe[2]),ye=xh(P,qe[1],qe[3]),xe=qe[0]-pe,ze=qe[1]-he,Be=qe[2]-qe[0]-ie,We=qe[3]-qe[1]-ye}const ot=(qe,Je,Ye,rt)=>{const dt=yh(qe.stretch-pe,ie,w,s.left),Ge=_h(qe.fixed-xe,Be,qe.stretch,R),yt=yh(Je.stretch-he,ye,T,s.top),Ct=_h(Je.fixed-ze,We,Je.stretch,B),_t=yh(Ye.stretch-pe,ie,w,s.left),$t=_h(Ye.fixed-xe,Be,Ye.stretch,R),ht=yh(rt.stretch-he,ye,T,s.top),Rt=_h(rt.fixed-ze,We,rt.stretch,B),Gt=new ke(dt,yt),ps=new ke(_t,yt),Zt=new ke(_t,ht),Bt=new ke(dt,ht),Rs=new ke(Ge/p,Ct/p),Xt=new ke($t/p,Rt/p),Kt=e*Math.PI/180;if(Kt){const Ds=Math.sin(Kt),Cs=Math.cos(Kt),Vs=[Cs,-Ds,Ds,Cs];Gt._matMult(Vs),ps._matMult(Vs),Bt._matMult(Vs),Zt._matMult(Vs)}const Es=qe.stretch+qe.fixed,Is=Je.stretch+Je.fixed;return{tl:Gt,tr:ps,bl:Bt,br:Zt,tex:{x:h.paddedRect.x+Hl+Es,y:h.paddedRect.y+Hl+Is,w:Ye.stretch+Ye.fixed-Es,h:rt.stretch+rt.fixed-Is},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rs,pixelOffsetBR:Xt,minFontScaleX:Be/p/w,minFontScaleY:We/p/T,isSDF:r}};if(a&&(h.stretchX||h.stretchY)){const qe=Wx(A,X,R),Je=Wx(P,re,B);for(let Ye=0;Ye<qe.length-1;Ye++){const rt=qe[Ye],dt=qe[Ye+1];for(let Ge=0;Ge<Je.length-1;Ge++)l.push(ot(rt,Je[Ge],dt,Je[Ge+1]))}}else l.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return l}function xh(s,e,r){let a=0;for(const l of s)a+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return a}function Wx(s,e,r){const a=[{fixed:-Hl,stretch:0}];for(const[l,h]of s){const p=a[a.length-1];a.push({fixed:l-p.stretch,stretch:p.stretch}),a.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return a.push({fixed:e+Hl,stretch:r}),a}function yh(s,e,r,a){return s/e*r+a}function _h(s,e,r,a){return s-e*r/a}function Aw(s,e,r,a){const l=e+s.positionedLines[a].lineOffset;return a===0?r+l/2:r+(l+(e+s.positionedLines[a-1].lineOffset))/2}class Mw{constructor(e=[],r=Pw){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,l=r[e];for(;e>0;){const h=e-1>>1,p=r[h];if(a(l,p)>=0)break;r[e]=p,e=h}r[e]=l}_down(e){const{data:r,compare:a}=this,l=this.length>>1,h=r[e];for(;e<l;){let p=1+(e<<1),y=r[p];const b=p+1;if(b<this.length&&a(r[b],y)<0&&(p=b,y=r[b]),a(y,h)>=0)break;r[e]=y,e=p}r[e]=h}}function Pw(s,e){return s<e?-1:s>e?1:0}function Iw(s,e=1,r=!1){let a=1/0,l=1/0,h=-1/0,p=-1/0;const y=s[0];for(let L=0;L<y.length;L++){const R=y[L];(!L||R.x<a)&&(a=R.x),(!L||R.y<l)&&(l=R.y),(!L||R.x>h)&&(h=R.x),(!L||R.y>p)&&(p=R.y)}const b=Math.min(h-a,p-l);let w=b/2;const T=new Mw([],Dw);if(b===0)return new ke(a,l);for(let L=a;L<h;L+=b)for(let R=l;R<p;R+=b)T.push(new Xl(L+w,R+w,w,s));let A=function(L){let R=0,B=0,X=0;const re=L[0];for(let pe=0,ie=re.length,he=ie-1;pe<ie;he=pe++){const ye=re[pe],xe=re[he],Be=ye.x*xe.y-xe.x*ye.y;B+=(ye.x+xe.x)*Be,X+=(ye.y+xe.y)*Be,R+=3*Be}return new Xl(B/R,X/R,0,L)}(s),P=T.length;for(;T.length;){const L=T.pop();(L.d>A.d||!A.d)&&(A=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,P)),L.max-A.d<=e||(w=L.h/2,T.push(new Xl(L.p.x-w,L.p.y-w,w,s)),T.push(new Xl(L.p.x+w,L.p.y-w,w,s)),T.push(new Xl(L.p.x-w,L.p.y+w,w,s)),T.push(new Xl(L.p.x+w,L.p.y+w,w,s)),P+=4)}return r&&(console.log(`num probes: ${P}`),console.log(`best distance: ${A.d}`)),A.p}function Dw(s,e){return e.max-s.max}class Xl{constructor(e,r,a,l){this.p=new ke(e,r),this.h=a,this.d=function(h,p){let y=!1,b=1/0;for(let w=0;w<p.length;w++){const T=p[w];for(let A=0,P=T.length,L=P-1;A<P;L=A++){const R=T[A],B=T[L];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(y=!y),b=Math.min(b,Vg(h,R,B))}}return(y?1:-1)*Math.sqrt(b)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Kl=7,Ap=Number.POSITIVE_INFINITY,Lw=Math.sqrt(2);function Hx(s,[e,r]){let a=0,l=0;if(r===Ap){e<0&&(e=0);const h=e/Lw;switch(s){case"top-right":case"top-left":l=h-Kl;break;case"bottom-right":case"bottom-left":l=-h+Kl;break;case"bottom":l=-e+Kl;break;case"top":l=e-Kl}switch(s){case"top-right":case"bottom-right":a=-h;break;case"top-left":case"bottom-left":a=h;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),s){case"top-right":case"top-left":case"top":l=r-Kl;break;case"bottom-right":case"bottom-left":case"bottom":l=-r+Kl}switch(s){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,l]}function Rw(s,e,r,a,l,h,p,y,b,w){s.createArrays(),s.tilePixelRatio=zt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const T=s.layers[0].layout,A=s.layers[0]._unevaluatedLayout._values,P={};if(s.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:X}=s.textSizeData;P.compositeTextSizes=[A["text-size"].possiblyEvaluate(new C(B),y),A["text-size"].possiblyEvaluate(new C(X),y)]}if(s.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:X}=s.iconSizeData;P.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new C(B),y),A["icon-size"].possiblyEvaluate(new C(X),y)]}P.layoutTextSize=A["text-size"].possiblyEvaluate(new C(b+1),y),P.layoutIconSize=A["icon-size"].possiblyEvaluate(new C(b+1),y),P.textMaxSize=A["text-size"].possiblyEvaluate(new C(18),y);const L=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",R=T.get("text-size");for(const B of s.features){const X=T.get("text-font").evaluate(B,{},y).join(","),re=R.evaluate(B,{},y),pe=P.layoutTextSize.evaluate(B,{},y),ie=(P.layoutIconSize.evaluate(B,{},y),{horizontal:{},vertical:void 0}),he=B.text;let ye,xe=[0,0];if(he){const We=he.toString(),ot=T.get("text-letter-spacing").evaluate(B,{},y)*Ir,qe=T.get("text-line-height").evaluate(B,{},y)*Ir,Je=Fm(We)?ot:0,Ye=T.get("text-anchor").evaluate(B,{},y),rt=T.get("text-variable-anchor");if(!rt){const _t=T.get("text-radial-offset").evaluate(B,{},y);xe=_t?Hx(Ye,[_t*Ir,Ap]):T.get("text-offset").evaluate(B,{},y).map($t=>$t*Ir)}let dt=L?"center":T.get("text-justify").evaluate(B,{},y);const Ge=T.get("symbol-placement")==="point",yt=Ge?T.get("text-max-width").evaluate(B,{},y)*Ir:1/0,Ct=_t=>{s.allowVerticalPlacement&&tu(We)&&(ie.vertical=Ep(he,e,r,l,X,yt,qe,Ye,_t,Je,xe,Pi.vertical,!0,pe,re))};if(!L&&rt){const _t=dt==="auto"?rt.map(ht=>Mp(ht)):[dt];let $t=!1;for(let ht=0;ht<_t.length;ht++){const Rt=_t[ht];if(!ie.horizontal[Rt])if($t)ie.horizontal[Rt]=ie.horizontal[0];else{const Gt=Ep(he,e,r,l,X,yt,qe,"center",Rt,Je,xe,Pi.horizontal,!1,pe,re);Gt&&(ie.horizontal[Rt]=Gt,$t=Gt.positionedLines.length===1)}}Ct("left")}else{if(dt==="auto"&&(dt=Mp(Ye)),Ge||T.get("text-writing-mode").indexOf("horizontal")>=0||!tu(We)){const _t=Ep(he,e,r,l,X,yt,qe,Ye,dt,Je,xe,Pi.horizontal,!1,pe,re);_t&&(ie.horizontal[dt]=_t)}Ct(Ge?"left":dt)}}let Be=!1;if(B.icon&&B.icon.name){const We=a[B.icon.name];We&&(ye=Ew(l[B.icon.name],T.get("icon-offset").evaluate(B,{},y),T.get("icon-anchor").evaluate(B,{},y)),Be=We.sdf,s.sdfIcons===void 0?s.sdfIcons=We.sdf:s.sdfIcons!==We.sdf&&Ms("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(We.pixelRatio!==s.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const ze=Kx(ie.horizontal)||ie.vertical;s.iconsInText||(s.iconsInText=!!ze&&ze.iconsInText),(ze||ye)&&zw(s,B,ie,ye,a,P,pe,0,xe,Be,p,y,w)}h&&s.generateCollisionDebugBuffers(b,s.collisionBoxArray)}function Mp(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zw(s,e,r,a,l,h,p,y,b,w,T,A,P){let L=h.textMaxSize.evaluate(e,{},A);L===void 0&&(L=p);const R=s.layers[0].layout,B=R.get("icon-offset").evaluate(e,{},A),X=Kx(r.horizontal)||r.vertical,re=P.name==="globe",pe=Ir,ie=p/pe,he=s.tilePixelRatio*L/pe,ye=(Ye=s.overscaling,s.zoom>18&&Ye>2&&(Ye>>=1),Math.max(zt/(512*Ye),1)*R.get("symbol-spacing")),xe=R.get("text-padding")*s.tilePixelRatio,Be=R.get("icon-padding")*s.tilePixelRatio,ze=Ne(R.get("text-max-angle")),We=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ot=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",qe=R.get("symbol-placement"),Je=ye/2;var Ye;const rt=R.get("icon-text-fit");let dt;a&&rt!=="none"&&(s.allowVerticalPlacement&&r.vertical&&(dt=zx(a,r.vertical,rt,R.get("icon-text-fit-padding"),B,ie)),X&&(a=zx(a,X,rt,R.get("icon-text-fit-padding"),B,ie)));const Ge=(yt,Ct,_t)=>{if(Ct.x<0||Ct.x>=zt||Ct.y<0||Ct.y>=zt)return;let $t=null;if(re){const{x:ht,y:Rt,z:Gt}=P.projectTilePoint(Ct.x,Ct.y,_t);$t={anchor:new ca(ht,Rt,Gt,0,void 0),up:P.upVector(_t,Ct.x,Ct.y)}}(function(ht,Rt,Gt,ps,Zt,Bt,Rs,Xt,Kt,Es,Is,Ds,Cs,Vs,Zs,ur,ks,yr,dr,qs,xs,hr,Ls,si,mr){const Dr=ht.addToLineVertexArray(Rt,ps);let Er,ri,Cr,vn,Yl,Fu,Bu,ky=0,Ay=0,My=0,Py=0,Zp=-1,Wp=-1;const Fn={};let Iy=Vm("");const $o=Gt?Gt.anchor:Rt;let Hp=0,Xp=0;if(Kt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Hp,Xp]=Kt.layout.get("text-offset").evaluate(xs,{},mr).map(bi=>bi*Ir):(Hp=Kt.layout.get("text-radial-offset").evaluate(xs,{},mr)*Ir,Xp=Ap),ht.allowVerticalPlacement&&Zt.vertical){const bi=Zt.vertical;if(Zs)Fu=Pp(bi),Xt&&(Bu=Pp(Xt));else{const vi=Kt.layout.get("text-rotate").evaluate(xs,{},mr)+90;Cr=bh(Es,$o,Rt,Is,Ds,Cs,bi,Vs,vi,ur),Xt&&(vn=bh(Es,$o,Rt,Is,Ds,Cs,Xt,yr,vi))}}if(Bt){const bi=Kt.layout.get("icon-rotate").evaluate(xs,{},mr),vi=Kt.layout.get("icon-text-fit")!=="none",Uu=Zx(Bt,bi,Ls,vi),Qp=Xt?Zx(Xt,bi,Ls,vi):void 0;ri=bh(Es,$o,Rt,Is,Ds,Cs,Bt,yr,bi),ky=4*Uu.length;const Dy=ht.iconSizeData;let Go=null;Dy.kind==="source"?(Go=[yn*Kt.layout.get("icon-size").evaluate(xs,{},mr)],Go[0]>Fa&&Ms(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Mu}. Reduce your "icon-size".`)):Dy.kind==="composite"&&(Go=[yn*hr.compositeIconSizes[0].evaluate(xs,{},mr),yn*hr.compositeIconSizes[1].evaluate(xs,{},mr)],(Go[0]>Fa||Go[1]>Fa)&&Ms(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Mu}. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,Uu,Go,qs,dr,xs,!1,Gt,Rt,Dr.lineStartIndex,Dr.lineLength,-1,si,mr),Zp=ht.icon.placedSymbolArray.length-1,Qp&&(Ay=4*Qp.length,ht.addSymbols(ht.icon,Qp,Go,qs,dr,xs,Pi.vertical,Gt,Rt,Dr.lineStartIndex,Dr.lineLength,-1,si,mr),Wp=ht.icon.placedSymbolArray.length-1)}for(const bi in Zt.horizontal){const vi=Zt.horizontal[bi];Er||(Iy=Vm(vi.text),Zs?Yl=Pp(vi):Er=bh(Es,$o,Rt,Is,Ds,Cs,vi,Vs,Kt.layout.get("text-rotate").evaluate(xs,{},mr),ur));const Uu=vi.positionedLines.length===1;if(My+=Xx(ht,Gt,Rt,vi,Rs,Kt,Zs,xs,ur,Dr,Zt.vertical?Pi.horizontal:Pi.horizontalOnly,Uu?Object.keys(Zt.horizontal):[bi],Fn,Zp,hr,si,mr),Uu)break}Zt.vertical&&(Py+=Xx(ht,Gt,Rt,Zt.vertical,Rs,Kt,Zs,xs,ur,Dr,Pi.vertical,["vertical"],Fn,Wp,hr,si,mr));let Ga=-1;const Kp=(bi,vi)=>bi?Math.max(bi,vi):vi;Ga=Kp(Yl,Ga),Ga=Kp(Fu,Ga),Ga=Kp(Bu,Ga);const d1=Ga>-1?1:0;ht.glyphOffsetArray.length>=Ua.MAX_GLYPHS&&Ms("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xs.sortKey!==void 0&&ht.addToSortKeyRanges(ht.symbolInstances.length,xs.sortKey),ht.symbolInstances.emplaceBack($o.x,$o.y,$o.z,Rt.x,Rt.y,Fn.right>=0?Fn.right:-1,Fn.center>=0?Fn.center:-1,Fn.left>=0?Fn.left:-1,Fn.vertical>=0?Fn.vertical:-1,Zp,Wp,Iy,Er!==void 0?Er:ht.collisionBoxArray.length,Er!==void 0?Er+1:ht.collisionBoxArray.length,Cr!==void 0?Cr:ht.collisionBoxArray.length,Cr!==void 0?Cr+1:ht.collisionBoxArray.length,ri!==void 0?ri:ht.collisionBoxArray.length,ri!==void 0?ri+1:ht.collisionBoxArray.length,vn||ht.collisionBoxArray.length,vn?vn+1:ht.collisionBoxArray.length,Is,My,Py,ky,Ay,d1,0,Hp,Xp,Ga)})(s,Ct,$t,yt,r,a,l,dt,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,xe,We,b,0,Be,ot,B,e,h,w,T,A)};if(qe==="line")for(const yt of qx(e.geometry,0,0,zt,zt)){const Ct=kw(yt,ye,ze,r.vertical||X,a,pe,he,s.overscaling,zt);for(const _t of Ct)X&&Ow(s,X.text,Je,_t)||Ge(yt,_t,A)}else if(qe==="line-center"){for(const yt of e.geometry)if(yt.length>1){const Ct=Cw(yt,ze,r.vertical||X,a,pe,he);Ct&&Ge(yt,Ct,A)}}else if(e.type==="Polygon")for(const yt of yp(e.geometry,0)){const Ct=Iw(yt,16);Ge(yt[0],new ca(Ct.x,Ct.y,0,0,void 0),A)}else if(e.type==="LineString")for(const yt of e.geometry)Ge(yt,new ca(yt[0].x,yt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const yt of e.geometry)for(const Ct of yt)Ge([Ct],new ca(Ct.x,Ct.y,0,0,void 0),A)}const Mu=255,Fa=Mu*yn;function Xx(s,e,r,a,l,h,p,y,b,w,T,A,P,L,R,B,X){const re=function(he,ye,xe,Be,ze,We,ot,qe){const Je=[];if(ye.positionedLines.length===0)return Je;const Ye=Be.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,rt=function(_t){const $t=_t[0],ht=_t[1],Rt=$t*ht;return Rt>0?[$t,-ht]:Rt<0?[-$t,ht]:$t===0?[ht,$t]:[ht,-$t]}(xe);let dt=Math.abs(ye.top-ye.bottom);for(const _t of ye.positionedLines)dt-=_t.lineOffset;const Ge=ye.positionedLines.length,yt=dt/Ge;let Ct=ye.top-xe[1];for(let _t=0;_t<Ge;++_t){const $t=ye.positionedLines[_t];Ct=Aw(ye,yt,Ct,_t);for(const ht of $t.positionedGlyphs){if(!ht.rect)continue;const Rt=ht.rect||{};let Gt=kx+1,ps=!0,Zt=1,Bt=0;if(ht.imageName){const Ls=ot[ht.imageName];if(!Ls)continue;if(Ls.sdf){Ms("SDF images are not supported in formatted text and will be ignored.");continue}ps=!1,Zt=Ls.pixelRatio,Gt=ci/Zt}const Rs=(ze||qe)&&ht.vertical,Xt=ht.metrics.advance*ht.scale/2,Kt=ht.metrics,Es=ht.rect;if(Es===null)continue;qe&&ye.verticalizable&&(Bt=ht.imageName?Xt-ht.metrics.width*ht.scale/2:0);const Is=ze?[ht.x+Xt,ht.y]:[0,0];let Ds=[0,0],Cs=[0,0],Vs=!1;ze||(Rs?(Cs=[ht.x+Xt+rt[0],ht.y+rt[1]-Bt],Vs=!0):Ds=[ht.x+Xt+xe[0],ht.y+xe[1]-Bt]);const Zs=Es.w*ht.scale/(Zt*(ht.localGlyph?_n:1)),ur=Es.h*ht.scale/(Zt*(ht.localGlyph?_n:1));let ks,yr,dr,qs;if(Rs){const Ls=ht.y-Ct,si=new ke(-Xt,Xt-Ls),mr=-Math.PI/2,Dr=new ke(...Cs);ks=new ke(-Xt+Ds[0],Ds[1]),ks._rotateAround(mr,si)._add(Dr),ks.x+=-Ls+Xt,ks.y-=(Kt.left-Gt)*ht.scale;const Er=ht.imageName?Kt.advance*ht.scale:Ir*ht.scale,ri=String.fromCharCode(ht.glyph);dw(ri)?ks.x+=(1-Gt)*ht.scale:hw(ri)?ks.x+=Er-Kt.height*ht.scale+(-Gt-1)*ht.scale:ks.x+=ht.imageName||Kt.width+2*Gt===Es.w&&Kt.height+2*Gt===Es.h?(Er-ur)/2:(Er-(Kt.height+2*Gt)*ht.scale)/2,yr=new ke(ks.x,ks.y-Zs),dr=new ke(ks.x+ur,ks.y),qs=new ke(ks.x+ur,ks.y-Zs)}else{const Ls=(Kt.left-Gt)*ht.scale-Xt+Ds[0],si=(-Kt.top-Gt)*ht.scale+Ds[1],mr=Ls+Zs,Dr=si+ur;ks=new ke(Ls,si),yr=new ke(mr,si),dr=new ke(Ls,Dr),qs=new ke(mr,Dr)}if(Ye){let Ls;Ls=ze?new ke(0,0):Vs?new ke(rt[0],rt[1]):new ke(xe[0],xe[1]),ks._rotateAround(Ye,Ls),yr._rotateAround(Ye,Ls),dr._rotateAround(Ye,Ls),qs._rotateAround(Ye,Ls)}const xs=new ke(0,0),hr=new ke(0,0);Je.push({tl:ks,tr:yr,bl:dr,br:qs,tex:Rt,writingMode:ye.writingMode,glyphOffset:Is,sectionIndex:ht.sectionIndex,isSDF:ps,pixelOffsetTL:xs,pixelOffsetBR:hr,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,a,b,h,p,y,l,s.allowVerticalPlacement),pe=s.textSizeData;let ie=null;pe.kind==="source"?(ie=[yn*h.layout.get("text-size").evaluate(y,{},X)],ie[0]>Fa&&Ms(`${s.layerIds[0]}: Value for "text-size" is >= ${Mu}. Reduce your "text-size".`)):pe.kind==="composite"&&(ie=[yn*R.compositeTextSizes[0].evaluate(y,{},X),yn*R.compositeTextSizes[1].evaluate(y,{},X)],(ie[0]>Fa||ie[1]>Fa)&&Ms(`${s.layerIds[0]}: Value for "text-size" is >= ${Mu}. Reduce your "text-size".`)),s.addSymbols(s.text,re,ie,b,p,y,T,e,r,w.lineStartIndex,w.lineLength,L,B,X);for(const he of A)P[he]=s.text.placedSymbolArray.length-1;return 4*re.length}function Kx(s){for(const e in s)return s[e];return null}function bh(s,e,r,a,l,h,p,y,b,w){let T=p.top,A=p.bottom,P=p.left,L=p.right;const R=p.collisionPadding;if(R&&(P-=R[0],T-=R[1],L+=R[2],A+=R[3]),b){const B=new ke(P,T),X=new ke(L,T),re=new ke(P,A),pe=new ke(L,A),ie=Ne(b);let he=new ke(0,0);w&&(he=new ke(w[0],w[1])),B._rotateAround(ie,he),X._rotateAround(ie,he),re._rotateAround(ie,he),pe._rotateAround(ie,he),P=Math.min(B.x,X.x,re.x,pe.x),L=Math.max(B.x,X.x,re.x,pe.x),T=Math.min(B.y,X.y,re.y,pe.y),A=Math.max(B.y,X.y,re.y,pe.y)}return s.emplaceBack(e.x,e.y,e.z,r.x,r.y,P,T,L,A,y,a,l,h),s.length-1}function Pp(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function Ow(s,e,r,a){const l=s.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(a.dist(h[p])<r)return!0}else l[e]=[];return l[e].push(a),!1}function Qx(s,e){const r=s.fovAboveCenter,a=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,l=(s._camera.position[2]*s.worldSize-a)/Math.cos(s._pitch),h=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-s._pitch-r,.01)),p=Math.sin(s._pitch)*h+l;return Math.min(1.01*p,l*(1/s._horizonShift))}function Vo(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const r=Math.pow(2,-s.z),a=s.x*r,l=(s.x+1)*r,h=s.y*r,p=(s.y+1)*r,y=Mi(a),b=Mi(l),w=Vr(h),T=Vr(p),A=e.project(y,w),P=e.project(b,w),L=e.project(b,T),R=e.project(y,T);let B=Math.min(A.x,P.x,L.x,R.x),X=Math.min(A.y,P.y,L.y,R.y),re=Math.max(A.x,P.x,L.x,R.x),pe=Math.max(A.y,P.y,L.y,R.y);const ie=r/16;function he(xe,Be,ze,We,ot,qe){const Je=(ze+ot)/2,Ye=(We+qe)/2,rt=e.project(Mi(Je),Vr(Ye)),dt=Math.max(0,B-rt.x,X-rt.y,rt.x-re,rt.y-pe);B=Math.min(B,rt.x),re=Math.max(re,rt.x),X=Math.min(X,rt.y),pe=Math.max(pe,rt.y),dt>ie&&(he(xe,rt,ze,We,Je,Ye),he(rt,Be,Je,Ye,ot,qe))}he(A,P,a,h,l,h),he(P,L,l,h,l,p),he(L,R,l,p,a,p),he(R,A,a,p,a,h),B-=ie,X-=ie,re+=ie,pe+=ie;const ye=1/Math.max(re-B,pe-X);return{scale:ye,x:B*ye,y:X*ye,x2:re*ye,y2:pe*ye,projection:e}}const Fw=fn(new Float32Array(16));class Ba{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Ts(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return xn(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return Qx(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,l){const h=e.horizonLineFromTop(!1),p=new ke(r,Math.max(h,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}pointCoordinate3D(e,r,a){const l=new ke(r,a);if(e.elevation)return e.elevation.pointCoordinate(l);{const h=this.pointCoordinate(e,l.x,l.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return Fw}createTileMatrix(e,r,a){let l,h,p;const y=a.canonical,b=fn(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Vo(y,this);l=1,h=w.x+a.wrap*w.scale,p=w.y,Lo(b,b,[l/w.scale,l/w.scale,e.pixelsPerMeter/r])}else l=r/e.zoomScale(y.z),h=(y.x+Math.pow(2,y.z)*a.wrap)*l,p=y.y*l;return lu(b,b,[h,p,0]),Lo(b,b,[l/zt,l/zt,1]),b}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class Bw extends Ba{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Ne(r));this.n=(l+Math.sin(Ne(a)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:l,r0:h}=this,p=Ne(e-this.center[0]),y=Ne(r),b=Math.sqrt(l-2*a*Math.sin(y))/a;return{x:b*Math.sin(p*a),y:b*Math.cos(p*a)-h,z:0}}unproject(e,r){const{n:a,c:l,r0:h}=this,p=h+r;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const b=Ne(this.center[0])*a;y=ts(y,-Math.PI-b,Math.PI-b);const w=At(it(y/a)+this.center[0],-180,180),T=Math.asin(At((l-(e*e+p*p)*a*a)/(2*a),-1,1)),A=At(it(T),-qr,qr);return new Ts(w,A)}}const Pu=1.340264,Iu=-.081106,Du=893e-6,Lu=.003796,vh=Math.sqrt(3)/2;class Uw extends Ba{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(vh*Math.sin(r)),l=a*a,h=l*l*l;return{x:.5*(e*Math.cos(a)/(vh*(Pu+3*Iu*l+h*(7*Du+9*Lu*l)))/Math.PI+.5),y:1-.5*(a*(Pu+Iu*l+h*(Du+Lu*l))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=a*a,h=l*l*l;for(let T,A,P,L=0;L<12&&(A=a*(Pu+Iu*l+h*(Du+Lu*l))-r,P=Pu+3*Iu*l+h*(7*Du+9*Lu*l),T=A/P,a=At(a-T,-Math.PI/3,Math.PI/3),l=a*a,h=l*l*l,!(Math.abs(T)<1e-12));++L);const p=vh*e*(Pu+3*Iu*l+h*(7*Du+9*Lu*l))/Math.cos(a),y=Math.asin(Math.sin(a)/vh),b=At(180*p/Math.PI,-180,180),w=At(180*y/Math.PI,-qr,qr);return new Ts(b,w)}}class Vw extends Ba{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),l=At(360*(.5-r),-qr,qr);return new Ts(a,l)}}const Ql=Math.PI/2;function wh(s){return Math.tan((Ql+s)/2)}class qw extends Ba{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let l=Ne(r),h=Ne(a);this.southernCenter=l+h<0,this.southernCenter&&(l=-l,h=-h);const p=Math.cos(l),y=wh(l);this.n=l===h?Math.sin(l):Math.log(p/Math.cos(h))/Math.log(wh(h)/y),this.f=p*Math.pow(wh(l),this.n)/this.n}project(e,r){r=Ne(r),this.southernCenter&&(r=-r),e=Ne(e-this.center[0]);const a=1e-6,{n:l,f:h}=this;h>0?r<-Ql+a&&(r=-Ql+a):r>Ql-a&&(r=Ql-a);const p=h/Math.pow(wh(r),l);let y=p*Math.sin(l*e),b=h-p*Math.cos(l*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:l}=this,h=l-r,p=Math.sign(h),y=Math.sign(a)*Math.sqrt(e*e+h*h);let b=Math.atan2(e,Math.abs(h))*p;h*a<0&&(b-=Math.PI*Math.sign(e)*p);const w=At(it(b/a)+this.center[0],-180,180),T=At(it(2*Math.atan(Math.pow(l/y,1/a))-Ql),-qr,qr);return new Ts(w,this.southernCenter?-T:T)}}class Jx extends Ba{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Dn(e),y:Ln(r),z:0}}unproject(e,r){const a=Mi(e),l=Vr(r);return new Ts(a,l)}}const Yx=Ne(qr);class $w extends Ba{project(e,r){const a=(r=Ne(r))*r,l=a*a;return{x:.5*((e=Ne(e))*(.8707-.131979*a+l*(l*(.003971*a-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+l*(.028874*a-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=25,h=0,p=a*a;do{p=a*a;const w=p*p;h=(a*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-r)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),a=At(a-h,-Yx,Yx)}while(Math.abs(h)>1e-6&&--l>0);p=a*a;const y=At(it(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=it(a);return new Ts(y,b)}}const ey=Ne(qr);class Gw extends Ba{project(e,r){r=Ne(r),e=Ne(e);const a=Math.cos(r),l=2/Math.PI,h=Math.acos(a*Math.cos(e/2)),p=Math.sin(h)/h,y=.5*(e*l+2*a*Math.sin(e/2)/p)||0,b=.5*(r+Math.sin(r)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,h=25;const p=1e-6;let y=0,b=0;do{const w=Math.cos(l),T=Math.sin(l),A=2*T*w,P=T*T,L=w*w,R=Math.cos(a/2),B=Math.sin(a/2),X=2*R*B,re=B*B,pe=1-L*R*R,ie=pe?1/pe:0,he=pe?Math.acos(w*R)*Math.sqrt(1/pe):0,ye=.5*(2*he*w*B+2*a/Math.PI)-e,xe=.5*(he*T+l)-r,Be=.5*ie*(L*re+he*w*R*P)+1/Math.PI,ze=ie*(X*A/4-he*T*B),We=.125*ie*(A*B-he*T*L*X),ot=.5*ie*(P*R+he*re*w)+.5,qe=ze*We-ot*Be;y=(xe*ze-ye*ot)/qe,b=(ye*We-xe*Be)/qe,a=At(a-y,-Math.PI,Math.PI),l=At(l-b,-ey,ey)}while((Math.abs(y)>p||Math.abs(b)>p)&&--h>0);return new Ts(it(a),it(l))}}class ty extends Ba{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:l}=this;return{x:Ne(e)*l*a+.5,y:-Math.sin(Ne(r))/l*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:l}=this,h=-(r-.5)/a,p=At(it((e-.5)/a)/l,-180,180),y=Math.asin(At(h*l,-1,1)),b=At(it(y),-qr,qr);return new Ts(p,b)}}class Zw extends Jx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const l=gu(e,r,a);return Qs(l,l,xu(In(a))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,r){const a=Rl(r.lat,r.lng),l=Yr([],a),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;hu(a,a,l,xn(1,0)*zt*h);const p=fn(new Float64Array(16));return Do(p,e.pixelMatrix,e.globeMatrix),Qs(a,a,p),new ke(a[0],a[1])}pixelsPerMeter(e,r){return xn(1,0)*r}pixelSpaceConversion(e,r,a){const l=xn(1,e)*r,h=ds(xn(1,45)*r,l,a);return this.pixelsPerMeter(e,r)/h}createTileMatrix(e,r,a){const l=sp(In(a.canonical));return Do(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,r){const{center:a}=e,l=xu(In(r));return Kd(l,l,Ne(a.lng)),Zm(l,l,Ne(a.lat)),Lo(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,r,a,l){return Cg(e,r,a,!0)||new Ol(0,0)}pointCoordinate3D(e,r,a){const l=this.pointCoordinate(e,r,a,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,r){return!Cg(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(l,h){const p=l.cameraToCenterDistance,y=l._centerAltitude*h,b=l._camera,w=l._camera.forward(),T=na([],Ai([],w,-p),[0,0,y]),A=l.worldSize/(2*Math.PI),P=[0,0,-A],L=l.width/l.height,R=Math.tan(l.fovAboveCenter),B=Ai([],b.up(),R),X=Ai([],b.right(),R*L),re=Yr([],na([],na([],w,B),X)),pe=[];let ie;if(new Km(T,re).closestPointOnSphere(P,A,pe)){const he=na([],pe,P),ye=gn([],he,T);ie=Math.cos(l.fovAboveCenter)*cu(ye)}else{const he=gn([],T,P),ye=gn([],P,T);Yr(ye,ye);const xe=cu(he)-A;ie=Math.sqrt(xe*(xe+2*A));const Be=Math.acos(ie/(A+xe))-Math.acos(Gi(w,ye));ie*=Math.cos(Be)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=zl(e.zoom);if(a>0){const l=Qx(e,xn(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ds(r,l+h*(1-Math.cos(p)),Math.pow(a,10))}return r}upVector(e,r,a){return gu(r,a,e,1)}upVectorScale(e){return{metersToTile:Qd(Yd(In(e)))}}}function sy(s){const e=s.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new Jx(s);case"equirectangular":return new Vw(s);case"naturalEarth":return new $w(s);case"equalEarth":return new Uw(s);case"winkelTripel":return new Gw(s);case"albers":return r?new ty(s):new Bw(s);case"lambertConformalConic":return r?new ty(s):new qw(s);case"globe":return new Zw(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Ww=ch.types,Hw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jh(s,e,r,a,l,h,p,y,b,w,T,A,P){const L=y?Math.min(Fa,Math.round(y[0])):0,R=y?Math.min(Fa,Math.round(y[1])):0;s.emplaceBack(e,r,Math.round(32*a),Math.round(32*l),h,p,(L<<1)+(b?1:0),R,16*w,16*T,256*A,256*P)}function Nh(s,e,r,a,l,h,p){s.emplaceBack(e,r,a,l,h,p)}function Sh(s,e,r,a,l){s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l)}function Xw(s){for(const e of s.sections)if(Um(e.text))return!0;return!1}class Ip{constructor(e){this.layoutVertexArray=new st,this.indexArray=new Pt,this.programConfigurations=e,this.segments=new lr,this.dynamicLayoutVertexArray=new nt,this.opacityVertexArray=new Dt,this.placedSymbolArray=new or,this.globeExtVertexArray=new ct}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,nw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Hw,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,iw.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}St(Ip,"SymbolBuffers");class Dp{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new lr,this.collisionVertexArray=new is,this.collisionVertexArrayExt=new es}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,aw.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ow.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}St(Dp,"CollisionBuffers");class Ua{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fn([]),this.placementViewportMatrix=fn([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wp(this.zoom,r["text-size"]),this.iconSizeData=wp(this.zoom,r["icon-size"]);const a=this.layers[0].layout,l=a.get("symbol-sort-key"),h=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>Pi[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Ip(new Io(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ip(new Io(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Jr,this.lineVertexArray=new Ml,this.symbolInstances=new Os}calculateGlyphDependencies(e,r,a,l,h){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,l&&h){const y=Cu[e.charAt(p)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,a,l){const h=this.layers[0],p=h.layout,y=this.projection.name==="globe",b=p.get("text-font"),w=p.get("text-field"),T=p.get("icon-image"),A=(w.value.kind!=="constant"||w.value.value instanceof Qr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),P=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!A&&!P)return;const R=r.iconDependencies,B=r.glyphDependencies,X=r.availableImages,re=new C(this.zoom);for(const{feature:pe,id:ie,index:he,sourceLayerIndex:ye}of e){const xe=h._featureFilter.needGeometry,Be=Fo(pe,xe);if(!h._featureFilter.filter(re,Be,a))continue;if(xe||(Be.geometry=aa(pe,a,l)),y&&pe.type!==1&&a.z<=5){const qe=Be.geometry,Je=.98078528056,Ye=(rt,dt)=>Gi(gu(rt.x,rt.y,a,1),gu(dt.x,dt.y,a,1))<Je;for(let rt=0;rt<qe.length;rt++)qe[rt]=nv(qe[rt],Ye)}let ze,We;if(A){const qe=h.getValueAndResolveTokens("text-field",Be,a,X),Je=Qr.factory(qe);Xw(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||_()==="unavailable"||this.hasRTLText&&S.isParsed())&&(ze=uw(Je,h,Be))}if(P){const qe=h.getValueAndResolveTokens("icon-image",Be,a,X);We=qe instanceof pi?qe:pi.fromString(qe)}if(!ze&&!We)continue;const ot=this.sortFeaturesByKey?L.evaluate(Be,{},a):void 0;if(this.features.push({id:ie,text:ze,icon:We,index:he,sourceLayerIndex:ye,geometry:Be.geometry,properties:pe.properties,type:Ww[pe.type],sortKey:ot}),We&&(R[We.name]=!0),ze){const qe=b.evaluate(Be,{},a).join(","),Je=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pi.vertical)>=0;for(const Ye of ze.sections)if(Ye.image)R[Ye.image.name]=!0;else{const rt=tu(ze.toString()),dt=Ye.fontStack||qe,Ge=B[dt]=B[dt]||{};this.calculateGlyphDependencies(Ye.text,Ge,Je,this.allowVerticalPlacement,rt)}}}p.get("symbol-placement")==="line"&&(this.features=function(pe){const ie={},he={},ye=[];let xe=0;function Be(qe){ye.push(pe[qe]),xe++}function ze(qe,Je,Ye){const rt=he[qe];return delete he[qe],he[Je]=rt,ye[rt].geometry[0].pop(),ye[rt].geometry[0]=ye[rt].geometry[0].concat(Ye[0]),rt}function We(qe,Je,Ye){const rt=ie[Je];return delete ie[Je],ie[qe]=rt,ye[rt].geometry[0].shift(),ye[rt].geometry[0]=Ye[0].concat(ye[rt].geometry[0]),rt}function ot(qe,Je,Ye){const rt=Ye?Je[0][Je[0].length-1]:Je[0][0];return`${qe}:${rt.x}:${rt.y}`}for(let qe=0;qe<pe.length;qe++){const Je=pe[qe],Ye=Je.geometry,rt=Je.text?Je.text.toString():null;if(!rt){Be(qe);continue}const dt=ot(rt,Ye),Ge=ot(rt,Ye,!0);if(dt in he&&Ge in ie&&he[dt]!==ie[Ge]){const yt=We(dt,Ge,Ye),Ct=ze(dt,Ge,ye[yt].geometry);delete ie[dt],delete he[Ge],he[ot(rt,ye[Ct].geometry,!0)]=Ct,ye[yt].geometry=null}else dt in he?ze(dt,Ge,Ye):Ge in ie?We(dt,Ge,Ye):(Be(qe),ie[dt]=xe-1,he[Ge]=xe-1)}return ye.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,ie)=>pe.sortKey-ie.sortKey)}update(e,r,a,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=sy(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:h}of r)this.lineVertexArray.emplaceBack(l,h);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,l,h,p,y,b,w,T,A,P,L,R){const B=e.indexArray,X=e.layoutVertexArray,re=e.globeExtVertexArray,pe=e.segments.prepareSegment(4*r.length,X,B,this.canOverlap?p.sortKey:void 0),ie=this.glyphOffsetArray.length,he=pe.vertexLength,ye=this.allowVerticalPlacement&&y===Pi.vertical?Math.PI/2:0,xe=p.text&&p.text.sections;for(let ze=0;ze<r.length;ze++){const{tl:We,tr:ot,bl:qe,br:Je,tex:Ye,pixelOffsetTL:rt,pixelOffsetBR:dt,minFontScaleX:Ge,minFontScaleY:yt,glyphOffset:Ct,isSDF:_t,sectionIndex:$t}=r[ze],ht=pe.vertexLength,Rt=Ct[1];if(jh(X,w.x,w.y,We.x,Rt+We.y,Ye.x,Ye.y,a,_t,rt.x,rt.y,Ge,yt),jh(X,w.x,w.y,ot.x,Rt+ot.y,Ye.x+Ye.w,Ye.y,a,_t,dt.x,rt.y,Ge,yt),jh(X,w.x,w.y,qe.x,Rt+qe.y,Ye.x,Ye.y+Ye.h,a,_t,rt.x,dt.y,Ge,yt),jh(X,w.x,w.y,Je.x,Rt+Je.y,Ye.x+Ye.w,Ye.y+Ye.h,a,_t,dt.x,dt.y,Ge,yt),b){const{x:Gt,y:ps,z:Zt}=b.anchor,[Bt,Rs,Xt]=b.up;Nh(re,Gt,ps,Zt,Bt,Rs,Xt),Nh(re,Gt,ps,Zt,Bt,Rs,Xt),Nh(re,Gt,ps,Zt,Bt,Rs,Xt),Nh(re,Gt,ps,Zt,Bt,Rs,Xt),Sh(e.dynamicLayoutVertexArray,Gt,ps,Zt,ye)}else Sh(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ye);B.emplaceBack(ht,ht+1,ht+2),B.emplaceBack(ht+1,ht+2,ht+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),ze!==r.length-1&&$t===r[ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,p,p.index,{},L,R,xe&&xe[$t])}const Be=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Be.x,Be.y,Be.z,w.x,w.y,ie,this.glyphOffsetArray.length-ie,he,T,A,w.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],y,0,!1,0,P,0)}_commitLayoutVertex(e,r,a,l,h,p,y){e.emplaceBack(r,a,l,h,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,a,l,h,p,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),w=b.vertexLength,T=y.tileAnchorX,A=y.tileAnchorY;for(let L=0;L<4;L++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,T,A,new ke(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,T,A,new ke(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,T,A,new ke(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,T,A,new ke(e.x1,e.y2)),b.vertexLength+=4;const P=a.indexArray;P.emplaceBack(w,w+1),P.emplaceBack(w+1,w+2),P.emplaceBack(w+2,w+3),P.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),w=this.getSymbolInstanceTextSize(e,p,r,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),w=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dp(Et,vx.members,Tr),this.iconCollisionBox=new Dp(Et,vx.members,Tr);const a=ql(this.iconSizeData,e),l=ql(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,r,a,l){const h=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),p=mh(this.textSizeData,e,h)/Ir;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,a){const l=this.icon.placedSymbolArray.get(a),h=mh(this.iconSizeData,e,l);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,r,a){e.emplaceBack(r,-a,-a),e.emplaceBack(r,a,-a),e.emplaceBack(r,a,a),e.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),w=this.getSymbolInstanceTextSize(e,p,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),w=this.getSymbolInstanceIconSize(e,r,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,b.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=ql(this.iconSizeData,e),l=ql(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,l,h,p,y,b,w){const T={};if(r<a){const{x1:A,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:he,featureIndex:ye}=e.get(r);T.textBox={x1:A,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:he},T.textFeatureIndex=ye}if(l<h){const{x1:A,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:he,featureIndex:ye}=e.get(l);T.verticalTextBox={x1:A,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:he},T.verticalTextFeatureIndex=ye}if(p<y){const{x1:A,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:he,featureIndex:ye}=e.get(p);T.iconBox={x1:A,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:he},T.iconFeatureIndex=ye}if(b<w){const{x1:A,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:he,featureIndex:ye}=e.get(b);T.verticalIconBox={x1:A,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:he},T.verticalIconFeatureIndex=ye}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let h=a.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),l=[],h=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const b=this.symbolInstances.get(y);l.push(0|Math.round(r*b.tileAnchorX+a*b.tileAnchorY)),h.push(b.featureIndex)}return p.sort((y,b)=>l[y]-l[b]||h[b]-h[y]),p}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:w}=a;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&p!==l&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}St(Ua,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ua.MAX_GLYPHS=65535,Ua.addDynamicAttributes=Sh;const Kw=new ce({"symbol-placement":new F(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new F(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new F(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new K(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new F(Ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new F(Ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new F(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new F(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new F(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new K(Ze.layout_symbol["icon-size"]),"icon-text-fit":new F(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new F(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new K(Ze.layout_symbol["icon-image"]),"icon-rotate":new K(Ze.layout_symbol["icon-rotate"]),"icon-padding":new F(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new F(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new K(Ze.layout_symbol["icon-offset"]),"icon-anchor":new K(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new F(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new F(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new F(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new K(Ze.layout_symbol["text-field"]),"text-font":new K(Ze.layout_symbol["text-font"]),"text-size":new K(Ze.layout_symbol["text-size"]),"text-max-width":new K(Ze.layout_symbol["text-max-width"]),"text-line-height":new K(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new K(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new K(Ze.layout_symbol["text-justify"]),"text-radial-offset":new K(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new F(Ze.layout_symbol["text-variable-anchor"]),"text-anchor":new K(Ze.layout_symbol["text-anchor"]),"text-max-angle":new F(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new F(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new K(Ze.layout_symbol["text-rotate"]),"text-padding":new F(Ze.layout_symbol["text-padding"]),"text-keep-upright":new F(Ze.layout_symbol["text-keep-upright"]),"text-transform":new K(Ze.layout_symbol["text-transform"]),"text-offset":new K(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new F(Ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new F(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new F(Ze.layout_symbol["text-optional"])});var Lp={paint:new ce({"icon-opacity":new K(Ze.paint_symbol["icon-opacity"]),"icon-color":new K(Ze.paint_symbol["icon-color"]),"icon-halo-color":new K(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new K(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new K(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new F(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new F(Ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new K(Ze.paint_symbol["text-opacity"]),"text-color":new K(Ze.paint_symbol["text-color"],{runtimeType:oi,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new K(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new K(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new K(Ze.paint_symbol["text-halo-blur"]),"text-translate":new F(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new F(Ze.paint_symbol["text-translate-anchor"])}),layout:Kw};class ry{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}St(ry,"FormatSectionOverride",{omit:["defaultValue"]});class Th extends pn{constructor(e){super(e,Lp)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const l=[];for(const h of a)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,l){const h=this.layout.get(e).evaluate(r,{},a,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ka(p.value)||!h?h:function(y,b){return b.replace(/{([^{}]+)}/g,(w,T)=>T in y?String(y[T]):"")}(r.properties,h)}createBucket(e){return new Ua(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Lp.paint.overridableProperties){if(!Th.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new ry(r),l=new jl(a,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new $c("source",l):new No("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new J(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Th.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),l=Lp.paint.properties[r];let h=!1;const p=y=>{for(const b of y)if(l.overrides&&l.overrides.hasOverride(b))return void(h=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Qr)p(a.value.value.sections);else if(a.value.kind==="source"){const y=w=>{h||(w instanceof Hn&&Gs(w.value)===ao?p(w.value.sections):w instanceof kn?p(w.sections):w.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return h}getProgramConfiguration(e){return new Ra(this,e)}}var Qw={paint:new ce({"background-color":new F(Ze.paint_background["background-color"]),"background-pattern":new F(Ze.paint_background["background-pattern"]),"background-opacity":new F(Ze.paint_background["background-opacity"])})},Jw={paint:new ce({"raster-opacity":new F(Ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new F(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new F(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new F(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new F(Ze.paint_raster["raster-saturation"]),"raster-contrast":new F(Ze.paint_raster["raster-contrast"]),"raster-resampling":new F(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new F(Ze.paint_raster["raster-fade-duration"])})};class Yw extends pn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var e1={paint:new ce({"sky-type":new F(Ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new F(Ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new F(Ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new F(Ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new F(Ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new ne(Ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new F(Ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new F(Ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new F(Ze.paint_sky["sky-opacity"])})};function Rp(s,e,r){const a=[0,0,1],l=wg([]);return Ng(l,l,r?-Ne(s)+Math.PI:Ne(s)),jg(l,l,-Ne(e)),yg(a,a,l),Yr(a,a)}const t1={circle:class extends pn{constructor(s){super(s,hv)}createBucket(s){return new lp(s)}queryRadius(s){const e=s;return Fl("circle-radius",this,e)+Fl("circle-stroke-width",this,e)+sh(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,r,a,l,h,p,y){const b=Zg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Wg(s,a,h,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Ra(this,s)}},heatmap:class extends pn{createBucket(s){return new Xg(s)}constructor(s){super(s,gv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Fl("heatmap-radius",this,s)}queryIntersectsFeature(s,e,r,a,l,h,p,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return Wg(s,a,h,p,y,!0,!0,new ke(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Ra(this,s)}},hillshade:class extends pn{constructor(s){super(s,xv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends pn{constructor(s){super(s,Iv)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(s){return new Ra(this,s)}recalculate(s,e){super.recalculate(s,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new oh(s)}queryRadius(){return sh(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,r,a,l,h){return!s.queryGeometry.isAboveHorizon&&Ug(Gg(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends pn{constructor(s){super(s,Xv)}createBucket(s){return new Su(s)}queryRadius(){return sh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Ra(this,s)}queryIntersectsFeature(s,e,r,a,l,h,p,y,b){const w=Zg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,r),A=this.paint.get("fill-extrusion-base").evaluate(e,r),P=[0,0],L=y&&h.elevation,R=h.elevation?h.elevation.exaggeration():1,B=s.tile.getBucket(this);if(L&&B instanceof Su){const he=B.centroidVertexArray,ye=b+1;ye<he.length&&(P[0]=he.geta_centroid_pos0(ye),P[1]=he.geta_centroid_pos1(ye))}if(P[0]===0&&P[1]===1)return!1;h.projection.name==="globe"&&(a=mx([a],[new ke(0,0),new ke(zt,zt)],s.tileID.canonical).map(he=>he.polygon).flat());const X=L?y:null,[re,pe]=function(he,ye,xe,Be,ze,We,ot,qe,Je,Ye,rt){return he.projection.name==="globe"?function(dt,Ge,yt,Ct,_t,$t,ht,Rt,Gt,ps,Zt){const Bt=[],Rs=[],Xt=dt.projection.upVectorScale(Zt,dt.center.lat,dt.worldSize).metersToTile,Kt=[0,0,0,1],Es=[0,0,0,1],Is=(Cs,Vs,Zs,ur)=>{Cs[0]=Vs,Cs[1]=Zs,Cs[2]=ur,Cs[3]=1},Ds=hx();yt>0&&(yt+=Ds),Ct+=Ds;for(const Cs of Ge){const Vs=[],Zs=[];for(const ur of Cs){const ks=ur.x+_t.x,yr=ur.y+_t.y,dr=dt.projection.projectTilePoint(ks,yr,Zt),qs=dt.projection.upVector(Zt,ur.x,ur.y);let xs=yt,hr=Ct;if(ht){const Ls=xx(ks,yr,yt,Ct,ht,Rt,Gt,ps);xs+=Ls.base,hr+=Ls.top}yt!==0?Is(Kt,dr.x+qs[0]*Xt*xs,dr.y+qs[1]*Xt*xs,dr.z+qs[2]*Xt*xs):Is(Kt,dr.x,dr.y,dr.z),Is(Es,dr.x+qs[0]*Xt*hr,dr.y+qs[1]*Xt*hr,dr.z+qs[2]*Xt*hr),Qs(Kt,Kt,$t),Qs(Es,Es,$t),Vs.push(new Vl(Kt[0],Kt[1],Kt[2])),Zs.push(new Vl(Es[0],Es[1],Es[2]))}Bt.push(Vs),Rs.push(Zs)}return[Bt,Rs]}(he,ye,xe,Be,ze,We,ot,qe,Je,Ye,rt):ot?function(dt,Ge,yt,Ct,_t,$t,ht,Rt,Gt){const ps=[],Zt=[],Bt=[0,0,0,1];for(const Rs of dt){const Xt=[],Kt=[];for(const Es of Rs){const Is=Es.x+Ct.x,Ds=Es.y+Ct.y,Cs=xx(Is,Ds,Ge,yt,$t,ht,Rt,Gt);Bt[0]=Is,Bt[1]=Ds,Bt[2]=Cs.base,Bt[3]=1,Ro(Bt,Bt,_t),Bt[3]=Math.max(Bt[3],1e-5);const Vs=new Vl(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Bt[0]=Is,Bt[1]=Ds,Bt[2]=Cs.top,Bt[3]=1,Ro(Bt,Bt,_t),Bt[3]=Math.max(Bt[3],1e-5);const Zs=new Vl(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Xt.push(Vs),Kt.push(Zs)}ps.push(Xt),Zt.push(Kt)}return[ps,Zt]}(ye,xe,Be,ze,We,ot,qe,Je,Ye):function(dt,Ge,yt,Ct,_t){const $t=[],ht=[],Rt=_t[8]*Ge,Gt=_t[9]*Ge,ps=_t[10]*Ge,Zt=_t[11]*Ge,Bt=_t[8]*yt,Rs=_t[9]*yt,Xt=_t[10]*yt,Kt=_t[11]*yt;for(const Es of dt){const Is=[],Ds=[];for(const Cs of Es){const Vs=Cs.x+Ct.x,Zs=Cs.y+Ct.y,ur=_t[0]*Vs+_t[4]*Zs+_t[12],ks=_t[1]*Vs+_t[5]*Zs+_t[13],yr=_t[2]*Vs+_t[6]*Zs+_t[14],dr=_t[3]*Vs+_t[7]*Zs+_t[15],qs=ur+Rt,xs=ks+Gt,hr=yr+ps,Ls=Math.max(dr+Zt,1e-5),si=ur+Bt,mr=ks+Rs,Dr=yr+Xt,Er=Math.max(dr+Kt,1e-5);Is.push(new Vl(qs/Ls,xs/Ls,hr/Ls)),Ds.push(new Vl(si/Er,mr/Er,Dr/Er))}$t.push(Is),ht.push(Ds)}return[$t,ht]}(ye,xe,Be,ze,We)}(h,a,A,T,w,p,X,P,R,h.center.lat,s.tileID.canonical),ie=s.queryGeometry;return function(he,ye,xe){let Be=1/0;Ug(xe,ye)&&(Be=gx(xe,ye[0]));for(let ze=0;ze<ye.length;ze++){const We=ye[ze],ot=he[ze];for(let qe=0;qe<We.length-1;qe++){const Je=We[qe],Ye=[Je,We[qe+1],ot[qe+1],ot[qe],Je];Bg(xe,Ye)&&(Be=Math.min(Be,gx(xe,Ye)))}}return Be!==1/0&&Be}(re,pe,ie.isPointQuery()?ie.screenBounds:ie.screenGeometry)}},line:class extends pn{constructor(s){super(s,yx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Mc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=_x.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new hh(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Ra(this,s)}queryRadius(s){const e=s,r=bx(Fl("line-width",this,e),Fl("line-gap-width",this,e)),a=Fl("line-offset",this,e);return r/2+Math.abs(a)+sh(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,r,a,l,h){if(s.queryGeometry.isAboveHorizon)return!1;const p=Gg(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),y=s.pixelToTileUnitsFactor/2*bx(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(a=function(w,T){const A=[],P=new ke(0,0);for(let L=0;L<w.length;L++){const R=w[L],B=[];for(let X=0;X<R.length;X++){const re=R[X],pe=R[X+1],ie=X===0?P:re.sub(R[X-1])._unit()._perp(),he=X===R.length-1?P:pe.sub(re)._unit()._perp(),ye=ie._add(he)._unit();ye._mult(1/(ye.x*he.x+ye.y*he.y)),B.push(ye._mult(T)._add(re))}A.push(B)}return A}(a,b*s.pixelToTileUnitsFactor)),function(w,T,A){for(let P=0;P<T.length;P++){const L=T[P];if(w.length>=3){for(let R=0;R<L.length;R++)if(Bo(w,L[R]))return!0}if(lv(w,L,A))return!0}return!1}(p,a,y)}isTileClipped(){return!0}},symbol:Th,background:class extends pn{constructor(s){super(s,Qw)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends pn{constructor(s){super(s,Jw)}getProgramIds(){return["raster"]}},sky:class extends pn{constructor(s){super(s,e1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=hp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),l=!a,h=s.style.light,p=h.properties.get("position");return l&&h.properties.get("anchor")==="viewport"&&Ms("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Rp(p.azimuthal,90-p.polar,e):Rp(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Rp(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class Ru{constructor(e,r,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,a){const{width:l,height:h}=e,{context:p}=this,{gl:y}=p,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:T,ImageData:A,ImageBitmap:P}=M;if(y.bindTexture(y.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===l&&this.size[1]===h){const{x:L,y:R}=a||{x:0,y:0};e instanceof b||e instanceof w||e instanceof T||e instanceof A||P&&e instanceof P?y.texSubImage2D(y.TEXTURE_2D,0,L,R,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,L,R,l,h,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[l,h],e instanceof b||e instanceof w||e instanceof T||e instanceof A||P&&e instanceof P?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,l,h,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class s1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class r1{constructor(){this.tasks={},this.taskQueue=[],Rr(["process"],this),this.invoker=new s1(this.process),this.nextId=0}add(e,r){const a=this.nextId++,l=function({type:h,isSymbolTile:p,zoom:y}){return y=y||0,h==="message"?0:h!=="maybePrepare"||p?h!=="parseTile"||p?h==="parseTile"&&p?300-y:h==="maybePrepare"&&p?400-y:500:200-y:100-y}(r);if(l===0){ns();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:r,priority:l,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){ns();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const h=this.tasks[this.taskQueue[l]];h.priority<r&&(r=h.priority,e=l)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class iy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const i1=["tile","layer","source","sourceLayer","state"];class ny{constructor(e,r,a,l,h){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of i1)this[r]!==void 0&&(e[r]=this[r]);return e}}const Hi=32,Rn=33,Va=new Uint16Array(8184);for(let s=0;s<2046;s++){let e=s+2,r=0,a=0,l=0,h=0,p=0,y=0;for(1&e?l=h=p=Hi:r=a=y=Hi;(e>>=1)>1;){const w=r+l>>1,T=a+h>>1;1&e?(l=r,h=a,r=p,a=y):(r=l,a=h,l=p,h=y),p=w,y=T}const b=4*s;Va[b+0]=r,Va[b+1]=a,Va[b+2]=l,Va[b+3]=h}const zn=new Uint16Array(2178),qa=new Uint8Array(1089),Eh=new Uint16Array(1089);function ay(s){return s===0?-.03125:s===32?.03125:0}var oy=Ae([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ly={type:2,extent:zt,loadGeometry:()=>[[new ke(0,0),new ke(zt+1,0),new ke(zt+1,zt+1),new ke(0,zt+1),new ke(0,0)]]};class zp{constructor(e,r,a,l,h){this.tileID=e,this.uid=$r(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<tn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Vo(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const p={};if(!h)return p;for(const y of l){const b=y.layerIds.map(w=>h.getLayer(w)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(T=>T.id===w)[0]));for(const w of b)p[w.id]=y}}return p}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Ua){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Ua&&h.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||_()!=="deferred"||j();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ss}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ru(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ru(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ru(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,l,h,p,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:y,transform:p,params:h,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),h=r?r.sourceLayer:"",p=l._geojsonTileLayer||l[h];if(!p)return;const y=El(r&&r.filter),{z:b,x:w,y:T}=this.tileID.canonical,A={z:b,x:w,y:T};for(let P=0;P<p.length;P++){const L=p.feature(P);if(y.needGeometry){const X=Fo(L,!0);if(!y.filter(new C(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!y.filter(new C(this.tileID.overscaledZ),L))continue;const R=a.getId(L,h),B=new ny(L,b,w,T,R);B.tile=A,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=be(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const h=this.expirationTime-r;h?this.expirationTime=a+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const a=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const p=this.buckets[h],y=p.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],w=e[y];if(!b||!w||Object.keys(w).length===0)continue;if(p.update(w,b,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof hh||p instanceof oh){const A=r.style._getSourceCache(p.layers[0].source);r._terrain&&r._terrain.enabled&&A&&p.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(A.id,this.tileID)}const T=r&&r.style&&r.style.getLayer(h);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<tn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=tn.now()+e}setTexture(e,r){const a=r.context,l=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ru(a,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,r){const a={};for(const l of r)a[l]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const l=this.dependencies[a];if(l){for(const h of r)if(l[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const a=aa(ly,this.tileID.canonical,this.tileTransform)[0],l=new at,h=new xi;for(let p=0;p<a.length;p++){const{x:y,y:b}=a[p];l.emplaceBack(y,b),h.emplaceBack(p)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(l,pu.members),this._tileDebugSegments=lr.simpleSegment(0,0,l.length,h.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const a=aa(ly,this.tileID.canonical,this.tileTransform)[0];let l,h;if(this.isRaster){const p=function(y,b){const w=Vo(y,b),T=Math.pow(2,y.z);for(let X=0;X<Rn;X++)for(let re=0;re<Rn;re++){const pe=Mi((y.x+(re+ay(re))/Hi)/T),ie=Vr((y.y+(X+ay(X))/Hi)/T),he=b.project(pe,ie),ye=X*Rn+re;zn[2*ye+0]=Math.round((he.x*w.scale-w.x)*zt),zn[2*ye+1]=Math.round((he.y*w.scale-w.y)*zt)}qa.fill(0),Eh.fill(0);for(let X=2045;X>=0;X--){const re=4*X,pe=Va[re+0],ie=Va[re+1],he=Va[re+2],ye=Va[re+3],xe=pe+he>>1,Be=ie+ye>>1,ze=xe+Be-ie,We=Be+pe-xe,ot=ie*Rn+pe,qe=ye*Rn+he,Je=Be*Rn+xe,Ye=Math.hypot((zn[2*ot+0]+zn[2*qe+0])/2-zn[2*Je+0],(zn[2*ot+1]+zn[2*qe+1])/2-zn[2*Je+1])>=16;qa[Je]=qa[Je]||(Ye?1:0),X<1022&&(qa[Je]=qa[Je]||qa[(ie+We>>1)*Rn+(pe+ze>>1)]||qa[(ye+We>>1)*Rn+(he+ze>>1)])}const A=new Qe,P=new Pt;let L=0;function R(X,re){const pe=re*Rn+X;return Eh[pe]===0&&(A.emplaceBack(zn[2*pe+0],zn[2*pe+1],X*zt/Hi,re*zt/Hi),Eh[pe]=++L),Eh[pe]-1}function B(X,re,pe,ie,he,ye){const xe=X+pe>>1,Be=re+ie>>1;if(Math.abs(X-he)+Math.abs(re-ye)>1&&qa[Be*Rn+xe])B(he,ye,X,re,xe,Be),B(pe,ie,he,ye,xe,Be);else{const ze=R(X,re),We=R(pe,ie),ot=R(he,ye);P.emplaceBack(ze,We,ot)}}return B(0,0,Hi,Hi,Hi,0),B(Hi,Hi,0,0,0,Hi),{vertices:A,indices:P}}(this.tileID.canonical,r);l=p.vertices,h=p.indices}else{l=new Qe,h=new Pt;for(const{x:y,y:b}of a)l.emplaceBack(y,b,0,0);const p=xp(l.int16,void 0,4);for(let y=0;y<p.length;y+=3)h.emplaceBack(p[y],p[y+1],p[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,oy.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=lr.simpleSegment(0,0,l.length,h.length)}_makeGlobeTileDebugBuffers(e,r){const a=r.projection;if(!a||a.name!=="globe"||r.freezeTileCoverage)return;const l=this.tileID.canonical,h=xu(kg(l,r)),p=zl(r.zoom);let y;p>0&&(y=Gm(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,r,h,y,p),this._makeGlobeTileDebugTextBuffer(e,l,r,h,y,p)}_globePoint(e,r,a,l,h,p,y){let b=gu(e,r,a);if(p){const w=1<<a.z,T=Dn(l.center.lng),A=Ln(l.center.lat),P=(a.x+.5)/w-T;let L=0;P>.5?L=-1:P<-.5&&(L=1);let R=(e/zt+a.x)/w+L,B=(r/zt+a.y)/w;R=(R-T)*l._pixelsPerMercatorPixel+T,B=(B-A)*l._pixelsPerMercatorPixel+A;const X=[R*l.worldSize,B*l.worldSize,0];Qs(X,X,p),b=Oo(b,X,y)}return Qs(b,b,h)}_makeGlobeTileDebugBorderBuffer(e,r,a,l,h,p){const y=new at,b=new xi,w=new Re,T=(P,L,R,B,X)=>{const re=(R-P)/(X-1),pe=(B-L)/(X-1),ie=y.length;for(let he=0;he<X;he++){const ye=P+he*re,xe=L+he*pe;y.emplaceBack(ye,xe);const Be=this._globePoint(ye,xe,r,a,l,h,p);w.emplaceBack(Be[0],Be[1],Be[2]),b.emplaceBack(ie+he)}},A=zt;T(0,0,A,0,16),T(A,0,A,A,16),T(A,A,0,A,16),T(0,A,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,pu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,Tg.members),this._tileDebugSegments=lr.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,r,a,l,h,p){const y=zt/4,b=new at,w=new Pt,T=new Re,A=25;w.reserve(32),b.reserve(A),T.reserve(A);const P=(L,R)=>A*L+R;for(let L=0;L<A;L++){const R=L*y;for(let B=0;B<A;B++){const X=B*y;b.emplaceBack(X,R);const re=this._globePoint(X,R,r,a,l,h,p);T.emplaceBack(re[0],re[1],re[2])}}for(let L=0;L<4;L++)for(let R=0;R<4;R++){const B=P(L,R),X=P(L,R+1),re=P(L+1,R),pe=P(L+1,R+1);w.emplaceBack(B,X,re),w.emplaceBack(re,X,pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(b,pu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,Tg.members),this._tileDebugTextSegments=lr.simpleSegment(0,0,A,32)}}class n1{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},bs(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])a[h]||(this.deletedStates[e][l][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),l=bs({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][r];if(h===null)return{};for(const p in h)delete l[p]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const p in this.stateChanges[l])this.state[l][p]||(this.state[l][p]={}),bs(this.state[l][p],this.stateChanges[l][p]),h[p]=this.state[l][p];a[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const p in this.state[l])h[p]={},this.state[l][p]={};else for(const p in this.deletedStates[l]){if(this.deletedStates[l][p]===null)this.state[l][p]={};else if(this.state[l][p])for(const y of Object.keys(this.deletedStates[l][p]))delete this.state[l][p][y];h[p]=this.state[l][p]}a[l]=a[l]||{},bs(a[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,r)}}class cy{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function uy(s,e,r,a){let l=0,h=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(r[p]<s[p]||r[p]>e[p])return null}else{const y=1/a[p];let b=(s[p]-r[p])*y,w=(e[p]-r[p])*y;if(b>w){const T=b;b=w,w=T}if(b>l&&(l=b),w<h&&(h=w),l>h)return null}return l}function dy(s,e,r,a,l,h,p,y,b,w,T){const A=a-s,P=l-e,L=h-r,R=p-s,B=y-e,X=b-r,re=T[1]*X-T[2]*B,pe=T[2]*R-T[0]*X,ie=T[0]*B-T[1]*R,he=A*re+P*pe+L*ie;if(Math.abs(he)<1e-15)return null;const ye=1/he,xe=w[0]-s,Be=w[1]-e,ze=w[2]-r,We=(xe*re+Be*pe+ze*ie)*ye;if(We<0||We>1)return null;const ot=Be*L-ze*P,qe=ze*A-xe*L,Je=xe*P-Be*A,Ye=(T[0]*ot+T[1]*qe+T[2]*Je)*ye;return Ye<0||We+Ye>1?null:(R*ot+B*qe+X*Je)*ye}function hy(s,e,r){return(s-e)/(r-e)}function my(s,e,r,a,l,h,p,y,b){const w=1<<r,T=h-a,A=p-l,P=(s+1)/w*T+a,L=(e+0)/w*A+l,R=(e+1)/w*A+l;y[0]=(s+0)/w*T+a,y[1]=L,b[0]=P,b[1]=R}class py{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(h){const p=Math.ceil(Math.log2(h.dim/8)),y=[];let b=Math.ceil(Math.pow(2,p));const w=1/b,T=(L,R,B,X,re)=>{const pe=X?1:0,ie=(L+1)*B-pe,he=R*B,ye=(R+1)*B-pe;re[0]=L*B,re[1]=he,re[2]=ie,re[3]=ye};let A=new cy(b);const P=[];for(let L=0;L<b*b;L++){T(L%b,Math.floor(L/b),w,!1,P);const R=$a(P[0],P[1],h),B=$a(P[2],P[1],h),X=$a(P[2],P[3],h),re=$a(P[0],P[3],h);A.minimums.push(Math.min(R,B,X,re)),A.maximums.push(Math.max(R,B,X,re)),A.leaves.push(1)}for(y.push(A),b/=2;b>=1;b/=2){const L=y[y.length-1];A=new cy(b);for(let R=0;R<b*b;R++){T(R%b,Math.floor(R/b),2,!0,P);const B=L.getElevation(P[0],P[1]),X=L.getElevation(P[2],P[1]),re=L.getElevation(P[2],P[3]),pe=L.getElevation(P[0],P[3]),ie=L.isLeaf(P[0],P[1]),he=L.isLeaf(P[2],P[1]),ye=L.isLeaf(P[2],P[3]),xe=L.isLeaf(P[0],P[3]),Be=Math.min(B.min,X.min,re.min,pe.min),ze=Math.max(B.max,X.max,re.max,pe.max),We=ie&&he&&ye&&xe;A.maximums.push(ze),A.minimums.push(Be),A.leaves.push(ze-Be<=5&&We?1:0)}y.push(A)}return y}(this.dem),a=r.length-1,l=r[a];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,l,h,p,y=1){return uy([e,r,-100],[a,l,this.maximums[0]*y],h,p)}raycast(e,r,a,l,h,p,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,a,l,h,p,y);if(b==null)return null;const w=[],T=[],A=[],P=[],L=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:R,t:B,nodex:X,nodey:re,depth:pe}=L.pop();if(this.leaves[R]){my(X,re,pe,e,r,a,l,A,P);const he=1<<pe,ye=(X+0)/he,xe=(X+1)/he,Be=(re+0)/he,ze=(re+1)/he,We=$a(ye,Be,this.dem)*y,ot=$a(xe,Be,this.dem)*y,qe=$a(xe,ze,this.dem)*y,Je=$a(ye,ze,this.dem)*y,Ye=dy(A[0],A[1],We,P[0],A[1],ot,P[0],P[1],qe,h,p),rt=dy(P[0],P[1],qe,A[0],P[1],Je,A[0],A[1],We,h,p),dt=Math.min(Ye!==null?Ye:Number.MAX_VALUE,rt!==null?rt:Number.MAX_VALUE);if(dt!==Number.MAX_VALUE)return dt;{const Ge=hu([],h,p,B);if(fy(We,ot,Je,qe,hy(Ge[0],A[0],P[0]),hy(Ge[1],A[1],P[1]))>=Ge[2])return B}continue}let ie=0;for(let he=0;he<this._siblingOffset.length;he++){my((X<<1)+this._siblingOffset[he][0],(re<<1)+this._siblingOffset[he][1],pe+1,e,r,a,l,A,P),A[2]=-100,P[2]=this.maximums[this.childOffsets[R]+he]*y;const ye=uy(A,P,h,p);if(ye!=null){const xe=ye;w[he]=xe;let Be=!1;for(let ze=0;ze<ie&&!Be;ze++)xe>=w[T[ze]]&&(T.splice(ze,0,he),Be=!0);Be||(T[ie]=he),ie++}}for(let he=0;he<ie;he++){const ye=T[he];L.push({idx:this.childOffsets[R]+ye,t:w[ye],nodex:(X<<1)+this._siblingOffset[ye][0],nodey:(re<<1)+this._siblingOffset[ye][1],depth:pe+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,l,h){if(e[l].isLeaf(r,a)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const p=l-1,y=e[p];let b=0,w=0;for(let T=0;T<this._siblingOffset.length;T++){const A=2*r+this._siblingOffset[T][0],P=2*a+this._siblingOffset[T][1],L=y.getElevation(A,P),R=y.isLeaf(A,P),B=this._addNode(L.min,L.max,R);R&&(b|=1<<T),w||(w=B)}for(let T=0;T<this._siblingOffset.length;T++)b&1<<T||this._construct(e,2*r+this._siblingOffset[T][0],2*a+this._siblingOffset[T][1],p,w+T)}}function fy(s,e,r,a,l,h){return ds(ds(s,r,h),ds(e,a,h),l)}function $a(s,e,r){const a=r.dim,l=At(s*a-.5,0,a-1),h=At(e*a-.5,0,a-1),p=Math.floor(l),y=Math.floor(h),b=Math.min(p+1,a-1),w=Math.min(y+1,a-1);return fy(r.get(p,y),r.get(b,y),r.get(p,w),r.get(b,w),l-p,h-y)}const gy={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function a1(s,e,r){return(256*s*256+256*e+r)/10-1e4}function o1(s,e,r){return 256*s+e+r/256-32768}class Ch{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,l=!1,h=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Ms(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2,y=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=l,!l){for(let b=0;b<p;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(p,b)]=y[this._idx(p-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,p)]=y[this._idx(b,p-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(p,-1)]=y[this._idx(p-1,0)],y[this._idx(-1,p)]=y[this._idx(0,p-1)],y[this._idx(p,p)]=y[this._idx(p-1,p-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new py(this)}get(e,r,a=!1){a&&(e=At(e,-1,this.dim),r=At(r,-1,this.dim));const l=4*this._idx(e,r);return(this.encoding==="terrarium"?o1:a1)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return gy[e]}get unpackVector(){return gy[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],l=Ch.getUnpackVector(r);let h=Math.floor((e+l[3])/l[2]);return a[2]=h%256,h=Math.floor(h/256),a[1]=h%256,h=Math.floor(h/256),a[0]=h,a}getPixels(){return new _i({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,p=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(a){case-1:p=y-1;break;case 1:y=p+1}const b=-r*this.dim,w=-a*this.dim;for(let T=p;T<y;T++)for(let A=l;A<h;A++){const P=4*this._idx(A,T),L=4*this._idx(A+b,T+w);this.pixels[P+0]=e.pixels[L+0],this.pixels[P+1]=e.pixels[L+1],this.pixels[P+2]=e.pixels[L+2],this.pixels[P+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}St(Ch,"DEMData"),St(py,"DemMinMaxQuadTree",{omit:["dem"]});class l1{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:r,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,l=r===void 0?0:this.data[a].indexOf(r),h=this.data[a][l];return this.data[a].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||r.push(l);for(const a of r)this.remove(a.value.tileID,a)}}class Jl{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}Jl.ReadOnly=!1,Jl.ReadWrite=!0,Jl.disabled=new Jl(519,Jl.ReadOnly,[0,1]);const Op=7680;class Fp{constructor(e,r,a,l,h,p){this.test=e,this.ref=r,this.mask=a,this.fail=l,this.depthFail=h,this.pass=p}}Fp.disabled=new Fp({func:519,mask:0},0,0,Op,Op,Op);class On{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}On.Replace=[1,0],On.disabled=new On(On.Replace,Ks.transparent,[!1,!1,!1,!1]),On.unblended=new On(On.Replace,Ks.transparent,[!0,!0,!0,!0]),On.alphaBlended=new On([1,771],Ks.transparent,[!0,!0,!0,!0]);const Bp=1029,Up=2305;class bn{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}bn.disabled=new bn(!1,Bp,Up),bn.backCCW=new bn(!0,Bp,Up),bn.backCW=new bn(!0,Bp,2304),bn.frontCW=new bn(!0,1028,2304),bn.frontCCW=new bn(!0,1028,Up);class qo extends no{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new l1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new n1,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return sr(this._tiles).map(e=>e.tileID).sort(xy).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&r.push(this._tiles[a]);return e?r.sort((a,l)=>{const h=a.tileID,p=l.tileID,y=new ke(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),b=new ke(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-p.overscaledZ||b.y-y.y||b.x-y.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(xy).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new sn(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=tn.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Zn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const h=r[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const p=this.getTileByID(h);a(e,p),a(p,e)}}function a(l,h){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let p=h.tileID.canonical.x-l.tileID.canonical.x;const y=h.tileID.canonical.y-l.tileID.canonical.y,b=Math.pow(2,l.tileID.canonical.z),w=h.tileID.key;p===0&&y===0||Math.abs(y)>1||(Math.abs(p)>1&&(Math.abs(p+b)===1?p+=b:Math.abs(p-b)===1&&(p-=b)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,p,y),l.neighboringTiles&&l.neighboringTiles[w]&&(l.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,l){for(const h in this._tiles){let p=this._tiles[h];if(l[h]||!p.hasData()||p.tileID.overscaledZ<=r||p.tileID.overscaledZ>a)continue;let y=p.tileID;for(;p&&p.tileID.overscaledZ>r+1;){const w=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[w.key],p&&p.hasData()&&(y=w)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){l[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const l=e.scaledTo(a),h=this._getLoadedTile(l);if(h)return h}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,l=Math.ceil(e.height/r)+1,h=Math.floor(a*l*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+r),a[h.tileID.key]=h}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,r,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let l;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new ti(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(l=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(y=>this._source.hasTile(y)))):l=[];const h=this._updateRetainedTiles(l);if(yy(this._source.type)&&l.length!==0){const y={},b={},w=Object.keys(h);for(const A of w){const P=h[A],L=this._tiles[A];if(!L||L.fadeEndTime&&L.fadeEndTime<=tn.now())continue;const R=this.findLoadedParent(P,Math.max(P.overscaledZ-qo.maxOverzooming,this._source.minzoom));R&&(this._addTile(R.tileID),y[R.tileID.key]=R.tileID),b[A]=P}const T=l[l.length-1].overscaledZ;for(const A in this._tiles){const P=this._tiles[A];if(h[A]||!P.hasData())continue;let L=P.tileID;for(;L.overscaledZ>T;){L=L.scaledTo(L.overscaledZ-1);const R=this._tiles[L.key];if(R&&R.hasData()&&b[L.key]){h[A]=P.tileID;break}}}for(const A in y)h[A]||(this._coveredTiles[A]=!0,h[A]=y[A])}for(const y in h)this._tiles[y].clearFadeHold();const p=function(y,b){const w=[];for(const T in y)T in b||w.push(T);return w}(this._tiles,h);for(const y of p){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const a={},l=e.reduce((w,T)=>Math.min(w,T.overscaledZ),1/0),h=e[0].overscaledZ,p=Math.max(h-qo.maxOverzooming,this._source.minzoom),y=Math.max(h+qo.maxUnderzooming,this._source.minzoom),b={};for(const w of e){const T=this._addTile(w);r[w.key]=w,T.hasData()||l<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,l,y,r);for(const w of e){let T=this._tiles[w.key];if(T.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const P=w.children(this._source.maxzoom)[0],L=this.getTile(P);if(L&&L.hasData()){r[P.key]=P;continue}}else{const P=w.children(this._source.maxzoom);if(r[P[0].key]&&r[P[1].key]&&r[P[2].key]&&r[P[3].key])continue}let A=T.wasRequested();for(let P=w.overscaledZ-1;P>=p;--P){const L=w.scaledTo(P);if(a[L.key]||(a[L.key]=!0,T=this.getTile(L),!T&&A&&(T=this._addTile(L)),T&&(r[L.key]=L,A=T.wasRequested(),T.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}r.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;l=h}for(const h of r)this._loadedParentTiles[h]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=!!r;if(!a){const l=this.map?this.map.painter:null;r=new zp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new Zn("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){const l=[],h=this.transform;if(!h)return l;const p=h.projection.name==="globe",y=Dn(h.center.lng);for(const b in this._tiles){const w=this._tiles[b];if(a&&w.clearQueryDebugViz(),w.holdingForFade())continue;let T;if(p){const A=w.tileID.canonical;if(A.z===0){const P=[Math.abs(At(y,...zu(A,-1))-y),Math.abs(At(y,...zu(A,1))-y)];T=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(At(y,...zu(A,-1))-y),Math.abs(At(y,...zu(A,0))-y),Math.abs(At(y,...zu(A,1))-y)];T=[P.indexOf(Math.min(...P))-1]}}else T=[0];for(const A of T){const P=e.containsTile(w,h,r,A);P&&l.push(P)}}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(yy(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=tn.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const l=this._tiles[e];l&&l.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,r))};return void this._source.on("data",y)}const a=new Map,l=Array.isArray(e)?e:[e],h=this.map.painter.terrain,p=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const y of l){const b=y.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of b)a.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}Vt(Array.from(a.values()),(y,b)=>{const w=new zp(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,T=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),b(T,w)})},r)}}function xy(s,e){const r=Math.abs(2*s.wrap)-+(s.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return s.overscaledZ-e.overscaledZ||a-r||e.canonical.y-s.canonical.y||e.canonical.x-s.canonical.x}function yy(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function zu(s,e){const r=1<<s.z;return[s.x/r+e,(s.x+1)/r+e]}qo.maxOverzooming=10,qo.maxUnderzooming=3;class kh{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const l=a||e.findDEMTileFor(r);if(!l||!l.dem)return;const h=l.dem,p=l.tileID,y=1<<r.canonical.z-p.canonical.z;return new kh(l,l.tileSize/zt/y,[(r.canonical.x/y-p.canonical.x)*h.dim,(r.canonical.y/y-p.canonical.y)*h.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(a);return new ke(l,h)}getElevationAt(e,r,a,l){const h=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],y=Math.floor(h),b=Math.floor(p),w=this._dem;return l=!!l,a?ds(ds(w.get(y,b,l),w.get(y,b+1,l),p-b),ds(w.get(y+1,b,l),w.get(y+1,b+1,l),p-b),h-y):w.get(y,b,l)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*xn(1,e)*this._dem.stride}}class _y{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Yn(zt,16,0),this.featureIndexArray=new Mo,this.promoteId=r}insert(e,r,a,l,h,p=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,h,p);const b=this.grid;for(let w=0;w<r.length;w++){const T=r[w],A=[1/0,1/0,-1/0,-1/0];for(let P=0;P<T.length;P++){const L=T[P];A[0]=Math.min(A[0],L.x),A[1]=Math.min(A[1],L.y),A[2]=Math.max(A[2],L.x),A[3]=Math.max(A[3],L.y)}A[0]<zt&&A[1]<zt&&A[2]>=0&&A[3]>=0&&b.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new vp(new fh(this.rawTileData)).layers,this.sourceLayerCoder=new iy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,l){this.loadVTLayers();const h=e.params||{},p=El(h.filter),y=e.tileResult,b=e.transform,w=y.bufferedTilespaceBounds,T=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(R,B,X,re)=>$g(y.bufferedTilespaceGeometry,R,B,X,re));T.sort(c1);let A=null;b.elevation&&T.length>0&&(A=kh.create(b.elevation,this.tileID));const P={};let L;for(let R=0;R<T.length;R++){const B=T[R];if(B===L)continue;L=B;const X=this.featureIndexArray.get(B);let re=null;this.loadMatchingFeature(P,X,p,h.layers,h.availableImages,r,a,l,(pe,ie,he,ye=0)=>(re||(re=aa(pe,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(y,pe,he,re,this.z,e.transform,e.pixelPosMatrix,A,ye)))}return P}loadMatchingFeature(e,r,a,l,h,p,y,b,w){const{featureIndex:T,bucketIndex:A,sourceLayerIndex:P,layoutVertexArrayOffset:L}=r,R=this.bucketLayerIDs[A];if(l&&!function(pe,ie){for(let he=0;he<pe.length;he++)if(ie.indexOf(pe[he])>=0)return!0;return!1}(l,R))return;const B=this.sourceLayerCoder.decode(P),X=this.vtLayers[B].feature(T);if(a.needGeometry){const pe=Fo(X,!0);if(!a.filter(new C(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!a.filter(new C(this.tileID.overscaledZ),X))return;const re=this.getId(X,B);for(let pe=0;pe<R.length;pe++){const ie=R[pe];if(l&&l.indexOf(ie)<0)continue;const he=p[ie];if(!he)continue;let ye={};re!==void 0&&b&&(ye=b.getState(he.sourceLayer||"_geojsonTileLayer",re));const xe=bs({},y[ie]);xe.paint=by(xe.paint,he.paint,X,ye,h),xe.layout=by(xe.layout,he.layout,X,ye,h);const Be=!w||w(X,he,ye,L);if(!Be)continue;const ze=new ny(X,this.z,this.x,this.y,re);ze.layer=xe;let We=e[ie];We===void 0&&(We=e[ie]=[]),We.push({featureIndex:T,feature:ze,intersectionZ:Be})}}lookupSymbolFeatures(e,r,a,l,h,p,y,b){const w={};this.loadVTLayers();const T=El(h);for(const A of e)this.loadMatchingFeature(w,{bucketIndex:a,sourceLayerIndex:l,featureIndex:A,layoutVertexArrayOffset:0},T,p,y,b,r);return w}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(a),h=this.vtFeatures[l];if(h[r])return h[r];const p=this.vtLayers[l].feature(r);return h[r]=p,p}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];l!=null&&(a=e.properties[l]),typeof a=="boolean"&&(a=Number(a))}return a}}function by(s,e,r,a,l){return Qt(s,(h,p)=>{const y=e instanceof te?e.get(p):null;return y&&y.evaluate?y.evaluate(r,a,l):y})}function c1(s,e){return e-s}St(_y,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class vy{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new oa({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=_r(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,y=!0;l.push({left:h,right:p,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let w=1;w<e.length;w++){y=!y;const T=e[w];h=b*a,b+=T,p=b*a,l.push({left:h,right:p,isDash:y,zeroLength:T===0})}return l}addRoundDash(e,r,a){const l=r/2;for(let h=-a;h<=a;h++){const p=this.width*(this.nextRow+a+h);let y=0,b=e[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++y]);const T=Math.abs(w-b.left),A=Math.abs(w-b.right),P=Math.min(T,A);let L;const R=h/a*(l+1);if(b.isDash){const B=l-Math.abs(R);L=Math.sqrt(P*P+B*B)}else L=l-Math.sqrt(P*P+R*R);this.image.data[p+w]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const w=e[b],T=e[b+1];w.zeroLength?e.splice(b,1):T&&T.isDash===w.isDash&&(T.left=w.left,e.splice(b,1))}const a=e[0],l=e[e.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let p=0,y=e[p];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++p]);const w=Math.abs(b-y.left),T=Math.abs(b-y.right),A=Math.min(w,T);this.image.data[h+b]=Math.max(0,Math.min(255,(y.isDash?A:-A)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const l=r==="round",h=l?7:0,p=2*h+1;if(this.nextRow+p>this.height)return Ms("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let T=0;T<e.length;T++)e[T]<0&&(Ms("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),y+=e[T];if(y!==0){const T=this.width/y,A=this.getDashRanges(e,this.width,T);l?this.addRoundDash(A,T,h):this.addRegularDash(A,r==="square"?.5*T:0)}const b=this.nextRow+h;this.nextRow+=p;const w={tl:[b,h],br:[y,0]};return this.positions[a]=w,w}}St(vy,"LineAtlas");const wy=1*_n;class jy{constructor(e){const r={},a=[];for(const y in e){const b=e[y],w=r[y]={};for(const T in b.glyphs){const A=b.glyphs[+T];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const P=A.metrics.localGlyph?wy:1,L={x:0,y:0,w:A.bitmap.width+2*P,h:A.bitmap.height+2*P};a.push(L),w[T]=L}}const{w:l,h}=Sp(a),p=new oa({width:l||1,height:h||1});for(const y in e){const b=e[y];for(const w in b.glyphs){const T=b.glyphs[+w];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const A=r[y][w],P=T.metrics.localGlyph?wy:1;oa.copy(T.bitmap,p,{x:0,y:0},{x:A.x+P,y:A.y+P},T.bitmap)}}this.image=p,this.positions=r}}St(jy,"GlyphAtlas");class u1{constructor(e){this.tileID=new ti(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Vo(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,a,l,h){this.status="parsing",this.data=e,this.collisionBoxArray=new Ss;const p=new iy(Object.keys(e.layers).sort()),y=new _y(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},w=new vy(256,256),T={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:a},A=r.familiesBySource[this.source];for(const ye in A){const xe=e.layers[ye];if(!xe)continue;let Be=!1,ze=!1;for(const qe of A[ye])qe[0].type==="symbol"?Be=!0:ze=!0;if(this.isSymbolTile===!0&&!Be||this.isSymbolTile===!1&&!ze)continue;xe.version===1&&Ms(`Vector tile source "${this.source}" layer "${ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const We=p.encode(ye),ot=[];for(let qe=0;qe<xe.length;qe++){const Je=xe.feature(qe),Ye=y.getId(Je,ye);ot.push({feature:Je,id:Ye,index:qe,sourceLayerIndex:We})}for(const qe of A[ye]){const Je=qe[0];this.isSymbolTile!==void 0&&Je.type==="symbol"!==this.isSymbolTile||Je.minzoom&&this.zoom<Math.floor(Je.minzoom)||Je.maxzoom&&this.zoom>=Je.maxzoom||Je.visibility!=="none"&&(Vp(qe,this.zoom,a),(b[Je.id]=Je.createBucket({index:y.bucketLayerIDs.length,layers:qe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:We,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(ot,T,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(qe.map(Ye=>Ye.id)))}}let P,L,R,B;w.trim();const X={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},re=()=>{if(P)return h(P);if(L&&R&&B){const ye=new jy(L),xe=new Ax(R,B);for(const Be in b){const ze=b[Be];ze instanceof Ua?(Vp(ze.layers,this.zoom,a),Rw(ze,L,ye.positions,R,xe.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):ze.hasPattern&&(ze instanceof hh||ze instanceof oh||ze instanceof Su)&&(Vp(ze.layers,this.zoom,a),ze.addFeatures(T,this.tileID.canonical,xe.patternPositions,a,this.tileTransform))}this.status="done",h(null,{buckets:sr(b).filter(Be=>!Be.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ye.image,lineAtlas:w,imageAtlas:xe,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?R:null,glyphPositions:this.returnDependencies?ye.positions:null})}},pe=Qt(T.glyphDependencies,ye=>Object.keys(ye).map(Number));Object.keys(pe).length?l.send("getGlyphs",{uid:this.uid,stacks:pe},(ye,xe)=>{P||(P=ye,L=xe,re())},void 0,!1,X):L={};const ie=Object.keys(T.iconDependencies);ie.length?l.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(ye,xe)=>{P||(P=ye,R=xe,re())},void 0,!1,X):R={};const he=Object.keys(T.patternDependencies);he.length?l.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"patterns"},(ye,xe)=>{P||(P=ye,B=xe,re())},void 0,!1,X):B={},re()}}function Vp(s,e,r){const a=new C(e);for(const l of s)l.recalculate(a,r)}class Ny{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,l){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[p,y]=h.result;return this.scheduler?this.scheduler.add(()=>{l(p,y)},r):l(p,y),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=a((p,y)=>{h.result=[p,y];for(const b of h.callbacks)this.scheduler?this.scheduler.add(()=>{b(p,y)},r):b(p,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==l),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function Sy(s,e,r){const a=JSON.stringify(s.request);return s.data&&(this.deduped.entries[a]={result:[null,s.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},l=>{const h=en(s.request,(p,y,b,w)=>{p?l(p):y&&l(null,{vectorTile:r?void 0:new vp(new fh(y)),rawData:y,cacheControl:b,expires:w})});return()=>{h.cancel(),l()}},e)}const Ty=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=Ty[15&a];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new qp(y,p,h,e)}constructor(e,r=64,a=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=Ty.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return $p(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:y}=this,b=[0,h.length-1,0],w=[];for(;b.length;){const T=b.pop()||0,A=b.pop()||0,P=b.pop()||0;if(A-P<=y){for(let X=P;X<=A;X++){const re=p[2*X],pe=p[2*X+1];re>=e&&re<=a&&pe>=r&&pe<=l&&w.push(h[X])}continue}const L=P+A>>1,R=p[2*L],B=p[2*L+1];R>=e&&R<=a&&B>=r&&B<=l&&w.push(h[L]),(T===0?e<=R:r<=B)&&(b.push(P),b.push(L-1),b.push(1-T)),(T===0?a>=R:l>=B)&&(b.push(L+1),b.push(A),b.push(1-T))}return w}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,y=[0,l.length-1,0],b=[],w=a*a;for(;y.length;){const T=y.pop()||0,A=y.pop()||0,P=y.pop()||0;if(A-P<=p){for(let X=P;X<=A;X++)Cy(h[2*X],h[2*X+1],e,r)<=w&&b.push(l[X]);continue}const L=P+A>>1,R=h[2*L],B=h[2*L+1];Cy(R,B,e,r)<=w&&b.push(l[L]),(T===0?e-a<=R:r-a<=B)&&(y.push(P),y.push(L-1),y.push(1-T)),(T===0?e+a>=R:r+a>=B)&&(y.push(L+1),y.push(A),y.push(1-T))}return b}}function $p(s,e,r,a,l,h){if(l-a<=r)return;const p=a+l>>1;Ey(s,e,p,a,l,h),$p(s,e,r,a,p-1,1-h),$p(s,e,r,p+1,l,1-h)}function Ey(s,e,r,a,l,h){for(;l>a;){if(l-a>600){const w=l-a+1,T=r-a+1,A=Math.log(w),P=.5*Math.exp(2*A/3),L=.5*Math.sqrt(A*P*(w-P)/w)*(T-w/2<0?-1:1);Ey(s,e,r,Math.max(a,Math.floor(r-T*P/w+L)),Math.min(l,Math.floor(r+(w-T)*P/w+L)),h)}const p=e[2*r+h];let y=a,b=l;for(Ou(s,e,a,r),e[2*l+h]>p&&Ou(s,e,a,l);y<b;){for(Ou(s,e,y,b),y++,b--;e[2*y+h]<p;)y++;for(;e[2*b+h]>p;)b--}e[2*a+h]===p?Ou(s,e,a,b):(b++,Ou(s,e,b,l)),b<=r&&(a=b+1),r<=b&&(l=b-1)}}function Ou(s,e,r,a){Gp(s,r,a),Gp(e,2*r,2*a),Gp(e,2*r+1,2*a+1)}function Gp(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}function Cy(s,e,r,a){const l=s-r,h=e-a;return l*l+h*h}n.ARRAY_TYPE=yi,n.AUTH_ERR_MSG=_e,n.Aabb=ei,n.Actor=class{constructor(s,e,r){this.target=s,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Rr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ns()?s:M,this.scheduler=new r1}send(s,e,r,a,l=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=h,this.callbacks[p]=r);const y=He(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:s,hasCallback:!!r,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:Ia(e,y)},y),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(s){const e=s.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(e.mustQueue||ns()){const a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),a&&a.metadata||{type:"message"})}else this.processTask(r,e)}processTask(s,e){if(e.type==="<response>"){const r=this.callbacks[s];delete this.callbacks[s],r&&(e.error?r(ea(e.error)):r(null,ea(e.data)))}else{const r=He(this.globalScope)?void 0:[],a=e.hasCallback?(h,p)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:h?Ia(h):null,data:Ia(p,r)},r)}:h=>{},l=ea(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,a);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],l.source)[h[1]](l,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.CanonicalTileID=dh,n.Color=Ks,n.ColorMode=On,n.CullFaceMode=bn,n.DEMData=Ch,n.DataConstantProperty=F,n.DedupedRequest=Ny,n.DepthMode=Jl,n.EXTENT=zt,n.Elevation=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,l=Math.floor(s.x),h=Math.floor((s.x-l)*a),p=Math.floor(s.y*a),y=this.findDEMTileFor(new ti(r,l,r,h,p));return!(!y||!y.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||s.y<0||s.y>1)return e;const l=a.getSource().maxzoom,h=1<<l,p=Math.floor(s.x),y=s.x-p,b=new ti(l,p,l,Math.floor(y*h),Math.floor(s.y*h)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;const T=w.dem,A=1<<w.tileID.canonical.z,P=(y*A-w.tileID.canonical.x)*T.dim,L=(s.y*A-w.tileID.canonical.y)*T.dim,R=Math.floor(P),B=Math.floor(L);return(r?this.exaggeration():1)*ds(ds(T.get(R,B),T.get(R,B+1),L-B),ds(T.get(R+1,B),T.get(R+1,B+1),L-B),P-R)}getAtTileOffset(s,e,r){const a=1<<s.canonical.z;return this.getAtPointOrZero(new Ol(s.wrap+(s.canonical.x+e/zt)/a,(s.canonical.y+r/zt)/a))}getAtTileOffsetFunc(s,e,r,a){return l=>{const h=this.getAtTileOffset(s,l.x,l.y),p=a.upVector(s.canonical,l.x,l.y);return Ai(p,p,h*a.upVectorScale(s.canonical,e,r).metersToTile),p}}getForTilePoints(s,e,r,a){if(this.isUsingMockSource())return!1;const l=kh.create(this,s,a);return!!l&&(e.forEach(h=>{h[2]=this.exaggeration()*l.getElevationAt(h[0],h[1],r)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,l=1<<s.canonical.z-a.canonical.z;let h=s.canonical.x/l-a.canonical.x,p=s.canonical.y/l-a.canonical.y,y=0;for(let b=0;b<s.canonical.z-a.canonical.z&&!r.leaves[y];b++){h*=2,p*=2;const w=2*Math.floor(p)+Math.floor(h);y=r.childOffsets[y]+w,h%=1,p%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},n.ErrorEvent=sn,n.EvaluationParameters=C,n.Event=Zn,n.Evented=no,n.FillExtrusionBucket=Su,n.Frustum=Jm,n.FrustumCorners=Qm,n.GLOBE_RADIUS=Pn,n.GLOBE_SCALE_MATCH_LATITUDE=45,n.GLOBE_ZOOM_THRESHOLD_MAX=Eg,n.GLOBE_ZOOM_THRESHOLD_MIN=Ym,n.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,e){const r=new at,a=new Pt,l=[],h=s+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),b=(w,T,A)=>{let P=w===h-1?w-2:w===0?w:w-1;return P+=A?24575:0,[P,T]};for(let w=0;w<h;++w)r.emplaceBack(...b(w,0,!0));for(let w=0;w<p;++w)for(let T=0;T<h;++T)r.emplaceBack(...b(T,w,(T===0||T===h-1)&&!0));for(let w=0;w<e.length;++w){const T=e[w];for(let A=0;A<h;++A)r.emplaceBack(...b(A,T,!0))}for(let w=0;w<e.length;++w){const T=a.length,A=e[w]+1+2,P=new Pt;for(let B=0;B<A-1;B++){const X=B===A-2,re=X?h*(y-e.length+w-B):h;for(let pe=0;pe<h-1;pe++){const ie=B*h+pe;B===0||X||pe===0||pe===h-2?(P.emplaceBack(ie+1,ie,ie+re),P.emplaceBack(ie+re,ie+re+1,ie+1)):(a.emplaceBack(ie+1,ie,ie+re),a.emplaceBack(ie+re,ie+re+1,ie+1))}}const L=lr.simpleSegment(0,T,r.length,a.length-T);for(let B=0;B<P.uint16.length;B+=3)a.emplaceBack(P.uint16[B],P.uint16[B+1],P.uint16[B+2]);const R=lr.simpleSegment(0,T,r.length,a.length-T);l.push({withoutSkirts:L,withSkirts:R})}return{vertices:r,indices:a,segments:l}}_createGrid(s){const e=this._fillGridMeshWithLods(zo,fu);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,pu.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new Pt;for(let l=0;l<=zo;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const r=new Ns,a=new Ns;this._poleSegments=[];for(let l=0,h=0;l<Ym;l++){const p=360/(1<<l);r.emplaceBack(0,-Pn,0,.5,0),a.emplaceBack(0,-Pn,0,.5,1);for(let y=0;y<=zo;y++){const b=y/zo,w=ds(0,p,b),[T,A,P]=Ll(rv,iv,w,Pn);r.emplaceBack(T,A,P,b,0),a.emplaceBack(T,A,P,b,1)}this._poleSegments.push(lr.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(r,Sg,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(a,Sg,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,e){if(!this._wireframeSegments){const r=new Tr,a=zo,l=a+1+2,h=1;this._wireframeSegments=[];for(let p=0,y=0;p<fu.length;p++){const b=fu[p];for(let T=h;T<b+h;T++)for(let A=h;A<a+h;A++){const P=T*l+A;r.emplaceBack(P,P+1),r.emplaceBack(P,P+l),r.emplaceBack(P,P+l+1)}const w=b*a*3;this._wireframeSegments.push(lr.simpleSegment(0,y,(b+1)*l,w)),y+=w}this._wireframeIndexBuffer=s.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},n.GlyphManager=Wl,n.ImagePosition=Tp,n.KDBush=qp,n.LivePerformanceUtils=_m,n.LngLat=Ts,n.LngLatBounds=za,n.LocalGlyphMode=kp,n.MAX_MERCATOR_LATITUDE=qr,n.MercatorCoordinate=Ol,n.ONE_EM=Ir,n.OverscaledTileID=ti,n.PerformanceMarkers=ga,n.Point=ke,n.Properties=ce,n.RGBAImage=_i,n.Ray=Km,n.RequestManager=class{constructor(s,e,r){this._transformRequestFn=s,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const s=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",se,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,e){return this._transformRequestFn&&this._transformRequestFn(s,e)||{url:s}}normalizeStyleURL(s,e){if(!Ee(s))return s;const r=gt(s);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(s,e){if(!Ee(s))return s;const r=gt(s);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(s,e,r,a){if(!Ee(s))return s;const l=gt(s);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),r&&l.params.push(`language=${r}`),a&&l.params.push(`worldview=${a}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(s,e,r,a){const l=gt(s);return Ee(s)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=`${e}${r}`,ut(l))}normalizeTileURL(s,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ee(s))return s;const a=gt(s);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${V.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${U.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${U.TILE_URL_VERSION}${a.path}`);const l=this._customAccessToken||function(h){for(const p of h){const y=p.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||U.ACCESS_TOKEN;return U.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,l)}canonicalizeTileURL(s,e){const r=gt(s);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return s;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${U.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${U.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter(h=>!h.match(/^access_token=/))),l.length&&(a+=`?${l.join("&")}`),a}canonicalizeTileset(s,e){const r=!!e&&Ee(e),a=[];for(const l of s.tiles||[])Le(l)?a.push(this.canonicalizeTileURL(l,r)):a.push(l);return a}_makeAPIURL(s,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=gt(U.API_URL);if(s.protocol=a.protocol,s.authority=a.authority,s.protocol==="http"){const l=s.params.indexOf("secure");l>=0&&s.params.splice(l,1)}if(a.path!=="/"&&(s.path=`${a.path}${s.path}`),!U.REQUIRE_ACCESS_TOKEN)return ut(s);if(e=e||U.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return s.params=s.params.filter(l=>l.indexOf("access_token")===-1),s.params.push(`access_token=${e||""}`),ut(s)}},n.ResourceType=Ti,n.SegmentVector=lr,n.SourceCache=qo,n.StencilMode=Fp,n.StructArrayLayout1ui2=xi,n.StructArrayLayout2f1f2i16=Ft,n.StructArrayLayout2i4=at,n.StructArrayLayout2ui4=Tr,n.StructArrayLayout3f12=es,n.StructArrayLayout3ui6=Pt,n.StructArrayLayout4i8=Qe,n.StructArrayLayout5f20=Ns,n.Texture=Ru,n.Tile=zp,n.Transitionable=O,n.Uniform1f=Hd,n.Uniform1i=class extends ra{constructor(s){super(s),this.current=0}set(s,e,r){this.fetchUniformLocation(s,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},n.Uniform2f=class extends ra{constructor(s){super(s),this.current=[0,0]}set(s,e,r){this.fetchUniformLocation(s,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},n.Uniform3f=class extends ra{constructor(s){super(s),this.current=[0,0,0]}set(s,e,r){this.fetchUniformLocation(s,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},n.Uniform4f=lg,n.UniformColor=cg,n.UniformMatrix2f=class extends ra{constructor(s){super(s),this.current=Ub}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let a=0;a<4;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},n.UniformMatrix3f=class extends ra{constructor(s){super(s),this.current=Bb}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.UniformMatrix4f=class extends ra{constructor(s){super(s),this.current=Fb}set(s,e,r){if(this.fetchUniformLocation(s,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},n.UnwrappedTileID=fx,n.ValidationError=Nt,n.VectorTileFeature=ch,n.VectorTileWorkerSource=class extends no{constructor(s,e,r,a,l){super(),this.actor=s,this.layerIndex=e,this.availableImages=r,this.loadVectorData=l||Sy,this.loading={},this.loaded={},this.deduped=new Ny(s.scheduler),this.isSpriteLoaded=a,this.scheduler=s.scheduler}loadTile(s,e){const r=s.uid,a=s&&s.request,l=a&&a.collectResourceTiming,h=this.loading[r]=new u1(s);h.abort=this.loadVectorData(s,(p,y)=>{const b=!this.loading[r];if(delete this.loading[r],b||p||!y)return h.status="done",b||(this.loaded[r]=h),e(p);const w=y.rawData,T={};y.expires&&(T.expires=y.expires),y.cacheControl&&(T.cacheControl=y.cacheControl),h.vectorTile=y.vectorTile||new vp(new fh(w));const A=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,L)=>{if(P||!L)return e(P);const R={};if(l){const B=dc(a);B.length>0&&(R.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,bs({rawTileData:w.slice(0)},L,T,R))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[r]=h})}reloadTile(s,e){const r=this.loaded,a=s.uid,l=this;if(r&&r[a]){const h=r[a];h.showCollisionBoxes=s.showCollisionBoxes,h.enableTerrain=!!s.enableTerrain,h.projection=s.projection,h.tileTransform=Vo(s.tileID.canonical,s.projection);const p=(y,b)=>{const w=h.reloadCallback;w&&(delete h.reloadCallback,h.parse(h.vectorTile,l.layerIndex,this.availableImages,l.actor,w)),e(y,b)};h.status==="parsing"?h.reloadCallback=p:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(s,e){const r=s.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(s,e){const r=this.loaded,a=s.uid;r&&r[a]&&delete r[a],e()}},n.WritingMode=Pi,n.ZoomDependentExpression=No,n.add=na,n.addDynamicAttributes=Sh,n.adjoint=function(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=e[4],y=e[5],b=e[6],w=e[7],T=e[8];return s[0]=p*T-y*w,s[1]=l*w-a*T,s[2]=a*y-l*p,s[3]=y*b-h*T,s[4]=r*T-l*b,s[5]=l*h-r*y,s[6]=h*w-p*b,s[7]=a*b-r*w,s[8]=r*p-a*h,s},n.asyncAll=Vt,n.bezier=Mt,n.bindAll=Rr,n.boundsAttributes=oy,n.bufferConvexPolygon=function(s,e){const r=[];for(let a=0;a<s.length;a++){const l=ts(a-1,-1,s.length-1),h=ts(a+1,-1,s.length-1),p=s[a],y=s[h],b=s[l].sub(p).unit(),w=y.sub(p).unit(),T=w.angleWithSep(b.x,b.y),A=b.add(w).unit().mult(-1*e/Math.sin(T/2));r.push(p.add(A))}return r},n.cacheEntryPossiblyAdded=function(s){Ji++,Ji>hs&&(s.getActor().send("enforceCacheSizeLimit",Ot),Ji=0)},n.calculateGlobeLabelMatrix=function(s,e){const{x:r,y:a}=s.point,l=Pg(r,a,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Do(l,l,sp(In(e)))},n.calculateGlobeMatrix=function(s){const{x:e,y:r}=s.point,{lng:a,lat:l}=s._center;return Pg(e,r,s.worldSize,a,l)},n.calculateGlobeMercatorMatrix=function(s){const e=s.pixelsPerMeter,r=e/xn(1,s.center.lat),a=fn(new Float64Array(16));return lu(a,a,[s.point.x,s.point.y,0]),Lo(a,a,[r,r,e]),Float32Array.from(a)},n.circumferenceAtLatitude=ip,n.clamp=At,n.clearTileCache=function(s){if(!Li())return;const e=M.caches.delete(xt);s&&e.catch(s).then(()=>s())},n.clipLine=qx,n.clone=function(s){var e=new yi(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},n.clone$1=rr,n.collisionCircleLayout=lw,n.config=U,n.conjugate=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},n.create=function(){var s=new yi(16);return yi!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},n.create$1=hg,n.createExpression=Aa,n.createLayout=Ae,n.createStyleLayer=function(s){return s.type==="custom"?new Yw(s):new t1[s.type](s)},n.cross=Xm,n.degToRad=Ne,n.distance=function(s,e){return Math.hypot(e[0]-s[0],e[1]-s[1],e[2]-s[2])},n.div=function(s,e,r){return s[0]=e[0]/r[0],s[1]=e[1]/r[1],s[2]=e[2]/r[2],s},n.dot=Gi,n.earthRadius=yu,n.ease=Tt,n.easeCubicInOut=tt,n.ecefToLatLng=function([s,e,r]){const a=Math.hypot(s,e,r),l=Math.atan2(s,r),h=.5*Math.PI-Math.acos(-e/a);return new Ts(it(l),it(h))},n.emitValidationErrors=Vd,n.endsWith=Si,n.enforceCacheSizeLimit=function(s){Or(),as&&as.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-s;a++)e.delete(r[a])})})},n.evaluateSizeForFeature=mh,n.evaluateSizeForZoom=ql,n.evaluateVariableOffset=Hx,n.evented=f,n.exactEquals=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},n.exactEquals$1=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]},n.exported=tn,n.exported$1=V,n.extend=bs,n.extend$1=rn,n.fillExtrusionHeightLift=hx,n.filterObject=Ii,n.fromMat4=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},n.fromQuat=function(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=r+r,y=a+a,b=l+l,w=r*p,T=a*p,A=a*y,P=l*p,L=l*y,R=l*b,B=h*p,X=h*y,re=h*b;return s[0]=1-A-R,s[1]=T+re,s[2]=P-X,s[3]=0,s[4]=T-re,s[5]=1-w-R,s[6]=L+B,s[7]=0,s[8]=P+X,s[9]=L-B,s[10]=1-w-A,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},n.fromRotation=function(s,e){var r=Math.sin(e),a=Math.cos(e);return s[0]=a,s[1]=r,s[2]=0,s[3]=-r,s[4]=a,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},n.fromScaling=pg,n.furthestTileCorner=function(s){const e=Math.round((s+45+360)%360/90)%4;return ft[e]},n.getAABBPointSquareDist=function(s,e,r){let a=0;for(let l=0;l<2;++l){const h=r?r[l]:0;s[l]>h&&(a+=(s[l]-h)*(s[l]-h)),e[l]<h&&(a+=(h-e[l])*(h-e[l]))}return a},n.getAnchorAlignment=Cp,n.getAnchorJustification=Mp,n.getBounds=function(s){let e=1/0,r=1/0,a=-1/0,l=-1/0;for(const h of s)e=Math.min(e,h.x),r=Math.min(r,h.y),a=Math.max(a,h.x),l=Math.max(l,h.y);return{min:new ke(e,r),max:new ke(a,l)}},n.getColumn=pt,n.getDefaultExportFromCjs=de,n.getGridMatrix=function(s,e,r,a){const l=e.getNorth(),h=e.getSouth(),p=e.getWest(),y=e.getEast(),b=1<<s.z,w=y-p,T=l-h,A=w/zo,P=-T/fu[r],L=[0,A,0,P,0,0,l,p,0];if(s.z>0){const R=180/a;mg(L,L,[R/w+1,0,0,0,R/T+1,0,-.5*R/A,.5*R/P,1])}return L[2]=b,L[5]=s.x,L[8]=s.y,L},n.getImage=ue,n.getJSON=function(s,e){return Yi(bs(s,{type:"json"}),e)},n.getLatitudinalLod=function(s){const e=qr-5;s=At(s,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Ne(s))),3);return Math.round(r*(fu.length-1))},n.getMapSessionAPI=jr,n.getPerformanceMeasurement=dc,n.getProjection=sy,n.getRTLTextPluginStatus=_,n.getReferrer=zi,n.getTilePoint=function(s,{x:e,y:r},a=0){return new ke(((e-a)*s.scale-s.x)*zt,(r*s.scale-s.y)*zt)},n.getTileVec3=function(s,e,r=0){return Dl(((e.x-r)*s.scale-s.x)*zt,(e.y*s.scale-s.y)*zt,Rg(e.z,e.y))},n.getVideo=function(s,e){const r=M.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<s.length;a++){const l=M.document.createElement("source");sl(s[a])||(r.crossOrigin="Anonymous"),l.src=s[a],r.appendChild(l)}return{cancel:()=>{}}},n.globeCenterToScreenPoint=function(s){const e=[0,0,0],r=fn(new Float64Array(16));return Do(r,s.pixelMatrix,s.globeMatrix),Qs(e,e,r),new ke(e[0],e[1])},n.globeDenormalizeECEF=sp,n.globeECEFOrigin=function(s,e){const r=[0,0,0];return Qs(r,r,xu(In(e.canonical))),Qs(r,r,s),r},n.globeMetersToEcef=Qd,n.globeNormalizeECEF=xu,n.globePixelsToTileUnits=function(s,e){return zt/(512*Math.pow(2,s))*Yd(In(e))},n.globePoleMatrixForTile=function(s,e,r){const a=fn(new Float64Array(16)),l=(e/(1<<s)-.5)*Math.PI*2;return Kd(a,r.globeMatrix,l),Float32Array.from(a)},n.globeTileBounds=In,n.globeTiltAtLngLat=Ig,n.globeToMercatorTransition=zl,n.globeUseCustomAntiAliasing=function(s,e,r){const a=zl(r.zoom),l=s.style.map._antialias,h=!!e.extStandardDerivatives,p=e.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return a===0&&!l&&!p&&h},n.identity=fn,n.identity$1=wg,n.invert=Gm,n.isFullscreen=function(){return!!M.document.fullscreenElement||!!M.document.webkitFullscreenElement},n.isLngLatBehindGlobe=rp,n.isMapAuthenticated=function(s){return Gr.has(s)},n.isMapboxURL=Ee,n.isSafariWithAntialiasingBug=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!He(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.latFromMercatorY=Vr,n.latLngToECEF=Rl,n.len=Kb,n.length=cu,n.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},n.lngFromMercatorX=Mi,n.loadVectorTile=Sy,n.makeRequest=Yi,n.mapValue=function(s,e,r,a,l){return At((s-e)/(r-e)*(l-a)+a,a,l)},n.mercatorScale=zg,n.mercatorXfromLng=Dn,n.mercatorYfromLat=Ln,n.mercatorZfromAltitude=xn,n.mul=Hb,n.mul$1=Xb,n.multiply=Do,n.multiply$1=mg,n.multiply$2=xg,n.nextPowerOfTwo=_r,n.normalize=Yr,n.normalize$1=Qb,n.normalize$2=bg,n.number=ds,n.ortho=function(s,e,r,a,l,h,p){var y=1/(e-r),b=1/(a-l),w=1/(h-p);return s[0]=-2*y,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*w,s[11]=0,s[12]=(e+r)*y,s[13]=(l+a)*b,s[14]=(p+h)*w,s[15]=1,s},n.pbf=wx,n.perspective=function(s,e,r,a,l){var h,p=1/Math.tan(e/2);return s[0]=p/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,l!=null&&l!==1/0?(s[10]=(l+a)*(h=1/(a-l)),s[14]=2*l*a*h):(s[10]=-1,s[14]=-2*a),s},n.pick=function(s,e){const r={};for(let a=0;a<e.length;a++){const l=e[a];l in s&&(r[l]=s[l])}return r},n.plugin=S,n.pointGeometry=fe,n.polesInViewport=function(s){const e=fn(new Float64Array(16));Do(e,s.pixelMatrix,s.globeMatrix);const r=[0,Zi,0],a=[0,Wi,0];return Qs(r,r,e),Qs(a,a,e),[r[0]>0&&r[0]<=s.width&&r[1]>0&&r[1]<=s.height&&!rp(s,new Ts(s.center.lat,90)),a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!rp(s,new Ts(s.center.lat,-90))]},n.polygonContainsPoint=Bo,n.polygonIntersectsBox=$g,n.polygonIntersectsPolygon=Bg,n.polygonizeBounds=function(s,e,r=0,a=!0){const l=new ke(r,r),h=s.sub(l),p=e.add(l),y=[h,new ke(p.x,h.y),p,new ke(h.x,p.y)];return a&&y.push(h.clone()),y},n.posAttributes=pu,n.postMapLoadEvent=nr,n.postPerformanceEvent=xr,n.postTurnstileEvent=ls,n.potpack=Sp,n.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},n.radToDeg=it,n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.registerForPluginStateChange=function(s){return s({pluginStatus:u,pluginURL:i}),f.on("pluginStateChange",s),s},n.removeAuthState=function(s){Gr.delete(s)},n.renderColorRamp=hp,n.resample=Og,n.rotateX=Zm,n.rotateX$1=jg,n.rotateY=Kd,n.rotateY$1=Ng,n.rotateZ=function(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],y=e[2],b=e[3],w=e[4],T=e[5],A=e[6],P=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=h*l+w*a,s[1]=p*l+T*a,s[2]=y*l+A*a,s[3]=b*l+P*a,s[4]=w*l-h*a,s[5]=T*l-p*a,s[6]=A*l-y*a,s[7]=P*l-b*a,s},n.rotateZ$1=function(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b+l*y,s[1]=l*b-a*y,s[2]=h*b+p*y,s[3]=p*b-h*y,s},n.scale=Lo,n.scale$1=_g,n.scale$2=Ai,n.scaleAndAdd=hu,n.set=function(s,e,r,a){return s[0]=e,s[1]=r,s[2]=a,s},n.setCacheLimits=function(s,e){Ot=s,hs=e},n.setColumn=function(s,e,r){s[4*e+0]=r[0],s[4*e+1]=r[1],s[4*e+2]=r[2],s[4*e+3]=r[3]},n.setRTLTextPlugin=function(s,e,r=!1){if(u===ru||u===iu||u===nu)throw new Error("setRTLTextPlugin cannot be called multiple times.");i=tn.resolveURL(s),u=ru,Da=e,m(),r||j()},n.smoothstep=zs,n.spec=Ze,n.squaredLength=function(s){var e=s[0],r=s[1],a=s[2];return e*e+r*r+a*a},n.storeAuthState=function(s,e){e?Gr.add(s):Gr.delete(s)},n.sub=gn,n.subtract=Hm,n.symbolSize=cw,n.tileAABB=function(s,e,r,a,l,h,p,y,b){if(b.name==="globe")return sv(s,e,new dh(r,a,l));const w=Vo({z:r,x:a,y:l},b);return new ei([(h+w.x/w.scale)*e,e*(w.y/w.scale),p],[(h+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},n.tileCornersToBounds=Jd,n.tileTransform=Vo,n.transformMat3=function(s,e,r){var a=e[0],l=e[1],h=e[2];return s[0]=a*r[0]+l*r[3]+h*r[6],s[1]=a*r[1]+l*r[4]+h*r[7],s[2]=a*r[2]+l*r[5]+h*r[8],s},n.transformMat4=Qs,n.transformMat4$1=Ro,n.transformQuat=yg,n.transitionTileAABBinECEF=kg,n.translate=lu,n.transpose=function(s,e){if(s===e){var r=e[1],a=e[2],l=e[5];s[1]=e[3],s[2]=e[6],s[3]=r,s[5]=e[7],s[6]=a,s[7]=l}else s[0]=e[0],s[1]=e[3],s[2]=e[6],s[3]=e[1],s[4]=e[4],s[5]=e[7],s[6]=e[2],s[7]=e[5],s[8]=e[8];return s},n.triggerPluginCompletionEvent=o,n.uniqueId=$r,n.updateGlobeVertexNormal=function(s,e,r,a,l){const h=5*e+2;s.float32[h+0]=r,s.float32[h+1]=a,s.float32[h+2]=l},n.validateCustomStyleLayer=function(s){const e=[],r=s.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateFilter=s=>gi(ko(s)),n.validateFog=s=>gi(Fd(s)),n.validateLayer=s=>gi(Ld(s)),n.validateLight=s=>gi(Od(s)),n.validateSource=s=>gi(zd(s)),n.validateStyle=Ud,n.validateTerrain=s=>gi(Jc(s)),n.values=sr,n.vectorTile=lh,n.version=z,n.warnOnce=Ms,n.window=M,n.wrap=ts}),E(["./shared"],function(n){function M(me){if(typeof me=="number"||typeof me=="boolean"||typeof me=="string"||me==null)return JSON.stringify(me);if(Array.isArray(me)){let Z="[";for(const ue of me)Z+=`${M(ue)},`;return`${Z}]`}let $="{";for(const Z of Object.keys(me).sort())$+=`${Z}:${M(me[Z])},`;return`${$}}`}function z(me){let $="";for(const Z of n.refProperties)$+=`/${M(me[Z])}`;return $}class q{constructor($){this.keyCache={},$&&this.replace($)}replace($){this._layerConfigs={},this._layers={},this.update($,[])}update($,Z){for(const _e of $)this._layerConfigs[_e.id]=_e,(this._layers[_e.id]=n.createStyleLayer(_e)).compileFilter(),this.keyCache[_e.id]&&delete this.keyCache[_e.id];for(const _e of Z)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const ue=function(_e,Ee){const Le={};for(let Te=0;Te<_e.length;Te++){const $e=Ee&&Ee[_e[Te].id]||z(_e[Te]);Ee&&(Ee[_e[Te].id]=$e);let mt=Le[$e];mt||(mt=Le[$e]=[]),mt.push(_e[Te])}const De=[];for(const Te in Le)De.push(Le[Te]);return De}(n.values(this._layerConfigs),this.keyCache);for(const _e of ue){const Ee=_e.map(gt=>this._layers[gt.id]),Le=Ee[0];if(Le.visibility==="none")continue;const De=Le.source||"";let Te=this.familiesBySource[De];Te||(Te=this.familiesBySource[De]={});const $e=Le.sourceLayer||"_geojsonTileLayer";let mt=Te[$e];mt||(mt=Te[$e]=[]),mt.push(Ee)}}}class U{loadTile($,Z){const{uid:ue,encoding:_e,rawImageData:Ee,padding:Le,buildQuadTree:De}=$,Te=n.window.ImageBitmap&&Ee instanceof n.window.ImageBitmap?this.getImageData(Ee,Le):Ee;Z(null,new n.DEMData(ue,Te,_e,Le<1,De))}getImageData($,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);const ue=this.offscreenCanvasContext.getImageData(-Z,-Z,$.width+2*Z,$.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}function V(me,$){if(me.length!==0){G(me[0],$);for(var Z=1;Z<me.length;Z++)G(me[Z],!$)}}function G(me,$){for(var Z=0,ue=0,_e=0,Ee=me.length,Le=Ee-1;_e<Ee;Le=_e++){var De=(me[_e][0]-me[Le][0])*(me[Le][1]+me[_e][1]),Te=Z+De;ue+=Math.abs(Z)>=Math.abs(De)?Z-Te+De:De-Te+Z,Z=Te}Z+ue>=0!=!!$&&me.reverse()}var H=n.getDefaultExportFromCjs(function me($,Z){var ue,_e=$&&$.type;if(_e==="FeatureCollection")for(ue=0;ue<$.features.length;ue++)me($.features[ue],Z);else if(_e==="GeometryCollection")for(ue=0;ue<$.geometries.length;ue++)me($.geometries[ue],Z);else if(_e==="Feature")me($.geometry,Z);else if(_e==="Polygon")V($.coordinates,Z);else if(_e==="MultiPolygon")for(ue=0;ue<$.coordinates.length;ue++)V($.coordinates[ue],Z);return $});const Y=n.VectorTileFeature.prototype.toGeoJSON;var ge={exports:{}},oe=n.pointGeometry,se=n.vectorTile.VectorTileFeature,de=ae;function ae(me,$){this.options=$||{},this.features=me,this.length=me.length}function Se(me,$){this.id=typeof me.id=="number"?me.id:void 0,this.type=me.type,this.rawGeometry=me.type===1?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=$||4096}ae.prototype.feature=function(me){return new Se(this.features[me],this.options.extent)},Se.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var $=0;$<me.length;$++){for(var Z=me[$],ue=[],_e=0;_e<Z.length;_e++)ue.push(new oe(Z[_e][0],Z[_e][1]));this.geometry.push(ue)}return this.geometry},Se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,$=1/0,Z=-1/0,ue=1/0,_e=-1/0,Ee=0;Ee<me.length;Ee++)for(var Le=me[Ee],De=0;De<Le.length;De++){var Te=Le[De];$=Math.min($,Te.x),Z=Math.max(Z,Te.x),ue=Math.min(ue,Te.y),_e=Math.max(_e,Te.y)}return[$,ue,Z,_e]},Se.prototype.toGeoJSON=se.prototype.toGeoJSON;var Ce=n.pbf,fe=de;function Ie(me){var $=new Ce;return function(Z,ue){for(var _e in Z.layers)ue.writeMessage(3,ke,Z.layers[_e])}(me,$),$.finish()}function ke(me,$){var Z;$.writeVarintField(15,me.version||1),$.writeStringField(1,me.name||""),$.writeVarintField(5,me.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<me.length;Z++)ue.feature=me.feature(Z),$.writeMessage(2,et,ue);var _e=ue.keys;for(Z=0;Z<_e.length;Z++)$.writeStringField(3,_e[Z]);var Ee=ue.values;for(Z=0;Z<Ee.length;Z++)$.writeMessage(4,tt,Ee[Z])}function et(me,$){var Z=me.feature;Z.id!==void 0&&$.writeVarintField(1,Z.id),$.writeMessage(2,Pe,me),$.writeVarintField(3,Z.type),$.writeMessage(4,ft,Z)}function Pe(me,$){var Z=me.feature,ue=me.keys,_e=me.values,Ee=me.keycache,Le=me.valuecache;for(var De in Z.properties){var Te=Z.properties[De],$e=Ee[De];if(Te!==null){$e===void 0&&(ue.push(De),Ee[De]=$e=ue.length-1),$.writeVarint($e);var mt=typeof Te;mt!=="string"&&mt!=="boolean"&&mt!=="number"&&(Te=JSON.stringify(Te));var gt=mt+":"+Te,ut=Le[gt];ut===void 0&&(_e.push(Te),Le[gt]=ut=_e.length-1),$.writeVarint(ut)}}}function Ne(me,$){return($<<3)+(7&me)}function it(me){return me<<1^me>>31}function ft(me,$){for(var Z=me.loadGeometry(),ue=me.type,_e=0,Ee=0,Le=Z.length,De=0;De<Le;De++){var Te=Z[De],$e=1;ue===1&&($e=Te.length),$.writeVarint(Ne(1,$e));for(var mt=ue===3?Te.length-1:Te.length,gt=0;gt<mt;gt++){gt===1&&ue!==1&&$.writeVarint(Ne(2,mt-1));var ut=Te[gt].x-_e,Wt=Te[gt].y-Ee;$.writeVarint(it(ut)),$.writeVarint(it(Wt)),_e+=ut,Ee+=Wt}ue===3&&$.writeVarint(Ne(7,1))}}function tt(me,$){var Z=typeof me;Z==="string"?$.writeStringField(1,me):Z==="boolean"?$.writeBooleanField(7,me):Z==="number"&&(me%1!=0?$.writeDoubleField(3,me):me<0?$.writeSVarintField(6,me):$.writeVarintField(5,me))}ge.exports=Ie,ge.exports.fromVectorTileJs=Ie,ge.exports.fromGeojsonVt=function(me,$){$=$||{};var Z={};for(var ue in me)Z[ue]=new fe(me[ue].features,$),Z[ue].name=ue,Z[ue].version=$.version,Z[ue].extent=$.extent;return Ie({layers:Z})},ge.exports.GeoJSONWrapper=fe;var Mt=n.getDefaultExportFromCjs(ge.exports);const Tt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},At=Math.fround||(zs=new Float32Array(1),me=>(zs[0]=+me,zs[0]));var zs;const ts=3,Vt=5,sr=6;class bs{constructor($){this.options=Object.assign(Object.create(Tt),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:Z,minZoom:ue,maxZoom:_e}=this.options;Z&&console.time("total time");const Ee=`prepare ${$.length} points`;Z&&console.time(Ee),this.points=$;const Le=[];for(let Te=0;Te<$.length;Te++){const $e=$[Te];if(!$e.geometry)continue;const[mt,gt]=$e.geometry.coordinates,ut=At(gr(mt)),Wt=At(_r(gt));Le.push(ut,Wt,1/0,Te,-1,1),this.options.reduce&&Le.push(0)}let De=this.trees[_e+1]=this._createTree(Le);Z&&console.timeEnd(Ee);for(let Te=_e;Te>=ue;Te--){const $e=+Date.now();De=this.trees[Te]=this._createTree(this._cluster(De,Te)),Z&&console.log("z%d: %d clusters in %dms",Te,De.numItems,+Date.now()-$e)}return Z&&console.timeEnd("total time"),this}getClusters($,Z){let ue=(($[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,$[1]));let Ee=$[2]===180?180:(($[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)ue=-180,Ee=180;else if(ue>Ee){const gt=this.getClusters([ue,_e,180,Le],Z),ut=this.getClusters([-180,_e,Ee,Le],Z);return gt.concat(ut)}const De=this.trees[this._limitZoom(Z)],Te=De.range(gr(ue),_r(Le),gr(Ee),_r(_e)),$e=De.data,mt=[];for(const gt of Te){const ut=this.stride*gt;mt.push($e[ut+Vt]>1?fr($e,ut,this.clusterProps):this.points[$e[ut+ts]])}return mt}getChildren($){const Z=this._getOriginId($),ue=this._getOriginZoom($),_e="No cluster with the specified id.",Ee=this.trees[ue];if(!Ee)throw new Error(_e);const Le=Ee.data;if(Z*this.stride>=Le.length)throw new Error(_e);const De=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),Te=Ee.within(Le[Z*this.stride],Le[Z*this.stride+1],De),$e=[];for(const mt of Te){const gt=mt*this.stride;Le[gt+4]===$&&$e.push(Le[gt+Vt]>1?fr(Le,gt,this.clusterProps):this.points[Le[gt+ts]])}if($e.length===0)throw new Error(_e);return $e}getLeaves($,Z,ue){const _e=[];return this._appendLeaves(_e,$,Z=Z||10,ue=ue||0,0),_e}getTile($,Z,ue){const _e=this.trees[this._limitZoom($)],Ee=Math.pow(2,$),{extent:Le,radius:De}=this.options,Te=De/Le,$e=(ue-Te)/Ee,mt=(ue+1+Te)/Ee,gt={features:[]};return this._addTileFeatures(_e.range((Z-Te)/Ee,$e,(Z+1+Te)/Ee,mt),_e.data,Z,ue,Ee,gt),Z===0&&this._addTileFeatures(_e.range(1-Te/Ee,$e,1,mt),_e.data,Ee,ue,Ee,gt),Z===Ee-1&&this._addTileFeatures(_e.range(0,$e,Te/Ee,mt),_e.data,-1,ue,Ee,gt),gt.features.length?gt:null}getClusterExpansionZoom($){let Z=this._getOriginZoom($)-1;for(;Z<=this.options.maxZoom;){const ue=this.getChildren($);if(Z++,ue.length!==1)break;$=ue[0].properties.cluster_id}return Z}_appendLeaves($,Z,ue,_e,Ee){const Le=this.getChildren(Z);for(const De of Le){const Te=De.properties;if(Te&&Te.cluster?Ee+Te.point_count<=_e?Ee+=Te.point_count:Ee=this._appendLeaves($,Te.cluster_id,ue,_e,Ee):Ee<_e?Ee++:$.push(De),$.length===ue)break}return Ee}_createTree($){const Z=new n.KDBush($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<$.length;ue+=this.stride)Z.add($[ue],$[ue+1]);return Z.finish(),Z.data=$,Z}_addTileFeatures($,Z,ue,_e,Ee,Le){for(const De of $){const Te=De*this.stride,$e=Z[Te+Vt]>1;let mt,gt,ut;if($e)mt=$r(Z,Te,this.clusterProps),gt=Z[Te],ut=Z[Te+1];else{const Ht=this.points[Z[Te+ts]];mt=Ht.properties;const[Yt,ls]=Ht.geometry.coordinates;gt=gr(Yt),ut=_r(ls)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(gt*Ee-ue)),Math.round(this.options.extent*(ut*Ee-_e))]],tags:mt};let Jt;Jt=$e||this.options.generateId?Z[Te+ts]:this.points[Z[Te+ts]].id,Jt!==void 0&&(Wt.id=Jt),Le.features.push(Wt)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,Z){const{radius:ue,extent:_e,reduce:Ee,minPoints:Le}=this.options,De=ue/(_e*Math.pow(2,Z)),Te=$.data,$e=[],mt=this.stride;for(let gt=0;gt<Te.length;gt+=mt){if(Te[gt+2]<=Z)continue;Te[gt+2]=Z;const ut=Te[gt],Wt=Te[gt+1],Jt=$.within(Te[gt],Te[gt+1],De),Ht=Te[gt+Vt];let Yt=Ht;for(const ls of Jt){const Us=ls*mt;Te[Us+2]>Z&&(Yt+=Te[Us+Vt])}if(Yt>Ht&&Yt>=Le){let ls,Us=ut*Ht,nr=Wt*Ht,Fr=-1;const xr=((gt/mt|0)<<5)+(Z+1)+this.points.length;for(const Oi of Jt){const jr=Oi*mt;if(Te[jr+2]<=Z)continue;Te[jr+2]=Z;const Gr=Te[jr+Vt];Us+=Te[jr]*Gr,nr+=Te[jr+1]*Gr,Te[jr+4]=xr,Ee&&(ls||(ls=this._map(Te,gt,!0),Fr=this.clusterProps.length,this.clusterProps.push(ls)),Ee(ls,this._map(Te,jr)))}Te[gt+4]=xr,$e.push(Us/Yt,nr/Yt,1/0,xr,-1,Yt),Ee&&$e.push(Fr)}else{for(let ls=0;ls<mt;ls++)$e.push(Te[gt+ls]);if(Yt>1)for(const ls of Jt){const Us=ls*mt;if(!(Te[Us+2]<=Z)){Te[Us+2]=Z;for(let nr=0;nr<mt;nr++)$e.push(Te[Us+nr])}}}}return $e}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,Z,ue){if($[Z+Vt]>1){const Le=this.clusterProps[$[Z+sr]];return ue?Object.assign({},Le):Le}const _e=this.points[$[Z+ts]].properties,Ee=this.options.map(_e);return ue&&Ee===_e?Object.assign({},Ee):Ee}}function fr(me,$,Z){return{type:"Feature",id:me[$+ts],properties:$r(me,$,Z),geometry:{type:"Point",coordinates:[(ue=me[$],360*(ue-.5)),Xr(me[$+1])]}};var ue}function $r(me,$,Z){const ue=me[$+Vt],_e=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,Ee=me[$+sr],Le=Ee===-1?{}:Object.assign({},Z[Ee]);return Object.assign(Le,{cluster:!0,cluster_id:me[$+ts],point_count:ue,point_count_abbreviated:_e})}function gr(me){return me/360+.5}function _r(me){const $=Math.sin(me*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function Xr(me){const $=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function Rr(me,$,Z,ue){for(var _e,Ee=ue,Le=Z-$>>1,De=Z-$,Te=me[$],$e=me[$+1],mt=me[Z],gt=me[Z+1],ut=$+3;ut<Z;ut+=3){var Wt=Si(me[ut],me[ut+1],Te,$e,mt,gt);if(Wt>Ee)_e=ut,Ee=Wt;else if(Wt===Ee){var Jt=Math.abs(ut-Le);Jt<De&&(_e=ut,De=Jt)}}Ee>ue&&(_e-$>3&&Rr(me,$,_e,ue),me[_e+2]=Ee,Z-_e>3&&Rr(me,_e,Z,ue))}function Si(me,$,Z,ue,_e,Ee){var Le=_e-Z,De=Ee-ue;if(Le!==0||De!==0){var Te=((me-Z)*Le+($-ue)*De)/(Le*Le+De*De);Te>1?(Z=_e,ue=Ee):Te>0&&(Z+=Le*Te,ue+=De*Te)}return(Le=me-Z)*Le+(De=$-ue)*De}function Qt(me,$,Z,ue){var _e={id:me===void 0?null:me,type:$,geometry:Z,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var Le=Ee.geometry,De=Ee.type;if(De==="Point"||De==="MultiPoint"||De==="LineString")Ii(Ee,Le);else if(De==="Polygon"||De==="MultiLineString")for(var Te=0;Te<Le.length;Te++)Ii(Ee,Le[Te]);else if(De==="MultiPolygon")for(Te=0;Te<Le.length;Te++)for(var $e=0;$e<Le[Te].length;$e++)Ii(Ee,Le[Te][$e])}(_e),_e}function Ii(me,$){for(var Z=0;Z<$.length;Z+=3)me.minX=Math.min(me.minX,$[Z]),me.minY=Math.min(me.minY,$[Z+1]),me.maxX=Math.max(me.maxX,$[Z]),me.maxY=Math.max(me.maxY,$[Z+1])}function rr(me,$,Z,ue){if($.geometry){var _e=$.geometry.coordinates,Ee=$.geometry.type,Le=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),De=[],Te=$.id;if(Z.promoteId?Te=$.properties[Z.promoteId]:Z.generateId&&(Te=ue||0),Ee==="Point")Di(_e,De);else if(Ee==="MultiPoint")for(var $e=0;$e<_e.length;$e++)Di(_e[$e],De);else if(Ee==="LineString")Ms(_e,De,Le,!1);else if(Ee==="MultiLineString"){if(Z.lineMetrics){for($e=0;$e<_e.length;$e++)Ms(_e[$e],De=[],Le,!1),me.push(Qt(Te,"LineString",De,$.properties));return}zr(_e,De,Le,!1)}else if(Ee==="Polygon")zr(_e,De,Le,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for($e=0;$e<$.geometry.geometries.length;$e++)rr(me,{id:Te,geometry:$.geometry.geometries[$e],properties:$.properties},Z,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for($e=0;$e<_e.length;$e++){var mt=[];zr(_e[$e],mt,Le,!0),De.push(mt)}}me.push(Qt(Te,Ee,De,$.properties))}}function Di(me,$){$.push(bt(me[0])),$.push(ns(me[1])),$.push(0)}function Ms(me,$,Z,ue){for(var _e,Ee,Le=0,De=0;De<me.length;De++){var Te=bt(me[De][0]),$e=ns(me[De][1]);$.push(Te),$.push($e),$.push(0),De>0&&(Le+=ue?(_e*$e-Te*Ee)/2:Math.sqrt(Math.pow(Te-_e,2)+Math.pow($e-Ee,2))),_e=Te,Ee=$e}var mt=$.length-3;$[2]=1,Rr($,0,mt,Z),$[mt+2]=1,$.size=Math.abs(Le),$.start=0,$.end=$.size}function zr(me,$,Z,ue){for(var _e=0;_e<me.length;_e++){var Ee=[];Ms(me[_e],Ee,Z,ue),$.push(Ee)}}function bt(me){return me/360+.5}function ns(me){var $=Math.sin(me*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function be(me,$,Z,ue,_e,Ee,Le,De){if(ue/=$,Ee>=(Z/=$)&&Le<ue)return me;if(Le<Z||Ee>=ue)return null;for(var Te=[],$e=0;$e<me.length;$e++){var mt=me[$e],gt=mt.geometry,ut=mt.type,Wt=_e===0?mt.minX:mt.minY,Jt=_e===0?mt.maxX:mt.maxY;if(Wt>=Z&&Jt<ue)Te.push(mt);else if(!(Jt<Z||Wt>=ue)){var Ht=[];if(ut==="Point"||ut==="MultiPoint")Ue(gt,Ht,Z,ue,_e);else if(ut==="LineString")He(gt,Ht,Z,ue,_e,!1,De.lineMetrics);else if(ut==="MultiLineString")pt(gt,Ht,Z,ue,_e,!1);else if(ut==="Polygon")pt(gt,Ht,Z,ue,_e,!0);else if(ut==="MultiPolygon")for(var Yt=0;Yt<gt.length;Yt++){var ls=[];pt(gt[Yt],ls,Z,ue,_e,!0),ls.length&&Ht.push(ls)}if(Ht.length){if(De.lineMetrics&&ut==="LineString"){for(Yt=0;Yt<Ht.length;Yt++)Te.push(Qt(mt.id,ut,Ht[Yt],mt.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(Ht.length===1?(ut="LineString",Ht=Ht[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=Ht.length===3?"Point":"MultiPoint"),Te.push(Qt(mt.id,ut,Ht,mt.tags))}}}return Te.length?Te:null}function Ue(me,$,Z,ue,_e){for(var Ee=0;Ee<me.length;Ee+=3){var Le=me[Ee+_e];Le>=Z&&Le<=ue&&($.push(me[Ee]),$.push(me[Ee+1]),$.push(me[Ee+2]))}}function He(me,$,Z,ue,_e,Ee,Le){for(var De,Te,$e=wt(me),mt=_e===0?Ot:hs,gt=me.start,ut=0;ut<me.length-3;ut+=3){var Wt=me[ut],Jt=me[ut+1],Ht=me[ut+2],Yt=me[ut+3],ls=me[ut+4],Us=_e===0?Wt:Jt,nr=_e===0?Yt:ls,Fr=!1;Le&&(De=Math.sqrt(Math.pow(Wt-Yt,2)+Math.pow(Jt-ls,2))),Us<Z?nr>Z&&(Te=mt($e,Wt,Jt,Yt,ls,Z),Le&&($e.start=gt+De*Te)):Us>ue?nr<ue&&(Te=mt($e,Wt,Jt,Yt,ls,ue),Le&&($e.start=gt+De*Te)):xt($e,Wt,Jt,Ht),nr<Z&&Us>=Z&&(Te=mt($e,Wt,Jt,Yt,ls,Z),Fr=!0),nr>ue&&Us<=ue&&(Te=mt($e,Wt,Jt,Yt,ls,ue),Fr=!0),!Ee&&Fr&&(Le&&($e.end=gt+De*Te),$.push($e),$e=wt(me)),Le&&(gt+=De)}var xr=me.length-3;Wt=me[xr],Jt=me[xr+1],Ht=me[xr+2],(Us=_e===0?Wt:Jt)>=Z&&Us<=ue&&xt($e,Wt,Jt,Ht),xr=$e.length-3,Ee&&xr>=3&&($e[xr]!==$e[0]||$e[xr+1]!==$e[1])&&xt($e,$e[0],$e[1],$e[2]),$e.length&&$.push($e)}function wt(me){var $=[];return $.size=me.size,$.start=me.start,$.end=me.end,$}function pt(me,$,Z,ue,_e,Ee){for(var Le=0;Le<me.length;Le++)He(me[Le],$,Z,ue,_e,Ee,!1)}function xt(me,$,Z,ue){me.push($),me.push(Z),me.push(ue)}function Ot(me,$,Z,ue,_e,Ee){var Le=(Ee-$)/(ue-$);return me.push(Ee),me.push(Z+(_e-Z)*Le),me.push(1),Le}function hs(me,$,Z,ue,_e,Ee){var Le=(Ee-Z)/(_e-Z);return me.push($+(ue-$)*Le),me.push(Ee),me.push(1),Le}function as(me,$){for(var Z=[],ue=0;ue<me.length;ue++){var _e,Ee=me[ue],Le=Ee.type;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")_e=ir(Ee.geometry,$);else if(Le==="MultiLineString"||Le==="Polygon"){_e=[];for(var De=0;De<Ee.geometry.length;De++)_e.push(ir(Ee.geometry[De],$))}else if(Le==="MultiPolygon")for(_e=[],De=0;De<Ee.geometry.length;De++){for(var Te=[],$e=0;$e<Ee.geometry[De].length;$e++)Te.push(ir(Ee.geometry[De][$e],$));_e.push(Te)}Z.push(Qt(Ee.id,Le,_e,Ee.tags))}return Z}function ir(me,$){var Z=[];Z.size=me.size,me.start!==void 0&&(Z.start=me.start,Z.end=me.end);for(var ue=0;ue<me.length;ue+=3)Z.push(me[ue]+$,me[ue+1],me[ue+2]);return Z}function Li(me,$){if(me.transformed)return me;var Z,ue,_e,Ee=1<<me.z,Le=me.x,De=me.y;for(Z=0;Z<me.features.length;Z++){var Te=me.features[Z],$e=Te.geometry,mt=Te.type;if(Te.geometry=[],mt===1)for(ue=0;ue<$e.length;ue+=2)Te.geometry.push(Or($e[ue],$e[ue+1],$,Ee,Le,De));else for(ue=0;ue<$e.length;ue++){var gt=[];for(_e=0;_e<$e[ue].length;_e+=2)gt.push(Or($e[ue][_e],$e[ue][_e+1],$,Ee,Le,De));Te.geometry.push(gt)}}return me.transformed=!0,me}function Or(me,$,Z,ue,_e,Ee){return[Math.round(Z*(me*ue-_e)),Math.round(Z*($*ue-Ee))]}function Cn(me,$,Z,ue,_e){for(var Ee=$===_e.maxZoom?0:_e.tolerance/((1<<$)*_e.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:ue,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},De=0;De<me.length;De++){Le.numFeatures++,Ji(Le,me[De],Ee,_e);var Te=me[De].minX,$e=me[De].minY,mt=me[De].maxX,gt=me[De].maxY;Te<Le.minX&&(Le.minX=Te),$e<Le.minY&&(Le.minY=$e),mt>Le.maxX&&(Le.maxX=mt),gt>Le.maxY&&(Le.maxY=gt)}return Le}function Ji(me,$,Z,ue){var _e=$.geometry,Ee=$.type,Le=[];if(Ee==="Point"||Ee==="MultiPoint")for(var De=0;De<_e.length;De+=3)Le.push(_e[De]),Le.push(_e[De+1]),me.numPoints++,me.numSimplified++;else if(Ee==="LineString")Ti(Le,_e,me,Z,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(De=0;De<_e.length;De++)Ti(Le,_e[De],me,Z,Ee==="Polygon",De===0);else if(Ee==="MultiPolygon")for(var Te=0;Te<_e.length;Te++){var $e=_e[Te];for(De=0;De<$e.length;De++)Ti(Le,$e[De],me,Z,!0,De===0)}if(Le.length){var mt=$.tags||null;if(Ee==="LineString"&&ue.lineMetrics){for(var gt in mt={},$.tags)mt[gt]=$.tags[gt];mt.mapbox_clip_start=_e.start/_e.size,mt.mapbox_clip_end=_e.end/_e.size}var ut={geometry:Le,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:mt};$.id!==null&&(ut.id=$.id),me.features.push(ut)}}function Ti(me,$,Z,ue,_e,Ee){var Le=ue*ue;if(ue>0&&$.size<(_e?Le:ue))Z.numPoints+=$.length/3;else{for(var De=[],Te=0;Te<$.length;Te+=3)(ue===0||$[Te+2]>Le)&&(Z.numSimplified++,De.push($[Te]),De.push($[Te+1])),Z.numPoints++;_e&&function($e,mt){for(var gt=0,ut=0,Wt=$e.length,Jt=Wt-2;ut<Wt;Jt=ut,ut+=2)gt+=($e[ut]-$e[Jt])*($e[ut+1]+$e[Jt+1]);if(gt>0===mt)for(ut=0,Wt=$e.length;ut<Wt/2;ut+=2){var Ht=$e[ut],Yt=$e[ut+1];$e[ut]=$e[Wt-2-ut],$e[ut+1]=$e[Wt-1-ut],$e[Wt-2-ut]=Ht,$e[Wt-1-ut]=Yt}}(De,Ee),me.push(De)}}function Ri(me,$){var Z=($=this.options=function(_e,Ee){for(var Le in Ee)_e[Le]=Ee[Le];return _e}(Object.create(this.options),$)).debug;if(Z&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var ue=function(_e,Ee){var Le=[];if(_e.type==="FeatureCollection")for(var De=0;De<_e.features.length;De++)rr(Le,_e.features[De],Ee,De);else rr(Le,_e.type==="Feature"?_e:{geometry:_e},Ee);return Le}(me,$);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(_e,Ee){var Le=Ee.buffer/Ee.extent,De=_e,Te=be(_e,1,-1-Le,Le,0,-1,2,Ee),$e=be(_e,1,1-Le,2+Le,0,-1,2,Ee);return(Te||$e)&&(De=be(_e,1,-Le,1+Le,0,-1,2,Ee)||[],Te&&(De=as(Te,1).concat(De)),$e&&(De=De.concat(as($e,-1)))),De}(ue,$),ue.length&&this.splitTile(ue,0,0,0),Z&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function zi(me,$,Z){return 32*((1<<me)*Z+$)+me}function Yi(me,$){const Z=me.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const ue=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!ue)return $(null,null);const _e=new class{constructor(Le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=Le.length,this._features=Le}feature(Le){return new class{constructor(De){this._feature=De,this.extent=n.EXTENT,this.type=De.type,this.properties=De.tags,"id"in De&&!isNaN(De.id)&&(this.id=parseInt(De.id,10))}loadGeometry(){if(this._feature.type===1){const De=[];for(const Te of this._feature.geometry)De.push([new n.Point(Te[0],Te[1])]);return De}{const De=[];for(const Te of this._feature.geometry){const $e=[];for(const mt of Te)$e.push(new n.Point(mt[0],mt[1]));De.push($e)}return De}}toGeoJSON(De,Te,$e){return Y.call(this,De,Te,$e)}}(this._features[Le])}}(ue.features);let Ee=Mt(_e);Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),$(null,{vectorTile:_e,rawData:Ee.buffer})}Ri.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ri.prototype.splitTile=function(me,$,Z,ue,_e,Ee,Le){for(var De=[me,$,Z,ue],Te=this.options,$e=Te.debug;De.length;){ue=De.pop(),Z=De.pop(),$=De.pop(),me=De.pop();var mt=1<<$,gt=zi($,Z,ue),ut=this.tiles[gt];if(!ut&&($e>1&&console.time("creation"),ut=this.tiles[gt]=Cn(me,$,Z,ue,Te),this.tileCoords.push({z:$,x:Z,y:ue}),$e)){$e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,Z,ue,ut.numFeatures,ut.numPoints,ut.numSimplified),console.timeEnd("creation"));var Wt="z"+$;this.stats[Wt]=(this.stats[Wt]||0)+1,this.total++}if(ut.source=me,_e){if($===Te.maxZoom||$===_e)continue;var Jt=1<<_e-$;if(Z!==Math.floor(Ee/Jt)||ue!==Math.floor(Le/Jt))continue}else if($===Te.indexMaxZoom||ut.numPoints<=Te.indexMaxPoints)continue;if(ut.source=null,me.length!==0){$e>1&&console.time("clipping");var Ht,Yt,ls,Us,nr,Fr,xr=.5*Te.buffer/Te.extent,Oi=.5-xr,jr=.5+xr,Gr=1+xr;Ht=Yt=ls=Us=null,nr=be(me,mt,Z-xr,Z+jr,0,ut.minX,ut.maxX,Te),Fr=be(me,mt,Z+Oi,Z+Gr,0,ut.minX,ut.maxX,Te),me=null,nr&&(Ht=be(nr,mt,ue-xr,ue+jr,1,ut.minY,ut.maxY,Te),Yt=be(nr,mt,ue+Oi,ue+Gr,1,ut.minY,ut.maxY,Te),nr=null),Fr&&(ls=be(Fr,mt,ue-xr,ue+jr,1,ut.minY,ut.maxY,Te),Us=be(Fr,mt,ue+Oi,ue+Gr,1,ut.minY,ut.maxY,Te),Fr=null),$e>1&&console.timeEnd("clipping"),De.push(Ht||[],$+1,2*Z,2*ue),De.push(Yt||[],$+1,2*Z,2*ue+1),De.push(ls||[],$+1,2*Z+1,2*ue),De.push(Us||[],$+1,2*Z+1,2*ue+1)}}},Ri.prototype.getTile=function(me,$,Z){var ue=this.options,_e=ue.extent,Ee=ue.debug;if(me<0||me>24)return null;var Le=1<<me,De=zi(me,$=($%Le+Le)%Le,Z);if(this.tiles[De])return Li(this.tiles[De],_e);Ee>1&&console.log("drilling down to z%d-%d-%d",me,$,Z);for(var Te,$e=me,mt=$,gt=Z;!Te&&$e>0;)$e--,mt=Math.floor(mt/2),gt=Math.floor(gt/2),Te=this.tiles[zi($e,mt,gt)];return Te&&Te.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",$e,mt,gt),Ee>1&&console.time("drilling down"),this.splitTile(Te.source,$e,mt,gt,me,$,Z),Ee>1&&console.timeEnd("drilling down"),this.tiles[De]?Li(this.tiles[De],_e):null):null};class en extends n.VectorTileWorkerSource{constructor($,Z,ue,_e,Ee){super($,Z,ue,_e,Yi),Ee&&(this.loadGeoJSON=Ee)}loadData($,Z){const ue=$&&$.request,_e=ue&&ue.collectResourceTiming;this.loadGeoJSON($,(Ee,Le)=>{if(Ee||!Le)return Z(Ee);if(typeof Le!="object")return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{H(Le,!0);try{if($.filter){const Te=n.createExpression($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));Le={type:"FeatureCollection",features:Le.features.filter(mt=>Te.value.evaluate({zoom:0},mt))}}this._geoJSONIndex=$.cluster?new bs(function({superclusterOptions:Te,clusterProperties:$e}){if(!$e||!Te)return Te;const mt={},gt={},ut={accumulated:null,zoom:0},Wt={properties:null},Jt=Object.keys($e);for(const Ht of Jt){const[Yt,ls]=$e[Ht],Us=n.createExpression(ls),nr=n.createExpression(typeof Yt=="string"?[Yt,["accumulated"],["get",Ht]]:Yt);mt[Ht]=Us.value,gt[Ht]=nr.value}return Te.map=Ht=>{Wt.properties=Ht;const Yt={};for(const ls of Jt)Yt[ls]=mt[ls].evaluate(ut,Wt);return Yt},Te.reduce=(Ht,Yt)=>{Wt.properties=Yt;for(const ls of Jt)ut.accumulated=Ht[ls],Ht[ls]=gt[ls].evaluate(ut,Wt)},Te}($)).load(Le.features):function(Te,$e){return new Ri(Te,$e)}(Le,$.geojsonVtOptions)}catch(Te){return Z(Te)}this.loaded={};const De={};if(_e){const Te=n.getPerformanceMeasurement(ue);Te&&(De.resourceTiming={},De.resourceTiming[$.source]=JSON.parse(JSON.stringify(Te)))}Z(null,De)}})}reloadTile($,Z){const ue=this.loaded;return ue&&ue[$.uid]?super.reloadTile($,Z):this.loadTile($,Z)}loadGeoJSON($,Z){if($.request)n.getJSON($.request,Z);else{if(typeof $.data!="string")return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse($.data))}catch{return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(ue){Z(ue)}}getClusterChildren($,Z){try{Z(null,this._geoJSONIndex.getChildren($.clusterId))}catch(ue){Z(ue)}}getClusterLeaves($,Z){try{Z(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(ue){Z(ue)}}}class sl{constructor($){this.self=$,this.actor=new n.Actor($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.getProjection({name:"mercator"}),this.workerSourceTypes={vector:n.VectorTileWorkerSource,geojson:en},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,ue)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=ue},this.self.registerRTLTextPlugin=Z=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=Z.applyArabicShaping,n.plugin.processBidirectionalText=Z.processBidirectionalText,n.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches($,Z,ue){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],ue()}checkIfReady($,Z,ue){ue()}setReferrer($,Z){this.referrer=Z}spriteLoaded($,Z){this.isSpriteLoaded[$]=Z;for(const ue in this.workerSources[$]){const _e=this.workerSources[$][ue];for(const Ee in _e)_e[Ee]instanceof n.VectorTileWorkerSource&&(_e[Ee].isSpriteLoaded=Z,_e[Ee].fire(new n.Event("isSpriteLoaded")))}}setImages($,Z,ue){this.availableImages[$]=Z;for(const _e in this.workerSources[$]){const Ee=this.workerSources[$][_e];for(const Le in Ee)Ee[Le].availableImages=Z}ue()}enableTerrain($,Z,ue){this.terrain=Z,ue()}setProjection($,Z){this.projections[$]=n.getProjection(Z)}setLayers($,Z,ue){this.getLayerIndex($).replace(Z),ue()}updateLayers($,Z,ue){this.getLayerIndex($).update(Z.layers,Z.removedIds),ue()}loadTile($,Z,ue){const _e=this.enableTerrain?n.extend({enableTerrain:this.terrain},Z):Z;_e.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source).loadTile(_e,ue)}loadDEMTile($,Z,ue){const _e=this.enableTerrain?n.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource($,Z.source).loadTile(_e,ue)}reloadTile($,Z,ue){const _e=this.enableTerrain?n.extend({enableTerrain:this.terrain},Z):Z;_e.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source).reloadTile(_e,ue)}abortTile($,Z,ue){this.getWorkerSource($,Z.type,Z.source).abortTile(Z,ue)}removeTile($,Z,ue){this.getWorkerSource($,Z.type,Z.source).removeTile(Z,ue)}removeSource($,Z,ue){if(!this.workerSources[$]||!this.workerSources[$][Z.type]||!this.workerSources[$][Z.type][Z.source])return;const _e=this.workerSources[$][Z.type][Z.source];delete this.workerSources[$][Z.type][Z.source],_e.removeSource!==void 0?_e.removeSource(Z,ue):ue()}loadWorkerSource($,Z,ue){try{this.self.importScripts(Z.url),ue()}catch(_e){ue(_e.toString())}}syncRTLPluginState($,Z,ue){try{n.plugin.setState(Z);const _e=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&_e!=null){this.self.importScripts(_e);const Ee=n.plugin.isParsed();ue(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),Ee)}}catch(_e){ue(_e.toString())}}getAvailableImages($){let Z=this.availableImages[$];return Z||(Z=[]),Z}getLayerIndex($){let Z=this.layerIndexes[$];return Z||(Z=this.layerIndexes[$]=new q),Z}getWorkerSource($,Z,ue){if(this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][Z]||(this.workerSources[$][Z]={}),!this.workerSources[$][Z][ue]){const _e={send:(Ee,Le,De,Te,$e,mt)=>{this.actor.send(Ee,Le,De,$,$e,mt)},scheduler:this.actor.scheduler};this.workerSources[$][Z][ue]=new this.workerSourceTypes[Z](_e,this.getLayerIndex($),this.getAvailableImages($),this.isSpriteLoaded[$])}return this.workerSources[$][Z][ue]}getDEMWorkerSource($,Z){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][Z]||(this.demWorkerSources[$][Z]=new U),this.demWorkerSources[$][Z]}enforceCacheSizeLimit($,Z){n.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics($,Z,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new sl(self)),sl}),E(["./shared"],function(n){function M(u,i){if(Array.isArray(u)){if(!Array.isArray(i)||u.length!==i.length)return!1;for(let o=0;o<u.length;o++)if(!M(u[o],i[o]))return!1;return!0}if(typeof u=="object"&&u!==null&&i!==null){if(typeof i!="object"||Object.keys(u).length!==Object.keys(i).length)return!1;for(const o in u)if(!M(u[o],i[o]))return!1;return!0}return u===i}var z=q;function q(u){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,f,_=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(_);try{f=new Worker(j),m=!0}catch{m=!1}return f&&f.terminate(),URL.revokeObjectURL(j),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var f=m.getContext("2d");if(!f)return!1;var _=f.getImageData(0,0,1,1);return _&&_.width===m.width}()?(U[o=i&&i.failIfMajorPerformanceCaveat]===void 0&&(U[o]=function(m){var f,_=function(j){var S=document.createElement("canvas"),C=Object.create(q.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=j,S.getContext("webgl",C)||S.getContext("experimental-webgl",C)}(m);if(!_)return!1;try{f=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!f||_.isContextLost())&&(_.shaderSource(f,"void main() {}"),_.compileShader(f),_.getShaderParameter(f,_.COMPILE_STATUS)===!0)}(o)),U[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o}(u)}var U={};function V(u,i,o){const m=n.window.document.createElement(u);return i!==void 0&&(m.className=i),o&&o.appendChild(m),m}function G(u,i,o){const m=n.window.document.createElementNS("http://www.w3.org/2000/svg",u);for(const f of Object.keys(i))m.setAttributeNS(null,f,i[f]);return o&&o.appendChild(m),m}q.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const H=n.window.document&&n.window.document.documentElement.style,Y=H&&H.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ge;function oe(){H&&Y&&(ge=H[Y],H[Y]="none")}function se(){H&&Y&&(H[Y]=ge)}function de(u){u.preventDefault(),u.stopPropagation(),n.window.removeEventListener("click",de,!0)}function ae(){n.window.addEventListener("click",de,!0),n.window.setTimeout(()=>{n.window.removeEventListener("click",de,!0)},0)}function Se(u,i){const o=u.getBoundingClientRect();return Ie(u,o,i)}function Ce(u,i){const o=u.getBoundingClientRect(),m=[];for(let f=0;f<i.length;f++)m.push(Ie(u,o,i[f]));return m}function fe(u){return n.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&n.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function Ie(u,i,o){const m=u.offsetWidth===i.width?1:u.offsetWidth/i.width;return new n.Point((o.clientX-i.left)*m,(o.clientY-i.top)*m)}function ke(u,i){var o=i[0],m=i[1],f=i[2],_=i[3],j=o*_-f*m;return j?(u[0]=_*(j=1/j),u[1]=-m*j,u[2]=-f*j,u[3]=o*j,u):null}function et(u){const{userImage:i}=u;return!!(i&&i.render&&i.render())&&(u.data.replace(new Uint8Array(i.data.buffer)),!0)}class Pe extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,callback:m}of this.requestors)this._notify(o,m);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,o){this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let m=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(o.content,o)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,o){if(!i)return!0;let m=0;for(const f of i){if(f[0]<m||f[1]<f[0]||o<f[1])return!1;m=f[1]}return!0}_validateContent(i,o){return!(i&&(i.length!==4||i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,o){o.version=this.images[i].version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,o){let m=!0;if(!this.isLoaded())for(const f of i)this.images[f]||(m=!1);this.isLoaded()||m?this._notify(i,o):this.requestors.push({ids:i,callback:o})}_notify(i,o){const m={};for(const f of i){this.images[f]||this.fire(new n.Event("styleimagemissing",{id:f}));const _=this.images[f];_?m[f]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:n.warnOnce(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,m)}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],m=this.getImage(i);if(!m)return null;if(o&&o.position.version===m.version)return o.position;if(o)o.position.version=m.version;else{const f={w:m.data.width+2,h:m.data.height+2,x:0,y:0},_=new n.ImagePosition(f,m);this.patterns[i]={bin:f,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new n.Texture(i,this.atlasImage,o.RGBA),this.atlasTexture&&this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h:m}=n.potpack(i),f=this.atlasImage;f.resize({width:o||1,height:m||1});for(const _ in this.patterns){const{bin:j}=this.patterns[_],S=j.x+1,C=j.y+1,D=this.images[_].data,I=D.width,O=D.height;n.RGBAImage.copy(D,f,{x:0,y:0},{x:S,y:C},{width:I,height:O}),n.RGBAImage.copy(D,f,{x:0,y:O-1},{x:S,y:C-1},{width:I,height:1}),n.RGBAImage.copy(D,f,{x:0,y:0},{x:S,y:C+O},{width:I,height:1}),n.RGBAImage.copy(D,f,{x:I-1,y:0},{x:S-1,y:C},{width:1,height:O}),n.RGBAImage.copy(D,f,{x:0,y:0},{x:S+I,y:C},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const m=this.images[o];et(m)&&this.updateImage(o,m)}}}const Ne=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(u,i){return function([o,m,f]){const _=n.degToRad(m+90),j=n.degToRad(f);return{x:o*Math.cos(_)*Math.sin(j),y:o*Math.sin(_)*Math.sin(j),z:o*Math.cos(j),azimuthal:m,polar:f}}(u.expression.evaluate(i))}interpolate(u,i,o){return{x:n.number(u.x,i.x,o),y:n.number(u.y,i.y,o),z:n.number(u.z,i.z,o),azimuthal:n.number(u.azimuthal,i.azimuthal,o),polar:n.number(u.polar,i.polar,o)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)});class it extends n.Evented{constructor(i){super(),this._transitionable=new n.Transitionable(Ne),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(n.validateLight,i,o))for(const m in i){const f=i[m];n.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),f):this._transitionable.setValue(m,f)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,i.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}const ft=new n.Properties({source:new n.DataConstantProperty(n.spec.terrain.source),exaggeration:new n.DataConstantProperty(n.spec.terrain.exaggeration)});let tt=class extends n.Evented{constructor(u,i){super(),this._transitionable=new n.Transitionable(ft),this.set(u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(u){for(const i in u){const o=u[i];n.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),o):this._transitionable.setValue(i,o)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}};function Mt(u,i,o,m){const f=n.smoothstep(45,65,o),[_,j]=Tt(u,m),S=n.length(i);let C=1-Math.min(1,Math.exp((S-_)/(j-_)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*f*u.alpha}function Tt(u,i){const o=.5/Math.tan(.5*i);return[u.range[0]+o,u.range[1]+o]}const At=new n.Properties({range:new n.DataConstantProperty(n.spec.fog.range),color:new n.DataConstantProperty(n.spec.fog.color),"high-color":new n.DataConstantProperty(n.spec.fog["high-color"]),"space-color":new n.DataConstantProperty(n.spec.fog["space-color"]),"horizon-blend":new n.DataConstantProperty(n.spec.fog["horizon-blend"]),"star-intensity":new n.DataConstantProperty(n.spec.fog["star-intensity"])});class zs extends n.Evented{constructor(i,o){super(),this._transitionable=new n.Transitionable(At),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const i=this._transform,o=i.projection.name==="globe",m=n.globeToMercatorTransition(i.zoom),f=this.properties.get("range"),_=[.5,3];return{range:o?[n.number(_[0],f[0],m),n.number(_[1],f[1],m)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o={}){if(!this._validate(n.validateFog,i,o)){for(const m of Object.keys(n.spec.fog))i&&i[m]===void 0&&(i[m]=n.spec.fog[m].default);for(const m in i){const f=i[m];n.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),f):this._transitionable.setValue(m,f)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.smoothstep(45,65,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(m,f,_){const j=n.MercatorCoordinate.fromLngLat(f),S=_.elevation?_.elevation.getAtPointOrZero(j):0,C=[j.x,j.y,S];return n.transformMat4(C,C,_.mercatorFogMatrix),Mt(m,C,_.pitch,_._fov)}(this.state,i,o):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Tt(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,i.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class ts{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=n.uniqueId();const m=this.workerPool.acquire(this.id);for(let f=0;f<m.length;f++){const _=new ts.Actor(m[f],o,this.id);_.name=`Worker ${f}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,m){n.asyncAll(this.actors,(f,_)=>{f.send(i,o,_)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Vt(u,i,o){return i*(n.EXTENT/(u.tileSize*Math.pow(2,o-u.tileID.overscaledZ)))}ts.Actor=n.Actor;class sr{constructor(i,o,m,f){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(i,o){let m,f;if(i instanceof n.Point||typeof i[0]=="number"){const _=n.Point.convert(i);m=[_],f=o.isPointAboveHorizon(_)}else{const _=n.Point.convert(i[0]),j=n.Point.convert(i[1]);m=[_,j],f=n.polygonizeBounds(_,j).every(S=>o.isPointAboveHorizon(S))}return new sr(m,o.getCameraPoint(),f,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return n.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.Point(1,1)):this.screenBounds[1],f=n.polygonizeBounds(o,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<m.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?f[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(f[3]=this.cameraPoint)),n.bufferConvexPolygon(f,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.Point(1,1)):this.screenBounds[1],f=n.polygonizeBounds(o,m,i),_=this.cameraPoint.clone();switch(3*((_.y>o.y)+(_.y>m.y))+((_.x>o.x)+(_.x>m.x))){case 0:f[0]=_,f[4]=_.clone();break;case 1:f.splice(1,0,_);break;case 2:f[1]=_;break;case 3:f.splice(4,0,_);break;case 5:f.splice(2,0,_);break;case 6:f[3]=_;break;case 7:f.splice(3,0,_);break;case 8:f[2]=_}return f}containsTile(i,o,m,f=0){const _=i.queryPadding/o._pixelsPerMercatorPixel+1,j=m?this._bufferedCameraMercator(_,o):this._bufferedScreenMercator(_,o);let S=i.tileID.wrap+(j.unwrapped?f:0);const C=j.polygon.map(te=>n.getTilePoint(i.tileTransform,te,S));if(!n.polygonIntersectsBox(C,0,0,n.EXTENT,n.EXTENT))return;S=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const D=this.screenGeometryMercator.polygon.map(te=>n.getTileVec3(i.tileTransform,te,S)),I=D.map(te=>new n.Point(te[0],te[1])),O=o.getFreeCameraOptions().position||new n.MercatorCoordinate(0,0,0),W=n.getTileVec3(i.tileTransform,O,S),Q=D.map(te=>{const F=n.sub(te,te,W);return n.normalize(F,F),new n.Ray(W,F)}),ee=Vt(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:Q,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(J=n.getBounds(C),J.min.x=n.clamp(J.min.x,0,n.EXTENT),J.min.y=n.clamp(J.min.y,0,n.EXTENT),J.max.x=n.clamp(J.max.x,0,n.EXTENT),J.max.y=n.clamp(J.max.y,0,n.EXTENT),J),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:ee};var J}_bufferedScreenMercator(i,o){const m=$r(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let f;return f=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[m]=f,f}}_bufferedCameraMercator(i,o){const m=$r(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let f;return f=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[m]=f,f}}_projectAndResample(i,o){const m=function(_,j){const S=n.multiply([],j.pixelMatrix,j.globeMatrix),C=[0,-n.GLOBE_RADIUS,0,1],D=[0,n.GLOBE_RADIUS,0,1],I=[0,0,0,1];n.transformMat4$1(C,C,S),n.transformMat4$1(D,D,S),n.transformMat4$1(I,I,S);const O=new n.Point(C[0]/C[3],C[1]/C[3]),W=new n.Point(D[0]/D[3],D[1]/D[3]),Q=n.polygonContainsPoint(_,O)&&C[3]<I[3],ee=n.polygonContainsPoint(_,W)&&D[3]<I[3];if(!Q&&!ee)return null;const J=function(we,Me,Ae){for(let Fe=1;Fe<we.length;Fe++){const at=fr(Me.pointCoordinate3D(we[Fe-1]).x),Re=fr(Me.pointCoordinate3D(we[Fe]).x);if(Ae<0){if(at<Re)return{idx:Fe,t:-at/(Re-1-at)}}else if(Re<at)return{idx:Fe,t:(1-at)/(Re+1-at)}}return null}(_,j,Q?-1:1);if(!J)return null;const{idx:te,t:F}=J;let K=te>1?bs(_.slice(0,te),j):[],ne=te<_.length?bs(_.slice(te),j):[];K=K.map(we=>new n.Point(fr(we.x),we.y)),ne=ne.map(we=>new n.Point(fr(we.x),we.y));const ce=[...K];ce.length===0&&ce.push(ne[ne.length-1]);const ve=n.number(ce[ce.length-1].y,(ne.length===0?K[0]:ne[0]).y,F);let je;return je=Q?[new n.Point(0,ve),new n.Point(0,0),new n.Point(1,0),new n.Point(1,ve)]:[new n.Point(1,ve),new n.Point(1,1),new n.Point(0,1),new n.Point(0,ve)],ce.push(...je),ne.length===0?ce.push(K[0]):ce.push(...ne),{polygon:ce.map(we=>new n.MercatorCoordinate(we.x,we.y)),unwrapped:!1}}(i,o);if(m)return m;const f=function(_,j){let S=!1,C=-1/0,D=0;for(let O=0;O<_.length-1;O++)_[O].x>C&&(C=_[O].x,D=O);for(let O=0;O<_.length-1;O++){const W=(D+O)%(_.length-1),Q=_[W],ee=_[W+1];Math.abs(Q.x-ee.x)>.5&&(Q.x<ee.x?(Q.x+=1,W===0&&(_[_.length-1].x+=1)):(ee.x+=1,W+1===_.length-1&&(_[0].x+=1)),S=!0)}const I=n.mercatorXfromLng(j.center.lng);return S&&I<Math.abs(I-1)&&_.forEach(O=>{O.x-=1}),{polygon:_,unwrapped:S}}(bs(i,o).map(_=>new n.Point(fr(_.x),_.y)),o);return{polygon:f.polygon.map(_=>new n.MercatorCoordinate(_.x,_.y)),unwrapped:f.unwrapped}}}function bs(u,i){return n.resample(u,o=>{const m=i.pointCoordinate3D(o);o.x=m.x,o.y=m.y},1/256)}function fr(u){return u<0?1+u%1:u%1}function $r(u){return 100*u|0}function gr(u,i,o,m,f){const _=function(j,S){if(j)return f(j);if(S){u.url&&S.tiles&&u.tiles&&delete u.tiles;const C=n.pick(n.extend(S,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(C.vectorLayers=S.vector_layers,C.vectorLayerIds=C.vectorLayers.map(D=>D.id)),C.tiles=i.canonicalizeTileset(C,u.url),f(null,C)}};return u.url?n.getJSON(i.transformRequest(i.normalizeSourceURL(u.url,null,o,m),n.ResourceType.Source),_):n.exported.frame(()=>_(null,u))}class _r{constructor(i,o,m){this.bounds=n.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),m=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*o),f=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*o),_=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*o),j=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*o);return i.x>=m&&i.x<_&&i.y>=f&&i.y<j}}class Xr{constructor(i,o,m){this.context=i;const f=i.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Rr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Si{constructor(i,o,m,f){this.length=o.length,this.attributes=m,this.itemSize=o.bytesPerElement,this.dynamicDraw=f,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let m=0;m<this.attributes.length;m++){const f=o.attributes[this.attributes[m].name];f!==void 0&&i.enableVertexAttribArray(f)}}setVertexAttribPointers(i,o,m){for(let f=0;f<this.attributes.length;f++){const _=this.attributes[f],j=o.attributes[_.name];j!==void 0&&i.vertexAttribPointer(j,_.components,i[Rr[_.type]],!1,this.itemSize,_.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ii extends Qt{getDefault(){return n.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class rr extends Qt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Di extends Qt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Ms extends Qt{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class zr extends Qt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class bt extends Qt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class ns extends Qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class be extends Qt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ue extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class He extends Qt{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class wt extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class pt extends Qt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class xt extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class Ot extends Qt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class hs extends Qt{getDefault(){return n.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class as extends Qt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class ir extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class Li extends Qt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Or extends Qt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Cn,Ji=class extends Qt{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class Ti extends Qt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Ri extends Qt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class zi extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Yi extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class en extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class sl extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class me extends Qt{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class $ extends Qt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Z extends Qt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class ue extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class _e extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Ee extends Qt{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Le extends Ee{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class De extends Ee{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Te extends De{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class $e{constructor(i,o,m,f){this.context=i,this.width=o,this.height=m;const _=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Le(i,_),f&&(this.depthAttachment=new De(i,_))}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class mt{constructor(i,o=!1){if(this.gl=i,this.isWebGL2=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),o){const m=i;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(i),deleteVertexArrayOES:m.deleteVertexArray.bind(i),bindVertexArrayOES:m.bindVertexArray.bind(i)}}this.clearColor=new Ii(this),this.clearDepth=new rr(this),this.clearStencil=new Di(this),this.colorMask=new Ms(this),this.depthMask=new zr(this),this.stencilMask=new bt(this),this.stencilFunc=new ns(this),this.stencilOp=new be(this),this.stencilTest=new Ue(this),this.depthRange=new He(this),this.depthTest=new wt(this),this.depthFunc=new pt(this),this.blend=new xt(this),this.blendFunc=new Ot(this),this.blendColor=new hs(this),this.blendEquation=new as(this),this.cullFace=new ir(this),this.cullFaceSide=new Li(this),this.frontFace=new Or(this),this.program=new Ji(this),this.activeTexture=new Ti(this),this.viewport=new Ri(this),this.bindFramebuffer=new zi(this),this.bindRenderbuffer=new Yi(this),this.bindTexture=new en(this),this.bindVertexBuffer=new sl(this),this.bindElementBuffer=new me(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new $(this),this.pixelStoreUnpack=new Z(this),this.pixelStoreUnpackPremultiplyAlpha=new ue(this),this.pixelStoreUnpackFlipY=new _e(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),o||(this.extTextureHalfFloat=i.getExtension("OES_texture_half_float")),(o||this.extTextureHalfFloat&&i.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o||i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new Xr(this,i,o)}createVertexBuffer(i,o,m){return new Si(this,i,o,m)}createRenderbuffer(i,o,m){const f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,i,o,m),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,m){return new $e(this,i,o,m)}clear({color:i,depth:o,stencil:m}){const f=this.gl;let _=0;i&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),m!==void 0&&(_|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),f.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){M(i.blendFunction,n.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class gt extends n.Evented{constructor(i,o,m,f){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(o,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new n.DedupedRequest}load(i){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=gr(this._options,this.map._requestManager,o,m,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new n.ErrorEvent(f))):_&&(n.extend(this,_),_.bounds&&(this.tileBounds=new _r(_.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(f)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return n.extend({},this._options)}loadTile(i,o){const m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(m,n.ResourceType.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile};if(f.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=o:i.request=i.actor.send("reloadTile",f,_.bind(this));else if(i.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",f,_.bind(this),void 0,!0);else{const j=n.loadVectorTile.call({deduped:this._deduped},f,(S,C)=>{S||!C?_.call(this,S):(f.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},i.actor&&i.actor.send("loadTile",f,_.bind(this),void 0,!0))},!0);i.request={cancel:j}}function _(j,S){return delete i.request,i.aborted?o(null):j&&j.status!==404?o(j):(S&&S.resourceTiming&&(i.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&i.setExpiryData(S),i.loadVectorData(S,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id})}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ut extends n.Evented{constructor(i,o,m,f){super(),this.id=i,this.dispatcher=m,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},o),n.extend(this,n.pick(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=gr(this._options,this.map._requestManager,null,null,(o,m)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new n.ErrorEvent(o)):m&&(n.extend(this,m),m.bounds&&(this.tileBounds=new _r(m.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(m.tiles),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return n.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const m=n.exported.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=n.getImage(this.map._requestManager.transformRequest(f,n.ResourceType.Tile),(_,j,S,C)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):_?(i.state="errored",o(_)):j?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:C}),i.setTexture(j,this.map.painter),i.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(i,o,m){i.setTexture(o,m)}static unloadTileData(i,o){i.texture&&o.saveTileTexture(i.texture)}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o()}unloadTile(i,o){i.texture&&this.map.painter.saveTileTexture(i.texture),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Wt(u,i,o,m,f,_,j,S){const C=[u,o,f,i,m,_,1,1,1],D=[j,S,1],I=n.adjoint([],C),[O,W,Q]=n.transformMat3(D,D,n.transpose(I,I));return n.multiply$1(C,[O,0,0,0,W,0,0,0,Q],C)}class Jt extends n.Evented{constructor(i,o,m,f){super(),this.id=i,this.dispatcher=m,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=o,this._dirty=!1}load(i,o){this._loaded=o||!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(m,f)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new n.ErrorEvent(m));else if(f){const{HTMLImageElement:_}=n.window;this.image=f instanceof _?n.exported.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const o=i.map(n.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let f=1/0,_=1/0,j=-1/0,S=-1/0;for(const O of m)f=Math.min(f,O.x),_=Math.min(_,O.y),j=Math.max(j,O.x),S=Math.max(S,O.y);const C=Math.max(j-f,S-_),D=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),I=Math.pow(2,D);return new n.CanonicalTileID(D,Math.floor((f+j)/2*I),Math.floor((_+S)/2*I))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const C in this.tiles){const D=this.tiles[C];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const o=n.tileTransform(this.tileID,this.map.transform.projection),[m,f,_,j]=this.coordinates.map(C=>{const D=o.projection.project(C[0],C[1]);return n.getTilePoint(o,D)._round()});this.perspectiveTransform=function(C,D,I,O,W,Q,ee,J,te,F){const K=Wt(0,0,C,0,0,D,C,D),ne=Wt(I,O,W,Q,ee,J,te,F);return n.multiply$1(ne,n.adjoint(K,K),ne),[ne[6]/ne[8]*C/n.EXTENT,ne[7]/ne[8]*D/n.EXTENT]}(this.width,this.height,m.x,m.y,f.x,f.y,j.x,j.y,_.x,_.y);const S=this._boundsArray=new n.StructArrayLayout4i8;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(f.x,f.y,n.EXTENT,0),S.emplaceBack(j.x,j.y,0,n.EXTENT),S.emplaceBack(_.x,_.y,n.EXTENT,n.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(S,n.boundsAttributes.members),this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new n.Texture(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,o){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},o(null)):(i.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ht={vector:gt,raster:ut,"raster-dem":class extends ut{constructor(u,i,o,m){super(u,i,o,m),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(u,i){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(f,_){f&&(u.state="errored",i(f)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",i(null))}u.request=n.getImage(this.map._requestManager.transformRequest(o,n.ResourceType.Tile),(function(f,_,j,S){if(delete u.request,u.aborted)u.state="unloaded",i(null);else if(f)u.state="errored",i(f);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:j,expires:S});const C=n.window.ImageBitmap&&_ instanceof n.window.ImageBitmap&&(Cn==null&&(Cn=n.window.OffscreenCanvas&&new n.window.OffscreenCanvas(1,1).getContext("2d")&&typeof n.window.createImageBitmap=="function"),Cn),D=1-(_.width-n.prevPowerOfTwo(_.width))/2;D<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const I=C?_:n.exported.getImageData(_,D),O={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:D};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",O,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const i=u.canonical,o=Math.pow(2,i.z),m=(i.x-1+o)%o,f=i.x===0?u.wrap-1:u.wrap,_=(i.x+1+o)%o,j=i.x+1===o?u.wrap+1:u.wrap,S={};return S[new n.OverscaledTileID(u.overscaledZ,f,i.z,m,i.y).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y).key]={backfilled:!1},i.y>0&&(S[new n.OverscaledTileID(u.overscaledZ,f,i.z,m,i.y-1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,u.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y-1).key]={backfilled:!1}),i.y+1<o&&(S[new n.OverscaledTileID(u.overscaledZ,f,i.z,m,i.y+1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,u.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y+1).key]={backfilled:!1}),S}unloadTile(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded"}},geojson:class extends n.Evented{constructor(u,i,o,m){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(m),this._data=i.data,this._options=n.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const f=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*f,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*f,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:n.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*f,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},i),this}getClusterChildren(u,i){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},i),this}getClusterLeaves(u,i,o,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:i,offset:o},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.Event("dataloading",{dataType:"source"})),this._loaded=!1;const u=n.extend({},this.workerOptions),i=this._data;typeof i=="string"?(u.request=this.map._requestManager.transformRequest(n.exported.resolveURL(i),n.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(o,m)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new n.ErrorEvent(o));else{const f={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(f.resourceTiming=m.resourceTiming[this.id]),this.fire(new n.Event("data",f)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,i){const o=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(o,{type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,f)=>(delete u.request,u.unloadVectorData(),u.aborted?i(null):m?i(m):(u.loadVectorData(f,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Jt{constructor(u,i,o,m){super(u,i,o,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const i of u.urls)this.urls.push(this.map._requestManager.transformRequest(i,n.ResourceType.Source).url);n.getVideo(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new n.ErrorEvent(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const i=this.video.seekable;u<i.start(0)||u>i.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,i=u.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new n.Texture(u,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Jt,canvas:class extends Jt{constructor(u,i,o,m){super(u,i,o,m),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(_=>typeof _!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof n.window.HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof n.window.HTMLCanvasElement?this.options.canvas:n.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends n.Evented{constructor(u,i,o,m){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _r(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),n.extend(this,n.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:i,y:o,z:m}=u.canonical;return this._implementation.hasTile({x:i,y:o,z:m})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,i){const{x:o,y:m,z:f}=u.tileID.canonical,_=new n.window.AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:o,y:m,z:f},{signal:_.signal})).then((function(j){return delete u.request,u.aborted?(u.state="unloaded",i(null)):j===void 0?(u.state="errored",i(null)):j===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",i(null)):function(S){return S instanceof n.window.ImageData||S instanceof n.window.HTMLCanvasElement||S instanceof n.window.ImageBitmap||S instanceof n.window.HTMLImageElement}(j)?(this.loadTileData(u,j),u.state="loaded",void i(null)):(u.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(j=>{j.code!==20&&(u.state="errored",i(j))}),u.request.cancel=()=>_.abort()}loadTileData(u,i){ut.loadTileData(u,i,this._map.painter)}unloadTileData(u){ut.unloadTileData(u,this._map.painter)}unloadTile(u,i){if(this.unloadTileData(u),this._implementation.unloadTile){const{x:o,y:m,z:f}=u.tileID.canonical;this._implementation.unloadTile({x:o,y:m,z:f})}i()}abortTile(u,i){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Yt=function(u,i,o,m){const f=new Ht[i.type](u,i,o,m);if(f.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${f.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],f),f};function ls(u,i){const o=n.identity([]);return n.scale(o,o,[.5*u.width,.5*-u.height,1]),n.translate(o,o,[1,-1,0]),n.multiply(o,o,u.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(o)}function Us(u,i,o,m,f,_,j,S=!1){const C=u.tilesIn(m,j,S);C.sort(Fr);const D=[];for(const O of C)D.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(i,o,u._state,O,f,_,ls(u.transform,O.tile.tileID),S)});const I=function(O){const W={},Q={};for(const ee of O){const J=ee.queryResults,te=ee.wrappedTileID,F=Q[te]=Q[te]||{};for(const K in J){const ne=J[K],ce=F[K]=F[K]||{},ve=W[K]=W[K]||[];for(const je of ne)ce[je.featureIndex]||(ce[je.featureIndex]=!0,ve.push(je))}}return W}(D);for(const O in I)I[O].forEach(W=>{const Q=W.feature,ee=Q.layer;ee&&ee.type!=="background"&&ee.type!=="sky"&&(Q.source=ee.source,ee["source-layer"]&&(Q.sourceLayer=ee["source-layer"]),Q.state=Q.id!==void 0?u.getFeatureState(ee["source-layer"],Q.id):{})});return I}function nr(u,i){const o=u.getRenderableIds().map(_=>u.getTileByID(_)),m=[],f={};for(let _=0;_<o.length;_++){const j=o[_],S=j.tileID.canonical.key;f[S]||(f[S]=!0,j.querySourceFeatures(m,i))}return m}function Fr(u,i){const o=u.tileID,m=i.tileID;return o.overscaledZ-m.overscaledZ||o.canonical.y-m.canonical.y||o.wrap-m.wrap||o.canonical.x-m.canonical.x}function xr(){return Da.workerClass!=null?new Da.workerClass:new n.window.Worker(Da.workerUrl)}const Oi="mapboxgl_preloaded_worker_pool";class jr{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<jr.workerCount;)this.workers.push(new xr);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Oi]}numActive(){return Object.keys(this.active).length}}let Gr;function ga(){return Gr||(Gr=new jr),Gr}function _m(u,i){const o={};for(const m in u)m!=="ref"&&(o[m]=u[m]);return n.refProperties.forEach(m=>{m in i&&(o[m]=i[m])}),o}function nd(u){u=u.slice();const i=Object.create(null);for(let o=0;o<u.length;o++)i[u[o].id]=u[o];for(let o=0;o<u.length;o++)"ref"in u[o]&&(u[o]=_m(u[o],i[u[o].ref]));return u}jr.workerCount=2;const ys={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function dc(u,i,o){o.push({command:ys.addSource,args:[u,i[u]]})}function io(u,i,o){i.push({command:ys.removeSource,args:[u]}),o[u]=!0}function hc(u,i,o,m){io(u,o,m),dc(u,i,o)}function rl(u,i,o){let m;for(m in u[o])if(u[o].hasOwnProperty(m)&&m!=="data"&&!M(u[o][m],i[o][m]))return!1;for(m in i[o])if(i[o].hasOwnProperty(m)&&m!=="data"&&!M(u[o][m],i[o][m]))return!1;return!0}function Fi(u,i,o,m,f,_){let j;for(j in i=i||{},u=u||{})u.hasOwnProperty(j)&&(M(u[j],i[j])||o.push({command:_,args:[m,j,i[j],f]}));for(j in i)i.hasOwnProperty(j)&&!u.hasOwnProperty(j)&&(M(u[j],i[j])||o.push({command:_,args:[m,j,i[j],f]}))}function tn(u){return u.id}function mc(u,i){return u[i.id]=i,u}class pc{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=n.clamp(i,0,1);let o=1,m=this._distances[o];const f=i*this.paddedLength+this.padding;for(;m<f&&o<this._distances.length;)m=this._distances[++o];const _=o-1,j=this._distances[_],S=m-j,C=S>0?(f-j)/S:0;return this.points[_].mult(1-C).add(this.points[o].mult(C))}}class Zn{constructor(i,o,m){const f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(o/m);for(let j=0;j<this.xCellCount*this.yCellCount;j++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,m,f,_){this._forEachCell(o,m,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(m),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(i,o,m,f){this._forEachCell(o-f,m-f,o+f,m+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(m),this.circles.push(f)}_insertBoxCell(i,o,m,f,_,j){this.boxCells[_].push(j)}_insertCircleCell(i,o,m,f,_,j){this.circleCells[_].push(j)}_query(i,o,m,f,_,j){if(m<0||i>this.width||f<0||o>this.height)return!_&&[];const S=[];if(i<=0&&o<=0&&this.width<=m&&this.height<=f){if(_)return!0;for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const D=this.circles[3*C],I=this.circles[3*C+1],O=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:D-O,y1:I-O,x2:D+O,y2:I+O})}return j?S.filter(j):S}return this._forEachCell(i,o,m,f,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},j),_?S.length>0:S}_queryCircle(i,o,m,f,_){const j=i-m,S=i+m,C=o-m,D=o+m;if(S<0||j>this.width||D<0||C>this.height)return!f&&[];const I=[];return this._forEachCell(j,C,S,D,this._queryCellCircle,I,{hitTest:f,circle:{x:i,y:o,radius:m},seenUids:{box:{},circle:{}}},_),f?I.length>0:I}query(i,o,m,f,_){return this._query(i,o,m,f,!1,_)}hitTest(i,o,m,f,_){return this._query(i,o,m,f,!0,_)}hitTestCircle(i,o,m,f){return this._queryCircle(i,o,m,!0,f)}_queryCell(i,o,m,f,_,j,S,C){const D=S.seenUids,I=this.boxCells[_];if(I!==null){const W=this.bboxes;for(const Q of I)if(!D.box[Q]){D.box[Q]=!0;const ee=4*Q;if(i<=W[ee+2]&&o<=W[ee+3]&&m>=W[ee+0]&&f>=W[ee+1]&&(!C||C(this.boxKeys[Q]))){if(S.hitTest)return j.push(!0),!0;j.push({key:this.boxKeys[Q],x1:W[ee],y1:W[ee+1],x2:W[ee+2],y2:W[ee+3]})}}}const O=this.circleCells[_];if(O!==null){const W=this.circles;for(const Q of O)if(!D.circle[Q]){D.circle[Q]=!0;const ee=3*Q;if(this._circleAndRectCollide(W[ee],W[ee+1],W[ee+2],i,o,m,f)&&(!C||C(this.circleKeys[Q]))){if(S.hitTest)return j.push(!0),!0;{const J=W[ee],te=W[ee+1],F=W[ee+2];j.push({key:this.circleKeys[Q],x1:J-F,y1:te-F,x2:J+F,y2:te+F})}}}}}_queryCellCircle(i,o,m,f,_,j,S,C){const D=S.circle,I=S.seenUids,O=this.boxCells[_];if(O!==null){const Q=this.bboxes;for(const ee of O)if(!I.box[ee]){I.box[ee]=!0;const J=4*ee;if(this._circleAndRectCollide(D.x,D.y,D.radius,Q[J+0],Q[J+1],Q[J+2],Q[J+3])&&(!C||C(this.boxKeys[ee])))return j.push(!0),!0}}const W=this.circleCells[_];if(W!==null){const Q=this.circles;for(const ee of W)if(!I.circle[ee]){I.circle[ee]=!0;const J=3*ee;if(this._circlesCollide(Q[J],Q[J+1],Q[J+2],D.x,D.y,D.radius)&&(!C||C(this.circleKeys[ee])))return j.push(!0),!0}}}_forEachCell(i,o,m,f,_,j,S,C){const D=this._convertToXCellCoord(i),I=this._convertToYCellCoord(o),O=this._convertToXCellCoord(m),W=this._convertToYCellCoord(f);for(let Q=D;Q<=O;Q++)for(let ee=I;ee<=W;ee++)if(_.call(this,i,o,m,f,this.xCellCount*ee+Q,j,S,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,m,f,_,j){const S=f-i,C=_-o,D=m+j;return D*D>S*S+C*C}_circleAndRectCollide(i,o,m,f,_,j,S){const C=(j-f)/2,D=Math.abs(i-(f+C));if(D>C+m)return!1;const I=(S-_)/2,O=Math.abs(o-(_+I));if(O>I+m)return!1;if(D<=C||O<=I)return!0;const W=D-C,Q=O-I;return W*W+Q*Q<=m*m}}const sn={unknown:0,flipRequired:1,flipNotRequired:2},no=Math.tan(85*Math.PI/180);function Ze(u,i,o,m,f,_,j){const S=n.create();if(o)if(_.name==="globe"){const C=n.calculateGlobeLabelMatrix(f,i);n.multiply(S,S,C)}else{const C=ke([],j);S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],m||n.rotateZ(S,S,f.angle)}else n.multiply(S,f.labelPlaneMatrix,u);return S}function rn(u,i,o,m,f,_,j){const S=Ze(u,i,o,m,f,_,j);return _.name==="globe"&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function ar(u,i,o,m,f,_,j){if(o){if(_.name==="globe"){const S=Ze(u,i,o,m,f,_,j);return n.invert(S,S),n.multiply(S,u,S),S}{const S=n.clone(u),C=n.identity([]);return C[0]=j[0],C[1]=j[1],C[4]=j[2],C[5]=j[3],n.multiply(S,S,C),m||n.rotateZ(S,S,-f.angle),S}}return f.glCoordMatrix}function Nr(u,i,o,m){const f=[u,i,o,1];o?n.transformMat4$1(f,f,m):rs(f,f,m);const _=f[3];return f[0]/=_,f[1]/=_,f[2]/=_,f}function ad(u,i){return Math.min(.5+u/i*.5,1.5)}function Bi(u,i){const o=u[0]/u[3],m=u[1]/u[3];return o>=-i[0]&&o<=i[0]&&m>=-i[1]&&m<=i[1]}function fc(u,i,o,m,f,_,j,S,C,D){const I=o.transform,O=m?u.textSizeData:u.iconSizeData,W=n.evaluateSizeForZoom(O,o.transform.zoom),Q=I.projection.name==="globe",ee=[256/o.width*2+1,256/o.height*2+1],J=m?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;J.clear();let te=null;Q&&(te=m?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const F=u.lineVertexArray,K=m?u.text.placedSymbolArray:u.icon.placedSymbolArray,ne=o.transform.width/o.transform.height;let ce,ve=!1;for(let je=0;je<K.length;je++){const we=K.get(je),{numGlyphs:Me,writingMode:Ae}=we;if(Ae!==n.WritingMode.vertical||ve||ce===n.WritingMode.horizontal||(ve=!0),ce=Ae,(we.hidden||Ae===n.WritingMode.vertical)&&!ve){Ei(Me,J);continue}ve=!1;const Fe=new n.Point(we.tileAnchorX,we.tileAnchorY);let{x:at,y:Re,z:Qe}=I.projection.projectTilePoint(Fe.x,Fe.y,D.canonical);if(C){const[qt,Et,Ft]=C(Fe);at+=qt,Re+=Et,Qe+=Ft}const Ve=[at,Re,Qe,1];if(n.transformMat4$1(Ve,Ve,i),!Bi(Ve,ee)){Ei(Me,J);continue}const nt=ad(o.transform.cameraToCenterDistance,Ve[3]),Oe=n.evaluateSizeForFeature(O,W,we),Xe=j?Oe/nt:Oe*nt,lt=Nr(at,Re,Qe,f);if(lt[3]<=0){Ei(Me,J);continue}let st={};const ct=j?null:C,Dt=jt(we,Xe,!1,S,i,f,_,u.glyphOffsetArray,F,J,te,lt,Fe,st,ne,ct,I.projection,D,j);ve=Dt.useVertical,ct&&Dt.needsFlipping&&(st={}),(Dt.notEnoughRoom||ve||Dt.needsFlipping&&jt(we,Xe,!0,S,i,f,_,u.glyphOffsetArray,F,J,te,lt,Fe,st,ne,ct,I.projection,D,j).notEnoughRoom)&&Ei(Me,J)}m?(u.text.dynamicLayoutVertexBuffer.updateData(J),te&&u.text.globeExtVertexBuffer.updateData(te)):(u.icon.dynamicLayoutVertexBuffer.updateData(J),te&&u.icon.globeExtVertexBuffer.updateData(te))}function od(u,i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J){const{lineStartIndex:te,glyphStartIndex:F,segment:K}=S,ne=F+S.numGlyphs,ce=te+S.lineLength,ve=i.getoffsetX(F),je=i.getoffsetX(ne-1),we=oi(u*ve,o,m,f,_,j,K,te,ce,C,D,I,O,W,!0,Q,ee,J);if(!we)return null;const Me=oi(u*je,o,m,f,_,j,K,te,ce,C,D,I,O,W,!0,Q,ee,J);return Me?{first:we,last:Me}:null}function xa(u,i,o,m){return u===n.WritingMode.horizontal&&Math.abs(m)>Math.abs(o)?{useVertical:!0}:u===n.WritingMode.vertical?m>0?{needsFlipping:!0}:null:i!==sn.unknown&&function(f,_){return f===0||Math.abs(_/f)>no}(o,m)?i===sn.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function jt(u,i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J,te,F,K){const ne=i/24,ce=u.lineOffsetX*ne,ve=u.lineOffsetY*ne,{lineStartIndex:je,glyphStartIndex:we,numGlyphs:Me,segment:Ae,writingMode:Fe,flipState:at}=u,Re=je+u.lineLength,Qe=Ve=>{if(I){const[lt,st,ct]=Ve.up,Dt=D.length;n.updateGlobeVertexNormal(I,Dt+0,lt,st,ct),n.updateGlobeVertexNormal(I,Dt+1,lt,st,ct),n.updateGlobeVertexNormal(I,Dt+2,lt,st,ct),n.updateGlobeVertexNormal(I,Dt+3,lt,st,ct)}const[nt,Oe,Xe]=Ve.point;n.addDynamicAttributes(D,nt,Oe,Xe,Ve.angle)};if(Me>1){const Ve=od(ne,S,ce,ve,o,O,W,u,C,_,Q,J,!1,te,F,K);if(!Ve)return{notEnoughRoom:!0};if(m&&!o){let[nt,Oe,Xe]=Ve.first.point,[lt,st,ct]=Ve.last.point;[nt,Oe]=Nr(nt,Oe,Xe,j),[lt,st]=Nr(lt,st,ct,j);const Dt=xa(Fe,at,(lt-nt)*ee,st-Oe);if(u.flipState=Dt&&Dt.needsFlipping?sn.flipRequired:sn.flipNotRequired,Dt)return Dt}Qe(Ve.first);for(let nt=we+1;nt<we+Me-1;nt++){const Oe=oi(ne*S.getoffsetX(nt),ce,ve,o,O,W,Ae,je,Re,C,_,Q,J,!1,!1,te,F,K);if(!Oe)return D.length-=4*(nt-we),{notEnoughRoom:!0};Qe(Oe)}Qe(Ve.last)}else{if(m&&!o){const nt=Nr(W.x,W.y,0,f),Oe=je+Ae+1,Xe=new n.Point(C.getx(Oe),C.gety(Oe)),lt=Nr(Xe.x,Xe.y,0,f),st=lt[3]>0?lt:ss(W,Xe,nt,1,f,void 0,te,F.canonical),ct=xa(Fe,at,(st[0]-nt[0])*ee,st[1]-nt[1]);if(u.flipState=ct&&ct.needsFlipping?sn.flipRequired:sn.flipNotRequired,ct)return ct}const Ve=oi(ne*S.getoffsetX(we),ce,ve,o,O,W,Ae,je,Re,C,_,Q,J,!1,!1,te,F,K);if(!Ve)return{notEnoughRoom:!0};Qe(Ve)}return{}}function os(u,i,o,m,f){const{x:_,y:j,z:S}=m.projectTilePoint(u.x,u.y,i);if(!f)return Nr(_,j,S,o);const[C,D,I]=f(u);return Nr(_+C,j+D,S+I,o)}function ss(u,i,o,m,f,_,j,S){const C=os(u.sub(i)._unit()._add(u),S,f,j,_);return n.sub(C,o,C),n.normalize(C,C),n.scaleAndAdd(C,o,C,m)}function oi(u,i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J,te,F){const K=m?u-i:u+i;let ne=K>0?1:-1,ce=0;m&&(ne*=-1,ce=Math.PI),ne<0&&(ce+=Math.PI);let ve=S+j+(ne>0?0:1)|0,je=f,we=f,Me=0,Ae=0;const Fe=Math.abs(K),at=[],Re=[];let Qe=_,Ve=Qe;const nt=()=>ss(Ve,Qe,we,Fe-Me+1,I,W,J,te.canonical);for(;Me+Ae<=Fe;){if(ve+=ne,ve<S||ve>=C)return null;if(we=je,Ve=Qe,at.push(we),Q&&Re.push(Ve),Qe=new n.Point(D.getx(ve),D.gety(ve)),je=O[ve],!je){const Ft=os(Qe,te.canonical,I,J,W);je=Ft[3]>0?O[ve]=Ft:nt()}Me+=Ae,Ae=n.distance(we,je)}ee&&W&&(O[ve]&&(je=nt(),Ae=n.distance(we,je)),O[ve]=je);const Oe=(Fe-Me)/Ae,Xe=Qe.sub(Ve)._mult(Oe)._add(Ve),lt=n.sub([],je,we),st=n.scaleAndAdd([],we,lt,Oe);let ct=[0,0,1],Dt=lt[0],qt=lt[1];if(F&&(ct=J.upVector(te.canonical,Xe.x,Xe.y),ct[0]!==0||ct[1]!==0||ct[2]!==1)){const Ft=[ct[2],0,-ct[0]],is=n.cross([],ct,Ft);n.normalize(Ft,Ft),n.normalize(is,is),Dt=n.dot(lt,Ft),qt=n.dot(lt,is)}if(o){const Ft=n.cross([],ct,lt);n.normalize(Ft,Ft),n.scaleAndAdd(st,st,Ft,o*ne)}const Et=ce+Math.atan2(qt,Dt);return at.push(st),Q&&Re.push(Xe),{point:st,angle:Et,path:at,tilePath:Re,up:ct}}function Ei(u,i){const o=i.length,m=o+4*u;i.resize(m),i.float32.fill(-1/0,4*o,4*m)}function rs(u,i,o){const m=i[0],f=i[1];return u[0]=o[0]*m+o[4]*f+o[12],u[1]=o[1]*m+o[5]*f+o[13],u[3]=o[3]*m+o[7]*f+o[15],u}const li=100;class ao{constructor(i,o,m=new Zn(i.width+200,i.height+200,25),f=new Zn(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=f,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+li,this.screenBottomBoundary=i.height+li,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,m,f,_,j,S,C){let D=m.projectedAnchorX,I=m.projectedAnchorY,O=m.projectedAnchorZ;const W=m.elevation,Q=m.tileID,ee=i.getProjection();if(W&&Q){const[je,we,Me]=ee.upVector(Q.canonical,m.tileAnchorX,m.tileAnchorY),Ae=ee.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=je*W*Ae,I+=we*W*Ae,O+=Me*W*Ae}const J=this.projectAndGetPerspectiveRatio(S,D,I,O,m.tileID,ee.name==="globe"||!!W||this.transform.pitch>0,ee),te=j*J.perspectiveRatio,F=(m.x1*o+f.x-m.padding)*te+J.point.x,K=(m.y1*o+f.y-m.padding)*te+J.point.y,ne=(m.x2*o+f.x+m.padding)*te+J.point.x,ce=(m.y2*o+f.y+m.padding)*te+J.point.y,ve=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(F,K,ne,ce)||!_&&this.grid.hitTest(F,K,ne,ce,C)||ve?{box:[],offscreen:!1,occluded:J.occluded}:{box:[F,K,ne,ce],offscreen:this.isOffscreen(F,K,ne,ce),occluded:!1}}placeCollisionCircles(i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J){const te=[],F=this.transform.elevation,K=i.getProjection(),ne=F?F.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,K):null,ce=new n.Point(m.tileAnchorX,m.tileAnchorY);let{x:ve,y:je,z:we}=K.projectTilePoint(ce.x,ce.y,J.canonical);if(ne){const[Xe,lt,st]=ne(ce);ve+=Xe,je+=lt,we+=st}const Me=K.name==="globe",Ae=this.projectAndGetPerspectiveRatio(S,ve,je,we,J,Me||!!F||this.transform.pitch>0,K),{perspectiveRatio:Fe}=Ae,at=(O?j/Fe:j*Fe)/n.ONE_EM,Re=Nr(ve,je,we,C),Qe=Ae.signedDistanceFromCamera>0?od(at,_,m.lineOffsetX*at,m.lineOffsetY*at,!1,Re,ce,m,f,C,{},F&&!O?ne:null,O&&!!F,K,J,O):null;let Ve=!1,nt=!1,Oe=!0;if(Qe&&!Ae.occluded){const Xe=.5*Q*Fe+ee,lt=new n.Point(-100,-100),st=new n.Point(this.screenRightBoundary,this.screenBottomBoundary),ct=new pc,{first:Dt,last:qt}=Qe,Et=Dt.path.length;let Ft=[];for(let Pt=Et-1;Pt>=1;Pt--)Ft.push(Dt.path[Pt]);for(let Pt=1;Pt<qt.path.length;Pt++)Ft.push(qt.path[Pt]);const is=2.5*Xe;D&&(Ft=Ft.map(([Pt,vs,ws],js)=>(ne&&!Me&&(ws=ne(js<Et-1?Dt.tilePath[Et-1-js]:qt.tilePath[js-Et+2])[2]),Nr(Pt,vs,ws,D))),Ft.some(Pt=>Pt[3]<=0)&&(Ft=[]));let es=[];if(Ft.length>0){let Pt=1/0,vs=-1/0,ws=1/0,js=-1/0;for(const Ns of Ft)Pt=Math.min(Pt,Ns[0]),ws=Math.min(ws,Ns[1]),vs=Math.max(vs,Ns[0]),js=Math.max(js,Ns[1]);vs>=lt.x&&Pt<=st.x&&js>=lt.y&&ws<=st.y&&(es=[Ft.map(Ns=>new n.Point(Ns[0],Ns[1]))],(Pt<lt.x||vs>st.x||ws<lt.y||js>st.y)&&(es=n.clipLine(es,lt.x,lt.y,st.x,st.y)))}for(const Pt of es){ct.reset(Pt,.25*Xe);let vs=0;vs=ct.length<=.5*Xe?1:Math.ceil(ct.paddedLength/is)+1;for(let ws=0;ws<vs;ws++){const js=ws/Math.max(vs-1,1),Ns=ct.lerp(js),Ur=Ns.x+li,Tr=Ns.y+li;te.push(Ur,Tr,Xe,0);const xi=Ur-Xe,$i=Tr-Xe,Bs=Ur+Xe,Ss=Tr+Xe;if(Oe=Oe&&this.isOffscreen(xi,$i,Bs,Ss),nt=nt||this.isInsideGrid(xi,$i,Bs,Ss),!o&&this.grid.hitTestCircle(Ur,Tr,Xe,W)&&(Ve=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!I&&Ve||!nt?[]:te,offscreen:Oe,collisionDetected:Ve,occluded:Ae.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let m=1/0,f=1/0,_=-1/0,j=-1/0;for(const I of i){const O=new n.Point(I.x+li,I.y+li);m=Math.min(m,O.x),f=Math.min(f,O.y),_=Math.max(_,O.x),j=Math.max(j,O.y),o.push(O)}const S=this.grid.query(m,f,_,j).concat(this.ignoredGrid.query(m,f,_,j)),C={},D={};for(const I of S){const O=I.key;if(C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]={}),C[O.bucketInstanceId][O.featureIndex])continue;const W=[new n.Point(I.x1,I.y1),new n.Point(I.x2,I.y1),new n.Point(I.x2,I.y2),new n.Point(I.x1,I.y2)];n.polygonIntersectsPolygon(o,W)&&(C[O.bucketInstanceId][O.featureIndex]=!0,D[O.bucketInstanceId]===void 0&&(D[O.bucketInstanceId]=[]),D[O.bucketInstanceId].push(O.featureIndex))}return D}insertCollisionBox(i,o,m,f,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:f,collisionGroupID:_},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,m,f,_){const j=o?this.ignoredGrid:this.grid,S={bucketInstanceId:m,featureIndex:f,collisionGroupID:_};for(let C=0;C<i.length;C+=4)j.insertCircle(S,i[C],i[C+1],i[C+2])}projectAndGetPerspectiveRatio(i,o,m,f,_,j,S){const C=[o,m,f,1];let D=!1;f||this.transform.pitch>0?(n.transformMat4$1(C,C,i),this.fogState&&_&&S.name!=="globe"&&(D=function(W,Q,ee,J,te,F){const K=F.calculateFogTileMatrix(te),ne=[Q,ee,J];return n.transformMat4(ne,ne,K),Mt(W,ne,F.pitch,F._fov)}(this.fogState,o,m,f,_.toUnwrapped(),this.transform)>.9)):rs(C,C,i);const I=C[3];return{point:new n.Point((C[0]/I+1)/2*this.transform.width+li,(-C[1]/I+1)/2*this.transform.height+li),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/I*.5,1.5),signedDistanceFromCamera:I,occluded:j&&C[2]>I||D}}isOffscreen(i,o,m,f){return m<li||i>=this.screenRightBoundary||f<li||o>this.screenBottomBoundary}isInsideGrid(i,o,m,f){return m>=0&&i<this.gridRightBoundary&&f>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=n.identity([]);return n.translate(i,i,[-100,-100,0]),i}}function Wn(u,i,o){const m=i.createTileMatrix(u,u.worldSize,o.toUnwrapped());return n.multiply(new Float32Array(16),u.projMatrix,m)}function mi(u,i,o){if(i.projection.name===o.projection.name)return u.projMatrix;const m=o.clone();return m.setProjection(i.projection),Wn(m,i.getProjection(),u)}function Fs(u,i,o){return i.name===o.projection.name?u.projMatrix:Wn(o,i,u)}class ld{constructor(i,o,m,f){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):f&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class nn{constructor(i,o,m,f,_,j=!1){this.text=new ld(i?i.text:null,o,m,_),this.icon=new ld(i?i.icon:null,o,f,_),this.clipped=j}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class oo{constructor(i,o,m,f=!1){this.text=i,this.icon=o,this.skipFade=m,this.clipped=f}}class lo{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class gc{constructor(i,o,m,f,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=m,this.bucketIndex=f,this.tileID=_}}class cd{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:m=>m.collisionGroupID===o}}return this.collisionGroups[i]}}function co(u,i,o,m,f){const{horizontalAlign:_,verticalAlign:j}=n.getAnchorAlignment(u),S=-(_-.5)*i,C=-(j-.5)*o,D=n.evaluateVariableOffset(u,m);return new n.Point(S+D[0]*f,C+D[1]*f)}function uo(u,i,o,m,f){const _=new n.Point(u,i);return o&&_._rotate(m?f:-f),_}class il{constructor(i,o,m,f,_){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new ao(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new cd(m),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,m,f){const _=m.getBucket(o),j=m.latestFeatureIndex;if(!_||!j||o.id!==_.layerIds[0])return;const S=_.layers[0].layout,C=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),I=m.tileSize/n.EXTENT,O=m.tileID.toUnwrapped();this.transform.setProjection(_.projection);const W=(Q=m.tileID,ee=_.getProjection(),J=this.transform,ee.name===this.projection?J.calculateProjMatrix(Q.toUnwrapped()):Wn(J,ee,Q));var Q,ee,J;const te=S.get("text-pitch-alignment")==="map",F=S.get("text-rotation-alignment")==="map";o.compileFilter();const K=o.dynamicFilter(),ne=o.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(m),ve=rn(W,m.tileID.canonical,te,F,this.transform,_.getProjection(),ce);let je=null;if(te){const Ae=ar(W,m.tileID.canonical,te,F,this.transform,_.getProjection(),ce);je=n.multiply([],this.transform.labelPlaneMatrix,Ae)}let we=null;K&&m.latestFeatureIndex&&(we={unwrappedTileID:O,dynamicFilter:K,dynamicFilterNeedsFeature:ne,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new gc(_.bucketInstanceId,j,_.sourceLayerIndex,_.index,m.tileID);const Me={bucket:_,layout:S,posMatrix:W,textLabelPlaneMatrix:ve,labelToScreenMatrix:je,clippingData:we,scale:D,textPixelRatio:I,holdingForFade:m.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(f)for(const Ae of _.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:at,symbolInstanceEnd:Re}=Ae;i.push({sortKey:Fe,symbolInstanceStart:at,symbolInstanceEnd:Re,parameters:Me})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J,te,F,K){const{textOffset0:ne,textOffset1:ce,crossTileID:ve}=W,je=[ne,ce],we=co(i,m,f,je,_),Me=this.collisionIndex.placeCollisionBox(ee,_,o,uo(we.x,we.y,j,S,this.transform.angle),O,C,D,I.predicate);if(te){const Ae=ee.getSymbolInstanceIconSize(K,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,Ae,te,uo(we.x,we.y,j,S,this.transform.angle),O,C,D,I.predicate).box.length===0)return}if(Me.box.length>0){let Ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[ve]&&this.prevPlacement.placements[ve]&&this.prevPlacement.placements[ve].text&&(Ae=this.prevPlacement.variableOffsets[ve].anchor),this.variableOffsets[ve]={textOffset:je,width:m,height:f,anchor:i,textScale:_,prevAnchor:Ae},this.markUsedJustification(ee,i,W,J),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,J,W),this.placedOrientations[ve]=J),{shift:we,placedGlyphBoxes:Me}}}placeLayerBucketPart(i,o,m,f){const{bucket:_,layout:j,posMatrix:S,textLabelPlaneMatrix:C,labelToScreenMatrix:D,clippingData:I,textPixelRatio:O,holdingForFade:W,collisionBoxArray:Q,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:J,collisionGroup:te}=i.parameters,F=j.get("text-optional"),K=j.get("icon-optional"),ne=j.get("text-allow-overlap"),ce=j.get("icon-allow-overlap"),ve=j.get("text-rotation-alignment")==="map",je=j.get("text-pitch-alignment")==="map",we=j.get("icon-text-fit")!=="none",Me=j.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let Ae=ne&&(ce||!_.hasIconData()||K),Fe=ce&&(ne||!_.hasTextData()||F);!_.collisionArrays&&Q&&_.deserializeCollisionBoxes(Q),m&&f&&_.updateCollisionDebugBuffers(this.transform.zoom,Q);const at=(Re,Qe,Ve)=>{const{crossTileID:nt,numVerticalGlyphVertices:Oe}=Re;if(I){const Bs={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ss=null;if(I.dynamicFilterNeedsFeature){const gs=this.retainedQueryData[_.bucketInstanceId];Ss=I.featureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:gs.bucketIndex,sourceLayerIndex:gs.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(Bs,Ss,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new n.Point(Re.tileAnchorX,Re.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[nt]=new oo(!1,!1,!1,!0),void o.add(nt)}if(o.has(nt))return;if(W)return void(this.placements[nt]=new oo(!1,!1,!1));let Xe=!1,lt=!1,st=!0,ct=!1,Dt=!1,qt=null,Et={box:null,offscreen:null,occluded:null},Ft={box:null,offscreen:null,occluded:null},is=null,es=null,Pt=null,vs=0,ws=0,js=0;Ve.textFeatureIndex?vs=Ve.textFeatureIndex:Re.useRuntimeCollisionCircles&&(vs=Re.featureIndex),Ve.verticalTextFeatureIndex&&(ws=Ve.verticalTextFeatureIndex);const Ns=Bs=>{Bs.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const Ss=this.transform.elevation;(Ss||Bs.elevation)&&(Bs.elevation=Ss?Ss.getAtTileOffset(Bs.tileID,Bs.tileAnchorX,Bs.tileAnchorY):0)},Ur=Ve.textBox;if(Ur){Ns(Ur);const Bs=gs=>{let or=n.WritingMode.horizontal;if(_.allowVerticalPlacement&&!gs&&this.prevPlacement){const Zr=this.prevPlacement.placedOrientations[nt];Zr&&(this.placedOrientations[nt]=Zr,or=Zr,this.markUsedOrientation(_,or,Re))}return or},Ss=(gs,or)=>{if(_.allowVerticalPlacement&&Oe>0&&Ve.verticalTextBox){for(const Zr of _.writingModes)if(Zr===n.WritingMode.vertical?(Et=or(),Ft=Et):Et=gs(),Et&&Et.box&&Et.box.length)break}else Et=gs()};if(j.get("text-variable-anchor")){let gs=j.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt]){const Os=this.prevPlacement.variableOffsets[nt];gs.indexOf(Os.anchor)>0&&(gs=gs.filter(Jr=>Jr!==Os.anchor),gs.unshift(Os.anchor))}const or=(Os,Jr,Ml)=>{const ta=_.getSymbolInstanceTextSize(ee,Re,this.transform.zoom,Qe),Mo=(Os.x2-Os.x1)*ta+2*Os.padding,hn=(Os.y2-Os.y1)*ta+2*Os.padding,Mn=we&&!ce?Jr:null;Mn&&Ns(Mn);let sa={box:[],offscreen:!1,occluded:!1};const Pl=ne?2*gs.length:gs.length;for(let Po=0;Po<Pl;++Po){const au=this.attemptAnchorPlacement(gs[Po%gs.length],Os,Mo,hn,ta,ve,je,O,S,te,Po>=gs.length,Re,Qe,_,Ml,Mn,ee,J);if(au&&(sa=au.placedGlyphBoxes,sa&&sa.box&&sa.box.length)){Xe=!0,qt=au.shift;break}}return sa};Ss(()=>or(Ur,Ve.iconBox,n.WritingMode.horizontal),()=>{const Os=Ve.verticalTextBox;return Os&&Ns(Os),_.allowVerticalPlacement&&!(Et&&Et.box&&Et.box.length)&&Oe>0&&Os?or(Os,Ve.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Et&&(Xe=Et.box,st=Et.offscreen,ct=Et.occluded);const Zr=Bs(!(!Et||!Et.box));if(!Xe&&this.prevPlacement){const Os=this.prevPlacement.variableOffsets[nt];Os&&(this.variableOffsets[nt]=Os,this.markUsedJustification(_,Os.anchor,Re,Zr))}}else{const gs=(or,Zr)=>{const Os=_.getSymbolInstanceTextSize(ee,Re,this.transform.zoom,Qe),Jr=this.collisionIndex.placeCollisionBox(_,Os,or,new n.Point(0,0),ne,O,S,te.predicate);return Jr&&Jr.box&&Jr.box.length&&(this.markUsedOrientation(_,Zr,Re),this.placedOrientations[nt]=Zr),Jr};Ss(()=>gs(Ur,n.WritingMode.horizontal),()=>{const or=Ve.verticalTextBox;return _.allowVerticalPlacement&&Oe>0&&or?(Ns(or),gs(or,n.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Bs(!!(Et&&Et.box&&Et.box.length))}}if(is=Et,Xe=is&&is.box&&is.box.length>0,st=is&&is.offscreen,ct=is&&is.occluded,Re.useRuntimeCollisionCircles){const Bs=_.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex>=0?Re.centerJustifiedTextSymbolIndex:Re.verticalPlacedTextSymbolIndex),Ss=n.evaluateSizeForFeature(_.textSizeData,ee,Bs),gs=j.get("text-padding");es=this.collisionIndex.placeCollisionCircles(_,ne,Bs,_.lineVertexArray,_.glyphOffsetArray,Ss,S,C,D,m,je,te.predicate,Re.collisionCircleDiameter*Ss/n.ONE_EM,gs,this.retainedQueryData[_.bucketInstanceId].tileID),Xe=ne||es.circles.length>0&&!es.collisionDetected,st=st&&es.offscreen,ct=es.occluded}if(Ve.iconFeatureIndex&&(js=Ve.iconFeatureIndex),Ve.iconBox){const Bs=Ss=>{Ns(Ss);const gs=we&&qt?uo(qt.x,qt.y,ve,je,this.transform.angle):new n.Point(0,0),or=_.getSymbolInstanceIconSize(J,this.transform.zoom,Re.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,or,Ss,gs,ce,O,S,te.predicate)};Ft&&Ft.box&&Ft.box.length&&Ve.verticalIconBox?(Pt=Bs(Ve.verticalIconBox),lt=Pt.box.length>0):(Pt=Bs(Ve.iconBox),lt=Pt.box.length>0),st=st&&Pt.offscreen,Dt=Pt.occluded}const Tr=F||Re.numHorizontalGlyphVertices===0&&Oe===0,xi=K||Re.numIconVertices===0;if(Tr||xi?xi?Tr||(lt=lt&&Xe):Xe=lt&&Xe:lt=Xe=lt&&Xe,Xe&&is&&is.box&&this.collisionIndex.insertCollisionBox(is.box,j.get("text-ignore-placement"),_.bucketInstanceId,Ft&&Ft.box&&ws?ws:vs,te.ID),lt&&Pt&&this.collisionIndex.insertCollisionBox(Pt.box,j.get("icon-ignore-placement"),_.bucketInstanceId,js,te.ID),es&&(Xe&&this.collisionIndex.insertCollisionCircles(es.circles,j.get("text-ignore-placement"),_.bucketInstanceId,vs,te.ID),m)){const Bs=_.bucketInstanceId;let Ss=this.collisionCircleArrays[Bs];Ss===void 0&&(Ss=this.collisionCircleArrays[Bs]=new lo);for(let gs=0;gs<es.circles.length;gs+=4)Ss.circles.push(es.circles[gs+0]),Ss.circles.push(es.circles[gs+1]),Ss.circles.push(es.circles[gs+2]),Ss.circles.push(es.collisionDetected?1:0)}const $i=_.projection.name!=="globe";Ae=Ae&&($i||!ct),Fe=Fe&&($i||!Dt),this.placements[nt]=new oo(Xe||Ae,lt||Fe,st||_.justReloaded),o.add(nt)};if(Me){const Re=_.getSortedSymbolIndexes(this.transform.angle);for(let Qe=Re.length-1;Qe>=0;--Qe){const Ve=Re[Qe];at(_.symbolInstances.get(Ve),Ve,_.collisionArrays[Ve])}}else for(let Re=i.symbolInstanceStart;Re<i.symbolInstanceEnd;Re++)at(_.symbolInstances.get(Re),Re,_.collisionArrays[Re]);if(m&&_.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[_.bucketInstanceId];n.invert(Re.invProjMatrix,S),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(i,o,m,f){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:C,crossTileID:D}=m,I=n.getAnchorJustification(o),O=f===n.WritingMode.vertical?C:I==="left"?_:I==="center"?j:I==="right"?S:-1;_>=0&&(i.text.placedSymbolArray.get(_).crossTileID=O>=0&&_!==O?0:D),j>=0&&(i.text.placedSymbolArray.get(j).crossTileID=O>=0&&j!==O?0:D),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=O>=0&&S!==O?0:D),C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=O>=0&&C!==O?0:D)}markUsedOrientation(i,o,m){const f=o===n.WritingMode.horizontal||o===n.WritingMode.horizontalOnly?o:0,_=o===n.WritingMode.vertical?o:0,{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D}=m,I=i.text.placedSymbolArray;j>=0&&(I.get(j).placedOrientation=f),S>=0&&(I.get(S).placedOrientation=f),C>=0&&(I.get(C).placedOrientation=f),D>=0&&(I.get(D).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let m=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const f=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},j=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const C in this.placements){const D=this.placements[C],I=_[C];I?(this.opacities[C]=new nn(I,f,D.text,D.icon,null,D.clipped),m=m||D.text!==I.text.placed||D.icon!==I.icon.placed):(this.opacities[C]=new nn(null,f,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const C in _){const D=_[C];if(!this.opacities[C]){const I=new nn(D,f,!1,!1);I.isHidden()||(this.opacities[C]=I,m=m||D.text.placed||D.icon.placed)}}for(const C in j)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=j[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const m=new Set;for(const f of o){const _=f.getBucket(i);_&&f.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,m,f.collisionBoxArray)}}updateBucketOpacities(i,o,m){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const f=i.layers[0].layout,_=!!i.layers[0].dynamicFilter(),j=new nn(null,0,!1,!1,!0),S=f.get("text-allow-overlap"),C=f.get("icon-allow-overlap"),D=f.get("text-variable-anchor"),I=f.get("text-rotation-alignment")==="map",O=f.get("text-pitch-alignment")==="map",W=f.get("icon-text-fit")!=="none",Q=new nn(null,0,S&&(C||!i.hasIconData()||f.get("icon-optional")),C&&(S||!i.hasTextData()||f.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const ee=(te,F,K)=>{for(let ne=0;ne<F/4;ne++)te.opacityVertexArray.emplaceBack(K)};let J=0;for(let te=0;te<i.symbolInstances.length;te++){const F=i.symbolInstances.get(te),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:ne,crossTileID:ce,numIconVertices:ve}=F,je=o.has(ce);let we=this.opacities[ce];je?we=j:we||(we=Q,this.opacities[ce]=we),o.add(ce);const Me=K>0||ne>0,Ae=ve>0,Fe=this.placedOrientations[ce],at=Fe===n.WritingMode.vertical,Re=Fe===n.WritingMode.horizontal||Fe===n.WritingMode.horizontalOnly;if(!Me&&!Ae||we.isHidden()||J++,Me){const Qe=ho(we.text);ee(i.text,K,at?Gs:Qe),ee(i.text,ne,Re?Gs:Qe);const Ve=we.text.isHidden(),{leftJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:Oe,rightJustifiedTextSymbolIndex:Xe,verticalPlacedTextSymbolIndex:lt}=F,st=i.text.placedSymbolArray,ct=Ve||at?1:0;nt>=0&&(st.get(nt).hidden=ct),Oe>=0&&(st.get(Oe).hidden=ct),Xe>=0&&(st.get(Xe).hidden=ct),lt>=0&&(st.get(lt).hidden=Ve||Re?1:0);const Dt=this.variableOffsets[ce];Dt&&this.markUsedJustification(i,Dt.anchor,F,Fe);const qt=this.placedOrientations[ce];qt&&(this.markUsedJustification(i,"left",F,qt),this.markUsedOrientation(i,qt,F))}if(Ae){const Qe=ho(we.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:nt}=F,Oe=i.icon.placedSymbolArray,Xe=we.icon.isHidden()?1:0;Ve>=0&&(ee(i.icon,ve,at?Gs:Qe),Oe.get(Ve).hidden=Xe),nt>=0&&(ee(i.icon,F.numVerticalIconVertices,Re?Gs:Qe),Oe.get(nt).hidden=Xe)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Qe=i.collisionArrays[te];if(Qe){let Ve=new n.Point(0,0),nt=!0;if(Qe.textBox||Qe.verticalTextBox){if(D){const Xe=this.variableOffsets[ce];Xe?(Ve=co(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textScale),I&&Ve._rotate(O?this.transform.angle:-this.transform.angle)):nt=!1}_&&(nt=!we.clipped),Qe.textBox&&ya(i.textCollisionBox.collisionVertexArray,we.text.placed,!nt||at,Ve.x,Ve.y),Qe.verticalTextBox&&ya(i.textCollisionBox.collisionVertexArray,we.text.placed,!nt||Re,Ve.x,Ve.y)}const Oe=nt&&!!(!Re&&Qe.verticalIconBox);Qe.iconBox&&ya(i.iconCollisionBox.collisionVertexArray,we.icon.placed,Oe,W?Ve.x:0,W?Ve.y:0),Qe.verticalIconBox&&ya(i.iconCollisionBox.collisionVertexArray,we.icon.placed,!Oe,W?Ve.x:0,W?Ve.y:0)}}}if(i.fullyClipped=J===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=te.invProjMatrix,i.placementViewportMatrix=te.viewportMatrix,i.collisionCircleArray=te.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const m=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function ya(u,i,o,m,f){u.emplaceBack(i?1:0,o?1:0,m||0,f||0),u.emplaceBack(i?1:0,o?1:0,m||0,f||0),u.emplaceBack(i?1:0,o?1:0,m||0,f||0),u.emplaceBack(i?1:0,o?1:0,m||0,f||0)}const Kr=Math.pow(2,25),Ks=Math.pow(2,24),xc=Math.pow(2,17),yc=Math.pow(2,16),Qr=Math.pow(2,9),pi=Math.pow(2,8),ud=Math.pow(2,1);function ho(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const i=u.placed?1:0,o=Math.floor(127*u.opacity);return o*Kr+i*Ks+o*xc+i*yc+o*Qr+i*pi+o*ud+i}const Gs=0;class mo{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,m,f,_){const j=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(j,f,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<j.length;){const S=j[this._currentPartIndex];if(o.placeLayerBucketPart(S,this._seenCrossTileIDs,m,S.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class _c{constructor(i,o,m,f,_,j,S,C){this.placement=new il(i,_,j,S,C),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(i,o,m){const f=n.exported.now(),_=()=>{const j=n.exported.now()-f;return!this._forceFullPlacement&&j>2};for(;this._currentPlacementIndex>=0;){const j=o[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=S)&&(!j.maxzoom||j.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new mo(j)),this._inProgressLayer.continuePlacement(m[j.source],this.placement,this._showCollisionBoxes,j,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Hn=512/n.EXTENT/2;class Pr{constructor(i,o,m){this.tileID=i,this.bucketInstanceId=m,this.index=new n.KDBush(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const f=i.canonical.x*n.EXTENT,_=i.canonical.y*n.EXTENT;for(let j=0;j<o.length;j++){const{key:S,crossTileID:C,tileAnchorX:D,tileAnchorY:I}=o.get(j),O=Math.floor((f+D)*Hn),W=Math.floor((_+I)*Hn);this.index.add(O,W),this.keys.push(S),this.crossTileIDs.push(C)}this.index.finish()}findMatches(i,o,m){const f=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),_=Hn/Math.pow(2,o.canonical.z-this.tileID.canonical.z),j=o.canonical.x*n.EXTENT,S=o.canonical.y*n.EXTENT;for(let C=0;C<i.length;C++){const D=i.get(C);if(D.crossTileID)continue;const{key:I,tileAnchorX:O,tileAnchorY:W}=D,Q=Math.floor((j+O)*_),ee=Math.floor((S+W)*_),J=this.index.range(Q-f,ee-f,Q+f,ee+f);for(const te of J){const F=this.crossTileIDs[te];if(this.keys[te]===I&&!m.has(F)){m.add(F),D.crossTileID=F;break}}}}}class bc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const m in this.indexes){const f=this.indexes[m],_={};for(const j in f){const S=f[j];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),_[S.tileID.key]=S}this.indexes[m]=_}this.lng=i}addBucket(i,o,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const f=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const j=this.indexes[_];if(Number(_)>i.overscaledZ)for(const S in j){const C=j[S];C.tileID.isChildOf(i)&&C.findMatches(o.symbolInstances,i,f)}else{const S=j[i.scaledTo(Number(_)).key];S&&S.findMatches(o.symbolInstances,i,f)}}for(let _=0;_<o.symbolInstances.length;_++){const j=o.symbolInstances.get(_);j.crossTileID||(j.crossTileID=m.generate(),f.add(j.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Pr(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const m of o.crossTileIDs)this.usedCrossTileIDs[i].delete(m)}removeStaleBuckets(i){let o=!1;for(const m in this.indexes){const f=this.indexes[m];for(const _ in f)i[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,f[_]),delete f[_],o=!0)}return o}}class an{constructor(){this.layerIndexes={},this.crossTileIDs=new bc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,m,f){let _=this.layerIndexes[i.id];_===void 0&&(_=this.layerIndexes[i.id]=new vc);let j=!1;const S={};f.name!=="globe"&&_.handleWrapJump(m);for(const C of o){const D=C.getBucket(i);D&&i.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,D,this.crossTileIDs)&&(j=!0),S[D.bucketInstanceId]=!0)}return _.removeStaleBuckets(S)&&(j=!0),j}pruneUnusedLayers(i){const o={};i.forEach(m=>{o[m]=!0});for(const m in this.layerIndexes)o[m]||delete this.layerIndexes[m]}}const kn=(u,i)=>n.emitValidationErrors(u,i&&i.filter(o=>o.identifier!=="source.canvas")),nl=n.pick(ys,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),bm=n.pick(ys,["setCenter","setZoom","setBearing","setPitch"]),wc={version:8,layers:[],sources:{}},_a={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ui extends n.Evented{constructor(i,o={}){super(),this.map=i,this.dispatcher=new ts(ga(),this),this.imageManager=new Pe,this.imageManager.setEventedParent(this),this.glyphManager=new n.GlyphManager(i._requestManager,o.localFontFamily?n.LocalGlyphMode.all:o.localIdeographFontFamily?n.LocalGlyphMode.ideographs:n.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new an,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const m=this;this._rtlTextPluginCallback=Ui.registerForPluginStateChange(f=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(_,j)=>{if(n.triggerPluginCompletionEvent(_),j&&j.every(S=>S))for(const S in m._sourceCaches){const C=m._sourceCaches[S],D=C.getSource().type;D!=="vector"&&D!=="geojson"||C.reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const _=this.getSource(f.sourceId);if(_&&_.vectorLayerIds)for(const j in this._layers){const S=this._layers[j];S.source===_.id&&this._validateLayer(S)}})}loadURL(i,o={}){this.fire(new n.Event("dataloading",{dataType:"style"}));const m=typeof o.validate=="boolean"?o.validate:!n.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,o.accessToken);const f=this.map._requestManager.transformRequest(i,n.ResourceType.Style);this._request=n.getJSON(f,(_,j)=>{this._request=null,_?this.fire(new n.ErrorEvent(_)):j&&this._load(j,m)})}loadJSON(i,o={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(wc,!1)}_updateLayerCount(i,o){const m=o?1:-1;i.is3D()&&(this._num3DLayers+=m),i.type==="circle"&&(this._numCircleLayers+=m),i.type==="symbol"&&(this._numSymbolLayers+=m)}_load(i,o){if(o&&kn(this,n.validateStyle(i)))return;this._loaded=!0,this.stylesheet=n.clone$1(i),this._updateMapProjection();for(const f in i.sources)this.addSource(f,i.sources[f],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const m=nd(this.stylesheet.layers);this._order=m.map(f=>f.id),this._layers={},this._serializedLayers={};for(const f of m){const _=n.createStyleLayer(f);_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new it(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(o,m,f){let _,j,S;const C=n.exported.devicePixelRatio>1?"@2x":"";let D=n.getJSON(m.transformRequest(m.normalizeSpriteURL(o,C,".json"),n.ResourceType.SpriteJSON),(W,Q)=>{D=null,S||(S=W,_=Q,O())}),I=n.getImage(m.transformRequest(m.normalizeSpriteURL(o,C,".png"),n.ResourceType.SpriteImage),(W,Q)=>{I=null,S||(S=W,j=Q,O())});function O(){if(S)f(S);else if(_&&j){const W=n.exported.getImageData(j),Q={};for(const ee in _){const{width:J,height:te,x:F,y:K,sdf:ne,pixelRatio:ce,stretchX:ve,stretchY:je,content:we}=_[ee],Me=new n.RGBAImage({width:J,height:te});n.RGBAImage.copy(W,Me,{x:F,y:K},{x:0,y:0},{width:J,height:te}),Q[ee]={data:Me,pixelRatio:ce,sdf:ne,stretchX:ve,stretchY:je,content:we}}f(null,Q)}}return{cancel(){D&&(D.cancel(),D=null),I&&(I.cancel(),I=null)}}}(i,this.map._requestManager,(o,m)=>{if(this._spriteRequest=null,o)this.fire(new n.ErrorEvent(o));else if(m)for(const f in m)this.imageManager.addImage(f,m[f]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(i){const o=this.getSource(i.source);if(!o)return;const m=i.sourceLayer;m&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(m)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const o=[];for(const m of i){const f=this._layers[m];f.type!=="custom"&&o.push(f.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&(typeof i.isLayerDraped=="function"?i.isLayerDraped():_a[i.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const o=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(f.length||_.length)&&this._updateWorkerLayers(f,_);for(const j in this._updatedSources){const S=this._updatedSources[j];S==="reload"?this._reloadSource(j):S==="clear"&&this._clearSource(j)}this._updateTilesForChangedImages();for(const j in this._updatedPaintProps)this._layers[j].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const m={};for(const f in this._sourceCaches){const _=this._sourceCaches[f];m[f]=_.used,_.used=!1}for(const f of this._order){const _=this._layers[f];if(_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)){const S=this._getLayerSourceCache(_);S&&(S.used=!0)}const j=this.map.painter;if(j){const S=_.getProgramIds();if(!S)continue;const C=_.getProgramConfiguration(i.zoom);for(const D of S)j.useProgram(D,C)}}for(const f in m){const _=this._sourceCaches[f];m[f]!==_.used&&_.getSource().fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),kn(this,n.validateStyle(i)))return!1;(i=n.clone$1(i)).layers=nd(i.layers);const o=function(f,_){if(!f)return[{command:ys.setStyle,args:[_]}];let j=[];try{if(!M(f.version,_.version))return[{command:ys.setStyle,args:[_]}];M(f.center,_.center)||j.push({command:ys.setCenter,args:[_.center]}),M(f.zoom,_.zoom)||j.push({command:ys.setZoom,args:[_.zoom]}),M(f.bearing,_.bearing)||j.push({command:ys.setBearing,args:[_.bearing]}),M(f.pitch,_.pitch)||j.push({command:ys.setPitch,args:[_.pitch]}),M(f.sprite,_.sprite)||j.push({command:ys.setSprite,args:[_.sprite]}),M(f.glyphs,_.glyphs)||j.push({command:ys.setGlyphs,args:[_.glyphs]}),M(f.transition,_.transition)||j.push({command:ys.setTransition,args:[_.transition]}),M(f.light,_.light)||j.push({command:ys.setLight,args:[_.light]}),M(f.fog,_.fog)||j.push({command:ys.setFog,args:[_.fog]}),M(f.projection,_.projection)||j.push({command:ys.setProjection,args:[_.projection]});const S={},C=[];(function(O,W,Q,ee){let J;for(J in W=W||{},O=O||{})O.hasOwnProperty(J)&&(W.hasOwnProperty(J)||io(J,Q,ee));for(J in W){if(!W.hasOwnProperty(J))continue;const te=W[J];O.hasOwnProperty(J)?M(O[J],te)||(O[J].type==="geojson"&&te.type==="geojson"&&rl(O,W,J)?Q.push({command:ys.setGeoJSONSourceData,args:[J,te.data]}):hc(J,W,Q,ee)):dc(J,W,Q)}})(f.sources,_.sources,C,S);const D=[];f.layers&&f.layers.forEach(O=>{O.source&&S[O.source]?j.push({command:ys.removeLayer,args:[O.id]}):D.push(O)});let I=f.terrain;I&&S[I.source]&&(j.push({command:ys.setTerrain,args:[void 0]}),I=void 0),j=j.concat(C),M(I,_.terrain)||j.push({command:ys.setTerrain,args:[_.terrain]}),function(O,W,Q){W=W||[];const ee=(O=O||[]).map(tn),J=W.map(tn),te=O.reduce(mc,{}),F=W.reduce(mc,{}),K=ee.slice(),ne=Object.create(null);let ce,ve,je,we,Me,Ae,Fe;for(ce=0,ve=0;ce<ee.length;ce++)je=ee[ce],F.hasOwnProperty(je)?ve++:(Q.push({command:ys.removeLayer,args:[je]}),K.splice(K.indexOf(je,ve),1));for(ce=0,ve=0;ce<J.length;ce++)je=J[J.length-1-ce],K[K.length-1-ce]!==je&&(te.hasOwnProperty(je)?(Q.push({command:ys.removeLayer,args:[je]}),K.splice(K.lastIndexOf(je,K.length-ve),1)):ve++,Ae=K[K.length-ce],Q.push({command:ys.addLayer,args:[F[je],Ae]}),K.splice(K.length-ce,0,je),ne[je]=!0);for(ce=0;ce<J.length;ce++)if(je=J[ce],we=te[je],Me=F[je],!ne[je]&&!M(we,Me))if(M(we.source,Me.source)&&M(we["source-layer"],Me["source-layer"])&&M(we.type,Me.type)){for(Fe in Fi(we.layout,Me.layout,Q,je,null,ys.setLayoutProperty),Fi(we.paint,Me.paint,Q,je,null,ys.setPaintProperty),M(we.filter,Me.filter)||Q.push({command:ys.setFilter,args:[je,Me.filter]}),M(we.minzoom,Me.minzoom)&&M(we.maxzoom,Me.maxzoom)||Q.push({command:ys.setLayerZoomRange,args:[je,Me.minzoom,Me.maxzoom]}),we)we.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&(Fe.indexOf("paint.")===0?Fi(we[Fe],Me[Fe],Q,je,Fe.slice(6),ys.setPaintProperty):M(we[Fe],Me[Fe])||Q.push({command:ys.setLayerProperty,args:[je,Fe,Me[Fe]]}));for(Fe in Me)Me.hasOwnProperty(Fe)&&!we.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&(Fe.indexOf("paint.")===0?Fi(we[Fe],Me[Fe],Q,je,Fe.slice(6),ys.setPaintProperty):M(we[Fe],Me[Fe])||Q.push({command:ys.setLayerProperty,args:[je,Fe,Me[Fe]]}))}else Q.push({command:ys.removeLayer,args:[je]}),Ae=K[K.lastIndexOf(je)+1],Q.push({command:ys.addLayer,args:[Me,Ae]})}(D,_.layers,j)}catch(S){console.warn("Unable to compute style diff:",S),j=[{command:ys.setStyle,args:[_]}]}return j}(this.serialize(),i).filter(f=>!(f.command in bm));if(o.length===0)return!1;const m=o.filter(f=>!(f.command in nl));if(m.length>0)throw new Error(`Unimplemented: ${m.map(f=>f.command).join(", ")}.`);return o.forEach(f=>{f.command!=="setTransition"&&f.command!=="setProjection"&&this[f.command].apply(this,f.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,o){return this.getImage(i)?this.fire(new n.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,o),this._afterImageUpdated(i),this)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new n.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,o,m={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(n.validateSource,`sources.${i}`,o,null,m))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const f=Yt(i,o,this.dispatcher,this);f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:f.serialize(),sourceId:i}));const _=j=>{const S=(j?"symbol:":"other:")+i,C=this._sourceCaches[S]=new n.SourceCache(S,f,j);(j?this._symbolSourceCaches:this._otherSourceCaches)[i]=C,C.style=this,C.onAdd(this.map)};_(!1),o.type!=="vector"&&o.type!=="geojson"||_(!0),f.onAdd&&f.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const o=this.getSource(i);if(!o)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===i)return this.fire(new n.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new n.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(i);for(const f of m)delete this._sourceCaches[f.id],delete this._updatedSources[f.id],f.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getSource(i).setData(o),this._changed=!0}getSource(i){const o=this._getSourceCache(i);return o&&o.getSource()}_getSources(){const i=[];for(const o in this._otherSourceCaches){const m=this._getSourceCache(o);m&&i.push(m.getSource())}return i}addLayer(i,o,m={}){this._checkLoaded();const f=i.id;if(this.getLayer(f))return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${f}" already exists on this map`)));let _;if(i.type==="custom"){if(kn(this,n.validateCustomStyleLayer(i)))return;_=n.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(f,i.source),i=n.clone$1(i),i=n.extend(i,{source:f})),this._validate(n.validateLayer,`layers.${f}`,i,{arrayIndex:-1},m))return;_=n.createStyleLayer(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const j=o?this._order.indexOf(o):this._order.length;if(o&&j===-1)return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(j,0,f),this._layerOrderChanged=!0,this._layers[f]=_;const S=this._getLayerSourceCache(_);if(this._removedLayers[f]&&_.source&&S&&_.type!=="custom"){const C=this._removedLayers[f];delete this._removedLayers[f],C.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",S.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const m=this._order.indexOf(i);this._order.splice(m,1);const f=o?this._order.indexOf(o):this._order.length;o&&f===-1?this.fire(new n.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(f,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,m){this._checkLoaded();const f=this.getLayer(i);f?f.minzoom===o&&f.maxzoom===m||(o!=null&&(f.minzoom=o),m!=null&&(f.maxzoom=m),this._updateLayer(f)):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,o,m={}){this._checkLoaded();const f=this.getLayer(i);if(f){if(!M(f.filter,o))return o==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(n.validateFilter,`layers.${f.id}.filter`,o,{layerType:f.type},m)||(f.filter=n.clone$1(o),this._updateLayer(f)))}else this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const o=this.getLayer(i);return o&&n.clone$1(o.filter)}setLayoutProperty(i,o,m,f={}){this._checkLoaded();const _=this.getLayer(i);_?M(_.getLayoutProperty(o),m)||(_.setLayoutProperty(o,m,f),this._updateLayer(_)):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,o){const m=this.getLayer(i);if(m)return m.getLayoutProperty(o);this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,o,m,f={}){this._checkLoaded();const _=this.getLayer(i);_?M(_.getPaintProperty(o),m)||(_.setPaintProperty(o,m,f)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,o){const m=this.getLayer(i);return m&&m.getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const m=i.source,f=i.sourceLayer,_=this.getSource(m);if(!_)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const j=_.type;if(j==="geojson"&&f)return void this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(j==="vector"&&!f)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(m);for(const C of S)C.setFeatureState(f,i.id,o)}removeFeatureState(i,o){this._checkLoaded();const m=i.source,f=this.getSource(m);if(!f)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const _=f.type,j=_==="vector"?i.sourceLayer:void 0;if(_==="vector"&&!j)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(m);for(const C of S)C.removeFeatureState(j,i.id,o)}getFeatureState(i){this._checkLoaded();const o=i.source,m=i.sourceLayer,f=this.getSource(o);if(f){if(f.type!=="vector"||m)return i.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(m,i.id);this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new n.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const o in this._sourceCaches){const m=this._sourceCaches[o].getSource();i[m.id]||(i[m.id]=m.serialize())}return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const o=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",o.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=j=>this._layers[j].type==="fill-extrusion",m={},f=[];for(let j=this._order.length-1;j>=0;j--){const S=this._order[j];if(o(S)){m[S]=j;for(const C of i){const D=C[S];if(D)for(const I of D)f.push(I)}}}f.sort((j,S)=>S.intersectionZ-j.intersectionZ);const _=[];for(let j=this._order.length-1;j>=0;j--){const S=this._order[j];if(o(S))for(let C=f.length-1;C>=0;C--){const D=f[C].feature;if(m[D.layer.id]<j)break;_.push(D),f.pop()}else for(const C of i){const D=C[S];if(D)for(const I of D)_.push(I.feature)}}return _}queryRenderedFeatures(i,o,m){o&&o.filter&&this._validate(n.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const f={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of o.layers){const D=this._layers[C];if(!D)return this.fire(new n.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];f[D.source]=!0}}const _=[];o.availableImages=this._availableImages;const j=o&&o.layers?o.layers.some(C=>{const D=this.getLayer(C);return D&&D.is3D()}):this.has3DLayers(),S=sr.createFromScreenPoints(i,m);for(const C in this._sourceCaches){const D=this._sourceCaches[C].getSource().id;o.layers&&!f[D]||_.push(Us(this._sourceCaches[C],this._layers,this._serializedLayers,S,o,m,j,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(C,D,I,O,W,Q,ee){const J={},te=Q.queryRenderedSymbols(O),F=[];for(const K of Object.keys(te).map(Number))F.push(ee[K]);F.sort(Fr);for(const K of F){const ne=K.featureIndex.lookupSymbolFeatures(te[K.bucketInstanceId],D,K.bucketIndex,K.sourceLayerIndex,W.filter,W.layers,W.availableImages,C);for(const ce in ne){const ve=J[ce]=J[ce]||[],je=ne[ce];je.sort((we,Me)=>{const Ae=K.featureSortOrder;if(Ae){const Fe=Ae.indexOf(we.featureIndex);return Ae.indexOf(Me.featureIndex)-Fe}return Me.featureIndex-we.featureIndex});for(const we of je)ve.push(we)}}for(const K in J)J[K].forEach(ne=>{const ce=ne.feature,ve=I(C[K]);if(!ve)return;const je=ve.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=je});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(n.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const m=this._getSourceCaches(i);let f=[];for(const _ of m)f=f.concat(nr(_,o));return f}addSourceType(i,o,m){return Ui.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(Ui.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const m=this.light.getLight();let f=!1;for(const j in i)if(!M(i[j],m[j])){f=!0;break}if(!f)return;const _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,o),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,o=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=i;if(o===1){if(typeof m.source=="object"){const f="terrain-dem-src";this.addSource(f,m.source),m=n.clone$1(m),m=n.extend(m,{source:f})}if(this._validate(n.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,o)}else{const f=this.terrain,_=f.get();for(const j of Object.keys(n.spec.terrain))!m.hasOwnProperty(j)&&n.spec.terrain[j].default&&(m[j]=n.spec.terrain[j].default);for(const j in m)if(!M(m[j],_[j])){f.set(m),this.stylesheet.terrain=m;const S=this._setTransitionParameters({duration:0});f.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new zs(i,this.map.transform);this.stylesheet.fog=i;const m=this._setTransitionParameters({duration:0});o.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,m=o.get();Object.keys(i).length===0&&o.set(i);for(const f in i)if(!M(i[f],m[f])){o.set(i),this.stylesheet.fog=i;const _=this._setTransitionParameters({duration:0});o.updateTransitions(_);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:n.exported.now(),transition:n.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(m=>this.isLayerDraped(this._layers[m])),o=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const m=this.terrain=new tt(i,o);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const f=this._setTransitionParameters({duration:0});m.updateTransitions(f)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,m,f,_={}){return(!_||_.validate!==!1)&&kn(this,i.call(n.validateStyle,n.extend({key:o,style:this.serialize(),value:m,styleSpec:n.spec},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const o=this._getSourceCaches(i);for(const m of o)m.clearTiles()}_reloadSource(i){const o=this._getSourceCaches(i);for(const m of o)m.resume(),m.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const o in this._sourceCaches)this._sourceCaches[o].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,m,f,_=!1){let j=!1,S=!1;const C={};for(const D of this._order){const I=this._layers[D];if(I.type!=="symbol")continue;if(!C[I.source]){const W=this._getLayerSourceCache(I);if(!W)continue;C[I.source]=W.getRenderableIds(!0).map(Q=>W.getTileByID(Q)).sort((Q,ee)=>ee.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(ee.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(I,C[I.source],i.center.lng,i.projection);j=j||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new n.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),i.zoom))&&(this.pauseablePlacement=new _c(i,this._order,_,o,m,f,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),S=!0),j&&this.pauseablePlacement.placement.setStale()),S||j)for(const D of this._order){const I=this._layers[D];I.type==="symbol"&&this.placement.updateLayerOpacities(I,C[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o,m){this.imageManager.getImages(o.icons,m),this._updateTilesForChangedImages();const f=_=>{_&&_.setDependencies(o.tileID.key,o.type,o.icons)};f(this._otherSourceCaches[o.source]),f(this._symbolSourceCaches[o.source])}getGlyphs(i,o,m){this.glyphManager.getGlyphs(o.stacks,m)}getResource(i,o,m){return n.makeRequest(o,m)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this._getSourceCaches(i);return o.length===0?(this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):o.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ui.getSourceType=function(u){return Ht[u]},Ui.setSourceType=function(u,i){Ht[u]=i},Ui.registerForPluginStateChange=n.registerForPluginStateChange;var jc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Xn="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",on=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,po=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ln=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let al={},ba={};const fo=[];va(jc,fo),va(on,fo),va(po,fo),va(ln,fo),al=_s("",on),ba=_s(ln,po);const dd=_s(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ol=jc,Nc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Sc={background:_s(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:_s(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:_s(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:_s("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_s(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:_s(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:_s("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:_s("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:_s("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:_s(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:_s(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:_s(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:_s(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:_s(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:_s(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:_s(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_s(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:_s(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:_s(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:_s(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:_s(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:_s(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:_s(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:_s(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:_s(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:_s(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Xn),skyboxGradient:_s(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Xn),skyboxCapture:_s(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:_s(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:_s(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function va(u,i){const o=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of o)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=m.split(" ");for(const _ of f)i.includes(_)||i.push(_)}}function _s(u,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),f={},_=[...fo];return va(u,_),va(i,_),{fragmentSource:u=u.replace(o,(j,S,C,D,I)=>(f[I]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${C} ${D} ${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = u_${I};
#endif
`)),vertexSource:i=i.replace(o,(j,S,C,D,I)=>{const O=D==="float"?"vec2":"vec4",W=I.match(/color/)?"color":O;return f[I]?S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${C} ${O} a_${I};
varying ${C} ${D} ${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${W}(a_${I}, u_${I}_t);
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${C} ${O} a_${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = a_${I};
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = unpack_mix_${W}(a_${I}, u_${I}_t);
#else
    ${C} ${D} ${I} = u_${I};
#endif
`}),staticAttributes:m,usedDefines:_}}class vm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,m,f,_,j,S){this.context=i;let C=this.boundPaintVertexBuffers.length!==f.length;for(let I=0;!C&&I<f.length;I++)this.boundPaintVertexBuffers[I]!==f[I]&&(C=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let I=0;!D&&I<S.length;I++)this.boundDynamicVertexBuffers[I]!==S[I]&&(D=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==m||C||D||this.boundIndexBuffer!==_||this.boundVertexOffset!==j)this.freshBind(o,m,f,_,j,S);else{i.bindVertexArrayOES.set(this.vao);for(const I of S)I&&I.bind();_&&_.dynamicDraw&&_.bind()}}freshBind(i,o,m,f,_,j){let S;const C=i.numAttributes,D=this.context,I=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=j;else{S=D.currentNumAttributes||0;for(let O=C;O<S;O++)I.disableVertexAttribArray(O)}o.enableAttributes(I,i),o.bind(),o.setVertexAttribPointers(I,i,_);for(const O of m)O.enableAttributes(I,i),O.bind(),O.setVertexAttribPointers(I,i,_);for(const O of j)O&&(O.enableAttributes(I,i),O.bind(),O.setVertexAttribPointers(I,i,_));f&&f.bind(),D.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Tc(u,i){const o=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new n.MercatorCoordinate(0,m/o).toLngLat().lat,new n.MercatorCoordinate(0,(m+1)/o).toLngLat().lat]}function hd(u,i,o,m,f,_,j){const S=u.context,C=S.gl,D=o.fbo;if(!D)return;u.prepareDrawTile();const I=u.useProgram("hillshade");S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get());const O=((J,te,F,K)=>{const ne=F.paint.get("hillshade-shadow-color"),ce=F.paint.get("hillshade-highlight-color"),ve=F.paint.get("hillshade-accent-color");let je=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(je-=J.transform.angle);const we=!J.options.moving;return{u_matrix:K||J.transform.calculateProjMatrix(te.tileID.toUnwrapped(),we),u_image:0,u_latrange:Tc(0,te.tileID),u_light:[F.paint.get("hillshade-exaggeration"),je],u_shadow:ne,u_highlight:ce,u_accent:ve}})(u,o,m,u.terrain?i.projMatrix:null);u.prepareDrawProgram(S,I,i.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:Q,tileBoundsSegments:ee}=u.getTileBoundsBuffers(o);I.draw(S,C.TRIANGLES,f,_,j,n.CullFaceMode.disabled,O,m.id,W,Q,ee)}function Ec(u,i,o){if(!i.needsDEMTextureUpload)return;const m=u.context,f=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||u.getTileTexture(o.stride);const _=o.getPixels();i.demTexture?i.demTexture.update(_,{premultiply:!1}):i.demTexture=new n.Texture(m,_,f.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function md(u,i,o,m,f,_){const j=u.context,S=j.gl;if(!i.dem)return;const C=i.dem;if(j.activeTexture.set(S.TEXTURE1),Ec(u,i,C),!i.demTexture)return;i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const D=C.dim;j.activeTexture.set(S.TEXTURE0);let I=i.fbo;if(!I){const ee=new n.Texture(j,{width:D,height:D,data:null},S.RGBA);ee.bind(S.LINEAR,S.CLAMP_TO_EDGE),I=i.fbo=j.createFramebuffer(D,D,!0),I.colorAttachment.set(ee.texture)}j.bindFramebuffer.set(I.framebuffer),j.viewport.set([0,0,D,D]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:W,tileBoundsSegments:Q}=u.getMercatorTileBoundsBuffers();u.useProgram("hillshadePrepare").draw(j,S.TRIANGLES,m,f,_,n.CullFaceMode.disabled,((ee,J)=>{const te=J.stride,F=n.create();return n.ortho(F,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(F,F,[0,-n.EXTENT,0]),{u_matrix:F,u_image:1,u_dimension:[te,te],u_zoom:ee.overscaledZ,u_unpack:J.unpackVector}})(i.tileID,C),o.id,O,W,Q),i.needsHillshadePrepare=!1}const Cc=u=>({u_matrix:new n.UniformMatrix4f(u),u_image0:new n.Uniform1i(u),u_skirt_height:new n.Uniform1f(u)}),wa=(u,i)=>({u_matrix:u,u_image0:0,u_skirt_height:i}),ll=(u,i,o,m,f,_,j,S,C,D,I,O,W,Q,ee)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:o,u_zoom_transition:f,u_merc_center:_,u_image0:0,u_frustum_tl:j,u_frustum_tr:S,u_frustum_br:C,u_frustum_bl:D,u_globe_pos:I,u_globe_radius:O,u_viewport:W,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:Q});function ja(u,i){return u!=null&&i!=null&&!(!u.hasData()||!i.hasData())&&u.demTexture!=null&&i.demTexture!=null&&u.tileID.key!==i.tileID.key}const cn=new class{constructor(){this.operations={}}newMorphing(u,i,o,m,f){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==o.tileID.key&&(_.queued=o)}else this.operations[u]={startTime:m,phase:0,duration:f,from:i,to:o,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const i=this.operations[u];return{from:i.from,to:i.to,phase:i.phase}}update(u){for(const i in this.operations){const o=this.operations[i];for(o.phase=(u-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,u)){delete this.operations[i];break}}}_nextOp(u,i){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=i,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Kn={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function cl(u){return 6*Math.pow(1.5,22-u)}function pd(u,i){const o=1<<u.z;return!i&&(u.x===0||u.x===o-1)||u.y===0||u.y===o-1}const go=u=>({u_matrix:u});function kc(u,i,o,m,f){if(f>0){const _=n.exported.now(),j=(_-u.timeAdded)/f,S=i?(_-i.timeAdded)/f:-1,C=o.getSource(),D=m.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),I=!i||Math.abs(i.tileID.overscaledZ-D)>Math.abs(u.tileID.overscaledZ-D),O=I&&u.refreshedUponExpiration?1:n.clamp(I?j:1-S,0,1);return u.refreshedUponExpiration&&j>=1&&(u.refreshedUponExpiration=!1),i?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class Ac extends n.SourceCache{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new ts(ga(),null),f=Yt("mock-dem",o,m,i.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class ul extends n.SourceCache{constructor(i){const o=Yt("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new ts(ga(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,m){if(i.freezeTileCoverage)return;this.transform=i;const f=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,j)=>{if(_[j.key]="",!this._tiles[j.key]){const S=new n.Tile(j,this._source.tileSize*j.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[j.key]=S}return _},{});for(const _ in this._tiles)_ in f||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const m=Object.values(o);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dl extends n.OverscaledTileID{constructor(i,o,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=m}}class Mc extends n.Elevation{constructor(i,o){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,f,_]=function(C){const D=new n.StructArrayLayout2i4,I=new n.StructArrayLayout3ui6,O=131;D.reserve(17161),I.reserve(33800);const W=n.EXTENT/128,Q=n.EXTENT+W/2,ee=Q+W;for(let te=-W;te<ee;te+=W)for(let F=-W;F<ee;F+=W){const K=F<0||F>Q||te<0||te>Q?24575:0,ne=n.clamp(Math.round(F),0,n.EXTENT),ce=n.clamp(Math.round(te),0,n.EXTENT);D.emplaceBack(ne+K,ce)}const J=(te,F)=>{const K=F*O+te;I.emplaceBack(K+1,K,K+O),I.emplaceBack(K+O,K+O+1,K+1)};for(let te=1;te<129;te++)for(let F=1;F<129;F++)J(F,te);return[0,129].forEach(te=>{for(let F=0;F<130;F++)J(F,te),J(te,F)}),[D,I,32768]}(),j=i.context;this.gridBuffer=j.createVertexBuffer(m,n.posAttributes.members),this.gridIndexBuffer=j.createIndexBuffer(f),this.gridSegments=n.SegmentVector.simpleSegment(0,0,m.length,f.length),this.gridNoSkirtSegments=n.SegmentVector.simpleSegment(0,0,m.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ul(o.map),this.orthoMatrix=n.create(),n.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.EXTENT,0,n.EXTENT,0,1);const S=j.gl;this._overlapStencilMode=new n.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ac(o.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,m){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const f=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(f.get("source")),this._exaggeration=f.get("exaggeration");const _=()=>{this.sourceCache.used&&n.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(o,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),o.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&n.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=o.getIds().map(C=>{const D=o.getTileByID(C).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(C,D){const I=D.transform.pointCoordinate(D.transform.getCameraPoint()),O=new n.Point(I.x,I.y);C.sort((W,Q)=>{if(Q.overscaledZ-W.overscaledZ)return Q.overscaledZ-W.overscaledZ;const ee=new n.Point(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),J=new n.Point(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),te=O.mult(1<<W.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(ee)-te.distSqr(J)})})(f,this.painter),this._previousZoom=m.zoom;const _=this.proxyToSource||{};this.proxyToSource={},f.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const j=this._style._sourceCaches;for(const C in j){const D=j[C];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,i[C],_),D.usedForTerrain))continue;const I=i[C];D.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[o.id]=f.map(C=>new dl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=n.exported.now();const S={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const D=this.terrainTileForTile[C.key];if(!D)continue;const I=D.tileID.key;I in S||(this._visibleDemTiles.push(D),S[I]=I)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const m=this._findTileCoveringTileID(o,this.sourceCache);m&&(this.terrainTileForTile[o.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const m in this.terrainTileForTile){const f=this.terrainTileForTile[m],_=f.dem;!_||f.demTexture&&!f.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),Ec(this.painter,f,_))}}_prepareDemTileUniforms(i,o,m,f){if(!o||o.demTexture==null)return!1;const _=i.tileID.canonical,j=Math.pow(2,o.tileID.canonical.z-_.z),S=f||"";return m[`u_dem_tl${S}`]=[_.x*j%1,_.y*j%1],m[`u_dem_scale${S}`]=j,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,o=i.gl;if(!this._emptyDepthBufferTexture){const m=new n.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new n.Texture(i,m,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const o=this._visibleDemTiles.reduce((m,f)=>{if(!f.dem)return m;const _=f.dem.tree.minimums[0];return _>0&&i++,m+_},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const m=this._getLoadedAreaMinimum(),f=new n.RGBAImage({width:1,height:1},new Uint8Array(n.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(f,{premultiply:!1}):_=this._emptyDEMTexture=new n.Texture(i,f,o.RGBA,{premultiply:!1}),_}setupElevationDraw(i,o,m){const f=this.painter.context,_=f.gl,j=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:n.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;j.u_dem_size=this.sourceCache.getSource().tileSize,j.u_exaggeration=this.exaggeration();let C=null,D=null,I=1;if(m&&m.morphing&&this._useVertexMorphing){const O=m.morphing.srcDemTile,W=m.morphing.dstDemTile;I=m.morphing.phase,O&&W&&(this._prepareDemTileUniforms(i,O,j,"_prev")&&(D=O),this._prepareDemTileUniforms(i,W,j)&&(C=W))}if(D&&C?(f.activeTexture.set(_.TEXTURE2),C.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),f.activeTexture.set(_.TEXTURE4),D.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),j.u_dem_lerp=I):(C=this.terrainTileForTile[i.tileID.key],f.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(i,C,j)?C.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),f.activeTexture.set(_.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(j.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),j.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&C){const O=(1<<C.tileID.canonical.z)*n.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;j.u_meter_to_dem=O}if(m&&m.labelPlaneMatrixInv&&(j.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),o.setTerrainUniformValues(f,j),this.painter.transform.projection.name==="globe"){const O=this.globeUniformValues(this.painter.transform,i.tileID.canonical,m&&m.useDenormalizedUpVectorScale);o.setGlobeUniformValues(f,O)}}globeUniformValues(i,o,m){const f=i.projection;return{u_tile_tl_up:f.upVector(o,0,0),u_tile_tr_up:f.upVector(o,n.EXTENT,0),u_tile_br_up:f.upVector(o,n.EXTENT,n.EXTENT),u_tile_bl_up:f.upVector(o,0,n.EXTENT),u_tile_up_scale:m?n.globeMetersToEcef(1):f.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,m=this.painter.context;i.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,_,j,S,C){if(f.transform.projection.name==="globe")(function(D,I,O,W,Q){const ee=D.context,J=ee.gl;let te,F;const K=D.options.showTerrainWireframe?2:0,ne=D.transform,ce=n.globeUseCustomAntiAliasing(D,ee,ne),ve=(nt,Oe)=>{if(F===nt)return;const Xe=[Kn[nt],"PROJECTION_GLOBE_VIEW"];ce&&Xe.push("CUSTOM_ANTIALIASING"),Oe&&Xe.push(Kn[K]),te=D.useProgram("globeRaster",null,Xe),F=nt},je=D.colorModeForRenderPass(),we=new n.DepthMode(J.LEQUAL,n.DepthMode.ReadWrite,D.depthRangeFor3D);cn.update(Q);const Me=n.calculateGlobeMercatorMatrix(ne),Ae=[n.mercatorXfromLng(ne.center.lng),n.mercatorYfromLat(ne.center.lat)],Fe=K?[!1,!0]:[!1],at=D.globeSharedBuffers,Re=[ne.width*n.exported.devicePixelRatio,ne.height*n.exported.devicePixelRatio],Qe=Float32Array.from(ne.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};if(Fe.forEach(nt=>{const Oe=D.transform,Xe=cl(Oe.zoom)*I.exaggeration();F=-1;const lt=nt?J.LINES:J.TRIANGLES;for(const st of W){const ct=O.getTile(st),Dt=n.StencilMode.disabled,qt=I.prevTerrainTileForTile[st.key],Et=I.terrainTileForTile[st.key];ja(qt,Et)&&cn.newMorphing(st.key,qt,Et,Q,250),ee.activeTexture.set(J.TEXTURE0),ct.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Ft=cn.getMorphValuesForProxy(st.key),is=Ft?1:0;Ft&&n.extend$1(Ve,{morphing:{srcDemTile:Ft.from,dstDemTile:Ft.to,phase:n.easeCubicInOut(Ft.phase)}});const es=n.tileCornersToBounds(st.canonical),Pt=n.getLatitudinalLod(es.getCenter().lat),vs=n.getGridMatrix(st.canonical,es,Pt,Oe.worldSize/Oe._pixelsPerMercatorPixel),ws=n.globeNormalizeECEF(n.globeTileBounds(st.canonical)),js=ll(Oe.projMatrix,Qe,Me,ws,n.globeToMercatorTransition(Oe.zoom),Ae,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,Re,Xe,vs);if(ve(is,nt),I.setupElevationDraw(ct,te,Ve),D.prepareDrawProgram(ee,te,st.toUnwrapped()),at){const[Ns,Ur,Tr]=nt?at.getWirefameBuffers(D.context,Pt):at.getGridBuffers(Pt,Xe!==0);te.draw(ee,lt,we,Dt,je,n.CullFaceMode.backCCW,js,"globe_raster",Ns,Ur,Tr)}}}),at){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&nt.push("CUSTOM_ANTIALIASING"),te=D.useProgram("globeRaster",null,nt);for(const Oe of W){const{x:Xe,y:lt,z:st}=Oe.canonical,ct=lt===0,Dt=lt===(1<<st)-1,[qt,Et,Ft,is]=at.getPoleBuffers(st);if(is&&(ct||Dt)){const es=O.getTile(Oe);ee.activeTexture.set(J.TEXTURE0),es.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Pt=n.globePoleMatrixForTile(st,Xe,ne);const vs=n.globeNormalizeECEF(n.globeTileBounds(Oe.canonical)),ws=(js,Ns)=>js.draw(ee,J.TRIANGLES,we,n.StencilMode.disabled,je,n.CullFaceMode.disabled,ll(ne.projMatrix,Pt,Pt,vs,0,Ae,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Re,0),"globe_pole_raster",Ns,Ft,is);I.setupElevationDraw(es,te,Ve),D.prepareDrawProgram(ee,te,Oe.toUnwrapped()),ct&&ws(te,qt),Dt&&(Pt=n.scale(n.create(),Pt,[1,-1,1]),ws(te,Et))}}}})(f,_,j,S,C);else{const D=f.context,I=D.gl;let O,W;const Q=f.options.showTerrainWireframe?2:0,ee=(ne,ce)=>{if(W===ne)return;const ve=[Kn[ne]];ce&&ve.push(Kn[Q]),O=f.useProgram("terrainRaster",null,ve),W=ne},J=f.colorModeForRenderPass(),te=new n.DepthMode(I.LEQUAL,n.DepthMode.ReadWrite,f.depthRangeFor3D);cn.update(C);const F=f.transform,K=cl(F.zoom)*_.exaggeration();(Q?[!1,!0]:[!1]).forEach(ne=>{W=-1;const ce=ne?I.LINES:I.TRIANGLES,[ve,je]=ne?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const we of S){const Me=j.getTile(we),Ae=n.StencilMode.disabled,Fe=_.prevTerrainTileForTile[we.key],at=_.terrainTileForTile[we.key];ja(Fe,at)&&cn.newMorphing(we.key,Fe,at,C,250),D.activeTexture.set(I.TEXTURE0),Me.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const Re=cn.getMorphValuesForProxy(we.key),Qe=Re?1:0;let Ve;Re&&(Ve={morphing:{srcDemTile:Re.from,dstDemTile:Re.to,phase:n.easeCubicInOut(Re.phase)}});const nt=wa(we.projMatrix,pd(we.canonical,F.renderWorldCopies)?K/10:K);ee(Qe,ne),_.setupElevationDraw(Me,O,Ve),f.prepareDrawProgram(D,O,we.toUnwrapped()),O.draw(D,ce,te,Ae,J,n.CullFaceMode.backCCW,nt,"terrain_raster",_.gridBuffer,ve,je)}})}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,m=this.painter.context,f=this.proxySourceCache,_=this.proxiedCoords[f.id],j=this._drapedRenderBatches.shift(),S=[],C=o.style.order;let D=0;for(const I of _){const O=f.getTileByID(I.proxyTileKey),W=f.proxyCachedFBO[I.key]?f.proxyCachedFBO[I.key][i]:void 0,Q=W!==void 0?f.renderCache[W]:this.pool[D++],ee=W!==void 0;if(O.texture=Q.tex,ee&&!Q.dirty){S.push(O.tileID);continue}let J;m.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(m.clear({color:n.Color.transparent,stencil:0}),Q.dirty=!1);for(let te=j.start;te<=j.end;++te){const F=o.style._layers[C[te]];if(F.isHidden(o.transform.zoom))continue;const K=o.style._getLayerSourceCache(F),ne=K?this.proxyToSource[I.key][K.id]:[I];if(!ne)continue;const ce=ne;m.viewport.set([0,0,Q.fb.width,Q.fb.height]),J!==(K?K.id:null)&&(this._setupStencil(Q,ne,F,K),J=K?K.id:null),o.renderLayer(o,K,F,ce)}this.renderedToTile?(Q.dirty=!0,S.push(O.tileID)):ee||--D,D===5&&(D=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,o.width,o.height]),j.end+1}postRender(){}renderCacheEfficiency(i){const o=i.order.length;if(o===0)return{efficiency:100};let m,f=0,_=0,j=!1;for(let S=0;S<o;++S){const C=i._layers[i.order[S]];this._style.isLayerDraped(C)?(j&&++f,++_):j||(j=!0,m=C.id)}return _===0?{efficiency:100}:{efficiency:100*(1-f/_),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,m){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const j=_.tileID,S=1<<j.overscaledZ,{x:C,y:D}=j.canonical,I=C/S,O=(C+1)/S,W=D/S,Q=(D+1)/S;return{minx:I,miny:W,maxx:O,maxy:Q,t:_.dem.tree.raycastRoot(I,W,O,Q,i,o,m),tile:_}});f.sort((_,j)=>(_.t!==null?_.t:Number.MAX_VALUE)-(j.t!==null?j.t:Number.MAX_VALUE));for(const _ of f){if(_.t==null)return null;const j=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,i,o,m);if(j!=null)return j}return null}_createFBO(){const i=this.painter.context,o=i.gl,m=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const f=new n.Texture(i,{width:m[0],height:m[1],data:null},o.RGBA);f.bind(o.LINEAR,o.CLAMP_TO_EDGE);const _=i.createFramebuffer(m[0],m[1],!1);return _.colorAttachment.set(f.texture),_.depthAttachment=new Te(i,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:_,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._layers[i],m=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!m&&o.shouldRedrape():!m&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const m of this._style._getSources())if(m instanceof gt){i=!0;break}if(!i)return;const o={};for(let m=0;m<this._style.order.length;++m){const f=this._style._layers[this._style.order[m]],_=this._style._getLayerSourceCache(f);if(_&&!o[_.id]&&!f.isHidden(this.painter.transform.zoom)&&f.type==="line"&&f.widthExpression()instanceof n.ZoomDependentExpression){o[_.id]=!0;for(const j of this.proxyCoords){const S=this.proxyToSource[j.key][_.id];if(S)for(const C of S)this._clearRenderCacheForTile(_.id,C)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof ut){i=!0;break}if(!i)return;const o={};for(let m=0;m<this._style.order.length;++m){const f=this._style._layers[this._style.order[m]],_=this._style._getLayerSourceCache(f);if(!_||o[_.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;const j=f.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][_.id];if(C)for(const D of C){const I=kc(_.getTile(D),_.findLoadedParent(D,0),_,this.painter.transform,j);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(_.id,D)}}}}_setupDrapedRenderBatches(){const i=this._style.order,o=i.length;if(o===0)return;const m=[];let f,_=0,j=this._style._layers[i[_]];for(;!this._style.isLayerDraped(j)&&j.isHidden(this.painter.transform.zoom)&&++_<o;)j=this._style._layers[i[_]];for(;_<o;++_){const S=this._style._layers[i[_]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?f===void 0&&(f=_):f!==void 0&&(m.push({start:f,end:_-1}),f=void 0))}f!==void 0&&m.push({start:f,end:_-1}),this._drapedRenderBatches=m}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const j=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<j.length;++S){const C=Object.values(j[S]);o.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,f=this._tilesDirty;for(let j=m.length-1;j>=0;j--){const S=m[j];if(o.getTileByID(S.key),o.proxyCachedFBO[S.key]!==void 0){const C=i[S.key],D=this.proxyToSource[S.key];let I=0;for(const O in D){const W=D[O],Q=C[O];if(!Q||Q.length!==W.length||W.some((ee,J)=>ee!==Q[J]||f[O]&&f[O].hasOwnProperty(ee.key))){I=-1;break}++I}for(const O in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][O]].dirty=I<0||I!==Object.values(C).length}}const _=[...this._drapedRenderBatches];_.sort((j,S)=>S.end-S.start-(j.end-j.start));for(const j of _)for(const S of m){if(o.proxyCachedFBO[S.key])continue;let C=o.renderCachePool.pop();C===void 0&&o.renderCache.length<50&&(C=o.renderCache.length,o.renderCache.push(this._createFBO())),C!==void 0&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][j.start]=C,o.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,m,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,j=_.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(m.isTileClipped())S=o.length,this._overlapStencilMode.test={func:j.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:j.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):n.StencilMode.disabled}_renderTileClippingMasks(i,o){const m=this.painter,f=this.painter.context,_=f.gl;m._tileClippingMaskIDs={},f.setColorMode(n.ColorMode.disabled),f.setDepthMode(n.DepthMode.disabled);const j=m.useProgram("clippingMask");for(const S of i){const C=m._tileClippingMaskIDs[S.key]=--o;j.draw(f,_.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,go(S.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const m=[i.x,i.y,1,1];n.transformMat4$1(m,m,o.pixelMatrixInverse),n.scale$1(m,m,1/m[3]),m[0]/=o.worldSize,m[1]/=o.worldSize;const f=o._camera.position,_=n.mercatorZfromAltitude(1,o.center.lat),j=[f[0],f[1],f[2]/_,0],S=n.subtract([],m.slice(0,3),j);n.normalize(S,S);const C=this.raycast(j,S,this._exaggeration);return C!==null&&C?(n.scaleAndAdd(j,j,S,C),j[3]=j[2],j[2]*=_,j):null}drawDepth(){const i=this.painter,o=i.context,m=this.proxySourceCache,f=Math.ceil(i.width),_=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===f&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const j=o.gl,S=o.createFramebuffer(f,_,!0);o.activeTexture.set(j.TEXTURE0);const C=new n.Texture(o,{width:f,height:_,data:null},j.RGBA);C.bind(j.NEAREST,j.CLAMP_TO_EDGE),S.colorAttachment.set(C.texture);const D=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,f,_);S.depthAttachment.set(D),this._depthFBO=S,this._depthTexture=C}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,f,_]),function(j,S,C,D){if(j.transform.projection.name==="globe")return;const I=j.context,O=I.gl;I.clear({depth:1});const W=j.useProgram("terrainDepth"),Q=new n.DepthMode(O.LESS,n.DepthMode.ReadWrite,j.depthRangeFor3D);for(const ee of D){const J=C.getTile(ee),te=wa(ee.projMatrix,0);S.setupElevationDraw(J,W),W.draw(I,O.TRIANGLES,Q,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.backCCW,te,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,o,m){if(i.getSource()instanceof Jt)return this._setupProxiedCoordsForImageSource(i,o,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const f=this.proxiedCoords[i.id]=[],_=this.proxyCoords;for(let S=0;S<_.length;S++){const C=_[S],D=this._findTileCoveringTileID(C,i);if(D){const I=this._createProxiedId(C,D,m[C.key]&&m[C.key][i.id]);f.push(I),this.proxyToSource[C.key][i.id]=[I]}}let j=!1;for(let S=0;S<o.length;S++){const C=i.getTile(o[S]);if(!C||!C.hasData())continue;const D=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==C.tileID.canonical.z){const I=this.proxyToSource[D.tileID.key][i.id],O=this._createProxiedId(D.tileID,C,m[D.tileID.key]&&m[D.tileID.key][i.id]);I?I.splice(I.length-1,0,O):this.proxyToSource[D.tileID.key][i.id]=[O],f.push(O),j=!0}}this._sourceTilesOverlap[i.id]=j}_setupProxiedCoordsForImageSource(i,o,m){if(!i.getSource().loaded())return;const f=this.proxiedCoords[i.id]=[],_=this.proxyCoords,j=i.getSource(),S=new n.Point(j.tileID.x,j.tileID.y)._div(1<<j.tileID.z),C=j.coordinates.map(n.MercatorCoordinate.fromLngLat).reduce((I,O)=>(I.min.x=Math.min(I.min.x,O.x-S.x),I.min.y=Math.min(I.min.y,O.y-S.y),I.max.x=Math.max(I.max.x,O.x-S.x),I.max.y=Math.max(I.max.y,O.y-S.y),I),{min:new n.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(I,O)=>{const W=I.wrap+I.canonical.x/(1<<I.canonical.z),Q=I.canonical.y/(1<<I.canonical.z),ee=n.EXTENT/(1<<I.canonical.z),J=O.wrap+O.canonical.x/(1<<O.canonical.z),te=O.canonical.y/(1<<O.canonical.z);return W+ee<J+C.min.x||W>J+C.max.x||Q+ee<te+C.min.y||Q>te+C.max.y};for(let I=0;I<_.length;I++){const O=_[I];for(let W=0;W<o.length;W++){const Q=i.getTile(o[W]);if(!Q||!Q.hasData()||D(O,Q.tileID))continue;const ee=this._createProxiedId(O,Q,m[O.key]&&m[O.key][i.id]),J=this.proxyToSource[O.key][i.id];J?J.push(ee):this.proxyToSource[O.key][i.id]=[ee],f.push(ee)}}}_createProxiedId(i,o,m){let f=this.orthoMatrix;if(m){const _=m.find(j=>j.key===o.tileID.key);if(_)return _}if(o.tileID.key!==i.key){const _=i.canonical.z-o.tileID.canonical.z;let j,S,C;f=n.create();const D=o.tileID.wrap-i.wrap<<i.overscaledZ;_>0?(j=n.EXTENT>>_,S=j*((o.tileID.canonical.x<<_)-i.canonical.x+D),C=j*((o.tileID.canonical.y<<_)-i.canonical.y)):(j=n.EXTENT<<-_,S=n.EXTENT*(o.tileID.canonical.x-(i.canonical.x+D<<-_)),C=n.EXTENT*(o.tileID.canonical.y-(i.canonical.y<<-_))),n.ortho(f,0,j,0,j,0,1),n.translate(f,f,[S,C,0])}return new dl(o.tileID,i.key,f)}_findTileCoveringTileID(i,o){let m=o.getTile(i);if(m&&m.hasData())return m;const f=this._findCoveringTileCache[o.id],_=f[i.key];if(m=_?o.getTileByID(_):null,m&&m.hasData()||_===null)return m;let j=m?m.tileID:i,S=j.overscaledZ;const C=o.getSource().minzoom,D=[];if(!_){const O=o.getSource().maxzoom;if(i.canonical.z>=O){const W=i.canonical.z-O;o.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,o.transform.tileZoom),j=new n.OverscaledTileID(S,i.wrap,O,i.canonical.x>>W,i.canonical.y>>W)):W!==0&&(S=O,j=new n.OverscaledTileID(S,i.wrap,O,i.canonical.x>>W,i.canonical.y>>W))}j.key!==i.key&&(D.push(j.key),m=o.getTile(j))}const I=O=>{D.forEach(W=>{f[W]=O}),D.length=0};for(S-=1;S>=C&&(!m||!m.hasData());S--){m&&I(m.tileID.key);const O=j.calculateScaledKey(S);if(m=o.getTileByID(O),m&&m.hasData())break;const W=f[O];if(W===null)break;W===void 0?D.push(O):m=o.getTileByID(W)}return I(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(o){let m=0;const f=new n.StructArrayLayout2ui4,_=131;for(let j=1;j<129;j++){for(let S=1;S<129;S++)m=j*_+S,f.emplaceBack(m,m+1),f.emplaceBack(m,m+_),f.emplaceBack(m+1,m+_),j===128&&f.emplaceBack(m+_,m+_+1);f.emplaceBack(m+1,m+1+_)}return f}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=n.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ds{static cacheKey(i,o,m,f){let _=`${o}${f?f.cacheKey:""}`;for(const j of m)i.usedDefines.includes(j)&&(_+=`/${j}`);return _}constructor(i,o,m,f,_,j){const S=i.gl;this.program=S.createProgram();const C=function(F){const K=[];for(let ne=0;ne<F.length;ne++){if(F[ne]===null)continue;const ce=F[ne].split(" ");K.push(ce.pop())}return K}(m.staticAttributes),D=f?f.getBinderAttributes():[],I=C.concat(D);let O=f?f.defines():[];O=O.concat(j.map(F=>`#define ${F}`));const W=i.isWebGL2?`#version 300 es
`:"",Q=W+O.concat(i.extStandardDerivatives&&W.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Nc):Nc,Nc,ol,dd.fragmentSource,ba.fragmentSource,m.fragmentSource).join(`
`),ee=W+O.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ol,dd.vertexSource,ba.vertexSource,al.vertexSource,m.vertexSource).join(`
`),J=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(J,Q),S.compileShader(J),S.attachShader(this.program,J);const te=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(te,ee),S.compileShader(te),S.attachShader(this.program,te),this.attributes={},this.numAttributes=I.length;for(let F=0;F<this.numAttributes;F++)I[F]&&(S.bindAttribLocation(this.program,F,I[F]),this.attributes[I[F]]=F);S.linkProgram(this.program),S.deleteShader(te),S.deleteShader(J),this.fixedUniforms=_(i),this.binderUniforms=f?f.getUniforms(i):[],j.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new n.Uniform1i(F),u_dem_prev:new n.Uniform1i(F),u_dem_unpack:new n.Uniform4f(F),u_dem_tl:new n.Uniform2f(F),u_dem_scale:new n.Uniform1f(F),u_dem_tl_prev:new n.Uniform2f(F),u_dem_scale_prev:new n.Uniform1f(F),u_dem_size:new n.Uniform1f(F),u_dem_lerp:new n.Uniform1f(F),u_exaggeration:new n.Uniform1f(F),u_depth:new n.Uniform1i(F),u_depth_size_inv:new n.Uniform2f(F),u_meter_to_dem:new n.Uniform1f(F),u_label_plane_matrix_inv:new n.UniformMatrix4f(F)}))(i)),j.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new n.Uniform3f(F),u_tile_tr_up:new n.Uniform3f(F),u_tile_br_up:new n.Uniform3f(F),u_tile_bl_up:new n.Uniform3f(F),u_tile_up_scale:new n.Uniform1f(F)}))(i)),j.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new n.UniformMatrix4f(F),u_fog_range:new n.Uniform2f(F),u_fog_color:new n.Uniform4f(F),u_fog_horizon_blend:new n.Uniform1f(F),u_fog_temporal_offset:new n.Uniform1f(F),u_frustum_tl:new n.Uniform3f(F),u_frustum_tr:new n.Uniform3f(F),u_frustum_br:new n.Uniform3f(F),u_frustum_bl:new n.Uniform3f(F),u_globe_pos:new n.Uniform3f(F),u_globe_radius:new n.Uniform1f(F),u_globe_transition:new n.Uniform1f(F),u_is_globe:new n.Uniform1i(F),u_viewport:new n.Uniform2f(F)}))(i))}}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const f in o)m[f]&&m[f].set(this.program,f,o[f])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const f in o)m[f]&&m[f].set(this.program,f,o[f])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const f in o)m[f].set(this.program,f,o[f])}}draw(i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J){const te=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(f),i.setColorMode(_),i.setCullFace(j);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(this.program,K,S[K]);ee&&ee.setUniforms(this.program,i,this.binderUniforms,W,{zoom:Q});const F={[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[o];for(const K of O.get()){const ne=K.vaos||(K.vaos={});(ne[C]||(ne[C]=new vm)).bind(i,this,D,ee?ee.getPaintVertexBuffers():[],I,K.vertexOffset,J||[]),te.drawElements(o,K.primitiveLength*F,te.UNSIGNED_SHORT,K.primitiveOffset*F*2)}}}function xo(u,i){const o=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,u.transform.tileZoom)/o,f=m*(i.tileID.canonical.x+i.tileID.wrap*o),_=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/Vt(i,1,u.transform.tileZoom),u_pixel_coord_upper:[f>>16,_>>16],u_pixel_coord_lower:[65535&f,65535&_]}}const fd=n.create(),Pc=(u,i,o,m,f,_,j,S,C,D,I)=>{const O=i.style.light,W=O.properties.get("position"),Q=[W.x,W.y,W.z],ee=n.create$1();O.properties.get("anchor")==="viewport"&&(n.fromRotation(ee,-i.transform.angle),n.transformMat3(Q,Q,ee));const J=O.properties.get("color"),te=i.transform,F={u_matrix:u,u_lightpos:Q,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+o,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:f,u_edge_radius:_};return te.projection.name==="globe"&&(F.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],F.u_zoom_transition=C,F.u_inv_rot_matrix=I,F.u_merc_center=D,F.u_up_dir=te.projection.upVector(new n.CanonicalTileID(0,0,0),D[0]*n.EXTENT,D[1]*n.EXTENT),F.u_height_lift=S),F},gd=(u,i,o,m,f,_,j,S,C,D,I,O)=>{const W=Pc(u,i,o,m,f,_,j,C,D,I,O),Q={u_height_factor:-Math.pow(2,j.overscaledZ)/S.tileSize/8};return n.extend(W,xo(i,S),Q)},Qn=u=>({u_matrix:u}),Ic=(u,i,o)=>n.extend(Qn(u),xo(i,o)),wm=(u,i)=>({u_matrix:u,u_world:i}),jm=(u,i,o,m)=>n.extend(Ic(u,i,o),{u_world:m}),Nm=n.create(),Dc=(u,i,o,m,f,_)=>{const j=u.transform,S=j.projection.name==="globe";let C;if(_.paint.get("circle-pitch-alignment")==="map")if(S){const I=n.globePixelsToTileUnits(j.zoom,i.canonical)*j._pixelsPerMercatorPixel;C=Float32Array.from([I,0,0,I])}else C=j.calculatePixelsToTileUnitsMatrix(o);else C=new Float32Array([j.pixelsToGLUnits[0],0,0,j.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:j.cameraToCenterDistance,u_matrix:u.translatePosMatrix(i.projMatrix,o,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:n.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:Nm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){D.u_inv_rot_matrix=m,D.u_merc_center=f,D.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],D.u_zoom_transition=n.globeToMercatorTransition(j.zoom);const I=f[0]*n.EXTENT,O=f[1]*n.EXTENT;D.u_up_dir=j.projection.upVector(new n.CanonicalTileID(0,0,0),I,O)}return D},Lc=u=>{const i=[];return u.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},Rc=(u,i,o,m)=>{const f=n.EXTENT/o.tileSize;return{u_matrix:u,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/f,i.pixelsToGLUnits[1]/f]}},hl=(u,i,o=1)=>({u_matrix:u,u_color:i,u_overlay:0,u_overlay_scale:o}),xd=n.create(),yd=(u,i,o,m,f,_,j)=>{const S=u.transform,C=S.projection.name==="globe",D=C?n.globePixelsToTileUnits(S.zoom,i.canonical)*S._pixelsPerMercatorPixel:Vt(o,1,_),I={u_matrix:i.projMatrix,u_extrude_scale:D,u_intensity:j,u_inv_rot_matrix:xd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){I.u_inv_rot_matrix=m,I.u_merc_center=f,I.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],I.u_zoom_transition=n.globeToMercatorTransition(S.zoom);const O=f[0]*n.EXTENT,W=f[1]*n.EXTENT;I.u_up_dir=S.projection.upVector(new n.CanonicalTileID(0,0,0),O,W)}return I},Sm=(u,i,o,m,f,_,j)=>{const S=u.transform,C=S.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:zc(u,i,o,m),u_pixels_to_tile_units:C,u_device_pixel_ratio:_,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:_o(o)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Na(i,u.transform),u_alpha_discard_threshold:0,u_trim_offset:j}},yo=(u,i,o,m,f)=>{const _=u.transform;return{u_matrix:zc(u,i,o,m),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:f,u_image:0,u_tile_units_to_pixels:Na(i,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Na(u,i){return 1/Vt(u,1,i.tileZoom)}function zc(u,i,o,m){return u.translatePosMatrix(m||i.tileID.projMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function _o(u){const i=u.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const Oc=(u,i,o,m,f,_)=>{return{u_matrix:u,u_tl_parent:i,u_scale_parent:o,u_fade_t:m.mix,u_opacity:m.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(S=f.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(j=f.paint.get("raster-contrast"),j>0?1/(1-j):1+j),u_spin_weights:Vi(f.paint.get("raster-hue-rotate")),u_perspective_transform:_};var j,S};function Vi(u){u*=Math.PI/180;const i=Math.sin(u),o=Math.cos(u);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const ml=n.create(),Fc=(u,i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J)=>{const te=f.transform,F={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:te.width/te.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:j,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ml,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ml,u_up_vector:[0,-1,0]};return J.name==="globe"&&(F.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],F.u_zoom_transition=O,F.u_inv_rot_matrix=Q,F.u_merc_center=W,F.u_camera_forward=te._camera.forward(),F.u_ecef_origin=n.globeECEFOrigin(te.globeMatrix,I.toUnwrapped()),F.u_tile_matrix=Float32Array.from(te.globeMatrix),F.u_up_vector=ee),F},pl=(u,i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J,te)=>n.extend(Fc(u,i,o,m,f,_,j,S,C,D,O,W,Q,ee,J,te),{u_gamma_scale:m?f.transform.cameraToCenterDistance*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:n.exported.devicePixelRatio,u_is_halo:+I}),_d=(u,i,o,m,f,_,j,S,C,D,I,O,W,Q,ee,J)=>n.extend(pl(u,i,o,m,f,_,j,S,!0,C,!0,I,O,W,Q,ee,J),{u_texsize_icon:D,u_texture_icon:1}),Bc=(u,i,o)=>({u_matrix:u,u_opacity:i,u_color:o}),Tm=(u,i,o,m,f)=>n.extend(function(_,j,S){const C=j.imageManager.getPattern(_.toString()),{width:D,height:I}=j.imageManager.getPixelSize(),O=Math.pow(2,S.tileID.overscaledZ),W=S.tileSize*Math.pow(2,j.transform.tileZoom)/O,Q=W*(S.tileID.canonical.x+S.tileID.wrap*O),ee=W*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:C.tl,u_pattern_br:C.br,u_texsize:[D,I],u_pattern_size:C.displaySize,u_tile_units_to_pixels:1/Vt(S,1,j.transform.tileZoom),u_pixel_coord_upper:[Q>>16,ee>>16],u_pixel_coord_lower:[65535&Q,65535&ee]}}(m,o,f),{u_matrix:u,u_opacity:i}),Uc={fillExtrusion:u=>({u_matrix:new n.UniformMatrix4f(u),u_lightpos:new n.Uniform3f(u),u_lightintensity:new n.Uniform1f(u),u_lightcolor:new n.Uniform3f(u),u_vertical_gradient:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_edge_radius:new n.Uniform1f(u),u_ao:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_up_dir:new n.Uniform3f(u),u_height_lift:new n.Uniform1f(u)}),fillExtrusionPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_lightpos:new n.Uniform3f(u),u_lightintensity:new n.Uniform1f(u),u_lightcolor:new n.Uniform3f(u),u_vertical_gradient:new n.Uniform1f(u),u_height_factor:new n.Uniform1f(u),u_edge_radius:new n.Uniform1f(u),u_ao:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_up_dir:new n.Uniform3f(u),u_height_lift:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u)}),fill:u=>({u_matrix:new n.UniformMatrix4f(u)}),fillPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),fillOutline:u=>({u_matrix:new n.UniformMatrix4f(u),u_world:new n.Uniform2f(u)}),fillOutlinePattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_world:new n.Uniform2f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),circle:u=>({u_camera_to_center_distance:new n.Uniform1f(u),u_extrude_scale:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_up_dir:new n.Uniform3f(u)}),collisionBox:u=>({u_matrix:new n.UniformMatrix4f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_extrude_scale:new n.Uniform2f(u)}),collisionCircle:u=>({u_matrix:new n.UniformMatrix4f(u),u_inv_matrix:new n.UniformMatrix4f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_viewport_size:new n.Uniform2f(u)}),debug:u=>({u_color:new n.UniformColor(u),u_matrix:new n.UniformMatrix4f(u),u_overlay:new n.Uniform1i(u),u_overlay_scale:new n.Uniform1f(u)}),clippingMask:u=>({u_matrix:new n.UniformMatrix4f(u)}),heatmap:u=>({u_extrude_scale:new n.Uniform1f(u),u_intensity:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_up_dir:new n.Uniform3f(u)}),heatmapTexture:u=>({u_image:new n.Uniform1i(u),u_color_ramp:new n.Uniform1i(u),u_opacity:new n.Uniform1f(u)}),hillshade:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_latrange:new n.Uniform2f(u),u_light:new n.Uniform2f(u),u_shadow:new n.UniformColor(u),u_highlight:new n.UniformColor(u),u_accent:new n.UniformColor(u)}),hillshadePrepare:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_dimension:new n.Uniform2f(u),u_zoom:new n.Uniform1f(u),u_unpack:new n.Uniform4f(u)}),line:u=>({u_matrix:new n.UniformMatrix4f(u),u_pixels_to_tile_units:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_units_to_pixels:new n.Uniform2f(u),u_dash_image:new n.Uniform1i(u),u_gradient_image:new n.Uniform1i(u),u_image_height:new n.Uniform1f(u),u_texsize:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_alpha_discard_threshold:new n.Uniform1f(u),u_trim_offset:new n.Uniform2f(u)}),linePattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_texsize:new n.Uniform2f(u),u_pixels_to_tile_units:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_units_to_pixels:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_alpha_discard_threshold:new n.Uniform1f(u)}),raster:u=>({u_matrix:new n.UniformMatrix4f(u),u_tl_parent:new n.Uniform2f(u),u_scale_parent:new n.Uniform1f(u),u_fade_t:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_image0:new n.Uniform1i(u),u_image1:new n.Uniform1i(u),u_brightness_low:new n.Uniform1f(u),u_brightness_high:new n.Uniform1f(u),u_saturation_factor:new n.Uniform1f(u),u_contrast_factor:new n.Uniform1f(u),u_spin_weights:new n.Uniform3f(u),u_perspective_transform:new n.Uniform2f(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_camera_forward:new n.Uniform3f(u),u_tile_matrix:new n.UniformMatrix4f(u),u_up_vector:new n.Uniform3f(u),u_ecef_origin:new n.Uniform3f(u),u_texture:new n.Uniform1i(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_texture:new n.Uniform1i(u),u_gamma_scale:new n.Uniform1f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_camera_forward:new n.Uniform3f(u),u_tile_matrix:new n.UniformMatrix4f(u),u_up_vector:new n.Uniform3f(u),u_ecef_origin:new n.Uniform3f(u),u_is_halo:new n.Uniform1i(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_texsize_icon:new n.Uniform2f(u),u_texture:new n.Uniform1i(u),u_texture_icon:new n.Uniform1i(u),u_gamma_scale:new n.Uniform1f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_is_halo:new n.Uniform1i(u)}),background:u=>({u_matrix:new n.UniformMatrix4f(u),u_opacity:new n.Uniform1f(u),u_color:new n.UniformColor(u)}),backgroundPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_opacity:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_pattern_tl:new n.Uniform2f(u),u_pattern_br:new n.Uniform2f(u),u_texsize:new n.Uniform2f(u),u_pattern_size:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),terrainRaster:Cc,terrainDepth:Cc,skybox:u=>({u_matrix:new n.UniformMatrix4f(u),u_sun_direction:new n.Uniform3f(u),u_cubemap:new n.Uniform1i(u),u_opacity:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u)}),skyboxGradient:u=>({u_matrix:new n.UniformMatrix4f(u),u_color_ramp:new n.Uniform1i(u),u_center_direction:new n.Uniform3f(u),u_radius:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u)}),skyboxCapture:u=>({u_matrix_3f:new n.UniformMatrix3f(u),u_sun_direction:new n.Uniform3f(u),u_sun_intensity:new n.Uniform1f(u),u_color_tint_r:new n.Uniform4f(u),u_color_tint_m:new n.Uniform4f(u),u_luminance:new n.Uniform1f(u)}),globeRaster:u=>({u_proj_matrix:new n.UniformMatrix4f(u),u_globe_matrix:new n.UniformMatrix4f(u),u_normalize_matrix:new n.UniformMatrix4f(u),u_merc_matrix:new n.UniformMatrix4f(u),u_zoom_transition:new n.Uniform1f(u),u_merc_center:new n.Uniform2f(u),u_image0:new n.Uniform1i(u),u_grid_matrix:new n.UniformMatrix3f(u),u_skirt_height:new n.Uniform1f(u),u_frustum_tl:new n.Uniform3f(u),u_frustum_tr:new n.Uniform3f(u),u_frustum_br:new n.Uniform3f(u),u_frustum_bl:new n.Uniform3f(u),u_globe_pos:new n.Uniform3f(u),u_globe_radius:new n.Uniform1f(u),u_viewport:new n.Uniform2f(u)}),globeAtmosphere:u=>({u_frustum_tl:new n.Uniform3f(u),u_frustum_tr:new n.Uniform3f(u),u_frustum_br:new n.Uniform3f(u),u_frustum_bl:new n.Uniform3f(u),u_horizon:new n.Uniform1f(u),u_transition:new n.Uniform1f(u),u_fadeout_range:new n.Uniform1f(u),u_color:new n.Uniform4f(u),u_high_color:new n.Uniform4f(u),u_space_color:new n.Uniform4f(u),u_star_intensity:new n.Uniform1f(u),u_star_density:new n.Uniform1f(u),u_star_size:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u),u_horizon_angle:new n.Uniform1f(u),u_rotation_matrix:new n.UniformMatrix4f(u)})};let fl;function bo(u,i,o,m,f,_,j){const S=u.context,C=S.gl,D=u.transform,I=u.useProgram("collisionBox"),O=[];let W=0,Q=0;for(let ce=0;ce<m.length;ce++){const ve=m[ce],je=i.getTile(ve),we=je.getBucket(o);if(!we)continue;const Me=mi(ve,we,D);let Ae=Me;f[0]===0&&f[1]===0||(Ae=u.translatePosMatrix(Me,je,f,_));const Fe=j?we.textCollisionBox:we.iconCollisionBox,at=we.collisionCircleArray;if(at.length>0){const Re=n.create(),Qe=Ae;n.mul(Re,we.placementInvProjMatrix,D.glCoordMatrix),n.mul(Re,Re,we.placementViewportMatrix),O.push({circleArray:at,circleOffset:Q,transform:Qe,invTransform:Re,projection:we.getProjection()}),W+=at.length/4,Q=W}Fe&&(u.terrain&&u.terrain.setupElevationDraw(je,I),I.draw(S,C.LINES,n.DepthMode.disabled,n.StencilMode.disabled,u.colorModeForRenderPass(),n.CullFaceMode.disabled,Rc(Ae,D,je,we.getProjection()),o.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,D.zoom,null,[Fe.collisionVertexBuffer,Fe.collisionVertexBufferExt]))}if(!j||!O.length)return;const ee=u.useProgram("collisionCircle"),J=new n.StructArrayLayout2f1f2i16;J.resize(4*W),J._trim();let te=0;for(const ce of O)for(let ve=0;ve<ce.circleArray.length/4;ve++){const je=4*ve,we=ce.circleArray[je+0],Me=ce.circleArray[je+1],Ae=ce.circleArray[je+2],Fe=ce.circleArray[je+3];J.emplace(te++,we,Me,Ae,Fe,0),J.emplace(te++,we,Me,Ae,Fe,1),J.emplace(te++,we,Me,Ae,Fe,2),J.emplace(te++,we,Me,Ae,Fe,3)}(!fl||fl.length<2*W)&&(fl=function(ce){const ve=2*ce,je=new n.StructArrayLayout3ui6;je.resize(ve),je._trim();for(let we=0;we<ve;we++){const Me=6*we;je.uint16[Me+0]=4*we+0,je.uint16[Me+1]=4*we+1,je.uint16[Me+2]=4*we+2,je.uint16[Me+3]=4*we+2,je.uint16[Me+4]=4*we+3,je.uint16[Me+5]=4*we+0}return je}(W));const F=S.createIndexBuffer(fl,!0),K=S.createVertexBuffer(J,n.collisionCircleLayout.members,!0);for(const ce of O){const ve={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ne=D).getCameraToCenterDistance(ce.projection),u_viewport_size:[ne.width,ne.height]};ee.draw(S,C.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,u.colorModeForRenderPass(),n.CullFaceMode.disabled,ve,o.id,K,F,n.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,D.zoom)}var ne;K.destroy(),F.destroy()}const bd=n.create();function Vc({width:u,height:i,anchor:o,textOffset:m,textScale:f},_){const{horizontalAlign:j,verticalAlign:S}=n.getAnchorAlignment(o),C=-(j-.5)*u,D=-(S-.5)*i,I=n.evaluateVariableOffset(o,m);return new n.Point((C/f+I[0])*_,(D/f+I[1])*_)}function Em(u,i,o,m,f,_,j,S,C,D,I){const O=u.text.placedSymbolArray,W=u.text.dynamicLayoutVertexArray,Q=u.icon.dynamicLayoutVertexArray,ee={},J=u.getProjection(),te=Fs(S,J,_),F=_.elevation,K=J.upVectorScale(S.canonical,_.center.lat,_.worldSize).metersToTile;W.clear();for(let ne=0;ne<O.length;ne++){const ce=O.get(ne),{tileAnchorX:ve,tileAnchorY:je,numGlyphs:we}=ce,Me=ce.hidden||!ce.crossTileID||u.allowVerticalPlacement&&!ce.placedOrientation?null:m[ce.crossTileID];if(Me){let Ae=0,Fe=0,at=0;if(F){const ct=F?F.getAtTileOffset(S,ve,je):0,[Dt,qt,Et]=J.upVector(S.canonical,ve,je);Ae=ct*Dt*K,Fe=ct*qt*K,at=ct*Et*K}let[Re,Qe,Ve,nt]=Nr(ce.projectedAnchorX+Ae,ce.projectedAnchorY+Fe,ce.projectedAnchorZ+at,o?te:j);const Oe=ad(_.getCameraToCenterDistance(J),nt);let Xe=f.evaluateSizeForFeature(u.textSizeData,D,ce)*Oe/n.ONE_EM;o&&(Xe*=u.tilePixelRatio/C);const lt=Vc(Me,Xe);o?({x:Re,y:Qe,z:Ve}=J.projectTilePoint(ve+lt.x,je+lt.y,S.canonical),[Re,Qe,Ve]=Nr(Re+Ae,Qe+Fe,Ve+at,j)):(i&&lt._rotate(-_.angle),Re+=lt.x,Qe+=lt.y,Ve=0);const st=u.allowVerticalPlacement&&ce.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let ct=0;ct<we;ct++)n.addDynamicAttributes(W,Re,Qe,Ve,st);I&&ce.associatedIconIndex>=0&&(ee[ce.associatedIconIndex]={x:Re,y:Qe,z:Ve,angle:st})}else Ei(we,W)}if(I){Q.clear();const ne=u.icon.placedSymbolArray;for(let ce=0;ce<ne.length;ce++){const ve=ne.get(ce),{numGlyphs:je}=ve,we=ee[ce];if(ve.hidden||!we)Ei(je,Q);else{const{x:Me,y:Ae,z:Fe,angle:at}=we;for(let Re=0;Re<je;Re++)n.addDynamicAttributes(Q,Me,Ae,Fe,at)}}u.icon.dynamicLayoutVertexBuffer.updateData(Q)}u.text.dynamicLayoutVertexBuffer.updateData(W)}function qc(u,i,o){return o.iconsInText&&i?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function vd(u,i,o,m,f,_,j,S,C,D,I,O){const W=u.context,Q=W.gl,ee=u.transform,J=S==="map",te=C==="map",F=J&&o.layout.get("symbol-placement")!=="point",K=J&&!te&&!F,ne=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ce=!1;const ve=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),je=[n.mercatorXfromLng(ee.center.lng),n.mercatorYfromLat(ee.center.lat)],we=o.layout.get("text-variable-anchor"),Me=ee.projection.name==="globe",Ae=[],Fe=[0,-1,0];let at=Fe;!Me&&!ee.mercatorFromTransition||J||(at=function(Re){const Qe=Re._camera.getWorldToCamera(Re.worldSize,1),Ve=n.multiply([],Qe,Re.globeMatrix);n.invert(Ve,Ve);const nt=[0,0,0],Oe=[0,1,0,0];return n.transformMat4$1(Oe,Oe,Ve),nt[0]=Oe[0],nt[1]=Oe[1],nt[2]=Oe[2],n.normalize(nt,nt),nt}(ee));for(const Re of m){const Qe=i.getTile(Re),Ve=Qe.getBucket(o);if(!Ve||Ve.projection.name==="mercator"&&Me)continue;const nt=f?Ve.text:Ve.icon;if(!nt||Ve.fullyClipped||!nt.segments.get().length)continue;const Oe=nt.programConfigurations.get(o.id),Xe=f||Ve.sdfIcons,lt=f?Ve.textSizeData:Ve.iconSizeData,st=te||ee.pitch!==0,ct=n.evaluateSizeForZoom(lt,ee.zoom);let Dt,qt,Et,Ft,is=[0,0],es=null;if(f)qt=Qe.glyphAtlasTexture,Et=Q.LINEAR,Dt=Qe.glyphAtlasTexture.size,Ve.iconsInText&&(is=Qe.imageAtlasTexture.size,es=Qe.imageAtlasTexture,Ft=st||u.options.rotating||u.options.zooming||lt.kind==="composite"||lt.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const hn=o.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;qt=Qe.imageAtlasTexture,Et=Xe||u.options.rotating||u.options.zooming||hn||st?Q.LINEAR:Q.NEAREST,Dt=Qe.imageAtlasTexture.size}const Pt=Ve.projection.name==="globe",vs=Pt?at:Fe,ws=Pt?n.globeToMercatorTransition(ee.zoom):0,js=Fs(Re,Ve.getProjection(),ee),Ns=ee.calculatePixelsToTileUnitsMatrix(Qe),Ur=Ze(js,Qe.tileID.canonical,te,J,ee,Ve.getProjection(),Ns),Tr=u.terrain&&te&&F?n.invert(n.create(),Ur):bd,xi=ar(js,Qe.tileID.canonical,te,J,ee,Ve.getProjection(),Ns),$i=we&&Ve.hasTextData(),Bs=o.layout.get("icon-text-fit")!=="none"&&$i&&Ve.hasIconData();if(F){const hn=ee.elevation,Mn=hn?hn.getAtTileOffsetFunc(Re,ee.center.lat,ee.worldSize,Ve.getProjection()):null,sa=rn(js,Qe.tileID.canonical,te,J,ee,Ve.getProjection(),Ns);fc(Ve,js,u,f,sa,xi,te,D,Mn,Re)}const Ss=F||f&&we||Bs,gs=u.translatePosMatrix(js,Qe,_,j),or=Ss?bd:Ur,Zr=u.translatePosMatrix(xi,Qe,_,j,!0),Os=Ve.getProjection().createInversionMatrix(ee,Re.canonical),Jr=[];u.terrainRenderModeElevated()&&te&&Jr.push("PITCH_WITH_MAP_TERRAIN"),Pt&&Jr.push("PROJECTION_GLOBE_VIEW"),Ss&&Jr.push("PROJECTED_POS_ON_VIEWPORT");const Ml=Xe&&o.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ta;ta=Xe?Ve.iconsInText?_d(lt.kind,ct,K,te,u,gs,or,Zr,Dt,is,Re,ws,je,Os,vs,Ve.getProjection()):pl(lt.kind,ct,K,te,u,gs,or,Zr,f,Dt,!0,Re,ws,je,Os,vs,Ve.getProjection()):Fc(lt.kind,ct,K,te,u,gs,or,Zr,f,Dt,Re,ws,je,Os,vs,Ve.getProjection());const Mo={program:u.useProgram(qc(Xe,f,Ve),Oe,Jr),buffers:nt,uniformValues:ta,atlasTexture:qt,atlasTextureIcon:es,atlasInterpolation:Et,atlasInterpolationIcon:Ft,isSDF:Xe,hasHalo:Ml,tile:Qe,labelPlaneMatrixInv:Tr};if(ne&&Ve.canOverlap){ce=!0;const hn=nt.segments.get();for(const Mn of hn)Ae.push({segments:new n.SegmentVector([Mn]),sortKey:Mn.sortKey,state:Mo})}else Ae.push({segments:nt.segments,sortKey:0,state:Mo})}ce&&Ae.sort((Re,Qe)=>Re.sortKey-Qe.sortKey);for(const Re of Ae){const Qe=Re.state;if(u.terrain&&u.terrain.setupElevationDraw(Qe.tile,Qe.program,{useDepthForOcclusion:!Me,labelPlaneMatrixInv:Qe.labelPlaneMatrixInv}),W.activeTexture.set(Q.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,Q.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(W.activeTexture.set(Q.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Qe.isSDF){const Ve=Qe.uniformValues;Qe.hasHalo&&(Ve.u_is_halo=1,vo(Qe.buffers,Re.segments,o,u,Qe.program,ve,I,O,Ve)),Ve.u_is_halo=0}vo(Qe.buffers,Re.segments,o,u,Qe.program,ve,I,O,Qe.uniformValues)}}function vo(u,i,o,m,f,_,j,S,C){const D=m.context,I=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.globeExtVertexBuffer];f.draw(D,D.gl.TRIANGLES,_,j,S,n.CullFaceMode.disabled,C,o.id,u.layoutVertexBuffer,u.indexBuffer,i,o.paint,m.transform.zoom,u.programConfigurations.get(o.id),I)}function wd(u,i,o,m,f,_,j){const S=u.context.gl,C=o.paint.get("fill-pattern"),D=C&&C.constantOr(1);let I,O,W,Q,ee;j?(O=D&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=S.LINES):(O=D?"fillPattern":"fill",I=S.TRIANGLES);for(const J of m){const te=i.getTile(J);if(D&&!te.patternsLoaded())continue;const F=te.getBucket(o);if(!F)continue;u.prepareDrawTile();const K=F.programConfigurations.get(o.id),ne=u.useProgram(O,K);D&&(u.context.activeTexture.set(S.TEXTURE0),te.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),K.updatePaintBuffers());const ce=C.constantOr(null);if(ce&&te.imageAtlas){const je=te.imageAtlas.patternPositions[ce.toString()];je&&K.setConstantPatternPositions(je)}const ve=u.translatePosMatrix(J.projMatrix,te,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(j){Q=F.indexBuffer2,ee=F.segments2;const je=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];W=O==="fillOutlinePattern"&&D?jm(ve,u,te,je):wm(ve,je)}else Q=F.indexBuffer,ee=F.segments,W=D?Ic(ve,u,te):Qn(ve);u.prepareDrawProgram(u.context,ne,J.toUnwrapped()),ne.draw(u.context,I,f,u.stencilModeForClipping(J),_,n.CullFaceMode.disabled,W,o.id,F.layoutVertexBuffer,Q,ee,o.paint,u.transform.zoom,K)}}function gl(u,i,o,m,f,_,j){const S=u.context,C=S.gl,D=u.transform,I=o.paint.get("fill-extrusion-pattern"),O=I.constantOr(1),W=o.paint.get("fill-extrusion-opacity"),Q=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],ee=o.layout.get("fill-extrusion-edge-radius"),J=ee>0&&!o.paint.get("fill-extrusion-rounded-roof"),te=J?0:ee,F=D.projection.name==="globe"?n.fillExtrusionHeightLift():0,K=D.projection.name==="globe",ne=K?n.globeToMercatorTransition(D.zoom):0,ce=[n.mercatorXfromLng(D.center.lng),n.mercatorYfromLat(D.center.lat)],ve=[];K&&ve.push("PROJECTION_GLOBE_VIEW"),Q[0]>0&&ve.push("FAUX_AO"),J&&ve.push("ZERO_ROOF_RADIUS");for(const je of m){const we=i.getTile(je),Me=we.getBucket(o);if(!Me||Me.projection.name!==D.projection.name)continue;const Ae=Me.programConfigurations.get(o.id),Fe=u.useProgram(O?"fillExtrusionPattern":"fillExtrusion",Ae,ve);if(u.terrain){const Xe=u.terrain;if(u.style.terrainSetForDrapingOnly())Xe.setupElevationDraw(we,Fe,{useMeterToDem:!0});else{if(!Me.enableTerrain)continue;if(Xe.setupElevationDraw(we,Fe,{useMeterToDem:!0}),jd(S,i,je,Me,o,Xe),!Me.centroidVertexBuffer){const lt=Fe.attributes.a_centroid_pos;lt!==void 0&&C.vertexAttrib2f(lt,0,0)}}}O&&(u.context.activeTexture.set(C.TEXTURE0),we.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ae.updatePaintBuffers());const at=I.constantOr(null);if(at&&we.imageAtlas){const Xe=we.imageAtlas.patternPositions[at.toString()];Xe&&Ae.setConstantPatternPositions(Xe)}const Re=u.translatePosMatrix(je.projMatrix,we,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Qe=D.projection.createInversionMatrix(D,je.canonical),Ve=o.paint.get("fill-extrusion-vertical-gradient"),nt=O?gd(Re,u,Ve,W,Q,te,je,we,F,ne,ce,Qe):Pc(Re,u,Ve,W,Q,te,je,F,ne,ce,Qe);u.prepareDrawProgram(S,Fe,je.toUnwrapped());const Oe=[];u.terrain&&Oe.push(Me.centroidVertexBuffer),K&&Oe.push(Me.layoutVertexExtBuffer),Fe.draw(S,S.gl.TRIANGLES,f,_,j,n.CullFaceMode.backCCW,nt,o.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,o.paint,u.transform.zoom,Ae,Oe)}}function jd(u,i,o,m,f,_){const j=[F=>{let K=F.canonical.x-1,ne=F.wrap;return K<0&&(K=(1<<F.canonical.z)-1,ne--),new n.OverscaledTileID(F.overscaledZ,ne,F.canonical.z,K,F.canonical.y)},F=>{let K=F.canonical.x+1,ne=F.wrap;return K===1<<F.canonical.z&&(K=0,ne++),new n.OverscaledTileID(F.overscaledZ,ne,F.canonical.z,K,F.canonical.y)},F=>new n.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,(F.canonical.y===0?1<<F.canonical.z:F.canonical.y)-1),F=>new n.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y===(1<<F.canonical.z)-1?0:F.canonical.y+1)],S=F=>{const K=i.getSource().minzoom,ne=ve=>{const je=i.getTileByID(ve);if(je&&je.hasData())return je.getBucket(f)},ce=[0,-1,1];for(const ve of ce){if(F.overscaledZ+ve<K)continue;const je=ne(F.calculateScaledKey(F.overscaledZ+ve));if(je)return je}},C=[0,0,0],D=(F,K)=>(C[0]=Math.min(F.min.y,K.min.y),C[1]=Math.max(F.max.y,K.max.y),C[2]=n.EXTENT-K.min.x>F.max.x?K.min.x-n.EXTENT:F.max.x,C),I=(F,K)=>(C[0]=Math.min(F.min.x,K.min.x),C[1]=Math.max(F.max.x,K.max.x),C[2]=n.EXTENT-K.min.y>F.max.y?K.min.y-n.EXTENT:F.max.y,C),O=[(F,K)=>D(F,K),(F,K)=>D(K,F),(F,K)=>I(F,K),(F,K)=>I(K,F)],W=new n.Point(0,0);let Q,ee,J;const te=(F,K,ne,ce,ve)=>{const je=[[ce?ne:F,ce?F:ne,0],[ce?ne:K,ce?K:ne,0]],we=ve<0?n.EXTENT+ve:ve,Me=[ce?we:(F+K)/2,ce?(F+K)/2:we,0];return ne===0&&ve<0||ne!==0&&ve>0?_.getForTilePoints(J,[Me],!0,ee):je.push(Me),_.getForTilePoints(o,je,!0,Q),Math.max(je[0][2],je[1][2],Me[2])/_.exaggeration()};for(let F=0;F<4;F++){const K=(F<2?1:5)-F,ne=m.borders[F];if(ne.length===0)continue;const ce=J=j[F](o),ve=S(ce);if(!(ve&&ve instanceof n.FillExtrusionBucket&&ve.enableTerrain)||m.borderDoneWithNeighborZ[F]===ve.canonical.z&&ve.borderDoneWithNeighborZ[K]===m.canonical.z||(ee=_.findDEMTileFor(ce),!ee||!ee.dem))continue;if(!Q){const Ae=_.findDEMTileFor(o);if(!Ae||!Ae.dem)return;Q=Ae}const je=ve.borders[K];let we=0;const Me=ve.borderDoneWithNeighborZ[K]!==m.canonical.z;if(m.canonical.z===ve.canonical.z){for(let Ae=0;Ae<ne.length;Ae++){const Fe=m.featuresOnBorder[ne[Ae]],at=Fe.borders[F];let Re;for(;we<je.length&&(Re=ve.featuresOnBorder[je[we]],!(Re.borders[K][1]>at[0]+3));)Me&&ve.encodeCentroid(void 0,Re,!1),we++;if(Re&&we<je.length){const Qe=we;let Ve=0;for(;!(Re.borders[K][0]>at[1]-3)&&(Ve++,++we!==je.length);)Re=ve.featuresOnBorder[je[we]];if(Re=ve.featuresOnBorder[je[Qe]],Fe.intersectsCount()>1||Re.intersectsCount()>1||Ve!==1){Ve!==1&&(we=Qe),m.encodeCentroid(void 0,Fe,!1),Me&&ve.encodeCentroid(void 0,Re,!1);continue}const nt=O[F](Fe,Re),Oe=F%2?n.EXTENT-1:0;W.x=te(nt[0],Math.min(n.EXTENT-1,nt[1]),Oe,F<2,nt[2]),W.y=0,m.encodeCentroid(W,Fe,!1),Me&&ve.encodeCentroid(W,Re,!1)}else m.encodeCentroid(void 0,Fe,!1)}m.borderDoneWithNeighborZ[F]=ve.canonical.z,m.needsCentroidUpdate=!0,Me&&(ve.borderDoneWithNeighborZ[K]=m.canonical.z,ve.needsCentroidUpdate=!0)}else{for(const Ae of ne)m.encodeCentroid(void 0,m.featuresOnBorder[Ae],!1);if(Me){for(const Ae of je)ve.encodeCentroid(void 0,ve.featuresOnBorder[Ae],!1);ve.borderDoneWithNeighborZ[K]=m.canonical.z,ve.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[F]=ve.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(u)}const Sa=new n.Color(1,0,0,1),Cm=new n.Color(0,1,0,1),km=new n.Color(0,0,1,1),Am=new n.Color(1,0,1,1),Mm=new n.Color(0,1,1,1);function Pm(u,i,o){const m=u.context,f=u.transform,_=m.gl,j=f.projection.name==="globe",S=j?["PROJECTION_GLOBE_VIEW"]:null;let C=o.projMatrix;if(j&&n.globeToMercatorTransition(f.zoom)>0){const Fe=n.transitionTileAABBinECEF(o.canonical,f),at=n.globeDenormalizeECEF(Fe);C=n.multiply(new Float32Array(16),f.globeMatrix,at),n.multiply(C,f.projMatrix,C)}const D=u.useProgram("debug",null,S),I=i.getTileByID(o.key);u.terrain&&u.terrain.setupElevationDraw(I,D);const O=n.DepthMode.disabled,W=n.StencilMode.disabled,Q=u.colorModeForRenderPass(),ee="$debug";m.activeTexture.set(_.TEXTURE0),u.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),j?I._makeGlobeTileDebugBuffers(u.context,f):I._makeDebugTileBoundsBuffers(u.context,f.projection);const J=I._tileDebugBuffer||u.debugBuffer,te=I._tileDebugIndexBuffer||u.debugIndexBuffer,F=I._tileDebugSegments||u.debugSegments;D.draw(m,_.LINE_STRIP,O,W,Q,n.CullFaceMode.disabled,hl(C,n.Color.red),ee,J,te,F,null,null,null,[I._globeTileDebugBorderBuffer]);const K=I.latestRawTileData,ne=Math.floor((K&&K.byteLength||0)/1024),ce=i.getTile(o).tileSize,ve=512/Math.min(ce,512)*(o.overscaledZ/f.zoom)*.5;let je=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(je+=` => ${o.overscaledZ}`),je+=` ${ne}kb`,function(Fe,at){Fe.initDebugOverlayCanvas();const Re=Fe.debugOverlayCanvas,Qe=Fe.context.gl,Ve=Fe.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Re.width,Re.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(at,5,5),Ve.strokeText(at,5,5),Fe.debugOverlayTexture.update(Re),Fe.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(u,je);const we=I._tileDebugTextBuffer||u.debugBuffer,Me=I._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Ae=I._tileDebugTextSegments||u.debugSegments;D.draw(m,_.TRIANGLES,O,W,n.ColorMode.alphaBlended,n.CullFaceMode.disabled,hl(C,n.Color.transparent,ve),ee,we,Me,Ae,null,null,null,[I._globeTileDebugTextBuffer])}function Nd(u,i,o,m){Ta(u,0,i+o/2,u.transform.width,o,m)}function xl(u,i,o,m){Ta(u,i-o/2,0,o,u.transform.height,m)}function Ta(u,i,o,m,f,_){const j=u.context,S=j.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*n.exported.devicePixelRatio,o*n.exported.devicePixelRatio,m*n.exported.devicePixelRatio,f*n.exported.devicePixelRatio),j.clear({color:_}),S.disable(S.SCISSOR_TEST)}const Sd=n.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Td}=Sd;function un(u,i,o,m){u.emplaceBack(i,o,m)}class yl{constructor(i){this.vertexArray=new n.StructArrayLayout3f12,this.indices=new n.StructArrayLayout3ui6,un(this.vertexArray,-1,-1,1),un(this.vertexArray,1,-1,1),un(this.vertexArray,-1,1,1),un(this.vertexArray,1,1,1),un(this.vertexArray,-1,-1,-1),un(this.vertexArray,1,-1,-1),un(this.vertexArray,-1,1,-1),un(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Td),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=n.SegmentVector.simpleSegment(0,0,36,12)}}function fi(u,i,o,m,f,_){const j=u.gl,S=i.paint.get("sky-atmosphere-color"),C=i.paint.get("sky-atmosphere-halo-color"),D=i.paint.get("sky-atmosphere-sun-intensity"),I=((O,W,Q,ee,J)=>({u_matrix_3f:O,u_sun_direction:W,u_sun_intensity:Q,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(n.fromMat4(n.create$1(),m),f,D,S,C);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+_,i.skyboxTexture,0),o.draw(u,j.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.frontCW,I,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const wo=n.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ed{constructor(i){const o=new n.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const m=new n.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,wo.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=n.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Jn={symbol:function(u,i,o,m,f){if(u.renderPass!=="translucent")return;const _=n.StencilMode.disabled,j=u.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(S,C,D,I,O,W,Q){const ee=C.transform,J=O==="map",te=W==="map";for(const F of S){const K=I.getTile(F),ne=K.getBucket(D);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const ce=n.evaluateSizeForZoom(ne.textSizeData,ee.zoom),ve=Fs(F,ne.getProjection(),ee),je=ee.calculatePixelsToTileUnitsMatrix(K),we=Ze(ve,K.tileID.canonical,te,J,ee,ne.getProjection(),je),Me=D.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(ce){const Ae=Math.pow(2,ee.zoom-K.tileID.overscaledZ);Em(ne,J,te,Q,n.symbolSize,ee,we,F,Ae,ce,Me)}}}(m,u,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),f),o.paint.get("icon-opacity").constantOr(1)!==0&&vd(u,i,o,m,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),_,j),o.paint.get("text-opacity").constantOr(1)!==0&&vd(u,i,o,m,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),_,j),i.map.showCollisionBoxes&&(bo(u,i,o,m,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),bo(u,i,o,m,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(u,i,o,m){if(u.renderPass!=="translucent")return;const f=o.paint.get("circle-opacity"),_=o.paint.get("circle-stroke-width"),j=o.paint.get("circle-stroke-opacity"),S=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(f.constantOr(1)===0&&(_.constantOr(1)===0||j.constantOr(1)===0))return;const C=u.context,D=C.gl,I=u.transform,O=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),W=n.StencilMode.disabled,Q=u.colorModeForRenderPass(),ee=I.projection.name==="globe",J=[n.mercatorXfromLng(I.center.lng),n.mercatorYfromLat(I.center.lat)],te=[];for(let K=0;K<m.length;K++){const ne=m[K],ce=i.getTile(ne),ve=ce.getBucket(o);if(!ve||ve.projection.name!==I.projection.name)continue;const je=ve.programConfigurations.get(o.id),we=Lc(o);ee&&we.push("PROJECTION_GLOBE_VIEW");const Me=u.useProgram("circle",je,we),Ae=ve.layoutVertexBuffer,Fe=ve.globeExtVertexBuffer,at=ve.indexBuffer,Re=I.projection.createInversionMatrix(I,ne.canonical),Qe={programConfiguration:je,program:Me,layoutVertexBuffer:Ae,globeExtVertexBuffer:Fe,indexBuffer:at,uniformValues:Dc(u,ne,ce,Re,J,o),tile:ce};if(S){const Ve=ve.segments.get();for(const nt of Ve)te.push({segments:new n.SegmentVector([nt]),sortKey:nt.sortKey,state:Qe})}else te.push({segments:ve.segments,sortKey:0,state:Qe})}S&&te.sort((K,ne)=>K.sortKey-ne.sortKey);const F={useDepthForOcclusion:!ee};for(const K of te){const{programConfiguration:ne,program:ce,layoutVertexBuffer:ve,globeExtVertexBuffer:je,indexBuffer:we,uniformValues:Me,tile:Ae}=K.state,Fe=K.segments;u.terrain&&u.terrain.setupElevationDraw(Ae,ce,F),u.prepareDrawProgram(C,ce,Ae.tileID.toUnwrapped()),ce.draw(C,D.TRIANGLES,O,W,Q,n.CullFaceMode.disabled,Me,o.id,ve,we,Fe,o.paint,I.zoom,ne,[je])}},heatmap:function(u,i,o,m){if(o.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const f=u.context,_=f.gl,j=n.StencilMode.disabled,S=new n.ColorMode([_.ONE,_.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(Q,ee,J,te){const F=Q.gl,K=ee.width*te,ne=ee.height*te;Q.activeTexture.set(F.TEXTURE1),Q.viewport.set([0,0,K,ne]);let ce=J.heatmapFbo;if(!ce||ce&&(ce.width!==K||ce.height!==ne)){ce&&ce.destroy();const ve=F.createTexture();F.bindTexture(F.TEXTURE_2D,ve),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),ce=J.heatmapFbo=Q.createFramebuffer(K,ne,!1),function(je,we,Me,Ae,Fe,at){const Re=je.gl;Re.texImage2D(Re.TEXTURE_2D,0,je.isWebGL2&&je.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,Fe,at,0,Re.RGBA,je.extRenderToTextureHalfFloat?je.isWebGL2?Re.HALF_FLOAT:je.extTextureHalfFloat.HALF_FLOAT_OES:Re.UNSIGNED_BYTE,null),Ae.colorAttachment.set(Me)}(Q,0,ve,ce,K,ne)}else F.bindTexture(F.TEXTURE_2D,ce.colorAttachment.get()),Q.bindFramebuffer.set(ce.framebuffer)})(f,u,o,u.transform.projection.name==="globe"?.5:.25),f.clear({color:n.Color.transparent});const C=u.transform,D=C.projection.name==="globe",I=D?["PROJECTION_GLOBE_VIEW"]:null,O=D?n.CullFaceMode.frontCCW:n.CullFaceMode.disabled,W=[n.mercatorXfromLng(C.center.lng),n.mercatorYfromLat(C.center.lat)];for(let Q=0;Q<m.length;Q++){const ee=m[Q];if(i.hasRenderableParent(ee))continue;const J=i.getTile(ee),te=J.getBucket(o);if(!te||te.projection.name!==C.projection.name)continue;const F=te.programConfigurations.get(o.id),K=u.useProgram("heatmap",F,I),{zoom:ne}=u.transform;u.terrain&&u.terrain.setupElevationDraw(J,K),u.prepareDrawProgram(f,K,ee.toUnwrapped());const ce=C.projection.createInversionMatrix(C,ee.canonical);K.draw(f,_.TRIANGLES,n.DepthMode.disabled,j,S,O,yd(u,ee,J,ce,W,ne,o.paint.get("heatmap-intensity")),o.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,o.paint,u.transform.zoom,F,D?[te.globeExtVertexBuffer]:null)}f.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(f,_){const j=f.context,S=j.gl,C=_.heatmapFbo;if(!C)return;j.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),j.activeTexture.set(S.TEXTURE1);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new n.Texture(j,_.colorRamp,S.RGBA)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(j,S.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,f.colorModeForRenderPass(),n.CullFaceMode.disabled,((I,O,W,Q)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,_),_.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,_.paint,f.transform.zoom)}(u,o))},line:function(u,i,o,m){if(u.renderPass!=="translucent")return;const f=o.paint.get("line-opacity"),_=o.paint.get("line-width");if(f.constantOr(1)===0||_.constantOr(1)===0)return;const j=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),S=u.colorModeForRenderPass(),C=u.terrain&&u.terrain.renderingToTexture?1:n.exported.devicePixelRatio,D=o.paint.get("line-dasharray"),I=D.constantOr(1),O=o.layout.get("line-cap"),W=o.paint.get("line-pattern"),Q=W.constantOr(1),ee=o.paint.get("line-gradient"),J=Q?"linePattern":"line",te=u.context,F=te.gl,K=(ce=>{const ve=[];_o(ce)&&ve.push("RENDER_LINE_DASH"),ce.paint.get("line-gradient")&&ve.push("RENDER_LINE_GRADIENT");const je=ce.paint.get("line-trim-offset");je[0]===0&&je[1]===0||ve.push("RENDER_LINE_TRIM_OFFSET");const we=ce.paint.get("line-pattern").constantOr(1),Me=ce.paint.get("line-opacity").constantOr(1)!==1;return!we&&Me&&ve.push("RENDER_LINE_ALPHA_DISCARD"),ve})(o);let ne=K.includes("RENDER_LINE_ALPHA_DISCARD");u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const ce of m){const ve=i.getTile(ce);if(Q&&!ve.patternsLoaded())continue;const je=ve.getBucket(o);if(!je)continue;u.prepareDrawTile();const we=je.programConfigurations.get(o.id),Me=u.useProgram(J,we,K),Ae=W.constantOr(null);if(Ae&&ve.imageAtlas){const Xe=ve.imageAtlas.patternPositions[Ae.toString()];Xe&&we.setConstantPatternPositions(Xe)}const Fe=D.constantOr(null),at=O.constantOr(null);if(!Q&&Fe&&at&&ve.lineAtlas){const Xe=ve.lineAtlas.getDash(Fe,at);Xe&&we.setConstantPatternPositions(Xe)}let[Re,Qe]=o.paint.get("line-trim-offset");(at==="round"||at==="square")&&Re!==Qe&&(Re===0&&(Re-=1),Qe===1&&(Qe+=1));const Ve=u.terrain?ce.projMatrix:null,nt=Q?yo(u,ve,o,Ve,C):Sm(u,ve,o,Ve,je.lineClipsArray.length,C,[Re,Qe]);if(ee){const Xe=je.gradients[o.id];let lt=Xe.texture;if(o.gradientVersion!==Xe.version){let st=256;if(o.stepInterpolant){const ct=i.getSource().maxzoom,Dt=ce.canonical.z===ct?Math.ceil(1<<u.transform.maxZoom-ce.canonical.z):1;st=n.clamp(n.nextPowerOfTwo(je.maxLineLength/n.EXTENT*1024*Dt),256,te.maxTextureSize)}Xe.gradient=n.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:st,image:Xe.gradient||void 0,clips:je.lineClipsArray}),Xe.texture?Xe.texture.update(Xe.gradient):Xe.texture=new n.Texture(te,Xe.gradient,F.RGBA),Xe.version=o.gradientVersion,lt=Xe.texture}te.activeTexture.set(F.TEXTURE1),lt.bind(o.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}I&&(te.activeTexture.set(F.TEXTURE0),ve.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),we.updatePaintBuffers()),Q&&(te.activeTexture.set(F.TEXTURE0),ve.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),we.updatePaintBuffers()),u.prepareDrawProgram(te,Me,ce.toUnwrapped());const Oe=Xe=>{Me.draw(te,F.TRIANGLES,j,Xe,S,n.CullFaceMode.disabled,nt,o.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,o.paint,u.transform.zoom,we,[je.layoutVertexBuffer2])};if(ne){const Xe=u.stencilModeForClipping(ce).ref;Xe===0&&u.terrain&&te.clear({stencil:0});const lt={func:F.EQUAL,mask:255};nt.u_alpha_discard_threshold=.8,Oe(new n.StencilMode(lt,Xe,255,F.KEEP,F.KEEP,F.INVERT)),nt.u_alpha_discard_threshold=0,Oe(new n.StencilMode(lt,Xe,255,F.KEEP,F.KEEP,F.KEEP))}else Oe(u.stencilModeForClipping(ce))}ne&&(u.resetStencilClippingMasks(),u.terrain&&te.clear({stencil:0}))},fill:function(u,i,o,m){const f=o.paint.get("fill-color"),_=o.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const j=u.colorModeForRenderPass(),S=o.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!S.constantOr(1)&&f.constantOr(n.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===C){const D=u.depthModeForSublayer(1,u.renderPass==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly);wd(u,i,o,m,D,j,!1)}if(u.renderPass==="translucent"&&o.paint.get("fill-antialias")){const D=u.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,n.DepthMode.ReadOnly);wd(u,i,o,m,D,j,!0)}},"fill-extrusion":function(u,i,o,m){const f=o.paint.get("fill-extrusion-opacity");if(f!==0&&u.renderPass==="translucent"){const _=new n.DepthMode(u.context.gl.LEQUAL,n.DepthMode.ReadWrite,u.depthRangeFor3D);if(f!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))gl(u,i,o,m,_,n.StencilMode.disabled,n.ColorMode.disabled),gl(u,i,o,m,_,u.stencilModeFor3D(),u.colorModeForRenderPass()),u.resetStencilClippingMasks();else{const j=u.colorModeForRenderPass();gl(u,i,o,m,_,n.StencilMode.disabled,j)}}},hillshade:function(u,i,o,m){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const f=u.context,_=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),j=u.colorModeForRenderPass(),S=u.terrain&&u.terrain.renderingToTexture,[C,D]=u.renderPass!=="translucent"||S?[{},m]:u.stencilConfigForOverlap(m);for(const I of D){const O=i.getTile(I);if(O.needsHillshadePrepare&&u.renderPass==="offscreen")md(u,O,o,_,n.StencilMode.disabled,j);else if(u.renderPass==="translucent"){const W=S&&u.terrain?u.terrain.stencilModeForRTTOverlap(I):C[I.overscaledZ];hd(u,I,O,o,_,W,j)}}f.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,i,o,m,f,_){if(u.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!m.length)return;const j=u.context,S=j.gl,C=i.getSource(),D=u.useProgram("raster"),I=u.colorModeForRenderPass(),O=u.terrain&&u.terrain.renderingToTexture,[W,Q]=C instanceof Jt||O?[{},m]:u.stencilConfigForOverlap(m),ee=Q[Q.length-1].overscaledZ,J=!u.options.moving;for(const te of Q){const F=O?n.DepthMode.disabled:u.depthModeForSublayer(te.overscaledZ-ee,o.paint.get("raster-opacity")===1?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly,S.LESS),K=te.toUnwrapped(),ne=i.getTile(te);if(O&&(!ne||!ne.hasData()))continue;const ce=O?te.projMatrix:u.transform.calculateProjMatrix(K,J),ve=u.terrain&&O?u.terrain.stencilModeForRTTOverlap(te):W[te.overscaledZ],je=_?0:o.paint.get("raster-fade-duration");ne.registerFadeDuration(je);const we=i.findLoadedParent(te,0),Me=kc(ne,we,i,u.transform,je);let Ae,Fe;u.terrain&&u.terrain.prepareDrawTile();const at=o.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;j.activeTexture.set(S.TEXTURE0),ne.texture.bind(at,S.CLAMP_TO_EDGE),j.activeTexture.set(S.TEXTURE1),we?(we.texture.bind(at,S.CLAMP_TO_EDGE),Ae=Math.pow(2,we.tileID.overscaledZ-ne.tileID.overscaledZ),Fe=[ne.tileID.canonical.x*Ae%1,ne.tileID.canonical.y*Ae%1]):ne.texture.bind(at,S.CLAMP_TO_EDGE),ne.texture.useMipmap&&j.extTextureFilterAnisotropic&&u.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const Re=Oc(ce,Fe||[0,0],Ae||1,Me,o,C instanceof Jt?C.perspectiveTransform:[0,0]);if(u.prepareDrawProgram(j,D,K),C instanceof Jt)C.boundsBuffer&&C.boundsSegments&&D.draw(j,S.TRIANGLES,F,n.StencilMode.disabled,I,n.CullFaceMode.disabled,Re,o.id,C.boundsBuffer,u.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Qe,tileBoundsIndexBuffer:Ve,tileBoundsSegments:nt}=u.getTileBoundsBuffers(ne);D.draw(j,S.TRIANGLES,F,ve,I,n.CullFaceMode.disabled,Re,o.id,Qe,Ve,nt)}}u.resetStencilClippingMasks()},background:function(u,i,o,m){const f=o.paint.get("background-color"),_=o.paint.get("background-opacity");if(_===0)return;const j=u.context,S=j.gl,C=u.transform,D=C.tileSize,I=o.paint.get("background-pattern");if(u.isPatternMissing(I))return;const O=!I&&f.a===1&&_===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==O)return;const W=n.StencilMode.disabled,Q=u.depthModeForSublayer(0,O==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly),ee=u.colorModeForRenderPass(),J=u.useProgram(I?"backgroundPattern":"background");let te,F=m;F||(te=u.getBackgroundTiles(),F=Object.values(te).map(K=>K.tileID)),I&&(j.activeTexture.set(S.TEXTURE0),u.imageManager.bind(u.context));for(const K of F){const ne=K.toUnwrapped(),ce=m?K.projMatrix:u.transform.calculateProjMatrix(ne);u.prepareDrawTile();const ve=i?i.getTile(K):te?te[K.key]:new n.Tile(K,D,C.zoom,u),je=I?Tm(ce,_,u,I,{tileID:K,tileSize:D}):Bc(ce,_,f);u.prepareDrawProgram(j,J,ne);const{tileBoundsBuffer:we,tileBoundsIndexBuffer:Me,tileBoundsSegments:Ae}=u.getTileBoundsBuffers(ve);J.draw(j,S.TRIANGLES,Q,W,ee,n.CullFaceMode.disabled,je,o.id,we,Me,Ae)}},sky:function(u,i,o){const m=u.transform,f=m.projection.name==="mercator"||m.projection.name==="globe"?1:n.smoothstep(7,8,m.zoom),_=o.paint.get("sky-opacity")*f;if(_===0)return;const j=u.context,S=o.paint.get("sky-type"),C=new n.DepthMode(j.gl.LEQUAL,n.DepthMode.ReadOnly,[0,1]),D=u.frameCounter/1e3%1;S==="atmosphere"?u.renderPass==="offscreen"?o.needsSkyboxCapture(u)&&(function(I,O,W,Q){const ee=I.context,J=ee.gl;let te=O.skyboxFbo;if(!te){te=O.skyboxFbo=ee.createFramebuffer(32,32,!1),O.skyboxGeometry=new yl(ee),O.skyboxTexture=ee.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,O.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let ce=0;ce<6;++ce)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(te.framebuffer),ee.viewport.set([0,0,32,32]);const F=O.getCenter(I,!0),K=I.useProgram("skyboxCapture"),ne=new Float64Array(16);n.identity(ne),n.rotateY(ne,ne,.5*-Math.PI),fi(ee,O,K,ne,F,0),n.identity(ne),n.rotateY(ne,ne,.5*Math.PI),fi(ee,O,K,ne,F,1),n.identity(ne),n.rotateX(ne,ne,.5*-Math.PI),fi(ee,O,K,ne,F,2),n.identity(ne),n.rotateX(ne,ne,.5*Math.PI),fi(ee,O,K,ne,F,3),n.identity(ne),fi(ee,O,K,ne,F,4),n.identity(ne),n.rotateY(ne,ne,Math.PI),fi(ee,O,K,ne,F,5),ee.viewport.set([0,0,I.width,I.height])}(u,o),o.markSkyboxValid(u)):u.renderPass==="sky"&&function(I,O,W,Q,ee){const J=I.context,te=J.gl,F=I.transform,K=I.useProgram("skybox");J.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_CUBE_MAP,O.skyboxTexture);const ne=((ce,ve,je,we,Me)=>({u_matrix:ce,u_sun_direction:ve,u_cubemap:0,u_opacity:we,u_temporal_offset:Me}))(F.skyboxMatrix,O.getCenter(I,!1),0,Q,ee);I.prepareDrawProgram(J,K),K.draw(J,te.TRIANGLES,W,n.StencilMode.disabled,I.colorModeForRenderPass(),n.CullFaceMode.backCW,ne,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(u,o,C,_,D):S==="gradient"&&u.renderPass==="sky"&&function(I,O,W,Q,ee){const J=I.context,te=J.gl,F=I.transform,K=I.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new yl(J)),J.activeTexture.set(te.TEXTURE0);let ne=O.colorRampTexture;ne||(ne=O.colorRampTexture=new n.Texture(J,O.colorRamp,te.RGBA)),ne.bind(te.LINEAR,te.CLAMP_TO_EDGE);const ce=((ve,je,we,Me,Ae)=>({u_matrix:ve,u_color_ramp:0,u_center_direction:je,u_radius:n.degToRad(we),u_opacity:Me,u_temporal_offset:Ae}))(F.skyboxMatrix,O.getCenter(I,!1),O.paint.get("sky-gradient-radius"),Q,ee);I.prepareDrawProgram(J,K),K.draw(J,te.TRIANGLES,W,n.StencilMode.disabled,I.colorModeForRenderPass(),n.CullFaceMode.backCW,ce,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(u,o,C,_,D)},debug:function(u,i,o){for(let m=0;m<o.length;m++)Pm(u,i,o[m])},custom:function(u,i,o,m){const f=u.context,_=o.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&o.isLayerDraped()){if(u.renderPass==="offscreen"){const j=_.prerender;if(j){if(u.setCustomLayerDefaults(),f.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const S=u.transform.pointMerc;j.call(_,f.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.globeToMercatorTransition(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else j.call(_,f.gl,u.transform.customLayerMatrix());f.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const S=_.renderToTile;if(S){const C=m[0].canonical,D=new n.MercatorCoordinate(C.x+m[0].wrap*(1<<C.z),C.y,C.z);f.setDepthMode(n.DepthMode.disabled),f.setStencilMode(n.StencilMode.disabled),f.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),S.call(_,f.gl,D),f.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),f.setColorMode(u.colorModeForRenderPass()),f.setStencilMode(n.StencilMode.disabled);const j=_.renderingMode==="3d"?new n.DepthMode(u.context.gl.LEQUAL,n.DepthMode.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,n.DepthMode.ReadOnly);if(f.setDepthMode(j),u.transform.projection.name==="globe"){const S=u.transform.pointMerc;_.render(f.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.globeToMercatorTransition(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else _.render(f.gl,u.transform.customLayerMatrix());f.setDirty(),u.setBaseState(),f.bindFramebuffer.set(null)}}else n.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ea{constructor(i,o,m=!1){this.context=new mt(i,m),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=n.SourceCache.maxUnderzooming+n.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,o){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Mc(this,i));const f=this._terrain;this.transform.elevation=m?f:null,f.update(i,this.transform,o)}_updateFog(i){const o=i.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,f]=o.getFovAdjustedRange(this.transform._fov);if(m>f)return void(this.transform.fogCullDistSq=null);const _=m+.78*(f-m);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,o){if(this.width=i*n.exported.devicePixelRatio,this.height=o*n.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const i=this.context,o=new n.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(n.EXTENT,0),o.emplaceBack(0,n.EXTENT),o.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(o,n.posAttributes.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const m=new n.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(n.EXTENT,0),m.emplaceBack(0,n.EXTENT),m.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=i.createVertexBuffer(m,n.posAttributes.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const f=new n.StructArrayLayout2i4;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(f,n.posAttributes.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const _=new n.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(n.EXTENT,0,n.EXTENT,0),_.emplaceBack(0,n.EXTENT,0,n.EXTENT),_.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(_,n.boundsAttributes.members),this.mercatorBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const j=new n.StructArrayLayout3ui6;j.emplaceBack(0,1,2),j.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(j);const S=new n.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])S.emplaceBack(D);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new n.Texture(i,new n.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=n.create();const C=this.context.gl;this.stencilClearMode=new n.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(n.window.performance.now()),this.atmosphereBuffer=new Ed(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,o.TRIANGLES,n.DepthMode.disabled,this.stencilClearMode,n.ColorMode.disabled,n.CullFaceMode.disabled,go(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,m){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const C of m)if(this._tileClippingMaskIDs[C.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=o.id;const f=this.context,_=f.gl;this.nextStencilID+m.length>256&&this.clearStencil(),f.setColorMode(n.ColorMode.disabled),f.setDepthMode(n.DepthMode.disabled);const j=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of m){const C=o.getTile(S),D=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:O,tileBoundsSegments:W}=this.getTileBoundsBuffers(C);j.draw(f,_.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:_.ALWAYS,mask:0},D,255,_.KEEP,_.KEEP,_.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,go(S.projMatrix),"$clipping",I,O,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new n.StencilMode({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new n.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,m=i.sort((j,S)=>S.overscaledZ-j.overscaledZ),f=m[m.length-1].overscaledZ,_=m[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const j={};for(let S=0;S<_;S++)j[S+f]=new n.StencilMode({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[j,m]}return[{[f]:n.StencilMode.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new n.ColorMode([i.CONSTANT_COLOR,i.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?n.ColorMode.unblended:n.ColorMode.alphaBlended}depthModeForSublayer(i,o,m){if(!this.opaquePassEnabledForLayer())return n.DepthMode.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new n.DepthMode(m||this.context.gl.LEQUAL,o,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();const m=this.style.order,f=this.style._sourceCaches;for(const D in f){const I=f[D];I.used&&I.prepare(this.context)}const _={},j={},S={};for(const D in f){const I=f[D];_[D]=I.getVisibleCoordinates(),j[D]=_[D].slice().reverse(),S[D]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<m.length;D++)if(this.style._layers[m[D]].is3D()){this.opaquePassCutoff=D;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.GlobeSharedBuffers(this.context)),!n.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const D of m){const I=this.style._layers[D],O=i._getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const W=O?j[O.id]:void 0;(I.type==="custom"||I.isSky()||W&&W.length)&&this.renderLayer(this,O,I,W)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon];const C=this.terrain;if(C&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&C.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);if(D.isSky())continue;const O=I?j[I.id]:void 0;this._renderTileClippingMasks(D,I,O),this.renderLayer(this,I,D,O)}if(this.style.fog&&this.transform.projection.supportsFog&&function(D,I){const O=D.context,W=O.gl,Q=D.transform,ee=new n.DepthMode(W.LEQUAL,n.DepthMode.ReadOnly,[0,1]),J=D.useProgram("globeAtmosphere",null,Q.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),te=n.globeToMercatorTransition(Q.zoom),F=I.properties.get("color").toArray01(),K=I.properties.get("high-color").toArray01(),ne=I.properties.get("space-color").toArray01PremultipliedAlpha(),ce=n.identity$1([]);n.rotateY$1(ce,ce,-n.degToRad(Q._center.lng)),n.rotateX$1(ce,ce,n.degToRad(Q._center.lat)),n.rotateZ$1(ce,ce,Q.angle),n.rotateX$1(ce,ce,-Q._pitch);const ve=n.fromQuat(new Float32Array(16),ce),je=n.mapValue(I.properties.get("star-intensity"),0,1,0,.25),we=5e-4,Me=n.mapValue(I.properties.get("horizon-blend"),0,1,we,.25),Ae=n.globeUseCustomAntiAliasing(D,O,Q)&&Me===we?Q.worldSize/(2*Math.PI*1.025)-1:Q.globeRadius,Fe=D.frameCounter/1e3%1,at=n.length(Q.globeCenterInViewSpace),Re=Math.sqrt(Math.pow(at,2)-Math.pow(Ae,2)),Qe=Math.acos(Re/at),Ve=((Oe,Xe,lt,st,ct,Dt,qt,Et,Ft,is,es,Pt,vs,ws)=>({u_frustum_tl:Oe,u_frustum_tr:Xe,u_frustum_br:lt,u_frustum_bl:st,u_horizon:ct,u_transition:Dt,u_fadeout_range:qt,u_color:Et,u_high_color:Ft,u_space_color:is,u_star_intensity:es,u_star_size:5*n.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Pt,u_horizon_angle:vs,u_rotation_matrix:ws}))(Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.frustumCorners.horizon,te,Me,F,K,ne,je,Fe,Qe,ve);D.prepareDrawProgram(O,J);const nt=D.atmosphereBuffer;nt&&J.draw(O,W.TRIANGLES,ee,n.StencilMode.disabled,n.ColorMode.alphaBlended,n.CullFaceMode.backCW,Ve,"skybox",nt.vertexBuffer,nt.indexBuffer,nt.segments)}(this,this.style.fog),this.renderPass="sky",(n.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);D.isSky()&&this.renderLayer(this,I,D,I?j[I.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);if(D.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(D)){if(D.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=I?(D.type==="symbol"?S:j)[I.id]:void 0;this._renderTileClippingMasks(D,I,I?_[I.id]:void 0),this.renderLayer(this,I,D,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let D=null;n.values(this.style._layers).forEach(I=>{const O=i._getLayerSourceCache(I);O&&!I.isHidden(this.transform.zoom)&&(!D||D.getSource().maxzoom<O.getSource().maxzoom)&&(D=O)}),D&&this.options.showTileBoundaries&&Jn.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const I=D.transform.padding;Nd(D,D.transform.height-(I.top||0),3,Sa),Nd(D,I.bottom||0,3,Cm),xl(D,I.left||0,3,km),xl(D,D.transform.width-(I.right||0),3,Am);const O=D.transform.centerPoint;(function(W,Q,ee,J){Ta(W,Q-1,ee-10,2,20,J),Ta(W,Q-10,ee-1,20,2,J)})(D,O.x,D.transform.height-O.y,Mm)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(n.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,o,m,f){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||f&&f.length)&&(this.id=m.id,this.gpuTimingStart(m),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(m.type)||i.terrain&&m.type==="custom")&&Jn[m.type](i,o,m,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),m.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),i.beginQueryEXT(i.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const m in i){const f=i[m],_=this.context.extTimerQuery,j=_.getQueryObjectEXT(f.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(f.query),o[m]=j}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let m=0;for(const f of i)m+=o.getQueryObjectEXT(f,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(f);return m}translatePosMatrix(i,o,m,f,_){if(!m[0]&&!m[1])return i;const j=_?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(j){const D=Math.sin(j),I=Math.cos(j);m=[m[0]*I-m[1]*D,m[0]*D+m[1]*I]}const S=[_?m[0]:Vt(o,m[0],this.transform.zoom),_?m[1]:Vt(o,m[1],this.transform.zoom),0],C=new Float32Array(16);return n.translate(C,i,S),C}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){return i===null||i!==void 0&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,o=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,f=[];return this.terrainRenderModeElevated()&&f.push("TERRAIN"),this.transform.projection.name==="globe"&&f.push("GLOBE"),o&&f.push("ZERO_EXAGGERATION"),m&&!i&&m.getOpacity(this.transform.pitch)!==0&&f.push("FOG"),i&&f.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&f.push("OVERDRAW_INSPECTOR"),f}useProgram(i,o,m){this.cache=this.cache||{};const f=m||[],_=this.currentGlobalDefines().concat(f),j=ds.cacheKey(Sc[i],i,_,o);return this.cache[j]||(this.cache[j]=new ds(this.context,i,Sc[i],o,Uc[i],_)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=n.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,o,m){if(this.terrain&&this.terrain.renderingToTexture)return;const f=this.style.fog;if(f){const _=f.getOpacity(this.transform.pitch),j=((S,C,D,I,O,W,Q,ee,J,te,F)=>{const K=S.transform,ne=C.properties.get("color").toArray01();ne[3]=I;const ce=S.frameCounter/1e3%1;return{u_fog_matrix:D?K.calculateFogTileMatrix(D):S.identityMat,u_fog_range:C.getFovAdjustedRange(K._fov),u_fog_color:ne,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:ce,u_frustum_tl:O,u_frustum_tr:W,u_frustum_br:Q,u_frustum_bl:ee,u_globe_pos:J,u_globe_radius:te,u_viewport:F,u_globe_transition:n.globeToMercatorTransition(K.zoom),u_is_globe:+(K.projection.name==="globe")}})(this,f,m,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.exported.devicePixelRatio,this.transform.height*n.exported.devicePixelRatio]);o.setFogUniformValues(i,j)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const f of m)o[f.key]=i[f.key]||new n.Tile(f,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class _l{constructor(i=0,o=0,m=0,f=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(m)||m<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=m,this.right=f}interpolate(i,o,m){return o.top!=null&&i.top!=null&&(this.top=n.number(i.top,o.top,m)),o.bottom!=null&&i.bottom!=null&&(this.bottom=n.number(i.bottom,o.bottom,m)),o.left!=null&&i.left!=null&&(this.left=n.number(i.left,o.left,m)),o.right!=null&&i.right!=null&&(this.right=n.number(i.right,o.right,m)),this}getCenter(i,o){const m=n.clamp((this.left+i-this.right)/2,0,i),f=n.clamp((this.top+o-this.bottom)/2,0,o);return new n.Point(m,f)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new _l(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function bl(u,i){const o=n.getColumn(u,3);n.fromQuat(u,i),n.setColumn(u,3,o)}function ms(u,i){const o=n.identity$1([]);return n.rotateZ$1(o,o,-i),n.rotateX$1(o,o,-u),o}function jo(u,i){const o=[u[0],u[1],0],m=[i[0],i[1],0];if(n.length(o)>=1e-15){const j=n.normalize([],o);n.scale$2(m,j,n.dot(m,j)),i[0]=m[0],i[1]=m[1]}const f=n.cross([],i,u);if(n.len(f)<1e-15)return null;const _=Math.atan2(-f[1],f[0]);return ms(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}class Cd{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof n.MercatorCoordinate?i:new n.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=n.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const m=this.position,f=this._elevation?this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(i)):0,_=n.MercatorCoordinate.fromLngLat(i,f),j=[_.x-m.x,_.y-m.y,_.z-m.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=jo(j,o)}setPitchBearing(i,o){this.orientation=ms(n.degToRad(i),n.degToRad(-o))}}class vl{constructor(i,o){this._transform=n.identity([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new n.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=n.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&n.setColumn(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||n.identity$1([]),i&&bl(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=ms(i,o),bl(this._transform,this._orientation)}forward(){const i=n.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=n.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=n.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const m=new Float64Array(16);return n.invert(m,this.getWorldToCamera(i,o)),m}getWorldToCameraPosition(i,o,m){const f=this.position;n.scale$2(f,f,-i);const _=new Float64Array(16);return n.fromScaling(_,[m,m,m]),n.translate(_,_,f),_[10]*=o,_}getWorldToCamera(i,o){const m=new Float64Array(16),f=new Float64Array(4),_=this.position;return n.conjugate(f,this._orientation),n.scale$2(_,_,-i),n.fromQuat(m,f),n.translate(m,m,_),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=o,m[9]*=o,m[10]*=o,m[11]*=o,m}getCameraToClipPerspective(i,o,m,f){const _=new Float64Array(16);return n.perspective(_,i,o,m,f),_}getDistanceToElevation(i,o=!1){const m=i===0?0:n.mercatorZfromAltitude(i,o?n.latFromMercatorY(this.position[1]):this.position[1]),f=this.forward();return(m-this.position[2])/f[2]}clone(){return new vl([...this.position],[...this.orientation])}}function Ca(u,i){const o=wl(u.projection,u.zoom,u.width,u.height),m=function(_,j,S,C,D){const I=new n.LngLat(S.lng-180*dn,S.lat),O=new n.LngLat(S.lng+180*dn,S.lat),W=_.project(I.lng,I.lat),Q=_.project(O.lng,O.lat),ee=-Math.atan2(Q.y-W.y,Q.x-W.x),J=n.MercatorCoordinate.fromLngLat(S);J.y=n.clamp(J.y,-1+dn,1-dn);const te=J.toLngLat(),F=_.project(te.lng,te.lat),K=n.MercatorCoordinate.fromLngLat(te);K.x+=dn;const ne=K.toLngLat(),ce=_.project(ne.lng,ne.lat),ve=jl(ce.x-F.x,ce.y-F.y,ee),je=n.MercatorCoordinate.fromLngLat(te);je.y+=dn;const we=je.toLngLat(),Me=_.project(we.lng,we.lat),Ae=jl(Me.x-F.x,Me.y-F.y,ee),Fe=Math.abs(ve.x)/Math.abs(Ae.y),at=n.identity([]);n.rotateZ(at,at,-ee*(1-(D?0:C)));const Re=n.identity([]);return n.scale(Re,Re,[1,1-(1-Fe)*C,1]),Re[4]=-Ae.x/Ae.y*C,n.rotateZ(Re,Re,ee),n.multiply(Re,at,Re),Re}(u.projection,0,u.center,o,i),f=kd(u);return n.scale(m,m,[f,f,1]),m}function kd(u){const i=u.projection,o=wl(u.projection,u.zoom,u.width,u.height),m=Ad(i,u.center),f=Ad(i,n.LngLat.convert(i.center));return Math.pow(2,m*o+(1-o)*f)}function wl(u,i,o,m,f=1/0){const _=u.range;if(!_)return 0;const j=Math.min(f,Math.max(o,m)),S=Math.log(j/1024)/Math.LN2;return n.smoothstep(_[0]+S,_[1]+S,i)}const dn=1/4e4;function Ad(u,i){const o=n.clamp(i.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=new n.LngLat(i.lng-180*dn,o),f=new n.LngLat(i.lng+180*dn,o),_=u.project(m.lng,o),j=u.project(f.lng,o),S=n.MercatorCoordinate.fromLngLat(m),C=n.MercatorCoordinate.fromLngLat(f),D=j.x-_.x,I=j.y-_.y,O=C.x-S.x,W=C.y-S.y,Q=Math.sqrt((O*O+W*W)/(D*D+I*I));return Math.log(Q)/Math.LN2}function jl(u,i,o){const m=Math.cos(o),f=Math.sin(o);return{x:u*m-i*f,y:u*f+i*m}}class ka{constructor(i,o,m,f,_,j,S){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=m??0,this._maxPitch=f??60,this.setProjection(j),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _l,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new vl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,o=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(i||m)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=n.getProjection(this.projectionOptions);const m=!M(o,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.getProjection({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.Point(this.width,this.height)}get bearing(){return n.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;var m;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(m=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(f,_,j){var S=_[0],C=_[1],D=_[2],I=_[3],O=Math.sin(j),W=Math.cos(j);f[0]=S*W+D*O,f[1]=C*W+I*O,f[2]=S*-O+D*W,f[3]=C*-O+I*W}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=n.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=n.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let f=0,_=0;for(let j=0;j<o.length;j++){const S=new n.Point(o[j][0]*this.width,m+o[j][1]*(this.height-m)),C=i.pointCoordinate(S);if(!C)continue;const D=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);f+=C[3]*D,_+=D}return _===0?NaN:f/_}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*o,f=this._mercatorZfromZoom(i),_=this._mercatorZfromZoom(this._maxZoom),j=Math.max(f-m,_);this._setZoom(this._zoomFromMercatorZ(j))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const f=n.length(n.sub([],this._camera.position,m));return n.clamp(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!n.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];n.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new Cd;return o.position=new n.MercatorCoordinate(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!n.length$1(i))return!1;n.normalize$1(i,i);const o=n.transformQuat([],[0,0,-1],i),m=n.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const f=jo(o,m);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;i[2]=n.clamp(i[2],f/m,f/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,m){this._unmodified=!1,this._edgeInsets.interpolate(i,o,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new n.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new n.Point(0,0)),f=this.pointCoordinate(new n.Point(this.width,0)),_=this.pointCoordinate(new n.Point(this.width,this.height)),j=this.pointCoordinate(new n.Point(0,this.height)),S=Math.floor(Math.min(m.x,f.x,_.x,j.x)),C=Math.floor(Math.max(m.x,f.x,_.x,j.x)),D=1;for(let I=S-D;I<=C+D;I++)I!==0&&o.push(new n.UnwrappedTileID(I,i))}return o}coveringTiles(i){let o=this.coveringZoomLevel(i);const m=o,f=this.elevation&&!i.isTerrainDEM,_=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const j=this.locationCoordinate(this.center),S=this.center.lat,C=1<<o,D=[C*j.x,C*j.y,0],I=this.projection.name==="globe",O=!I,W=n.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,O),Q=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=C*n.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/n.mercatorZfromAltitude(1,this.center.lat),te=[C*Q.x,C*Q.y,J*(O?1:ee)],F=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,ne=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ce=i.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?kd(this):1,je=Oe=>{const lt=new n.MercatorCoordinate(Oe.x+25e-6,Oe.y,Oe.z),st=new n.MercatorCoordinate(Oe.x,Oe.y+25e-6,Oe.z),ct=Oe.toLngLat(),Dt=lt.toLngLat(),qt=st.toLngLat(),Et=this.locationCoordinate(ct),Ft=this.locationCoordinate(Dt),is=this.locationCoordinate(qt),es=Math.hypot(Ft.x-Et.x,Ft.y-Et.y),Pt=Math.hypot(is.x-Et.x,is.y-Et.y);return Math.sqrt(es*Pt)*ve/25e-6},we=Oe=>{const Xe=ne,lt=ce;return{aabb:n.tileAABB(this,C,0,0,0,Oe,lt,Xe,this.projection),zoom:0,x:0,y:0,minZ:lt,maxZ:Xe,wrap:Oe,fullyVisible:!1}},Me=[];let Ae=[];const Fe=o,at=i.reparseOverscaled?m:o,Re=Oe=>Oe*Oe,Qe=Re((J-this._centerAltitude)*ee),Ve=Oe=>{if(!this._elevation||!Oe.tileID||!_)return;const Xe=this._elevation.getMinMaxForTile(Oe.tileID),lt=Oe.aabb;Xe?(lt.min[2]=Xe.min,lt.max[2]=Xe.max,lt.center[2]=(lt.min[2]+lt.max[2])/2):(Oe.shouldSplit=nt(Oe),Oe.shouldSplit||(lt.min[2]=lt.max[2]=lt.center[2]=this._centerAltitude))},nt=Oe=>{if(Oe.zoom<K)return!0;if(Oe.zoom===Fe)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const Xe=Oe.aabb.distanceX(te),lt=Oe.aabb.distanceY(te);let st=Qe,ct=1;if(I){st=Re(Oe.aabb.distanceZ(te));const Et=Math.pow(2,Oe.zoom),Ft=n.latFromMercatorY((Oe.y+1)/Et),is=n.latFromMercatorY(Oe.y/Et),es=Math.min(Math.max(S,Ft),is),Pt=n.circumferenceAtLatitude(es)/n.circumferenceAtLatitude(S);if(ct=es===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pt/this._mercatorScaleRatio),this.zoom<=n.GLOBE_ZOOM_THRESHOLD_MIN&&Oe.zoom===Fe-1&&Pt>=.9)return!0}else if(f&&(st=Re(Oe.aabb.distanceZ(te)*ee)),this.projection.isReprojectedInTileSpace&&m<=5){const Et=Math.pow(2,Oe.zoom),Ft=je(new n.MercatorCoordinate((Oe.x+.5)/Et,(Oe.y+.5)/Et));ct=Ft>.85?1:Ft}const Dt=Xe*Xe+lt*lt+st,qt=Re((1<<Fe-Oe.zoom)*F*ct*((Et,Ft)=>{if(Ft*Re(.707)<Et)return 1;const is=Math.sqrt(Ft/Et);return is/(1.4144271570014144+(Math.pow(1.1,is-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(st,Qe),Dt));return Dt<qt};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Me.push(we(-Oe)),Me.push(we(Oe));for(Me.push(we(0));Me.length>0;){const Oe=Me.pop(),Xe=Oe.x,lt=Oe.y;let st=Oe.fullyVisible;if(!st){const ct=Oe.aabb.intersects(W);if(ct===0)continue;st=ct===2}if(Oe.zoom!==Fe&&nt(Oe))for(let ct=0;ct<4;ct++){const Dt=(Xe<<1)+ct%2,qt=(lt<<1)+(ct>>1),Et={aabb:_?Oe.aabb.quadrant(ct):n.tileAABB(this,C,Oe.zoom+1,Dt,qt,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:Dt,y:qt,wrap:Oe.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};f&&!I&&(Et.tileID=new n.OverscaledTileID(Oe.zoom+1===Fe?at:Oe.zoom+1,Oe.wrap,Oe.zoom+1,Dt,qt),Ve(Et)),Me.push(Et)}else{const ct=Oe.zoom===Fe?at:Oe.zoom;if(i.minzoom&&i.minzoom>ct)continue;const Dt=D[0]-(.5+Xe+(Oe.wrap<<Oe.zoom))*(1<<o-Oe.zoom),qt=D[1]-.5-lt,Et=Oe.tileID?Oe.tileID:new n.OverscaledTileID(ct,Oe.wrap,Oe.zoom,Xe,lt);Ae.push({tileID:Et,distanceSq:Dt*Dt+qt*qt})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,Xe=this.horizonLineFromTop();Ae=Ae.filter(lt=>{const st=[0,0,0,1],ct=[n.EXTENT,n.EXTENT,0,1],Dt=this.calculateFogTileMatrix(lt.tileID.toUnwrapped());n.transformMat4$1(st,st,Dt),n.transformMat4$1(ct,ct,Dt);const qt=n.getAABBPointSquareDist(st,ct);if(qt===0)return!0;let Et=!1;const Ft=this._elevation;if(Ft&&qt>Oe&&Xe!==0){const is=this.calculateProjMatrix(lt.tileID.toUnwrapped());let es;i.isTerrainDEM||(es=Ft.getMinMaxForTile(lt.tileID)),es||(es={min:ce,max:ne});const Pt=n.furthestTileCorner(this.rotation),vs=[Pt[0]*n.EXTENT,Pt[1]*n.EXTENT,es.max];n.transformMat4(vs,vs,is),Et=(1-vs[1])*this.height*.5<Xe}return qt<Oe||Et})}return Ae.sort((Oe,Xe)=>Oe.distanceSq-Xe.distanceSq).map(Oe=>Oe.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=n.clamp(i.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=this.projection.project(i.lng,o);return new n.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let m,f;const _=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;m=(o.x-_.x)/S,f=(o.y-_.y)/S}else{const S=this.pointCoordinate(o),C=this.pointCoordinate(_);m=S.x-C.x,f=S.y-C.y}const j=this.locationCoordinate(i);this.setLocation(new n.MercatorCoordinate(j.x-m,j.y-f))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const m=o?n.mercatorZfromAltitude(o,i.lat):void 0,f=this.projection.project(i.lng,i.lat);return new n.MercatorCoordinate(f.x,f.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const m=o??this._centerAltitude,f=[i.x,i.y,0,1],_=[i.x,i.y,1,1];n.transformMat4$1(f,f,this.pixelMatrixInverse),n.transformMat4$1(_,_,this.pixelMatrixInverse);const j=_[3];n.scale$1(f,f,1/f[3]),n.scale$1(_,_,1/j);const S=f[2],C=_[2];return{p0:f,p1:_,t:S===C?0:(m-S)/(C-S)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return n.transformMat4$1(o,o,this.pixelMatrixInverse),n.transformMat4$1(m,m,this.pixelMatrixInverse),n.scale$1(o,o,1/o[3]),n.scale$1(m,m,1/m[3]),o[2]=n.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,m[2]=n.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,n.scale$1(o,o,1/this.worldSize),n.scale$1(m,m,1/this.worldSize),new n.Ray([o[0],o[1],o[2]],n.normalize([],n.sub([],m,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:m,t:f}=i,_=n.mercatorZfromAltitude(o[2],this._center.lat),j=n.mercatorZfromAltitude(m[2],this._center.lat);return new n.MercatorCoordinate(n.number(o[0],m[0],f)/this.worldSize,n.number(o[1],m[1],f)/this.worldSize,n.number(_,j,f))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let o=this.projection.pointCoordinate3D(this,i.x,i.y);if(o)return new n.MercatorCoordinate(o[0],o[1],o[2]);let m=0,f=this.horizonLineFromTop();if(i.y>f)return this.pointCoordinate(i);const _=.02*f,j=i.clone();for(let S=0;S<10&&f-m>_;S++){j.y=n.number(m,f,.66);const C=this.projection.pointCoordinate3D(this,j.x,j.y);C?(f=j.y,o=C):m=j.y}return o?new n.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const m=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,f=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return n.transformMat4$1(f,f,this.pixelMatrix),f[3]>0?new n.Point(f[0]/f[3],f[1]/f[3]):new n.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,_=this.pointLocation3D(new n.Point(o,i)),j=this.pointLocation3D(new n.Point(f,i)),S=this.pointLocation3D(new n.Point(f,m)),C=this.pointLocation3D(new n.Point(o,m));let D=Math.min(_.lng,j.lng,S.lng,C.lng),I=Math.max(_.lng,j.lng,S.lng,C.lng),O=Math.min(_.lat,j.lat,S.lat,C.lat),W=Math.max(_.lat,j.lat,S.lat,C.lat);const Q=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,J=(te,F,K,ne,ce)=>{const ve=(te+K)/2,je=(F+ne)/2,we=new n.Point(ve,je),{lng:Me,lat:Ae}=this.pointLocation3D(we),Fe=Math.max(0,D-Me,O-Ae,Me-I,Ae-W);D=Math.min(D,Me),I=Math.max(I,Me),O=Math.min(O,Ae),W=Math.max(W,Ae),(ce<ee||Fe>Q)&&(J(te,F,ve,je,ce+1),J(ve,je,K,ne,ce+1))};if(J(o,i,f,i,1),J(f,i,f,m,1),J(f,m,o,m,1),J(o,m,o,i,1),this.projection.name==="globe"){const[te,F]=n.polesInViewport(this);te?(W=90,I=180,D=-180):F&&(O=-90,I=180,D=-180)}return new n.LngLatBounds(new n.LngLat(D,O),new n.LngLat(I,W))}_getBoundsRectangular(i,o){const{top:m,left:f}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,j=this.width-this._edgeInsets.right,S=new n.Point(f,m),C=new n.Point(j,m),D=new n.Point(j,_),I=new n.Point(f,_);let O=this.pointCoordinate(S,i),W=this.pointCoordinate(C,i);const Q=this.pointCoordinate(D,o),ee=this.pointCoordinate(I,o),J=(te,F)=>(F.y-te.y)/(F.x-te.x);return O.y>1&&W.y>=0?O=new n.MercatorCoordinate((1-ee.y)/J(ee,O)+ee.x,1):O.y<0&&W.y<=1&&(O=new n.MercatorCoordinate(-ee.y/J(ee,O)+ee.x,0)),W.y>1&&O.y>=0?W=new n.MercatorCoordinate((1-Q.y)/J(Q,W)+Q.x,1):W.y<0&&O.y<=1&&(W=new n.MercatorCoordinate(-Q.y/J(Q,W)+Q.x,0)),new n.LngLatBounds().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((m,f)=>{if(f.dem){const _=f.dem.tree;m.min=Math.min(m.min,_.minimums[0]),m.max=Math.max(m.max,_.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-n.MAX_MERCATOR_LATITUDE,this.maxLat=n.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=n.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=n.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=n.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,m=this._distanceTileDataCache;if(m[o])return m[o];const f=i.canonical,_=1/this.height,j=this.cameraWorldSize,S=j/this.zoomScale(f.z),C=(f.x+Math.pow(2,f.z)*i.wrap)*S,D=f.y*S,I=this.point;I.x*=j/this.worldSize,I.y*=j/this.worldSize;const O=this.angle,W=Math.sin(-O),Q=-Math.cos(-O);return m[o]={bearing:[W,Q],center:[(I.x-C)*_,(I.y-D)*_],scale:S/n.EXTENT*_},m[o]}calculateFogTileMatrix(i){const o=i.key,m=this._fogTileMatrixCache;if(m[o])return m[o];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return n.multiply(f,this.worldToFogMatrix,f),m[o]=new Float32Array(f),m[o]}calculateProjMatrix(i,o=!1){const m=i.key,f=o?this._alignedProjMatrixCache:this._projMatrixCache;if(f[m])return f[m];const _=this.calculatePosMatrix(i,this.worldSize);return n.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,_),f[m]=new Float32Array(_),f[m]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[o])return m[o];const f=function(_,j){const{scale:S}=_.tileTransform,C=S*n.EXTENT/(_.tileSize*Math.pow(2,j.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return D=new Float32Array(4),W=(I=j.inverseAdjustmentMatrix)[1],Q=I[2],ee=I[3],te=(O=[C,C])[1],D[0]=I[0]*(J=O[0]),D[1]=W*J,D[2]=Q*te,D[3]=ee*te,D;var D,I,O,W,Q,ee,J,te}(i,this);return m[o]=f,m[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,o=n.fromScaling([],[i,i,i]);return n.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const o=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(o),f=this._camera.forward(),_=n.mercatorZfromAltitude(1,this._center.lat);m[2]/=_,f[2]/=_,n.normalize(f,f);const j=i.raycast(m,f,i.exaggeration());if(j){const S=n.scaleAndAdd([],m,f,j),C=new n.MercatorCoordinate(S[0],S[1],n.mercatorZfromAltitude(S[2],n.latFromMercatorY(S[1]))),D=(C.z+n.length([C.x-m[0],C.y-m[1],C.z-m[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,m=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(m),_=o.getAtPointOrZero(new n.MercatorCoordinate(...f)),j=this.pixelsPerMeter/this.worldSize*_,S=this._minimumHeightOverTerrain(),C=f[2]-j;if(C<=S)if(C<0||i){const D=this.locationCoordinate(this._center,this._centerAltitude),I=[f[0],f[1],D.z-f[2]],O=n.length(I);I[2]-=(S-C)/this._pixelsPerMercatorPixel;const W=n.length(I);if(W===0)return;n.scale$2(I,I,O/W*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],D.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const W=this.center;return W.lat=n.clamp(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(W.lng=n.clamp(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const o=this._unmodified,{x:m,y:f}=this.point;let _=0,j=m,S=f;const C=this.width/2,D=this.height/2,I=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(f-D<I&&(S=I+D),f+D>O&&(S=O-D),O-I<this.height&&(_=Math.max(_,this.height/(O-I)),S=(O+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,ee=this.worldSize/2-(W+Q)/2;j=(m+ee+this.worldSize)%this.worldSize-ee,j-C<W&&(j=W+C),j+C>Q&&(j=Q-C),Q-W<this.width&&(_=Math.max(_,this.width/(Q-W)),j=(Q+W)/2)}j===m&&S===f||(this.center=this.unproject(new n.Point(j,S))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.mercatorZfromAltitude(1,this.center.lat)/n.mercatorZfromAltitude(1,n.GLOBE_SCALE_MATCH_LATITUDE));const m=wl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const f=this.projection.zAxisUnit==="meters"?o:1,_=this._camera.getWorldToCamera(this.worldSize,f),j=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);j[8]=2*-i.x/this.width,j[9]=2*i.y/this.height;let S=n.mul([],j,_);if(this.projection.isReprojectedInTileSpace){const je=this.locationCoordinate(this.center),we=n.identity([]);n.translate(we,we,[je.x*this.worldSize,je.y*this.worldSize,0]),n.multiply(we,we,Ca(this)),n.translate(we,we,[-je.x*this.worldSize,-je.y*this.worldSize,0]),n.multiply(S,S,we),this.inverseAdjustmentMatrix=function(Me){const Ae=Ca(Me,!0);return ke([],[Ae[0],Ae[1],Ae[4],Ae[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=n.scale([],S,[this.worldSize,this.worldSize,this.worldSize/f,1]),this.projMatrix=S,this.invProjMatrix=n.invert(new Float64Array(16),this.projMatrix);const C=n.invert([],j);this.frustumCorners=n.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);n.identity(D),n.scale(D,D,[1,-1,1]),n.rotateX(D,D,this._pitch),n.rotateZ(D,D,this.angle);const I=n.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;I[8]=2*-i.x/this.width,I[9]=2*(i.y+O)/this.height,this.skyboxMatrix=n.multiply(D,I,D);const W=this.point,Q=W.x,ee=W.y,J=this.width%2/2,te=this.height%2/2,F=Math.cos(this.angle),K=Math.sin(this.angle),ne=Q-Math.round(Q)+F*J+K*te,ce=ee-Math.round(ee)+F*te+K*J,ve=new Float64Array(S);if(n.translate(ve,ve,[ne>.5?ne-1:ne,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=ve,S=n.create(),n.scale(S,S,[this.width/2,-this.height/2,1]),n.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=n.create(),n.scale(S,S,[1,-1,1]),n.translate(S,S,[-1,-1,0]),n.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=n.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.calculateGlobeMatrix(this);const je=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.transformMat4(je,je,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,m=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,_=[i,i,o];n.scale$2(_,_,f),n.scale$2(m,m,-1),n.multiply$2(m,m,_);const j=n.create();n.translate(j,j,m),n.scale(j,j,_),this.mercatorFogMatrix=j,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,f)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),f=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-m[0]*_,f.y/this.worldSize-m[1]*_,i/this.worldSize*this._centerAltitude-m[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],f=i[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(_=Math.min((o-m)/f,1)),this._camera.position=n.scaleAndAdd([],this._camera.position,i,_),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:m,bearing:f}=this._camera.getPitchBearing(),_=n.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,j=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.degToRad(this._maxPitch)),S=Math.max((i[2]-_)/Math.cos(m),j),C=this._zoomFromMercatorZ(S);n.scaleAndAdd(i,i,o,S),this._pitch=n.clamp(m,n.degToRad(this.minPitch),n.degToRad(this.maxPitch)),this.angle=n.wrap(f,-Math.PI,Math.PI),this._setZoom(n.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,m=n.GLOBE_ZOOM_THRESHOLD_MAX,f=0,_=1/0;for(;m-o>1e-6&&m>o;){const j=o+.5*(m-o),S=this.tileSize*Math.pow(2,j),C=this.getCameraToCenterDistance(this.projection,j,S),D=this.scaleZoom(C/(i*this.tileSize)),I=Math.abs(j-D);I<_&&(_=I,f=j),j<D?o=j:m=j}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const m=Math.min(i.x,o.x),f=Math.max(i.x,o.x),_=Math.min(i.y,o.y),j=Math.max(i.y,o.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new n.Point(m,_),new n.Point(f,j),new n.Point(m,j),new n.Point(f,_)],C=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const I of S){const O=this.pointRayIntersection(I);if(O.t<0)return!0;const W=this.rayIntersectionCoordinate(O);if(W.x<C||W.y<0||W.x>D||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.Point(0,0),new n.Point(this.width,this.height))}zoomDeltaToMovement(i,o){const m=n.length(n.sub([],this._camera.position,i)),f=this._zoomFromMercatorZ(m)+o;return m-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([o,m,f],_){const j=[o,m,f,1];n.transformMat4$1(j,j,_);const S=j[3]=Math.max(j[3],1e-6);return j[0]/=S,j[1]/=S,j[2]/=S,j}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.Point(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.Point(0,i))}}getCameraToCenterDistance(i,o=this.zoom,m=this.worldSize){const f=wl(i,o,this.width,this.height,1024),_=i.pixelSpaceConversion(this.center.lat,m,f);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.multiply(i,i,this.globeMatrix),i}}function Aa(u,i){let o=!1,m=null;const f=()=>{m=null,o&&(u(),m=setTimeout(f,i),o=!1)};return()=>(o=!0,m||f(),m)}class $c{constructor(i){this._hashName=i&&encodeURIComponent(i),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Aa(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,n.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),n.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=No(i);if(this._hashName){const m=this._hashName;let f=!1;const _=n.window.location.hash.slice(1).split("&").map(j=>{const S=j.split("=")[0];return S===m?(f=!0,`${S}=${o}`):j}).filter(j=>j);return f||_.push(`${m}=${o}`),`#${_.join("&")}`}return`#${o}`}_getCurrentHash(){const i=n.window.location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(o=m)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(m=>isNaN(m))){const m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:m,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=n.window.location.href.replace(/(#.+)?$/,this.getHashString());n.window.history.replaceState(n.window.history.state,null,i)}}function No(u,i){const o=u.getCenter(),m=Math.round(100*u.getZoom())/100,f=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),j=Math.round(o.lng*_)/_,S=Math.round(o.lat*_)/_,C=u.getBearing(),D=u.getPitch();let I=i?`/${j}/${S}/${m}`:`${m}/${S}/${j}`;return(C||D)&&(I+="/"+Math.round(10*C)/10),D&&(I+=`/${Math.round(D)}`),I}const So={linearity:.3,easing:n.bezier(0,0,.3,1)},Nl=n.extend({deceleration:2500,maxSpeed:1400},So),Sl=n.extend({deceleration:20,maxSpeed:1400},So),Nt=n.extend({deceleration:1e3,maxSpeed:360},So),Ci=n.extend({deceleration:1e3,maxSpeed:90},So);class Md{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=n.exported.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new n.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(o.pan.mag()){const _=Eo(o.pan.mag(),m,n.extend({},Nl,i||{}));f.offset=o.pan.mult(_.amount/o.pan.mag()),f.center=this._map.transform.center,To(f,_)}if(o.zoom){const _=Eo(o.zoom,m,Sl);f.zoom=this._map.transform.zoom+_.amount,To(f,_)}if(o.bearing){const _=Eo(o.bearing,m,Nt);f.bearing=this._map.transform.bearing+n.clamp(_.amount,-179,179),To(f,_)}if(o.pitch){const _=Eo(o.pitch,m,Ci);f.pitch=this._map.transform.pitch+_.amount,To(f,_)}if(f.zoom||f.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function To(u,i){(!u.duration||u.duration<i.duration)&&(u.duration=i.duration,u.easing=i.easing)}function Eo(u,i,o){const{maxSpeed:m,linearity:f,deceleration:_}=o,j=n.clamp(u*f/(i/1e3),-m,m),S=Math.abs(j)/(_*f);return{easing:o.easing,duration:1e3*S,amount:j*(S/2)}}class Sr extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m,f={}){const _=Se(o.getCanvasContainer(),m),j=o.unproject(_);super(i,n.extend({point:_,lngLat:j,originalEvent:m},f)),this._defaultPrevented=!1,this.target=o}}class Co extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m){const f=i==="touchend"?m.changedTouches:m.touches,_=Ce(o.getCanvasContainer(),f),j=_.map(C=>o.unproject(C)),S=_.reduce((C,D,I,O)=>C.add(D.div(O.length)),new n.Point(0,0));super(i,{points:_,point:S,lngLats:j,lngLat:o.unproject(S),originalEvent:m}),this._defaultPrevented=!1}}class Tl extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class Gc{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Tl(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Sr(i.type,this._map,i))}mouseup(i){this._map.fire(new Sr(i.type,this._map,i))}preclick(i){const o=n.extend({},i);o.type="preclick",this._map.fire(new Sr(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Sr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Sr(i.type,this._map,i))}mouseover(i){this._map.fire(new Sr(i.type,this._map,i))}mouseout(i){this._map.fire(new Sr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Co(i.type,this._map,i))}touchmove(i){this._map.fire(new Co(i.type,this._map,i))}touchend(i){this._map.fire(new Co(i.type,this._map,i))}touchcancel(i){this._map.fire(new Co(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class El{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Sr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Sr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Sr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pd{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(oe(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const m=o,f=this._startPos,_=this._lastPos;if(!f||!_||_.equals(m)||!this._box&&m.dist(f)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=V("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const j=Math.min(f.x,m.x),S=Math.max(f.x,m.x),C=Math.min(f.y,m.y),D=Math.max(f.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${j}px,${C}px)`,this._box.style.width=S-j+"px",this._box.style.height=D-C+"px")})}mouseupWindow(i,o){if(!this._active)return;const m=this._startPos,f=o;if(m&&i.button===0){if(this.reset(),ae(),m.x!==f.x||m.y!==f.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(m,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),se(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new n.Event(i,{originalEvent:o}))}}function Cl(u,i){const o={};for(let m=0;m<u.length;m++)o[u[m].identifier]=i[m];return o}class Ma{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(f){const _=new n.Point(0,0);for(const j of f)_._add(j);return _.div(f.length)}(o),this.touches=Cl(m,o)))}touchmove(i,o,m){if(this.aborted||!this.centroid)return;const f=Cl(m,o);for(const _ in this.touches){const j=f[_];(!j||j.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Zc{constructor(i){this.singleTap=new Ma(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,m){this.singleTap.touchstart(i,o,m)}touchmove(i,o,m){this.singleTap.touchmove(i,o,m)}touchend(i,o,m){const f=this.singleTap.touchend(i,o,m);if(f){const _=i.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(f)<30;if(_&&j||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Im{constructor(){this._zoomIn=new Zc({numTouches:1,numTaps:2}),this._zoomOut=new Zc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,m){this._zoomIn.touchstart(i,o,m),this._zoomOut.touchstart(i,o,m)}touchmove(i,o,m){this._zoomIn.touchmove(i,o,m),this._zoomOut.touchmove(i,o,m)}touchend(i,o,m){const f=this._zoomIn.touchend(i,o,m),_=this._zoomOut.touchend(i,o,m);return f?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()+1,around:j.unproject(f)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()-1,around:j.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Id={0:1,2:2};class Pa{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const m=fe(i);this._correctButton(i,m)&&(this._lastPoint=o,this._eventButton=m)}mousemoveWindow(i,o){const m=this._lastPoint;if(m){if(i.preventDefault(),this._eventButton!=null&&function(f,_){const j=Id[_];return f.buttons===void 0||(f.buttons&j)!==j}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(m,o)}}mouseupWindow(i){this._lastPoint&&fe(i)===this._eventButton&&(this._moved&&ae(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wc extends Pa{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class Hc extends Pa{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const m=.8*(o.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class Xc extends Pa{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const m=-.5*(o.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class kl{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.Point(0,0)}touchstart(i,o,m){return this._calculateTransform(i,o,m)}touchmove(i,o,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!n.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,m)}}touchend(i,o,m){this._calculateTransform(i,o,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,m){m.length>0&&(this._active=!0);const f=Cl(m,o),_=new n.Point(0,0),j=new n.Point(0,0);let S=0;for(const D in f){const I=f[D],O=this._touches[D];O&&(_._add(I),j._add(I.sub(O)),S++,f[D]=I)}if(this._touches=f,S<this._minTouches||!j.mag())return;const C=j.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ko{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,m){return{}}touchstart(i,o,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,m){const f=this._firstTwoTouches;if(!f)return;i.preventDefault();const[_,j]=f,S=Ao(m,o,_),C=Ao(m,o,j);if(!S||!C)return;const D=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],D,i)}touchend(i,o,m){if(!this._firstTwoTouches)return;const[f,_]=this._firstTwoTouches,j=Ao(m,o,f),S=Ao(m,o,_);j&&S||(this._active&&ae(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ao(u,i,o){for(let m=0;m<u.length;m++)if(u[m].identifier===o)return i[m]}function Kc(u,i){return Math.log(u/i)/Math.LN2}class Dd extends ko{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,m),pinchAround:o}}}function Qc(u,i){return 180*u.angleWith(i)/Math.PI}class Ld extends ko{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const m=this._vector;if(this._vector=i[0].sub(i[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Qc(this._vector,m),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const f=Qc(i,m);return Math.abs(f)<o}}function An(u){return Math.abs(u.y)>Math.abs(u.x)}class Rd extends ko{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,An(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,m){const f=this._lastPoints;if(!f)return;const _=i[0].sub(f[0]),j=i[1].sub(f[1]);return this._map._cooperativeGestures&&!n.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(_,j,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+j.y)/2*-.5})}gestureBeginsVertically(i,o,m){if(this._valid!==void 0)return this._valid;const f=i.mag()>=2,_=o.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const j=i.y>0==o.y>0;return An(i)&&An(o)&&j}}const zd={panStep:100,bearingStep:15,pitchStep:10};class Dm{constructor(){const i=zd;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,m=0,f=0,_=0,j=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?f=1:(i.preventDefault(),j=-1);break;case 40:i.shiftKey?f=-1:(i.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(m=0,f=0),{cameraAnimation:S=>{const C=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Od,zoom:o?Math.round(C)+o*(i.shiftKey?2:1):C,bearing:S.getBearing()+m*this._bearingStep,pitch:S.getPitch()+f*this._pitchStep,offset:[-_*this._panStep,-j*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Od(u){return u*(2-u)}const Jc=4.000244140625;class Fd{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||n.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===n.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=n.exported.now(),f=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,o!==0&&o%Jc==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(f*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Se(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Jc?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&D!==0&&(D=1/D);const I=o(),O=Math.pow(2,I),W=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(W*D))),this._type==="wheel"&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:o(),f=this._startZoom,_=this._easing;let j,S=!1;if(this._type==="wheel"&&f&&_){const C=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),D=_(C);j=n.number(f,m,D),C<1?this._frameId||(this._frameId=!0):S=!0}else j=m,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:j-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=n.ease;if(this._prevEase){const m=this._prevEase,f=(n.exported.now()-m.start)/m.duration,_=m.easing(f+.01)-m.easing(f),j=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-j*j);o=n.bezier(j,S,.25,1)}return this._prevEase={start:n.exported.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(n.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Bd{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Br{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lm{constructor(){this._tap=new Zc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=o[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,o,m))}touchmove(i,o,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const f=o[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,m)}touchend(i,o,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(i,o,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ud{constructor(i,o,m){this._el=i,this._mousePan=o,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rm{constructor(i,o,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zm{constructor(i,o,m,f){this._el=i,this._touchZoom=o,this._touchRotate=m,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gi=u=>u.zoom||u.drag||u.pitch||u.rotate;class Vd extends n.Event{}class Om{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const m=n.sub([],o,i);this.radius=n.length(m[2]<0?n.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){n.div(i,i,this.constants),n.normalize(i,i),n.mul$1(i,i,this.constants);const o=n.scale$2([],i,this.radius);if(o[2]>0){const m=n.scale$2([],[0,0,1],n.dot(o,[0,0,1])),f=n.scale$2([],n.normalize([],[o[0],o[1],0]),this.radius),_=n.add([],o,n.scale$2([],n.sub([],n.add([],f,m),o),2));o[0]=_[0],o[1]=_[1]}return o}}function ki(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class qi{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Md(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Om,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[n.window.document,"mousemove",{capture:!0}],[n.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[n.window,"blur",void 0]];for(const[f,_,j]of this._listeners)f.addEventListener(_,f===n.window.document?this.handleWindowEvent:this.handleEvent,j)}destroy(){for(const[i,o,m]of this._listeners)i.removeEventListener(o,i===n.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const o=this._map,m=o.getCanvasContainer();this._add("mapEvent",new Gc(o,i));const f=o.boxZoom=new Pd(o,i);this._add("boxZoom",f);const _=new Im,j=new Br;o.doubleClickZoom=new Bd(j,_),this._add("tapZoom",_),this._add("clickZoom",j);const S=new Lm;this._add("tapDragZoom",S);const C=o.touchPitch=new Rd(o);this._add("touchPitch",C);const D=new Hc(i),I=new Xc(i);o.dragRotate=new Rm(i,D,I),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const O=new Wc(i),W=new kl(o,i);o.dragPan=new Ud(m,O,W),this._add("mousePan",O),this._add("touchPan",W,["touchZoom","touchRotate"]);const Q=new Ld,ee=new Dd;o.touchZoomRotate=new zm(m,ee,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new El(o));const J=o.scrollZoom=new Fd(o,this);this._add("scrollZoom",J,["mousePan"]);const te=o.keyboard=new Dm;this._add("keyboard",te);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[F]&&o[F].enable(i[F])}_add(i,o,m){this._handlers.push({handlerName:i,handler:o,allowed:m}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,m){for(const f in i)if(f!==m&&(!o||o.indexOf(f)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const m of i)this._el.contains(m.target)&&o.push(m);return o}handleEvent(i,o){this._updatingCamera=!0;const m=i.type==="renderFrame",f=m?void 0:i,_={needsRenderFrame:!1},j={},S={},C=i.touches?this._getMapTouches(i.touches):void 0,D=C?Ce(this._el,C):m?void 0:Se(this._el,i);for(const{handlerName:W,handler:Q,allowed:ee}of this._handlers){if(!Q.isEnabled())continue;let J;this._blockedByActive(S,ee,W)?Q.reset():Q[o||i.type]&&(J=Q[o||i.type](i,D,C),this.mergeHandlerResult(_,j,J,W,f),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||Q.isActive())&&(S[W]=Q)}const I={};for(const W in this._previousActiveHandlers)S[W]||(I[W]=f);this._previousActiveHandlers=S,(Object.keys(I).length||ki(_))&&(this._changes.push([_,j,I]),this._triggerRenderFrame()),(Object.keys(S).length||ki(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=_;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(i,o,m,f,_){if(!m)return;n.extend(i,m);const j={handlerName:f,originalEvent:m.originalEvent||_};m.zoomDelta!==void 0&&(o.zoom=j),m.panDelta!==void 0&&(o.drag=j),m.pitchDelta!==void 0&&(o.pitch=j),m.bearingDelta!==void 0&&(o.rotate=j)}_applyChanges(){const i={},o={},m={};for(const[f,_,j]of this._changes)f.panDelta&&(i.panDelta=(i.panDelta||new n.Point(0,0))._add(f.panDelta)),f.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(i.around=f.around),f.aroundCoord!==void 0&&(i.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(i.pinchAround=f.pinchAround),f.noInertia&&(i.noInertia=f.noInertia),n.extend(o,_),n.extend(m,j);this._updateMapTransform(i,o,m),this._changes=[]}_updateMapTransform(i,o,m){const f=this._map,_=f.transform,j=K=>[K.x,K.y,K.z];if((K=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!ki(i)){const K=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",K!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&f._stop(!0),!ki(i))return void this._fireEvents(o,m,!0);let{panDelta:S,zoomDelta:C,bearingDelta:D,pitchDelta:I,around:O,aroundCoord:W,pinchAround:Q}=i;_._isCameraConstrained&&(C>0&&(C=0),_._isCameraConstrained=!1),Q!==void 0&&(O=Q),(C||(K=>o[K]&&!this._eventsInProgress[K])("drag"))&&O&&(this._dragOrigin=j(_.pointCoordinate3D(O)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",f._stop(!0),O=O||f.transform.centerPoint,D&&(_.bearing+=D),I&&(_.pitch+=I),_._updateCameraState();const ee=[0,0,0];if(S)if(_.projection.name==="mercator"){const K=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O).dir),ne=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O.sub(S)).dir);ee[0]=ne[0]-K[0],ee[1]=ne[1]-K[1]}else{const K=_.pointCoordinate(O);if(_.projection.name==="globe"){S=S.rotate(-_.angle);const ne=_._pixelsPerMercatorPixel/_.worldSize;ee[0]=-S.x*n.mercatorScale(n.latFromMercatorY(K.y))*ne,ee[1]=-S.y*n.mercatorScale(_.center.lat)*ne}else{const ne=_.pointCoordinate(O.sub(S));K&&ne&&(ee[0]=ne.x-K.x,ee[1]=ne.y-K.y)}}const J=_.zoom,te=[0,0,0];if(C){const K=j(W||_.pointCoordinate3D(O)),ne={dir:n.normalize([],n.sub([],K,_._camera.position))};if(ne.dir[2]<0){const ce=_.zoomDeltaToMovement(K,C);n.scale$2(te,ne.dir,ce)}}const F=n.add(ee,ee,te);_._translateCameraConstrained(F),C&&Math.abs(_.zoom-J)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,m,!0)}_fireEvents(i,o,m){const f=gi(this._eventsInProgress),_=gi(i),j={};for(const I in i){const{originalEvent:O}=i[I];this._eventsInProgress[I]||(j[`${I}start`]=O),this._eventsInProgress[I]=i[I]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(const I in j)this._fireEvent(I,j[I]);_&&this._fireEvent("move",_.originalEvent);for(const I in i){const{originalEvent:O}=i[I];this._fireEvent(I,O)}const S={};let C;for(const I in this._eventsInProgress){const{handlerName:O,originalEvent:W}=this._eventsInProgress[I];this._handlersById[O].isActive()||(delete this._eventsInProgress[I],C=o[O]||W,S[`${I}end`]=C)}for(const I in S)this._fireEvent(I,S[I]);const D=gi(this._eventsInProgress);if(m&&(f||_)&&!D){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;I?(O(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:C})):(this._map.fire(new n.Event("moveend",{originalEvent:C})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new n.Event(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Vd("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Yn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Al extends n.Evented{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,m){return i=n.Point.convert(i).mult(-1),this.panTo(this.transform.center,n.extend({offset:i},o),m)}panTo(i,o,m){return this.easeTo(n.extend({center:i},o),m)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,m){return this.easeTo(n.extend({zoom:i},o),m)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,m){return this.easeTo(n.extend({bearing:i},o),m)}resetNorth(i,o){return this.rotateTo(0,n.extend({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=n.LngLatBounds.convert(i);const m=o&&o.bearing||0,f=o&&o.pitch||0,_=i.getNorthWest(),j=i.getSouthEast();return this._cameraForBounds(this.transform,_,j,m,f,o)}_extendCameraOptions(i){const o={top:0,bottom:0,right:0,left:0};if(typeof(i=n.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const m=i.padding;i.padding={top:m,bottom:m,right:m,left:m}}return i.padding=n.extend(o,i.padding),i}_minimumAABBFrustumDistance(i,o){const m=o.max[0]-o.min[0],f=o.max[1]-o.min[1];return m/f>i.aspect?m/(2*Math.tan(.5*i.fovX)*i.aspect):f/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,m,f,_,j){const S=i.clone(),C=this._extendCameraOptions(j);S.bearing=f,S.pitch=_;const D=n.LngLat.convert(o),I=n.LngLat.convert(m),O=.5*(D.lat+I.lat),W=.5*(D.lng+I.lng),Q=n.latLngToECEF(O,W),ee=n.normalize([],Q),J=n.normalize([],n.cross([],ee,[0,1,0])),te=n.cross([],J,ee),F=[J[0],J[1],J[2],0,te[0],te[1],te[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],K=[Q,n.latLngToECEF(D.lat,D.lng),n.latLngToECEF(I.lat,D.lng),n.latLngToECEF(I.lat,I.lng),n.latLngToECEF(D.lat,I.lng),n.latLngToECEF(O,D.lng),n.latLngToECEF(O,I.lng),n.latLngToECEF(D.lat,W),n.latLngToECEF(I.lat,W)];let ne=n.Aabb.fromPoints(K.map(st=>[n.dot(J,st),n.dot(te,st),n.dot(ee,st)]));const ce=n.transformMat4([],ne.center,F);n.squaredLength(ce)===0&&n.set(ce,0,0,1),n.normalize(ce,ce),n.scale$2(ce,ce,n.GLOBE_RADIUS),S.center=n.ecefToLatLng(ce);const ve=S.getWorldToCameraMatrix(),je=n.invert(new Float64Array(16),ve);ne=n.Aabb.applyTransform(ne,n.multiply([],ve,F)),n.transformMat4(ce,ce,ve);const we=.5*(ne.max[2]-ne.min[2]),Me=this._minimumAABBFrustumDistance(S,ne),Ae=n.scale$2([],[0,0,1],we),Fe=n.add(Ae,ce,Ae),at=Me+(S.pitch===0?0:n.distance(ce,Fe)),Re=S.globeCenterInViewSpace,Qe=n.sub([],ce,[Re[0],Re[1],Re[2]]);n.normalize(Qe,Qe),n.scale$2(Qe,Qe,at);const Ve=n.add([],ce,Qe);n.transformMat4(Ve,Ve,je);const nt=n.earthRadius/n.GLOBE_RADIUS,Oe=n.length(Ve),Xe=n.mercatorZfromAltitude(Math.max(Oe*nt-n.earthRadius,Number.EPSILON),0),lt=Math.min(S.zoomFromMercatorZAdjusted(Xe),C.maxZoom);return lt>.5*(n.GLOBE_ZOOM_THRESHOLD_MIN+n.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=lt,this._cameraForBounds(S,o,m,f,_,j)):{center:S.center,zoom:lt,bearing:f,pitch:_}}queryTerrainElevation(i,o){const m=this.transform.elevation;return m?(o=n.extend({},{exaggerated:!0},o),m.getAtPoint(n.MercatorCoordinate.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,m,f,_,j){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,o,m,f,_,j);const S=i.clone(),C=this._extendCameraOptions(j),D=S.padding;S.bearing=f,S.pitch=_;const I=n.LngLat.convert(o),O=n.LngLat.convert(m),W=new n.LngLat(I.lng,O.lat),Q=new n.LngLat(O.lng,I.lat),ee=S.project(I),J=S.project(O),te=this.queryTerrainElevation(I),F=this.queryTerrainElevation(O),K=this.queryTerrainElevation(W),ne=this.queryTerrainElevation(Q),ce=[[ee.x,ee.y,Math.min(te||0,F||0,K||0,ne||0)],[J.x,J.y,Math.max(te||0,F||0,K||0,ne||0)]];let ve=n.Aabb.fromPoints(ce);const je=S.getWorldToCameraMatrix(),we=n.invert(new Float64Array(16),je);ve=n.Aabb.applyTransform(ve,je);const Me=n.sub([],ve.max,ve.min),Ae=D.left||0,Fe=D.right||0,at=D.bottom||0,Re=D.top||0,{left:Qe,right:Ve,top:nt,bottom:Oe}=C.padding,Xe=.5*(Ae+Fe),lt=.5*(Re+at),st=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(Ae+Fe+Qe+Ve))/Me[0],(S.height-(at+Re+Oe+nt))/Me[1])),C.maxZoom),ct=S.scale/S.zoomScale(st);ve=new n.Aabb([ve.min[0]-(Qe+Xe)*ct,ve.min[1]-(Oe+lt)*ct,ve.min[2]],[ve.max[0]+(Ve+Xe)*ct,ve.max[1]+(nt+lt)*ct,ve.max[2]]);const Dt=.5*Me[2],qt=this._minimumAABBFrustumDistance(S,ve),Et=[0,0,1,0];n.transformMat4$1(Et,Et,je),n.normalize$2(Et,Et);const Ft=n.scale$2([],Et,qt+Dt),is=n.add([],ve.center,Ft),es=(typeof C.offset.x=="number"&&typeof C.offset.y=="number"?new n.Point(C.offset.x,C.offset.y):n.Point.convert(C.offset)).rotate(-n.degToRad(f));ve.center[0]-=es.x*ct,ve.center[1]+=es.y*ct,n.transformMat4(ve.center,ve.center,we),n.transformMat4(is,is,we);const Pt=[ve.center[0],ve.center[1],is[2]*S.pixelsPerMeter];n.scale$2(Pt,Pt,1/S.worldSize);const vs=n.lngFromMercatorX(Pt[0]),ws=n.latFromMercatorY(Pt[1]),js=Math.min(S._zoomFromMercatorZ(Pt[2]),C.maxZoom),Ns=new n.LngLat(vs,ws);return S.mercatorFromTransition&&js<.5*(n.GLOBE_ZOOM_THRESHOLD_MIN+n.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=js,this._cameraForBounds(S,o,m,f,_,j)):{center:Ns,zoom:js,bearing:f,pitch:_}}fitBounds(i,o,m){const f=this.cameraForBounds(i,o);return this._fitInternal(f,o,m)}fitScreenCoordinates(i,o,m,f,_){const j=n.Point.convert(i),S=n.Point.convert(o),C=new n.Point(Math.min(j.x,S.x),Math.min(j.y,S.y)),D=new n.Point(Math.max(j.x,S.x),Math.max(j.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(j,S))return this;const I=this.transform.pointLocation3D(C),O=this.transform.pointLocation3D(D),W=this.transform.pointLocation3D(new n.Point(C.x,D.y)),Q=this.transform.pointLocation3D(new n.Point(D.x,C.y)),ee=[Math.min(I.lng,O.lng,W.lng,Q.lng),Math.min(I.lat,O.lat,W.lat,Q.lat)],J=[Math.max(I.lng,O.lng,W.lng,Q.lng),Math.max(I.lat,O.lat,W.lat,Q.lat)],te=f&&f.pitch?f.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,ee,J,m,te,f);return this._fitInternal(F,f,_)}_fitInternal(i,o,m){return i?(delete(o=n.extend(i,o)).padding,o.linear?this.easeTo(o,m):this.flyTo(o,m)):this}jumpTo(i,o){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let f=!1,_=!1,j=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(f=!0,m.zoom=+i.zoom),i.center!==void 0&&(m.center=n.LngLat.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(_=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(j=!0,m.pitch=+i.pitch),i.padding==null||m.isPaddingEqual(i.padding)||(m.padding=i.padding),i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),f&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),_&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),j&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.warnOnce(Yn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const m=this.transform;if(!m.projection.supportsFreeCamera)return n.warnOnce(Yn),this;this.stop();const f=m.zoom,_=m.pitch,j=m.bearing;m.setFreeCameraOptions(i);const S=f!==m.zoom,C=_!==m.pitch,D=j!==m.bearing;return this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),S&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),D&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),C&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=n.extend({offset:[0,0],duration:500,easing:n.ease},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const m=this.transform,f=this.getZoom(),_=this.getBearing(),j=this.getPitch(),S=this.getPadding(),C="zoom"in i?+i.zoom:f,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:j,O="padding"in i?i.padding:m.padding,W=n.Point.convert(i.offset);let Q,ee,J;if(m.projection.name==="globe"){const Ae=n.MercatorCoordinate.fromLngLat(m.center),Fe=W.rotate(-m.angle);Ae.x+=Fe.x/m.worldSize,Ae.y+=Fe.y/m.worldSize;const at=Ae.toLngLat(),Re=n.LngLat.convert(i.center||at);this._normalizeCenter(Re),Q=m.centerPoint.add(Fe),ee=new n.Point(Ae.x,Ae.y).mult(m.worldSize),J=new n.Point(n.mercatorXfromLng(Re.lng),n.mercatorYfromLat(Re.lat)).mult(m.worldSize).sub(ee)}else{Q=m.centerPoint.add(W);const Ae=m.pointLocation(Q),Fe=n.LngLat.convert(i.center||Ae);this._normalizeCenter(Fe),ee=m.project(Ae),J=m.project(Fe).sub(ee)}const te=m.zoomScale(C-f);let F,K;i.around&&(F=n.LngLat.convert(i.around),K=m.locationPoint(F));const ne=this._zooming||C!==f,ce=this._rotating||_!==D,ve=this._pitching||I!==j,je=!m.isPaddingEqual(O),we=Ae=>Fe=>{if(ne&&(Ae.zoom=n.number(f,C,Fe)),ce&&(Ae.bearing=n.number(_,D,Fe)),ve&&(Ae.pitch=n.number(j,I,Fe)),je&&(Ae.interpolatePadding(S,O,Fe),Q=Ae.centerPoint.add(W)),F)Ae.setLocationAtPoint(F,K);else{const at=Ae.zoomScale(Ae.zoom-f),Re=C>f?Math.min(2,te):Math.max(.5,te),Qe=Math.pow(Re,1-Fe),Ve=Ae.unproject(ee.add(J.mult(Fe*Qe)).mult(at));Ae.setLocationAtPoint(Ae.renderWorldCopies?Ve.wrap():Ve,Q)}return i.preloadOnly||this._fireMoveEvents(o),Ae};if(i.preloadOnly){const Ae=this._emulate(we,i.duration,m);return this._preloadTiles(Ae),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ce,this._pitching=ve,this._padding=je,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,Me),this._ease(we(m),Ae=>{m.recenterOnTerrain(),this._afterEase(o,Ae)},i),this}_prepareEase(i,o,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||m.moving||this.fire(new n.Event("movestart",i)),this._zooming&&!m.zooming&&this.fire(new n.Event("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new n.Event("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new n.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new n.Event("move",i)),this._zooming&&this.fire(new n.Event("zoom",i)),this._rotating&&this.fire(new n.Event("rotate",i)),this._pitching&&this.fire(new n.Event("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,f=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new n.Event("zoomend",i)),f&&this.fire(new n.Event("rotateend",i)),_&&this.fire(new n.Event("pitchend",i)),this.fire(new n.Event("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const st=n.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,o)}this.stop(),i=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},i);const m=this.transform,f=this.getZoom(),_=this.getBearing(),j=this.getPitch(),S=this.getPadding(),C="zoom"in i?n.clamp(+i.zoom,m.minZoom,m.maxZoom):f,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:j,O="padding"in i?i.padding:m.padding,W=m.zoomScale(C-f),Q=n.Point.convert(i.offset);let ee=m.centerPoint.add(Q);const J=m.pointLocation(ee),te=n.LngLat.convert(i.center||J);this._normalizeCenter(te);const F=m.project(J),K=m.project(te).sub(F);let ne=i.curve;const ce=Math.max(m.width,m.height),ve=ce/W,je=K.mag();if("minZoom"in i){const st=n.clamp(Math.min(i.minZoom,f,C),m.minZoom,m.maxZoom),ct=ce/m.zoomScale(st-f);ne=Math.sqrt(ct/je*2)}const we=ne*ne;function Me(st){const ct=(ve*ve-ce*ce+(st?-1:1)*we*we*je*je)/(2*(st?ve:ce)*we*je);return Math.log(Math.sqrt(ct*ct+1)-ct)}function Ae(st){return(Math.exp(st)-Math.exp(-st))/2}function Fe(st){return(Math.exp(st)+Math.exp(-st))/2}const at=Me(0);let Re=function(st){return Fe(at)/Fe(at+ne*st)},Qe=function(st){return ce*((Fe(at)*(Ae(ct=at+ne*st)/Fe(ct))-Ae(at))/we)/je;var ct},Ve=(Me(1)-at)/ne;if(Math.abs(je)<1e-6||!isFinite(Ve)){if(Math.abs(ce-ve)<1e-6)return this.easeTo(i,o);const st=ve<ce?-1:1;Ve=Math.abs(Math.log(ve/ce))/ne,Qe=function(){return 0},Re=function(ct){return Math.exp(st*ne*ct)}}i.duration="duration"in i?+i.duration:1e3*Ve/("screenSpeed"in i?+i.screenSpeed/ne:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const nt=_!==D,Oe=I!==j,Xe=!m.isPaddingEqual(O),lt=st=>ct=>{const Dt=ct*Ve,qt=1/Re(Dt);st.zoom=ct===1?C:f+st.scaleZoom(qt),nt&&(st.bearing=n.number(_,D,ct)),Oe&&(st.pitch=n.number(j,I,ct)),Xe&&(st.interpolatePadding(S,O,ct),ee=st.centerPoint.add(Q));const Et=ct===1?te:st.unproject(F.add(K.mult(Qe(Dt))).mult(qt));return st.setLocationAtPoint(st.renderWorldCopies?Et.wrap():Et,ee),st._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),st};if(i.preloadOnly){const st=this._emulate(lt,i.duration,m);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=nt,this._pitching=Oe,this._padding=Xe,this._prepareEase(o,!1),this._ease(lt(m),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,o)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,o,m){m.animate===!1||m.duration===0?(i(1),o()):(this._easeStart=n.exported.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=n.wrap(i,-180,180);const m=Math.abs(i-o);return Math.abs(i-360-o)<m&&(i-=360),Math.abs(i+360-o)<m&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const m=i.lng-o.center.lng;i.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&n.exported.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,m){const f=Math.ceil(15*o/1e3),_=[],j=i(m.clone());for(let S=0;S<=f;S++){const C=j(S/f);_.push(C.clone())}return _}}class St{constructor(i={}){this.options=i,n.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact;return this._map=i,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V("button","mapboxgl-ctrl-attrib-button",this._container),V("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const m=this._map._getUIString(`AttributionControl.${o}`);i.setAttribute("aria-label",m),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.config.ACCESS_TOKEN}];if(i){const m=o.reduce((f,_,j)=>(_.value&&(f+=`${_.key}=${_.value}${j<o.length-1?"&":""}`),f),"?");i.href=`${n.config.FEEDBACK_URL}/${m}#${No(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const o=this._map.style._sourceCaches;for(const f in o){const _=o[f];if(_.used){const j=_.getSource();j.attribution&&i.indexOf(j.attribution)<0&&i.push(j.attribution)}}i.sort((f,_)=>f.length-_.length),i=i.filter((f,_)=>{for(let j=_+1;j<i.length;j++)if(i[j].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yc{constructor(){n.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=V("div","mapboxgl-ctrl");const o=V("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const m=i[o].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class eu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,m=o?this._queue.concat(o):this._queue;for(const f of m)if(f.id===i)return void(f.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const m of o)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ia(u,i,o){if(u=new n.LngLat(u.lng,u.lat),i){const m=new n.LngLat(u.lng-360,u.lat),f=new n.LngLat(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-o.center.lng)/360),j=o.locationPoint(u).distSqr(i),S=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(m).distSqr(i)<j&&(S||Math.abs(m.lng-o.center.lng)<_)?u=m:o.locationPoint(f).distSqr(i)<j&&(S||Math.abs(f.lng-o.center.lng)<_)&&(u=f)}for(;Math.abs(u.lng-o.center.lng)>180;){const m=o.locationPoint(u);if(m.x>=0&&m.y>=0&&m.x<=o.width&&m.y<=o.height)break;u.lng>o.center.lng?u.lng-=360:u.lng+=360}return u}const ea={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class vt extends n.Evented{constructor(i,o){if(super(),(i instanceof n.window.HTMLElement||o)&&(i=n.extend({element:i},o)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=n.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=V("div");const f=41,_=27,j=G("svg",{display:"block",height:f*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${f}`},this._element),S=G("radialGradient",{id:"shadowGradient"},G("defs",{},j));G("stop",{offset:"10%","stop-opacity":.4},S),G("stop",{offset:"100%","stop-opacity":.05},S),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},j),G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},j),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},j),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},j),this._offset=n.Point.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()});const m=this._element.classList;for(const f in ea)m.remove(`mapboxgl-marker-anchor-${f}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=n.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,m=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,m=this._element;this._popup&&(o===m||m.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const m=i.unproject(o),f=i.getFreeCameraOptions();if(!f.position)return!1;const _=f.position.toLngLat();return _.distanceTo(m)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const m=i.unproject(o);let f;i._showingGlobe()&&n.isLngLatBehindGlobe(i.transform,this._lngLat)?f=0:(f=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${ea[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const i=this._pos,o=this._map,m=this.getPitchAlignment();if(!o||!i||m!=="map")return"";if(!o._showingGlobe()){const C=o.getPitch();return C?`rotateX(${C}deg)`:""}const f=n.radToDeg(n.globeTiltAtLngLat(o.transform,this._lngLat)),_=i.sub(n.globeCenterToScreenPoint(o.transform)),j=Math.abs(_.x)+Math.abs(_.y);if(j===0)return"";const S=f/j;return`rotateX(${-_.y*S}deg) rotateY(${_.x*S}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let m=0;const f=this.getRotationAlignment();if(f==="map")if(o._showingGlobe()){const _=o.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),j=o.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);m=n.radToDeg(Math.atan2(j.y,j.x))-90}else m=-o.getBearing();else if(f==="horizon"){const _=n.smoothstep(4,6,o.getZoom()),j=n.globeCenterToScreenPoint(o.transform);j.y+=_*o.transform.height;const S=i.sub(j),C=n.radToDeg(Math.atan2(S.y,S.x));m=(C>90?C-270:C+90)*(1-_)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){n.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Ia(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),i===!0?this._updateFrameId=n.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=n.Point.convert(i),this._update(),this}_onMove(i){const o=this._map;if(!o)return;const m=this._pointerdownPos,f=this._positionDelta;if(m&&f){if(!this._isDragging){const _=this._clickTolerance||o._clickTolerance;if(i.point.dist(m)<_)return;this._isDragging=!0}this._pos=i.point.sub(f),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,m=this._pos;o&&m&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(m),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Fm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qd(u=new n.Point(0,0),i="bottom"){if(typeof u=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(i){case"top":return new n.Point(0,u);case"top-left":return new n.Point(o,o);case"top-right":return new n.Point(-o,o);case"bottom":return new n.Point(0,-u);case"bottom-left":return new n.Point(o,-o);case"bottom-right":return new n.Point(-o,-o);case"left":return new n.Point(u,0);case"right":return new n.Point(-u,0)}return new n.Point(0,0)}return u instanceof n.Point||Array.isArray(u)?n.Point.convert(u):n.Point.convert(u[i]||[0,0])}class su{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=n.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,m){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+m}}const $d={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Gd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Bm={showCompass:!0,showZoom:!0,visualizePitch:!1};class Um{constructor(i,o,m=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Hc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new Xc({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),oe()}move(i,o){const m=this.map,f=this.mouseRotate.mousemoveWindow(i,o),_=f&&f.bearingDelta;if(_&&m.setBearing(m.getBearing()+_),this.mousePitch){const j=this.mousePitch.mousemoveWindow(i,o),S=j&&j.pitchDelta;S&&m.setPitch(m.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){se(),n.window.removeEventListener("mousemove",this.mousemove),n.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(n.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Se(this.element,i)),n.window.addEventListener("mousemove",this.mousemove),n.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Se(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ce(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Ce(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ru={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},iu={maxWidth:100,unit:"metric"},nu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Da={version:n.version,supported:z,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends Al{constructor(u){if(n.LivePerformanceUtils.mark(n.PerformanceMarkers.create),(u=n.extend({},Gd,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&n.isSafariWithAntialiasingBug(n.window)&&(u.antialias=!1,n.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ka(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._useWebGL2=u.useWebGL2,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._optimizeForTerrain=u.optimizeForTerrain,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new eu,this._domRenderTaskQueue=new eu,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.uniqueId(),this._locale=n.extend({},$d,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new su(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new n.RequestManager(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,typeof u.container=="string"){if(this._container=n.window.document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof n.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&n.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),n.window!==void 0&&(n.window.addEventListener("online",this._onWindowOnline,!1),n.window.addEventListener("resize",this._onWindowResize,!1),n.window.addEventListener("orientationchange",this._onWindowResize,!1),n.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new qi(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this._hash=u.hash&&new $c(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,n.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),u.attributionControl&&this.addControl(new St({customAttribution:u.customAttribution})),this._logoControl=new Yc,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new n.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new n.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(u,i){if(i===void 0&&(i=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=u.onAdd(this);this._controls.push(u);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(o,m.firstChild):m.appendChild(o),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(u);return i>-1&&this._controls.splice(i,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new n.Event("movestart",u)).fire(new n.Event("move",u)),this.fire(new n.Event("resize",u)),i&&this.fire(new n.Event("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(n.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?n.window.navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(i=>i==="auto"?n.window.navigator.language:i):u}setLanguage(u){const i=this._parseLanguage(u);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,i=u.projection.name;let o;i==="globe"&&u.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?(u.setMercatorFromTransition(),o=!0):i==="mercator"&&u.zoom<n.GLOBE_ZOOM_THRESHOLD_MAX&&(u.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,i){return this._updateProjection(u||i||{name:"mercator"})}_updateProjection(u){let i;if(i=u.name==="globe"&&this.transform.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(u){return this.transform.locationPoint3D(n.LngLat.convert(u))}unproject(u){return this.transform.pointLocation3D(n.Point.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,i,o){if(u==="mouseenter"||u==="mouseover"){let m=!1;const f=j=>{const S=i.filter(D=>this.getLayer(D)),C=S.length?this.queryRenderedFeatures(j.point,{layers:S}):[];C.length?m||(m=!0,o.call(this,new Sr(u,this,j.originalEvent,{features:C}))):m=!1},_=()=>{m=!1};return{layers:new Set(i),listener:o,delegates:{mousemove:f,mouseout:_}}}if(u==="mouseleave"||u==="mouseout"){let m=!1;const f=j=>{const S=i.filter(C=>this.getLayer(C));(S.length?this.queryRenderedFeatures(j.point,{layers:S}):[]).length?m=!0:m&&(m=!1,o.call(this,new Sr(u,this,j.originalEvent)))},_=j=>{m&&(m=!1,o.call(this,new Sr(u,this,j.originalEvent)))};return{layers:new Set(i),listener:o,delegates:{mousemove:f,mouseout:_}}}{const m=f=>{const _=i.filter(S=>this.getLayer(S)),j=_.length?this.queryRenderedFeatures(f.point,{layers:_}):[];j.length&&(f.features=j,o.call(this,f),delete f.features)};return{layers:new Set(i),listener:o,delegates:{[u]:m}}}}on(u,i,o){if(o===void 0)return super.on(u,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(u,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(m);for(const f in m.delegates)this.on(f,m.delegates[f]);return this}once(u,i,o){if(o===void 0)return super.once(u,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(u,i,o);for(const f in m.delegates)this.once(f,m.delegates[f]);return this}off(u,i,o){if(o===void 0)return super.off(u,i);i=new Set(Array.isArray(i)?i:[i]);const m=(_,j)=>{if(_.size!==j.size)return!1;for(const S of _)if(!j.has(S))return!1;return!0},f=this._delegatedListeners?this._delegatedListeners[u]:void 0;return f&&(_=>{for(let j=0;j<_.length;j++){const S=_[j];if(S.listener===o&&m(S.layers,i)){for(const C in S.delegates)this.off(C,S.delegates[C]);return _.splice(j,1),this}}})(f),this}queryRenderedFeatures(u,i){return this.style?(i!==void 0||u===void 0||u instanceof n.Point||Array.isArray(u)||(i=u,u=void 0),this.style.queryRenderedFeatures(u=u||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(u,i){return this.style.querySourceFeatures(u,i)}isPointOnSurface(u){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&n.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.Point.convert(u))}setStyle(u,i){return(i=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(u,i))}_getUIString(u){const i=this._locale[u];if(i==null)throw new Error(`Missing UI string '${u}'`);return i}_updateStyle(u,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new Ui(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ui(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,i){if(typeof u=="string"){const o=this._requestManager.normalizeStyleURL(u),m=this._requestManager.transformRequest(o,n.ResourceType.Style);n.getJSON(m,(f,_)=>{f?this.fire(new n.ErrorEvent(f)):_&&this._updateDiff(_,i)})}else typeof u=="object"&&this._updateDiff(u,i)}_updateDiff(u,i){try{this.style.setState(u)&&this._update(!0)}catch(o){n.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(u,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.warnOnce("There is no style added to the map."),!1)}addSource(u,i){return this._lazyInitEmptyStyle(),this.style.addSource(u,i),this._update(!0)}isSourceLoaded(u){return!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){const u=this.style&&this.style._sourceCaches;for(const i in u){const o=u[i]._tiles;for(const m in o){const f=o[m];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}addSourceType(u,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(u,i,o)}removeSource(u){return this.style.removeSource(u),this._updateTerrain(),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,i,{pixelRatio:o=1,sdf:m=!1,stretchX:f,stretchY:_,content:j}={}){if(this._lazyInitEmptyStyle(),i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap){const{width:S,height:C,data:D}=n.exported.getImageData(i);this.style.addImage(u,{data:new n.RGBAImage({width:S,height:C},D),pixelRatio:o,stretchX:f,stretchY:_,content:j,sdf:m,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:C}=i,D=i;this.style.addImage(u,{data:new n.RGBAImage({width:S,height:C},new Uint8Array(D.data)),pixelRatio:o,stretchX:f,stretchY:_,content:j,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,u)}}updateImage(u,i){const o=this.style.getImage(u);if(!o)return void this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap?n.exported.getImageData(i):i,{width:f,height:_}=m;f!==void 0&&_!==void 0?f===o.data.width&&_===o.data.height?(o.data.replace(m.data,!(i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap)),this.style.updateImage(u,o)):this.fire(new n.ErrorEvent(new Error(`The width and height of the updated image (${f}, ${_})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`))):this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,i){n.getImage(this._requestManager.transformRequest(u,n.ResourceType.Image),(o,m)=>{i(o,m instanceof n.window.HTMLImageElement?n.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(u,i){return this._lazyInitEmptyStyle(),this.style.addLayer(u,i),this._update(!0)}moveLayer(u,i){return this.style.moveLayer(u,i),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,i,o){return this.style.setLayerZoomRange(u,i,o),this._update(!0)}setFilter(u,i,o={}){return this.style.setFilter(u,i,o),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,i,o,m={}){return this.style.setPaintProperty(u,i,o,m),this._update(!0)}getPaintProperty(u,i){return this.style.getPaintProperty(u,i)}setLayoutProperty(u,i,o,m={}){return this.style.setLayoutProperty(u,i,o,m),this._update(!0)}getLayoutProperty(u,i){return this.style.getLayoutProperty(u,i)}setLight(u,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.LngLat.convert(u),this.transform):0}setFeatureState(u,i){return this.style.setFeatureState(u,i),this._update()}removeFeatureState(u,i){return this.style.removeFeatureState(u,i),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,m,f,_=this._container;for(;_&&(!m||!f);){const j=n.window.getComputedStyle(_).transform;j&&j!=="none"&&(o=j.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(m=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(f=o[3])),_=_.parentElement}this._containerWidth=m?Math.abs(u/m):u,this._containerHeight=f?Math.abs(i/f):i}_detectMissingCSS(){n.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=V("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=V("div","mapboxgl-canvas-container",u);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=V("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=V("div","mapboxgl-control-container",u),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{m[f]=V("div",`mapboxgl-ctrl-${f}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,i){const o=n.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(u),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${i}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const i=this._markers.indexOf(u);i!==-1&&this._markers.splice(i,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const i=this._popups.indexOf(u);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const u=n.extend({},z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._useWebGL2&&this._canvas.getContext("webgl2",u),o=i||this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);o?(this._useWebGL2&&!i&&n.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),n.storeAuthState(o,!0),this.painter=new Ea(o,this.transform,!!i),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.exported$1.testSupport(o)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let i;const o=this.painter.context.extTimerQuery,m=n.exported.now();if(this.listens("gpu-timing-frame")&&(i=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],n.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],n.window.performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const f=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,C=this.transform.pitch,D=n.exported.now(),I=new n.EvaluationParameters(S,{now:D,fadeDuration:f,pitch:C,transition:this.style.getTransition()});this.style.update(I)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,f,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new n.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const S=n.exported.now()-m;o.endQueryEXT(o.TIME_ELAPSED_EXT,i),setTimeout(()=>{const C=o.getQueryObjectEXT(i,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(i),this.fire(new n.Event("gpu-timing-frame",{cpuTime:S,gpuTime:C})),n.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:C}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const C=this.painter.queryGpuTimers(S);this.fire(new n.Event("gpu-timing-layer",{layerTimes:C}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const C=this.painter.queryGpuTimeDeferredRender(S);this.fire(new n.Event("gpu-timing-deferred-render",{gpuTime:C}))},50)}const j=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(j||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(_=this._updateAverageElevation(m,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new n.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const C=this._calculateSpeedIndex();this.fire(new n.Event("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,n.LivePerformanceUtils.mark(n.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&n.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const i of this._markers)u&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!u||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(u,i=!1){const o=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((i||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const m=this.transform.averageElevation;let f=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(f)?f=0:this._averageElevationLastSampledAt=u;const j=Math.abs(m-f);if(j>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(f),o(f);this._averageElevation.easeTo(f,u,300)}else if(j>1e-4)return this._averageElevation.jumpTo(f),o(f)}return!!this._averageElevation.isEasing(u)&&o(this._averageElevation.getValue(u))}_authenticate(){n.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===n.AUTH_ERR_MSG||u.status===401)){const i=this.painter.context.gl;n.storeAuthState(i,!1),this._logoControl instanceof Yc&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),n.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,m=o.createFramebuffer();function f(_){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,_,0);const j=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,j),j}return o.bindFramebuffer(o.FRAMEBUFFER,m),this._canvasPixelComparison(f(u),i.canvasCopies.map(f),i.timeStamps)}_canvasPixelComparison(u,i,o){let m=o[1]-o[0];const f=u.length/4;for(let _=0;_<i.length;_++){const j=i[_];let S=0;for(let C=0;C<j.length;C+=4)j[C]===u[C]&&j[C+1]===u[C+1]&&j[C+2]===u[C+2]&&j[C+3]===u[C+3]&&(S+=1);m+=(o[_+2]-o[_+1])*(1-S/f)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),n.window!==void 0&&(n.window.removeEventListener("resize",this._onWindowResize,!1),n.window.removeEventListener("orientationchange",this._onWindowResize,!1),n.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.removeEventListener("online",this._onWindowOnline,!1),n.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),n.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=n.exported.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(u){const i=this.style?Object.values(this.style._sourceCaches):[];return n.asyncAll(i,(o,m)=>o._preloadTiles(u,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){n.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,i){n.setCacheLimits(u,i)}get version(){return n.version}},NavigationControl:class{constructor(u){this.options=n.extend({},Bm,u),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),V("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),V("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=V("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const i=u.getZoom(),o=i===u.getMaxZoom(),m=i===u.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Um(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,i){const o=V("button",u,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(u,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);u.setAttribute("aria-label",o),u.firstElementChild&&u.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.Evented{constructor(u){super(),this.options=n.extend({geolocation:n.window.navigator.geolocation},ru,u),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Aa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,u(o)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):n.window.navigator.permissions!==void 0?n.window.navigator.permissions.query({name:"geolocation"}).then(o=>i(o.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(u){const i=this._map.getMaxBounds(),o=u.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("geolocate",u)),this._finish()}}_updateCamera(u){const i=new n.LngLat(u.coords.longitude,u.coords.latitude),o=u.coords.accuracy,m=this._map.getBearing(),f=n.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),f,{geolocateSource:!0})}_updateMarker(u){if(u){const i=new n.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,i=n.mercatorZfromAltitude(1,u._center.lat)*u.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=V("button","mapboxgl-ctrl-geolocate",this._container),V("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V("div","mapboxgl-user-location"),this._dotElement.appendChild(V("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(V("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new vt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=V("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{n.window.addEventListener("ondeviceorientationabsolute"in n.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};n.window.DeviceMotionEvent!==void 0&&typeof n.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),n.window.removeEventListener("deviceorientation",this._onDeviceOrientation),n.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:St,ScaleControl:class{constructor(u){this.options=n.extend({},iu,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,m=i._containerWidth/2-u/2,f=i.unproject([m,o]),_=i.unproject([m+u,o]),j=f.distanceTo(_);if(this.options.unit==="imperial"){const S=3.2808*j;S>5280?this._setScale(u,S/5280,"mile"):this._setScale(u,S,"foot")}else this.options.unit==="nautical"?this._setScale(u,j/1852,"nautical-mile"):j>=1e3?this._setScale(u,j/1e3,"kilometer"):this._setScale(u,j,"meter")}_setScale(u,i,o){this._map._requestDomTask(()=>{const m=function(_){const j=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/j;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const D=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*D)/D}(S),j*S}(i),f=m/i;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(m):`${m}&nbsp;${nu[o]}`,this._container.style.width=u*f+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof n.window.HTMLElement?this._container=u.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in n.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in n.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,n.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!n.window.document.fullscreenEnabled&&!n.window.document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=V("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),n.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(n.window.document.fullscreenElement||n.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?n.window.document.exitFullscreen?n.window.document.exitFullscreen():n.window.document.webkitCancelFullScreen&&n.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.Evented{constructor(u){super(),this.options=n.extend(Object.create(tu),u),n.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=n.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(n.window.document.createTextNode(u))}setHTML(u){const i=n.window.document.createDocumentFragment(),o=n.window.document.createElement("body");let m;for(o.innerHTML=u;m=o.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=V("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(u),this.options.closeButton){const o=this._closeButton=V("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let i;return this._classList.delete(u)?i=!1:(this._classList.add(u),i=!0),this._updateClassList(),i}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,m=this._pos;if(!i||!o||!m)return"bottom";const f=o.offsetWidth,_=o.offsetHeight,j=m.x<f/2,S=m.x>i.transform.width-f/2;if(m.y+u<_)return j?"top-left":S?"top-right":"top";if(m.y>i.transform.height-_){if(j)return"bottom-left";if(S)return"bottom-right"}return j?"left":S?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),u.className=i.join(" ")}_update(u){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let m=this._container;if(m||(m=this._container=V("div","mapboxgl-popup",i.getContainer()),this._tip=V("div","mapboxgl-popup-tip",m),m.appendChild(o)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ia(this._lngLat,this._pos,i.transform)),!this._trackPointer||u){const f=this._pos=this._trackPointer&&u?u:i.project(this._lngLat),_=qd(this.options.offset),j=this._anchor=this._getAnchor(_.y),S=qd(this.options.offset,j),C=f.add(S).round();i._requestDomTask(()=>{this._container&&j&&(this._container.style.transform=`${ea[j]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&i._showingGlobe()){const f=n.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Fm);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:vt,Style:Ui,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.Point,MercatorCoordinate:n.MercatorCoordinate,FreeCameraOptions:Cd,Evented:n.Evented,config:n.config,prewarm:function(){ga().acquire(Oi)},clearPrewarmedResources:function(){const u=Gr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Oi),Gr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return n.config.ACCESS_TOKEN},set accessToken(u){n.config.ACCESS_TOKEN=u},get baseApiUrl(){return n.config.API_URL},set baseApiUrl(u){n.config.API_URL=u},get workerCount(){return jr.workerCount},set workerCount(u){jr.workerCount=u},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){n.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){n.clearTileCache(u)},workerUrl:"",workerClass:null,setNow:n.exported.setNow,restoreNow:n.exported.restoreNow};return Da});var k=N;return k})})(nb);var yE=nb.exports;const hi=g1(yE);async function ob(c,d){var g,x;if(!c||c.trim().length<3)return d(!1),[];d(!0);try{const v=await Mr.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(c)}.json`,{params:{access_token:void 0,autocomplete:"true",language:"en",limit:5}});return(x=(g=v==null?void 0:v.data)==null?void 0:g.features)==null?void 0:x.map(N=>{const E=N.context||[],k=M=>E.find(z=>z.id.startsWith(M))||{};let n=k("country").short_code||"";return n=n?n.toUpperCase():"",{display_name:N.place_name,address_line1:N.text||"",address_line2:"",city:k("place").text||"",state:k("region").text||"",postal_code:k("postcode").text||"",country:n,lat:N.geometry.coordinates[1],lng:N.geometry.coordinates[0]}})}finally{d(!1)}}const _E=[{code:"AF",name:"Afghanistan",flag:""},{code:"AL",name:"Albania",flag:""},{code:"DZ",name:"Algeria",flag:""},{code:"AD",name:"Andorra",flag:""},{code:"AO",name:"Angola",flag:""},{code:"AG",name:"Antigua and Barbuda",flag:""},{code:"AR",name:"Argentina",flag:""},{code:"AM",name:"Armenia",flag:""},{code:"AU",name:"Australia",flag:""},{code:"AT",name:"Austria",flag:""},{code:"AZ",name:"Azerbaijan",flag:""},{code:"BS",name:"Bahamas",flag:""},{code:"BH",name:"Bahrain",flag:""},{code:"BD",name:"Bangladesh",flag:""},{code:"BB",name:"Barbados",flag:""},{code:"BY",name:"Belarus",flag:""},{code:"BE",name:"Belgium",flag:""},{code:"BZ",name:"Belize",flag:""},{code:"BJ",name:"Benin",flag:""},{code:"BT",name:"Bhutan",flag:""},{code:"BO",name:"Bolivia",flag:""},{code:"BA",name:"Bosnia and Herzegovina",flag:""},{code:"BW",name:"Botswana",flag:""},{code:"BR",name:"Brazil",flag:""},{code:"BN",name:"Brunei",flag:""},{code:"BG",name:"Bulgaria",flag:""},{code:"BF",name:"Burkina Faso",flag:""},{code:"BI",name:"Burundi",flag:""},{code:"CV",name:"Cabo Verde",flag:""},{code:"KH",name:"Cambodia",flag:""},{code:"CM",name:"Cameroon",flag:""},{code:"CA",name:"Canada",flag:""},{code:"CF",name:"Central African Republic",flag:""},{code:"TD",name:"Chad",flag:""},{code:"CL",name:"Chile",flag:""},{code:"CN",name:"China",flag:""},{code:"CO",name:"Colombia",flag:""},{code:"KM",name:"Comoros",flag:""},{code:"CG",name:"Congo",flag:""},{code:"CD",name:"Congo (Democratic Republic)",flag:""},{code:"CR",name:"Costa Rica",flag:""},{code:"CI",name:"Cte d'Ivoire",flag:""},{code:"HR",name:"Croatia",flag:""},{code:"CU",name:"Cuba",flag:""},{code:"CY",name:"Cyprus",flag:""},{code:"CZ",name:"Czech Republic",flag:""},{code:"DK",name:"Denmark",flag:""},{code:"DJ",name:"Djibouti",flag:""},{code:"DM",name:"Dominica",flag:""},{code:"DO",name:"Dominican Republic",flag:""},{code:"EC",name:"Ecuador",flag:""},{code:"EG",name:"Egypt",flag:""},{code:"SV",name:"El Salvador",flag:""},{code:"GQ",name:"Equatorial Guinea",flag:""},{code:"ER",name:"Eritrea",flag:""},{code:"EE",name:"Estonia",flag:""},{code:"SZ",name:"Eswatini",flag:""},{code:"ET",name:"Ethiopia",flag:""},{code:"FJ",name:"Fiji",flag:""},{code:"FI",name:"Finland",flag:""},{code:"FR",name:"France",flag:""},{code:"GA",name:"Gabon",flag:""},{code:"GM",name:"Gambia",flag:""},{code:"GE",name:"Georgia",flag:""},{code:"DE",name:"Germany",flag:""},{code:"GH",name:"Ghana",flag:""},{code:"GR",name:"Greece",flag:""},{code:"GD",name:"Grenada",flag:""},{code:"GT",name:"Guatemala",flag:""},{code:"GN",name:"Guinea",flag:""},{code:"GW",name:"Guinea-Bissau",flag:""},{code:"GY",name:"Guyana",flag:""},{code:"HT",name:"Haiti",flag:""},{code:"HN",name:"Honduras",flag:""},{code:"HU",name:"Hungary",flag:""},{code:"IS",name:"Iceland",flag:""},{code:"IN",name:"India",flag:""},{code:"ID",name:"Indonesia",flag:""},{code:"IR",name:"Iran",flag:""},{code:"IQ",name:"Iraq",flag:""},{code:"IE",name:"Ireland",flag:""},{code:"IL",name:"Israel",flag:""},{code:"IT",name:"Italy",flag:""},{code:"JM",name:"Jamaica",flag:""},{code:"JP",name:"Japan",flag:""},{code:"JO",name:"Jordan",flag:""},{code:"KZ",name:"Kazakhstan",flag:""},{code:"KE",name:"Kenya",flag:""},{code:"KI",name:"Kiribati",flag:""},{code:"KP",name:"Korea (North)",flag:""},{code:"KR",name:"Korea (South)",flag:""},{code:"KW",name:"Kuwait",flag:""},{code:"KG",name:"Kyrgyzstan",flag:""},{code:"LA",name:"Laos",flag:""},{code:"LV",name:"Latvia",flag:""},{code:"LB",name:"Lebanon",flag:""},{code:"LS",name:"Lesotho",flag:""},{code:"LR",name:"Liberia",flag:""},{code:"LY",name:"Libya",flag:""},{code:"LI",name:"Liechtenstein",flag:""},{code:"LT",name:"Lithuania",flag:""},{code:"LU",name:"Luxembourg",flag:""},{code:"MG",name:"Madagascar",flag:""},{code:"MW",name:"Malawi",flag:""},{code:"MY",name:"Malaysia",flag:""},{code:"MV",name:"Maldives",flag:""},{code:"ML",name:"Mali",flag:""},{code:"MT",name:"Malta",flag:""},{code:"MH",name:"Marshall Islands",flag:""},{code:"MR",name:"Mauritania",flag:""},{code:"MU",name:"Mauritius",flag:""},{code:"MX",name:"Mexico",flag:""},{code:"FM",name:"Micronesia",flag:""},{code:"MD",name:"Moldova",flag:""},{code:"MC",name:"Monaco",flag:""},{code:"MN",name:"Mongolia",flag:""},{code:"ME",name:"Montenegro",flag:""},{code:"MA",name:"Morocco",flag:""},{code:"MZ",name:"Mozambique",flag:""},{code:"MM",name:"Myanmar",flag:""},{code:"NA",name:"Namibia",flag:""},{code:"NR",name:"Nauru",flag:""},{code:"NP",name:"Nepal",flag:""},{code:"NL",name:"Netherlands",flag:""},{code:"NZ",name:"New Zealand",flag:""},{code:"NI",name:"Nicaragua",flag:""},{code:"NE",name:"Niger",flag:""},{code:"NG",name:"Nigeria",flag:""},{code:"MK",name:"North Macedonia",flag:""},{code:"NO",name:"Norway",flag:""},{code:"OM",name:"Oman",flag:""},{code:"PK",name:"Pakistan",flag:""},{code:"PW",name:"Palau",flag:""},{code:"PA",name:"Panama",flag:""},{code:"PG",name:"Papua New Guinea",flag:""},{code:"PY",name:"Paraguay",flag:""},{code:"PE",name:"Peru",flag:""},{code:"PH",name:"Philippines",flag:""},{code:"PL",name:"Poland",flag:""},{code:"PT",name:"Portugal",flag:""},{code:"QA",name:"Qatar",flag:""},{code:"RO",name:"Romania",flag:""},{code:"RU",name:"Russia",flag:""},{code:"RW",name:"Rwanda",flag:""},{code:"KN",name:"Saint Kitts and Nevis",flag:""},{code:"LC",name:"Saint Lucia",flag:""},{code:"VC",name:"Saint Vincent and the Grenadines",flag:""},{code:"WS",name:"Samoa",flag:""},{code:"SM",name:"San Marino",flag:""},{code:"ST",name:"So Tom and Prncipe",flag:""},{code:"SA",name:"Saudi Arabia",flag:""},{code:"SN",name:"Senegal",flag:""},{code:"RS",name:"Serbia",flag:""},{code:"SC",name:"Seychelles",flag:""},{code:"SL",name:"Sierra Leone",flag:""},{code:"SG",name:"Singapore",flag:""},{code:"SK",name:"Slovakia",flag:""},{code:"SI",name:"Slovenia",flag:""},{code:"SB",name:"Solomon Islands",flag:""},{code:"SO",name:"Somalia",flag:""},{code:"ZA",name:"South Africa",flag:""},{code:"SS",name:"South Sudan",flag:""},{code:"ES",name:"Spain",flag:""},{code:"LK",name:"Sri Lanka",flag:""},{code:"SD",name:"Sudan",flag:""},{code:"SR",name:"Suriname",flag:""},{code:"SE",name:"Sweden",flag:""},{code:"CH",name:"Switzerland",flag:""},{code:"SY",name:"Syria",flag:""},{code:"TJ",name:"Tajikistan",flag:""},{code:"TZ",name:"Tanzania",flag:""},{code:"TH",name:"Thailand",flag:""},{code:"TL",name:"Timor-Leste",flag:""},{code:"TG",name:"Togo",flag:""},{code:"TO",name:"Tonga",flag:""},{code:"TT",name:"Trinidad and Tobago",flag:""},{code:"TN",name:"Tunisia",flag:""},{code:"TR",name:"Turkey",flag:""},{code:"TM",name:"Turkmenistan",flag:""},{code:"TV",name:"Tuvalu",flag:""},{code:"UG",name:"Uganda",flag:""},{code:"UA",name:"Ukraine",flag:""},{code:"AE",name:"United Arab Emirates",flag:""},{code:"GB",name:"United Kingdom",flag:""},{code:"US",name:"United States",flag:""},{code:"UY",name:"Uruguay",flag:""},{code:"UZ",name:"Uzbekistan",flag:""},{code:"VU",name:"Vanuatu",flag:""},{code:"VA",name:"Vatican City",flag:""},{code:"VE",name:"Venezuela",flag:""},{code:"VN",name:"Vietnam",flag:""},{code:"YE",name:"Yemen",flag:""},{code:"ZM",name:"Zambia",flag:""},{code:"ZW",name:"Zimbabwe",flag:""}],lb=()=>_E.map(c=>({value:c.code,label:`${c.flag} ${c.name}`,name:c.name,flag:c.flag})),cb=c=>[c.line1,c.line2,c.city,c.state,c.postal_code].filter(Boolean).join(", "),bE=c=>{const d=c.label||`Address #${c.id.slice(-4)}`,g=cb(c);return`${d} - ${g}`},vE=(c,d)=>{if(!c||!d)return"";const g=x=>{const[v,N]=x.split(":"),E=parseInt(v,10),k=E>=12?"PM":"AM";return`${E===0?12:E>12?E-12:E}:${N} ${k}`};return`${g(c)} - ${g(d)}`},Kh=(c,d)=>{if(!c||!d)return!0;const g=new Date(`1970-01-01T${c}`),x=new Date(`1970-01-01T${d}`);return g<x},wE=async c=>{try{const d=[c.line1,c.line2,c.city,c.state,c.postal_code].filter(Boolean).join(", "),x=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d)}&limit=1`)).json();return x&&x.length>0?{latitude:parseFloat(x[0].lat),longitude:parseFloat(x[0].lon)}:null}catch(d){return console.error("Geocoding error:",d),null}},ub=({isOpen:c,onClose:d,onSubmit:g,customer:x,loading:v=!1,title:N})=>{const{register:E,handleSubmit:k,reset:n,formState:{errors:M},setValue:z,watch:q}=Tn({defaultValues:{name:"",external_id:"",tax_id:"",phone:"",email:"",account_status:"active",credit_terms_days:30}}),[U,V]=le.useState(""),[G,H]=le.useState(!1),[Y,ge]=le.useState(null),[oe,se]=le.useState([]),de=le.useRef(null),[ae,Se]=le.useState(null),[Ce,fe]=le.useState(null),[Ie,ke]=le.useState(!1),et=q("latitude"),Pe=q("longitude"),Ne=q("delivery_window_start"),it=q("delivery_window_end");le.useEffect(()=>{var tt,Mt,Tt,At,zs,ts,Vt,sr,bs,fr,$r,gr,_r;if(x){if(n({name:x.name,external_id:x.external_id||"",tax_id:x.tax_id||"",phone:x.phone||"",email:x.email||"",account_status:x.account_status,credit_terms_days:x.credit_terms_days,address_label:((tt=x.primary_address)==null?void 0:tt.label)||"",line1:((Mt=x.primary_address)==null?void 0:Mt.line1)||"",line2:((Tt=x.primary_address)==null?void 0:Tt.line2)||"",city:((At=x.primary_address)==null?void 0:At.city)||"",state:((zs=x.primary_address)==null?void 0:zs.state)||"",postal_code:((ts=x.primary_address)==null?void 0:ts.postal_code)||"",country:((Vt=x.primary_address)==null?void 0:Vt.country)||"US",delivery_window_start:((sr=x.primary_address)==null?void 0:sr.delivery_window_start)||"",delivery_window_end:((bs=x.primary_address)==null?void 0:bs.delivery_window_end)||"",is_primary:((fr=x.primary_address)==null?void 0:fr.is_primary)||!0,instructions:(($r=x.primary_address)==null?void 0:$r.instructions)||"",latitude:(gr=x.primary_address)==null?void 0:gr.latitude,longitude:(_r=x.primary_address)==null?void 0:_r.longitude}),x.primary_address){const Xr=[x.primary_address.line1,x.primary_address.line2,x.primary_address.city,x.primary_address.state,x.primary_address.postal_code].filter(Boolean);V(Xr.join(", "))}}else n({name:"",external_id:"",tax_id:"",phone:"",email:"",account_status:"active",credit_terms_days:30,address_label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:!0,instructions:"",latitude:void 0,longitude:void 0}),V("")},[x,n]),le.useEffect(()=>{let tt=!0;return U&&U.length>=3?(H(!0),ob(U,H).then(Mt=>{tt&&se(Mt||[])})):(se([]),H(!1)),()=>{tt=!1}},[U]),le.useEffect(()=>{if(!ae&&de.current&&et&&Pe){hi.accessToken=void 0;const tt=new hi.Map({container:de.current,style:"mapbox://styles/mapbox/streets-v11",center:[Pe,et],zoom:14});tt.addControl(new hi.NavigationControl,"top-right"),Se(tt);const Mt=new hi.Marker({anchor:"center",draggable:Ie}).setLngLat([Pe,et]).addTo(tt);fe(Mt),Mt.on("dragend",()=>{const Tt=Mt.getLngLat();z("latitude",Tt.lat),z("longitude",Tt.lng)}),tt.on("load",()=>{tt.resize()})}},[de,et,Pe]),le.useEffect(()=>{ae&&Ce&&et&&Pe&&(Ce.setLngLat([Pe,et]),Ce.setDraggable(Ie),ae.setCenter([Pe,et]),ae.setZoom(14),ae.resize())},[et,Pe,Ie,ae,Ce]),le.useEffect(()=>()=>{Ce&&Ce.remove(),ae&&ae.remove()},[]);const ft=tt=>{if(tt.delivery_window_start&&tt.delivery_window_end&&!Kh(tt.delivery_window_start,tt.delivery_window_end))return;const{address_label:Mt,line1:Tt,line2:At,city:zs,state:ts,postal_code:Vt,country:sr,delivery_window_start:bs,delivery_window_end:fr,is_primary:$r,instructions:gr,latitude:_r,longitude:Xr,...Rr}=tt;g({...Rr,address:{label:Mt,line1:Tt,line2:At,city:zs,state:ts,postal_code:Vt,country:sr,delivery_window_start:bs||void 0,delivery_window_end:fr||void 0,is_primary:$r,instructions:gr,latitude:_r,longitude:Xr}})};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:k(ft),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Business Name *"}),t.jsx("input",{type:"text",id:"name",...E("name",{required:"Business name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),M.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"external_id",className:"block text-sm font-medium text-gray-700",children:"External ID"}),t.jsx("input",{type:"text",id:"external_id",...E("external_id"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"QuickBooks ID"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tax_id",className:"block text-sm font-medium text-gray-700",children:"Tax ID (VAT/EIN)"}),t.jsx("input",{type:"text",id:"tax_id",...E("tax_id"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone"}),t.jsx("input",{type:"tel",id:"phone",...E("phone"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),t.jsx("input",{type:"email",id:"email",...E("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),M.email&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.email.message})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"account_status",className:"block text-sm font-medium text-gray-700",children:"Account Status"}),t.jsxs("select",{id:"account_status",...E("account_status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"credit_terms_days",className:"block text-sm font-medium text-gray-700",children:"Credit Terms (Days)"}),t.jsx("input",{type:"number",id:"credit_terms_days",min:"0",...E("credit_terms_days",{required:"Credit terms is required",min:{value:0,message:"Credit terms must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),M.credit_terms_days&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.credit_terms_days.message})]})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200 mt-4",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Address"}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"address_autosuggest",className:"block text-sm font-medium text-gray-700",children:"Address *"}),t.jsx("input",{type:"text",id:"address_autosuggest",value:U,onChange:tt=>{V(tt.target.value),ge(null)},className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",autoComplete:"off",placeholder:"Start typing address..."}),G&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Searching..."}),oe.length>0&&!Y&&t.jsx("ul",{className:"border border-gray-200 rounded bg-white mt-1 max-h-48 overflow-y-auto z-10 relative",children:oe.map((tt,Mt)=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-50",onClick:()=>{ge(tt),V(tt.display_name),z("line1",tt.address_line1||""),z("line2",tt.address_line2||""),z("city",tt.city||""),z("state",tt.state||""),z("postal_code",tt.postal_code||""),z("country",tt.country||""),z("latitude",tt.lat),z("longitude",tt.lng)},children:tt.display_name},Mt))}),Y&&t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Address selected"})]})]}),et&&Pe&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{ref:de,style:{width:"100%",height:200,borderRadius:8,overflow:"hidden",position:"relative"}}),t.jsx("div",{className:"flex justify-end mt-2",children:Ie?t.jsx("button",{type:"button",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",onClick:()=>ke(!1),children:"Save Pin Location"}):t.jsx("button",{type:"button",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs",onClick:()=>ke(!0),children:"Adjust Pin"})})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200 mt-4",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Delivery Preferences"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_start",className:"block text-sm font-medium text-gray-700",children:"Delivery Window Start"}),t.jsx("input",{type:"time",id:"delivery_window_start",...E("delivery_window_start"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_end",className:"block text-sm font-medium text-gray-700",children:"Delivery Window End"}),t.jsx("input",{type:"time",id:"delivery_window_end",...E("delivery_window_end"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),Ne&&it&&!Kh(Ne,it)&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:"End time must be after start time"})]})]})]}),t.jsx("div",{className:"pt-4 border-t border-gray-200 mt-4",children:t.jsxs("div",{children:[t.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-gray-700",children:"Delivery Instructions"}),t.jsx("textarea",{id:"instructions",rows:3,...E("instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate codes, special access requirements, loading dock information..."})]})})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:v,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:v?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Customer"}),t.jsx("button",{type:"button",onClick:d,disabled:v,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},ro=({isOpen:c,onClose:d,onConfirm:g,title:x,message:v,confirmText:N="Confirm",cancelText:E="Cancel",type:k="danger",loading:n=!1})=>{if(!c)return null;const z=(()=>{switch(k){case"danger":return{icon:"text-red-600",button:"bg-red-600 hover:bg-red-700 focus:ring-red-500"};case"warning":return{icon:"text-yellow-600",button:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"};default:return{icon:"text-blue-600",button:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}}})();return t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsx("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:t.jsxs("div",{className:"sm:flex sm:items-start",children:[t.jsx("div",{className:`mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full ${k==="danger"?"bg-red-100":k==="warning"?"bg-yellow-100":"bg-blue-100"} sm:mx-0 sm:h-10 sm:w-10`,children:t.jsx($s,{className:`h-6 w-6 ${z.icon}`})}),t.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[t.jsx("h3",{className:"text-base font-semibold leading-6 text-gray-900",children:x}),t.jsx("div",{className:"mt-2",children:t.jsx("p",{className:"text-sm text-gray-500",children:v})})]})]})}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"button",onClick:g,disabled:n,className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto ${z.button} disabled:opacity-50 disabled:cursor-not-allowed`,children:n?"Processing...":N}),t.jsx("button",{type:"button",onClick:d,disabled:n,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:E})]})]})]})})},jE=()=>{const c=Hr(),[d,g]=le.useState({page:1}),[x,v]=le.useState(!1),[N,E]=le.useState(null),{data:k,isLoading:n,error:M,refetch:z}=S_(d),q=yS(),U=T_(),V=_S();le.useEffect(()=>{console.log("CustomersPage state:",{filters:d,data:k,isLoading:n,error:M,isFormOpen:x})},[d,k,n,M,x]);const G=()=>{console.log("Adding new customer"),v(!0)},H=Se=>{console.log("Viewing customer:",Se),c(`/customers/${Se.id}`)},Y=async Se=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await V(Se.id),E(null)}catch(Ce){console.error("Error deleting customer:",Ce),alert("Failed to delete customer. Please try again.")}},ge=async(Se,Ce)=>{try{await U.mutateAsync({id:Se.id,account_status:Ce})}catch(fe){console.error("Error updating customer status:",fe)}},oe=async Se=>{console.log("Form submit:",Se);try{await q.mutateAsync(Se),v(!1)}catch(Ce){console.error("Form submit error:",Ce)}},se=async()=>{if(N){console.log("Confirming delete:",N);try{await V.mutateAsync(N.id),E(null)}catch(Se){console.error("Delete error:",Se)}}},de=Se=>{console.log("Page change:",Se),g(Ce=>({...Ce,page:Se}))},ae=()=>{console.log("Refreshing customers"),z()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),t.jsx("p",{className:"text-gray-600",children:"Manage your customer database"}),M&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",M.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:ae,disabled:n,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(tl,{className:`h-4 w-4 ${n?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:G,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Customer"})]})]})]}),t.jsx(vS,{filters:d,onFiltersChange:g}),t.jsx(bS,{customers:(k==null?void 0:k.customers)||[],loading:n,onView:H,onDelete:Y,onStatusChange:ge}),k&&k.totalPages>1&&t.jsx(ac,{currentPage:k.currentPage,totalPages:k.totalPages,totalCount:k.totalCount,onPageChange:de}),t.jsx(ub,{isOpen:x,onClose:()=>{console.log("Closing form"),v(!1)},onSubmit:oe,customer:void 0,loading:q.isPending,title:"Add New Customer"}),t.jsx(ro,{isOpen:!!N,onClose:()=>E(null),onConfirm:se,title:"Delete Customer",message:`Are you sure you want to delete "${N==null?void 0:N.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:V.isPending})]})},NE=(c,d=5)=>kt.customers.getOrderHistory.useQuery({customer_id:c,limit:d,offset:0},{enabled:!!c&&c!=="null"&&c!=="undefined",retry:1,staleTime:3e4,select:g=>g.orders}),db=c=>kt.customers.getAddresses.useQuery({customer_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",retry:1,staleTime:3e4}),hb=()=>kt.customers.createAddress.useMutation({onSuccess:c=>{console.log("Address created successfully:",c),It.success("Address created successfully")},onError:c=>{console.error("Create address mutation error:",c),It.error(c.message||"Failed to create address")}}),SE=()=>kt.customers.updateAddress.useMutation({onSuccess:c=>{console.log("Address updated successfully:",c),It.success("Address updated successfully")},onError:c=>{console.error("Update address mutation error:",c),It.error(c.message||"Failed to update address")}}),TE=()=>kt.customers.deleteAddress.useMutation({onSuccess:(c,d)=>{console.log("Address deleted successfully:",d.address_id),It.success("Address deleted successfully")},onError:c=>{console.error("Delete address mutation error:",c),It.error(c.message||"Failed to delete address")}}),EE=()=>kt.customers.setPrimaryAddress.useMutation({onSuccess:(c,d)=>{console.log("Primary address set successfully:",d.address_id),It.success("Primary address updated successfully")},onError:c=>{console.error("Set primary address mutation error:",c),It.error(c.message||"Failed to set primary address")}}),CE=({address:c,onEdit:d,onDelete:g,onSetPrimary:x})=>{const v=le.useRef(null),[N,E]=le.useState(null),[k,n]=le.useState(null),M=vE(c.delivery_window_start,c.delivery_window_end);return le.useEffect(()=>{if(!N&&v.current&&c.latitude&&c.longitude){hi.accessToken=void 0;const z=new hi.Map({container:v.current,style:"mapbox://styles/mapbox/streets-v11",center:[c.longitude,c.latitude],zoom:14,interactive:!1}),q=new hi.Marker().setLngLat([c.longitude,c.latitude]).addTo(z);E(z),n(q),z.on("load",()=>{z.resize()})}},[v,c.latitude,c.longitude]),le.useEffect(()=>()=>{k&&k.remove(),N&&N.remove()},[]),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Nn,{className:"h-4 w-4 text-gray-400 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900",children:c.label||`Address #${c.id.slice(-4)}`}),c.is_primary&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx($h,{className:"h-3 w-3 mr-1"}),"Primary"]})]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[c.latitude&&c.longitude&&t.jsx("div",{className:"p-1 text-green-600",title:"Geocoded",children:t.jsx(w_,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>d(c),className:"p-1 text-gray-400 hover:text-blue-600 rounded hover:bg-blue-50 transition-colors",title:"Edit address",children:t.jsx(ai,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>g(c),className:"p-1 text-gray-400 hover:text-red-600 rounded hover:bg-red-50 transition-colors",title:"Delete address",children:t.jsx(so,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-gray-900",children:cb(c)}),M&&t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(Ki,{className:"h-4 w-4"}),t.jsxs("span",{children:["Delivery: ",M]})]}),c.instructions&&t.jsxs("div",{className:"flex items-start space-x-2 text-sm text-gray-600",children:[t.jsx(b_,{className:"h-4 w-4 mt-0.5"}),t.jsx("p",{className:"line-clamp-2",children:c.instructions})]}),c.latitude&&c.longitude&&t.jsx("div",{className:"mt-3 h-32 rounded-md overflow-hidden border border-gray-200",children:t.jsx("div",{ref:v,className:"w-full h-full"})}),!c.is_primary&&t.jsx("button",{onClick:()=>x(c),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Set as Primary"})]})]})},mb=({isOpen:c,onClose:d,onSubmit:g,address:x,customerId:v,loading:N=!1,title:E,isFirstAddress:k=!1})=>{const[n,M]=le.useState(!1),[z,q]=le.useState(!1),{register:U,handleSubmit:V,reset:G,watch:H,setValue:Y,formState:{errors:ge}}=Tn({defaultValues:{customer_id:v,label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:k,instructions:""}}),oe=H(["line1","city","state","postal_code"]),se=H("delivery_window_start"),de=H("delivery_window_end");le.useEffect(()=>{x?(G({customer_id:x.customer_id,label:x.label||"",line1:x.line1,line2:x.line2||"",city:x.city,state:x.state||"",postal_code:x.postal_code||"",country:x.country,delivery_window_start:x.delivery_window_start||"",delivery_window_end:x.delivery_window_end||"",is_primary:x.is_primary,instructions:x.instructions||"",latitude:x.latitude,longitude:x.longitude}),q(!!(x.latitude&&x.longitude))):(G({customer_id:v,label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:k,instructions:""}),q(!1))},[x,v,k,G]);const ae=async()=>{const[fe,Ie,ke,et]=oe;if(!(!fe||!Ie)){M(!0);try{const Pe=await wE({line1:fe,city:Ie,state:ke,postal_code:et});Pe&&(Y("latitude",Pe.latitude),Y("longitude",Pe.longitude),q(!0))}catch(Pe){console.error("Geocoding failed:",Pe)}finally{M(!1)}}},Se=fe=>{if(fe.delivery_window_start&&fe.delivery_window_end&&!Kh(fe.delivery_window_start,fe.delivery_window_end)){alert("End time must be after start time");return}fe.delivery_window_start&&!fe.delivery_window_end&&(fe.delivery_window_end=void 0),fe.delivery_window_end&&!fe.delivery_window_start&&(fe.delivery_window_start=void 0),g(fe)},Ce=lb();return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:V(Se),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:E}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Address Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"label",className:"block text-sm font-medium text-gray-700",children:"Address Label"}),t.jsx("input",{type:"text",id:"label",...U("label"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Main Location, Loading Dock, etc."})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"line1",className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),t.jsx("input",{type:"text",id:"line1",...U("line1",{required:"Address line 1 is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),ge.line1&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:ge.line1.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"line2",className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),t.jsx("input",{type:"text",id:"line2",...U("line2"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Apartment, suite, unit, etc."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700",children:"City *"}),t.jsx("input",{type:"text",id:"city",...U("city",{required:"City is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),ge.city&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:ge.city.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700",children:"State/Province"}),t.jsx("input",{type:"text",id:"state",...U("state"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postal_code",className:"block text-sm font-medium text-gray-700",children:"Postal Code"}),t.jsx("input",{type:"text",id:"postal_code",...U("postal_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700",children:"Country"}),t.jsx("select",{id:"country",...U("country"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:Ce.map(fe=>t.jsx("option",{value:fe.value,children:fe.label},fe.value))})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Geocoding"}),t.jsxs("button",{type:"button",onClick:ae,disabled:n||!oe[0]||!oe[1],className:"flex items-center space-x-2 text-sm text-blue-600 hover:text-blue-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:[n?t.jsx(tr,{className:"h-4 w-4 animate-spin"}):z?t.jsx(w_,{className:"h-4 w-4 text-green-600"}):t.jsx(Nn,{className:"h-4 w-4"}),t.jsx("span",{children:n?"Geocoding...":z?"Geocoded":"Geocode Address"})]})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Geocoding helps with delivery route optimization"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Delivery Preferences"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_start",className:"block text-sm font-medium text-gray-700",children:"Delivery Window Start"}),t.jsx("input",{type:"time",id:"delivery_window_start",...U("delivery_window_start"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_end",className:"block text-sm font-medium text-gray-700",children:"Delivery Window End"}),t.jsx("input",{type:"time",id:"delivery_window_end",...U("delivery_window_end"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),se&&de&&!Kh(se,de)&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:"End time must be after start time"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"is_primary",...U("is_primary"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"is_primary",className:"ml-2 block text-sm text-gray-900",children:"Set as primary address"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Primary address will be used as the default for orders"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Access & Security"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"access_code",className:"block text-sm font-medium text-gray-700",children:"Access Code"}),t.jsx("input",{type:"text",id:"access_code",...U("access_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Building access code"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"gate_code",className:"block text-sm font-medium text-gray-700",children:"Gate Code"}),t.jsx("input",{type:"text",id:"gate_code",...U("gate_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate or entrance code"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"building_type",className:"block text-sm font-medium text-gray-700",children:"Building Type"}),t.jsxs("select",{id:"building_type",...U("building_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select type..."}),t.jsx("option",{value:"residential",children:"Residential"}),t.jsx("option",{value:"commercial",children:"Commercial"}),t.jsx("option",{value:"industrial",children:"Industrial"}),t.jsx("option",{value:"other",children:"Other"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"preferred_delivery_time",className:"block text-sm font-medium text-gray-700",children:"Preferred Time"}),t.jsx("input",{type:"time",id:"preferred_delivery_time",...U("preferred_delivery_time"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Preferred time within delivery window"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"security_requirements",className:"block text-sm font-medium text-gray-700",children:"Security Requirements"}),t.jsx("textarea",{id:"security_requirements",rows:2,...U("security_requirements"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Security checkpoints, ID requirements, visitor procedures..."})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"On-Site Contact"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"contact_person",className:"block text-sm font-medium text-gray-700",children:"Contact Person"}),t.jsx("input",{type:"text",id:"contact_person",...U("contact_person"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"On-site contact name"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"contact_phone",className:"block text-sm font-medium text-gray-700",children:"Contact Phone"}),t.jsx("input",{type:"tel",id:"contact_phone",...U("contact_phone"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Phone number for delivery"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Logistics & Access"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"parking_instructions",className:"block text-sm font-medium text-gray-700",children:"Parking Instructions"}),t.jsx("textarea",{id:"parking_instructions",rows:2,...U("parking_instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Where to park, parking restrictions, loading zones..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"loading_dock_info",className:"block text-sm font-medium text-gray-700",children:"Loading Dock Information"}),t.jsx("textarea",{id:"loading_dock_info",rows:2,...U("loading_dock_info"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Loading dock location, height restrictions, equipment availability..."})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Delivery Instructions"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_notes",className:"block text-sm font-medium text-gray-700",children:"Delivery Notes"}),t.jsx("textarea",{id:"delivery_notes",rows:3,...U("delivery_notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Specific delivery instructions, handling requirements..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"special_instructions",className:"block text-sm font-medium text-gray-700",children:"Special Instructions"}),t.jsx("textarea",{id:"special_instructions",rows:3,...U("special_instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Special handling, fragile items, temperature requirements..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-gray-700",children:"General Instructions"}),t.jsx("textarea",{id:"instructions",rows:2,...U("instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"General delivery notes and instructions..."})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Address"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},kE=({customerId:c})=>{const[d,g]=le.useState(!1),[x,v]=le.useState(null),[N,E]=le.useState(null),{data:k=[],isLoading:n}=db(c),M=hb(),z=SE(),q=TE(),U=EE(),V=()=>{v(null),g(!0)},G=se=>{v(se),g(!0)},H=se=>{E(se)},Y=async se=>{if(!se.is_primary)try{await U.mutateAsync(se)}catch{}},ge=async se=>{try{x?await z.mutateAsync({id:x.id,...se}):await M.mutateAsync(se),g(!1),v(null)}catch{}},oe=async()=>{if(N)try{await q.mutateAsync(N),E(null)}catch{}};return n?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-20 bg-gray-200 rounded"}),t.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Nn,{className:"h-5 w-5 text-gray-400"}),t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Delivery Addresses (",k.length,")"]})]}),t.jsxs("button",{onClick:V,className:"flex items-center space-x-2 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Address"})]})]}),k.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Nn,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"No delivery addresses added yet"}),t.jsx("button",{onClick:V,className:"text-blue-600 hover:text-blue-800 font-medium",children:"Add the first address"})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:k.map(se=>t.jsx(CE,{address:se,onEdit:G,onDelete:H,onSetPrimary:Y},se.id))}),t.jsx(mb,{isOpen:d,onClose:()=>{g(!1),v(null)},onSubmit:ge,address:x||void 0,customerId:c,loading:M.isPending||z.isPending,title:x?"Edit Address":"Add New Address",isFirstAddress:k.length===0}),t.jsx(ro,{isOpen:!!N,onClose:()=>E(null),onConfirm:oe,title:"Delete Address",message:`Are you sure you want to delete this address? ${N!=null&&N.is_primary?"This is the primary address for this customer.":""}`,confirmText:"Delete",type:"danger",loading:q.isPending})]})},AE=()=>[{status:"draft",label:"Draft",description:"Order is being created",color:"bg-gray-100 text-gray-800 border-gray-200",icon:"FileText",allowedTransitions:["confirmed","cancelled"]},{status:"confirmed",label:"Confirmed",description:"Order confirmed, stock reserved",color:"bg-blue-100 text-blue-800 border-blue-200",icon:"CheckCircle",allowedTransitions:["scheduled","cancelled"]},{status:"scheduled",label:"Scheduled",description:"Delivery date scheduled",color:"bg-purple-100 text-purple-800 border-purple-200",icon:"Calendar",allowedTransitions:["en_route","cancelled"]},{status:"en_route",label:"En Route",description:"Out for delivery",color:"bg-orange-100 text-orange-800 border-orange-200",icon:"Truck",allowedTransitions:["delivered"]},{status:"delivered",label:"Delivered",description:"Successfully delivered",color:"bg-green-100 text-green-800 border-green-200",icon:"Package",allowedTransitions:["invoiced"]},{status:"invoiced",label:"Invoiced",description:"Invoice generated",color:"bg-teal-100 text-teal-800 border-teal-200",icon:"Receipt",allowedTransitions:[]},{status:"cancelled",label:"Cancelled",description:"Order cancelled",color:"bg-red-100 text-red-800 border-red-200",icon:"XCircle",allowedTransitions:[]}],Jo=c=>{const d=AE();return d.find(g=>g.status===c)||d[0]},If=c=>`#${c.slice(-8).toUpperCase()}`,ME=c=>new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),As=c=>`Ksh ${c.toLocaleString("en-KE",{minimumFractionDigits:2,maximumFractionDigits:2})}`,PE=c=>Jo(c).color,lf=c=>Jo(c).allowedTransitions,IE=c=>{const d=[];return c.customer_id||d.push("Customer is required"),c.delivery_address_id||d.push("Delivery address is required"),(!c.order_lines||c.order_lines.length===0)&&d.push("At least one product is required"),{valid:d.length===0,errors:d}},DE=({orders:c,loading:d})=>{const g=Hr();return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"})]})]})}):c.length?t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Orders"}),t.jsx("div",{className:"space-y-4",children:c.map(x=>{var v;return t.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>g(`/orders/${x.id}`),children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:["Order #",x.id]}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[t.jsx(er,{className:"h-4 w-4"}),t.jsx("span",{children:ME(x.order_date)})]})]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x.status==="completed"?"bg-green-100 text-green-800":x.status==="cancelled"?"bg-red-100 text-red-800":x.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:x.status.charAt(0).toUpperCase()+x.status.slice(1)})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(fs,{className:"h-4 w-4"}),t.jsxs("span",{children:[((v=x.order_lines)==null?void 0:v.length)||0," items"]})]}),x.total_amount!==void 0&&t.jsxs("p",{className:"text-sm font-medium text-gray-900 mt-1",children:["Total: $",x.total_amount.toFixed(2)]})]})]},x.id)})})]}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Orders"}),t.jsx("p",{className:"text-gray-500 text-center py-4",children:"No orders found"})]})},ym=({status:c,className:d="",children:g})=>{const x=()=>{switch(c){case"active":return"bg-green-100 text-green-800 border-green-200";case"credit_hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"closed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},v=()=>{if(g)return g;switch(c){case"active":return"Active";case"credit_hold":return"Credit Hold";case"closed":return"Closed";default:return c}};return t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${x()} ${d}`,children:v()})},LE=()=>{const{id:c}=nc(),d=Hr(),[g,x]=le.useState(!1),{data:v,isLoading:N,error:E}=xS(c),k=T_(),{data:n,isLoading:M}=NE((v==null?void 0:v.id)||"",5),z=async U=>{if(v)try{await k.mutateAsync({id:v.id,...U}),x(!1)}catch{}},q=U=>new Date(U).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return N?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]}):E||!v?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Customer not found or error loading customer details."})})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:v.name})]}),t.jsxs("button",{onClick:()=>x(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ai,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Customer"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Business Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(x_,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:v.name})]})]}),v.external_id&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"External ID"}),t.jsx("span",{className:"text-gray-900",children:v.external_id})]}),v.tax_id&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Tax ID (VAT/EIN)"}),t.jsx("span",{className:"text-gray-900",children:v.tax_id})]}),v.email&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Email"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(JN,{className:"h-4 w-4 text-gray-400"}),t.jsx("a",{href:`mailto:${v.email}`,className:"text-blue-600 hover:text-blue-800",children:v.email})]})]}),v.phone&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Phone"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(sS,{className:"h-4 w-4 text-gray-400"}),t.jsx("a",{href:`tel:${v.phone}`,className:"text-blue-600 hover:text-blue-800",children:v.phone})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Account Status"}),t.jsx(ym,{status:v.account_status})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Credit Terms"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ZN,{className:"h-4 w-4 text-gray-400"}),t.jsxs("span",{className:"text-gray-900",children:[v.credit_terms_days," days"]})]})]})]})]})}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(v.created_at)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Last Updated"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(v.updated_at)})]})]})]})]})})]}),t.jsx(kE,{customerId:v.id}),t.jsx(DE,{orders:n||[],loading:M}),t.jsx(ub,{isOpen:g,onClose:()=>x(!1),onSubmit:z,customer:v,loading:k.isPending,title:"Edit Customer"})]})},cc=(c={})=>kt.products.list.useQuery({search:c.search,status:c.status,unit_of_measure:c.unit_of_measure,page:c.page||1,limit:c.limit||50,sort_by:c.sort_by||"created_at",sort_order:c.sort_order||"desc",show_obsolete:c.show_obsolete||!1},{retry:1,staleTime:3e4}),RE=c=>kt.products.getById.useQuery({id:c},{enabled:!!c}),zE=()=>kt.products.getStats.useQuery(void 0,{staleTime:6e4}),OE=()=>kt.products.create.useMutation({onSuccess:c=>{console.log("Product created successfully:",c),It.success("Product created successfully")},onError:c=>{console.error("Create product mutation error:",c),It.error(c.message||"Failed to create product")}}),pb=()=>kt.products.update.useMutation({onSuccess:c=>{console.log("Product updated successfully:",c),It.success("Product updated successfully")},onError:c=>{console.error("Update product mutation error:",c),It.error(c.message||"Failed to update product")}}),FE=()=>kt.products.delete.useMutation({onSuccess:(c,d)=>{console.log("Product deleted successfully:",d.id),It.success("Product status set to obsolete")},onError:c=>{console.error("Delete product mutation error:",c),It.error(c.message||"Failed to delete product")}}),BE=()=>kt.products.bulkUpdateStatus.useMutation({onSuccess:c=>{console.log("Bulk product status update successful:",c),It.success(`Updated ${c.updated_count} products successfully`)},onError:c=>{console.error("Bulk update status mutation error:",c),It.error(c.message||"Failed to update product status")}}),UE=()=>kt.products.reactivate.useMutation({onSuccess:c=>{console.log("Product reactivated successfully:",c),It.success("Product reactivated successfully")},onError:c=>{console.error("Reactivate product mutation error:",c),It.error(c.message||"Failed to reactivate product")}}),VE=({products:c,loading:d=!1,onView:g,onEdit:x,onDelete:v,selectedProducts:N=[],onSelectionChange:E})=>{const[k,n]=le.useState(!1),M=UE(),z=Y=>new Date(Y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),q=Y=>Y==="cylinder"?qf:Gf,U=Y=>{switch(Y){case"active":return"active";case"end_of_sale":return"credit_hold";case"obsolete":return"closed";default:return"active"}},V=Y=>{n(Y),E&&E(Y?c.map(ge=>ge.id):[])},G=(Y,ge)=>{if(E){const oe=ge?[...N,Y]:N.filter(se=>se!==Y);E(oe),n(oe.length===c.length)}},H=async Y=>{try{await M.mutateAsync(Y.id)}catch{}};return console.log("ProductTable render:",{products:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading products..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(fs,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load products. Please check your connection.":"Get started by adding your first product."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Products (",c.length,")"]}),N.length>0&&t.jsxs("span",{className:"text-sm text-blue-600",children:[N.length," selected"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[E&&t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:k,onChange:Y=>V(Y.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type & Specs"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(Y=>{const ge=q(Y.unit_of_measure),oe=Y.status==="obsolete";return t.jsxs("tr",{className:`hover:bg-gray-50 ${oe?"opacity-60":""}`,children:[E&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",checked:N.includes(Y.id),onChange:se=>G(Y.id,se.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[Y.name,oe&&t.jsx("span",{className:"ml-2 text-xs text-red-600",children:"(Obsolete)"})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Y.sku]}),Y.description&&t.jsx("div",{className:"text-xs text-gray-400 mt-1 max-w-xs truncate",children:Y.description})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ge,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsx("div",{className:"capitalize",children:Y.unit_of_measure}),Y.unit_of_measure==="cylinder"&&t.jsxs("div",{className:"text-xs text-gray-500",children:[Y.capacity_kg&&`${Y.capacity_kg} kg capacity`,Y.tare_weight_kg&&`  ${Y.tare_weight_kg} kg tare`]}),Y.valve_type&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Valve: ",Y.valve_type]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(ym,{status:U(Y.status),className:"capitalize",children:Y.status.replace("_"," ")})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:z(Y.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(Y),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View product",children:t.jsx(om,{className:"h-4 w-4"})}),!oe&&t.jsx("button",{onClick:()=>x(Y),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit product",children:t.jsx(ai,{className:"h-4 w-4"})}),oe?t.jsx("button",{onClick:()=>H(Y),disabled:M.isPending,className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors disabled:opacity-50",title:"Reactivate product",children:t.jsx(eo,{className:"h-4 w-4"})}):t.jsx("button",{onClick:()=>v(Y),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Mark as obsolete",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},Y.id)})})]})})]})},qE=({filters:c,onFiltersChange:d})=>{const g=n=>{d({...c,search:n.target.value||void 0,page:1})},x=n=>{d({...c,status:n.target.value||void 0,page:1})},v=n=>{d({...c,unit_of_measure:n.target.value||void 0,page:1})},N=n=>{const[M,z]=n.target.value.split(":");d({...c,sort_by:M||"created_at",sort_order:z||"desc",page:1})},E=()=>{d({...c,show_obsolete:!c.show_obsolete,page:1})},k=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by SKU, name, or description...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:x,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]})}),t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(fs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.unit_of_measure||"",onChange:v,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"cylinder",children:"Cylinders"}),t.jsx("option",{value:"kg",children:"By Weight (kg)"})]})]})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("select",{value:`${c.sort_by||"created_at"}:${c.sort_order||"desc"}`,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"created_at:desc",children:"Newest First"}),t.jsx("option",{value:"created_at:asc",children:"Oldest First"}),t.jsx("option",{value:"name:asc",children:"Name A-Z"}),t.jsx("option",{value:"name:desc",children:"Name Z-A"}),t.jsx("option",{value:"sku:asc",children:"SKU A-Z"}),t.jsx("option",{value:"sku:desc",children:"SKU Z-A"}),t.jsx("option",{value:"capacity_kg:desc",children:"Capacity High-Low"}),t.jsx("option",{value:"capacity_kg:asc",children:"Capacity Low-High"})]})}),t.jsxs("button",{onClick:E,className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${c.show_obsolete?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,title:c.show_obsolete?"Hide obsolete products":"Show obsolete products",children:[c.show_obsolete?t.jsx(WN,{className:"h-4 w-4"}):t.jsx(om,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:c.show_obsolete?"Hide Obsolete":"Show Obsolete"})]}),t.jsxs("button",{onClick:k,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},fb=({isOpen:c,onClose:d,onSubmit:g,product:x,loading:v=!1,title:N})=>{const[E,k]=le.useState(!1),{register:n,handleSubmit:M,reset:z,watch:q,formState:{errors:U}}=Tn({defaultValues:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:void 0,tare_weight_kg:void 0,valve_type:"",status:"active",barcode_uid:""}}),V=q("unit_of_measure"),G=q("status");le.useEffect(()=>{z(x?{sku:x.sku,name:x.name,description:x.description||"",unit_of_measure:x.unit_of_measure,capacity_kg:x.capacity_kg,tare_weight_kg:x.tare_weight_kg,valve_type:x.valve_type||"",status:x.status,barcode_uid:x.barcode_uid||""}:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:void 0,tare_weight_kg:void 0,valve_type:"",status:"active",barcode_uid:""})},[x,z]),le.useEffect(()=>{k(G==="obsolete")},[G]);const H=oe=>/^[A-Z0-9-]+$/.test(oe)?!0:"SKU must contain only uppercase letters, numbers, and hyphens",Y=(oe,se)=>{if(oe!==void 0){if(oe<=0)return`${se} must be greater than 0`;if(oe>500)return`${se} must be 500 kg or less`}return!0},ge=oe=>{const se={...oe};oe.unit_of_measure!=="cylinder"&&(se.capacity_kg=void 0,se.tare_weight_kg=void 0,se.valve_type=void 0),Object.keys(se).forEach(de=>{se[de]===""&&(se[de]=void 0)}),g(se)};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:M(ge),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU *"}),t.jsx("input",{type:"text",id:"sku",...n("sku",{required:"SKU is required",validate:H}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 uppercase",placeholder:"CYL-50KG-S"}),U.sku&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.sku.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",...n("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),t.jsx("input",{type:"text",id:"name",...n("name",{required:"Product name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"LPG Cylinder 50kg"}),U.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.name.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...n("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Detailed product description..."})]})]}),E&&t.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:'Warning: Setting status to "Obsolete" will make this product unavailable for future orders.'})]})})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Physical Properties"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_of_measure",className:"block text-sm font-medium text-gray-700",children:"Unit of Measure"}),t.jsxs("select",{id:"unit_of_measure",...n("unit_of_measure"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"kg",children:"By Weight (kg)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"barcode_uid",className:"block text-sm font-medium text-gray-700",children:"Barcode/RFID UID"}),t.jsx("input",{type:"text",id:"barcode_uid",...n("barcode_uid"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional unique identifier"})]}),V==="cylinder"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_kg",className:"block text-sm font-medium text-gray-700",children:"Capacity (kg)"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"500",id:"capacity_kg",...n("capacity_kg",{valueAsNumber:!0,validate:oe=>Y(oe,"Capacity")}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"50.0"}),U.capacity_kg&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.capacity_kg.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tare_weight_kg",className:"block text-sm font-medium text-gray-700",children:"Tare Weight (kg)"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"500",id:"tare_weight_kg",...n("tare_weight_kg",{valueAsNumber:!0,validate:oe=>Y(oe,"Tare weight")}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"15.0"}),U.tare_weight_kg&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.tare_weight_kg.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"valve_type",className:"block text-sm font-medium text-gray-700",children:"Valve Type"}),t.jsx("input",{type:"text",id:"valve_type",...n("valve_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Standard valve specifications"})]})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:v,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:v?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Product"}),t.jsx("button",{type:"button",onClick:d,disabled:v,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},v0=(c,d)=>`${c}-${d.toLowerCase()}`,w0=[{name:"full",description:"Full cylinder ready for delivery"},{name:"empty",description:"Empty cylinder for exchange/pickup"}],$E=c=>{switch(c){case"delivery":return"Standard Delivery";case"refill":return"Refill Service";case"exchange":return"Cylinder Exchange";case"pickup":return"Empty Pickup";default:return c}},GE=c=>{switch(c){case"standard":return"Standard Service";case"express":return"Express Service";case"scheduled":return"Scheduled Service";default:return c}},cf=c=>c==="exchange"||c==="pickup",ZE=({isOpen:c,onClose:d,onSubmit:g,product:x,loading:v=!1,title:N})=>{const[E,k]=le.useState(!1),[n,M]=le.useState([]),{register:z,handleSubmit:q,reset:U,watch:V,setValue:G,formState:{errors:H}}=Tn({defaultValues:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:0,tare_weight_kg:0,valve_type:"",status:"active",barcode_uid:"",requires_tag:!1,variant_type:"cylinder",parent_product_id:void 0,variant_name:void 0,is_variant:!1}}),Y=V("variant_type"),ge=V("sku");le.useEffect(()=>{x&&U({sku:x.sku,name:x.name,description:x.description||"",unit_of_measure:x.unit_of_measure,capacity_kg:x.capacity_kg||0,tare_weight_kg:x.tare_weight_kg||0,valve_type:x.valve_type||"",status:x.status,barcode_uid:x.barcode_uid||"",requires_tag:x.requires_tag,variant_type:x.variant_type,parent_product_id:x.parent_product_id,variant_name:x.variant_name,is_variant:x.is_variant})},[x,U]),le.useEffect(()=>{Y==="cylinder"&&n.length===0&&E&&M(w0.map(Ce=>({name:Ce.name,description:Ce.description,status:"active"})))},[Y,E,n.length]);const oe=()=>{M([...n,{name:"",description:"",status:"active"}])},se=Ce=>{M(n.filter((fe,Ie)=>Ie!==Ce))},de=(Ce,fe,Ie)=>{const ke=[...n];ke[Ce]={...ke[Ce],[fe]:Ie},M(ke)},ae=Ce=>{const fe={...Ce,is_variant:!1,parent_product_id:void 0,variant_name:void 0};let Ie;E&&n.length>0&&(Ie=n.map(ke=>({parent_product_id:"",variant_name:ke.name,sku:v0(Ce.sku,ke.name),name:`${Ce.name} (${ke.name})`,description:ke.description||`${ke.name} variant of ${Ce.name}`,status:ke.status,barcode_uid:void 0}))),g(fe,Ie)},Se=()=>{M(w0.map(Ce=>({name:Ce.name,description:Ce.description,status:"active"})))};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:t.jsxs("form",{onSubmit:q(ae),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h4",{className:"text-md font-semibold text-gray-900 flex items-center space-x-2",children:[t.jsx(fs,{className:"h-5 w-5"}),t.jsx("span",{children:"Product Information"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU *"}),t.jsx("input",{type:"text",id:"sku",...z("sku",{required:"SKU is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., PROGAS-13KG"}),H.sku&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:H.sku.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),t.jsx("input",{type:"text",id:"name",...z("name",{required:"Product name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., ProGas 13kg Cylinder"}),H.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:H.name.message})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...z("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Product description..."})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"variant_type",className:"block text-sm font-medium text-gray-700",children:"Variant Type *"}),t.jsxs("select",{id:"variant_type",...z("variant_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"refillable",children:"Refillable"}),t.jsx("option",{value:"disposable",children:"Disposable"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_of_measure",className:"block text-sm font-medium text-gray-700",children:"Unit of Measure"}),t.jsxs("select",{id:"unit_of_measure",...z("unit_of_measure"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"kg",children:"Kilogram"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_kg",className:"block text-sm font-medium text-gray-700",children:"Capacity (kg)"}),t.jsx("input",{type:"number",step:"0.1",id:"capacity_kg",...z("capacity_kg",{min:0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tare_weight_kg",className:"block text-sm font-medium text-gray-700",children:"Tare Weight (kg)"}),t.jsx("input",{type:"number",step:"0.1",id:"tare_weight_kg",...z("tare_weight_kg",{min:0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"valve_type",className:"block text-sm font-medium text-gray-700",children:"Valve Type"}),t.jsx("input",{type:"text",id:"valve_type",...z("valve_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., POL, ACME"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",...z("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]})]}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"requires_tag",...z("requires_tag"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"requires_tag",className:"ml-2 block text-sm text-gray-700",children:"Requires Tag"})]})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"text-md font-semibold text-gray-900 flex items-center space-x-2",children:[t.jsx(aS,{className:"h-5 w-5"}),t.jsx("span",{children:"Product Variants"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"create_variants",checked:E,onChange:Ce=>k(Ce.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"create_variants",className:"block text-sm text-gray-700",children:"Create Variants"})]})]}),E&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(nm,{className:"h-5 w-5 text-blue-600 mt-0.5"}),t.jsx("div",{children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Product Variants:"})," Create different variants of this product (e.g., full vs empty cylinders). Each variant will have its own SKU and inventory tracking."]})})]})}),Y==="cylinder"&&n.length===0&&t.jsx("div",{className:"text-center py-4",children:t.jsxs("button",{type:"button",onClick:Se,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Standard Cylinder Variants"})]})}),n.map((Ce,fe)=>t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h5",{className:"text-sm font-medium text-gray-900",children:["Variant ",fe+1]}),t.jsx("button",{type:"button",onClick:()=>se(fe),className:"text-red-600 hover:text-red-800",children:t.jsx(so,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Variant Name *"}),t.jsx("input",{type:"text",value:Ce.name,onChange:Ie=>de(fe,"name",Ie.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., full, empty"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("input",{type:"text",value:Ce.description||"",onChange:Ie=>de(fe,"description",Ie.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Variant description"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("strong",{children:"Generated SKU:"})," ",ge?v0(ge,Ce.name):"Enter parent SKU first"]})]})]},fe)),t.jsxs("button",{type:"button",onClick:oe,className:"w-full flex items-center justify-center space-x-2 border border-gray-300 rounded-lg px-4 py-3 text-gray-600 hover:bg-gray-50 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Another Variant"})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:v,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Creating...":"Create Product"}),t.jsx("button",{type:"button",onClick:d,disabled:v,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},WE=()=>{const{data:c,isLoading:d}=zE();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((x,v)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},v))})]})});if(!c)return null;const g=[{name:"Total Products",value:c.total,icon:fs,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Active",value:c.active,icon:pa,color:"text-green-600",bgColor:"bg-green-50"},{name:"End of Sale",value:c.end_of_sale,icon:$s,color:"text-yellow-600",bgColor:"bg-yellow-50"},{name:"Obsolete",value:c.obsolete,icon:Qa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Cylinders",value:c.cylinders,icon:qf,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"By Weight",value:c.kg_products,icon:Gf,color:"text-indigo-600",bgColor:"bg-indigo-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:g.map(x=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${x.bgColor} mb-2`,children:t.jsx(x.icon,{className:`h-6 w-6 ${x.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.value}),t.jsx("div",{className:"text-sm text-gray-600",children:x.name})]},x.name))})]})},HE=({selectedProducts:c,onClearSelection:d})=>{const[g,x]=le.useState(!1),v=BE(),N=async k=>{try{await v.mutateAsync({productIds:c,status:k}),d(),x(!1)}catch{}},E=()=>{console.log("Exporting products:",c),x(!1)};return c.length===0?null:t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[c.length," product",c.length>1?"s":""," selected"]}),t.jsx("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear selection"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>x(!g),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(tS,{className:"h-4 w-4"}),t.jsx("span",{children:"Bulk Actions"}),t.jsx(am,{className:"h-4 w-4"})]}),g&&t.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-10",children:t.jsxs("div",{className:"py-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Change Status"}),t.jsx("button",{onClick:()=>N("active"),disabled:v.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as Active"}),t.jsx("button",{onClick:()=>N("end_of_sale"),disabled:v.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as End of Sale"}),t.jsx("button",{onClick:()=>N("obsolete"),disabled:v.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as Obsolete"}),t.jsx("div",{className:"border-t border-gray-100 mt-1",children:t.jsxs("button",{onClick:E,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx($f,{className:"h-4 w-4"}),t.jsx("span",{children:"Export Selected"})]})})]})})]})]})})},XE=()=>{const c=Hr(),[d,g]=le.useState({page:1}),[x,v]=le.useState(!1),[N,E]=le.useState(!1),[k,n]=le.useState(null),[M,z]=le.useState(null),[q,U]=le.useState([]),{data:V,isLoading:G,error:H,refetch:Y}=cc(d),ge=OE(),oe=pb(),se=FE();le.useEffect(()=>{console.log("ProductsPage state:",{filters:d,data:V,isLoading:G,error:H,isFormOpen:x,editingProduct:k,selectedProducts:q})},[d,V,G,H,x,k,q]);const de=()=>{console.log("Adding new product"),n(null),v(!0)},ae=()=>{console.log("Adding product with variants"),E(!0)},Se=Tt=>{console.log("Editing product:",Tt),n(Tt),v(!0)},Ce=Tt=>{console.log("Viewing product:",Tt),c(`/products/${Tt.id}`)},fe=Tt=>{console.log("Marking product as obsolete:",Tt),z(Tt)},Ie=async Tt=>{console.log("Form submit:",Tt);try{k?await oe.mutateAsync({id:k.id,...Tt}):await ge.mutateAsync(Tt),v(!1),n(null)}catch(At){console.error("Form submit error:",At)}},ke=async(Tt,At)=>{console.log("Variant form submit:",Tt,At);try{const zs=await ge.mutateAsync(Tt);if(At&&At.length>0)for(const ts of At){const Vt={...ts,parent_product_id:zs.id};await ge.mutateAsync(Vt)}E(!1),Y()}catch(zs){console.error("Variant form submit error:",zs)}},et=async()=>{if(M){console.log("Confirming mark as obsolete:",M);try{await se.mutateAsync(M.id),z(null)}catch(Tt){console.error("Mark obsolete error:",Tt)}}},Pe=Tt=>{console.log("Page change:",Tt),g(At=>({...At,page:Tt}))},Ne=()=>{console.log("Refreshing products"),Y()},it=Tt=>{U(Tt)},ft=()=>{U([])},Mt=M?M.status==="obsolete"?{title:"Product Already Obsolete",message:`"${M.name}" is already marked as obsolete and hidden from active lists.`}:{title:"Mark Product as Obsolete",message:`Are you sure you want to mark "${M.name}" as obsolete? This will hide it from active product lists but preserve all historical data including price lists, inventory records, and order history. The product can be reactivated later if needed.`}:{title:"",message:""};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Products"}),t.jsx("p",{className:"text-gray-600",children:"Manage your LPG product catalog"}),H&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",H.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Ne,disabled:G,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(tl,{className:`h-4 w-4 ${G?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:ae,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(j_,{className:"h-4 w-4"}),t.jsx("span",{children:"Create with Variants"})]}),t.jsxs("button",{onClick:de,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]})]}),t.jsx(WE,{}),t.jsx(qE,{filters:d,onFiltersChange:g}),t.jsx(HE,{selectedProducts:q,onClearSelection:ft}),t.jsx(VE,{products:(V==null?void 0:V.products)||[],loading:G,onView:Ce,onEdit:Se,onDelete:fe,selectedProducts:q,onSelectionChange:it}),V&&V.totalPages>1&&t.jsx(ac,{currentPage:V.currentPage,totalPages:V.totalPages,totalCount:V.totalCount,onPageChange:Pe}),t.jsx(fb,{isOpen:x,onClose:()=>{console.log("Closing form"),v(!1),n(null)},onSubmit:Ie,product:k||void 0,loading:ge.isPending||oe.isPending,title:k?"Edit Product":"Add New Product"}),t.jsx(ZE,{isOpen:N,onClose:()=>E(!1),onSubmit:ke,loading:ge.isPending,title:"Create Product with Variants"}),t.jsx(ro,{isOpen:!!M,onClose:()=>z(null),onConfirm:et,title:Mt.title,message:Mt.message,confirmText:(M==null?void 0:M.status)==="obsolete"?"OK":"Mark as Obsolete",type:(M==null?void 0:M.status)==="obsolete"?"info":"warning",loading:se.isPending})]})},eg=(c={})=>kt.pricing.listPriceLists.useQuery({search:c.search,currency:c.currency,status:c.status,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Price lists fetch error:",d),It.error("Failed to load price lists")}}),KE=c=>kt.pricing.getPriceList.useQuery({price_list_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Price list fetch error:",d),It.error("Failed to load price list details")}}),QE=()=>{const c=kt.useContext();return kt.pricing.createPriceList.useMutation({onSuccess:d=>{console.log("Price list created successfully:",d),c.pricing.listPriceLists.invalidate(),c.pricing.getStats.invalidate(),It.success("Price list created successfully")},onError:d=>{console.error("Create price list error:",d),It.error(d.message||"Failed to create price list")}})},gb=()=>{const c=kt.useContext();return kt.pricing.updatePriceList.useMutation({onSuccess:d=>{console.log("Price list updated successfully:",d),c.pricing.listPriceLists.invalidate(),c.pricing.getPriceList.invalidate({price_list_id:d.id}),c.pricing.getStats.invalidate(),It.success("Price list updated successfully")},onError:d=>{console.error("Update price list error:",d),It.error(d.message||"Failed to update price list")}})},JE=()=>kt.pricing.getStats.useQuery(void 0,{enabled:!0,staleTime:6e4,retry:1,onError:c=>{console.error("Pricing stats fetch error:",c),It.error("Failed to load pricing statistics")}}),xb=(c,d={})=>kt.pricing.getPriceListItems.useQuery({price_list_id:c,search:d.search,page:d.page||1,limit:d.limit||50},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:g=>{console.error("Price list items fetch error:",g),It.error("Failed to load price list items")}}),yb=()=>{const c=kt.useContext();return kt.pricing.createPriceListItem.useMutation({onSuccess:d=>{console.log("Price list item created successfully:",d),c.pricing.getPriceListItems.invalidate({price_list_id:d.price_list_id}),c.pricing.getPriceList.invalidate({price_list_id:d.price_list_id}),It.success("Price list item created successfully")},onError:d=>{console.error("Create price list item error:",d),It.error(d.message||"Failed to create price list item")}})},fa=(c,d="KES")=>{const g="Ksh",x=c.toLocaleString("en-KE",{minimumFractionDigits:2,maximumFractionDigits:2});return`${g} ${x}`},YE=(c,d)=>d?c*(1+d/100):c,_b=(c,d)=>{const g=new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});if(!d)return`${g} - Ongoing`;const x=new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return`${g} - ${x}`},Qh=(c,d)=>{const g=new Date().toISOString().split("T")[0],x=c,v=d;return x>g?{status:"future",label:"Future",color:"bg-blue-100 text-blue-800 border-blue-200"}:v&&v<g?{status:"expired",label:"Expired",color:"bg-red-100 text-red-800 border-red-200"}:{status:"active",label:"Active",color:"bg-green-100 text-green-800 border-green-200"}},eC=(c,d)=>d?new Date(c)<=new Date(d):!0,tC=(c,d=30)=>{if(!c)return!1;const g=new Date,x=new Date(c),v=Math.ceil((x.getTime()-g.getTime())/(1e3*60*60*24));return v<=d&&v>=0},sC=({isOpen:c,onClose:d,onSubmit:g,priceListId:x,item:v,loading:N=!1,title:E,existingProductIds:k=[]})=>{const[n,M]=le.useState([]),[z,q]=le.useState(0),[U,V]=le.useState(!1),{register:G,handleSubmit:H,reset:Y,watch:ge,setValue:oe,formState:{errors:se}}=Tn({defaultValues:{price_list_id:x,product_id:"",unit_price:0,min_qty:1,surcharge_pct:0}}),{data:de}=cc({limit:1e3}),Se=((de==null?void 0:de.products)||[]).filter(Pe=>Pe.status==="active"&&!k.includes(Pe.id)),Ce=ge("unit_price"),fe=ge("surcharge_pct");le.useEffect(()=>{Y(v?{price_list_id:v.price_list_id,product_id:v.product_id,unit_price:v.unit_price,min_qty:v.min_qty,surcharge_pct:v.surcharge_pct||0}:{price_list_id:x,product_id:"",unit_price:0,min_qty:1,surcharge_pct:0})},[v,x,Y]);const Ie=Pe=>{v?g(Pe):n.length>0?n.forEach(Ne=>{g({...Pe,product_id:Ne,unit_price:U?z:Pe.unit_price})}):g(Pe)},ke=Pe=>{M(Ne=>Ne.includes(Pe)?Ne.filter(it=>it!==Pe):[...Ne,Pe])},et=(Pe,Ne)=>Pe*(1+(Ne||0)/100);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:H(Ie),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:E}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[!v&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Products"}),t.jsx("div",{className:"border border-gray-300 rounded-md p-2 max-h-60 overflow-y-auto",children:Se.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500",children:"No available products to add"}):t.jsx("div",{className:"space-y-2",children:Se.map(Pe=>t.jsxs("div",{className:`flex items-center p-2 rounded-md ${n.includes(Pe.id)?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:[t.jsx("input",{type:"checkbox",id:`product-${Pe.id}`,checked:n.includes(Pe.id),onChange:()=>ke(Pe.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsxs("label",{htmlFor:`product-${Pe.id}`,className:"ml-2 block text-sm text-gray-900 cursor-pointer flex-1",children:[t.jsx("div",{className:"font-medium",children:Pe.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",Pe.sku]})]})]},Pe.id))})}),n.length>0&&t.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:[n.length," product",n.length!==1?"s":""," selected"]})]}),!v&&n.length>0&&t.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("input",{type:"checkbox",id:"use-bulk-price",checked:U,onChange:()=>V(!U),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"use-bulk-price",className:"ml-2 block text-sm font-medium text-blue-800",children:"Apply same price to all selected products"})]}),U&&t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"block text-sm font-medium text-blue-800 mb-1",children:"Bulk Price (KSh)"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:z,onChange:Pe=>q(parseFloat(Pe.target.value)||0),className:"w-full rounded-md border border-blue-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"})]})]}),(v||!U)&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700",children:"Unit Price (KSh) *"}),t.jsx("input",{type:"number",id:"unit_price",min:"0",step:"0.01",...G("unit_price",{required:"Unit price is required",min:{value:0,message:"Price must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"}),se.unit_price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:se.unit_price.message})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"min_qty",className:"block text-sm font-medium text-gray-700",children:"Minimum Quantity"}),t.jsx("input",{type:"number",id:"min_qty",min:"1",...G("min_qty",{required:"Minimum quantity is required",min:{value:1,message:"Minimum quantity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),se.min_qty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:se.min_qty.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"surcharge_pct",className:"block text-sm font-medium text-gray-700",children:"Surcharge %"}),t.jsx("input",{type:"number",id:"surcharge_pct",min:"0",step:"0.1",...G("surcharge_pct",{min:{value:0,message:"Surcharge must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"}),se.surcharge_pct&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:se.surcharge_pct.message})]})]}),(Ce>0||z>0)&&fe>0&&t.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:t.jsxs("div",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Final Price:"})," ",fa(et(U?z:Ce,fe)),t.jsxs("div",{className:"text-xs mt-1",children:["(Base price + ",fe,"% surcharge)"]})]})}),v&&t.jsx("input",{type:"hidden",...G("product_id"),value:v.product_id}),t.jsx("input",{type:"hidden",...G("price_list_id"),value:x})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||n.length===0&&!v,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):v?"Update Price":"Add Products"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},rC=({productId:c})=>{const[d,g]=le.useState(null),[x,v]=le.useState(!1),[N,E]=le.useState(null),{data:k={priceLists:[]}}=eg(),n=k.priceLists||[],M={},z=yb(),q=oe=>{g(oe),E(null),v(!0)},U=oe=>{g(oe.price_list_id),E(oe),v(!0)},V=async oe=>{try{if(N){alert("Edit functionality is temporarily disabled");return}else await z.mutateAsync({...oe,product_id:c});v(!1),E(null)}catch{}},G=n.filter(oe=>!Object.keys(M).includes(oe.id));new Date().toISOString().split("T")[0];const H=n.filter(oe=>Qh(oe.start_date,oe.end_date).status==="active"),Y=Object.keys(M).length===0,ge=!H.some(oe=>Object.keys(M).includes(oe.id));return t.jsxs("div",{className:"space-y-6",children:[(Y||ge)&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($n,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:Y?"No Pricing Defined":"No Active Pricing"}),t.jsx("p",{className:"text-sm text-yellow-700",children:Y?"This product has no pricing defined in any price list.":"This product has pricing defined, but not in any active price list."})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Current Pricing"}),G.length>0&&t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:"",onChange:oe=>{oe.target.value&&q(oe.target.value)},className:"appearance-none bg-blue-600 text-white px-3 py-1 pr-8 rounded text-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[t.jsx("option",{value:"",children:"Add to Price List..."}),G.map(oe=>t.jsx("option",{value:oe.id,children:oe.name},oe.id))]}),t.jsx(vr,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white pointer-events-none"})]})]}),Object.keys(M).length===0?t.jsxs("div",{className:"p-8 text-center",children:[t.jsx($n,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"No pricing defined for this product"}),G.length>0&&t.jsx("button",{onClick:()=>q(G[0].id),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Add pricing to a price list"})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price List"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Min Qty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Surcharge"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(M).map(([oe,se])=>{const de=n.find(fe=>fe.id===oe);if(!de||!se.length)return null;const ae=se[0],Se=Qh(de.start_date,de.end_date),Ce=YE(ae.unit_price,ae.surcharge_pct);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:de.name}),de.is_default&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Default"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Se.color}`,children:Se.label})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:fa(ae.unit_price)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:ae.min_qty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:ae.surcharge_pct?`${ae.surcharge_pct}%`:"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-green-600",children:fa(Ce)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx("button",{onClick:()=>U(ae),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit price",children:t.jsx(ai,{className:"h-4 w-4"})})})]},oe)})})]})})]}),x&&d&&t.jsx(sC,{isOpen:x,onClose:()=>{v(!1),E(null)},onSubmit:V,priceListId:d,item:N||void 0,loading:z.isPending,title:N?"Edit Product Price":"Add Product to Price List"})]})},iC=()=>{const{id:c}=nc(),d=Hr(),[g,x]=le.useState(!1),[v,N]=le.useState("details"),{data:E,isLoading:k,error:n}=RE(c),M=pb(),z=async G=>{if(E)try{await M.mutateAsync({id:E.id,...G}),x(!1)}catch{}},q=G=>new Date(G).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=G=>{switch(G){case"active":return"active";case"end_of_sale":return"credit_hold";case"obsolete":return"closed";default:return"active"}};if(k)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(n||!E)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Product not found or error loading product details."})})})]});const V=E.unit_of_measure==="cylinder"?qf:Gf;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:E.name})]}),t.jsxs("button",{onClick:()=>x(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ai,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Product"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"flex space-x-8 px-6",children:[t.jsxs("button",{onClick:()=>N("details"),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${v==="details"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(fs,{className:"h-4 w-4"}),t.jsx("span",{children:"Product Details"})]}),t.jsxs("button",{onClick:()=>N("pricing"),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${v==="pricing"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx($n,{className:"h-4 w-4"}),t.jsx("span",{children:"Pricing"})]})]})}),t.jsxs("div",{className:"p-6",children:[v==="details"&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Product Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(fs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:E.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"SKU"}),t.jsx("span",{className:"text-gray-900 font-mono",children:E.sku})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Unit of Measure"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(V,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900 capitalize",children:E.unit_of_measure})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),t.jsx(ym,{status:U(E.status),className:"capitalize",children:E.status.replace("_"," ")})]}),E.unit_of_measure==="cylinder"&&t.jsxs(t.Fragment,{children:[E.capacity_kg&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Capacity"}),t.jsxs("span",{className:"text-gray-900",children:[E.capacity_kg," kg"]})]}),E.tare_weight_kg&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Tare Weight"}),t.jsxs("span",{className:"text-gray-900",children:[E.tare_weight_kg," kg"]})]}),E.valve_type&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Valve Type"}),t.jsx("span",{className:"text-gray-900",children:E.valve_type})]})]}),E.barcode_uid&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Barcode/RFID UID"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(UN,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900 font-mono",children:E.barcode_uid})]})]}),E.description&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),t.jsx("p",{className:"text-gray-900",children:E.description})]})]}),E.status==="obsolete"&&t.jsx("div",{className:"mt-6 p-4 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-5 w-5 text-red-600"}),t.jsx("span",{className:"text-sm font-medium text-red-800",children:"This product is marked as obsolete and is no longer available for new orders."})]})})]}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Details"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(E.created_at)})]})]})})]})})]}),v==="pricing"&&t.jsx(rC,{productId:E.id})]})]}),t.jsx(fb,{isOpen:g,onClose:()=>x(!1),onSubmit:z,product:E,loading:M.isPending,title:"Edit Product"})]})},tg=(c={})=>kt.warehouses.list.useQuery(c,{retry:1,staleTime:3e4}),nC=c=>kt.warehouses.get.useQuery({id:c},{enabled:!!c}),aC=()=>kt.warehouses.getStats.useQuery(void 0,{staleTime:6e4}),sg=()=>kt.warehouses.getOptions.useQuery(void 0,{staleTime:3e5}),oC=()=>kt.warehouses.create.useMutation({onSuccess:c=>{console.log("Warehouse created successfully:",c),It.success("Warehouse created successfully")},onError:c=>{console.error("Create warehouse mutation error:",c),It.error(c.message||"Failed to create warehouse")}}),bb=()=>kt.warehouses.update.useMutation({onSuccess:c=>{console.log("Warehouse updated successfully:",c),It.success("Warehouse updated successfully")},onError:c=>{console.error("Update warehouse mutation error:",c),It.error(c.message||"Failed to update warehouse")}}),lC=()=>kt.warehouses.delete.useMutation({onSuccess:(c,d)=>{console.log("Warehouse deleted successfully:",d.id),It.success("Warehouse deleted successfully")},onError:c=>{console.error("Delete warehouse mutation error:",c),It.error(c.message||"Failed to delete warehouse")}}),cC=({warehouses:c,loading:d=!1,onView:g,onEdit:x,onDelete:v})=>{const N=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),E=n=>n?n.toLocaleString()+" cylinders":"-",k=n=>n?[n.city,n.state].filter(Boolean).join(", ")||"Address incomplete":"No address";return console.log("WarehouseTable render:",{warehouses:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading warehouses..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(Gn,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No warehouses found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load warehouses. Please check your connection.":"Get started by adding your first warehouse."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Warehouses (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(n=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx(Gn,{className:"h-5 w-5 text-blue-600"})})}),t.jsx("div",{children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.name})})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Nn,{className:"h-4 w-4 text-gray-400"}),t.jsx("div",{className:"text-sm text-gray-900",children:k(n.address)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:E(n.capacity_cylinders)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(n.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(n),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View warehouse",children:t.jsx(om,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>x(n),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit warehouse",children:t.jsx(ai,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>v(n),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete warehouse",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},n.id))})]})})]})},uC=({filters:c,onFiltersChange:d})=>{const g=v=>{d({...c,search:v.target.value||void 0,page:1})},x=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by warehouse name...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("button",{onClick:x,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{children:"Reset"})]})]})})},vb=({isOpen:c,onClose:d,onSubmit:g,warehouse:x,loading:v=!1,title:N})=>{const[E,k]=le.useState(!0),[n,M]=le.useState(""),[z,q]=le.useState(!1),[U,V]=le.useState(null),[G,H]=le.useState([]),Y=ui.useRef(null),[ge,oe]=le.useState(null),[se,de]=le.useState(null),[ae,Se]=le.useState(!1),{register:Ce,handleSubmit:fe,reset:Ie,setValue:ke,watch:et,formState:{errors:Pe}}=Tn({defaultValues:{name:"",capacity_cylinders:void 0,address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}}),Ne=et("address.latitude"),it=et("address.longitude");le.useEffect(()=>{if(x){const tt=!!x.address;k(tt),Ie({name:x.name,capacity_cylinders:x.capacity_cylinders,address:x.address?{line1:x.address.line1,line2:x.address.line2||"",city:x.address.city,state:x.address.state||"",postal_code:x.address.postal_code||"",country:x.address.country,instructions:x.address.instructions||"",latitude:x.address.latitude,longitude:x.address.longitude}:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}),M(x.address?[x.address.line1,x.address.city,x.address.state,x.address.postal_code,x.address.country].filter(Boolean).join(", "):"")}else k(!0),Ie({name:"",capacity_cylinders:void 0,address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}),M("")},[x,Ie]),le.useEffect(()=>{let tt=!0;return n&&n.length>=3?(q(!0),ob(n,q).then(Mt=>{tt&&H(Mt||[])})):(H([]),q(!1)),()=>{tt=!1}},[n]),le.useEffect(()=>{if(!ge&&Y.current&&Ne&&it){hi.accessToken=void 0;const tt=new hi.Map({container:Y.current,style:"mapbox://styles/mapbox/streets-v11",center:[it,Ne],zoom:14});tt.addControl(new hi.NavigationControl,"top-right"),oe(tt);const Mt=new hi.Marker({anchor:"center",draggable:ae}).setLngLat([it,Ne]).addTo(tt);de(Mt),Mt.on("dragend",()=>{const Tt=Mt.getLngLat();ke("address.latitude",Tt.lat),ke("address.longitude",Tt.lng)}),tt.on("load",()=>{tt.resize()})}},[Y,Ne,it]),le.useEffect(()=>{ge&&se&&Ne&&it&&(se.setLngLat([it,Ne]),se.setDraggable(ae),ge.setCenter([it,Ne]),ge.setZoom(14),ge.resize())},[Ne,it,ae,ge,se]),le.useEffect(()=>()=>{se&&se.remove(),ge&&ge.remove()},[]);const ft=tt=>{g(tt)};return lb(),c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:fe(ft),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Warehouse Name *"}),t.jsx("input",{type:"text",id:"name",...Ce("name",{required:"Warehouse name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Main Depot"}),Pe.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:Pe.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_cylinders",className:"block text-sm font-medium text-gray-700",children:"Storage Capacity (cylinders)"}),t.jsx("input",{type:"number",min:"1",id:"capacity_cylinders",...Ce("capacity_cylinders",{valueAsNumber:!0,min:{value:1,message:"Capacity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"1000"}),Pe.capacity_cylinders&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:Pe.capacity_cylinders.message})]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Location"})}),E&&t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("label",{htmlFor:"addressInput",className:"block text-sm font-medium text-gray-700",children:"Address *"}),t.jsx("input",{type:"text",id:"addressInput",value:n,onChange:tt=>{M(tt.target.value),V(null)},className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Start typing address..."}),z&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Searching..."}),G.length>0&&!U&&t.jsx("ul",{className:"border border-gray-200 rounded bg-white mt-1 max-h-48 overflow-y-auto z-10 relative",children:G.map((tt,Mt)=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-50",onClick:()=>{V(tt),M(tt.display_name),ke("address.line1",tt.address_line1||""),ke("address.line2",tt.address_line2||""),ke("address.city",tt.city||""),ke("address.state",tt.state||""),ke("address.postal_code",tt.postal_code||""),ke("address.country",tt.country||""),ke("address.latitude",tt.lat),ke("address.longitude",tt.lng)},children:tt.display_name},Mt))}),U&&t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Address selected"}),Ne&&it&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{ref:Y,style:{width:"100%",height:200,borderRadius:8,overflow:"hidden",position:"relative"}}),t.jsx("div",{className:"flex justify-end mt-2",children:ae?t.jsx("button",{type:"button",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",onClick:()=>Se(!1),children:"Save Pin Location"}):t.jsx("button",{type:"button",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs",onClick:()=>Se(!0),children:"Adjust Pin"})})]}),t.jsx("label",{htmlFor:"address.instructions",className:"block text-sm font-medium text-gray-700 mt-4",children:"Access Instructions"}),t.jsx("textarea",{rows:2,...Ce("address.instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate codes, special access requirements, loading dock information..."})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse",children:[t.jsxs("button",{type:"submit",className:"inline-flex w-full justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",disabled:v,children:[v?t.jsx(tr,{className:"animate-spin h-5 w-5 mr-2"}):null,"Save"]}),t.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:d,children:"Cancel"})]})]})})]})}):null},dC=()=>{const{data:c,isLoading:d}=aC();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(3)].map((x,v)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},v))})]})});if(!c)return null;const g=[{name:"Total Warehouses",value:c.total,icon:Gn,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Total Capacity",value:c.total_capacity.toLocaleString()+" cylinders",icon:Ko,color:"text-green-600",bgColor:"bg-green-50"},{name:"Average Capacity",value:c.average_capacity.toLocaleString()+" cylinders",icon:ic,color:"text-purple-600",bgColor:"bg-purple-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Warehouse Overview"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:g.map(x=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${x.bgColor} mb-2`,children:t.jsx(x.icon,{className:`h-6 w-6 ${x.color}`})}),t.jsx("div",{className:"text-lg font-bold text-gray-900",children:x.value}),t.jsx("div",{className:"text-sm text-gray-600",children:x.name})]},x.name))})]})},hC=()=>{const c=Hr(),[d,g]=le.useState({page:1}),[x,v]=le.useState(!1),[N,E]=le.useState(null),[k,n]=le.useState(null),{data:M,isLoading:z,error:q,refetch:U}=tg(d),V=oC(),G=bb(),H=lC();le.useEffect(()=>{console.log("WarehousesPage state:",{filters:d,data:M,isLoading:z,error:q,isFormOpen:x,editingWarehouse:N})},[d,M,z,q,x,N]);const Y=()=>{console.log("Adding new warehouse"),E(null),v(!0)},ge=fe=>{console.log("Editing warehouse:",fe),E(fe),v(!0)},oe=fe=>{console.log("Viewing warehouse:",fe),c(`/warehouses/${fe.id}`)},se=fe=>{console.log("Deleting warehouse:",fe),n(fe)},de=async fe=>{console.log("Form submit:",fe);try{N?await G.mutateAsync({id:N.id,...fe}):await V.mutateAsync(fe),v(!1),E(null)}catch(Ie){console.error("Form submit error:",Ie)}},ae=async()=>{if(k){console.log("Confirming delete:",k);try{await H.mutateAsync(k.id),n(null)}catch(fe){console.error("Delete error:",fe)}}},Se=fe=>{console.log("Page change:",fe),g(Ie=>({...Ie,page:fe}))},Ce=()=>{console.log("Refreshing warehouses"),U()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Warehouses"}),t.jsx("p",{className:"text-gray-600",children:"Manage storage facilities and inventory locations"}),q&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",q.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Ce,disabled:z,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(tl,{className:`h-4 w-4 ${z?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:Y,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Warehouse"})]})]})]}),t.jsx(dC,{}),t.jsx(uC,{filters:d,onFiltersChange:g}),t.jsx(cC,{warehouses:(M==null?void 0:M.warehouses)||[],loading:z,onView:oe,onEdit:ge,onDelete:se}),M&&M.totalPages>1&&t.jsx(ac,{currentPage:M.currentPage,totalPages:M.totalPages,totalCount:M.totalCount,onPageChange:Se}),t.jsx(vb,{isOpen:x,onClose:()=>{console.log("Closing form"),v(!1),E(null)},onSubmit:de,warehouse:N||void 0,loading:V.isPending||G.isPending,title:N?"Edit Warehouse":"Add New Warehouse"}),t.jsx(ro,{isOpen:!!k,onClose:()=>n(null),onConfirm:ae,title:"Delete Warehouse",message:`Are you sure you want to delete "${k==null?void 0:k.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:H.isPending})]})},mC=(c={})=>kt.inventory.list.useQuery({warehouse_id:c.warehouse_id,product_id:c.product_id,low_stock_only:c.low_stock_only||!1},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Inventory fetch error:",d),It.error("Failed to load inventory")}}),wb=c=>kt.inventory.getByWarehouse.useQuery({warehouse_id:c},{enabled:!!c,staleTime:3e4,retry:1,onError:d=>{console.error("Warehouse inventory fetch error:",d),It.error("Failed to load warehouse inventory")}}),pC=c=>kt.inventory.getStats.useQuery({warehouse_id:c},{enabled:!0,staleTime:6e4,retry:1,onError:d=>{console.error("Inventory stats fetch error:",d),It.error("Failed to load inventory statistics")}}),fC=()=>{const c=kt.useContext();return kt.inventory.adjustStock.useMutation({onSuccess:d=>{console.log("Stock adjusted successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Stock levels updated successfully")},onError:d=>{console.error("Stock adjustment error:",d),It.error(d.message||"Failed to adjust stock levels")}})},gC=()=>{const c=kt.useContext();return kt.inventory.transferStock.useMutation({onSuccess:d=>{console.log("Stock transferred successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Stock transferred successfully")},onError:d=>{console.error("Stock transfer error:",d),It.error(d.message||"Failed to transfer stock")}})},xC=()=>{const c=kt.useContext();return kt.inventory.create.useMutation({onSuccess:d=>{console.log("Inventory balance created successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Inventory balance created successfully")},onError:d=>{console.error("Create inventory error:",d),It.error(d.message||"Failed to create inventory balance")}})},uf={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_URL:"/api/v1/trpc",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRyY3JqaW5yZGpnaXpxaGpkZ3ZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNDE2NTAsImV4cCI6MjA2NDYxNzY1MH0.2-y5r5UzIfcGoHc6BPkRy5rnxWxl4SJwxUehPWBxAao",VITE_SUPABASE_URL:"https://trcrjinrdjgizqhjdgvc.supabase.co"},yC=()=>{var Y,ge;const{id:c}=nc(),d=Hr(),[g,x]=le.useState(!1),v=le.useRef(null),[N,E]=le.useState(null),{data:k,isLoading:n,error:M}=nC(c),{data:z=[],isLoading:q}=wb(c),U=bb(),V=async oe=>{if(k)try{await U.mutateAsync({id:k.id,...oe}),x(!1)}catch{}},G=oe=>new Date(oe).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),H=oe=>oe?oe.toLocaleString()+" cylinders":"Not specified";return le.useEffect(()=>{var se,de;if(!((se=k==null?void 0:k.address)!=null&&se.latitude)||!((de=k==null?void 0:k.address)!=null&&de.longitude)||!v.current)return;const oe=uf==null?void 0:uf.VITE_MAPBOX_API_KEY;if(!oe){console.warn("Mapbox access token not found");return}if(N){try{N.remove()}catch(ae){console.warn("Error removing existing map:",ae)}E(null)}try{hi.accessToken=oe;const ae=new hi.Map({container:v.current,style:"mapbox://styles/mapbox/streets-v11",center:[k.address.longitude,k.address.latitude],zoom:14});ae.addControl(new hi.NavigationControl,"top-right"),new hi.Marker({anchor:"center"}).setLngLat([k.address.longitude,k.address.latitude]).addTo(ae),ae.on("load",()=>{try{ae.resize()}catch(Se){console.warn("Error resizing map:",Se)}}),E(ae)}catch(ae){console.error("Error initializing map:",ae)}},[(Y=k==null?void 0:k.address)==null?void 0:Y.latitude,(ge=k==null?void 0:k.address)==null?void 0:ge.longitude]),le.useEffect(()=>()=>{if(N){try{N.remove()}catch(oe){console.warn("Error cleaning up map:",oe)}E(null)}},[N]),n?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]}):M||!k?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Warehouse not found or error loading warehouse details."})})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:k.name})]}),t.jsxs("button",{onClick:()=>x(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ai,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Warehouse"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Warehouse Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Warehouse Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:k.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Storage Capacity"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(fs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:H(k.capacity_cylinders)})]})]})]})]}),k.address&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Location"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Physical Address"}),t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Nn,{className:"h-4 w-4 text-gray-400 mt-0.5"}),t.jsxs("div",{className:"text-gray-900",children:[t.jsx("div",{children:k.address.line1}),k.address.line2&&t.jsx("div",{children:k.address.line2}),t.jsxs("div",{children:[k.address.city,k.address.state&&`, ${k.address.state}`,k.address.postal_code&&` ${k.address.postal_code}`]}),t.jsx("div",{children:k.address.country})]})]})]}),k.address.latitude&&k.address.longitude&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-2",children:"Map Location"}),t.jsx("div",{ref:v,className:"w-full h-64 rounded-lg border border-gray-300",style:{minHeight:"256px"}})]}),k.address.instructions&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Access Instructions"}),t.jsx("p",{className:"text-gray-900",children:k.address.instructions})]})]})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Details"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:G(k.created_at)})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Inventory"}),q?t.jsx("div",{className:"flex justify-center py-4",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):z.length>0?t.jsx("div",{className:"space-y-3",children:z.map(oe=>{var se,de,ae;return t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-900",children:(se=oe.product)==null?void 0:se.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",(de=oe.product)==null?void 0:de.sku]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(fs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm font-medium text-gray-600",children:(ae=oe.product)==null?void 0:ae.unit_of_measure})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center border border-green-200",children:[t.jsx("div",{className:"text-2xl font-bold text-green-700",children:oe.qty_full}),t.jsx("div",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Full"})]}),t.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 text-center border border-gray-300",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-700",children:oe.qty_empty}),t.jsx("div",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Empty"})]}),t.jsxs("div",{className:`rounded-lg p-3 text-center border ${oe.qty_reserved>0?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}`,children:[t.jsx("div",{className:`text-2xl font-bold ${oe.qty_reserved>0?"text-yellow-700":"text-blue-700"}`,children:oe.qty_reserved}),t.jsx("div",{className:`text-xs font-medium uppercase tracking-wide ${oe.qty_reserved>0?"text-yellow-600":"text-blue-600"}`,children:"Reserved"})]})]}),t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-gray-500",children:"Available:"}),t.jsxs("span",{className:"font-semibold text-gray-900",children:[oe.qty_full-oe.qty_reserved," units"]})]})})]},oe.id)})}):t.jsxs("div",{className:"text-center py-4",children:[t.jsx(fs,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"This warehouse has no inventory yet."})]})]})]})]}),t.jsx(vb,{isOpen:g,onClose:()=>x(!1),onSubmit:V,warehouse:k,loading:U.isPending,title:"Edit Warehouse"})]})},_C=({inventory:c,loading:d=!1,onAdjustStock:g,onTransferStock:x})=>{const v=k=>new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=k=>k===0?"text-red-600 bg-red-50":k<=10?"text-yellow-600 bg-yellow-50":"text-green-600 bg-green-50",E=k=>k===0?t.jsx($s,{className:"h-4 w-4"}):k<=10?t.jsx($s,{className:"h-4 w-4"}):null;return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading inventory..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(fs,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No inventory found"}),t.jsx("p",{className:"text-gray-500",children:"No inventory records found for the selected filters."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Inventory (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reserved"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Available"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(k=>{var q,U,V;const n=k.qty_full-k.qty_reserved,M=N(n),z=E(n);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((q=k.product)==null?void 0:q.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((U=k.product)==null?void 0:U.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:((V=k.warehouse)==null?void 0:V.name)||"Unknown Warehouse"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:k.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:k.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:k.qty_reserved})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-sm font-medium ${M}`,children:[z,t.jsx("span",{children:n})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v(k.updated_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(k),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Adjust stock",children:t.jsx(ai,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>x(k),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors",title:"Transfer stock",children:t.jsx(g_,{className:"h-4 w-4"})})]})})]},k.id)})})]})})]})},Jh=({value:c,onChange:d,placeholder:g="Select warehouse...",className:x="",required:v=!1})=>{const{data:N,isLoading:E}=sg();return E?t.jsx("div",{className:`relative ${x}`,children:t.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:[t.jsx(Gn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-500",children:"Loading warehouses..."})]})}):t.jsx("div",{className:`relative ${x}`,children:t.jsxs("div",{className:"relative",children:[t.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c||"",onChange:k=>d(k.target.value),required:v,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:g}),N==null?void 0:N.map(k=>t.jsx("option",{value:k.id,children:k.city&&k.state?`${k.name} (${k.city}, ${k.state})`:k.name},k.id))]}),t.jsx(am,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"})]})})},bC=({filters:c,onFiltersChange:d})=>{const g=E=>{d({...c,search:E.target.value||void 0,page:1})},x=E=>{d({...c,warehouse_id:E||void 0,page:1})},v=()=>{d({...c,low_stock_only:!c.low_stock_only,page:1})},N=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by product SKU or name...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-64",children:t.jsx(Jh,{value:c.warehouse_id,onChange:x,placeholder:"All Warehouses"})}),t.jsxs("button",{onClick:v,className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${c.low_stock_only?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,children:[t.jsx($s,{className:"h-4 w-4"}),t.jsx("span",{children:"Low Stock Only"})]}),t.jsxs("button",{onClick:N,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},vC=()=>{const{data:c,isLoading:d}=pC();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[...Array(6)].map((x,v)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},v))})]})});if(!c)return null;const g=[{name:"Total Cylinders",value:c.total_cylinders.toLocaleString(),icon:fs,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Full Cylinders",value:c.total_full.toLocaleString(),icon:pa,color:"text-green-600",bgColor:"bg-green-50"},{name:"Empty Cylinders",value:c.total_empty.toLocaleString(),icon:$N,color:"text-gray-600",bgColor:"bg-gray-50"},{name:"Reserved",value:c.total_reserved.toLocaleString(),icon:KN,color:"text-orange-600",bgColor:"bg-orange-50"},{name:"Available",value:c.total_available.toLocaleString(),icon:Sn,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"Low Stock Items",value:c.low_stock_products.toLocaleString(),icon:$s,color:"text-red-600",bgColor:"bg-red-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Inventory Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:g.map(x=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${x.bgColor} mb-2`,children:t.jsx(x.icon,{className:`h-6 w-6 ${x.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.value}),t.jsx("div",{className:"text-sm text-gray-600",children:x.name})]},x.name))})]})},wC=({isOpen:c,onClose:d,onSubmit:g,inventory:x,loading:v=!1})=>{var H,Y;const{register:N,handleSubmit:E,reset:k,watch:n,formState:{errors:M}}=Tn({defaultValues:{inventory_id:x.id,adjustment_type:"physical_count",qty_full_change:0,qty_empty_change:0,reason:""}}),z=n("qty_full_change")||0,q=n("qty_empty_change")||0;le.useEffect(()=>{x&&k({inventory_id:x.id,adjustment_type:"physical_count",qty_full_change:0,qty_empty_change:0,reason:""})},[x,k]);const U=ge=>{g(ge)},V=x.qty_full+z,G=x.qty_empty+q;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:E(U),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Adjust Stock"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Current Stock Levels"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.qty_full}),t.jsx("div",{className:"text-sm text-gray-600",children:"Full Cylinders"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-600",children:x.qty_empty}),t.jsx("div",{className:"text-sm text-gray-600",children:"Empty Cylinders"})]})]}),t.jsxs("div",{className:"mt-3 text-center",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Product: ",t.jsx("span",{className:"font-medium",children:(H=x.product)==null?void 0:H.name})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Warehouse: ",t.jsx("span",{className:"font-medium",children:(Y=x.warehouse)==null?void 0:Y.name})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"adjustment_type",className:"block text-sm font-medium text-gray-700",children:"Adjustment Type *"}),t.jsxs("select",{id:"adjustment_type",...N("adjustment_type",{required:"Adjustment type is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"received_full",children:"Received Full Cylinders"}),t.jsx("option",{value:"received_empty",children:"Received Empty Cylinders"}),t.jsx("option",{value:"physical_count",children:"Physical Count Adjustment"}),t.jsx("option",{value:"damage_loss",children:"Damage/Loss"}),t.jsx("option",{value:"other",children:"Other"})]}),M.adjustment_type&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.adjustment_type.message})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_full_change",className:"block text-sm font-medium text-gray-700",children:"Full Cylinders Change"}),t.jsx("input",{type:"number",id:"qty_full_change",...N("qty_full_change",{valueAsNumber:!0,validate:ge=>x.qty_full+(ge||0)<0?"Cannot result in negative quantity":!0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),M.qty_full_change&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.qty_full_change.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_empty_change",className:"block text-sm font-medium text-gray-700",children:"Empty Cylinders Change"}),t.jsx("input",{type:"number",id:"qty_empty_change",...N("qty_empty_change",{valueAsNumber:!0,validate:ge=>x.qty_empty+(ge||0)<0?"Cannot result in negative quantity":!0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),M.qty_empty_change&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.qty_empty_change.message})]})]}),(z!==0||q!==0)&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"Resulting Stock Levels"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:V}),z>0&&t.jsx(Sn,{className:"h-4 w-4 text-green-600"}),z<0&&t.jsx(Xy,{className:"h-4 w-4 text-red-600"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Full Cylinders"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:G}),q>0&&t.jsx(Sn,{className:"h-4 w-4 text-green-600"}),q<0&&t.jsx(Xy,{className:"h-4 w-4 text-red-600"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Empty Cylinders"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700",children:"Reason/Notes *"}),t.jsx("textarea",{id:"reason",rows:3,...N("reason",{required:"Reason is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Explain the reason for this stock adjustment..."}),M.reason&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.reason.message})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:v,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:v?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Adjusting..."})]}):"Adjust Stock"}),t.jsx("button",{type:"button",onClick:d,disabled:v,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},jC=({isOpen:c,onClose:d,onSubmit:g,inventory:x,loading:v=!1})=>{var Y,ge,oe;const{register:N,handleSubmit:E,reset:k,watch:n,setValue:M,formState:{errors:z}}=Tn({defaultValues:{from_warehouse_id:x.warehouse_id,to_warehouse_id:"",product_id:x.product_id,qty_full:0,qty_empty:0,notes:""}}),q=n("qty_full")||0,U=n("qty_empty")||0,V=n("to_warehouse_id");le.useEffect(()=>{x&&k({from_warehouse_id:x.warehouse_id,to_warehouse_id:"",product_id:x.product_id,qty_full:0,qty_empty:0,notes:""})},[x,k]);const G=se=>{g(se)},H=se=>{M("to_warehouse_id",se)};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:E(G),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Transfer Stock"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Product Information"}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Product:"})," ",(Y=x.product)==null?void 0:Y.name]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"SKU:"})," ",(ge=x.product)==null?void 0:ge.sku]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"From Warehouse"}),t.jsx("div",{className:"text-sm text-blue-800 font-medium",children:(oe=x.warehouse)==null?void 0:oe.name}),t.jsxs("div",{className:"mt-2 space-y-1 text-xs text-blue-700",children:[t.jsxs("div",{children:["Full: ",x.qty_full]}),t.jsxs("div",{children:["Empty: ",x.qty_empty]})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(BN,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"To Warehouse"}),t.jsx(Jh,{value:V,onChange:H,placeholder:"Select destination...",className:"w-full",required:!0}),z.to_warehouse_id&&t.jsx("p",{className:"mt-1 text-xs text-red-600",children:"Destination warehouse is required"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Transfer Quantities"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_full",className:"block text-sm font-medium text-gray-700",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",max:x.qty_full,id:"qty_full",...N("qty_full",{valueAsNumber:!0,min:{value:0,message:"Quantity must be positive"},max:{value:x.qty_full,message:`Cannot exceed available quantity (${x.qty_full})`}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Available: ",x.qty_full]}),z.qty_full&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.qty_full.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_empty",className:"block text-sm font-medium text-gray-700",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",max:x.qty_empty,id:"qty_empty",...N("qty_empty",{valueAsNumber:!0,min:{value:0,message:"Quantity must be positive"},max:{value:x.qty_empty,message:`Cannot exceed available quantity (${x.qty_empty})`}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Available: ",x.qty_empty]}),z.qty_empty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.qty_empty.message})]})]}),(q>0||U>0)&&t.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsxs("div",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Transfer Summary:"})," ",q," full + ",U," empty cylinders"]})})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Transfer Notes"}),t.jsx("textarea",{id:"notes",rows:3,...N("notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional notes about this transfer..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:v||!V||q===0&&U===0,className:"inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:v?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Transferring..."})]}):"Transfer Stock"}),t.jsx("button",{type:"button",onClick:d,disabled:v,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},NC=()=>{const[c,d]=le.useState({page:1}),[g,x]=le.useState(null),[v,N]=le.useState(null),[E,k]=le.useState(!1),{data:n,isLoading:M,error:z,refetch:q}=mC(c),{data:U}=cc({limit:1e3}),{data:V}=tg({limit:1e3}),G=fC(),H=gC(),Y=xC(),ge=(U==null?void 0:U.products)||[],oe=(V==null?void 0:V.warehouses)||[];le.useEffect(()=>{console.log("InventoryPage state:",{filters:c,data:n,isLoading:M,error:z,adjustingInventory:g,transferringInventory:v})},[c,n,M,z,g,v]);const se=et=>{console.log("Adjusting stock for:",et),x(et)},de=et=>{console.log("Transferring stock for:",et),N(et)},ae=()=>{console.log("Adding new stock"),k(!0)},Se=async et=>{console.log("Adjustment submit:",et);try{await G.mutateAsync(et),x(null)}catch(Pe){console.error("Adjustment error:",Pe)}},Ce=async et=>{console.log("Transfer submit:",et);try{await H.mutateAsync(et),N(null)}catch(Pe){console.error("Transfer error:",Pe)}},fe=async et=>{console.log("Add stock submit:",et);try{await Y.mutateAsync(et),k(!1)}catch(Pe){console.error("Add stock error:",Pe)}},Ie=et=>{console.log("Page change:",et),d(Pe=>({...Pe,page:et}))},ke=()=>{console.log("Refreshing inventory"),q()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),t.jsx("p",{className:"text-gray-600",children:"Track stock levels across all warehouses"}),z&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",z.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:ke,disabled:M,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(tl,{className:`h-4 w-4 ${M?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:ae,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",title:"Add new inventory record",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Stock"})]})]})]}),t.jsx(vC,{}),t.jsx(bC,{filters:c,onFiltersChange:d}),t.jsx(_C,{inventory:(n==null?void 0:n.inventory)||[],loading:M,onAdjustStock:se,onTransferStock:de}),n&&n.totalPages>1&&t.jsx(ac,{currentPage:n.currentPage,totalPages:n.totalPages,totalCount:n.totalCount,onPageChange:Ie}),g&&t.jsx(wC,{isOpen:!!g,onClose:()=>x(null),onSubmit:Se,inventory:g,loading:G.isPending}),v&&t.jsx(jC,{isOpen:!!v,onClose:()=>N(null),onSubmit:Ce,inventory:v,loading:H.isPending}),E&&t.jsx(SC,{isOpen:E,onClose:()=>k(!1),onSubmit:fe,products:ge,warehouses:oe,loading:Y.isPending})]})},SC=({isOpen:c,onClose:d,onSubmit:g,products:x,warehouses:v,loading:N=!1})=>{const[E,k]=le.useState({warehouse_id:"",product_id:"",qty_full:0,qty_empty:0,qty_reserved:0}),n=z=>{z.preventDefault(),E.warehouse_id&&E.product_id&&g(E)},M=(z,q)=>{k(U=>({...U,[z]:q}))};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:n,children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Add New Stock Record"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(vr,{className:"h-6 w-6 rotate-45"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warehouse *"}),t.jsxs("select",{value:E.warehouse_id,onChange:z=>M("warehouse_id",z.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select a warehouse..."}),v.map(z=>t.jsx("option",{value:z.id,children:z.name},z.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product *"}),t.jsxs("select",{value:E.product_id,onChange:z=>M("product_id",z.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select a product..."}),x.filter(z=>z.status==="active").map(z=>t.jsxs("option",{value:z.id,children:[z.name," (",z.sku,")"]},z.id))]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:E.qty_full,onChange:z=>M("qty_full",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:E.qty_empty,onChange:z=>M("qty_empty",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reserved Cylinders"}),t.jsx("input",{type:"number",min:"0",max:E.qty_full,value:E.qty_reserved,onChange:z=>M("qty_reserved",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Cannot exceed full cylinders quantity"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||!E.warehouse_id||!E.product_id,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Adding...":"Add Stock Record"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},TC=({priceLists:c,loading:d=!1,onView:g,onEdit:x,onDuplicate:v,onSetDefault:N,onDelete:E})=>{const k=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading price lists..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx($n,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No price lists found"}),t.jsx("p",{className:"text-gray-500",children:"Get started by creating your first price list."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Price Lists (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price List"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Currency"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Range"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Products"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(n=>{const M=Qh(n.start_date,n.end_date),z=tC(n.end_date);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>g(n),className:"text-sm font-medium text-blue-600 hover:text-blue-900 hover:underline",children:n.name}),n.is_default&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx($h,{className:"h-3 w-3 mr-1"}),"Default"]}),z&&t.jsx($s,{className:"h-4 w-4 text-yellow-500",title:"Expiring soon"})]}),n.description&&t.jsx("div",{className:"text-sm text-gray-500 mt-1 max-w-xs truncate",children:n.description})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900 font-mono",children:fa(n.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-4 w-4 text-gray-400"}),t.jsx("div",{className:"text-sm text-gray-900",children:_b(n.start_date,n.end_date)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${M.color}`,children:M.label})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.product_count||0})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:k(n.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>x(n),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit price list",children:t.jsx(ai,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>v(n),className:"text-purple-600 hover:text-purple-900 p-1 rounded hover:bg-purple-50 transition-colors",title:"Duplicate price list",children:t.jsx(GN,{className:"h-4 w-4"})}),!n.is_default&&t.jsx("button",{onClick:()=>N(n),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors",title:"Set as default",children:t.jsx($h,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>E(n),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete price list",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},n.id)})})]})})]})},EC=({filters:c,onFiltersChange:d})=>{const g=N=>{d({...c,search:N.target.value||void 0,page:1})},x=N=>{d({...c,status:N.target.value||void 0,page:1})},v=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name or description...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-32",children:t.jsxs("div",{className:"relative",children:[t.jsx(er,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:x,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"future",children:"Future"}),t.jsx("option",{value:"expired",children:"Expired"})]})]})}),t.jsxs("button",{onClick:v,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},jb=({isOpen:c,onClose:d,onSubmit:g,priceList:x,loading:v=!1,title:N})=>{const{register:E,handleSubmit:k,reset:n,watch:M,formState:{errors:z}}=Tn({defaultValues:{name:"",description:"",currency_code:"KES",start_date:new Date().toISOString().split("T")[0],end_date:"",is_default:!1}}),q=M("start_date"),U=M("end_date"),V=M("is_default");le.useEffect(()=>{n(x?{name:x.name,description:x.description||"",currency_code:"KES",start_date:x.start_date,end_date:x.end_date||"",is_default:x.is_default}:{name:"",description:"",currency_code:"KES",start_date:new Date().toISOString().split("T")[0],end_date:"",is_default:!1})},[x,n]);const G=Y=>{const ge={...Y,currency_code:"KES",end_date:Y.end_date||void 0,description:Y.description||void 0};g(ge)},H=!U||eC(q,U);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:k(G),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Price List Name *"}),t.jsx("input",{type:"text",id:"name",...E("name",{required:"Price list name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Standard 2025"}),z.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...E("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional description of this price list..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"currency_code",className:"block text-sm font-medium text-gray-700",children:"Currency"}),t.jsx("div",{className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm bg-gray-50",children:t.jsx("span",{className:"text-gray-900",children:"KES - Kenyan Shilling (KSh)"})}),t.jsx("input",{type:"hidden",...E("currency_code"),value:"KES"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:"Start Date *"}),t.jsx("input",{type:"date",id:"start_date",...E("start_date",{required:"Start date is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.start_date&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.start_date.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:"End Date"}),t.jsx("input",{type:"date",id:"end_date",...E("end_date"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave empty for no end date"})]})]}),!H&&t.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:"End date must be after start date"})]})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"is_default",...E("is_default"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"is_default",className:"ml-2 block text-sm text-gray-900",children:"Set as default price list"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Only one price list can be set as default at a time"}),V&&t.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsx("p",{className:"text-xs text-yellow-800",children:"Setting this as default will unset any existing default price list"})})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:v||!H,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:v?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Price List"}),t.jsx("button",{type:"button",onClick:d,disabled:v,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},CC=()=>{const{data:c,isLoading:d}=JE();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[...Array(6)].map((x,v)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},v))})]})});if(!c)return null;const g=[{name:"Total Price Lists",value:c.total_price_lists,icon:$n,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Active",value:c.active_price_lists,icon:pa,color:"text-green-600",bgColor:"bg-green-50"},{name:"Future",value:c.future_price_lists,icon:Ki,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Expired",value:c.expired_price_lists,icon:Qa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Expiring Soon",value:c.expiring_soon,icon:$s,color:"text-yellow-600",bgColor:"bg-yellow-50"},{name:"No Pricing",value:c.products_without_pricing,icon:fs,color:"text-gray-600",bgColor:"bg-gray-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Pricing Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:g.map(x=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${x.bgColor} mb-2`,children:t.jsx(x.icon,{className:`h-6 w-6 ${x.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.value}),t.jsx("div",{className:"text-sm text-gray-600",children:x.name})]},x.name))})]})},kC=()=>{const c=Hr(),[d,g]=le.useState({page:1}),[x,v]=le.useState(!1),[N,E]=le.useState(null),[k,n]=le.useState(null),{data:M,isLoading:z,error:q,refetch:U}=eg(d),V=QE(),G=gb();le.useEffect(()=>{console.log("PricingPage state:",{filters:d,data:M,isLoading:z,error:q,isFormOpen:x,editingPriceList:N})},[d,M,z,q,x,N]);const H=()=>{console.log("Adding new price list"),E(null),v(!0)},Y=Ie=>{console.log("Editing price list:",Ie),E(Ie),v(!0)},ge=Ie=>{console.log("Viewing price list:",Ie),c(`/pricing/${Ie.id}`)},oe=Ie=>{console.log("Duplicating price list:",Ie),E({...Ie,id:"",name:`Copy of ${Ie.name}`,is_default:!1}),v(!0)},se=async Ie=>{console.log("Setting default price list:",Ie),alert("Set default price list functionality is temporarily disabled")},de=Ie=>{console.log("Deleting price list:",Ie),n(Ie)},ae=async Ie=>{console.log("Form submit:",Ie);try{N!=null&&N.id?await G.mutateAsync({id:N.id,...Ie}):await V.mutateAsync(Ie),v(!1),E(null)}catch(ke){console.error("Form submit error:",ke)}},Se=async()=>{k&&(console.log("Confirming delete:",k),alert("Delete price list functionality is temporarily disabled"),n(null))},Ce=Ie=>{console.log("Page change:",Ie),g(ke=>({...ke,page:Ie}))},fe=()=>{console.log("Refreshing price lists"),U()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Price Catalog"}),t.jsx("p",{className:"text-gray-600",children:"Manage pricing for your products across different markets"}),q&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",q.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:fe,disabled:z,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(tl,{className:`h-4 w-4 ${z?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:H,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Create Price List"})]})]})]}),t.jsx(CC,{}),t.jsx(EC,{filters:d,onFiltersChange:g}),t.jsx(TC,{priceLists:(M==null?void 0:M.priceLists)||[],loading:z,onView:ge,onEdit:Y,onDuplicate:oe,onSetDefault:se,onDelete:de}),M&&M.totalPages>1&&t.jsx(ac,{currentPage:M.currentPage,totalPages:M.totalPages,totalCount:M.totalCount,onPageChange:Ce}),t.jsx(jb,{isOpen:x,onClose:()=>{console.log("Closing form"),v(!1),E(null)},onSubmit:ae,priceList:N||void 0,loading:V.isPending||G.isPending,title:N!=null&&N.id?"Edit Price List":"Create New Price List"}),t.jsx(ro,{isOpen:!!k,onClose:()=>n(null),onConfirm:Se,title:"Delete Price List",message:`Are you sure you want to delete "${k==null?void 0:k.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:!1})]})},AC=({isOpen:c,onClose:d,onSubmit:g,priceList:x,loading:v=!1})=>{const[N,E]=le.useState([]),[k,n]=le.useState({}),[M,z]=le.useState(""),{data:q}=cc({limit:1e3}),{data:U=[]}=xb(x.id),V=(q==null?void 0:q.products)||[],G=U.map(de=>de.product_id),H=V.filter(de=>de.status==="active"&&!G.includes(de.id)&&(M===""||de.name.toLowerCase().includes(M.toLowerCase())||de.sku.toLowerCase().includes(M.toLowerCase())));le.useEffect(()=>{c||(E([]),n({}),z(""))},[c]);const Y=(de,ae)=>{if(ae){const Se=H.find(Ce=>Ce.id===de);Se&&(E(Ce=>[...Ce,de]),n(Ce=>({...Ce,[de]:{productId:de,productName:Se.name,productSku:Se.sku,unitPrice:0,minQty:1,surchargeRate:void 0}})))}else E(Se=>Se.filter(Ce=>Ce!==de)),n(Se=>{const Ce={...Se};return delete Ce[de],Ce})},ge=(de,ae,Se)=>{n(Ce=>({...Ce,[de]:{...Ce[de],[ae]:Se}}))},oe=()=>{const de=Object.values(k).filter(ae=>ae.unitPrice>0);de.length!==0&&g(de)},se=N.length>0&&N.every(de=>{var ae;return((ae=k[de])==null?void 0:ae.unitPrice)>0});return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:["Add Products to: ",x.name]}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search products by name or SKU...",value:M,onChange:de=>z(de.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:["Select Products (",H.length," available)"]}),t.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:H.length>0?t.jsx("div",{className:"divide-y divide-gray-200",children:H.map(de=>t.jsx("div",{className:"p-3 hover:bg-gray-50",children:t.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:N.includes(de.id),onChange:ae=>Y(de.id,ae.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:de.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",de.sku,"  ",de.unit_of_measure,de.capacity_kg&&`  ${de.capacity_kg}kg`]})]})]})},de.id))}):t.jsxs("div",{className:"p-8 text-center",children:[t.jsx(fs,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500",children:M?"No products found matching your search.":"All products are already in this price list."})]})})]}),N.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Set Prices for Selected Products"}),t.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:N.map(de=>{const ae=k[de];return ae?t.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gray-50",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("h5",{className:"font-medium text-gray-900",children:ae.productName}),t.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",ae.productSku]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Unit Price (",x.currency_code,") *"]}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:ae.unitPrice||"",onChange:Se=>ge(de,"unitPrice",parseFloat(Se.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Quantity"}),t.jsx("input",{type:"number",min:"1",value:ae.minQty,onChange:Se=>ge(de,"minQty",parseInt(Se.target.value)||1),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Surcharge (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:ae.surchargeRate||"",onChange:Se=>ge(de,"surchargeRate",parseFloat(Se.target.value)||void 0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"})]})]}),ae.unitPrice>0&&t.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded",children:t.jsxs("span",{className:"text-sm text-blue-800",children:["Final Price: ",fa(ae.surchargeRate?ae.unitPrice*(1+ae.surchargeRate/100):ae.unitPrice,x.currency_code)]})})]},de):null})})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:oe,disabled:v||!se,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:v?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Adding..."})]}):`Add ${N.length} Product${N.length!==1?"s":""}`}),t.jsx("button",{type:"button",onClick:d,disabled:v,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]})}):null},MC=({isOpen:c,onClose:d,onSubmit:g,item:x,currencyCode:v,loading:N=!1})=>{var H,Y;const{register:E,handleSubmit:k,reset:n,watch:M,formState:{errors:z}}=Tn({defaultValues:{unit_price:x.unit_price,min_qty:x.min_qty,surcharge_pct:x.surcharge_pct||void 0}}),q=M("unit_price"),U=M("surcharge_pct");le.useEffect(()=>{x&&n({unit_price:x.unit_price,min_qty:x.min_qty,surcharge_pct:x.surcharge_pct||void 0})},[x,n]);const V=ge=>{g({unit_price:ge.unit_price,min_qty:ge.min_qty,surcharge_pct:ge.surcharge_pct||null})},G=()=>q?U?q*(1+U/100):q:0;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:k(V),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Edit Product Price"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:(H=x.product)==null?void 0:H.name}),t.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",(Y=x.product)==null?void 0:Y.sku]})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700",children:["Unit Price (",v,") *"]}),t.jsx("input",{type:"number",min:"0",step:"0.01",id:"unit_price",...E("unit_price",{required:"Unit price is required",min:{value:.01,message:"Price must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.unit_price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.unit_price.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"min_qty",className:"block text-sm font-medium text-gray-700",children:"Minimum Quantity"}),t.jsx("input",{type:"number",min:"1",id:"min_qty",...E("min_qty",{required:"Minimum quantity is required",min:{value:1,message:"Minimum quantity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.min_qty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.min_qty.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"surcharge_pct",className:"block text-sm font-medium text-gray-700",children:"Surcharge Percentage (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",id:"surcharge_pct",...E("surcharge_pct",{min:{value:0,message:"Surcharge cannot be negative"},max:{value:100,message:"Surcharge cannot exceed 100%"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"}),z.surcharge_pct&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.surcharge_pct.message})]}),q>0&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Final Price:"}),t.jsx("span",{className:"text-lg font-bold text-blue-900",children:fa(G(),v)})]}),U&&U>0&&t.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Base: ",fa(q,v)," + ",U,"% surcharge"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Changes"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},PC=()=>{var ke;const{id:c}=nc(),d=Hr(),[g,x]=le.useState(!1),[v,N]=le.useState(!1),[E,k]=le.useState(null),[n,M]=le.useState(null),{data:z,isLoading:q,error:U}=KE(c),{data:V=[],refetch:G}=xb(c),H=gb(),Y=yb(),ge=async et=>{if(z)try{await H.mutateAsync({id:z.id,...et}),x(!1)}catch{}},oe=async et=>{try{for(const Pe of et)await Y.mutateAsync({price_list_id:c,product_id:Pe.productId,unit_price:Pe.unitPrice,min_qty:Pe.minQty||1,surcharge_pct:Pe.surchargeRate||void 0});N(!1),G()}catch{}},se=et=>{k(et)},de=async et=>{E&&(alert("Update price list item functionality is temporarily disabled"),k(null))},ae=et=>{M(et)},Se=async()=>{n&&(alert("Delete price list item functionality is temporarily disabled"),M(null))},Ce=et=>new Date(et).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),fe=(et,Pe)=>Pe?et*(1+Pe/100):et;if(q)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(U||!z)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Price list not found or error loading details."})})})]});const Ie=Qh(z.start_date,z.end_date);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:z.name})]}),t.jsxs("button",{onClick:()=>x(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ai,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Price List"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Price List Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($n,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:z.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Currency"}),t.jsx("span",{className:"text-gray-900 font-mono",children:z.currency_code})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Ie.color}`,children:Ie.label})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Date Range"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:_b(z.start_date,z.end_date)})]})]}),z.description&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),t.jsx("p",{className:"text-gray-900",children:z.description})]})]})]})}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:Ce(z.created_at)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Products"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(fs,{className:"h-4 w-4 text-gray-400"}),t.jsxs("span",{className:"text-sm text-gray-900",children:[V.length," products"]})]})]})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Products in this Price List (",V.length,")"]}),t.jsxs("button",{onClick:()=>N(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Products"})]})]}),V.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Min Qty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Surcharge"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:V.map(et=>{var Pe,Ne;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((Pe=et.product)==null?void 0:Pe.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((Ne=et.product)==null?void 0:Ne.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:fa(et.unit_price,z.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:et.min_qty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:et.surcharge_pct?`${et.surcharge_pct}%`:"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:fa(fe(et.unit_price,et.surcharge_pct),z.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>se(et),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit price",children:t.jsx(ai,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>ae(et),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Remove from list",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},et.id)})})]})}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(fs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products added yet"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"Add products to this price list to set their pricing."}),t.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Products"})]})]})]}),t.jsx(jb,{isOpen:g,onClose:()=>x(!1),onSubmit:ge,priceList:z,loading:H.isPending,title:"Edit Price List"}),t.jsx(AC,{isOpen:v,onClose:()=>N(!1),onSubmit:oe,priceList:z,loading:Y.isPending}),E&&t.jsx(MC,{isOpen:!!E,onClose:()=>k(null),onSubmit:de,item:E,currencyCode:z.currency_code,loading:!1}),t.jsx(ro,{isOpen:!!n,onClose:()=>M(null),onConfirm:Se,title:"Remove Product",message:`Are you sure you want to remove "${(ke=n==null?void 0:n.product)==null?void 0:ke.name}" from this price list?`,confirmText:"Remove",type:"danger",loading:!1})]})},rg=(c={})=>kt.orders.list.useQuery({status:c.status,customer_id:c.customer_id,search:c.search,order_date_from:c.order_date_from,order_date_to:c.order_date_to,scheduled_date_from:c.scheduled_date_from,scheduled_date_to:c.scheduled_date_to,include_analytics:c.include_analytics||!1,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Orders fetch error:",d),It.error("Failed to load orders")}}),IC=c=>kt.orders.getById.useQuery({order_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Order fetch error:",d),It.error("Failed to load order details")}}),DC=()=>{const c=kt.useContext();return kt.orders.create.useMutation({onSuccess:d=>{console.log("Order created successfully:",d),c.orders.list.invalidate(),It.success("Order created successfully")},onError:d=>{console.error("Create order error:",d),It.error(d.message||"Failed to create order")}})},Nb=()=>{const c=kt.useContext();return kt.orders.updateStatus.useMutation({onSuccess:d=>{console.log("Order status updated successfully:",d),c.orders.list.invalidate(),c.orders.getById.invalidate({order_id:d.id}),It.success("Order status updated successfully")},onError:d=>{console.error("Update order status error:",d),It.error(d.message||"Failed to update order status")}})},LC=()=>{const c=kt.useContext();return kt.orders.updateTax.useMutation({onSuccess:(d,g)=>{console.log("Order tax updated:",d),c.orders.getById.invalidate({order_id:g.order_id}),c.orders.list.invalidate(),It.success("Order tax updated successfully")},onError:d=>{console.error("Update tax error:",d),It.error(d.message||"Failed to update order tax")}})},RC=({orders:c,loading:d=!1,onView:g,onEdit:x,onChangeStatus:v,selectedOrders:N=[],onSelectionChange:E})=>{const[k,n]=le.useState(!1),M=V=>new Date(V).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),z=V=>{const G=[];switch(V.status){case"draft":G.push({label:"Confirm",action:()=>v(V,"confirmed"),icon:fs,color:"text-blue-600 hover:text-blue-900"});break;case"confirmed":G.push({label:"Schedule",action:()=>v(V,"scheduled"),icon:er,color:"text-purple-600 hover:text-purple-900"});break;case"scheduled":G.push({label:"En Route",action:()=>v(V,"en_route"),icon:wr,color:"text-orange-600 hover:text-orange-900"});break;case"en_route":G.push({label:"Delivered",action:()=>v(V,"delivered"),icon:fs,color:"text-green-600 hover:text-green-900"});break;case"delivered":G.push({label:"Invoice",action:()=>v(V,"invoiced"),icon:rS,color:"text-teal-600 hover:text-teal-900"});break}return["draft","confirmed","scheduled"].includes(V.status)&&G.push({label:"Cancel",action:()=>v(V,"cancelled"),icon:Qa,color:"text-red-600 hover:text-red-900"}),G},q=V=>{n(V),E&&E(V?c.map(G=>G.id):[])},U=(V,G)=>{if(E){const H=G?[...N,V]:N.filter(Y=>Y!==V);E(H),n(H.length===c.length)}};return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading orders..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(lm,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No orders found"}),t.jsx("p",{className:"text-gray-500",children:"Get started by creating your first order."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Orders (",c.length,")"]}),N.length>0&&t.jsxs("span",{className:"text-sm text-blue-600",children:[N.length," selected"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[E&&t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:k,onChange:V=>q(V.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delivery Address"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dates"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(V=>{var H,Y,ge,oe;const G=z(V);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[E&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",checked:N.includes(V.id),onChange:se=>U(V.id,se.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("button",{onClick:()=>g(V),className:"text-sm font-medium text-blue-600 hover:text-blue-900",children:If(V.id)}),t.jsxs("div",{className:"text-sm text-gray-500",children:[((H=V.order_lines)==null?void 0:H.length)||0," item",(((Y=V.order_lines)==null?void 0:Y.length)||0)!==1?"s":""]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((ge=V.customer)==null?void 0:ge.name)||"Unknown Customer"}),((oe=V.customer)==null?void 0:oe.email)&&t.jsx("div",{className:"text-sm text-gray-500",children:V.customer.email})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:V.delivery_address?t.jsxs(t.Fragment,{children:[t.jsx("div",{children:V.delivery_address.city}),V.delivery_address.state&&t.jsx("div",{className:"text-gray-500",children:V.delivery_address.state})]}):"No address"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsxs("div",{children:["Order: ",M(V.order_date)]}),V.scheduled_date&&t.jsxs("div",{className:"text-gray-500",children:["Scheduled: ",M(V.scheduled_date)]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${PE(V.status)}`,children:V.status.replace("_"," ").toUpperCase()})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:V.total_amount?As(V.total_amount):"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(V),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View order",children:t.jsx(om,{className:"h-4 w-4"})}),["draft","confirmed"].includes(V.status)&&t.jsx("button",{onClick:()=>x(V),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit order",children:t.jsx(ai,{className:"h-4 w-4"})}),G.slice(0,2).map((se,de)=>t.jsx("button",{onClick:se.action,className:`p-1 rounded hover:bg-gray-50 transition-colors ${se.color}`,title:se.label,children:t.jsx(se.icon,{className:"h-4 w-4"})},de))]})})]},V.id)})})]})})]})},zC=({filters:c,onFiltersChange:d,savedFilters:g=[],onSaveFilter:x,onLoadFilter:v})=>{const[N,E]=le.useState(!1),[k,n]=le.useState(!1),[M,z]=le.useState(""),q=se=>{d({...c,search:se.target.value||void 0,page:1})},U=se=>{d({...c,status:se.target.value||void 0,page:1})},V=(se,de)=>{d({...c,[se]:de||void 0,page:1})},G=(se,de)=>{d({...c,[se]:de?parseFloat(de):void 0,page:1})},H=se=>{d({...c,delivery_area:se.target.value||void 0,page:1})},Y=()=>{d({page:1})},ge=()=>{M.trim()&&x&&(x(M.trim(),c),n(!1),z(""))},oe=[{name:"Today's Deliveries",filters:{scheduled_date_from:new Date().toISOString().split("T")[0],scheduled_date_to:new Date().toISOString().split("T")[0]}},{name:"Overdue Orders",filters:{scheduled_date_to:new Date(Date.now()-864e5).toISOString().split("T")[0],status:"scheduled"}},{name:"Draft Orders",filters:{status:"draft"}},{name:"This Week",filters:{order_date_from:new Date(Date.now()-7*864e5).toISOString().split("T")[0]}}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6 space-y-4",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by order ID, customer name, or product SKU...",value:c.search||"",onChange:q,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:U,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"confirmed",children:"Confirmed"}),t.jsx("option",{value:"scheduled",children:"Scheduled"}),t.jsx("option",{value:"en_route",children:"En Route"}),t.jsx("option",{value:"delivered",children:"Delivered"}),t.jsx("option",{value:"invoiced",children:"Invoiced"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})}),t.jsxs("button",{onClick:()=>E(!N),className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${N?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[t.jsx(Qu,{className:"h-4 w-4"}),t.jsx("span",{children:"Advanced"})]}),t.jsxs("button",{onClick:Y,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:oe.map(se=>t.jsx("button",{onClick:()=>d({...se.filters,page:1}),className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors",children:se.name},se.name))}),g.length>0&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($h,{className:"h-4 w-4 text-yellow-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Saved Filters:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(se=>t.jsx("button",{onClick:()=>v==null?void 0:v(se),className:"px-3 py-1 text-sm bg-yellow-100 text-yellow-800 rounded-full hover:bg-yellow-200 transition-colors",children:se.name},se.id))})]}),N&&t.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Date From"}),t.jsxs("div",{className:"relative",children:[t.jsx(er,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:c.order_date_from||"",onChange:se=>V("order_date_from",se.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Date To"}),t.jsx("input",{type:"date",value:c.order_date_to||"",onChange:se=>V("order_date_to",se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled From"}),t.jsxs("div",{className:"relative",children:[t.jsx(er,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:c.scheduled_date_from||"",onChange:se=>V("scheduled_date_from",se.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled To"}),t.jsx("input",{type:"date",value:c.scheduled_date_to||"",onChange:se=>V("scheduled_date_to",se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx($n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:c.amount_min||"",onChange:se=>G("amount_min",se.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx($n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:c.amount_max||"",onChange:se=>G("amount_max",se.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Area"}),t.jsxs("div",{className:"relative",children:[t.jsx(Nn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:c.delivery_area||"",onChange:H,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"City or region"})]})]})]}),x&&t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{onClick:()=>n(!0),className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(N_,{className:"h-4 w-4"}),t.jsx("span",{children:"Save Filter"})]})})]}),k&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>n(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Save Filter"}),t.jsx("button",{onClick:()=>n(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(eo,{className:"h-6 w-6"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter Name"}),t.jsx("input",{type:"text",value:M,onChange:se=>z(se.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter a name for this filter..."})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:ge,disabled:!M.trim(),className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Save Filter"}),t.jsx("button",{onClick:()=>n(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})})]})},OC=()=>null,Sb=({isOpen:c,onClose:d,onSubmit:g,order:x,newStatus:v,loading:N=!1})=>{const{register:E,handleSubmit:k,reset:n,formState:{errors:M},watch:z}=Tn({defaultValues:{order_id:x.id,new_status:v,notes:"",scheduled_date:""}}),q=z("scheduled_date");le.useEffect(()=>{n({order_id:x.id,new_status:v,notes:"",scheduled_date:v==="scheduled"?new Date().toISOString().split("T")[0]:""})},[x.id,v,n]);const U=oe=>{g(oe)},V=Jo(v),G=v==="scheduled",Y=(()=>{const oe=[];if(v==="confirmed"){const se=IE(x);oe.push(...se.errors)}else v==="scheduled"&&(q||oe.push("Scheduled date is required"),x.delivery_address||oe.push("Delivery address is required"));return oe})(),ge=Y.length===0;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:k(U),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Change Order Status"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current Status:"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Jo(x.status).color}`,children:x.status.replace("_"," ").toUpperCase()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"New Status:"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${V.color}`,children:v.replace("_"," ").toUpperCase()})]}),t.jsx("div",{className:"mt-2 text-sm text-gray-600",children:V.description})]}),Y.length>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx($s,{className:"h-5 w-5 text-red-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Cannot proceed:"}),t.jsx("ul",{className:"mt-1 text-sm text-red-700 list-disc list-inside",children:Y.map((oe,se)=>t.jsx("li",{children:oe},se))})]})]})}),G&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"scheduled_date",className:"block text-sm font-medium text-gray-700",children:"Scheduled Delivery Date *"}),t.jsx("input",{type:"date",id:"scheduled_date",...E("scheduled_date",{required:G?"Scheduled date is required":!1,validate:oe=>{if(G&&oe){const se=new Date(oe),de=new Date;if(de.setHours(0,0,0,0),se<de)return"Scheduled date cannot be in the past"}return!0}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]}),M.scheduled_date&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.scheduled_date.message})]}),v==="confirmed"&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Note:"})," Confirming this order will reserve inventory for all products."]})}),v==="delivered"&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Note:"})," Marking as delivered will deduct inventory and release reserved stock."]})}),v==="cancelled"&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-red-800",children:[t.jsx("strong",{children:"Warning:"})," Cancelling this order will release any reserved inventory."]})})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||!ge,className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed ${v==="cancelled"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}`,children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Updating..."})]}):`Change to ${V.label}`}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},FC=({selectedOrders:c,onClearSelection:d,onBulkOperation:g})=>{const[x,v]=le.useState(!1),[N,E]=le.useState(!1),[k,n]=le.useState(!1),[M,z]=le.useState(""),[q,U]=le.useState(""),[V,G]=le.useState("");if(c.length===0)return null;const H=ae=>c.every(Se=>{switch(ae){case"confirmed":return Se.status==="draft";case"scheduled":return Se.status==="confirmed";case"cancelled":return["draft","confirmed","scheduled"].includes(Se.status);default:return!1}}),Y=()=>{M&&(g({order_ids:c.map(ae=>ae.id),operation:"schedule",scheduled_date:M,notes:V}),E(!1),z(""),G(""))},ge=()=>{q&&(g({order_ids:c.map(ae=>ae.id),operation:"status_change",new_status:q,notes:V}),n(!1),U(""),G(""))},oe=()=>{g({order_ids:c.map(ae=>ae.id),operation:"export"}),v(!1)},se=()=>{g({order_ids:c.map(ae=>ae.id),operation:"print"}),v(!1)},de=c.reduce((ae,Se)=>ae+(Se.total_amount||0),0);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[c.length," order",c.length>1?"s":""," selected"]}),t.jsxs("span",{className:"text-sm text-blue-700",children:["Total value: $",de.toLocaleString()]}),t.jsxs("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center space-x-1",children:[t.jsx(Ys,{className:"h-3 w-3"}),t.jsx("span",{children:"Clear selection"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>v(!x),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx("span",{children:"Bulk Actions"}),t.jsx(am,{className:"h-4 w-4"})]}),x&&t.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg border border-gray-200 z-10",children:t.jsxs("div",{className:"py-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Status Changes"}),H("confirmed")&&t.jsxs("button",{onClick:()=>{U("confirmed"),n(!0),v(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(pa,{className:"h-4 w-4 text-blue-600"}),t.jsx("span",{children:"Confirm Orders"})]}),H("scheduled")&&t.jsxs("button",{onClick:()=>{E(!0),v(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(er,{className:"h-4 w-4 text-purple-600"}),t.jsx("span",{children:"Schedule Deliveries"})]}),H("cancelled")&&t.jsxs("button",{onClick:()=>{U("cancelled"),n(!0),v(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Ys,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{children:"Cancel Orders"})]}),t.jsxs("div",{className:"border-t border-gray-100 mt-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Export & Print"}),t.jsxs("button",{onClick:oe,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx($f,{className:"h-4 w-4 text-green-600"}),t.jsx("span",{children:"Export to CSV"})]}),t.jsxs("button",{onClick:se,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(b_,{className:"h-4 w-4 text-gray-600"}),t.jsx("span",{children:"Print Manifests"})]})]})]})})]})]})}),N&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>E(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:["Schedule ",c.length," Orders"]}),t.jsx("button",{onClick:()=>E(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Delivery Date *"}),t.jsx("input",{type:"date",value:M,onChange:ae=>z(ae.target.value),min:new Date().toISOString().split("T")[0],className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),t.jsx("textarea",{value:V,onChange:ae=>G(ae.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Add notes for this bulk scheduling..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:Y,disabled:!M,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Schedule Orders"}),t.jsx("button",{onClick:()=>E(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})}),k&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>n(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:[q==="confirmed"&&"Confirm Orders",q==="cancelled"&&"Cancel Orders"]}),t.jsx("button",{onClick:()=>n(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(Ys,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-gray-700",children:["This will change the status of ",c.length," selected orders to"," ",t.jsx("span",{className:"font-medium",children:q}),"."]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:q==="cancelled"?"Cancellation Reason *":"Notes (Optional)"}),t.jsx("textarea",{value:V,onChange:ae=>G(ae.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:q==="cancelled"?"Please provide a reason for cancellation...":"Add notes for this status change..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsxs("button",{onClick:ge,disabled:q==="cancelled"&&!V.trim(),className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed ${q==="cancelled"?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"}`,children:[q==="confirmed"&&"Confirm Orders",q==="cancelled"&&"Cancel Orders"]}),t.jsx("button",{onClick:()=>n(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})})]})},BC=()=>{const c=Hr(),[d,g]=le.useState({page:1}),[x,v]=le.useState(null),[N,E]=le.useState([]),{data:k,isLoading:n,error:M,refetch:z}=rg(d),q=Nb();le.useEffect(()=>{console.log("OrdersPage state:",{filters:d,data:k,isLoading:n,error:M,statusChangeOrder:x,selectedOrders:N})},[d,k,n,M,x,N]);const U=()=>{console.log("Creating new order"),c("/orders/new")},V=fe=>{console.log("Viewing order:",fe),c(`/orders/${fe.id}`)},G=fe=>{console.log("Editing order:",fe),c(`/orders/${fe.id}/edit`)},H=(fe,Ie)=>{console.log("Changing order status:",fe,Ie),v({order:fe,newStatus:Ie})},Y=async fe=>{console.log("Status change submit:",fe);try{await q.mutateAsync(fe),v(null)}catch(Ie){console.error("Status change error:",Ie)}},ge=async fe=>{switch(console.log("Bulk operation:",fe),fe.operation){case"status_change":if(fe.new_status)for(const Ie of fe.order_ids)(k==null?void 0:k.orders.find(et=>et.id===Ie))&&await q.mutateAsync({order_id:Ie,new_status:fe.new_status,notes:fe.notes});break;case"schedule":if(fe.scheduled_date)for(const Ie of fe.order_ids)await q.mutateAsync({order_id:Ie,new_status:"scheduled",scheduled_date:fe.scheduled_date,notes:fe.notes});break;case"export":oe(fe.order_ids);break;case"print":se(fe.order_ids);break}E([])},oe=fe=>{const Ie=(k==null?void 0:k.orders.filter(it=>fe.includes(it.id)))||[],ke=[["Order ID","Customer","Status","Order Date","Scheduled Date","Total Amount"],...Ie.map(it=>{var ft,tt;return[it.id,((ft=it.customer)==null?void 0:ft.name)||"",it.status,it.order_date,it.scheduled_date||"",((tt=it.total_amount)==null?void 0:tt.toString())||"0"]})].map(it=>it.join(",")).join(`
`),et=new Blob([ke],{type:"text/csv"}),Pe=window.URL.createObjectURL(et),Ne=document.createElement("a");Ne.href=Pe,Ne.download=`orders-export-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),window.URL.revokeObjectURL(Pe)},se=fe=>{console.log("Print manifests for orders:",fe)},de=fe=>{console.log("Page change:",fe),g(Ie=>({...Ie,page:fe}))},ae=()=>{console.log("Refreshing orders"),z()},Se=fe=>{E(fe)},Ce=()=>{E([])};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Management"}),t.jsx("p",{className:"text-gray-600",children:"Manage customer orders and deliveries"}),M&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",M.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>c("/orders/reports"),className:"flex items-center space-x-2 bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:[t.jsx(Ko,{className:"h-4 w-4"}),t.jsx("span",{children:"Reports"})]}),t.jsxs("button",{onClick:()=>c("/orders/schedule"),className:"flex items-center space-x-2 bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(er,{className:"h-4 w-4"}),t.jsx("span",{children:"Schedule"})]}),t.jsxs("button",{onClick:ae,disabled:n,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(tl,{className:`h-4 w-4 ${n?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:U,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Create Order"})]})]})]}),t.jsx(OC,{}),t.jsx(zC,{filters:d,onFiltersChange:g}),t.jsx(FC,{selectedOrders:(k==null?void 0:k.orders.filter(fe=>N.includes(fe.id)))||[],onClearSelection:Ce,onBulkOperation:ge}),t.jsx(RC,{orders:(k==null?void 0:k.orders)||[],loading:n,onView:V,onEdit:G,onChangeStatus:H,selectedOrders:N,onSelectionChange:Se}),k&&k.totalPages>1&&t.jsx(ac,{currentPage:k.currentPage,totalPages:k.totalPages,totalCount:k.totalCount,onPageChange:de}),x&&t.jsx(Sb,{isOpen:!!x,onClose:()=>v(null),onSubmit:Y,order:x.order,newStatus:x.newStatus,loading:q.isPending})]})},UC=({value:c,onChange:d,customers:g,placeholder:x="Search customer...",className:v=""})=>{const[N,E]=le.useState(!1),[k,n]=le.useState(""),[M,z]=le.useState([]);le.useEffect(()=>{if(k){const G=g.filter(H=>H.name.toLowerCase().includes(k.toLowerCase())||H.external_id&&H.external_id.toLowerCase().includes(k.toLowerCase())||H.tax_id&&H.tax_id.toLowerCase().includes(k.toLowerCase()));z(G)}else z(g)},[k,g]);const q=g.find(G=>G.id===c),U=G=>{d(G),E(!1),n("")},V=()=>{d(""),n("")};return t.jsxs("div",{className:`relative ${v}`,children:[t.jsx("div",{className:"relative",children:t.jsx("div",{onClick:()=>E(!N),className:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 cursor-pointer",children:q?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:q.name}),q.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",q.external_id]})]}),t.jsx("button",{onClick:G=>{G.stopPropagation(),V()},className:"text-gray-400 hover:text-gray-600",children:t.jsx(Ys,{className:"h-4 w-4"})})]}):t.jsxs("div",{className:"flex items-center justify-between text-gray-500",children:[t.jsx("span",{children:x}),t.jsx(am,{className:"h-4 w-4"})]})})}),N&&t.jsxs("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:[t.jsx("div",{className:"p-2",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:k,onChange:G=>n(G.target.value),placeholder:"Type to search...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0})]})}),t.jsx("div",{className:"max-h-60 overflow-auto",children:M.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No customers found"}):M.map(G=>t.jsxs("div",{onClick:()=>U(G.id),className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsx("div",{className:"font-medium text-gray-900",children:G.name}),G.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",G.external_id]}),G.tax_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Tax ID: ",G.tax_id]})]},G.id))})]})]})},VC=({orderType:c,serviceType:d,exchangeEmptyQty:g,requiresPickup:x,onOrderTypeChange:v,onServiceTypeChange:N,onExchangeEmptyQtyChange:E,onRequiresPickupChange:k,disabled:n=!1})=>{const M=[{value:"delivery",label:"Standard Delivery",description:"Deliver full cylinders to customer",icon:wr,color:"bg-blue-50 border-blue-200 text-blue-800",selectedColor:"bg-blue-100 border-blue-300"},{value:"refill",label:"Refill Service",description:"Deliver full cylinders and collect empties",icon:eo,color:"bg-green-50 border-green-200 text-green-800",selectedColor:"bg-green-100 border-green-300"},{value:"exchange",label:"Cylinder Exchange",description:"Exchange empties for full cylinders",icon:g_,color:"bg-orange-50 border-orange-200 text-orange-800",selectedColor:"bg-orange-100 border-orange-300"},{value:"pickup",label:"Empty Pickup",description:"Collect empty cylinders only",icon:j_,color:"bg-purple-50 border-purple-200 text-purple-800",selectedColor:"bg-purple-100 border-purple-300"}],z=[{value:"standard",label:"Standard Service",description:"Regular delivery schedule",icon:Ki},{value:"express",label:"Express Service",description:"Priority delivery",icon:lS},{value:"scheduled",label:"Scheduled Service",description:"Specific delivery time",icon:er}],q=U=>{v(U),cf(U)?k(!0):U==="delivery"&&k(!1),U==="delivery"&&E(0)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Type"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:M.map(U=>{const V=U.icon,G=c===U.value;return t.jsxs("button",{type:"button",onClick:()=>q(U.value),disabled:n,className:`relative p-4 border-2 rounded-lg text-left transition-all hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${G?U.selectedColor:U.color}`,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(V,{className:"h-6 w-6 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:U.label}),t.jsx("p",{className:"text-sm opacity-80 mt-1",children:U.description})]})]}),G&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("div",{className:"w-3 h-3 bg-current rounded-full"})})]},U.value)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Service Type"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:z.map(U=>{const V=U.icon,G=d===U.value;return t.jsxs("button",{type:"button",onClick:()=>N(U.value),disabled:n,className:`relative p-4 border-2 rounded-lg text-left transition-all hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${G?"bg-gray-100 border-gray-300 text-gray-900":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(V,{className:"h-5 w-5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:U.label}),t.jsx("p",{className:"text-sm opacity-80 mt-1",children:U.description})]})]}),G&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"})})]},U.value)})})]}),(c==="refill"||c==="exchange"||c==="pickup")&&t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:c==="pickup"?"Pickup Details":"Exchange Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"exchange_empty_qty",className:"block text-sm font-medium text-gray-700",children:c==="pickup"?"Empty Cylinders to Collect *":"Empty Cylinders to Exchange *"}),t.jsx("input",{type:"number",id:"exchange_empty_qty",min:"0",value:g,onChange:U=>E(parseInt(U.target.value)||0),disabled:n,className:"mt-1 block w-full sm:w-32 rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50",placeholder:"0"}),t.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[c==="refill"&&"Number of empty cylinders customer will return",c==="exchange"&&"Number of empty cylinders to collect from customer",c==="pickup"&&"Number of empty cylinders to collect"]})]}),c!=="pickup"&&t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"requires_pickup",checked:x,onChange:U=>k(U.target.checked),disabled:n||cf(c),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded disabled:opacity-50"}),t.jsxs("label",{htmlFor:"requires_pickup",className:"ml-2 block text-sm text-gray-700",children:["Requires pickup of empty cylinders",cf(c)&&t.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Required for this order type)"})]})]})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:[$E(c)," - ",GE(d)]}),t.jsxs("div",{className:"text-sm text-blue-800",children:[c==="delivery"&&t.jsx("p",{children:"Standard delivery of full cylinders to the customer's address."}),c==="refill"&&t.jsxs("div",{children:[t.jsx("p",{children:"Delivery of full cylinders with collection of empty cylinders."}),t.jsx("p",{className:"mt-1",children:" Deliver: Full cylinders as per order"}),t.jsxs("p",{children:[" Collect: ",g||0," empty cylinders"]})]}),c==="exchange"&&t.jsxs("div",{children:[t.jsx("p",{children:"Exchange service where empties are swapped for full cylinders."}),t.jsx("p",{className:"mt-1",children:" Deliver: Full cylinders as per order"}),t.jsxs("p",{children:[" Collect: ",g||0," empty cylinders"]})]}),c==="pickup"&&t.jsxs("div",{children:[t.jsx("p",{children:"Collection of empty cylinders only."}),t.jsxs("p",{className:"mt-1",children:[" Collect: ",g||0," empty cylinders"]})]})]})]})]})},qC=()=>{const c=Hr(),[d,g]=le.useState(1),[x,v]=le.useState(""),[N,E]=le.useState(""),[k,n]=le.useState(new Date().toISOString().split("T")[0]),[M,z]=le.useState([]),[q,U]=le.useState(""),[V,G]=le.useState(0),[H,Y]=le.useState(!1),[ge,oe]=le.useState("delivery"),[se,de]=le.useState("standard"),[ae,Se]=le.useState(0),[Ce,fe]=le.useState(!1),{data:Ie}=S_({limit:1e3}),{data:ke=[]}=db(x),{data:et}=cc({limit:1e3}),{data:Pe}=eg({limit:1e3}),Ne=DC(),it=hb(),ft=(Ie==null?void 0:Ie.customers)||[],tt=(et==null?void 0:et.products)||[],Mt=(Pe==null?void 0:Pe.priceLists)||[],Tt=new Date().toISOString().split("T")[0],At=Mt.filter(bt=>!(bt.end_date&&bt.end_date<Tt||bt.start_date&&bt.start_date>Tt)),zs=At.find(bt=>bt.is_default)||At[0];tt.filter(bt=>bt.status==="active").map(bt=>bt.id);const ts=ft.find(bt=>bt.id===x),Vt=ke.find(bt=>bt.id===N),sr=M.reduce((bt,ns)=>bt+ns.subtotal,0),bs=sr*(V/100),fr=sr+bs,$r=bt=>{v(bt),E("")};le.useEffect(()=>{if(x&&ke.length>0&&!N){const bt=ke.find(ns=>ns.is_primary);bt&&E(bt.id)}},[x,ke,N]);const gr=bt=>0,_r=bt=>{const ns=tt.find(wt=>wt.id===bt);if(!ns)return;const be=M.find(wt=>wt.product_id===bt),Ue=gr(),He=rr();if(be){if(be.quantity>=He){alert(`Cannot add more items. Only ${He} units available in stock.`);return}z(wt=>wt.map(pt=>pt.product_id===bt?{...pt,quantity:pt.quantity+1,subtotal:(pt.quantity+1)*pt.unit_price}:pt))}else{const wt={product_id:bt,product_name:ns.name,product_sku:ns.sku,quantity:1,unit_price:Ue,subtotal:Ue};z(pt=>[...pt,wt])}},Xr=(bt,ns)=>{if(ns<=0){Rr(bt);return}const be=rr();if(ns>be){alert(`Cannot set quantity to ${ns}. Only ${be} units available in stock.`);return}z(Ue=>Ue.map(He=>He.product_id===bt?{...He,quantity:ns,subtotal:ns*He.unit_price}:He))},Rr=bt=>{z(ns=>ns.filter(be=>be.product_id!==bt))},Si=async()=>{if(!(!x||!N||M.length===0))try{const bt={customer_id:x,delivery_address_id:N,order_date:k,status:"draft",notes:q,tax_percent:V,tax_amount:bs,total_amount:fr,order_type:ge,service_type:se,exchange_empty_qty:ae,requires_pickup:Ce},ns=await Ne.mutateAsync(bt);c(`/orders/${ns.id}`)}catch(bt){console.error("Error creating order:",bt)}},Qt=x&&N,Ii=Qt&&M.length>0,rr=bt=>999,Di=bt=>(console.log("Stock status for quantity",bt),"text-green-600"),Ms=()=>{x&&Y(!0)},zr=async bt=>{try{const ns=await it.mutateAsync(bt);E(ns.id),Y(!1)}catch{}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create New Order"})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("div",{className:"flex items-center justify-between mb-6",children:t.jsxs("div",{className:"flex items-center space-x-8",children:[t.jsxs("div",{className:`flex items-center space-x-2 ${d>=1?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=1?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),t.jsx("span",{className:"font-medium",children:"Customer & Delivery"})]}),t.jsx("div",{className:`w-16 h-0.5 ${d>=2?"bg-blue-600":"bg-gray-200"}`}),t.jsxs("div",{className:`flex items-center space-x-2 ${d>=2?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=2?"bg-blue-600 text-white":"bg-gray-200"}`,children:"2"}),t.jsx("span",{className:"font-medium",children:"Add Products"})]}),t.jsx("div",{className:`w-16 h-0.5 ${d>=3?"bg-blue-600":"bg-gray-200"}`}),t.jsxs("div",{className:`flex items-center space-x-2 ${d>=3?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=3?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),t.jsx("span",{className:"font-medium",children:"Review & Create"})]})]})}),d===1&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"mb-6",children:t.jsx(VC,{selectedOrderType:ge,selectedServiceType:se,exchangeEmptyQty:ae,requiresPickup:Ce,onOrderTypeChange:oe,onServiceTypeChange:de,onExchangeEmptyQtyChange:Se,onRequiresPickupChange:fe})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(cm,{className:"inline h-4 w-4 mr-1"}),"Select Customer *"]}),t.jsx(UC,{value:x,onChange:$r,customers:ft,placeholder:"Search for a customer..."})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(er,{className:"inline h-4 w-4 mr-1"}),"Order Date *"]}),t.jsx("input",{type:"date",value:k,onChange:bt=>n(bt.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),x&&t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Nn,{className:"inline h-4 w-4 mr-1"}),"Delivery Address *"]}),ke.length>0?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("select",{value:N,onChange:bt=>E(bt.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Choose a delivery address..."}),ke.map(bt=>t.jsx("option",{value:bt.id,children:bE(bt)},bt.id))]}),Vt&&t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Selected Address:"}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("div",{children:Vt.line1}),Vt.line2&&t.jsx("div",{children:Vt.line2}),t.jsxs("div",{children:[Vt.city,", ",Vt.state," ",Vt.postal_code]}),Vt.instructions&&t.jsxs("div",{className:"mt-2 text-gray-600",children:[t.jsx("strong",{children:"Instructions:"})," ",Vt.instructions]})]})]})]}):t.jsxs("div",{className:"text-center py-8 border border-gray-200 rounded-lg bg-yellow-50",children:[t.jsx($s,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No delivery addresses found"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"This customer doesn't have any delivery addresses yet."}),t.jsxs("button",{onClick:Ms,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Address for Customer"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Notes"}),t.jsx("textarea",{value:q,onChange:bt=>U(bt.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional notes about this order..."})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>g(2),disabled:!Qt,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Add Products"})})]}),d===2&&t.jsxs("div",{className:"space-y-6",children:[!zs&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("span",{className:"text-sm text-yellow-800",children:["No active price list found. Product prices may not be available.",Mt.length>0?`Found ${Mt.length} price list(s) but none are currently active.`:"No price lists exist yet."]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Available Products"}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:tt.filter(bt=>bt.status==="active").map(bt=>{const ns=rr(bt.id),be=gr(bt.id),Ue=M.find(as=>as.product_id===bt.id),He=!!Ue,wt=(Ue==null?void 0:Ue.quantity)||0;Di(ns);const pt=wt<ns,xt=ns===0,Ot=be===0,hs=Ot;return t.jsx("div",{className:`p-3 border rounded-lg transition-all ${He?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200 opacity-75"}`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"font-medium text-gray-900",children:bt.name}),He&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"In Order"})]}),t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["SKU: ",bt.sku]}),t.jsx("div",{className:"flex items-center space-x-2 mb-2",children:t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(qN,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:[ns," available",He?` (${wt} in order)`:""]})]})}),t.jsx("div",{className:"flex items-center space-x-2 mb-3",children:t.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[t.jsx($n,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm font-medium",children:["No price set",zs?` in ${zs.name}`:""]})]})}),t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-2 mt-2",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(HN,{className:"h-4 w-4 text-yellow-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-yellow-800",children:[xt,t.jsxs(t.Fragment,{children:["No pricing configured for this product.",t.jsx("button",{onClick:()=>window.open("/pricing","_blank"),className:"ml-1 text-blue-600 hover:text-blue-800 underline",children:"Set up pricing"})]}),!pt&&!xt&&!Ot&&`Maximum quantity (${ns}) already in order.`]})]})})]}),t.jsx("div",{className:"ml-4 flex-shrink-0",children:t.jsx("button",{onClick:()=>_r(bt.id),disabled:hs,title:"No price set",className:`
                                flex items-center justify-center w-10 h-10 rounded-lg text-sm font-medium transition-all
                                bg-gray-200 text-gray-400 cursor-not-allowed
                              `,children:t.jsx(vr,{className:"h-4 w-4"})})})]})},bt.id)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Items"}),M.length>0?t.jsxs("div",{className:"space-y-3",children:[M.map(bt=>{const ns=rr(bt.product_id);return t.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:bt.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",bt.product_sku]})]}),t.jsx("button",{onClick:()=>Rr(bt.product_id),className:"text-red-600 hover:text-red-800",children:t.jsx(so,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("label",{className:"text-sm text-gray-600",children:"Qty:"}),t.jsx("input",{type:"number",min:"1",max:ns,value:bt.quantity,onChange:be=>Xr(bt.product_id,parseInt(be.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(max: ",ns,")"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[As(bt.unit_price)," each"]}),t.jsx("div",{className:"font-medium text-gray-900",children:As(bt.subtotal)})]})]})]},bt.product_id)}),t.jsxs("div",{className:"border-t pt-3",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Subtotal:"}),t.jsx("span",{className:"text-xl font-bold text-gray-900",children:As(sr)})]}),t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tax (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",value:V,onChange:bt=>G(Number(bt.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm text-right"})]}),t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Tax:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:As(bs)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:As(fr)})]})]})]}):t.jsxs("div",{className:"text-center py-8 border border-gray-200 rounded-lg",children:[t.jsx(fs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No products added yet."}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Select products from the left to add them to the order."})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("button",{onClick:()=>g(1),className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200",children:"Back"}),t.jsx("button",{onClick:()=>g(3),disabled:M.length===0,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Review"})]})]}),d===3&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Customer:"}),t.jsx("div",{className:"text-gray-900",children:ts==null?void 0:ts.name})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Delivery Address:"}),t.jsxs("div",{className:"text-gray-900",children:[Vt==null?void 0:Vt.line1,(Vt==null?void 0:Vt.line2)&&t.jsx("div",{children:Vt.line2}),t.jsxs("div",{children:[Vt==null?void 0:Vt.city,", ",Vt==null?void 0:Vt.state," ",Vt==null?void 0:Vt.postal_code]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Order Date:"}),t.jsx("div",{className:"text-gray-900",children:new Date(k).toLocaleDateString()})]}),q&&t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notes:"}),t.jsx("div",{className:"text-gray-900",children:q})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tax (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",value:V,onChange:bt=>G(Number(bt.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm text-right"})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Items"}),t.jsxs("div",{className:"space-y-2",children:[M.map(bt=>t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-200",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:bt.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:[bt.quantity,"  ",As(bt.unit_price)]})]}),t.jsx("div",{className:"font-medium text-gray-900",children:As(bt.subtotal)})]},bt.product_id)),t.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-300",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Subtotal:"}),t.jsx("span",{className:"text-xl font-bold text-gray-900",children:As(sr)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Tax:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:As(bs)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:As(fr)})]})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("button",{onClick:()=>g(2),className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200",children:"Back"}),t.jsxs("button",{onClick:Si,disabled:!Ii||Ne.isPending,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(lm,{className:"h-4 w-4"}),t.jsx("span",{children:Ne.isPending?"Creating...":"Create Order"})]})]})]})]}),t.jsx(mb,{isOpen:H,onClose:()=>Y(!1),onSubmit:zr,customerId:x,loading:it.isPending,title:"Add New Address",isFirstAddress:ke.length===0})]})},$C=({statusHistory:c,currentStatus:d,estimatedDates:g={}})=>{const x=n=>new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=(n,M)=>(Jo(n),M?t.jsx(pa,{className:"h-5 w-5 text-green-600"}):n===d?t.jsx(Ki,{className:"h-5 w-5 text-blue-600"}):t.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-gray-300 bg-white"})),N=(n,M)=>M?"border-green-200 bg-green-50":n===d?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50",E=["draft","confirmed","scheduled","en_route","delivered","invoiced"],k=E.indexOf(d);return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Order Timeline"}),t.jsx("div",{className:"space-y-4",children:E.map((n,M)=>{const z=M<k||n===d&&d!=="cancelled",q=n===d,U=Jo(n),V=c.find(H=>H.status===n),G=g[n];return n==="cancelled"&&d!=="cancelled"?null:t.jsxs("div",{className:`relative flex items-start space-x-4 p-4 rounded-lg border ${N(n,z)}`,children:[M<E.length-1&&n!=="cancelled"&&t.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-8 bg-gray-200"}),t.jsx("div",{className:"flex-shrink-0 mt-1",children:v(n,z)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:`text-sm font-medium ${z||q?"text-gray-900":"text-gray-500"}`,children:U.label}),V&&t.jsx("span",{className:"text-xs text-gray-500",children:x(V.changed_at)})]}),t.jsx("p",{className:`text-sm mt-1 ${z||q?"text-gray-600":"text-gray-400"}`,children:U.description}),(V||G)&&t.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs",children:[V&&t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(pa,{className:"h-3 w-3"}),t.jsxs("span",{children:["Completed: ",x(V.changed_at)]})]}),G&&!V&&t.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[t.jsx(er,{className:"h-3 w-3"}),t.jsxs("span",{children:["Estimated: ",x(G)]})]})]}),V&&t.jsxs("div",{className:"mt-3 space-y-2",children:[V.user_name&&t.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[t.jsx(cm,{className:"h-3 w-3"}),t.jsxs("span",{children:["Changed by: ",V.user_name]})]}),V.notes&&t.jsxs("div",{className:"flex items-start space-x-1 text-xs text-gray-600",children:[t.jsx(eS,{className:"h-3 w-3 mt-0.5"}),t.jsx("span",{children:V.notes})]})]}),q&&t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Current Status"})})]})]},n)})}),c.length>1&&t.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Performance Metrics"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Order Processing Time:"}),t.jsx("div",{className:"font-medium text-gray-900",children:(()=>{var z,q;const n=(z=c.find(U=>U.status==="draft"))==null?void 0:z.changed_at,M=(q=c.find(U=>U.status==="confirmed"))==null?void 0:q.changed_at;return n&&M?`${Math.round((new Date(M).getTime()-new Date(n).getTime())/36e5)} hours`:"N/A"})()})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Fulfillment Time:"}),t.jsx("div",{className:"font-medium text-gray-900",children:(()=>{var z,q;const n=(z=c.find(U=>U.status==="confirmed"))==null?void 0:z.changed_at,M=(q=c.find(U=>U.status==="delivered"))==null?void 0:q.changed_at;return n&&M?`${Math.round((new Date(M).getTime()-new Date(n).getTime())/864e5)} days`:"N/A"})()})]})]})]})]})},GC=({isOpen:c,onClose:d,order:g})=>{var U;const[x,v]=le.useState(0),[N,E]=le.useState(""),k=LC();if(le.useEffect(()=>{g&&(v(g.tax_percent||0),E(g.notes||""))},[g]),!c||!g)return null;const n=((U=g.order_lines)==null?void 0:U.reduce((V,G)=>V+(G.subtotal||G.quantity*G.unit_price),0))||0,M=n*(x/100),z=n+M,q=async V=>{V.preventDefault();try{await k.mutateAsync({id:g.id,tax_percent:x,tax_amount:M,total_amount:z,notes:N}),d()}catch(G){console.error("Error updating order:",G)}};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Edit Order"}),t.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(Ys,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:q,className:"p-6 space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Order Summary"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),t.jsx("span",{className:"font-medium text-gray-900",children:As(n)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600",children:["Tax (",x,"%):"]}),t.jsx("span",{className:"font-medium text-gray-900",children:As(M)})]}),t.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-2",children:[t.jsx("span",{className:"font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"font-bold text-gray-900",children:As(z)})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"taxPercent",className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Percentage (%)"}),t.jsx("input",{type:"number",id:"taxPercent",min:"0",max:"100",step:"0.01",value:x,onChange:V=>v(Number(V.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),t.jsx("textarea",{id:"notes",rows:3,value:N,onChange:V=>E(V.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Add any additional notes..."})]}),t.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{type:"button",onClick:async()=>{try{await k(g.id,x),Wr.success("Total amount recalculated")}catch(V){console.error("Error recalculating total:",V),Wr.error("Failed to recalculate total")}},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Recalculate Total"}),t.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:updateOrder.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(N_,{className:"h-4 w-4"}),t.jsx("span",{children:updateOrder.isPending?"Saving...":"Save Changes"})]})]})]})]})})},ZC=()=>{var oe,se,de,ae,Se,Ce,fe,Ie,ke,et;const{id:c}=nc(),d=Hr(),[g,x]=le.useState(null),[v,N]=le.useState(!1),[E,k]=le.useState(!1),{data:n,isLoading:M,error:z}=IC(c),q=Nb(),U=Pe=>{n&&x({order:n,newStatus:Pe})},V=async Pe=>{try{await q.mutateAsync(Pe),x(null)}catch(Ne){console.error("Status change error:",Ne)}},G=Pe=>new Date(Pe).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(M)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(z||!n)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Order not found or error loading order details."})})})]});const H=Jo(n.status),Y=lf(n.status),ge=[{id:"1",order_id:n.id,status:"draft",changed_by:"system",changed_at:n.created_at,user_name:"System",notes:"Order created"},...n.status!=="draft"?[{id:"2",order_id:n.id,status:"confirmed",changed_by:"admin",changed_at:new Date(new Date(n.created_at).getTime()+36e5).toISOString(),user_name:"Admin User",notes:"Order confirmed and inventory reserved"}]:[]];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Order ",If(n.id)]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>N(!v),className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(Ki,{className:"h-4 w-4"}),t.jsxs("span",{children:[v?"Hide":"Show"," Timeline"]})]}),["draft","confirmed"].includes(n.status)&&t.jsxs("button",{onClick:()=>k(!0),className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(ai,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Order"})]}),Y.map(Pe=>t.jsxs("button",{onClick:()=>U(Pe),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[Pe==="confirmed"&&"Confirm Order",Pe==="scheduled"&&"Schedule Delivery",Pe==="en_route"&&"Mark En Route",Pe==="delivered"&&"Mark Delivered",Pe==="invoiced"&&"Generate Invoice",Pe==="cancelled"&&"Cancel Order"]},Pe))]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Order ",If(n.id)]}),t.jsxs("p",{className:"text-gray-600",children:["Created on ",G(n.created_at)]})]}),t.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${H.color}`,children:n.status.replace("_"," ").toUpperCase()})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:t.jsx(cm,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Customer"}),t.jsx("p",{className:"text-gray-600",children:(oe=n.customer)==null?void 0:oe.name}),((se=n.customer)==null?void 0:se.email)&&t.jsx("p",{className:"text-sm text-gray-500",children:n.customer.email}),((de=n.customer)==null?void 0:de.phone)&&t.jsx("p",{className:"text-sm text-gray-500",children:n.customer.phone})]})]}),t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:t.jsx(Nn,{className:"h-5 w-5 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Delivery Address"}),n.delivery_address?t.jsxs("div",{className:"text-gray-600",children:[t.jsx("p",{children:n.delivery_address.line1}),n.delivery_address.line2&&t.jsx("p",{children:n.delivery_address.line2}),t.jsxs("p",{children:[n.delivery_address.city,", ",n.delivery_address.state," ",n.delivery_address.postal_code]}),n.delivery_address.instructions&&t.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Note: ",n.delivery_address.instructions]})]}):t.jsx("p",{className:"text-gray-500",children:"No address specified"})]})]}),t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:t.jsx(er,{className:"h-5 w-5 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Important Dates"}),t.jsxs("div",{className:"text-gray-600 space-y-1",children:[t.jsxs("p",{children:["Order: ",new Date(n.order_date).toLocaleDateString()]}),n.scheduled_date&&t.jsxs("p",{children:["Scheduled: ",new Date(n.scheduled_date).toLocaleDateString()]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Updated: ",G(n.updated_at)]})]})]})]})]}),n.notes&&t.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Order Notes"}),t.jsx("p",{className:"text-gray-700",children:n.notes})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Order Items"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(fs,{className:"h-5 w-5 text-gray-400"}),t.jsxs("span",{className:"text-gray-600",children:[((ae=n.order_lines)==null?void 0:ae.length)||0," item",(((Se=n.order_lines)==null?void 0:Se.length)||0)!==1?"s":""]})]})]}),n.order_lines&&n.order_lines.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subtotal"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.order_lines.map(Pe=>{var Ne,it;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((Ne=Pe.product)==null?void 0:Ne.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((it=Pe.product)==null?void 0:it.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:Pe.quantity})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm text-gray-900",children:As(Pe.unit_price)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:As(Pe.subtotal||Pe.quantity*Pe.unit_price)})})]},Pe.id)})}),t.jsx("tfoot",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"Total:"}),t.jsx("td",{className:"px-6 py-4 text-right text-lg font-bold text-gray-900",children:n.total_amount?As(n.total_amount):As(n.order_lines.reduce((Pe,Ne)=>Pe+(Ne.subtotal||Ne.quantity*Ne.unit_price),0))})]})})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(fs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No items in this order"})]})]}),v&&t.jsx($C,{statusHistory:ge,currentStatus:n.status})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Summary"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),t.jsx("span",{className:"font-medium text-gray-900",children:As(((Ce=n.order_lines)==null?void 0:Ce.reduce((Pe,Ne)=>Pe+(Ne.subtotal||Ne.quantity*Ne.unit_price),0))||0)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600",children:["Tax",n.tax_percent!=null?` (${n.tax_percent}%)`:"",":"]}),t.jsx("span",{className:"font-medium text-gray-900",children:As(n.tax_amount!=null?n.tax_amount:0)})]}),t.jsx("div",{className:"border-t border-gray-200 pt-4",children:t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:As((((fe=n.order_lines)==null?void 0:fe.reduce((Pe,Ne)=>Pe+(Ne.subtotal||Ne.quantity*Ne.unit_price),0))||0)+(n.tax_amount!=null?n.tax_amount:0))})]})})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Details"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Account Status:"}),t.jsx("div",{className:"mt-1",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${((Ie=n.customer)==null?void 0:Ie.account_status)==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:((ke=n.customer)==null?void 0:ke.account_status)||"Unknown"})})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Credit Terms:"}),t.jsxs("div",{className:"mt-1 text-sm text-gray-900",children:[((et=n.customer)==null?void 0:et.credit_terms_days)||0," days"]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"space-y-3",children:[["draft","confirmed"].includes(n.status)&&t.jsxs("button",{onClick:()=>k(!0),className:"w-full flex items-center justify-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ai,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Order"})]}),t.jsxs("button",{onClick:()=>U(lf(n.status)[0]),disabled:lf(n.status).length===0,className:"w-full flex items-center justify-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(Ki,{className:"h-4 w-4"}),t.jsx("span",{children:"Change Status"})]}),t.jsxs("button",{onClick:()=>N(!v),className:"w-full flex items-center justify-center space-x-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:[t.jsx(Ki,{className:"h-4 w-4"}),t.jsxs("span",{children:[v?"Hide":"Show"," Timeline"]})]})]})]})]})]}),g&&t.jsx(Sb,{isOpen:!!g,onClose:()=>x(null),onSubmit:V,order:g.order,newStatus:g.newStatus,loading:q.isPending}),E&&t.jsx(GC,{isOpen:E,onClose:()=>k(!1),order:n})]})},WC=({orders:c,onOrderClick:d,onDateChange:g,onReschedule:x})=>{const[v,N]=le.useState(new Date),[E,k]=le.useState(null),n=se=>se.toISOString().split("T")[0],M=se=>se.toLocaleDateString("en-US",{month:"long",year:"numeric"}),z=se=>{const de=se.getFullYear(),ae=se.getMonth(),Se=new Date(de,ae,1),fe=new Date(de,ae+1,0).getDate(),Ie=Se.getDay(),ke=[];for(let et=0;et<Ie;et++)ke.push(null);for(let et=1;et<=fe;et++)ke.push(new Date(de,ae,et));return ke},q=se=>{const de=n(se);return c.filter(ae=>ae.scheduled_date===de)},U=se=>{N(de=>{const ae=new Date(de);return se==="prev"?ae.setMonth(de.getMonth()-1):ae.setMonth(de.getMonth()+1),ae})},V=se=>{const de=n(se),ae=q(se);k(de),g(de,ae)},G=se=>{const de=q(se),ae=new Date;return ae.setHours(0,0,0,0),de.length===0?"empty":se<ae?"past":n(se)===n(ae)?"today":"scheduled"},H=se=>{const de=G(se),ae=E===n(se),Se="min-h-[80px] p-2 border border-gray-200 cursor-pointer transition-colors relative";if(ae)return`${Se} bg-blue-100 border-blue-300`;switch(de){case"today":return`${Se} bg-yellow-50 border-yellow-300 hover:bg-yellow-100`;case"scheduled":return`${Se} bg-green-50 border-green-200 hover:bg-green-100`;case"past":return`${Se} bg-gray-50 text-gray-500 hover:bg-gray-100`;default:return`${Se} hover:bg-gray-50`}},Y=z(v),ge=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],oe=le.useMemo(()=>{if(!E)return[];const se=new Date(E+"T00:00:00");return q(se)},[E,c]);return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Delivery Schedule"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:()=>U("prev"),className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:t.jsx(y_,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-lg font-medium text-gray-900 min-w-[200px] text-center",children:M(v)}),t.jsx("button",{onClick:()=>U("next"),className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:t.jsx(__,{className:"h-4 w-4"})})]})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-4",children:ge.map(se=>t.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500 border-b border-gray-200",children:se},se))}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-6",children:Y.map((se,de)=>t.jsx("div",{children:se?t.jsxs("div",{className:H(se),onClick:()=>V(se),children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:se.getDate()}),q(se).length>0&&t.jsxs("div",{className:"space-y-1",children:[q(se).slice(0,2).map(ae=>{var Se,Ce;return t.jsx("div",{className:"text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded truncate",title:`${(Se=ae.customer)==null?void 0:Se.name} - ${As(ae.total_amount||0)}`,children:(Ce=ae.customer)==null?void 0:Ce.name},ae.id)}),q(se).length>2&&t.jsxs("div",{className:"text-xs text-gray-500",children:["+",q(se).length-2," more"]})]})]}):t.jsx("div",{className:"min-h-[80px] p-2"})},de))}),E&&oe.length>0&&t.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Deliveries for ",new Date(E).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})]}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsxs("span",{children:[oe.length," deliveries"]})]})]}),t.jsx("div",{className:"space-y-3",children:oe.map(se=>{var de,ae,Se,Ce;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",onClick:()=>d(se),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(fs,{className:"h-4 w-4 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:(de=se.customer)==null?void 0:de.name}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(Nn,{className:"h-3 w-3"}),t.jsxs("span",{children:[(ae=se.delivery_address)==null?void 0:ae.city,", ",(Se=se.delivery_address)==null?void 0:Se.state]})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:As(se.total_amount||0)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[((Ce=se.order_lines)==null?void 0:Ce.length)||0," items"]})]})]},se.id)})}),t.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ki,{className:"h-4 w-4 text-blue-600"}),t.jsx("span",{className:"text-blue-800",children:"Estimated Route Time:"})]}),t.jsxs("span",{className:"font-medium text-blue-900",children:[Math.ceil(oe.length*.5)," hours"]})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[t.jsx("span",{className:"text-blue-800",children:"Total Revenue:"}),t.jsx("span",{className:"font-medium text-blue-900",children:As(oe.reduce((se,de)=>se+(de.total_amount||0),0))})]})]})]})]})},HC=()=>{const c=Hr(),[d,g]=le.useState(null),[x,v]=le.useState([]),{data:N}=rg({status:"scheduled",limit:1e3}),E=(N==null?void 0:N.orders)||[],k=G=>{c(`/orders/${G.id}`)},n=(G,H)=>{g(G),v(H)},M=async(G,H)=>{console.log("Reschedule order",G,"to",H)},z=()=>{const G=new Date().toISOString().split("T")[0];return E.filter(H=>H.scheduled_date===G)},q=()=>{const G=new Date().toISOString().split("T")[0];return E.filter(H=>H.scheduled_date&&H.scheduled_date>G)},U=z(),V=q();return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Delivery Schedule"})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:t.jsx(er,{className:"h-6 w-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Deliveries"}),t.jsx("p",{className:"text-3xl font-bold text-blue-600",children:U.length}),t.jsxs("p",{className:"text-sm text-gray-600",children:[U.reduce((G,H)=>G+(H.total_amount||0),0).toLocaleString("en-US",{style:"currency",currency:"USD"})," total value"]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:t.jsx(wr,{className:"h-6 w-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Deliveries"}),t.jsx("p",{className:"text-3xl font-bold text-green-600",children:V.length}),t.jsx("p",{className:"text-sm text-gray-600",children:"Next 30 days"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:t.jsx(fs,{className:"h-6 w-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Scheduled"}),t.jsx("p",{className:"text-3xl font-bold text-purple-600",children:E.length}),t.jsx("p",{className:"text-sm text-gray-600",children:"All scheduled orders"})]})]})})]}),t.jsx(WC,{orders:E,onOrderClick:k,onDateChange:n,onReschedule:M}),U.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Today's Delivery Route"}),t.jsx("div",{className:"space-y-3",children:U.map((G,H)=>{var Y,ge,oe,se;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>k(G),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:H+1}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:(Y=G.customer)==null?void 0:Y.name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[(ge=G.delivery_address)==null?void 0:ge.city,", ",(oe=G.delivery_address)==null?void 0:oe.state]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:(G.total_amount||0).toLocaleString("en-US",{style:"currency",currency:"USD"})}),t.jsxs("div",{className:"text-sm text-gray-600",children:[((se=G.order_lines)==null?void 0:se.length)||0," items"]})]})]},G.id)})}),t.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Estimated Route Time:"}),t.jsxs("span",{className:"font-medium text-gray-900",children:[Math.ceil(U.length*.5)," hours"]})]}),t.jsxs("div",{className:"flex justify-between text-sm mt-1",children:[t.jsx("span",{className:"text-gray-600",children:"Total Stops:"}),t.jsx("span",{className:"font-medium text-gray-900",children:U.length})]})]})]})]})},XC=({analytics:c,dateRange:d,onDateRangeChange:g})=>{const[x,v]=le.useState("overview"),N=n=>`${n.toFixed(1)}%`,E=n=>({draft:"bg-gray-500",confirmed:"bg-blue-500",scheduled:"bg-purple-500",en_route:"bg-orange-500",delivered:"bg-green-500",invoiced:"bg-teal-500",cancelled:"bg-red-500"})[n]||"bg-gray-500",k=[{id:"overview",label:"Overview",icon:Ko},{id:"trends",label:"Trends",icon:Sn},{id:"customers",label:"Customers",icon:ic},{id:"products",label:"Products",icon:fs},{id:"delivery",label:"Delivery",icon:Ki}];return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Order Analytics"}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:d.start,onChange:n=>g({...d,start:n.target.value}),className:"text-sm border border-gray-300 rounded px-2 py-1"}),t.jsx("span",{className:"text-gray-500",children:"to"}),t.jsx("input",{type:"date",value:d.end,onChange:n=>g({...d,end:n.target.value}),className:"text-sm border border-gray-300 rounded px-2 py-1"})]})})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"flex space-x-8 px-6",children:k.map(n=>t.jsxs("button",{onClick:()=>v(n.id),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${x===n.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(n.icon,{className:"h-4 w-4"}),t.jsx("span",{children:n.label})]},n.id))})}),t.jsxs("div",{className:"p-6",children:[x==="overview"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Orders by Status"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx("div",{className:"space-y-3",children:c.orders_by_status.map(n=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${E(n.status)}`}),t.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:n.status.replace("_"," ")})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm text-gray-600",children:n.count}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",N(n.percentage),")"]})]})]},n.status))}),t.jsx("div",{className:"relative",children:t.jsx("div",{className:"w-48 h-48 mx-auto relative",children:t.jsx("div",{className:"w-full h-full rounded-full bg-gray-200 relative overflow-hidden",children:c.orders_by_status.map((n,M)=>{const z=c.orders_by_status.slice(0,M).reduce((U,V)=>U+V.percentage,0)*3.6,q=n.percentage*3.6;return t.jsx("div",{className:`absolute inset-0 ${E(n.status)} opacity-80`,style:{clipPath:`polygon(50% 50%, ${50+50*Math.cos((z-90)*Math.PI/180)}% ${50+50*Math.sin((z-90)*Math.PI/180)}%, ${50+50*Math.cos((z+q-90)*Math.PI/180)}% ${50+50*Math.sin((z+q-90)*Math.PI/180)}%)`}},n.status)})})})})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Delivery Performance"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ki,{className:"h-5 w-5 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-900",children:"On-Time Deliveries"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-2xl font-bold text-green-900",children:c.delivery_performance.on_time_deliveries}),t.jsxs("div",{className:"text-sm text-green-700",children:[N(c.delivery_performance.on_time_deliveries/(c.delivery_performance.on_time_deliveries+c.delivery_performance.late_deliveries)*100)," success rate"]})]})]}),t.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ki,{className:"h-5 w-5 text-red-600"}),t.jsx("span",{className:"text-sm font-medium text-red-900",children:"Late Deliveries"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-2xl font-bold text-red-900",children:c.delivery_performance.late_deliveries}),t.jsx("div",{className:"text-sm text-red-700",children:"Need attention"})]})]}),t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Sn,{className:"h-5 w-5 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Avg Fulfillment"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[c.delivery_performance.avg_fulfillment_time,"h"]}),t.jsx("div",{className:"text-sm text-blue-700",children:"Average time"})]})]})]})]})]}),x==="trends"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Daily Order Trends"}),t.jsx("div",{className:"space-y-4",children:c.daily_trends.slice(-7).map(n=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:new Date(n.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.orders," orders"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:As(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[As(n.revenue/(n.orders||1))," avg"]})]})]},n.date))})]}),x==="customers"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Top Customers"}),t.jsx("div",{className:"space-y-3",children:c.top_customers.map((n,M)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["#",M+1]})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.customer_name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.order_count," orders"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:As(n.total_revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[As(n.total_revenue/n.order_count)," avg"]})]})]},n.customer_id))})]}),x==="products"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Top Products"}),t.jsx("div",{className:"space-y-3",children:c.top_products.map((n,M)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-green-600",children:["#",M+1]})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.product_name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.quantity_sold," units sold"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:As(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[As(n.revenue/n.quantity_sold)," per unit"]})]})]},n.product_id))})]}),x==="delivery"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Regional Breakdown"}),t.jsx("div",{className:"space-y-3",children:c.regional_breakdown.map((n,M)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Nn,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.region}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.order_count," orders"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:As(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[As(n.revenue/n.order_count)," avg"]})]})]},n.region))})]})]})]})]})},KC=()=>{const c=Hr(),[d,g]=le.useState({start:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),{data:x}=rg({order_date_from:d.start,order_date_to:d.end,limit:1e4}),v=(x==null?void 0:x.orders)||[],N=le.useMemo(()=>{const k=v.reduce((de,ae)=>(de[ae.status]=(de[ae.status]||0)+1,de),{}),n=v.length,M=Object.entries(k).map(([de,ae])=>({status:de,count:ae,percentage:n>0?ae/n*100:0})),z=v.reduce((de,ae)=>{const Se=ae.order_date;return de[Se]||(de[Se]={orders:0,revenue:0}),de[Se].orders+=1,de[Se].revenue+=ae.total_amount||0,de},{}),q=Object.entries(z).map(([de,ae])=>({date:de,orders:ae.orders,revenue:ae.revenue})).sort((de,ae)=>de.date.localeCompare(ae.date)),U=v.reduce((de,ae)=>{var fe;const Se=ae.customer_id,Ce=((fe=ae.customer)==null?void 0:fe.name)||"Unknown";return de[Se]||(de[Se]={customer_name:Ce,order_count:0,total_revenue:0}),de[Se].order_count+=1,de[Se].total_revenue+=ae.total_amount||0,de},{}),V=Object.entries(U).map(([de,ae])=>({customer_id:de,...ae})).sort((de,ae)=>ae.total_revenue-de.total_revenue).slice(0,10),G=v.reduce((de,ae)=>{var Se;return(Se=ae.order_lines)==null||Se.forEach(Ce=>{var ke;const fe=Ce.product_id,Ie=((ke=Ce.product)==null?void 0:ke.name)||"Unknown";de[fe]||(de[fe]={product_name:Ie,quantity_sold:0,revenue:0}),de[fe].quantity_sold+=Ce.quantity,de[fe].revenue+=Ce.subtotal||Ce.quantity*Ce.unit_price}),de},{}),H=Object.entries(G).map(([de,ae])=>({product_id:de,...ae})).sort((de,ae)=>ae.revenue-de.revenue).slice(0,10),Y=v.filter(de=>de.status==="delivered"),ge={on_time_deliveries:Math.floor(Y.length*.85),late_deliveries:Math.floor(Y.length*.15),avg_fulfillment_time:48},oe=v.reduce((de,ae)=>{var Ce;const Se=((Ce=ae.delivery_address)==null?void 0:Ce.city)||"Unknown";return de[Se]||(de[Se]={order_count:0,revenue:0}),de[Se].order_count+=1,de[Se].revenue+=ae.total_amount||0,de},{}),se=Object.entries(oe).map(([de,ae])=>({region:de,...ae})).sort((de,ae)=>ae.revenue-de.revenue).slice(0,10);return{orders_by_status:M,daily_trends:q,top_customers:V,top_products:H,delivery_performance:ge,regional_breakdown:se}},[v]),E=()=>{const k=[["Date Range",`${d.start} to ${d.end}`],["Total Orders",v.length.toString()],["Total Revenue",v.reduce((q,U)=>q+(U.total_amount||0),0).toString()],[],["Status","Count","Percentage"],...N.orders_by_status.map(q=>[q.status,q.count.toString(),`${q.percentage.toFixed(1)}%`]),[],["Top Customers","Orders","Revenue"],...N.top_customers.map(q=>[q.customer_name,q.order_count.toString(),q.total_revenue.toString()])].map(q=>q.join(",")).join(`
`),n=new Blob([k],{type:"text/csv"}),M=window.URL.createObjectURL(n),z=document.createElement("a");z.href=M,z.download=`order-report-${d.start}-to-${d.end}.csv`,document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(M)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Ar,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Reports & Analytics"})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("button",{onClick:E,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx($f,{className:"h-4 w-4"}),t.jsx("span",{children:"Export Report"})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ko,{className:"h-8 w-8 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Orders"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v.length})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(er,{className:"h-8 w-8 text-green-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v.reduce((k,n)=>k+(n.total_amount||0),0).toLocaleString("en-US",{style:"currency",currency:"USD"})})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ko,{className:"h-8 w-8 text-purple-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Avg Order Value"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v.length>0?(v.reduce((k,n)=>k+(n.total_amount||0),0)/v.length).toLocaleString("en-US",{style:"currency",currency:"USD"}):"$0"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(er,{className:"h-8 w-8 text-orange-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Completion Rate"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v.length>0?`${(v.filter(k=>["delivered","invoiced"].includes(k.status)).length/v.length*100).toFixed(1)}%`:"0%"})]})]})})]}),t.jsx(XC,{analytics:N,dateRange:d,onDateRangeChange:g})]})},QC=async c=>{throw new Error("DEPRECATED: Use tRPC inventory endpoints instead of direct Supabase calls")},JC=async c=>{throw new Error("DEPRECATED: Use tRPC transfer endpoints instead of direct Supabase calls")},YC=async c=>{throw new Error("DEPRECATED: Use tRPC transfer endpoints instead of direct Supabase calls")},Tb=async()=>{throw new Error("DEPRECATED: Use tRPC truck/warehouse endpoints instead of direct Supabase calls")},ek=({warehouseId:c})=>{const{data:d=[],isLoading:g,error:x}=wb(c);return c?g?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(tr,{className:"h-8 w-8 animate-spin text-blue-500"})}):x?t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:x.message||"Failed to load warehouse inventory"})})})}):d.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(fs,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Inventory"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This warehouse has no inventory yet."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(v=>{var N,E;return t.jsxs("tr",{children:[" ",t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((N=v.product)==null?void 0:N.name)||v.product_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:((E=v.product)==null?void 0:E.sku)||v.product_sku})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:v.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:v.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:new Date(v.updated_at).toLocaleString()})})]},v.id||`${v.product_id}`)})})]})}):null},Eb=({isOpen:c,onClose:d,onSelect:g})=>{const[x,v]=le.useState(""),{data:N}=cc({search:x,limit:1e3}),E=(N==null?void 0:N.products)||[];return c?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Select Product"}),t.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",children:t.jsx(Ys,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"p-4 border-b",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:x,onChange:k=>v(k.target.value),placeholder:"Search by product name or SKU...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:E.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(fs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No products found"})]}):t.jsx("div",{className:"space-y-2",children:E.map(k=>t.jsx("button",{onClick:()=>{g(k),d()},className:"w-full text-left p-3 hover:bg-blue-50 rounded-lg transition-colors",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:k.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",k.sku,"  ",k.unit_of_measure]})]}),t.jsx("div",{className:"text-sm text-gray-500",children:k.unit_of_measure})]})},k.id))})})]})}):null},tk=({onSuccess:c})=>{var et,Pe;const[d,g]=le.useState([]),[x,v]=le.useState(""),[N,E]=le.useState(""),[k,n]=le.useState([]),[M,z]=le.useState(!1),[q,U]=le.useState(!1),[V,G]=le.useState(null),[H,Y]=le.useState(""),{data:ge=[]}=sg(),[oe,se]=le.useState(!1),[de,ae]=le.useState(null);le.useEffect(()=>{Se()},[]);const Se=async()=>{try{const Ne=await Tb();g(Ne)}catch(Ne){G("Failed to load trucks"),console.error(Ne)}},Ce=async Ne=>{Ne.preventDefault(),z(!0),G(null);try{if(!x)throw new Error("Please select a truck");if(!N)throw new Error("Please select a warehouse");if(k.length===0)throw new Error("Please add at least one product");if(k.filter(Tt=>(!Tt.qty_full||Tt.qty_full<0)&&(!Tt.qty_empty||Tt.qty_empty<0)).length>0)throw new Error("Please enter valid quantities for all products");if(k.filter(Tt=>(Tt.qty_full||0)===0&&(Tt.qty_empty||0)===0).length>0)throw new Error("Each line must have at least one full or empty cylinder");const tt={truck_id:x,warehouse_id:N,lines:k.map(Tt=>({product_id:Tt.product_id,qty_full:Tt.qty_full||0,qty_empty:Tt.qty_empty||0}))};console.log("Creating transfer with data:",tt);const Mt=await JC(tt);console.log("Transfer created successfully:",Mt),v(""),E(""),n([]),U(!1),c&&c()}catch(it){console.error("Transfer creation error:",it),G(it.message||"Failed to create transfer")}finally{z(!1)}},fe=()=>{ae(k.length),se(!0)},Ie=Ne=>{if(de!==null){const it=[...k];de<k.length?it[de]={...it[de],product_id:Ne.id,product_name:Ne.name,product_sku:Ne.sku,unit_of_measure:Ne.unit_of_measure}:it.push({product_id:Ne.id,product_name:Ne.name,product_sku:Ne.sku,unit_of_measure:Ne.unit_of_measure,qty_full:"",qty_empty:""}),n(it)}se(!1),ae(null)},ke=d.filter(Ne=>Ne.fleet_number.toLowerCase().includes(H.toLowerCase())||Ne.license_plate.toLowerCase().includes(H.toLowerCase()));return t.jsxs("div",{className:"space-y-6",children:[V&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:V})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Source Warehouse"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:N,onChange:Ne=>E(Ne.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select a warehouse..."}),ge.map(Ne=>t.jsx("option",{value:Ne.id,children:Ne.name},Ne.id))]}),t.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Truck"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:H,onChange:Ne=>Y(Ne.target.value),placeholder:"Search by fleet number or license plate...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),H&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:t.jsx("div",{className:"max-h-60 overflow-auto",children:ke.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No trucks found"}):ke.map(Ne=>t.jsxs("div",{onClick:()=>{v(Ne.id),Y("")},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(wr,{className:"inline h-4 w-4 mr-1"}),Ne.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",Ne.license_plate]})]},Ne.id))})})]}),x&&t.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(wr,{className:"inline h-4 w-4 mr-1"}),(et=d.find(Ne=>Ne.id===x))==null?void 0:et.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",(Pe=d.find(Ne=>Ne.id===x))==null?void 0:Pe.license_plate]})]}),t.jsx("button",{onClick:()=>v(""),className:"text-gray-400 hover:text-gray-600",children:t.jsx(Ys,{className:"h-4 w-4"})})]})})]})]}),N&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Source Warehouse Inventory"}),t.jsx(ek,{warehouseId:N})]}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transfer Lines"}),t.jsxs("button",{type:"button",onClick:fe,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]}),t.jsx("div",{className:"space-y-4",children:k.map((Ne,it)=>t.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:Ne.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Ne.product_sku]})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Ne.qty_full,onChange:ft=>{const tt=[...k];tt[it].qty_full=ft.target.value===""?"":parseInt(ft.target.value),n(tt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Ne.qty_empty,onChange:ft=>{const tt=[...k];tt[it].qty_empty=ft.target.value===""?"":parseInt(ft.target.value),n(tt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx("button",{type:"button",onClick:()=>{const ft=[...k];ft.splice(it,1),n(ft)},className:"text-red-600 hover:text-red-800",children:t.jsx(Ys,{className:"h-5 w-5"})})]},it))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>U(!0),disabled:M||!x||!N||k.length===0,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Transfer"})}),t.jsx(ro,{isOpen:q,onClose:()=>U(!1),onConfirm:Ce,title:"Confirm Transfer",message:"Are you sure you want to create this transfer? This will move inventory from the warehouse to the truck.",confirmText:"Create Transfer",type:"info",loading:M}),t.jsx(Eb,{isOpen:oe,onClose:()=>{se(!1),ae(null)},onSelect:Ie})]})},sk=({truckId:c})=>{const[d,g]=le.useState([]),[x,v]=le.useState(!0),[N,E]=le.useState(null);le.useEffect(()=>{k()},[c]);const k=async()=>{try{v(!0),E(null);const n=await QC(c);g(n)}catch(n){E(n.message||"Failed to load truck inventory"),console.error(n)}finally{v(!1)}};return x?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(tr,{className:"h-8 w-8 animate-spin text-blue-500"})}):N?t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:N})})})}):d.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(fs,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Inventory"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This truck has no inventory yet."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(n=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.product_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:n.product_sku})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:n.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:n.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:new Date(n.updated_at).toLocaleString()})})]},n.product_id))})]})})},rk=({onSuccess:c})=>{var et,Pe;const[d,g]=le.useState([]),[x,v]=le.useState(""),[N,E]=le.useState(""),[k,n]=le.useState([]),[M,z]=le.useState(!1),[q,U]=le.useState(!1),[V,G]=le.useState(null),[H,Y]=le.useState(""),{data:ge=[]}=sg(),[oe,se]=le.useState(!1),[de,ae]=le.useState(null);le.useEffect(()=>{Se()},[]);const Se=async()=>{try{const Ne=await Tb();g(Ne)}catch(Ne){G("Failed to load trucks"),console.error(Ne)}},Ce=async Ne=>{Ne.preventDefault(),z(!0),G(null);try{if(!x)throw new Error("Please select a truck");if(!N)throw new Error("Please select a warehouse");if(k.length===0)throw new Error("Please add at least one product");if(k.filter(Tt=>(!Tt.qty_full||Tt.qty_full<0)&&(!Tt.qty_empty||Tt.qty_empty<0)).length>0)throw new Error("Please enter valid quantities for all products");if(k.filter(Tt=>(Tt.qty_full||0)===0&&(Tt.qty_empty||0)===0).length>0)throw new Error("Each line must have at least one full or empty cylinder");const tt={truck_id:x,warehouse_id:N,lines:k.map(Tt=>({product_id:Tt.product_id,qty_full:Tt.qty_full||0,qty_empty:Tt.qty_empty||0}))};console.log("Creating transfer with data:",tt);const Mt=await YC(tt);console.log("Transfer created successfully:",Mt),v(""),E(""),n([]),U(!1),c&&c()}catch(it){console.error("Transfer creation error:",it),G(it.message||"Failed to create transfer")}finally{z(!1)}},fe=()=>{ae(k.length),se(!0)},Ie=Ne=>{if(de!==null){const it=[...k];de<k.length?it[de]={...it[de],product_id:Ne.id,product_name:Ne.name,product_sku:Ne.sku,unit_of_measure:Ne.unit_of_measure}:it.push({product_id:Ne.id,product_name:Ne.name,product_sku:Ne.sku,unit_of_measure:Ne.unit_of_measure,qty_full:"",qty_empty:""}),n(it)}se(!1),ae(null)},ke=d.filter(Ne=>Ne.fleet_number.toLowerCase().includes(H.toLowerCase())||Ne.license_plate.toLowerCase().includes(H.toLowerCase()));return t.jsxs("div",{className:"space-y-6",children:[V&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:V})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Truck"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Qi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:H,onChange:Ne=>Y(Ne.target.value),placeholder:"Search by fleet number or license plate...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),H&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:t.jsx("div",{className:"max-h-60 overflow-auto",children:ke.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No trucks found"}):ke.map(Ne=>t.jsxs("div",{onClick:()=>{v(Ne.id),Y("")},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(wr,{className:"inline h-4 w-4 mr-1"}),Ne.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",Ne.license_plate]})]},Ne.id))})})]}),x&&t.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(wr,{className:"inline h-4 w-4 mr-1"}),(et=d.find(Ne=>Ne.id===x))==null?void 0:et.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",(Pe=d.find(Ne=>Ne.id===x))==null?void 0:Pe.license_plate]})]}),t.jsx("button",{onClick:()=>v(""),className:"text-gray-400 hover:text-gray-600",children:t.jsx(Ys,{className:"h-4 w-4"})})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Destination Warehouse"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:N,onChange:Ne=>E(Ne.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select a warehouse..."}),ge.map(Ne=>t.jsx("option",{value:Ne.id,children:Ne.name},Ne.id))]}),t.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]})]}),x&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Truck Inventory"}),t.jsx(sk,{truckId:x})]}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transfer Lines"}),t.jsxs("button",{type:"button",onClick:fe,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]}),t.jsx("div",{className:"space-y-4",children:k.map((Ne,it)=>t.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:Ne.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Ne.product_sku]})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Ne.qty_full,onChange:ft=>{const tt=[...k];tt[it].qty_full=ft.target.value===""?"":parseInt(ft.target.value),n(tt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Ne.qty_empty,onChange:ft=>{const tt=[...k];tt[it].qty_empty=ft.target.value===""?"":parseInt(ft.target.value),n(tt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx("button",{type:"button",onClick:()=>{const ft=[...k];ft.splice(it,1),n(ft)},className:"text-red-600 hover:text-red-800",children:t.jsx(Ys,{className:"h-5 w-5"})})]},it))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>U(!0),disabled:M||!x||!N||k.length===0,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Transfer"})}),t.jsx(ro,{isOpen:q,onClose:()=>U(!1),onConfirm:Ce,title:"Confirm Transfer",message:"Are you sure you want to create this transfer? This will move inventory from the truck to the warehouse.",confirmText:"Create Transfer",type:"info",loading:M}),t.jsx(Eb,{isOpen:oe,onClose:()=>{se(!1),ae(null)},onSelect:Ie})]})},ik=c=>{const[d,g]=le.useState(null),{data:x,isLoading:v,refetch:N}=kt.transfers.list.useQuery({source_warehouse_id:c==null?void 0:c.source_warehouse_id,destination_warehouse_id:c==null?void 0:c.destination_warehouse_id,status:c==null?void 0:c.status,transfer_type:c==null?void 0:c.transfer_type,date_from:c==null?void 0:c.date_from,date_to:c==null?void 0:c.date_to,created_by_user_id:c==null?void 0:c.created_by_user_id,search_text:c==null?void 0:c.search_text,page:1,limit:20,sort_by:"created_at",sort_order:"desc"},{retry:1,staleTime:3e4,onError:oe=>{g(oe.message),It.error("Failed to fetch transfers")}}),E=(x==null?void 0:x.transfers)||[],k=(x==null?void 0:x.totalCount)||0,n=le.useCallback(async oe=>{try{return await kt.transfers.getWarehouseStock.query({warehouse_id:oe})}catch(se){return console.error("Error fetching warehouse stock:",se),g("Failed to fetch warehouse stock"),null}},[]),{data:M,isLoading:z}=kt.transfers.searchProducts.useQuery({search:"",warehouse_id:c==null?void 0:c.source_warehouse_id,include_variants:!0,limit:50},{enabled:!1}),q=kt.transfers.validate.useMutation({onError:oe=>{g(oe.message),It.error("Transfer validation failed")}}),U=kt.transfers.create.useMutation({onSuccess:()=>{It.success("Transfer created successfully"),N()},onError:oe=>{g(oe.message),It.error("Failed to create transfer")}}),V=kt.transfers.updateStatus.useMutation({onSuccess:()=>{It.success("Transfer status updated"),N()},onError:oe=>{g(oe.message),It.error("Failed to update transfer status")}}),G=le.useCallback(async oe=>{try{return g(null),await q.mutateAsync(oe)}catch(se){return console.error("Transfer validation error:",se),{isValid:!1,errors:[se.message||"Validation failed"],warnings:[]}}},[q]),H=le.useCallback(async oe=>{try{return g(null),await U.mutateAsync(oe)}catch(se){return console.error("Create transfer error:",se),null}},[U]),Y=le.useCallback(async(oe,se,de)=>{try{g(null),await V.mutateAsync({transfer_id:oe,status:se,notes:de})}catch(ae){console.error("Update transfer status error:",ae)}},[V]),{data:ge}=kt.transfers.getCostAnalysis.useQuery({transfer_id:""},{enabled:!1});return{transfers:E,totalCount:k,loading:v,error:d,products:(M==null?void 0:M.products)||[],productsLoading:z,fetchTransfers:N,fetchWarehouseStock:n,validateTransfer:G,createTransfer:H,updateTransferStatus:Y,costAnalysis:ge,isValidating:q.isLoading,isCreating:U.isLoading,isUpdating:V.isLoading}},nk=c=>{const{data:d,isLoading:g,refetch:x}=kt.transfers.searchProducts.useQuery({search:"",warehouse_id:c,include_variants:!0,limit:100},{enabled:!!c,retry:1,staleTime:6e4});return{products:(d==null?void 0:d.products)||[],isLoading:g,refetch:x}},Cb=c=>{const{data:d,isLoading:g,refetch:x}=kt.transfers.getWarehouseStock.useQuery({warehouse_id:c||""},{enabled:!!c,retry:1,staleTime:6e4});return{stockInfo:(d==null?void 0:d.stock)||[],isLoading:g,refetch:()=>x(),fetchStockInfo:x}},ak=()=>{const[c,d]=le.useState([]),[g,x]=le.useState([]),[v,N]=le.useState({is_valid:!0,errors:[],warnings:[]}),[E,k]=le.useState(null),n=le.useCallback((q,U,V)=>{const G={product_id:q.id,product_sku:q.sku,product_name:q.name,variant_name:q.variant_name,quantity_to_transfer:U,unit_weight_kg:q.weight_kg||0,total_weight_kg:(q.weight_kg||0)*U,unit_cost:V.unit_cost||0,total_cost:(V.unit_cost||0)*U,available_stock:V.available_quantity||0};d(H=>{const Y=H.findIndex(ge=>ge.product_id===q.id&&ge.variant_name===q.variant_name);if(Y>=0){const ge=[...H];return ge[Y]={...ge[Y],quantity_to_transfer:U},ge}else return[...H,G]})},[]),M=le.useCallback((q,U)=>{d(V=>V.filter(G=>!(G.product_id===q&&G.variant_name===U)))},[]),z=le.useCallback((q,U,V)=>{const G=[],H=[];(!q||!U)&&G.push("Source and destination warehouses are required"),q===U&&G.push("Source and destination warehouses must be different"),c.length===0&&G.push("At least one item must be selected for transfer"),c.forEach(ge=>{ge.quantity_to_transfer>ge.available_stock&&G.push(`Insufficient stock for ${ge.product_name}: requested ${ge.quantity_to_transfer}, available ${ge.available_stock}`)});const Y={is_valid:G.length===0,errors:G,warnings:H};if(N(Y),Y.is_valid){const ge={total_items:c.length,total_quantity:c.reduce((oe,se)=>oe+se.quantity_to_transfer,0),total_weight:c.reduce((oe,se)=>oe+se.total_weight_kg,0),total_cost:c.reduce((oe,se)=>oe+se.total_cost,0)};k(ge)}return Y},[c]);return{selectedItems:c,validationResult:v,transferSummary:E,warehouseStockData:g,setWarehouseStockData:x,addItem:n,removeItem:M,validateTransfer:z}},ok=({warehouseId:c,onProductSelect:d,selectedProductIds:g,disabled:x=!1})=>{const[v,N]=le.useState({warehouse_id:c,has_stock:!0,search_text:"",variant_type:void 0,variant_name:void 0}),[E,k]=le.useState(!1),[n,M]=le.useState({}),{products:z,loading:q,searchProducts:U}=nk(),{stockInfo:V,loading:G,fetchStockInfo:H}=Cb(c);le.useEffect(()=>{v.warehouse_id&&(U(v),H(v))},[v,U,H]);const Y=fe=>{N(Ie=>({...Ie,search_text:fe}))},ge=(fe,Ie)=>{N(ke=>({...ke,[fe]:Ie}))},oe=(fe,Ie)=>{M(ke=>({...ke,[fe]:Ie}))},se=fe=>{const Ie=`${fe.id}-${fe.variant_name||"default"}`,ke=n[Ie]||1,et=V.find(Pe=>Pe.product_id===fe.id&&Pe.variant_name===fe.variant_name);if(!et){alert("Stock information not found for this product");return}if(ke>et.qty_available){alert(`Quantity exceeds available stock (${et.qty_available})`);return}d(fe,ke,et),M(Pe=>({...Pe,[Ie]:1}))},de=(fe,Ie)=>V.find(ke=>ke.product_id===fe&&ke.variant_name===Ie),ae=(fe,Ie)=>{const ke=`${fe}-${Ie||"default"}`;return g.includes(ke)},Se=fe=>!fe||fe.qty_available===0?{status:"out-of-stock",color:"text-red-600 bg-red-100",text:"Out of Stock"}:fe.qty_available<=(fe.reorder_level||0)?{status:"low-stock",color:"text-yellow-600 bg-yellow-100",text:"Low Stock"}:{status:"in-stock",color:"text-green-600 bg-green-100",text:"In Stock"},Ce=q||G;return t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Products"}),t.jsxs("button",{onClick:()=>k(!E),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-800",children:[t.jsx(Qu,{className:"h-4 w-4"}),t.jsx("span",{children:"Filters"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(Qi,{className:"h-5 w-5 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search products by name or SKU...",value:v.search_text||"",onChange:fe=>Y(fe.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),E&&t.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg space-y-4",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Type"}),t.jsxs("select",{value:v.variant_type||"",onChange:fe=>ge("variant_type",fe.target.value||void 0),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"cylinder",children:"Cylinders"}),t.jsx("option",{value:"refillable",children:"Refillable"}),t.jsx("option",{value:"disposable",children:"Disposable"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Variant"}),t.jsxs("select",{value:v.variant_name||"",onChange:fe=>ge("variant_name",fe.target.value||void 0),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"",children:"All Variants"}),t.jsx("option",{value:"full",children:"Full"}),t.jsx("option",{value:"empty",children:"Empty"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Status"}),t.jsxs("select",{value:v.has_stock?"in-stock":"all",onChange:fe=>ge("has_stock",fe.target.value==="in-stock"),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"all",children:"All Products"}),t.jsx("option",{value:"in-stock",children:"In Stock Only"})]})]})]})})]}),t.jsx("div",{className:"p-4",children:Ce?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),t.jsx("span",{className:"ml-2 text-gray-600",children:"Loading products..."})]}):z.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(fs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 mb-2",children:"No products found"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your search criteria or filters"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:z.map(fe=>{const Ie=de(fe.id,fe.variant_name),ke=Se(Ie),et=`${fe.id}-${fe.variant_name||"default"}`,Pe=ae(fe.id,fe.variant_name),Ne=n[et]||1;return t.jsxs("div",{className:`border rounded-lg p-4 transition-all duration-200 ${Pe?"border-blue-500 bg-blue-50":x||ke.status==="out-of-stock"?"border-gray-200 bg-gray-50 opacity-75":"border-gray-300 hover:border-blue-300 hover:shadow-sm"}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:fe.name}),t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["SKU: ",fe.sku]}),fe.variant_name&&t.jsx("span",{className:"inline-block bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded mt-1",children:fe.variant_name})]}),t.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${ke.color}`,children:ke.text})]}),Ie&&t.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Available:"}),t.jsx("span",{className:"font-medium",children:Ie.qty_available})]}),Ie.qty_reserved>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Reserved:"}),t.jsx("span",{children:Ie.qty_reserved})]}),fe.capacity_kg&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Weight:"}),t.jsxs("span",{children:[fe.capacity_kg,"kg"]})]})]}),ke.status!=="out-of-stock"&&!x&&t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"number",min:"1",max:(Ie==null?void 0:Ie.qty_available)||999,value:Ne,onChange:it=>oe(et,parseInt(it.target.value)||1),className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["max ",(Ie==null?void 0:Ie.qty_available)||0]})]})]}),t.jsx("div",{children:Pe?t.jsxs("div",{className:"flex items-center justify-center py-2 text-sm text-blue-600",children:[t.jsx(VN,{className:"h-4 w-4 mr-1"}),"Selected"]}):ke.status==="out-of-stock"?t.jsxs("div",{className:"flex items-center justify-center py-2 text-sm text-gray-500",children:[t.jsx(nm,{className:"h-4 w-4 mr-1"}),"Out of Stock"]}):t.jsxs("button",{onClick:()=>se(fe),disabled:x||Ne>((Ie==null?void 0:Ie.qty_available)||0),className:`w-full flex items-center justify-center py-2 px-3 text-sm font-medium rounded-md ${x||Ne>((Ie==null?void 0:Ie.qty_available)||0)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[t.jsx(vr,{className:"h-4 w-4 mr-1"}),"Add to Transfer"]})})]},et)})})}),z.length>0&&t.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50 text-sm text-gray-600",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{children:["Showing ",z.length," product",z.length!==1?"s":""]}),t.jsxs("span",{children:[g.length," selected for transfer"]})]})})]})};function lk(c){const d=[];return c.errors.forEach(g=>{d.push({severity:"error",message:g})}),c.warnings.forEach(g=>{d.push({severity:"warning",message:g})}),d}function ck(c,d,g){const v=new Date(g).toISOString().slice(0,10).replace(/-/g,""),N=Math.random().toString(36).substring(2,6).toUpperCase();return`TR-${c}-${d}-${v}-${N}`}const j0=({summary:c,validationResult:d,selectedItems:g,onRemoveItem:x,showItemDetails:v=!0})=>{var n,M;if(!c||g.length===0)return t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:t.jsxs("div",{className:"text-center text-gray-500",children:[t.jsx(fs,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{children:"No items selected for transfer"})]})});const N=d?lk(d):[],E=d&&!d.is_valid,k=d&&d.warnings.length>0;return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(fs,{className:"h-5 w-5 text-blue-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Items"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_products})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Sn,{className:"h-5 w-5 text-green-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Quantity"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_quantity})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Sf,{className:"h-5 w-5 text-purple-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Weight"}),t.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[c.total_weight_kg.toFixed(1),"kg"]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(wr,{className:"h-5 w-5 text-orange-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Variants"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.unique_variants})]})]})})]}),d&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center mb-3",children:[E?t.jsx(Qa,{className:"h-5 w-5 text-red-500 mr-2"}):k?t.jsx($s,{className:"h-5 w-5 text-yellow-500 mr-2"}):t.jsx(pa,{className:"h-5 w-5 text-green-500 mr-2"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Validation Status"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.validation_summary.valid_items}),t.jsx("p",{className:"text-sm text-gray-600",children:"Valid Items"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.validation_summary.invalid_items}),t.jsx("p",{className:"text-sm text-gray-600",children:"Invalid Items"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.validation_summary.items_with_warnings}),t.jsx("p",{className:"text-sm text-gray-600",children:"Warnings"})]})]}),N.length>0&&t.jsx("div",{className:"space-y-2",children:N.map((z,q)=>t.jsxs("div",{className:`flex items-start p-3 rounded-md ${z.severity==="error"?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[z.severity==="error"?t.jsx(Qa,{className:"h-4 w-4 text-red-500 mr-2 mt-0.5 flex-shrink-0"}):t.jsx($s,{className:"h-4 w-4 text-yellow-500 mr-2 mt-0.5 flex-shrink-0"}),t.jsx("span",{className:`text-sm ${z.severity==="error"?"text-red-700":"text-yellow-700"}`,children:z.message})]},q))})]}),v&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Selected Items"})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"space-y-3",children:g.map((z,q)=>t.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${z.is_valid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center mb-1",children:[t.jsx("h4",{className:"font-medium text-gray-900 mr-2",children:z.product_name}),z.variant_name&&t.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:z.variant_name}),!z.is_valid&&t.jsx(Qa,{className:"h-4 w-4 text-red-500 ml-2"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("span",{children:["SKU: ",z.product_sku]}),t.jsx("span",{className:"mx-2",children:""}),t.jsxs("span",{children:["Qty: ",z.quantity_to_transfer]}),z.total_weight_kg&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mx-2",children:""}),t.jsxs("span",{children:["Weight: ",z.total_weight_kg.toFixed(1),"kg"]})]})]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Available: ",z.available_stock,z.reserved_stock&&z.reserved_stock>0&&t.jsxs("span",{children:["  Reserved: ",z.reserved_stock]})]}),(z.validation_errors.length>0||z.validation_warnings.length>0)&&t.jsxs("div",{className:"mt-2 space-y-1",children:[z.validation_errors.map((U,V)=>t.jsxs("div",{className:"text-xs text-red-600 flex items-center",children:[t.jsx(Qa,{className:"h-3 w-3 mr-1"}),U]},V)),z.validation_warnings.map((U,V)=>t.jsxs("div",{className:"text-xs text-yellow-600 flex items-center",children:[t.jsx($s,{className:"h-3 w-3 mr-1"}),U]},V))]})]}),x&&t.jsx("button",{onClick:()=>x(z.product_id,z.variant_name),className:"ml-4 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full",title:"Remove item",children:t.jsx(Qa,{className:"h-4 w-4"})})]},`${z.product_id}-${z.variant_name||"default"}`))})})]}),(c.heaviest_item||c.most_expensive_item)&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Additional Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.heaviest_item&&t.jsxs("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(Sf,{className:"h-4 w-4 text-purple-500 mr-2"}),t.jsx("span",{className:"font-medium text-purple-700",children:"Heaviest Item"})]}),t.jsxs("p",{className:"text-sm text-purple-600",children:[c.heaviest_item.product_name," - ",(n=c.heaviest_item.total_weight_kg)==null?void 0:n.toFixed(1),"kg"]})]}),c.most_expensive_item&&c.total_cost&&t.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(Sn,{className:"h-4 w-4 text-green-500 mr-2"}),t.jsx("span",{className:"font-medium text-green-700",children:"Most Expensive Item"})]}),t.jsxs("p",{className:"text-sm text-green-600",children:[c.most_expensive_item.product_name," - $",(M=c.most_expensive_item.total_cost)==null?void 0:M.toFixed(2)]})]})]}),c.total_cost&&t.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-blue-700",children:"Estimated Total Cost"}),t.jsxs("span",{className:"text-lg font-bold text-blue-900",children:["$",c.total_cost.toFixed(2)]})]})})]})]})},uk=({onTransferCreated:c,onCancel:d,initialSourceWarehouseId:g,initialDestinationWarehouseId:x})=>{var Ne,it;const[v,N]=le.useState({source_warehouse_id:g||"",destination_warehouse_id:x||"",transfer_date:new Date().toISOString().split("T")[0],priority:"normal",transfer_reference:"",reason:"",notes:"",instructions:"",selected_items:[]}),[E,k]=le.useState("setup"),{data:n}=tg(),M=(n==null?void 0:n.warehouses)||[],{createTransfer:z,loading:q}=ik(),{selectedItems:U,validationResult:V,transferSummary:G,setWarehouseStockData:H,addItem:Y,removeItem:ge,validateTransfer:oe}=ak(),{stockInfo:se,fetchStockInfo:de}=Cb();le.useEffect(()=>{if(v.source_warehouse_id&&v.destination_warehouse_id&&!v.transfer_reference&&M.length>0){const ft=M.find(Mt=>Mt.id===v.source_warehouse_id),tt=M.find(Mt=>Mt.id===v.destination_warehouse_id);if(ft&&tt){const Mt=ck(ft.name.substring(0,3).toUpperCase(),tt.name.substring(0,3).toUpperCase(),v.transfer_date);N(Tt=>({...Tt,transfer_reference:Mt}))}}},[v.source_warehouse_id,v.destination_warehouse_id,v.transfer_date,M]),le.useEffect(()=>{v.source_warehouse_id&&de({warehouse_id:v.source_warehouse_id,has_stock:!0})},[v.source_warehouse_id,de]),le.useEffect(()=>{H(se)},[se,H]),le.useEffect(()=>{U.length>0&&v.source_warehouse_id&&v.destination_warehouse_id&&oe(v.source_warehouse_id,v.destination_warehouse_id,v.transfer_date)},[U,v,oe]);const ae=(ft,tt)=>{N(Mt=>({...Mt,[ft]:tt}))},Se=(ft,tt,Mt)=>{Y(ft,tt,Mt)},Ce=(ft,tt)=>{ge(ft,tt)},fe=()=>{if(E==="setup"){if(!v.source_warehouse_id||!v.destination_warehouse_id){alert("Please select both source and destination warehouses");return}if(v.source_warehouse_id===v.destination_warehouse_id){alert("Source and destination warehouses must be different");return}k("products")}else if(E==="products"){if(U.length===0){alert("Please select at least one product for transfer");return}k("review")}},Ie=()=>{E==="products"?k("setup"):E==="review"&&k("products")},ke=async()=>{if(!(V!=null&&V.is_valid)){alert("Please fix validation errors before submitting");return}try{const ft={source_warehouse_id:v.source_warehouse_id,destination_warehouse_id:v.destination_warehouse_id,transfer_date:v.transfer_date,items:U.map(Mt=>({product_id:Mt.product_id,product_sku:Mt.product_sku,product_name:Mt.product_name,variant_name:Mt.variant_name,quantity_to_transfer:Mt.quantity_to_transfer,unit_weight_kg:Mt.unit_weight_kg,total_weight_kg:Mt.total_weight_kg,unit_cost:Mt.unit_cost,total_cost:Mt.total_cost})),notes:v.notes,reason:v.reason,priority:v.priority,transfer_reference:v.transfer_reference},tt=await z(ft);tt&&c&&c(tt.id)}catch(ft){console.error("Error submitting transfer:",ft)}},et=()=>E==="setup"?v.source_warehouse_id&&v.destination_warehouse_id&&v.source_warehouse_id!==v.destination_warehouse_id:E==="products"?U.length>0:!0,Pe=U.map(ft=>`${ft.product_id}-${ft.variant_name||"default"}`);return t.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Multi-SKU Transfer"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${E==="setup"?"bg-blue-500 text-white":"bg-blue-100 text-blue-600"}`,children:"1"}),t.jsx("div",{className:"w-8 h-1 bg-gray-200"}),t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${E==="products"?"bg-blue-500 text-white":E==="review"?"bg-blue-100 text-blue-600":"bg-gray-200 text-gray-500"}`,children:"2"}),t.jsx("div",{className:"w-8 h-1 bg-gray-200"}),t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${E==="review"?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:"3"})]})]}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{className:E==="setup"?"font-medium text-blue-600":"",children:"Setup Transfer"}),t.jsx("span",{className:E==="products"?"font-medium text-blue-600":"",children:"Select Products"}),t.jsx("span",{className:E==="review"?"font-medium text-blue-600":"",children:"Review & Submit"})]})]}),E==="setup"&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transfer Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(x_,{className:"h-4 w-4 inline mr-1"}),"Source Warehouse"]}),t.jsx(Jh,{value:v.source_warehouse_id,onChange:ft=>ae("source_warehouse_id",ft),placeholder:"Select source warehouse"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Vf,{className:"h-4 w-4 inline mr-1"}),"Destination Warehouse"]}),t.jsx(Jh,{value:v.destination_warehouse_id,onChange:ft=>ae("destination_warehouse_id",ft),placeholder:"Select destination warehouse",excludeIds:v.source_warehouse_id?[v.source_warehouse_id]:[]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(er,{className:"h-4 w-4 inline mr-1"}),"Transfer Date"]}),t.jsx("input",{type:"date",value:v.transfer_date,onChange:ft=>ae("transfer_date",ft.target.value),min:new Date().toISOString().split("T")[0],className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),t.jsxs("select",{value:v.priority,onChange:ft=>ae("priority",ft.target.value),className:"block w-full border border-gray-300 rounded-md py-2 px-3",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"normal",children:"Normal"}),t.jsx("option",{value:"high",children:"High"}),t.jsx("option",{value:"urgent",children:"Urgent"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Transfer"}),t.jsxs("select",{value:v.reason,onChange:ft=>ae("reason",ft.target.value),className:"block w-full border border-gray-300 rounded-md py-2 px-3",children:[t.jsx("option",{value:"",children:"Select reason"}),t.jsx("option",{value:"restock",children:"Restock"}),t.jsx("option",{value:"redistribution",children:"Redistribution"}),t.jsx("option",{value:"shortage",children:"Stock Shortage"}),t.jsx("option",{value:"maintenance",children:"Maintenance"}),t.jsx("option",{value:"optimization",children:"Inventory Optimization"}),t.jsx("option",{value:"other",children:"Other"})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Reference"}),t.jsx("input",{type:"text",value:v.transfer_reference,onChange:ft=>ae("transfer_reference",ft.target.value),placeholder:"Auto-generated",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),t.jsx("textarea",{value:v.notes,onChange:ft=>ae("notes",ft.target.value),rows:4,placeholder:"Add any additional notes about this transfer...",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions"}),t.jsx("textarea",{value:v.instructions,onChange:ft=>ae("instructions",ft.target.value),rows:3,placeholder:"Any special handling instructions...",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]})]})]})]}),E==="products"&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[t.jsx("div",{children:t.jsx(ok,{warehouseId:v.source_warehouse_id,onProductSelect:Se,selectedProductIds:Pe})}),t.jsx("div",{children:t.jsx(j0,{summary:G,validationResult:V,selectedItems:U,onRemoveItem:Ce,showItemDetails:!0})})]}),E==="review"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transfer Overview"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Source"}),t.jsx("p",{className:"font-medium",children:(Ne=M.find(ft=>ft.id===v.source_warehouse_id))==null?void 0:Ne.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Destination"}),t.jsx("p",{className:"font-medium",children:(it=M.find(ft=>ft.id===v.destination_warehouse_id))==null?void 0:it.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Transfer Date"}),t.jsx("p",{className:"font-medium",children:v.transfer_date})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Priority"}),t.jsx("p",{className:"font-medium capitalize",children:v.priority})]})]})]}),V&&!V.is_valid&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx($s,{className:"h-5 w-5 text-red-500 mr-2"}),t.jsx("h3",{className:"font-semibold text-red-800",children:"Validation Errors"})]}),t.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:V.errors.map((ft,tt)=>t.jsxs("li",{children:[" ",ft]},tt))})]}),t.jsx(j0,{summary:G,validationResult:V,selectedItems:U,onRemoveItem:Ce,showItemDetails:!0})]}),t.jsxs("div",{className:"flex justify-between items-center bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("div",{children:E!=="setup"&&t.jsx("button",{onClick:Ie,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Previous"})}),t.jsxs("div",{className:"flex space-x-3",children:[d&&t.jsx("button",{onClick:d,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),E!=="review"?t.jsx("button",{onClick:fe,disabled:!et(),className:`px-4 py-2 rounded-md font-medium ${et()?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"}):t.jsxs("button",{onClick:ke,disabled:!(V!=null&&V.is_valid)||q,className:`flex items-center px-6 py-2 rounded-md font-medium ${V!=null&&V.is_valid&&!q?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[t.jsx(iS,{className:"h-4 w-4 mr-2"}),q?"Creating...":"Submit Transfer"]})]})]})]})};function kb(c){var d,g,x="";if(typeof c=="string"||typeof c=="number")x+=c;else if(typeof c=="object")if(Array.isArray(c)){var v=c.length;for(d=0;d<v;d++)c[d]&&(g=kb(c[d]))&&(x&&(x+=" "),x+=g)}else for(g in c)c[g]&&(x&&(x+=" "),x+=g);return x}function dk(){for(var c,d,g=0,x="",v=arguments.length;g<v;g++)(c=arguments[g])&&(d=kb(c))&&(x&&(x+=" "),x+=d);return x}const ig="-",hk=c=>{const d=pk(c),{conflictingClassGroups:g,conflictingClassGroupModifiers:x}=c;return{getClassGroupId:E=>{const k=E.split(ig);return k[0]===""&&k.length!==1&&k.shift(),Ab(k,d)||mk(E)},getConflictingClassGroupIds:(E,k)=>{const n=g[E]||[];return k&&x[E]?[...n,...x[E]]:n}}},Ab=(c,d)=>{var E;if(c.length===0)return d.classGroupId;const g=c[0],x=d.nextPart.get(g),v=x?Ab(c.slice(1),x):void 0;if(v)return v;if(d.validators.length===0)return;const N=c.join(ig);return(E=d.validators.find(({validator:k})=>k(N)))==null?void 0:E.classGroupId},N0=/^\[(.+)\]$/,mk=c=>{if(N0.test(c)){const d=N0.exec(c)[1],g=d==null?void 0:d.substring(0,d.indexOf(":"));if(g)return"arbitrary.."+g}},pk=c=>{const{theme:d,prefix:g}=c,x={nextPart:new Map,validators:[]};return gk(Object.entries(c.classGroups),g).forEach(([N,E])=>{Df(E,x,N,d)}),x},Df=(c,d,g,x)=>{c.forEach(v=>{if(typeof v=="string"){const N=v===""?d:S0(d,v);N.classGroupId=g;return}if(typeof v=="function"){if(fk(v)){Df(v(x),d,g,x);return}d.validators.push({validator:v,classGroupId:g});return}Object.entries(v).forEach(([N,E])=>{Df(E,S0(d,N),g,x)})})},S0=(c,d)=>{let g=c;return d.split(ig).forEach(x=>{g.nextPart.has(x)||g.nextPart.set(x,{nextPart:new Map,validators:[]}),g=g.nextPart.get(x)}),g},fk=c=>c.isThemeGetter,gk=(c,d)=>d?c.map(([g,x])=>{const v=x.map(N=>typeof N=="string"?d+N:typeof N=="object"?Object.fromEntries(Object.entries(N).map(([E,k])=>[d+E,k])):N);return[g,v]}):c,xk=c=>{if(c<1)return{get:()=>{},set:()=>{}};let d=0,g=new Map,x=new Map;const v=(N,E)=>{g.set(N,E),d++,d>c&&(d=0,x=g,g=new Map)};return{get(N){let E=g.get(N);if(E!==void 0)return E;if((E=x.get(N))!==void 0)return v(N,E),E},set(N,E){g.has(N)?g.set(N,E):v(N,E)}}},Mb="!",yk=c=>{const{separator:d,experimentalParseClassName:g}=c,x=d.length===1,v=d[0],N=d.length,E=k=>{const n=[];let M=0,z=0,q;for(let Y=0;Y<k.length;Y++){let ge=k[Y];if(M===0){if(ge===v&&(x||k.slice(Y,Y+N)===d)){n.push(k.slice(z,Y)),z=Y+N;continue}if(ge==="/"){q=Y;continue}}ge==="["?M++:ge==="]"&&M--}const U=n.length===0?k:k.substring(z),V=U.startsWith(Mb),G=V?U.substring(1):U,H=q&&q>z?q-z:void 0;return{modifiers:n,hasImportantModifier:V,baseClassName:G,maybePostfixModifierPosition:H}};return g?k=>g({className:k,parseClassName:E}):E},_k=c=>{if(c.length<=1)return c;const d=[];let g=[];return c.forEach(x=>{x[0]==="["?(d.push(...g.sort(),x),g=[]):g.push(x)}),d.push(...g.sort()),d},bk=c=>({cache:xk(c.cacheSize),parseClassName:yk(c),...hk(c)}),vk=/\s+/,wk=(c,d)=>{const{parseClassName:g,getClassGroupId:x,getConflictingClassGroupIds:v}=d,N=[],E=c.trim().split(vk);let k="";for(let n=E.length-1;n>=0;n-=1){const M=E[n],{modifiers:z,hasImportantModifier:q,baseClassName:U,maybePostfixModifierPosition:V}=g(M);let G=!!V,H=x(G?U.substring(0,V):U);if(!H){if(!G){k=M+(k.length>0?" "+k:k);continue}if(H=x(U),!H){k=M+(k.length>0?" "+k:k);continue}G=!1}const Y=_k(z).join(":"),ge=q?Y+Mb:Y,oe=ge+H;if(N.includes(oe))continue;N.push(oe);const se=v(H,G);for(let de=0;de<se.length;++de){const ae=se[de];N.push(ge+ae)}k=M+(k.length>0?" "+k:k)}return k};function jk(){let c=0,d,g,x="";for(;c<arguments.length;)(d=arguments[c++])&&(g=Pb(d))&&(x&&(x+=" "),x+=g);return x}const Pb=c=>{if(typeof c=="string")return c;let d,g="";for(let x=0;x<c.length;x++)c[x]&&(d=Pb(c[x]))&&(g&&(g+=" "),g+=d);return g};function Nk(c,...d){let g,x,v,N=E;function E(n){const M=d.reduce((z,q)=>q(z),c());return g=bk(M),x=g.cache.get,v=g.cache.set,N=k,k(n)}function k(n){const M=x(n);if(M)return M;const z=wk(n,g);return v(n,z),z}return function(){return N(jk.apply(null,arguments))}}const Ws=c=>{const d=g=>g[c]||[];return d.isThemeGetter=!0,d},Ib=/^\[(?:([a-z-]+):)?(.+)\]$/i,Sk=/^\d+\/\d+$/,Tk=new Set(["px","full","screen"]),Ek=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ck=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,kk=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ak=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Mk=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ha=c=>sc(c)||Tk.has(c)||Sk.test(c),Wa=c=>uc(c,"length",Fk),sc=c=>!!c&&!Number.isNaN(Number(c)),df=c=>uc(c,"number",sc),Gu=c=>!!c&&Number.isInteger(Number(c)),Pk=c=>c.endsWith("%")&&sc(c.slice(0,-1)),us=c=>Ib.test(c),Ha=c=>Ek.test(c),Ik=new Set(["length","size","percentage"]),Dk=c=>uc(c,Ik,Db),Lk=c=>uc(c,"position",Db),Rk=new Set(["image","url"]),zk=c=>uc(c,Rk,Uk),Ok=c=>uc(c,"",Bk),Zu=()=>!0,uc=(c,d,g)=>{const x=Ib.exec(c);return x?x[1]?typeof d=="string"?x[1]===d:d.has(x[1]):g(x[2]):!1},Fk=c=>Ck.test(c)&&!kk.test(c),Db=()=>!1,Bk=c=>Ak.test(c),Uk=c=>Mk.test(c),Vk=()=>{const c=Ws("colors"),d=Ws("spacing"),g=Ws("blur"),x=Ws("brightness"),v=Ws("borderColor"),N=Ws("borderRadius"),E=Ws("borderSpacing"),k=Ws("borderWidth"),n=Ws("contrast"),M=Ws("grayscale"),z=Ws("hueRotate"),q=Ws("invert"),U=Ws("gap"),V=Ws("gradientColorStops"),G=Ws("gradientColorStopPositions"),H=Ws("inset"),Y=Ws("margin"),ge=Ws("opacity"),oe=Ws("padding"),se=Ws("saturate"),de=Ws("scale"),ae=Ws("sepia"),Se=Ws("skew"),Ce=Ws("space"),fe=Ws("translate"),Ie=()=>["auto","contain","none"],ke=()=>["auto","hidden","clip","visible","scroll"],et=()=>["auto",us,d],Pe=()=>[us,d],Ne=()=>["",ha,Wa],it=()=>["auto",sc,us],ft=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],tt=()=>["solid","dashed","dotted","double","none"],Mt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Tt=()=>["start","end","center","between","around","evenly","stretch"],At=()=>["","0",us],zs=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ts=()=>[sc,us];return{cacheSize:500,separator:":",theme:{colors:[Zu],spacing:[ha,Wa],blur:["none","",Ha,us],brightness:ts(),borderColor:[c],borderRadius:["none","","full",Ha,us],borderSpacing:Pe(),borderWidth:Ne(),contrast:ts(),grayscale:At(),hueRotate:ts(),invert:At(),gap:Pe(),gradientColorStops:[c],gradientColorStopPositions:[Pk,Wa],inset:et(),margin:et(),opacity:ts(),padding:Pe(),saturate:ts(),scale:ts(),sepia:At(),skew:ts(),space:Pe(),translate:Pe()},classGroups:{aspect:[{aspect:["auto","square","video",us]}],container:["container"],columns:[{columns:[Ha]}],"break-after":[{"break-after":zs()}],"break-before":[{"break-before":zs()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ft(),us]}],overflow:[{overflow:ke()}],"overflow-x":[{"overflow-x":ke()}],"overflow-y":[{"overflow-y":ke()}],overscroll:[{overscroll:Ie()}],"overscroll-x":[{"overscroll-x":Ie()}],"overscroll-y":[{"overscroll-y":Ie()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[H]}],"inset-x":[{"inset-x":[H]}],"inset-y":[{"inset-y":[H]}],start:[{start:[H]}],end:[{end:[H]}],top:[{top:[H]}],right:[{right:[H]}],bottom:[{bottom:[H]}],left:[{left:[H]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Gu,us]}],basis:[{basis:et()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",us]}],grow:[{grow:At()}],shrink:[{shrink:At()}],order:[{order:["first","last","none",Gu,us]}],"grid-cols":[{"grid-cols":[Zu]}],"col-start-end":[{col:["auto",{span:["full",Gu,us]},us]}],"col-start":[{"col-start":it()}],"col-end":[{"col-end":it()}],"grid-rows":[{"grid-rows":[Zu]}],"row-start-end":[{row:["auto",{span:[Gu,us]},us]}],"row-start":[{"row-start":it()}],"row-end":[{"row-end":it()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",us]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",us]}],gap:[{gap:[U]}],"gap-x":[{"gap-x":[U]}],"gap-y":[{"gap-y":[U]}],"justify-content":[{justify:["normal",...Tt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Tt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Tt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[oe]}],px:[{px:[oe]}],py:[{py:[oe]}],ps:[{ps:[oe]}],pe:[{pe:[oe]}],pt:[{pt:[oe]}],pr:[{pr:[oe]}],pb:[{pb:[oe]}],pl:[{pl:[oe]}],m:[{m:[Y]}],mx:[{mx:[Y]}],my:[{my:[Y]}],ms:[{ms:[Y]}],me:[{me:[Y]}],mt:[{mt:[Y]}],mr:[{mr:[Y]}],mb:[{mb:[Y]}],ml:[{ml:[Y]}],"space-x":[{"space-x":[Ce]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ce]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",us,d]}],"min-w":[{"min-w":[us,d,"min","max","fit"]}],"max-w":[{"max-w":[us,d,"none","full","min","max","fit","prose",{screen:[Ha]},Ha]}],h:[{h:[us,d,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[us,d,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[us,d,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[us,d,"auto","min","max","fit"]}],"font-size":[{text:["base",Ha,Wa]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",df]}],"font-family":[{font:[Zu]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",us]}],"line-clamp":[{"line-clamp":["none",sc,df]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ha,us]}],"list-image":[{"list-image":["none",us]}],"list-style-type":[{list:["none","disc","decimal",us]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[c]}],"placeholder-opacity":[{"placeholder-opacity":[ge]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[c]}],"text-opacity":[{"text-opacity":[ge]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...tt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ha,Wa]}],"underline-offset":[{"underline-offset":["auto",ha,us]}],"text-decoration-color":[{decoration:[c]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Pe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",us]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",us]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ge]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ft(),Lk]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Dk]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},zk]}],"bg-color":[{bg:[c]}],"gradient-from-pos":[{from:[G]}],"gradient-via-pos":[{via:[G]}],"gradient-to-pos":[{to:[G]}],"gradient-from":[{from:[V]}],"gradient-via":[{via:[V]}],"gradient-to":[{to:[V]}],rounded:[{rounded:[N]}],"rounded-s":[{"rounded-s":[N]}],"rounded-e":[{"rounded-e":[N]}],"rounded-t":[{"rounded-t":[N]}],"rounded-r":[{"rounded-r":[N]}],"rounded-b":[{"rounded-b":[N]}],"rounded-l":[{"rounded-l":[N]}],"rounded-ss":[{"rounded-ss":[N]}],"rounded-se":[{"rounded-se":[N]}],"rounded-ee":[{"rounded-ee":[N]}],"rounded-es":[{"rounded-es":[N]}],"rounded-tl":[{"rounded-tl":[N]}],"rounded-tr":[{"rounded-tr":[N]}],"rounded-br":[{"rounded-br":[N]}],"rounded-bl":[{"rounded-bl":[N]}],"border-w":[{border:[k]}],"border-w-x":[{"border-x":[k]}],"border-w-y":[{"border-y":[k]}],"border-w-s":[{"border-s":[k]}],"border-w-e":[{"border-e":[k]}],"border-w-t":[{"border-t":[k]}],"border-w-r":[{"border-r":[k]}],"border-w-b":[{"border-b":[k]}],"border-w-l":[{"border-l":[k]}],"border-opacity":[{"border-opacity":[ge]}],"border-style":[{border:[...tt(),"hidden"]}],"divide-x":[{"divide-x":[k]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[k]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ge]}],"divide-style":[{divide:tt()}],"border-color":[{border:[v]}],"border-color-x":[{"border-x":[v]}],"border-color-y":[{"border-y":[v]}],"border-color-s":[{"border-s":[v]}],"border-color-e":[{"border-e":[v]}],"border-color-t":[{"border-t":[v]}],"border-color-r":[{"border-r":[v]}],"border-color-b":[{"border-b":[v]}],"border-color-l":[{"border-l":[v]}],"divide-color":[{divide:[v]}],"outline-style":[{outline:["",...tt()]}],"outline-offset":[{"outline-offset":[ha,us]}],"outline-w":[{outline:[ha,Wa]}],"outline-color":[{outline:[c]}],"ring-w":[{ring:Ne()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[c]}],"ring-opacity":[{"ring-opacity":[ge]}],"ring-offset-w":[{"ring-offset":[ha,Wa]}],"ring-offset-color":[{"ring-offset":[c]}],shadow:[{shadow:["","inner","none",Ha,Ok]}],"shadow-color":[{shadow:[Zu]}],opacity:[{opacity:[ge]}],"mix-blend":[{"mix-blend":[...Mt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Mt()}],filter:[{filter:["","none"]}],blur:[{blur:[g]}],brightness:[{brightness:[x]}],contrast:[{contrast:[n]}],"drop-shadow":[{"drop-shadow":["","none",Ha,us]}],grayscale:[{grayscale:[M]}],"hue-rotate":[{"hue-rotate":[z]}],invert:[{invert:[q]}],saturate:[{saturate:[se]}],sepia:[{sepia:[ae]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[g]}],"backdrop-brightness":[{"backdrop-brightness":[x]}],"backdrop-contrast":[{"backdrop-contrast":[n]}],"backdrop-grayscale":[{"backdrop-grayscale":[M]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[z]}],"backdrop-invert":[{"backdrop-invert":[q]}],"backdrop-opacity":[{"backdrop-opacity":[ge]}],"backdrop-saturate":[{"backdrop-saturate":[se]}],"backdrop-sepia":[{"backdrop-sepia":[ae]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[E]}],"border-spacing-x":[{"border-spacing-x":[E]}],"border-spacing-y":[{"border-spacing-y":[E]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",us]}],duration:[{duration:ts()}],ease:[{ease:["linear","in","out","in-out",us]}],delay:[{delay:ts()}],animate:[{animate:["none","spin","ping","pulse","bounce",us]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[de]}],"scale-x":[{"scale-x":[de]}],"scale-y":[{"scale-y":[de]}],rotate:[{rotate:[Gu,us]}],"translate-x":[{"translate-x":[fe]}],"translate-y":[{"translate-y":[fe]}],"skew-x":[{"skew-x":[Se]}],"skew-y":[{"skew-y":[Se]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",us]}],accent:[{accent:["auto",c]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",us]}],"caret-color":[{caret:[c]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Pe()}],"scroll-mx":[{"scroll-mx":Pe()}],"scroll-my":[{"scroll-my":Pe()}],"scroll-ms":[{"scroll-ms":Pe()}],"scroll-me":[{"scroll-me":Pe()}],"scroll-mt":[{"scroll-mt":Pe()}],"scroll-mr":[{"scroll-mr":Pe()}],"scroll-mb":[{"scroll-mb":Pe()}],"scroll-ml":[{"scroll-ml":Pe()}],"scroll-p":[{"scroll-p":Pe()}],"scroll-px":[{"scroll-px":Pe()}],"scroll-py":[{"scroll-py":Pe()}],"scroll-ps":[{"scroll-ps":Pe()}],"scroll-pe":[{"scroll-pe":Pe()}],"scroll-pt":[{"scroll-pt":Pe()}],"scroll-pr":[{"scroll-pr":Pe()}],"scroll-pb":[{"scroll-pb":Pe()}],"scroll-pl":[{"scroll-pl":Pe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",us]}],fill:[{fill:[c,"none"]}],"stroke-w":[{stroke:[ha,Wa,df]}],stroke:[{stroke:[c,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},qk=Nk(Vk);function id(...c){return qk(dk(c))}const $k=({value:c,onValueChange:d,children:g,className:x})=>t.jsx("div",{className:id("w-full",x),"data-state":c,children:g}),Gk=({children:c,className:d})=>t.jsx("div",{className:id("inline-flex h-10 items-center justify-center rounded-lg bg-gray-100 p-1 text-gray-500",d),children:c}),hf=({value:c,children:d,className:g})=>t.jsx("button",{role:"tab","data-state":c,className:id("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=true]:bg-white data-[state=true]:text-gray-950 data-[state=true]:shadow-sm",g),children:d}),mf=({value:c,children:d,className:g})=>t.jsx("div",{role:"tabpanel","data-state":c,className:id("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2",g),children:d}),T0=({children:c,className:d})=>t.jsx("div",{className:id("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm",d),children:c}),Zk=()=>{const[c,d]=le.useState("load");return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Transfers"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage inventory transfers between warehouses and trucks"})]}),t.jsxs($k,{value:c,onValueChange:d,className:"space-y-6",children:[t.jsxs(Gk,{className:"grid w-full grid-cols-3",children:[t.jsxs(hf,{value:"load",className:"flex items-center space-x-2",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Load Truck"})]}),t.jsxs(hf,{value:"return",className:"flex items-center space-x-2",children:[t.jsx(Vf,{className:"h-4 w-4"}),t.jsx("span",{children:"Return to Warehouse"})]}),t.jsxs(hf,{value:"multi-sku",className:"flex items-center space-x-2",children:[t.jsx(fs,{className:"h-4 w-4"}),t.jsx("span",{children:"Multi-SKU Transfer"})]})]}),t.jsx(mf,{value:"load",children:t.jsx(T0,{children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Load Truck"}),t.jsx(tk,{})]})})}),t.jsx(mf,{value:"return",children:t.jsx(T0,{children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Return to Warehouse"}),t.jsx(rk,{})]})})}),t.jsx(mf,{value:"multi-sku",children:t.jsx(uk,{onTransferCreated:g=>{console.log("Transfer created:",g)}})})]})]})},Wk=()=>t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),t.jsx("p",{className:"text-gray-600",children:"System configuration and preferences"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx(nS,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"System Settings"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"This page will contain system configuration options, user preferences, and administrative settings."}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-500",children:[t.jsx("p",{children:" User account management"}),t.jsx("p",{children:" System preferences and configuration"}),t.jsx("p",{children:" Security settings and permissions"}),t.jsx("p",{children:" Backup and maintenance options"})]})]})})]}),Hk=({trucks:c,loading:d,onStatusChange:g})=>d?t.jsx("div",{className:"flex justify-center items-center h-32",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):c.length?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Truck Details"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Load"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"relative px-6 py-3",children:t.jsx("span",{className:"sr-only",children:"Actions"})})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(x=>{const v=(x.inventory||[]).reduce((k,n)=>k+(n.qty_full||0)+(n.qty_empty||0),0),N=v/x.capacity_cylinders*100,E=N>100;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(wr,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.fleet_number}),t.jsx("div",{className:"text-sm text-gray-500",children:x.license_plate})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:x.driver_name||"Unassigned"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("div",{className:"text-sm text-gray-900",children:x.capacity_cylinders})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("div",{className:"w-48",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("span",{className:"text-xs font-medium text-gray-500",children:[v," / ",x.capacity_cylinders]}),E&&t.jsx(nm,{className:"h-4 w-4 text-red-500",title:"Overloaded"})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full ${E?"bg-red-500":"bg-blue-500"}`,style:{width:`${Math.min(N,100)}%`}})})]})})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("select",{value:x.active?"active":"inactive",onChange:k=>g(x,k.target.value==="active"),className:`block w-full pl-3 pr-10 py-2 text-sm border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${x.active?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx(pf,{to:`/trucks/${x.id}`,className:"text-blue-600 hover:text-blue-900",children:"View Details"})})]},x.id)})})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(wr,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No trucks"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new truck."}),t.jsx("div",{className:"mt-6",children:t.jsx(pf,{to:"/trucks/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"Add Truck"})})]}),Xk=(c={})=>kt.trucks.list.useQuery(c,{retry:1,staleTime:3e4,select:d=>({trucks:d.trucks,isLoading:!1,error:null,totalCount:d.totalCount,totalPages:d.totalPages,currentPage:d.currentPage})}),Kk=c=>kt.trucks.get.useQuery({id:c},{enabled:!!c}),Qk=()=>kt.trucks.create.useMutation({onSuccess:c=>{console.log("Truck created successfully:",c),It.success("Truck created successfully")},onError:c=>{console.error("Create truck mutation error:",c),It.error(c.message||"Failed to create truck")}}),Lb=()=>kt.trucks.update.useMutation({onSuccess:c=>{console.log("Truck updated successfully:",c),It.success("Truck updated successfully")},onError:c=>{console.error("Update truck mutation error:",c),It.error(c.message||"Failed to update truck")}}),Jk=()=>{const{data:c,isLoading:d,error:g}=Xk(),x=Lb(),v=(c==null?void 0:c.trucks)||[],N=async(E,k)=>{try{await x.mutateAsync({id:E.id,active:k})}catch(n){console.error("Error updating truck status:",n),alert("Failed to update truck status. Please try again.")}};return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Trucks"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage your fleet and monitor truck inventory"})]}),t.jsxs(pf,{to:"/trucks/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[t.jsx(vr,{className:"-ml-1 mr-2 h-5 w-5"}),"Add Truck"]})]}),g&&t.jsx("div",{className:"rounded-md bg-red-50 p-4 mb-8",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:g.message})})})}),t.jsx(Hk,{trucks:v,loading:d,onStatusChange:N})]})},Rb=({initialData:c,onSuccess:d})=>{const g=Hr(),x=Qk(),v=Lb(),[N,E]=le.useState(null),[k,n]=le.useState({fleet_number:(c==null?void 0:c.fleet_number)||"",license_plate:(c==null?void 0:c.license_plate)||"",capacity_cylinders:(c==null?void 0:c.capacity_cylinders)||"",driver_name:(c==null?void 0:c.driver_name)||"",active:(c==null?void 0:c.active)??!0}),M=x.isLoading||v.isLoading,z=async q=>{if(q.preventDefault(),!M){E(null);try{if(!k.fleet_number)throw new Error("Fleet number is required");if(!k.license_plate)throw new Error("License plate is required");const U=parseInt(String(k.capacity_cylinders));if(isNaN(U)||U<=0)throw new Error("Capacity must be a valid number greater than 0");const V={fleet_number:k.fleet_number,license_plate:k.license_plate,capacity_cylinders:U,driver_name:k.driver_name||null,active:k.active};let G;c!=null&&c.id?G=await v.mutateAsync({id:c.id,...V}):G=await x.mutateAsync(V),console.log("Operation successful, result:",G),d?d():(console.log("Navigating to:",`/trucks/${G.id}`),g(`/trucks/${G.id}`))}catch(U){console.error("Form submission error:",U),E(U.message||"Failed to save truck")}}};return t.jsxs("form",{onSubmit:z,className:"space-y-6",children:[N&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:N})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(wr,{className:"h-6 w-6 text-gray-400"}),t.jsx("h3",{className:"ml-2 text-lg font-medium text-gray-900",children:c?"Edit Truck":"New Truck"})]})}),t.jsxs("div",{className:"px-6 py-5 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"fleet_number",className:"block text-sm font-medium text-gray-700",children:"Fleet Number"}),t.jsx("input",{type:"text",id:"fleet_number",value:k.fleet_number,onChange:q=>n({...k,fleet_number:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"license_plate",className:"block text-sm font-medium text-gray-700",children:"License Plate"}),t.jsx("input",{type:"text",id:"license_plate",value:k.license_plate,onChange:q=>n({...k,license_plate:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_cylinders",className:"block text-sm font-medium text-gray-700",children:"Capacity (Cylinders)"}),t.jsx("input",{type:"number",id:"capacity_cylinders",min:"1",placeholder:"Enter capacity",value:k.capacity_cylinders||"",onChange:q=>{const U=q.target.value;n(V=>({...V,capacity_cylinders:U===""?"":parseInt(U)}))},className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"driver_name",className:"block text-sm font-medium text-gray-700",children:"Driver Name"}),t.jsx("input",{type:"text",id:"driver_name",value:k.driver_name,onChange:q=>n({...k,driver_name:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"active",checked:k.active,onChange:q=>n({...k,active:q.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"active",className:"ml-2 block text-sm text-gray-900",children:"Active"})]})]}),t.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>g("/trucks"),className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:M,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:M?t.jsxs("div",{className:"flex items-center",children:[t.jsx(tr,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Saving..."]}):"Save Truck"})]})})]})]})},Yk=()=>{const{id:c}=nc(),d=Hr(),[g,x]=le.useState(!1),{data:v,isLoading:N,error:E}=Kk(c||"");if(N)return t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})});if(E||!v)return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:(E==null?void 0:E.message)||"Truck not found"})})})})});if(g)return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("button",{onClick:()=>x(!1),className:"mb-6 inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t.jsx(Ar,{className:"h-4 w-4 mr-1"}),"Back to Details"]}),t.jsx(Rb,{initialData:v,onSuccess:()=>{x(!1),loadTruckDetails()}})]});const k=v.inventory.reduce((n,M)=>n+(M.qty_full||0)+(M.qty_empty||0),0);return k/v.capacity_cylinders*100,t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("button",{onClick:()=>d("/trucks"),className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t.jsx(Ar,{className:"h-4 w-4 mr-1"}),"Back to Trucks"]})}),t.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(wr,{className:"h-6 w-6 text-gray-400"}),t.jsx("h1",{className:"ml-2 text-xl font-semibold text-gray-900",children:v.fleet_number}),t.jsx("span",{className:`ml-4 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${v.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:v.active?"Active":"Inactive"})]}),t.jsxs("button",{onClick:()=>x(!0),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[t.jsx(ai,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),t.jsxs("div",{className:"px-6 py-5 grid grid-cols-1 gap-6 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Truck Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"License Plate"}),t.jsx("p",{className:"mt-1",children:v.license_plate})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Driver"}),t.jsx("p",{className:"mt-1",children:v.driver_name||"Not assigned"})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Capacity"}),t.jsxs("p",{className:"mt-1",children:[v.capacity_cylinders," cylinders"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Current Load"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("p",{className:"text-lg font-medium",children:[k," / ",v.capacity_cylinders," cylinders"]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:t.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${k/(v.capacity_cylinders||1)*100}%`}})})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Inventory Breakdown"}),v.inventory.length===0?t.jsx("p",{className:"text-sm text-gray-500",children:"No inventory items"}):t.jsx("div",{className:"space-y-3",children:v.inventory.map(n=>t.jsxs("div",{className:"flex items-start",children:[t.jsx(fs,{className:"h-5 w-5 text-gray-400 mt-0.5"}),t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.product_name}),t.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",n.product_sku]}),t.jsxs("div",{className:"mt-1 flex space-x-4",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:["Full: ",n.qty_full||0]}),t.jsxs("span",{className:"text-xs text-gray-500",children:["Empty: ",n.qty_empty||0]})]})]})]},n.product_id))})]})]})]})]})]})},eA=()=>{const c=Hr();return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Add New Truck"}),t.jsx(Rb,{onSuccess:()=>c("/trucks")})]})},tA=({schedule:c,onClick:d})=>{const{truck:g,capacity_info:x,allocations:v,maintenance_due:N,fuel_sufficient:E}=c,k=q=>{switch(q){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-gray-600 bg-gray-100";case"maintenance":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}},n=(q,U)=>U?"bg-red-500":q>85?"bg-orange-500":q>60?"bg-yellow-500":"bg-green-500",M=q=>q>=1e3?`${(q/1e3).toFixed(1)}t`:`${q}kg`,z=[];return N&&z.push("Maintenance Due"),E||z.push("Low Fuel"),x.is_overallocated&&z.push("Overallocated"),t.jsxs("div",{className:`bg-white rounded-lg shadow border-2 transition-all duration-200 hover:shadow-md ${d?"cursor-pointer hover:border-blue-300":"border-gray-200"} ${x.is_overallocated?"border-red-300":"border-gray-200"}`,onClick:d,children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(wr,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:g.fleet_number}),t.jsx("p",{className:"text-sm text-gray-600",children:g.license_plate})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ym,{status:g.status,className:k(g.status)}),z.length>0&&t.jsxs("div",{className:"flex items-center text-red-600",children:[t.jsx($s,{className:"h-4 w-4"}),t.jsx("span",{className:"text-xs ml-1",children:z.length})]})]})]})}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Capacity"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[M(x.allocated_weight_kg)," / ",M(x.total_capacity_kg)]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:t.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${n(x.utilization_percentage,x.is_overallocated)}`,style:{width:`${Math.min(x.utilization_percentage,100)}%`}})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[t.jsx("span",{children:"0%"}),t.jsxs("span",{className:"font-medium",children:[x.utilization_percentage.toFixed(1),"%"]}),t.jsx("span",{children:"100%"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(fs,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Orders"}),t.jsx("p",{className:"font-semibold",children:x.orders_count})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(wr,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Available"}),t.jsx("p",{className:"font-semibold",children:M(x.available_weight_kg)})]})]}),g.driver_name&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"h-4 w-4 bg-gray-400 rounded-full"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Driver"}),t.jsx("p",{className:"font-semibold text-sm",children:g.driver_name})]})]}),c.route&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ki,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Route"}),t.jsx("p",{className:"font-semibold",children:c.route.route_status})]})]})]}),z.length>0&&t.jsxs("div",{className:"space-y-1",children:[N&&t.jsxs("div",{className:"flex items-center space-x-2 text-yellow-700 bg-yellow-50 p-2 rounded",children:[t.jsx(oS,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Maintenance due"})]}),!E&&t.jsxs("div",{className:"flex items-center space-x-2 text-orange-700 bg-orange-50 p-2 rounded",children:[t.jsx(v_,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Check fuel level"})]}),x.is_overallocated&&t.jsxs("div",{className:"flex items-center space-x-2 text-red-700 bg-red-50 p-2 rounded",children:[t.jsx($s,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:["Capacity exceeded by ",M(x.allocated_weight_kg-x.total_capacity_kg)]})]})]}),v.length>0&&t.jsxs("div",{className:"border-t pt-3 mt-3",children:[t.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-2",children:["Today's Orders (",v.length,")"]}),t.jsxs("div",{className:"space-y-1",children:[v.slice(0,3).map((q,U)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-gray-600",children:["Order #",q.order_id.slice(-6)]}),t.jsx("span",{className:"font-medium",children:M(q.estimated_weight_kg)})]},q.id)),v.length>3&&t.jsxs("p",{className:"text-xs text-gray-500",children:["+",v.length-3," more orders"]})]})]})]})})]})},sA=({order:c,orderWeight:d,recommendations:g,selectedTruckId:x,onTruckSelect:v,onCancel:N,onConfirm:E,isLoading:k=!1})=>{const[n,M]=le.useState(!1),z=H=>H>=1e3?`${(H/1e3).toFixed(1)}t`:`${H}kg`,q=g.filter(H=>H.can_accommodate),U=g.filter(H=>!H.can_accommodate),V=g.find(H=>H.truck.id===x),G=x&&(V==null?void 0:V.can_accommodate);return t.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 max-w-4xl w-full",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Assign Truck for Order #",c.id.slice(-6)]}),t.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(fs,{className:"h-4 w-4"}),t.jsxs("span",{children:["Order Weight: ",z(d)]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Sf,{className:"h-4 w-4"}),t.jsxs("span",{children:["Delivery Date: ",c.scheduled_date||"Today"]})]})]})]}),t.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600",children:""})]})}),t.jsxs("div",{className:"px-6 py-4",children:[q.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center",children:[t.jsx(pa,{className:"h-5 w-5 text-green-500 mr-2"}),"Available Trucks (",q.length,")"]}),t.jsx("div",{className:"grid gap-3",children:q.map(H=>t.jsx(E0,{recommendation:H,orderWeight:d,isSelected:x===H.truck.id,onClick:()=>v(H.truck.id)},H.truck.id))})]}),U.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-700 flex items-center",children:[t.jsx($s,{className:"h-5 w-5 text-red-500 mr-2"}),"Unavailable Trucks (",U.length,")"]}),t.jsxs("button",{onClick:()=>M(!n),className:"text-sm text-blue-600 hover:text-blue-800",children:[n?"Hide":"Show"," unavailable trucks"]})]}),n&&t.jsx("div",{className:"grid gap-3 opacity-75",children:U.map(H=>t.jsx(E0,{recommendation:H,orderWeight:d,isSelected:!1,onClick:()=>{},disabled:!0},H.truck.id))})]}),g.length===0&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(wr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"No trucks available for this order"})]})]}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-gray-600",children:V&&t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{children:["Selected: ",V.truck.fleet_number]}),t.jsxs("span",{children:["Utilization after: ",((V.capacity_info.allocated_weight_kg+d)/V.capacity_info.total_capacity_kg*100).toFixed(1),"%"]})]})}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:N,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:E,disabled:!G||k,className:`px-4 py-2 rounded-md font-medium ${G&&!k?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:k?"Assigning...":"Assign Truck"})]})]})})]})},E0=({recommendation:c,orderWeight:d,isSelected:g,onClick:x,disabled:v=!1})=>{const{truck:N,capacity_info:E,warnings:k,errors:n}=c,M=q=>q>=1e3?`${(q/1e3).toFixed(1)}t`:`${q}kg`,z=(E.allocated_weight_kg+d)/E.total_capacity_kg*100;return t.jsxs("div",{className:`border-2 rounded-lg p-4 transition-all duration-200 ${v?"cursor-not-allowed opacity-75":"cursor-pointer"} ${g?"border-blue-500 bg-blue-50":n.length>0?"border-red-300 hover:border-red-400":k.length>0?"border-yellow-300 hover:border-yellow-400":"border-gray-200 hover:border-blue-300"}`,onClick:v?void 0:x,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${g?"bg-blue-200":"bg-gray-100"}`,children:t.jsx(wr,{className:`h-5 w-5 ${g?"text-blue-600":"text-gray-600"}`})}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900",children:N.fleet_number}),t.jsx("p",{className:"text-sm text-gray-600",children:N.license_plate}),N.driver_name&&t.jsxs("p",{className:"text-xs text-gray-500",children:["Driver: ",N.driver_name]})]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:n.length>0?t.jsx($s,{className:"h-5 w-5 text-red-500"}):k.length>0?t.jsx($s,{className:"h-5 w-5 text-yellow-500"}):t.jsx(pa,{className:"h-5 w-5 text-green-500"})})]}),t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[t.jsxs("span",{children:["Current: ",E.utilization_percentage.toFixed(1),"%"]}),t.jsxs("span",{children:["After: ",z.toFixed(1),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsxs("div",{className:"flex h-2 rounded-full overflow-hidden",children:[t.jsx("div",{className:"bg-blue-500",style:{width:`${Math.min(E.utilization_percentage,100)}%`}}),t.jsx("div",{className:`${z>100?"bg-red-500":z>85?"bg-orange-500":"bg-blue-300"}`,style:{width:`${Math.min(Math.max(0,z-E.utilization_percentage),100-E.utilization_percentage)}%`}})]})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[t.jsxs("span",{children:[M(E.allocated_weight_kg)," / ",M(E.total_capacity_kg)]}),t.jsxs("span",{children:["Available: ",M(E.available_weight_kg)]})]})]}),(n.length>0||k.length>0)&&t.jsxs("div",{className:"mt-3 space-y-1",children:[n.map((q,U)=>t.jsx("div",{className:"text-xs text-red-700 bg-red-50 p-2 rounded",children:q},U)),k.map((q,U)=>t.jsx("div",{className:"text-xs text-yellow-700 bg-yellow-50 p-2 rounded",children:q},U))]})]})},rA=()=>{const[c,d]=le.useState(new Date().toISOString().split("T")[0]),[g,x]=le.useState(!1),v={total_capacity_kg:5400,total_allocated_kg:3780,overall_utilization:70,active_trucks:8,overallocated_trucks:1,maintenance_due_trucks:2},N=[],E=M=>M>=1e3?`${(M/1e3).toFixed(1)}t`:`${M}kg`,k=M=>new Date(M).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),n=M=>"text-yellow-600 bg-yellow-100";return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsx("div",{className:"py-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Fleet Capacity Dashboard"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Monitor truck capacity and optimize delivery allocations"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(er,{className:"h-5 w-5 text-gray-400"}),t.jsx("input",{type:"date",value:c,onChange:M=>d(M.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),t.jsxs("button",{onClick:()=>x(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center space-x-2",children:[t.jsx(vr,{className:"h-4 w-4"}),t.jsx("span",{children:"Allocate Order"})]})]})]})})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Sn,{className:`h-8 w-8 ${n()}`})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Fleet Utilization"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[v.overall_utilization.toFixed(1),"%"]}),t.jsxs("p",{className:"text-xs text-gray-500",children:[E(v.total_allocated_kg)," / ",E(v.total_capacity_kg)]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(wr,{className:"h-8 w-8 text-blue-600 bg-blue-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Trucks"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:v.active_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Available for delivery"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx($s,{className:"h-8 w-8 text-red-600 bg-red-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overallocated"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:v.overallocated_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Need attention"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(fs,{className:"h-8 w-8 text-yellow-600 bg-yellow-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Maintenance Due"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:v.maintenance_due_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Schedule soon"})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Fleet Capacity for ",k(c)]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[E(v.total_allocated_kg)," allocated of ",E(v.total_capacity_kg)," total capacity"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-2",children:t.jsx("div",{className:"h-4 rounded-full transition-all duration-500 bg-yellow-500",style:{width:`${Math.min(v.overall_utilization,100)}%`}})}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{children:"0%"}),t.jsxs("span",{className:"font-medium",children:[v.overall_utilization.toFixed(1),"% Utilized"]}),t.jsx("span",{children:"100%"})]})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Truck Capacity Details"}),t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),t.jsx("span",{children:"Good utilization"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),t.jsx("span",{children:"High utilization"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),t.jsx("span",{children:"Overallocated"})]})]})]}),N.length>0?t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:N.map(M=>t.jsx(tA,{schedule:M,onClick:()=>{console.log("Truck clicked:",M.truck_id)}},M.truck_id))}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(wr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsxs("p",{className:"text-gray-600 mb-2",children:["No truck schedules for ",k(c)]}),t.jsx("p",{className:"text-sm text-gray-500",children:"Try selecting a different date or ensure trucks are properly configured"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(vr,{className:"h-6 w-6 text-blue-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Allocate Orders"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Assign pending orders to trucks"})]})]})}),t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-green-400 hover:bg-green-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Sn,{className:"h-6 w-6 text-green-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Optimize Routes"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Auto-optimize truck allocations"})]})]})}),t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-yellow-400 hover:bg-yellow-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($s,{className:"h-6 w-6 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Maintenance"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Schedule truck maintenance"})]})]})})]})]})]}),g&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsx(sA,{order:{id:"sample-order",scheduled_date:c},orderWeight:150,recommendations:[],onTruckSelect:M=>console.log("Selected:",M),onCancel:()=>x(!1),onConfirm:()=>{x(!1)}})})]})},iA=new V0({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1}}});function nA(){return t.jsx(W0,{client:iA,children:t.jsxs(zN,{children:[t.jsx(x1,{children:t.jsxs(y1,{children:[t.jsx(Js,{path:"/login",element:t.jsx(pS,{})}),t.jsxs(Js,{path:"/*",element:t.jsx(cS,{children:t.jsx(mS,{})}),children:[t.jsx(Js,{index:!0,element:t.jsx(gS,{})}),t.jsx(Js,{path:"customers",element:t.jsx(jE,{})}),t.jsx(Js,{path:"customers/:id",element:t.jsx(LE,{})}),t.jsx(Js,{path:"products",element:t.jsx(XE,{})}),t.jsx(Js,{path:"products/:id",element:t.jsx(iC,{})}),t.jsx(Js,{path:"warehouses",element:t.jsx(hC,{})}),t.jsx(Js,{path:"warehouses/:id",element:t.jsx(yC,{})}),t.jsx(Js,{path:"inventory",element:t.jsx(NC,{})}),t.jsx(Js,{path:"pricing",element:t.jsx(kC,{})}),t.jsx(Js,{path:"pricing/:id",element:t.jsx(PC,{})}),t.jsx(Js,{path:"orders",element:t.jsx(BC,{})}),t.jsx(Js,{path:"orders/new",element:t.jsx(qC,{})}),t.jsx(Js,{path:"orders/schedule",element:t.jsx(HC,{})}),t.jsx(Js,{path:"orders/reports",element:t.jsx(KC,{})}),t.jsx(Js,{path:"orders/:id",element:t.jsx(ZC,{})}),t.jsx(Js,{path:"transfers",element:t.jsx(Zk,{})}),t.jsx(Js,{path:"settings",element:t.jsx(Wk,{})}),t.jsxs(Js,{path:"trucks",children:[t.jsx(Js,{index:!0,element:t.jsx(Jk,{})}),t.jsx(Js,{path:"new",element:t.jsx(eA,{})}),t.jsx(Js,{path:"capacity",element:t.jsx(rA,{})}),t.jsx(Js,{path:":id",element:t.jsx(Yk,{})})]})]})]})}),t.jsx(Qj,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})}const C0=new V0({defaultOptions:{queries:{retry:1,staleTime:3e4,refetchOnWindowFocus:!1}}});window.addEventListener("error",c=>{console.error("Global error:",c.error)});window.addEventListener("unhandledrejection",c=>{console.error("Unhandled promise rejection:",c.reason)});const zb=document.getElementById("root");if(!zb)throw new Error("Failed to find the root element");try{P0(zb).render(t.jsx(le.StrictMode,{children:t.jsx(kt.Provider,{client:RN,queryClient:C0,children:t.jsx(W0,{client:C0,children:t.jsx(nA,{})})})}))}catch(c){console.error("Error rendering app:",c)}
//# sourceMappingURL=index-BD3DzMUy.js.map
