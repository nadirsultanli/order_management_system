import{r as oe,a as m1,R as li,N as k0,b as p1,O as f1,c as g1,g as x1,u as Qr,d as nc,L as hf,B as y1,e as _1,f as Hs}from"./vendor-BeIN97dW.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))f(w);new MutationObserver(w=>{for(const N of w)if(N.type==="childList")for(const E of N.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&f(E)}).observe(document,{childList:!0,subtree:!0});function x(w){const N={};return w.integrity&&(N.integrity=w.integrity),w.referrerPolicy&&(N.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?N.credentials="include":w.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function f(w){if(w.ep)return;w.ep=!0;const N=x(w);fetch(w.href,N)}})();var A0={exports:{}},em={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v1=oe,b1=Symbol.for("react.element"),w1=Symbol.for("react.fragment"),j1=Object.prototype.hasOwnProperty,N1=v1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,S1={key:!0,ref:!0,__self:!0,__source:!0};function M0(c,u,x){var f,w={},N=null,E=null;x!==void 0&&(N=""+x),u.key!==void 0&&(N=""+u.key),u.ref!==void 0&&(E=u.ref);for(f in u)j1.call(u,f)&&!S1.hasOwnProperty(f)&&(w[f]=u[f]);if(c&&c.defaultProps)for(f in u=c.defaultProps,u)w[f]===void 0&&(w[f]=u[f]);return{$$typeof:b1,type:c,key:N,ref:E,props:w,_owner:N1.current}}em.Fragment=w1;em.jsx=M0;em.jsxs=M0;A0.exports=em;var t=A0.exports,P0,Iy=m1;P0=Iy.createRoot,Iy.hydrateRoot;class Qo{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(u){const x={listener:u};return this.listeners.add(x),this.onSubscribe(),()=>{this.listeners.delete(x),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const Kd=typeof window>"u"||"Deno"in window;function Ki(){}function T1(c,u){return typeof c=="function"?c(u):c}function mf(c){return typeof c=="number"&&c>=0&&c!==1/0}function Dy(c,u){return c.filter(x=>!u.includes(x))}function E1(c,u,x){const f=c.slice(0);return f[u]=x,f}function I0(c,u){return Math.max(c+(u||0)-Date.now(),0)}function Yl(c,u,x){return Yd(c)?typeof u=="function"?{...x,queryKey:c,queryFn:u}:{...u,queryKey:c}:c}function C1(c,u,x){return Yd(c)?{...u,mutationKey:c}:typeof c=="function"?{...u,mutationFn:c}:{...c}}function Xa(c,u,x){return Yd(c)?[{...u,queryKey:c},x]:[c||{},u]}function Ly(c,u){const{type:x="all",exact:f,fetchStatus:w,predicate:N,queryKey:E,stale:A}=c;if(Yd(E)){if(f){if(u.queryHash!==If(E,u.options))return!1}else if(!Bh(u.queryKey,E))return!1}if(x!=="all"){const n=u.isActive();if(x==="active"&&!n||x==="inactive"&&n)return!1}return!(typeof A=="boolean"&&u.isStale()!==A||typeof w<"u"&&w!==u.state.fetchStatus||N&&!N(u))}function Ry(c,u){const{exact:x,fetching:f,predicate:w,mutationKey:N}=c;if(Yd(N)){if(!u.options.mutationKey)return!1;if(x){if(Ja(u.options.mutationKey)!==Ja(N))return!1}else if(!Bh(u.options.mutationKey,N))return!1}return!(typeof f=="boolean"&&u.state.status==="loading"!==f||w&&!w(u))}function If(c,u){return((u==null?void 0:u.queryKeyHashFn)||Ja)(c)}function Ja(c){return JSON.stringify(c,(u,x)=>pf(x)?Object.keys(x).sort().reduce((f,w)=>(f[w]=x[w],f),{}):x)}function Bh(c,u){return D0(c,u)}function D0(c,u){return c===u?!0:typeof c!=typeof u?!1:c&&u&&typeof c=="object"&&typeof u=="object"?!Object.keys(u).some(x=>!D0(c[x],u[x])):!1}function L0(c,u){if(c===u)return c;const x=zy(c)&&zy(u);if(x||pf(c)&&pf(u)){const f=x?c.length:Object.keys(c).length,w=x?u:Object.keys(u),N=w.length,E=x?[]:{};let A=0;for(let n=0;n<N;n++){const P=x?n:w[n];E[P]=L0(c[P],u[P]),E[P]===c[P]&&A++}return f===N&&A===f?c:E}return u}function Uh(c,u){if(c&&!u||u&&!c)return!1;for(const x in c)if(c[x]!==u[x])return!1;return!0}function zy(c){return Array.isArray(c)&&c.length===Object.keys(c).length}function pf(c){if(!Oy(c))return!1;const u=c.constructor;if(typeof u>"u")return!0;const x=u.prototype;return!(!Oy(x)||!x.hasOwnProperty("isPrototypeOf"))}function Oy(c){return Object.prototype.toString.call(c)==="[object Object]"}function Yd(c){return Array.isArray(c)}function R0(c){return new Promise(u=>{setTimeout(u,c)})}function Fy(c){R0(0).then(c)}function k1(){if(typeof AbortController=="function")return new AbortController}function ff(c,u,x){return x.isDataEqual!=null&&x.isDataEqual(c,u)?c:typeof x.structuralSharing=="function"?x.structuralSharing(c,u):x.structuralSharing!==!1?L0(c,u):u}class A1 extends Qo{constructor(){super(),this.setup=u=>{if(!Kd&&window.addEventListener){const x=()=>u();return window.addEventListener("visibilitychange",x,!1),window.addEventListener("focus",x,!1),()=>{window.removeEventListener("visibilitychange",x),window.removeEventListener("focus",x)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var u;(u=this.cleanup)==null||u.call(this),this.cleanup=void 0}}setEventListener(u){var x;this.setup=u,(x=this.cleanup)==null||x.call(this),this.cleanup=u(f=>{typeof f=="boolean"?this.setFocused(f):this.onFocus()})}setFocused(u){this.focused!==u&&(this.focused=u,this.onFocus())}onFocus(){this.listeners.forEach(({listener:u})=>{u()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const Vh=new A1,By=["online","offline"];class M1 extends Qo{constructor(){super(),this.setup=u=>{if(!Kd&&window.addEventListener){const x=()=>u();return By.forEach(f=>{window.addEventListener(f,x,!1)}),()=>{By.forEach(f=>{window.removeEventListener(f,x)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var u;(u=this.cleanup)==null||u.call(this),this.cleanup=void 0}}setEventListener(u){var x;this.setup=u,(x=this.cleanup)==null||x.call(this),this.cleanup=u(f=>{typeof f=="boolean"?this.setOnline(f):this.onOnline()})}setOnline(u){this.online!==u&&(this.online=u,this.onOnline())}onOnline(){this.listeners.forEach(({listener:u})=>{u()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const qh=new M1;function P1(c){return Math.min(1e3*2**c,3e4)}function tm(c){return(c??"online")==="online"?qh.isOnline():!0}class z0{constructor(u){this.revert=u==null?void 0:u.revert,this.silent=u==null?void 0:u.silent}}function Dh(c){return c instanceof z0}function O0(c){let u=!1,x=0,f=!1,w,N,E;const A=new Promise((J,de)=>{N=J,E=de}),n=J=>{f||(W(new z0(J)),c.abort==null||c.abort())},P=()=>{u=!0},z=()=>{u=!1},q=()=>!Vh.isFocused()||c.networkMode!=="always"&&!qh.isOnline(),U=J=>{f||(f=!0,c.onSuccess==null||c.onSuccess(J),w==null||w(),N(J))},W=J=>{f||(f=!0,c.onError==null||c.onError(J),w==null||w(),E(J))},X=()=>new Promise(J=>{w=de=>{const ne=f||!q();return ne&&J(de),ne},c.onPause==null||c.onPause()}).then(()=>{w=void 0,f||c.onContinue==null||c.onContinue()}),Z=()=>{if(f)return;let J;try{J=c.fn()}catch(de){J=Promise.reject(de)}Promise.resolve(J).then(U).catch(de=>{var ne,te;if(f)return;const Ne=(ne=c.retry)!=null?ne:3,he=(te=c.retryDelay)!=null?te:P1,Ce=typeof he=="function"?he(x,de):he,Ae=Ne===!0||typeof Ne=="number"&&x<Ne||typeof Ne=="function"&&Ne(x,de);if(u||!Ae){W(de);return}x++,c.onFail==null||c.onFail(x,de),R0(Ce).then(()=>{if(q())return X()}).then(()=>{u?W(de):Z()})})};return tm(c.networkMode)?Z():X().then(Z),{promise:A,cancel:n,continue:()=>(w==null?void 0:w())?A:Promise.resolve(),cancelRetry:P,continueRetry:z}}const Df=console;function I1(){let c=[],u=0,x=z=>{z()},f=z=>{z()};const w=z=>{let q;u++;try{q=z()}finally{u--,u||A()}return q},N=z=>{u?c.push(z):Fy(()=>{x(z)})},E=z=>(...q)=>{N(()=>{z(...q)})},A=()=>{const z=c;c=[],z.length&&Fy(()=>{f(()=>{z.forEach(q=>{x(q)})})})};return{batch:w,batchCalls:E,schedule:N,setNotifyFunction:z=>{x=z},setBatchNotifyFunction:z=>{f=z}}}const Qs=I1();class F0{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),mf(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(u){this.cacheTime=Math.max(this.cacheTime||0,u??(Kd?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class D1 extends F0{constructor(u){super(),this.abortSignalConsumed=!1,this.defaultOptions=u.defaultOptions,this.setOptions(u.options),this.observers=[],this.cache=u.cache,this.logger=u.logger||Df,this.queryKey=u.queryKey,this.queryHash=u.queryHash,this.initialState=u.state||L1(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(u){this.options={...this.defaultOptions,...u},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(u,x){const f=ff(this.state.data,u,this.options);return this.dispatch({data:f,type:"success",dataUpdatedAt:x==null?void 0:x.updatedAt,manual:x==null?void 0:x.manual}),f}setState(u,x){this.dispatch({type:"setState",state:u,setStateOptions:x})}cancel(u){var x;const f=this.promise;return(x=this.retryer)==null||x.cancel(u),f?f.then(Ki).catch(Ki):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(u=>u.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(u=>u.getCurrentResult().isStale)}isStaleByTime(u=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!I0(this.state.dataUpdatedAt,u)}onFocus(){var u;const x=this.observers.find(f=>f.shouldFetchOnWindowFocus());x&&x.refetch({cancelRefetch:!1}),(u=this.retryer)==null||u.continue()}onOnline(){var u;const x=this.observers.find(f=>f.shouldFetchOnReconnect());x&&x.refetch({cancelRefetch:!1}),(u=this.retryer)==null||u.continue()}addObserver(u){this.observers.includes(u)||(this.observers.push(u),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:u}))}removeObserver(u){this.observers.includes(u)&&(this.observers=this.observers.filter(x=>x!==u),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:u}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(u,x){var f,w;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&x!=null&&x.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var N;return(N=this.retryer)==null||N.continueRetry(),this.promise}}if(u&&this.setOptions(u),!this.options.queryFn){const W=this.observers.find(X=>X.options.queryFn);W&&this.setOptions(W.options)}const E=k1(),A={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},n=W=>{Object.defineProperty(W,"signal",{enumerable:!0,get:()=>{if(E)return this.abortSignalConsumed=!0,E.signal}})};n(A);const P=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(A)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'"),z={fetchOptions:x,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:P};if(n(z),(f=this.options.behavior)==null||f.onFetch(z),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==((w=z.fetchOptions)==null?void 0:w.meta)){var q;this.dispatch({type:"fetch",meta:(q=z.fetchOptions)==null?void 0:q.meta})}const U=W=>{if(Dh(W)&&W.silent||this.dispatch({type:"error",error:W}),!Dh(W)){var X,Z,J,de;(X=(Z=this.cache.config).onError)==null||X.call(Z,W,this),(J=(de=this.cache.config).onSettled)==null||J.call(de,this.state.data,W,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=O0({fn:z.fetchFn,abort:E==null?void 0:E.abort.bind(E),onSuccess:W=>{var X,Z,J,de;if(typeof W>"u"){U(new Error(this.queryHash+" data is undefined"));return}this.setData(W),(X=(Z=this.cache.config).onSuccess)==null||X.call(Z,W,this),(J=(de=this.cache.config).onSettled)==null||J.call(de,W,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:U,onFail:(W,X)=>{this.dispatch({type:"failed",failureCount:W,error:X})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:z.options.retry,retryDelay:z.options.retryDelay,networkMode:z.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(u){const x=f=>{var w,N;switch(u.type){case"failed":return{...f,fetchFailureCount:u.failureCount,fetchFailureReason:u.error};case"pause":return{...f,fetchStatus:"paused"};case"continue":return{...f,fetchStatus:"fetching"};case"fetch":return{...f,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:(w=u.meta)!=null?w:null,fetchStatus:tm(this.options.networkMode)?"fetching":"paused",...!f.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...f,data:u.data,dataUpdateCount:f.dataUpdateCount+1,dataUpdatedAt:(N=u.dataUpdatedAt)!=null?N:Date.now(),error:null,isInvalidated:!1,status:"success",...!u.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const E=u.error;return Dh(E)&&E.revert&&this.revertState?{...this.revertState,fetchStatus:"idle"}:{...f,error:E,errorUpdateCount:f.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:f.fetchFailureCount+1,fetchFailureReason:E,fetchStatus:"idle",status:"error"};case"invalidate":return{...f,isInvalidated:!0};case"setState":return{...f,...u.state}}};this.state=x(this.state),Qs.batch(()=>{this.observers.forEach(f=>{f.onQueryUpdate(u)}),this.cache.notify({query:this,type:"updated",action:u})})}}function L1(c){const u=typeof c.initialData=="function"?c.initialData():c.initialData,x=typeof u<"u",f=x?typeof c.initialDataUpdatedAt=="function"?c.initialDataUpdatedAt():c.initialDataUpdatedAt:0;return{data:u,dataUpdateCount:0,dataUpdatedAt:x?f??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:x?"success":"loading",fetchStatus:"idle"}}class R1 extends Qo{constructor(u){super(),this.config=u||{},this.queries=[],this.queriesMap={}}build(u,x,f){var w;const N=x.queryKey,E=(w=x.queryHash)!=null?w:If(N,x);let A=this.get(E);return A||(A=new D1({cache:this,logger:u.getLogger(),queryKey:N,queryHash:E,options:u.defaultQueryOptions(x),state:f,defaultOptions:u.getQueryDefaults(N)}),this.add(A)),A}add(u){this.queriesMap[u.queryHash]||(this.queriesMap[u.queryHash]=u,this.queries.push(u),this.notify({type:"added",query:u}))}remove(u){const x=this.queriesMap[u.queryHash];x&&(u.destroy(),this.queries=this.queries.filter(f=>f!==u),x===u&&delete this.queriesMap[u.queryHash],this.notify({type:"removed",query:u}))}clear(){Qs.batch(()=>{this.queries.forEach(u=>{this.remove(u)})})}get(u){return this.queriesMap[u]}getAll(){return this.queries}find(u,x){const[f]=Xa(u,x);return typeof f.exact>"u"&&(f.exact=!0),this.queries.find(w=>Ly(f,w))}findAll(u,x){const[f]=Xa(u,x);return Object.keys(f).length>0?this.queries.filter(w=>Ly(f,w)):this.queries}notify(u){Qs.batch(()=>{this.listeners.forEach(({listener:x})=>{x(u)})})}onFocus(){Qs.batch(()=>{this.queries.forEach(u=>{u.onFocus()})})}onOnline(){Qs.batch(()=>{this.queries.forEach(u=>{u.onOnline()})})}}class z1 extends F0{constructor(u){super(),this.defaultOptions=u.defaultOptions,this.mutationId=u.mutationId,this.mutationCache=u.mutationCache,this.logger=u.logger||Df,this.observers=[],this.state=u.state||B0(),this.setOptions(u.options),this.scheduleGc()}setOptions(u){this.options={...this.defaultOptions,...u},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(u){this.dispatch({type:"setState",state:u})}addObserver(u){this.observers.includes(u)||(this.observers.push(u),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:u}))}removeObserver(u){this.observers=this.observers.filter(x=>x!==u),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:u})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var u,x;return(u=(x=this.retryer)==null?void 0:x.continue())!=null?u:this.execute()}async execute(){const u=()=>{var Ae;return this.retryer=O0({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(fe,Ie)=>{this.dispatch({type:"failed",failureCount:fe,error:Ie})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(Ae=this.options.retry)!=null?Ae:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},x=this.state.status==="loading";try{var f,w,N,E,A,n,P,z;if(!x){var q,U,W,X;this.dispatch({type:"loading",variables:this.options.variables}),await((q=(U=this.mutationCache.config).onMutate)==null?void 0:q.call(U,this.state.variables,this));const fe=await((W=(X=this.options).onMutate)==null?void 0:W.call(X,this.state.variables));fe!==this.state.context&&this.dispatch({type:"loading",context:fe,variables:this.state.variables})}const Ae=await u();return await((f=(w=this.mutationCache.config).onSuccess)==null?void 0:f.call(w,Ae,this.state.variables,this.state.context,this)),await((N=(E=this.options).onSuccess)==null?void 0:N.call(E,Ae,this.state.variables,this.state.context)),await((A=(n=this.mutationCache.config).onSettled)==null?void 0:A.call(n,Ae,null,this.state.variables,this.state.context,this)),await((P=(z=this.options).onSettled)==null?void 0:P.call(z,Ae,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:Ae}),Ae}catch(Ae){try{var Z,J,de,ne,te,Ne,he,Ce;throw await((Z=(J=this.mutationCache.config).onError)==null?void 0:Z.call(J,Ae,this.state.variables,this.state.context,this)),await((de=(ne=this.options).onError)==null?void 0:de.call(ne,Ae,this.state.variables,this.state.context)),await((te=(Ne=this.mutationCache.config).onSettled)==null?void 0:te.call(Ne,void 0,Ae,this.state.variables,this.state.context,this)),await((he=(Ce=this.options).onSettled)==null?void 0:he.call(Ce,void 0,Ae,this.state.variables,this.state.context)),Ae}finally{this.dispatch({type:"error",error:Ae})}}}dispatch(u){const x=f=>{switch(u.type){case"failed":return{...f,failureCount:u.failureCount,failureReason:u.error};case"pause":return{...f,isPaused:!0};case"continue":return{...f,isPaused:!1};case"loading":return{...f,context:u.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!tm(this.options.networkMode),status:"loading",variables:u.variables};case"success":return{...f,data:u.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...f,data:void 0,error:u.error,failureCount:f.failureCount+1,failureReason:u.error,isPaused:!1,status:"error"};case"setState":return{...f,...u.state}}};this.state=x(this.state),Qs.batch(()=>{this.observers.forEach(f=>{f.onMutationUpdate(u)}),this.mutationCache.notify({mutation:this,type:"updated",action:u})})}}function B0(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class O1 extends Qo{constructor(u){super(),this.config=u||{},this.mutations=[],this.mutationId=0}build(u,x,f){const w=new z1({mutationCache:this,logger:u.getLogger(),mutationId:++this.mutationId,options:u.defaultMutationOptions(x),state:f,defaultOptions:x.mutationKey?u.getMutationDefaults(x.mutationKey):void 0});return this.add(w),w}add(u){this.mutations.push(u),this.notify({type:"added",mutation:u})}remove(u){this.mutations=this.mutations.filter(x=>x!==u),this.notify({type:"removed",mutation:u})}clear(){Qs.batch(()=>{this.mutations.forEach(u=>{this.remove(u)})})}getAll(){return this.mutations}find(u){return typeof u.exact>"u"&&(u.exact=!0),this.mutations.find(x=>Ry(u,x))}findAll(u){return this.mutations.filter(x=>Ry(u,x))}notify(u){Qs.batch(()=>{this.listeners.forEach(({listener:x})=>{x(u)})})}resumePausedMutations(){var u;return this.resuming=((u=this.resuming)!=null?u:Promise.resolve()).then(()=>{const x=this.mutations.filter(f=>f.state.isPaused);return Qs.batch(()=>x.reduce((f,w)=>f.then(()=>w.continue().catch(Ki)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function gf(){return{onFetch:c=>{c.fetchFn=()=>{var u,x,f,w,N,E;const A=(u=c.fetchOptions)==null||(x=u.meta)==null?void 0:x.refetchPage,n=(f=c.fetchOptions)==null||(w=f.meta)==null?void 0:w.fetchMore,P=n==null?void 0:n.pageParam,z=(n==null?void 0:n.direction)==="forward",q=(n==null?void 0:n.direction)==="backward",U=((N=c.state.data)==null?void 0:N.pages)||[],W=((E=c.state.data)==null?void 0:E.pageParams)||[];let X=W,Z=!1;const J=Ce=>{Object.defineProperty(Ce,"signal",{enumerable:!0,get:()=>{var Ae;if((Ae=c.signal)!=null&&Ae.aborted)Z=!0;else{var fe;(fe=c.signal)==null||fe.addEventListener("abort",()=>{Z=!0})}return c.signal}})},de=c.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+c.options.queryHash+"'")),ne=(Ce,Ae,fe,Ie)=>(X=Ie?[Ae,...X]:[...X,Ae],Ie?[fe,...Ce]:[...Ce,fe]),te=(Ce,Ae,fe,Ie)=>{if(Z)return Promise.reject("Cancelled");if(typeof fe>"u"&&!Ae&&Ce.length)return Promise.resolve(Ce);const Ee={queryKey:c.queryKey,pageParam:fe,meta:c.options.meta};J(Ee);const tt=de(Ee);return Promise.resolve(tt).then(Pe=>ne(Ce,fe,Pe,Ie))};let Ne;if(!U.length)Ne=te([]);else if(z){const Ce=typeof P<"u",Ae=Ce?P:xf(c.options,U);Ne=te(U,Ce,Ae)}else if(q){const Ce=typeof P<"u",Ae=Ce?P:U0(c.options,U);Ne=te(U,Ce,Ae,!0)}else{X=[];const Ce=typeof c.options.getNextPageParam>"u";Ne=(A&&U[0]?A(U[0],0,U):!0)?te([],Ce,W[0]):Promise.resolve(ne([],W[0],U[0]));for(let fe=1;fe<U.length;fe++)Ne=Ne.then(Ie=>{if(A&&U[fe]?A(U[fe],fe,U):!0){const tt=Ce?W[fe]:xf(c.options,Ie);return te(Ie,Ce,tt)}return Promise.resolve(ne(Ie,W[fe],U[fe]))})}return Ne.then(Ce=>({pages:Ce,pageParams:X}))}}}}function xf(c,u){return c.getNextPageParam==null?void 0:c.getNextPageParam(u[u.length-1],u)}function U0(c,u){return c.getPreviousPageParam==null?void 0:c.getPreviousPageParam(u[0],u)}function F1(c,u){if(c.getNextPageParam&&Array.isArray(u)){const x=xf(c,u);return typeof x<"u"&&x!==null&&x!==!1}}function B1(c,u){if(c.getPreviousPageParam&&Array.isArray(u)){const x=U0(c,u);return typeof x<"u"&&x!==null&&x!==!1}}class U1{constructor(u={}){this.queryCache=u.queryCache||new R1,this.mutationCache=u.mutationCache||new O1,this.logger=u.logger||Df,this.defaultOptions=u.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=Vh.subscribe(()=>{Vh.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=qh.subscribe(()=>{qh.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var u,x;this.mountCount--,this.mountCount===0&&((u=this.unsubscribeFocus)==null||u.call(this),this.unsubscribeFocus=void 0,(x=this.unsubscribeOnline)==null||x.call(this),this.unsubscribeOnline=void 0)}isFetching(u,x){const[f]=Xa(u,x);return f.fetchStatus="fetching",this.queryCache.findAll(f).length}isMutating(u){return this.mutationCache.findAll({...u,fetching:!0}).length}getQueryData(u,x){var f;return(f=this.queryCache.find(u,x))==null?void 0:f.state.data}ensureQueryData(u,x,f){const w=Yl(u,x,f),N=this.getQueryData(w.queryKey);return N?Promise.resolve(N):this.fetchQuery(w)}getQueriesData(u){return this.getQueryCache().findAll(u).map(({queryKey:x,state:f})=>{const w=f.data;return[x,w]})}setQueryData(u,x,f){const w=this.queryCache.find(u),N=w==null?void 0:w.state.data,E=T1(x,N);if(typeof E>"u")return;const A=Yl(u),n=this.defaultQueryOptions(A);return this.queryCache.build(this,n).setData(E,{...f,manual:!0})}setQueriesData(u,x,f){return Qs.batch(()=>this.getQueryCache().findAll(u).map(({queryKey:w})=>[w,this.setQueryData(w,x,f)]))}getQueryState(u,x){var f;return(f=this.queryCache.find(u,x))==null?void 0:f.state}removeQueries(u,x){const[f]=Xa(u,x),w=this.queryCache;Qs.batch(()=>{w.findAll(f).forEach(N=>{w.remove(N)})})}resetQueries(u,x,f){const[w,N]=Xa(u,x,f),E=this.queryCache,A={type:"active",...w};return Qs.batch(()=>(E.findAll(w).forEach(n=>{n.reset()}),this.refetchQueries(A,N)))}cancelQueries(u,x,f){const[w,N={}]=Xa(u,x,f);typeof N.revert>"u"&&(N.revert=!0);const E=Qs.batch(()=>this.queryCache.findAll(w).map(A=>A.cancel(N)));return Promise.all(E).then(Ki).catch(Ki)}invalidateQueries(u,x,f){const[w,N]=Xa(u,x,f);return Qs.batch(()=>{var E,A;if(this.queryCache.findAll(w).forEach(P=>{P.invalidate()}),w.refetchType==="none")return Promise.resolve();const n={...w,type:(E=(A=w.refetchType)!=null?A:w.type)!=null?E:"active"};return this.refetchQueries(n,N)})}refetchQueries(u,x,f){const[w,N]=Xa(u,x,f),E=Qs.batch(()=>this.queryCache.findAll(w).filter(n=>!n.isDisabled()).map(n=>{var P;return n.fetch(void 0,{...N,cancelRefetch:(P=N==null?void 0:N.cancelRefetch)!=null?P:!0,meta:{refetchPage:w.refetchPage}})}));let A=Promise.all(E).then(Ki);return N!=null&&N.throwOnError||(A=A.catch(Ki)),A}fetchQuery(u,x,f){const w=Yl(u,x,f),N=this.defaultQueryOptions(w);typeof N.retry>"u"&&(N.retry=!1);const E=this.queryCache.build(this,N);return E.isStaleByTime(N.staleTime)?E.fetch(N):Promise.resolve(E.state.data)}prefetchQuery(u,x,f){return this.fetchQuery(u,x,f).then(Ki).catch(Ki)}fetchInfiniteQuery(u,x,f){const w=Yl(u,x,f);return w.behavior=gf(),this.fetchQuery(w)}prefetchInfiniteQuery(u,x,f){return this.fetchInfiniteQuery(u,x,f).then(Ki).catch(Ki)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(u){this.defaultOptions=u}setQueryDefaults(u,x){const f=this.queryDefaults.find(w=>Ja(u)===Ja(w.queryKey));f?f.defaultOptions=x:this.queryDefaults.push({queryKey:u,defaultOptions:x})}getQueryDefaults(u){if(!u)return;const x=this.queryDefaults.find(f=>Bh(u,f.queryKey));return x==null?void 0:x.defaultOptions}setMutationDefaults(u,x){const f=this.mutationDefaults.find(w=>Ja(u)===Ja(w.mutationKey));f?f.defaultOptions=x:this.mutationDefaults.push({mutationKey:u,defaultOptions:x})}getMutationDefaults(u){if(!u)return;const x=this.mutationDefaults.find(f=>Bh(u,f.mutationKey));return x==null?void 0:x.defaultOptions}defaultQueryOptions(u){if(u!=null&&u._defaulted)return u;const x={...this.defaultOptions.queries,...this.getQueryDefaults(u==null?void 0:u.queryKey),...u,_defaulted:!0};return!x.queryHash&&x.queryKey&&(x.queryHash=If(x.queryKey,x)),typeof x.refetchOnReconnect>"u"&&(x.refetchOnReconnect=x.networkMode!=="always"),typeof x.useErrorBoundary>"u"&&(x.useErrorBoundary=!!x.suspense),x}defaultMutationOptions(u){return u!=null&&u._defaulted?u:{...this.defaultOptions.mutations,...this.getMutationDefaults(u==null?void 0:u.mutationKey),...u,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}class Lf extends Qo{constructor(u,x){super(),this.client=u,this.options=x,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(x)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),Uy(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return yf(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return yf(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(u,x){const f=this.options,w=this.currentQuery;if(this.options=this.client.defaultQueryOptions(u),Uh(f,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=f.queryKey),this.updateQuery();const N=this.hasListeners();N&&Vy(this.currentQuery,w,this.options,f)&&this.executeFetch(),this.updateResult(x),N&&(this.currentQuery!==w||this.options.enabled!==f.enabled||this.options.staleTime!==f.staleTime)&&this.updateStaleTimeout();const E=this.computeRefetchInterval();N&&(this.currentQuery!==w||this.options.enabled!==f.enabled||E!==this.currentRefetchInterval)&&this.updateRefetchInterval(E)}getOptimisticResult(u){const x=this.client.getQueryCache().build(this.client,u),f=this.createResult(x,u);return q1(this,f,u)&&(this.currentResult=f,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),f}getCurrentResult(){return this.currentResult}trackResult(u){const x={};return Object.keys(u).forEach(f=>{Object.defineProperty(x,f,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(f),u[f])})}),x}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:u,...x}={}){return this.fetch({...x,meta:{refetchPage:u}})}fetchOptimistic(u){const x=this.client.defaultQueryOptions(u),f=this.client.getQueryCache().build(this.client,x);return f.isFetchingOptimistic=!0,f.fetch().then(()=>this.createResult(f,x))}fetch(u){var x;return this.executeFetch({...u,cancelRefetch:(x=u.cancelRefetch)!=null?x:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(u){this.updateQuery();let x=this.currentQuery.fetch(this.options,u);return u!=null&&u.throwOnError||(x=x.catch(Ki)),x}updateStaleTimeout(){if(this.clearStaleTimeout(),Kd||this.currentResult.isStale||!mf(this.options.staleTime))return;const x=I0(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},x)}computeRefetchInterval(){var u;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(u=this.options.refetchInterval)!=null?u:!1}updateRefetchInterval(u){this.clearRefetchInterval(),this.currentRefetchInterval=u,!(Kd||this.options.enabled===!1||!mf(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||Vh.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(u,x){const f=this.currentQuery,w=this.options,N=this.currentResult,E=this.currentResultState,A=this.currentResultOptions,n=u!==f,P=n?u.state:this.currentQueryInitialState,z=n?this.currentResult:this.previousQueryResult,{state:q}=u;let{dataUpdatedAt:U,error:W,errorUpdatedAt:X,fetchStatus:Z,status:J}=q,de=!1,ne=!1,te;if(x._optimisticResults){const fe=this.hasListeners(),Ie=!fe&&Uy(u,x),Ee=fe&&Vy(u,f,x,w);(Ie||Ee)&&(Z=tm(u.options.networkMode)?"fetching":"paused",U||(J="loading")),x._optimisticResults==="isRestoring"&&(Z="idle")}if(x.keepPreviousData&&!q.dataUpdatedAt&&z!=null&&z.isSuccess&&J!=="error")te=z.data,U=z.dataUpdatedAt,J=z.status,de=!0;else if(x.select&&typeof q.data<"u")if(N&&q.data===(E==null?void 0:E.data)&&x.select===this.selectFn)te=this.selectResult;else try{this.selectFn=x.select,te=x.select(q.data),te=ff(N==null?void 0:N.data,te,x),this.selectResult=te,this.selectError=null}catch(fe){this.selectError=fe}else te=q.data;if(typeof x.placeholderData<"u"&&typeof te>"u"&&J==="loading"){let fe;if(N!=null&&N.isPlaceholderData&&x.placeholderData===(A==null?void 0:A.placeholderData))fe=N.data;else if(fe=typeof x.placeholderData=="function"?x.placeholderData():x.placeholderData,x.select&&typeof fe<"u")try{fe=x.select(fe),this.selectError=null}catch(Ie){this.selectError=Ie}typeof fe<"u"&&(J="success",te=ff(N==null?void 0:N.data,fe,x),ne=!0)}this.selectError&&(W=this.selectError,te=this.selectResult,X=Date.now(),J="error");const Ne=Z==="fetching",he=J==="loading",Ce=J==="error";return{status:J,fetchStatus:Z,isLoading:he,isSuccess:J==="success",isError:Ce,isInitialLoading:he&&Ne,data:te,dataUpdatedAt:U,error:W,errorUpdatedAt:X,failureCount:q.fetchFailureCount,failureReason:q.fetchFailureReason,errorUpdateCount:q.errorUpdateCount,isFetched:q.dataUpdateCount>0||q.errorUpdateCount>0,isFetchedAfterMount:q.dataUpdateCount>P.dataUpdateCount||q.errorUpdateCount>P.errorUpdateCount,isFetching:Ne,isRefetching:Ne&&!he,isLoadingError:Ce&&q.dataUpdatedAt===0,isPaused:Z==="paused",isPlaceholderData:ne,isPreviousData:de,isRefetchError:Ce&&q.dataUpdatedAt!==0,isStale:Rf(u,x),refetch:this.refetch,remove:this.remove}}updateResult(u){const x=this.currentResult,f=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,Uh(f,x))return;this.currentResult=f;const w={cache:!0},N=()=>{if(!x)return!0;const{notifyOnChangeProps:E}=this.options,A=typeof E=="function"?E():E;if(A==="all"||!A&&!this.trackedProps.size)return!0;const n=new Set(A??this.trackedProps);return this.options.useErrorBoundary&&n.add("error"),Object.keys(this.currentResult).some(P=>{const z=P;return this.currentResult[z]!==x[z]&&n.has(z)})};(u==null?void 0:u.listeners)!==!1&&N()&&(w.listeners=!0),this.notify({...w,...u})}updateQuery(){const u=this.client.getQueryCache().build(this.client,this.options);if(u===this.currentQuery)return;const x=this.currentQuery;this.currentQuery=u,this.currentQueryInitialState=u.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(x==null||x.removeObserver(this),u.addObserver(this))}onQueryUpdate(u){const x={};u.type==="success"?x.onSuccess=!u.manual:u.type==="error"&&!Dh(u.error)&&(x.onError=!0),this.updateResult(x),this.hasListeners()&&this.updateTimers()}notify(u){Qs.batch(()=>{if(u.onSuccess){var x,f,w,N;(x=(f=this.options).onSuccess)==null||x.call(f,this.currentResult.data),(w=(N=this.options).onSettled)==null||w.call(N,this.currentResult.data,null)}else if(u.onError){var E,A,n,P;(E=(A=this.options).onError)==null||E.call(A,this.currentResult.error),(n=(P=this.options).onSettled)==null||n.call(P,void 0,this.currentResult.error)}u.listeners&&this.listeners.forEach(({listener:z})=>{z(this.currentResult)}),u.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function V1(c,u){return u.enabled!==!1&&!c.state.dataUpdatedAt&&!(c.state.status==="error"&&u.retryOnMount===!1)}function Uy(c,u){return V1(c,u)||c.state.dataUpdatedAt>0&&yf(c,u,u.refetchOnMount)}function yf(c,u,x){if(u.enabled!==!1){const f=typeof x=="function"?x(c):x;return f==="always"||f!==!1&&Rf(c,u)}return!1}function Vy(c,u,x,f){return x.enabled!==!1&&(c!==u||f.enabled===!1)&&(!x.suspense||c.state.status!=="error")&&Rf(c,x)}function Rf(c,u){return c.isStaleByTime(u.staleTime)}function q1(c,u,x){return x.keepPreviousData?!1:x.placeholderData!==void 0?u.isPlaceholderData:!Uh(c.getCurrentResult(),u)}class $1 extends Qo{constructor(u,x){super(),this.client=u,this.queries=[],this.result=[],this.observers=[],this.observersMap={},x&&this.setQueries(x)}onSubscribe(){this.listeners.size===1&&this.observers.forEach(u=>{u.subscribe(x=>{this.onUpdate(u,x)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.observers.forEach(u=>{u.destroy()})}setQueries(u,x){this.queries=u,Qs.batch(()=>{const f=this.observers,w=this.findMatchingObservers(this.queries);w.forEach(P=>P.observer.setOptions(P.defaultedQueryOptions,x));const N=w.map(P=>P.observer),E=Object.fromEntries(N.map(P=>[P.options.queryHash,P])),A=N.map(P=>P.getCurrentResult()),n=N.some((P,z)=>P!==f[z]);f.length===N.length&&!n||(this.observers=N,this.observersMap=E,this.result=A,this.hasListeners()&&(Dy(f,N).forEach(P=>{P.destroy()}),Dy(N,f).forEach(P=>{P.subscribe(z=>{this.onUpdate(P,z)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(u=>u.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(u){return this.findMatchingObservers(u).map(x=>x.observer.getOptimisticResult(x.defaultedQueryOptions))}findMatchingObservers(u){const x=this.observers,f=new Map(x.map(W=>[W.options.queryHash,W])),w=u.map(W=>this.client.defaultQueryOptions(W)),N=w.flatMap(W=>{const X=f.get(W.queryHash);return X!=null?[{defaultedQueryOptions:W,observer:X}]:[]}),E=new Set(N.map(W=>W.defaultedQueryOptions.queryHash)),A=w.filter(W=>!E.has(W.queryHash)),n=new Set(N.map(W=>W.observer)),P=x.filter(W=>!n.has(W)),z=W=>{const X=this.client.defaultQueryOptions(W),Z=this.observersMap[X.queryHash];return Z??new Lf(this.client,X)},q=A.map((W,X)=>{if(W.keepPreviousData){const Z=P[X];if(Z!==void 0)return{defaultedQueryOptions:W,observer:Z}}return{defaultedQueryOptions:W,observer:z(W)}}),U=(W,X)=>w.indexOf(W.defaultedQueryOptions)-w.indexOf(X.defaultedQueryOptions);return N.concat(q).sort(U)}onUpdate(u,x){const f=this.observers.indexOf(u);f!==-1&&(this.result=E1(this.result,f,x),this.notify())}notify(){Qs.batch(()=>{this.listeners.forEach(({listener:u})=>{u(this.result)})})}}class G1 extends Lf{constructor(u,x){super(u,x)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(u,x){super.setOptions({...u,behavior:gf()},x)}getOptimisticResult(u){return u.behavior=gf(),super.getOptimisticResult(u)}fetchNextPage({pageParam:u,...x}={}){return this.fetch({...x,meta:{fetchMore:{direction:"forward",pageParam:u}}})}fetchPreviousPage({pageParam:u,...x}={}){return this.fetch({...x,meta:{fetchMore:{direction:"backward",pageParam:u}}})}createResult(u,x){var f,w,N,E,A,n;const{state:P}=u,z=super.createResult(u,x),{isFetching:q,isRefetching:U}=z,W=q&&((f=P.fetchMeta)==null||(w=f.fetchMore)==null?void 0:w.direction)==="forward",X=q&&((N=P.fetchMeta)==null||(E=N.fetchMore)==null?void 0:E.direction)==="backward";return{...z,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:F1(x,(A=P.data)==null?void 0:A.pages),hasPreviousPage:B1(x,(n=P.data)==null?void 0:n.pages),isFetchingNextPage:W,isFetchingPreviousPage:X,isRefetching:U&&!W&&!X}}}let Z1=class extends Qo{constructor(u,x){super(),this.client=u,this.setOptions(x),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(u){var x;const f=this.options;this.options=this.client.defaultMutationOptions(u),Uh(f,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(x=this.currentMutation)==null||x.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var u;(u=this.currentMutation)==null||u.removeObserver(this)}}onMutationUpdate(u){this.updateResult();const x={listeners:!0};u.type==="success"?x.onSuccess=!0:u.type==="error"&&(x.onError=!0),this.notify(x)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(u,x){return this.mutateOptions=x,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof u<"u"?u:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const u=this.currentMutation?this.currentMutation.state:B0(),x=u.status==="loading",f={...u,isLoading:x,isPending:x,isSuccess:u.status==="success",isError:u.status==="error",isIdle:u.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=f}notify(u){Qs.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(u.onSuccess){var x,f,w,N;(x=(f=this.mutateOptions).onSuccess)==null||x.call(f,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(w=(N=this.mutateOptions).onSettled)==null||w.call(N,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(u.onError){var E,A,n,P;(E=(A=this.mutateOptions).onError)==null||E.call(A,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(n=(P=this.mutateOptions).onSettled)==null||n.call(P,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}u.listeners&&this.listeners.forEach(({listener:z})=>{z(this.currentResult)})})}};var V0={exports:{}},q0={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tc=oe;function W1(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var H1=typeof Object.is=="function"?Object.is:W1,X1=tc.useState,K1=tc.useEffect,Q1=tc.useLayoutEffect,J1=tc.useDebugValue;function Y1(c,u){var x=u(),f=X1({inst:{value:x,getSnapshot:u}}),w=f[0].inst,N=f[1];return Q1(function(){w.value=x,w.getSnapshot=u,Qp(w)&&N({inst:w})},[c,x,u]),K1(function(){return Qp(w)&&N({inst:w}),c(function(){Qp(w)&&N({inst:w})})},[c]),J1(x),x}function Qp(c){var u=c.getSnapshot;c=c.value;try{var x=u();return!H1(c,x)}catch{return!0}}function ej(c,u){return u()}var tj=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ej:Y1;q0.useSyncExternalStore=tc.useSyncExternalStore!==void 0?tc.useSyncExternalStore:tj;V0.exports=q0;var sj=V0.exports;const zf=sj.useSyncExternalStore,qy=oe.createContext(void 0),$0=oe.createContext(!1);function G0(c,u){return c||(u&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=qy),window.ReactQueryClientContext):qy)}const sm=({context:c}={})=>{const u=oe.useContext(G0(c,oe.useContext($0)));if(!u)throw new Error("No QueryClient set, use QueryClientProvider to set one");return u},rj=({client:c,children:u,context:x,contextSharing:f=!1})=>{oe.useEffect(()=>(c.mount(),()=>{c.unmount()}),[c]);const w=G0(x,f);return oe.createElement($0.Provider,{value:!x&&f},oe.createElement(w.Provider,{value:c},u))},Z0=oe.createContext(!1),W0=()=>oe.useContext(Z0);Z0.Provider;function ij(){let c=!1;return{clearReset:()=>{c=!1},reset:()=>{c=!0},isReset:()=>c}}const nj=oe.createContext(ij()),H0=()=>oe.useContext(nj);function X0(c,u){return typeof c=="function"?c(...u):!!c}const K0=(c,u)=>{(c.suspense||c.useErrorBoundary)&&(u.isReset()||(c.retryOnMount=!1))},Q0=c=>{oe.useEffect(()=>{c.clearReset()},[c])},J0=({result:c,errorResetBoundary:u,useErrorBoundary:x,query:f})=>c.isError&&!u.isReset()&&!c.isFetching&&X0(x,[c.error,f]),Y0=c=>{c.suspense&&typeof c.staleTime!="number"&&(c.staleTime=1e3)},e_=(c,u)=>c.isLoading&&c.isFetching&&!u,_f=(c,u,x)=>(c==null?void 0:c.suspense)&&e_(u,x),vf=(c,u,x)=>u.fetchOptimistic(c).then(({data:f})=>{c.onSuccess==null||c.onSuccess(f),c.onSettled==null||c.onSettled(f,null)}).catch(f=>{x.clearReset(),c.onError==null||c.onError(f),c.onSettled==null||c.onSettled(void 0,f)});function aj({queries:c,context:u}){const x=sm({context:u}),f=W0(),w=H0(),N=oe.useMemo(()=>c.map(U=>{const W=x.defaultQueryOptions(U);return W._optimisticResults=f?"isRestoring":"optimistic",W}),[c,x,f]);N.forEach(U=>{Y0(U),K0(U,w)}),Q0(w);const[E]=oe.useState(()=>new $1(x,N)),A=E.getOptimisticResult(N);zf(oe.useCallback(U=>f?()=>{}:E.subscribe(Qs.batchCalls(U)),[E,f]),()=>E.getCurrentResult(),()=>E.getCurrentResult()),oe.useEffect(()=>{E.setQueries(N,{listeners:!1})},[N,E]);const P=A.some((U,W)=>_f(N[W],U,f))?A.flatMap((U,W)=>{const X=N[W],Z=E.getObservers()[W];if(X&&Z){if(_f(X,U,f))return vf(X,Z,w);e_(U,f)&&vf(X,Z,w)}return[]}):[];if(P.length>0)throw Promise.all(P);const z=E.getQueries(),q=A.find((U,W)=>{var X,Z;return J0({result:U,errorResetBoundary:w,useErrorBoundary:(X=(Z=N[W])==null?void 0:Z.useErrorBoundary)!=null?X:!1,query:z[W]})});if(q!=null&&q.error)throw q.error;return A}function t_(c,u){const x=sm({context:c.context}),f=W0(),w=H0(),N=x.defaultQueryOptions(c);N._optimisticResults=f?"isRestoring":"optimistic",N.onError&&(N.onError=Qs.batchCalls(N.onError)),N.onSuccess&&(N.onSuccess=Qs.batchCalls(N.onSuccess)),N.onSettled&&(N.onSettled=Qs.batchCalls(N.onSettled)),Y0(N),K0(N,w),Q0(w);const[E]=oe.useState(()=>new u(x,N)),A=E.getOptimisticResult(N);if(zf(oe.useCallback(n=>{const P=f?()=>{}:E.subscribe(Qs.batchCalls(n));return E.updateResult(),P},[E,f]),()=>E.getCurrentResult(),()=>E.getCurrentResult()),oe.useEffect(()=>{E.setOptions(N,{listeners:!1})},[N,E]),_f(N,A,f))throw vf(N,E,w);if(J0({result:A,errorResetBoundary:w,useErrorBoundary:N.useErrorBoundary,query:E.getCurrentQuery()}))throw A.error;return N.notifyOnChangeProps?A:E.trackResult(A)}function s_(c,u,x){const f=Yl(c,u,x);return t_(f,Lf)}function oj(c,u,x){const f=C1(c,u),w=sm({context:f.context}),[N]=oe.useState(()=>new Z1(w,f));oe.useEffect(()=>{N.setOptions(f)},[N,f]);const E=zf(oe.useCallback(n=>N.subscribe(Qs.batchCalls(n)),[N]),()=>N.getCurrentResult(),()=>N.getCurrentResult()),A=oe.useCallback((n,P)=>{N.mutate(n,P).catch(lj)},[N]);if(E.error&&X0(N.options.useErrorBoundary,[E.error]))throw E.error;return{...E,mutate:A,mutateAsync:E.mutate}}function lj(){}function cj(c,u,x){const f=Yl(c,u,x);return t_(f,G1)}let dj={data:""},uj=c=>typeof window=="object"?((c?c.querySelector("#_goober"):window._goober)||Object.assign((c||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:c||dj,hj=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,mj=/\/\*[^]*?\*\/|  +/g,$y=/\n+/g,Ka=(c,u)=>{let x="",f="",w="";for(let N in c){let E=c[N];N[0]=="@"?N[1]=="i"?x=N+" "+E+";":f+=N[1]=="f"?Ka(E,N):N+"{"+Ka(E,N[1]=="k"?"":u)+"}":typeof E=="object"?f+=Ka(E,u?u.replace(/([^,])+/g,A=>N.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,n=>/&/.test(n)?n.replace(/&/g,A):A?A+" "+n:n)):N):E!=null&&(N=/^--/.test(N)?N:N.replace(/[A-Z]/g,"-$&").toLowerCase(),w+=Ka.p?Ka.p(N,E):N+":"+E+";")}return x+(u&&w?u+"{"+w+"}":w)+f},ua={},r_=c=>{if(typeof c=="object"){let u="";for(let x in c)u+=x+r_(c[x]);return u}return c},pj=(c,u,x,f,w)=>{let N=r_(c),E=ua[N]||(ua[N]=(n=>{let P=0,z=11;for(;P<n.length;)z=101*z+n.charCodeAt(P++)>>>0;return"go"+z})(N));if(!ua[E]){let n=N!==c?c:(P=>{let z,q,U=[{}];for(;z=hj.exec(P.replace(mj,""));)z[4]?U.shift():z[3]?(q=z[3].replace($y," ").trim(),U.unshift(U[0][q]=U[0][q]||{})):U[0][z[1]]=z[2].replace($y," ").trim();return U[0]})(c);ua[E]=Ka(w?{["@keyframes "+E]:n}:n,x?"":"."+E)}let A=x&&ua.g?ua.g:null;return x&&(ua.g=ua[E]),((n,P,z,q)=>{q?P.data=P.data.replace(q,n):P.data.indexOf(n)===-1&&(P.data=z?n+P.data:P.data+n)})(ua[E],u,f,A),E},fj=(c,u,x)=>c.reduce((f,w,N)=>{let E=u[N];if(E&&E.call){let A=E(x),n=A&&A.props&&A.props.className||/^go/.test(A)&&A;E=n?"."+n:A&&typeof A=="object"?A.props?"":Ka(A,""):A===!1?"":A}return f+w+(E??"")},"");function rm(c){let u=this||{},x=c.call?c(u.p):c;return pj(x.unshift?x.raw?fj(x,[].slice.call(arguments,1),u.p):x.reduce((f,w)=>Object.assign(f,w&&w.call?w(u.p):w),{}):x,uj(u.target),u.g,u.o,u.k)}let i_,bf,wf;rm.bind({g:1});let fa=rm.bind({k:1});function gj(c,u,x,f){Ka.p=u,i_=c,bf=x,wf=f}function eo(c,u){let x=this||{};return function(){let f=arguments;function w(N,E){let A=Object.assign({},N),n=A.className||w.className;x.p=Object.assign({theme:bf&&bf()},A),x.o=/ *go\d+/.test(n),A.className=rm.apply(x,f)+(n?" "+n:"");let P=c;return c[0]&&(P=A.as||c,delete A.as),wf&&P[0]&&wf(A),i_(P,A)}return w}}var xj=c=>typeof c=="function",$h=(c,u)=>xj(c)?c(u):c,yj=(()=>{let c=0;return()=>(++c).toString()})(),n_=(()=>{let c;return()=>{if(c===void 0&&typeof window<"u"){let u=matchMedia("(prefers-reduced-motion: reduce)");c=!u||u.matches}return c}})(),_j=20,a_=(c,u)=>{switch(u.type){case 0:return{...c,toasts:[u.toast,...c.toasts].slice(0,_j)};case 1:return{...c,toasts:c.toasts.map(N=>N.id===u.toast.id?{...N,...u.toast}:N)};case 2:let{toast:x}=u;return a_(c,{type:c.toasts.find(N=>N.id===x.id)?1:0,toast:x});case 3:let{toastId:f}=u;return{...c,toasts:c.toasts.map(N=>N.id===f||f===void 0?{...N,dismissed:!0,visible:!1}:N)};case 4:return u.toastId===void 0?{...c,toasts:[]}:{...c,toasts:c.toasts.filter(N=>N.id!==u.toastId)};case 5:return{...c,pausedAt:u.time};case 6:let w=u.time-(c.pausedAt||0);return{...c,pausedAt:void 0,toasts:c.toasts.map(N=>({...N,pauseDuration:N.pauseDuration+w}))}}},Lh=[],Go={toasts:[],pausedAt:void 0},Jo=c=>{Go=a_(Go,c),Lh.forEach(u=>{u(Go)})},vj={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},bj=(c={})=>{let[u,x]=oe.useState(Go),f=oe.useRef(Go);oe.useEffect(()=>(f.current!==Go&&x(Go),Lh.push(x),()=>{let N=Lh.indexOf(x);N>-1&&Lh.splice(N,1)}),[]);let w=u.toasts.map(N=>{var E,A,n;return{...c,...c[N.type],...N,removeDelay:N.removeDelay||((E=c[N.type])==null?void 0:E.removeDelay)||(c==null?void 0:c.removeDelay),duration:N.duration||((A=c[N.type])==null?void 0:A.duration)||(c==null?void 0:c.duration)||vj[N.type],style:{...c.style,...(n=c[N.type])==null?void 0:n.style,...N.style}}});return{...u,toasts:w}},wj=(c,u="blank",x)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:u,ariaProps:{role:"status","aria-live":"polite"},message:c,pauseDuration:0,...x,id:(x==null?void 0:x.id)||yj()}),eu=c=>(u,x)=>{let f=wj(u,c,x);return Jo({type:2,toast:f}),f.id},Kr=(c,u)=>eu("blank")(c,u);Kr.error=eu("error");Kr.success=eu("success");Kr.loading=eu("loading");Kr.custom=eu("custom");Kr.dismiss=c=>{Jo({type:3,toastId:c})};Kr.remove=c=>Jo({type:4,toastId:c});Kr.promise=(c,u,x)=>{let f=Kr.loading(u.loading,{...x,...x==null?void 0:x.loading});return typeof c=="function"&&(c=c()),c.then(w=>{let N=u.success?$h(u.success,w):void 0;return N?Kr.success(N,{id:f,...x,...x==null?void 0:x.success}):Kr.dismiss(f),w}).catch(w=>{let N=u.error?$h(u.error,w):void 0;N?Kr.error(N,{id:f,...x,...x==null?void 0:x.error}):Kr.dismiss(f)}),c};var jj=(c,u)=>{Jo({type:1,toast:{id:c,height:u}})},Nj=()=>{Jo({type:5,time:Date.now()})},Wd=new Map,Sj=1e3,Tj=(c,u=Sj)=>{if(Wd.has(c))return;let x=setTimeout(()=>{Wd.delete(c),Jo({type:4,toastId:c})},u);Wd.set(c,x)},Ej=c=>{let{toasts:u,pausedAt:x}=bj(c);oe.useEffect(()=>{if(x)return;let N=Date.now(),E=u.map(A=>{if(A.duration===1/0)return;let n=(A.duration||0)+A.pauseDuration-(N-A.createdAt);if(n<0){A.visible&&Kr.dismiss(A.id);return}return setTimeout(()=>Kr.dismiss(A.id),n)});return()=>{E.forEach(A=>A&&clearTimeout(A))}},[u,x]);let f=oe.useCallback(()=>{x&&Jo({type:6,time:Date.now()})},[x]),w=oe.useCallback((N,E)=>{let{reverseOrder:A=!1,gutter:n=8,defaultPosition:P}=E||{},z=u.filter(W=>(W.position||P)===(N.position||P)&&W.height),q=z.findIndex(W=>W.id===N.id),U=z.filter((W,X)=>X<q&&W.visible).length;return z.filter(W=>W.visible).slice(...A?[U+1]:[0,U]).reduce((W,X)=>W+(X.height||0)+n,0)},[u]);return oe.useEffect(()=>{u.forEach(N=>{if(N.dismissed)Tj(N.id,N.removeDelay);else{let E=Wd.get(N.id);E&&(clearTimeout(E),Wd.delete(N.id))}})},[u]),{toasts:u,handlers:{updateHeight:jj,startPause:Nj,endPause:f,calculateOffset:w}}},Cj=fa`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,kj=fa`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Aj=fa`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Mj=eo("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Cj} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${kj} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${c=>c.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Aj} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Pj=fa`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ij=eo("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${c=>c.secondary||"#e0e0e0"};
  border-right-color: ${c=>c.primary||"#616161"};
  animation: ${Pj} 1s linear infinite;
`,Dj=fa`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Lj=fa`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Rj=eo("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Dj} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Lj} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${c=>c.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,zj=eo("div")`
  position: absolute;
`,Oj=eo("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Fj=fa`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Bj=eo("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Fj} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Uj=({toast:c})=>{let{icon:u,type:x,iconTheme:f}=c;return u!==void 0?typeof u=="string"?oe.createElement(Bj,null,u):u:x==="blank"?null:oe.createElement(Oj,null,oe.createElement(Ij,{...f}),x!=="loading"&&oe.createElement(zj,null,x==="error"?oe.createElement(Mj,{...f}):oe.createElement(Rj,{...f})))},Vj=c=>`
0% {transform: translate3d(0,${c*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,qj=c=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${c*-150}%,-1px) scale(.6); opacity:0;}
`,$j="0%{opacity:0;} 100%{opacity:1;}",Gj="0%{opacity:1;} 100%{opacity:0;}",Zj=eo("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Wj=eo("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Hj=(c,u)=>{let x=c.includes("top")?1:-1,[f,w]=n_()?[$j,Gj]:[Vj(x),qj(x)];return{animation:u?`${fa(f)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${fa(w)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Xj=oe.memo(({toast:c,position:u,style:x,children:f})=>{let w=c.height?Hj(c.position||u||"top-center",c.visible):{opacity:0},N=oe.createElement(Uj,{toast:c}),E=oe.createElement(Wj,{...c.ariaProps},$h(c.message,c));return oe.createElement(Zj,{className:c.className,style:{...w,...x,...c.style}},typeof f=="function"?f({icon:N,message:E}):oe.createElement(oe.Fragment,null,N,E))});gj(oe.createElement);var Kj=({id:c,className:u,style:x,onHeightUpdate:f,children:w})=>{let N=oe.useCallback(E=>{if(E){let A=()=>{let n=E.getBoundingClientRect().height;f(c,n)};A(),new MutationObserver(A).observe(E,{subtree:!0,childList:!0,characterData:!0})}},[c,f]);return oe.createElement("div",{ref:N,className:u,style:x},w)},Qj=(c,u)=>{let x=c.includes("top"),f=x?{top:0}:{bottom:0},w=c.includes("center")?{justifyContent:"center"}:c.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:n_()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${u*(x?1:-1)}px)`,...f,...w}},Jj=rm`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Ph=16,Yj=({reverseOrder:c,position:u="top-center",toastOptions:x,gutter:f,children:w,containerStyle:N,containerClassName:E})=>{let{toasts:A,handlers:n}=Ej(x);return oe.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Ph,left:Ph,right:Ph,bottom:Ph,pointerEvents:"none",...N},className:E,onMouseEnter:n.startPause,onMouseLeave:n.endPause},A.map(P=>{let z=P.position||u,q=n.calculateOffset(P,{reverseOrder:c,gutter:f,defaultPosition:u}),U=Qj(z,q);return oe.createElement(Kj,{id:P.id,key:P.id,onHeightUpdate:n.updateHeight,className:P.visible?Jj:"",style:U},P.type==="custom"?$h(P.message,P):w?w(P):oe.createElement(Xj,{toast:P,position:z}))}))},It=Kr;function eN(c){return c}function tN(c){return c.length===0?eN:c.length===1?c[0]:function(x){return c.reduce((f,w)=>w(f),x)}}function o_(c){const u={subscribe(x){let f=null,w=!1,N=!1,E=!1;function A(){if(f===null){E=!0;return}N||(N=!0,typeof f=="function"?f():f&&f.unsubscribe())}return f=c({next(n){var P;w||(P=x.next)==null||P.call(x,n)},error(n){var P;w||(w=!0,(P=x.error)==null||P.call(x,n),A())},complete(){var n;w||(w=!0,(n=x.complete)==null||n.call(x),A())}}),E&&A(),{unsubscribe:A}},pipe(...x){return tN(x)(u)}};return u}function sN(c){return u=>{let x=0,f=null;const w=[];function N(){f||(f=u.subscribe({next(A){var n;for(const P of w)(n=P.next)==null||n.call(P,A)},error(A){var n;for(const P of w)(n=P.error)==null||n.call(P,A)},complete(){var A;for(const n of w)(A=n.complete)==null||A.call(n)}}))}function E(){if(x===0&&f){const A=f;f=null,A.unsubscribe()}}return{subscribe(A){return x++,w.push(A),N(),{unsubscribe(){x--,E();const n=w.findIndex(P=>P===A);n>-1&&w.splice(n,1)}}}}}}class Of extends Error{constructor(u){super(u),this.name="ObservableAbortError",Object.setPrototypeOf(this,Of.prototype)}}function rN(c){let u;return{promise:new Promise((f,w)=>{let N=!1;function E(){N||(N=!0,w(new Of("This operation was aborted.")),A.unsubscribe())}const A=c.subscribe({next(n){N=!0,f(n),E()},error(n){N=!0,w(n),E()},complete(){N=!0,E()}});u=E}),abort:u}}function iN(c){return o_(u=>{function x(w=0,N=c.op){const E=c.links[w];if(!E)throw new Error("No more links to execute - did you forget to add an ending link?");return E({op:N,next(n){return x(w+1,n)}})}return x().subscribe(u)})}function l_(c){const u=Object.create(null);for(const x in c){const f=c[x];u[f]=x}return u}const c_={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};l_(c_);l_(c_);const d_=()=>{};function u_(c,u){return new Proxy(d_,{get(f,w){if(!(typeof w!="string"||w==="then"))return u_(c,[...u,w])},apply(f,w,N){const E=u[u.length-1]==="apply";return c({args:E?N.length>=2?N[1]:[]:N,path:E?u.slice(0,-1):u})}})}const im=c=>u_(c,[]),Ff=c=>new Proxy(d_,{get(u,x){if(!(typeof x!="string"||x==="then"))return c(x)}});function nN(c){return!!c&&!Array.isArray(c)&&typeof c=="object"}class aN extends Error{}function oN(c){if(c instanceof Error)return c;const u=typeof c;if(!(u==="undefined"||u==="function"||c===null)){if(u!=="object")return new Error(String(c));if(nN(c)){const x=new aN;for(const f in c)x[f]=c[f];return x}}}function Gh(c){return!!c&&!Array.isArray(c)&&typeof c=="object"}function lN(c,u){if("error"in c){const f=u.transformer.deserialize(c.error);return{ok:!1,error:{...c,error:f}}}return{ok:!0,result:{...c.result,...(!c.result.type||c.result.type==="data")&&{type:"data",data:u.transformer.deserialize(c.result.data)}}}}class Jp extends Error{constructor(){super("Unable to transform response from server")}}function cN(c,u){let x;try{x=lN(c,u)}catch{throw new Jp}if(!x.ok&&(!Gh(x.error.error)||typeof x.error.error.code!="number"))throw new Jp;if(x.ok&&!Gh(x.result))throw new Jp;return x}function dN(c){return c instanceof qn||c instanceof Error&&c.name==="TRPCClientError"}function uN(c){return Gh(c)&&Gh(c.error)&&typeof c.error.code=="number"&&typeof c.error.message=="string"}class qn extends Error{static from(u,x={}){const f=u;return dN(f)?(x.meta&&(f.meta={...f.meta,...x.meta}),f):uN(f)?new qn(f.error.message,{...x,result:f}):f instanceof Error?new qn(f.message,{...x,cause:oN(f)}):new qn("Unknown error",{...x,cause:f})}constructor(u,x){var w,N;const f=x==null?void 0:x.cause;super(u,{cause:f}),this.meta=x==null?void 0:x.meta,this.cause=f,this.shape=(w=x==null?void 0:x.result)==null?void 0:w.error,this.data=(N=x==null?void 0:x.result)==null?void 0:N.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,qn.prototype)}}const Gy=c=>typeof c=="function";function hN(c){if(c)return c;if(typeof window<"u"&&Gy(window.fetch))return window.fetch;if(typeof globalThis<"u"&&Gy(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}function mN(c){return c||(typeof window<"u"&&window.AbortController?window.AbortController:typeof globalThis<"u"&&globalThis.AbortController?globalThis.AbortController:null)}function pN(c){return{url:c.url.toString().replace(/\/$/,""),fetch:c.fetch,AbortController:mN(c.AbortController)}}function fN(c){const u={};for(let x=0;x<c.length;x++){const f=c[x];u[x]=f}return u}const gN={query:"GET",mutation:"POST"};function h_(c){return"input"in c?c.runtime.transformer.serialize(c.input):fN(c.inputs.map(u=>c.runtime.transformer.serialize(u)))}const xN=c=>{let u=c.url+"/"+c.path;const x=[];if("inputs"in c&&x.push("batch=1"),c.type==="query"){const f=h_(c);f!==void 0&&x.push(`input=${encodeURIComponent(JSON.stringify(f))}`)}return x.length&&(u+="?"+x.join("&")),u},yN=c=>{if(c.type==="query")return;const u=h_(c);return u!==void 0?JSON.stringify(u):void 0},_N=c=>bN({...c,contentTypeHeader:"application/json",getUrl:xN,getBody:yN});async function vN(c,u){const x=c.getUrl(c),f=c.getBody(c),{type:w}=c,N=await c.headers();/* istanbul ignore if -- @preserve */if(w==="subscription")throw new Error("Subscriptions should use wsLink");const E={...c.contentTypeHeader?{"content-type":c.contentTypeHeader}:{},...c.batchModeHeader?{"trpc-batch-mode":c.batchModeHeader}:{},...N};return hN(c.fetch)(x,{method:gN[w],signal:u==null?void 0:u.signal,body:f,headers:E})}function bN(c){const u=c.AbortController?new c.AbortController:null,x={};let f=!1;return{promise:new Promise((E,A)=>{vN(c,u).then(n=>(x.response=n,f=!0,n.json())).then(n=>{x.responseJSON=n,E({json:n,meta:x})}).catch(n=>{f=!0,A(qn.from(n,{meta:x}))})}),cancel:()=>{f||u==null||u.abort()}}}function wN(c){return u=>{const x=pN(u);return f=>({op:w})=>o_(N=>{const{path:E,input:A,type:n}=w,{promise:P,cancel:z}=c.requester({...x,runtime:f,type:n,path:E,input:A,headers(){return u.headers?typeof u.headers=="function"?u.headers({op:w}):u.headers:{}}});let q;return P.then(U=>{q=U.meta;const W=cN(U.json,f);if(!W.ok){N.error(qn.from(W.error,{meta:q}));return}N.next({context:U.meta,result:W.result}),N.complete()}).catch(U=>{N.error(qn.from(U,{meta:q}))}),()=>{z()}})}}const jN=wN({requester:_N});class NN{$request({type:u,input:x,path:f,context:w={}}){return iN({links:this.links,op:{id:++this.requestId,type:u,path:f,input:x,context:w}}).pipe(sN())}requestAsPromise(u){const x=this.$request(u),{promise:f,abort:w}=rN(x);return new Promise((E,A)=>{var n;(n=u.signal)==null||n.addEventListener("abort",w),f.then(P=>{E(P.result.data)}).catch(P=>{A(qn.from(P))})})}query(u,x,f){return this.requestAsPromise({type:"query",path:u,input:x,context:f==null?void 0:f.context,signal:f==null?void 0:f.signal})}mutation(u,x,f){return this.requestAsPromise({type:"mutation",path:u,input:x,context:f==null?void 0:f.context,signal:f==null?void 0:f.signal})}subscription(u,x,f){return this.$request({type:"subscription",path:u,input:x,context:f==null?void 0:f.context}).subscribe({next(N){var E,A,n;N.result.type==="started"?(E=f.onStarted)==null||E.call(f):N.result.type==="stopped"?(A=f.onStopped)==null||A.call(f):(n=f.onData)==null||n.call(f,N.result.data)},error(N){var E;(E=f.onError)==null||E.call(f,N)},complete(){var N;(N=f.onComplete)==null||N.call(f)}})}constructor(u){this.requestId=0;const x=(()=>{const f=u.transformer;return f?"input"in f?u.transformer:{input:f,output:f}:{input:{serialize:w=>w,deserialize:w=>w},output:{serialize:w=>w,deserialize:w=>w}}})();this.runtime={transformer:{serialize:f=>x.input.serialize(f),deserialize:f=>x.output.deserialize(f)},combinedTransformer:x},this.links=u.links.map(f=>f(this.runtime))}}function SN(c){return new NN(c)}const TN={query:"query",mutate:"mutation",subscribe:"subscription"},EN=c=>TN[c];function CN(c){return Ff(u=>c.hasOwnProperty(u)?c[u]:u==="__untypedClient"?c:im(({path:x,args:f})=>{const w=[u,...x],N=EN(w.pop()),E=w.join(".");return c[N](E,...f)}))}function hr(c,u){const x=Array.isArray(c)?c:[c],[f,w]=x,N=typeof f!="string"||f===""?[]:f.split(".");return!w&&(!u||u==="any")?N.length?[N]:[]:[N,{...typeof w<"u"&&{input:w},...u&&u!=="any"&&{type:u}}]}function Zh(c,u){return c.length?u===void 0?[c]:[c,u]:[]}function kN(c,u){return im(x=>{const f=x.args,w=[c,...x.path],N=w.pop(),E=w.join(".");if(N==="useMutation")return u[N](E,...f);const[A,...n]=f,P=Zh(E,A);if(N==="getQueryKey")return hr(P,n[0]??"any");if(N==="_def")return{path:w};if(N.startsWith("useSuspense")){const z=n[0]||{},U=u[N==="useSuspenseQuery"?"useQuery":"useInfiniteQuery"](P,{...z,suspense:!0,enabled:!0});return[U.data,U]}return u[N](P,...n)})}const AN=["client","ssrContext","ssrState","abortOnUnmount"],MN=oe.createContext(null);function PN(c){return Ff(u=>{const x=u;return x==="client"?CN(c.client):AN.includes(x)?c[x]:im(({path:f,args:w})=>{const N=[u,...f],E=N.pop(),A=N.join("."),n=W=>{if(["setData","setInfiniteData"].includes(W)){const[de,ne,...te]=w;return{queryKey:Zh(A,de),updater:ne,rest:te}}const[X,...Z]=w;return{queryKey:Zh(A,X),rest:Z}},{queryKey:P,rest:z,updater:q}=n(E);return{fetch:()=>c.fetchQuery(P,...z),fetchInfinite:()=>c.fetchInfiniteQuery(P,...z),prefetch:()=>c.prefetchQuery(P,...z),prefetchInfinite:()=>c.prefetchInfiniteQuery(P,...z),ensureData:()=>c.ensureQueryData(P,...z),invalidate:()=>c.invalidateQueries(P,...z),reset:()=>c.resetQueries(P,...z),refetch:()=>c.refetchQueries(P,...z),cancel:()=>c.cancelQuery(P,...z),setData:()=>{c.setQueryData(P,q,...z)},setInfiniteData:()=>{c.setInfiniteQueryData(P,q,...z)},getData:()=>c.getQueryData(P),getInfiniteData:()=>c.getInfiniteQueryData(P)}[E]()})})}function IN(c){return im(u=>{const x=u.path.join("."),[f,w]=u.args;return{queryKey:Zh(x,f),queryFn:()=>c.query(x,f,w==null?void 0:w.trpc),...w}})}function Za(c,u){const[x,f]=c;return[x,f,u==null?void 0:u.trpc]}function Yp(c){const{path:u}=c;return oe.useMemo(()=>({path:u}),[u])}function DN(c){const u=X=>X.originalFn(),x=MN,f=c==null?void 0:c.reactQueryContext,w=X=>SN(X),N=X=>{const{abortOnUnmount:Z=!1,client:J,queryClient:de,ssrContext:ne}=X,[te,Ne]=oe.useState(X.ssrState??!1);return oe.useEffect(()=>{Ne(he=>he?"mounted":!1)},[]),li.createElement(x.Provider,{value:{abortOnUnmount:Z,queryClient:de,client:J,ssrContext:ne??null,ssrState:te,fetchQuery:oe.useCallback((he,Ce)=>de.fetchQuery({...Ce,queryKey:hr(he,"query"),queryFn:()=>J.query(...Za(he,Ce))}),[J,de]),fetchInfiniteQuery:oe.useCallback((he,Ce)=>de.fetchInfiniteQuery({...Ce,queryKey:hr(he,"infinite"),queryFn:({pageParam:Ae})=>{const[fe,Ie]=he,Ee={...Ie,cursor:Ae};return J.query(...Za([fe,Ee],Ce))}}),[J,de]),prefetchQuery:oe.useCallback((he,Ce)=>de.prefetchQuery({...Ce,queryKey:hr(he,"query"),queryFn:()=>J.query(...Za(he,Ce))}),[J,de]),prefetchInfiniteQuery:oe.useCallback((he,Ce)=>de.prefetchInfiniteQuery({...Ce,queryKey:hr(he,"infinite"),queryFn:({pageParam:Ae})=>{const[fe,Ie]=he,Ee={...Ie,cursor:Ae};return J.query(...Za([fe,Ee],Ce))}}),[J,de]),ensureQueryData:oe.useCallback((he,Ce)=>de.ensureQueryData({...Ce,queryKey:hr(he,"query"),queryFn:()=>J.query(...Za(he,Ce))}),[J,de]),invalidateQueries:oe.useCallback((he,Ce,Ae)=>de.invalidateQueries({...Ce,queryKey:hr(he,"any")},Ae),[de]),resetQueries:oe.useCallback((...he)=>{const[Ce,Ae,fe]=he;return de.resetQueries({...Ae,queryKey:hr(Ce,"any")},fe)},[de]),refetchQueries:oe.useCallback((...he)=>{const[Ce,Ae,fe]=he;return de.refetchQueries({...Ae,queryKey:hr(Ce,"any")},fe)},[de]),cancelQuery:oe.useCallback(he=>de.cancelQueries({queryKey:hr(he,"any")}),[de]),setQueryData:oe.useCallback((...he)=>{const[Ce,...Ae]=he;return de.setQueryData(hr(Ce,"query"),...Ae)},[de]),getQueryData:oe.useCallback((...he)=>{const[Ce,...Ae]=he;return de.getQueryData(hr(Ce,"query"),...Ae)},[de]),setInfiniteQueryData:oe.useCallback((...he)=>{const[Ce,...Ae]=he;return de.setQueryData(hr(Ce,"infinite"),...Ae)},[de]),getInfiniteQueryData:oe.useCallback((...he)=>{const[Ce,...Ae]=he;return de.getQueryData(hr(Ce,"infinite"),...Ae)},[de])}},X.children)};function E(){return li.useContext(x)}function A(X,Z,J){var te;const{queryClient:de,ssrState:ne}=E();return ne&&ne!=="mounted"&&((te=de.getQueryCache().find(hr(X,Z)))==null?void 0:te.state.status)==="error"?{retryOnMount:!1,...J}:J}function n(X,Z){var Ee,tt;const J=E();if(!J)throw new Error("Unable to retrieve application context. Did you forget to wrap your App inside `withTRPC` HoC?");const{abortOnUnmount:de,client:ne,ssrState:te,queryClient:Ne,prefetchQuery:he}=J,Ce=Ne.getQueryDefaults(hr(X,"query"));typeof window>"u"&&te==="prepass"&&((Ee=Z==null?void 0:Z.trpc)==null?void 0:Ee.ssr)!==!1&&((Z==null?void 0:Z.enabled)??(Ce==null?void 0:Ce.enabled))!==!1&&!Ne.getQueryCache().find(hr(X,"query"))&&he(X,Z);const Ae=A(X,"query",{...Ce,...Z}),fe=((tt=Z==null?void 0:Z.trpc)==null?void 0:tt.abortOnUnmount)??(c==null?void 0:c.abortOnUnmount)??de,Ie=s_({...Ae,queryKey:hr(X,"query"),queryFn:je=>{const Pe={...Ae,trpc:{...Ae==null?void 0:Ae.trpc,...fe?{signal:je.signal}:{}}};return ne.query(...Za(X,Pe))},context:f});return Ie.trpc=Yp({path:X[0]}),Ie}function P(X,Z){const{client:J}=E(),de=sm({context:f}),ne=Array.isArray(X)?X[0]:X,te=de.getMutationDefaults([ne.split(".")]),Ne=oj({...Z,mutationKey:[ne.split(".")],mutationFn:he=>J.mutation(...Za([ne,he],Z)),context:f,onSuccess(...he){return u({originalFn:()=>{var Ae,fe;return((Ae=Z==null?void 0:Z.onSuccess)==null?void 0:Ae.call(Z,...he))??((fe=te==null?void 0:te.onSuccess)==null?void 0:fe.call(te,...he))},queryClient:de,meta:(Z==null?void 0:Z.meta)??(te==null?void 0:te.meta)??{}})}});return Ne.trpc=Yp({path:ne}),Ne}/* istanbul ignore next -- @preserve */function z(X,Z){const J=(Z==null?void 0:Z.enabled)??!0,de=Ja(X),{client:ne}=E(),te=oe.useRef(Z);te.current=Z,oe.useEffect(()=>{if(!J)return;const[Ne,he]=X;let Ce=!1;const Ae=ne.subscription(Ne,he??void 0,{onStarted:()=>{var fe,Ie;Ce||(Ie=(fe=te.current).onStarted)==null||Ie.call(fe)},onData:fe=>{Ce||te.current.onData(fe)},onError:fe=>{var Ie,Ee;Ce||(Ee=(Ie=te.current).onError)==null||Ee.call(Ie,fe)}});return()=>{Ce=!0,Ae.unsubscribe()}},[de,J])}function q(X,Z){var tt,je;const[J,de]=X,{client:ne,ssrState:te,prefetchInfiniteQuery:Ne,queryClient:he,abortOnUnmount:Ce}=E(),Ae=he.getQueryDefaults(hr(X,"infinite"));typeof window>"u"&&te==="prepass"&&((tt=Z==null?void 0:Z.trpc)==null?void 0:tt.ssr)!==!1&&((Z==null?void 0:Z.enabled)??(Ae==null?void 0:Ae.enabled))!==!1&&!he.getQueryCache().find(hr(X,"infinite"))&&Ne(X,{...Ae,...Z});const fe=A(X,"infinite",{...Ae,...Z}),Ie=((je=Z==null?void 0:Z.trpc)==null?void 0:je.abortOnUnmount)??Ce,Ee=cj({...fe,queryKey:hr(X,"infinite"),queryFn:Pe=>{const it={...fe,trpc:{...fe==null?void 0:fe.trpc,...Ie?{signal:Pe.signal}:{}}},ct={...de??{},cursor:Pe.pageParam??(Z==null?void 0:Z.initialCursor)};return ne.query(...Za([J,ct],it))},context:f});return Ee.trpc=Yp({path:J}),Ee}return{Provider:N,createClient:w,useContext:E,useUtils:E,useQuery:n,useQueries:(X,Z)=>{var Ce;const{ssrState:J,queryClient:de,prefetchQuery:ne,client:te}=E(),Ne=IN(te),he=X(Ne);if(typeof window>"u"&&J==="prepass")for(const Ae of he){const fe=Ae;((Ce=fe.trpc)==null?void 0:Ce.ssr)!==!1&&!de.getQueryCache().find(hr(fe.queryKey,"query"))&&ne(fe.queryKey,fe)}return aj({queries:he.map(Ae=>({...Ae,queryKey:hr(Ae.queryKey,"query")})),context:Z})},useMutation:P,useSubscription:z,useDehydratedState:(X,Z)=>oe.useMemo(()=>Z&&X.runtime.transformer.deserialize(Z),[Z,X]),useInfiniteQuery:q}}function LN(c){return DN(c)}function RN(c){return Ff(u=>u==="useContext"||u==="useUtils"?()=>{const x=c.useUtils();return oe.useMemo(()=>PN(x),[x])}:c.hasOwnProperty(u)?c[u]:kN(u,c))}function zN(c){const u=LN(c);return RN(u)}const yt=zN(),ON=yt.createClient({links:[jN({url:"/api/v1/trpc",headers:async()=>{try{let c=localStorage.getItem("auth_token");if(!c){const u=Object.keys(localStorage);for(const x of u)if(x.includes("auth-token")){const f=localStorage.getItem(x);try{const w=JSON.parse(f);if(w&&w.access_token){c=w.access_token;break}}catch{}}}return c?{Authorization:`Bearer ${c}`}:{}}catch(c){return console.warn("Failed to get auth token for tRPC:",c),{}}}})]}),m_=oe.createContext(void 0),nm=()=>{const c=oe.useContext(m_);if(c===void 0)throw new Error("useAuth must be used within an AuthProvider");return c},FN=({children:c})=>{const[u,x]=oe.useState({user:null,adminUser:null,loading:!0,error:null}),f=yt.auth.login.useMutation(),w=yt.auth.register.useMutation(),N=yt.auth.logout.useMutation(),E=async(z,q)=>{x(U=>({...U,loading:!0,error:null}));try{const U=await f.mutateAsync({email:z,password:q});localStorage.setItem("auth_token",U.session.access_token),localStorage.setItem("refresh_token",U.session.refresh_token),x({user:U.user,adminUser:U.user,loading:!1,error:null}),window.location.href="/dashboard"}catch(U){throw console.error("Login error:",U),x(W=>({...W,loading:!1,error:U.message||"Authentication failed"})),U}},A=async(z,q,U)=>{x(W=>({...W,loading:!0,error:null}));try{const W=await w.mutateAsync({email:z,password:q,name:U});x(X=>({...X,loading:!1,error:null}))}catch(W){throw x(X=>({...X,loading:!1,error:W.message||"Registration failed"})),W}},n=async()=>{x(z=>({...z,loading:!0}));try{await N.mutateAsync()}catch{}localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),x({user:null,adminUser:null,loading:!1,error:null})};oe.useEffect(()=>{(async()=>{let q=localStorage.getItem("auth_token");if(!q){const W=Object.keys(localStorage);for(const X of W){const Z=localStorage.getItem(X);try{const J=JSON.parse(Z);if(J&&J.access_token){q=J.access_token;break}}catch{}}}const U=window.location.pathname==="/login"||window.location.pathname==="/";if(!q){x(W=>({...W,user:null,adminUser:null,loading:!1})),U||(window.location.href="/login");return}try{const J=await(await fetch("/api/v1/trpc/api/v1/trpc/auth.me",{method:"GET",headers:{Authorization:`Bearer ${q}`}})).json();if(J&&J.result&&J.result.data){const de=J.result.data;x({user:de.user,adminUser:de.user,loading:!1,error:null})}else throw new Error("Invalid response format from auth.me")}catch(W){console.error("Auth initialization failed:",W==null?void 0:W.message),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),x({user:null,adminUser:null,loading:!1,error:null}),U||(window.location.href="/login")}})()},[]);const P={...u,signIn:E,signOut:n,register:A};return t.jsx(m_.Provider,{value:P,children:c})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var BN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Lt=(c,u)=>{const x=oe.forwardRef(({color:f="currentColor",size:w=24,strokeWidth:N=2,absoluteStrokeWidth:E,className:A="",children:n,...P},z)=>oe.createElement("svg",{ref:z,...BN,width:w,height:w,stroke:f,strokeWidth:E?Number(N)*24/Number(w):N,className:["lucide",`lucide-${UN(c)}`,A].join(" "),...P},[...u.map(([q,U])=>oe.createElement(q,U)),...Array.isArray(n)?n:[n]]));return x.displayName=`${c}`,x};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zy=Lt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tu=Lt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=Lt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bf=Lt("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=Lt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_=Lt("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VN=Lt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=Lt("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qN=Lt("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f_=Lt("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=Lt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $N=Lt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=Lt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GN=Lt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const am=Lt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_=Lt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=Lt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZN=Lt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=Lt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WN=Lt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=Lt("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uf=Lt("Cylinder",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5v14a9 3 0 0 0 18 0V5",key:"aqi0yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=Lt("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=Lt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XN=Lt("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const om=Lt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=Lt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qd=Lt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=Lt("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"8ur5zv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=Lt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QN=Lt("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=Lt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JN=Lt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=Lt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eS=Lt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=Lt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tS=Lt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=Lt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_=Lt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_=Lt("Package2",[["path",{d:"M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z",key:"1ront0"}],["path",{d:"m3 9 2.45-4.9A2 2 0 0 1 7.24 3h9.52a2 2 0 0 1 1.8 1.1L21 9",key:"19h2x1"}],["path",{d:"M12 3v6",key:"1holv5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=Lt("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rS=Lt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iS=Lt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=Lt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=Lt("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=Lt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=Lt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_=Lt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jf=Lt("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yi=Lt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nS=Lt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=Lt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sc=Lt("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const di=Lt("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wh=Lt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oS=Lt("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=Lt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wy=Lt("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=Lt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=Lt("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lm=Lt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rc=Lt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=Lt("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qf=Lt("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lS=Lt("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Lt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=Lt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cS=Lt("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),dS=({children:c})=>{const{user:u,adminUser:x,loading:f}=nm();return f?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}):!u||!x?t.jsx(k0,{to:"/login",replace:!0}):t.jsx(t.Fragment,{children:c})},uS=({onMenuClick:c})=>{const{adminUser:u,signOut:x}=nm(),f=async()=>{try{await x()}catch(w){console.error("Error signing out:",w)}};return t.jsxs("header",{className:"bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:c,className:"lg:hidden p-2 rounded-md hover:bg-gray-100 transition-colors",children:t.jsx(tS,{className:"h-6 w-6 text-gray-600"})}),t.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"LPG Order Management"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(lm,{className:"h-4 w-4"}),t.jsxs("div",{className:"flex flex-col items-end",children:[t.jsx("span",{className:"font-medium text-gray-900",children:u==null?void 0:u.name}),t.jsx("span",{className:"text-xs text-gray-500",children:u==null?void 0:u.email})]})]})}),t.jsxs("button",{onClick:f,className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:[t.jsx(YN,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Sign Out"})]})]})]})},hS=[{name:"Dashboard",href:"/",icon:QN},{name:"Customers",href:"/customers",icon:rc},{name:"Products",href:"/products",icon:hs},{name:"Warehouses",href:"/warehouses",icon:En},{name:"Inventory",href:"/inventory",icon:Xo},{name:"Trucks",href:"/trucks",icon:mr},{name:"Fleet Capacity",href:"/trucks/capacity",icon:Ji},{name:"Pricing",href:"/pricing",icon:Sn},{name:"Orders",href:"/orders",icon:sc},{name:"Transfers",href:"/transfers",icon:Bf}],mS=({isOpen:c,onClose:u})=>t.jsxs(t.Fragment,{children:[c&&t.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden",onClick:u}),t.jsxs("aside",{className:`
          fixed top-0 left-0 z-50 h-full w-64 bg-gray-900 transform transition-transform duration-300 ease-in-out
          ${c?"translate-x-0":"-translate-x-full"}
          lg:translate-x-0 lg:static lg:z-auto lg:flex-shrink-0
        `,children:[t.jsxs("div",{className:"flex items-center justify-between p-4 lg:hidden border-b border-gray-700",children:[t.jsx("span",{className:"text-lg font-semibold text-white",children:"Menu"}),t.jsx("button",{onClick:u,className:"p-2 rounded-md hover:bg-gray-800 transition-colors",children:t.jsx(er,{className:"h-5 w-5 text-gray-300"})})]}),t.jsx("div",{className:"hidden lg:flex items-center justify-center h-16 bg-gray-800 border-b border-gray-700",children:t.jsx("span",{className:"text-lg font-semibold text-white",children:"LPG Admin"})}),t.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-y-auto",children:hS.map(x=>t.jsxs(p1,{to:x.href,onClick:u,className:({isActive:f})=>`flex items-center space-x-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${f?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-800"}`,children:[t.jsx(x.icon,{className:"h-5 w-5"}),t.jsx("span",{children:x.name})]},x.name))})]})]}),pS=()=>{const[c,u]=oe.useState(!1);return t.jsxs("div",{className:"h-screen flex overflow-hidden bg-gray-50",children:[t.jsx(mS,{isOpen:c,onClose:()=>u(!1)}),t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[t.jsx(uS,{onMenuClick:()=>u(!c)}),t.jsx("main",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"p-6",children:t.jsx(f1,{})})})]})]})},fS=()=>{const{user:c,signIn:u,loading:x,error:f}=nm(),[w,N]=oe.useState({email:"",password:""}),[E,A]=oe.useState(!1);if(c)return t.jsx(k0,{to:"/",replace:!0});const n=async z=>{z.preventDefault(),A(!0);try{await u(w.email,w.password)}catch{}finally{A(!1)}},P=z=>{N(q=>({...q,[z.target.name]:z.target.value}))};return x?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"max-w-md w-full space-y-8",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mx-auto h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center",children:t.jsx(__,{className:"h-8 w-8 text-white"})}),t.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Admin Portal"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"LPG Order Management System"})]}),t.jsxs("form",{className:"mt-8 space-y-6",onSubmit:n,children:[f&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tu,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-600",children:f})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),t.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:w.email,onChange:P,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter your email"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),t.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:w.password,onChange:P,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter your password"})]})]}),t.jsx("button",{type:"submit",disabled:E,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:E?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Signing in..."})]}):"Sign In"})]}),t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-xs text-gray-500",children:"Authorized personnel only. Please contact your administrator if you need access."})})]})})},gS=(c="month")=>yt.analytics.getDashboardStats.useQuery({period:c},{retry:1,staleTime:6e4,refetchInterval:5*60*1e3}),Hy=()=>{const{adminUser:c}=nm(),{data:u,isLoading:x,refetch:f}=gS(),w=[{name:"Active Customers",value:x?"...":((u==null?void 0:u.activeCustomers)||0).toLocaleString(),total:x?"...":((u==null?void 0:u.totalCustomers)||0).toLocaleString(),change:x?"...":`${(u==null?void 0:u.totalCustomers)||0} total`,changeType:"neutral",icon:rc},{name:"Active Products",value:x?"...":((u==null?void 0:u.activeProducts)||0).toLocaleString(),total:x?"...":((u==null?void 0:u.totalProducts)||0).toLocaleString(),change:x?"...":`${(u==null?void 0:u.totalProducts)||0} total`,changeType:"neutral",icon:hs},{name:"Total Cylinders",value:x?"...":((u==null?void 0:u.totalCylinders)||0).toLocaleString(),change:x?"...":"across all warehouses",changeType:"positive",icon:Ji},{name:"Warehouses",value:x?"...":((u==null?void 0:u.totalWarehouses)||0).toLocaleString(),change:x?"...":"storage locations",changeType:"neutral",icon:En}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),t.jsxs("p",{className:"text-gray-600",children:["Welcome ",c==null?void 0:c.name,"!"]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>f(),disabled:x,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${x?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsx(Xo,{className:"h-8 w-8 text-blue-600"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:w.map(N=>t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:N.name}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.value})]}),t.jsx("div",{className:"p-3 bg-blue-50 rounded-full",children:t.jsx(N.icon,{className:"h-6 w-6 text-blue-600"})})]}),t.jsx("div",{className:"mt-4 flex items-center",children:t.jsx("span",{className:"text-sm text-gray-500",children:N.change})})]},N.name))}),!x&&u&&u.lowStockProducts>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Low Stock Alert"}),t.jsxs("p",{className:"text-sm text-red-700",children:[u.lowStockProducts," product",u.lowStockProducts>1?"s have":" has"," low stock levels (10 available)"]})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("button",{onClick:()=>window.location.href="/orders",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(sc,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"New Order"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Create a new customer order"})]}),t.jsxs("button",{onClick:()=>window.location.href="/customers",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(rc,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"Add Customer"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Register a new customer"})]}),t.jsxs("button",{onClick:()=>window.location.href="/inventory",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(hs,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"Manage Inventory"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Update product stock levels"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),t.jsx(Zy,{className:"h-5 w-5 text-gray-400"})]}),t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Zy,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"Recent activity tracking coming soon"})]})]})]})},N_=(c={})=>yt.customers.list.useQuery({search:c.search,status:c.status,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:u=>{console.error("Customers fetch error:",u),It.error("Failed to load customers")}}),xS=c=>yt.customers.getById.useQuery({customer_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:u=>{console.error("Customer fetch error:",u),It.error("Failed to load customer details")}}),yS=()=>{const c=yt.useContext();return yt.customers.create.useMutation({onSuccess:u=>{console.log("Customer created successfully:",u),c.customers.list.invalidate(),It.success("Customer created successfully")},onError:u=>{console.error("Create customer error:",u),It.error(u.message||"Failed to create customer")}})},S_=()=>{const c=yt.useContext();return yt.customers.update.useMutation({onSuccess:u=>{console.log("Customer updated successfully:",u),c.customers.list.invalidate(),c.customers.getById.invalidate({customer_id:u.id}),It.success("Customer updated successfully")},onError:u=>{console.error("Update customer error:",u),It.error(u.message||"Failed to update customer")}})},_S=()=>{const c=yt.useContext();return yt.customers.delete.useMutation({onSuccess:()=>{console.log("Customer deleted successfully"),c.customers.list.invalidate(),It.success("Customer deleted successfully")},onError:u=>{console.error("Delete customer error:",u),It.error(u.message||"Failed to delete customer")}})},vS=({customers:c,loading:u=!1,onView:x,onDelete:f,onStatusChange:w})=>{const N=E=>new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return console.log("CustomerTable render:",{customers:c,loading:u}),u?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading customers..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(rc,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No customers found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load customers. Please check your connection.":"Get started by adding your first customer."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Customers (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credit Terms"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(E=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:E.name}),E.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",E.external_id]}),E.tax_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Tax ID: ",E.tax_id]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[E.email&&t.jsx("div",{className:"mb-1",children:E.email}),E.phone&&t.jsx("div",{className:"text-gray-500",children:E.phone}),!E.email&&!E.phone&&t.jsx("span",{className:"text-gray-400",children:"No contact info"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("select",{value:E.account_status,onChange:A=>w(E,A.target.value),className:`block w-full pl-3 pr-10 py-2 text-sm border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${E.account_status==="active"?"bg-green-50 text-green-700 border-green-200":E.account_status==="credit_hold"?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-red-50 text-red-700 border-red-200"}`,children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[E.credit_terms_days," days"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(E.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>x(E),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View/Edit customer",children:t.jsx(di,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>f(E),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete customer",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},E.id))})]})})]})},bS=({filters:c,onFiltersChange:u})=>{const x=w=>{u({...c,search:w.target.value||void 0,page:1})},f=w=>{u({...c,account_status:w.target.value||void 0,page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name, email, or tax ID...",value:c.search||"",onChange:x,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.account_status||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]})})]})})},ac=({currentPage:c,totalPages:u,totalCount:x,onPageChange:f})=>{if(u<=1)return null;const N=(()=>{const A=[],n=[];for(let P=Math.max(2,c-2);P<=Math.min(u-1,c+2);P++)A.push(P);return c-2>2?n.push(1,"..."):n.push(1),n.push(...A),c+2<u-1?n.push("...",u):n.push(u),n})();return t.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[t.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[t.jsx("button",{onClick:()=>f(c-1),disabled:c===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),t.jsx("button",{onClick:()=>f(c+1),disabled:c===u,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),t.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[t.jsx("div",{children:t.jsxs("p",{className:"text-sm text-gray-700",children:["Showing"," ",t.jsx("span",{className:"font-medium",children:Math.min((c-1)*50+1,x)})," ","to"," ",t.jsx("span",{className:"font-medium",children:Math.min(c*50,x)})," ","of ",t.jsx("span",{className:"font-medium",children:x})," results"]})}),t.jsx("div",{children:t.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[t.jsx("button",{onClick:()=>f(c-1),disabled:c===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(g_,{className:"h-5 w-5"})}),N.map((E,A)=>t.jsx(li.Fragment,{children:E==="..."?t.jsx("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:"..."}):t.jsx("button",{onClick:()=>f(E),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${c===E?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:E})},A)),t.jsx("button",{onClick:()=>f(c+1),disabled:c===u,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(x_,{className:"h-5 w-5"})})]})})]})]})};var su=c=>c.type==="checkbox",Zo=c=>c instanceof Date,pi=c=>c==null;const T_=c=>typeof c=="object";var br=c=>!pi(c)&&!Array.isArray(c)&&T_(c)&&!Zo(c),wS=c=>br(c)&&c.target?su(c.target)?c.target.checked:c.target.value:c,jS=c=>c.substring(0,c.search(/\.\d+(\.|$)/))||c,NS=(c,u)=>c.has(jS(u)),SS=c=>{const u=c.constructor&&c.constructor.prototype;return br(u)&&u.hasOwnProperty("isPrototypeOf")},$f=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function oi(c){let u;const x=Array.isArray(c),f=typeof FileList<"u"?c instanceof FileList:!1;if(c instanceof Date)u=new Date(c);else if(c instanceof Set)u=new Set(c);else if(!($f&&(c instanceof Blob||f))&&(x||br(c)))if(u=x?[]:{},!x&&!SS(c))u=c;else for(const w in c)c.hasOwnProperty(w)&&(u[w]=oi(c[w]));else return c;return u}var cm=c=>Array.isArray(c)?c.filter(Boolean):[],Ar=c=>c===void 0,Bt=(c,u,x)=>{if(!u||!br(c))return x;const f=cm(u.split(/[,[\].]+?/)).reduce((w,N)=>pi(w)?w:w[N],c);return Ar(f)||f===c?Ar(c[u])?x:c[u]:f},Vn=c=>typeof c=="boolean",Gf=c=>/^\w*$/.test(c),E_=c=>cm(c.replace(/["|']|\]/g,"").split(/\.|\[/)),Ks=(c,u,x)=>{let f=-1;const w=Gf(u)?[u]:E_(u),N=w.length,E=N-1;for(;++f<N;){const A=w[f];let n=x;if(f!==E){const P=c[A];n=br(P)||Array.isArray(P)?P:isNaN(+w[f+1])?{}:[]}if(A==="__proto__"||A==="constructor"||A==="prototype")return;c[A]=n,c=c[A]}};const Xy={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},jn={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ha={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};li.createContext(null);var TS=(c,u,x,f=!0)=>{const w={defaultValues:u._defaultValues};for(const N in c)Object.defineProperty(w,N,{get:()=>{const E=N;return u._proxyFormState[E]!==jn.all&&(u._proxyFormState[E]=!f||jn.all),c[E]}});return w};const ES=typeof window<"u"?oe.useLayoutEffect:oe.useEffect;var $n=c=>typeof c=="string",CS=(c,u,x,f,w)=>$n(c)?(f&&u.watch.add(c),Bt(x,c,w)):Array.isArray(c)?c.map(N=>(f&&u.watch.add(N),Bt(x,N))):(f&&(u.watchAll=!0),x),kS=(c,u,x,f,w)=>u?{...x[c],types:{...x[c]&&x[c].types?x[c].types:{},[f]:w||!0}}:{},Hd=c=>Array.isArray(c)?c:[c],Ky=()=>{let c=[];return{get observers(){return c},next:w=>{for(const N of c)N.next&&N.next(w)},subscribe:w=>(c.push(w),{unsubscribe:()=>{c=c.filter(N=>N!==w)}}),unsubscribe:()=>{c=[]}}},Nf=c=>pi(c)||!T_(c);function Qa(c,u){if(Nf(c)||Nf(u))return c===u;if(Zo(c)&&Zo(u))return c.getTime()===u.getTime();const x=Object.keys(c),f=Object.keys(u);if(x.length!==f.length)return!1;for(const w of x){const N=c[w];if(!f.includes(w))return!1;if(w!=="ref"){const E=u[w];if(Zo(N)&&Zo(E)||br(N)&&br(E)||Array.isArray(N)&&Array.isArray(E)?!Qa(N,E):N!==E)return!1}}return!0}var Ci=c=>br(c)&&!Object.keys(c).length,Zf=c=>c.type==="file",Nn=c=>typeof c=="function",Hh=c=>{if(!$f)return!1;const u=c?c.ownerDocument:0;return c instanceof(u&&u.defaultView?u.defaultView.HTMLElement:HTMLElement)},C_=c=>c.type==="select-multiple",Wf=c=>c.type==="radio",AS=c=>Wf(c)||su(c),ef=c=>Hh(c)&&c.isConnected;function MS(c,u){const x=u.slice(0,-1).length;let f=0;for(;f<x;)c=Ar(c)?f++:c[u[f++]];return c}function PS(c){for(const u in c)if(c.hasOwnProperty(u)&&!Ar(c[u]))return!1;return!0}function Or(c,u){const x=Array.isArray(u)?u:Gf(u)?[u]:E_(u),f=x.length===1?c:MS(c,x),w=x.length-1,N=x[w];return f&&delete f[N],w!==0&&(br(f)&&Ci(f)||Array.isArray(f)&&PS(f))&&Or(c,x.slice(0,-1)),c}var k_=c=>{for(const u in c)if(Nn(c[u]))return!0;return!1};function Xh(c,u={}){const x=Array.isArray(c);if(br(c)||x)for(const f in c)Array.isArray(c[f])||br(c[f])&&!k_(c[f])?(u[f]=Array.isArray(c[f])?[]:{},Xh(c[f],u[f])):pi(c[f])||(u[f]=!0);return u}function A_(c,u,x){const f=Array.isArray(c);if(br(c)||f)for(const w in c)Array.isArray(c[w])||br(c[w])&&!k_(c[w])?Ar(u)||Nf(x[w])?x[w]=Array.isArray(c[w])?Xh(c[w],[]):{...Xh(c[w])}:A_(c[w],pi(u)?{}:u[w],x[w]):x[w]=!Qa(c[w],u[w]);return x}var Vd=(c,u)=>A_(c,u,Xh(u));const Qy={value:!1,isValid:!1},Jy={value:!0,isValid:!0};var M_=c=>{if(Array.isArray(c)){if(c.length>1){const u=c.filter(x=>x&&x.checked&&!x.disabled).map(x=>x.value);return{value:u,isValid:!!u.length}}return c[0].checked&&!c[0].disabled?c[0].attributes&&!Ar(c[0].attributes.value)?Ar(c[0].value)||c[0].value===""?Jy:{value:c[0].value,isValid:!0}:Jy:Qy}return Qy},P_=(c,{valueAsNumber:u,valueAsDate:x,setValueAs:f})=>Ar(c)?c:u?c===""?NaN:c&&+c:x&&$n(c)?new Date(c):f?f(c):c;const Yy={isValid:!1,value:null};var I_=c=>Array.isArray(c)?c.reduce((u,x)=>x&&x.checked&&!x.disabled?{isValid:!0,value:x.value}:u,Yy):Yy;function e0(c){const u=c.ref;return Zf(u)?u.files:Wf(u)?I_(c.refs).value:C_(u)?[...u.selectedOptions].map(({value:x})=>x):su(u)?M_(c.refs).value:P_(Ar(u.value)?c.ref.value:u.value,c)}var IS=(c,u,x,f)=>{const w={};for(const N of c){const E=Bt(u,N);E&&Ks(w,N,E._f)}return{criteriaMode:x,names:[...c],fields:w,shouldUseNativeValidation:f}},Kh=c=>c instanceof RegExp,qd=c=>Ar(c)?c:Kh(c)?c.source:br(c)?Kh(c.value)?c.value.source:c.value:c,t0=c=>({isOnSubmit:!c||c===jn.onSubmit,isOnBlur:c===jn.onBlur,isOnChange:c===jn.onChange,isOnAll:c===jn.all,isOnTouch:c===jn.onTouched});const s0="AsyncFunction";var DS=c=>!!c&&!!c.validate&&!!(Nn(c.validate)&&c.validate.constructor.name===s0||br(c.validate)&&Object.values(c.validate).find(u=>u.constructor.name===s0)),LS=c=>c.mount&&(c.required||c.min||c.max||c.maxLength||c.minLength||c.pattern||c.validate),r0=(c,u,x)=>!x&&(u.watchAll||u.watch.has(c)||[...u.watch].some(f=>c.startsWith(f)&&/^\.\w+/.test(c.slice(f.length))));const Xd=(c,u,x,f)=>{for(const w of x||Object.keys(c)){const N=Bt(c,w);if(N){const{_f:E,...A}=N;if(E){if(E.refs&&E.refs[0]&&u(E.refs[0],w)&&!f)return!0;if(E.ref&&u(E.ref,E.name)&&!f)return!0;if(Xd(A,u))break}else if(br(A)&&Xd(A,u))break}}};function i0(c,u,x){const f=Bt(c,x);if(f||Gf(x))return{error:f,name:x};const w=x.split(".");for(;w.length;){const N=w.join("."),E=Bt(u,N),A=Bt(c,N);if(E&&!Array.isArray(E)&&x!==N)return{name:x};if(A&&A.type)return{name:N,error:A};if(A&&A.root&&A.root.type)return{name:`${N}.root`,error:A.root};w.pop()}return{name:x}}var RS=(c,u,x,f)=>{x(c);const{name:w,...N}=c;return Ci(N)||Object.keys(N).length>=Object.keys(u).length||Object.keys(N).find(E=>u[E]===(!f||jn.all))},zS=(c,u,x)=>!c||!u||c===u||Hd(c).some(f=>f&&(x?f===u:f.startsWith(u)||u.startsWith(f))),OS=(c,u,x,f,w)=>w.isOnAll?!1:!x&&w.isOnTouch?!(u||c):(x?f.isOnBlur:w.isOnBlur)?!c:(x?f.isOnChange:w.isOnChange)?c:!0,FS=(c,u)=>!cm(Bt(c,u)).length&&Or(c,u),BS=(c,u,x)=>{const f=Hd(Bt(c,x));return Ks(f,"root",u[x]),Ks(c,x,f),c},Rh=c=>$n(c);function n0(c,u,x="validate"){if(Rh(c)||Array.isArray(c)&&c.every(Rh)||Vn(c)&&!c)return{type:x,message:Rh(c)?c:"",ref:u}}var Jl=c=>br(c)&&!Kh(c)?c:{value:c,message:""},a0=async(c,u,x,f,w,N)=>{const{ref:E,refs:A,required:n,maxLength:P,minLength:z,min:q,max:U,pattern:W,validate:X,name:Z,valueAsNumber:J,mount:de}=c._f,ne=Bt(x,Z);if(!de||u.has(Z))return{};const te=A?A[0]:E,Ne=je=>{w&&te.reportValidity&&(te.setCustomValidity(Vn(je)?"":je||""),te.reportValidity())},he={},Ce=Wf(E),Ae=su(E),fe=Ce||Ae,Ie=(J||Zf(E))&&Ar(E.value)&&Ar(ne)||Hh(E)&&E.value===""||ne===""||Array.isArray(ne)&&!ne.length,Ee=kS.bind(null,Z,f,he),tt=(je,Pe,it,ct=ha.maxLength,Nt=ha.minLength)=>{const ft=je?Pe:it;he[Z]={type:je?ct:Nt,message:ft,ref:E,...Ee(je?ct:Nt,ft)}};if(N?!Array.isArray(ne)||!ne.length:n&&(!fe&&(Ie||pi(ne))||Vn(ne)&&!ne||Ae&&!M_(A).isValid||Ce&&!I_(A).isValid)){const{value:je,message:Pe}=Rh(n)?{value:!!n,message:n}:Jl(n);if(je&&(he[Z]={type:ha.required,message:Pe,ref:te,...Ee(ha.required,Pe)},!f))return Ne(Pe),he}if(!Ie&&(!pi(q)||!pi(U))){let je,Pe;const it=Jl(U),ct=Jl(q);if(!pi(ne)&&!isNaN(ne)){const Nt=E.valueAsNumber||ne&&+ne;pi(it.value)||(je=Nt>it.value),pi(ct.value)||(Pe=Nt<ct.value)}else{const Nt=E.valueAsDate||new Date(ne),ft=Os=>new Date(new Date().toDateString()+" "+Os),Mt=E.type=="time",ht=E.type=="week";$n(it.value)&&ne&&(je=Mt?ft(ne)>ft(it.value):ht?ne>it.value:Nt>new Date(it.value)),$n(ct.value)&&ne&&(Pe=Mt?ft(ne)<ft(ct.value):ht?ne<ct.value:Nt<new Date(ct.value))}if((je||Pe)&&(tt(!!je,it.message,ct.message,ha.max,ha.min),!f))return Ne(he[Z].message),he}if((P||z)&&!Ie&&($n(ne)||N&&Array.isArray(ne))){const je=Jl(P),Pe=Jl(z),it=!pi(je.value)&&ne.length>+je.value,ct=!pi(Pe.value)&&ne.length<+Pe.value;if((it||ct)&&(tt(it,je.message,Pe.message),!f))return Ne(he[Z].message),he}if(W&&!Ie&&$n(ne)){const{value:je,message:Pe}=Jl(W);if(Kh(je)&&!ne.match(je)&&(he[Z]={type:ha.pattern,message:Pe,ref:E,...Ee(ha.pattern,Pe)},!f))return Ne(Pe),he}if(X){if(Nn(X)){const je=await X(ne,x),Pe=n0(je,te);if(Pe&&(he[Z]={...Pe,...Ee(ha.validate,Pe.message)},!f))return Ne(Pe.message),he}else if(br(X)){let je={};for(const Pe in X){if(!Ci(je)&&!f)break;const it=n0(await X[Pe](ne,x),te,Pe);it&&(je={...it,...Ee(Pe,it.message)},Ne(it.message),f&&(he[Z]=je))}if(!Ci(je)&&(he[Z]={ref:te,...je},!f))return he}}return Ne(!0),he};const US={mode:jn.onSubmit,reValidateMode:jn.onChange,shouldFocusError:!0};function VS(c={}){let u={...US,...c},x={submitCount:0,isDirty:!1,isReady:!1,isLoading:Nn(u.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:u.errors||{},disabled:u.disabled||!1};const f={};let w=br(u.defaultValues)||br(u.values)?oi(u.defaultValues||u.values)||{}:{},N=u.shouldUnregister?{}:oi(w),E={action:!1,mount:!1,watch:!1},A={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},n,P=0;const z={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let q={...z};const U={array:Ky(),state:Ky()},W=u.criteriaMode===jn.all,X=we=>Ge=>{clearTimeout(P),P=setTimeout(we,Ge)},Z=async we=>{if(!u.disabled&&(z.isValid||q.isValid||we)){const Ge=u.resolver?Ci((await Ae()).errors):await Ie(f,!0);Ge!==x.isValid&&U.state.next({isValid:Ge})}},J=(we,Ge)=>{!u.disabled&&(z.isValidating||z.validatingFields||q.isValidating||q.validatingFields)&&((we||Array.from(A.mount)).forEach(et=>{et&&(Ge?Ks(x.validatingFields,et,Ge):Or(x.validatingFields,et))}),U.state.next({validatingFields:x.validatingFields,isValidating:!Ci(x.validatingFields)}))},de=(we,Ge=[],et,Ct,wt=!0,De=!0)=>{if(Ct&&et&&!u.disabled){if(E.action=!0,De&&Array.isArray(Bt(f,we))){const xt=et(Bt(f,we),Ct.argA,Ct.argB);wt&&Ks(f,we,xt)}if(De&&Array.isArray(Bt(x.errors,we))){const xt=et(Bt(x.errors,we),Ct.argA,Ct.argB);wt&&Ks(x.errors,we,xt),FS(x.errors,we)}if((z.touchedFields||q.touchedFields)&&De&&Array.isArray(Bt(x.touchedFields,we))){const xt=et(Bt(x.touchedFields,we),Ct.argA,Ct.argB);wt&&Ks(x.touchedFields,we,xt)}(z.dirtyFields||q.dirtyFields)&&(x.dirtyFields=Vd(w,N)),U.state.next({name:we,isDirty:tt(we,Ge),dirtyFields:x.dirtyFields,errors:x.errors,isValid:x.isValid})}else Ks(N,we,Ge)},ne=(we,Ge)=>{Ks(x.errors,we,Ge),U.state.next({errors:x.errors})},te=we=>{x.errors=we,U.state.next({errors:x.errors,isValid:!1})},Ne=(we,Ge,et,Ct)=>{const wt=Bt(f,we);if(wt){const De=Bt(N,we,Ar(et)?Bt(w,we):et);Ar(De)||Ct&&Ct.defaultChecked||Ge?Ks(N,we,Ge?De:e0(wt._f)):it(we,De),E.mount&&Z()}},he=(we,Ge,et,Ct,wt)=>{let De=!1,xt=!1;const Jt={name:we};if(!u.disabled){if(!et||Ct){(z.isDirty||q.isDirty)&&(xt=x.isDirty,x.isDirty=Jt.isDirty=tt(),De=xt!==Jt.isDirty);const qt=Qa(Bt(w,we),Ge);xt=!!Bt(x.dirtyFields,we),qt?Or(x.dirtyFields,we):Ks(x.dirtyFields,we,!0),Jt.dirtyFields=x.dirtyFields,De=De||(z.dirtyFields||q.dirtyFields)&&xt!==!qt}if(et){const qt=Bt(x.touchedFields,we);qt||(Ks(x.touchedFields,we,et),Jt.touchedFields=x.touchedFields,De=De||(z.touchedFields||q.touchedFields)&&qt!==et)}De&&wt&&U.state.next(Jt)}return De?Jt:{}},Ce=(we,Ge,et,Ct)=>{const wt=Bt(x.errors,we),De=(z.isValid||q.isValid)&&Vn(Ge)&&x.isValid!==Ge;if(u.delayError&&et?(n=X(()=>ne(we,et)),n(u.delayError)):(clearTimeout(P),n=null,et?Ks(x.errors,we,et):Or(x.errors,we)),(et?!Qa(wt,et):wt)||!Ci(Ct)||De){const xt={...Ct,...De&&Vn(Ge)?{isValid:Ge}:{},errors:x.errors,name:we};x={...x,...xt},U.state.next(xt)}},Ae=async we=>{J(we,!0);const Ge=await u.resolver(N,u.context,IS(we||A.mount,f,u.criteriaMode,u.shouldUseNativeValidation));return J(we),Ge},fe=async we=>{const{errors:Ge}=await Ae(we);if(we)for(const et of we){const Ct=Bt(Ge,et);Ct?Ks(x.errors,et,Ct):Or(x.errors,et)}else x.errors=Ge;return Ge},Ie=async(we,Ge,et={valid:!0})=>{for(const Ct in we){const wt=we[Ct];if(wt){const{_f:De,...xt}=wt;if(De){const Jt=A.array.has(De.name),qt=wt._f&&DS(wt._f);qt&&z.validatingFields&&J([Ct],!0);const vs=await a0(wt,A.disabled,N,W,u.shouldUseNativeValidation&&!Ge,Jt);if(qt&&z.validatingFields&&J([Ct]),vs[De.name]&&(et.valid=!1,Ge))break;!Ge&&(Bt(vs,De.name)?Jt?BS(x.errors,vs,De.name):Ks(x.errors,De.name,vs[De.name]):Or(x.errors,De.name))}!Ci(xt)&&await Ie(xt,Ge,et)}}return et.valid},Ee=()=>{for(const we of A.unMount){const Ge=Bt(f,we);Ge&&(Ge._f.refs?Ge._f.refs.every(et=>!ef(et)):!ef(Ge._f.ref))&&jr(we)}A.unMount=new Set},tt=(we,Ge)=>!u.disabled&&(we&&Ge&&Ks(N,we,Ge),!Qa(Os(),w)),je=(we,Ge,et)=>CS(we,A,{...E.mount?N:Ar(Ge)?w:$n(we)?{[we]:Ge}:Ge},et,Ge),Pe=we=>cm(Bt(E.mount?N:w,we,u.shouldUnregister?Bt(w,we,[]):[])),it=(we,Ge,et={})=>{const Ct=Bt(f,we);let wt=Ge;if(Ct){const De=Ct._f;De&&(!De.disabled&&Ks(N,we,P_(Ge,De)),wt=Hh(De.ref)&&pi(Ge)?"":Ge,C_(De.ref)?[...De.ref.options].forEach(xt=>xt.selected=wt.includes(xt.value)):De.refs?su(De.ref)?De.refs.forEach(xt=>{(!xt.defaultChecked||!xt.disabled)&&(Array.isArray(wt)?xt.checked=!!wt.find(Jt=>Jt===xt.value):xt.checked=wt===xt.value||!!wt)}):De.refs.forEach(xt=>xt.checked=xt.value===wt):Zf(De.ref)?De.ref.value="":(De.ref.value=wt,De.ref.type||U.state.next({name:we,values:oi(N)})))}(et.shouldDirty||et.shouldTouch)&&he(we,wt,et.shouldTouch,et.shouldDirty,!0),et.shouldValidate&&ht(we)},ct=(we,Ge,et)=>{for(const Ct in Ge){if(!Ge.hasOwnProperty(Ct))return;const wt=Ge[Ct],De=we+"."+Ct,xt=Bt(f,De);(A.array.has(we)||br(wt)||xt&&!xt._f)&&!Zo(wt)?ct(De,wt,et):it(De,wt,et)}},Nt=(we,Ge,et={})=>{const Ct=Bt(f,we),wt=A.array.has(we),De=oi(Ge);Ks(N,we,De),wt?(U.array.next({name:we,values:oi(N)}),(z.isDirty||z.dirtyFields||q.isDirty||q.dirtyFields)&&et.shouldDirty&&U.state.next({name:we,dirtyFields:Vd(w,N),isDirty:tt(we,De)})):Ct&&!Ct._f&&!pi(De)?ct(we,De,et):it(we,De,et),r0(we,A)&&U.state.next({...x}),U.state.next({name:E.mount?we:void 0,values:oi(N)})},ft=async we=>{E.mount=!0;const Ge=we.target;let et=Ge.name,Ct=!0;const wt=Bt(f,et),De=qt=>{Ct=Number.isNaN(qt)||Zo(qt)&&isNaN(qt.getTime())||Qa(qt,Bt(N,et,qt))},xt=t0(u.mode),Jt=t0(u.reValidateMode);if(wt){let qt,vs;const sr=Ge.type?e0(wt._f):wS(we),Ls=we.type===Xy.BLUR||we.type===Xy.FOCUS_OUT,xi=!LS(wt._f)&&!u.resolver&&!Bt(x.errors,et)&&!wt._f.deps||OS(Ls,Bt(x.touchedFields,et),x.isSubmitted,Jt,xt),Wr=r0(et,A,Ls);Ks(N,et,sr),Ls?(wt._f.onBlur&&wt._f.onBlur(we),n&&n(0)):wt._f.onChange&&wt._f.onChange(we);const Dr=he(et,sr,Ls),yi=!Ci(Dr)||Wr;if(!Ls&&U.state.next({name:et,type:we.type,values:oi(N)}),xi)return(z.isValid||q.isValid)&&(u.mode==="onBlur"?Ls&&Z():Ls||Z()),yi&&U.state.next({name:et,...Wr?{}:Dr});if(!Ls&&Wr&&U.state.next({...x}),u.resolver){const{errors:Oi}=await Ae([et]);if(De(sr),Ct){const en=i0(x.errors,f,et),tn=i0(Oi,f,en.name||et);qt=tn.error,et=tn.name,vs=Ci(Oi)}}else J([et],!0),qt=(await a0(wt,A.disabled,N,W,u.shouldUseNativeValidation))[et],J([et]),De(sr),Ct&&(qt?vs=!1:(z.isValid||q.isValid)&&(vs=await Ie(f,!0)));Ct&&(wt._f.deps&&ht(wt._f.deps),Ce(et,vs,qt,Dr))}},Mt=(we,Ge)=>{if(Bt(x.errors,Ge)&&we.focus)return we.focus(),1},ht=async(we,Ge={})=>{let et,Ct;const wt=Hd(we);if(u.resolver){const De=await fe(Ar(we)?we:wt);et=Ci(De),Ct=we?!wt.some(xt=>Bt(De,xt)):et}else we?(Ct=(await Promise.all(wt.map(async De=>{const xt=Bt(f,De);return await Ie(xt&&xt._f?{[De]:xt}:xt)}))).every(Boolean),!(!Ct&&!x.isValid)&&Z()):Ct=et=await Ie(f);return U.state.next({...!$n(we)||(z.isValid||q.isValid)&&et!==x.isValid?{}:{name:we},...u.resolver||!we?{isValid:et}:{},errors:x.errors}),Ge.shouldFocus&&!Ct&&Xd(f,Mt,we?wt:A.mount),Ct},Os=we=>{const Ge={...E.mount?N:w};return Ar(we)?Ge:$n(we)?Bt(Ge,we):we.map(et=>Bt(Ge,et))},ns=(we,Ge)=>({invalid:!!Bt((Ge||x).errors,we),isDirty:!!Bt((Ge||x).dirtyFields,we),error:Bt((Ge||x).errors,we),isValidating:!!Bt(x.validatingFields,we),isTouched:!!Bt((Ge||x).touchedFields,we)}),_s=we=>{we&&Hd(we).forEach(Ge=>Or(x.errors,Ge)),U.state.next({errors:we?x.errors:{}})},pr=(we,Ge,et)=>{const Ct=(Bt(f,we,{_f:{}})._f||{}).ref,wt=Bt(x.errors,we)||{},{ref:De,message:xt,type:Jt,...qt}=wt;Ks(x.errors,we,{...qt,...Ge,ref:Ct}),U.state.next({name:we,errors:x.errors,isValid:!1}),et&&et.shouldFocus&&Ct&&Ct.focus&&Ct.focus()},Ut=(we,Ge)=>Nn(we)?U.state.subscribe({next:et=>we(je(void 0,Ge),et)}):je(we,Ge,!0),fr=we=>U.state.subscribe({next:Ge=>{zS(we.name,Ge.name,we.exact)&&RS(Ge,we.formState||z,Ir,we.reRenderRoot)&&we.callback({values:{...N},...x,...Ge})}}).unsubscribe,Fr=we=>(E.mount=!0,q={...q,...we.formState},fr({...we,formState:q})),jr=(we,Ge={})=>{for(const et of we?Hd(we):A.mount)A.mount.delete(et),A.array.delete(et),Ge.keepValue||(Or(f,et),Or(N,et)),!Ge.keepError&&Or(x.errors,et),!Ge.keepDirty&&Or(x.dirtyFields,et),!Ge.keepTouched&&Or(x.touchedFields,et),!Ge.keepIsValidating&&Or(x.validatingFields,et),!u.shouldUnregister&&!Ge.keepDefaultValue&&Or(w,et);U.state.next({values:oi(N)}),U.state.next({...x,...Ge.keepDirty?{isDirty:tt()}:{}}),!Ge.keepIsValid&&Z()},gr=({disabled:we,name:Ge})=>{(Vn(we)&&E.mount||we||A.disabled.has(Ge))&&(we?A.disabled.add(Ge):A.disabled.delete(Ge))},Br=(we,Ge={})=>{let et=Bt(f,we);const Ct=Vn(Ge.disabled)||Vn(u.disabled);return Ks(f,we,{...et||{},_f:{...et&&et._f?et._f:{ref:{name:we}},name:we,mount:!0,...Ge}}),A.mount.add(we),et?gr({disabled:Vn(Ge.disabled)?Ge.disabled:u.disabled,name:we}):Ne(we,!0,Ge.value),{...Ct?{disabled:Ge.disabled||u.disabled}:{},...u.progressive?{required:!!Ge.required,min:qd(Ge.min),max:qd(Ge.max),minLength:qd(Ge.minLength),maxLength:qd(Ge.maxLength),pattern:qd(Ge.pattern)}:{},name:we,onChange:ft,onBlur:ft,ref:wt=>{if(wt){Br(we,Ge),et=Bt(f,we);const De=Ar(wt.value)&&wt.querySelectorAll&&wt.querySelectorAll("input,select,textarea")[0]||wt,xt=AS(De),Jt=et._f.refs||[];if(xt?Jt.find(qt=>qt===De):De===et._f.ref)return;Ks(f,we,{_f:{...et._f,...xt?{refs:[...Jt.filter(ef),De,...Array.isArray(Bt(w,we))?[{}]:[]],ref:{type:De.type,name:we}}:{ref:De}}}),Ne(we,!1,void 0,De)}else et=Bt(f,we,{}),et._f&&(et._f.mount=!1),(u.shouldUnregister||Ge.shouldUnregister)&&!(NS(A.array,we)&&E.action)&&A.unMount.add(we)}}},_r=()=>u.shouldFocusError&&Xd(f,Mt,A.mount),Jr=we=>{Vn(we)&&(U.state.next({disabled:we}),Xd(f,(Ge,et)=>{const Ct=Bt(f,et);Ct&&(Ge.disabled=Ct._f.disabled||we,Array.isArray(Ct._f.refs)&&Ct._f.refs.forEach(wt=>{wt.disabled=Ct._f.disabled||we}))},0,!1))},Qt=(we,Ge)=>async et=>{let Ct;et&&(et.preventDefault&&et.preventDefault(),et.persist&&et.persist());let wt=oi(N);if(U.state.next({isSubmitting:!0}),u.resolver){const{errors:De,values:xt}=await Ae();x.errors=De,wt=xt}else await Ie(f);if(A.disabled.size)for(const De of A.disabled)Ks(wt,De,void 0);if(Or(x.errors,"root"),Ci(x.errors)){U.state.next({errors:{}});try{await we(wt,et)}catch(De){Ct=De}}else Ge&&await Ge({...x.errors},et),_r(),setTimeout(_r);if(U.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ci(x.errors)&&!Ct,submitCount:x.submitCount+1,errors:x.errors}),Ct)throw Ct},gi=(we,Ge={})=>{Bt(f,we)&&(Ar(Ge.defaultValue)?Nt(we,oi(Bt(w,we))):(Nt(we,Ge.defaultValue),Ks(w,we,oi(Ge.defaultValue))),Ge.keepTouched||Or(x.touchedFields,we),Ge.keepDirty||(Or(x.dirtyFields,we),x.isDirty=Ge.defaultValue?tt(we,oi(Bt(w,we))):tt()),Ge.keepError||(Or(x.errors,we),z.isValid&&Z()),U.state.next({...x}))},vr=(we,Ge={})=>{const et=we?oi(we):w,Ct=oi(et),wt=Ci(we),De=wt?w:Ct;if(Ge.keepDefaultValues||(w=et),!Ge.keepValues){if(Ge.keepDirtyValues){const xt=new Set([...A.mount,...Object.keys(Vd(w,N))]);for(const Jt of Array.from(xt))Bt(x.dirtyFields,Jt)?Ks(De,Jt,Bt(N,Jt)):Nt(Jt,Bt(De,Jt))}else{if($f&&Ar(we))for(const xt of A.mount){const Jt=Bt(f,xt);if(Jt&&Jt._f){const qt=Array.isArray(Jt._f.refs)?Jt._f.refs[0]:Jt._f.ref;if(Hh(qt)){const vs=qt.closest("form");if(vs){vs.reset();break}}}}for(const xt of A.mount)Nt(xt,Bt(De,xt))}N=oi(De),U.array.next({values:{...De}}),U.state.next({values:{...De}})}A={mount:Ge.keepDirtyValues?A.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},E.mount=!z.isValid||!!Ge.keepIsValid||!!Ge.keepDirtyValues,E.watch=!!u.shouldUnregister,U.state.next({submitCount:Ge.keepSubmitCount?x.submitCount:0,isDirty:wt?!1:Ge.keepDirty?x.isDirty:!!(Ge.keepDefaultValues&&!Qa(we,w)),isSubmitted:Ge.keepIsSubmitted?x.isSubmitted:!1,dirtyFields:wt?{}:Ge.keepDirtyValues?Ge.keepDefaultValues&&N?Vd(w,N):x.dirtyFields:Ge.keepDefaultValues&&we?Vd(w,we):Ge.keepDirty?x.dirtyFields:{},touchedFields:Ge.keepTouched?x.touchedFields:{},errors:Ge.keepErrors?x.errors:{},isSubmitSuccessful:Ge.keepIsSubmitSuccessful?x.isSubmitSuccessful:!1,isSubmitting:!1})},Mi=(we,Ge)=>vr(Nn(we)?we(N):we,Ge),As=(we,Ge={})=>{const et=Bt(f,we),Ct=et&&et._f;if(Ct){const wt=Ct.refs?Ct.refs[0]:Ct.ref;wt.focus&&(wt.focus(),Ge.shouldSelect&&Nn(wt.select)&&wt.select())}},Ir=we=>{x={...x,...we}},Zr={control:{register:Br,unregister:jr,getFieldState:ns,handleSubmit:Qt,setError:pr,_subscribe:fr,_runSchema:Ae,_focusError:_r,_getWatch:je,_getDirty:tt,_setValid:Z,_setFieldArray:de,_setDisabledField:gr,_setErrors:te,_getFieldArray:Pe,_reset:vr,_resetDefaultValues:()=>Nn(u.defaultValues)&&u.defaultValues().then(we=>{Mi(we,u.resetOptions),U.state.next({isLoading:!1})}),_removeUnmounted:Ee,_disableForm:Jr,_subjects:U,_proxyFormState:z,get _fields(){return f},get _formValues(){return N},get _state(){return E},set _state(we){E=we},get _defaultValues(){return w},get _names(){return A},set _names(we){A=we},get _formState(){return x},get _options(){return u},set _options(we){u={...u,...we}}},subscribe:Fr,trigger:ht,register:Br,handleSubmit:Qt,watch:Ut,setValue:Nt,getValues:Os,reset:Mi,resetField:gi,clearErrors:_s,unregister:jr,setError:pr,setFocus:As,getFieldState:ns};return{...Zr,formControl:Zr}}function Cn(c={}){const u=li.useRef(void 0),x=li.useRef(void 0),[f,w]=li.useState({isDirty:!1,isValidating:!1,isLoading:Nn(c.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:c.errors||{},disabled:c.disabled||!1,isReady:!1,defaultValues:Nn(c.defaultValues)?void 0:c.defaultValues});u.current||(u.current={...c.formControl?c.formControl:VS(c),formState:f},c.formControl&&c.defaultValues&&!Nn(c.defaultValues)&&c.formControl.reset(c.defaultValues,c.resetOptions));const N=u.current.control;return N._options=c,ES(()=>{const E=N._subscribe({formState:N._proxyFormState,callback:()=>w({...N._formState}),reRenderRoot:!0});return w(A=>({...A,isReady:!0})),N._formState.isReady=!0,E},[N]),li.useEffect(()=>N._disableForm(c.disabled),[N,c.disabled]),li.useEffect(()=>{c.mode&&(N._options.mode=c.mode),c.reValidateMode&&(N._options.reValidateMode=c.reValidateMode)},[N,c.mode,c.reValidateMode]),li.useEffect(()=>{c.errors&&(N._setErrors(c.errors),N._focusError())},[N,c.errors]),li.useEffect(()=>{c.shouldUnregister&&N._subjects.state.next({values:N._getWatch()})},[N,c.shouldUnregister]),li.useEffect(()=>{if(N._proxyFormState.isDirty){const E=N._getDirty();E!==f.isDirty&&N._subjects.state.next({isDirty:E})}},[N,f.isDirty]),li.useEffect(()=>{c.values&&!Qa(c.values,x.current)?(N._reset(c.values,N._options.resetOptions),x.current=c.values,w(E=>({...E}))):N._resetDefaultValues()},[N,c.values]),li.useEffect(()=>{N._state.mount||(N._setValid(),N._state.mount=!0),N._state.watch&&(N._state.watch=!1,N._subjects.state.next({...N._formState})),N._removeUnmounted()}),u.current.formState=TS(f,N),u.current}function D_(c,u){return function(){return c.apply(u,arguments)}}const{toString:qS}=Object.prototype,{getPrototypeOf:Hf}=Object,{iterator:dm,toStringTag:L_}=Symbol,um=(c=>u=>{const x=qS.call(u);return c[x]||(c[x]=x.slice(8,-1).toLowerCase())})(Object.create(null)),kn=c=>(c=c.toLowerCase(),u=>um(u)===c),hm=c=>u=>typeof u===c,{isArray:oc}=Array,Jd=hm("undefined");function $S(c){return c!==null&&!Jd(c)&&c.constructor!==null&&!Jd(c.constructor)&&ki(c.constructor.isBuffer)&&c.constructor.isBuffer(c)}const R_=kn("ArrayBuffer");function GS(c){let u;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?u=ArrayBuffer.isView(c):u=c&&c.buffer&&R_(c.buffer),u}const ZS=hm("string"),ki=hm("function"),z_=hm("number"),mm=c=>c!==null&&typeof c=="object",WS=c=>c===!0||c===!1,zh=c=>{if(um(c)!=="object")return!1;const u=Hf(c);return(u===null||u===Object.prototype||Object.getPrototypeOf(u)===null)&&!(L_ in c)&&!(dm in c)},HS=kn("Date"),XS=kn("File"),KS=kn("Blob"),QS=kn("FileList"),JS=c=>mm(c)&&ki(c.pipe),YS=c=>{let u;return c&&(typeof FormData=="function"&&c instanceof FormData||ki(c.append)&&((u=um(c))==="formdata"||u==="object"&&ki(c.toString)&&c.toString()==="[object FormData]"))},eT=kn("URLSearchParams"),[tT,sT,rT,iT]=["ReadableStream","Request","Response","Headers"].map(kn),nT=c=>c.trim?c.trim():c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ru(c,u,{allOwnKeys:x=!1}={}){if(c===null||typeof c>"u")return;let f,w;if(typeof c!="object"&&(c=[c]),oc(c))for(f=0,w=c.length;f<w;f++)u.call(null,c[f],f,c);else{const N=x?Object.getOwnPropertyNames(c):Object.keys(c),E=N.length;let A;for(f=0;f<E;f++)A=N[f],u.call(null,c[A],A,c)}}function O_(c,u){u=u.toLowerCase();const x=Object.keys(c);let f=x.length,w;for(;f-- >0;)if(w=x[f],u===w.toLowerCase())return w;return null}const Wo=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,F_=c=>!Jd(c)&&c!==Wo;function Sf(){const{caseless:c}=F_(this)&&this||{},u={},x=(f,w)=>{const N=c&&O_(u,w)||w;zh(u[N])&&zh(f)?u[N]=Sf(u[N],f):zh(f)?u[N]=Sf({},f):oc(f)?u[N]=f.slice():u[N]=f};for(let f=0,w=arguments.length;f<w;f++)arguments[f]&&ru(arguments[f],x);return u}const aT=(c,u,x,{allOwnKeys:f}={})=>(ru(u,(w,N)=>{x&&ki(w)?c[N]=D_(w,x):c[N]=w},{allOwnKeys:f}),c),oT=c=>(c.charCodeAt(0)===65279&&(c=c.slice(1)),c),lT=(c,u,x,f)=>{c.prototype=Object.create(u.prototype,f),c.prototype.constructor=c,Object.defineProperty(c,"super",{value:u.prototype}),x&&Object.assign(c.prototype,x)},cT=(c,u,x,f)=>{let w,N,E;const A={};if(u=u||{},c==null)return u;do{for(w=Object.getOwnPropertyNames(c),N=w.length;N-- >0;)E=w[N],(!f||f(E,c,u))&&!A[E]&&(u[E]=c[E],A[E]=!0);c=x!==!1&&Hf(c)}while(c&&(!x||x(c,u))&&c!==Object.prototype);return u},dT=(c,u,x)=>{c=String(c),(x===void 0||x>c.length)&&(x=c.length),x-=u.length;const f=c.indexOf(u,x);return f!==-1&&f===x},uT=c=>{if(!c)return null;if(oc(c))return c;let u=c.length;if(!z_(u))return null;const x=new Array(u);for(;u-- >0;)x[u]=c[u];return x},hT=(c=>u=>c&&u instanceof c)(typeof Uint8Array<"u"&&Hf(Uint8Array)),mT=(c,u)=>{const f=(c&&c[dm]).call(c);let w;for(;(w=f.next())&&!w.done;){const N=w.value;u.call(c,N[0],N[1])}},pT=(c,u)=>{let x;const f=[];for(;(x=c.exec(u))!==null;)f.push(x);return f},fT=kn("HTMLFormElement"),gT=c=>c.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(x,f,w){return f.toUpperCase()+w}),o0=(({hasOwnProperty:c})=>(u,x)=>c.call(u,x))(Object.prototype),xT=kn("RegExp"),B_=(c,u)=>{const x=Object.getOwnPropertyDescriptors(c),f={};ru(x,(w,N)=>{let E;(E=u(w,N,c))!==!1&&(f[N]=E||w)}),Object.defineProperties(c,f)},yT=c=>{B_(c,(u,x)=>{if(ki(c)&&["arguments","caller","callee"].indexOf(x)!==-1)return!1;const f=c[x];if(ki(f)){if(u.enumerable=!1,"writable"in u){u.writable=!1;return}u.set||(u.set=()=>{throw Error("Can not rewrite read-only method '"+x+"'")})}})},_T=(c,u)=>{const x={},f=w=>{w.forEach(N=>{x[N]=!0})};return oc(c)?f(c):f(String(c).split(u)),x},vT=()=>{},bT=(c,u)=>c!=null&&Number.isFinite(c=+c)?c:u;function wT(c){return!!(c&&ki(c.append)&&c[L_]==="FormData"&&c[dm])}const jT=c=>{const u=new Array(10),x=(f,w)=>{if(mm(f)){if(u.indexOf(f)>=0)return;if(!("toJSON"in f)){u[w]=f;const N=oc(f)?[]:{};return ru(f,(E,A)=>{const n=x(E,w+1);!Jd(n)&&(N[A]=n)}),u[w]=void 0,N}}return f};return x(c,0)},NT=kn("AsyncFunction"),ST=c=>c&&(mm(c)||ki(c))&&ki(c.then)&&ki(c.catch),U_=((c,u)=>c?setImmediate:u?((x,f)=>(Wo.addEventListener("message",({source:w,data:N})=>{w===Wo&&N===x&&f.length&&f.shift()()},!1),w=>{f.push(w),Wo.postMessage(x,"*")}))(`axios@${Math.random()}`,[]):x=>setTimeout(x))(typeof setImmediate=="function",ki(Wo.postMessage)),TT=typeof queueMicrotask<"u"?queueMicrotask.bind(Wo):typeof process<"u"&&process.nextTick||U_,ET=c=>c!=null&&ki(c[dm]),Ke={isArray:oc,isArrayBuffer:R_,isBuffer:$S,isFormData:YS,isArrayBufferView:GS,isString:ZS,isNumber:z_,isBoolean:WS,isObject:mm,isPlainObject:zh,isReadableStream:tT,isRequest:sT,isResponse:rT,isHeaders:iT,isUndefined:Jd,isDate:HS,isFile:XS,isBlob:KS,isRegExp:xT,isFunction:ki,isStream:JS,isURLSearchParams:eT,isTypedArray:hT,isFileList:QS,forEach:ru,merge:Sf,extend:aT,trim:nT,stripBOM:oT,inherits:lT,toFlatObject:cT,kindOf:um,kindOfTest:kn,endsWith:dT,toArray:uT,forEachEntry:mT,matchAll:pT,isHTMLForm:fT,hasOwnProperty:o0,hasOwnProp:o0,reduceDescriptors:B_,freezeMethods:yT,toObjectSet:_T,toCamelCase:gT,noop:vT,toFiniteNumber:bT,findKey:O_,global:Wo,isContextDefined:F_,isSpecCompliantForm:wT,toJSONObject:jT,isAsyncFn:NT,isThenable:ST,setImmediate:U_,asap:TT,isIterable:ET};function cs(c,u,x,f,w){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=c,this.name="AxiosError",u&&(this.code=u),x&&(this.config=x),f&&(this.request=f),w&&(this.response=w,this.status=w.status?w.status:null)}Ke.inherits(cs,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ke.toJSONObject(this.config),code:this.code,status:this.status}}});const V_=cs.prototype,q_={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(c=>{q_[c]={value:c}});Object.defineProperties(cs,q_);Object.defineProperty(V_,"isAxiosError",{value:!0});cs.from=(c,u,x,f,w,N)=>{const E=Object.create(V_);return Ke.toFlatObject(c,E,function(n){return n!==Error.prototype},A=>A!=="isAxiosError"),cs.call(E,c.message,u,x,f,w),E.cause=c,E.name=c.name,N&&Object.assign(E,N),E};const CT=null;function Tf(c){return Ke.isPlainObject(c)||Ke.isArray(c)}function $_(c){return Ke.endsWith(c,"[]")?c.slice(0,-2):c}function l0(c,u,x){return c?c.concat(u).map(function(w,N){return w=$_(w),!x&&N?"["+w+"]":w}).join(x?".":""):u}function kT(c){return Ke.isArray(c)&&!c.some(Tf)}const AT=Ke.toFlatObject(Ke,{},null,function(u){return/^is[A-Z]/.test(u)});function pm(c,u,x){if(!Ke.isObject(c))throw new TypeError("target must be an object");u=u||new FormData,x=Ke.toFlatObject(x,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Z,J){return!Ke.isUndefined(J[Z])});const f=x.metaTokens,w=x.visitor||z,N=x.dots,E=x.indexes,n=(x.Blob||typeof Blob<"u"&&Blob)&&Ke.isSpecCompliantForm(u);if(!Ke.isFunction(w))throw new TypeError("visitor must be a function");function P(X){if(X===null)return"";if(Ke.isDate(X))return X.toISOString();if(Ke.isBoolean(X))return X.toString();if(!n&&Ke.isBlob(X))throw new cs("Blob is not supported. Use a Buffer instead.");return Ke.isArrayBuffer(X)||Ke.isTypedArray(X)?n&&typeof Blob=="function"?new Blob([X]):Buffer.from(X):X}function z(X,Z,J){let de=X;if(X&&!J&&typeof X=="object"){if(Ke.endsWith(Z,"{}"))Z=f?Z:Z.slice(0,-2),X=JSON.stringify(X);else if(Ke.isArray(X)&&kT(X)||(Ke.isFileList(X)||Ke.endsWith(Z,"[]"))&&(de=Ke.toArray(X)))return Z=$_(Z),de.forEach(function(te,Ne){!(Ke.isUndefined(te)||te===null)&&u.append(E===!0?l0([Z],Ne,N):E===null?Z:Z+"[]",P(te))}),!1}return Tf(X)?!0:(u.append(l0(J,Z,N),P(X)),!1)}const q=[],U=Object.assign(AT,{defaultVisitor:z,convertValue:P,isVisitable:Tf});function W(X,Z){if(!Ke.isUndefined(X)){if(q.indexOf(X)!==-1)throw Error("Circular reference detected in "+Z.join("."));q.push(X),Ke.forEach(X,function(de,ne){(!(Ke.isUndefined(de)||de===null)&&w.call(u,de,Ke.isString(ne)?ne.trim():ne,Z,U))===!0&&W(de,Z?Z.concat(ne):[ne])}),q.pop()}}if(!Ke.isObject(c))throw new TypeError("data must be an object");return W(c),u}function c0(c){const u={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(c).replace(/[!'()~]|%20|%00/g,function(f){return u[f]})}function Xf(c,u){this._pairs=[],c&&pm(c,this,u)}const G_=Xf.prototype;G_.append=function(u,x){this._pairs.push([u,x])};G_.toString=function(u){const x=u?function(f){return u.call(this,f,c0)}:c0;return this._pairs.map(function(w){return x(w[0])+"="+x(w[1])},"").join("&")};function MT(c){return encodeURIComponent(c).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Z_(c,u,x){if(!u)return c;const f=x&&x.encode||MT;Ke.isFunction(x)&&(x={serialize:x});const w=x&&x.serialize;let N;if(w?N=w(u,x):N=Ke.isURLSearchParams(u)?u.toString():new Xf(u,x).toString(f),N){const E=c.indexOf("#");E!==-1&&(c=c.slice(0,E)),c+=(c.indexOf("?")===-1?"?":"&")+N}return c}class d0{constructor(){this.handlers=[]}use(u,x,f){return this.handlers.push({fulfilled:u,rejected:x,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(u){this.handlers[u]&&(this.handlers[u]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(u){Ke.forEach(this.handlers,function(f){f!==null&&u(f)})}}const W_={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},PT=typeof URLSearchParams<"u"?URLSearchParams:Xf,IT=typeof FormData<"u"?FormData:null,DT=typeof Blob<"u"?Blob:null,LT={isBrowser:!0,classes:{URLSearchParams:PT,FormData:IT,Blob:DT},protocols:["http","https","file","blob","url","data"]},Kf=typeof window<"u"&&typeof document<"u",Ef=typeof navigator=="object"&&navigator||void 0,RT=Kf&&(!Ef||["ReactNative","NativeScript","NS"].indexOf(Ef.product)<0),zT=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",OT=Kf&&window.location.href||"http://localhost",FT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Kf,hasStandardBrowserEnv:RT,hasStandardBrowserWebWorkerEnv:zT,navigator:Ef,origin:OT},Symbol.toStringTag,{value:"Module"})),ci={...FT,...LT};function BT(c,u){return pm(c,new ci.classes.URLSearchParams,Object.assign({visitor:function(x,f,w,N){return ci.isNode&&Ke.isBuffer(x)?(this.append(f,x.toString("base64")),!1):N.defaultVisitor.apply(this,arguments)}},u))}function UT(c){return Ke.matchAll(/\w+|\[(\w*)]/g,c).map(u=>u[0]==="[]"?"":u[1]||u[0])}function VT(c){const u={},x=Object.keys(c);let f;const w=x.length;let N;for(f=0;f<w;f++)N=x[f],u[N]=c[N];return u}function H_(c){function u(x,f,w,N){let E=x[N++];if(E==="__proto__")return!0;const A=Number.isFinite(+E),n=N>=x.length;return E=!E&&Ke.isArray(w)?w.length:E,n?(Ke.hasOwnProp(w,E)?w[E]=[w[E],f]:w[E]=f,!A):((!w[E]||!Ke.isObject(w[E]))&&(w[E]=[]),u(x,f,w[E],N)&&Ke.isArray(w[E])&&(w[E]=VT(w[E])),!A)}if(Ke.isFormData(c)&&Ke.isFunction(c.entries)){const x={};return Ke.forEachEntry(c,(f,w)=>{u(UT(f),w,x,0)}),x}return null}function qT(c,u,x){if(Ke.isString(c))try{return(u||JSON.parse)(c),Ke.trim(c)}catch(f){if(f.name!=="SyntaxError")throw f}return(0,JSON.stringify)(c)}const iu={transitional:W_,adapter:["xhr","http","fetch"],transformRequest:[function(u,x){const f=x.getContentType()||"",w=f.indexOf("application/json")>-1,N=Ke.isObject(u);if(N&&Ke.isHTMLForm(u)&&(u=new FormData(u)),Ke.isFormData(u))return w?JSON.stringify(H_(u)):u;if(Ke.isArrayBuffer(u)||Ke.isBuffer(u)||Ke.isStream(u)||Ke.isFile(u)||Ke.isBlob(u)||Ke.isReadableStream(u))return u;if(Ke.isArrayBufferView(u))return u.buffer;if(Ke.isURLSearchParams(u))return x.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),u.toString();let A;if(N){if(f.indexOf("application/x-www-form-urlencoded")>-1)return BT(u,this.formSerializer).toString();if((A=Ke.isFileList(u))||f.indexOf("multipart/form-data")>-1){const n=this.env&&this.env.FormData;return pm(A?{"files[]":u}:u,n&&new n,this.formSerializer)}}return N||w?(x.setContentType("application/json",!1),qT(u)):u}],transformResponse:[function(u){const x=this.transitional||iu.transitional,f=x&&x.forcedJSONParsing,w=this.responseType==="json";if(Ke.isResponse(u)||Ke.isReadableStream(u))return u;if(u&&Ke.isString(u)&&(f&&!this.responseType||w)){const E=!(x&&x.silentJSONParsing)&&w;try{return JSON.parse(u)}catch(A){if(E)throw A.name==="SyntaxError"?cs.from(A,cs.ERR_BAD_RESPONSE,this,null,this.response):A}}return u}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ci.classes.FormData,Blob:ci.classes.Blob},validateStatus:function(u){return u>=200&&u<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ke.forEach(["delete","get","head","post","put","patch"],c=>{iu.headers[c]={}});const $T=Ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),GT=c=>{const u={};let x,f,w;return c&&c.split(`
`).forEach(function(E){w=E.indexOf(":"),x=E.substring(0,w).trim().toLowerCase(),f=E.substring(w+1).trim(),!(!x||u[x]&&$T[x])&&(x==="set-cookie"?u[x]?u[x].push(f):u[x]=[f]:u[x]=u[x]?u[x]+", "+f:f)}),u},u0=Symbol("internals");function $d(c){return c&&String(c).trim().toLowerCase()}function Oh(c){return c===!1||c==null?c:Ke.isArray(c)?c.map(Oh):String(c)}function ZT(c){const u=Object.create(null),x=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=x.exec(c);)u[f[1]]=f[2];return u}const WT=c=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(c.trim());function tf(c,u,x,f,w){if(Ke.isFunction(f))return f.call(this,u,x);if(w&&(u=x),!!Ke.isString(u)){if(Ke.isString(f))return u.indexOf(f)!==-1;if(Ke.isRegExp(f))return f.test(u)}}function HT(c){return c.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(u,x,f)=>x.toUpperCase()+f)}function XT(c,u){const x=Ke.toCamelCase(" "+u);["get","set","has"].forEach(f=>{Object.defineProperty(c,f+x,{value:function(w,N,E){return this[f].call(this,u,w,N,E)},configurable:!0})})}class Ai{constructor(u){u&&this.set(u)}set(u,x,f){const w=this;function N(A,n,P){const z=$d(n);if(!z)throw new Error("header name must be a non-empty string");const q=Ke.findKey(w,z);(!q||w[q]===void 0||P===!0||P===void 0&&w[q]!==!1)&&(w[q||n]=Oh(A))}const E=(A,n)=>Ke.forEach(A,(P,z)=>N(P,z,n));if(Ke.isPlainObject(u)||u instanceof this.constructor)E(u,x);else if(Ke.isString(u)&&(u=u.trim())&&!WT(u))E(GT(u),x);else if(Ke.isObject(u)&&Ke.isIterable(u)){let A={},n,P;for(const z of u){if(!Ke.isArray(z))throw TypeError("Object iterator must return a key-value pair");A[P=z[0]]=(n=A[P])?Ke.isArray(n)?[...n,z[1]]:[n,z[1]]:z[1]}E(A,x)}else u!=null&&N(x,u,f);return this}get(u,x){if(u=$d(u),u){const f=Ke.findKey(this,u);if(f){const w=this[f];if(!x)return w;if(x===!0)return ZT(w);if(Ke.isFunction(x))return x.call(this,w,f);if(Ke.isRegExp(x))return x.exec(w);throw new TypeError("parser must be boolean|regexp|function")}}}has(u,x){if(u=$d(u),u){const f=Ke.findKey(this,u);return!!(f&&this[f]!==void 0&&(!x||tf(this,this[f],f,x)))}return!1}delete(u,x){const f=this;let w=!1;function N(E){if(E=$d(E),E){const A=Ke.findKey(f,E);A&&(!x||tf(f,f[A],A,x))&&(delete f[A],w=!0)}}return Ke.isArray(u)?u.forEach(N):N(u),w}clear(u){const x=Object.keys(this);let f=x.length,w=!1;for(;f--;){const N=x[f];(!u||tf(this,this[N],N,u,!0))&&(delete this[N],w=!0)}return w}normalize(u){const x=this,f={};return Ke.forEach(this,(w,N)=>{const E=Ke.findKey(f,N);if(E){x[E]=Oh(w),delete x[N];return}const A=u?HT(N):String(N).trim();A!==N&&delete x[N],x[A]=Oh(w),f[A]=!0}),this}concat(...u){return this.constructor.concat(this,...u)}toJSON(u){const x=Object.create(null);return Ke.forEach(this,(f,w)=>{f!=null&&f!==!1&&(x[w]=u&&Ke.isArray(f)?f.join(", "):f)}),x}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([u,x])=>u+": "+x).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(u){return u instanceof this?u:new this(u)}static concat(u,...x){const f=new this(u);return x.forEach(w=>f.set(w)),f}static accessor(u){const f=(this[u0]=this[u0]={accessors:{}}).accessors,w=this.prototype;function N(E){const A=$d(E);f[A]||(XT(w,E),f[A]=!0)}return Ke.isArray(u)?u.forEach(N):N(u),this}}Ai.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ke.reduceDescriptors(Ai.prototype,({value:c},u)=>{let x=u[0].toUpperCase()+u.slice(1);return{get:()=>c,set(f){this[x]=f}}});Ke.freezeMethods(Ai);function sf(c,u){const x=this||iu,f=u||x,w=Ai.from(f.headers);let N=f.data;return Ke.forEach(c,function(A){N=A.call(x,N,w.normalize(),u?u.status:void 0)}),w.normalize(),N}function X_(c){return!!(c&&c.__CANCEL__)}function lc(c,u,x){cs.call(this,c??"canceled",cs.ERR_CANCELED,u,x),this.name="CanceledError"}Ke.inherits(lc,cs,{__CANCEL__:!0});function K_(c,u,x){const f=x.config.validateStatus;!x.status||!f||f(x.status)?c(x):u(new cs("Request failed with status code "+x.status,[cs.ERR_BAD_REQUEST,cs.ERR_BAD_RESPONSE][Math.floor(x.status/100)-4],x.config,x.request,x))}function KT(c){const u=/^([-+\w]{1,25})(:?\/\/|:)/.exec(c);return u&&u[1]||""}function QT(c,u){c=c||10;const x=new Array(c),f=new Array(c);let w=0,N=0,E;return u=u!==void 0?u:1e3,function(n){const P=Date.now(),z=f[N];E||(E=P),x[w]=n,f[w]=P;let q=N,U=0;for(;q!==w;)U+=x[q++],q=q%c;if(w=(w+1)%c,w===N&&(N=(N+1)%c),P-E<u)return;const W=z&&P-z;return W?Math.round(U*1e3/W):void 0}}function JT(c,u){let x=0,f=1e3/u,w,N;const E=(P,z=Date.now())=>{x=z,w=null,N&&(clearTimeout(N),N=null),c.apply(null,P)};return[(...P)=>{const z=Date.now(),q=z-x;q>=f?E(P,z):(w=P,N||(N=setTimeout(()=>{N=null,E(w)},f-q)))},()=>w&&E(w)]}const Qh=(c,u,x=3)=>{let f=0;const w=QT(50,250);return JT(N=>{const E=N.loaded,A=N.lengthComputable?N.total:void 0,n=E-f,P=w(n),z=E<=A;f=E;const q={loaded:E,total:A,progress:A?E/A:void 0,bytes:n,rate:P||void 0,estimated:P&&A&&z?(A-E)/P:void 0,event:N,lengthComputable:A!=null,[u?"download":"upload"]:!0};c(q)},x)},h0=(c,u)=>{const x=c!=null;return[f=>u[0]({lengthComputable:x,total:c,loaded:f}),u[1]]},m0=c=>(...u)=>Ke.asap(()=>c(...u)),YT=ci.hasStandardBrowserEnv?((c,u)=>x=>(x=new URL(x,ci.origin),c.protocol===x.protocol&&c.host===x.host&&(u||c.port===x.port)))(new URL(ci.origin),ci.navigator&&/(msie|trident)/i.test(ci.navigator.userAgent)):()=>!0,eE=ci.hasStandardBrowserEnv?{write(c,u,x,f,w,N){const E=[c+"="+encodeURIComponent(u)];Ke.isNumber(x)&&E.push("expires="+new Date(x).toGMTString()),Ke.isString(f)&&E.push("path="+f),Ke.isString(w)&&E.push("domain="+w),N===!0&&E.push("secure"),document.cookie=E.join("; ")},read(c){const u=document.cookie.match(new RegExp("(^|;\\s*)("+c+")=([^;]*)"));return u?decodeURIComponent(u[3]):null},remove(c){this.write(c,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function tE(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}function sE(c,u){return u?c.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):c}function Q_(c,u,x){let f=!tE(u);return c&&(f||x==!1)?sE(c,u):u}const p0=c=>c instanceof Ai?{...c}:c;function Ko(c,u){u=u||{};const x={};function f(P,z,q,U){return Ke.isPlainObject(P)&&Ke.isPlainObject(z)?Ke.merge.call({caseless:U},P,z):Ke.isPlainObject(z)?Ke.merge({},z):Ke.isArray(z)?z.slice():z}function w(P,z,q,U){if(Ke.isUndefined(z)){if(!Ke.isUndefined(P))return f(void 0,P,q,U)}else return f(P,z,q,U)}function N(P,z){if(!Ke.isUndefined(z))return f(void 0,z)}function E(P,z){if(Ke.isUndefined(z)){if(!Ke.isUndefined(P))return f(void 0,P)}else return f(void 0,z)}function A(P,z,q){if(q in u)return f(P,z);if(q in c)return f(void 0,P)}const n={url:N,method:N,data:N,baseURL:E,transformRequest:E,transformResponse:E,paramsSerializer:E,timeout:E,timeoutMessage:E,withCredentials:E,withXSRFToken:E,adapter:E,responseType:E,xsrfCookieName:E,xsrfHeaderName:E,onUploadProgress:E,onDownloadProgress:E,decompress:E,maxContentLength:E,maxBodyLength:E,beforeRedirect:E,transport:E,httpAgent:E,httpsAgent:E,cancelToken:E,socketPath:E,responseEncoding:E,validateStatus:A,headers:(P,z,q)=>w(p0(P),p0(z),q,!0)};return Ke.forEach(Object.keys(Object.assign({},c,u)),function(z){const q=n[z]||w,U=q(c[z],u[z],z);Ke.isUndefined(U)&&q!==A||(x[z]=U)}),x}const J_=c=>{const u=Ko({},c);let{data:x,withXSRFToken:f,xsrfHeaderName:w,xsrfCookieName:N,headers:E,auth:A}=u;u.headers=E=Ai.from(E),u.url=Z_(Q_(u.baseURL,u.url,u.allowAbsoluteUrls),c.params,c.paramsSerializer),A&&E.set("Authorization","Basic "+btoa((A.username||"")+":"+(A.password?unescape(encodeURIComponent(A.password)):"")));let n;if(Ke.isFormData(x)){if(ci.hasStandardBrowserEnv||ci.hasStandardBrowserWebWorkerEnv)E.setContentType(void 0);else if((n=E.getContentType())!==!1){const[P,...z]=n?n.split(";").map(q=>q.trim()).filter(Boolean):[];E.setContentType([P||"multipart/form-data",...z].join("; "))}}if(ci.hasStandardBrowserEnv&&(f&&Ke.isFunction(f)&&(f=f(u)),f||f!==!1&&YT(u.url))){const P=w&&N&&eE.read(N);P&&E.set(w,P)}return u},rE=typeof XMLHttpRequest<"u",iE=rE&&function(c){return new Promise(function(x,f){const w=J_(c);let N=w.data;const E=Ai.from(w.headers).normalize();let{responseType:A,onUploadProgress:n,onDownloadProgress:P}=w,z,q,U,W,X;function Z(){W&&W(),X&&X(),w.cancelToken&&w.cancelToken.unsubscribe(z),w.signal&&w.signal.removeEventListener("abort",z)}let J=new XMLHttpRequest;J.open(w.method.toUpperCase(),w.url,!0),J.timeout=w.timeout;function de(){if(!J)return;const te=Ai.from("getAllResponseHeaders"in J&&J.getAllResponseHeaders()),he={data:!A||A==="text"||A==="json"?J.responseText:J.response,status:J.status,statusText:J.statusText,headers:te,config:c,request:J};K_(function(Ae){x(Ae),Z()},function(Ae){f(Ae),Z()},he),J=null}"onloadend"in J?J.onloadend=de:J.onreadystatechange=function(){!J||J.readyState!==4||J.status===0&&!(J.responseURL&&J.responseURL.indexOf("file:")===0)||setTimeout(de)},J.onabort=function(){J&&(f(new cs("Request aborted",cs.ECONNABORTED,c,J)),J=null)},J.onerror=function(){f(new cs("Network Error",cs.ERR_NETWORK,c,J)),J=null},J.ontimeout=function(){let Ne=w.timeout?"timeout of "+w.timeout+"ms exceeded":"timeout exceeded";const he=w.transitional||W_;w.timeoutErrorMessage&&(Ne=w.timeoutErrorMessage),f(new cs(Ne,he.clarifyTimeoutError?cs.ETIMEDOUT:cs.ECONNABORTED,c,J)),J=null},N===void 0&&E.setContentType(null),"setRequestHeader"in J&&Ke.forEach(E.toJSON(),function(Ne,he){J.setRequestHeader(he,Ne)}),Ke.isUndefined(w.withCredentials)||(J.withCredentials=!!w.withCredentials),A&&A!=="json"&&(J.responseType=w.responseType),P&&([U,X]=Qh(P,!0),J.addEventListener("progress",U)),n&&J.upload&&([q,W]=Qh(n),J.upload.addEventListener("progress",q),J.upload.addEventListener("loadend",W)),(w.cancelToken||w.signal)&&(z=te=>{J&&(f(!te||te.type?new lc(null,c,J):te),J.abort(),J=null)},w.cancelToken&&w.cancelToken.subscribe(z),w.signal&&(w.signal.aborted?z():w.signal.addEventListener("abort",z)));const ne=KT(w.url);if(ne&&ci.protocols.indexOf(ne)===-1){f(new cs("Unsupported protocol "+ne+":",cs.ERR_BAD_REQUEST,c));return}J.send(N||null)})},nE=(c,u)=>{const{length:x}=c=c?c.filter(Boolean):[];if(u||x){let f=new AbortController,w;const N=function(P){if(!w){w=!0,A();const z=P instanceof Error?P:this.reason;f.abort(z instanceof cs?z:new lc(z instanceof Error?z.message:z))}};let E=u&&setTimeout(()=>{E=null,N(new cs(`timeout ${u} of ms exceeded`,cs.ETIMEDOUT))},u);const A=()=>{c&&(E&&clearTimeout(E),E=null,c.forEach(P=>{P.unsubscribe?P.unsubscribe(N):P.removeEventListener("abort",N)}),c=null)};c.forEach(P=>P.addEventListener("abort",N));const{signal:n}=f;return n.unsubscribe=()=>Ke.asap(A),n}},aE=function*(c,u){let x=c.byteLength;if(x<u){yield c;return}let f=0,w;for(;f<x;)w=f+u,yield c.slice(f,w),f=w},oE=async function*(c,u){for await(const x of lE(c))yield*aE(x,u)},lE=async function*(c){if(c[Symbol.asyncIterator]){yield*c;return}const u=c.getReader();try{for(;;){const{done:x,value:f}=await u.read();if(x)break;yield f}}finally{await u.cancel()}},f0=(c,u,x,f)=>{const w=oE(c,u);let N=0,E,A=n=>{E||(E=!0,f&&f(n))};return new ReadableStream({async pull(n){try{const{done:P,value:z}=await w.next();if(P){A(),n.close();return}let q=z.byteLength;if(x){let U=N+=q;x(U)}n.enqueue(new Uint8Array(z))}catch(P){throw A(P),P}},cancel(n){return A(n),w.return()}},{highWaterMark:2})},fm=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Y_=fm&&typeof ReadableStream=="function",cE=fm&&(typeof TextEncoder=="function"?(c=>u=>c.encode(u))(new TextEncoder):async c=>new Uint8Array(await new Response(c).arrayBuffer())),ev=(c,...u)=>{try{return!!c(...u)}catch{return!1}},dE=Y_&&ev(()=>{let c=!1;const u=new Request(ci.origin,{body:new ReadableStream,method:"POST",get duplex(){return c=!0,"half"}}).headers.has("Content-Type");return c&&!u}),g0=64*1024,Cf=Y_&&ev(()=>Ke.isReadableStream(new Response("").body)),Jh={stream:Cf&&(c=>c.body)};fm&&(c=>{["text","arrayBuffer","blob","formData","stream"].forEach(u=>{!Jh[u]&&(Jh[u]=Ke.isFunction(c[u])?x=>x[u]():(x,f)=>{throw new cs(`Response type '${u}' is not supported`,cs.ERR_NOT_SUPPORT,f)})})})(new Response);const uE=async c=>{if(c==null)return 0;if(Ke.isBlob(c))return c.size;if(Ke.isSpecCompliantForm(c))return(await new Request(ci.origin,{method:"POST",body:c}).arrayBuffer()).byteLength;if(Ke.isArrayBufferView(c)||Ke.isArrayBuffer(c))return c.byteLength;if(Ke.isURLSearchParams(c)&&(c=c+""),Ke.isString(c))return(await cE(c)).byteLength},hE=async(c,u)=>{const x=Ke.toFiniteNumber(c.getContentLength());return x??uE(u)},mE=fm&&(async c=>{let{url:u,method:x,data:f,signal:w,cancelToken:N,timeout:E,onDownloadProgress:A,onUploadProgress:n,responseType:P,headers:z,withCredentials:q="same-origin",fetchOptions:U}=J_(c);P=P?(P+"").toLowerCase():"text";let W=nE([w,N&&N.toAbortSignal()],E),X;const Z=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let J;try{if(n&&dE&&x!=="get"&&x!=="head"&&(J=await hE(z,f))!==0){let he=new Request(u,{method:"POST",body:f,duplex:"half"}),Ce;if(Ke.isFormData(f)&&(Ce=he.headers.get("content-type"))&&z.setContentType(Ce),he.body){const[Ae,fe]=h0(J,Qh(m0(n)));f=f0(he.body,g0,Ae,fe)}}Ke.isString(q)||(q=q?"include":"omit");const de="credentials"in Request.prototype;X=new Request(u,{...U,signal:W,method:x.toUpperCase(),headers:z.normalize().toJSON(),body:f,duplex:"half",credentials:de?q:void 0});let ne=await fetch(X,U);const te=Cf&&(P==="stream"||P==="response");if(Cf&&(A||te&&Z)){const he={};["status","statusText","headers"].forEach(Ie=>{he[Ie]=ne[Ie]});const Ce=Ke.toFiniteNumber(ne.headers.get("content-length")),[Ae,fe]=A&&h0(Ce,Qh(m0(A),!0))||[];ne=new Response(f0(ne.body,g0,Ae,()=>{fe&&fe(),Z&&Z()}),he)}P=P||"text";let Ne=await Jh[Ke.findKey(Jh,P)||"text"](ne,c);return!te&&Z&&Z(),await new Promise((he,Ce)=>{K_(he,Ce,{data:Ne,headers:Ai.from(ne.headers),status:ne.status,statusText:ne.statusText,config:c,request:X})})}catch(de){throw Z&&Z(),de&&de.name==="TypeError"&&/Load failed|fetch/i.test(de.message)?Object.assign(new cs("Network Error",cs.ERR_NETWORK,c,X),{cause:de.cause||de}):cs.from(de,de&&de.code,c,X)}}),kf={http:CT,xhr:iE,fetch:mE};Ke.forEach(kf,(c,u)=>{if(c){try{Object.defineProperty(c,"name",{value:u})}catch{}Object.defineProperty(c,"adapterName",{value:u})}});const x0=c=>`- ${c}`,pE=c=>Ke.isFunction(c)||c===null||c===!1,tv={getAdapter:c=>{c=Ke.isArray(c)?c:[c];const{length:u}=c;let x,f;const w={};for(let N=0;N<u;N++){x=c[N];let E;if(f=x,!pE(x)&&(f=kf[(E=String(x)).toLowerCase()],f===void 0))throw new cs(`Unknown adapter '${E}'`);if(f)break;w[E||"#"+N]=f}if(!f){const N=Object.entries(w).map(([A,n])=>`adapter ${A} `+(n===!1?"is not supported by the environment":"is not available in the build"));let E=u?N.length>1?`since :
`+N.map(x0).join(`
`):" "+x0(N[0]):"as no adapter specified";throw new cs("There is no suitable adapter to dispatch the request "+E,"ERR_NOT_SUPPORT")}return f},adapters:kf};function rf(c){if(c.cancelToken&&c.cancelToken.throwIfRequested(),c.signal&&c.signal.aborted)throw new lc(null,c)}function y0(c){return rf(c),c.headers=Ai.from(c.headers),c.data=sf.call(c,c.transformRequest),["post","put","patch"].indexOf(c.method)!==-1&&c.headers.setContentType("application/x-www-form-urlencoded",!1),tv.getAdapter(c.adapter||iu.adapter)(c).then(function(f){return rf(c),f.data=sf.call(c,c.transformResponse,f),f.headers=Ai.from(f.headers),f},function(f){return X_(f)||(rf(c),f&&f.response&&(f.response.data=sf.call(c,c.transformResponse,f.response),f.response.headers=Ai.from(f.response.headers))),Promise.reject(f)})}const sv="1.10.0",gm={};["object","boolean","number","function","string","symbol"].forEach((c,u)=>{gm[c]=function(f){return typeof f===c||"a"+(u<1?"n ":" ")+c}});const _0={};gm.transitional=function(u,x,f){function w(N,E){return"[Axios v"+sv+"] Transitional option '"+N+"'"+E+(f?". "+f:"")}return(N,E,A)=>{if(u===!1)throw new cs(w(E," has been removed"+(x?" in "+x:"")),cs.ERR_DEPRECATED);return x&&!_0[E]&&(_0[E]=!0,console.warn(w(E," has been deprecated since v"+x+" and will be removed in the near future"))),u?u(N,E,A):!0}};gm.spelling=function(u){return(x,f)=>(console.warn(`${f} is likely a misspelling of ${u}`),!0)};function fE(c,u,x){if(typeof c!="object")throw new cs("options must be an object",cs.ERR_BAD_OPTION_VALUE);const f=Object.keys(c);let w=f.length;for(;w-- >0;){const N=f[w],E=u[N];if(E){const A=c[N],n=A===void 0||E(A,N,c);if(n!==!0)throw new cs("option "+N+" must be "+n,cs.ERR_BAD_OPTION_VALUE);continue}if(x!==!0)throw new cs("Unknown option "+N,cs.ERR_BAD_OPTION)}}const Fh={assertOptions:fE,validators:gm},Un=Fh.validators;class Ho{constructor(u){this.defaults=u||{},this.interceptors={request:new d0,response:new d0}}async request(u,x){try{return await this._request(u,x)}catch(f){if(f instanceof Error){let w={};Error.captureStackTrace?Error.captureStackTrace(w):w=new Error;const N=w.stack?w.stack.replace(/^.+\n/,""):"";try{f.stack?N&&!String(f.stack).endsWith(N.replace(/^.+\n.+\n/,""))&&(f.stack+=`
`+N):f.stack=N}catch{}}throw f}}_request(u,x){typeof u=="string"?(x=x||{},x.url=u):x=u||{},x=Ko(this.defaults,x);const{transitional:f,paramsSerializer:w,headers:N}=x;f!==void 0&&Fh.assertOptions(f,{silentJSONParsing:Un.transitional(Un.boolean),forcedJSONParsing:Un.transitional(Un.boolean),clarifyTimeoutError:Un.transitional(Un.boolean)},!1),w!=null&&(Ke.isFunction(w)?x.paramsSerializer={serialize:w}:Fh.assertOptions(w,{encode:Un.function,serialize:Un.function},!0)),x.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?x.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:x.allowAbsoluteUrls=!0),Fh.assertOptions(x,{baseUrl:Un.spelling("baseURL"),withXsrfToken:Un.spelling("withXSRFToken")},!0),x.method=(x.method||this.defaults.method||"get").toLowerCase();let E=N&&Ke.merge(N.common,N[x.method]);N&&Ke.forEach(["delete","get","head","post","put","patch","common"],X=>{delete N[X]}),x.headers=Ai.concat(E,N);const A=[];let n=!0;this.interceptors.request.forEach(function(Z){typeof Z.runWhen=="function"&&Z.runWhen(x)===!1||(n=n&&Z.synchronous,A.unshift(Z.fulfilled,Z.rejected))});const P=[];this.interceptors.response.forEach(function(Z){P.push(Z.fulfilled,Z.rejected)});let z,q=0,U;if(!n){const X=[y0.bind(this),void 0];for(X.unshift.apply(X,A),X.push.apply(X,P),U=X.length,z=Promise.resolve(x);q<U;)z=z.then(X[q++],X[q++]);return z}U=A.length;let W=x;for(q=0;q<U;){const X=A[q++],Z=A[q++];try{W=X(W)}catch(J){Z.call(this,J);break}}try{z=y0.call(this,W)}catch(X){return Promise.reject(X)}for(q=0,U=P.length;q<U;)z=z.then(P[q++],P[q++]);return z}getUri(u){u=Ko(this.defaults,u);const x=Q_(u.baseURL,u.url,u.allowAbsoluteUrls);return Z_(x,u.params,u.paramsSerializer)}}Ke.forEach(["delete","get","head","options"],function(u){Ho.prototype[u]=function(x,f){return this.request(Ko(f||{},{method:u,url:x,data:(f||{}).data}))}});Ke.forEach(["post","put","patch"],function(u){function x(f){return function(N,E,A){return this.request(Ko(A||{},{method:u,headers:f?{"Content-Type":"multipart/form-data"}:{},url:N,data:E}))}}Ho.prototype[u]=x(),Ho.prototype[u+"Form"]=x(!0)});class Qf{constructor(u){if(typeof u!="function")throw new TypeError("executor must be a function.");let x;this.promise=new Promise(function(N){x=N});const f=this;this.promise.then(w=>{if(!f._listeners)return;let N=f._listeners.length;for(;N-- >0;)f._listeners[N](w);f._listeners=null}),this.promise.then=w=>{let N;const E=new Promise(A=>{f.subscribe(A),N=A}).then(w);return E.cancel=function(){f.unsubscribe(N)},E},u(function(N,E,A){f.reason||(f.reason=new lc(N,E,A),x(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(u){if(this.reason){u(this.reason);return}this._listeners?this._listeners.push(u):this._listeners=[u]}unsubscribe(u){if(!this._listeners)return;const x=this._listeners.indexOf(u);x!==-1&&this._listeners.splice(x,1)}toAbortSignal(){const u=new AbortController,x=f=>{u.abort(f)};return this.subscribe(x),u.signal.unsubscribe=()=>this.unsubscribe(x),u.signal}static source(){let u;return{token:new Qf(function(w){u=w}),cancel:u}}}function gE(c){return function(x){return c.apply(null,x)}}function xE(c){return Ke.isObject(c)&&c.isAxiosError===!0}const Af={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Af).forEach(([c,u])=>{Af[u]=c});function rv(c){const u=new Ho(c),x=D_(Ho.prototype.request,u);return Ke.extend(x,Ho.prototype,u,{allOwnKeys:!0}),Ke.extend(x,u,null,{allOwnKeys:!0}),x.create=function(w){return rv(Ko(c,w))},x}const Pr=rv(iu);Pr.Axios=Ho;Pr.CanceledError=lc;Pr.CancelToken=Qf;Pr.isCancel=X_;Pr.VERSION=sv;Pr.toFormData=pm;Pr.AxiosError=cs;Pr.Cancel=Pr.CanceledError;Pr.all=function(u){return Promise.all(u)};Pr.spread=gE;Pr.isAxiosError=xE;Pr.mergeConfig=Ko;Pr.AxiosHeaders=Ai;Pr.formToJSON=c=>H_(Ke.isHTMLForm(c)?new FormData(c):c);Pr.getAdapter=tv.getAdapter;Pr.HttpStatusCode=Af;Pr.default=Pr;var iv={exports:{}};(function(c,u){var x={};(function(f,w){c.exports=w()})(g1,function(){var f,w,N;function E(n,P){if(!f)f=P;else if(!w)w=P;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+f+")(sharedChunk); ("+w+")(sharedChunk); self.onerror = null;",q={};f(q),N=P(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(N.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}E(["exports"],function(n){var P=typeof self<"u"?self:{},z="2.15.0";let q;const U={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(q==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{q=x.API_URL_REGEX!=null?new RegExp(x.API_URL_REGEX):s}catch{q=s}}return q},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!U.API_URL)return null;try{const s=new URL(U.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},W={supported:!1,testSupport:function(s){!J&&Z&&(de?ne(s):X=s)}};let X,Z,J=!1,de=!1;function ne(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Z),s.isContextLost())return;W.supported=!0}catch{}s.deleteTexture(e),J=!0}P.document&&(Z=P.document.createElement("img"),Z.onload=function(){X&&ne(X),X=null,de=!0},Z.onerror=function(){J=!0,X=null},Z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const te="01";function Ne(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var he=Ce;function Ce(s,e,r,a){this.cx=3*s,this.bx=3*(r-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=e,this.p2x=r,this.p2y=a}Ce.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,e){if(e===void 0&&(e=1e-6),s<0)return 0;if(s>1)return 1;for(var r=s,a=0;a<8;a++){var l=this.sampleCurveX(r)-s;if(Math.abs(l)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var p=0,y=1;for(r=s,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-s)<e));a++)s>l?p=r:y=r,r=.5*(y-p)+p;return r},solve:function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))}};var Ae=Ne(he),fe=Ie;function Ie(s,e){this.x=s,this.y=e}Ie.prototype={clone:function(){return new Ie(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,e){return this.clone()._rotateAround(s,e)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var e=s.x-this.x,r=s.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult:function(s){var e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var e=Math.cos(s),r=Math.sin(s),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(s,e){var r=Math.cos(s),a=Math.sin(s),l=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ie.convert=function(s){return s instanceof Ie?s:Array.isArray(s)?new Ie(s[0],s[1]):s};var Ee=Ne(fe);const tt=Math.PI/180,je=180/Math.PI;function Pe(s){return s*tt}function it(s){return s*je}const ct=[[0,0],[1,0],[1,1],[0,1]];function Nt(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,r=e*s;return 4*(s<.5?r:3*(s-e)+r-.75)}function ft(s,e,r,a){const l=new Ae(s,e,r,a);return function(h){return l.solve(h)}}const Mt=ft(.25,.1,.25,1);function ht(s,e,r){return Math.min(r,Math.max(e,s))}function Os(s,e,r){return(r=ht((r-s)/(e-s),0,1))*r*(3-2*r)}function ns(s,e,r){const a=r-e,l=((s-e)%a+a)%a+e;return l===e?r:l}function _s(s,e,r){if(!s.length)return r(null,[]);let a=s.length;const l=new Array(s.length);let h=null;s.forEach((p,y)=>{e(p,(v,b)=>{v&&(h=v),l[y]=b,--a==0&&r(h,l)})})}function pr(s){const e=[];for(const r in s)e.push(s[r]);return e}function Ut(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}let fr=1;function Fr(){return fr++}function jr(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function gr(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Br(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function _r(s,e){s.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Jr(s,e){return s.indexOf(e,s.length-e.length)!==-1}function Qt(s,e,r){const a={};for(const l in s)a[l]=e.call(this,s[l],l,s);return a}function gi(s,e,r){const a={};for(const l in s)e.call(r||this,s[l],l,s)&&(a[l]=s[l]);return a}function vr(s){return Array.isArray(s)?s.map(vr):typeof s=="object"&&s?Qt(s,vr):s}const Mi={};function As(s){Mi[s]||(typeof console<"u"&&console.warn(s),Mi[s]=!0)}function Ir(s,e,r){return(r.y-s.y)*(e.x-s.x)>(e.y-s.y)*(r.x-s.x)}function Zn(s){let e=0;for(let r,a,l=0,h=s.length,p=h-1;l<h;p=l++)r=s[l],a=s[p],e+=(a.x-r.x)*(r.y+a.y);return e}function Zr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function we(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,h)=>{const p=l||h;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Ge=null;function et(s){if(Ge==null){const e=s.navigator?s.navigator.userAgent:null;Ge=!!s.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ge}function Ct(s){try{const e=P[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function wt(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}const De="mapbox-tiles";let xt=500,Jt=50,qt,vs;function sr(){try{return P.caches}catch{}}function Ls(){sr()&&!qt&&(qt=P.caches.open(De))}function xi(s){const e=s.indexOf("?");if(e<0)return s;const r=function(l){const h=l.indexOf("?");return h>0?l.slice(h+1).split("&"):[]}(s),a=r.filter(l=>{const h=l.split("=");return h[0]==="language"||h[0]==="worldview"});return a.length?`${s.slice(0,e)}?${a.join("&")}`:s.slice(0,e)}let Wr=1/0;const Dr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Dr);class yi extends Error{constructor(e,r,a){r===401&&Re(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Oi=Zr()?()=>self.worker&&self.worker.referrer:()=>(P.location.protocol==="blob:"?P.parent:P).location.href,en=function(s,e){if(!(/^file:/.test(r=s.url)||/^file:/.test(Oi())&&!/^\w+:/.test(r))){if(P.fetch&&P.Request&&P.AbortController&&P.Request.prototype.hasOwnProperty("signal"))return function(a,l){const h=new P.AbortController,p=new P.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Oi(),referrerPolicy:a.referrerPolicy,signal:h.signal});let y=!1,v=!1;const b=(T=p.url).indexOf("sku=")>0&&Re(T);var T;a.type==="json"&&p.headers.set("Accept","application/json");const k=(L,R,B)=>{if(v)return;if(L&&L.message!=="SecurityError"&&As(L.toString()),R&&B)return M(R);const H=Date.now();P.fetch(p).then(re=>{if(re.ok){const pe=b?re.clone():null;return M(re,pe,H)}return l(new yi(re.statusText,re.status,a.url))}).catch(re=>{re.name!=="AbortError"&&l(new Error(`${re.message} ${a.url}`))})},M=(L,R,B)=>{(a.type==="arrayBuffer"?L.arrayBuffer():a.type==="json"?L.json():L.text()).then(H=>{v||(R&&B&&function(re,pe,ie){if(Ls(),!qt)return;const ue={status:pe.status,statusText:pe.statusText,headers:new P.Headers};pe.headers.forEach((Ue,Oe)=>ue.headers.set(Oe,Ue));const xe=we(pe.headers.get("Cache-Control")||"");if(xe["no-store"])return;xe["max-age"]&&ue.headers.set("Expires",new Date(ie+1e3*xe["max-age"]).toUTCString());const ge=ue.headers.get("Expires");ge&&(new Date(ge).getTime()-ie<42e4||function(Ue,Oe){if(vs===void 0)try{new Response(new ReadableStream),vs=!0}catch{vs=!1}vs?Oe(Ue.body):Ue.blob().then(Oe)}(pe,Ue=>{const Oe=new P.Response(Ue,ue);Ls(),qt&&qt.then(He=>He.put(xi(re.url),Oe)).catch(He=>As(He.message))}))}(p,R,B),y=!0,l(null,H,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(H=>{v||l(new Error(H.message))})};return b?function(L,R){if(Ls(),!qt)return R(null);const B=xi(L.url);qt.then(H=>{H.match(B).then(re=>{const pe=function(ie){if(!ie)return!1;const ue=new Date(ie.headers.get("Expires")||0),xe=we(ie.headers.get("Cache-Control")||"");return ue>Date.now()&&!xe["no-cache"]}(re);H.delete(B),pe&&H.put(B,re.clone()),R(null,re,pe)}).catch(R)}).catch(R)}(p,k):k(null,null),{cancel:()=>{v=!0,y||h.abort()}}}(s,e);if(Zr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var r;return function(a,l){const h=new P.XMLHttpRequest;h.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in a.headers)h.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=a.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(a.type==="json")try{p=JSON.parse(h.response)}catch(y){return l(y)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else l(new yi(h.statusText,h.status,a.url))},h.send(a.body),{cancel:()=>h.abort()}}(s,e)},tn=function(s,e){return en(Ut(s,{type:"arrayBuffer"}),e)};function el(s){const e=P.document.createElement("a");return e.href=s,e.protocol===P.document.location.protocol&&e.host===P.document.location.host}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let V,$;V=[],$=0;const ce=function(s,e){if(W.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),$>=U.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return V.push(h),h}$++;let r=!1;const a=()=>{if(!r)for(r=!0,$--;V.length&&$<U.MAX_PARALLEL_IMAGE_REQUESTS;){const h=V.shift(),{requestParameters:p,callback:y,cancelled:v}=h;v||(h.cancel=ce(p,y).cancel)}},l=tn(s,(h,p,y,v)=>{a(),h?e(h):p&&(P.createImageBitmap?function(b,T){const k=new P.Blob([new Uint8Array(b)],{type:"image/png"});P.createImageBitmap(k).then(M=>{T(null,M)}).catch(M=>{T(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(b,T)=>e(b,T,y,v)):function(b,T){const k=new P.Image,M=P.URL;k.onload=()=>{T(null,k),M.revokeObjectURL(k.src),k.onload=null,P.requestAnimationFrame(()=>{k.src=me})},k.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new P.Blob([new Uint8Array(b)],{type:"image/png"});k.src=b.byteLength?M.createObjectURL(L):me}(p,(b,T)=>e(b,T,y,v)))});return{cancel:()=>{l.cancel(),a()}}},ye="NO_ACCESS_TOKEN";function Te(s){return s.indexOf("mapbox:")===0}function Re(s){return U.API_URL_REGEX.test(s)}function Le(s){return U.API_CDN_URL_REGEX.test(s)}function Se(s){return U.API_STYLE_REGEX.test(s)&&!$e(s)}function $e(s){return U.API_SPRITE_REGEX.test(s)}const gt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _t(s){const e=s.match(gt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ut(s){const e=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${e}`}const Wt="mapbox.eventData";function Yt(s){if(!s)return null;const e=s.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(P.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ht{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Yt(U.ACCESS_TOKEN);let a="";return a=r&&r.u?P.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,h)=>String.fromCharCode(+("0x"+h)))):U.ACCESS_TOKEN||"",e?`${Wt}.${e}:${a}`:`${Wt}:${a}`}fetchEventData(){const e=Ct("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const l=P.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const h=P.localStorage.getItem(a);h&&(this.anonId=h)}catch{As("Unable to read from LocalStorage")}}saveEventData(){const e=Ct("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{P.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&P.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{As("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,l){if(!U.EVENTS_URL)return;const h=_t(U.EVENTS_URL);h.params.push(`access_token=${l||U.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},y=r?Ut(p,r):p,v={url:ut(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(b,T){return en(Ut(b,{method:"POST"}),T)}(v,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(l)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const es=new class extends Ht{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,e){U.EVENTS_URL&&U.ACCESS_TOKEN&&Array.isArray(s)&&s.some(r=>Te(r)||Re(r))&&this.queueRequest(Date.now(),e)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Yt(U.ACCESS_TOKEN),r=e?e.u:U.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;Br(this.anonId)||(this.anonId=jr(),a=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),p=new Date(l),y=(l-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||h.getDate()!==p.getDate()}else a=!0;a?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:te,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},s):this.processRequests()}},os=es.postTurnstileEvent.bind(es),Vs=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,e,r,a){this.skuToken=e,this.errorCb=a,U.EVENTS_URL&&(r||U.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},r):this.errorCb(new Error(ye)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Br(this.anonId)||(this.anonId=jr()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:te,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},s))}},rr=Vs.postMapLoadEvent.bind(Vs),Ur=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(s,e){U.EVENTS_URL&&(s||U.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),a=function(l){const h=P.performance.getEntriesByType("resource"),p=P.performance.getEntriesByType("mark"),y=function(M){const L={};if(M){for(const R in M)if(R!=="other")for(const B of M[R]){const H=`${R}ResolveRangeMin`,re=`${R}ResolveRangeMax`,pe=`${R}RequestCount`,ie=`${R}RequestCachedCount`;L[H]=Math.min(L[H]||1/0,B.startTime),L[re]=Math.max(L[re]||-1/0,B.responseEnd);const ue=xe=>{L[xe]===void 0&&(L[xe]=0),++L[xe]};B.transferSize!==void 0&&B.transferSize===0&&ue(ie),ue(pe)}}return L}(function(M,L){const R={};if(M)for(const B of M){const H=L(B);R[H]===void 0&&(R[H]=[]),R[H].push(B)}return R}(h,ou)),v=P.devicePixelRatio,b=P.navigator.connection||P.navigator.mozConnection||P.navigator.webkitConnection,T={counters:[],metadata:[],attributes:[]},k=(M,L,R)=>{R!=null&&M.push({name:L,value:R.toString()})};for(const M in y)k(T.counters,M,y[M]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(k(T.counters,"interactionRangeMin",l.interactionRange[0]),k(T.counters,"interactionRangeMax",l.interactionRange[1])),p)for(const M of Object.keys(ga)){const L=ga[M],R=p.find(B=>B.name===L);R&&k(T.counters,L,R.startTime)}return k(T.counters,"visibilityHidden",l.visibilityHidden),k(T.attributes,"style",function(M){if(M)for(const L of M){const R=L.name.split("?")[0];if(Se(R)){const B=R.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(h)),k(T.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),k(T.attributes,"fogEnabled",l.fogEnabled?"true":"false"),k(T.attributes,"projection",l.projection),k(T.attributes,"zoom",l.zoom),k(T.metadata,"devicePixelRatio",v),k(T.metadata,"connectionEffectiveType",b?b.effectiveType:void 0),k(T.metadata,"navigatorUserAgent",P.navigator.userAgent),k(T.metadata,"screenWidth",P.screen.width),k(T.metadata,"screenHeight",P.screen.height),k(T.metadata,"windowWidth",P.innerWidth),k(T.metadata,"windowHeight",P.innerHeight),k(T.metadata,"mapWidth",l.width/v),k(T.metadata,"mapHeight",l.height/v),k(T.metadata,"webglRenderer",l.renderer),k(T.metadata,"webglVendor",l.vendor),k(T.metadata,"sdkVersion",z),k(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(r);for(const l of a.metadata);for(const l of a.counters);for(const l of a.attributes);this.postEvent(e,a,()=>{},s)}},xr=Ur.postPerformanceEvent.bind(Ur),Fi=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,e,r,a){if(!U.API_URL||!U.SESSION_PATH)return;const l=_t(U.API_URL+U.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${a||U.ACCESS_TOKEN||""}`);const h={url:ut(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,y){return en(Ut(p,{method:"GET"}),y)}(h,p=>{this.pendingRequest=null,r(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(s,e,r,a){this.skuToken=e,this.errorCb=a,U.SESSION_PATH&&U.API_URL&&(r||U.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},r):this.errorCb(new Error(ye)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},s)}},Nr=Fi.getSessionAPI.bind(Fi),Hr=new Set,ga={create:"create",load:"load",fullLoad:"fullLoad"},ym={mark(s){P.performance.mark(s)},measure(s,e,r){P.performance.measure(s,e,r)}};function ou(s){const e=s.name.split("?")[0];return Le(e)&&e.includes("mapbox-gl.js")?"javascript":Le(e)&&e.includes("mapbox-gl.css")?"css":function(r){return U.API_FONTS_REGEX.test(r)}(e)?"fontRange":$e(e)?"sprite":Se(e)?"style":function(r){return U.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}const xs=P.performance;function uc(s){const e=s?s.url.toString():void 0;return xs.getEntriesByName(e)}let ro,hc,tl,Bi;const sn={now:()=>tl!==void 0?tl:P.performance.now(),setNow(s){tl=s},restoreNow(){tl=void 0},frame(s){const e=P.requestAnimationFrame(s);return{cancel:()=>P.cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:r,height:a}=s;Bi||(Bi=P.document.createElement("canvas"));const l=Bi.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>Bi.width||a>Bi.height)&&(Bi.width=r,Bi.height=a),l.clearRect(-e,-e,r+2*e,a+2*e),l.drawImage(s,0,0,r,a),l.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:s=>(ro||(ro=P.document.createElement("a")),ro.href=s,ro.href),get devicePixelRatio(){return P.devicePixelRatio},get prefersReducedMotion(){return!!P.matchMedia&&(hc==null&&(hc=P.matchMedia("(prefers-reduced-motion: reduce)")),hc.matches)}};function mc(s,e,r){r[s]&&r[s].indexOf(e)!==-1||(r[s]=r[s]||[],r[s].push(e))}function pc(s,e,r){if(r&&r[s]){const a=r[s].indexOf(e);a!==-1&&r[s].splice(a,1)}}class Wn{constructor(e,r={}){Ut(this,r),this.type=e}}class rn extends Wn{constructor(e,r={}){super("error",Ut({error:e},r))}}class io{on(e,r){return this._listeners=this._listeners||{},mc(e,r,this._listeners),this}off(e,r){return pc(e,r,this._listeners),pc(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},mc(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Wn(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of l)y.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of h)pc(a,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(Ut(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof rn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function nn(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}function ir(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Sr(s){if(Array.isArray(s))return s.map(Sr);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const r in s)e[r]=Sr(s[r]);return e}return ir(s)}class lu extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Ui=lu;class fc{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,l]of r)this.bindings[a]=l}concat(e){return new fc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var cu=fc;const xa={kind:"null"},St={kind:"number"},as={kind:"string"},ss={kind:"boolean"},ui={kind:"color"},Pi={kind:"object"},rs={kind:"value"},hi={kind:"collator"},no={kind:"formatted"},Hn={kind:"resolvedImage"};function _i(s,e){return{kind:"array",itemType:s,N:e}}function Fs(s){if(s.kind==="array"){const e=Fs(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const du=[xa,St,as,ss,ui,no,Pi,_i(rs),Hn];function an(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!an(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const r of du)if(!an(r,e))return null}}return`Expected ${Fs(s)} but found ${Fs(e)} instead.`}function ao(s,e){return e.some(r=>r.kind===s.kind)}function oo(s,e){return e.some(r=>r==="null"?s===null:r==="array"?Array.isArray(s):r==="object"?s&&!Array.isArray(s)&&typeof s=="object":r===typeof s)}var gc,uu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function lo(s){return(s=Math.round(s))<0?0:s>255?255:s}function co(s){return lo(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function sl(s){return(e=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:e>1?1:e;var e}function ya(s,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?s+(e-s)*r*6:2*r<1?e:3*r<2?s+(e-s)*(2/3-r)*6:s}try{gc={}.parseCSSColor=function(s){var e,r=s.replace(/ /g,"").toLowerCase();if(r in uu)return uu[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),l=r.indexOf(")");if(a!==-1&&l+1===r.length){var h=r.substr(0,a),p=r.substr(a+1,l-(a+1)).split(","),y=1;switch(h){case"rgba":if(p.length!==4)return null;y=sl(p.pop());case"rgb":return p.length!==3?null:[co(p[0]),co(p[1]),co(p[2]),y];case"hsla":if(p.length!==4)return null;y=sl(p.pop());case"hsl":if(p.length!==3)return null;var v=(parseFloat(p[0])%360+360)%360/360,b=sl(p[1]),T=sl(p[2]),k=T<=.5?T*(b+1):T+b-T*b,M=2*T-k;return[lo(255*ya(M,k,v+1/3)),lo(255*ya(M,k,v)),lo(255*ya(M,k,v-1/3)),y];default:return null}}return null}}catch{}class Yr{constructor(e,r,a,l=1){this.r=e,this.g=r,this.b=a,this.a=l}static parse(e){if(!e)return;if(e instanceof Yr)return e;if(typeof e!="string")return;const r=gc(e);return r?new Yr(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${l})`}toArray(){const{r:e,g:r,b:a,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*a/l,l]}toArray01(){const{r:e,g:r,b:a,a:l}=this;return l===0?[0,0,0,0]:[e/l,r/l,a/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:l}=this;return[e,r,a,l]}}Yr.black=new Yr(0,0,0,1),Yr.white=new Yr(1,1,1,1),Yr.transparent=new Yr(0,0,0,0),Yr.red=new Yr(1,0,0,1),Yr.blue=new Yr(0,0,1,1);var Js=Yr;class xc{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yc{constructor(e,r,a,l,h){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=l,this.textColor=h}}class ei{constructor(e){this.sections=e}static fromString(e){return new ei([new yc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ei?e:ei.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class vi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new vi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function hu(s,e,r,a){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[s,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[s,e,r,a]:[s,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function uo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Js||s instanceof xc||s instanceof ei||s instanceof vi)return!0;if(Array.isArray(s)){for(const e of s)if(!uo(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!uo(s[e]))return!1;return!0}return!1}function Zs(s){if(s===null)return xa;if(typeof s=="string")return as;if(typeof s=="boolean")return ss;if(typeof s=="number")return St;if(s instanceof Js)return ui;if(s instanceof xc)return hi;if(s instanceof ei)return no;if(s instanceof vi)return Hn;if(Array.isArray(s)){const e=s.length;let r;for(const a of s){const l=Zs(a);if(r){if(r===l)continue;r=rs;break}r=l}return _i(r||rs,e)}return Pi}function ho(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Js||s instanceof ei||s instanceof vi?s.toString():JSON.stringify(s)}class _c{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!uo(e[1]))return r.error("invalid value");const a=e[1];let l=Zs(a);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new _c(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Js?["rgba"].concat(this.value.toArray()):this.value instanceof ei?this.value.serialize():this.value}}var Xn=_c,Lr=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const vc={string:as,number:St,boolean:ss,object:Pi};class bc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,l=1;const h=e[0];if(h==="array"){let y,v;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in vc)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=vc[b],l++}else y=rs;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}a=_i(y,v)}else a=vc[h];const p=[];for(;l<e.length;l++){const y=r.parse(e[l],l,rs);if(!y)return null;p.push(y)}return new bc(a,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!an(this.type,Zs(a)))return a;if(r===this.args.length-1)throw new Lr(`Expected value to be of type ${Fs(this.type)}, but found ${Fs(Zs(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(a=>a.serialize()))}}var on=bc;class An{constructor(e){this.type=no,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let v=null;if(y["font-scale"]&&(v=r.parse(y["font-scale"],1,St),!v))return null;let b=null;if(y["text-font"]&&(b=r.parse(y["text-font"],1,_i(as)),!b))return null;let T=null;if(y["text-color"]&&(T=r.parse(y["text-color"],1,ui),!T))return null;const k=l[l.length-1];k.scale=v,k.font=b,k.textColor=T}else{const v=r.parse(e[p],1,rs);if(!v)return null;const b=v.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new An(l)}evaluate(e){return new ei(this.sections.map(r=>{const a=r.content.evaluate(e);return Zs(a)===Hn?new yc("",a,null,null,null):new yc(ho(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class rl{constructor(e){this.type=Hn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,as);return a?new rl(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=vi.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const _m={"to-boolean":ss,"to-color":ui,"to-number":St,"to-string":as};class wc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=_m[a],h=[];for(let p=1;p<e.length;p++){const y=r.parse(e[p],p,rs);if(!y)return null;h.push(y)}return new wc(l,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const l of this.args){if(r=l.evaluate(e),a=null,r instanceof Js)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:hu(r[0],r[1],r[2],r[3]),!a))return new Js(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Lr(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Lr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ei.fromString(ho(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?vi.fromString(ho(this.args[0].evaluate(e))):ho(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new An([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var _a=wc;const Vi=["Unknown","Point","LineString","Polygon"];var jc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-s[0])+this.featureDistanceData.bearing[1]*(a*e-s[1])}return 0}parseColor(s){let e=this._parseColorCache[s];return e||(e=this._parseColorCache[s]=Js.parse(s)),e}};class Kn{constructor(e,r,a,l){this.name=e,this.type=r,this._evaluate=a,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],l=Kn.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=p.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let v=null;for(const[b,T]of y){v=new kc(r.registry,r.path,null,r.scope);const k=[];let M=!1;for(let L=1;L<e.length;L++){const R=e[L],B=Array.isArray(b)?b[L-1]:b.type,H=v.parse(R,1+k.length,B);if(!H){M=!0;break}k.push(H)}if(!M)if(Array.isArray(b)&&b.length!==k.length)v.error(`Expected ${b.length} arguments, but found ${k.length} instead.`);else{for(let L=0;L<k.length;L++){const R=Array.isArray(b)?b[L]:b.type,B=k[L];v.concat(L+1).checkSubtype(R,B.type)}if(v.errors.length===0)return new Kn(a,h,T,k)}}if(y.length===1)r.errors.push(...v.errors);else{const b=(y.length?y:p).map(([k])=>{return M=k,Array.isArray(M)?`(${M.map(Fs).join(", ")})`:`(${Fs(M.type)}...)`;var M}).join(" | "),T=[];for(let k=1;k<e.length;k++){const M=r.parse(e[k],1+T.length);if(!M)return null;T.push(Fs(M.type))}r.error(`Expected arguments of type ${b}, but found (${T.join(", ")}) instead.`)}return null}static register(e,r){Kn.definitions=r;for(const a in r)e[a]=Kn}}var ln=Kn;class mo{constructor(e,r,a){this.type=hi,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const l=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ss);if(!l)return null;const h=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ss);if(!h)return null;let p=null;return a.locale&&(p=r.parse(a.locale,1,as),!p)?null:new mo(l,h,p)}evaluate(e){return new xc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const cn=8192;function il(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function va(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function po(s,e){const r=(180+s[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*cn),Math.round(a*l*cn)]}function mu(s,e,r){const a=s[0]-e[0],l=s[1]-e[1],h=s[0]-r[0],p=s[1]-r[1];return a*p-h*l==0&&a*h<=0&&l*p<=0}function nl(s,e){let r=!1;for(let p=0,y=e.length;p<y;p++){const v=e[p];for(let b=0,T=v.length;b<T-1;b++){if(mu(s,v[b],v[b+1]))return!1;(l=v[b])[1]>(a=s)[1]!=(h=v[b+1])[1]>a[1]&&a[0]<(h[0]-l[0])*(a[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var a,l,h;return r}function Nc(s,e){for(let r=0;r<e.length;r++)if(nl(s,e[r]))return!0;return!1}function Sc(s,e,r,a){const l=a[0]-r[0],h=a[1]-r[1],p=(s[0]-r[0])*h-l*(s[1]-r[1]),y=(e[0]-r[0])*h-l*(e[1]-r[1]);return p>0&&y<0||p<0&&y>0}function ba(s,e,r){for(const b of r)for(let T=0;T<b.length-1;++T)if((y=[(p=b[T+1])[0]-(h=b[T])[0],p[1]-h[1]])[0]*(v=[(l=e)[0]-(a=s)[0],l[1]-a[1]])[1]-y[1]*v[0]!=0&&Sc(a,l,h,p)&&Sc(h,p,a,l))return!0;var a,l,h,p,y,v;return!1}function ys(s,e){for(let r=0;r<s.length;++r)if(!nl(s[r],e))return!1;for(let r=0;r<s.length-1;++r)if(ba(s[r],s[r+1],e))return!1;return!0}function vm(s,e){for(let r=0;r<e.length;r++)if(ys(s,e[r]))return!0;return!1}function Tc(s,e,r){const a=[];for(let l=0;l<s.length;l++){const h=[];for(let p=0;p<s[l].length;p++){const y=po(s[l][p],r);il(e,y),h.push(y)}a.push(h)}return a}function pu(s,e,r){const a=[];for(let l=0;l<s.length;l++){const h=Tc(s[l],e,r);a.push(h)}return a}function Ec(s,e,r,a){if(s[0]<r[0]||s[0]>r[2]){const l=.5*a;let h=s[0]-r[0]>l?-a:r[0]-s[0]>l?a:0;h===0&&(h=s[0]-r[2]>l?-a:r[2]-s[0]>l?a:0),s[0]+=h}il(e,s)}function fu(s,e,r,a){const l=Math.pow(2,a.z)*cn,h=[a.x*cn,a.y*cn],p=[];if(!s)return p;for(const y of s)for(const v of y){const b=[v.x+h[0],v.y+h[1]];Ec(b,e,r,l),p.push(b)}return p}function Cc(s,e,r,a){const l=Math.pow(2,a.z)*cn,h=[a.x*cn,a.y*cn],p=[];if(!s)return p;for(const v of s){const b=[];for(const T of v){const k=[T.x+h[0],T.y+h[1]];il(e,k),b.push(k)}p.push(b)}if(e[2]-e[0]<=l/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const v of p)for(const b of v)Ec(b,e,r,l)}var y;return p}class wa{constructor(e,r){this.type=ss,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(uo(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let l=0;l<a.features.length;++l){const h=a.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new wa(a,a.features[l].geometry)}else if(a.type==="Feature"){const l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new wa(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new wa(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=Tc(a.coordinates,h,p),v=fu(r.geometry(),l,h,p);if(!va(l,h))return!1;for(const b of v)if(!nl(b,y))return!1}if(a.type==="MultiPolygon"){const y=pu(a.coordinates,h,p),v=fu(r.geometry(),l,h,p);if(!va(l,h))return!1;for(const b of v)if(!Nc(b,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=Tc(a.coordinates,h,p),v=Cc(r.geometry(),l,h,p);if(!va(l,h))return!1;for(const b of v)if(!ys(b,y))return!1}if(a.type==="MultiPolygon"){const y=pu(a.coordinates,h,p),v=Cc(r.geometry(),l,h,p);if(!va(l,h))return!1;for(const b of v)if(!vm(b,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var al=wa;function ja(s){if(s instanceof ln&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof al)return!1;let e=!0;return s.eachChild(r=>{e&&!ja(r)&&(e=!1)}),e}function dn(s){if(s instanceof ln&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(r=>{e&&!dn(r)&&(e=!1)}),e}function Qn(s,e){if(s instanceof ln&&e.indexOf(s.name)>=0)return!1;let r=!0;return s.eachChild(a=>{r&&!Qn(a,e)&&(r=!1)}),r}class ol{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new ol(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var gu=ol;class fo{constructor(e,r=[],a,l=new cu,h=[]){this.registry=e,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=h,this.expectedType=a}parse(e,r,a,l,h={}){return r?this.concat(r,a,l)._parse(e,h):this._parse(e,h)}_parse(e,r){function a(l,h,p){return p==="assert"?new on(h,[l]):p==="coerce"?new _a(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,v=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||v.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(y,v))return null}else p=a(p,y,r.typeAnnotation||"coerce");else p=a(p,y,r.typeAnnotation||"assert")}if(!(p instanceof Xn)&&p.type.kind!=="resolvedImage"&&Ac(p)){const y=new jc;try{p=new Xn(p.type,p.evaluate(y))}catch(v){return this.error(v.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const l=typeof e=="number"?this.path.concat(e):this.path,h=a?this.scope.concat(a):this.scope;return new fo(this.registry,l,r||null,h,this.errors)}error(e,...r){const a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Ui(a,e))}checkSubtype(e,r){const a=an(e,r);return a&&this.error(a),a}}var kc=fo;function Ac(s){if(s instanceof gu)return Ac(s.boundExpression);if(s instanceof ln&&s.name==="error"||s instanceof mo||s instanceof al)return!1;const e=s instanceof _a||s instanceof on;let r=!0;return s.eachChild(a=>{r=e?r&&Ac(a):r&&a instanceof Xn}),!!r&&ja(s)&&Qn(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ll(s,e){const r=s.length-1;let a,l,h=0,p=r,y=0;for(;h<=p;)if(y=Math.floor((h+p)/2),a=s[y],l=s[y+1],a<=e){if(y===r||e<l)return y;h=y+1}else{if(!(a>e))throw new Lr("Input is not a number.");p=y-1}return 0}class cl{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of a)this.labels.push(l),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,St);if(!a)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],v=e[p+1],b=p,T=p+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const k=r.parse(v,T,h);if(!k)return null;h=h||k.type,l.push([y,k])}return new cl(h,a,l)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const h=r.length;return l>=r[h-1]?a[h-1].evaluate(e):a[ll(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var Mc=cl;function us(s,e,r){return s*(1-r)+e*r}var go=Object.freeze({__proto__:null,array:function(s,e,r){return s.map((a,l)=>us(a,e[l],r))},color:function(s,e,r){return new Js(us(s.r,e.r,r),us(s.g,e.g,r),us(s.b,e.b,r),us(s.a,e.a,r))},number:us});const xu=.95047,Pc=1.08883,yu=4/29,Jn=6/29,Ic=3*Jn*Jn,bm=Jn*Jn*Jn,wm=Math.PI/180,jm=180/Math.PI;function Dc(s){return s>bm?Math.pow(s,1/3):s/Ic+yu}function Lc(s){return s>Jn?s*s*s:Ic*(s-yu)}function Rc(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function dl(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function _u(s){const e=dl(s.r),r=dl(s.g),a=dl(s.b),l=Dc((.4124564*e+.3575761*r+.1804375*a)/xu),h=Dc((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*h-16,a:500*(l-h),b:200*(h-Dc((.0193339*e+.119192*r+.9503041*a)/Pc)),alpha:s.a}}function vu(s){let e=(s.l+16)/116,r=isNaN(s.a)?e:e+s.a/500,a=isNaN(s.b)?e:e-s.b/200;return e=1*Lc(e),r=xu*Lc(r),a=Pc*Lc(a),new Js(Rc(3.2404542*r-1.5371385*e-.4985314*a),Rc(-.969266*r+1.8760108*e+.041556*a),Rc(.0556434*r-.2040259*e+1.0572252*a),s.alpha)}function Nm(s,e,r){const a=e-s;return s+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const xo={forward:_u,reverse:vu,interpolate:function(s,e,r){return{l:us(s.l,e.l,r),a:us(s.a,e.a,r),b:us(s.b,e.b,r),alpha:us(s.alpha,e.alpha,r)}}},Na={forward:function(s){const{l:e,a:r,b:a}=_u(s),l=Math.atan2(a,r)*jm;return{h:l<0?l+360:l,c:Math.sqrt(r*r+a*a),l:e,alpha:s.a}},reverse:function(s){const e=s.h*wm,r=s.c;return vu({l:s.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:s.alpha})},interpolate:function(s,e,r){return{h:Nm(s.h,e.h,r),c:us(s.c,e.c,r),l:us(s.l,e.l,r),alpha:us(s.alpha,e.alpha,r)}}};var zc=Object.freeze({__proto__:null,hcl:Na,lab:xo});class yo{constructor(e,r,a,l,h){this.type=e,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of h)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,r,a,l){let h=0;if(e.name==="exponential")h=Oc(r,e.base,a,l);else if(e.name==="linear")h=Oc(r,1,a,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new Ae(p[0],p[1],p[2],p[3]).solve(Oc(r,1,a,l))}return h}static parse(e,r){let[a,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const b=l[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const b=l.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,St),!h)return null;const y=[];let v=null;a==="interpolate-hcl"||a==="interpolate-lab"?v=ui:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let b=0;b<p.length;b+=2){const T=p[b],k=p[b+1],M=b+3,L=b+4;if(typeof T!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(y.length&&y[y.length-1][0]>=T)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const R=r.parse(k,L,v);if(!R)return null;v=v||R.type,y.push([T,R])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new yo(v,a,l,h,y):r.error(`Type ${Fs(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const h=r.length;if(l>=r[h-1])return a[h-1].evaluate(e);const p=ll(r,l),y=yo.interpolationFactor(this.interpolation,l,r[p],r[p+1]),v=a[p].evaluate(e),b=a[p+1].evaluate(e);return this.operator==="interpolate"?go[this.type.kind.toLowerCase()](v,b,y):this.operator==="interpolate-hcl"?Na.reverse(Na.interpolate(Na.forward(v),Na.forward(b),y)):xo.reverse(xo.interpolate(xo.forward(v),xo.forward(b),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function Oc(s,e,r,a){const l=a-r,h=s-r;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}var qi=yo;class ul{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const l=r.expectedType;l&&l.kind!=="value"&&(a=l);const h=[];for(const y of e.slice(1)){const v=r.parse(y,1+h.length,a,void 0,{typeAnnotation:"omit"});if(!v)return null;a=a||v.type,h.push(v)}const p=l&&h.some(y=>an(l,y.type));return new ul(p?rs:a,h)}evaluate(e){let r,a=null,l=0;for(const h of this.args){if(l++,a=h.evaluate(e),a&&a instanceof vi&&!a.available&&(r||(r=a),a=null,l===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Fc=ul;class hl{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const y=r.parse(e[h+1],h+1);if(!y)return null;a.push([p,y])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return l?new hl(a,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}var bu=hl;class Bc{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,St),l=r.parse(e[2],2,_i(r.expectedType||rs));return a&&l?new Bc(l.type.itemType,a,l):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Lr(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Lr(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Lr(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Sm=Bc;class Uc{constructor(e,r){this.type=ss,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,rs);return a&&l?ao(a.type,[ss,as,St,xa,rs])?new Uc(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!oo(r,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(Zs(r))} instead.`);if(!oo(a,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${Fs(Zs(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ml=Uc;class _o{constructor(e,r,a){this.type=St,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,rs);if(!a||!l)return null;if(!ao(a.type,[ss,as,St,xa,rs]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(a.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,St);return h?new _o(a,l,h):null}return new _o(a,l)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!oo(r,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(Zs(r))} instead.`);if(!oo(a,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${Fs(Zs(a))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return a.indexOf(r,l)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var wu=_o;class Vc{constructor(e,r,a,l,h,p){this.inputType=e,this.type=r,this.input=a,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},p=[];for(let b=2;b<e.length-1;b+=2){let T=e[b];const k=e[b+1];Array.isArray(T)||(T=[T]);const M=r.concat(b);if(T.length===0)return M.error("Expected at least one branch label.");for(const R of T){if(typeof R!="number"&&typeof R!="string")return M.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return M.error("Numeric branch labels must be integer values.");if(a){if(M.checkSubtype(a,Zs(R)))return null}else a=Zs(R);if(h[String(R)]!==void 0)return M.error("Branch labels must be unique.");h[String(R)]=p.length}const L=r.parse(k,b,l);if(!L)return null;l=l||L.type,p.push(L)}const y=r.parse(e[1],1,rs);if(!y)return null;const v=r.parse(e[e.length-1],e.length-1,l);return v?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new Vc(a,l,y,h,p,v):null}evaluate(e){const r=this.input.evaluate(e);return(Zs(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],l={};for(const p of r){const y=l[this.cases[p]];y===void 0?(l[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[y][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of a)e.push(y.length===1?h(y[0]):y.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Tm=Vc;class qc{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const y=r.parse(e[p],p,ss);if(!y)return null;const v=r.parse(e[p+1],p+1,a);if(!v)return null;l.push([y,v]),a=a||v.type}const h=r.parse(e[e.length-1],e.length-1,a);return h?new qc(a,l,h):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var ju=qc;class vo{constructor(e,r,a,l){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,St);if(!a||!l)return null;if(!ao(a.type,[_i(rs),as,rs]))return r.error(`Expected first argument to be of type array or string, but found ${Fs(a.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,St);return h?new vo(a.type,a,l,h):null}return new vo(a.type,a,l)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!oo(r,["string","array"]))throw new Lr(`Expected first argument to be of type array or string, but found ${Fs(Zs(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(a,l)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Nu=vo;function pl(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Su(s,e,r,a){return a.compare(e,r)===0}function Sa(s,e,r){const a=s!=="=="&&s!=="!=";return class nv{constructor(h,p,y){this.type=ss,this.lhs=h,this.rhs=p,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const y=h[0];let v=p.parse(h[1],1,rs);if(!v)return null;if(!pl(y,v.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Fs(v.type)}'.`);let b=p.parse(h[2],2,rs);if(!b)return null;if(!pl(y,b.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Fs(b.type)}'.`);if(v.type.kind!==b.type.kind&&v.type.kind!=="value"&&b.type.kind!=="value")return p.error(`Cannot compare types '${Fs(v.type)}' and '${Fs(b.type)}'.`);a&&(v.type.kind==="value"&&b.type.kind!=="value"?v=new on(b.type,[v]):v.type.kind!=="value"&&b.type.kind==="value"&&(b=new on(v.type,[b])));let T=null;if(h.length===4){if(v.type.kind!=="string"&&b.type.kind!=="string"&&v.type.kind!=="value"&&b.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(h[3],3,hi),!T)return null}return new nv(v,b,T)}evaluate(h){const p=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(a&&this.hasUntypedArgument){const v=Zs(p),b=Zs(y);if(v.kind!==b.kind||v.kind!=="string"&&v.kind!=="number")throw new Lr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${v.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const v=Zs(p),b=Zs(y);if(v.kind!=="string"||b.kind!=="string")return e(h,p,y)}return this.collator?r(h,p,y,this.collator.evaluate(h)):e(h,p,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[s];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const Em=Sa("==",function(s,e,r){return e===r},Su),Cm=Sa("!=",function(s,e,r){return e!==r},function(s,e,r,a){return!Su(0,e,r,a)}),km=Sa("<",function(s,e,r){return e<r},function(s,e,r,a){return a.compare(e,r)<0}),Am=Sa(">",function(s,e,r){return e>r},function(s,e,r,a){return a.compare(e,r)>0}),Mm=Sa("<=",function(s,e,r){return e<=r},function(s,e,r,a){return a.compare(e,r)<=0}),Tu=Sa(">=",function(s,e,r){return e>=r},function(s,e,r,a){return a.compare(e,r)>=0});class fl{constructor(e,r,a,l,h,p){this.type=as,this.number=e,this.locale=r,this.currency=a,this.unit=l,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,St);if(!a)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,as),!h))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,as),!p))return null;let y=null;if(l.unit&&(y=r.parse(l.unit,1,as),!y))return null;let v=null;if(l["min-fraction-digits"]&&(v=r.parse(l["min-fraction-digits"],1,St),!v))return null;let b=null;return l["max-fraction-digits"]&&(b=r.parse(l["max-fraction-digits"],1,St),!b)?null:new fl(a,h,p,y,v,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ta{constructor(e){this.type=St,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Fs(a.type)} instead.`):new Ta(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Lr(`Expected value to be of type string or array, but found ${Fs(Zs(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Eu={"==":Em,"!=":Cm,">":Am,"<":km,">=":Tu,"<=":Mm,array:on,at:Sm,boolean:on,case:ju,coalesce:Fc,collator:mo,format:An,image:rl,in:ml,"index-of":wu,interpolate:qi,"interpolate-hcl":qi,"interpolate-lab":qi,length:Ta,let:bu,literal:Xn,match:Tm,number:on,"number-format":fl,object:on,slice:Nu,step:Mc,string:on,"to-boolean":_a,"to-color":_a,"to-number":_a,"to-string":_a,var:gu,within:al};function Cu(s,[e,r,a,l]){e=e.evaluate(s),r=r.evaluate(s),a=a.evaluate(s);const h=l?l.evaluate(s):1,p=hu(e,r,a,h);if(p)throw new Lr(p);return new Js(e/255*h,r/255*h,a/255*h,h)}function un(s,e){return s in e}function gl(s,e){const r=e[s];return r===void 0?null:r}function bi(s){return{type:s}}ln.register(Eu,{error:[{kind:"error"},[as],(s,[e])=>{throw new Lr(e.evaluate(s))}],typeof:[as,[rs],(s,[e])=>Fs(Zs(e.evaluate(s)))],"to-rgba":[_i(St,4),[ui],(s,[e])=>e.evaluate(s).toArray()],rgb:[ui,[St,St,St],Cu],rgba:[ui,[St,St,St,St],Cu],has:{type:ss,overloads:[[[as],(s,[e])=>un(e.evaluate(s),s.properties())],[[as,Pi],(s,[e,r])=>un(e.evaluate(s),r.evaluate(s))]]},get:{type:rs,overloads:[[[as],(s,[e])=>gl(e.evaluate(s),s.properties())],[[as,Pi],(s,[e,r])=>gl(e.evaluate(s),r.evaluate(s))]]},"feature-state":[rs,[as],(s,[e])=>gl(e.evaluate(s),s.featureState||{})],properties:[Pi,[],s=>s.properties()],"geometry-type":[as,[],s=>s.geometryType()],id:[rs,[],s=>s.id()],zoom:[St,[],s=>s.globals.zoom],pitch:[St,[],s=>s.globals.pitch||0],"distance-from-center":[St,[],s=>s.distanceFromCenter()],"heatmap-density":[St,[],s=>s.globals.heatmapDensity||0],"line-progress":[St,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[St,[],s=>s.globals.skyRadialProgress||0],accumulated:[rs,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[St,bi(St),(s,e)=>{let r=0;for(const a of e)r+=a.evaluate(s);return r}],"*":[St,bi(St),(s,e)=>{let r=1;for(const a of e)r*=a.evaluate(s);return r}],"-":{type:St,overloads:[[[St,St],(s,[e,r])=>e.evaluate(s)-r.evaluate(s)],[[St],(s,[e])=>-e.evaluate(s)]]},"/":[St,[St,St],(s,[e,r])=>e.evaluate(s)/r.evaluate(s)],"%":[St,[St,St],(s,[e,r])=>e.evaluate(s)%r.evaluate(s)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(s,[e,r])=>Math.pow(e.evaluate(s),r.evaluate(s))],sqrt:[St,[St],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[St,[St],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[St,[St],(s,[e])=>Math.log(e.evaluate(s))],log2:[St,[St],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[St,[St],(s,[e])=>Math.sin(e.evaluate(s))],cos:[St,[St],(s,[e])=>Math.cos(e.evaluate(s))],tan:[St,[St],(s,[e])=>Math.tan(e.evaluate(s))],asin:[St,[St],(s,[e])=>Math.asin(e.evaluate(s))],acos:[St,[St],(s,[e])=>Math.acos(e.evaluate(s))],atan:[St,[St],(s,[e])=>Math.atan(e.evaluate(s))],min:[St,bi(St),(s,e)=>Math.min(...e.map(r=>r.evaluate(s)))],max:[St,bi(St),(s,e)=>Math.max(...e.map(r=>r.evaluate(s)))],abs:[St,[St],(s,[e])=>Math.abs(e.evaluate(s))],round:[St,[St],(s,[e])=>{const r=e.evaluate(s);return r<0?-Math.round(-r):Math.round(r)}],floor:[St,[St],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[St,[St],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[ss,[as,rs],(s,[e,r])=>s.properties()[e.value]===r.value],"filter-id-==":[ss,[rs],(s,[e])=>s.id()===e.value],"filter-type-==":[ss,[as],(s,[e])=>s.geometryType()===e.value],"filter-<":[ss,[as,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[ss,[as,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[ss,[as,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[ss,[as,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[ss,[rs],(s,[e])=>e.value in s.properties()],"filter-has-id":[ss,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ss,[_i(as)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[ss,[_i(rs)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[ss,[as,_i(rs)],(s,[e,r])=>r.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[ss,[as,_i(rs)],(s,[e,r])=>function(a,l,h,p){for(;h<=p;){const y=h+p>>1;if(l[y]===a)return!0;l[y]>a?p=y-1:h=y+1}return!1}(s.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ss,overloads:[[[ss,ss],(s,[e,r])=>e.evaluate(s)&&r.evaluate(s)],[bi(ss),(s,e)=>{for(const r of e)if(!r.evaluate(s))return!1;return!0}]]},any:{type:ss,overloads:[[[ss,ss],(s,[e,r])=>e.evaluate(s)||r.evaluate(s)],[bi(ss),(s,e)=>{for(const r of e)if(r.evaluate(s))return!0;return!1}]]},"!":[ss,[ss],(s,[e])=>!e.evaluate(s)],"is-supported-script":[ss,[as],(s,[e])=>{const r=s.globals&&s.globals.isSupportedScript;return!r||r(e.evaluate(s))}],upcase:[as,[as],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[as,[as],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[as,bi(rs),(s,e)=>e.map(r=>ho(r.evaluate(s))).join("")],"resolved-locale":[as,[hi],(s,[e])=>e.evaluate(s).resolvedLocale()]});var bo=Eu;function ku(s){return{result:"success",value:s}}function Yn(s){return{result:"error",value:s}}function Ea(s){return s["property-type"]==="data-driven"}function xl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function yl(s){return!!s.expression&&s.expression.interpolated}function ms(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function wo(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Au(s){return s}function _l(s,e){const r=e.type==="color",a=s.stops&&typeof s.stops[0][0]=="object",l=a||!(a||s.property!==void 0),h=s.type||(yl(e)?"exponential":"interval");if(r&&((s=nn({},s)).stops&&(s.stops=s.stops.map(b=>[b[0],Js.parse(b[1])])),s.default=Js.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!zc[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let p,y,v;if(h==="exponential")p=hn;else if(h==="interval")p=vl;else if(h==="categorical"){p=Mu,y=Object.create(null);for(const b of s.stops)y[b[0]]=b[1];v=typeof s.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=Pu}if(a){const b={},T=[];for(let L=0;L<s.stops.length;L++){const R=s.stops[L],B=R[0].zoom;b[B]===void 0&&(b[B]={zoom:B,type:s.type,property:s.property,default:s.default,stops:[]},T.push(B)),b[B].stops.push([R[0].value,R[1]])}const k=[];for(const L of T)k.push([b[L].zoom,_l(b[L],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:qi.interpolationFactor.bind(void 0,M),zoomStops:k.map(L=>L[0]),evaluate:({zoom:L},R)=>hn({stops:k,base:s.base},e,L).evaluate(L,R)}}if(l){const b=h==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:qi.interpolationFactor.bind(void 0,b),zoomStops:s.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(s,e,T,y,v)}}return{kind:"source",evaluate(b,T){const k=T&&T.properties?T.properties[s.property]:void 0;return k===void 0?Ca(s.default,e.default):p(s,e,k,y,v)}}}function Ca(s,e,r){return s!==void 0?s:e!==void 0?e:r!==void 0?r:void 0}function Mu(s,e,r,a,l){return Ca(typeof r===l?a[r]:void 0,s.default,e.default)}function vl(s,e,r){if(ms(r)!=="number")return Ca(s.default,e.default);const a=s.stops.length;if(a===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[a-1][0])return s.stops[a-1][1];const l=ll(s.stops.map(h=>h[0]),r);return s.stops[l][1]}function hn(s,e,r){const a=s.base!==void 0?s.base:1;if(ms(r)!=="number")return Ca(s.default,e.default);const l=s.stops.length;if(l===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[l-1][0])return s.stops[l-1][1];const h=ll(s.stops.map(T=>T[0]),r),p=function(T,k,M,L){const R=L-M,B=T-M;return R===0?0:k===1?B/R:(Math.pow(k,B)-1)/(Math.pow(k,R)-1)}(r,a,s.stops[h][0],s.stops[h+1][0]),y=s.stops[h][1],v=s.stops[h+1][1];let b=go[e.type]||Au;if(s.colorSpace&&s.colorSpace!=="rgb"){const T=zc[s.colorSpace];b=(k,M)=>T.reverse(T.interpolate(T.forward(k),T.forward(M),p))}return typeof y.evaluate=="function"?{evaluate(...T){const k=y.evaluate.apply(void 0,T),M=v.evaluate.apply(void 0,T);if(k!==void 0&&M!==void 0)return b(k,M,p)}}:b(y,v,p)}function Pu(s,e,r){return e.type==="color"?r=Js.parse(r):e.type==="formatted"?r=ei.fromString(r.toString()):e.type==="resolvedImage"?r=vi.fromString(r.toString()):ms(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Ca(r,s.default,e.default)}class bl{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new jc,this._defaultValue=r?function(a){return a.type==="color"&&(wo(a.default)||Array.isArray(a.default))?new Js(0,0,0,0):a.type==="color"?Js.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,l,h,p,y,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,l,h,p,y,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=v||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Lr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function ka(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in bo}function Aa(s,e){const r=new kc(bo,[],e?function(l){const h={color:ui,string:as,number:St,enum:as,boolean:ss,formatted:no,resolvedImage:Hn};return l.type==="array"?_i(h[l.value]||rs,l.length):h[l.type]}(e):void 0),a=r.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?ku(new bl(a,e)):Yn(r.errors)}class $c{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!dn(r.expression)}evaluateWithoutErrorHandling(e,r,a,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,h,p)}evaluate(e,r,a,l,h,p){return this._styleExpression.evaluate(e,r,a,l,h,p)}}class jo{constructor(e,r,a,l){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!dn(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,a,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,h,p)}evaluate(e,r,a,l,h,p){return this._styleExpression.evaluate(e,r,a,l,h,p)}interpolationFactor(e,r,a){return this.interpolationType?qi.interpolationFactor(this.interpolationType,e,r,a):0}}function No(s,e){if((s=Aa(s,e)).result==="error")return s;const r=s.value.expression,a=ja(r);if(!a&&!Ea(e))return Yn([new Ui("","data expressions not supported")]);const l=Qn(r,["zoom","pitch","distance-from-center"]);if(!l&&!xl(e))return Yn([new Ui("","zoom expressions not supported")]);const h=jl(r);return h||l?h instanceof Ui?Yn([h]):h instanceof qi&&!yl(e)?Yn([new Ui("",'"interpolate" expressions cannot be used with this property')]):ku(h?new jo(a?"camera":"composite",s.value,h.labels,h instanceof qi?h.interpolation:void 0):new $c(a?"constant":"source",s.value)):Yn([new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class wl{constructor(e,r){this._parameters=e,this._specification=r,nn(this,_l(this._parameters,this._specification))}static deserialize(e){return new wl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function jl(s){let e=null;if(s instanceof bu)e=jl(s.result);else if(s instanceof Fc){for(const r of s.args)if(e=jl(r),e)break}else(s instanceof Mc||s instanceof qi)&&s.input instanceof ln&&s.input.name==="zoom"&&(e=s);return e instanceof Ui||s.eachChild(r=>{const a=jl(r);a instanceof Ui?e=a:!e&&a?e=new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Tt{constructor(e,r,a,l){this.message=(e?`${e}: `:"")+a,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ii(s){const e=s.key,r=s.value,a=s.valueSpec||{},l=s.objectElementValidators||{},h=s.style,p=s.styleSpec;let y=[];const v=ms(r);if(v!=="object")return[new Tt(e,r,`object expected, ${v} found`)];for(const b in r){const T=b.split(".")[0];let k;l[T]?k=l[T]:a[T]?k=Vr:l["*"]?k=l["*"]:a["*"]&&(k=Vr),k?y=y.concat(k({key:(e&&`${e}.`)+b,value:r[b],valueSpec:a[T]||a["*"],style:h,styleSpec:p,object:r,objectKey:b},r)):y.push(new Tt(e,r[b],`unknown property "${b}"`))}for(const b in a)l[b]||a[b].required&&a[b].default===void 0&&r[b]===void 0&&y.push(new Tt(e,r,`missing required property "${b}"`));return y}function Iu(s){const e=s.value,r=s.valueSpec,a=s.style,l=s.styleSpec,h=s.key,p=s.arrayElementValidator||Vr;if(ms(e)!=="array")return[new Tt(h,e,`array expected, ${ms(e)} found`)];if(r.length&&e.length!==r.length)return[new Tt(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Tt(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(y.function=r.function),ms(r.value)==="object"&&(y=r.value);let v=[];for(let b=0;b<e.length;b++)v=v.concat(p({array:e,arrayIndex:b,value:e[b],valueSpec:y,style:a,styleSpec:l,key:`${h}[${b}]`}));return v}function So(s){const e=s.key,r=s.value,a=s.valueSpec;let l=ms(r);if(l==="number"&&r!=r&&(l="NaN"),l!=="number")return[new Tt(e,r,`number expected, ${l} found`)];if("minimum"in a){let h=a.minimum;if(ms(a.minimum)==="array"&&(h=a.minimum[s.arrayIndex]),r<h)return[new Tt(e,r,`${r} is less than the minimum value ${h}`)]}if("maximum"in a){let h=a.maximum;if(ms(a.maximum)==="array"&&(h=a.maximum[s.arrayIndex]),r>h)return[new Tt(e,r,`${r} is greater than the maximum value ${h}`)]}return[]}function To(s){const e=s.valueSpec,r=ir(s.value.type);let a,l,h,p={};const y=r!=="categorical"&&s.value.property===void 0,v=!y,b=ms(s.value.stops)==="array"&&ms(s.value.stops[0])==="array"&&ms(s.value.stops[0][0])==="object",T=Ii({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new Tt(L.key,L.value,'identity function may not have a "stops" property')];let R=[];const B=L.value;return R=R.concat(Iu({key:L.key,value:B,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:k})),ms(B)==="array"&&B.length===0&&R.push(new Tt(L.key,B,"array must have at least one stop")),R},default:function(L){return Vr({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&y&&T.push(new Tt(s.key,s.value,'missing required property "property"')),r==="identity"||s.value.stops||T.push(new Tt(s.key,s.value,'missing required property "stops"')),r==="exponential"&&s.valueSpec.expression&&!yl(s.valueSpec)&&T.push(new Tt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(v&&!Ea(s.valueSpec)?T.push(new Tt(s.key,s.value,"property functions not supported")):y&&!xl(s.valueSpec)&&T.push(new Tt(s.key,s.value,"zoom functions not supported"))),r!=="categorical"&&!b||s.value.property!==void 0||T.push(new Tt(s.key,s.value,'"property" property is required')),T;function k(L){let R=[];const B=L.value,H=L.key;if(ms(B)!=="array")return[new Tt(H,B,`array expected, ${ms(B)} found`)];if(B.length!==2)return[new Tt(H,B,`array length 2 expected, length ${B.length} found`)];if(b){if(ms(B[0])!=="object")return[new Tt(H,B,`object expected, ${ms(B[0])} found`)];if(B[0].zoom===void 0)return[new Tt(H,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new Tt(H,B,"object stop key must have value")];const re=ir(B[0].zoom);if(typeof re!="number")return[new Tt(H,B[0].zoom,"stop zoom values must be numbers")];if(h&&h>re)return[new Tt(H,B[0].zoom,"stop zoom values must appear in ascending order")];re!==h&&(h=re,l=void 0,p={}),R=R.concat(Ii({key:`${H}[0]`,value:B[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:So,value:M}}))}else R=R.concat(M({key:`${H}[0]`,value:B[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},B));return ka(Sr(B[1]))?R.concat([new Tt(`${H}[1]`,B[1],"expressions are not allowed in function stops.")]):R.concat(Vr({key:`${H}[1]`,value:B[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function M(L,R){const B=ms(L.value),H=ir(L.value),re=L.value!==null?L.value:R;if(a){if(B!==a)return[new Tt(L.key,re,`${B} stop domain type must match previous stop domain type ${a}`)]}else a=B;if(B!=="number"&&B!=="string"&&B!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new Tt(L.key,re,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&r!=="categorical"){let pe=`number expected, ${B} found`;return Ea(e)&&r===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tt(L.key,re,pe)]}return r!=="categorical"||B!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?r!=="categorical"&&B==="number"&&typeof H=="number"&&typeof l=="number"&&l!==void 0&&H<l?[new Tt(L.key,re,"stop domain values must appear in ascending order")]:(l=H,r==="categorical"&&H in p?[new Tt(L.key,re,"stop domain values must be unique")]:(p[H]=!0,[])):[new Tt(L.key,re,`integer expected, found ${String(H)}`)]}}function Tr(s){const e=(s.expressionContext==="property"?No:Aa)(Sr(s.value),s.valueSpec);if(e.result==="error")return e.value.map(a=>new Tt(`${s.key}${a.key}`,s.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!r.outputDefined())return[new Tt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!dn(r))return[new Tt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return Eo(r,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Qn(r,["zoom","feature-state"]))return[new Tt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!ja(r))return[new Tt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Eo(s,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)r.delete(l);if(r.size===0)return[];const a=[];return s instanceof ln&&r.has(s.name)?[new Tt(e.key,e.value,`["${s.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(s.eachChild(l=>{a.push(...Eo(l,e))}),a)}function Nl(s){const e=s.key,r=s.value,a=s.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(ir(r))===-1&&l.push(new Tt(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ir(r))===-1&&l.push(new Tt(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Gc(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Gc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Sl(s,e="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gc(s)||(s=Pa(s));const r=s;let a=!0;try{a=function(b){if(!Ma(b))return b;let T=Sr(b);return Tl(T),T=Du(T),T}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=We[`filter_${e}`],h=Aa(a,l);let p=null;if(h.result==="error")throw new Error(h.value.map(b=>`${b.key}: ${b.message}`).join(", "));p=(b,T,k)=>h.value.evaluate(b,T,{},k);let y=null,v=null;if(a!==r){const b=Aa(r,l);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));y=(T,k,M,L,R)=>b.value.evaluate(T,k,{},M,void 0,void 0,L,R),v=!ja(b.value.expression)}return{filter:p,dynamicFilter:y||void 0,needGeometry:Lu(a),needFeature:!!v}}function Du(s){if(!Array.isArray(s))return s;const e=function(r){if(Zc.has(r[0])){for(let a=1;a<r.length;a++)if(Ma(r[a]))return!0}return r}(s);return e===!0?e:e.map(r=>Du(r))}function Tl(s){let e=!1;const r=[];if(s[0]==="case"){for(let a=1;a<s.length-1;a+=2)e=e||Ma(s[a]),r.push(s[a+1]);r.push(s[s.length-1])}else if(s[0]==="match"){e=e||Ma(s[1]);for(let a=2;a<s.length-1;a+=2)r.push(s[a+1]);r.push(s[s.length-1])}else if(s[0]==="step"){e=e||Ma(s[1]);for(let a=1;a<s.length-1;a+=2)r.push(s[a+1])}e&&(s.length=0,s.push("any",...r));for(let a=1;a<s.length;a++)Tl(s[a])}function Ma(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<s.length;r++)if(Ma(s[r]))return!0;return!1}const Zc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Pm(s,e){return s<e?-1:s>e?1:0}function Lu(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let e=1;e<s.length;e++)if(Lu(s[e]))return!0;return!1}function Pa(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Wc(s[1],s[2],"=="):e==="!="?El(Wc(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Wc(s[1],s[2],e):e==="any"?(r=s.slice(1),["any"].concat(r.map(Pa))):e==="all"?["all"].concat(s.slice(1).map(Pa)):e==="none"?["all"].concat(s.slice(1).map(Pa).map(El)):e==="in"?Hc(s[1],s.slice(2)):e==="!in"?El(Hc(s[1],s.slice(2))):e==="has"?Xc(s[1]):e==="!has"?El(Xc(s[1])):e!=="within"||s;var r}function Wc(s,e,r){switch(s){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,s,e]}}function Hc(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",s,["literal",e.sort(Pm)]]:["filter-in-small",s,["literal",e]]}}function Xc(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function El(s){return["!",s]}function Co(s){return Gc(Sr(s.value))?Tr(nn({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):ko(s)}function ko(s){const e=s.value,r=s.key;if(ms(e)!=="array")return[new Tt(r,e,`array expected, ${ms(e)} found`)];const a=s.styleSpec;let l,h=[];if(e.length<1)return[new Tt(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Nl({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:s.style,styleSpec:s.styleSpec})),ir(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ir(e[1])==="$type"&&h.push(new Tt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Tt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=ms(e[1]),l!=="string"&&h.push(new Tt(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=ms(e[p]),ir(e[1])==="$type"?h=h.concat(Nl({key:`${r}[${p}]`,value:e[p],valueSpec:a.geometry_type,style:s.style,styleSpec:s.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Tt(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(ko({key:`${r}[${p}]`,value:e[p],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":l=ms(e[1]),e.length!==2?h.push(new Tt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Tt(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=ms(e[1]),e.length!==2?h.push(new Tt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new Tt(`${r}[1]`,e[1],`object expected, ${l} found`))}return h}function Kc(s,e){const r=s.key,a=s.style,l=s.styleSpec,h=s.value,p=s.objectKey,y=l[`${e}_${s.layerType}`];if(!y)return[];const v=p.match(/^(.*)-transition$/);if(e==="paint"&&v&&y[v[1]]&&y[v[1]].transition)return Vr({key:r,value:h,valueSpec:l.transition,style:a,styleSpec:l});const b=s.valueSpec||y[p];if(!b)return[new Tt(r,h,`unknown property "${p}"`)];let T;if(ms(h)==="string"&&Ea(b)&&!b.tokens&&(T=/^{([^}]+)}$/.exec(h))){const M=`\`{ "type": "identity", "property": ${T?JSON.stringify(T[1]):'"_"'} }\``;return[new Tt(r,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: ${M}.`)]}const k=[];return s.layerType==="symbol"&&(p==="text-field"&&a&&!a.glyphs&&k.push(new Tt(r,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&wo(Sr(h))&&ir(h.type)==="identity"&&k.push(new Tt(r,h,'"text-font" does not support identity functions'))),k.concat(Vr({key:s.key,value:h,valueSpec:b,style:a,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function Ru(s){return Kc(s,"paint")}function Qc(s){return Kc(s,"layout")}function zu(s){let e=[];const r=s.value,a=s.key,l=s.style,h=s.styleSpec;r.type||r.ref||e.push(new Tt(a,r,'either "type" or "ref" is required'));let p=ir(r.type);const y=ir(r.ref);if(r.id){const v=ir(r.id);for(let b=0;b<s.arrayIndex;b++){const T=l.layers[b];ir(T.id)===v&&e.push(new Tt(a,r.id,`duplicate layer id "${r.id}", previously used at line ${T.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach(b=>{b in r&&e.push(new Tt(a,r[b],`"${b}" is prohibited for ref layers`))}),l.layers.forEach(b=>{ir(b.id)===y&&(v=b)}),v?v.ref?e.push(new Tt(a,r.ref,"ref cannot reference another ref layer")):p=ir(v.type):typeof y=="string"&&e.push(new Tt(a,r.ref,`ref layer "${y}" not found`))}else if(p!=="background"&&p!=="sky")if(r.source){const v=l.sources&&l.sources[r.source],b=v&&ir(v.type);v?b==="vector"&&p==="raster"?e.push(new Tt(a,r.source,`layer "${r.id}" requires a raster source`)):b==="raster"&&p!=="raster"?e.push(new Tt(a,r.source,`layer "${r.id}" requires a vector source`)):b!=="vector"||r["source-layer"]?b==="raster-dem"&&p!=="hillshade"?e.push(new Tt(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||b==="geojson"&&v.lineMetrics||e.push(new Tt(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Tt(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Tt(a,r.source,`source "${r.source}" not found`))}else e.push(new Tt(a,r,'missing required property "source"'));return e=e.concat(Ii({key:a,value:r,valueSpec:h.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Vr({key:`${a}.type`,value:r.type,valueSpec:h.layer.type,style:s.style,styleSpec:s.styleSpec,object:r,objectKey:"type"}),filter:v=>Co(nn({layerType:p},v)),layout:v=>Ii({layer:r,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>Qc(nn({layerType:p},b))}}),paint:v=>Ii({layer:r,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>Ru(nn({layerType:p},b))}})}})),e}function Mn(s){const e=s.value,r=s.key,a=ms(e);return a!=="string"?[new Tt(r,e,`string expected, ${a} found`)]:[]}const Ou={promoteId:function({key:s,value:e}){if(ms(e)==="string")return Mn({key:s,value:e});{const r=[];for(const a in e)r.push(...Mn({key:`${s}.${a}`,value:e[a]}));return r}}};function Fu(s){const e=s.value,r=s.key,a=s.styleSpec,l=s.style;if(!e.type)return[new Tt(r,e,'"type" is required')];const h=ir(e.type);let p;switch(h){case"vector":case"raster":case"raster-dem":return p=Ii({key:r,value:e,valueSpec:a[`source_${h.replace("-","_")}`],style:s.style,styleSpec:a,objectElementValidators:Ou}),p;case"geojson":if(p=Ii({key:r,value:e,valueSpec:a.source_geojson,style:l,styleSpec:a,objectElementValidators:Ou}),e.cluster)for(const y in e.clusterProperties){const[v,b]=e.clusterProperties[y],T=typeof v=="string"?[v,["accumulated"],["get",y]]:v;p.push(...Tr({key:`${r}.${y}.map`,value:b,expressionContext:"cluster-map"})),p.push(...Tr({key:`${r}.${y}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return p;case"video":return Ii({key:r,value:e,valueSpec:a.source_video,style:l,styleSpec:a});case"image":return Ii({key:r,value:e,valueSpec:a.source_image,style:l,styleSpec:a});case"canvas":return[new Tt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nl({key:`${r}.type`,value:e.type,valueSpec:{values:Im(a)},style:l,styleSpec:a})}}function Im(s){return s.source.reduce((e,r)=>{const a=s[r];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Bu(s){const e=s.value,r=s.styleSpec,a=r.light,l=s.style;let h=[];const p=ms(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Tt("light",e,`object expected, ${p} found`)]),h;for(const y in e){const v=y.match(/^(.*)-transition$/);h=h.concat(v&&a[v[1]]&&a[v[1]].transition?Vr({key:y,value:e[y],valueSpec:r.transition,style:l,styleSpec:r}):a[y]?Vr({key:y,value:e[y],valueSpec:a[y],style:l,styleSpec:r}):[new Tt(y,e[y],`unknown property "${y}"`)])}return h}function Jc(s){const e=s.value,r=s.key,a=s.style,l=s.styleSpec,h=l.terrain;let p=[];const y=ms(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new Tt("terrain",e,`object expected, ${y} found`)]),p;for(const v in e){const b=v.match(/^(.*)-transition$/);p=p.concat(b&&h[b[1]]&&h[b[1]].transition?Vr({key:v,value:e[v],valueSpec:l.transition,style:a,styleSpec:l}):h[v]?Vr({key:v,value:e[v],valueSpec:h[v],style:a,styleSpec:l}):[new Tt(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=a.sources&&a.sources[e.source],b=v&&ir(v.type);v?b!=="raster-dem"&&p.push(new Tt(r,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):p.push(new Tt(r,e.source,`source "${e.source}" not found`))}else p.push(new Tt(r,e,'terrain is missing required property "source"'));return p}function Uu(s){const e=s.value,r=s.style,a=s.styleSpec,l=a.fog;let h=[];const p=ms(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Tt("fog",e,`object expected, ${p} found`)]),h;for(const y in e){const v=y.match(/^(.*)-transition$/);h=h.concat(v&&l[v[1]]&&l[v[1]].transition?Vr({key:y,value:e[y],valueSpec:a.transition,style:r,styleSpec:a}):l[y]?Vr({key:y,value:e[y],valueSpec:l[y],style:r,styleSpec:a}):[new Tt(y,e[y],`unknown property "${y}"`)])}return h}const Vu={"*":()=>[],array:Iu,boolean:function(s){const e=s.value,r=s.key,a=ms(e);return a!=="boolean"?[new Tt(r,e,`boolean expected, ${a} found`)]:[]},number:So,color:function(s){const e=s.key,r=s.value,a=ms(r);return a!=="string"?[new Tt(e,r,`color expected, ${a} found`)]:gc(r)===null?[new Tt(e,r,`color expected, "${r}" found`)]:[]},enum:Nl,filter:Co,function:To,layer:zu,object:Ii,source:Fu,light:Bu,terrain:Jc,fog:Uu,string:Mn,formatted:function(s){return Mn(s).length===0?[]:Tr(s)},resolvedImage:function(s){return Mn(s).length===0?[]:Tr(s)},projection:function(s){const e=s.value,r=s.styleSpec,a=r.projection,l=s.style;let h=[];const p=ms(e);if(p==="object")for(const y in e)h=h.concat(Vr({key:y,value:e[y],valueSpec:a[y],style:l,styleSpec:r}));else p!=="string"&&(h=h.concat([new Tt("projection",e,`object or string expected, ${p} found`)]));return h}};function Vr(s){const e=s.value,r=s.valueSpec,a=s.styleSpec;return r.expression&&wo(ir(e))?To(s):r.expression&&ka(Sr(e))?Tr(s):r.type&&Vu[r.type]?Vu[r.type](s):Ii(nn({},s,{valueSpec:r.type?a[r.type]:r}))}function Dm(s){const e=s.value,r=s.key,a=Mn(s);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Tt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Tt(r,e,'"glyphs" url must include a "{range}" token'))),a}function qu(s,e=We){return wi(Vr({key:"",value:s,valueSpec:e.$root,styleSpec:e,style:s,objectElementValidators:{glyphs:Dm,"*":()=>[]}}))}const Lm=s=>wi(Ru(s)),Rm=s=>wi(Qc(s));function wi(s){return s.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function $u(s,e){let r=!1;if(e&&e.length)for(const a of e)s.fire(new rn(new Error(a.message))),r=!0;return r}var zm=$i,Di=3;function $i(s,e,r){var a=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var l=new Int32Array(this.arrayBuffer);s=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var h=0;h<this.d*this.d;h++){var p=l[Di+h],y=l[Di+h+1];a.push(p===y?null:l.subarray(p,y))}var v=l[Di+a.length+1];this.keys=l.subarray(l[Di+a.length],v),this.bboxes=l.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=s,this.padding=r,this.scale=e/s,this.uid=0;var T=r/e*s;this.min=-T,this.max=s+T}$i.prototype.insert=function(s,e,r,a,l){this._forEachCell(e,r,a,l,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l)},$i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},$i.prototype._insertCell=function(s,e,r,a,l,h){this.cells[l].push(h)},$i.prototype.query=function(s,e,r,a,l){var h=this.min,p=this.max;if(s<=h&&e<=h&&p<=r&&p<=a&&!l)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(s,e,r,a,this._queryCell,y,{},l),y},$i.prototype._queryCell=function(s,e,r,a,l,h,p,y){var v=this.cells[l];if(v!==null)for(var b=this.keys,T=this.bboxes,k=0;k<v.length;k++){var M=v[k];if(p[M]===void 0){var L=4*M;(y?y(T[L+0],T[L+1],T[L+2],T[L+3]):s<=T[L+2]&&e<=T[L+3]&&r>=T[L+0]&&a>=T[L+1])?(p[M]=!0,h.push(b[M])):p[M]=!1}}},$i.prototype._forEachCell=function(s,e,r,a,l,h,p,y){for(var v=this._convertToCellCoord(s),b=this._convertToCellCoord(e),T=this._convertToCellCoord(r),k=this._convertToCellCoord(a),M=v;M<=T;M++)for(var L=b;L<=k;L++){var R=this.d*L+M;if((!y||y(this._convertFromCellCoord(M),this._convertFromCellCoord(L),this._convertFromCellCoord(M+1),this._convertFromCellCoord(L+1)))&&l.call(this,s,e,r,a,R,h,p,y))return}},$i.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},$i.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},$i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,e=Di+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var h=e,p=0;p<s.length;p++){var y=s[p];l[Di+p]=h,l.set(y,h),h+=y.length}return l[Di+s.length]=h,l.set(this.keys,h),l[Di+s.length+1]=h+=this.keys.length,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer};var ea=Ne(zm);const Cl={};function Et(s,e,r={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writeable:!1}),Cl[e]={klass:s,omit:r.omit||[]}}Et(Object,"Object"),ea.serialize=function(s,e){const r=s.toArrayBuffer();return e&&e.push(r),{buffer:r}},ea.deserialize=function(s){return new ea(s.buffer)},Object.defineProperty(ea,"name",{value:"Grid"}),Et(ea,"Grid"),Et(Js,"Color"),Et(Error,"Error"),Et(yi,"AJAXError"),Et(vi,"ResolvedImage"),Et(wl,"StylePropertyFunction"),Et(bl,"StyleExpression",{omit:["_evaluator"]}),Et(jo,"ZoomDependentExpression"),Et($c,"ZoomConstantExpression"),Et(ln,"CompoundExpression",{omit:["_evaluate"]});for(const s in bo)Cl[bo[s]._classRegistryKey]||Et(bo[s],`Expression${s}`);function Yc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function ed(s){return P.ImageBitmap&&s instanceof P.ImageBitmap}function Ia(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Yc(s)||ed(s))return e&&e.push(s),s;if(ArrayBuffer.isView(s)){const r=s;return e&&e.push(r.buffer),r}if(s instanceof P.ImageData)return e&&e.push(s.data.buffer),s;if(Array.isArray(s)){const r=[];for(const a of s)r.push(Ia(a,e));return r}if(typeof s=="object"){const r=s.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const l=r.serialize?r.serialize(s,e):{};if(!r.serialize){for(const h in s)s.hasOwnProperty(h)&&(Cl[a].omit.indexOf(h)>=0||(l[h]=Ia(s[h],e)));s instanceof Error&&(l.message=s.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(l.$name=a),l}throw new Error("can't serialize object of type "+typeof s)}function ta(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Yc(s)||ed(s)||ArrayBuffer.isView(s)||s instanceof P.ImageData)return s;if(Array.isArray(s))return s.map(ta);if(typeof s=="object"){const e=s.$name||"Object",{klass:r}=Cl[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(s);const a=Object.create(r.prototype);for(const l of Object.keys(s))l!=="$name"&&(a[l]=ta(s[l]));return a}throw new Error("can't deserialize object of type "+typeof s)}const jt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function td(s){for(const e of s)if(sd(e.charCodeAt(0)))return!0;return!1}function Om(s){for(const e of s)if(!Gu(e.charCodeAt(0)))return!1;return!0}function Gu(s){return!(jt.Arabic(s)||jt["Arabic Supplement"](s)||jt["Arabic Extended-A"](s)||jt["Arabic Presentation Forms-A"](s)||jt["Arabic Presentation Forms-B"](s))}function sd(s){return!(s!==746&&s!==747&&(s<4352||!(jt["Bopomofo Extended"](s)||jt.Bopomofo(s)||jt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||jt["CJK Compatibility Ideographs"](s)||jt["CJK Compatibility"](s)||jt["CJK Radicals Supplement"](s)||jt["CJK Strokes"](s)||!(!jt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||jt["CJK Unified Ideographs Extension A"](s)||jt["CJK Unified Ideographs"](s)||jt["Enclosed CJK Letters and Months"](s)||jt["Hangul Compatibility Jamo"](s)||jt["Hangul Jamo Extended-A"](s)||jt["Hangul Jamo Extended-B"](s)||jt["Hangul Jamo"](s)||jt["Hangul Syllables"](s)||jt.Hiragana(s)||jt["Ideographic Description Characters"](s)||jt.Kanbun(s)||jt["Kangxi Radicals"](s)||jt["Katakana Phonetic Extensions"](s)||jt.Katakana(s)&&s!==12540||!(!jt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!jt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||jt["Unified Canadian Aboriginal Syllabics"](s)||jt["Unified Canadian Aboriginal Syllabics Extended"](s)||jt["Vertical Forms"](s)||jt["Yijing Hexagram Symbols"](s)||jt["Yi Syllables"](s)||jt["Yi Radicals"](s))))}function Zu(s){return!(sd(s)||function(e){return!!(jt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||jt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||jt["Letterlike Symbols"](e)||jt["Number Forms"](e)||jt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||jt["Control Pictures"](e)&&e!==9251||jt["Optical Character Recognition"](e)||jt["Enclosed Alphanumerics"](e)||jt["Geometric Shapes"](e)||jt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||jt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||jt["CJK Symbols and Punctuation"](e)||jt.Katakana(e)||jt["Private Use Area"](e)||jt["CJK Compatibility Forms"](e)||jt["Small Form Variants"](e)||jt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Wu(s){return s>=1424&&s<=2303||jt["Arabic Presentation Forms-A"](s)||jt["Arabic Presentation Forms-B"](s)}function Fm(s,e){return!(!e&&Wu(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||jt.Khmer(s))}function Bm(s){for(const e of s)if(Wu(e.charCodeAt(0)))return!0;return!1}const rd="deferred",id="loading",nd="loaded";let Da=null,d="unavailable",i=null;const o=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(d="error"),Da&&Da(s)};function m(){g.fire(new Wn("pluginStateChange",{pluginStatus:d,pluginURL:i}))}const g=new io,_=function(){return d},j=function(){if(d!==rd||!i)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=id,m(),i&&tn({url:i},s=>{s?o(s):(d=nd,m())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===nd||S.applyArabicShaping!=null,isLoading:()=>d===id,setState(s){d=s.pluginStatus,i=s.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>i};class C{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,a){for(const l of r)if(!Fm(l.charCodeAt(0),a))return!1;return!0}(e,S.isLoaded())}}class D{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,l){if(wo(a))return new wl(a,l);if(ka(a)){const h=No(a,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=a;return typeof a=="string"&&l.type==="color"&&(h=Js.parse(a)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class I{constructor(e){this.property=e,this.value=new D(e,void 0)}transitioned(e,r){return new G(this.property,this.value,r,Ut({},e.transition,this.transition),e.now)}untransitioned(){return new G(this.property,this.value,null,{},0)}}class O{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return vr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].value=new D(this._values[e].property,r===null?void 0:vr(r))}getTransition(e){return vr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].transition=vr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const a=new Q(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(e,r._values[l]);return a}untransitioned(){const e=new Q(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class G{constructor(e,r,a,l,h){const p=l.delay||0,y=l.duration||0;h=h||0,this.property=e,this.value=r,this.begin=h+p,this.end=this.begin+y,e.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const l=e.now||0,h=this.value.possiblyEvaluate(e,r,a),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,r,a);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,a),h,Nt(y))}}return h}}class Q{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const l=new se(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,a);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return vr(this._values[e].value)}setValue(e,r){this._values[e]=new D(this._values[e].property,r===null?void 0:vr(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const l=new se(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,a);return l}}class Y{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,l){return this.property.evaluate(this.value,this.parameters,e,r,a,l)}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class F{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const l=go[this.specification.type];return l?l(e,r,a):e}}class K{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,l){return new Y(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,l)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Y(this,{kind:"constant",value:void 0},e.parameters);const l=go[this.specification.type];return l?new Y(this,{kind:"constant",value:l(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,l,h,p){return e.kind==="constant"?e.value:e.evaluate(r,a,l,h,p)}}class ae{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,l){return!!e.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class le{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new C(0,{});for(const a in e){const l=e[a];l.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new D(l,void 0),p=this.defaultTransitionablePropertyValues[a]=new I(l);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate(r)}}}function _e(s,e){return 256*(s=ht(Math.floor(s),0,255))+ht(Math.floor(e),0,255)}Et(K,"DataDrivenProperty"),Et(F,"DataConstantProperty"),Et(ae,"ColorRampProperty");const be={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ve{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Me{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ke(s,e=1){let r=0,a=0;return{members:s.map(l=>{const h=be[l.type].BYTES_PER_ELEMENT,p=r=Be(r,Math.max(e,h)),y=l.components||1;return a=Math.max(a,h),r+=h*y,{name:l.name,type:l.type,components:y,offset:p}}),size:Be(r,Math.max(a,e)),alignment:e}}function Be(s,e){return Math.ceil(s/e)*e}class at extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=a,e}}at.prototype.bytesPerElement=4,Et(at,"StructArrayLayout2i4");class ze extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=a,this.int16[h+2]=l,e}}ze.prototype.bytesPerElement=6,Et(ze,"StructArrayLayout3i6");class Qe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=l,this.int16[p+3]=h,e}}Qe.prototype.bytesPerElement=8,Et(Qe,"StructArrayLayout4i8");class Ve extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,l,h,p,y)}emplace(e,r,a,l,h,p,y,v){const b=6*e,T=12*e,k=3*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.uint8[T+4]=l,this.uint8[T+5]=h,this.uint8[T+6]=p,this.uint8[T+7]=y,this.float32[k+2]=v,e}}Ve.prototype.bytesPerElement=12,Et(Ve,"StructArrayLayout2i4ub1f12");class nt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=l,this.float32[p+3]=h,e}}nt.prototype.bytesPerElement=16,Et(nt,"StructArrayLayout4f16");class Fe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=6*e,v=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=a,this.uint16[y+2]=l,this.uint16[y+3]=h,this.float32[v+2]=p,e}}Fe.prototype.bytesPerElement=12,Et(Fe,"StructArrayLayout4ui1f12");class Xe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=l,this.uint16[p+3]=h,e}}Xe.prototype.bytesPerElement=8,Et(Xe,"StructArrayLayout4ui8");class lt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,l,h,p)}emplace(e,r,a,l,h,p,y){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=l,this.int16[v+3]=h,this.int16[v+4]=p,this.int16[v+5]=y,e}}lt.prototype.bytesPerElement=12,Et(lt,"StructArrayLayout6i12");class st extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,v,b,T,k,M){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,l,h,p,y,v,b,T,k,M)}emplace(e,r,a,l,h,p,y,v,b,T,k,M,L){const R=12*e;return this.int16[R+0]=r,this.int16[R+1]=a,this.int16[R+2]=l,this.int16[R+3]=h,this.uint16[R+4]=p,this.uint16[R+5]=y,this.uint16[R+6]=v,this.uint16[R+7]=b,this.int16[R+8]=T,this.int16[R+9]=k,this.int16[R+10]=M,this.int16[R+11]=L,e}}st.prototype.bytesPerElement=24,Et(st,"StructArrayLayout4i4ui4i24");class dt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,l,h,p)}emplace(e,r,a,l,h,p,y){const v=10*e,b=5*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=l,this.float32[b+2]=h,this.float32[b+3]=p,this.float32[b+4]=y,e}}dt.prototype.bytesPerElement=20,Et(dt,"StructArrayLayout3i3f20");class Dt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Dt.prototype.bytesPerElement=4,Et(Dt,"StructArrayLayout1ul4");class Vt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,v,b,T,k,M,L){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,a,l,h,p,y,v,b,T,k,M,L)}emplace(e,r,a,l,h,p,y,v,b,T,k,M,L,R){const B=20*e,H=10*e;return this.int16[B+0]=r,this.int16[B+1]=a,this.int16[B+2]=l,this.int16[B+3]=h,this.int16[B+4]=p,this.float32[H+3]=y,this.float32[H+4]=v,this.float32[H+5]=b,this.float32[H+6]=T,this.int16[B+14]=k,this.uint32[H+8]=M,this.uint16[B+18]=L,this.uint16[B+19]=R,e}}Vt.prototype.bytesPerElement=40,Et(Vt,"StructArrayLayout5i4f1i1ul2ui40");class kt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,l,h,p,y)}emplace(e,r,a,l,h,p,y,v){const b=8*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+4]=h,this.int16[b+5]=p,this.int16[b+6]=y,this.int16[b+7]=v,e}}kt.prototype.bytesPerElement=16,Et(kt,"StructArrayLayout3i2i2i16");class Ot extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=4*e,v=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=l,this.int16[v+6]=h,this.int16[v+7]=p,e}}Ot.prototype.bytesPerElement=16,Et(Ot,"StructArrayLayout2f1f2i16");class is extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=12*e,y=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=a,this.float32[y+1]=l,this.float32[y+2]=h,e}}is.prototype.bytesPerElement=12,Et(is,"StructArrayLayout2ub2f12");class ts extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=a,this.float32[h+2]=l,e}}ts.prototype.bytesPerElement=12,Et(ts,"StructArrayLayout3f12");class Pt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=a,this.uint16[h+2]=l,e}}Pt.prototype.bytesPerElement=6,Et(Pt,"StructArrayLayout3ui6");class bs extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,v,b,T,k,M,L,R,B,H,re,pe,ie,ue,xe){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,r,a,l,h,p,y,v,b,T,k,M,L,R,B,H,re,pe,ie,ue,xe)}emplace(e,r,a,l,h,p,y,v,b,T,k,M,L,R,B,H,re,pe,ie,ue,xe,ge){const Ue=30*e,Oe=15*e,He=60*e;return this.int16[Ue+0]=r,this.int16[Ue+1]=a,this.int16[Ue+2]=l,this.float32[Oe+2]=h,this.float32[Oe+3]=p,this.uint16[Ue+8]=y,this.uint16[Ue+9]=v,this.uint32[Oe+5]=b,this.uint32[Oe+6]=T,this.uint32[Oe+7]=k,this.uint16[Ue+16]=M,this.uint16[Ue+17]=L,this.uint16[Ue+18]=R,this.float32[Oe+10]=B,this.float32[Oe+11]=H,this.uint8[He+48]=re,this.uint8[He+49]=pe,this.uint8[He+50]=ie,this.uint32[Oe+13]=ue,this.int16[Ue+28]=xe,this.uint8[He+58]=ge,e}}bs.prototype.bytesPerElement=60,Et(bs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ws extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,v,b,T,k,M,L,R,B,H,re,pe,ie,ue,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,rt){const mt=this.length;return this.resize(mt+1),this.emplace(mt,e,r,a,l,h,p,y,v,b,T,k,M,L,R,B,H,re,pe,ie,ue,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,rt)}emplace(e,r,a,l,h,p,y,v,b,T,k,M,L,R,B,H,re,pe,ie,ue,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,rt,mt){const Ze=38*e,vt=19*e;return this.int16[Ze+0]=r,this.int16[Ze+1]=a,this.int16[Ze+2]=l,this.float32[vt+2]=h,this.float32[vt+3]=p,this.int16[Ze+8]=y,this.int16[Ze+9]=v,this.int16[Ze+10]=b,this.int16[Ze+11]=T,this.int16[Ze+12]=k,this.int16[Ze+13]=M,this.uint16[Ze+14]=L,this.uint16[Ze+15]=R,this.uint16[Ze+16]=B,this.uint16[Ze+17]=H,this.uint16[Ze+18]=re,this.uint16[Ze+19]=pe,this.uint16[Ze+20]=ie,this.uint16[Ze+21]=ue,this.uint16[Ze+22]=xe,this.uint16[Ze+23]=ge,this.uint16[Ze+24]=Ue,this.uint16[Ze+25]=Oe,this.uint16[Ze+26]=He,this.uint16[Ze+27]=ot,this.uint16[Ze+28]=qe,this.uint32[vt+15]=Je,this.float32[vt+16]=Ye,this.float32[vt+17]=rt,this.float32[vt+18]=mt,e}}ws.prototype.bytesPerElement=76,Et(ws,"StructArrayLayout3i2f6i15ui1ul3f76");class js extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}js.prototype.bytesPerElement=4,Et(js,"StructArrayLayout1f4");class Ns extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=l,this.float32[y+3]=h,this.float32[y+4]=p,e}}Ns.prototype.bytesPerElement=20,Et(Ns,"StructArrayLayout5f20");class qr extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=l,this.uint16[p+4]=h,e}}qr.prototype.bytesPerElement=12,Et(qr,"StructArrayLayout1ul3ui12");class Er extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=a,e}}Er.prototype.bytesPerElement=4,Et(Er,"StructArrayLayout2ui4");class ji extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ji.prototype.bytesPerElement=2,Et(ji,"StructArrayLayout1ui2");class Gi extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=a,e}}Gi.prototype.bytesPerElement=8,Et(Gi,"StructArrayLayout2f8");class Bs extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Bs.prototype.size=40;class Ss extends Vt{get(e){return new Bs(this,e)}}Et(Ss,"CollisionBoxArray");class fs extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}fs.prototype.size=60;class nr extends bs{get(e){return new fs(this,e)}}Et(nr,"PlacedSymbolArray");class Xr extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Xr.prototype.size=76;class zs extends ws{get(e){return new Xr(this,e)}}Et(zs,"SymbolInstanceArray");class ti extends js{getoffsetX(e){return this.float32[1*e+0]}}Et(ti,"GlyphOffsetArray");class kl extends at{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Et(kl,"SymbolLineVertexArray");class sa extends ve{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sa.prototype.size=12;class Ao extends qr{get(e){return new sa(this,e)}}Et(Ao,"FeatureIndexArray");class mn extends Er{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Et(mn,"FillExtrusionCentroidArray");const Pn=ke([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ra=ke([{name:"a_dash",components:4,type:"Uint16"}]);var Al={exports:{}},Mo={exports:{}};Mo.exports=function(s,e){var r,a,l,h,p,y,v,b;for(a=s.length-(r=3&s.length),l=e,p=3432918353,y=461845907,b=0;b<a;)v=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24,++b,l=27492+(65535&(h=5*(65535&(l=(l^=v=(65535&(v=(v=(65535&v)*p+(((v>>>16)*p&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(v=0,r){case 3:v^=(255&s.charCodeAt(b+2))<<16;case 2:v^=(255&s.charCodeAt(b+1))<<8;case 1:l^=v=(65535&(v=(v=(65535&(v^=255&s.charCodeAt(b)))*p+(((v>>>16)*p&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295}return l^=s.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var ad=Mo.exports,rg={exports:{}};rg.exports=function(s,e){for(var r,a=s.length,l=e^a,h=0;a>=4;)r=1540483477*(65535&(r=255&s.charCodeAt(h)|(255&s.charCodeAt(++h))<<8|(255&s.charCodeAt(++h))<<16|(255&s.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++h;switch(a){case 3:l^=(255&s.charCodeAt(h+2))<<16;case 2:l^=(255&s.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&s.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var ig=ad,Fv=rg.exports;Al.exports=ig,Al.exports.murmur3=ig,Al.exports.murmur2=Fv;var Um=Ne(Al.exports);class Hu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,l){this.ids.push(ng(e)),this.positions.push(r,a,l)}getPositions(e){const r=ng(e);let a=0,l=this.ids.length-1;for(;a<l;){const p=a+l>>1;this.ids[p]>=r?l=p:a=p+1}const h=[];for(;this.ids[a]===r;)h.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return h}static serialize(e,r){const a=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Vm(a,l,0,a.length-1),r&&r.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(e){const r=new Hu;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ng(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Um(String(s))}function Vm(s,e,r,a){for(;r<a;){const l=s[r+a>>1];let h=r-1,p=a+1;for(;;){do h++;while(s[h]<l);do p--;while(s[p]>l);if(h>=p)break;Xu(s,h,p),Xu(e,3*h,3*p),Xu(e,3*h+1,3*p+1),Xu(e,3*h+2,3*p+2)}p-r<a-p?(Vm(s,e,r,p),r=p+1):(Vm(s,e,p+1,a),a=p)}}function Xu(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}Et(Hu,"FeaturePositionMap");class ia{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class Ku extends ia{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ag extends ia{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class og extends ia{constructor(e){super(e),this.current=Js.transparent}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Bv=new Float32Array(16),Uv=new Float32Array(9),Vv=new Float32Array(4);function qm(s){return[_e(255*s.r,255*s.g),_e(255*s.b,255*s.a)]}class od{constructor(e,r,a){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(e,r,a,l,h){r.set(e,h,l.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new og(e):new Ku(e)}}class Ml{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,l,h){const p=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;p&&r.set(e,h,p)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new ag(e):new Ku(e)}}class na{constructor(e,r,a,l){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,a,l,h,p){const y=this.paintVertexArray.length,v=this.expression.evaluate(new C(0),r,{},h,l,p);this.paintVertexArray.resize(e),this._setPaintValue(y,e,v)}updatePaintArray(e,r,a,l,h){const p=this.expression.evaluate({zoom:0},a,l,void 0,h);this._setPaintValue(e,r,p)}_setPaintValue(e,r,a){if(this.type==="color"){const l=qm(a);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pn{constructor(e,r,a,l,h,p){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,a,l,h,p){const y=this.expression.evaluate(new C(this.zoom),r,{},h,l,p),v=this.expression.evaluate(new C(this.zoom+1),r,{},h,l,p),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,y,v)}updatePaintArray(e,r,a,l,h){const p=this.expression.evaluate({zoom:this.zoom},a,l,void 0,h),y=this.expression.evaluate({zoom:this.zoom+1},a,l,void 0,h);this._setPaintValue(e,r,p,y)}_setPaintValue(e,r,a,l){if(this.type==="color"){const h=qm(a),p=qm(l);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,l,h){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=ht(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(e,h,y)}getBinding(e,r){return new Ku(e)}}class La{constructor(e,r,a,l,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(a==="array"?ra:Pn).members;for(let p=0;p<r.length;++p);this.paintVertexArray=new l}populatePaintArray(e,r,a){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,l,h,p){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,r,a,l){if(!l||!a)return;const h=l[a];if(!h)return;const{tl:p,br:y,pixelRatio:v}=h;for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,p[0],p[1],y[0],y[1],v)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ra{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!a(h))continue;const p=e.paint.get(h);if(!(p instanceof Y&&Ea(p.property.specification)))continue;const y=$v(h,e.type),v=p.value,b=p.property.specification.type,T=!!p.property.useIntegerZoom,k=h==="line-dasharray"||h.endsWith("pattern"),M=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||M)if(v.kind==="source"||M||k){const L=lg(h,b,"source");this.binders[h]=k?new La(v,y,b,L,e.id):new na(v,y,b,L),l.push(`/a_${h}`)}else{const L=lg(h,b,"composite");this.binders[h]=new pn(v,y,b,T,r,L),l.push(`/z_${h}`)}else this.binders[h]=k?new Ml(v.value,y):new od(v.value,y,b),l.push(`/u_${h}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof na||r instanceof pn?r.maxValue:0}populatePaintArrays(e,r,a,l,h,p){for(const y in this.binders){const v=this.binders[y];(v instanceof na||v instanceof pn||v instanceof La)&&v.populatePaintArray(e,r,a,l,h,p)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof Ml&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,l,h,p){let y=!1;for(const v in e){const b=r.getPositions(v);for(const T of b){const k=a.feature(T.index);for(const M in this.binders){const L=this.binders[M];if((L instanceof na||L instanceof pn||L instanceof La)&&L.expression.isStateDependent===!0){const R=l.paint.get(M);L.expression=R.value,L.updatePaintArray(T.start,T.end,k,e[v],h,p),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof od||a instanceof Ml)&&e.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof na||a instanceof pn||a instanceof La)for(let l=0;l<a.paintVertexAttributes.length;l++)e.push(a.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof od||a instanceof Ml||a instanceof pn)for(const l of a.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof od||l instanceof Ml||l instanceof pn)for(const h of l.uniformNames)r.push({name:h,property:a,binding:l.getBinding(e,h)})}return r}setUniforms(e,r,a,l,h){for(const{name:p,property:y,binding:v}of a)this.binders[y].setUniform(e,v,h,l.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof na||r instanceof pn||r instanceof La)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof na||a instanceof pn||a instanceof La)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof na||r instanceof pn||r instanceof La)&&r.destroy()}}}class Po{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ra(l,r,a);this.needsUpload=!1,this._featureMap=new Hu,this._bufferOffset=0}populatePaintArrays(e,r,a,l,h,p,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,l,h,p,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,l,h){for(const p of a)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,l,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function $v(s,e){return qv[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const Gv={"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe},"line-dasharray":{source:Xe,composite:Xe}},Zv={color:{source:Gi,composite:nt},number:{source:js,composite:Gi}};function lg(s,e,r){const a=Gv[s];return a&&a[r]||Zv[e][r]}Et(od,"ConstantBinder"),Et(Ml,"PatternConstantBinder"),Et(na,"SourceExpressionBinder"),Et(La,"PatternCompositeBinder"),Et(pn,"CompositeExpressionBinder"),Et(Ra,"ProgramConfiguration",{omit:["_buffers"]}),Et(Po,"ProgramConfigurationSet");const cg="-transition";class fn extends io{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ee(r.layout)),r.paint)){this._transitionablePaint=new O(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Rm,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Jr(e,cg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Lm,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(Jr(e,cg))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.value.isDataDriven(),p=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,v=y.isDataDriven(),b=Jr(e,"pattern")||e==="line-dasharray";return v||h||b||this._handleOverridablePaintPropertyUpdate(e,p,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),gi(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,l,h={}){return(!h||h.validate!==!1)&&$u(this,e.call(qu,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:We,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Y&&Ea(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wv=ke([{name:"a_pos",components:2,type:"Int16"}],4),Hv=ke([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ar{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,l){let h=this.segments[this.segments.length-1];return e>ar.MAX_VERTEX_ARRAY_LENGTH&&As(`Max vertices per segment is ${ar.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ar.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,l){return new ar([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}ar.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et(ar,"SegmentVector");var zt=8192;class za{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ts?new Ts(e.lng,e.lat):Ts.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ts?new Ts(e.lng,e.lat):Ts.convert(e),this}extend(e){const r=this._sw,a=this._ne;let l,h;if(e instanceof Ts)l=e,h=e;else{if(!(e instanceof za))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(za.convert(e)):this.extend(Ts.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Ts.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return r||a?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new Ts(l.lng,l.lat),this._ne=new Ts(h.lng,h.lat)),this}getCenter(){return new Ts((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ts(this.getWest(),this.getNorth())}getSouthEast(){return new Ts(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=Ts.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return!e||e instanceof za?e:new za(e)}}var Qu=1e-6,Ni=typeof Float32Array<"u"?Float32Array:Array;function dg(){var s=new Ni(9);return Ni!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function ug(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3],y=e[4],v=e[5],b=e[6],T=e[7],k=e[8],M=r[0],L=r[1],R=r[2],B=r[3],H=r[4],re=r[5],pe=r[6],ie=r[7],ue=r[8];return s[0]=M*a+L*p+R*b,s[1]=M*l+L*y+R*T,s[2]=M*h+L*v+R*k,s[3]=B*a+H*p+re*b,s[4]=B*l+H*y+re*T,s[5]=B*h+H*v+re*k,s[6]=pe*a+ie*p+ue*b,s[7]=pe*l+ie*y+ue*T,s[8]=pe*h+ie*v+ue*k,s}function gn(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function $m(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=e[4],y=e[5],v=e[6],b=e[7],T=e[8],k=e[9],M=e[10],L=e[11],R=e[12],B=e[13],H=e[14],re=e[15],pe=r*y-a*p,ie=r*v-l*p,ue=r*b-h*p,xe=a*v-l*y,ge=a*b-h*y,Ue=l*b-h*v,Oe=T*B-k*R,He=T*H-M*R,ot=T*re-L*R,qe=k*H-M*B,Je=k*re-L*B,Ye=M*re-L*H,rt=pe*Ye-ie*Je+ue*qe+xe*ot-ge*He+Ue*Oe;return rt?(s[0]=(y*Ye-v*Je+b*qe)*(rt=1/rt),s[1]=(l*Je-a*Ye-h*qe)*rt,s[2]=(B*Ue-H*ge+re*xe)*rt,s[3]=(M*ge-k*Ue-L*xe)*rt,s[4]=(v*ot-p*Ye-b*He)*rt,s[5]=(r*Ye-l*ot+h*He)*rt,s[6]=(H*ue-R*Ue-re*ie)*rt,s[7]=(T*Ue-M*ue+L*ie)*rt,s[8]=(p*Je-y*ot+b*Oe)*rt,s[9]=(a*ot-r*Je-h*Oe)*rt,s[10]=(R*ge-B*ue+re*pe)*rt,s[11]=(k*ue-T*ge-L*pe)*rt,s[12]=(y*He-p*qe-v*Oe)*rt,s[13]=(r*qe-a*He+l*Oe)*rt,s[14]=(B*ie-R*xe-H*pe)*rt,s[15]=(T*xe-k*ie+M*pe)*rt,s):null}function Io(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3],y=e[4],v=e[5],b=e[6],T=e[7],k=e[8],M=e[9],L=e[10],R=e[11],B=e[12],H=e[13],re=e[14],pe=e[15],ie=r[0],ue=r[1],xe=r[2],ge=r[3];return s[0]=ie*a+ue*y+xe*k+ge*B,s[1]=ie*l+ue*v+xe*M+ge*H,s[2]=ie*h+ue*b+xe*L+ge*re,s[3]=ie*p+ue*T+xe*R+ge*pe,s[4]=(ie=r[4])*a+(ue=r[5])*y+(xe=r[6])*k+(ge=r[7])*B,s[5]=ie*l+ue*v+xe*M+ge*H,s[6]=ie*h+ue*b+xe*L+ge*re,s[7]=ie*p+ue*T+xe*R+ge*pe,s[8]=(ie=r[8])*a+(ue=r[9])*y+(xe=r[10])*k+(ge=r[11])*B,s[9]=ie*l+ue*v+xe*M+ge*H,s[10]=ie*h+ue*b+xe*L+ge*re,s[11]=ie*p+ue*T+xe*R+ge*pe,s[12]=(ie=r[12])*a+(ue=r[13])*y+(xe=r[14])*k+(ge=r[15])*B,s[13]=ie*l+ue*v+xe*M+ge*H,s[14]=ie*h+ue*b+xe*L+ge*re,s[15]=ie*p+ue*T+xe*R+ge*pe,s}function ld(s,e,r){var a,l,h,p,y,v,b,T,k,M,L,R,B=r[0],H=r[1],re=r[2];return e===s?(s[12]=e[0]*B+e[4]*H+e[8]*re+e[12],s[13]=e[1]*B+e[5]*H+e[9]*re+e[13],s[14]=e[2]*B+e[6]*H+e[10]*re+e[14],s[15]=e[3]*B+e[7]*H+e[11]*re+e[15]):(l=e[1],h=e[2],p=e[3],y=e[4],v=e[5],b=e[6],T=e[7],k=e[8],M=e[9],L=e[10],R=e[11],s[0]=a=e[0],s[1]=l,s[2]=h,s[3]=p,s[4]=y,s[5]=v,s[6]=b,s[7]=T,s[8]=k,s[9]=M,s[10]=L,s[11]=R,s[12]=a*B+y*H+k*re+e[12],s[13]=l*B+v*H+M*re+e[13],s[14]=h*B+b*H+L*re+e[14],s[15]=p*B+T*H+R*re+e[15]),s}function Do(s,e,r){var a=r[0],l=r[1],h=r[2];return s[0]=e[0]*a,s[1]=e[1]*a,s[2]=e[2]*a,s[3]=e[3]*a,s[4]=e[4]*l,s[5]=e[5]*l,s[6]=e[6]*l,s[7]=e[7]*l,s[8]=e[8]*h,s[9]=e[9]*h,s[10]=e[10]*h,s[11]=e[11]*h,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function Gm(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[4],p=e[5],y=e[6],v=e[7],b=e[8],T=e[9],k=e[10],M=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=h*l+b*a,s[5]=p*l+T*a,s[6]=y*l+k*a,s[7]=v*l+M*a,s[8]=b*l-h*a,s[9]=T*l-p*a,s[10]=k*l-y*a,s[11]=M*l-v*a,s}function Ju(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],y=e[2],v=e[3],b=e[8],T=e[9],k=e[10],M=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=h*l-b*a,s[1]=p*l-T*a,s[2]=y*l-k*a,s[3]=v*l-M*a,s[8]=h*a+b*l,s[9]=p*a+T*l,s[10]=y*a+k*l,s[11]=v*a+M*l,s}function hg(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function mg(s,e,r){var a,l,h,p=r[0],y=r[1],v=r[2],b=Math.hypot(p,y,v);return b<Qu?null:(p*=b=1/b,y*=b,v*=b,a=Math.sin(e),l=Math.cos(e),s[0]=p*p*(h=1-l)+l,s[1]=y*p*h+v*a,s[2]=v*p*h-y*a,s[3]=0,s[4]=p*y*h-v*a,s[5]=y*y*h+l,s[6]=v*y*h+p*a,s[7]=0,s[8]=p*v*h+y*a,s[9]=y*v*h-p*a,s[10]=v*v*h+l,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});var Xv=Io;function Zm(){var s=new Ni(3);return Ni!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function pg(s){var e=new Ni(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function cd(s){return Math.hypot(s[0],s[1],s[2])}function Pl(s,e,r){var a=new Ni(3);return a[0]=s,a[1]=e,a[2]=r,a}function aa(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s[2]=e[2]+r[2],s}function Wm(s,e,r){return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],s}function fg(s,e,r){return s[0]=e[0]*r[0],s[1]=e[1]*r[1],s[2]=e[2]*r[2],s}function dd(s,e,r){return s[0]=Math.min(e[0],r[0]),s[1]=Math.min(e[1],r[1]),s[2]=Math.min(e[2],r[2]),s}function ud(s,e,r){return s[0]=Math.max(e[0],r[0]),s[1]=Math.max(e[1],r[1]),s[2]=Math.max(e[2],r[2]),s}function Li(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s}function hd(s,e,r,a){return s[0]=e[0]+r[0]*a,s[1]=e[1]+r[1]*a,s[2]=e[2]+r[2]*a,s}function si(s,e){var r=e[0],a=e[1],l=e[2],h=r*r+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),s[0]=e[0]*h,s[1]=e[1]*h,s[2]=e[2]*h,s}function Zi(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Hm(s,e,r){var a=e[0],l=e[1],h=e[2],p=r[0],y=r[1],v=r[2];return s[0]=l*v-h*y,s[1]=h*p-a*v,s[2]=a*y-l*p,s}function Ys(s,e,r){var a=e[0],l=e[1],h=e[2],p=r[3]*a+r[7]*l+r[11]*h+r[15];return s[0]=(r[0]*a+r[4]*l+r[8]*h+r[12])/(p=p||1),s[1]=(r[1]*a+r[5]*l+r[9]*h+r[13])/p,s[2]=(r[2]*a+r[6]*l+r[10]*h+r[14])/p,s}function gg(s,e,r){var a=r[0],l=r[1],h=r[2],p=e[0],y=e[1],v=e[2],b=l*v-h*y,T=h*p-a*v,k=a*y-l*p,M=l*k-h*T,L=h*b-a*k,R=a*T-l*b,B=2*r[3];return T*=B,k*=B,L*=2,R*=2,s[0]=p+(b*=B)+(M*=2),s[1]=y+T+L,s[2]=v+k+R,s}var md,xn=Wm,Kv=fg,Qv=cd;function xg(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s[3]=e[3]*r,s}function yg(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=r*r+a*a+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),s[0]=r*p,s[1]=a*p,s[2]=l*p,s[3]=h*p,s}function Lo(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3];return s[0]=r[0]*a+r[4]*l+r[8]*h+r[12]*p,s[1]=r[1]*a+r[5]*l+r[9]*h+r[13]*p,s[2]=r[2]*a+r[6]*l+r[10]*h+r[14]*p,s[3]=r[3]*a+r[7]*l+r[11]*h+r[15]*p,s}function _g(){var s=new Ni(4);return Ni!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function vg(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function bg(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),v=Math.cos(r);return s[0]=a*v+p*y,s[1]=l*v+h*y,s[2]=h*v-l*y,s[3]=p*v-a*y,s}function wg(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),v=Math.cos(r);return s[0]=a*v-h*y,s[1]=l*v+p*y,s[2]=h*v+a*y,s[3]=p*v-l*y,s}Zm(),md=new Ni(4),Ni!=Float32Array&&(md[0]=0,md[1]=0,md[2]=0,md[3]=0);var Jv=yg;Zm(),Pl(1,0,0),Pl(0,1,0),_g(),_g(),dg();const Yv=ke([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jg}=Yv,Ng=ke([{name:"a_pos_3",components:3,type:"Int16"}]);var pd=ke([{name:"a_pos",type:"Int16",components:2}]);class Xm{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const l=Zi(r,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/l;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,r,a){if(function(L,R){var B=L[0],H=L[1],re=L[2],pe=R[0],ie=R[1],ue=R[2];return Math.abs(B-pe)<=Qu*Math.max(1,Math.abs(B),Math.abs(pe))&&Math.abs(H-ie)<=Qu*Math.max(1,Math.abs(H),Math.abs(ie))&&Math.abs(re-ue)<=Qu*Math.max(1,Math.abs(re),Math.abs(ue))}(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[l,h,p]=this.dir,y=this.pos[0]-e[0],v=this.pos[1]-e[1],b=this.pos[2]-e[2],T=l*l+h*h+p*p,k=2*(y*l+v*h+b*p),M=k*k-4*T*(y*y+v*v+b*b-r*r);if(M<0){const L=Math.max(-k/2,0),R=y+l*L,B=v+h*L,H=b+p*L,re=Math.hypot(R,B,H);return a[0]=R*r/re,a[1]=B*r/re,a[2]=H*r/re,!1}{const L=(-k-Math.sqrt(M))/(2*T);if(L<0){const R=Math.hypot(y,v,b);return a[0]=y*r/R,a[1]=v*r/R,a[2]=b*r/R,!1}return a[0]=y+l*L,a[1]=v+h*L,a[2]=b+p*L,!0}}}class Km{constructor(e,r,a,l,h){this.TL=e,this.TR=r,this.BR=a,this.BL=l,this.horizon=h}static fromInvProjectionMatrix(e,r,a){const l=[-1,1,1],h=[1,1,1],p=[1,-1,1],y=[-1,-1,1],v=Ys(l,l,e),b=Ys(h,h,e),T=Ys(p,p,e),k=Ys(y,y,e);return new Km(v,b,T,k,r/a)}}class Qm{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a,l){const h=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const b=Lo([],v,e),T=1/b[3]/r*h;return function(k,M,L){return k[0]=M[0]*L[0],k[1]=M[1]*L[1],k[2]=M[2]*L[2],k[3]=M[3]*L[3],k}(b,b,[T,T,l?1/b[3]:T,T])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const b=si([],Hm([],xn([],p[v[0]],p[v[1]]),xn([],p[v[2]],p[v[1]]))),T=-Zi(b,p[v[1]]);return b.concat(T)});return new Qm(p,y)}}class ri{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const l of e)dd(r,r,l),ud(a,a,l);return new ri(r,a)}static applyTransform(e,r){const a=e.getCorners();for(let l=0;l<a.length;++l)Ys(a[l],a[l],r);return ri.fromPoints(a)}constructor(e,r){this.min=e,this.max=r,this.center=Li([],aa([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=pg(this.min),l=pg(this.max);for(let h=0;h<r.length;h++)a[h]=r[h]?this.min[h]:this.center[h],l[h]=r[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new ri(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let a=!0;for(let l=0;l<e.planes.length;l++){const h=e.planes[l];let p=0;for(let y=0;y<r.length;y++)p+=Zi(h,r[y])+h[3]>=0;if(p===0)return 0;p!==r.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let h=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const v=e.points[y][l]-this.min[l];h=Math.min(h,v),p=Math.max(p,v)}if(p<0||h>this.max[l]-this.min[l])return 0}return 1}}const Jm=5,Sg=6,In=zt/Math.PI/2,eb=16383,Ro=64,fd=[Ro,32,16],Wi=-In,Hi=In,tb=[new ri([Wi,Wi,Wi],[Hi,Hi,Hi]),new ri([Wi,Wi,Wi],[0,0,Hi]),new ri([0,Wi,Wi],[Hi,0,Hi]),new ri([Wi,0,Wi],[0,Hi,Hi]),new ri([0,0,Wi],[Hi,Hi,Hi])];function Yu(s){return s*In/yd}function Tg(s,e,r,a=!0){const l=Li([],s._camera.position,s.worldSize),h=[e,r,1,1];Lo(h,h,s.pixelMatrixInverse),xg(h,h,1/h[3]);const p=si([],xn([],h,l)),y=s.globeMatrix,v=[y[12],y[13],y[14]],b=xn([],v,l),T=cd(b),k=si([],b),M=s.worldSize/(2*Math.PI),L=Zi(k,p),R=Math.asin(M/T);if(R<Math.acos(L)){if(!a)return null;const ot=[],qe=[];Li(ot,p,T/L),si(qe,xn(qe,ot,b)),si(p,aa(p,b,Li(p,qe,Math.tan(R)*T)))}const B=[];new Xm(l,p).closestPointOnSphere(v,M,B);const H=si([],wt(y,0)),re=si([],wt(y,1)),pe=si([],wt(y,2)),ie=Zi(H,B),ue=Zi(re,B),xe=Zi(pe,B),ge=it(Math.asin(-ue/M));let Ue=it(Math.atan2(ie,xe));Ue=s.center.lng+function(ot,qe){const Je=(qe-ot+180)%360-180;return Je<-180?Je+360:Je}(s.center.lng,Ue);const Oe=Ln(Ue),He=ht(Rn(ge),0,1);return new Rl(Oe,He)}class sb{constructor(e,r,a){this.a=xn([],e,a),this.b=xn([],r,a),this.center=a;const l=si([],this.a),h=si([],this.b);this.angle=Math.acos(Zi(l,h))}}function Ym(s,e){if(s.angle===0)return null;let r;return r=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),r<0||r>1?null:function(a,l,h,p){const y=Math.sin(h);return a*(Math.sin((1-p)*h)/y)+l*(Math.sin(p*h)/y)}(s.a[e],s.b[e],s.angle,ht(r,0,1))+s.center[e]}function Dn(s){if(s.z<=1)return tb[s.z+2*s.y+s.x];const e=ep(eh(s));return ri.fromPoints(e)}function zo(s,e,r){return Li(s,s,1-r),hd(s,s,e,r)}function Eg(s,e){const r=Ll(e.zoom);if(r===0)return Dn(s);const a=eh(s),l=ep(a),h=Ln(a.getWest())*e.worldSize,p=Ln(a.getEast())*e.worldSize,y=Rn(a.getNorth())*e.worldSize,v=Rn(a.getSouth())*e.worldSize,b=[h,y,0],T=[p,y,0],k=[h,v,0],M=[p,v,0],L=$m([],e.globeMatrix);return Ys(b,b,L),Ys(T,T,L),Ys(k,k,L),Ys(M,M,L),l[0]=zo(l[0],k,r),l[1]=zo(l[1],M,r),l[2]=zo(l[2],T,r),l[3]=zo(l[3],b,r),ri.fromPoints(l)}function Cg(s,e,r){for(const a of s)Ys(a,a,e),Li(a,a,r)}function rb(s,e,r){const a=e/s.worldSize,l=s.globeMatrix;if(r.z<=1){const Oe=Dn(r).getCorners();return Cg(Oe,l,a),ri.fromPoints(Oe)}const h=eh(r),p=ep(h);Cg(p,l,a);const y=Number.MAX_VALUE,v=[-y,-y,-y],b=[y,y,y];if(h.contains(s.center)){for(const ot of p)dd(b,b,ot),ud(v,v,ot);v[2]=0;const Oe=s.point,He=[Oe.x*a,Oe.y*a,0];return dd(b,b,He),ud(v,v,He),new ri(b,v)}const T=[l[12]*a,l[13]*a,l[14]*a],k=h.getCenter(),M=ht(s.center.lat,-Gr,Gr),L=ht(k.lat,-Gr,Gr),R=Ln(s.center.lng),B=Rn(M);let H=R-Ln(k.lng);const re=B-Rn(L);H>.5?H-=1:H<-.5&&(H+=1);let pe=0;Math.abs(H)>Math.abs(re)?pe=H>=0?1:3:(pe=re>=0?0:2,hd(T,T,[l[4]*a,l[5]*a,l[6]*a],-Math.sin(Pe(re>=0?h.getSouth():h.getNorth()))*In));const ie=p[pe],ue=p[(pe+1)%4],xe=new sb(ie,ue,T),ge=[Ym(xe,0)||ie[0],Ym(xe,1)||ie[1],Ym(xe,2)||ie[2]],Ue=Ll(s.zoom);if(Ue>0){const Oe=function({x:ot,y:qe,z:Je},Ye,rt,mt,Ze){const vt=1/(1<<Je);let At=ot*vt,bt=At+vt,$t=qe*vt,pt=$t+vt,Rt=0;const Gt=(At+bt)/2-mt;return Gt>.5?Rt=-1:Gt<-.5&&(Rt=1),At=((At+Rt)*Ye-(mt*=Ye))*rt+mt,bt=((bt+Rt)*Ye-mt)*rt+mt,$t=($t*Ye-(Ze*=Ye))*rt+Ze,pt=(pt*Ye-Ze)*rt+Ze,[[At,pt,0],[bt,pt,0],[bt,$t,0],[At,$t,0]]}(r,e,s._pixelsPerMercatorPixel,R,B);for(let ot=0;ot<p.length;ot++)zo(p[ot],Oe[ot],Ue);const He=aa([],Oe[pe],Oe[(pe+1)%4]);Li(He,He,.5),zo(ge,He,Ue)}for(const Oe of p)dd(b,b,Oe),ud(v,v,Oe);return b[2]=Math.min(ie[2],ue[2]),dd(b,b,ge),ud(v,v,ge),new ri(b,v)}function eh({x:s,y:e,z:r}){const a=1/(1<<r),l=new Ts(Ri(s*a),$r((e+1)*a)),h=new Ts(Ri((s+1)*a),$r(e*a));return new za(l,h)}function ep(s){const e=Pe(s.getNorth()),r=Pe(s.getSouth()),a=Math.cos(e),l=Math.cos(r),h=Math.sin(e),p=Math.sin(r),y=s.getWest(),v=s.getEast();return[Il(l,p,y),Il(l,p,v),Il(a,h,v),Il(a,h,y)]}function Il(s,e,r,a=In){return r=Pe(r),[s*Math.sin(r)*a,-e*a,s*Math.cos(r)*a]}function Dl(s,e,r){return Il(Math.cos(Pe(s)),Math.sin(Pe(s)),e,r)}function gd(s,e,r,a){const l=1<<r.z,h=(s/zt+r.x)/l;return Dl($r((e/zt+r.y)/l),Ri(h),a)}function th({min:s,max:e}){return eb/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const kg=new Float64Array(16);function xd(s){const e=th(s),r=hg(kg,[e,e,e]);return ld(r,r,((a=[])[0]=-(l=s.min)[0],a[1]=-l[1],a[2]=-l[2],a));var a,l}function tp(s){const e=(a=s.min,(r=kg)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r);var r,a;const l=1/th(s);return Do(e,e,[l,l,l])}function Ag(s,e,r,a,l){const h=function(v){const b=zt/(2*Math.PI);return v/(2*Math.PI)/b}(r),p=[s,e,-r/(2*Math.PI)],y=gn(new Float64Array(16));return ld(y,y,p),Do(y,y,[h,h,h]),Gm(y,y,Pe(-l)),Ju(y,y,Pe(-a)),y}function Ll(s){return Os(Jm,Sg,s)}function Mg(s,e){const r=Dl(e.lat,e.lng),a=function(R){const B=Dl(R._center.lat,R._center.lng);let H=Hm([],Pl(0,1,0),B);const re=mg([],-R.angle,B);H=Ys(H,H,re),mg(re,-R._pitch,H);const pe=si([],B);return Li(pe,pe,Yu(R.cameraToCenterDistance/R.pixelsPerMeter)),Ys(pe,pe,re),aa([],B,pe)}(s);return p=(l=Wm([],a,r))[0],y=l[1],v=l[2],b=(h=r)[0],T=h[1],k=h[2],L=(M=Math.sqrt(p*p+y*y+v*v)*Math.sqrt(b*b+T*T+k*k))&&Zi(l,h)/M,Math.acos(Math.min(Math.max(L,-1),1));var l,h,p,y,v,b,T,k,M,L}function sp(s,e){return Mg(s,e)>Math.PI/2*1.01}const Pg=Pe(85),ib=Math.cos(Pg),nb=Math.sin(Pg),yd=63710088e-1,Ig=2*Math.PI*yd;class Oa{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oa(ns(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,l=e.lat*r,h=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return yd*Math.acos(Math.min(h,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new za(new Oa(this.lng-a,this.lat-r),new Oa(this.lng+a,this.lat+r))}toEcef(e){const r=Yu(e);return Dl(this.lat,this.lng,In+r)}static convert(e){if(e instanceof Oa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ts=Oa;function rp(s){return Ig*Math.cos(s*Math.PI/180)}function Ln(s){return(180+s)/360}function Rn(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function yn(s,e){return s/rp(e)}function Ri(s){return 360*s-180}function $r(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Dg(s,e){return s*rp($r(e))}const Gr=85.051129;function Lg(s){return 1/Math.cos(s*Math.PI/180)}class Rl{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Ts.convert(e);return new Rl(Ln(a.lng),Rn(a.lat),yn(r,a.lat))}toLngLat(){return new Ts(Ri(this.x),$r(this.y))}toAltitude(){return Dg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ig*Lg($r(this.y))}}function ip(s,e,r,a,l,h,p,y,v){const b=(e+a)/2,T=(r+l)/2,k=new Ee(b,T);y(k),function(M,L,R,B,H,re){const pe=R-H,ie=B-re;return Math.abs((B-L)*pe-(R-M)*ie)/Math.hypot(pe,ie)}(k.x,k.y,h.x,h.y,p.x,p.y)>=v?(ip(s,e,r,b,T,h,k,y,v),ip(s,b,T,a,l,k,p,y,v)):s.push(p)}function Rg(s,e,r){let a=s[0],l=a.x,h=a.y;e(a);const p=[a];for(let y=1;y<s.length;y++){const v=s[y],{x:b,y:T}=v;e(v),ip(p,l,h,b,T,a,v,e,r),l=b,h=T,a=v}return p}function np(s,e,r,a){if(a(e,r)){const l=e.add(r)._mult(.5);np(s,e,l,a),np(s,l,r,a)}else s.push(r)}function ab(s,e){let r=s[0];const a=[r];for(let l=1;l<s.length;l++){const h=s[l];np(a,r,h,e),r=h}return a}const ap=Math.pow(2,14)-1,zg=-ap-1;function ob(s,e){const r=Math.round(s.x*e),a=Math.round(s.y*e);return s.x=ht(r,zg,ap),s.y=ht(a,zg,ap),(r<s.x||r>s.x+1||a<s.y||a>s.y+1)&&As("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function oa(s,e,r){const a=s.loadGeometry(),l=s.extent,h=zt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:v,y:b,projection:T}=r,k=M=>{const L=Ri((e.x+M.x/l)/p),R=$r((e.y+M.y/l)/p),B=T.project(L,R);M.x=(B.x*y-v)*l,M.y=(B.y*y-b)*l};for(let M=0;M<a.length;M++)if(s.type!==1)a[M]=Rg(a[M],k,1);else{const L=[];for(const R of a[M])R.x<0||R.x>=l||R.y<0||R.y>=l||(k(R),L.push(R));a[M]=L}}for(const p of a)for(const y of p)ob(y,h);return a}function Oo(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?oa(s):[]}}function sh(s,e,r,a,l){s.emplaceBack(2*e+(a+1)/2,2*r+(l+1)/2)}function rh(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class op{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new at,this.indexArray=new Pt,this.segments=new ar,this.programConfigurations=new Po(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,l){const h=this.layers[0],p=[];let y=null;h.type==="circle"&&(y=h.layout.get("circle-sort-key"));for(const{feature:b,id:T,index:k,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,R=Oo(b,L);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),R,a))continue;const B=y?y.evaluate(R,{},a):void 0,H={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:k,geometry:L?R.geometry:oa(b,a,l),patterns:{},sortKey:B};p.push(H)}y&&p.sort((b,T)=>b.sortKey-T.sortKey);let v=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new lt,v=l.projection);for(const b of p){const{geometry:T,index:k,sourceLayerIndex:M}=b,L=e[k].feature;this.addFeature(b,T,k,r.availableImages,a,v),r.featureIndex.insert(L,T,k,M,this.index)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Hv.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,l,h,p){for(const y of r)for(const v of y){const b=v.x,T=v.y;if(b<0||b>=zt||T<0||T>=zt)continue;if(p){const L=p.projectTilePoint(b,T,h),R=p.upVector(h,b,T),B=this.globeExtVertexArray;rh(B,L,R),rh(B,L,R),rh(B,L,R),rh(B,L,R)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=k.vertexLength;sh(this.layoutVertexArray,b,T,-1,-1),sh(this.layoutVertexArray,b,T,1,-1),sh(this.layoutVertexArray,b,T,1,1),sh(this.layoutVertexArray,b,T,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},l,h)}}function Og(s,e){for(let r=0;r<s.length;r++)if(Fo(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(Fo(s,e[r]))return!0;return!!lp(s,e)}function lb(s,e,r){return!!Fo(s,e)||!!cp(e,s,r)}function Fg(s,e){if(s.length===1)return Ug(e,s[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let l=0;l<a.length;l++)if(Fo(s,a[l]))return!0}for(let r=0;r<s.length;r++)if(Ug(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(lp(s,e[r]))return!0;return!1}function cb(s,e,r){if(s.length>1){if(lp(s,e))return!0;for(let a=0;a<e.length;a++)if(cp(e[a],s,r))return!0}for(let a=0;a<s.length;a++)if(cp(s[a],e,r))return!0;return!1}function lp(s,e){if(s.length===0||e.length===0)return!1;for(let r=0;r<s.length-1;r++){const a=s[r],l=s[r+1];for(let h=0;h<e.length-1;h++)if(db(a,l,e[h],e[h+1]))return!0}return!1}function db(s,e,r,a){return Ir(s,r,a)!==Ir(e,r,a)&&Ir(s,e,r)!==Ir(s,e,a)}function cp(s,e,r){const a=r*r;if(e.length===1)return s.distSqr(e[0])<a;for(let l=1;l<e.length;l++)if(Bg(s,e[l-1],e[l])<a)return!0;return!1}function Bg(s,e,r){const a=e.distSqr(r);if(a===0)return s.distSqr(e);const l=((s.x-e.x)*(r.x-e.x)+(s.y-e.y)*(r.y-e.y))/a;return s.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function Ug(s,e){let r,a,l,h=!1;for(let p=0;p<s.length;p++){r=s[p];for(let y=0,v=r.length-1;y<r.length;v=y++)a=r[y],l=r[v],a.y>e.y!=l.y>e.y&&e.x<(l.x-a.x)*(e.y-a.y)/(l.y-a.y)+a.x&&(h=!h)}return h}function Fo(s,e){let r=!1;for(let a=0,l=s.length-1;a<s.length;l=a++){const h=s[a],p=s[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(r=!r)}return r}function Vg(s,e,r,a,l){for(const p of s)if(e<=p.x&&r<=p.y&&a>=p.x&&l>=p.y)return!0;const h=[new Ee(e,r),new Ee(e,l),new Ee(a,l),new Ee(a,r)];if(s.length>2){for(const p of h)if(Fo(s,p))return!0}for(let p=0;p<s.length-1;p++)if(ub(s[p],s[p+1],h))return!0;return!1}function ub(s,e,r){const a=r[0],l=r[2];if(s.x<a.x&&e.x<a.x||s.x>l.x&&e.x>l.x||s.y<a.y&&e.y<a.y||s.y>l.y&&e.y>l.y)return!1;const h=Ir(s,e,r[0]);return h!==Ir(s,e,r[1])||h!==Ir(s,e,r[2])||h!==Ir(s,e,r[3])}function zl(s,e,r){const a=e.paint.get(s).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(s)}function ih(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function qg(s,e,r,a,l){if(!e[0]&&!e[1])return s;const h=Ee.convert(e)._mult(l);r==="viewport"&&h._rotate(-a);const p=[];for(let y=0;y<s.length;y++)p.push(s[y].sub(h));return p}function $g(s,e,r,a){const l=Ee.convert(s)._mult(a);return e==="viewport"&&l._rotate(-r),l}Et(op,"CircleBucket",{omit:["layers"]});const hb=new le({"circle-sort-key":new K(We.layout_circle["circle-sort-key"])});var mb={paint:new le({"circle-radius":new K(We.paint_circle["circle-radius"]),"circle-color":new K(We.paint_circle["circle-color"]),"circle-blur":new K(We.paint_circle["circle-blur"]),"circle-opacity":new K(We.paint_circle["circle-opacity"]),"circle-translate":new F(We.paint_circle["circle-translate"]),"circle-translate-anchor":new F(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new F(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new F(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new K(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new K(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new K(We.paint_circle["circle-stroke-opacity"])}),layout:hb};function Gg(s,e,r,a,l,h,p,y,v){if(h&&s.queryGeometry.isAboveHorizon)return!1;h&&(v*=s.pixelToTileUnitsFactor);const b=s.tileID.canonical,T=r.projection.upVectorScale(b,r.center.lat,r.worldSize).metersToTile;for(const k of e)for(const M of k){const L=M.add(y),R=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(L.x,L.y,!0):0,B=r.projection.projectTilePoint(L.x,L.y,b);if(R>0){const ie=r.projection.upVector(b,L.x,L.y);B.x+=ie[0]*T*R,B.y+=ie[1]*T*R,B.z+=ie[2]*T*R}const H=h?L:pb(B.x,B.y,B.z,a),re=h?s.tilespaceRays.map(ie=>gb(ie,R)):s.queryGeometry.screenGeometry,pe=Lo([],[B.x,B.y,B.z,1],a);if(!p&&h?v*=pe[3]/r.cameraToCenterDistance:p&&!h&&(v*=r.cameraToCenterDistance/pe[3]),h){const ie=$r((M.y/zt+b.y)/(1<<b.z));v/=r.projection.pixelsPerMeter(ie,1)/yn(1,ie)}if(lb(re,H,v))return!0}return!1}function pb(s,e,r,a){const l=Lo([],[s,e,r,1],a);return new Ee(l[0]/l[3],l[1]/l[3])}const Zg=Pl(0,0,0),fb=Pl(0,0,1);function gb(s,e){const r=Zm();return Zg[2]=e,s.intersectsPlane(Zg,fb,r),new Ee(r[0],r[1])}class Wg extends op{}function Hg(s,{width:e,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*a)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*a);return s.width=e,s.height=r,s.data=l,s}function Xg(s,e,r){const{width:a,height:l}=e;a===s.width&&l===s.height||(dp(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,a),height:Math.min(s.height,l)},r),s.width=a,s.height=l,s.data=e.data)}function dp(s,e,r,a,l,h){if(l.width===0||l.height===0)return e;if(l.width>s.width||l.height>s.height||r.x>s.width-l.width||r.y>s.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||a.x>e.width-l.width||a.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=s.data,y=e.data;for(let v=0;v<l.height;v++){const b=((r.y+v)*s.width+r.x)*h,T=((a.y+v)*e.width+a.x)*h;for(let k=0;k<l.width*h;k++)y[T+k]=p[b+k]}return e}Et(Wg,"HeatmapBucket",{omit:["layers"]});class la{constructor(e,r){Hg(this,e,1,r)}resize(e){Xg(this,new la(e),1)}clone(){return new la({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,h){dp(e,r,a,l,h,1)}}class Si{constructor(e,r){Hg(this,e,4,r)}resize(e){Xg(this,new Si(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Si({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,h){dp(e,r,a,l,h,4)}}Et(la,"AlphaImage"),Et(Si,"RGBAImage");var xb={paint:new le({"heatmap-radius":new K(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new K(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new F(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ae(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new F(We.paint_heatmap["heatmap-opacity"])})};function up(s){const e={},r=s.resolution||256,a=s.clips?s.clips.length:1,l=s.image||new Si({width:r,height:a}),h=(p,y,v)=>{e[s.evaluationKey]=v;const b=s.expression.evaluate(e);l.data[p+y+0]=Math.floor(255*b.r/b.a),l.data[p+y+1]=Math.floor(255*b.g/b.a),l.data[p+y+2]=Math.floor(255*b.b/b.a),l.data[p+y+3]=Math.floor(255*b.a)};if(s.clips)for(let p=0,y=0;p<a;++p,y+=4*r)for(let v=0,b=0;v<r;v++,b+=4){const T=v/(r-1),{start:k,end:M}=s.clips[p];h(y,b,k*(1-T)+M*T)}else for(let p=0,y=0;p<r;p++,y+=4)h(0,y,p/(r-1));return l}var yb={paint:new le({"hillshade-illumination-direction":new F(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new F(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new F(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new F(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new F(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new F(We.paint_hillshade["hillshade-accent-color"])})};const _b=ke([{name:"a_pos",components:2,type:"Int16"}],4),{members:vb}=_b;var hp={exports:{}};function nh(s,e,r){r=r||2;var a,l,h,p,y,v,b,T=e&&e.length,k=T?e[0]*r:s.length,M=Kg(s,0,k,r,!0),L=[];if(!M||M.next===M.prev)return L;if(T&&(M=function(B,H,re,pe){var ie,ue,xe,ge=[];for(ie=0,ue=H.length;ie<ue;ie++)(xe=Kg(B,H[ie]*pe,ie<ue-1?H[ie+1]*pe:B.length,pe,!1))===xe.next&&(xe.steiner=!0),ge.push(Cb(xe));for(ge.sort(Sb),ie=0;ie<ge.length;ie++)re=Tb(ge[ie],re);return re}(s,e,M,r)),s.length>80*r){a=h=s[0],l=p=s[1];for(var R=r;R<k;R+=r)(y=s[R])<a&&(a=y),(v=s[R+1])<l&&(l=v),y>h&&(h=y),v>p&&(p=v);b=(b=Math.max(h-a,p-l))!==0?32767/b:0}return _d(M,L,r,a,l,b,0),L}function Kg(s,e,r,a,l){var h,p;if(l===fp(s,e,r,a)>0)for(h=e;h<r;h+=a)p=Yg(h,s[h],s[h+1],p);else for(h=r-a;h>=e;h-=a)p=Yg(h,s[h],s[h+1],p);return p&&ah(p,p.next)&&(bd(p),p=p.next),p}function Bo(s,e){if(!s)return s;e||(e=s);var r,a=s;do if(r=!1,a.steiner||!ah(a,a.next)&&or(a.prev,a,a.next)!==0)a=a.next;else{if(bd(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function _d(s,e,r,a,l,h,p){if(s){!p&&h&&function(T,k,M,L){var R=T;do R.z===0&&(R.z=mp(R.x,R.y,k,M,L)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==T);R.prevZ.nextZ=null,R.prevZ=null,function(B){var H,re,pe,ie,ue,xe,ge,Ue,Oe=1;do{for(re=B,B=null,ue=null,xe=0;re;){for(xe++,pe=re,ge=0,H=0;H<Oe&&(ge++,pe=pe.nextZ);H++);for(Ue=Oe;ge>0||Ue>0&&pe;)ge!==0&&(Ue===0||!pe||re.z<=pe.z)?(ie=re,re=re.nextZ,ge--):(ie=pe,pe=pe.nextZ,Ue--),ue?ue.nextZ=ie:B=ie,ie.prevZ=ue,ue=ie;re=pe}ue.nextZ=null,Oe*=2}while(xe>1)}(R)}(s,a,l,h);for(var y,v,b=s;s.prev!==s.next;)if(y=s.prev,v=s.next,h?wb(s,a,l,h):bb(s))e.push(y.i/r|0),e.push(s.i/r|0),e.push(v.i/r|0),bd(s),s=v.next,b=v.next;else if((s=v)===b){p?p===1?_d(s=jb(Bo(s),e,r),e,r,a,l,h,2):p===2&&Nb(s,e,r,a,l,h):_d(Bo(s),e,r,a,l,h,1);break}}}function bb(s){var e=s.prev,r=s,a=s.next;if(or(e,r,a)>=0)return!1;for(var l=e.x,h=r.x,p=a.x,y=e.y,v=r.y,b=a.y,T=l<h?l<p?l:p:h<p?h:p,k=y<v?y<b?y:b:v<b?v:b,M=l>h?l>p?l:p:h>p?h:p,L=y>v?y>b?y:b:v>b?v:b,R=a.next;R!==e;){if(R.x>=T&&R.x<=M&&R.y>=k&&R.y<=L&&Ol(l,y,h,v,p,b,R.x,R.y)&&or(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function wb(s,e,r,a){var l=s.prev,h=s,p=s.next;if(or(l,h,p)>=0)return!1;for(var y=l.x,v=h.x,b=p.x,T=l.y,k=h.y,M=p.y,L=y<v?y<b?y:b:v<b?v:b,R=T<k?T<M?T:M:k<M?k:M,B=y>v?y>b?y:b:v>b?v:b,H=T>k?T>M?T:M:k>M?k:M,re=mp(L,R,e,r,a),pe=mp(B,H,e,r,a),ie=s.prevZ,ue=s.nextZ;ie&&ie.z>=re&&ue&&ue.z<=pe;){if(ie.x>=L&&ie.x<=B&&ie.y>=R&&ie.y<=H&&ie!==l&&ie!==p&&Ol(y,T,v,k,b,M,ie.x,ie.y)&&or(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ue.x>=L&&ue.x<=B&&ue.y>=R&&ue.y<=H&&ue!==l&&ue!==p&&Ol(y,T,v,k,b,M,ue.x,ue.y)&&or(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ie&&ie.z>=re;){if(ie.x>=L&&ie.x<=B&&ie.y>=R&&ie.y<=H&&ie!==l&&ie!==p&&Ol(y,T,v,k,b,M,ie.x,ie.y)&&or(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ue&&ue.z<=pe;){if(ue.x>=L&&ue.x<=B&&ue.y>=R&&ue.y<=H&&ue!==l&&ue!==p&&Ol(y,T,v,k,b,M,ue.x,ue.y)&&or(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function jb(s,e,r){var a=s;do{var l=a.prev,h=a.next.next;!ah(l,h)&&Qg(l,a,a.next,h)&&vd(l,h)&&vd(h,l)&&(e.push(l.i/r|0),e.push(a.i/r|0),e.push(h.i/r|0),bd(a),bd(a.next),a=s=h),a=a.next}while(a!==s);return Bo(a)}function Nb(s,e,r,a,l,h){var p=s;do{for(var y=p.next.next;y!==p.prev;){if(p.i!==y.i&&kb(p,y)){var v=Jg(p,y);return p=Bo(p,p.next),v=Bo(v,v.next),_d(p,e,r,a,l,h,0),void _d(v,e,r,a,l,h,0)}y=y.next}p=p.next}while(p!==s)}function Sb(s,e){return s.x-e.x}function Tb(s,e){var r=function(l,h){var p,y=h,v=l.x,b=l.y,T=-1/0;do{if(b<=y.y&&b>=y.next.y&&y.next.y!==y.y){var k=y.x+(b-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(k<=v&&k>T&&(T=k,p=y.x<y.next.x?y:y.next,k===v))return p}y=y.next}while(y!==h);if(!p)return null;var M,L=p,R=p.x,B=p.y,H=1/0;y=p;do v>=y.x&&y.x>=R&&v!==y.x&&Ol(b<B?v:T,b,R,B,b<B?T:v,b,y.x,y.y)&&(M=Math.abs(b-y.y)/(v-y.x),vd(y,l)&&(M<H||M===H&&(y.x>p.x||y.x===p.x&&Eb(p,y)))&&(p=y,H=M)),y=y.next;while(y!==L);return p}(s,e);if(!r)return e;var a=Jg(r,s);return Bo(a,a.next),Bo(r,r.next)}function Eb(s,e){return or(s.prev,s,e.prev)<0&&or(e.next,s,s.next)<0}function mp(s,e,r,a,l){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-r)*l|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Cb(s){var e=s,r=s;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==s);return r}function Ol(s,e,r,a,l,h,p,y){return(l-p)*(e-y)>=(s-p)*(h-y)&&(s-p)*(a-y)>=(r-p)*(e-y)&&(r-p)*(h-y)>=(l-p)*(a-y)}function kb(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(r,a){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&Qg(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(s,e)&&(vd(s,e)&&vd(e,s)&&function(r,a){var l=r,h=!1,p=(r.x+a.x)/2,y=(r.y+a.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&p<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(s,e)&&(or(s.prev,s,e.prev)||or(s,e.prev,e))||ah(s,e)&&or(s.prev,s,s.next)>0&&or(e.prev,e,e.next)>0)}function or(s,e,r){return(e.y-s.y)*(r.x-e.x)-(e.x-s.x)*(r.y-e.y)}function ah(s,e){return s.x===e.x&&s.y===e.y}function Qg(s,e,r,a){var l=lh(or(s,e,r)),h=lh(or(s,e,a)),p=lh(or(r,a,s)),y=lh(or(r,a,e));return l!==h&&p!==y||!(l!==0||!oh(s,r,e))||!(h!==0||!oh(s,a,e))||!(p!==0||!oh(r,s,a))||!(y!==0||!oh(r,e,a))}function oh(s,e,r){return e.x<=Math.max(s.x,r.x)&&e.x>=Math.min(s.x,r.x)&&e.y<=Math.max(s.y,r.y)&&e.y>=Math.min(s.y,r.y)}function lh(s){return s>0?1:s<0?-1:0}function vd(s,e){return or(s.prev,s,s.next)<0?or(s,e,s.next)>=0&&or(s,s.prev,e)>=0:or(s,e,s.prev)<0||or(s,s.next,e)<0}function Jg(s,e){var r=new pp(s.i,s.x,s.y),a=new pp(e.i,e.x,e.y),l=s.next,h=e.prev;return s.next=e,e.prev=s,r.next=l,l.prev=r,a.next=r,r.prev=a,h.next=a,a.prev=h,a}function Yg(s,e,r,a){var l=new pp(s,e,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function bd(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function pp(s,e,r){this.i=s,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fp(s,e,r,a){for(var l=0,h=e,p=r-a;h<r;h+=a)l+=(s[p]-s[h])*(s[h+1]+s[p+1]),p=h;return l}hp.exports=nh,hp.exports.default=nh,nh.deviation=function(s,e,r,a){var l=e&&e.length,h=Math.abs(fp(s,0,l?e[0]*r:s.length,r));if(l)for(var p=0,y=e.length;p<y;p++)h-=Math.abs(fp(s,e[p]*r,p<y-1?e[p+1]*r:s.length,r));var v=0;for(p=0;p<a.length;p+=3){var b=a[p]*r,T=a[p+1]*r,k=a[p+2]*r;v+=Math.abs((s[b]-s[k])*(s[T+1]-s[b+1])-(s[b]-s[T])*(s[k+1]-s[b+1]))}return h===0&&v===0?0:Math.abs((v-h)/h)},nh.flatten=function(s){for(var e=s[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,l=0;l<s.length;l++){for(var h=0;h<s[l].length;h++)for(var p=0;p<e;p++)r.vertices.push(s[l][h][p]);l>0&&r.holes.push(a+=s[l-1].length)}return r};var gp=Ne(hp.exports);function Ab(s,e,r,a,l){ex(s,e,r,a||s.length-1,l||Mb)}function ex(s,e,r,a,l){for(;a>r;){if(a-r>600){var h=a-r+1,p=e-r+1,y=Math.log(h),v=.5*Math.exp(2*y/3),b=.5*Math.sqrt(y*v*(h-v)/h)*(p-h/2<0?-1:1);ex(s,e,Math.max(r,Math.floor(e-p*v/h+b)),Math.min(a,Math.floor(e+(h-p)*v/h+b)),l)}var T=s[e],k=r,M=a;for(wd(s,r,e),l(s[a],T)>0&&wd(s,r,a);k<M;){for(wd(s,k,M),k++,M--;l(s[k],T)<0;)k++;for(;l(s[M],T)>0;)M--}l(s[r],T)===0?wd(s,r,M):wd(s,++M,a),M<=e&&(r=M+1),e<=M&&(a=M-1)}}function wd(s,e,r){var a=s[e];s[e]=s[r],s[r]=a}function Mb(s,e){return s<e?-1:s>e?1:0}function xp(s,e){const r=s.length;if(r<=1)return[s];const a=[];let l,h;for(let p=0;p<r;p++){const y=Zn(s[p]);y!==0&&(s[p].area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(l&&a.push(l),l=[s[p]]):l.push(s[p]))}if(l&&a.push(l),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(Ab(a[p],e,1,a[p].length-1,Pb),a[p]=a[p].slice(0,e));return a}function Pb(s,e){return e.area-s.area}function yp(s,e,r){const a=r.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${s}-pattern`);p.isConstant()||(l=!0);const y=p.constantOr(null);y&&(l=!0,a[y]=!0)}return l}function _p(s,e,r,a,l){const h=l.patternDependencies;for(const p of e){const y=p.paint.get(`${s}-pattern`).value;if(y.kind!=="constant"){let v=y.evaluate({zoom:a},r,{},l.availableImages);v=v&&v.name?v.name:v,h[v]=!0,r.patterns[p.id]=v}}return r}class ch{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new at,this.indexArray=new Pt,this.indexArray2=new Er,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new ar,this.segments2=new ar,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,a,l){this.hasPattern=yp("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:v,index:b,sourceLayerIndex:T}of e){const k=this.layers[0]._featureFilter.needGeometry,M=Oo(y,k);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),M,a))continue;const L=h?h.evaluate(M,{},a,r.availableImages):void 0,R={id:v,properties:y.properties,type:y.type,sourceLayerIndex:T,index:b,geometry:k?M.geometry:oa(y,a,l),patterns:{},sortKey:L};p.push(R)}h&&p.sort((y,v)=>y.sortKey-v.sortKey);for(const y of p){const{geometry:v,index:b,sourceLayerIndex:T}=y;if(this.hasPattern){const k=_p("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(y,v,b,a,{},r.availableImages);r.featureIndex.insert(e[b].feature,v,b,T,this.index)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}addFeatures(e,r,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,l,h,p=[]){for(const y of xp(r,500)){let v=0;for(const R of y)v+=R.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),T=b.vertexLength,k=[],M=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&M.push(k.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),H=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(H+R.length-1,H),k.push(R[0].x),k.push(R[0].y);for(let re=1;re<R.length;re++)this.layoutVertexArray.emplaceBack(R[re].x,R[re].y),this.indexArray2.emplaceBack(H+re-1,H+re),k.push(R[re].x),k.push(R[re].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const L=gp(k,M);for(let R=0;R<L.length;R+=3)this.indexArray.emplaceBack(T+L[R],T+L[R+1],T+L[R+2]);b.vertexLength+=v,b.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}}Et(ch,"FillBucket",{omit:["layers","patternFeatures"]});const Ib=new le({"fill-sort-key":new K(We.layout_fill["fill-sort-key"])});var Db={paint:new le({"fill-antialias":new F(We.paint_fill["fill-antialias"]),"fill-opacity":new K(We.paint_fill["fill-opacity"]),"fill-color":new K(We.paint_fill["fill-color"]),"fill-outline-color":new K(We.paint_fill["fill-outline-color"]),"fill-translate":new F(We.paint_fill["fill-translate"]),"fill-translate-anchor":new F(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new K(We.paint_fill["fill-pattern"])}),layout:Ib};const Lb=ke([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Rb=ke([{name:"a_centroid_pos",components:2,type:"Uint16"}]),zb=ke([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ob}=Lb;var dh={},Fb=fe,tx=Fl;function Fl(s,e,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=s,this._geometry=-1,this._keys=a,this._values=l,s.readFields(Bb,this,e)}function Bb(s,e,r){s==1?e.id=r.readVarint():s==2?function(a,l){for(var h=a.readVarint()+a.pos;a.pos<h;){var p=l._keys[a.readVarint()],y=l._values[a.readVarint()];l.properties[p]=y}}(r,e):s==3?e.type=r.readVarint():s==4&&(e._geometry=r.pos)}function Ub(s){for(var e,r,a=0,l=0,h=s.length,p=h-1;l<h;p=l++)a+=((r=s[p]).x-(e=s[l]).x)*(e.y+r.y);return a}Fl.types=["Unknown","Point","LineString","Polygon"],Fl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var e,r=s.readVarint()+s.pos,a=1,l=0,h=0,p=0,y=[];s.pos<r;){if(l<=0){var v=s.readVarint();a=7&v,l=v>>3}if(l--,a===1||a===2)h+=s.readSVarint(),p+=s.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new Fb(h,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Fl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var e=s.readVarint()+s.pos,r=1,a=0,l=0,h=0,p=1/0,y=-1/0,v=1/0,b=-1/0;s.pos<e;){if(a<=0){var T=s.readVarint();r=7&T,a=T>>3}if(a--,r===1||r===2)(l+=s.readSVarint())<p&&(p=l),l>y&&(y=l),(h+=s.readSVarint())<v&&(v=h),h>b&&(b=h);else if(r!==7)throw new Error("unknown command "+r)}return[p,v,y,b]},Fl.prototype.toGeoJSON=function(s,e,r){var a,l,h=this.extent*Math.pow(2,r),p=this.extent*s,y=this.extent*e,v=this.loadGeometry(),b=Fl.types[this.type];function T(L){for(var R=0;R<L.length;R++){var B=L[R];L[R]=[360*(B.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(a=0;a<v.length;a++)k[a]=v[a][0];T(v=k);break;case 2:for(a=0;a<v.length;a++)T(v[a]);break;case 3:for(v=function(L){var R=L.length;if(R<=1)return[L];for(var B,H,re=[],pe=0;pe<R;pe++){var ie=Ub(L[pe]);ie!==0&&(H===void 0&&(H=ie<0),H===ie<0?(B&&re.push(B),B=[L[pe]]):B.push(L[pe]))}return B&&re.push(B),re}(v),a=0;a<v.length;a++)for(l=0;l<v[a].length;l++)T(v[a][l])}v.length===1?v=v[0]:b="Multi"+b;var M={type:"Feature",geometry:{type:b,coordinates:v},properties:this.properties};return"id"in this&&(M.id=this.id),M};var Vb=tx,sx=rx;function rx(s,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(qb,this,e),this.length=this._features.length}function qb(s,e,r){s===15?e.version=r.readVarint():s===1?e.name=r.readString():s===5?e.extent=r.readVarint():s===2?e._features.push(r.pos):s===3?e._keys.push(r.readString()):s===4&&e._values.push(function(a){for(var l=null,h=a.readVarint()+a.pos;a.pos<h;){var p=a.readVarint()>>3;l=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return l}(r))}rx.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var e=this._pbf.readVarint()+this._pbf.pos;return new Vb(this._pbf,e,this.extent,this._keys,this._values)};var $b=sx;function Gb(s,e,r){if(s===3){var a=new $b(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var vp=dh.VectorTile=function(s,e){this.layers=s.readFields(Gb,{},e)},uh=dh.VectorTileFeature=tx;function hh(s,e,r,a){const l=[],h=a===0?(p,y,v,b,T,k)=>{p.push(new Ee(k,v+(k-y)/(b-y)*(T-v)))}:(p,y,v,b,T,k)=>{p.push(new Ee(y+(k-v)/(T-v)*(b-y),k))};for(const p of s){const y=[];for(const v of p){if(v.length<=2)continue;const b=[];for(let M=0;M<v.length-1;M++){const L=v[M].x,R=v[M].y,B=v[M+1].x,H=v[M+1].y,re=a===0?L:R,pe=a===0?B:H;re<e?pe>e&&h(b,L,R,B,H,e):re>r?pe<r&&h(b,L,R,B,H,r):b.push(v[M]),pe<e&&re>=e&&h(b,L,R,B,H,e),pe>r&&re<=r&&h(b,L,R,B,H,r)}let T=v[v.length-1];const k=a===0?T.x:T.y;k>=e&&k<=r&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),y.push(b))}y.length&&l.push(y)}return l}dh.VectorTileLayer=sx;const Zb=uh.types,Wb=Math.pow(2,13);function jd(s,e,r,a,l,h,p,y){s.emplaceBack((e<<1)+p,(r<<1)+h,(Math.floor(a*Wb)<<1)+l,Math.round(y))}function Nd(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class ix{constructor(){this.acc=new Ee(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ee(e.x,e.y),this.max=new Ee(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,l=this.max;e.x<a.x?a.x=e.x:e.x>l.x&&(l.x=e.x),e.y<a.y?a.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===zt)&&e.x===r.x)!=((e.y===0||e.y===zt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,us(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>zt!=e.x>zt&&this.addBorderIntersection(1,us(r.y,e.y,(zt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,us(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>zt!=e.y>zt&&this.addBorderIntersection(3,us(r.x,e.x,(zt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((r,a)=>r+a.edges,0);return e!==0?this.acc.div(e)._round():new Ee(0,0)}span(){return new Ee(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Sd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Qe,this.centroidVertexArray=new mn,this.indexArray=new Pt,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new ar,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,a,l){this.features=[],this.hasPattern=yp("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(h){const p=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*p/(p*p+1)/zt/(1<<h.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:h,id:p,index:y,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,T=Oo(h,b);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),T,a))continue;const k={id:p,sourceLayerIndex:v,index:y,geometry:b?T.geometry:oa(h,a,l),properties:h.properties,type:h.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(_p("fill-extrusion",this.layers,k,this.zoom,r)):this.addFeature(k,k.geometry,y,a,{},r.availableImages,l),r.featureIndex.insert(h,k.geometry,y,v,this.index,M)}this.sortBorders()}addFeatures(e,r,a,l,h){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,r,a,l,h)}this.sortBorders()}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ob),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,zb.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,l,h,p,y){const v=[new Ee(0,0),new Ee(zt,zt)],b=y.projection,T=b.name==="globe",k=this.enableTerrain&&!T?new ix:null,M=Zb[e.type]==="Polygon";T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new lt);const L=xp(r,500);for(let re=L.length-1;re>=0;re--){const pe=L[re];(pe.length===0||(R=pe[0]).every(ie=>ie.x<=0)||R.every(ie=>ie.x>=zt)||R.every(ie=>ie.y<=0)||R.every(ie=>ie.y>=zt))&&L.splice(re,1)}var R;let B;if(T)B=ux(L,v,l);else{B=[];for(const re of L)B.push({polygon:re,bounds:v})}const H=M?this.edgeRadius:0;for(const{polygon:re,bounds:pe}of B){let ie=0,ue=0;for(const ge of re)M&&!ge[0].equals(ge[ge.length-1])&&ge.push(ge[0]),ue+=M?ge.length-1:ge.length;const xe=this.segments.prepareSegment((M?5:4)*ue,this.layoutVertexArray,this.indexArray);if(M){const ge=[],Ue=[];ie=xe.vertexLength;for(const He of re){let ot,qe;He.length&&He!==re[0]&&Ue.push(ge.length/2),ot=He[1].sub(He[0])._perp()._unit();for(let Je=1;Je<He.length;Je++){const Ye=He[Je],rt=He[Je===He.length-1?1:Je+1];let{x:mt,y:Ze}=Ye;if(H){qe=rt.sub(Ye)._perp()._unit();const vt=ot.add(qe)._unit(),At=H*Math.min(4,1/(ot.x*vt.x+ot.y*vt.y));mt+=At*vt.x,Ze+=At*vt.y,ot=qe}jd(this.layoutVertexArray,mt,Ze,0,0,1,1,0),xe.vertexLength++,ge.push(Ye.x,Ye.y),T&&Nd(this.layoutVertexExtArray,b.projectTilePoint(mt,Ze,l),b.upVector(l,mt,Ze))}}const Oe=gp(ge,Ue);for(let He=0;He<Oe.length;He+=3)this.indexArray.emplaceBack(ie+Oe[He],ie+Oe[He+2],ie+Oe[He+1]),xe.primitiveLength++}for(const ge of re){k&&ge.length&&k.startRing(ge[0]);let Ue,Oe,He,ot=ge.length>4&&lx(ge[ge.length-2],ge[0],ge[1]),qe=H?Hb(ge[ge.length-2],ge[0],ge[1],H):0;Oe=ge[1].sub(ge[0])._perp()._unit();let Je=!0;for(let Ye=1,rt=0;Ye<ge.length;Ye++){let mt=ge[Ye-1],Ze=ge[Ye];const vt=ge[Ye===ge.length-1?1:Ye+1];if(k&&M&&k.currentPolyCount.top++,ox(Ze,mt,pe)){H&&(Oe=vt.sub(Ze)._perp()._unit(),Je=!Je);continue}k&&k.append(Ze,mt);const At=Ze.sub(mt)._perp(),bt=At.x/(Math.abs(At.x)+Math.abs(At.y)),$t=At.y>0?1:0,pt=mt.dist(Ze);if(rt+pt>32768&&(rt=0),H){He=vt.sub(Ze)._perp()._unit();let Zt=ax(mt,Ze,vt,nx(Oe,He),H);isNaN(Zt)&&(Zt=0);const Ft=Ze.sub(mt)._unit();mt=mt.add(Ft.mult(qe))._round(),Ze=Ze.add(Ft.mult(-Zt))._round(),qe=Zt,Oe=He}const Rt=xe.vertexLength,Gt=ge.length>4&&lx(mt,Ze,vt);let ps=cx(rt,ot,Je);if(jd(this.layoutVertexArray,mt.x,mt.y,bt,$t,0,0,ps),jd(this.layoutVertexArray,mt.x,mt.y,bt,$t,0,1,ps),rt+=pt,ps=cx(rt,Gt,!Je),ot=Gt,jd(this.layoutVertexArray,Ze.x,Ze.y,bt,$t,0,0,ps),jd(this.layoutVertexArray,Ze.x,Ze.y,bt,$t,0,1,ps),xe.vertexLength+=4,this.indexArray.emplaceBack(Rt+0,Rt+1,Rt+2),this.indexArray.emplaceBack(Rt+1,Rt+3,Rt+2),xe.primitiveLength+=2,H){const Zt=ie+(Ye===1?ge.length-2:Ye-2),Ft=Ye===1?ie:Zt+1;if(this.indexArray.emplaceBack(Rt+1,Zt,Rt+3),this.indexArray.emplaceBack(Zt,Ft,Rt+3),xe.primitiveLength+=2,Ue===void 0&&(Ue=Rt),!ox(vt,ge[Ye],pe)){const Rs=Ye===ge.length-1?Ue:xe.vertexLength;this.indexArray.emplaceBack(Rt+2,Rt+3,Rs),this.indexArray.emplaceBack(Rt+3,Rs+1,Rs),this.indexArray.emplaceBack(Rt+3,Ft,Rs+1),xe.primitiveLength+=3}Je=!Je}if(T){const Zt=this.layoutVertexExtArray,Ft=b.projectTilePoint(mt.x,mt.y,l),Rs=b.projectTilePoint(Ze.x,Ze.y,l),Xt=b.upVector(l,mt.x,mt.y),Kt=b.upVector(l,Ze.x,Ze.y);Nd(Zt,Ft,Xt),Nd(Zt,Ft,Xt),Nd(Zt,Rs,Kt),Nd(Zt,Rs,Kt)}}M&&(ie+=ge.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const re=k.borders,pe=this.featuresOnBorder.push(k)-1;for(let ie=0;ie<4;ie++)re[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(pe)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,r,a=!0){let l,h;if(e)if(e.y!==0){const y=r.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else l=Math.ceil(7*(e.x+450)),h=0;else l=0,h=+a;let p=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let v=0;v<y.top;v++)this.centroidVertexArray.emplace(p++,l,h);for(let v=0;v<2*y.edges;v++)this.centroidVertexArray.emplace(p++,0,h),this.centroidVertexArray.emplace(p++,l,h)}}}function nx(s,e){const r=s.add(e)._unit();return s.x*r.x+s.y*r.y}function Hb(s,e,r,a){const l=e.sub(s)._perp()._unit(),h=r.sub(e)._perp()._unit();return ax(s,e,r,nx(l,h),a)}function ax(s,e,r,a,l){const h=Math.sqrt(1-a*a);return Math.min(s.dist(e)/3,e.dist(r)/3,l*h/a)}function ox(s,e,r){return s.x<r[0].x&&e.x<r[0].x||s.x>r[1].x&&e.x>r[1].x||s.y<r[0].y&&e.y<r[0].y||s.y>r[1].y&&e.y>r[1].y}function lx(s,e,r){if(s.x<0||s.x>=zt||e.x<0||e.x>=zt||r.x<0||r.x>=zt)return!1;const a=r.sub(e),l=a.perp(),h=s.sub(e);return(a.x*h.x+a.y*h.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(h.x*h.x+h.y*h.y))>-.866&&l.x*h.x+l.y*h.y<0}function cx(s,e,r){const a=e?2|s:-3&s;return r?1|a:-2&a}function dx(){const s=Math.PI/32,e=Math.tan(s),r=yd;return r*Math.sqrt(1+2*e*e)-r}function ux(s,e,r){const a=1<<r.z,l=Ri(r.x/a),h=Ri((r.x+1)/a),p=$r(r.y/a),y=$r((r.y+1)/a);return function(v,b,T,k,M=0,L){const R=[];if(!v.length||!T||!k)return R;const B=(ge,Ue)=>{for(const Oe of ge)R.push({polygon:Oe,bounds:Ue})},H=Math.ceil(Math.log2(T)),re=Math.ceil(Math.log2(k)),pe=H-re,ie=[];for(let ge=0;ge<Math.abs(pe);ge++)ie.push(pe>0?0:1);for(let ge=0;ge<Math.min(H,re);ge++)ie.push(0),ie.push(1);let ue=v;if(ue=hh(ue,b[0].y-M,b[1].y+M,1),ue=hh(ue,b[0].x-M,b[1].x+M,0),!ue.length)return R;const xe=[];for(ie.length?xe.push({polygons:ue,bounds:b,depth:0}):B(ue,b);xe.length;){const ge=xe.pop(),Ue=ge.depth,Oe=ie[Ue],He=ge.bounds[0],ot=ge.bounds[1],qe=Oe===0?He.x:He.y,Je=Oe===0?ot.x:ot.y,Ye=L?L(Oe,qe,Je):.5*(qe+Je),rt=hh(ge.polygons,qe-M,Ye+M,Oe),mt=hh(ge.polygons,Ye-M,Je+M,Oe);if(rt.length){const Ze=[He,new Ee(Oe===0?Ye:ot.x,Oe===1?Ye:ot.y)];ie.length>Ue+1?xe.push({polygons:rt,bounds:Ze,depth:Ue+1}):B(rt,Ze)}if(mt.length){const Ze=[new Ee(Oe===0?Ye:He.x,Oe===1?Ye:He.y),ot];ie.length>Ue+1?xe.push({polygons:mt,bounds:Ze,depth:Ue+1}):B(mt,Ze)}}return R}(s,e,Math.ceil((h-l)/11.25),Math.ceil((p-y)/11.25),1,(v,b,T)=>{if(v===0)return .5*(b+T);{const k=$r((r.y+b/zt)/a);return(Rn(.5*($r((r.y+T/zt)/a)+k))*a-r.y)*zt}})}Et(Sd,"FillExtrusionBucket",{omit:["layers","features"]}),Et(ix,"PartMetadata");const Xb=new le({"fill-extrusion-edge-radius":new F(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Kb={paint:new le({"fill-extrusion-opacity":new F(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new K(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new F(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new F(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new K(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new K(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new K(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new F(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new F(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new F(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new F(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Xb};function hx(s,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[s*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class mh{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Td(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=function(h,p,y){var v=hx(256*h,256*(p=Math.pow(2,y)-p-1),y),b=hx(256*(h+1),256*(p+1),y);return v[0]+","+v[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),l=function(h,p,y){let v,b="";for(let T=h;T>0;T--)v=1<<T-1,b+=(p&v?1:0)+(y&v?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mx{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Td(e,r.z,r.z,r.x,r.y)}}class ii{constructor(e,r,a,l,h){this.overscaledZ=e,this.wrap=r,this.canonical=new mh(a,+l,+h),this.key=r===0&&e===a?this.canonical.key:Td(r,e,a,l,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new ii(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ii(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Td(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Td(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ii(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new ii(r,this.wrap,r,a,l),new ii(r,this.wrap,r,a+1,l),new ii(r,this.wrap,r,a,l+1),new ii(r,this.wrap,r,a+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ii(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ii(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Td(s,e,r,a,l){const h=1<<Math.min(r,22);let p=h*(l%h)+a%h;return s&&r<22&&(p+=h*h*((s<0?-2*s-1:2*s)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}Et(mh,"CanonicalTileID"),Et(ii,"OverscaledTileID",{omit:["projMatrix"]});class Bl extends Ee{constructor(e,r,a){super(e,r),this.z=a}}function Ed(s,e){return s.x*e.x+s.y*e.y}function px(s,e){if(s.length===1){let r=0;const a=e[r++];let l;for(;!l||a.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const h=e[r],p=s[0],y=l.sub(a),v=h.sub(a),b=p.sub(a),T=Ed(y,y),k=Ed(y,v),M=Ed(v,v),L=Ed(b,y),R=Ed(b,v),B=T*M-k*k,H=(M*L-k*R)/B,re=(T*R-k*L)/B,pe=a.z*(1-H-re)+l.z*H+h.z*re;if(isFinite(pe))return pe}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function fx(s,e,r,a,l,h,p,y){const v=p*l.getElevationAt(s,e,!0,!0),b=h[0]!==0,T=b?h[1]===0?p*(h[0]/7-450):p*function(k,M,L){const R=Math.floor(M[0]/8),B=Math.floor(M[1]/8),H=10*(M[0]-8*R),re=10*(M[1]-8*B),pe=k.getElevationAt(R,B,!0,!0),ie=k.getMeterToDEM(L),ue=Math.floor(.5*(H*ie-1)),xe=Math.floor(.5*(re*ie-1)),ge=k.tileCoordToPixel(R,B),Ue=2*ue+1,Oe=2*xe+1,He=function(mt,Ze,vt,At,bt){return[mt.getElevationAtPixel(Ze,vt,!0),mt.getElevationAtPixel(Ze+bt,vt,!0),mt.getElevationAtPixel(Ze,vt+bt,!0),mt.getElevationAtPixel(Ze+At,vt+bt,!0)]}(k,ge.x-ue,ge.y-xe,Ue,Oe),ot=Math.abs(He[0]-He[1]),qe=Math.abs(He[2]-He[3]),Je=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),Ye=Math.min(.25,.5*ie*(ot+qe)/Ue),rt=Math.min(.25,.5*ie*Je/Oe);return pe+Math.max(Ye*H,rt*re)}(l,h,y):v;return{base:v+(r===0)?-1:r,top:b?Math.max(T+a,v+r+2):v+a}}const Qb=ke([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Jb}=Qb,Yb=ke([{name:"a_packed",components:4,type:"Float32"}]),{members:ew}=Yb,tw=uh.types,sw=Math.cos(Math.PI/180*37.5);class ph{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ve,this.layoutVertexArray2=new nt,this.indexArray=new Pt,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new ar,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,l){this.hasPattern=yp("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:T,id:k,index:M,sourceLayerIndex:L}of e){const R=this.layers[0]._featureFilter.needGeometry,B=Oo(T,R);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),B,a))continue;const H=h?h.evaluate(B,{},a):void 0,re={id:k,properties:T.properties,type:T.type,sourceLayerIndex:L,index:M,geometry:R?B.geometry:oa(T,a,l),patterns:{},sortKey:H};p.push(re)}h&&p.sort((T,k)=>T.sortKey-k.sortKey);const{lineAtlas:y,featureIndex:v}=r,b=this.addConstantDashes(y);for(const T of p){const{geometry:k,index:M,sourceLayerIndex:L}=T;if(b&&this.addFeatureDashes(T,y),this.hasPattern){const R=_p("line",this.layers,T,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(T,k,M,a,y.positions,r.availableImages);v.insert(e[M].feature,k,M,L,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind!=="constant"||h.kind!=="constant")r=!0;else{const p=h.value,y=l.value;if(!y)continue;e.addDash(y,p)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(h.kind==="constant"&&p.kind==="constant")continue;let y,v;if(h.kind==="constant"){if(y=h.value,!y)continue}else y=h.evaluate({zoom:a},e);v=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),r.addDash(y,v),e.patterns[l.id]=r.getKey(y,v)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}addFeatures(e,r,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ew)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,l,h,p){const y=this.layers[0].layout,v=y.get("line-join").evaluate(e,{}),b=y.get("line-cap").evaluate(e,{}),T=y.get("line-miter-limit"),k=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of r)this.addLine(M,e,v,b,T,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}addLine(e,r,a,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<e.length-1;re++)this.totalDistance+=e[re].dist(e[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=tw[r.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let b=0;for(;b<v-1&&e[b].equals(e[b+1]);)b++;if(v<(y?3:2))return;a==="bevel"&&(h=1.05);const T=this.overscaling<=16?15*zt/(512*this.overscaling):0,k=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let M,L,R,B,H;this.e1=this.e2=-1,y&&(M=e[v-2],H=e[b].sub(M)._unit()._perp());for(let re=b;re<v;re++){if(R=re===v-1?y?e[b+1]:void 0:e[re+1],R&&e[re].equals(R))continue;H&&(B=H),M&&(L=M),M=e[re],H=R?R.sub(M)._unit()._perp():B,B=B||H;let pe=B.add(H);pe.x===0&&pe.y===0||pe._unit();const ie=B.x*H.x+B.y*H.y,ue=pe.x*H.x+pe.y*H.y,xe=ue!==0?1/ue:1/0,ge=2*Math.sqrt(2-2*ue),Ue=ue<sw&&L&&R,Oe=B.x*H.y-B.y*H.x>0;if(Ue&&re>b){const qe=M.dist(L);if(qe>2*T){const Je=M.sub(M.sub(L)._mult(T/qe)._round());this.updateDistance(L,Je),this.addCurrentVertex(Je,B,0,0,k),L=Je}}const He=L&&R;let ot=He?a:y?"butt":l;if(He&&ot==="round"&&(xe<p?ot="miter":xe<=2&&(ot="fakeround")),ot==="miter"&&xe>h&&(ot="bevel"),ot==="bevel"&&(xe>2&&(ot="flipbevel"),xe<h&&(ot="miter")),L&&this.updateDistance(L,M),ot==="miter")pe._mult(xe),this.addCurrentVertex(M,pe,0,0,k);else if(ot==="flipbevel"){if(xe>100)pe=H.mult(-1);else{const qe=xe*B.add(H).mag()/B.sub(H).mag();pe._perp()._mult(qe*(Oe?-1:1))}this.addCurrentVertex(M,pe,0,0,k),this.addCurrentVertex(M,pe.mult(-1),0,0,k)}else if(ot==="bevel"||ot==="fakeround"){const qe=-Math.sqrt(xe*xe-1),Je=Oe?qe:0,Ye=Oe?0:qe;if(L&&this.addCurrentVertex(M,B,Je,Ye,k),ot==="fakeround"){const rt=Math.round(180*ge/Math.PI/20);for(let mt=1;mt<rt;mt++){let Ze=mt/rt;if(Ze!==.5){const At=Ze-.5;Ze+=Ze*At*(Ze-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*At*At+(.848013+ie*(.215638*ie-1.06021)))}const vt=H.sub(B)._mult(Ze)._add(B)._unit()._mult(Oe?-1:1);this.addHalfVertex(M,vt.x,vt.y,!1,Oe,0,k)}}R&&this.addCurrentVertex(M,H,-Je,-Ye,k)}else if(ot==="butt")this.addCurrentVertex(M,pe,0,0,k);else if(ot==="square"){const qe=L?1:-1;L||this.addCurrentVertex(M,pe,qe,qe,k),this.addCurrentVertex(M,pe,0,0,k),L&&this.addCurrentVertex(M,pe,qe,qe,k)}else ot==="round"&&(L&&(this.addCurrentVertex(M,B,0,0,k),this.addCurrentVertex(M,B,1,1,k,!0)),R&&(this.addCurrentVertex(M,H,-1,-1,k,!0),this.addCurrentVertex(M,H,0,0,k)));if(Ue&&re<v-1){const qe=M.dist(R);if(qe>2*T){const Je=M.add(R.sub(M)._mult(T/qe)._round());this.updateDistance(M,Je),this.addCurrentVertex(Je,H,0,0,k),M=Je}}}}addCurrentVertex(e,r,a,l,h,p=!1){const y=r.y*l-r.x,v=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,p,!1,a,h),this.addHalfVertex(e,y,v,p,!0,-l,h)}addHalfVertex({x:e,y:r},a,l,h,p,y,v){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),v.primitiveLength++),p?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Et(ph,"LineBucket",{omit:["layers","patternFeatures"]});const rw=new le({"line-cap":new K(We.layout_line["line-cap"]),"line-join":new K(We.layout_line["line-join"]),"line-miter-limit":new F(We.layout_line["line-miter-limit"]),"line-round-limit":new F(We.layout_line["line-round-limit"]),"line-sort-key":new K(We.layout_line["line-sort-key"])});var gx={paint:new le({"line-opacity":new K(We.paint_line["line-opacity"]),"line-color":new K(We.paint_line["line-color"]),"line-translate":new F(We.paint_line["line-translate"]),"line-translate-anchor":new F(We.paint_line["line-translate-anchor"]),"line-width":new K(We.paint_line["line-width"]),"line-gap-width":new K(We.paint_line["line-gap-width"]),"line-offset":new K(We.paint_line["line-offset"]),"line-blur":new K(We.paint_line["line-blur"]),"line-dasharray":new K(We.paint_line["line-dasharray"]),"line-pattern":new K(We.paint_line["line-pattern"]),"line-gradient":new ae(We.paint_line["line-gradient"]),"line-trim-offset":new F(We.paint_line["line-trim-offset"])}),layout:rw};const xx=new class extends K{possiblyEvaluate(s,e){return e=new C(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(s,e)}evaluate(s,e,r,a){return e=Ut({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(s,e,r,a)}}(gx.paint.properties["line-width"].specification);function yx(s,e){return e>0?e+2*s:s}xx.useIntegerZoom=!0;const iw=ke([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nw=ke([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),aw=ke([{name:"a_projected_pos",components:4,type:"Float32"}],4);ke([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ow=ke([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),lw=ke([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _x=ke([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cw=ke([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ke([{name:"triangle",components:3,type:"Uint16"}]),ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ke([{type:"Float32",name:"offsetX"}]),ke([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Rr=24;const _n=128;function bp(s,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new C(s+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:l}=r;let h=0;for(;h<a.length&&a[h]<=s;)h++;h=Math.max(0,h-1);let p=h;for(;p<a.length&&a[p]<s+1;)p++;p=Math.min(a.length-1,p);const y=a[h],v=a[p];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:v,minSize:r.evaluate(new C(y)),maxSize:r.evaluate(new C(v)),interpolationType:l}}}function fh(s,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:l}){return s.kind==="source"?a/_n:s.kind==="composite"?us(a/_n,l/_n,r):e}function Ul(s,e){let r=0,a=0;if(s.kind==="constant")a=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=s,y=l?ht(qi.interpolationFactor(l,e,h,p),0,1):0;s.kind==="camera"?a=us(s.minSize,s.maxSize,y):r=y}return{uSizeT:r,uSize:a}}var dw=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:_n,evaluateSizeForFeature:fh,evaluateSizeForZoom:Ul,getSizeData:bp});function uw(s,e,r){return s.sections.forEach(a=>{a.text=function(l,h,p){const y=h.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),S.applyArabicShaping&&(l=S.applyArabicShaping(l)),l}(a.text,e,r)}),s}const Cd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function hw(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function mw(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var vx=Ms,bx=function(s,e,r,a,l){var h,p,y=8*l-a-1,v=(1<<y)-1,b=v>>1,T=-7,k=l-1,M=-1,L=s[e+k];for(k+=M,h=L&(1<<-T)-1,L>>=-T,T+=y;T>0;h=256*h+s[e+k],k+=M,T-=8);for(p=h&(1<<-T)-1,h>>=-T,T+=a;T>0;p=256*p+s[e+k],k+=M,T-=8);if(h===0)h=1-b;else{if(h===v)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,a),h-=b}return(L?-1:1)*p*Math.pow(2,h-a)},wx=function(s,e,r,a,l,h){var p,y,v,b=8*h-l-1,T=(1<<b)-1,k=T>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=0,R=1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-p))<1&&(p--,v*=2),(e+=p+k>=1?M/v:M*Math.pow(2,1-k))*v>=2&&(p++,v/=2),p+k>=T?(y=0,p=T):p+k>=1?(y=(e*v-1)*Math.pow(2,l),p+=k):(y=e*Math.pow(2,k-1)*Math.pow(2,l),p=0));l>=8;s[r+L]=255&y,L+=R,y/=256,l-=8);for(p=p<<l|y,b+=l;b>0;s[r+L]=255&p,L+=R,p/=256,b-=8);s[r+L-R]|=128*B};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Ms(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Ms.Varint=0,Ms.Fixed64=1,Ms.Bytes=2,Ms.Fixed32=5;var wp=4294967296,jx=1/wp,Nx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ca(s){return s.type===Ms.Bytes?s.readVarint()+s.pos:s.pos+1}function Vl(s,e,r){return r?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function Sx(s,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=s;l--)r.buf[l+a]=r.buf[l]}function pw(s,e){for(var r=0;r<s.length;r++)e.writeVarint(s[r])}function fw(s,e){for(var r=0;r<s.length;r++)e.writeSVarint(s[r])}function gw(s,e){for(var r=0;r<s.length;r++)e.writeFloat(s[r])}function xw(s,e){for(var r=0;r<s.length;r++)e.writeDouble(s[r])}function yw(s,e){for(var r=0;r<s.length;r++)e.writeBoolean(s[r])}function _w(s,e){for(var r=0;r<s.length;r++)e.writeFixed32(s[r])}function vw(s,e){for(var r=0;r<s.length;r++)e.writeSFixed32(s[r])}function bw(s,e){for(var r=0;r<s.length;r++)e.writeFixed64(s[r])}function ww(s,e){for(var r=0;r<s.length;r++)e.writeSFixed64(s[r])}function gh(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+16777216*s[e+3]}function ql(s,e,r){s[r]=e,s[r+1]=e>>>8,s[r+2]=e>>>16,s[r+3]=e>>>24}function Tx(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+(s[e+3]<<24)}Ms.prototype={destroy:function(){this.buf=null},readFields:function(s,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,h=this.pos;this.type=7&a,s(l,e,this),this.pos===h&&this.skip(a)}return e},readMessage:function(s,e){return this.readFields(s,e,this.readVarint()+this.pos)},readFixed32:function(){var s=gh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Tx(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=gh(this.buf,this.pos)+gh(this.buf,this.pos+4)*wp;return this.pos+=8,s},readSFixed64:function(){var s=gh(this.buf,this.pos)+Tx(this.buf,this.pos+4)*wp;return this.pos+=8,s},readFloat:function(){var s=bx(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=bx(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(l,h,p){var y,v,b=p.buf;if(y=(112&(v=b[p.pos++]))>>4,v<128||(y|=(127&(v=b[p.pos++]))<<3,v<128)||(y|=(127&(v=b[p.pos++]))<<10,v<128)||(y|=(127&(v=b[p.pos++]))<<17,v<128)||(y|=(127&(v=b[p.pos++]))<<24,v<128)||(y|=(1&(v=b[p.pos++]))<<31,v<128))return Vl(l,y,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&Nx?function(r,a,l){return Nx.decode(r.subarray(a,l))}(this.buf,e,s):function(r,a,l){for(var h="",p=a;p<l;){var y,v,b,T=r[p],k=null,M=T>239?4:T>223?3:T>191?2:1;if(p+M>l)break;M===1?T<128&&(k=T):M===2?(192&(y=r[p+1]))==128&&(k=(31&T)<<6|63&y)<=127&&(k=null):M===3?(v=r[p+2],(192&(y=r[p+1]))==128&&(192&v)==128&&((k=(15&T)<<12|(63&y)<<6|63&v)<=2047||k>=55296&&k<=57343)&&(k=null)):M===4&&(v=r[p+2],b=r[p+3],(192&(y=r[p+1]))==128&&(192&v)==128&&(192&b)==128&&((k=(15&T)<<18|(63&y)<<12|(63&v)<<6|63&b)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,M=1):k>65535&&(k-=65536,h+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),h+=String.fromCharCode(k),p+=M}return h}(this.buf,e,s)},readBytes:function(){var s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e},readPackedVarint:function(s,e){if(this.type!==Ms.Bytes)return s.push(this.readVarint(e));var r=ca(this);for(s=s||[];this.pos<r;)s.push(this.readVarint(e));return s},readPackedSVarint:function(s){if(this.type!==Ms.Bytes)return s.push(this.readSVarint());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Ms.Bytes)return s.push(this.readBoolean());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Ms.Bytes)return s.push(this.readFloat());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Ms.Bytes)return s.push(this.readDouble());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Ms.Bytes)return s.push(this.readFixed32());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Ms.Bytes)return s.push(this.readSFixed32());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Ms.Bytes)return s.push(this.readFixed64());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Ms.Bytes)return s.push(this.readSFixed64());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed64());return s},skip:function(s){var e=7&s;if(e===Ms.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ms.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ms.Fixed32)this.pos+=4;else{if(e!==Ms.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(s,e){this.writeVarint(s<<3|e)},realloc:function(s){for(var e=this.length||16;e<this.pos+s;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),ql(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),ql(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),ql(this.buf,-1&s,this.pos),ql(this.buf,Math.floor(s*jx),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),ql(this.buf,-1&s,this.pos),ql(this.buf,Math.floor(s*jx),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(e,r){var a,l;if(e>=0?(a=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,p,y){y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,y.buf[y.pos]=127&(h>>>=7)}(a,0,r),function(h,p){var y=(7&h)<<4;p.buf[p.pos++]|=y|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,r)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var e=this.pos;this.pos=function(a,l,h){for(var p,y,v=0;v<l.length;v++){if((p=l.charCodeAt(v))>55295&&p<57344){if(!y){p>56319||v+1===l.length?(a[h++]=239,a[h++]=191,a[h++]=189):y=p;continue}if(p<56320){a[h++]=239,a[h++]=191,a[h++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(a[h++]=239,a[h++]=191,a[h++]=189,y=null);p<128?a[h++]=p:(p<2048?a[h++]=p>>6|192:(p<65536?a[h++]=p>>12|224:(a[h++]=p>>18|240,a[h++]=p>>12&63|128),a[h++]=p>>6&63|128),a[h++]=63&p|128)}return h}(this.buf,s,this.pos);var r=this.pos-e;r>=128&&Sx(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(s){this.realloc(4),wx(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),wx(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var e=s.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=s[r]},writeRawMessage:function(s,e){this.pos++;var r=this.pos;s(e,this);var a=this.pos-r;a>=128&&Sx(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(s,e,r){this.writeTag(s,Ms.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(s,e){e.length&&this.writeMessage(s,pw,e)},writePackedSVarint:function(s,e){e.length&&this.writeMessage(s,fw,e)},writePackedBoolean:function(s,e){e.length&&this.writeMessage(s,yw,e)},writePackedFloat:function(s,e){e.length&&this.writeMessage(s,gw,e)},writePackedDouble:function(s,e){e.length&&this.writeMessage(s,xw,e)},writePackedFixed32:function(s,e){e.length&&this.writeMessage(s,_w,e)},writePackedSFixed32:function(s,e){e.length&&this.writeMessage(s,vw,e)},writePackedFixed64:function(s,e){e.length&&this.writeMessage(s,bw,e)},writePackedSFixed64:function(s,e){e.length&&this.writeMessage(s,ww,e)},writeBytesField:function(s,e){this.writeTag(s,Ms.Bytes),this.writeBytes(e)},writeFixed32Field:function(s,e){this.writeTag(s,Ms.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(s,e){this.writeTag(s,Ms.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(s,e){this.writeTag(s,Ms.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(s,e){this.writeTag(s,Ms.Fixed64),this.writeSFixed64(e)},writeVarintField:function(s,e){this.writeTag(s,Ms.Varint),this.writeVarint(e)},writeSVarintField:function(s,e){this.writeTag(s,Ms.Varint),this.writeSVarint(e)},writeStringField:function(s,e){this.writeTag(s,Ms.Bytes),this.writeString(e)},writeFloatField:function(s,e){this.writeTag(s,Ms.Fixed32),this.writeFloat(e)},writeDoubleField:function(s,e){this.writeTag(s,Ms.Fixed64),this.writeDouble(e)},writeBooleanField:function(s,e){this.writeVarintField(s,!!e)}};var xh=Ne(vx);const jp=3;function jw(s,e,r){e.glyphs=[],s===1&&r.readMessage(Nw,e)}function Nw(s,e,r){if(s===3){const{id:a,bitmap:l,width:h,height:p,left:y,top:v,advance:b}=r.readMessage(Sw,{});e.glyphs.push({id:a,bitmap:new la({width:h+2*jp,height:p+2*jp},l),metrics:{width:h,height:p,left:y,top:v,advance:b}})}else s===4?e.ascender=r.readSVarint():s===5&&(e.descender=r.readSVarint())}function Sw(s,e,r){s===1?e.id=r.readVarint():s===2?e.bitmap=r.readBytes():s===3?e.width=r.readVarint():s===4?e.height=r.readVarint():s===5?e.left=r.readSVarint():s===6?e.top=r.readSVarint():s===7&&(e.advance=r.readVarint())}const Ex=jp;function Np(s){let e=0,r=0;for(const p of s)e+=p.w*p.h,r=Math.max(r,p.w);s.sort((p,y)=>y.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,h=0;for(const p of s)for(let y=a.length-1;y>=0;y--){const v=a[y];if(!(p.w>v.w||p.h>v.h)){if(p.x=v.x,p.y=v.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===v.w&&p.h===v.h){const b=a.pop();y<a.length&&(a[y]=b)}else p.h===v.h?(v.x+=p.w,v.w-=p.w):p.w===v.w?(v.y+=p.h,v.h-=p.h):(a.push({x:v.x+p.w,y:v.y,w:v.w-p.w,h:p.h}),v.y+=p.h,v.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}const mi=1;class Sp{constructor(e,{pixelRatio:r,version:a,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+mi,this.paddedRect.y+mi]}get br(){return[this.paddedRect.x+this.paddedRect.w-mi,this.paddedRect.y+this.paddedRect.h-mi]}get displaySize(){return[(this.paddedRect.w-2*mi)/this.pixelRatio,(this.paddedRect.h-2*mi)/this.pixelRatio]}}class Cx{constructor(e,r){const a={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,a,h),this.addImages(r,l,h);const{w:p,h:y}=Np(h),v=new Si({width:p||1,height:y||1});for(const b in e){const T=e[b],k=a[b].paddedRect;Si.copy(T.data,v,{x:0,y:0},{x:k.x+mi,y:k.y+mi},T.data)}for(const b in r){const T=r[b],k=l[b].paddedRect,M=k.x+mi,L=k.y+mi,R=T.data.width,B=T.data.height;Si.copy(T.data,v,{x:0,y:0},{x:M,y:L},T.data),Si.copy(T.data,v,{x:0,y:B-1},{x:M,y:L-1},{width:R,height:1}),Si.copy(T.data,v,{x:0,y:0},{x:M,y:L+B},{width:R,height:1}),Si.copy(T.data,v,{x:R-1,y:0},{x:M-1,y:L},{width:1,height:B}),Si.copy(T.data,v,{x:0,y:0},{x:M+R,y:L},{width:1,height:B})}this.image=v,this.iconPositions=a,this.patternPositions=l}addImages(e,r,a){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2*mi,h:h.data.height+2*mi};a.push(p),r[l]=new Sp(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,h]=e.tl;a.update(r.data,void 0,{x:l,y:h})}}Et(Sp,"ImagePosition"),Et(Cx,"ImageAtlas");const zi={horizontal:1,vertical:2,horizontalOnly:3},kx=-17;class kd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new kd;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new kd;return r.imageName=e,r}}class $l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new $l;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?a.addImageSection(h):a.addTextSection(h,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,a){let l="";for(let h=0;h<r.length;h++){const p=r.charCodeAt(h+1)||null,y=r.charCodeAt(h-1)||null;l+=!a&&(p&&Zu(p)&&!Cd[r[h+1]]||y&&Zu(y)&&!Cd[r[h-1]])||!Cd[r[h]]?r[h]:Cd[r[h]]}return l}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&yh[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&yh[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new $l;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(kd.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void As("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(kd.forImage(r)),this.sectionIndex.push(this.sections.length-1)):As("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tp(s,e,r,a,l,h,p,y,v,b,T,k,M,L,R){const B=$l.fromFeature(s,l);k===zi.vertical&&B.verticalizePunctuation(M);let H=[];const re=function(ge,Ue,Oe,He,ot,qe){if(!ge)return[];const Je=[],Ye=function(vt,At,bt,$t,pt,Rt){let Gt=0;for(let ps=0;ps<vt.length();ps++){const Zt=vt.getSection(ps);Gt+=Ax(vt.getCharCode(ps),Zt,$t,pt,At,Rt)}return Gt/Math.max(1,Math.ceil(Gt/bt))}(ge,Ue,Oe,He,ot,qe),rt=ge.text.indexOf("")>=0;let mt=0;for(let vt=0;vt<ge.length();vt++){const At=ge.getSection(vt),bt=ge.getCharCode(vt);if(yh[bt]||(mt+=Ax(bt,At,He,ot,Ue,qe)),vt<ge.length()-1){const $t=!((Ze=bt)<11904||!(jt["Bopomofo Extended"](Ze)||jt.Bopomofo(Ze)||jt["CJK Compatibility Forms"](Ze)||jt["CJK Compatibility Ideographs"](Ze)||jt["CJK Compatibility"](Ze)||jt["CJK Radicals Supplement"](Ze)||jt["CJK Strokes"](Ze)||jt["CJK Symbols and Punctuation"](Ze)||jt["CJK Unified Ideographs Extension A"](Ze)||jt["CJK Unified Ideographs"](Ze)||jt["Enclosed CJK Letters and Months"](Ze)||jt["Halfwidth and Fullwidth Forms"](Ze)||jt.Hiragana(Ze)||jt["Ideographic Description Characters"](Ze)||jt["Kangxi Radicals"](Ze)||jt["Katakana Phonetic Extensions"](Ze)||jt.Katakana(Ze)||jt["Vertical Forms"](Ze)||jt["Yi Radicals"](Ze)||jt["Yi Syllables"](Ze)));(Tw[bt]||$t||At.imageName)&&Je.push(Px(vt+1,mt,Ye,Je,Ew(bt,ge.getCharCode(vt+1),$t&&rt),!1))}}var Ze;return Ix(Px(ge.length(),mt,Ye,Je,0,!0))}(B,b,h,e,a,L),{processBidirectionalText:pe,processStyledBidirectionalText:ie}=S;if(pe&&B.sections.length===1){const ge=pe(B.toString(),re);for(const Ue of ge){const Oe=new $l;Oe.text=Ue,Oe.sections=B.sections;for(let He=0;He<Ue.length;He++)Oe.sectionIndex.push(0);H.push(Oe)}}else if(ie){const ge=ie(B.text,B.sectionIndex,re);for(const Ue of ge){const Oe=new $l;Oe.text=Ue[0],Oe.sectionIndex=Ue[1],Oe.sections=B.sections,H.push(Oe)}}else H=function(ge,Ue){const Oe=[],He=ge.text;let ot=0;for(const qe of Ue)Oe.push(ge.substring(ot,qe)),ot=qe;return ot<He.length&&Oe.push(ge.substring(ot,He.length)),Oe}(B,re);const ue=[],xe={positionedLines:ue,text:B.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Ue,Oe,He,ot,qe,Je,Ye,rt,mt,Ze,vt){let At=0,bt=0,$t=0;const pt=Ye==="right"?1:Ye==="left"?0:.5;let Rt=!1;for(const Xt of ot){const Kt=Xt.getSections();for(const Es of Kt){if(Es.imageName)continue;const Ps=Ue[Es.fontStack];if(Ps&&(Rt=Ps.ascender!==void 0&&Ps.descender!==void 0,!Rt))break}if(!Rt)break}let Gt=0;for(const Xt of ot){Xt.trim();const Kt=Xt.getMaxScale(),Es=(Kt-1)*Rr,Ps={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Gt]=Ps;const Is=Ps.positionedGlyphs;let Cs=0;if(!Xt.length()){bt+=qe,++Gt;continue}let qs=0,Ws=0;for(let ks=0;ks<Xt.length();ks++){const yr=Xt.getSection(ks),cr=Xt.getSectionIndex(ks),Gs=Xt.getCharCode(ks);let gs=yr.scale,dr=null,Ds=null,ni=null,ur=Rr,zr=0;const Cr=!(rt===zi.horizontal||!Ze&&!sd(Gs)||Ze&&(yh[Gs]||(ps=Gs,jt.Arabic(ps)||jt["Arabic Supplement"](ps)||jt["Arabic Extended-A"](ps)||jt["Arabic Presentation Forms-A"](ps)||jt["Arabic Presentation Forms-B"](ps))));if(yr.imageName){const ai=He[yr.imageName];if(!ai)continue;ni=yr.imageName,ge.iconsInText=ge.iconsInText||!0,Ds=ai.paddedRect;const kr=ai.displaySize;gs=gs*Rr/vt,dr={width:kr[0],height:kr[1],left:mi,top:-Ex,advance:Cr?kr[1]:kr[0],localGlyph:!1},zr=Rt?-dr.height*gs:kx+Kt*Rr-kr[1]*gs,ur=dr.advance;const wn=(Cr?kr[0]:kr[1])*gs-Rr*Kt;wn>0&&wn>Cs&&(Cs=wn)}else{const ai=Oe[yr.fontStack];if(!ai)continue;ai[Gs]&&(Ds=ai[Gs]);const kr=Ue[yr.fontStack];if(!kr)continue;const wn=kr.glyphs[Gs];if(!wn)continue;if(dr=wn.metrics,ur=Gs!==8203?Rr:0,Rt){const Ql=kr.ascender!==void 0?Math.abs(kr.ascender):0,Fd=kr.descender!==void 0?Math.abs(kr.descender):0,Bd=(Ql+Fd)*gs;qs<Bd&&(qs=Bd,Ws=(Ql-Fd)/2*gs),zr=-Ql*gs}else zr=kx+(Kt-gs)*Rr}Cr?(ge.verticalizable=!0,Is.push({glyph:Gs,imageName:ni,x:At,y:bt+zr,vertical:Cr,scale:gs,localGlyph:dr.localGlyph,fontStack:yr.fontStack,sectionIndex:cr,metrics:dr,rect:Ds}),At+=ur*gs+mt):(Is.push({glyph:Gs,imageName:ni,x:At,y:bt+zr,vertical:Cr,scale:gs,localGlyph:dr.localGlyph,fontStack:yr.fontStack,sectionIndex:cr,metrics:dr,rect:Ds}),At+=dr.advance*gs+mt)}Is.length!==0&&($t=Math.max(At-mt,$t),Rt?Dx(Is,pt,Cs,Ws,qe*Kt/2):Dx(Is,pt,Cs,0,qe/2)),At=0;const lr=qe*Kt+Cs;Ps.lineOffset=Math.max(Cs,Es),bt+=lr,++Gt}var ps;const Zt=bt,{horizontalAlign:Ft,verticalAlign:Rs}=Ep(Je);(function(Xt,Kt,Es,Ps,Is,Cs){const qs=(Kt-Es)*Is,Ws=-Cs*Ps;for(const lr of Xt)for(const ks of lr.positionedGlyphs)ks.x+=qs,ks.y+=Ws})(ge.positionedLines,pt,Ft,Rs,$t,Zt),ge.top+=-Rs*Zt,ge.bottom=ge.top+Zt,ge.left+=-Ft*$t,ge.right=ge.left+$t,ge.hasBaseline=Rt}(xe,e,r,a,H,p,y,v,k,b,M,R),!function(ge){for(const Ue of ge)if(Ue.positionedGlyphs.length!==0)return!1;return!0}(ue)&&xe}const yh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Tw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ax(s,e,r,a,l,h){if(e.imageName){const p=a[e.imageName];return p?p.displaySize[0]*e.scale*Rr/h+l:0}{const p=r[e.fontStack],y=p&&p.glyphs[s];return y?y.metrics.advance*e.scale+l:0}}function Mx(s,e,r,a){const l=Math.pow(s-e,2);return a?s<e?l/2:2*l:l+Math.abs(r)*r}function Ew(s,e,r){let a=0;return s===10&&(a-=1e4),r&&(a+=150),s!==40&&s!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Px(s,e,r,a,l,h){let p=null,y=Mx(e,r,l,h);for(const v of a){const b=Mx(e-v.x,r,l,h)+v.badness;b<=y&&(p=v,y=b)}return{index:s,x:e,priorBreak:p,badness:y}}function Ix(s){return s?Ix(s.priorBreak).concat(s.index):[]}function Ep(s){let e=.5,r=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Dx(s,e,r,a,l){if(!(e||r||a||l))return;const h=s.length-1,p=s[h],y=(p.x+p.metrics.advance*p.scale)*e;for(let v=0;v<=h;v++)s[v].x-=y,s[v].y+=r+a+l}function Cw(s,e,r){const{horizontalAlign:a,verticalAlign:l}=Ep(r),h=e[0]-s.displaySize[0]*a,p=e[1]-s.displaySize[1]*l;return{image:s,top:p,bottom:p+s.displaySize[1],left:h,right:h+s.displaySize[0]}}function Lx(s,e,r,a,l,h){const p=s.image;let y;if(p.content){const H=p.content,re=p.pixelRatio||1;y=[H[0]/re,H[1]/re,p.displaySize[0]-H[2]/re,p.displaySize[1]-H[3]/re]}const v=e.left*h,b=e.right*h;let T,k,M,L;r==="width"||r==="both"?(L=l[0]+v-a[3],k=l[0]+b+a[1]):(L=l[0]+(v+b-p.displaySize[0])/2,k=L+p.displaySize[0]);const R=e.top*h,B=e.bottom*h;return r==="height"||r==="both"?(T=l[1]+R-a[0],M=l[1]+B+a[2]):(T=l[1]+(R+B-p.displaySize[1])/2,M=T+p.displaySize[1]),{image:p,top:T,right:k,bottom:M,left:L,collisionPadding:y}}class da extends Ee{constructor(e,r,a,l,h){super(e,r),this.angle=l,this.z=a,h!==void 0&&(this.segment=h)}clone(){return new da(this.x,this.y,this.z,this.angle,this.segment)}}function Rx(s,e,r,a,l){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,y=0;for(;y>-r/2;){if(p--,p<0)return!1;y-=s[p].dist(h),h=s[p]}y+=s[p].dist(s[p+1]),p++;const v=[];let b=0;for(;y<r/2;){const T=s[p],k=s[p+1];if(!k)return!1;let M=s[p-1].angleTo(T)-T.angleTo(k);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:y,angleDelta:M}),b+=M;y-v[0].distance>a;)b-=v.shift().angleDelta;if(b>l)return!1;p++,y+=T.dist(k)}return!0}function zx(s){let e=0;for(let r=0;r<s.length-1;r++)e+=s[r].dist(s[r+1]);return e}function Ox(s,e,r){return s?.6*e*r:0}function Fx(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function kw(s,e,r,a,l,h){const p=Ox(r,l,h),y=Fx(r,a)*h;let v=0;const b=zx(s)/2;for(let T=0;T<s.length-1;T++){const k=s[T],M=s[T+1],L=k.dist(M);if(v+L>b){const R=(b-v)/L,B=us(k.x,M.x,R),H=us(k.y,M.y,R),re=new da(B,H,0,M.angleTo(k),T);return!p||Rx(s,re,y,p,e)?re:void 0}v+=L}}function Aw(s,e,r,a,l,h,p,y,v){const b=Ox(a,h,p),T=Fx(a,l),k=T*p,M=s[0].x===0||s[0].x===v||s[0].y===0||s[0].y===v;return e-k<e/4&&(e=k+e/4),Bx(s,M?e/2*y%e:(T/2+2*h)*p*y%e,e,b,r,k,M,!1,v)}function Bx(s,e,r,a,l,h,p,y,v){const b=h/2,T=zx(s);let k=0,M=e-r,L=[];for(let R=0;R<s.length-1;R++){const B=s[R],H=s[R+1],re=B.dist(H),pe=H.angleTo(B);for(;M+r<k+re;){M+=r;const ie=(M-k)/re,ue=us(B.x,H.x,ie),xe=us(B.y,H.y,ie);if(ue>=0&&ue<v&&xe>=0&&xe<v&&M-b>=0&&M+b<=T){const ge=new da(ue,xe,0,pe,R);ge._round(),a&&!Rx(s,ge,h,a,l)||L.push(ge)}}k+=re}return y||L.length||p||(L=Bx(s,k/2,r,a,l,h,p,!0,v)),L}function Ux(s,e,r,a,l){const h=[];for(let p=0;p<s.length;p++){const y=s[p];let v;for(let b=0;b<y.length-1;b++){let T=y[b],k=y[b+1];T.x<e&&k.x<e||(T.x<e?T=new Ee(e,T.y+(e-T.x)/(k.x-T.x)*(k.y-T.y))._round():k.x<e&&(k=new Ee(e,T.y+(e-T.x)/(k.x-T.x)*(k.y-T.y))._round()),T.y<r&&k.y<r||(T.y<r?T=new Ee(T.x+(r-T.y)/(k.y-T.y)*(k.x-T.x),r)._round():k.y<r&&(k=new Ee(T.x+(r-T.y)/(k.y-T.y)*(k.x-T.x),r)._round()),T.x>=a&&k.x>=a||(T.x>=a?T=new Ee(a,T.y+(a-T.x)/(k.x-T.x)*(k.y-T.y))._round():k.x>=a&&(k=new Ee(a,T.y+(a-T.x)/(k.x-T.x)*(k.y-T.y))._round()),T.y>=l&&k.y>=l||(T.y>=l?T=new Ee(T.x+(l-T.y)/(k.y-T.y)*(k.x-T.x),l)._round():k.y>=l&&(k=new Ee(T.x+(l-T.y)/(k.y-T.y)*(k.x-T.x),l)._round()),v&&T.equals(v[v.length-1])||(v=[T],h.push(v)),v.push(k)))))}}return h}Et(da,"Anchor");const Ad=1e20;function Vx(s,e,r,a,l,h,p,y,v){for(let b=e;b<e+a;b++)qx(s,r*h+b,h,l,p,y,v);for(let b=r;b<r+l;b++)qx(s,b*h+e,1,a,p,y,v)}function qx(s,e,r,a,l,h,p){h[0]=0,p[0]=-Ad,p[1]=Ad,l[0]=s[e];for(let y=1,v=0,b=0;y<a;y++){l[y]=s[e+y*r];const T=y*y;do{const k=h[v];b=(l[y]-l[k]+T-k*k)/(y-k)/2}while(b<=p[v]&&--v>-1);v++,h[v]=y,p[v]=b,p[v+1]=Ad}for(let y=0,v=0;y<a;y++){for(;p[v+1]<y;)v++;const b=h[v],T=y-b;s[e+y*r]=l[b]+T*T}}const vn=2,Cp={none:0,ideographs:1,all:2};class Gl{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const a=[];for(const l in e)for(const h of e[l])a.push({stack:l,id:h});_s(a,({stack:l,id:h},p)=>{let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=y.glyphs[h];if(v!==void 0)return void p(null,{stack:l,id:h,glyph:v});if(v=this._tinySDF(y,l,h),v)return y.glyphs[h]=v,void p(null,{stack:l,id:h,glyph:v});const b=Math.floor(h/256);if(256*b>65535)return void p(new Error("glyphs > 65535 not supported"));if(y.ranges[b])return void p(null,{stack:l,id:h,glyph:v});let T=y.requests[b];T||(T=y.requests[b]=[],Gl.loadGlyphRange(l,b,this.url,this.requestManager,(k,M)=>{if(M){y.ascender=M.ascender,y.descender=M.descender;for(const L in M.glyphs)this._doesCharSupportLocalGlyph(+L)||(y.glyphs[+L]=M.glyphs[+L]);y.ranges[b]=!0}for(const L of T)L(k,M);delete y.requests[b]})),T.push((k,M)=>{k?p(k):M&&p(null,{stack:l,id:h,glyph:M.glyphs[h]||null})})},(l,h)=>{if(l)r(l);else if(h){const p={};for(const{stack:y,id:v,glyph:b}of h)p[y]===void 0&&(p[y]={}),p[y].glyphs===void 0&&(p[y].glyphs={}),p[y].glyphs[v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},p[y].ascender=this.entries[y].ascender,p[y].descender=this.entries[y].descender;r(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Cp.none&&(this.localGlyphMode===Cp.all?!!this.localFontFamily:!!this.localFontFamily&&(jt["CJK Unified Ideographs"](e)||jt["Hangul Syllables"](e)||jt.Hiragana(e)||jt.Katakana(e)||jt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,a){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let B="400";/bold/i.test(r)?B="900":/medium/i.test(r)?B="500":/light/i.test(r)&&(B="200"),h=e.tinySDF=new Gl.TinySDF({fontFamily:l,fontWeight:B,fontSize:24*vn,buffer:3*vn,radius:8*vn}),h.fontWeight=B}if(this.localGlyphs[h.fontWeight][a])return this.localGlyphs[h.fontWeight][a];const p=String.fromCharCode(a),{data:y,width:v,height:b,glyphWidth:T,glyphHeight:k,glyphLeft:M,glyphTop:L,glyphAdvance:R}=h.draw(p);return this.localGlyphs[h.fontWeight][a]={id:a,bitmap:new la({width:v,height:b},y),metrics:{width:T/vn,height:k/vn,left:M/vn,top:L/vn-27,advance:R/vn,localGlyph:!0}}}}Gl.loadGlyphRange=function(s,e,r,a,l){const h=256*e,p=h+255,y=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",s).replace("{range}",`${h}-${p}`),Dr.Glyphs);tn(y,(v,b)=>{if(v)l(v);else if(b){const T={},k=function(M){return new xh(M).readFields(jw,{})}(b);for(const M of k.glyphs)T[M.id]=M;l(null,{glyphs:T,ascender:k.ascender,descender:k.descender})}})},Gl.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const y=this.size=s+4*e,v=this._createCanvas(y),b=this.ctx=v.getContext("2d",{willReadFrequently:!0});b.font=`${p} ${h} ${s}px ${l}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(s),p=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),v=Math.min(this.size-this.buffer,p+Math.ceil(a)),b=y+2*this.buffer,T=v+2*this.buffer,k=Math.max(b*T,0),M=new Uint8ClampedArray(k),L={data:M,width:b,height:T,glyphWidth:y,glyphHeight:v,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||v===0)return L;const{ctx:R,buffer:B,gridInner:H,gridOuter:re}=this;R.clearRect(B,B,y,v),R.fillText(s,B,B+p);const pe=R.getImageData(B,B,y,v);re.fill(Ad,0,k),H.fill(0,0,k);for(let ie=0;ie<v;ie++)for(let ue=0;ue<y;ue++){const xe=pe.data[4*(ie*y+ue)+3]/255;if(xe===0)continue;const ge=(ie+B)*b+ue+B;if(xe===1)re[ge]=0,H[ge]=Ad;else{const Ue=.5-xe;re[ge]=Ue>0?Ue*Ue:0,H[ge]=Ue<0?Ue*Ue:0}}Vx(re,0,0,b,T,b,this.f,this.v,this.z),Vx(H,B,B,y,v,b,this.f,this.v,this.z);for(let ie=0;ie<k;ie++){const ue=Math.sqrt(re[ie])-Math.sqrt(H[ie]);M[ie]=Math.round(255-255*(ue/this.radius+this.cutoff))}return L}};const Zl=mi;function $x(s,e,r,a){const l=[],h=s.image,p=h.pixelRatio,y=h.paddedRect.w-2*Zl,v=h.paddedRect.h-2*Zl,b=s.right-s.left,T=s.bottom-s.top,k=h.stretchX||[[0,y]],M=h.stretchY||[[0,v]],L=(qe,Je)=>qe+Je[1]-Je[0],R=k.reduce(L,0),B=M.reduce(L,0),H=y-R,re=v-B;let pe=0,ie=R,ue=0,xe=B,ge=0,Ue=H,Oe=0,He=re;if(h.content&&a){const qe=h.content;pe=_h(k,0,qe[0]),ue=_h(M,0,qe[1]),ie=_h(k,qe[0],qe[2]),xe=_h(M,qe[1],qe[3]),ge=qe[0]-pe,Oe=qe[1]-ue,Ue=qe[2]-qe[0]-ie,He=qe[3]-qe[1]-xe}const ot=(qe,Je,Ye,rt)=>{const mt=vh(qe.stretch-pe,ie,b,s.left),Ze=bh(qe.fixed-ge,Ue,qe.stretch,R),vt=vh(Je.stretch-ue,xe,T,s.top),At=bh(Je.fixed-Oe,He,Je.stretch,B),bt=vh(Ye.stretch-pe,ie,b,s.left),$t=bh(Ye.fixed-ge,Ue,Ye.stretch,R),pt=vh(rt.stretch-ue,xe,T,s.top),Rt=bh(rt.fixed-Oe,He,rt.stretch,B),Gt=new Ee(mt,vt),ps=new Ee(bt,vt),Zt=new Ee(bt,pt),Ft=new Ee(mt,pt),Rs=new Ee(Ze/p,At/p),Xt=new Ee($t/p,Rt/p),Kt=e*Math.PI/180;if(Kt){const Is=Math.sin(Kt),Cs=Math.cos(Kt),qs=[Cs,-Is,Is,Cs];Gt._matMult(qs),ps._matMult(qs),Ft._matMult(qs),Zt._matMult(qs)}const Es=qe.stretch+qe.fixed,Ps=Je.stretch+Je.fixed;return{tl:Gt,tr:ps,bl:Ft,br:Zt,tex:{x:h.paddedRect.x+Zl+Es,y:h.paddedRect.y+Zl+Ps,w:Ye.stretch+Ye.fixed-Es,h:rt.stretch+rt.fixed-Ps},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rs,pixelOffsetBR:Xt,minFontScaleX:Ue/p/b,minFontScaleY:He/p/T,isSDF:r}};if(a&&(h.stretchX||h.stretchY)){const qe=Gx(k,H,R),Je=Gx(M,re,B);for(let Ye=0;Ye<qe.length-1;Ye++){const rt=qe[Ye],mt=qe[Ye+1];for(let Ze=0;Ze<Je.length-1;Ze++)l.push(ot(rt,Je[Ze],mt,Je[Ze+1]))}}else l.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:v+1}));return l}function _h(s,e,r){let a=0;for(const l of s)a+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return a}function Gx(s,e,r){const a=[{fixed:-Zl,stretch:0}];for(const[l,h]of s){const p=a[a.length-1];a.push({fixed:l-p.stretch,stretch:p.stretch}),a.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return a.push({fixed:e+Zl,stretch:r}),a}function vh(s,e,r,a){return s/e*r+a}function bh(s,e,r,a){return s-e*r/a}function Mw(s,e,r,a){const l=e+s.positionedLines[a].lineOffset;return a===0?r+l/2:r+(l+(e+s.positionedLines[a-1].lineOffset))/2}class Pw{constructor(e=[],r=Iw){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,l=r[e];for(;e>0;){const h=e-1>>1,p=r[h];if(a(l,p)>=0)break;r[e]=p,e=h}r[e]=l}_down(e){const{data:r,compare:a}=this,l=this.length>>1,h=r[e];for(;e<l;){let p=1+(e<<1),y=r[p];const v=p+1;if(v<this.length&&a(r[v],y)<0&&(p=v,y=r[v]),a(y,h)>=0)break;r[e]=y,e=p}r[e]=h}}function Iw(s,e){return s<e?-1:s>e?1:0}function Dw(s,e=1,r=!1){let a=1/0,l=1/0,h=-1/0,p=-1/0;const y=s[0];for(let L=0;L<y.length;L++){const R=y[L];(!L||R.x<a)&&(a=R.x),(!L||R.y<l)&&(l=R.y),(!L||R.x>h)&&(h=R.x),(!L||R.y>p)&&(p=R.y)}const v=Math.min(h-a,p-l);let b=v/2;const T=new Pw([],Lw);if(v===0)return new Ee(a,l);for(let L=a;L<h;L+=v)for(let R=l;R<p;R+=v)T.push(new Wl(L+b,R+b,b,s));let k=function(L){let R=0,B=0,H=0;const re=L[0];for(let pe=0,ie=re.length,ue=ie-1;pe<ie;ue=pe++){const xe=re[pe],ge=re[ue],Ue=xe.x*ge.y-ge.x*xe.y;B+=(xe.x+ge.x)*Ue,H+=(xe.y+ge.y)*Ue,R+=3*Ue}return new Wl(B/R,H/R,0,L)}(s),M=T.length;for(;T.length;){const L=T.pop();(L.d>k.d||!k.d)&&(k=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-k.d<=e||(b=L.h/2,T.push(new Wl(L.p.x-b,L.p.y-b,b,s)),T.push(new Wl(L.p.x+b,L.p.y-b,b,s)),T.push(new Wl(L.p.x-b,L.p.y+b,b,s)),T.push(new Wl(L.p.x+b,L.p.y+b,b,s)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${k.d}`)),k.p}function Lw(s,e){return e.max-s.max}class Wl{constructor(e,r,a,l){this.p=new Ee(e,r),this.h=a,this.d=function(h,p){let y=!1,v=1/0;for(let b=0;b<p.length;b++){const T=p[b];for(let k=0,M=T.length,L=M-1;k<M;L=k++){const R=T[k],B=T[L];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(y=!y),v=Math.min(v,Bg(h,R,B))}}return(y?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Hl=7,kp=Number.POSITIVE_INFINITY,Rw=Math.sqrt(2);function Zx(s,[e,r]){let a=0,l=0;if(r===kp){e<0&&(e=0);const h=e/Rw;switch(s){case"top-right":case"top-left":l=h-Hl;break;case"bottom-right":case"bottom-left":l=-h+Hl;break;case"bottom":l=-e+Hl;break;case"top":l=e-Hl}switch(s){case"top-right":case"bottom-right":a=-h;break;case"top-left":case"bottom-left":a=h;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),s){case"top-right":case"top-left":case"top":l=r-Hl;break;case"bottom-right":case"bottom-left":case"bottom":l=-r+Hl}switch(s){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,l]}function zw(s,e,r,a,l,h,p,y,v,b){s.createArrays(),s.tilePixelRatio=zt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const T=s.layers[0].layout,k=s.layers[0]._unevaluatedLayout._values,M={};if(s.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:H}=s.textSizeData;M.compositeTextSizes=[k["text-size"].possiblyEvaluate(new C(B),y),k["text-size"].possiblyEvaluate(new C(H),y)]}if(s.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:H}=s.iconSizeData;M.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new C(B),y),k["icon-size"].possiblyEvaluate(new C(H),y)]}M.layoutTextSize=k["text-size"].possiblyEvaluate(new C(v+1),y),M.layoutIconSize=k["icon-size"].possiblyEvaluate(new C(v+1),y),M.textMaxSize=k["text-size"].possiblyEvaluate(new C(18),y);const L=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",R=T.get("text-size");for(const B of s.features){const H=T.get("text-font").evaluate(B,{},y).join(","),re=R.evaluate(B,{},y),pe=M.layoutTextSize.evaluate(B,{},y),ie=(M.layoutIconSize.evaluate(B,{},y),{horizontal:{},vertical:void 0}),ue=B.text;let xe,ge=[0,0];if(ue){const He=ue.toString(),ot=T.get("text-letter-spacing").evaluate(B,{},y)*Rr,qe=T.get("text-line-height").evaluate(B,{},y)*Rr,Je=Om(He)?ot:0,Ye=T.get("text-anchor").evaluate(B,{},y),rt=T.get("text-variable-anchor");if(!rt){const bt=T.get("text-radial-offset").evaluate(B,{},y);ge=bt?Zx(Ye,[bt*Rr,kp]):T.get("text-offset").evaluate(B,{},y).map($t=>$t*Rr)}let mt=L?"center":T.get("text-justify").evaluate(B,{},y);const Ze=T.get("symbol-placement")==="point",vt=Ze?T.get("text-max-width").evaluate(B,{},y)*Rr:1/0,At=bt=>{s.allowVerticalPlacement&&td(He)&&(ie.vertical=Tp(ue,e,r,l,H,vt,qe,Ye,bt,Je,ge,zi.vertical,!0,pe,re))};if(!L&&rt){const bt=mt==="auto"?rt.map(pt=>Ap(pt)):[mt];let $t=!1;for(let pt=0;pt<bt.length;pt++){const Rt=bt[pt];if(!ie.horizontal[Rt])if($t)ie.horizontal[Rt]=ie.horizontal[0];else{const Gt=Tp(ue,e,r,l,H,vt,qe,"center",Rt,Je,ge,zi.horizontal,!1,pe,re);Gt&&(ie.horizontal[Rt]=Gt,$t=Gt.positionedLines.length===1)}}At("left")}else{if(mt==="auto"&&(mt=Ap(Ye)),Ze||T.get("text-writing-mode").indexOf("horizontal")>=0||!td(He)){const bt=Tp(ue,e,r,l,H,vt,qe,Ye,mt,Je,ge,zi.horizontal,!1,pe,re);bt&&(ie.horizontal[mt]=bt)}At(Ze?"left":mt)}}let Ue=!1;if(B.icon&&B.icon.name){const He=a[B.icon.name];He&&(xe=Cw(l[B.icon.name],T.get("icon-offset").evaluate(B,{},y),T.get("icon-anchor").evaluate(B,{},y)),Ue=He.sdf,s.sdfIcons===void 0?s.sdfIcons=He.sdf:s.sdfIcons!==He.sdf&&As("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==s.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const Oe=Hx(ie.horizontal)||ie.vertical;s.iconsInText||(s.iconsInText=!!Oe&&Oe.iconsInText),(Oe||xe)&&Ow(s,B,ie,xe,a,M,pe,0,ge,Ue,p,y,b)}h&&s.generateCollisionDebugBuffers(v,s.collisionBoxArray)}function Ap(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ow(s,e,r,a,l,h,p,y,v,b,T,k,M){let L=h.textMaxSize.evaluate(e,{},k);L===void 0&&(L=p);const R=s.layers[0].layout,B=R.get("icon-offset").evaluate(e,{},k),H=Hx(r.horizontal)||r.vertical,re=M.name==="globe",pe=Rr,ie=p/pe,ue=s.tilePixelRatio*L/pe,xe=(Ye=s.overscaling,s.zoom>18&&Ye>2&&(Ye>>=1),Math.max(zt/(512*Ye),1)*R.get("symbol-spacing")),ge=R.get("text-padding")*s.tilePixelRatio,Ue=R.get("icon-padding")*s.tilePixelRatio,Oe=Pe(R.get("text-max-angle")),He=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ot=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",qe=R.get("symbol-placement"),Je=xe/2;var Ye;const rt=R.get("icon-text-fit");let mt;a&&rt!=="none"&&(s.allowVerticalPlacement&&r.vertical&&(mt=Lx(a,r.vertical,rt,R.get("icon-text-fit-padding"),B,ie)),H&&(a=Lx(a,H,rt,R.get("icon-text-fit-padding"),B,ie)));const Ze=(vt,At,bt)=>{if(At.x<0||At.x>=zt||At.y<0||At.y>=zt)return;let $t=null;if(re){const{x:pt,y:Rt,z:Gt}=M.projectTilePoint(At.x,At.y,bt);$t={anchor:new da(pt,Rt,Gt,0,void 0),up:M.upVector(bt,At.x,At.y)}}(function(pt,Rt,Gt,ps,Zt,Ft,Rs,Xt,Kt,Es,Ps,Is,Cs,qs,Ws,lr,ks,yr,cr,Gs,gs,dr,Ds,ni,ur){const zr=pt.addToLineVertexArray(Rt,ps);let Cr,ai,kr,wn,Ql,Fd,Bd,Ey=0,Cy=0,ky=0,Ay=0,Gp=-1,Zp=-1;const Bn={};let My=Um("");const qo=Gt?Gt.anchor:Rt;let Wp=0,Hp=0;if(Kt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Wp,Hp]=Kt.layout.get("text-offset").evaluate(gs,{},ur).map(Ti=>Ti*Rr):(Wp=Kt.layout.get("text-radial-offset").evaluate(gs,{},ur)*Rr,Hp=kp),pt.allowVerticalPlacement&&Zt.vertical){const Ti=Zt.vertical;if(Ws)Fd=Mp(Ti),Xt&&(Bd=Mp(Xt));else{const Ei=Kt.layout.get("text-rotate").evaluate(gs,{},ur)+90;kr=wh(Es,qo,Rt,Ps,Is,Cs,Ti,qs,Ei,lr),Xt&&(wn=wh(Es,qo,Rt,Ps,Is,Cs,Xt,yr,Ei))}}if(Ft){const Ti=Kt.layout.get("icon-rotate").evaluate(gs,{},ur),Ei=Kt.layout.get("icon-text-fit")!=="none",Ud=$x(Ft,Ti,Ds,Ei),Kp=Xt?$x(Xt,Ti,Ds,Ei):void 0;ai=wh(Es,qo,Rt,Ps,Is,Cs,Ft,yr,Ti),Ey=4*Ud.length;const Py=pt.iconSizeData;let $o=null;Py.kind==="source"?($o=[_n*Kt.layout.get("icon-size").evaluate(gs,{},ur)],$o[0]>Fa&&As(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Md}. Reduce your "icon-size".`)):Py.kind==="composite"&&($o=[_n*dr.compositeIconSizes[0].evaluate(gs,{},ur),_n*dr.compositeIconSizes[1].evaluate(gs,{},ur)],($o[0]>Fa||$o[1]>Fa)&&As(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Md}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,Ud,$o,Gs,cr,gs,!1,Gt,Rt,zr.lineStartIndex,zr.lineLength,-1,ni,ur),Gp=pt.icon.placedSymbolArray.length-1,Kp&&(Cy=4*Kp.length,pt.addSymbols(pt.icon,Kp,$o,Gs,cr,gs,zi.vertical,Gt,Rt,zr.lineStartIndex,zr.lineLength,-1,ni,ur),Zp=pt.icon.placedSymbolArray.length-1)}for(const Ti in Zt.horizontal){const Ei=Zt.horizontal[Ti];Cr||(My=Um(Ei.text),Ws?Ql=Mp(Ei):Cr=wh(Es,qo,Rt,Ps,Is,Cs,Ei,qs,Kt.layout.get("text-rotate").evaluate(gs,{},ur),lr));const Ud=Ei.positionedLines.length===1;if(ky+=Wx(pt,Gt,Rt,Ei,Rs,Kt,Ws,gs,lr,zr,Zt.vertical?zi.horizontal:zi.horizontalOnly,Ud?Object.keys(Zt.horizontal):[Ti],Bn,Gp,dr,ni,ur),Ud)break}Zt.vertical&&(Ay+=Wx(pt,Gt,Rt,Zt.vertical,Rs,Kt,Ws,gs,lr,zr,zi.vertical,["vertical"],Bn,Zp,dr,ni,ur));let Ga=-1;const Xp=(Ti,Ei)=>Ti?Math.max(Ti,Ei):Ei;Ga=Xp(Ql,Ga),Ga=Xp(Fd,Ga),Ga=Xp(Bd,Ga);const h1=Ga>-1?1:0;pt.glyphOffsetArray.length>=Ua.MAX_GLYPHS&&As("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gs.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,gs.sortKey),pt.symbolInstances.emplaceBack(qo.x,qo.y,qo.z,Rt.x,Rt.y,Bn.right>=0?Bn.right:-1,Bn.center>=0?Bn.center:-1,Bn.left>=0?Bn.left:-1,Bn.vertical>=0?Bn.vertical:-1,Gp,Zp,My,Cr!==void 0?Cr:pt.collisionBoxArray.length,Cr!==void 0?Cr+1:pt.collisionBoxArray.length,kr!==void 0?kr:pt.collisionBoxArray.length,kr!==void 0?kr+1:pt.collisionBoxArray.length,ai!==void 0?ai:pt.collisionBoxArray.length,ai!==void 0?ai+1:pt.collisionBoxArray.length,wn||pt.collisionBoxArray.length,wn?wn+1:pt.collisionBoxArray.length,Ps,ky,Ay,Ey,Cy,h1,0,Wp,Hp,Ga)})(s,At,$t,vt,r,a,l,mt,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,ge,He,v,0,Ue,ot,B,e,h,b,T,k)};if(qe==="line")for(const vt of Ux(e.geometry,0,0,zt,zt)){const At=Aw(vt,xe,Oe,r.vertical||H,a,pe,ue,s.overscaling,zt);for(const bt of At)H&&Fw(s,H.text,Je,bt)||Ze(vt,bt,k)}else if(qe==="line-center"){for(const vt of e.geometry)if(vt.length>1){const At=kw(vt,Oe,r.vertical||H,a,pe,ue);At&&Ze(vt,At,k)}}else if(e.type==="Polygon")for(const vt of xp(e.geometry,0)){const At=Dw(vt,16);Ze(vt[0],new da(At.x,At.y,0,0,void 0),k)}else if(e.type==="LineString")for(const vt of e.geometry)Ze(vt,new da(vt[0].x,vt[0].y,0,0,void 0),k);else if(e.type==="Point")for(const vt of e.geometry)for(const At of vt)Ze([At],new da(At.x,At.y,0,0,void 0),k)}const Md=255,Fa=Md*_n;function Wx(s,e,r,a,l,h,p,y,v,b,T,k,M,L,R,B,H){const re=function(ue,xe,ge,Ue,Oe,He,ot,qe){const Je=[];if(xe.positionedLines.length===0)return Je;const Ye=Ue.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,rt=function(bt){const $t=bt[0],pt=bt[1],Rt=$t*pt;return Rt>0?[$t,-pt]:Rt<0?[-$t,pt]:$t===0?[pt,$t]:[pt,-$t]}(ge);let mt=Math.abs(xe.top-xe.bottom);for(const bt of xe.positionedLines)mt-=bt.lineOffset;const Ze=xe.positionedLines.length,vt=mt/Ze;let At=xe.top-ge[1];for(let bt=0;bt<Ze;++bt){const $t=xe.positionedLines[bt];At=Mw(xe,vt,At,bt);for(const pt of $t.positionedGlyphs){if(!pt.rect)continue;const Rt=pt.rect||{};let Gt=Ex+1,ps=!0,Zt=1,Ft=0;if(pt.imageName){const Ds=ot[pt.imageName];if(!Ds)continue;if(Ds.sdf){As("SDF images are not supported in formatted text and will be ignored.");continue}ps=!1,Zt=Ds.pixelRatio,Gt=mi/Zt}const Rs=(Oe||qe)&&pt.vertical,Xt=pt.metrics.advance*pt.scale/2,Kt=pt.metrics,Es=pt.rect;if(Es===null)continue;qe&&xe.verticalizable&&(Ft=pt.imageName?Xt-pt.metrics.width*pt.scale/2:0);const Ps=Oe?[pt.x+Xt,pt.y]:[0,0];let Is=[0,0],Cs=[0,0],qs=!1;Oe||(Rs?(Cs=[pt.x+Xt+rt[0],pt.y+rt[1]-Ft],qs=!0):Is=[pt.x+Xt+ge[0],pt.y+ge[1]-Ft]);const Ws=Es.w*pt.scale/(Zt*(pt.localGlyph?vn:1)),lr=Es.h*pt.scale/(Zt*(pt.localGlyph?vn:1));let ks,yr,cr,Gs;if(Rs){const Ds=pt.y-At,ni=new Ee(-Xt,Xt-Ds),ur=-Math.PI/2,zr=new Ee(...Cs);ks=new Ee(-Xt+Is[0],Is[1]),ks._rotateAround(ur,ni)._add(zr),ks.x+=-Ds+Xt,ks.y-=(Kt.left-Gt)*pt.scale;const Cr=pt.imageName?Kt.advance*pt.scale:Rr*pt.scale,ai=String.fromCharCode(pt.glyph);hw(ai)?ks.x+=(1-Gt)*pt.scale:mw(ai)?ks.x+=Cr-Kt.height*pt.scale+(-Gt-1)*pt.scale:ks.x+=pt.imageName||Kt.width+2*Gt===Es.w&&Kt.height+2*Gt===Es.h?(Cr-lr)/2:(Cr-(Kt.height+2*Gt)*pt.scale)/2,yr=new Ee(ks.x,ks.y-Ws),cr=new Ee(ks.x+lr,ks.y),Gs=new Ee(ks.x+lr,ks.y-Ws)}else{const Ds=(Kt.left-Gt)*pt.scale-Xt+Is[0],ni=(-Kt.top-Gt)*pt.scale+Is[1],ur=Ds+Ws,zr=ni+lr;ks=new Ee(Ds,ni),yr=new Ee(ur,ni),cr=new Ee(Ds,zr),Gs=new Ee(ur,zr)}if(Ye){let Ds;Ds=Oe?new Ee(0,0):qs?new Ee(rt[0],rt[1]):new Ee(ge[0],ge[1]),ks._rotateAround(Ye,Ds),yr._rotateAround(Ye,Ds),cr._rotateAround(Ye,Ds),Gs._rotateAround(Ye,Ds)}const gs=new Ee(0,0),dr=new Ee(0,0);Je.push({tl:ks,tr:yr,bl:cr,br:Gs,tex:Rt,writingMode:xe.writingMode,glyphOffset:Ps,sectionIndex:pt.sectionIndex,isSDF:ps,pixelOffsetTL:gs,pixelOffsetBR:dr,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,a,v,h,p,y,l,s.allowVerticalPlacement),pe=s.textSizeData;let ie=null;pe.kind==="source"?(ie=[_n*h.layout.get("text-size").evaluate(y,{},H)],ie[0]>Fa&&As(`${s.layerIds[0]}: Value for "text-size" is >= ${Md}. Reduce your "text-size".`)):pe.kind==="composite"&&(ie=[_n*R.compositeTextSizes[0].evaluate(y,{},H),_n*R.compositeTextSizes[1].evaluate(y,{},H)],(ie[0]>Fa||ie[1]>Fa)&&As(`${s.layerIds[0]}: Value for "text-size" is >= ${Md}. Reduce your "text-size".`)),s.addSymbols(s.text,re,ie,v,p,y,T,e,r,b.lineStartIndex,b.lineLength,L,B,H);for(const ue of k)M[ue]=s.text.placedSymbolArray.length-1;return 4*re.length}function Hx(s){for(const e in s)return s[e];return null}function wh(s,e,r,a,l,h,p,y,v,b){let T=p.top,k=p.bottom,M=p.left,L=p.right;const R=p.collisionPadding;if(R&&(M-=R[0],T-=R[1],L+=R[2],k+=R[3]),v){const B=new Ee(M,T),H=new Ee(L,T),re=new Ee(M,k),pe=new Ee(L,k),ie=Pe(v);let ue=new Ee(0,0);b&&(ue=new Ee(b[0],b[1])),B._rotateAround(ie,ue),H._rotateAround(ie,ue),re._rotateAround(ie,ue),pe._rotateAround(ie,ue),M=Math.min(B.x,H.x,re.x,pe.x),L=Math.max(B.x,H.x,re.x,pe.x),T=Math.min(B.y,H.y,re.y,pe.y),k=Math.max(B.y,H.y,re.y,pe.y)}return s.emplaceBack(e.x,e.y,e.z,r.x,r.y,M,T,L,k,y,a,l,h),s.length-1}function Mp(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function Fw(s,e,r,a){const l=s.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(a.dist(h[p])<r)return!0}else l[e]=[];return l[e].push(a),!1}function Xx(s,e){const r=s.fovAboveCenter,a=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,l=(s._camera.position[2]*s.worldSize-a)/Math.cos(s._pitch),h=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-s._pitch-r,.01)),p=Math.sin(s._pitch)*h+l;return Math.min(1.01*p,l*(1/s._horizonShift))}function Uo(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const r=Math.pow(2,-s.z),a=s.x*r,l=(s.x+1)*r,h=s.y*r,p=(s.y+1)*r,y=Ri(a),v=Ri(l),b=$r(h),T=$r(p),k=e.project(y,b),M=e.project(v,b),L=e.project(v,T),R=e.project(y,T);let B=Math.min(k.x,M.x,L.x,R.x),H=Math.min(k.y,M.y,L.y,R.y),re=Math.max(k.x,M.x,L.x,R.x),pe=Math.max(k.y,M.y,L.y,R.y);const ie=r/16;function ue(ge,Ue,Oe,He,ot,qe){const Je=(Oe+ot)/2,Ye=(He+qe)/2,rt=e.project(Ri(Je),$r(Ye)),mt=Math.max(0,B-rt.x,H-rt.y,rt.x-re,rt.y-pe);B=Math.min(B,rt.x),re=Math.max(re,rt.x),H=Math.min(H,rt.y),pe=Math.max(pe,rt.y),mt>ie&&(ue(ge,rt,Oe,He,Je,Ye),ue(rt,Ue,Je,Ye,ot,qe))}ue(k,M,a,h,l,h),ue(M,L,l,h,l,p),ue(L,R,l,p,a,p),ue(R,k,a,p,a,h),B-=ie,H-=ie,re+=ie,pe+=ie;const xe=1/Math.max(re-B,pe-H);return{scale:xe,x:B*xe,y:H*xe,x2:re*xe,y2:pe*xe,projection:e}}const Bw=gn(new Float32Array(16));class Ba{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Ts(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return yn(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return Xx(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,l){const h=e.horizonLineFromTop(!1),p=new Ee(r,Math.max(h,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}pointCoordinate3D(e,r,a){const l=new Ee(r,a);if(e.elevation)return e.elevation.pointCoordinate(l);{const h=this.pointCoordinate(e,l.x,l.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return Bw}createTileMatrix(e,r,a){let l,h,p;const y=a.canonical,v=gn(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=Uo(y,this);l=1,h=b.x+a.wrap*b.scale,p=b.y,Do(v,v,[l/b.scale,l/b.scale,e.pixelsPerMeter/r])}else l=r/e.zoomScale(y.z),h=(y.x+Math.pow(2,y.z)*a.wrap)*l,p=y.y*l;return ld(v,v,[h,p,0]),Do(v,v,[l/zt,l/zt,1]),v}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class Uw extends Ba{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Pe(r));this.n=(l+Math.sin(Pe(a)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:l,r0:h}=this,p=Pe(e-this.center[0]),y=Pe(r),v=Math.sqrt(l-2*a*Math.sin(y))/a;return{x:v*Math.sin(p*a),y:v*Math.cos(p*a)-h,z:0}}unproject(e,r){const{n:a,c:l,r0:h}=this,p=h+r;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const v=Pe(this.center[0])*a;y=ns(y,-Math.PI-v,Math.PI-v);const b=ht(it(y/a)+this.center[0],-180,180),T=Math.asin(ht((l-(e*e+p*p)*a*a)/(2*a),-1,1)),k=ht(it(T),-Gr,Gr);return new Ts(b,k)}}const Pd=1.340264,Id=-.081106,Dd=893e-6,Ld=.003796,jh=Math.sqrt(3)/2;class Vw extends Ba{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(jh*Math.sin(r)),l=a*a,h=l*l*l;return{x:.5*(e*Math.cos(a)/(jh*(Pd+3*Id*l+h*(7*Dd+9*Ld*l)))/Math.PI+.5),y:1-.5*(a*(Pd+Id*l+h*(Dd+Ld*l))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=a*a,h=l*l*l;for(let T,k,M,L=0;L<12&&(k=a*(Pd+Id*l+h*(Dd+Ld*l))-r,M=Pd+3*Id*l+h*(7*Dd+9*Ld*l),T=k/M,a=ht(a-T,-Math.PI/3,Math.PI/3),l=a*a,h=l*l*l,!(Math.abs(T)<1e-12));++L);const p=jh*e*(Pd+3*Id*l+h*(7*Dd+9*Ld*l))/Math.cos(a),y=Math.asin(Math.sin(a)/jh),v=ht(180*p/Math.PI,-180,180),b=ht(180*y/Math.PI,-Gr,Gr);return new Ts(v,b)}}class qw extends Ba{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),l=ht(360*(.5-r),-Gr,Gr);return new Ts(a,l)}}const Xl=Math.PI/2;function Nh(s){return Math.tan((Xl+s)/2)}class $w extends Ba{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let l=Pe(r),h=Pe(a);this.southernCenter=l+h<0,this.southernCenter&&(l=-l,h=-h);const p=Math.cos(l),y=Nh(l);this.n=l===h?Math.sin(l):Math.log(p/Math.cos(h))/Math.log(Nh(h)/y),this.f=p*Math.pow(Nh(l),this.n)/this.n}project(e,r){r=Pe(r),this.southernCenter&&(r=-r),e=Pe(e-this.center[0]);const a=1e-6,{n:l,f:h}=this;h>0?r<-Xl+a&&(r=-Xl+a):r>Xl-a&&(r=Xl-a);const p=h/Math.pow(Nh(r),l);let y=p*Math.sin(l*e),v=h-p*Math.cos(l*e);return y=.5*(y/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:y,y:this.southernCenter?v:1-v,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:l}=this,h=l-r,p=Math.sign(h),y=Math.sign(a)*Math.sqrt(e*e+h*h);let v=Math.atan2(e,Math.abs(h))*p;h*a<0&&(v-=Math.PI*Math.sign(e)*p);const b=ht(it(v/a)+this.center[0],-180,180),T=ht(it(2*Math.atan(Math.pow(l/y,1/a))-Xl),-Gr,Gr);return new Ts(b,this.southernCenter?-T:T)}}class Kx extends Ba{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Ln(e),y:Rn(r),z:0}}unproject(e,r){const a=Ri(e),l=$r(r);return new Ts(a,l)}}const Qx=Pe(Gr);class Gw extends Ba{project(e,r){const a=(r=Pe(r))*r,l=a*a;return{x:.5*((e=Pe(e))*(.8707-.131979*a+l*(l*(.003971*a-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+l*(.028874*a-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=25,h=0,p=a*a;do{p=a*a;const b=p*p;h=(a*(1.007226+p*(.015085+b*(.028874*p-.044475-.005916*b)))-r)/(1.007226+p*(.045255+b*(.259866*p-.311325-.005916*11*b))),a=ht(a-h,-Qx,Qx)}while(Math.abs(h)>1e-6&&--l>0);p=a*a;const y=ht(it(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=it(a);return new Ts(y,v)}}const Jx=Pe(Gr);class Zw extends Ba{project(e,r){r=Pe(r),e=Pe(e);const a=Math.cos(r),l=2/Math.PI,h=Math.acos(a*Math.cos(e/2)),p=Math.sin(h)/h,y=.5*(e*l+2*a*Math.sin(e/2)/p)||0,v=.5*(r+Math.sin(r)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,h=25;const p=1e-6;let y=0,v=0;do{const b=Math.cos(l),T=Math.sin(l),k=2*T*b,M=T*T,L=b*b,R=Math.cos(a/2),B=Math.sin(a/2),H=2*R*B,re=B*B,pe=1-L*R*R,ie=pe?1/pe:0,ue=pe?Math.acos(b*R)*Math.sqrt(1/pe):0,xe=.5*(2*ue*b*B+2*a/Math.PI)-e,ge=.5*(ue*T+l)-r,Ue=.5*ie*(L*re+ue*b*R*M)+1/Math.PI,Oe=ie*(H*k/4-ue*T*B),He=.125*ie*(k*B-ue*T*L*H),ot=.5*ie*(M*R+ue*re*b)+.5,qe=Oe*He-ot*Ue;y=(ge*Oe-xe*ot)/qe,v=(xe*He-ge*Ue)/qe,a=ht(a-y,-Math.PI,Math.PI),l=ht(l-v,-Jx,Jx)}while((Math.abs(y)>p||Math.abs(v)>p)&&--h>0);return new Ts(it(a),it(l))}}class Yx extends Ba{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Pe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:l}=this;return{x:Pe(e)*l*a+.5,y:-Math.sin(Pe(r))/l*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:l}=this,h=-(r-.5)/a,p=ht(it((e-.5)/a)/l,-180,180),y=Math.asin(ht(h*l,-1,1)),v=ht(it(y),-Gr,Gr);return new Ts(p,v)}}class Ww extends Kx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const l=gd(e,r,a);return Ys(l,l,xd(Dn(a))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,r){const a=Dl(r.lat,r.lng),l=si([],a),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;hd(a,a,l,yn(1,0)*zt*h);const p=gn(new Float64Array(16));return Io(p,e.pixelMatrix,e.globeMatrix),Ys(a,a,p),new Ee(a[0],a[1])}pixelsPerMeter(e,r){return yn(1,0)*r}pixelSpaceConversion(e,r,a){const l=yn(1,e)*r,h=us(yn(1,45)*r,l,a);return this.pixelsPerMeter(e,r)/h}createTileMatrix(e,r,a){const l=tp(Dn(a.canonical));return Io(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,r){const{center:a}=e,l=xd(Dn(r));return Ju(l,l,Pe(a.lng)),Gm(l,l,Pe(a.lat)),Do(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,r,a,l){return Tg(e,r,a,!0)||new Rl(0,0)}pointCoordinate3D(e,r,a){const l=this.pointCoordinate(e,r,a,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,r){return!Tg(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(l,h){const p=l.cameraToCenterDistance,y=l._centerAltitude*h,v=l._camera,b=l._camera.forward(),T=aa([],Li([],b,-p),[0,0,y]),k=l.worldSize/(2*Math.PI),M=[0,0,-k],L=l.width/l.height,R=Math.tan(l.fovAboveCenter),B=Li([],v.up(),R),H=Li([],v.right(),R*L),re=si([],aa([],aa([],b,B),H)),pe=[];let ie;if(new Xm(T,re).closestPointOnSphere(M,k,pe)){const ue=aa([],pe,M),xe=xn([],ue,T);ie=Math.cos(l.fovAboveCenter)*cd(xe)}else{const ue=xn([],T,M),xe=xn([],M,T);si(xe,xe);const ge=cd(ue)-k;ie=Math.sqrt(ge*(ge+2*k));const Ue=Math.acos(ie/(k+ge))-Math.acos(Zi(b,xe));ie*=Math.cos(Ue)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Ll(e.zoom);if(a>0){const l=Xx(e,yn(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return us(r,l+h*(1-Math.cos(p)),Math.pow(a,10))}return r}upVector(e,r,a){return gd(r,a,e,1)}upVectorScale(e){return{metersToTile:Yu(th(Dn(e)))}}}function ey(s){const e=s.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new Kx(s);case"equirectangular":return new qw(s);case"naturalEarth":return new Gw(s);case"equalEarth":return new Vw(s);case"winkelTripel":return new Zw(s);case"albers":return r?new Yx(s):new Uw(s);case"lambertConformalConic":return r?new Yx(s):new $w(s);case"globe":return new Ww(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Hw=uh.types,Xw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sh(s,e,r,a,l,h,p,y,v,b,T,k,M){const L=y?Math.min(Fa,Math.round(y[0])):0,R=y?Math.min(Fa,Math.round(y[1])):0;s.emplaceBack(e,r,Math.round(32*a),Math.round(32*l),h,p,(L<<1)+(v?1:0),R,16*b,16*T,256*k,256*M)}function Th(s,e,r,a,l,h,p){s.emplaceBack(e,r,a,l,h,p)}function Eh(s,e,r,a,l){s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l)}function Kw(s){for(const e of s.sections)if(Bm(e.text))return!0;return!1}class Pp{constructor(e){this.layoutVertexArray=new st,this.indexArray=new Pt,this.programConfigurations=e,this.segments=new ar,this.dynamicLayoutVertexArray=new nt,this.opacityVertexArray=new Dt,this.placedSymbolArray=new nr,this.globeExtVertexArray=new dt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,aw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Xw,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,nw.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Et(Pp,"SymbolBuffers");class Ip{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new ar,this.collisionVertexArray=new is,this.collisionVertexArrayExt=new ts}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ow.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,lw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Et(Ip,"CollisionBuffers");class Ua{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gn([]),this.placementViewportMatrix=gn([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bp(this.zoom,r["text-size"]),this.iconSizeData=bp(this.zoom,r["icon-size"]);const a=this.layers[0].layout,l=a.get("symbol-sort-key"),h=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>zi[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Pp(new Po(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Pp(new Po(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ti,this.lineVertexArray=new kl,this.symbolInstances=new zs}calculateGlyphDependencies(e,r,a,l,h){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,l&&h){const y=Cd[e.charAt(p)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,a,l){const h=this.layers[0],p=h.layout,y=this.projection.name==="globe",v=p.get("text-font"),b=p.get("text-field"),T=p.get("icon-image"),k=(b.value.kind!=="constant"||b.value.value instanceof ei&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),M=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!k&&!M)return;const R=r.iconDependencies,B=r.glyphDependencies,H=r.availableImages,re=new C(this.zoom);for(const{feature:pe,id:ie,index:ue,sourceLayerIndex:xe}of e){const ge=h._featureFilter.needGeometry,Ue=Oo(pe,ge);if(!h._featureFilter.filter(re,Ue,a))continue;if(ge||(Ue.geometry=oa(pe,a,l)),y&&pe.type!==1&&a.z<=5){const qe=Ue.geometry,Je=.98078528056,Ye=(rt,mt)=>Zi(gd(rt.x,rt.y,a,1),gd(mt.x,mt.y,a,1))<Je;for(let rt=0;rt<qe.length;rt++)qe[rt]=ab(qe[rt],Ye)}let Oe,He;if(k){const qe=h.getValueAndResolveTokens("text-field",Ue,a,H),Je=ei.factory(qe);Kw(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||_()==="unavailable"||this.hasRTLText&&S.isParsed())&&(Oe=uw(Je,h,Ue))}if(M){const qe=h.getValueAndResolveTokens("icon-image",Ue,a,H);He=qe instanceof vi?qe:vi.fromString(qe)}if(!Oe&&!He)continue;const ot=this.sortFeaturesByKey?L.evaluate(Ue,{},a):void 0;if(this.features.push({id:ie,text:Oe,icon:He,index:ue,sourceLayerIndex:xe,geometry:Ue.geometry,properties:pe.properties,type:Hw[pe.type],sortKey:ot}),He&&(R[He.name]=!0),Oe){const qe=v.evaluate(Ue,{},a).join(","),Je=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zi.vertical)>=0;for(const Ye of Oe.sections)if(Ye.image)R[Ye.image.name]=!0;else{const rt=td(Oe.toString()),mt=Ye.fontStack||qe,Ze=B[mt]=B[mt]||{};this.calculateGlyphDependencies(Ye.text,Ze,Je,this.allowVerticalPlacement,rt)}}}p.get("symbol-placement")==="line"&&(this.features=function(pe){const ie={},ue={},xe=[];let ge=0;function Ue(qe){xe.push(pe[qe]),ge++}function Oe(qe,Je,Ye){const rt=ue[qe];return delete ue[qe],ue[Je]=rt,xe[rt].geometry[0].pop(),xe[rt].geometry[0]=xe[rt].geometry[0].concat(Ye[0]),rt}function He(qe,Je,Ye){const rt=ie[Je];return delete ie[Je],ie[qe]=rt,xe[rt].geometry[0].shift(),xe[rt].geometry[0]=Ye[0].concat(xe[rt].geometry[0]),rt}function ot(qe,Je,Ye){const rt=Ye?Je[0][Je[0].length-1]:Je[0][0];return`${qe}:${rt.x}:${rt.y}`}for(let qe=0;qe<pe.length;qe++){const Je=pe[qe],Ye=Je.geometry,rt=Je.text?Je.text.toString():null;if(!rt){Ue(qe);continue}const mt=ot(rt,Ye),Ze=ot(rt,Ye,!0);if(mt in ue&&Ze in ie&&ue[mt]!==ie[Ze]){const vt=He(mt,Ze,Ye),At=Oe(mt,Ze,xe[vt].geometry);delete ie[mt],delete ue[Ze],ue[ot(rt,xe[At].geometry,!0)]=At,xe[vt].geometry=null}else mt in ue?Oe(mt,Ze,Ye):Ze in ie?He(mt,Ze,Ye):(Ue(qe),ie[mt]=ge-1,ue[Ze]=ge-1)}return xe.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,ie)=>pe.sortKey-ie.sortKey)}update(e,r,a,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ey(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:h}of r)this.lineVertexArray.emplaceBack(l,h);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,l,h,p,y,v,b,T,k,M,L,R){const B=e.indexArray,H=e.layoutVertexArray,re=e.globeExtVertexArray,pe=e.segments.prepareSegment(4*r.length,H,B,this.canOverlap?p.sortKey:void 0),ie=this.glyphOffsetArray.length,ue=pe.vertexLength,xe=this.allowVerticalPlacement&&y===zi.vertical?Math.PI/2:0,ge=p.text&&p.text.sections;for(let Oe=0;Oe<r.length;Oe++){const{tl:He,tr:ot,bl:qe,br:Je,tex:Ye,pixelOffsetTL:rt,pixelOffsetBR:mt,minFontScaleX:Ze,minFontScaleY:vt,glyphOffset:At,isSDF:bt,sectionIndex:$t}=r[Oe],pt=pe.vertexLength,Rt=At[1];if(Sh(H,b.x,b.y,He.x,Rt+He.y,Ye.x,Ye.y,a,bt,rt.x,rt.y,Ze,vt),Sh(H,b.x,b.y,ot.x,Rt+ot.y,Ye.x+Ye.w,Ye.y,a,bt,mt.x,rt.y,Ze,vt),Sh(H,b.x,b.y,qe.x,Rt+qe.y,Ye.x,Ye.y+Ye.h,a,bt,rt.x,mt.y,Ze,vt),Sh(H,b.x,b.y,Je.x,Rt+Je.y,Ye.x+Ye.w,Ye.y+Ye.h,a,bt,mt.x,mt.y,Ze,vt),v){const{x:Gt,y:ps,z:Zt}=v.anchor,[Ft,Rs,Xt]=v.up;Th(re,Gt,ps,Zt,Ft,Rs,Xt),Th(re,Gt,ps,Zt,Ft,Rs,Xt),Th(re,Gt,ps,Zt,Ft,Rs,Xt),Th(re,Gt,ps,Zt,Ft,Rs,Xt),Eh(e.dynamicLayoutVertexArray,Gt,ps,Zt,xe)}else Eh(e.dynamicLayoutVertexArray,b.x,b.y,b.z,xe);B.emplaceBack(pt,pt+1,pt+2),B.emplaceBack(pt+1,pt+2,pt+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(At[0]),Oe!==r.length-1&&$t===r[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,p,p.index,{},L,R,ge&&ge[$t])}const Ue=v?v.anchor:b;e.placedSymbolArray.emplaceBack(Ue.x,Ue.y,Ue.z,b.x,b.y,ie,this.glyphOffsetArray.length-ie,ue,T,k,b.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],y,0,!1,0,M,0)}_commitLayoutVertex(e,r,a,l,h,p,y){e.emplaceBack(r,a,l,h,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,a,l,h,p,y){const v=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=v.vertexLength,T=y.tileAnchorX,k=y.tileAnchorY;for(let L=0;L<4;L++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,T,k,new Ee(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,T,k,new Ee(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,T,k,new Ee(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,T,k,new Ee(e.x1,e.y2)),v.vertexLength+=4;const M=a.indexArray;M.emplaceBack(b,b+1),M.emplaceBack(b+1,b+2),M.emplaceBack(b+2,b+3),M.emplaceBack(b+3,b),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const v=a.get(y),b=this.getSymbolInstanceTextSize(e,p,r,y);this._addCollisionDebugVertices(v,b,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const v=a.get(y),b=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._addCollisionDebugVertices(v,b,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ip(kt,_x.members,Er),this.iconCollisionBox=new Ip(kt,_x.members,Er);const a=Ul(this.iconSizeData,e),l=Ul(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,r,a,l){const h=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),p=fh(this.textSizeData,e,h)/Rr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,a){const l=this.icon.placedSymbolArray.get(a),h=fh(this.iconSizeData,e,l);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,r,a){e.emplaceBack(r,-a,-a),e.emplaceBack(r,a,-a),e.emplaceBack(r,a,a),e.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const v=a.get(y),b=this.getSymbolInstanceTextSize(e,p,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,v.padding)}}_updateIconDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const v=a.get(y),b=this.getSymbolInstanceIconSize(e,r,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,v.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Ul(this.iconSizeData,e),l=Ul(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,l,h,p,y,v,b){const T={};if(r<a){const{x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue,featureIndex:xe}=e.get(r);T.textBox={x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue},T.textFeatureIndex=xe}if(l<h){const{x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue,featureIndex:xe}=e.get(l);T.verticalTextBox={x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue},T.verticalTextFeatureIndex=xe}if(p<y){const{x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue,featureIndex:xe}=e.get(p);T.iconBox={x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue},T.iconFeatureIndex=xe}if(v<b){const{x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue,featureIndex:xe}=e.get(v);T.verticalIconBox={x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:H,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue},T.verticalIconFeatureIndex=xe}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let h=a.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),l=[],h=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const v=this.symbolInstances.get(y);l.push(0|Math.round(r*v.tileAnchorX+a*v.tileAnchorY)),h.push(v.featureIndex)}return p.sort((y,v)=>l[y]-l[v]||h[v]-h[y]),p}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:b}=a;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&p!==l&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Et(Ua,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ua.MAX_GLYPHS=65535,Ua.addDynamicAttributes=Eh;const Qw=new le({"symbol-placement":new F(We.layout_symbol["symbol-placement"]),"symbol-spacing":new F(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new F(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new K(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new F(We.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new F(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new F(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new F(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new F(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new K(We.layout_symbol["icon-size"]),"icon-text-fit":new F(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new F(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new K(We.layout_symbol["icon-image"]),"icon-rotate":new K(We.layout_symbol["icon-rotate"]),"icon-padding":new F(We.layout_symbol["icon-padding"]),"icon-keep-upright":new F(We.layout_symbol["icon-keep-upright"]),"icon-offset":new K(We.layout_symbol["icon-offset"]),"icon-anchor":new K(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new F(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new F(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new F(We.layout_symbol["text-rotation-alignment"]),"text-field":new K(We.layout_symbol["text-field"]),"text-font":new K(We.layout_symbol["text-font"]),"text-size":new K(We.layout_symbol["text-size"]),"text-max-width":new K(We.layout_symbol["text-max-width"]),"text-line-height":new K(We.layout_symbol["text-line-height"]),"text-letter-spacing":new K(We.layout_symbol["text-letter-spacing"]),"text-justify":new K(We.layout_symbol["text-justify"]),"text-radial-offset":new K(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new F(We.layout_symbol["text-variable-anchor"]),"text-anchor":new K(We.layout_symbol["text-anchor"]),"text-max-angle":new F(We.layout_symbol["text-max-angle"]),"text-writing-mode":new F(We.layout_symbol["text-writing-mode"]),"text-rotate":new K(We.layout_symbol["text-rotate"]),"text-padding":new F(We.layout_symbol["text-padding"]),"text-keep-upright":new F(We.layout_symbol["text-keep-upright"]),"text-transform":new K(We.layout_symbol["text-transform"]),"text-offset":new K(We.layout_symbol["text-offset"]),"text-allow-overlap":new F(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new F(We.layout_symbol["text-ignore-placement"]),"text-optional":new F(We.layout_symbol["text-optional"])});var Dp={paint:new le({"icon-opacity":new K(We.paint_symbol["icon-opacity"]),"icon-color":new K(We.paint_symbol["icon-color"]),"icon-halo-color":new K(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new K(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new K(We.paint_symbol["icon-halo-blur"]),"icon-translate":new F(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new F(We.paint_symbol["icon-translate-anchor"]),"text-opacity":new K(We.paint_symbol["text-opacity"]),"text-color":new K(We.paint_symbol["text-color"],{runtimeType:ui,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new K(We.paint_symbol["text-halo-color"]),"text-halo-width":new K(We.paint_symbol["text-halo-width"]),"text-halo-blur":new K(We.paint_symbol["text-halo-blur"]),"text-translate":new F(We.paint_symbol["text-translate"]),"text-translate-anchor":new F(We.paint_symbol["text-translate-anchor"])}),layout:Qw};class ty{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et(ty,"FormatSectionOverride",{omit:["defaultValue"]});class Ch extends fn{constructor(e){super(e,Dp)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const l=[];for(const h of a)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,l){const h=this.layout.get(e).evaluate(r,{},a,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ka(p.value)||!h?h:function(y,v){return v.replace(/{([^{}]+)}/g,(b,T)=>T in y?String(y[T]):"")}(r.properties,h)}createBucket(e){return new Ua(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Dp.paint.overridableProperties){if(!Ch.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new ty(r),l=new bl(a,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new $c("source",l):new jo("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Y(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Ch.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),l=Dp.paint.properties[r];let h=!1;const p=y=>{for(const v of y)if(l.overrides&&l.overrides.hasOverride(v))return void(h=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ei)p(a.value.value.sections);else if(a.value.kind==="source"){const y=b=>{h||(b instanceof Xn&&Zs(b.value)===no?p(b.value.sections):b instanceof An?p(b.sections):b.eachChild(y))},v=a.value;v._styleExpression&&y(v._styleExpression.expression)}return h}getProgramConfiguration(e){return new Ra(this,e)}}var Jw={paint:new le({"background-color":new F(We.paint_background["background-color"]),"background-pattern":new F(We.paint_background["background-pattern"]),"background-opacity":new F(We.paint_background["background-opacity"])})},Yw={paint:new le({"raster-opacity":new F(We.paint_raster["raster-opacity"]),"raster-hue-rotate":new F(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new F(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new F(We.paint_raster["raster-brightness-max"]),"raster-saturation":new F(We.paint_raster["raster-saturation"]),"raster-contrast":new F(We.paint_raster["raster-contrast"]),"raster-resampling":new F(We.paint_raster["raster-resampling"]),"raster-fade-duration":new F(We.paint_raster["raster-fade-duration"])})};class e1 extends fn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var t1={paint:new le({"sky-type":new F(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new F(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new F(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new F(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new F(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new ae(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new F(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new F(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new F(We.paint_sky["sky-opacity"])})};function Lp(s,e,r){const a=[0,0,1],l=vg([]);return wg(l,l,r?-Pe(s)+Math.PI:Pe(s)),bg(l,l,-Pe(e)),gg(a,a,l),si(a,a)}const s1={circle:class extends fn{constructor(s){super(s,mb)}createBucket(s){return new op(s)}queryRadius(s){const e=s;return zl("circle-radius",this,e)+zl("circle-stroke-width",this,e)+ih(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,r,a,l,h,p,y){const v=$g(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Gg(s,a,h,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,b)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Ra(this,s)}},heatmap:class extends fn{createBucket(s){return new Wg(s)}constructor(s){super(s,xb),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=up({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return zl("heatmap-radius",this,s)}queryIntersectsFeature(s,e,r,a,l,h,p,y){const v=this.paint.get("heatmap-radius").evaluate(e,r);return Gg(s,a,h,p,y,!0,!0,new Ee(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Ra(this,s)}},hillshade:class extends fn{constructor(s){super(s,yb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends fn{constructor(s){super(s,Db)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(s){return new Ra(this,s)}recalculate(s,e){super.recalculate(s,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new ch(s)}queryRadius(){return ih(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,r,a,l,h){return!s.queryGeometry.isAboveHorizon&&Fg(qg(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends fn{constructor(s){super(s,Kb)}createBucket(s){return new Sd(s)}queryRadius(){return ih(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Ra(this,s)}queryIntersectsFeature(s,e,r,a,l,h,p,y,v){const b=$g(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,r),k=this.paint.get("fill-extrusion-base").evaluate(e,r),M=[0,0],L=y&&h.elevation,R=h.elevation?h.elevation.exaggeration():1,B=s.tile.getBucket(this);if(L&&B instanceof Sd){const ue=B.centroidVertexArray,xe=v+1;xe<ue.length&&(M[0]=ue.geta_centroid_pos0(xe),M[1]=ue.geta_centroid_pos1(xe))}if(M[0]===0&&M[1]===1)return!1;h.projection.name==="globe"&&(a=ux([a],[new Ee(0,0),new Ee(zt,zt)],s.tileID.canonical).map(ue=>ue.polygon).flat());const H=L?y:null,[re,pe]=function(ue,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,rt){return ue.projection.name==="globe"?function(mt,Ze,vt,At,bt,$t,pt,Rt,Gt,ps,Zt){const Ft=[],Rs=[],Xt=mt.projection.upVectorScale(Zt,mt.center.lat,mt.worldSize).metersToTile,Kt=[0,0,0,1],Es=[0,0,0,1],Ps=(Cs,qs,Ws,lr)=>{Cs[0]=qs,Cs[1]=Ws,Cs[2]=lr,Cs[3]=1},Is=dx();vt>0&&(vt+=Is),At+=Is;for(const Cs of Ze){const qs=[],Ws=[];for(const lr of Cs){const ks=lr.x+bt.x,yr=lr.y+bt.y,cr=mt.projection.projectTilePoint(ks,yr,Zt),Gs=mt.projection.upVector(Zt,lr.x,lr.y);let gs=vt,dr=At;if(pt){const Ds=fx(ks,yr,vt,At,pt,Rt,Gt,ps);gs+=Ds.base,dr+=Ds.top}vt!==0?Ps(Kt,cr.x+Gs[0]*Xt*gs,cr.y+Gs[1]*Xt*gs,cr.z+Gs[2]*Xt*gs):Ps(Kt,cr.x,cr.y,cr.z),Ps(Es,cr.x+Gs[0]*Xt*dr,cr.y+Gs[1]*Xt*dr,cr.z+Gs[2]*Xt*dr),Ys(Kt,Kt,$t),Ys(Es,Es,$t),qs.push(new Bl(Kt[0],Kt[1],Kt[2])),Ws.push(new Bl(Es[0],Es[1],Es[2]))}Ft.push(qs),Rs.push(Ws)}return[Ft,Rs]}(ue,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,rt):ot?function(mt,Ze,vt,At,bt,$t,pt,Rt,Gt){const ps=[],Zt=[],Ft=[0,0,0,1];for(const Rs of mt){const Xt=[],Kt=[];for(const Es of Rs){const Ps=Es.x+At.x,Is=Es.y+At.y,Cs=fx(Ps,Is,Ze,vt,$t,pt,Rt,Gt);Ft[0]=Ps,Ft[1]=Is,Ft[2]=Cs.base,Ft[3]=1,Lo(Ft,Ft,bt),Ft[3]=Math.max(Ft[3],1e-5);const qs=new Bl(Ft[0]/Ft[3],Ft[1]/Ft[3],Ft[2]/Ft[3]);Ft[0]=Ps,Ft[1]=Is,Ft[2]=Cs.top,Ft[3]=1,Lo(Ft,Ft,bt),Ft[3]=Math.max(Ft[3],1e-5);const Ws=new Bl(Ft[0]/Ft[3],Ft[1]/Ft[3],Ft[2]/Ft[3]);Xt.push(qs),Kt.push(Ws)}ps.push(Xt),Zt.push(Kt)}return[ps,Zt]}(xe,ge,Ue,Oe,He,ot,qe,Je,Ye):function(mt,Ze,vt,At,bt){const $t=[],pt=[],Rt=bt[8]*Ze,Gt=bt[9]*Ze,ps=bt[10]*Ze,Zt=bt[11]*Ze,Ft=bt[8]*vt,Rs=bt[9]*vt,Xt=bt[10]*vt,Kt=bt[11]*vt;for(const Es of mt){const Ps=[],Is=[];for(const Cs of Es){const qs=Cs.x+At.x,Ws=Cs.y+At.y,lr=bt[0]*qs+bt[4]*Ws+bt[12],ks=bt[1]*qs+bt[5]*Ws+bt[13],yr=bt[2]*qs+bt[6]*Ws+bt[14],cr=bt[3]*qs+bt[7]*Ws+bt[15],Gs=lr+Rt,gs=ks+Gt,dr=yr+ps,Ds=Math.max(cr+Zt,1e-5),ni=lr+Ft,ur=ks+Rs,zr=yr+Xt,Cr=Math.max(cr+Kt,1e-5);Ps.push(new Bl(Gs/Ds,gs/Ds,dr/Ds)),Is.push(new Bl(ni/Cr,ur/Cr,zr/Cr))}$t.push(Ps),pt.push(Is)}return[$t,pt]}(xe,ge,Ue,Oe,He)}(h,a,k,T,b,p,H,M,R,h.center.lat,s.tileID.canonical),ie=s.queryGeometry;return function(ue,xe,ge){let Ue=1/0;Fg(ge,xe)&&(Ue=px(ge,xe[0]));for(let Oe=0;Oe<xe.length;Oe++){const He=xe[Oe],ot=ue[Oe];for(let qe=0;qe<He.length-1;qe++){const Je=He[qe],Ye=[Je,He[qe+1],ot[qe+1],ot[qe],Je];Og(ge,Ye)&&(Ue=Math.min(Ue,px(ge,Ye)))}}return Ue!==1/0&&Ue}(re,pe,ie.isPointQuery()?ie.screenBounds:ie.screenGeometry)}},line:class extends fn{constructor(s){super(s,gx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Mc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=xx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new ph(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Ra(this,s)}queryRadius(s){const e=s,r=yx(zl("line-width",this,e),zl("line-gap-width",this,e)),a=zl("line-offset",this,e);return r/2+Math.abs(a)+ih(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,r,a,l,h){if(s.queryGeometry.isAboveHorizon)return!1;const p=qg(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),y=s.pixelToTileUnitsFactor/2*yx(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),v=this.paint.get("line-offset").evaluate(e,r);return v&&(a=function(b,T){const k=[],M=new Ee(0,0);for(let L=0;L<b.length;L++){const R=b[L],B=[];for(let H=0;H<R.length;H++){const re=R[H],pe=R[H+1],ie=H===0?M:re.sub(R[H-1])._unit()._perp(),ue=H===R.length-1?M:pe.sub(re)._unit()._perp(),xe=ie._add(ue)._unit();xe._mult(1/(xe.x*ue.x+xe.y*ue.y)),B.push(xe._mult(T)._add(re))}k.push(B)}return k}(a,v*s.pixelToTileUnitsFactor)),function(b,T,k){for(let M=0;M<T.length;M++){const L=T[M];if(b.length>=3){for(let R=0;R<L.length;R++)if(Fo(b,L[R]))return!0}if(cb(b,L,k))return!0}return!1}(p,a,y)}isTileClipped(){return!0}},symbol:Ch,background:class extends fn{constructor(s){super(s,Jw)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends fn{constructor(s){super(s,Yw)}getProgramIds(){return["raster"]}},sky:class extends fn{constructor(s){super(s,t1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=up({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),l=!a,h=s.style.light,p=h.properties.get("position");return l&&h.properties.get("anchor")==="viewport"&&As("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Lp(p.azimuthal,90-p.polar,e):Lp(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Lp(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class Rd{constructor(e,r,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,a){const{width:l,height:h}=e,{context:p}=this,{gl:y}=p,{HTMLImageElement:v,HTMLCanvasElement:b,HTMLVideoElement:T,ImageData:k,ImageBitmap:M}=P;if(y.bindTexture(y.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===l&&this.size[1]===h){const{x:L,y:R}=a||{x:0,y:0};e instanceof v||e instanceof b||e instanceof T||e instanceof k||M&&e instanceof M?y.texSubImage2D(y.TEXTURE_2D,0,L,R,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,L,R,l,h,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[l,h],e instanceof v||e instanceof b||e instanceof T||e instanceof k||M&&e instanceof M?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,l,h,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class r1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class i1{constructor(){this.tasks={},this.taskQueue=[],_r(["process"],this),this.invoker=new r1(this.process),this.nextId=0}add(e,r){const a=this.nextId++,l=function({type:h,isSymbolTile:p,zoom:y}){return y=y||0,h==="message"?0:h!=="maybePrepare"||p?h!=="parseTile"||p?h==="parseTile"&&p?300-y:h==="maybePrepare"&&p?400-y:500:200-y:100-y}(r);if(l===0){Zr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:r,priority:l,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Zr();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const h=this.tasks[this.taskQueue[l]];h.priority<r&&(r=h.priority,e=l)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class sy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const n1=["tile","layer","source","sourceLayer","state"];class ry{constructor(e,r,a,l,h){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of n1)this[r]!==void 0&&(e[r]=this[r]);return e}}const Xi=32,zn=33,Va=new Uint16Array(8184);for(let s=0;s<2046;s++){let e=s+2,r=0,a=0,l=0,h=0,p=0,y=0;for(1&e?l=h=p=Xi:r=a=y=Xi;(e>>=1)>1;){const b=r+l>>1,T=a+h>>1;1&e?(l=r,h=a,r=p,a=y):(r=l,a=h,l=p,h=y),p=b,y=T}const v=4*s;Va[v+0]=r,Va[v+1]=a,Va[v+2]=l,Va[v+3]=h}const On=new Uint16Array(2178),qa=new Uint8Array(1089),kh=new Uint16Array(1089);function iy(s){return s===0?-.03125:s===32?.03125:0}var ny=ke([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ay={type:2,extent:zt,loadGeometry:()=>[[new Ee(0,0),new Ee(zt+1,0),new Ee(zt+1,zt+1),new Ee(0,zt+1),new Ee(0,0)]]};class Rp{constructor(e,r,a,l,h){this.tileID=e,this.uid=Fr(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<sn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Uo(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const p={};if(!h)return p;for(const y of l){const v=y.layerIds.map(b=>h.getLayer(b)).filter(Boolean);if(v.length!==0){y.layers=v,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(b=>v.filter(T=>T.id===b)[0]));for(const b of v)p[b.id]=y}}return p}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Ua){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Ua&&h.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||_()!=="deferred"||j();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ss}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Rd(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Rd(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Rd(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,l,h,p,y,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:y,transform:p,params:h,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),h=r?r.sourceLayer:"",p=l._geojsonTileLayer||l[h];if(!p)return;const y=Sl(r&&r.filter),{z:v,x:b,y:T}=this.tileID.canonical,k={z:v,x:b,y:T};for(let M=0;M<p.length;M++){const L=p.feature(M);if(y.needGeometry){const H=Oo(L,!0);if(!y.filter(new C(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!y.filter(new C(this.tileID.overscaledZ),L))continue;const R=a.getId(L,h),B=new ry(L,v,b,T,R);B.tile=k,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=we(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const h=this.expirationTime-r;h?this.expirationTime=a+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const a=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const p=this.buckets[h],y=p.layers[0].sourceLayer||"_geojsonTileLayer",v=a[y],b=e[y];if(!v||!b||Object.keys(b).length===0)continue;if(p.update(b,v,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof ph||p instanceof ch){const k=r.style._getSourceCache(p.layers[0].source);r._terrain&&r._terrain.enabled&&k&&p.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(k.id,this.tileID)}const T=r&&r.style&&r.style.getLayer(h);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<sn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=sn.now()+e}setTexture(e,r){const a=r.context,l=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Rd(a,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,r){const a={};for(const l of r)a[l]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const l=this.dependencies[a];if(l){for(const h of r)if(l[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const a=oa(ay,this.tileID.canonical,this.tileTransform)[0],l=new at,h=new ji;for(let p=0;p<a.length;p++){const{x:y,y:v}=a[p];l.emplaceBack(y,v),h.emplaceBack(p)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(l,pd.members),this._tileDebugSegments=ar.simpleSegment(0,0,l.length,h.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const a=oa(ay,this.tileID.canonical,this.tileTransform)[0];let l,h;if(this.isRaster){const p=function(y,v){const b=Uo(y,v),T=Math.pow(2,y.z);for(let H=0;H<zn;H++)for(let re=0;re<zn;re++){const pe=Ri((y.x+(re+iy(re))/Xi)/T),ie=$r((y.y+(H+iy(H))/Xi)/T),ue=v.project(pe,ie),xe=H*zn+re;On[2*xe+0]=Math.round((ue.x*b.scale-b.x)*zt),On[2*xe+1]=Math.round((ue.y*b.scale-b.y)*zt)}qa.fill(0),kh.fill(0);for(let H=2045;H>=0;H--){const re=4*H,pe=Va[re+0],ie=Va[re+1],ue=Va[re+2],xe=Va[re+3],ge=pe+ue>>1,Ue=ie+xe>>1,Oe=ge+Ue-ie,He=Ue+pe-ge,ot=ie*zn+pe,qe=xe*zn+ue,Je=Ue*zn+ge,Ye=Math.hypot((On[2*ot+0]+On[2*qe+0])/2-On[2*Je+0],(On[2*ot+1]+On[2*qe+1])/2-On[2*Je+1])>=16;qa[Je]=qa[Je]||(Ye?1:0),H<1022&&(qa[Je]=qa[Je]||qa[(ie+He>>1)*zn+(pe+Oe>>1)]||qa[(xe+He>>1)*zn+(ue+Oe>>1)])}const k=new Qe,M=new Pt;let L=0;function R(H,re){const pe=re*zn+H;return kh[pe]===0&&(k.emplaceBack(On[2*pe+0],On[2*pe+1],H*zt/Xi,re*zt/Xi),kh[pe]=++L),kh[pe]-1}function B(H,re,pe,ie,ue,xe){const ge=H+pe>>1,Ue=re+ie>>1;if(Math.abs(H-ue)+Math.abs(re-xe)>1&&qa[Ue*zn+ge])B(ue,xe,H,re,ge,Ue),B(pe,ie,ue,xe,ge,Ue);else{const Oe=R(H,re),He=R(pe,ie),ot=R(ue,xe);M.emplaceBack(Oe,He,ot)}}return B(0,0,Xi,Xi,Xi,0),B(Xi,Xi,0,0,0,Xi),{vertices:k,indices:M}}(this.tileID.canonical,r);l=p.vertices,h=p.indices}else{l=new Qe,h=new Pt;for(const{x:y,y:v}of a)l.emplaceBack(y,v,0,0);const p=gp(l.int16,void 0,4);for(let y=0;y<p.length;y+=3)h.emplaceBack(p[y],p[y+1],p[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,ny.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=ar.simpleSegment(0,0,l.length,h.length)}_makeGlobeTileDebugBuffers(e,r){const a=r.projection;if(!a||a.name!=="globe"||r.freezeTileCoverage)return;const l=this.tileID.canonical,h=xd(Eg(l,r)),p=Ll(r.zoom);let y;p>0&&(y=$m(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,r,h,y,p),this._makeGlobeTileDebugTextBuffer(e,l,r,h,y,p)}_globePoint(e,r,a,l,h,p,y){let v=gd(e,r,a);if(p){const b=1<<a.z,T=Ln(l.center.lng),k=Rn(l.center.lat),M=(a.x+.5)/b-T;let L=0;M>.5?L=-1:M<-.5&&(L=1);let R=(e/zt+a.x)/b+L,B=(r/zt+a.y)/b;R=(R-T)*l._pixelsPerMercatorPixel+T,B=(B-k)*l._pixelsPerMercatorPixel+k;const H=[R*l.worldSize,B*l.worldSize,0];Ys(H,H,p),v=zo(v,H,y)}return Ys(v,v,h)}_makeGlobeTileDebugBorderBuffer(e,r,a,l,h,p){const y=new at,v=new ji,b=new ze,T=(M,L,R,B,H)=>{const re=(R-M)/(H-1),pe=(B-L)/(H-1),ie=y.length;for(let ue=0;ue<H;ue++){const xe=M+ue*re,ge=L+ue*pe;y.emplaceBack(xe,ge);const Ue=this._globePoint(xe,ge,r,a,l,h,p);b.emplaceBack(Ue[0],Ue[1],Ue[2]),v.emplaceBack(ie+ue)}},k=zt;T(0,0,k,0,16),T(k,0,k,k,16),T(k,k,0,k,16),T(0,k,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(v),this._tileDebugBuffer=e.createVertexBuffer(y,pd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,Ng.members),this._tileDebugSegments=ar.simpleSegment(0,0,y.length,v.length)}_makeGlobeTileDebugTextBuffer(e,r,a,l,h,p){const y=zt/4,v=new at,b=new Pt,T=new ze,k=25;b.reserve(32),v.reserve(k),T.reserve(k);const M=(L,R)=>k*L+R;for(let L=0;L<k;L++){const R=L*y;for(let B=0;B<k;B++){const H=B*y;v.emplaceBack(H,R);const re=this._globePoint(H,R,r,a,l,h,p);T.emplaceBack(re[0],re[1],re[2])}}for(let L=0;L<4;L++)for(let R=0;R<4;R++){const B=M(L,R),H=M(L,R+1),re=M(L+1,R),pe=M(L+1,R+1);b.emplaceBack(B,H,re),b.emplaceBack(re,H,pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(v,pd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,Ng.members),this._tileDebugTextSegments=ar.simpleSegment(0,0,k,32)}}class a1{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Ut(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])a[h]||(this.deletedStates[e][l][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),l=Ut({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][r];if(h===null)return{};for(const p in h)delete l[p]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const p in this.stateChanges[l])this.state[l][p]||(this.state[l][p]={}),Ut(this.state[l][p],this.stateChanges[l][p]),h[p]=this.state[l][p];a[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const p in this.state[l])h[p]={},this.state[l][p]={};else for(const p in this.deletedStates[l]){if(this.deletedStates[l][p]===null)this.state[l][p]={};else if(this.state[l][p])for(const y of Object.keys(this.deletedStates[l][p]))delete this.state[l][p][y];h[p]=this.state[l][p]}a[l]=a[l]||{},Ut(a[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,r)}}class oy{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function ly(s,e,r,a){let l=0,h=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(r[p]<s[p]||r[p]>e[p])return null}else{const y=1/a[p];let v=(s[p]-r[p])*y,b=(e[p]-r[p])*y;if(v>b){const T=v;v=b,b=T}if(v>l&&(l=v),b<h&&(h=b),l>h)return null}return l}function cy(s,e,r,a,l,h,p,y,v,b,T){const k=a-s,M=l-e,L=h-r,R=p-s,B=y-e,H=v-r,re=T[1]*H-T[2]*B,pe=T[2]*R-T[0]*H,ie=T[0]*B-T[1]*R,ue=k*re+M*pe+L*ie;if(Math.abs(ue)<1e-15)return null;const xe=1/ue,ge=b[0]-s,Ue=b[1]-e,Oe=b[2]-r,He=(ge*re+Ue*pe+Oe*ie)*xe;if(He<0||He>1)return null;const ot=Ue*L-Oe*M,qe=Oe*k-ge*L,Je=ge*M-Ue*k,Ye=(T[0]*ot+T[1]*qe+T[2]*Je)*xe;return Ye<0||He+Ye>1?null:(R*ot+B*qe+H*Je)*xe}function dy(s,e,r){return(s-e)/(r-e)}function uy(s,e,r,a,l,h,p,y,v){const b=1<<r,T=h-a,k=p-l,M=(s+1)/b*T+a,L=(e+0)/b*k+l,R=(e+1)/b*k+l;y[0]=(s+0)/b*T+a,y[1]=L,v[0]=M,v[1]=R}class hy{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(h){const p=Math.ceil(Math.log2(h.dim/8)),y=[];let v=Math.ceil(Math.pow(2,p));const b=1/v,T=(L,R,B,H,re)=>{const pe=H?1:0,ie=(L+1)*B-pe,ue=R*B,xe=(R+1)*B-pe;re[0]=L*B,re[1]=ue,re[2]=ie,re[3]=xe};let k=new oy(v);const M=[];for(let L=0;L<v*v;L++){T(L%v,Math.floor(L/v),b,!1,M);const R=$a(M[0],M[1],h),B=$a(M[2],M[1],h),H=$a(M[2],M[3],h),re=$a(M[0],M[3],h);k.minimums.push(Math.min(R,B,H,re)),k.maximums.push(Math.max(R,B,H,re)),k.leaves.push(1)}for(y.push(k),v/=2;v>=1;v/=2){const L=y[y.length-1];k=new oy(v);for(let R=0;R<v*v;R++){T(R%v,Math.floor(R/v),2,!0,M);const B=L.getElevation(M[0],M[1]),H=L.getElevation(M[2],M[1]),re=L.getElevation(M[2],M[3]),pe=L.getElevation(M[0],M[3]),ie=L.isLeaf(M[0],M[1]),ue=L.isLeaf(M[2],M[1]),xe=L.isLeaf(M[2],M[3]),ge=L.isLeaf(M[0],M[3]),Ue=Math.min(B.min,H.min,re.min,pe.min),Oe=Math.max(B.max,H.max,re.max,pe.max),He=ie&&ue&&xe&&ge;k.maximums.push(Oe),k.minimums.push(Ue),k.leaves.push(Oe-Ue<=5&&He?1:0)}y.push(k)}return y}(this.dem),a=r.length-1,l=r[a];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,l,h,p,y=1){return ly([e,r,-100],[a,l,this.maximums[0]*y],h,p)}raycast(e,r,a,l,h,p,y=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,r,a,l,h,p,y);if(v==null)return null;const b=[],T=[],k=[],M=[],L=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:R,t:B,nodex:H,nodey:re,depth:pe}=L.pop();if(this.leaves[R]){uy(H,re,pe,e,r,a,l,k,M);const ue=1<<pe,xe=(H+0)/ue,ge=(H+1)/ue,Ue=(re+0)/ue,Oe=(re+1)/ue,He=$a(xe,Ue,this.dem)*y,ot=$a(ge,Ue,this.dem)*y,qe=$a(ge,Oe,this.dem)*y,Je=$a(xe,Oe,this.dem)*y,Ye=cy(k[0],k[1],He,M[0],k[1],ot,M[0],M[1],qe,h,p),rt=cy(M[0],M[1],qe,k[0],M[1],Je,k[0],k[1],He,h,p),mt=Math.min(Ye!==null?Ye:Number.MAX_VALUE,rt!==null?rt:Number.MAX_VALUE);if(mt!==Number.MAX_VALUE)return mt;{const Ze=hd([],h,p,B);if(my(He,ot,Je,qe,dy(Ze[0],k[0],M[0]),dy(Ze[1],k[1],M[1]))>=Ze[2])return B}continue}let ie=0;for(let ue=0;ue<this._siblingOffset.length;ue++){uy((H<<1)+this._siblingOffset[ue][0],(re<<1)+this._siblingOffset[ue][1],pe+1,e,r,a,l,k,M),k[2]=-100,M[2]=this.maximums[this.childOffsets[R]+ue]*y;const xe=ly(k,M,h,p);if(xe!=null){const ge=xe;b[ue]=ge;let Ue=!1;for(let Oe=0;Oe<ie&&!Ue;Oe++)ge>=b[T[Oe]]&&(T.splice(Oe,0,ue),Ue=!0);Ue||(T[ie]=ue),ie++}}for(let ue=0;ue<ie;ue++){const xe=T[ue];L.push({idx:this.childOffsets[R]+xe,t:b[xe],nodex:(H<<1)+this._siblingOffset[xe][0],nodey:(re<<1)+this._siblingOffset[xe][1],depth:pe+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,l,h){if(e[l].isLeaf(r,a)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const p=l-1,y=e[p];let v=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){const k=2*r+this._siblingOffset[T][0],M=2*a+this._siblingOffset[T][1],L=y.getElevation(k,M),R=y.isLeaf(k,M),B=this._addNode(L.min,L.max,R);R&&(v|=1<<T),b||(b=B)}for(let T=0;T<this._siblingOffset.length;T++)v&1<<T||this._construct(e,2*r+this._siblingOffset[T][0],2*a+this._siblingOffset[T][1],p,b+T)}}function my(s,e,r,a,l,h){return us(us(s,r,h),us(e,a,h),l)}function $a(s,e,r){const a=r.dim,l=ht(s*a-.5,0,a-1),h=ht(e*a-.5,0,a-1),p=Math.floor(l),y=Math.floor(h),v=Math.min(p+1,a-1),b=Math.min(y+1,a-1);return my(r.get(p,y),r.get(v,y),r.get(p,b),r.get(v,b),l-p,h-y)}const py={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function o1(s,e,r){return(256*s*256+256*e+r)/10-1e4}function l1(s,e,r){return 256*s+e+r/256-32768}class Ah{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,l=!1,h=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return As(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2,y=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=l,!l){for(let v=0;v<p;v++)y[this._idx(-1,v)]=y[this._idx(0,v)],y[this._idx(p,v)]=y[this._idx(p-1,v)],y[this._idx(v,-1)]=y[this._idx(v,0)],y[this._idx(v,p)]=y[this._idx(v,p-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(p,-1)]=y[this._idx(p-1,0)],y[this._idx(-1,p)]=y[this._idx(0,p-1)],y[this._idx(p,p)]=y[this._idx(p-1,p-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new hy(this)}get(e,r,a=!1){a&&(e=ht(e,-1,this.dim),r=ht(r,-1,this.dim));const l=4*this._idx(e,r);return(this.encoding==="terrarium"?l1:o1)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return py[e]}get unpackVector(){return py[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],l=Ah.getUnpackVector(r);let h=Math.floor((e+l[3])/l[2]);return a[2]=h%256,h=Math.floor(h/256),a[1]=h%256,h=Math.floor(h/256),a[0]=h,a}getPixels(){return new Si({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,p=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(a){case-1:p=y-1;break;case 1:y=p+1}const v=-r*this.dim,b=-a*this.dim;for(let T=p;T<y;T++)for(let k=l;k<h;k++){const M=4*this._idx(k,T),L=4*this._idx(k+v,T+b);this.pixels[M+0]=e.pixels[L+0],this.pixels[M+1]=e.pixels[L+1],this.pixels[M+2]=e.pixels[L+2],this.pixels[M+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Et(Ah,"DEMData"),Et(hy,"DemMinMaxQuadTree",{omit:["dem"]});class c1{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:r,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,l=r===void 0?0:this.data[a].indexOf(r),h=this.data[a][l];return this.data[a].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||r.push(l);for(const a of r)this.remove(a.value.tileID,a)}}class Kl{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}Kl.ReadOnly=!1,Kl.ReadWrite=!0,Kl.disabled=new Kl(519,Kl.ReadOnly,[0,1]);const zp=7680;class Op{constructor(e,r,a,l,h,p){this.test=e,this.ref=r,this.mask=a,this.fail=l,this.depthFail=h,this.pass=p}}Op.disabled=new Op({func:519,mask:0},0,0,zp,zp,zp);class Fn{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}Fn.Replace=[1,0],Fn.disabled=new Fn(Fn.Replace,Js.transparent,[!1,!1,!1,!1]),Fn.unblended=new Fn(Fn.Replace,Js.transparent,[!0,!0,!0,!0]),Fn.alphaBlended=new Fn([1,771],Js.transparent,[!0,!0,!0,!0]);const Fp=1029,Bp=2305;class bn{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}bn.disabled=new bn(!1,Fp,Bp),bn.backCCW=new bn(!0,Fp,Bp),bn.backCW=new bn(!0,Fp,2304),bn.frontCW=new bn(!0,1028,2304),bn.frontCCW=new bn(!0,1028,Bp);class Vo extends io{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new c1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new a1,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return pr(this._tiles).map(e=>e.tileID).sort(fy).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&r.push(this._tiles[a]);return e?r.sort((a,l)=>{const h=a.tileID,p=l.tileID,y=new Ee(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),v=new Ee(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-p.overscaledZ||v.y-y.y||v.x-y.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(fy).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new rn(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=sn.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Wn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const h=r[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const p=this.getTileByID(h);a(e,p),a(p,e)}}function a(l,h){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let p=h.tileID.canonical.x-l.tileID.canonical.x;const y=h.tileID.canonical.y-l.tileID.canonical.y,v=Math.pow(2,l.tileID.canonical.z),b=h.tileID.key;p===0&&y===0||Math.abs(y)>1||(Math.abs(p)>1&&(Math.abs(p+v)===1?p+=v:Math.abs(p-v)===1&&(p-=v)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,p,y),l.neighboringTiles&&l.neighboringTiles[b]&&(l.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,l){for(const h in this._tiles){let p=this._tiles[h];if(l[h]||!p.hasData()||p.tileID.overscaledZ<=r||p.tileID.overscaledZ>a)continue;let y=p.tileID;for(;p&&p.tileID.overscaledZ>r+1;){const b=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[b.key],p&&p.hasData()&&(y=b)}let v=y;for(;v.overscaledZ>r;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){l[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const l=e.scaledTo(a),h=this._getLoadedTile(l);if(h)return h}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,l=Math.ceil(e.height/r)+1,h=Math.floor(a*l*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+r),a[h.tileID.key]=h}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,r,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let l;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new ii(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(l=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(y=>this._source.hasTile(y)))):l=[];const h=this._updateRetainedTiles(l);if(gy(this._source.type)&&l.length!==0){const y={},v={},b=Object.keys(h);for(const k of b){const M=h[k],L=this._tiles[k];if(!L||L.fadeEndTime&&L.fadeEndTime<=sn.now())continue;const R=this.findLoadedParent(M,Math.max(M.overscaledZ-Vo.maxOverzooming,this._source.minzoom));R&&(this._addTile(R.tileID),y[R.tileID.key]=R.tileID),v[k]=M}const T=l[l.length-1].overscaledZ;for(const k in this._tiles){const M=this._tiles[k];if(h[k]||!M.hasData())continue;let L=M.tileID;for(;L.overscaledZ>T;){L=L.scaledTo(L.overscaledZ-1);const R=this._tiles[L.key];if(R&&R.hasData()&&v[L.key]){h[k]=M.tileID;break}}}for(const k in y)h[k]||(this._coveredTiles[k]=!0,h[k]=y[k])}for(const y in h)this._tiles[y].clearFadeHold();const p=function(y,v){const b=[];for(const T in y)T in v||b.push(T);return b}(this._tiles,h);for(const y of p){const v=this._tiles[y];v.hasSymbolBuckets&&!v.holdingForFade()?v.setHoldDuration(this.map._fadeDuration):v.hasSymbolBuckets&&!v.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const a={},l=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),h=e[0].overscaledZ,p=Math.max(h-Vo.maxOverzooming,this._source.minzoom),y=Math.max(h+Vo.maxUnderzooming,this._source.minzoom),v={};for(const b of e){const T=this._addTile(b);r[b.key]=b,T.hasData()||l<this._source.maxzoom&&(v[b.key]=b)}this._retainLoadedChildren(v,l,y,r);for(const b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const M=b.children(this._source.maxzoom)[0],L=this.getTile(M);if(L&&L.hasData()){r[M.key]=M;continue}}else{const M=b.children(this._source.maxzoom);if(r[M[0].key]&&r[M[1].key]&&r[M[2].key]&&r[M[3].key])continue}let k=T.wasRequested();for(let M=b.overscaledZ-1;M>=p;--M){const L=b.scaledTo(M);if(a[L.key]||(a[L.key]=!0,T=this.getTile(L),!T&&k&&(T=this._addTile(L)),T&&(r[L.key]=L,k=T.wasRequested(),T.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}r.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;l=h}for(const h of r)this._loadedParentTiles[h]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=!!r;if(!a){const l=this.map?this.map.painter:null;r=new Rp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new Wn("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){const l=[],h=this.transform;if(!h)return l;const p=h.projection.name==="globe",y=Ln(h.center.lng);for(const v in this._tiles){const b=this._tiles[v];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let T;if(p){const k=b.tileID.canonical;if(k.z===0){const M=[Math.abs(ht(y,...zd(k,-1))-y),Math.abs(ht(y,...zd(k,1))-y)];T=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(ht(y,...zd(k,-1))-y),Math.abs(ht(y,...zd(k,0))-y),Math.abs(ht(y,...zd(k,1))-y)];T=[M.indexOf(Math.min(...M))-1]}}else T=[0];for(const k of T){const M=e.containsTile(b,h,r,k);M&&l.push(M)}}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(gy(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=sn.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const l=this._tiles[e];l&&l.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,r))};return void this._source.on("data",y)}const a=new Map,l=Array.isArray(e)?e:[e],h=this.map.painter.terrain,p=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const y of l){const v=y.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const b of v)a.set(b.key,b);this.usedForTerrain&&y.updateElevation(!1)}_s(Array.from(a.values()),(y,v)=>{const b=new Rp(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),v(T,b)})},r)}}function fy(s,e){const r=Math.abs(2*s.wrap)-+(s.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return s.overscaledZ-e.overscaledZ||a-r||e.canonical.y-s.canonical.y||e.canonical.x-s.canonical.x}function gy(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function zd(s,e){const r=1<<s.z;return[s.x/r+e,(s.x+1)/r+e]}Vo.maxOverzooming=10,Vo.maxUnderzooming=3;class Mh{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const l=a||e.findDEMTileFor(r);if(!l||!l.dem)return;const h=l.dem,p=l.tileID,y=1<<r.canonical.z-p.canonical.z;return new Mh(l,l.tileSize/zt/y,[(r.canonical.x/y-p.canonical.x)*h.dim,(r.canonical.y/y-p.canonical.y)*h.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(a);return new Ee(l,h)}getElevationAt(e,r,a,l){const h=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],y=Math.floor(h),v=Math.floor(p),b=this._dem;return l=!!l,a?us(us(b.get(y,v,l),b.get(y,v+1,l),p-v),us(b.get(y+1,v,l),b.get(y+1,v+1,l),p-v),h-y):b.get(y,v,l)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*yn(1,e)*this._dem.stride}}class xy{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ea(zt,16,0),this.featureIndexArray=new Ao,this.promoteId=r}insert(e,r,a,l,h,p=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,h,p);const v=this.grid;for(let b=0;b<r.length;b++){const T=r[b],k=[1/0,1/0,-1/0,-1/0];for(let M=0;M<T.length;M++){const L=T[M];k[0]=Math.min(k[0],L.x),k[1]=Math.min(k[1],L.y),k[2]=Math.max(k[2],L.x),k[3]=Math.max(k[3],L.y)}k[0]<zt&&k[1]<zt&&k[2]>=0&&k[3]>=0&&v.insert(y,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new vp(new xh(this.rawTileData)).layers,this.sourceLayerCoder=new sy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,l){this.loadVTLayers();const h=e.params||{},p=Sl(h.filter),y=e.tileResult,v=e.transform,b=y.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(R,B,H,re)=>Vg(y.bufferedTilespaceGeometry,R,B,H,re));T.sort(d1);let k=null;v.elevation&&T.length>0&&(k=Mh.create(v.elevation,this.tileID));const M={};let L;for(let R=0;R<T.length;R++){const B=T[R];if(B===L)continue;L=B;const H=this.featureIndexArray.get(B);let re=null;this.loadMatchingFeature(M,H,p,h.layers,h.availableImages,r,a,l,(pe,ie,ue,xe=0)=>(re||(re=oa(pe,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(y,pe,ue,re,this.z,e.transform,e.pixelPosMatrix,k,xe)))}return M}loadMatchingFeature(e,r,a,l,h,p,y,v,b){const{featureIndex:T,bucketIndex:k,sourceLayerIndex:M,layoutVertexArrayOffset:L}=r,R=this.bucketLayerIDs[k];if(l&&!function(pe,ie){for(let ue=0;ue<pe.length;ue++)if(ie.indexOf(pe[ue])>=0)return!0;return!1}(l,R))return;const B=this.sourceLayerCoder.decode(M),H=this.vtLayers[B].feature(T);if(a.needGeometry){const pe=Oo(H,!0);if(!a.filter(new C(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!a.filter(new C(this.tileID.overscaledZ),H))return;const re=this.getId(H,B);for(let pe=0;pe<R.length;pe++){const ie=R[pe];if(l&&l.indexOf(ie)<0)continue;const ue=p[ie];if(!ue)continue;let xe={};re!==void 0&&v&&(xe=v.getState(ue.sourceLayer||"_geojsonTileLayer",re));const ge=Ut({},y[ie]);ge.paint=yy(ge.paint,ue.paint,H,xe,h),ge.layout=yy(ge.layout,ue.layout,H,xe,h);const Ue=!b||b(H,ue,xe,L);if(!Ue)continue;const Oe=new ry(H,this.z,this.x,this.y,re);Oe.layer=ge;let He=e[ie];He===void 0&&(He=e[ie]=[]),He.push({featureIndex:T,feature:Oe,intersectionZ:Ue})}}lookupSymbolFeatures(e,r,a,l,h,p,y,v){const b={};this.loadVTLayers();const T=Sl(h);for(const k of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:l,featureIndex:k,layoutVertexArrayOffset:0},T,p,y,v,r);return b}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(a),h=this.vtFeatures[l];if(h[r])return h[r];const p=this.vtLayers[l].feature(r);return h[r]=p,p}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];l!=null&&(a=e.properties[l]),typeof a=="boolean"&&(a=Number(a))}return a}}function yy(s,e,r,a,l){return Qt(s,(h,p)=>{const y=e instanceof se?e.get(p):null;return y&&y.evaluate?y.evaluate(r,a,l):y})}function d1(s,e){return e-s}Et(xy,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class _y{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new la({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=gr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,y=!0;l.push({left:h,right:p,isDash:y,zeroLength:e[0]===0});let v=e[0];for(let b=1;b<e.length;b++){y=!y;const T=e[b];h=v*a,v+=T,p=v*a,l.push({left:h,right:p,isDash:y,zeroLength:T===0})}return l}addRoundDash(e,r,a){const l=r/2;for(let h=-a;h<=a;h++){const p=this.width*(this.nextRow+a+h);let y=0,v=e[y];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++y]);const T=Math.abs(b-v.left),k=Math.abs(b-v.right),M=Math.min(T,k);let L;const R=h/a*(l+1);if(v.isDash){const B=l-Math.abs(R);L=Math.sqrt(M*M+B*B)}else L=l-Math.sqrt(M*M+R*R);this.image.data[p+b]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,r){for(let v=e.length-1;v>=0;--v){const b=e[v],T=e[v+1];b.zeroLength?e.splice(v,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(v,1))}const a=e[0],l=e[e.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let p=0,y=e[p];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++p]);const b=Math.abs(v-y.left),T=Math.abs(v-y.right),k=Math.min(b,T);this.image.data[h+v]=Math.max(0,Math.min(255,(y.isDash?k:-k)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const l=r==="round",h=l?7:0,p=2*h+1;if(this.nextRow+p>this.height)return As("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let T=0;T<e.length;T++)e[T]<0&&(As("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),y+=e[T];if(y!==0){const T=this.width/y,k=this.getDashRanges(e,this.width,T);l?this.addRoundDash(k,T,h):this.addRegularDash(k,r==="square"?.5*T:0)}const v=this.nextRow+h;this.nextRow+=p;const b={tl:[v,h],br:[y,0]};return this.positions[a]=b,b}}Et(_y,"LineAtlas");const vy=1*vn;class by{constructor(e){const r={},a=[];for(const y in e){const v=e[y],b=r[y]={};for(const T in v.glyphs){const k=v.glyphs[+T];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const M=k.metrics.localGlyph?vy:1,L={x:0,y:0,w:k.bitmap.width+2*M,h:k.bitmap.height+2*M};a.push(L),b[T]=L}}const{w:l,h}=Np(a),p=new la({width:l||1,height:h||1});for(const y in e){const v=e[y];for(const b in v.glyphs){const T=v.glyphs[+b];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const k=r[y][b],M=T.metrics.localGlyph?vy:1;la.copy(T.bitmap,p,{x:0,y:0},{x:k.x+M,y:k.y+M},T.bitmap)}}this.image=p,this.positions=r}}Et(by,"GlyphAtlas");class u1{constructor(e){this.tileID=new ii(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Uo(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,a,l,h){this.status="parsing",this.data=e,this.collisionBoxArray=new Ss;const p=new sy(Object.keys(e.layers).sort()),y=new xy(this.tileID,this.promoteId);y.bucketLayerIDs=[];const v={},b=new _y(256,256),T={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:a},k=r.familiesBySource[this.source];for(const xe in k){const ge=e.layers[xe];if(!ge)continue;let Ue=!1,Oe=!1;for(const qe of k[xe])qe[0].type==="symbol"?Ue=!0:Oe=!0;if(this.isSymbolTile===!0&&!Ue||this.isSymbolTile===!1&&!Oe)continue;ge.version===1&&As(`Vector tile source "${this.source}" layer "${xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const He=p.encode(xe),ot=[];for(let qe=0;qe<ge.length;qe++){const Je=ge.feature(qe),Ye=y.getId(Je,xe);ot.push({feature:Je,id:Ye,index:qe,sourceLayerIndex:He})}for(const qe of k[xe]){const Je=qe[0];this.isSymbolTile!==void 0&&Je.type==="symbol"!==this.isSymbolTile||Je.minzoom&&this.zoom<Math.floor(Je.minzoom)||Je.maxzoom&&this.zoom>=Je.maxzoom||Je.visibility!=="none"&&(Up(qe,this.zoom,a),(v[Je.id]=Je.createBucket({index:y.bucketLayerIDs.length,layers:qe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:He,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(ot,T,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(qe.map(Ye=>Ye.id)))}}let M,L,R,B;b.trim();const H={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},re=()=>{if(M)return h(M);if(L&&R&&B){const xe=new by(L),ge=new Cx(R,B);for(const Ue in v){const Oe=v[Ue];Oe instanceof Ua?(Up(Oe.layers,this.zoom,a),zw(Oe,L,xe.positions,R,ge.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Oe.hasPattern&&(Oe instanceof ph||Oe instanceof ch||Oe instanceof Sd)&&(Up(Oe.layers,this.zoom,a),Oe.addFeatures(T,this.tileID.canonical,ge.patternPositions,a,this.tileTransform))}this.status="done",h(null,{buckets:pr(v).filter(Ue=>!Ue.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,lineAtlas:b,imageAtlas:ge,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?R:null,glyphPositions:this.returnDependencies?xe.positions:null})}},pe=Qt(T.glyphDependencies,xe=>Object.keys(xe).map(Number));Object.keys(pe).length?l.send("getGlyphs",{uid:this.uid,stacks:pe},(xe,ge)=>{M||(M=xe,L=ge,re())},void 0,!1,H):L={};const ie=Object.keys(T.iconDependencies);ie.length?l.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(xe,ge)=>{M||(M=xe,R=ge,re())},void 0,!1,H):R={};const ue=Object.keys(T.patternDependencies);ue.length?l.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"patterns"},(xe,ge)=>{M||(M=xe,B=ge,re())},void 0,!1,H):B={},re()}}function Up(s,e,r){const a=new C(e);for(const l of s)l.recalculate(a,r)}class wy{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,l){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[p,y]=h.result;return this.scheduler?this.scheduler.add(()=>{l(p,y)},r):l(p,y),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=a((p,y)=>{h.result=[p,y];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,y)},r):v(p,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==l),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function jy(s,e,r){const a=JSON.stringify(s.request);return s.data&&(this.deduped.entries[a]={result:[null,s.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},l=>{const h=tn(s.request,(p,y,v,b)=>{p?l(p):y&&l(null,{vectorTile:r?void 0:new vp(new xh(y)),rawData:y,cacheControl:v,expires:b})});return()=>{h.cancel(),l()}},e)}const Ny=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=Ny[15&a];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Vp(y,p,h,e)}constructor(e,r=64,a=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=Ny.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return qp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:y}=this,v=[0,h.length-1,0],b=[];for(;v.length;){const T=v.pop()||0,k=v.pop()||0,M=v.pop()||0;if(k-M<=y){for(let H=M;H<=k;H++){const re=p[2*H],pe=p[2*H+1];re>=e&&re<=a&&pe>=r&&pe<=l&&b.push(h[H])}continue}const L=M+k>>1,R=p[2*L],B=p[2*L+1];R>=e&&R<=a&&B>=r&&B<=l&&b.push(h[L]),(T===0?e<=R:r<=B)&&(v.push(M),v.push(L-1),v.push(1-T)),(T===0?a>=R:l>=B)&&(v.push(L+1),v.push(k),v.push(1-T))}return b}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,y=[0,l.length-1,0],v=[],b=a*a;for(;y.length;){const T=y.pop()||0,k=y.pop()||0,M=y.pop()||0;if(k-M<=p){for(let H=M;H<=k;H++)Ty(h[2*H],h[2*H+1],e,r)<=b&&v.push(l[H]);continue}const L=M+k>>1,R=h[2*L],B=h[2*L+1];Ty(R,B,e,r)<=b&&v.push(l[L]),(T===0?e-a<=R:r-a<=B)&&(y.push(M),y.push(L-1),y.push(1-T)),(T===0?e+a>=R:r+a>=B)&&(y.push(L+1),y.push(k),y.push(1-T))}return v}}function qp(s,e,r,a,l,h){if(l-a<=r)return;const p=a+l>>1;Sy(s,e,p,a,l,h),qp(s,e,r,a,p-1,1-h),qp(s,e,r,p+1,l,1-h)}function Sy(s,e,r,a,l,h){for(;l>a;){if(l-a>600){const b=l-a+1,T=r-a+1,k=Math.log(b),M=.5*Math.exp(2*k/3),L=.5*Math.sqrt(k*M*(b-M)/b)*(T-b/2<0?-1:1);Sy(s,e,r,Math.max(a,Math.floor(r-T*M/b+L)),Math.min(l,Math.floor(r+(b-T)*M/b+L)),h)}const p=e[2*r+h];let y=a,v=l;for(Od(s,e,a,r),e[2*l+h]>p&&Od(s,e,a,l);y<v;){for(Od(s,e,y,v),y++,v--;e[2*y+h]<p;)y++;for(;e[2*v+h]>p;)v--}e[2*a+h]===p?Od(s,e,a,v):(v++,Od(s,e,v,l)),v<=r&&(a=v+1),r<=v&&(l=v-1)}}function Od(s,e,r,a){$p(s,r,a),$p(e,2*r,2*a),$p(e,2*r+1,2*a+1)}function $p(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}function Ty(s,e,r,a){const l=s-r,h=e-a;return l*l+h*h}n.ARRAY_TYPE=Ni,n.AUTH_ERR_MSG=ye,n.Aabb=ri,n.Actor=class{constructor(s,e,r){this.target=s,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},_r(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Zr()?s:P,this.scheduler=new i1}send(s,e,r,a,l=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=h,this.callbacks[p]=r);const y=et(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:s,hasCallback:!!r,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:Ia(e,y)},y),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(s){const e=s.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(e.mustQueue||Zr()){const a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),a&&a.metadata||{type:"message"})}else this.processTask(r,e)}processTask(s,e){if(e.type==="<response>"){const r=this.callbacks[s];delete this.callbacks[s],r&&(e.error?r(ta(e.error)):r(null,ta(e.data)))}else{const r=et(this.globalScope)?void 0:[],a=e.hasCallback?(h,p)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:h?Ia(h):null,data:Ia(p,r)},r)}:h=>{},l=ta(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,a);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],l.source)[h[1]](l,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.CanonicalTileID=mh,n.Color=Js,n.ColorMode=Fn,n.CullFaceMode=bn,n.DEMData=Ah,n.DataConstantProperty=F,n.DedupedRequest=wy,n.DepthMode=Kl,n.EXTENT=zt,n.Elevation=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,l=Math.floor(s.x),h=Math.floor((s.x-l)*a),p=Math.floor(s.y*a),y=this.findDEMTileFor(new ii(r,l,r,h,p));return!(!y||!y.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||s.y<0||s.y>1)return e;const l=a.getSource().maxzoom,h=1<<l,p=Math.floor(s.x),y=s.x-p,v=new ii(l,p,l,Math.floor(y*h),Math.floor(s.y*h)),b=this.findDEMTileFor(v);if(!b||!b.dem)return e;const T=b.dem,k=1<<b.tileID.canonical.z,M=(y*k-b.tileID.canonical.x)*T.dim,L=(s.y*k-b.tileID.canonical.y)*T.dim,R=Math.floor(M),B=Math.floor(L);return(r?this.exaggeration():1)*us(us(T.get(R,B),T.get(R,B+1),L-B),us(T.get(R+1,B),T.get(R+1,B+1),L-B),M-R)}getAtTileOffset(s,e,r){const a=1<<s.canonical.z;return this.getAtPointOrZero(new Rl(s.wrap+(s.canonical.x+e/zt)/a,(s.canonical.y+r/zt)/a))}getAtTileOffsetFunc(s,e,r,a){return l=>{const h=this.getAtTileOffset(s,l.x,l.y),p=a.upVector(s.canonical,l.x,l.y);return Li(p,p,h*a.upVectorScale(s.canonical,e,r).metersToTile),p}}getForTilePoints(s,e,r,a){if(this.isUsingMockSource())return!1;const l=Mh.create(this,s,a);return!!l&&(e.forEach(h=>{h[2]=this.exaggeration()*l.getElevationAt(h[0],h[1],r)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,l=1<<s.canonical.z-a.canonical.z;let h=s.canonical.x/l-a.canonical.x,p=s.canonical.y/l-a.canonical.y,y=0;for(let v=0;v<s.canonical.z-a.canonical.z&&!r.leaves[y];v++){h*=2,p*=2;const b=2*Math.floor(p)+Math.floor(h);y=r.childOffsets[y]+b,h%=1,p%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},n.ErrorEvent=rn,n.EvaluationParameters=C,n.Event=Wn,n.Evented=io,n.FillExtrusionBucket=Sd,n.Frustum=Qm,n.FrustumCorners=Km,n.GLOBE_RADIUS=In,n.GLOBE_SCALE_MATCH_LATITUDE=45,n.GLOBE_ZOOM_THRESHOLD_MAX=Sg,n.GLOBE_ZOOM_THRESHOLD_MIN=Jm,n.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,e){const r=new at,a=new Pt,l=[],h=s+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),v=(b,T,k)=>{let M=b===h-1?b-2:b===0?b:b-1;return M+=k?24575:0,[M,T]};for(let b=0;b<h;++b)r.emplaceBack(...v(b,0,!0));for(let b=0;b<p;++b)for(let T=0;T<h;++T)r.emplaceBack(...v(T,b,(T===0||T===h-1)&&!0));for(let b=0;b<e.length;++b){const T=e[b];for(let k=0;k<h;++k)r.emplaceBack(...v(k,T,!0))}for(let b=0;b<e.length;++b){const T=a.length,k=e[b]+1+2,M=new Pt;for(let B=0;B<k-1;B++){const H=B===k-2,re=H?h*(y-e.length+b-B):h;for(let pe=0;pe<h-1;pe++){const ie=B*h+pe;B===0||H||pe===0||pe===h-2?(M.emplaceBack(ie+1,ie,ie+re),M.emplaceBack(ie+re,ie+re+1,ie+1)):(a.emplaceBack(ie+1,ie,ie+re),a.emplaceBack(ie+re,ie+re+1,ie+1))}}const L=ar.simpleSegment(0,T,r.length,a.length-T);for(let B=0;B<M.uint16.length;B+=3)a.emplaceBack(M.uint16[B],M.uint16[B+1],M.uint16[B+2]);const R=ar.simpleSegment(0,T,r.length,a.length-T);l.push({withoutSkirts:L,withSkirts:R})}return{vertices:r,indices:a,segments:l}}_createGrid(s){const e=this._fillGridMeshWithLods(Ro,fd);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,pd.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new Pt;for(let l=0;l<=Ro;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const r=new Ns,a=new Ns;this._poleSegments=[];for(let l=0,h=0;l<Jm;l++){const p=360/(1<<l);r.emplaceBack(0,-In,0,.5,0),a.emplaceBack(0,-In,0,.5,1);for(let y=0;y<=Ro;y++){const v=y/Ro,b=us(0,p,v),[T,k,M]=Il(ib,nb,b,In);r.emplaceBack(T,k,M,v,0),a.emplaceBack(T,k,M,v,1)}this._poleSegments.push(ar.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(r,jg,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(a,jg,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,e){if(!this._wireframeSegments){const r=new Er,a=Ro,l=a+1+2,h=1;this._wireframeSegments=[];for(let p=0,y=0;p<fd.length;p++){const v=fd[p];for(let T=h;T<v+h;T++)for(let k=h;k<a+h;k++){const M=T*l+k;r.emplaceBack(M,M+1),r.emplaceBack(M,M+l),r.emplaceBack(M,M+l+1)}const b=v*a*3;this._wireframeSegments.push(ar.simpleSegment(0,y,(v+1)*l,b)),y+=b}this._wireframeIndexBuffer=s.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},n.GlyphManager=Gl,n.ImagePosition=Sp,n.KDBush=Vp,n.LivePerformanceUtils=ym,n.LngLat=Ts,n.LngLatBounds=za,n.LocalGlyphMode=Cp,n.MAX_MERCATOR_LATITUDE=Gr,n.MercatorCoordinate=Rl,n.ONE_EM=Rr,n.OverscaledTileID=ii,n.PerformanceMarkers=ga,n.Point=Ee,n.Properties=le,n.RGBAImage=Si,n.Ray=Xm,n.RequestManager=class{constructor(s,e,r){this._transformRequestFn=s,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const s=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",te,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,e){return this._transformRequestFn&&this._transformRequestFn(s,e)||{url:s}}normalizeStyleURL(s,e){if(!Te(s))return s;const r=_t(s);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(s,e){if(!Te(s))return s;const r=_t(s);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(s,e,r,a){if(!Te(s))return s;const l=_t(s);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),r&&l.params.push(`language=${r}`),a&&l.params.push(`worldview=${a}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(s,e,r,a){const l=_t(s);return Te(s)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=`${e}${r}`,ut(l))}normalizeTileURL(s,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Te(s))return s;const a=_t(s);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${W.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${U.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${U.TILE_URL_VERSION}${a.path}`);const l=this._customAccessToken||function(h){for(const p of h){const y=p.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||U.ACCESS_TOKEN;return U.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,l)}canonicalizeTileURL(s,e){const r=_t(s);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return s;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${U.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${U.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter(h=>!h.match(/^access_token=/))),l.length&&(a+=`?${l.join("&")}`),a}canonicalizeTileset(s,e){const r=!!e&&Te(e),a=[];for(const l of s.tiles||[])Re(l)?a.push(this.canonicalizeTileURL(l,r)):a.push(l);return a}_makeAPIURL(s,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=_t(U.API_URL);if(s.protocol=a.protocol,s.authority=a.authority,s.protocol==="http"){const l=s.params.indexOf("secure");l>=0&&s.params.splice(l,1)}if(a.path!=="/"&&(s.path=`${a.path}${s.path}`),!U.REQUIRE_ACCESS_TOKEN)return ut(s);if(e=e||U.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return s.params=s.params.filter(l=>l.indexOf("access_token")===-1),s.params.push(`access_token=${e||""}`),ut(s)}},n.ResourceType=Dr,n.SegmentVector=ar,n.SourceCache=Vo,n.StencilMode=Op,n.StructArrayLayout1ui2=ji,n.StructArrayLayout2f1f2i16=Ot,n.StructArrayLayout2i4=at,n.StructArrayLayout2ui4=Er,n.StructArrayLayout3f12=ts,n.StructArrayLayout3ui6=Pt,n.StructArrayLayout4i8=Qe,n.StructArrayLayout5f20=Ns,n.Texture=Rd,n.Tile=Rp,n.Transitionable=O,n.Uniform1f=Ku,n.Uniform1i=class extends ia{constructor(s){super(s),this.current=0}set(s,e,r){this.fetchUniformLocation(s,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},n.Uniform2f=class extends ia{constructor(s){super(s),this.current=[0,0]}set(s,e,r){this.fetchUniformLocation(s,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},n.Uniform3f=class extends ia{constructor(s){super(s),this.current=[0,0,0]}set(s,e,r){this.fetchUniformLocation(s,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},n.Uniform4f=ag,n.UniformColor=og,n.UniformMatrix2f=class extends ia{constructor(s){super(s),this.current=Vv}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let a=0;a<4;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},n.UniformMatrix3f=class extends ia{constructor(s){super(s),this.current=Uv}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.UniformMatrix4f=class extends ia{constructor(s){super(s),this.current=Bv}set(s,e,r){if(this.fetchUniformLocation(s,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},n.UnwrappedTileID=mx,n.ValidationError=Tt,n.VectorTileFeature=uh,n.VectorTileWorkerSource=class extends io{constructor(s,e,r,a,l){super(),this.actor=s,this.layerIndex=e,this.availableImages=r,this.loadVectorData=l||jy,this.loading={},this.loaded={},this.deduped=new wy(s.scheduler),this.isSpriteLoaded=a,this.scheduler=s.scheduler}loadTile(s,e){const r=s.uid,a=s&&s.request,l=a&&a.collectResourceTiming,h=this.loading[r]=new u1(s);h.abort=this.loadVectorData(s,(p,y)=>{const v=!this.loading[r];if(delete this.loading[r],v||p||!y)return h.status="done",v||(this.loaded[r]=h),e(p);const b=y.rawData,T={};y.expires&&(T.expires=y.expires),y.cacheControl&&(T.cacheControl=y.cacheControl),h.vectorTile=y.vectorTile||new vp(new xh(b));const k=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,L)=>{if(M||!L)return e(M);const R={};if(l){const B=uc(a);B.length>0&&(R.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,Ut({rawTileData:b.slice(0)},L,T,R))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[r]=h})}reloadTile(s,e){const r=this.loaded,a=s.uid,l=this;if(r&&r[a]){const h=r[a];h.showCollisionBoxes=s.showCollisionBoxes,h.enableTerrain=!!s.enableTerrain,h.projection=s.projection,h.tileTransform=Uo(s.tileID.canonical,s.projection);const p=(y,v)=>{const b=h.reloadCallback;b&&(delete h.reloadCallback,h.parse(h.vectorTile,l.layerIndex,this.availableImages,l.actor,b)),e(y,v)};h.status==="parsing"?h.reloadCallback=p:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(s,e){const r=s.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(s,e){const r=this.loaded,a=s.uid;r&&r[a]&&delete r[a],e()}},n.WritingMode=zi,n.ZoomDependentExpression=jo,n.add=aa,n.addDynamicAttributes=Eh,n.adjoint=function(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=e[4],y=e[5],v=e[6],b=e[7],T=e[8];return s[0]=p*T-y*b,s[1]=l*b-a*T,s[2]=a*y-l*p,s[3]=y*v-h*T,s[4]=r*T-l*v,s[5]=l*h-r*y,s[6]=h*b-p*v,s[7]=a*v-r*b,s[8]=r*p-a*h,s},n.asyncAll=_s,n.bezier=ft,n.bindAll=_r,n.boundsAttributes=ny,n.bufferConvexPolygon=function(s,e){const r=[];for(let a=0;a<s.length;a++){const l=ns(a-1,-1,s.length-1),h=ns(a+1,-1,s.length-1),p=s[a],y=s[h],v=s[l].sub(p).unit(),b=y.sub(p).unit(),T=b.angleWithSep(v.x,v.y),k=v.add(b).unit().mult(-1*e/Math.sin(T/2));r.push(p.add(k))}return r},n.cacheEntryPossiblyAdded=function(s){Wr++,Wr>Jt&&(s.getActor().send("enforceCacheSizeLimit",xt),Wr=0)},n.calculateGlobeLabelMatrix=function(s,e){const{x:r,y:a}=s.point,l=Ag(r,a,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Io(l,l,tp(Dn(e)))},n.calculateGlobeMatrix=function(s){const{x:e,y:r}=s.point,{lng:a,lat:l}=s._center;return Ag(e,r,s.worldSize,a,l)},n.calculateGlobeMercatorMatrix=function(s){const e=s.pixelsPerMeter,r=e/yn(1,s.center.lat),a=gn(new Float64Array(16));return ld(a,a,[s.point.x,s.point.y,0]),Do(a,a,[r,r,e]),Float32Array.from(a)},n.circumferenceAtLatitude=rp,n.clamp=ht,n.clearTileCache=function(s){if(!sr())return;const e=P.caches.delete(De);s&&e.catch(s).then(()=>s())},n.clipLine=Ux,n.clone=function(s){var e=new Ni(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},n.clone$1=vr,n.collisionCircleLayout=cw,n.config=U,n.conjugate=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},n.create=function(){var s=new Ni(16);return Ni!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},n.create$1=dg,n.createExpression=Aa,n.createLayout=ke,n.createStyleLayer=function(s){return s.type==="custom"?new e1(s):new s1[s.type](s)},n.cross=Hm,n.degToRad=Pe,n.distance=function(s,e){return Math.hypot(e[0]-s[0],e[1]-s[1],e[2]-s[2])},n.div=function(s,e,r){return s[0]=e[0]/r[0],s[1]=e[1]/r[1],s[2]=e[2]/r[2],s},n.dot=Zi,n.earthRadius=yd,n.ease=Mt,n.easeCubicInOut=Nt,n.ecefToLatLng=function([s,e,r]){const a=Math.hypot(s,e,r),l=Math.atan2(s,r),h=.5*Math.PI-Math.acos(-e/a);return new Ts(it(l),it(h))},n.emitValidationErrors=$u,n.endsWith=Jr,n.enforceCacheSizeLimit=function(s){Ls(),qt&&qt.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-s;a++)e.delete(r[a])})})},n.evaluateSizeForFeature=fh,n.evaluateSizeForZoom=Ul,n.evaluateVariableOffset=Zx,n.evented=g,n.exactEquals=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},n.exactEquals$1=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]},n.exported=sn,n.exported$1=W,n.extend=Ut,n.extend$1=nn,n.fillExtrusionHeightLift=dx,n.filterObject=gi,n.fromMat4=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},n.fromQuat=function(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=r+r,y=a+a,v=l+l,b=r*p,T=a*p,k=a*y,M=l*p,L=l*y,R=l*v,B=h*p,H=h*y,re=h*v;return s[0]=1-k-R,s[1]=T+re,s[2]=M-H,s[3]=0,s[4]=T-re,s[5]=1-b-R,s[6]=L+B,s[7]=0,s[8]=M+H,s[9]=L-B,s[10]=1-b-k,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},n.fromRotation=function(s,e){var r=Math.sin(e),a=Math.cos(e);return s[0]=a,s[1]=r,s[2]=0,s[3]=-r,s[4]=a,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},n.fromScaling=hg,n.furthestTileCorner=function(s){const e=Math.round((s+45+360)%360/90)%4;return ct[e]},n.getAABBPointSquareDist=function(s,e,r){let a=0;for(let l=0;l<2;++l){const h=r?r[l]:0;s[l]>h&&(a+=(s[l]-h)*(s[l]-h)),e[l]<h&&(a+=(h-e[l])*(h-e[l]))}return a},n.getAnchorAlignment=Ep,n.getAnchorJustification=Ap,n.getBounds=function(s){let e=1/0,r=1/0,a=-1/0,l=-1/0;for(const h of s)e=Math.min(e,h.x),r=Math.min(r,h.y),a=Math.max(a,h.x),l=Math.max(l,h.y);return{min:new Ee(e,r),max:new Ee(a,l)}},n.getColumn=wt,n.getDefaultExportFromCjs=Ne,n.getGridMatrix=function(s,e,r,a){const l=e.getNorth(),h=e.getSouth(),p=e.getWest(),y=e.getEast(),v=1<<s.z,b=y-p,T=l-h,k=b/Ro,M=-T/fd[r],L=[0,k,0,M,0,0,l,p,0];if(s.z>0){const R=180/a;ug(L,L,[R/b+1,0,0,0,R/T+1,0,-.5*R/k,.5*R/M,1])}return L[2]=v,L[5]=s.x,L[8]=s.y,L},n.getImage=ce,n.getJSON=function(s,e){return en(Ut(s,{type:"json"}),e)},n.getLatitudinalLod=function(s){const e=Gr-5;s=ht(s,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Pe(s))),3);return Math.round(r*(fd.length-1))},n.getMapSessionAPI=Nr,n.getPerformanceMeasurement=uc,n.getProjection=ey,n.getRTLTextPluginStatus=_,n.getReferrer=Oi,n.getTilePoint=function(s,{x:e,y:r},a=0){return new Ee(((e-a)*s.scale-s.x)*zt,(r*s.scale-s.y)*zt)},n.getTileVec3=function(s,e,r=0){return Pl(((e.x-r)*s.scale-s.x)*zt,(e.y*s.scale-s.y)*zt,Dg(e.z,e.y))},n.getVideo=function(s,e){const r=P.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<s.length;a++){const l=P.document.createElement("source");el(s[a])||(r.crossOrigin="Anonymous"),l.src=s[a],r.appendChild(l)}return{cancel:()=>{}}},n.globeCenterToScreenPoint=function(s){const e=[0,0,0],r=gn(new Float64Array(16));return Io(r,s.pixelMatrix,s.globeMatrix),Ys(e,e,r),new Ee(e[0],e[1])},n.globeDenormalizeECEF=tp,n.globeECEFOrigin=function(s,e){const r=[0,0,0];return Ys(r,r,xd(Dn(e.canonical))),Ys(r,r,s),r},n.globeMetersToEcef=Yu,n.globeNormalizeECEF=xd,n.globePixelsToTileUnits=function(s,e){return zt/(512*Math.pow(2,s))*th(Dn(e))},n.globePoleMatrixForTile=function(s,e,r){const a=gn(new Float64Array(16)),l=(e/(1<<s)-.5)*Math.PI*2;return Ju(a,r.globeMatrix,l),Float32Array.from(a)},n.globeTileBounds=Dn,n.globeTiltAtLngLat=Mg,n.globeToMercatorTransition=Ll,n.globeUseCustomAntiAliasing=function(s,e,r){const a=Ll(r.zoom),l=s.style.map._antialias,h=!!e.extStandardDerivatives,p=e.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return a===0&&!l&&!p&&h},n.identity=gn,n.identity$1=vg,n.invert=$m,n.isFullscreen=function(){return!!P.document.fullscreenElement||!!P.document.webkitFullscreenElement},n.isLngLatBehindGlobe=sp,n.isMapAuthenticated=function(s){return Hr.has(s)},n.isMapboxURL=Te,n.isSafariWithAntialiasingBug=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!et(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.latFromMercatorY=$r,n.latLngToECEF=Dl,n.len=Qv,n.length=cd,n.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},n.lngFromMercatorX=Ri,n.loadVectorTile=jy,n.makeRequest=en,n.mapValue=function(s,e,r,a,l){return ht((s-e)/(r-e)*(l-a)+a,a,l)},n.mercatorScale=Lg,n.mercatorXfromLng=Ln,n.mercatorYfromLat=Rn,n.mercatorZfromAltitude=yn,n.mul=Xv,n.mul$1=Kv,n.multiply=Io,n.multiply$1=ug,n.multiply$2=fg,n.nextPowerOfTwo=gr,n.normalize=si,n.normalize$1=Jv,n.normalize$2=yg,n.number=us,n.ortho=function(s,e,r,a,l,h,p){var y=1/(e-r),v=1/(a-l),b=1/(h-p);return s[0]=-2*y,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*v,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*b,s[11]=0,s[12]=(e+r)*y,s[13]=(l+a)*v,s[14]=(p+h)*b,s[15]=1,s},n.pbf=vx,n.perspective=function(s,e,r,a,l){var h,p=1/Math.tan(e/2);return s[0]=p/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,l!=null&&l!==1/0?(s[10]=(l+a)*(h=1/(a-l)),s[14]=2*l*a*h):(s[10]=-1,s[14]=-2*a),s},n.pick=function(s,e){const r={};for(let a=0;a<e.length;a++){const l=e[a];l in s&&(r[l]=s[l])}return r},n.plugin=S,n.pointGeometry=fe,n.polesInViewport=function(s){const e=gn(new Float64Array(16));Io(e,s.pixelMatrix,s.globeMatrix);const r=[0,Wi,0],a=[0,Hi,0];return Ys(r,r,e),Ys(a,a,e),[r[0]>0&&r[0]<=s.width&&r[1]>0&&r[1]<=s.height&&!sp(s,new Ts(s.center.lat,90)),a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!sp(s,new Ts(s.center.lat,-90))]},n.polygonContainsPoint=Fo,n.polygonIntersectsBox=Vg,n.polygonIntersectsPolygon=Og,n.polygonizeBounds=function(s,e,r=0,a=!0){const l=new Ee(r,r),h=s.sub(l),p=e.add(l),y=[h,new Ee(p.x,h.y),p,new Ee(h.x,p.y)];return a&&y.push(h.clone()),y},n.posAttributes=pd,n.postMapLoadEvent=rr,n.postPerformanceEvent=xr,n.postTurnstileEvent=os,n.potpack=Np,n.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},n.radToDeg=it,n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.registerForPluginStateChange=function(s){return s({pluginStatus:d,pluginURL:i}),g.on("pluginStateChange",s),s},n.removeAuthState=function(s){Hr.delete(s)},n.renderColorRamp=up,n.resample=Rg,n.rotateX=Gm,n.rotateX$1=bg,n.rotateY=Ju,n.rotateY$1=wg,n.rotateZ=function(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],y=e[2],v=e[3],b=e[4],T=e[5],k=e[6],M=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=h*l+b*a,s[1]=p*l+T*a,s[2]=y*l+k*a,s[3]=v*l+M*a,s[4]=b*l-h*a,s[5]=T*l-p*a,s[6]=k*l-y*a,s[7]=M*l-v*a,s},n.rotateZ$1=function(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),v=Math.cos(r);return s[0]=a*v+l*y,s[1]=l*v-a*y,s[2]=h*v+p*y,s[3]=p*v-h*y,s},n.scale=Do,n.scale$1=xg,n.scale$2=Li,n.scaleAndAdd=hd,n.set=function(s,e,r,a){return s[0]=e,s[1]=r,s[2]=a,s},n.setCacheLimits=function(s,e){xt=s,Jt=e},n.setColumn=function(s,e,r){s[4*e+0]=r[0],s[4*e+1]=r[1],s[4*e+2]=r[2],s[4*e+3]=r[3]},n.setRTLTextPlugin=function(s,e,r=!1){if(d===rd||d===id||d===nd)throw new Error("setRTLTextPlugin cannot be called multiple times.");i=sn.resolveURL(s),d=rd,Da=e,m(),r||j()},n.smoothstep=Os,n.spec=We,n.squaredLength=function(s){var e=s[0],r=s[1],a=s[2];return e*e+r*r+a*a},n.storeAuthState=function(s,e){e?Hr.add(s):Hr.delete(s)},n.sub=xn,n.subtract=Wm,n.symbolSize=dw,n.tileAABB=function(s,e,r,a,l,h,p,y,v){if(v.name==="globe")return rb(s,e,new mh(r,a,l));const b=Uo({z:r,x:a,y:l},v);return new ri([(h+b.x/b.scale)*e,e*(b.y/b.scale),p],[(h+b.x2/b.scale)*e,e*(b.y2/b.scale),y])},n.tileCornersToBounds=eh,n.tileTransform=Uo,n.transformMat3=function(s,e,r){var a=e[0],l=e[1],h=e[2];return s[0]=a*r[0]+l*r[3]+h*r[6],s[1]=a*r[1]+l*r[4]+h*r[7],s[2]=a*r[2]+l*r[5]+h*r[8],s},n.transformMat4=Ys,n.transformMat4$1=Lo,n.transformQuat=gg,n.transitionTileAABBinECEF=Eg,n.translate=ld,n.transpose=function(s,e){if(s===e){var r=e[1],a=e[2],l=e[5];s[1]=e[3],s[2]=e[6],s[3]=r,s[5]=e[7],s[6]=a,s[7]=l}else s[0]=e[0],s[1]=e[3],s[2]=e[6],s[3]=e[1],s[4]=e[4],s[5]=e[7],s[6]=e[2],s[7]=e[5],s[8]=e[8];return s},n.triggerPluginCompletionEvent=o,n.uniqueId=Fr,n.updateGlobeVertexNormal=function(s,e,r,a,l){const h=5*e+2;s.float32[h+0]=r,s.float32[h+1]=a,s.float32[h+2]=l},n.validateCustomStyleLayer=function(s){const e=[],r=s.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateFilter=s=>wi(Co(s)),n.validateFog=s=>wi(Uu(s)),n.validateLayer=s=>wi(zu(s)),n.validateLight=s=>wi(Bu(s)),n.validateSource=s=>wi(Fu(s)),n.validateStyle=qu,n.validateTerrain=s=>wi(Jc(s)),n.values=pr,n.vectorTile=dh,n.version=z,n.warnOnce=As,n.window=P,n.wrap=ns}),E(["./shared"],function(n){function P(me){if(typeof me=="number"||typeof me=="boolean"||typeof me=="string"||me==null)return JSON.stringify(me);if(Array.isArray(me)){let $="[";for(const ce of me)$+=`${P(ce)},`;return`${$}]`}let V="{";for(const $ of Object.keys(me).sort())V+=`${$}:${P(me[$])},`;return`${V}}`}function z(me){let V="";for(const $ of n.refProperties)V+=`/${P(me[$])}`;return V}class q{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(const ye of V)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=n.createStyleLayer(ye)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of $)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ce=function(ye,Te){const Re={};for(let Se=0;Se<ye.length;Se++){const $e=Te&&Te[ye[Se].id]||z(ye[Se]);Te&&(Te[ye[Se].id]=$e);let gt=Re[$e];gt||(gt=Re[$e]=[]),gt.push(ye[Se])}const Le=[];for(const Se in Re)Le.push(Re[Se]);return Le}(n.values(this._layerConfigs),this.keyCache);for(const ye of ce){const Te=ye.map(_t=>this._layers[_t.id]),Re=Te[0];if(Re.visibility==="none")continue;const Le=Re.source||"";let Se=this.familiesBySource[Le];Se||(Se=this.familiesBySource[Le]={});const $e=Re.sourceLayer||"_geojsonTileLayer";let gt=Se[$e];gt||(gt=Se[$e]=[]),gt.push(Te)}}}class U{loadTile(V,$){const{uid:ce,encoding:ye,rawImageData:Te,padding:Re,buildQuadTree:Le}=V,Se=n.window.ImageBitmap&&Te instanceof n.window.ImageBitmap?this.getImageData(Te,Re):Te;$(null,new n.DEMData(ce,Se,ye,Re<1,Le))}getImageData(V,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const ce=this.offscreenCanvasContext.getImageData(-$,-$,V.width+2*$,V.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}function W(me,V){if(me.length!==0){X(me[0],V);for(var $=1;$<me.length;$++)X(me[$],!V)}}function X(me,V){for(var $=0,ce=0,ye=0,Te=me.length,Re=Te-1;ye<Te;Re=ye++){var Le=(me[ye][0]-me[Re][0])*(me[Re][1]+me[ye][1]),Se=$+Le;ce+=Math.abs($)>=Math.abs(Le)?$-Se+Le:Le-Se+$,$=Se}$+ce>=0!=!!V&&me.reverse()}var Z=n.getDefaultExportFromCjs(function me(V,$){var ce,ye=V&&V.type;if(ye==="FeatureCollection")for(ce=0;ce<V.features.length;ce++)me(V.features[ce],$);else if(ye==="GeometryCollection")for(ce=0;ce<V.geometries.length;ce++)me(V.geometries[ce],$);else if(ye==="Feature")me(V.geometry,$);else if(ye==="Polygon")W(V.coordinates,$);else if(ye==="MultiPolygon")for(ce=0;ce<V.coordinates.length;ce++)W(V.coordinates[ce],$);return V});const J=n.VectorTileFeature.prototype.toGeoJSON;var de={exports:{}},ne=n.pointGeometry,te=n.vectorTile.VectorTileFeature,Ne=he;function he(me,V){this.options=V||{},this.features=me,this.length=me.length}function Ce(me,V){this.id=typeof me.id=="number"?me.id:void 0,this.type=me.type,this.rawGeometry=me.type===1?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=V||4096}he.prototype.feature=function(me){return new Ce(this.features[me],this.options.extent)},Ce.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var V=0;V<me.length;V++){for(var $=me[V],ce=[],ye=0;ye<$.length;ye++)ce.push(new ne($[ye][0],$[ye][1]));this.geometry.push(ce)}return this.geometry},Ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,V=1/0,$=-1/0,ce=1/0,ye=-1/0,Te=0;Te<me.length;Te++)for(var Re=me[Te],Le=0;Le<Re.length;Le++){var Se=Re[Le];V=Math.min(V,Se.x),$=Math.max($,Se.x),ce=Math.min(ce,Se.y),ye=Math.max(ye,Se.y)}return[V,ce,$,ye]},Ce.prototype.toGeoJSON=te.prototype.toGeoJSON;var Ae=n.pbf,fe=Ne;function Ie(me){var V=new Ae;return function($,ce){for(var ye in $.layers)ce.writeMessage(3,Ee,$.layers[ye])}(me,V),V.finish()}function Ee(me,V){var $;V.writeVarintField(15,me.version||1),V.writeStringField(1,me.name||""),V.writeVarintField(5,me.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<me.length;$++)ce.feature=me.feature($),V.writeMessage(2,tt,ce);var ye=ce.keys;for($=0;$<ye.length;$++)V.writeStringField(3,ye[$]);var Te=ce.values;for($=0;$<Te.length;$++)V.writeMessage(4,Nt,Te[$])}function tt(me,V){var $=me.feature;$.id!==void 0&&V.writeVarintField(1,$.id),V.writeMessage(2,je,me),V.writeVarintField(3,$.type),V.writeMessage(4,ct,$)}function je(me,V){var $=me.feature,ce=me.keys,ye=me.values,Te=me.keycache,Re=me.valuecache;for(var Le in $.properties){var Se=$.properties[Le],$e=Te[Le];if(Se!==null){$e===void 0&&(ce.push(Le),Te[Le]=$e=ce.length-1),V.writeVarint($e);var gt=typeof Se;gt!=="string"&&gt!=="boolean"&&gt!=="number"&&(Se=JSON.stringify(Se));var _t=gt+":"+Se,ut=Re[_t];ut===void 0&&(ye.push(Se),Re[_t]=ut=ye.length-1),V.writeVarint(ut)}}}function Pe(me,V){return(V<<3)+(7&me)}function it(me){return me<<1^me>>31}function ct(me,V){for(var $=me.loadGeometry(),ce=me.type,ye=0,Te=0,Re=$.length,Le=0;Le<Re;Le++){var Se=$[Le],$e=1;ce===1&&($e=Se.length),V.writeVarint(Pe(1,$e));for(var gt=ce===3?Se.length-1:Se.length,_t=0;_t<gt;_t++){_t===1&&ce!==1&&V.writeVarint(Pe(2,gt-1));var ut=Se[_t].x-ye,Wt=Se[_t].y-Te;V.writeVarint(it(ut)),V.writeVarint(it(Wt)),ye+=ut,Te+=Wt}ce===3&&V.writeVarint(Pe(7,1))}}function Nt(me,V){var $=typeof me;$==="string"?V.writeStringField(1,me):$==="boolean"?V.writeBooleanField(7,me):$==="number"&&(me%1!=0?V.writeDoubleField(3,me):me<0?V.writeSVarintField(6,me):V.writeVarintField(5,me))}de.exports=Ie,de.exports.fromVectorTileJs=Ie,de.exports.fromGeojsonVt=function(me,V){V=V||{};var $={};for(var ce in me)$[ce]=new fe(me[ce].features,V),$[ce].name=ce,$[ce].version=V.version,$[ce].extent=V.extent;return Ie({layers:$})},de.exports.GeoJSONWrapper=fe;var ft=n.getDefaultExportFromCjs(de.exports);const Mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},ht=Math.fround||(Os=new Float32Array(1),me=>(Os[0]=+me,Os[0]));var Os;const ns=3,_s=5,pr=6;class Ut{constructor(V){this.options=Object.assign(Object.create(Mt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:$,minZoom:ce,maxZoom:ye}=this.options;$&&console.time("total time");const Te=`prepare ${V.length} points`;$&&console.time(Te),this.points=V;const Re=[];for(let Se=0;Se<V.length;Se++){const $e=V[Se];if(!$e.geometry)continue;const[gt,_t]=$e.geometry.coordinates,ut=ht(jr(gt)),Wt=ht(gr(_t));Re.push(ut,Wt,1/0,Se,-1,1),this.options.reduce&&Re.push(0)}let Le=this.trees[ye+1]=this._createTree(Re);$&&console.timeEnd(Te);for(let Se=ye;Se>=ce;Se--){const $e=+Date.now();Le=this.trees[Se]=this._createTree(this._cluster(Le,Se)),$&&console.log("z%d: %d clusters in %dms",Se,Le.numItems,+Date.now()-$e)}return $&&console.timeEnd("total time"),this}getClusters(V,$){let ce=((V[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,V[1]));let Te=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ce=-180,Te=180;else if(ce>Te){const _t=this.getClusters([ce,ye,180,Re],$),ut=this.getClusters([-180,ye,Te,Re],$);return _t.concat(ut)}const Le=this.trees[this._limitZoom($)],Se=Le.range(jr(ce),gr(Re),jr(Te),gr(ye)),$e=Le.data,gt=[];for(const _t of Se){const ut=this.stride*_t;gt.push($e[ut+_s]>1?fr($e,ut,this.clusterProps):this.points[$e[ut+ns]])}return gt}getChildren(V){const $=this._getOriginId(V),ce=this._getOriginZoom(V),ye="No cluster with the specified id.",Te=this.trees[ce];if(!Te)throw new Error(ye);const Re=Te.data;if($*this.stride>=Re.length)throw new Error(ye);const Le=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Se=Te.within(Re[$*this.stride],Re[$*this.stride+1],Le),$e=[];for(const gt of Se){const _t=gt*this.stride;Re[_t+4]===V&&$e.push(Re[_t+_s]>1?fr(Re,_t,this.clusterProps):this.points[Re[_t+ns]])}if($e.length===0)throw new Error(ye);return $e}getLeaves(V,$,ce){const ye=[];return this._appendLeaves(ye,V,$=$||10,ce=ce||0,0),ye}getTile(V,$,ce){const ye=this.trees[this._limitZoom(V)],Te=Math.pow(2,V),{extent:Re,radius:Le}=this.options,Se=Le/Re,$e=(ce-Se)/Te,gt=(ce+1+Se)/Te,_t={features:[]};return this._addTileFeatures(ye.range(($-Se)/Te,$e,($+1+Se)/Te,gt),ye.data,$,ce,Te,_t),$===0&&this._addTileFeatures(ye.range(1-Se/Te,$e,1,gt),ye.data,Te,ce,Te,_t),$===Te-1&&this._addTileFeatures(ye.range(0,$e,Se/Te,gt),ye.data,-1,ce,Te,_t),_t.features.length?_t:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){const ce=this.getChildren(V);if($++,ce.length!==1)break;V=ce[0].properties.cluster_id}return $}_appendLeaves(V,$,ce,ye,Te){const Re=this.getChildren($);for(const Le of Re){const Se=Le.properties;if(Se&&Se.cluster?Te+Se.point_count<=ye?Te+=Se.point_count:Te=this._appendLeaves(V,Se.cluster_id,ce,ye,Te):Te<ye?Te++:V.push(Le),V.length===ce)break}return Te}_createTree(V){const $=new n.KDBush(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<V.length;ce+=this.stride)$.add(V[ce],V[ce+1]);return $.finish(),$.data=V,$}_addTileFeatures(V,$,ce,ye,Te,Re){for(const Le of V){const Se=Le*this.stride,$e=$[Se+_s]>1;let gt,_t,ut;if($e)gt=Fr($,Se,this.clusterProps),_t=$[Se],ut=$[Se+1];else{const Ht=this.points[$[Se+ns]];gt=Ht.properties;const[es,os]=Ht.geometry.coordinates;_t=jr(es),ut=gr(os)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(_t*Te-ce)),Math.round(this.options.extent*(ut*Te-ye))]],tags:gt};let Yt;Yt=$e||this.options.generateId?$[Se+ns]:this.points[$[Se+ns]].id,Yt!==void 0&&(Wt.id=Yt),Re.features.push(Wt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,$){const{radius:ce,extent:ye,reduce:Te,minPoints:Re}=this.options,Le=ce/(ye*Math.pow(2,$)),Se=V.data,$e=[],gt=this.stride;for(let _t=0;_t<Se.length;_t+=gt){if(Se[_t+2]<=$)continue;Se[_t+2]=$;const ut=Se[_t],Wt=Se[_t+1],Yt=V.within(Se[_t],Se[_t+1],Le),Ht=Se[_t+_s];let es=Ht;for(const os of Yt){const Vs=os*gt;Se[Vs+2]>$&&(es+=Se[Vs+_s])}if(es>Ht&&es>=Re){let os,Vs=ut*Ht,rr=Wt*Ht,Ur=-1;const xr=((_t/gt|0)<<5)+($+1)+this.points.length;for(const Fi of Yt){const Nr=Fi*gt;if(Se[Nr+2]<=$)continue;Se[Nr+2]=$;const Hr=Se[Nr+_s];Vs+=Se[Nr]*Hr,rr+=Se[Nr+1]*Hr,Se[Nr+4]=xr,Te&&(os||(os=this._map(Se,_t,!0),Ur=this.clusterProps.length,this.clusterProps.push(os)),Te(os,this._map(Se,Nr)))}Se[_t+4]=xr,$e.push(Vs/es,rr/es,1/0,xr,-1,es),Te&&$e.push(Ur)}else{for(let os=0;os<gt;os++)$e.push(Se[_t+os]);if(es>1)for(const os of Yt){const Vs=os*gt;if(!(Se[Vs+2]<=$)){Se[Vs+2]=$;for(let rr=0;rr<gt;rr++)$e.push(Se[Vs+rr])}}}}return $e}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$,ce){if(V[$+_s]>1){const Re=this.clusterProps[V[$+pr]];return ce?Object.assign({},Re):Re}const ye=this.points[V[$+ns]].properties,Te=this.options.map(ye);return ce&&Te===ye?Object.assign({},Te):Te}}function fr(me,V,$){return{type:"Feature",id:me[V+ns],properties:Fr(me,V,$),geometry:{type:"Point",coordinates:[(ce=me[V],360*(ce-.5)),Br(me[V+1])]}};var ce}function Fr(me,V,$){const ce=me[V+_s],ye=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,Te=me[V+pr],Re=Te===-1?{}:Object.assign({},$[Te]);return Object.assign(Re,{cluster:!0,cluster_id:me[V+ns],point_count:ce,point_count_abbreviated:ye})}function jr(me){return me/360+.5}function gr(me){const V=Math.sin(me*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function Br(me){const V=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function _r(me,V,$,ce){for(var ye,Te=ce,Re=$-V>>1,Le=$-V,Se=me[V],$e=me[V+1],gt=me[$],_t=me[$+1],ut=V+3;ut<$;ut+=3){var Wt=Jr(me[ut],me[ut+1],Se,$e,gt,_t);if(Wt>Te)ye=ut,Te=Wt;else if(Wt===Te){var Yt=Math.abs(ut-Re);Yt<Le&&(ye=ut,Le=Yt)}}Te>ce&&(ye-V>3&&_r(me,V,ye,ce),me[ye+2]=Te,$-ye>3&&_r(me,ye,$,ce))}function Jr(me,V,$,ce,ye,Te){var Re=ye-$,Le=Te-ce;if(Re!==0||Le!==0){var Se=((me-$)*Re+(V-ce)*Le)/(Re*Re+Le*Le);Se>1?($=ye,ce=Te):Se>0&&($+=Re*Se,ce+=Le*Se)}return(Re=me-$)*Re+(Le=V-ce)*Le}function Qt(me,V,$,ce){var ye={id:me===void 0?null:me,type:V,geometry:$,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Te){var Re=Te.geometry,Le=Te.type;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")gi(Te,Re);else if(Le==="Polygon"||Le==="MultiLineString")for(var Se=0;Se<Re.length;Se++)gi(Te,Re[Se]);else if(Le==="MultiPolygon")for(Se=0;Se<Re.length;Se++)for(var $e=0;$e<Re[Se].length;$e++)gi(Te,Re[Se][$e])}(ye),ye}function gi(me,V){for(var $=0;$<V.length;$+=3)me.minX=Math.min(me.minX,V[$]),me.minY=Math.min(me.minY,V[$+1]),me.maxX=Math.max(me.maxX,V[$]),me.maxY=Math.max(me.maxY,V[$+1])}function vr(me,V,$,ce){if(V.geometry){var ye=V.geometry.coordinates,Te=V.geometry.type,Re=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),Le=[],Se=V.id;if($.promoteId?Se=V.properties[$.promoteId]:$.generateId&&(Se=ce||0),Te==="Point")Mi(ye,Le);else if(Te==="MultiPoint")for(var $e=0;$e<ye.length;$e++)Mi(ye[$e],Le);else if(Te==="LineString")As(ye,Le,Re,!1);else if(Te==="MultiLineString"){if($.lineMetrics){for($e=0;$e<ye.length;$e++)As(ye[$e],Le=[],Re,!1),me.push(Qt(Se,"LineString",Le,V.properties));return}Ir(ye,Le,Re,!1)}else if(Te==="Polygon")Ir(ye,Le,Re,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for($e=0;$e<V.geometry.geometries.length;$e++)vr(me,{id:Se,geometry:V.geometry.geometries[$e],properties:V.properties},$,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for($e=0;$e<ye.length;$e++){var gt=[];Ir(ye[$e],gt,Re,!0),Le.push(gt)}}me.push(Qt(Se,Te,Le,V.properties))}}function Mi(me,V){V.push(Zn(me[0])),V.push(Zr(me[1])),V.push(0)}function As(me,V,$,ce){for(var ye,Te,Re=0,Le=0;Le<me.length;Le++){var Se=Zn(me[Le][0]),$e=Zr(me[Le][1]);V.push(Se),V.push($e),V.push(0),Le>0&&(Re+=ce?(ye*$e-Se*Te)/2:Math.sqrt(Math.pow(Se-ye,2)+Math.pow($e-Te,2))),ye=Se,Te=$e}var gt=V.length-3;V[2]=1,_r(V,0,gt,$),V[gt+2]=1,V.size=Math.abs(Re),V.start=0,V.end=V.size}function Ir(me,V,$,ce){for(var ye=0;ye<me.length;ye++){var Te=[];As(me[ye],Te,$,ce),V.push(Te)}}function Zn(me){return me/360+.5}function Zr(me){var V=Math.sin(me*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function we(me,V,$,ce,ye,Te,Re,Le){if(ce/=V,Te>=($/=V)&&Re<ce)return me;if(Re<$||Te>=ce)return null;for(var Se=[],$e=0;$e<me.length;$e++){var gt=me[$e],_t=gt.geometry,ut=gt.type,Wt=ye===0?gt.minX:gt.minY,Yt=ye===0?gt.maxX:gt.maxY;if(Wt>=$&&Yt<ce)Se.push(gt);else if(!(Yt<$||Wt>=ce)){var Ht=[];if(ut==="Point"||ut==="MultiPoint")Ge(_t,Ht,$,ce,ye);else if(ut==="LineString")et(_t,Ht,$,ce,ye,!1,Le.lineMetrics);else if(ut==="MultiLineString")wt(_t,Ht,$,ce,ye,!1);else if(ut==="Polygon")wt(_t,Ht,$,ce,ye,!0);else if(ut==="MultiPolygon")for(var es=0;es<_t.length;es++){var os=[];wt(_t[es],os,$,ce,ye,!0),os.length&&Ht.push(os)}if(Ht.length){if(Le.lineMetrics&&ut==="LineString"){for(es=0;es<Ht.length;es++)Se.push(Qt(gt.id,ut,Ht[es],gt.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(Ht.length===1?(ut="LineString",Ht=Ht[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=Ht.length===3?"Point":"MultiPoint"),Se.push(Qt(gt.id,ut,Ht,gt.tags))}}}return Se.length?Se:null}function Ge(me,V,$,ce,ye){for(var Te=0;Te<me.length;Te+=3){var Re=me[Te+ye];Re>=$&&Re<=ce&&(V.push(me[Te]),V.push(me[Te+1]),V.push(me[Te+2]))}}function et(me,V,$,ce,ye,Te,Re){for(var Le,Se,$e=Ct(me),gt=ye===0?xt:Jt,_t=me.start,ut=0;ut<me.length-3;ut+=3){var Wt=me[ut],Yt=me[ut+1],Ht=me[ut+2],es=me[ut+3],os=me[ut+4],Vs=ye===0?Wt:Yt,rr=ye===0?es:os,Ur=!1;Re&&(Le=Math.sqrt(Math.pow(Wt-es,2)+Math.pow(Yt-os,2))),Vs<$?rr>$&&(Se=gt($e,Wt,Yt,es,os,$),Re&&($e.start=_t+Le*Se)):Vs>ce?rr<ce&&(Se=gt($e,Wt,Yt,es,os,ce),Re&&($e.start=_t+Le*Se)):De($e,Wt,Yt,Ht),rr<$&&Vs>=$&&(Se=gt($e,Wt,Yt,es,os,$),Ur=!0),rr>ce&&Vs<=ce&&(Se=gt($e,Wt,Yt,es,os,ce),Ur=!0),!Te&&Ur&&(Re&&($e.end=_t+Le*Se),V.push($e),$e=Ct(me)),Re&&(_t+=Le)}var xr=me.length-3;Wt=me[xr],Yt=me[xr+1],Ht=me[xr+2],(Vs=ye===0?Wt:Yt)>=$&&Vs<=ce&&De($e,Wt,Yt,Ht),xr=$e.length-3,Te&&xr>=3&&($e[xr]!==$e[0]||$e[xr+1]!==$e[1])&&De($e,$e[0],$e[1],$e[2]),$e.length&&V.push($e)}function Ct(me){var V=[];return V.size=me.size,V.start=me.start,V.end=me.end,V}function wt(me,V,$,ce,ye,Te){for(var Re=0;Re<me.length;Re++)et(me[Re],V,$,ce,ye,Te,!1)}function De(me,V,$,ce){me.push(V),me.push($),me.push(ce)}function xt(me,V,$,ce,ye,Te){var Re=(Te-V)/(ce-V);return me.push(Te),me.push($+(ye-$)*Re),me.push(1),Re}function Jt(me,V,$,ce,ye,Te){var Re=(Te-$)/(ye-$);return me.push(V+(ce-V)*Re),me.push(Te),me.push(1),Re}function qt(me,V){for(var $=[],ce=0;ce<me.length;ce++){var ye,Te=me[ce],Re=Te.type;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")ye=vs(Te.geometry,V);else if(Re==="MultiLineString"||Re==="Polygon"){ye=[];for(var Le=0;Le<Te.geometry.length;Le++)ye.push(vs(Te.geometry[Le],V))}else if(Re==="MultiPolygon")for(ye=[],Le=0;Le<Te.geometry.length;Le++){for(var Se=[],$e=0;$e<Te.geometry[Le].length;$e++)Se.push(vs(Te.geometry[Le][$e],V));ye.push(Se)}$.push(Qt(Te.id,Re,ye,Te.tags))}return $}function vs(me,V){var $=[];$.size=me.size,me.start!==void 0&&($.start=me.start,$.end=me.end);for(var ce=0;ce<me.length;ce+=3)$.push(me[ce]+V,me[ce+1],me[ce+2]);return $}function sr(me,V){if(me.transformed)return me;var $,ce,ye,Te=1<<me.z,Re=me.x,Le=me.y;for($=0;$<me.features.length;$++){var Se=me.features[$],$e=Se.geometry,gt=Se.type;if(Se.geometry=[],gt===1)for(ce=0;ce<$e.length;ce+=2)Se.geometry.push(Ls($e[ce],$e[ce+1],V,Te,Re,Le));else for(ce=0;ce<$e.length;ce++){var _t=[];for(ye=0;ye<$e[ce].length;ye+=2)_t.push(Ls($e[ce][ye],$e[ce][ye+1],V,Te,Re,Le));Se.geometry.push(_t)}}return me.transformed=!0,me}function Ls(me,V,$,ce,ye,Te){return[Math.round($*(me*ce-ye)),Math.round($*(V*ce-Te))]}function xi(me,V,$,ce,ye){for(var Te=V===ye.maxZoom?0:ye.tolerance/((1<<V)*ye.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:ce,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Le=0;Le<me.length;Le++){Re.numFeatures++,Wr(Re,me[Le],Te,ye);var Se=me[Le].minX,$e=me[Le].minY,gt=me[Le].maxX,_t=me[Le].maxY;Se<Re.minX&&(Re.minX=Se),$e<Re.minY&&(Re.minY=$e),gt>Re.maxX&&(Re.maxX=gt),_t>Re.maxY&&(Re.maxY=_t)}return Re}function Wr(me,V,$,ce){var ye=V.geometry,Te=V.type,Re=[];if(Te==="Point"||Te==="MultiPoint")for(var Le=0;Le<ye.length;Le+=3)Re.push(ye[Le]),Re.push(ye[Le+1]),me.numPoints++,me.numSimplified++;else if(Te==="LineString")Dr(Re,ye,me,$,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(Le=0;Le<ye.length;Le++)Dr(Re,ye[Le],me,$,Te==="Polygon",Le===0);else if(Te==="MultiPolygon")for(var Se=0;Se<ye.length;Se++){var $e=ye[Se];for(Le=0;Le<$e.length;Le++)Dr(Re,$e[Le],me,$,!0,Le===0)}if(Re.length){var gt=V.tags||null;if(Te==="LineString"&&ce.lineMetrics){for(var _t in gt={},V.tags)gt[_t]=V.tags[_t];gt.mapbox_clip_start=ye.start/ye.size,gt.mapbox_clip_end=ye.end/ye.size}var ut={geometry:Re,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:gt};V.id!==null&&(ut.id=V.id),me.features.push(ut)}}function Dr(me,V,$,ce,ye,Te){var Re=ce*ce;if(ce>0&&V.size<(ye?Re:ce))$.numPoints+=V.length/3;else{for(var Le=[],Se=0;Se<V.length;Se+=3)(ce===0||V[Se+2]>Re)&&($.numSimplified++,Le.push(V[Se]),Le.push(V[Se+1])),$.numPoints++;ye&&function($e,gt){for(var _t=0,ut=0,Wt=$e.length,Yt=Wt-2;ut<Wt;Yt=ut,ut+=2)_t+=($e[ut]-$e[Yt])*($e[ut+1]+$e[Yt+1]);if(_t>0===gt)for(ut=0,Wt=$e.length;ut<Wt/2;ut+=2){var Ht=$e[ut],es=$e[ut+1];$e[ut]=$e[Wt-2-ut],$e[ut+1]=$e[Wt-1-ut],$e[Wt-2-ut]=Ht,$e[Wt-1-ut]=es}}(Le,Te),me.push(Le)}}function yi(me,V){var $=(V=this.options=function(ye,Te){for(var Re in Te)ye[Re]=Te[Re];return ye}(Object.create(this.options),V)).debug;if($&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var ce=function(ye,Te){var Re=[];if(ye.type==="FeatureCollection")for(var Le=0;Le<ye.features.length;Le++)vr(Re,ye.features[Le],Te,Le);else vr(Re,ye.type==="Feature"?ye:{geometry:ye},Te);return Re}(me,V);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(ye,Te){var Re=Te.buffer/Te.extent,Le=ye,Se=we(ye,1,-1-Re,Re,0,-1,2,Te),$e=we(ye,1,1-Re,2+Re,0,-1,2,Te);return(Se||$e)&&(Le=we(ye,1,-Re,1+Re,0,-1,2,Te)||[],Se&&(Le=qt(Se,1).concat(Le)),$e&&(Le=Le.concat(qt($e,-1)))),Le}(ce,V),ce.length&&this.splitTile(ce,0,0,0),$&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Oi(me,V,$){return 32*((1<<me)*$+V)+me}function en(me,V){const $=me.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const ce=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ce)return V(null,null);const ye=new class{constructor(Re){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=Re.length,this._features=Re}feature(Re){return new class{constructor(Le){this._feature=Le,this.extent=n.EXTENT,this.type=Le.type,this.properties=Le.tags,"id"in Le&&!isNaN(Le.id)&&(this.id=parseInt(Le.id,10))}loadGeometry(){if(this._feature.type===1){const Le=[];for(const Se of this._feature.geometry)Le.push([new n.Point(Se[0],Se[1])]);return Le}{const Le=[];for(const Se of this._feature.geometry){const $e=[];for(const gt of Se)$e.push(new n.Point(gt[0],gt[1]));Le.push($e)}return Le}}toGeoJSON(Le,Se,$e){return J.call(this,Le,Se,$e)}}(this._features[Re])}}(ce.features);let Te=ft(ye);Te.byteOffset===0&&Te.byteLength===Te.buffer.byteLength||(Te=new Uint8Array(Te)),V(null,{vectorTile:ye,rawData:Te.buffer})}yi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yi.prototype.splitTile=function(me,V,$,ce,ye,Te,Re){for(var Le=[me,V,$,ce],Se=this.options,$e=Se.debug;Le.length;){ce=Le.pop(),$=Le.pop(),V=Le.pop(),me=Le.pop();var gt=1<<V,_t=Oi(V,$,ce),ut=this.tiles[_t];if(!ut&&($e>1&&console.time("creation"),ut=this.tiles[_t]=xi(me,V,$,ce,Se),this.tileCoords.push({z:V,x:$,y:ce}),$e)){$e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,$,ce,ut.numFeatures,ut.numPoints,ut.numSimplified),console.timeEnd("creation"));var Wt="z"+V;this.stats[Wt]=(this.stats[Wt]||0)+1,this.total++}if(ut.source=me,ye){if(V===Se.maxZoom||V===ye)continue;var Yt=1<<ye-V;if($!==Math.floor(Te/Yt)||ce!==Math.floor(Re/Yt))continue}else if(V===Se.indexMaxZoom||ut.numPoints<=Se.indexMaxPoints)continue;if(ut.source=null,me.length!==0){$e>1&&console.time("clipping");var Ht,es,os,Vs,rr,Ur,xr=.5*Se.buffer/Se.extent,Fi=.5-xr,Nr=.5+xr,Hr=1+xr;Ht=es=os=Vs=null,rr=we(me,gt,$-xr,$+Nr,0,ut.minX,ut.maxX,Se),Ur=we(me,gt,$+Fi,$+Hr,0,ut.minX,ut.maxX,Se),me=null,rr&&(Ht=we(rr,gt,ce-xr,ce+Nr,1,ut.minY,ut.maxY,Se),es=we(rr,gt,ce+Fi,ce+Hr,1,ut.minY,ut.maxY,Se),rr=null),Ur&&(os=we(Ur,gt,ce-xr,ce+Nr,1,ut.minY,ut.maxY,Se),Vs=we(Ur,gt,ce+Fi,ce+Hr,1,ut.minY,ut.maxY,Se),Ur=null),$e>1&&console.timeEnd("clipping"),Le.push(Ht||[],V+1,2*$,2*ce),Le.push(es||[],V+1,2*$,2*ce+1),Le.push(os||[],V+1,2*$+1,2*ce),Le.push(Vs||[],V+1,2*$+1,2*ce+1)}}},yi.prototype.getTile=function(me,V,$){var ce=this.options,ye=ce.extent,Te=ce.debug;if(me<0||me>24)return null;var Re=1<<me,Le=Oi(me,V=(V%Re+Re)%Re,$);if(this.tiles[Le])return sr(this.tiles[Le],ye);Te>1&&console.log("drilling down to z%d-%d-%d",me,V,$);for(var Se,$e=me,gt=V,_t=$;!Se&&$e>0;)$e--,gt=Math.floor(gt/2),_t=Math.floor(_t/2),Se=this.tiles[Oi($e,gt,_t)];return Se&&Se.source?(Te>1&&console.log("found parent tile z%d-%d-%d",$e,gt,_t),Te>1&&console.time("drilling down"),this.splitTile(Se.source,$e,gt,_t,me,V,$),Te>1&&console.timeEnd("drilling down"),this.tiles[Le]?sr(this.tiles[Le],ye):null):null};class tn extends n.VectorTileWorkerSource{constructor(V,$,ce,ye,Te){super(V,$,ce,ye,en),Te&&(this.loadGeoJSON=Te)}loadData(V,$){const ce=V&&V.request,ye=ce&&ce.collectResourceTiming;this.loadGeoJSON(V,(Te,Re)=>{if(Te||!Re)return $(Te);if(typeof Re!="object")return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{Z(Re,!0);try{if(V.filter){const Se=n.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(gt=>`${gt.key}: ${gt.message}`).join(", "));Re={type:"FeatureCollection",features:Re.features.filter(gt=>Se.value.evaluate({zoom:0},gt))}}this._geoJSONIndex=V.cluster?new Ut(function({superclusterOptions:Se,clusterProperties:$e}){if(!$e||!Se)return Se;const gt={},_t={},ut={accumulated:null,zoom:0},Wt={properties:null},Yt=Object.keys($e);for(const Ht of Yt){const[es,os]=$e[Ht],Vs=n.createExpression(os),rr=n.createExpression(typeof es=="string"?[es,["accumulated"],["get",Ht]]:es);gt[Ht]=Vs.value,_t[Ht]=rr.value}return Se.map=Ht=>{Wt.properties=Ht;const es={};for(const os of Yt)es[os]=gt[os].evaluate(ut,Wt);return es},Se.reduce=(Ht,es)=>{Wt.properties=es;for(const os of Yt)ut.accumulated=Ht[os],Ht[os]=_t[os].evaluate(ut,Wt)},Se}(V)).load(Re.features):function(Se,$e){return new yi(Se,$e)}(Re,V.geojsonVtOptions)}catch(Se){return $(Se)}this.loaded={};const Le={};if(ye){const Se=n.getPerformanceMeasurement(ce);Se&&(Le.resourceTiming={},Le.resourceTiming[V.source]=JSON.parse(JSON.stringify(Se)))}$(null,Le)}})}reloadTile(V,$){const ce=this.loaded;return ce&&ce[V.uid]?super.reloadTile(V,$):this.loadTile(V,$)}loadGeoJSON(V,$){if(V.request)n.getJSON(V.request,$);else{if(typeof V.data!="string")return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(V.data))}catch{return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ce){$(ce)}}getClusterChildren(V,$){try{$(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ce){$(ce)}}getClusterLeaves(V,$){try{$(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ce){$(ce)}}}class el{constructor(V){this.self=V,this.actor=new n.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.getProjection({name:"mercator"}),this.workerSourceTypes={vector:n.VectorTileWorkerSource,geojson:tn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,ce)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=ce},this.self.registerRTLTextPlugin=$=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=$.applyArabicShaping,n.plugin.processBidirectionalText=$.processBidirectionalText,n.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(V,$,ce){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],ce()}checkIfReady(V,$,ce){ce()}setReferrer(V,$){this.referrer=$}spriteLoaded(V,$){this.isSpriteLoaded[V]=$;for(const ce in this.workerSources[V]){const ye=this.workerSources[V][ce];for(const Te in ye)ye[Te]instanceof n.VectorTileWorkerSource&&(ye[Te].isSpriteLoaded=$,ye[Te].fire(new n.Event("isSpriteLoaded")))}}setImages(V,$,ce){this.availableImages[V]=$;for(const ye in this.workerSources[V]){const Te=this.workerSources[V][ye];for(const Re in Te)Te[Re].availableImages=$}ce()}enableTerrain(V,$,ce){this.terrain=$,ce()}setProjection(V,$){this.projections[V]=n.getProjection($)}setLayers(V,$,ce){this.getLayerIndex(V).replace($),ce()}updateLayers(V,$,ce){this.getLayerIndex(V).update($.layers,$.removedIds),ce()}loadTile(V,$,ce){const ye=this.enableTerrain?n.extend({enableTerrain:this.terrain},$):$;ye.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,$.type,$.source).loadTile(ye,ce)}loadDEMTile(V,$,ce){const ye=this.enableTerrain?n.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(V,$.source).loadTile(ye,ce)}reloadTile(V,$,ce){const ye=this.enableTerrain?n.extend({enableTerrain:this.terrain},$):$;ye.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,$.type,$.source).reloadTile(ye,ce)}abortTile(V,$,ce){this.getWorkerSource(V,$.type,$.source).abortTile($,ce)}removeTile(V,$,ce){this.getWorkerSource(V,$.type,$.source).removeTile($,ce)}removeSource(V,$,ce){if(!this.workerSources[V]||!this.workerSources[V][$.type]||!this.workerSources[V][$.type][$.source])return;const ye=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],ye.removeSource!==void 0?ye.removeSource($,ce):ce()}loadWorkerSource(V,$,ce){try{this.self.importScripts($.url),ce()}catch(ye){ce(ye.toString())}}syncRTLPluginState(V,$,ce){try{n.plugin.setState($);const ye=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);const Te=n.plugin.isParsed();ce(Te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),Te)}}catch(ye){ce(ye.toString())}}getAvailableImages(V){let $=this.availableImages[V];return $||($=[]),$}getLayerIndex(V){let $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new q),$}getWorkerSource(V,$,ce){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),!this.workerSources[V][$][ce]){const ye={send:(Te,Re,Le,Se,$e,gt)=>{this.actor.send(Te,Re,Le,V,$e,gt)},scheduler:this.actor.scheduler};this.workerSources[V][$][ce]=new this.workerSourceTypes[$](ye,this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])}return this.workerSources[V][$][ce]}getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new U),this.demWorkerSources[V][$]}enforceCacheSizeLimit(V,$){n.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(V,$,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new el(self)),el}),E(["./shared"],function(n){function P(d,i){if(Array.isArray(d)){if(!Array.isArray(i)||d.length!==i.length)return!1;for(let o=0;o<d.length;o++)if(!P(d[o],i[o]))return!1;return!0}if(typeof d=="object"&&d!==null&&i!==null){if(typeof i!="object"||Object.keys(d).length!==Object.keys(i).length)return!1;for(const o in d)if(!P(d[o],i[o]))return!1;return!0}return d===i}var z=q;function q(d){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,g,_=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(_);try{g=new Worker(j),m=!0}catch{m=!1}return g&&g.terminate(),URL.revokeObjectURL(j),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var g=m.getContext("2d");if(!g)return!1;var _=g.getImageData(0,0,1,1);return _&&_.width===m.width}()?(U[o=i&&i.failIfMajorPerformanceCaveat]===void 0&&(U[o]=function(m){var g,_=function(j){var S=document.createElement("canvas"),C=Object.create(q.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=j,S.getContext("webgl",C)||S.getContext("experimental-webgl",C)}(m);if(!_)return!1;try{g=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!g||_.isContextLost())&&(_.shaderSource(g,"void main() {}"),_.compileShader(g),_.getShaderParameter(g,_.COMPILE_STATUS)===!0)}(o)),U[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o}(d)}var U={};function W(d,i,o){const m=n.window.document.createElement(d);return i!==void 0&&(m.className=i),o&&o.appendChild(m),m}function X(d,i,o){const m=n.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const g of Object.keys(i))m.setAttributeNS(null,g,i[g]);return o&&o.appendChild(m),m}q.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Z=n.window.document&&n.window.document.documentElement.style,J=Z&&Z.userSelect!==void 0?"userSelect":"WebkitUserSelect";let de;function ne(){Z&&J&&(de=Z[J],Z[J]="none")}function te(){Z&&J&&(Z[J]=de)}function Ne(d){d.preventDefault(),d.stopPropagation(),n.window.removeEventListener("click",Ne,!0)}function he(){n.window.addEventListener("click",Ne,!0),n.window.setTimeout(()=>{n.window.removeEventListener("click",Ne,!0)},0)}function Ce(d,i){const o=d.getBoundingClientRect();return Ie(d,o,i)}function Ae(d,i){const o=d.getBoundingClientRect(),m=[];for(let g=0;g<i.length;g++)m.push(Ie(d,o,i[g]));return m}function fe(d){return n.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&n.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Ie(d,i,o){const m=d.offsetWidth===i.width?1:d.offsetWidth/i.width;return new n.Point((o.clientX-i.left)*m,(o.clientY-i.top)*m)}function Ee(d,i){var o=i[0],m=i[1],g=i[2],_=i[3],j=o*_-g*m;return j?(d[0]=_*(j=1/j),d[1]=-m*j,d[2]=-g*j,d[3]=o*j,d):null}function tt(d){const{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class je extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,callback:m}of this.requestors)this._notify(o,m);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,o){this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let m=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(o.content,o)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,o){if(!i)return!0;let m=0;for(const g of i){if(g[0]<m||g[1]<g[0]||o<g[1])return!1;m=g[1]}return!0}_validateContent(i,o){return!(i&&(i.length!==4||i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,o){o.version=this.images[i].version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,o){let m=!0;if(!this.isLoaded())for(const g of i)this.images[g]||(m=!1);this.isLoaded()||m?this._notify(i,o):this.requestors.push({ids:i,callback:o})}_notify(i,o){const m={};for(const g of i){this.images[g]||this.fire(new n.Event("styleimagemissing",{id:g}));const _=this.images[g];_?m[g]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:n.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,m)}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],m=this.getImage(i);if(!m)return null;if(o&&o.position.version===m.version)return o.position;if(o)o.position.version=m.version;else{const g={w:m.data.width+2,h:m.data.height+2,x:0,y:0},_=new n.ImagePosition(g,m);this.patterns[i]={bin:g,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new n.Texture(i,this.atlasImage,o.RGBA),this.atlasTexture&&this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h:m}=n.potpack(i),g=this.atlasImage;g.resize({width:o||1,height:m||1});for(const _ in this.patterns){const{bin:j}=this.patterns[_],S=j.x+1,C=j.y+1,D=this.images[_].data,I=D.width,O=D.height;n.RGBAImage.copy(D,g,{x:0,y:0},{x:S,y:C},{width:I,height:O}),n.RGBAImage.copy(D,g,{x:0,y:O-1},{x:S,y:C-1},{width:I,height:1}),n.RGBAImage.copy(D,g,{x:0,y:0},{x:S,y:C+O},{width:I,height:1}),n.RGBAImage.copy(D,g,{x:I-1,y:0},{x:S-1,y:C},{width:1,height:O}),n.RGBAImage.copy(D,g,{x:0,y:0},{x:S+I,y:C},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const m=this.images[o];tt(m)&&this.updateImage(o,m)}}}const Pe=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(d,i){return function([o,m,g]){const _=n.degToRad(m+90),j=n.degToRad(g);return{x:o*Math.cos(_)*Math.sin(j),y:o*Math.sin(_)*Math.sin(j),z:o*Math.cos(j),azimuthal:m,polar:g}}(d.expression.evaluate(i))}interpolate(d,i,o){return{x:n.number(d.x,i.x,o),y:n.number(d.y,i.y,o),z:n.number(d.z,i.z,o),azimuthal:n.number(d.azimuthal,i.azimuthal,o),polar:n.number(d.polar,i.polar,o)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)});class it extends n.Evented{constructor(i){super(),this._transitionable=new n.Transitionable(Pe),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(n.validateLight,i,o))for(const m in i){const g=i[m];n.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,i.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}const ct=new n.Properties({source:new n.DataConstantProperty(n.spec.terrain.source),exaggeration:new n.DataConstantProperty(n.spec.terrain.exaggeration)});let Nt=class extends n.Evented{constructor(d,i){super(),this._transitionable=new n.Transitionable(ct),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(d){for(const i in d){const o=d[i];n.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),o):this._transitionable.setValue(i,o)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function ft(d,i,o,m){const g=n.smoothstep(45,65,o),[_,j]=Mt(d,m),S=n.length(i);let C=1-Math.min(1,Math.exp((S-_)/(j-_)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*g*d.alpha}function Mt(d,i){const o=.5/Math.tan(.5*i);return[d.range[0]+o,d.range[1]+o]}const ht=new n.Properties({range:new n.DataConstantProperty(n.spec.fog.range),color:new n.DataConstantProperty(n.spec.fog.color),"high-color":new n.DataConstantProperty(n.spec.fog["high-color"]),"space-color":new n.DataConstantProperty(n.spec.fog["space-color"]),"horizon-blend":new n.DataConstantProperty(n.spec.fog["horizon-blend"]),"star-intensity":new n.DataConstantProperty(n.spec.fog["star-intensity"])});class Os extends n.Evented{constructor(i,o){super(),this._transitionable=new n.Transitionable(ht),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const i=this._transform,o=i.projection.name==="globe",m=n.globeToMercatorTransition(i.zoom),g=this.properties.get("range"),_=[.5,3];return{range:o?[n.number(_[0],g[0],m),n.number(_[1],g[1],m)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o={}){if(!this._validate(n.validateFog,i,o)){for(const m of Object.keys(n.spec.fog))i&&i[m]===void 0&&(i[m]=n.spec.fog[m].default);for(const m in i){const g=i[m];n.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.smoothstep(45,65,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(m,g,_){const j=n.MercatorCoordinate.fromLngLat(g),S=_.elevation?_.elevation.getAtPointOrZero(j):0,C=[j.x,j.y,S];return n.transformMat4(C,C,_.mercatorFogMatrix),ft(m,C,_.pitch,_._fov)}(this.state,i,o):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Mt(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,i.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class ns{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=n.uniqueId();const m=this.workerPool.acquire(this.id);for(let g=0;g<m.length;g++){const _=new ns.Actor(m[g],o,this.id);_.name=`Worker ${g}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,m){n.asyncAll(this.actors,(g,_)=>{g.send(i,o,_)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function _s(d,i,o){return i*(n.EXTENT/(d.tileSize*Math.pow(2,o-d.tileID.overscaledZ)))}ns.Actor=n.Actor;class pr{constructor(i,o,m,g){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(i,o){let m,g;if(i instanceof n.Point||typeof i[0]=="number"){const _=n.Point.convert(i);m=[_],g=o.isPointAboveHorizon(_)}else{const _=n.Point.convert(i[0]),j=n.Point.convert(i[1]);m=[_,j],g=n.polygonizeBounds(_,j).every(S=>o.isPointAboveHorizon(S))}return new pr(m,o.getCameraPoint(),g,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return n.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.Point(1,1)):this.screenBounds[1],g=n.polygonizeBounds(o,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<m.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?g[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(g[3]=this.cameraPoint)),n.bufferConvexPolygon(g,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.Point(1,1)):this.screenBounds[1],g=n.polygonizeBounds(o,m,i),_=this.cameraPoint.clone();switch(3*((_.y>o.y)+(_.y>m.y))+((_.x>o.x)+(_.x>m.x))){case 0:g[0]=_,g[4]=_.clone();break;case 1:g.splice(1,0,_);break;case 2:g[1]=_;break;case 3:g.splice(4,0,_);break;case 5:g.splice(2,0,_);break;case 6:g[3]=_;break;case 7:g.splice(3,0,_);break;case 8:g[2]=_}return g}containsTile(i,o,m,g=0){const _=i.queryPadding/o._pixelsPerMercatorPixel+1,j=m?this._bufferedCameraMercator(_,o):this._bufferedScreenMercator(_,o);let S=i.tileID.wrap+(j.unwrapped?g:0);const C=j.polygon.map(se=>n.getTilePoint(i.tileTransform,se,S));if(!n.polygonIntersectsBox(C,0,0,n.EXTENT,n.EXTENT))return;S=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const D=this.screenGeometryMercator.polygon.map(se=>n.getTileVec3(i.tileTransform,se,S)),I=D.map(se=>new n.Point(se[0],se[1])),O=o.getFreeCameraOptions().position||new n.MercatorCoordinate(0,0,0),G=n.getTileVec3(i.tileTransform,O,S),Q=D.map(se=>{const F=n.sub(se,se,G);return n.normalize(F,F),new n.Ray(G,F)}),ee=_s(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:Q,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Y=n.getBounds(C),Y.min.x=n.clamp(Y.min.x,0,n.EXTENT),Y.min.y=n.clamp(Y.min.y,0,n.EXTENT),Y.max.x=n.clamp(Y.max.x,0,n.EXTENT),Y.max.y=n.clamp(Y.max.y,0,n.EXTENT),Y),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:ee};var Y}_bufferedScreenMercator(i,o){const m=Fr(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[m]=g,g}}_bufferedCameraMercator(i,o){const m=Fr(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[m]=g,g}}_projectAndResample(i,o){const m=function(_,j){const S=n.multiply([],j.pixelMatrix,j.globeMatrix),C=[0,-n.GLOBE_RADIUS,0,1],D=[0,n.GLOBE_RADIUS,0,1],I=[0,0,0,1];n.transformMat4$1(C,C,S),n.transformMat4$1(D,D,S),n.transformMat4$1(I,I,S);const O=new n.Point(C[0]/C[3],C[1]/C[3]),G=new n.Point(D[0]/D[3],D[1]/D[3]),Q=n.polygonContainsPoint(_,O)&&C[3]<I[3],ee=n.polygonContainsPoint(_,G)&&D[3]<I[3];if(!Q&&!ee)return null;const Y=function(ve,Me,ke){for(let Be=1;Be<ve.length;Be++){const at=fr(Me.pointCoordinate3D(ve[Be-1]).x),ze=fr(Me.pointCoordinate3D(ve[Be]).x);if(ke<0){if(at<ze)return{idx:Be,t:-at/(ze-1-at)}}else if(ze<at)return{idx:Be,t:(1-at)/(ze+1-at)}}return null}(_,j,Q?-1:1);if(!Y)return null;const{idx:se,t:F}=Y;let K=se>1?Ut(_.slice(0,se),j):[],ae=se<_.length?Ut(_.slice(se),j):[];K=K.map(ve=>new n.Point(fr(ve.x),ve.y)),ae=ae.map(ve=>new n.Point(fr(ve.x),ve.y));const le=[...K];le.length===0&&le.push(ae[ae.length-1]);const _e=n.number(le[le.length-1].y,(ae.length===0?K[0]:ae[0]).y,F);let be;return be=Q?[new n.Point(0,_e),new n.Point(0,0),new n.Point(1,0),new n.Point(1,_e)]:[new n.Point(1,_e),new n.Point(1,1),new n.Point(0,1),new n.Point(0,_e)],le.push(...be),ae.length===0?le.push(K[0]):le.push(...ae),{polygon:le.map(ve=>new n.MercatorCoordinate(ve.x,ve.y)),unwrapped:!1}}(i,o);if(m)return m;const g=function(_,j){let S=!1,C=-1/0,D=0;for(let O=0;O<_.length-1;O++)_[O].x>C&&(C=_[O].x,D=O);for(let O=0;O<_.length-1;O++){const G=(D+O)%(_.length-1),Q=_[G],ee=_[G+1];Math.abs(Q.x-ee.x)>.5&&(Q.x<ee.x?(Q.x+=1,G===0&&(_[_.length-1].x+=1)):(ee.x+=1,G+1===_.length-1&&(_[0].x+=1)),S=!0)}const I=n.mercatorXfromLng(j.center.lng);return S&&I<Math.abs(I-1)&&_.forEach(O=>{O.x-=1}),{polygon:_,unwrapped:S}}(Ut(i,o).map(_=>new n.Point(fr(_.x),_.y)),o);return{polygon:g.polygon.map(_=>new n.MercatorCoordinate(_.x,_.y)),unwrapped:g.unwrapped}}}function Ut(d,i){return n.resample(d,o=>{const m=i.pointCoordinate3D(o);o.x=m.x,o.y=m.y},1/256)}function fr(d){return d<0?1+d%1:d%1}function Fr(d){return 100*d|0}function jr(d,i,o,m,g){const _=function(j,S){if(j)return g(j);if(S){d.url&&S.tiles&&d.tiles&&delete d.tiles;const C=n.pick(n.extend(S,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(C.vectorLayers=S.vector_layers,C.vectorLayerIds=C.vectorLayers.map(D=>D.id)),C.tiles=i.canonicalizeTileset(C,d.url),g(null,C)}};return d.url?n.getJSON(i.transformRequest(i.normalizeSourceURL(d.url,null,o,m),n.ResourceType.Source),_):n.exported.frame(()=>_(null,d))}class gr{constructor(i,o,m){this.bounds=n.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),m=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*o),g=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*o),_=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*o),j=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*o);return i.x>=m&&i.x<_&&i.y>=g&&i.y<j}}class Br{constructor(i,o,m){this.context=i;const g=i.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _r={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jr{constructor(i,o,m,g){this.length=o.length,this.attributes=m,this.itemSize=o.bytesPerElement,this.dynamicDraw=g,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let m=0;m<this.attributes.length;m++){const g=o.attributes[this.attributes[m].name];g!==void 0&&i.enableVertexAttribArray(g)}}setVertexAttribPointers(i,o,m){for(let g=0;g<this.attributes.length;g++){const _=this.attributes[g],j=o.attributes[_.name];j!==void 0&&i.vertexAttribPointer(j,_.components,i[_r[_.type]],!1,this.itemSize,_.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gi extends Qt{getDefault(){return n.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class vr extends Qt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Mi extends Qt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class As extends Qt{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ir extends Qt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Zn extends Qt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Zr extends Qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class we extends Qt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ge extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class et extends Qt{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ct extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class wt extends Qt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class De extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class xt extends Qt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Jt extends Qt{getDefault(){return n.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class qt extends Qt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class vs extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class sr extends Qt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Ls extends Qt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let xi,Wr=class extends Qt{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Dr extends Qt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class yi extends Qt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Oi extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class en extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class tn extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class el extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class me extends Qt{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class V extends Qt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class $ extends Qt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class ce extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class ye extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Te extends Qt{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Re extends Te{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Le extends Te{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Se extends Le{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class $e{constructor(i,o,m,g){this.context=i,this.width=o,this.height=m;const _=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Re(i,_),g&&(this.depthAttachment=new Le(i,_))}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class gt{constructor(i,o=!1){if(this.gl=i,this.isWebGL2=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),o){const m=i;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(i),deleteVertexArrayOES:m.deleteVertexArray.bind(i),bindVertexArrayOES:m.bindVertexArray.bind(i)}}this.clearColor=new gi(this),this.clearDepth=new vr(this),this.clearStencil=new Mi(this),this.colorMask=new As(this),this.depthMask=new Ir(this),this.stencilMask=new Zn(this),this.stencilFunc=new Zr(this),this.stencilOp=new we(this),this.stencilTest=new Ge(this),this.depthRange=new et(this),this.depthTest=new Ct(this),this.depthFunc=new wt(this),this.blend=new De(this),this.blendFunc=new xt(this),this.blendColor=new Jt(this),this.blendEquation=new qt(this),this.cullFace=new vs(this),this.cullFaceSide=new sr(this),this.frontFace=new Ls(this),this.program=new Wr(this),this.activeTexture=new Dr(this),this.viewport=new yi(this),this.bindFramebuffer=new Oi(this),this.bindRenderbuffer=new en(this),this.bindTexture=new tn(this),this.bindVertexBuffer=new el(this),this.bindElementBuffer=new me(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new V(this),this.pixelStoreUnpack=new $(this),this.pixelStoreUnpackPremultiplyAlpha=new ce(this),this.pixelStoreUnpackFlipY=new ye(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),o||(this.extTextureHalfFloat=i.getExtension("OES_texture_half_float")),(o||this.extTextureHalfFloat&&i.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o||i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new Br(this,i,o)}createVertexBuffer(i,o,m){return new Jr(this,i,o,m)}createRenderbuffer(i,o,m){const g=this.gl,_=g.createRenderbuffer();return this.bindRenderbuffer.set(_),g.renderbufferStorage(g.RENDERBUFFER,i,o,m),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,m){return new $e(this,i,o,m)}clear({color:i,depth:o,stencil:m}){const g=this.gl;let _=0;i&&(_|=g.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),m!==void 0&&(_|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),g.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){P(i.blendFunction,n.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class _t extends n.Evented{constructor(i,o,m,g){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(o,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new n.DedupedRequest}load(i){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=jr(this._options,this.map._requestManager,o,m,(g,_)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new n.ErrorEvent(g))):_&&(n.extend(this,_),_.bounds&&(this.tileBounds=new gr(_.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(g)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return n.extend({},this._options)}loadTile(i,o){const m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(m,n.ResourceType.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=o:i.request=i.actor.send("reloadTile",g,_.bind(this));else if(i.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",g,_.bind(this),void 0,!0);else{const j=n.loadVectorTile.call({deduped:this._deduped},g,(S,C)=>{S||!C?_.call(this,S):(g.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},i.actor&&i.actor.send("loadTile",g,_.bind(this),void 0,!0))},!0);i.request={cancel:j}}function _(j,S){return delete i.request,i.aborted?o(null):j&&j.status!==404?o(j):(S&&S.resourceTiming&&(i.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&i.setExpiryData(S),i.loadVectorData(S,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id})}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ut extends n.Evented{constructor(i,o,m,g){super(),this.id=i,this.dispatcher=m,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},o),n.extend(this,n.pick(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=jr(this._options,this.map._requestManager,null,null,(o,m)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new n.ErrorEvent(o)):m&&(n.extend(this,m),m.bounds&&(this.tileBounds=new gr(m.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(m.tiles),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return n.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const m=n.exported.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=n.getImage(this.map._requestManager.transformRequest(g,n.ResourceType.Tile),(_,j,S,C)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):_?(i.state="errored",o(_)):j?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:C}),i.setTexture(j,this.map.painter),i.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(i,o,m){i.setTexture(o,m)}static unloadTileData(i,o){i.texture&&o.saveTileTexture(i.texture)}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o()}unloadTile(i,o){i.texture&&this.map.painter.saveTileTexture(i.texture),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Wt(d,i,o,m,g,_,j,S){const C=[d,o,g,i,m,_,1,1,1],D=[j,S,1],I=n.adjoint([],C),[O,G,Q]=n.transformMat3(D,D,n.transpose(I,I));return n.multiply$1(C,[O,0,0,0,G,0,0,0,Q],C)}class Yt extends n.Evented{constructor(i,o,m,g){super(),this.id=i,this.dispatcher=m,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=o,this._dirty=!1}load(i,o){this._loaded=o||!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(m,g)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new n.ErrorEvent(m));else if(g){const{HTMLImageElement:_}=n.window;this.image=g instanceof _?n.exported.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const o=i.map(n.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let g=1/0,_=1/0,j=-1/0,S=-1/0;for(const O of m)g=Math.min(g,O.x),_=Math.min(_,O.y),j=Math.max(j,O.x),S=Math.max(S,O.y);const C=Math.max(j-g,S-_),D=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),I=Math.pow(2,D);return new n.CanonicalTileID(D,Math.floor((g+j)/2*I),Math.floor((_+S)/2*I))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const C in this.tiles){const D=this.tiles[C];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const o=n.tileTransform(this.tileID,this.map.transform.projection),[m,g,_,j]=this.coordinates.map(C=>{const D=o.projection.project(C[0],C[1]);return n.getTilePoint(o,D)._round()});this.perspectiveTransform=function(C,D,I,O,G,Q,ee,Y,se,F){const K=Wt(0,0,C,0,0,D,C,D),ae=Wt(I,O,G,Q,ee,Y,se,F);return n.multiply$1(ae,n.adjoint(K,K),ae),[ae[6]/ae[8]*C/n.EXTENT,ae[7]/ae[8]*D/n.EXTENT]}(this.width,this.height,m.x,m.y,g.x,g.y,j.x,j.y,_.x,_.y);const S=this._boundsArray=new n.StructArrayLayout4i8;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(g.x,g.y,n.EXTENT,0),S.emplaceBack(j.x,j.y,0,n.EXTENT),S.emplaceBack(_.x,_.y,n.EXTENT,n.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(S,n.boundsAttributes.members),this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new n.Texture(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,o){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},o(null)):(i.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ht={vector:_t,raster:ut,"raster-dem":class extends ut{constructor(d,i,o,m){super(d,i,o,m),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(d,i){const o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(g,_){g&&(d.state="errored",i(g)),_&&(d.dem=_,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",i(null))}d.request=n.getImage(this.map._requestManager.transformRequest(o,n.ResourceType.Tile),(function(g,_,j,S){if(delete d.request,d.aborted)d.state="unloaded",i(null);else if(g)d.state="errored",i(g);else if(_){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:j,expires:S});const C=n.window.ImageBitmap&&_ instanceof n.window.ImageBitmap&&(xi==null&&(xi=n.window.OffscreenCanvas&&new n.window.OffscreenCanvas(1,1).getContext("2d")&&typeof n.window.createImageBitmap=="function"),xi),D=1-(_.width-n.prevPowerOfTwo(_.width))/2;D<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const I=C?_:n.exported.getImageData(_,D),O={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:D};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",O,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const i=d.canonical,o=Math.pow(2,i.z),m=(i.x-1+o)%o,g=i.x===0?d.wrap-1:d.wrap,_=(i.x+1+o)%o,j=i.x+1===o?d.wrap+1:d.wrap,S={};return S[new n.OverscaledTileID(d.overscaledZ,g,i.z,m,i.y).key]={backfilled:!1},S[new n.OverscaledTileID(d.overscaledZ,j,i.z,_,i.y).key]={backfilled:!1},i.y>0&&(S[new n.OverscaledTileID(d.overscaledZ,g,i.z,m,i.y-1).key]={backfilled:!1},S[new n.OverscaledTileID(d.overscaledZ,d.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new n.OverscaledTileID(d.overscaledZ,j,i.z,_,i.y-1).key]={backfilled:!1}),i.y+1<o&&(S[new n.OverscaledTileID(d.overscaledZ,g,i.z,m,i.y+1).key]={backfilled:!1},S[new n.OverscaledTileID(d.overscaledZ,d.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new n.OverscaledTileID(d.overscaledZ,j,i.z,_,i.y+1).key]={backfilled:!1}),S}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends n.Evented{constructor(d,i,o,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(m),this._data=i.data,this._options=n.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const g=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*g,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*g,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:n.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*g,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},i),this}getClusterChildren(d,i){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},i),this}getClusterLeaves(d,i,o,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:i,offset:o},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=n.extend({},this.workerOptions),i=this._data;typeof i=="string"?(d.request=this.map._requestManager.transformRequest(n.exported.resolveURL(i),n.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(o,m)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new n.ErrorEvent(o));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(g.resourceTiming=m.resourceTiming[this.id]),this.fire(new n.Event("data",g)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,i){const o=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(o,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,g)=>(delete d.request,d.unloadVectorData(),d.aborted?i(null):m?i(m):(d.loadVectorData(g,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Yt{constructor(d,i,o,m){super(d,i,o,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const i of d.urls)this.urls.push(this.map._requestManager.transformRequest(i,n.ResourceType.Source).url);n.getVideo(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new n.ErrorEvent(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const i=this.video.seekable;d<i.start(0)||d>i.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,i=d.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new n.Texture(d,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Yt,canvas:class extends Yt{constructor(d,i,o,m){super(d,i,o,m),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(_=>typeof _!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof n.window.HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof n.window.HTMLCanvasElement?this.options.canvas:n.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends n.Evented{constructor(d,i,o,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new gr(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),n.extend(this,n.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:i,y:o,z:m}=d.canonical;return this._implementation.hasTile({x:i,y:o,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,i){const{x:o,y:m,z:g}=d.tileID.canonical,_=new n.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:o,y:m,z:g},{signal:_.signal})).then((function(j){return delete d.request,d.aborted?(d.state="unloaded",i(null)):j===void 0?(d.state="errored",i(null)):j===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",i(null)):function(S){return S instanceof n.window.ImageData||S instanceof n.window.HTMLCanvasElement||S instanceof n.window.ImageBitmap||S instanceof n.window.HTMLImageElement}(j)?(this.loadTileData(d,j),d.state="loaded",void i(null)):(d.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(j=>{j.code!==20&&(d.state="errored",i(j))}),d.request.cancel=()=>_.abort()}loadTileData(d,i){ut.loadTileData(d,i,this._map.painter)}unloadTileData(d){ut.unloadTileData(d,this._map.painter)}unloadTile(d,i){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:o,y:m,z:g}=d.tileID.canonical;this._implementation.unloadTile({x:o,y:m,z:g})}i()}abortTile(d,i){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}}},es=function(d,i,o,m){const g=new Ht[i.type](d,i,o,m);if(g.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${g.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],g),g};function os(d,i){const o=n.identity([]);return n.scale(o,o,[.5*d.width,.5*-d.height,1]),n.translate(o,o,[1,-1,0]),n.multiply(o,o,d.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(o)}function Vs(d,i,o,m,g,_,j,S=!1){const C=d.tilesIn(m,j,S);C.sort(Ur);const D=[];for(const O of C)D.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(i,o,d._state,O,g,_,os(d.transform,O.tile.tileID),S)});const I=function(O){const G={},Q={};for(const ee of O){const Y=ee.queryResults,se=ee.wrappedTileID,F=Q[se]=Q[se]||{};for(const K in Y){const ae=Y[K],le=F[K]=F[K]||{},_e=G[K]=G[K]||[];for(const be of ae)le[be.featureIndex]||(le[be.featureIndex]=!0,_e.push(be))}}return G}(D);for(const O in I)I[O].forEach(G=>{const Q=G.feature,ee=Q.layer;ee&&ee.type!=="background"&&ee.type!=="sky"&&(Q.source=ee.source,ee["source-layer"]&&(Q.sourceLayer=ee["source-layer"]),Q.state=Q.id!==void 0?d.getFeatureState(ee["source-layer"],Q.id):{})});return I}function rr(d,i){const o=d.getRenderableIds().map(_=>d.getTileByID(_)),m=[],g={};for(let _=0;_<o.length;_++){const j=o[_],S=j.tileID.canonical.key;g[S]||(g[S]=!0,j.querySourceFeatures(m,i))}return m}function Ur(d,i){const o=d.tileID,m=i.tileID;return o.overscaledZ-m.overscaledZ||o.canonical.y-m.canonical.y||o.wrap-m.wrap||o.canonical.x-m.canonical.x}function xr(){return Da.workerClass!=null?new Da.workerClass:new n.window.Worker(Da.workerUrl)}const Fi="mapboxgl_preloaded_worker_pool";class Nr{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Nr.workerCount;)this.workers.push(new xr);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Fi]}numActive(){return Object.keys(this.active).length}}let Hr;function ga(){return Hr||(Hr=new Nr),Hr}function ym(d,i){const o={};for(const m in d)m!=="ref"&&(o[m]=d[m]);return n.refProperties.forEach(m=>{m in i&&(o[m]=i[m])}),o}function ou(d){d=d.slice();const i=Object.create(null);for(let o=0;o<d.length;o++)i[d[o].id]=d[o];for(let o=0;o<d.length;o++)"ref"in d[o]&&(d[o]=ym(d[o],i[d[o].ref]));return d}Nr.workerCount=2;const xs={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function uc(d,i,o){o.push({command:xs.addSource,args:[d,i[d]]})}function ro(d,i,o){i.push({command:xs.removeSource,args:[d]}),o[d]=!0}function hc(d,i,o,m){ro(d,o,m),uc(d,i,o)}function tl(d,i,o){let m;for(m in d[o])if(d[o].hasOwnProperty(m)&&m!=="data"&&!P(d[o][m],i[o][m]))return!1;for(m in i[o])if(i[o].hasOwnProperty(m)&&m!=="data"&&!P(d[o][m],i[o][m]))return!1;return!0}function Bi(d,i,o,m,g,_){let j;for(j in i=i||{},d=d||{})d.hasOwnProperty(j)&&(P(d[j],i[j])||o.push({command:_,args:[m,j,i[j],g]}));for(j in i)i.hasOwnProperty(j)&&!d.hasOwnProperty(j)&&(P(d[j],i[j])||o.push({command:_,args:[m,j,i[j],g]}))}function sn(d){return d.id}function mc(d,i){return d[i.id]=i,d}class pc{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=n.clamp(i,0,1);let o=1,m=this._distances[o];const g=i*this.paddedLength+this.padding;for(;m<g&&o<this._distances.length;)m=this._distances[++o];const _=o-1,j=this._distances[_],S=m-j,C=S>0?(g-j)/S:0;return this.points[_].mult(1-C).add(this.points[o].mult(C))}}class Wn{constructor(i,o,m){const g=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(o/m);for(let j=0;j<this.xCellCount*this.yCellCount;j++)g.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,m,g,_){this._forEachCell(o,m,g,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(m),this.bboxes.push(g),this.bboxes.push(_)}insertCircle(i,o,m,g){this._forEachCell(o-g,m-g,o+g,m+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(m),this.circles.push(g)}_insertBoxCell(i,o,m,g,_,j){this.boxCells[_].push(j)}_insertCircleCell(i,o,m,g,_,j){this.circleCells[_].push(j)}_query(i,o,m,g,_,j){if(m<0||i>this.width||g<0||o>this.height)return!_&&[];const S=[];if(i<=0&&o<=0&&this.width<=m&&this.height<=g){if(_)return!0;for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const D=this.circles[3*C],I=this.circles[3*C+1],O=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:D-O,y1:I-O,x2:D+O,y2:I+O})}return j?S.filter(j):S}return this._forEachCell(i,o,m,g,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},j),_?S.length>0:S}_queryCircle(i,o,m,g,_){const j=i-m,S=i+m,C=o-m,D=o+m;if(S<0||j>this.width||D<0||C>this.height)return!g&&[];const I=[];return this._forEachCell(j,C,S,D,this._queryCellCircle,I,{hitTest:g,circle:{x:i,y:o,radius:m},seenUids:{box:{},circle:{}}},_),g?I.length>0:I}query(i,o,m,g,_){return this._query(i,o,m,g,!1,_)}hitTest(i,o,m,g,_){return this._query(i,o,m,g,!0,_)}hitTestCircle(i,o,m,g){return this._queryCircle(i,o,m,!0,g)}_queryCell(i,o,m,g,_,j,S,C){const D=S.seenUids,I=this.boxCells[_];if(I!==null){const G=this.bboxes;for(const Q of I)if(!D.box[Q]){D.box[Q]=!0;const ee=4*Q;if(i<=G[ee+2]&&o<=G[ee+3]&&m>=G[ee+0]&&g>=G[ee+1]&&(!C||C(this.boxKeys[Q]))){if(S.hitTest)return j.push(!0),!0;j.push({key:this.boxKeys[Q],x1:G[ee],y1:G[ee+1],x2:G[ee+2],y2:G[ee+3]})}}}const O=this.circleCells[_];if(O!==null){const G=this.circles;for(const Q of O)if(!D.circle[Q]){D.circle[Q]=!0;const ee=3*Q;if(this._circleAndRectCollide(G[ee],G[ee+1],G[ee+2],i,o,m,g)&&(!C||C(this.circleKeys[Q]))){if(S.hitTest)return j.push(!0),!0;{const Y=G[ee],se=G[ee+1],F=G[ee+2];j.push({key:this.circleKeys[Q],x1:Y-F,y1:se-F,x2:Y+F,y2:se+F})}}}}}_queryCellCircle(i,o,m,g,_,j,S,C){const D=S.circle,I=S.seenUids,O=this.boxCells[_];if(O!==null){const Q=this.bboxes;for(const ee of O)if(!I.box[ee]){I.box[ee]=!0;const Y=4*ee;if(this._circleAndRectCollide(D.x,D.y,D.radius,Q[Y+0],Q[Y+1],Q[Y+2],Q[Y+3])&&(!C||C(this.boxKeys[ee])))return j.push(!0),!0}}const G=this.circleCells[_];if(G!==null){const Q=this.circles;for(const ee of G)if(!I.circle[ee]){I.circle[ee]=!0;const Y=3*ee;if(this._circlesCollide(Q[Y],Q[Y+1],Q[Y+2],D.x,D.y,D.radius)&&(!C||C(this.circleKeys[ee])))return j.push(!0),!0}}}_forEachCell(i,o,m,g,_,j,S,C){const D=this._convertToXCellCoord(i),I=this._convertToYCellCoord(o),O=this._convertToXCellCoord(m),G=this._convertToYCellCoord(g);for(let Q=D;Q<=O;Q++)for(let ee=I;ee<=G;ee++)if(_.call(this,i,o,m,g,this.xCellCount*ee+Q,j,S,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,m,g,_,j){const S=g-i,C=_-o,D=m+j;return D*D>S*S+C*C}_circleAndRectCollide(i,o,m,g,_,j,S){const C=(j-g)/2,D=Math.abs(i-(g+C));if(D>C+m)return!1;const I=(S-_)/2,O=Math.abs(o-(_+I));if(O>I+m)return!1;if(D<=C||O<=I)return!0;const G=D-C,Q=O-I;return G*G+Q*Q<=m*m}}const rn={unknown:0,flipRequired:1,flipNotRequired:2},io=Math.tan(85*Math.PI/180);function We(d,i,o,m,g,_,j){const S=n.create();if(o)if(_.name==="globe"){const C=n.calculateGlobeLabelMatrix(g,i);n.multiply(S,S,C)}else{const C=Ee([],j);S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],m||n.rotateZ(S,S,g.angle)}else n.multiply(S,g.labelPlaneMatrix,d);return S}function nn(d,i,o,m,g,_,j){const S=We(d,i,o,m,g,_,j);return _.name==="globe"&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function ir(d,i,o,m,g,_,j){if(o){if(_.name==="globe"){const S=We(d,i,o,m,g,_,j);return n.invert(S,S),n.multiply(S,d,S),S}{const S=n.clone(d),C=n.identity([]);return C[0]=j[0],C[1]=j[1],C[4]=j[2],C[5]=j[3],n.multiply(S,S,C),m||n.rotateZ(S,S,-g.angle),S}}return g.glCoordMatrix}function Sr(d,i,o,m){const g=[d,i,o,1];o?n.transformMat4$1(g,g,m):rs(g,g,m);const _=g[3];return g[0]/=_,g[1]/=_,g[2]/=_,g}function lu(d,i){return Math.min(.5+d/i*.5,1.5)}function Ui(d,i){const o=d[0]/d[3],m=d[1]/d[3];return o>=-i[0]&&o<=i[0]&&m>=-i[1]&&m<=i[1]}function fc(d,i,o,m,g,_,j,S,C,D){const I=o.transform,O=m?d.textSizeData:d.iconSizeData,G=n.evaluateSizeForZoom(O,o.transform.zoom),Q=I.projection.name==="globe",ee=[256/o.width*2+1,256/o.height*2+1],Y=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Y.clear();let se=null;Q&&(se=m?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const F=d.lineVertexArray,K=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,ae=o.transform.width/o.transform.height;let le,_e=!1;for(let be=0;be<K.length;be++){const ve=K.get(be),{numGlyphs:Me,writingMode:ke}=ve;if(ke!==n.WritingMode.vertical||_e||le===n.WritingMode.horizontal||(_e=!0),le=ke,(ve.hidden||ke===n.WritingMode.vertical)&&!_e){Pi(Me,Y);continue}_e=!1;const Be=new n.Point(ve.tileAnchorX,ve.tileAnchorY);let{x:at,y:ze,z:Qe}=I.projection.projectTilePoint(Be.x,Be.y,D.canonical);if(C){const[Vt,kt,Ot]=C(Be);at+=Vt,ze+=kt,Qe+=Ot}const Ve=[at,ze,Qe,1];if(n.transformMat4$1(Ve,Ve,i),!Ui(Ve,ee)){Pi(Me,Y);continue}const nt=lu(o.transform.cameraToCenterDistance,Ve[3]),Fe=n.evaluateSizeForFeature(O,G,ve),Xe=j?Fe/nt:Fe*nt,lt=Sr(at,ze,Qe,g);if(lt[3]<=0){Pi(Me,Y);continue}let st={};const dt=j?null:C,Dt=St(ve,Xe,!1,S,i,g,_,d.glyphOffsetArray,F,Y,se,lt,Be,st,ae,dt,I.projection,D,j);_e=Dt.useVertical,dt&&Dt.needsFlipping&&(st={}),(Dt.notEnoughRoom||_e||Dt.needsFlipping&&St(ve,Xe,!0,S,i,g,_,d.glyphOffsetArray,F,Y,se,lt,Be,st,ae,dt,I.projection,D,j).notEnoughRoom)&&Pi(Me,Y)}m?(d.text.dynamicLayoutVertexBuffer.updateData(Y),se&&d.text.globeExtVertexBuffer.updateData(se)):(d.icon.dynamicLayoutVertexBuffer.updateData(Y),se&&d.icon.globeExtVertexBuffer.updateData(se))}function cu(d,i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y){const{lineStartIndex:se,glyphStartIndex:F,segment:K}=S,ae=F+S.numGlyphs,le=se+S.lineLength,_e=i.getoffsetX(F),be=i.getoffsetX(ae-1),ve=ui(d*_e,o,m,g,_,j,K,se,le,C,D,I,O,G,!0,Q,ee,Y);if(!ve)return null;const Me=ui(d*be,o,m,g,_,j,K,se,le,C,D,I,O,G,!0,Q,ee,Y);return Me?{first:ve,last:Me}:null}function xa(d,i,o,m){return d===n.WritingMode.horizontal&&Math.abs(m)>Math.abs(o)?{useVertical:!0}:d===n.WritingMode.vertical?m>0?{needsFlipping:!0}:null:i!==rn.unknown&&function(g,_){return g===0||Math.abs(_/g)>io}(o,m)?i===rn.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function St(d,i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y,se,F,K){const ae=i/24,le=d.lineOffsetX*ae,_e=d.lineOffsetY*ae,{lineStartIndex:be,glyphStartIndex:ve,numGlyphs:Me,segment:ke,writingMode:Be,flipState:at}=d,ze=be+d.lineLength,Qe=Ve=>{if(I){const[lt,st,dt]=Ve.up,Dt=D.length;n.updateGlobeVertexNormal(I,Dt+0,lt,st,dt),n.updateGlobeVertexNormal(I,Dt+1,lt,st,dt),n.updateGlobeVertexNormal(I,Dt+2,lt,st,dt),n.updateGlobeVertexNormal(I,Dt+3,lt,st,dt)}const[nt,Fe,Xe]=Ve.point;n.addDynamicAttributes(D,nt,Fe,Xe,Ve.angle)};if(Me>1){const Ve=cu(ae,S,le,_e,o,O,G,d,C,_,Q,Y,!1,se,F,K);if(!Ve)return{notEnoughRoom:!0};if(m&&!o){let[nt,Fe,Xe]=Ve.first.point,[lt,st,dt]=Ve.last.point;[nt,Fe]=Sr(nt,Fe,Xe,j),[lt,st]=Sr(lt,st,dt,j);const Dt=xa(Be,at,(lt-nt)*ee,st-Fe);if(d.flipState=Dt&&Dt.needsFlipping?rn.flipRequired:rn.flipNotRequired,Dt)return Dt}Qe(Ve.first);for(let nt=ve+1;nt<ve+Me-1;nt++){const Fe=ui(ae*S.getoffsetX(nt),le,_e,o,O,G,ke,be,ze,C,_,Q,Y,!1,!1,se,F,K);if(!Fe)return D.length-=4*(nt-ve),{notEnoughRoom:!0};Qe(Fe)}Qe(Ve.last)}else{if(m&&!o){const nt=Sr(G.x,G.y,0,g),Fe=be+ke+1,Xe=new n.Point(C.getx(Fe),C.gety(Fe)),lt=Sr(Xe.x,Xe.y,0,g),st=lt[3]>0?lt:ss(G,Xe,nt,1,g,void 0,se,F.canonical),dt=xa(Be,at,(st[0]-nt[0])*ee,st[1]-nt[1]);if(d.flipState=dt&&dt.needsFlipping?rn.flipRequired:rn.flipNotRequired,dt)return dt}const Ve=ui(ae*S.getoffsetX(ve),le,_e,o,O,G,ke,be,ze,C,_,Q,Y,!1,!1,se,F,K);if(!Ve)return{notEnoughRoom:!0};Qe(Ve)}return{}}function as(d,i,o,m,g){const{x:_,y:j,z:S}=m.projectTilePoint(d.x,d.y,i);if(!g)return Sr(_,j,S,o);const[C,D,I]=g(d);return Sr(_+C,j+D,S+I,o)}function ss(d,i,o,m,g,_,j,S){const C=as(d.sub(i)._unit()._add(d),S,g,j,_);return n.sub(C,o,C),n.normalize(C,C),n.scaleAndAdd(C,o,C,m)}function ui(d,i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y,se,F){const K=m?d-i:d+i;let ae=K>0?1:-1,le=0;m&&(ae*=-1,le=Math.PI),ae<0&&(le+=Math.PI);let _e=S+j+(ae>0?0:1)|0,be=g,ve=g,Me=0,ke=0;const Be=Math.abs(K),at=[],ze=[];let Qe=_,Ve=Qe;const nt=()=>ss(Ve,Qe,ve,Be-Me+1,I,G,Y,se.canonical);for(;Me+ke<=Be;){if(_e+=ae,_e<S||_e>=C)return null;if(ve=be,Ve=Qe,at.push(ve),Q&&ze.push(Ve),Qe=new n.Point(D.getx(_e),D.gety(_e)),be=O[_e],!be){const Ot=as(Qe,se.canonical,I,Y,G);be=Ot[3]>0?O[_e]=Ot:nt()}Me+=ke,ke=n.distance(ve,be)}ee&&G&&(O[_e]&&(be=nt(),ke=n.distance(ve,be)),O[_e]=be);const Fe=(Be-Me)/ke,Xe=Qe.sub(Ve)._mult(Fe)._add(Ve),lt=n.sub([],be,ve),st=n.scaleAndAdd([],ve,lt,Fe);let dt=[0,0,1],Dt=lt[0],Vt=lt[1];if(F&&(dt=Y.upVector(se.canonical,Xe.x,Xe.y),dt[0]!==0||dt[1]!==0||dt[2]!==1)){const Ot=[dt[2],0,-dt[0]],is=n.cross([],dt,Ot);n.normalize(Ot,Ot),n.normalize(is,is),Dt=n.dot(lt,Ot),Vt=n.dot(lt,is)}if(o){const Ot=n.cross([],dt,lt);n.normalize(Ot,Ot),n.scaleAndAdd(st,st,Ot,o*ae)}const kt=le+Math.atan2(Vt,Dt);return at.push(st),Q&&ze.push(Xe),{point:st,angle:kt,path:at,tilePath:ze,up:dt}}function Pi(d,i){const o=i.length,m=o+4*d;i.resize(m),i.float32.fill(-1/0,4*o,4*m)}function rs(d,i,o){const m=i[0],g=i[1];return d[0]=o[0]*m+o[4]*g+o[12],d[1]=o[1]*m+o[5]*g+o[13],d[3]=o[3]*m+o[7]*g+o[15],d}const hi=100;class no{constructor(i,o,m=new Wn(i.width+200,i.height+200,25),g=new Wn(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=g,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+hi,this.screenBottomBoundary=i.height+hi,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,m,g,_,j,S,C){let D=m.projectedAnchorX,I=m.projectedAnchorY,O=m.projectedAnchorZ;const G=m.elevation,Q=m.tileID,ee=i.getProjection();if(G&&Q){const[be,ve,Me]=ee.upVector(Q.canonical,m.tileAnchorX,m.tileAnchorY),ke=ee.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=be*G*ke,I+=ve*G*ke,O+=Me*G*ke}const Y=this.projectAndGetPerspectiveRatio(S,D,I,O,m.tileID,ee.name==="globe"||!!G||this.transform.pitch>0,ee),se=j*Y.perspectiveRatio,F=(m.x1*o+g.x-m.padding)*se+Y.point.x,K=(m.y1*o+g.y-m.padding)*se+Y.point.y,ae=(m.x2*o+g.x+m.padding)*se+Y.point.x,le=(m.y2*o+g.y+m.padding)*se+Y.point.y,_e=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(F,K,ae,le)||!_&&this.grid.hitTest(F,K,ae,le,C)||_e?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[F,K,ae,le],offscreen:this.isOffscreen(F,K,ae,le),occluded:!1}}placeCollisionCircles(i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y){const se=[],F=this.transform.elevation,K=i.getProjection(),ae=F?F.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,K):null,le=new n.Point(m.tileAnchorX,m.tileAnchorY);let{x:_e,y:be,z:ve}=K.projectTilePoint(le.x,le.y,Y.canonical);if(ae){const[Xe,lt,st]=ae(le);_e+=Xe,be+=lt,ve+=st}const Me=K.name==="globe",ke=this.projectAndGetPerspectiveRatio(S,_e,be,ve,Y,Me||!!F||this.transform.pitch>0,K),{perspectiveRatio:Be}=ke,at=(O?j/Be:j*Be)/n.ONE_EM,ze=Sr(_e,be,ve,C),Qe=ke.signedDistanceFromCamera>0?cu(at,_,m.lineOffsetX*at,m.lineOffsetY*at,!1,ze,le,m,g,C,{},F&&!O?ae:null,O&&!!F,K,Y,O):null;let Ve=!1,nt=!1,Fe=!0;if(Qe&&!ke.occluded){const Xe=.5*Q*Be+ee,lt=new n.Point(-100,-100),st=new n.Point(this.screenRightBoundary,this.screenBottomBoundary),dt=new pc,{first:Dt,last:Vt}=Qe,kt=Dt.path.length;let Ot=[];for(let Pt=kt-1;Pt>=1;Pt--)Ot.push(Dt.path[Pt]);for(let Pt=1;Pt<Vt.path.length;Pt++)Ot.push(Vt.path[Pt]);const is=2.5*Xe;D&&(Ot=Ot.map(([Pt,bs,ws],js)=>(ae&&!Me&&(ws=ae(js<kt-1?Dt.tilePath[kt-1-js]:Vt.tilePath[js-kt+2])[2]),Sr(Pt,bs,ws,D))),Ot.some(Pt=>Pt[3]<=0)&&(Ot=[]));let ts=[];if(Ot.length>0){let Pt=1/0,bs=-1/0,ws=1/0,js=-1/0;for(const Ns of Ot)Pt=Math.min(Pt,Ns[0]),ws=Math.min(ws,Ns[1]),bs=Math.max(bs,Ns[0]),js=Math.max(js,Ns[1]);bs>=lt.x&&Pt<=st.x&&js>=lt.y&&ws<=st.y&&(ts=[Ot.map(Ns=>new n.Point(Ns[0],Ns[1]))],(Pt<lt.x||bs>st.x||ws<lt.y||js>st.y)&&(ts=n.clipLine(ts,lt.x,lt.y,st.x,st.y)))}for(const Pt of ts){dt.reset(Pt,.25*Xe);let bs=0;bs=dt.length<=.5*Xe?1:Math.ceil(dt.paddedLength/is)+1;for(let ws=0;ws<bs;ws++){const js=ws/Math.max(bs-1,1),Ns=dt.lerp(js),qr=Ns.x+hi,Er=Ns.y+hi;se.push(qr,Er,Xe,0);const ji=qr-Xe,Gi=Er-Xe,Bs=qr+Xe,Ss=Er+Xe;if(Fe=Fe&&this.isOffscreen(ji,Gi,Bs,Ss),nt=nt||this.isInsideGrid(ji,Gi,Bs,Ss),!o&&this.grid.hitTestCircle(qr,Er,Xe,G)&&(Ve=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!I&&Ve||!nt?[]:se,offscreen:Fe,collisionDetected:Ve,occluded:ke.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let m=1/0,g=1/0,_=-1/0,j=-1/0;for(const I of i){const O=new n.Point(I.x+hi,I.y+hi);m=Math.min(m,O.x),g=Math.min(g,O.y),_=Math.max(_,O.x),j=Math.max(j,O.y),o.push(O)}const S=this.grid.query(m,g,_,j).concat(this.ignoredGrid.query(m,g,_,j)),C={},D={};for(const I of S){const O=I.key;if(C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]={}),C[O.bucketInstanceId][O.featureIndex])continue;const G=[new n.Point(I.x1,I.y1),new n.Point(I.x2,I.y1),new n.Point(I.x2,I.y2),new n.Point(I.x1,I.y2)];n.polygonIntersectsPolygon(o,G)&&(C[O.bucketInstanceId][O.featureIndex]=!0,D[O.bucketInstanceId]===void 0&&(D[O.bucketInstanceId]=[]),D[O.bucketInstanceId].push(O.featureIndex))}return D}insertCollisionBox(i,o,m,g,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:g,collisionGroupID:_},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,m,g,_){const j=o?this.ignoredGrid:this.grid,S={bucketInstanceId:m,featureIndex:g,collisionGroupID:_};for(let C=0;C<i.length;C+=4)j.insertCircle(S,i[C],i[C+1],i[C+2])}projectAndGetPerspectiveRatio(i,o,m,g,_,j,S){const C=[o,m,g,1];let D=!1;g||this.transform.pitch>0?(n.transformMat4$1(C,C,i),this.fogState&&_&&S.name!=="globe"&&(D=function(G,Q,ee,Y,se,F){const K=F.calculateFogTileMatrix(se),ae=[Q,ee,Y];return n.transformMat4(ae,ae,K),ft(G,ae,F.pitch,F._fov)}(this.fogState,o,m,g,_.toUnwrapped(),this.transform)>.9)):rs(C,C,i);const I=C[3];return{point:new n.Point((C[0]/I+1)/2*this.transform.width+hi,(-C[1]/I+1)/2*this.transform.height+hi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/I*.5,1.5),signedDistanceFromCamera:I,occluded:j&&C[2]>I||D}}isOffscreen(i,o,m,g){return m<hi||i>=this.screenRightBoundary||g<hi||o>this.screenBottomBoundary}isInsideGrid(i,o,m,g){return m>=0&&i<this.gridRightBoundary&&g>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=n.identity([]);return n.translate(i,i,[-100,-100,0]),i}}function Hn(d,i,o){const m=i.createTileMatrix(d,d.worldSize,o.toUnwrapped());return n.multiply(new Float32Array(16),d.projMatrix,m)}function _i(d,i,o){if(i.projection.name===o.projection.name)return d.projMatrix;const m=o.clone();return m.setProjection(i.projection),Hn(m,i.getProjection(),d)}function Fs(d,i,o){return i.name===o.projection.name?d.projMatrix:Hn(o,i,d)}class du{constructor(i,o,m,g){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):g&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class an{constructor(i,o,m,g,_,j=!1){this.text=new du(i?i.text:null,o,m,_),this.icon=new du(i?i.icon:null,o,g,_),this.clipped=j}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ao{constructor(i,o,m,g=!1){this.text=i,this.icon=o,this.skipFade=m,this.clipped=g}}class oo{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class gc{constructor(i,o,m,g,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=m,this.bucketIndex=g,this.tileID=_}}class uu{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:m=>m.collisionGroupID===o}}return this.collisionGroups[i]}}function lo(d,i,o,m,g){const{horizontalAlign:_,verticalAlign:j}=n.getAnchorAlignment(d),S=-(_-.5)*i,C=-(j-.5)*o,D=n.evaluateVariableOffset(d,m);return new n.Point(S+D[0]*g,C+D[1]*g)}function co(d,i,o,m,g){const _=new n.Point(d,i);return o&&_._rotate(m?g:-g),_}class sl{constructor(i,o,m,g,_){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new no(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new uu(m),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,m,g){const _=m.getBucket(o),j=m.latestFeatureIndex;if(!_||!j||o.id!==_.layerIds[0])return;const S=_.layers[0].layout,C=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),I=m.tileSize/n.EXTENT,O=m.tileID.toUnwrapped();this.transform.setProjection(_.projection);const G=(Q=m.tileID,ee=_.getProjection(),Y=this.transform,ee.name===this.projection?Y.calculateProjMatrix(Q.toUnwrapped()):Hn(Y,ee,Q));var Q,ee,Y;const se=S.get("text-pitch-alignment")==="map",F=S.get("text-rotation-alignment")==="map";o.compileFilter();const K=o.dynamicFilter(),ae=o.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(m),_e=nn(G,m.tileID.canonical,se,F,this.transform,_.getProjection(),le);let be=null;if(se){const ke=ir(G,m.tileID.canonical,se,F,this.transform,_.getProjection(),le);be=n.multiply([],this.transform.labelPlaneMatrix,ke)}let ve=null;K&&m.latestFeatureIndex&&(ve={unwrappedTileID:O,dynamicFilter:K,dynamicFilterNeedsFeature:ae,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new gc(_.bucketInstanceId,j,_.sourceLayerIndex,_.index,m.tileID);const Me={bucket:_,layout:S,posMatrix:G,textLabelPlaneMatrix:_e,labelToScreenMatrix:be,clippingData:ve,scale:D,textPixelRatio:I,holdingForFade:m.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(g)for(const ke of _.sortKeyRanges){const{sortKey:Be,symbolInstanceStart:at,symbolInstanceEnd:ze}=ke;i.push({sortKey:Be,symbolInstanceStart:at,symbolInstanceEnd:ze,parameters:Me})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y,se,F,K){const{textOffset0:ae,textOffset1:le,crossTileID:_e}=G,be=[ae,le],ve=lo(i,m,g,be,_),Me=this.collisionIndex.placeCollisionBox(ee,_,o,co(ve.x,ve.y,j,S,this.transform.angle),O,C,D,I.predicate);if(se){const ke=ee.getSymbolInstanceIconSize(K,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,ke,se,co(ve.x,ve.y,j,S,this.transform.angle),O,C,D,I.predicate).box.length===0)return}if(Me.box.length>0){let ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(ke=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:be,width:m,height:g,anchor:i,textScale:_,prevAnchor:ke},this.markUsedJustification(ee,i,G,Y),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,Y,G),this.placedOrientations[_e]=Y),{shift:ve,placedGlyphBoxes:Me}}}placeLayerBucketPart(i,o,m,g){const{bucket:_,layout:j,posMatrix:S,textLabelPlaneMatrix:C,labelToScreenMatrix:D,clippingData:I,textPixelRatio:O,holdingForFade:G,collisionBoxArray:Q,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:Y,collisionGroup:se}=i.parameters,F=j.get("text-optional"),K=j.get("icon-optional"),ae=j.get("text-allow-overlap"),le=j.get("icon-allow-overlap"),_e=j.get("text-rotation-alignment")==="map",be=j.get("text-pitch-alignment")==="map",ve=j.get("icon-text-fit")!=="none",Me=j.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let ke=ae&&(le||!_.hasIconData()||K),Be=le&&(ae||!_.hasTextData()||F);!_.collisionArrays&&Q&&_.deserializeCollisionBoxes(Q),m&&g&&_.updateCollisionDebugBuffers(this.transform.zoom,Q);const at=(ze,Qe,Ve)=>{const{crossTileID:nt,numVerticalGlyphVertices:Fe}=ze;if(I){const Bs={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ss=null;if(I.dynamicFilterNeedsFeature){const fs=this.retainedQueryData[_.bucketInstanceId];Ss=I.featureIndex.loadFeature({featureIndex:ze.featureIndex,bucketIndex:fs.bucketIndex,sourceLayerIndex:fs.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(Bs,Ss,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new n.Point(ze.tileAnchorX,ze.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[nt]=new ao(!1,!1,!1,!0),void o.add(nt)}if(o.has(nt))return;if(G)return void(this.placements[nt]=new ao(!1,!1,!1));let Xe=!1,lt=!1,st=!0,dt=!1,Dt=!1,Vt=null,kt={box:null,offscreen:null,occluded:null},Ot={box:null,offscreen:null,occluded:null},is=null,ts=null,Pt=null,bs=0,ws=0,js=0;Ve.textFeatureIndex?bs=Ve.textFeatureIndex:ze.useRuntimeCollisionCircles&&(bs=ze.featureIndex),Ve.verticalTextFeatureIndex&&(ws=Ve.verticalTextFeatureIndex);const Ns=Bs=>{Bs.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const Ss=this.transform.elevation;(Ss||Bs.elevation)&&(Bs.elevation=Ss?Ss.getAtTileOffset(Bs.tileID,Bs.tileAnchorX,Bs.tileAnchorY):0)},qr=Ve.textBox;if(qr){Ns(qr);const Bs=fs=>{let nr=n.WritingMode.horizontal;if(_.allowVerticalPlacement&&!fs&&this.prevPlacement){const Xr=this.prevPlacement.placedOrientations[nt];Xr&&(this.placedOrientations[nt]=Xr,nr=Xr,this.markUsedOrientation(_,nr,ze))}return nr},Ss=(fs,nr)=>{if(_.allowVerticalPlacement&&Fe>0&&Ve.verticalTextBox){for(const Xr of _.writingModes)if(Xr===n.WritingMode.vertical?(kt=nr(),Ot=kt):kt=fs(),kt&&kt.box&&kt.box.length)break}else kt=fs()};if(j.get("text-variable-anchor")){let fs=j.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt]){const zs=this.prevPlacement.variableOffsets[nt];fs.indexOf(zs.anchor)>0&&(fs=fs.filter(ti=>ti!==zs.anchor),fs.unshift(zs.anchor))}const nr=(zs,ti,kl)=>{const sa=_.getSymbolInstanceTextSize(ee,ze,this.transform.zoom,Qe),Ao=(zs.x2-zs.x1)*sa+2*zs.padding,mn=(zs.y2-zs.y1)*sa+2*zs.padding,Pn=ve&&!le?ti:null;Pn&&Ns(Pn);let ra={box:[],offscreen:!1,occluded:!1};const Al=ae?2*fs.length:fs.length;for(let Mo=0;Mo<Al;++Mo){const ad=this.attemptAnchorPlacement(fs[Mo%fs.length],zs,Ao,mn,sa,_e,be,O,S,se,Mo>=fs.length,ze,Qe,_,kl,Pn,ee,Y);if(ad&&(ra=ad.placedGlyphBoxes,ra&&ra.box&&ra.box.length)){Xe=!0,Vt=ad.shift;break}}return ra};Ss(()=>nr(qr,Ve.iconBox,n.WritingMode.horizontal),()=>{const zs=Ve.verticalTextBox;return zs&&Ns(zs),_.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&Fe>0&&zs?nr(zs,Ve.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),kt&&(Xe=kt.box,st=kt.offscreen,dt=kt.occluded);const Xr=Bs(!(!kt||!kt.box));if(!Xe&&this.prevPlacement){const zs=this.prevPlacement.variableOffsets[nt];zs&&(this.variableOffsets[nt]=zs,this.markUsedJustification(_,zs.anchor,ze,Xr))}}else{const fs=(nr,Xr)=>{const zs=_.getSymbolInstanceTextSize(ee,ze,this.transform.zoom,Qe),ti=this.collisionIndex.placeCollisionBox(_,zs,nr,new n.Point(0,0),ae,O,S,se.predicate);return ti&&ti.box&&ti.box.length&&(this.markUsedOrientation(_,Xr,ze),this.placedOrientations[nt]=Xr),ti};Ss(()=>fs(qr,n.WritingMode.horizontal),()=>{const nr=Ve.verticalTextBox;return _.allowVerticalPlacement&&Fe>0&&nr?(Ns(nr),fs(nr,n.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Bs(!!(kt&&kt.box&&kt.box.length))}}if(is=kt,Xe=is&&is.box&&is.box.length>0,st=is&&is.offscreen,dt=is&&is.occluded,ze.useRuntimeCollisionCircles){const Bs=_.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex>=0?ze.centerJustifiedTextSymbolIndex:ze.verticalPlacedTextSymbolIndex),Ss=n.evaluateSizeForFeature(_.textSizeData,ee,Bs),fs=j.get("text-padding");ts=this.collisionIndex.placeCollisionCircles(_,ae,Bs,_.lineVertexArray,_.glyphOffsetArray,Ss,S,C,D,m,be,se.predicate,ze.collisionCircleDiameter*Ss/n.ONE_EM,fs,this.retainedQueryData[_.bucketInstanceId].tileID),Xe=ae||ts.circles.length>0&&!ts.collisionDetected,st=st&&ts.offscreen,dt=ts.occluded}if(Ve.iconFeatureIndex&&(js=Ve.iconFeatureIndex),Ve.iconBox){const Bs=Ss=>{Ns(Ss);const fs=ve&&Vt?co(Vt.x,Vt.y,_e,be,this.transform.angle):new n.Point(0,0),nr=_.getSymbolInstanceIconSize(Y,this.transform.zoom,ze.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,nr,Ss,fs,le,O,S,se.predicate)};Ot&&Ot.box&&Ot.box.length&&Ve.verticalIconBox?(Pt=Bs(Ve.verticalIconBox),lt=Pt.box.length>0):(Pt=Bs(Ve.iconBox),lt=Pt.box.length>0),st=st&&Pt.offscreen,Dt=Pt.occluded}const Er=F||ze.numHorizontalGlyphVertices===0&&Fe===0,ji=K||ze.numIconVertices===0;if(Er||ji?ji?Er||(lt=lt&&Xe):Xe=lt&&Xe:lt=Xe=lt&&Xe,Xe&&is&&is.box&&this.collisionIndex.insertCollisionBox(is.box,j.get("text-ignore-placement"),_.bucketInstanceId,Ot&&Ot.box&&ws?ws:bs,se.ID),lt&&Pt&&this.collisionIndex.insertCollisionBox(Pt.box,j.get("icon-ignore-placement"),_.bucketInstanceId,js,se.ID),ts&&(Xe&&this.collisionIndex.insertCollisionCircles(ts.circles,j.get("text-ignore-placement"),_.bucketInstanceId,bs,se.ID),m)){const Bs=_.bucketInstanceId;let Ss=this.collisionCircleArrays[Bs];Ss===void 0&&(Ss=this.collisionCircleArrays[Bs]=new oo);for(let fs=0;fs<ts.circles.length;fs+=4)Ss.circles.push(ts.circles[fs+0]),Ss.circles.push(ts.circles[fs+1]),Ss.circles.push(ts.circles[fs+2]),Ss.circles.push(ts.collisionDetected?1:0)}const Gi=_.projection.name!=="globe";ke=ke&&(Gi||!dt),Be=Be&&(Gi||!Dt),this.placements[nt]=new ao(Xe||ke,lt||Be,st||_.justReloaded),o.add(nt)};if(Me){const ze=_.getSortedSymbolIndexes(this.transform.angle);for(let Qe=ze.length-1;Qe>=0;--Qe){const Ve=ze[Qe];at(_.symbolInstances.get(Ve),Ve,_.collisionArrays[Ve])}}else for(let ze=i.symbolInstanceStart;ze<i.symbolInstanceEnd;ze++)at(_.symbolInstances.get(ze),ze,_.collisionArrays[ze]);if(m&&_.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[_.bucketInstanceId];n.invert(ze.invProjMatrix,S),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(i,o,m,g){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:C,crossTileID:D}=m,I=n.getAnchorJustification(o),O=g===n.WritingMode.vertical?C:I==="left"?_:I==="center"?j:I==="right"?S:-1;_>=0&&(i.text.placedSymbolArray.get(_).crossTileID=O>=0&&_!==O?0:D),j>=0&&(i.text.placedSymbolArray.get(j).crossTileID=O>=0&&j!==O?0:D),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=O>=0&&S!==O?0:D),C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=O>=0&&C!==O?0:D)}markUsedOrientation(i,o,m){const g=o===n.WritingMode.horizontal||o===n.WritingMode.horizontalOnly?o:0,_=o===n.WritingMode.vertical?o:0,{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D}=m,I=i.text.placedSymbolArray;j>=0&&(I.get(j).placedOrientation=g),S>=0&&(I.get(S).placedOrientation=g),C>=0&&(I.get(C).placedOrientation=g),D>=0&&(I.get(D).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let m=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const g=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},j=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const C in this.placements){const D=this.placements[C],I=_[C];I?(this.opacities[C]=new an(I,g,D.text,D.icon,null,D.clipped),m=m||D.text!==I.text.placed||D.icon!==I.icon.placed):(this.opacities[C]=new an(null,g,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const C in _){const D=_[C];if(!this.opacities[C]){const I=new an(D,g,!1,!1);I.isHidden()||(this.opacities[C]=I,m=m||D.text.placed||D.icon.placed)}}for(const C in j)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=j[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const m=new Set;for(const g of o){const _=g.getBucket(i);_&&g.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,m,g.collisionBoxArray)}}updateBucketOpacities(i,o,m){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const g=i.layers[0].layout,_=!!i.layers[0].dynamicFilter(),j=new an(null,0,!1,!1,!0),S=g.get("text-allow-overlap"),C=g.get("icon-allow-overlap"),D=g.get("text-variable-anchor"),I=g.get("text-rotation-alignment")==="map",O=g.get("text-pitch-alignment")==="map",G=g.get("icon-text-fit")!=="none",Q=new an(null,0,S&&(C||!i.hasIconData()||g.get("icon-optional")),C&&(S||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const ee=(se,F,K)=>{for(let ae=0;ae<F/4;ae++)se.opacityVertexArray.emplaceBack(K)};let Y=0;for(let se=0;se<i.symbolInstances.length;se++){const F=i.symbolInstances.get(se),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:ae,crossTileID:le,numIconVertices:_e}=F,be=o.has(le);let ve=this.opacities[le];be?ve=j:ve||(ve=Q,this.opacities[le]=ve),o.add(le);const Me=K>0||ae>0,ke=_e>0,Be=this.placedOrientations[le],at=Be===n.WritingMode.vertical,ze=Be===n.WritingMode.horizontal||Be===n.WritingMode.horizontalOnly;if(!Me&&!ke||ve.isHidden()||Y++,Me){const Qe=uo(ve.text);ee(i.text,K,at?Zs:Qe),ee(i.text,ae,ze?Zs:Qe);const Ve=ve.text.isHidden(),{leftJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:Fe,rightJustifiedTextSymbolIndex:Xe,verticalPlacedTextSymbolIndex:lt}=F,st=i.text.placedSymbolArray,dt=Ve||at?1:0;nt>=0&&(st.get(nt).hidden=dt),Fe>=0&&(st.get(Fe).hidden=dt),Xe>=0&&(st.get(Xe).hidden=dt),lt>=0&&(st.get(lt).hidden=Ve||ze?1:0);const Dt=this.variableOffsets[le];Dt&&this.markUsedJustification(i,Dt.anchor,F,Be);const Vt=this.placedOrientations[le];Vt&&(this.markUsedJustification(i,"left",F,Vt),this.markUsedOrientation(i,Vt,F))}if(ke){const Qe=uo(ve.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:nt}=F,Fe=i.icon.placedSymbolArray,Xe=ve.icon.isHidden()?1:0;Ve>=0&&(ee(i.icon,_e,at?Zs:Qe),Fe.get(Ve).hidden=Xe),nt>=0&&(ee(i.icon,F.numVerticalIconVertices,ze?Zs:Qe),Fe.get(nt).hidden=Xe)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Qe=i.collisionArrays[se];if(Qe){let Ve=new n.Point(0,0),nt=!0;if(Qe.textBox||Qe.verticalTextBox){if(D){const Xe=this.variableOffsets[le];Xe?(Ve=lo(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textScale),I&&Ve._rotate(O?this.transform.angle:-this.transform.angle)):nt=!1}_&&(nt=!ve.clipped),Qe.textBox&&ya(i.textCollisionBox.collisionVertexArray,ve.text.placed,!nt||at,Ve.x,Ve.y),Qe.verticalTextBox&&ya(i.textCollisionBox.collisionVertexArray,ve.text.placed,!nt||ze,Ve.x,Ve.y)}const Fe=nt&&!!(!ze&&Qe.verticalIconBox);Qe.iconBox&&ya(i.iconCollisionBox.collisionVertexArray,ve.icon.placed,Fe,G?Ve.x:0,G?Ve.y:0),Qe.verticalIconBox&&ya(i.iconCollisionBox.collisionVertexArray,ve.icon.placed,!Fe,G?Ve.x:0,G?Ve.y:0)}}}if(i.fullyClipped=Y===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=se.invProjMatrix,i.placementViewportMatrix=se.viewportMatrix,i.collisionCircleArray=se.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const m=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function ya(d,i,o,m,g){d.emplaceBack(i?1:0,o?1:0,m||0,g||0),d.emplaceBack(i?1:0,o?1:0,m||0,g||0),d.emplaceBack(i?1:0,o?1:0,m||0,g||0),d.emplaceBack(i?1:0,o?1:0,m||0,g||0)}const Yr=Math.pow(2,25),Js=Math.pow(2,24),xc=Math.pow(2,17),yc=Math.pow(2,16),ei=Math.pow(2,9),vi=Math.pow(2,8),hu=Math.pow(2,1);function uo(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const i=d.placed?1:0,o=Math.floor(127*d.opacity);return o*Yr+i*Js+o*xc+i*yc+o*ei+i*vi+o*hu+i}const Zs=0;class ho{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,m,g,_){const j=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(j,g,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<j.length;){const S=j[this._currentPartIndex];if(o.placeLayerBucketPart(S,this._seenCrossTileIDs,m,S.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class _c{constructor(i,o,m,g,_,j,S,C){this.placement=new sl(i,_,j,S,C),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(i,o,m){const g=n.exported.now(),_=()=>{const j=n.exported.now()-g;return!this._forceFullPlacement&&j>2};for(;this._currentPlacementIndex>=0;){const j=o[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=S)&&(!j.maxzoom||j.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ho(j)),this._inProgressLayer.continuePlacement(m[j.source],this.placement,this._showCollisionBoxes,j,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Xn=512/n.EXTENT/2;class Lr{constructor(i,o,m){this.tileID=i,this.bucketInstanceId=m,this.index=new n.KDBush(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=i.canonical.x*n.EXTENT,_=i.canonical.y*n.EXTENT;for(let j=0;j<o.length;j++){const{key:S,crossTileID:C,tileAnchorX:D,tileAnchorY:I}=o.get(j),O=Math.floor((g+D)*Xn),G=Math.floor((_+I)*Xn);this.index.add(O,G),this.keys.push(S),this.crossTileIDs.push(C)}this.index.finish()}findMatches(i,o,m){const g=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),_=Xn/Math.pow(2,o.canonical.z-this.tileID.canonical.z),j=o.canonical.x*n.EXTENT,S=o.canonical.y*n.EXTENT;for(let C=0;C<i.length;C++){const D=i.get(C);if(D.crossTileID)continue;const{key:I,tileAnchorX:O,tileAnchorY:G}=D,Q=Math.floor((j+O)*_),ee=Math.floor((S+G)*_),Y=this.index.range(Q-g,ee-g,Q+g,ee+g);for(const se of Y){const F=this.crossTileIDs[se];if(this.keys[se]===I&&!m.has(F)){m.add(F),D.crossTileID=F;break}}}}}class vc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const m in this.indexes){const g=this.indexes[m],_={};for(const j in g){const S=g[j];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),_[S.tileID.key]=S}this.indexes[m]=_}this.lng=i}addBucket(i,o,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const g=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const j=this.indexes[_];if(Number(_)>i.overscaledZ)for(const S in j){const C=j[S];C.tileID.isChildOf(i)&&C.findMatches(o.symbolInstances,i,g)}else{const S=j[i.scaledTo(Number(_)).key];S&&S.findMatches(o.symbolInstances,i,g)}}for(let _=0;_<o.symbolInstances.length;_++){const j=o.symbolInstances.get(_);j.crossTileID||(j.crossTileID=m.generate(),g.add(j.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Lr(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const m of o.crossTileIDs)this.usedCrossTileIDs[i].delete(m)}removeStaleBuckets(i){let o=!1;for(const m in this.indexes){const g=this.indexes[m];for(const _ in g)i[g[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,g[_]),delete g[_],o=!0)}return o}}class on{constructor(){this.layerIndexes={},this.crossTileIDs=new vc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,m,g){let _=this.layerIndexes[i.id];_===void 0&&(_=this.layerIndexes[i.id]=new bc);let j=!1;const S={};g.name!=="globe"&&_.handleWrapJump(m);for(const C of o){const D=C.getBucket(i);D&&i.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,D,this.crossTileIDs)&&(j=!0),S[D.bucketInstanceId]=!0)}return _.removeStaleBuckets(S)&&(j=!0),j}pruneUnusedLayers(i){const o={};i.forEach(m=>{o[m]=!0});for(const m in this.layerIndexes)o[m]||delete this.layerIndexes[m]}}const An=(d,i)=>n.emitValidationErrors(d,i&&i.filter(o=>o.identifier!=="source.canvas")),rl=n.pick(xs,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),_m=n.pick(xs,["setCenter","setZoom","setBearing","setPitch"]),wc={version:8,layers:[],sources:{}},_a={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Vi extends n.Evented{constructor(i,o={}){super(),this.map=i,this.dispatcher=new ns(ga(),this),this.imageManager=new je,this.imageManager.setEventedParent(this),this.glyphManager=new n.GlyphManager(i._requestManager,o.localFontFamily?n.LocalGlyphMode.all:o.localIdeographFontFamily?n.LocalGlyphMode.ideographs:n.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new on,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const m=this;this._rtlTextPluginCallback=Vi.registerForPluginStateChange(g=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(_,j)=>{if(n.triggerPluginCompletionEvent(_),j&&j.every(S=>S))for(const S in m._sourceCaches){const C=m._sourceCaches[S],D=C.getSource().type;D!=="vector"&&D!=="geojson"||C.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const _=this.getSource(g.sourceId);if(_&&_.vectorLayerIds)for(const j in this._layers){const S=this._layers[j];S.source===_.id&&this._validateLayer(S)}})}loadURL(i,o={}){this.fire(new n.Event("dataloading",{dataType:"style"}));const m=typeof o.validate=="boolean"?o.validate:!n.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,o.accessToken);const g=this.map._requestManager.transformRequest(i,n.ResourceType.Style);this._request=n.getJSON(g,(_,j)=>{this._request=null,_?this.fire(new n.ErrorEvent(_)):j&&this._load(j,m)})}loadJSON(i,o={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(wc,!1)}_updateLayerCount(i,o){const m=o?1:-1;i.is3D()&&(this._num3DLayers+=m),i.type==="circle"&&(this._numCircleLayers+=m),i.type==="symbol"&&(this._numSymbolLayers+=m)}_load(i,o){if(o&&An(this,n.validateStyle(i)))return;this._loaded=!0,this.stylesheet=n.clone$1(i),this._updateMapProjection();for(const g in i.sources)this.addSource(g,i.sources[g],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const m=ou(this.stylesheet.layers);this._order=m.map(g=>g.id),this._layers={},this._serializedLayers={};for(const g of m){const _=n.createStyleLayer(g);_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new it(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(o,m,g){let _,j,S;const C=n.exported.devicePixelRatio>1?"@2x":"";let D=n.getJSON(m.transformRequest(m.normalizeSpriteURL(o,C,".json"),n.ResourceType.SpriteJSON),(G,Q)=>{D=null,S||(S=G,_=Q,O())}),I=n.getImage(m.transformRequest(m.normalizeSpriteURL(o,C,".png"),n.ResourceType.SpriteImage),(G,Q)=>{I=null,S||(S=G,j=Q,O())});function O(){if(S)g(S);else if(_&&j){const G=n.exported.getImageData(j),Q={};for(const ee in _){const{width:Y,height:se,x:F,y:K,sdf:ae,pixelRatio:le,stretchX:_e,stretchY:be,content:ve}=_[ee],Me=new n.RGBAImage({width:Y,height:se});n.RGBAImage.copy(G,Me,{x:F,y:K},{x:0,y:0},{width:Y,height:se}),Q[ee]={data:Me,pixelRatio:le,sdf:ae,stretchX:_e,stretchY:be,content:ve}}g(null,Q)}}return{cancel(){D&&(D.cancel(),D=null),I&&(I.cancel(),I=null)}}}(i,this.map._requestManager,(o,m)=>{if(this._spriteRequest=null,o)this.fire(new n.ErrorEvent(o));else if(m)for(const g in m)this.imageManager.addImage(g,m[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(i){const o=this.getSource(i.source);if(!o)return;const m=i.sourceLayer;m&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(m)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const o=[];for(const m of i){const g=this._layers[m];g.type!=="custom"&&o.push(g.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&(typeof i.isLayerDraped=="function"?i.isLayerDraped():_a[i.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const o=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(g.length||_.length)&&this._updateWorkerLayers(g,_);for(const j in this._updatedSources){const S=this._updatedSources[j];S==="reload"?this._reloadSource(j):S==="clear"&&this._clearSource(j)}this._updateTilesForChangedImages();for(const j in this._updatedPaintProps)this._layers[j].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const m={};for(const g in this._sourceCaches){const _=this._sourceCaches[g];m[g]=_.used,_.used=!1}for(const g of this._order){const _=this._layers[g];if(_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)){const S=this._getLayerSourceCache(_);S&&(S.used=!0)}const j=this.map.painter;if(j){const S=_.getProgramIds();if(!S)continue;const C=_.getProgramConfiguration(i.zoom);for(const D of S)j.useProgram(D,C)}}for(const g in m){const _=this._sourceCaches[g];m[g]!==_.used&&_.getSource().fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),An(this,n.validateStyle(i)))return!1;(i=n.clone$1(i)).layers=ou(i.layers);const o=function(g,_){if(!g)return[{command:xs.setStyle,args:[_]}];let j=[];try{if(!P(g.version,_.version))return[{command:xs.setStyle,args:[_]}];P(g.center,_.center)||j.push({command:xs.setCenter,args:[_.center]}),P(g.zoom,_.zoom)||j.push({command:xs.setZoom,args:[_.zoom]}),P(g.bearing,_.bearing)||j.push({command:xs.setBearing,args:[_.bearing]}),P(g.pitch,_.pitch)||j.push({command:xs.setPitch,args:[_.pitch]}),P(g.sprite,_.sprite)||j.push({command:xs.setSprite,args:[_.sprite]}),P(g.glyphs,_.glyphs)||j.push({command:xs.setGlyphs,args:[_.glyphs]}),P(g.transition,_.transition)||j.push({command:xs.setTransition,args:[_.transition]}),P(g.light,_.light)||j.push({command:xs.setLight,args:[_.light]}),P(g.fog,_.fog)||j.push({command:xs.setFog,args:[_.fog]}),P(g.projection,_.projection)||j.push({command:xs.setProjection,args:[_.projection]});const S={},C=[];(function(O,G,Q,ee){let Y;for(Y in G=G||{},O=O||{})O.hasOwnProperty(Y)&&(G.hasOwnProperty(Y)||ro(Y,Q,ee));for(Y in G){if(!G.hasOwnProperty(Y))continue;const se=G[Y];O.hasOwnProperty(Y)?P(O[Y],se)||(O[Y].type==="geojson"&&se.type==="geojson"&&tl(O,G,Y)?Q.push({command:xs.setGeoJSONSourceData,args:[Y,se.data]}):hc(Y,G,Q,ee)):uc(Y,G,Q)}})(g.sources,_.sources,C,S);const D=[];g.layers&&g.layers.forEach(O=>{O.source&&S[O.source]?j.push({command:xs.removeLayer,args:[O.id]}):D.push(O)});let I=g.terrain;I&&S[I.source]&&(j.push({command:xs.setTerrain,args:[void 0]}),I=void 0),j=j.concat(C),P(I,_.terrain)||j.push({command:xs.setTerrain,args:[_.terrain]}),function(O,G,Q){G=G||[];const ee=(O=O||[]).map(sn),Y=G.map(sn),se=O.reduce(mc,{}),F=G.reduce(mc,{}),K=ee.slice(),ae=Object.create(null);let le,_e,be,ve,Me,ke,Be;for(le=0,_e=0;le<ee.length;le++)be=ee[le],F.hasOwnProperty(be)?_e++:(Q.push({command:xs.removeLayer,args:[be]}),K.splice(K.indexOf(be,_e),1));for(le=0,_e=0;le<Y.length;le++)be=Y[Y.length-1-le],K[K.length-1-le]!==be&&(se.hasOwnProperty(be)?(Q.push({command:xs.removeLayer,args:[be]}),K.splice(K.lastIndexOf(be,K.length-_e),1)):_e++,ke=K[K.length-le],Q.push({command:xs.addLayer,args:[F[be],ke]}),K.splice(K.length-le,0,be),ae[be]=!0);for(le=0;le<Y.length;le++)if(be=Y[le],ve=se[be],Me=F[be],!ae[be]&&!P(ve,Me))if(P(ve.source,Me.source)&&P(ve["source-layer"],Me["source-layer"])&&P(ve.type,Me.type)){for(Be in Bi(ve.layout,Me.layout,Q,be,null,xs.setLayoutProperty),Bi(ve.paint,Me.paint,Q,be,null,xs.setPaintProperty),P(ve.filter,Me.filter)||Q.push({command:xs.setFilter,args:[be,Me.filter]}),P(ve.minzoom,Me.minzoom)&&P(ve.maxzoom,Me.maxzoom)||Q.push({command:xs.setLayerZoomRange,args:[be,Me.minzoom,Me.maxzoom]}),ve)ve.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?Bi(ve[Be],Me[Be],Q,be,Be.slice(6),xs.setPaintProperty):P(ve[Be],Me[Be])||Q.push({command:xs.setLayerProperty,args:[be,Be,Me[Be]]}));for(Be in Me)Me.hasOwnProperty(Be)&&!ve.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?Bi(ve[Be],Me[Be],Q,be,Be.slice(6),xs.setPaintProperty):P(ve[Be],Me[Be])||Q.push({command:xs.setLayerProperty,args:[be,Be,Me[Be]]}))}else Q.push({command:xs.removeLayer,args:[be]}),ke=K[K.lastIndexOf(be)+1],Q.push({command:xs.addLayer,args:[Me,ke]})}(D,_.layers,j)}catch(S){console.warn("Unable to compute style diff:",S),j=[{command:xs.setStyle,args:[_]}]}return j}(this.serialize(),i).filter(g=>!(g.command in _m));if(o.length===0)return!1;const m=o.filter(g=>!(g.command in rl));if(m.length>0)throw new Error(`Unimplemented: ${m.map(g=>g.command).join(", ")}.`);return o.forEach(g=>{g.command!=="setTransition"&&g.command!=="setProjection"&&this[g.command].apply(this,g.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,o){return this.getImage(i)?this.fire(new n.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,o),this._afterImageUpdated(i),this)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new n.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,o,m={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(n.validateSource,`sources.${i}`,o,null,m))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const g=es(i,o,this.dispatcher,this);g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:g.serialize(),sourceId:i}));const _=j=>{const S=(j?"symbol:":"other:")+i,C=this._sourceCaches[S]=new n.SourceCache(S,g,j);(j?this._symbolSourceCaches:this._otherSourceCaches)[i]=C,C.style=this,C.onAdd(this.map)};_(!1),o.type!=="vector"&&o.type!=="geojson"||_(!0),g.onAdd&&g.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const o=this.getSource(i);if(!o)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===i)return this.fire(new n.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new n.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(i);for(const g of m)delete this._sourceCaches[g.id],delete this._updatedSources[g.id],g.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getSource(i).setData(o),this._changed=!0}getSource(i){const o=this._getSourceCache(i);return o&&o.getSource()}_getSources(){const i=[];for(const o in this._otherSourceCaches){const m=this._getSourceCache(o);m&&i.push(m.getSource())}return i}addLayer(i,o,m={}){this._checkLoaded();const g=i.id;if(this.getLayer(g))return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${g}" already exists on this map`)));let _;if(i.type==="custom"){if(An(this,n.validateCustomStyleLayer(i)))return;_=n.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(g,i.source),i=n.clone$1(i),i=n.extend(i,{source:g})),this._validate(n.validateLayer,`layers.${g}`,i,{arrayIndex:-1},m))return;_=n.createStyleLayer(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const j=o?this._order.indexOf(o):this._order.length;if(o&&j===-1)return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(j,0,g),this._layerOrderChanged=!0,this._layers[g]=_;const S=this._getLayerSourceCache(_);if(this._removedLayers[g]&&_.source&&S&&_.type!=="custom"){const C=this._removedLayers[g];delete this._removedLayers[g],C.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",S.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const m=this._order.indexOf(i);this._order.splice(m,1);const g=o?this._order.indexOf(o):this._order.length;o&&g===-1?this.fire(new n.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(g,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,m){this._checkLoaded();const g=this.getLayer(i);g?g.minzoom===o&&g.maxzoom===m||(o!=null&&(g.minzoom=o),m!=null&&(g.maxzoom=m),this._updateLayer(g)):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,o,m={}){this._checkLoaded();const g=this.getLayer(i);if(g){if(!P(g.filter,o))return o==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(n.validateFilter,`layers.${g.id}.filter`,o,{layerType:g.type},m)||(g.filter=n.clone$1(o),this._updateLayer(g)))}else this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const o=this.getLayer(i);return o&&n.clone$1(o.filter)}setLayoutProperty(i,o,m,g={}){this._checkLoaded();const _=this.getLayer(i);_?P(_.getLayoutProperty(o),m)||(_.setLayoutProperty(o,m,g),this._updateLayer(_)):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,o){const m=this.getLayer(i);if(m)return m.getLayoutProperty(o);this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,o,m,g={}){this._checkLoaded();const _=this.getLayer(i);_?P(_.getPaintProperty(o),m)||(_.setPaintProperty(o,m,g)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,o){const m=this.getLayer(i);return m&&m.getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const m=i.source,g=i.sourceLayer,_=this.getSource(m);if(!_)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const j=_.type;if(j==="geojson"&&g)return void this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(j==="vector"&&!g)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(m);for(const C of S)C.setFeatureState(g,i.id,o)}removeFeatureState(i,o){this._checkLoaded();const m=i.source,g=this.getSource(m);if(!g)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const _=g.type,j=_==="vector"?i.sourceLayer:void 0;if(_==="vector"&&!j)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(m);for(const C of S)C.removeFeatureState(j,i.id,o)}getFeatureState(i){this._checkLoaded();const o=i.source,m=i.sourceLayer,g=this.getSource(o);if(g){if(g.type!=="vector"||m)return i.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(m,i.id);this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new n.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const o in this._sourceCaches){const m=this._sourceCaches[o].getSource();i[m.id]||(i[m.id]=m.serialize())}return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const o=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",o.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=j=>this._layers[j].type==="fill-extrusion",m={},g=[];for(let j=this._order.length-1;j>=0;j--){const S=this._order[j];if(o(S)){m[S]=j;for(const C of i){const D=C[S];if(D)for(const I of D)g.push(I)}}}g.sort((j,S)=>S.intersectionZ-j.intersectionZ);const _=[];for(let j=this._order.length-1;j>=0;j--){const S=this._order[j];if(o(S))for(let C=g.length-1;C>=0;C--){const D=g[C].feature;if(m[D.layer.id]<j)break;_.push(D),g.pop()}else for(const C of i){const D=C[S];if(D)for(const I of D)_.push(I.feature)}}return _}queryRenderedFeatures(i,o,m){o&&o.filter&&this._validate(n.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const g={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of o.layers){const D=this._layers[C];if(!D)return this.fire(new n.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];g[D.source]=!0}}const _=[];o.availableImages=this._availableImages;const j=o&&o.layers?o.layers.some(C=>{const D=this.getLayer(C);return D&&D.is3D()}):this.has3DLayers(),S=pr.createFromScreenPoints(i,m);for(const C in this._sourceCaches){const D=this._sourceCaches[C].getSource().id;o.layers&&!g[D]||_.push(Vs(this._sourceCaches[C],this._layers,this._serializedLayers,S,o,m,j,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(C,D,I,O,G,Q,ee){const Y={},se=Q.queryRenderedSymbols(O),F=[];for(const K of Object.keys(se).map(Number))F.push(ee[K]);F.sort(Ur);for(const K of F){const ae=K.featureIndex.lookupSymbolFeatures(se[K.bucketInstanceId],D,K.bucketIndex,K.sourceLayerIndex,G.filter,G.layers,G.availableImages,C);for(const le in ae){const _e=Y[le]=Y[le]||[],be=ae[le];be.sort((ve,Me)=>{const ke=K.featureSortOrder;if(ke){const Be=ke.indexOf(ve.featureIndex);return ke.indexOf(Me.featureIndex)-Be}return Me.featureIndex-ve.featureIndex});for(const ve of be)_e.push(ve)}}for(const K in Y)Y[K].forEach(ae=>{const le=ae.feature,_e=I(C[K]);if(!_e)return;const be=_e.getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=be});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(n.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const m=this._getSourceCaches(i);let g=[];for(const _ of m)g=g.concat(rr(_,o));return g}addSourceType(i,o,m){return Vi.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(Vi.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const j in i)if(!P(i[j],m[j])){g=!0;break}if(!g)return;const _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,o),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,o=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=i;if(o===1){if(typeof m.source=="object"){const g="terrain-dem-src";this.addSource(g,m.source),m=n.clone$1(m),m=n.extend(m,{source:g})}if(this._validate(n.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,o)}else{const g=this.terrain,_=g.get();for(const j of Object.keys(n.spec.terrain))!m.hasOwnProperty(j)&&n.spec.terrain[j].default&&(m[j]=n.spec.terrain[j].default);for(const j in m)if(!P(m[j],_[j])){g.set(m),this.stylesheet.terrain=m;const S=this._setTransitionParameters({duration:0});g.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new Os(i,this.map.transform);this.stylesheet.fog=i;const m=this._setTransitionParameters({duration:0});o.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,m=o.get();Object.keys(i).length===0&&o.set(i);for(const g in i)if(!P(i[g],m[g])){o.set(i),this.stylesheet.fog=i;const _=this._setTransitionParameters({duration:0});o.updateTransitions(_);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:n.exported.now(),transition:n.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(m=>this.isLayerDraped(this._layers[m])),o=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const m=this.terrain=new Nt(i,o);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const g=this._setTransitionParameters({duration:0});m.updateTransitions(g)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,m,g,_={}){return(!_||_.validate!==!1)&&An(this,i.call(n.validateStyle,n.extend({key:o,style:this.serialize(),value:m,styleSpec:n.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const o=this._getSourceCaches(i);for(const m of o)m.clearTiles()}_reloadSource(i){const o=this._getSourceCaches(i);for(const m of o)m.resume(),m.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const o in this._sourceCaches)this._sourceCaches[o].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,m,g,_=!1){let j=!1,S=!1;const C={};for(const D of this._order){const I=this._layers[D];if(I.type!=="symbol")continue;if(!C[I.source]){const G=this._getLayerSourceCache(I);if(!G)continue;C[I.source]=G.getRenderableIds(!0).map(Q=>G.getTileByID(Q)).sort((Q,ee)=>ee.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(ee.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(I,C[I.source],i.center.lng,i.projection);j=j||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new n.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),i.zoom))&&(this.pauseablePlacement=new _c(i,this._order,_,o,m,g,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),S=!0),j&&this.pauseablePlacement.placement.setStale()),S||j)for(const D of this._order){const I=this._layers[D];I.type==="symbol"&&this.placement.updateLayerOpacities(I,C[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o,m){this.imageManager.getImages(o.icons,m),this._updateTilesForChangedImages();const g=_=>{_&&_.setDependencies(o.tileID.key,o.type,o.icons)};g(this._otherSourceCaches[o.source]),g(this._symbolSourceCaches[o.source])}getGlyphs(i,o,m){this.glyphManager.getGlyphs(o.stacks,m)}getResource(i,o,m){return n.makeRequest(o,m)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this._getSourceCaches(i);return o.length===0?(this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):o.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Vi.getSourceType=function(d){return Ht[d]},Vi.setSourceType=function(d,i){Ht[d]=i},Vi.registerForPluginStateChange=n.registerForPluginStateChange;var jc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Kn="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ln=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,mo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,cn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let il={},va={};const po=[];ba(jc,po),ba(ln,po),ba(mo,po),ba(cn,po),il=ys("",ln),va=ys(cn,mo);const mu=ys(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),nl=jc,Nc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Sc={background:ys(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ys(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ys(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ys("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ys(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ys(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ys("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ys("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ys("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ys(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ys(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ys(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ys(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ys(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:ys(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:ys(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ys(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ys(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ys(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ys(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:ys(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:ys(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:ys(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:ys(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:ys(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ys(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Kn),skyboxGradient:ys(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Kn),skyboxCapture:ys(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ys(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ys(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ba(d,i){const o=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of o)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=m.split(" ");for(const _ of g)i.includes(_)||i.push(_)}}function ys(d,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),g={},_=[...po];return ba(d,_),ba(i,_),{fragmentSource:d=d.replace(o,(j,S,C,D,I)=>(g[I]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${C} ${D} ${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = u_${I};
#endif
`)),vertexSource:i=i.replace(o,(j,S,C,D,I)=>{const O=D==="float"?"vec2":"vec4",G=I.match(/color/)?"color":O;return g[I]?S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${C} ${O} a_${I};
varying ${C} ${D} ${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${G}(a_${I}, u_${I}_t);
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${C} ${O} a_${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = a_${I};
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = unpack_mix_${G}(a_${I}, u_${I}_t);
#else
    ${C} ${D} ${I} = u_${I};
#endif
`}),staticAttributes:m,usedDefines:_}}class vm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,m,g,_,j,S){this.context=i;let C=this.boundPaintVertexBuffers.length!==g.length;for(let I=0;!C&&I<g.length;I++)this.boundPaintVertexBuffers[I]!==g[I]&&(C=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let I=0;!D&&I<S.length;I++)this.boundDynamicVertexBuffers[I]!==S[I]&&(D=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==m||C||D||this.boundIndexBuffer!==_||this.boundVertexOffset!==j)this.freshBind(o,m,g,_,j,S);else{i.bindVertexArrayOES.set(this.vao);for(const I of S)I&&I.bind();_&&_.dynamicDraw&&_.bind()}}freshBind(i,o,m,g,_,j){let S;const C=i.numAttributes,D=this.context,I=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=g,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=j;else{S=D.currentNumAttributes||0;for(let O=C;O<S;O++)I.disableVertexAttribArray(O)}o.enableAttributes(I,i),o.bind(),o.setVertexAttribPointers(I,i,_);for(const O of m)O.enableAttributes(I,i),O.bind(),O.setVertexAttribPointers(I,i,_);for(const O of j)O&&(O.enableAttributes(I,i),O.bind(),O.setVertexAttribPointers(I,i,_));g&&g.bind(),D.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Tc(d,i){const o=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new n.MercatorCoordinate(0,m/o).toLngLat().lat,new n.MercatorCoordinate(0,(m+1)/o).toLngLat().lat]}function pu(d,i,o,m,g,_,j){const S=d.context,C=S.gl,D=o.fbo;if(!D)return;d.prepareDrawTile();const I=d.useProgram("hillshade");S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get());const O=((Y,se,F,K)=>{const ae=F.paint.get("hillshade-shadow-color"),le=F.paint.get("hillshade-highlight-color"),_e=F.paint.get("hillshade-accent-color");let be=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=Y.transform.angle);const ve=!Y.options.moving;return{u_matrix:K||Y.transform.calculateProjMatrix(se.tileID.toUnwrapped(),ve),u_image:0,u_latrange:Tc(0,se.tileID),u_light:[F.paint.get("hillshade-exaggeration"),be],u_shadow:ae,u_highlight:le,u_accent:_e}})(d,o,m,d.terrain?i.projMatrix:null);d.prepareDrawProgram(S,I,i.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Q,tileBoundsSegments:ee}=d.getTileBoundsBuffers(o);I.draw(S,C.TRIANGLES,g,_,j,n.CullFaceMode.disabled,O,m.id,G,Q,ee)}function Ec(d,i,o){if(!i.needsDEMTextureUpload)return;const m=d.context,g=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(o.stride);const _=o.getPixels();i.demTexture?i.demTexture.update(_,{premultiply:!1}):i.demTexture=new n.Texture(m,_,g.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function fu(d,i,o,m,g,_){const j=d.context,S=j.gl;if(!i.dem)return;const C=i.dem;if(j.activeTexture.set(S.TEXTURE1),Ec(d,i,C),!i.demTexture)return;i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const D=C.dim;j.activeTexture.set(S.TEXTURE0);let I=i.fbo;if(!I){const ee=new n.Texture(j,{width:D,height:D,data:null},S.RGBA);ee.bind(S.LINEAR,S.CLAMP_TO_EDGE),I=i.fbo=j.createFramebuffer(D,D,!0),I.colorAttachment.set(ee.texture)}j.bindFramebuffer.set(I.framebuffer),j.viewport.set([0,0,D,D]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:G,tileBoundsSegments:Q}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(j,S.TRIANGLES,m,g,_,n.CullFaceMode.disabled,((ee,Y)=>{const se=Y.stride,F=n.create();return n.ortho(F,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(F,F,[0,-n.EXTENT,0]),{u_matrix:F,u_image:1,u_dimension:[se,se],u_zoom:ee.overscaledZ,u_unpack:Y.unpackVector}})(i.tileID,C),o.id,O,G,Q),i.needsHillshadePrepare=!1}const Cc=d=>({u_matrix:new n.UniformMatrix4f(d),u_image0:new n.Uniform1i(d),u_skirt_height:new n.Uniform1f(d)}),wa=(d,i)=>({u_matrix:d,u_image0:0,u_skirt_height:i}),al=(d,i,o,m,g,_,j,S,C,D,I,O,G,Q,ee)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:o,u_zoom_transition:g,u_merc_center:_,u_image0:0,u_frustum_tl:j,u_frustum_tr:S,u_frustum_br:C,u_frustum_bl:D,u_globe_pos:I,u_globe_radius:O,u_viewport:G,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:Q});function ja(d,i){return d!=null&&i!=null&&!(!d.hasData()||!i.hasData())&&d.demTexture!=null&&i.demTexture!=null&&d.tileID.key!==i.tileID.key}const dn=new class{constructor(){this.operations={}}newMorphing(d,i,o,m,g){if(d in this.operations){const _=this.operations[d];_.to.tileID.key!==o.tileID.key&&(_.queued=o)}else this.operations[d]={startTime:m,phase:0,duration:g,from:i,to:o,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const i=this.operations[d];return{from:i.from,to:i.to,phase:i.phase}}update(d){for(const i in this.operations){const o=this.operations[i];for(o.phase=(d-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,d)){delete this.operations[i];break}}}_nextOp(d,i){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=i,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Qn={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ol(d){return 6*Math.pow(1.5,22-d)}function gu(d,i){const o=1<<d.z;return!i&&(d.x===0||d.x===o-1)||d.y===0||d.y===o-1}const fo=d=>({u_matrix:d});function kc(d,i,o,m,g){if(g>0){const _=n.exported.now(),j=(_-d.timeAdded)/g,S=i?(_-i.timeAdded)/g:-1,C=o.getSource(),D=m.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),I=!i||Math.abs(i.tileID.overscaledZ-D)>Math.abs(d.tileID.overscaledZ-D),O=I&&d.refreshedUponExpiration?1:n.clamp(I?j:1-S,0,1);return d.refreshedUponExpiration&&j>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class Ac extends n.SourceCache{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new ns(ga(),null),g=es("mock-dem",o,m,i.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class ll extends n.SourceCache{constructor(i){const o=es("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new ns(ga(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,m){if(i.freezeTileCoverage)return;this.transform=i;const g=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,j)=>{if(_[j.key]="",!this._tiles[j.key]){const S=new n.Tile(j,this._source.tileSize*j.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[j.key]=S}return _},{});for(const _ in this._tiles)_ in g||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const m=Object.values(o);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cl extends n.OverscaledTileID{constructor(i,o,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=m}}class Mc extends n.Elevation{constructor(i,o){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,g,_]=function(C){const D=new n.StructArrayLayout2i4,I=new n.StructArrayLayout3ui6,O=131;D.reserve(17161),I.reserve(33800);const G=n.EXTENT/128,Q=n.EXTENT+G/2,ee=Q+G;for(let se=-G;se<ee;se+=G)for(let F=-G;F<ee;F+=G){const K=F<0||F>Q||se<0||se>Q?24575:0,ae=n.clamp(Math.round(F),0,n.EXTENT),le=n.clamp(Math.round(se),0,n.EXTENT);D.emplaceBack(ae+K,le)}const Y=(se,F)=>{const K=F*O+se;I.emplaceBack(K+1,K,K+O),I.emplaceBack(K+O,K+O+1,K+1)};for(let se=1;se<129;se++)for(let F=1;F<129;F++)Y(F,se);return[0,129].forEach(se=>{for(let F=0;F<130;F++)Y(F,se),Y(se,F)}),[D,I,32768]}(),j=i.context;this.gridBuffer=j.createVertexBuffer(m,n.posAttributes.members),this.gridIndexBuffer=j.createIndexBuffer(g),this.gridSegments=n.SegmentVector.simpleSegment(0,0,m.length,g.length),this.gridNoSkirtSegments=n.SegmentVector.simpleSegment(0,0,m.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ll(o.map),this.orthoMatrix=n.create(),n.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.EXTENT,0,n.EXTENT,0,1);const S=j.gl;this._overlapStencilMode=new n.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ac(o.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,m){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const g=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(g.get("source")),this._exaggeration=g.get("exaggeration");const _=()=>{this.sourceCache.used&&n.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(o,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),o.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&n.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=o.getIds().map(C=>{const D=o.getTileByID(C).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(C,D){const I=D.transform.pointCoordinate(D.transform.getCameraPoint()),O=new n.Point(I.x,I.y);C.sort((G,Q)=>{if(Q.overscaledZ-G.overscaledZ)return Q.overscaledZ-G.overscaledZ;const ee=new n.Point(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),Y=new n.Point(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),se=O.mult(1<<G.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(ee)-se.distSqr(Y)})})(g,this.painter),this._previousZoom=m.zoom;const _=this.proxyToSource||{};this.proxyToSource={},g.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const j=this._style._sourceCaches;for(const C in j){const D=j[C];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,i[C],_),D.usedForTerrain))continue;const I=i[C];D.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[o.id]=g.map(C=>new cl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=n.exported.now();const S={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const D=this.terrainTileForTile[C.key];if(!D)continue;const I=D.tileID.key;I in S||(this._visibleDemTiles.push(D),S[I]=I)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const m=this._findTileCoveringTileID(o,this.sourceCache);m&&(this.terrainTileForTile[o.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const m in this.terrainTileForTile){const g=this.terrainTileForTile[m],_=g.dem;!_||g.demTexture&&!g.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),Ec(this.painter,g,_))}}_prepareDemTileUniforms(i,o,m,g){if(!o||o.demTexture==null)return!1;const _=i.tileID.canonical,j=Math.pow(2,o.tileID.canonical.z-_.z),S=g||"";return m[`u_dem_tl${S}`]=[_.x*j%1,_.y*j%1],m[`u_dem_scale${S}`]=j,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,o=i.gl;if(!this._emptyDepthBufferTexture){const m=new n.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new n.Texture(i,m,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const o=this._visibleDemTiles.reduce((m,g)=>{if(!g.dem)return m;const _=g.dem.tree.minimums[0];return _>0&&i++,m+_},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const m=this._getLoadedAreaMinimum(),g=new n.RGBAImage({width:1,height:1},new Uint8Array(n.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(g,{premultiply:!1}):_=this._emptyDEMTexture=new n.Texture(i,g,o.RGBA,{premultiply:!1}),_}setupElevationDraw(i,o,m){const g=this.painter.context,_=g.gl,j=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:n.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;j.u_dem_size=this.sourceCache.getSource().tileSize,j.u_exaggeration=this.exaggeration();let C=null,D=null,I=1;if(m&&m.morphing&&this._useVertexMorphing){const O=m.morphing.srcDemTile,G=m.morphing.dstDemTile;I=m.morphing.phase,O&&G&&(this._prepareDemTileUniforms(i,O,j,"_prev")&&(D=O),this._prepareDemTileUniforms(i,G,j)&&(C=G))}if(D&&C?(g.activeTexture.set(_.TEXTURE2),C.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),g.activeTexture.set(_.TEXTURE4),D.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),j.u_dem_lerp=I):(C=this.terrainTileForTile[i.tileID.key],g.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(i,C,j)?C.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),g.activeTexture.set(_.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(j.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),j.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&C){const O=(1<<C.tileID.canonical.z)*n.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;j.u_meter_to_dem=O}if(m&&m.labelPlaneMatrixInv&&(j.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),o.setTerrainUniformValues(g,j),this.painter.transform.projection.name==="globe"){const O=this.globeUniformValues(this.painter.transform,i.tileID.canonical,m&&m.useDenormalizedUpVectorScale);o.setGlobeUniformValues(g,O)}}globeUniformValues(i,o,m){const g=i.projection;return{u_tile_tl_up:g.upVector(o,0,0),u_tile_tr_up:g.upVector(o,n.EXTENT,0),u_tile_br_up:g.upVector(o,n.EXTENT,n.EXTENT),u_tile_bl_up:g.upVector(o,0,n.EXTENT),u_tile_up_scale:m?n.globeMetersToEcef(1):g.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,m=this.painter.context;i.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,_,j,S,C){if(g.transform.projection.name==="globe")(function(D,I,O,G,Q){const ee=D.context,Y=ee.gl;let se,F;const K=D.options.showTerrainWireframe?2:0,ae=D.transform,le=n.globeUseCustomAntiAliasing(D,ee,ae),_e=(nt,Fe)=>{if(F===nt)return;const Xe=[Qn[nt],"PROJECTION_GLOBE_VIEW"];le&&Xe.push("CUSTOM_ANTIALIASING"),Fe&&Xe.push(Qn[K]),se=D.useProgram("globeRaster",null,Xe),F=nt},be=D.colorModeForRenderPass(),ve=new n.DepthMode(Y.LEQUAL,n.DepthMode.ReadWrite,D.depthRangeFor3D);dn.update(Q);const Me=n.calculateGlobeMercatorMatrix(ae),ke=[n.mercatorXfromLng(ae.center.lng),n.mercatorYfromLat(ae.center.lat)],Be=K?[!1,!0]:[!1],at=D.globeSharedBuffers,ze=[ae.width*n.exported.devicePixelRatio,ae.height*n.exported.devicePixelRatio],Qe=Float32Array.from(ae.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};if(Be.forEach(nt=>{const Fe=D.transform,Xe=ol(Fe.zoom)*I.exaggeration();F=-1;const lt=nt?Y.LINES:Y.TRIANGLES;for(const st of G){const dt=O.getTile(st),Dt=n.StencilMode.disabled,Vt=I.prevTerrainTileForTile[st.key],kt=I.terrainTileForTile[st.key];ja(Vt,kt)&&dn.newMorphing(st.key,Vt,kt,Q,250),ee.activeTexture.set(Y.TEXTURE0),dt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const Ot=dn.getMorphValuesForProxy(st.key),is=Ot?1:0;Ot&&n.extend$1(Ve,{morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:n.easeCubicInOut(Ot.phase)}});const ts=n.tileCornersToBounds(st.canonical),Pt=n.getLatitudinalLod(ts.getCenter().lat),bs=n.getGridMatrix(st.canonical,ts,Pt,Fe.worldSize/Fe._pixelsPerMercatorPixel),ws=n.globeNormalizeECEF(n.globeTileBounds(st.canonical)),js=al(Fe.projMatrix,Qe,Me,ws,n.globeToMercatorTransition(Fe.zoom),ke,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,ze,Xe,bs);if(_e(is,nt),I.setupElevationDraw(dt,se,Ve),D.prepareDrawProgram(ee,se,st.toUnwrapped()),at){const[Ns,qr,Er]=nt?at.getWirefameBuffers(D.context,Pt):at.getGridBuffers(Pt,Xe!==0);se.draw(ee,lt,ve,Dt,be,n.CullFaceMode.backCCW,js,"globe_raster",Ns,qr,Er)}}}),at){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];le&&nt.push("CUSTOM_ANTIALIASING"),se=D.useProgram("globeRaster",null,nt);for(const Fe of G){const{x:Xe,y:lt,z:st}=Fe.canonical,dt=lt===0,Dt=lt===(1<<st)-1,[Vt,kt,Ot,is]=at.getPoleBuffers(st);if(is&&(dt||Dt)){const ts=O.getTile(Fe);ee.activeTexture.set(Y.TEXTURE0),ts.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let Pt=n.globePoleMatrixForTile(st,Xe,ae);const bs=n.globeNormalizeECEF(n.globeTileBounds(Fe.canonical)),ws=(js,Ns)=>js.draw(ee,Y.TRIANGLES,ve,n.StencilMode.disabled,be,n.CullFaceMode.disabled,al(ae.projMatrix,Pt,Pt,bs,0,ke,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,ze,0),"globe_pole_raster",Ns,Ot,is);I.setupElevationDraw(ts,se,Ve),D.prepareDrawProgram(ee,se,Fe.toUnwrapped()),dt&&ws(se,Vt),Dt&&(Pt=n.scale(n.create(),Pt,[1,-1,1]),ws(se,kt))}}}})(g,_,j,S,C);else{const D=g.context,I=D.gl;let O,G;const Q=g.options.showTerrainWireframe?2:0,ee=(ae,le)=>{if(G===ae)return;const _e=[Qn[ae]];le&&_e.push(Qn[Q]),O=g.useProgram("terrainRaster",null,_e),G=ae},Y=g.colorModeForRenderPass(),se=new n.DepthMode(I.LEQUAL,n.DepthMode.ReadWrite,g.depthRangeFor3D);dn.update(C);const F=g.transform,K=ol(F.zoom)*_.exaggeration();(Q?[!1,!0]:[!1]).forEach(ae=>{G=-1;const le=ae?I.LINES:I.TRIANGLES,[_e,be]=ae?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const ve of S){const Me=j.getTile(ve),ke=n.StencilMode.disabled,Be=_.prevTerrainTileForTile[ve.key],at=_.terrainTileForTile[ve.key];ja(Be,at)&&dn.newMorphing(ve.key,Be,at,C,250),D.activeTexture.set(I.TEXTURE0),Me.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const ze=dn.getMorphValuesForProxy(ve.key),Qe=ze?1:0;let Ve;ze&&(Ve={morphing:{srcDemTile:ze.from,dstDemTile:ze.to,phase:n.easeCubicInOut(ze.phase)}});const nt=wa(ve.projMatrix,gu(ve.canonical,F.renderWorldCopies)?K/10:K);ee(Qe,ae),_.setupElevationDraw(Me,O,Ve),g.prepareDrawProgram(D,O,ve.toUnwrapped()),O.draw(D,le,se,ke,Y,n.CullFaceMode.backCCW,nt,"terrain_raster",_.gridBuffer,_e,be)}})}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,m=this.painter.context,g=this.proxySourceCache,_=this.proxiedCoords[g.id],j=this._drapedRenderBatches.shift(),S=[],C=o.style.order;let D=0;for(const I of _){const O=g.getTileByID(I.proxyTileKey),G=g.proxyCachedFBO[I.key]?g.proxyCachedFBO[I.key][i]:void 0,Q=G!==void 0?g.renderCache[G]:this.pool[D++],ee=G!==void 0;if(O.texture=Q.tex,ee&&!Q.dirty){S.push(O.tileID);continue}let Y;m.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(m.clear({color:n.Color.transparent,stencil:0}),Q.dirty=!1);for(let se=j.start;se<=j.end;++se){const F=o.style._layers[C[se]];if(F.isHidden(o.transform.zoom))continue;const K=o.style._getLayerSourceCache(F),ae=K?this.proxyToSource[I.key][K.id]:[I];if(!ae)continue;const le=ae;m.viewport.set([0,0,Q.fb.width,Q.fb.height]),Y!==(K?K.id:null)&&(this._setupStencil(Q,ae,F,K),Y=K?K.id:null),o.renderLayer(o,K,F,le)}this.renderedToTile?(Q.dirty=!0,S.push(O.tileID)):ee||--D,D===5&&(D=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,o.width,o.height]),j.end+1}postRender(){}renderCacheEfficiency(i){const o=i.order.length;if(o===0)return{efficiency:100};let m,g=0,_=0,j=!1;for(let S=0;S<o;++S){const C=i._layers[i.order[S]];this._style.isLayerDraped(C)?(j&&++g,++_):j||(j=!0,m=C.id)}return _===0?{efficiency:100}:{efficiency:100*(1-g/_),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,m){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const j=_.tileID,S=1<<j.overscaledZ,{x:C,y:D}=j.canonical,I=C/S,O=(C+1)/S,G=D/S,Q=(D+1)/S;return{minx:I,miny:G,maxx:O,maxy:Q,t:_.dem.tree.raycastRoot(I,G,O,Q,i,o,m),tile:_}});g.sort((_,j)=>(_.t!==null?_.t:Number.MAX_VALUE)-(j.t!==null?j.t:Number.MAX_VALUE));for(const _ of g){if(_.t==null)return null;const j=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,i,o,m);if(j!=null)return j}return null}_createFBO(){const i=this.painter.context,o=i.gl,m=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const g=new n.Texture(i,{width:m[0],height:m[1],data:null},o.RGBA);g.bind(o.LINEAR,o.CLAMP_TO_EDGE);const _=i.createFramebuffer(m[0],m[1],!1);return _.colorAttachment.set(g.texture),_.depthAttachment=new Se(i,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:_,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._layers[i],m=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!m&&o.shouldRedrape():!m&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const m of this._style._getSources())if(m instanceof _t){i=!0;break}if(!i)return;const o={};for(let m=0;m<this._style.order.length;++m){const g=this._style._layers[this._style.order[m]],_=this._style._getLayerSourceCache(g);if(_&&!o[_.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof n.ZoomDependentExpression){o[_.id]=!0;for(const j of this.proxyCoords){const S=this.proxyToSource[j.key][_.id];if(S)for(const C of S)this._clearRenderCacheForTile(_.id,C)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof ut){i=!0;break}if(!i)return;const o={};for(let m=0;m<this._style.order.length;++m){const g=this._style._layers[this._style.order[m]],_=this._style._getLayerSourceCache(g);if(!_||o[_.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const j=g.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][_.id];if(C)for(const D of C){const I=kc(_.getTile(D),_.findLoadedParent(D,0),_,this.painter.transform,j);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(_.id,D)}}}}_setupDrapedRenderBatches(){const i=this._style.order,o=i.length;if(o===0)return;const m=[];let g,_=0,j=this._style._layers[i[_]];for(;!this._style.isLayerDraped(j)&&j.isHidden(this.painter.transform.zoom)&&++_<o;)j=this._style._layers[i[_]];for(;_<o;++_){const S=this._style._layers[i[_]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?g===void 0&&(g=_):g!==void 0&&(m.push({start:g,end:_-1}),g=void 0))}g!==void 0&&m.push({start:g,end:_-1}),this._drapedRenderBatches=m}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const j=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<j.length;++S){const C=Object.values(j[S]);o.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,g=this._tilesDirty;for(let j=m.length-1;j>=0;j--){const S=m[j];if(o.getTileByID(S.key),o.proxyCachedFBO[S.key]!==void 0){const C=i[S.key],D=this.proxyToSource[S.key];let I=0;for(const O in D){const G=D[O],Q=C[O];if(!Q||Q.length!==G.length||G.some((ee,Y)=>ee!==Q[Y]||g[O]&&g[O].hasOwnProperty(ee.key))){I=-1;break}++I}for(const O in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][O]].dirty=I<0||I!==Object.values(C).length}}const _=[...this._drapedRenderBatches];_.sort((j,S)=>S.end-S.start-(j.end-j.start));for(const j of _)for(const S of m){if(o.proxyCachedFBO[S.key])continue;let C=o.renderCachePool.pop();C===void 0&&o.renderCache.length<50&&(C=o.renderCache.length,o.renderCache.push(this._createFBO())),C!==void 0&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][j.start]=C,o.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,m,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,j=_.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(m.isTileClipped())S=o.length,this._overlapStencilMode.test={func:j.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:j.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):n.StencilMode.disabled}_renderTileClippingMasks(i,o){const m=this.painter,g=this.painter.context,_=g.gl;m._tileClippingMaskIDs={},g.setColorMode(n.ColorMode.disabled),g.setDepthMode(n.DepthMode.disabled);const j=m.useProgram("clippingMask");for(const S of i){const C=m._tileClippingMaskIDs[S.key]=--o;j.draw(g,_.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,fo(S.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const m=[i.x,i.y,1,1];n.transformMat4$1(m,m,o.pixelMatrixInverse),n.scale$1(m,m,1/m[3]),m[0]/=o.worldSize,m[1]/=o.worldSize;const g=o._camera.position,_=n.mercatorZfromAltitude(1,o.center.lat),j=[g[0],g[1],g[2]/_,0],S=n.subtract([],m.slice(0,3),j);n.normalize(S,S);const C=this.raycast(j,S,this._exaggeration);return C!==null&&C?(n.scaleAndAdd(j,j,S,C),j[3]=j[2],j[2]*=_,j):null}drawDepth(){const i=this.painter,o=i.context,m=this.proxySourceCache,g=Math.ceil(i.width),_=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const j=o.gl,S=o.createFramebuffer(g,_,!0);o.activeTexture.set(j.TEXTURE0);const C=new n.Texture(o,{width:g,height:_,data:null},j.RGBA);C.bind(j.NEAREST,j.CLAMP_TO_EDGE),S.colorAttachment.set(C.texture);const D=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,g,_);S.depthAttachment.set(D),this._depthFBO=S,this._depthTexture=C}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,g,_]),function(j,S,C,D){if(j.transform.projection.name==="globe")return;const I=j.context,O=I.gl;I.clear({depth:1});const G=j.useProgram("terrainDepth"),Q=new n.DepthMode(O.LESS,n.DepthMode.ReadWrite,j.depthRangeFor3D);for(const ee of D){const Y=C.getTile(ee),se=wa(ee.projMatrix,0);S.setupElevationDraw(Y,G),G.draw(I,O.TRIANGLES,Q,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.backCCW,se,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,o,m){if(i.getSource()instanceof Yt)return this._setupProxiedCoordsForImageSource(i,o,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const g=this.proxiedCoords[i.id]=[],_=this.proxyCoords;for(let S=0;S<_.length;S++){const C=_[S],D=this._findTileCoveringTileID(C,i);if(D){const I=this._createProxiedId(C,D,m[C.key]&&m[C.key][i.id]);g.push(I),this.proxyToSource[C.key][i.id]=[I]}}let j=!1;for(let S=0;S<o.length;S++){const C=i.getTile(o[S]);if(!C||!C.hasData())continue;const D=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==C.tileID.canonical.z){const I=this.proxyToSource[D.tileID.key][i.id],O=this._createProxiedId(D.tileID,C,m[D.tileID.key]&&m[D.tileID.key][i.id]);I?I.splice(I.length-1,0,O):this.proxyToSource[D.tileID.key][i.id]=[O],g.push(O),j=!0}}this._sourceTilesOverlap[i.id]=j}_setupProxiedCoordsForImageSource(i,o,m){if(!i.getSource().loaded())return;const g=this.proxiedCoords[i.id]=[],_=this.proxyCoords,j=i.getSource(),S=new n.Point(j.tileID.x,j.tileID.y)._div(1<<j.tileID.z),C=j.coordinates.map(n.MercatorCoordinate.fromLngLat).reduce((I,O)=>(I.min.x=Math.min(I.min.x,O.x-S.x),I.min.y=Math.min(I.min.y,O.y-S.y),I.max.x=Math.max(I.max.x,O.x-S.x),I.max.y=Math.max(I.max.y,O.y-S.y),I),{min:new n.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(I,O)=>{const G=I.wrap+I.canonical.x/(1<<I.canonical.z),Q=I.canonical.y/(1<<I.canonical.z),ee=n.EXTENT/(1<<I.canonical.z),Y=O.wrap+O.canonical.x/(1<<O.canonical.z),se=O.canonical.y/(1<<O.canonical.z);return G+ee<Y+C.min.x||G>Y+C.max.x||Q+ee<se+C.min.y||Q>se+C.max.y};for(let I=0;I<_.length;I++){const O=_[I];for(let G=0;G<o.length;G++){const Q=i.getTile(o[G]);if(!Q||!Q.hasData()||D(O,Q.tileID))continue;const ee=this._createProxiedId(O,Q,m[O.key]&&m[O.key][i.id]),Y=this.proxyToSource[O.key][i.id];Y?Y.push(ee):this.proxyToSource[O.key][i.id]=[ee],g.push(ee)}}}_createProxiedId(i,o,m){let g=this.orthoMatrix;if(m){const _=m.find(j=>j.key===o.tileID.key);if(_)return _}if(o.tileID.key!==i.key){const _=i.canonical.z-o.tileID.canonical.z;let j,S,C;g=n.create();const D=o.tileID.wrap-i.wrap<<i.overscaledZ;_>0?(j=n.EXTENT>>_,S=j*((o.tileID.canonical.x<<_)-i.canonical.x+D),C=j*((o.tileID.canonical.y<<_)-i.canonical.y)):(j=n.EXTENT<<-_,S=n.EXTENT*(o.tileID.canonical.x-(i.canonical.x+D<<-_)),C=n.EXTENT*(o.tileID.canonical.y-(i.canonical.y<<-_))),n.ortho(g,0,j,0,j,0,1),n.translate(g,g,[S,C,0])}return new cl(o.tileID,i.key,g)}_findTileCoveringTileID(i,o){let m=o.getTile(i);if(m&&m.hasData())return m;const g=this._findCoveringTileCache[o.id],_=g[i.key];if(m=_?o.getTileByID(_):null,m&&m.hasData()||_===null)return m;let j=m?m.tileID:i,S=j.overscaledZ;const C=o.getSource().minzoom,D=[];if(!_){const O=o.getSource().maxzoom;if(i.canonical.z>=O){const G=i.canonical.z-O;o.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,o.transform.tileZoom),j=new n.OverscaledTileID(S,i.wrap,O,i.canonical.x>>G,i.canonical.y>>G)):G!==0&&(S=O,j=new n.OverscaledTileID(S,i.wrap,O,i.canonical.x>>G,i.canonical.y>>G))}j.key!==i.key&&(D.push(j.key),m=o.getTile(j))}const I=O=>{D.forEach(G=>{g[G]=O}),D.length=0};for(S-=1;S>=C&&(!m||!m.hasData());S--){m&&I(m.tileID.key);const O=j.calculateScaledKey(S);if(m=o.getTileByID(O),m&&m.hasData())break;const G=g[O];if(G===null)break;G===void 0?D.push(O):m=o.getTileByID(G)}return I(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(o){let m=0;const g=new n.StructArrayLayout2ui4,_=131;for(let j=1;j<129;j++){for(let S=1;S<129;S++)m=j*_+S,g.emplaceBack(m,m+1),g.emplaceBack(m,m+_),g.emplaceBack(m+1,m+_),j===128&&g.emplaceBack(m+_,m+_+1);g.emplaceBack(m+1,m+1+_)}return g}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=n.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class us{static cacheKey(i,o,m,g){let _=`${o}${g?g.cacheKey:""}`;for(const j of m)i.usedDefines.includes(j)&&(_+=`/${j}`);return _}constructor(i,o,m,g,_,j){const S=i.gl;this.program=S.createProgram();const C=function(F){const K=[];for(let ae=0;ae<F.length;ae++){if(F[ae]===null)continue;const le=F[ae].split(" ");K.push(le.pop())}return K}(m.staticAttributes),D=g?g.getBinderAttributes():[],I=C.concat(D);let O=g?g.defines():[];O=O.concat(j.map(F=>`#define ${F}`));const G=i.isWebGL2?`#version 300 es
`:"",Q=G+O.concat(i.extStandardDerivatives&&G.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Nc):Nc,Nc,nl,mu.fragmentSource,va.fragmentSource,m.fragmentSource).join(`
`),ee=G+O.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,nl,mu.vertexSource,va.vertexSource,il.vertexSource,m.vertexSource).join(`
`),Y=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(Y,Q),S.compileShader(Y),S.attachShader(this.program,Y);const se=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(se,ee),S.compileShader(se),S.attachShader(this.program,se),this.attributes={},this.numAttributes=I.length;for(let F=0;F<this.numAttributes;F++)I[F]&&(S.bindAttribLocation(this.program,F,I[F]),this.attributes[I[F]]=F);S.linkProgram(this.program),S.deleteShader(se),S.deleteShader(Y),this.fixedUniforms=_(i),this.binderUniforms=g?g.getUniforms(i):[],j.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new n.Uniform1i(F),u_dem_prev:new n.Uniform1i(F),u_dem_unpack:new n.Uniform4f(F),u_dem_tl:new n.Uniform2f(F),u_dem_scale:new n.Uniform1f(F),u_dem_tl_prev:new n.Uniform2f(F),u_dem_scale_prev:new n.Uniform1f(F),u_dem_size:new n.Uniform1f(F),u_dem_lerp:new n.Uniform1f(F),u_exaggeration:new n.Uniform1f(F),u_depth:new n.Uniform1i(F),u_depth_size_inv:new n.Uniform2f(F),u_meter_to_dem:new n.Uniform1f(F),u_label_plane_matrix_inv:new n.UniformMatrix4f(F)}))(i)),j.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new n.Uniform3f(F),u_tile_tr_up:new n.Uniform3f(F),u_tile_br_up:new n.Uniform3f(F),u_tile_bl_up:new n.Uniform3f(F),u_tile_up_scale:new n.Uniform1f(F)}))(i)),j.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new n.UniformMatrix4f(F),u_fog_range:new n.Uniform2f(F),u_fog_color:new n.Uniform4f(F),u_fog_horizon_blend:new n.Uniform1f(F),u_fog_temporal_offset:new n.Uniform1f(F),u_frustum_tl:new n.Uniform3f(F),u_frustum_tr:new n.Uniform3f(F),u_frustum_br:new n.Uniform3f(F),u_frustum_bl:new n.Uniform3f(F),u_globe_pos:new n.Uniform3f(F),u_globe_radius:new n.Uniform1f(F),u_globe_transition:new n.Uniform1f(F),u_is_globe:new n.Uniform1i(F),u_viewport:new n.Uniform2f(F)}))(i))}}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in o)m[g]&&m[g].set(this.program,g,o[g])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in o)m[g]&&m[g].set(this.program,g,o[g])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in o)m[g].set(this.program,g,o[g])}}draw(i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y){const se=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(g),i.setColorMode(_),i.setCullFace(j);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(this.program,K,S[K]);ee&&ee.setUniforms(this.program,i,this.binderUniforms,G,{zoom:Q});const F={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[o];for(const K of O.get()){const ae=K.vaos||(K.vaos={});(ae[C]||(ae[C]=new vm)).bind(i,this,D,ee?ee.getPaintVertexBuffers():[],I,K.vertexOffset,Y||[]),se.drawElements(o,K.primitiveLength*F,se.UNSIGNED_SHORT,K.primitiveOffset*F*2)}}}function go(d,i){const o=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,d.transform.tileZoom)/o,g=m*(i.tileID.canonical.x+i.tileID.wrap*o),_=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/_s(i,1,d.transform.tileZoom),u_pixel_coord_upper:[g>>16,_>>16],u_pixel_coord_lower:[65535&g,65535&_]}}const xu=n.create(),Pc=(d,i,o,m,g,_,j,S,C,D,I)=>{const O=i.style.light,G=O.properties.get("position"),Q=[G.x,G.y,G.z],ee=n.create$1();O.properties.get("anchor")==="viewport"&&(n.fromRotation(ee,-i.transform.angle),n.transformMat3(Q,Q,ee));const Y=O.properties.get("color"),se=i.transform,F={u_matrix:d,u_lightpos:Q,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+o,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:_};return se.projection.name==="globe"&&(F.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],F.u_zoom_transition=C,F.u_inv_rot_matrix=I,F.u_merc_center=D,F.u_up_dir=se.projection.upVector(new n.CanonicalTileID(0,0,0),D[0]*n.EXTENT,D[1]*n.EXTENT),F.u_height_lift=S),F},yu=(d,i,o,m,g,_,j,S,C,D,I,O)=>{const G=Pc(d,i,o,m,g,_,j,C,D,I,O),Q={u_height_factor:-Math.pow(2,j.overscaledZ)/S.tileSize/8};return n.extend(G,go(i,S),Q)},Jn=d=>({u_matrix:d}),Ic=(d,i,o)=>n.extend(Jn(d),go(i,o)),bm=(d,i)=>({u_matrix:d,u_world:i}),wm=(d,i,o,m)=>n.extend(Ic(d,i,o),{u_world:m}),jm=n.create(),Dc=(d,i,o,m,g,_)=>{const j=d.transform,S=j.projection.name==="globe";let C;if(_.paint.get("circle-pitch-alignment")==="map")if(S){const I=n.globePixelsToTileUnits(j.zoom,i.canonical)*j._pixelsPerMercatorPixel;C=Float32Array.from([I,0,0,I])}else C=j.calculatePixelsToTileUnitsMatrix(o);else C=new Float32Array([j.pixelsToGLUnits[0],0,0,j.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:j.cameraToCenterDistance,u_matrix:d.translatePosMatrix(i.projMatrix,o,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:n.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:jm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){D.u_inv_rot_matrix=m,D.u_merc_center=g,D.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],D.u_zoom_transition=n.globeToMercatorTransition(j.zoom);const I=g[0]*n.EXTENT,O=g[1]*n.EXTENT;D.u_up_dir=j.projection.upVector(new n.CanonicalTileID(0,0,0),I,O)}return D},Lc=d=>{const i=[];return d.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},Rc=(d,i,o,m)=>{const g=n.EXTENT/o.tileSize;return{u_matrix:d,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/g,i.pixelsToGLUnits[1]/g]}},dl=(d,i,o=1)=>({u_matrix:d,u_color:i,u_overlay:0,u_overlay_scale:o}),_u=n.create(),vu=(d,i,o,m,g,_,j)=>{const S=d.transform,C=S.projection.name==="globe",D=C?n.globePixelsToTileUnits(S.zoom,i.canonical)*S._pixelsPerMercatorPixel:_s(o,1,_),I={u_matrix:i.projMatrix,u_extrude_scale:D,u_intensity:j,u_inv_rot_matrix:_u,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){I.u_inv_rot_matrix=m,I.u_merc_center=g,I.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],I.u_zoom_transition=n.globeToMercatorTransition(S.zoom);const O=g[0]*n.EXTENT,G=g[1]*n.EXTENT;I.u_up_dir=S.projection.upVector(new n.CanonicalTileID(0,0,0),O,G)}return I},Nm=(d,i,o,m,g,_,j)=>{const S=d.transform,C=S.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:zc(d,i,o,m),u_pixels_to_tile_units:C,u_device_pixel_ratio:_,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:yo(o)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Na(i,d.transform),u_alpha_discard_threshold:0,u_trim_offset:j}},xo=(d,i,o,m,g)=>{const _=d.transform;return{u_matrix:zc(d,i,o,m),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:g,u_image:0,u_tile_units_to_pixels:Na(i,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Na(d,i){return 1/_s(d,1,i.tileZoom)}function zc(d,i,o,m){return d.translatePosMatrix(m||i.tileID.projMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function yo(d){const i=d.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const Oc=(d,i,o,m,g,_)=>{return{u_matrix:d,u_tl_parent:i,u_scale_parent:o,u_fade_t:m.mix,u_opacity:m.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(S=g.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(j=g.paint.get("raster-contrast"),j>0?1/(1-j):1+j),u_spin_weights:qi(g.paint.get("raster-hue-rotate")),u_perspective_transform:_};var j,S};function qi(d){d*=Math.PI/180;const i=Math.sin(d),o=Math.cos(d);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const ul=n.create(),Fc=(d,i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y)=>{const se=g.transform,F={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:se.width/se.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:j,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ul,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ul,u_up_vector:[0,-1,0]};return Y.name==="globe"&&(F.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],F.u_zoom_transition=O,F.u_inv_rot_matrix=Q,F.u_merc_center=G,F.u_camera_forward=se._camera.forward(),F.u_ecef_origin=n.globeECEFOrigin(se.globeMatrix,I.toUnwrapped()),F.u_tile_matrix=Float32Array.from(se.globeMatrix),F.u_up_vector=ee),F},hl=(d,i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y,se)=>n.extend(Fc(d,i,o,m,g,_,j,S,C,D,O,G,Q,ee,Y,se),{u_gamma_scale:m?g.transform.cameraToCenterDistance*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:n.exported.devicePixelRatio,u_is_halo:+I}),bu=(d,i,o,m,g,_,j,S,C,D,I,O,G,Q,ee,Y)=>n.extend(hl(d,i,o,m,g,_,j,S,!0,C,!0,I,O,G,Q,ee,Y),{u_texsize_icon:D,u_texture_icon:1}),Bc=(d,i,o)=>({u_matrix:d,u_opacity:i,u_color:o}),Sm=(d,i,o,m,g)=>n.extend(function(_,j,S){const C=j.imageManager.getPattern(_.toString()),{width:D,height:I}=j.imageManager.getPixelSize(),O=Math.pow(2,S.tileID.overscaledZ),G=S.tileSize*Math.pow(2,j.transform.tileZoom)/O,Q=G*(S.tileID.canonical.x+S.tileID.wrap*O),ee=G*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:C.tl,u_pattern_br:C.br,u_texsize:[D,I],u_pattern_size:C.displaySize,u_tile_units_to_pixels:1/_s(S,1,j.transform.tileZoom),u_pixel_coord_upper:[Q>>16,ee>>16],u_pixel_coord_lower:[65535&Q,65535&ee]}}(m,o,g),{u_matrix:d,u_opacity:i}),Uc={fillExtrusion:d=>({u_matrix:new n.UniformMatrix4f(d),u_lightpos:new n.Uniform3f(d),u_lightintensity:new n.Uniform1f(d),u_lightcolor:new n.Uniform3f(d),u_vertical_gradient:new n.Uniform1f(d),u_opacity:new n.Uniform1f(d),u_edge_radius:new n.Uniform1f(d),u_ao:new n.Uniform2f(d),u_tile_id:new n.Uniform3f(d),u_zoom_transition:new n.Uniform1f(d),u_inv_rot_matrix:new n.UniformMatrix4f(d),u_merc_center:new n.Uniform2f(d),u_up_dir:new n.Uniform3f(d),u_height_lift:new n.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new n.UniformMatrix4f(d),u_lightpos:new n.Uniform3f(d),u_lightintensity:new n.Uniform1f(d),u_lightcolor:new n.Uniform3f(d),u_vertical_gradient:new n.Uniform1f(d),u_height_factor:new n.Uniform1f(d),u_edge_radius:new n.Uniform1f(d),u_ao:new n.Uniform2f(d),u_tile_id:new n.Uniform3f(d),u_zoom_transition:new n.Uniform1f(d),u_inv_rot_matrix:new n.UniformMatrix4f(d),u_merc_center:new n.Uniform2f(d),u_up_dir:new n.Uniform3f(d),u_height_lift:new n.Uniform1f(d),u_image:new n.Uniform1i(d),u_texsize:new n.Uniform2f(d),u_pixel_coord_upper:new n.Uniform2f(d),u_pixel_coord_lower:new n.Uniform2f(d),u_tile_units_to_pixels:new n.Uniform1f(d),u_opacity:new n.Uniform1f(d)}),fill:d=>({u_matrix:new n.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new n.UniformMatrix4f(d),u_image:new n.Uniform1i(d),u_texsize:new n.Uniform2f(d),u_pixel_coord_upper:new n.Uniform2f(d),u_pixel_coord_lower:new n.Uniform2f(d),u_tile_units_to_pixels:new n.Uniform1f(d)}),fillOutline:d=>({u_matrix:new n.UniformMatrix4f(d),u_world:new n.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new n.UniformMatrix4f(d),u_world:new n.Uniform2f(d),u_image:new n.Uniform1i(d),u_texsize:new n.Uniform2f(d),u_pixel_coord_upper:new n.Uniform2f(d),u_pixel_coord_lower:new n.Uniform2f(d),u_tile_units_to_pixels:new n.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new n.Uniform1f(d),u_extrude_scale:new n.UniformMatrix2f(d),u_device_pixel_ratio:new n.Uniform1f(d),u_matrix:new n.UniformMatrix4f(d),u_inv_rot_matrix:new n.UniformMatrix4f(d),u_merc_center:new n.Uniform2f(d),u_tile_id:new n.Uniform3f(d),u_zoom_transition:new n.Uniform1f(d),u_up_dir:new n.Uniform3f(d)}),collisionBox:d=>({u_matrix:new n.UniformMatrix4f(d),u_camera_to_center_distance:new n.Uniform1f(d),u_extrude_scale:new n.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new n.UniformMatrix4f(d),u_inv_matrix:new n.UniformMatrix4f(d),u_camera_to_center_distance:new n.Uniform1f(d),u_viewport_size:new n.Uniform2f(d)}),debug:d=>({u_color:new n.UniformColor(d),u_matrix:new n.UniformMatrix4f(d),u_overlay:new n.Uniform1i(d),u_overlay_scale:new n.Uniform1f(d)}),clippingMask:d=>({u_matrix:new n.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new n.Uniform1f(d),u_intensity:new n.Uniform1f(d),u_matrix:new n.UniformMatrix4f(d),u_inv_rot_matrix:new n.UniformMatrix4f(d),u_merc_center:new n.Uniform2f(d),u_tile_id:new n.Uniform3f(d),u_zoom_transition:new n.Uniform1f(d),u_up_dir:new n.Uniform3f(d)}),heatmapTexture:d=>({u_image:new n.Uniform1i(d),u_color_ramp:new n.Uniform1i(d),u_opacity:new n.Uniform1f(d)}),hillshade:d=>({u_matrix:new n.UniformMatrix4f(d),u_image:new n.Uniform1i(d),u_latrange:new n.Uniform2f(d),u_light:new n.Uniform2f(d),u_shadow:new n.UniformColor(d),u_highlight:new n.UniformColor(d),u_accent:new n.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new n.UniformMatrix4f(d),u_image:new n.Uniform1i(d),u_dimension:new n.Uniform2f(d),u_zoom:new n.Uniform1f(d),u_unpack:new n.Uniform4f(d)}),line:d=>({u_matrix:new n.UniformMatrix4f(d),u_pixels_to_tile_units:new n.UniformMatrix2f(d),u_device_pixel_ratio:new n.Uniform1f(d),u_units_to_pixels:new n.Uniform2f(d),u_dash_image:new n.Uniform1i(d),u_gradient_image:new n.Uniform1i(d),u_image_height:new n.Uniform1f(d),u_texsize:new n.Uniform2f(d),u_tile_units_to_pixels:new n.Uniform1f(d),u_alpha_discard_threshold:new n.Uniform1f(d),u_trim_offset:new n.Uniform2f(d)}),linePattern:d=>({u_matrix:new n.UniformMatrix4f(d),u_texsize:new n.Uniform2f(d),u_pixels_to_tile_units:new n.UniformMatrix2f(d),u_device_pixel_ratio:new n.Uniform1f(d),u_image:new n.Uniform1i(d),u_units_to_pixels:new n.Uniform2f(d),u_tile_units_to_pixels:new n.Uniform1f(d),u_alpha_discard_threshold:new n.Uniform1f(d)}),raster:d=>({u_matrix:new n.UniformMatrix4f(d),u_tl_parent:new n.Uniform2f(d),u_scale_parent:new n.Uniform1f(d),u_fade_t:new n.Uniform1f(d),u_opacity:new n.Uniform1f(d),u_image0:new n.Uniform1i(d),u_image1:new n.Uniform1i(d),u_brightness_low:new n.Uniform1f(d),u_brightness_high:new n.Uniform1f(d),u_saturation_factor:new n.Uniform1f(d),u_contrast_factor:new n.Uniform1f(d),u_spin_weights:new n.Uniform3f(d),u_perspective_transform:new n.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new n.Uniform1i(d),u_is_size_feature_constant:new n.Uniform1i(d),u_size_t:new n.Uniform1f(d),u_size:new n.Uniform1f(d),u_camera_to_center_distance:new n.Uniform1f(d),u_rotate_symbol:new n.Uniform1i(d),u_aspect_ratio:new n.Uniform1f(d),u_fade_change:new n.Uniform1f(d),u_matrix:new n.UniformMatrix4f(d),u_label_plane_matrix:new n.UniformMatrix4f(d),u_coord_matrix:new n.UniformMatrix4f(d),u_is_text:new n.Uniform1i(d),u_pitch_with_map:new n.Uniform1i(d),u_texsize:new n.Uniform2f(d),u_tile_id:new n.Uniform3f(d),u_zoom_transition:new n.Uniform1f(d),u_inv_rot_matrix:new n.UniformMatrix4f(d),u_merc_center:new n.Uniform2f(d),u_camera_forward:new n.Uniform3f(d),u_tile_matrix:new n.UniformMatrix4f(d),u_up_vector:new n.Uniform3f(d),u_ecef_origin:new n.Uniform3f(d),u_texture:new n.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new n.Uniform1i(d),u_is_size_feature_constant:new n.Uniform1i(d),u_size_t:new n.Uniform1f(d),u_size:new n.Uniform1f(d),u_camera_to_center_distance:new n.Uniform1f(d),u_rotate_symbol:new n.Uniform1i(d),u_aspect_ratio:new n.Uniform1f(d),u_fade_change:new n.Uniform1f(d),u_matrix:new n.UniformMatrix4f(d),u_label_plane_matrix:new n.UniformMatrix4f(d),u_coord_matrix:new n.UniformMatrix4f(d),u_is_text:new n.Uniform1i(d),u_pitch_with_map:new n.Uniform1i(d),u_texsize:new n.Uniform2f(d),u_texture:new n.Uniform1i(d),u_gamma_scale:new n.Uniform1f(d),u_device_pixel_ratio:new n.Uniform1f(d),u_tile_id:new n.Uniform3f(d),u_zoom_transition:new n.Uniform1f(d),u_inv_rot_matrix:new n.UniformMatrix4f(d),u_merc_center:new n.Uniform2f(d),u_camera_forward:new n.Uniform3f(d),u_tile_matrix:new n.UniformMatrix4f(d),u_up_vector:new n.Uniform3f(d),u_ecef_origin:new n.Uniform3f(d),u_is_halo:new n.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new n.Uniform1i(d),u_is_size_feature_constant:new n.Uniform1i(d),u_size_t:new n.Uniform1f(d),u_size:new n.Uniform1f(d),u_camera_to_center_distance:new n.Uniform1f(d),u_rotate_symbol:new n.Uniform1i(d),u_aspect_ratio:new n.Uniform1f(d),u_fade_change:new n.Uniform1f(d),u_matrix:new n.UniformMatrix4f(d),u_label_plane_matrix:new n.UniformMatrix4f(d),u_coord_matrix:new n.UniformMatrix4f(d),u_is_text:new n.Uniform1i(d),u_pitch_with_map:new n.Uniform1i(d),u_texsize:new n.Uniform2f(d),u_texsize_icon:new n.Uniform2f(d),u_texture:new n.Uniform1i(d),u_texture_icon:new n.Uniform1i(d),u_gamma_scale:new n.Uniform1f(d),u_device_pixel_ratio:new n.Uniform1f(d),u_is_halo:new n.Uniform1i(d)}),background:d=>({u_matrix:new n.UniformMatrix4f(d),u_opacity:new n.Uniform1f(d),u_color:new n.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new n.UniformMatrix4f(d),u_opacity:new n.Uniform1f(d),u_image:new n.Uniform1i(d),u_pattern_tl:new n.Uniform2f(d),u_pattern_br:new n.Uniform2f(d),u_texsize:new n.Uniform2f(d),u_pattern_size:new n.Uniform2f(d),u_pixel_coord_upper:new n.Uniform2f(d),u_pixel_coord_lower:new n.Uniform2f(d),u_tile_units_to_pixels:new n.Uniform1f(d)}),terrainRaster:Cc,terrainDepth:Cc,skybox:d=>({u_matrix:new n.UniformMatrix4f(d),u_sun_direction:new n.Uniform3f(d),u_cubemap:new n.Uniform1i(d),u_opacity:new n.Uniform1f(d),u_temporal_offset:new n.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new n.UniformMatrix4f(d),u_color_ramp:new n.Uniform1i(d),u_center_direction:new n.Uniform3f(d),u_radius:new n.Uniform1f(d),u_opacity:new n.Uniform1f(d),u_temporal_offset:new n.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new n.UniformMatrix3f(d),u_sun_direction:new n.Uniform3f(d),u_sun_intensity:new n.Uniform1f(d),u_color_tint_r:new n.Uniform4f(d),u_color_tint_m:new n.Uniform4f(d),u_luminance:new n.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new n.UniformMatrix4f(d),u_globe_matrix:new n.UniformMatrix4f(d),u_normalize_matrix:new n.UniformMatrix4f(d),u_merc_matrix:new n.UniformMatrix4f(d),u_zoom_transition:new n.Uniform1f(d),u_merc_center:new n.Uniform2f(d),u_image0:new n.Uniform1i(d),u_grid_matrix:new n.UniformMatrix3f(d),u_skirt_height:new n.Uniform1f(d),u_frustum_tl:new n.Uniform3f(d),u_frustum_tr:new n.Uniform3f(d),u_frustum_br:new n.Uniform3f(d),u_frustum_bl:new n.Uniform3f(d),u_globe_pos:new n.Uniform3f(d),u_globe_radius:new n.Uniform1f(d),u_viewport:new n.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new n.Uniform3f(d),u_frustum_tr:new n.Uniform3f(d),u_frustum_br:new n.Uniform3f(d),u_frustum_bl:new n.Uniform3f(d),u_horizon:new n.Uniform1f(d),u_transition:new n.Uniform1f(d),u_fadeout_range:new n.Uniform1f(d),u_color:new n.Uniform4f(d),u_high_color:new n.Uniform4f(d),u_space_color:new n.Uniform4f(d),u_star_intensity:new n.Uniform1f(d),u_star_density:new n.Uniform1f(d),u_star_size:new n.Uniform1f(d),u_temporal_offset:new n.Uniform1f(d),u_horizon_angle:new n.Uniform1f(d),u_rotation_matrix:new n.UniformMatrix4f(d)})};let ml;function _o(d,i,o,m,g,_,j){const S=d.context,C=S.gl,D=d.transform,I=d.useProgram("collisionBox"),O=[];let G=0,Q=0;for(let le=0;le<m.length;le++){const _e=m[le],be=i.getTile(_e),ve=be.getBucket(o);if(!ve)continue;const Me=_i(_e,ve,D);let ke=Me;g[0]===0&&g[1]===0||(ke=d.translatePosMatrix(Me,be,g,_));const Be=j?ve.textCollisionBox:ve.iconCollisionBox,at=ve.collisionCircleArray;if(at.length>0){const ze=n.create(),Qe=ke;n.mul(ze,ve.placementInvProjMatrix,D.glCoordMatrix),n.mul(ze,ze,ve.placementViewportMatrix),O.push({circleArray:at,circleOffset:Q,transform:Qe,invTransform:ze,projection:ve.getProjection()}),G+=at.length/4,Q=G}Be&&(d.terrain&&d.terrain.setupElevationDraw(be,I),I.draw(S,C.LINES,n.DepthMode.disabled,n.StencilMode.disabled,d.colorModeForRenderPass(),n.CullFaceMode.disabled,Rc(ke,D,be,ve.getProjection()),o.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,D.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!j||!O.length)return;const ee=d.useProgram("collisionCircle"),Y=new n.StructArrayLayout2f1f2i16;Y.resize(4*G),Y._trim();let se=0;for(const le of O)for(let _e=0;_e<le.circleArray.length/4;_e++){const be=4*_e,ve=le.circleArray[be+0],Me=le.circleArray[be+1],ke=le.circleArray[be+2],Be=le.circleArray[be+3];Y.emplace(se++,ve,Me,ke,Be,0),Y.emplace(se++,ve,Me,ke,Be,1),Y.emplace(se++,ve,Me,ke,Be,2),Y.emplace(se++,ve,Me,ke,Be,3)}(!ml||ml.length<2*G)&&(ml=function(le){const _e=2*le,be=new n.StructArrayLayout3ui6;be.resize(_e),be._trim();for(let ve=0;ve<_e;ve++){const Me=6*ve;be.uint16[Me+0]=4*ve+0,be.uint16[Me+1]=4*ve+1,be.uint16[Me+2]=4*ve+2,be.uint16[Me+3]=4*ve+2,be.uint16[Me+4]=4*ve+3,be.uint16[Me+5]=4*ve+0}return be}(G));const F=S.createIndexBuffer(ml,!0),K=S.createVertexBuffer(Y,n.collisionCircleLayout.members,!0);for(const le of O){const _e={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(ae=D).getCameraToCenterDistance(le.projection),u_viewport_size:[ae.width,ae.height]};ee.draw(S,C.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,d.colorModeForRenderPass(),n.CullFaceMode.disabled,_e,o.id,K,F,n.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,D.zoom)}var ae;K.destroy(),F.destroy()}const wu=n.create();function Vc({width:d,height:i,anchor:o,textOffset:m,textScale:g},_){const{horizontalAlign:j,verticalAlign:S}=n.getAnchorAlignment(o),C=-(j-.5)*d,D=-(S-.5)*i,I=n.evaluateVariableOffset(o,m);return new n.Point((C/g+I[0])*_,(D/g+I[1])*_)}function Tm(d,i,o,m,g,_,j,S,C,D,I){const O=d.text.placedSymbolArray,G=d.text.dynamicLayoutVertexArray,Q=d.icon.dynamicLayoutVertexArray,ee={},Y=d.getProjection(),se=Fs(S,Y,_),F=_.elevation,K=Y.upVectorScale(S.canonical,_.center.lat,_.worldSize).metersToTile;G.clear();for(let ae=0;ae<O.length;ae++){const le=O.get(ae),{tileAnchorX:_e,tileAnchorY:be,numGlyphs:ve}=le,Me=le.hidden||!le.crossTileID||d.allowVerticalPlacement&&!le.placedOrientation?null:m[le.crossTileID];if(Me){let ke=0,Be=0,at=0;if(F){const dt=F?F.getAtTileOffset(S,_e,be):0,[Dt,Vt,kt]=Y.upVector(S.canonical,_e,be);ke=dt*Dt*K,Be=dt*Vt*K,at=dt*kt*K}let[ze,Qe,Ve,nt]=Sr(le.projectedAnchorX+ke,le.projectedAnchorY+Be,le.projectedAnchorZ+at,o?se:j);const Fe=lu(_.getCameraToCenterDistance(Y),nt);let Xe=g.evaluateSizeForFeature(d.textSizeData,D,le)*Fe/n.ONE_EM;o&&(Xe*=d.tilePixelRatio/C);const lt=Vc(Me,Xe);o?({x:ze,y:Qe,z:Ve}=Y.projectTilePoint(_e+lt.x,be+lt.y,S.canonical),[ze,Qe,Ve]=Sr(ze+ke,Qe+Be,Ve+at,j)):(i&&lt._rotate(-_.angle),ze+=lt.x,Qe+=lt.y,Ve=0);const st=d.allowVerticalPlacement&&le.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let dt=0;dt<ve;dt++)n.addDynamicAttributes(G,ze,Qe,Ve,st);I&&le.associatedIconIndex>=0&&(ee[le.associatedIconIndex]={x:ze,y:Qe,z:Ve,angle:st})}else Pi(ve,G)}if(I){Q.clear();const ae=d.icon.placedSymbolArray;for(let le=0;le<ae.length;le++){const _e=ae.get(le),{numGlyphs:be}=_e,ve=ee[le];if(_e.hidden||!ve)Pi(be,Q);else{const{x:Me,y:ke,z:Be,angle:at}=ve;for(let ze=0;ze<be;ze++)n.addDynamicAttributes(Q,Me,ke,Be,at)}}d.icon.dynamicLayoutVertexBuffer.updateData(Q)}d.text.dynamicLayoutVertexBuffer.updateData(G)}function qc(d,i,o){return o.iconsInText&&i?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ju(d,i,o,m,g,_,j,S,C,D,I,O){const G=d.context,Q=G.gl,ee=d.transform,Y=S==="map",se=C==="map",F=Y&&o.layout.get("symbol-placement")!=="point",K=Y&&!se&&!F,ae=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let le=!1;const _e=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),be=[n.mercatorXfromLng(ee.center.lng),n.mercatorYfromLat(ee.center.lat)],ve=o.layout.get("text-variable-anchor"),Me=ee.projection.name==="globe",ke=[],Be=[0,-1,0];let at=Be;!Me&&!ee.mercatorFromTransition||Y||(at=function(ze){const Qe=ze._camera.getWorldToCamera(ze.worldSize,1),Ve=n.multiply([],Qe,ze.globeMatrix);n.invert(Ve,Ve);const nt=[0,0,0],Fe=[0,1,0,0];return n.transformMat4$1(Fe,Fe,Ve),nt[0]=Fe[0],nt[1]=Fe[1],nt[2]=Fe[2],n.normalize(nt,nt),nt}(ee));for(const ze of m){const Qe=i.getTile(ze),Ve=Qe.getBucket(o);if(!Ve||Ve.projection.name==="mercator"&&Me)continue;const nt=g?Ve.text:Ve.icon;if(!nt||Ve.fullyClipped||!nt.segments.get().length)continue;const Fe=nt.programConfigurations.get(o.id),Xe=g||Ve.sdfIcons,lt=g?Ve.textSizeData:Ve.iconSizeData,st=se||ee.pitch!==0,dt=n.evaluateSizeForZoom(lt,ee.zoom);let Dt,Vt,kt,Ot,is=[0,0],ts=null;if(g)Vt=Qe.glyphAtlasTexture,kt=Q.LINEAR,Dt=Qe.glyphAtlasTexture.size,Ve.iconsInText&&(is=Qe.imageAtlasTexture.size,ts=Qe.imageAtlasTexture,Ot=st||d.options.rotating||d.options.zooming||lt.kind==="composite"||lt.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const mn=o.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;Vt=Qe.imageAtlasTexture,kt=Xe||d.options.rotating||d.options.zooming||mn||st?Q.LINEAR:Q.NEAREST,Dt=Qe.imageAtlasTexture.size}const Pt=Ve.projection.name==="globe",bs=Pt?at:Be,ws=Pt?n.globeToMercatorTransition(ee.zoom):0,js=Fs(ze,Ve.getProjection(),ee),Ns=ee.calculatePixelsToTileUnitsMatrix(Qe),qr=We(js,Qe.tileID.canonical,se,Y,ee,Ve.getProjection(),Ns),Er=d.terrain&&se&&F?n.invert(n.create(),qr):wu,ji=ir(js,Qe.tileID.canonical,se,Y,ee,Ve.getProjection(),Ns),Gi=ve&&Ve.hasTextData(),Bs=o.layout.get("icon-text-fit")!=="none"&&Gi&&Ve.hasIconData();if(F){const mn=ee.elevation,Pn=mn?mn.getAtTileOffsetFunc(ze,ee.center.lat,ee.worldSize,Ve.getProjection()):null,ra=nn(js,Qe.tileID.canonical,se,Y,ee,Ve.getProjection(),Ns);fc(Ve,js,d,g,ra,ji,se,D,Pn,ze)}const Ss=F||g&&ve||Bs,fs=d.translatePosMatrix(js,Qe,_,j),nr=Ss?wu:qr,Xr=d.translatePosMatrix(ji,Qe,_,j,!0),zs=Ve.getProjection().createInversionMatrix(ee,ze.canonical),ti=[];d.terrainRenderModeElevated()&&se&&ti.push("PITCH_WITH_MAP_TERRAIN"),Pt&&ti.push("PROJECTION_GLOBE_VIEW"),Ss&&ti.push("PROJECTED_POS_ON_VIEWPORT");const kl=Xe&&o.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let sa;sa=Xe?Ve.iconsInText?bu(lt.kind,dt,K,se,d,fs,nr,Xr,Dt,is,ze,ws,be,zs,bs,Ve.getProjection()):hl(lt.kind,dt,K,se,d,fs,nr,Xr,g,Dt,!0,ze,ws,be,zs,bs,Ve.getProjection()):Fc(lt.kind,dt,K,se,d,fs,nr,Xr,g,Dt,ze,ws,be,zs,bs,Ve.getProjection());const Ao={program:d.useProgram(qc(Xe,g,Ve),Fe,ti),buffers:nt,uniformValues:sa,atlasTexture:Vt,atlasTextureIcon:ts,atlasInterpolation:kt,atlasInterpolationIcon:Ot,isSDF:Xe,hasHalo:kl,tile:Qe,labelPlaneMatrixInv:Er};if(ae&&Ve.canOverlap){le=!0;const mn=nt.segments.get();for(const Pn of mn)ke.push({segments:new n.SegmentVector([Pn]),sortKey:Pn.sortKey,state:Ao})}else ke.push({segments:nt.segments,sortKey:0,state:Ao})}le&&ke.sort((ze,Qe)=>ze.sortKey-Qe.sortKey);for(const ze of ke){const Qe=ze.state;if(d.terrain&&d.terrain.setupElevationDraw(Qe.tile,Qe.program,{useDepthForOcclusion:!Me,labelPlaneMatrixInv:Qe.labelPlaneMatrixInv}),G.activeTexture.set(Q.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,Q.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(G.activeTexture.set(Q.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Qe.isSDF){const Ve=Qe.uniformValues;Qe.hasHalo&&(Ve.u_is_halo=1,vo(Qe.buffers,ze.segments,o,d,Qe.program,_e,I,O,Ve)),Ve.u_is_halo=0}vo(Qe.buffers,ze.segments,o,d,Qe.program,_e,I,O,Qe.uniformValues)}}function vo(d,i,o,m,g,_,j,S,C){const D=m.context,I=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];g.draw(D,D.gl.TRIANGLES,_,j,S,n.CullFaceMode.disabled,C,o.id,d.layoutVertexBuffer,d.indexBuffer,i,o.paint,m.transform.zoom,d.programConfigurations.get(o.id),I)}function Nu(d,i,o,m,g,_,j){const S=d.context.gl,C=o.paint.get("fill-pattern"),D=C&&C.constantOr(1);let I,O,G,Q,ee;j?(O=D&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=S.LINES):(O=D?"fillPattern":"fill",I=S.TRIANGLES);for(const Y of m){const se=i.getTile(Y);if(D&&!se.patternsLoaded())continue;const F=se.getBucket(o);if(!F)continue;d.prepareDrawTile();const K=F.programConfigurations.get(o.id),ae=d.useProgram(O,K);D&&(d.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),K.updatePaintBuffers());const le=C.constantOr(null);if(le&&se.imageAtlas){const be=se.imageAtlas.patternPositions[le.toString()];be&&K.setConstantPatternPositions(be)}const _e=d.translatePosMatrix(Y.projMatrix,se,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(j){Q=F.indexBuffer2,ee=F.segments2;const be=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];G=O==="fillOutlinePattern"&&D?wm(_e,d,se,be):bm(_e,be)}else Q=F.indexBuffer,ee=F.segments,G=D?Ic(_e,d,se):Jn(_e);d.prepareDrawProgram(d.context,ae,Y.toUnwrapped()),ae.draw(d.context,I,g,d.stencilModeForClipping(Y),_,n.CullFaceMode.disabled,G,o.id,F.layoutVertexBuffer,Q,ee,o.paint,d.transform.zoom,K)}}function pl(d,i,o,m,g,_,j){const S=d.context,C=S.gl,D=d.transform,I=o.paint.get("fill-extrusion-pattern"),O=I.constantOr(1),G=o.paint.get("fill-extrusion-opacity"),Q=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],ee=o.layout.get("fill-extrusion-edge-radius"),Y=ee>0&&!o.paint.get("fill-extrusion-rounded-roof"),se=Y?0:ee,F=D.projection.name==="globe"?n.fillExtrusionHeightLift():0,K=D.projection.name==="globe",ae=K?n.globeToMercatorTransition(D.zoom):0,le=[n.mercatorXfromLng(D.center.lng),n.mercatorYfromLat(D.center.lat)],_e=[];K&&_e.push("PROJECTION_GLOBE_VIEW"),Q[0]>0&&_e.push("FAUX_AO"),Y&&_e.push("ZERO_ROOF_RADIUS");for(const be of m){const ve=i.getTile(be),Me=ve.getBucket(o);if(!Me||Me.projection.name!==D.projection.name)continue;const ke=Me.programConfigurations.get(o.id),Be=d.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ke,_e);if(d.terrain){const Xe=d.terrain;if(d.style.terrainSetForDrapingOnly())Xe.setupElevationDraw(ve,Be,{useMeterToDem:!0});else{if(!Me.enableTerrain)continue;if(Xe.setupElevationDraw(ve,Be,{useMeterToDem:!0}),Su(S,i,be,Me,o,Xe),!Me.centroidVertexBuffer){const lt=Be.attributes.a_centroid_pos;lt!==void 0&&C.vertexAttrib2f(lt,0,0)}}}O&&(d.context.activeTexture.set(C.TEXTURE0),ve.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ke.updatePaintBuffers());const at=I.constantOr(null);if(at&&ve.imageAtlas){const Xe=ve.imageAtlas.patternPositions[at.toString()];Xe&&ke.setConstantPatternPositions(Xe)}const ze=d.translatePosMatrix(be.projMatrix,ve,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Qe=D.projection.createInversionMatrix(D,be.canonical),Ve=o.paint.get("fill-extrusion-vertical-gradient"),nt=O?yu(ze,d,Ve,G,Q,se,be,ve,F,ae,le,Qe):Pc(ze,d,Ve,G,Q,se,be,F,ae,le,Qe);d.prepareDrawProgram(S,Be,be.toUnwrapped());const Fe=[];d.terrain&&Fe.push(Me.centroidVertexBuffer),K&&Fe.push(Me.layoutVertexExtBuffer),Be.draw(S,S.gl.TRIANGLES,g,_,j,n.CullFaceMode.backCCW,nt,o.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,o.paint,d.transform.zoom,ke,Fe)}}function Su(d,i,o,m,g,_){const j=[F=>{let K=F.canonical.x-1,ae=F.wrap;return K<0&&(K=(1<<F.canonical.z)-1,ae--),new n.OverscaledTileID(F.overscaledZ,ae,F.canonical.z,K,F.canonical.y)},F=>{let K=F.canonical.x+1,ae=F.wrap;return K===1<<F.canonical.z&&(K=0,ae++),new n.OverscaledTileID(F.overscaledZ,ae,F.canonical.z,K,F.canonical.y)},F=>new n.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,(F.canonical.y===0?1<<F.canonical.z:F.canonical.y)-1),F=>new n.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y===(1<<F.canonical.z)-1?0:F.canonical.y+1)],S=F=>{const K=i.getSource().minzoom,ae=_e=>{const be=i.getTileByID(_e);if(be&&be.hasData())return be.getBucket(g)},le=[0,-1,1];for(const _e of le){if(F.overscaledZ+_e<K)continue;const be=ae(F.calculateScaledKey(F.overscaledZ+_e));if(be)return be}},C=[0,0,0],D=(F,K)=>(C[0]=Math.min(F.min.y,K.min.y),C[1]=Math.max(F.max.y,K.max.y),C[2]=n.EXTENT-K.min.x>F.max.x?K.min.x-n.EXTENT:F.max.x,C),I=(F,K)=>(C[0]=Math.min(F.min.x,K.min.x),C[1]=Math.max(F.max.x,K.max.x),C[2]=n.EXTENT-K.min.y>F.max.y?K.min.y-n.EXTENT:F.max.y,C),O=[(F,K)=>D(F,K),(F,K)=>D(K,F),(F,K)=>I(F,K),(F,K)=>I(K,F)],G=new n.Point(0,0);let Q,ee,Y;const se=(F,K,ae,le,_e)=>{const be=[[le?ae:F,le?F:ae,0],[le?ae:K,le?K:ae,0]],ve=_e<0?n.EXTENT+_e:_e,Me=[le?ve:(F+K)/2,le?(F+K)/2:ve,0];return ae===0&&_e<0||ae!==0&&_e>0?_.getForTilePoints(Y,[Me],!0,ee):be.push(Me),_.getForTilePoints(o,be,!0,Q),Math.max(be[0][2],be[1][2],Me[2])/_.exaggeration()};for(let F=0;F<4;F++){const K=(F<2?1:5)-F,ae=m.borders[F];if(ae.length===0)continue;const le=Y=j[F](o),_e=S(le);if(!(_e&&_e instanceof n.FillExtrusionBucket&&_e.enableTerrain)||m.borderDoneWithNeighborZ[F]===_e.canonical.z&&_e.borderDoneWithNeighborZ[K]===m.canonical.z||(ee=_.findDEMTileFor(le),!ee||!ee.dem))continue;if(!Q){const ke=_.findDEMTileFor(o);if(!ke||!ke.dem)return;Q=ke}const be=_e.borders[K];let ve=0;const Me=_e.borderDoneWithNeighborZ[K]!==m.canonical.z;if(m.canonical.z===_e.canonical.z){for(let ke=0;ke<ae.length;ke++){const Be=m.featuresOnBorder[ae[ke]],at=Be.borders[F];let ze;for(;ve<be.length&&(ze=_e.featuresOnBorder[be[ve]],!(ze.borders[K][1]>at[0]+3));)Me&&_e.encodeCentroid(void 0,ze,!1),ve++;if(ze&&ve<be.length){const Qe=ve;let Ve=0;for(;!(ze.borders[K][0]>at[1]-3)&&(Ve++,++ve!==be.length);)ze=_e.featuresOnBorder[be[ve]];if(ze=_e.featuresOnBorder[be[Qe]],Be.intersectsCount()>1||ze.intersectsCount()>1||Ve!==1){Ve!==1&&(ve=Qe),m.encodeCentroid(void 0,Be,!1),Me&&_e.encodeCentroid(void 0,ze,!1);continue}const nt=O[F](Be,ze),Fe=F%2?n.EXTENT-1:0;G.x=se(nt[0],Math.min(n.EXTENT-1,nt[1]),Fe,F<2,nt[2]),G.y=0,m.encodeCentroid(G,Be,!1),Me&&_e.encodeCentroid(G,ze,!1)}else m.encodeCentroid(void 0,Be,!1)}m.borderDoneWithNeighborZ[F]=_e.canonical.z,m.needsCentroidUpdate=!0,Me&&(_e.borderDoneWithNeighborZ[K]=m.canonical.z,_e.needsCentroidUpdate=!0)}else{for(const ke of ae)m.encodeCentroid(void 0,m.featuresOnBorder[ke],!1);if(Me){for(const ke of be)_e.encodeCentroid(void 0,_e.featuresOnBorder[ke],!1);_e.borderDoneWithNeighborZ[K]=m.canonical.z,_e.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[F]=_e.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(d)}const Sa=new n.Color(1,0,0,1),Em=new n.Color(0,1,0,1),Cm=new n.Color(0,0,1,1),km=new n.Color(1,0,1,1),Am=new n.Color(0,1,1,1);function Mm(d,i,o){const m=d.context,g=d.transform,_=m.gl,j=g.projection.name==="globe",S=j?["PROJECTION_GLOBE_VIEW"]:null;let C=o.projMatrix;if(j&&n.globeToMercatorTransition(g.zoom)>0){const Be=n.transitionTileAABBinECEF(o.canonical,g),at=n.globeDenormalizeECEF(Be);C=n.multiply(new Float32Array(16),g.globeMatrix,at),n.multiply(C,g.projMatrix,C)}const D=d.useProgram("debug",null,S),I=i.getTileByID(o.key);d.terrain&&d.terrain.setupElevationDraw(I,D);const O=n.DepthMode.disabled,G=n.StencilMode.disabled,Q=d.colorModeForRenderPass(),ee="$debug";m.activeTexture.set(_.TEXTURE0),d.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),j?I._makeGlobeTileDebugBuffers(d.context,g):I._makeDebugTileBoundsBuffers(d.context,g.projection);const Y=I._tileDebugBuffer||d.debugBuffer,se=I._tileDebugIndexBuffer||d.debugIndexBuffer,F=I._tileDebugSegments||d.debugSegments;D.draw(m,_.LINE_STRIP,O,G,Q,n.CullFaceMode.disabled,dl(C,n.Color.red),ee,Y,se,F,null,null,null,[I._globeTileDebugBorderBuffer]);const K=I.latestRawTileData,ae=Math.floor((K&&K.byteLength||0)/1024),le=i.getTile(o).tileSize,_e=512/Math.min(le,512)*(o.overscaledZ/g.zoom)*.5;let be=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(be+=` => ${o.overscaledZ}`),be+=` ${ae}kb`,function(Be,at){Be.initDebugOverlayCanvas();const ze=Be.debugOverlayCanvas,Qe=Be.context.gl,Ve=Be.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,ze.width,ze.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(at,5,5),Ve.strokeText(at,5,5),Be.debugOverlayTexture.update(ze),Be.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(d,be);const ve=I._tileDebugTextBuffer||d.debugBuffer,Me=I._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,ke=I._tileDebugTextSegments||d.debugSegments;D.draw(m,_.TRIANGLES,O,G,n.ColorMode.alphaBlended,n.CullFaceMode.disabled,dl(C,n.Color.transparent,_e),ee,ve,Me,ke,null,null,null,[I._globeTileDebugTextBuffer])}function Tu(d,i,o,m){Ta(d,0,i+o/2,d.transform.width,o,m)}function fl(d,i,o,m){Ta(d,i-o/2,0,o,d.transform.height,m)}function Ta(d,i,o,m,g,_){const j=d.context,S=j.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*n.exported.devicePixelRatio,o*n.exported.devicePixelRatio,m*n.exported.devicePixelRatio,g*n.exported.devicePixelRatio),j.clear({color:_}),S.disable(S.SCISSOR_TEST)}const Eu=n.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Cu}=Eu;function un(d,i,o,m){d.emplaceBack(i,o,m)}class gl{constructor(i){this.vertexArray=new n.StructArrayLayout3f12,this.indices=new n.StructArrayLayout3ui6,un(this.vertexArray,-1,-1,1),un(this.vertexArray,1,-1,1),un(this.vertexArray,-1,1,1),un(this.vertexArray,1,1,1),un(this.vertexArray,-1,-1,-1),un(this.vertexArray,1,-1,-1),un(this.vertexArray,-1,1,-1),un(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Cu),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=n.SegmentVector.simpleSegment(0,0,36,12)}}function bi(d,i,o,m,g,_){const j=d.gl,S=i.paint.get("sky-atmosphere-color"),C=i.paint.get("sky-atmosphere-halo-color"),D=i.paint.get("sky-atmosphere-sun-intensity"),I=((O,G,Q,ee,Y)=>({u_matrix_3f:O,u_sun_direction:G,u_sun_intensity:Q,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(n.fromMat4(n.create$1(),m),g,D,S,C);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+_,i.skyboxTexture,0),o.draw(d,j.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.frontCW,I,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const bo=n.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ku{constructor(i){const o=new n.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const m=new n.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,bo.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=n.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Yn={symbol:function(d,i,o,m,g){if(d.renderPass!=="translucent")return;const _=n.StencilMode.disabled,j=d.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(S,C,D,I,O,G,Q){const ee=C.transform,Y=O==="map",se=G==="map";for(const F of S){const K=I.getTile(F),ae=K.getBucket(D);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const le=n.evaluateSizeForZoom(ae.textSizeData,ee.zoom),_e=Fs(F,ae.getProjection(),ee),be=ee.calculatePixelsToTileUnitsMatrix(K),ve=We(_e,K.tileID.canonical,se,Y,ee,ae.getProjection(),be),Me=D.layout.get("icon-text-fit")!=="none"&&ae.hasIconData();if(le){const ke=Math.pow(2,ee.zoom-K.tileID.overscaledZ);Tm(ae,Y,se,Q,n.symbolSize,ee,ve,F,ke,le,Me)}}}(m,d,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g),o.paint.get("icon-opacity").constantOr(1)!==0&&ju(d,i,o,m,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),_,j),o.paint.get("text-opacity").constantOr(1)!==0&&ju(d,i,o,m,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),_,j),i.map.showCollisionBoxes&&(_o(d,i,o,m,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),_o(d,i,o,m,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,o,m){if(d.renderPass!=="translucent")return;const g=o.paint.get("circle-opacity"),_=o.paint.get("circle-stroke-width"),j=o.paint.get("circle-stroke-opacity"),S=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)===0&&(_.constantOr(1)===0||j.constantOr(1)===0))return;const C=d.context,D=C.gl,I=d.transform,O=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),G=n.StencilMode.disabled,Q=d.colorModeForRenderPass(),ee=I.projection.name==="globe",Y=[n.mercatorXfromLng(I.center.lng),n.mercatorYfromLat(I.center.lat)],se=[];for(let K=0;K<m.length;K++){const ae=m[K],le=i.getTile(ae),_e=le.getBucket(o);if(!_e||_e.projection.name!==I.projection.name)continue;const be=_e.programConfigurations.get(o.id),ve=Lc(o);ee&&ve.push("PROJECTION_GLOBE_VIEW");const Me=d.useProgram("circle",be,ve),ke=_e.layoutVertexBuffer,Be=_e.globeExtVertexBuffer,at=_e.indexBuffer,ze=I.projection.createInversionMatrix(I,ae.canonical),Qe={programConfiguration:be,program:Me,layoutVertexBuffer:ke,globeExtVertexBuffer:Be,indexBuffer:at,uniformValues:Dc(d,ae,le,ze,Y,o),tile:le};if(S){const Ve=_e.segments.get();for(const nt of Ve)se.push({segments:new n.SegmentVector([nt]),sortKey:nt.sortKey,state:Qe})}else se.push({segments:_e.segments,sortKey:0,state:Qe})}S&&se.sort((K,ae)=>K.sortKey-ae.sortKey);const F={useDepthForOcclusion:!ee};for(const K of se){const{programConfiguration:ae,program:le,layoutVertexBuffer:_e,globeExtVertexBuffer:be,indexBuffer:ve,uniformValues:Me,tile:ke}=K.state,Be=K.segments;d.terrain&&d.terrain.setupElevationDraw(ke,le,F),d.prepareDrawProgram(C,le,ke.tileID.toUnwrapped()),le.draw(C,D.TRIANGLES,O,G,Q,n.CullFaceMode.disabled,Me,o.id,_e,ve,Be,o.paint,I.zoom,ae,[be])}},heatmap:function(d,i,o,m){if(o.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const g=d.context,_=g.gl,j=n.StencilMode.disabled,S=new n.ColorMode([_.ONE,_.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(Q,ee,Y,se){const F=Q.gl,K=ee.width*se,ae=ee.height*se;Q.activeTexture.set(F.TEXTURE1),Q.viewport.set([0,0,K,ae]);let le=Y.heatmapFbo;if(!le||le&&(le.width!==K||le.height!==ae)){le&&le.destroy();const _e=F.createTexture();F.bindTexture(F.TEXTURE_2D,_e),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),le=Y.heatmapFbo=Q.createFramebuffer(K,ae,!1),function(be,ve,Me,ke,Be,at){const ze=be.gl;ze.texImage2D(ze.TEXTURE_2D,0,be.isWebGL2&&be.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,Be,at,0,ze.RGBA,be.extRenderToTextureHalfFloat?be.isWebGL2?ze.HALF_FLOAT:be.extTextureHalfFloat.HALF_FLOAT_OES:ze.UNSIGNED_BYTE,null),ke.colorAttachment.set(Me)}(Q,0,_e,le,K,ae)}else F.bindTexture(F.TEXTURE_2D,le.colorAttachment.get()),Q.bindFramebuffer.set(le.framebuffer)})(g,d,o,d.transform.projection.name==="globe"?.5:.25),g.clear({color:n.Color.transparent});const C=d.transform,D=C.projection.name==="globe",I=D?["PROJECTION_GLOBE_VIEW"]:null,O=D?n.CullFaceMode.frontCCW:n.CullFaceMode.disabled,G=[n.mercatorXfromLng(C.center.lng),n.mercatorYfromLat(C.center.lat)];for(let Q=0;Q<m.length;Q++){const ee=m[Q];if(i.hasRenderableParent(ee))continue;const Y=i.getTile(ee),se=Y.getBucket(o);if(!se||se.projection.name!==C.projection.name)continue;const F=se.programConfigurations.get(o.id),K=d.useProgram("heatmap",F,I),{zoom:ae}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Y,K),d.prepareDrawProgram(g,K,ee.toUnwrapped());const le=C.projection.createInversionMatrix(C,ee.canonical);K.draw(g,_.TRIANGLES,n.DepthMode.disabled,j,S,O,vu(d,ee,Y,le,G,ae,o.paint.get("heatmap-intensity")),o.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,o.paint,d.transform.zoom,F,D?[se.globeExtVertexBuffer]:null)}g.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(g,_){const j=g.context,S=j.gl,C=_.heatmapFbo;if(!C)return;j.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),j.activeTexture.set(S.TEXTURE1);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new n.Texture(j,_.colorRamp,S.RGBA)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(j,S.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,g.colorModeForRenderPass(),n.CullFaceMode.disabled,((I,O,G,Q)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,_),_.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,_.paint,g.transform.zoom)}(d,o))},line:function(d,i,o,m){if(d.renderPass!=="translucent")return;const g=o.paint.get("line-opacity"),_=o.paint.get("line-width");if(g.constantOr(1)===0||_.constantOr(1)===0)return;const j=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),C=d.terrain&&d.terrain.renderingToTexture?1:n.exported.devicePixelRatio,D=o.paint.get("line-dasharray"),I=D.constantOr(1),O=o.layout.get("line-cap"),G=o.paint.get("line-pattern"),Q=G.constantOr(1),ee=o.paint.get("line-gradient"),Y=Q?"linePattern":"line",se=d.context,F=se.gl,K=(le=>{const _e=[];yo(le)&&_e.push("RENDER_LINE_DASH"),le.paint.get("line-gradient")&&_e.push("RENDER_LINE_GRADIENT");const be=le.paint.get("line-trim-offset");be[0]===0&&be[1]===0||_e.push("RENDER_LINE_TRIM_OFFSET");const ve=le.paint.get("line-pattern").constantOr(1),Me=le.paint.get("line-opacity").constantOr(1)!==1;return!ve&&Me&&_e.push("RENDER_LINE_ALPHA_DISCARD"),_e})(o);let ae=K.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ae=!1);for(const le of m){const _e=i.getTile(le);if(Q&&!_e.patternsLoaded())continue;const be=_e.getBucket(o);if(!be)continue;d.prepareDrawTile();const ve=be.programConfigurations.get(o.id),Me=d.useProgram(Y,ve,K),ke=G.constantOr(null);if(ke&&_e.imageAtlas){const Xe=_e.imageAtlas.patternPositions[ke.toString()];Xe&&ve.setConstantPatternPositions(Xe)}const Be=D.constantOr(null),at=O.constantOr(null);if(!Q&&Be&&at&&_e.lineAtlas){const Xe=_e.lineAtlas.getDash(Be,at);Xe&&ve.setConstantPatternPositions(Xe)}let[ze,Qe]=o.paint.get("line-trim-offset");(at==="round"||at==="square")&&ze!==Qe&&(ze===0&&(ze-=1),Qe===1&&(Qe+=1));const Ve=d.terrain?le.projMatrix:null,nt=Q?xo(d,_e,o,Ve,C):Nm(d,_e,o,Ve,be.lineClipsArray.length,C,[ze,Qe]);if(ee){const Xe=be.gradients[o.id];let lt=Xe.texture;if(o.gradientVersion!==Xe.version){let st=256;if(o.stepInterpolant){const dt=i.getSource().maxzoom,Dt=le.canonical.z===dt?Math.ceil(1<<d.transform.maxZoom-le.canonical.z):1;st=n.clamp(n.nextPowerOfTwo(be.maxLineLength/n.EXTENT*1024*Dt),256,se.maxTextureSize)}Xe.gradient=n.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:st,image:Xe.gradient||void 0,clips:be.lineClipsArray}),Xe.texture?Xe.texture.update(Xe.gradient):Xe.texture=new n.Texture(se,Xe.gradient,F.RGBA),Xe.version=o.gradientVersion,lt=Xe.texture}se.activeTexture.set(F.TEXTURE1),lt.bind(o.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}I&&(se.activeTexture.set(F.TEXTURE0),_e.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),ve.updatePaintBuffers()),Q&&(se.activeTexture.set(F.TEXTURE0),_e.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),ve.updatePaintBuffers()),d.prepareDrawProgram(se,Me,le.toUnwrapped());const Fe=Xe=>{Me.draw(se,F.TRIANGLES,j,Xe,S,n.CullFaceMode.disabled,nt,o.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,o.paint,d.transform.zoom,ve,[be.layoutVertexBuffer2])};if(ae){const Xe=d.stencilModeForClipping(le).ref;Xe===0&&d.terrain&&se.clear({stencil:0});const lt={func:F.EQUAL,mask:255};nt.u_alpha_discard_threshold=.8,Fe(new n.StencilMode(lt,Xe,255,F.KEEP,F.KEEP,F.INVERT)),nt.u_alpha_discard_threshold=0,Fe(new n.StencilMode(lt,Xe,255,F.KEEP,F.KEEP,F.KEEP))}else Fe(d.stencilModeForClipping(le))}ae&&(d.resetStencilClippingMasks(),d.terrain&&se.clear({stencil:0}))},fill:function(d,i,o,m){const g=o.paint.get("fill-color"),_=o.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const j=d.colorModeForRenderPass(),S=o.paint.get("fill-pattern"),C=d.opaquePassEnabledForLayer()&&!S.constantOr(1)&&g.constantOr(n.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===C){const D=d.depthModeForSublayer(1,d.renderPass==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly);Nu(d,i,o,m,D,j,!1)}if(d.renderPass==="translucent"&&o.paint.get("fill-antialias")){const D=d.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,n.DepthMode.ReadOnly);Nu(d,i,o,m,D,j,!0)}},"fill-extrusion":function(d,i,o,m){const g=o.paint.get("fill-extrusion-opacity");if(g!==0&&d.renderPass==="translucent"){const _=new n.DepthMode(d.context.gl.LEQUAL,n.DepthMode.ReadWrite,d.depthRangeFor3D);if(g!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))pl(d,i,o,m,_,n.StencilMode.disabled,n.ColorMode.disabled),pl(d,i,o,m,_,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const j=d.colorModeForRenderPass();pl(d,i,o,m,_,n.StencilMode.disabled,j)}}},hillshade:function(d,i,o,m){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const g=d.context,_=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),j=d.colorModeForRenderPass(),S=d.terrain&&d.terrain.renderingToTexture,[C,D]=d.renderPass!=="translucent"||S?[{},m]:d.stencilConfigForOverlap(m);for(const I of D){const O=i.getTile(I);if(O.needsHillshadePrepare&&d.renderPass==="offscreen")fu(d,O,o,_,n.StencilMode.disabled,j);else if(d.renderPass==="translucent"){const G=S&&d.terrain?d.terrain.stencilModeForRTTOverlap(I):C[I.overscaledZ];pu(d,I,O,o,_,G,j)}}g.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,i,o,m,g,_){if(d.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!m.length)return;const j=d.context,S=j.gl,C=i.getSource(),D=d.useProgram("raster"),I=d.colorModeForRenderPass(),O=d.terrain&&d.terrain.renderingToTexture,[G,Q]=C instanceof Yt||O?[{},m]:d.stencilConfigForOverlap(m),ee=Q[Q.length-1].overscaledZ,Y=!d.options.moving;for(const se of Q){const F=O?n.DepthMode.disabled:d.depthModeForSublayer(se.overscaledZ-ee,o.paint.get("raster-opacity")===1?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly,S.LESS),K=se.toUnwrapped(),ae=i.getTile(se);if(O&&(!ae||!ae.hasData()))continue;const le=O?se.projMatrix:d.transform.calculateProjMatrix(K,Y),_e=d.terrain&&O?d.terrain.stencilModeForRTTOverlap(se):G[se.overscaledZ],be=_?0:o.paint.get("raster-fade-duration");ae.registerFadeDuration(be);const ve=i.findLoadedParent(se,0),Me=kc(ae,ve,i,d.transform,be);let ke,Be;d.terrain&&d.terrain.prepareDrawTile();const at=o.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;j.activeTexture.set(S.TEXTURE0),ae.texture.bind(at,S.CLAMP_TO_EDGE),j.activeTexture.set(S.TEXTURE1),ve?(ve.texture.bind(at,S.CLAMP_TO_EDGE),ke=Math.pow(2,ve.tileID.overscaledZ-ae.tileID.overscaledZ),Be=[ae.tileID.canonical.x*ke%1,ae.tileID.canonical.y*ke%1]):ae.texture.bind(at,S.CLAMP_TO_EDGE),ae.texture.useMipmap&&j.extTextureFilterAnisotropic&&d.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const ze=Oc(le,Be||[0,0],ke||1,Me,o,C instanceof Yt?C.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(j,D,K),C instanceof Yt)C.boundsBuffer&&C.boundsSegments&&D.draw(j,S.TRIANGLES,F,n.StencilMode.disabled,I,n.CullFaceMode.disabled,ze,o.id,C.boundsBuffer,d.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Qe,tileBoundsIndexBuffer:Ve,tileBoundsSegments:nt}=d.getTileBoundsBuffers(ae);D.draw(j,S.TRIANGLES,F,_e,I,n.CullFaceMode.disabled,ze,o.id,Qe,Ve,nt)}}d.resetStencilClippingMasks()},background:function(d,i,o,m){const g=o.paint.get("background-color"),_=o.paint.get("background-opacity");if(_===0)return;const j=d.context,S=j.gl,C=d.transform,D=C.tileSize,I=o.paint.get("background-pattern");if(d.isPatternMissing(I))return;const O=!I&&g.a===1&&_===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==O)return;const G=n.StencilMode.disabled,Q=d.depthModeForSublayer(0,O==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly),ee=d.colorModeForRenderPass(),Y=d.useProgram(I?"backgroundPattern":"background");let se,F=m;F||(se=d.getBackgroundTiles(),F=Object.values(se).map(K=>K.tileID)),I&&(j.activeTexture.set(S.TEXTURE0),d.imageManager.bind(d.context));for(const K of F){const ae=K.toUnwrapped(),le=m?K.projMatrix:d.transform.calculateProjMatrix(ae);d.prepareDrawTile();const _e=i?i.getTile(K):se?se[K.key]:new n.Tile(K,D,C.zoom,d),be=I?Sm(le,_,d,I,{tileID:K,tileSize:D}):Bc(le,_,g);d.prepareDrawProgram(j,Y,ae);const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Me,tileBoundsSegments:ke}=d.getTileBoundsBuffers(_e);Y.draw(j,S.TRIANGLES,Q,G,ee,n.CullFaceMode.disabled,be,o.id,ve,Me,ke)}},sky:function(d,i,o){const m=d.transform,g=m.projection.name==="mercator"||m.projection.name==="globe"?1:n.smoothstep(7,8,m.zoom),_=o.paint.get("sky-opacity")*g;if(_===0)return;const j=d.context,S=o.paint.get("sky-type"),C=new n.DepthMode(j.gl.LEQUAL,n.DepthMode.ReadOnly,[0,1]),D=d.frameCounter/1e3%1;S==="atmosphere"?d.renderPass==="offscreen"?o.needsSkyboxCapture(d)&&(function(I,O,G,Q){const ee=I.context,Y=ee.gl;let se=O.skyboxFbo;if(!se){se=O.skyboxFbo=ee.createFramebuffer(32,32,!1),O.skyboxGeometry=new gl(ee),O.skyboxTexture=ee.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,O.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let le=0;le<6;++le)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(se.framebuffer),ee.viewport.set([0,0,32,32]);const F=O.getCenter(I,!0),K=I.useProgram("skyboxCapture"),ae=new Float64Array(16);n.identity(ae),n.rotateY(ae,ae,.5*-Math.PI),bi(ee,O,K,ae,F,0),n.identity(ae),n.rotateY(ae,ae,.5*Math.PI),bi(ee,O,K,ae,F,1),n.identity(ae),n.rotateX(ae,ae,.5*-Math.PI),bi(ee,O,K,ae,F,2),n.identity(ae),n.rotateX(ae,ae,.5*Math.PI),bi(ee,O,K,ae,F,3),n.identity(ae),bi(ee,O,K,ae,F,4),n.identity(ae),n.rotateY(ae,ae,Math.PI),bi(ee,O,K,ae,F,5),ee.viewport.set([0,0,I.width,I.height])}(d,o),o.markSkyboxValid(d)):d.renderPass==="sky"&&function(I,O,G,Q,ee){const Y=I.context,se=Y.gl,F=I.transform,K=I.useProgram("skybox");Y.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,O.skyboxTexture);const ae=((le,_e,be,ve,Me)=>({u_matrix:le,u_sun_direction:_e,u_cubemap:0,u_opacity:ve,u_temporal_offset:Me}))(F.skyboxMatrix,O.getCenter(I,!1),0,Q,ee);I.prepareDrawProgram(Y,K),K.draw(Y,se.TRIANGLES,G,n.StencilMode.disabled,I.colorModeForRenderPass(),n.CullFaceMode.backCW,ae,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,o,C,_,D):S==="gradient"&&d.renderPass==="sky"&&function(I,O,G,Q,ee){const Y=I.context,se=Y.gl,F=I.transform,K=I.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new gl(Y)),Y.activeTexture.set(se.TEXTURE0);let ae=O.colorRampTexture;ae||(ae=O.colorRampTexture=new n.Texture(Y,O.colorRamp,se.RGBA)),ae.bind(se.LINEAR,se.CLAMP_TO_EDGE);const le=((_e,be,ve,Me,ke)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:be,u_radius:n.degToRad(ve),u_opacity:Me,u_temporal_offset:ke}))(F.skyboxMatrix,O.getCenter(I,!1),O.paint.get("sky-gradient-radius"),Q,ee);I.prepareDrawProgram(Y,K),K.draw(Y,se.TRIANGLES,G,n.StencilMode.disabled,I.colorModeForRenderPass(),n.CullFaceMode.backCW,le,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,o,C,_,D)},debug:function(d,i,o){for(let m=0;m<o.length;m++)Mm(d,i,o[m])},custom:function(d,i,o,m){const g=d.context,_=o.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&o.isLayerDraped()){if(d.renderPass==="offscreen"){const j=_.prerender;if(j){if(d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const S=d.transform.pointMerc;j.call(_,g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),n.globeToMercatorTransition(d.transform.zoom),[S.x,S.y],d.transform.pixelsPerMeterRatio)}else j.call(_,g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const S=_.renderToTile;if(S){const C=m[0].canonical,D=new n.MercatorCoordinate(C.x+m[0].wrap*(1<<C.z),C.y,C.z);g.setDepthMode(n.DepthMode.disabled),g.setStencilMode(n.StencilMode.disabled),g.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),S.call(_,g.gl,D),g.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),g.setStencilMode(n.StencilMode.disabled);const j=_.renderingMode==="3d"?new n.DepthMode(d.context.gl.LEQUAL,n.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,n.DepthMode.ReadOnly);if(g.setDepthMode(j),d.transform.projection.name==="globe"){const S=d.transform.pointMerc;_.render(g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),n.globeToMercatorTransition(d.transform.zoom),[S.x,S.y],d.transform.pixelsPerMeterRatio)}else _.render(g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState(),g.bindFramebuffer.set(null)}}else n.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ea{constructor(i,o,m=!1){this.context=new gt(i,m),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=n.SourceCache.maxUnderzooming+n.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,o){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Mc(this,i));const g=this._terrain;this.transform.elevation=m?g:null,g.update(i,this.transform,o)}_updateFog(i){const o=i.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,g]=o.getFovAdjustedRange(this.transform._fov);if(m>g)return void(this.transform.fogCullDistSq=null);const _=m+.78*(g-m);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,o){if(this.width=i*n.exported.devicePixelRatio,this.height=o*n.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const i=this.context,o=new n.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(n.EXTENT,0),o.emplaceBack(0,n.EXTENT),o.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(o,n.posAttributes.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const m=new n.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(n.EXTENT,0),m.emplaceBack(0,n.EXTENT),m.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=i.createVertexBuffer(m,n.posAttributes.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const g=new n.StructArrayLayout2i4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,n.posAttributes.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const _=new n.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(n.EXTENT,0,n.EXTENT,0),_.emplaceBack(0,n.EXTENT,0,n.EXTENT),_.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(_,n.boundsAttributes.members),this.mercatorBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const j=new n.StructArrayLayout3ui6;j.emplaceBack(0,1,2),j.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(j);const S=new n.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])S.emplaceBack(D);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new n.Texture(i,new n.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=n.create();const C=this.context.gl;this.stencilClearMode=new n.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(n.window.performance.now()),this.atmosphereBuffer=new ku(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,o.TRIANGLES,n.DepthMode.disabled,this.stencilClearMode,n.ColorMode.disabled,n.CullFaceMode.disabled,fo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,m){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const C of m)if(this._tileClippingMaskIDs[C.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=o.id;const g=this.context,_=g.gl;this.nextStencilID+m.length>256&&this.clearStencil(),g.setColorMode(n.ColorMode.disabled),g.setDepthMode(n.DepthMode.disabled);const j=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of m){const C=o.getTile(S),D=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:O,tileBoundsSegments:G}=this.getTileBoundsBuffers(C);j.draw(g,_.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:_.ALWAYS,mask:0},D,255,_.KEEP,_.KEEP,_.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,fo(S.projMatrix),"$clipping",I,O,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new n.StencilMode({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new n.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,m=i.sort((j,S)=>S.overscaledZ-j.overscaledZ),g=m[m.length-1].overscaledZ,_=m[0].overscaledZ-g+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const j={};for(let S=0;S<_;S++)j[S+g]=new n.StencilMode({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[j,m]}return[{[g]:n.StencilMode.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new n.ColorMode([i.CONSTANT_COLOR,i.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?n.ColorMode.unblended:n.ColorMode.alphaBlended}depthModeForSublayer(i,o,m){if(!this.opaquePassEnabledForLayer())return n.DepthMode.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new n.DepthMode(m||this.context.gl.LEQUAL,o,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();const m=this.style.order,g=this.style._sourceCaches;for(const D in g){const I=g[D];I.used&&I.prepare(this.context)}const _={},j={},S={};for(const D in g){const I=g[D];_[D]=I.getVisibleCoordinates(),j[D]=_[D].slice().reverse(),S[D]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<m.length;D++)if(this.style._layers[m[D]].is3D()){this.opaquePassCutoff=D;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.GlobeSharedBuffers(this.context)),!n.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const D of m){const I=this.style._layers[D],O=i._getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const G=O?j[O.id]:void 0;(I.type==="custom"||I.isSky()||G&&G.length)&&this.renderLayer(this,O,I,G)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon];const C=this.terrain;if(C&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&C.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);if(D.isSky())continue;const O=I?j[I.id]:void 0;this._renderTileClippingMasks(D,I,O),this.renderLayer(this,I,D,O)}if(this.style.fog&&this.transform.projection.supportsFog&&function(D,I){const O=D.context,G=O.gl,Q=D.transform,ee=new n.DepthMode(G.LEQUAL,n.DepthMode.ReadOnly,[0,1]),Y=D.useProgram("globeAtmosphere",null,Q.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),se=n.globeToMercatorTransition(Q.zoom),F=I.properties.get("color").toArray01(),K=I.properties.get("high-color").toArray01(),ae=I.properties.get("space-color").toArray01PremultipliedAlpha(),le=n.identity$1([]);n.rotateY$1(le,le,-n.degToRad(Q._center.lng)),n.rotateX$1(le,le,n.degToRad(Q._center.lat)),n.rotateZ$1(le,le,Q.angle),n.rotateX$1(le,le,-Q._pitch);const _e=n.fromQuat(new Float32Array(16),le),be=n.mapValue(I.properties.get("star-intensity"),0,1,0,.25),ve=5e-4,Me=n.mapValue(I.properties.get("horizon-blend"),0,1,ve,.25),ke=n.globeUseCustomAntiAliasing(D,O,Q)&&Me===ve?Q.worldSize/(2*Math.PI*1.025)-1:Q.globeRadius,Be=D.frameCounter/1e3%1,at=n.length(Q.globeCenterInViewSpace),ze=Math.sqrt(Math.pow(at,2)-Math.pow(ke,2)),Qe=Math.acos(ze/at),Ve=((Fe,Xe,lt,st,dt,Dt,Vt,kt,Ot,is,ts,Pt,bs,ws)=>({u_frustum_tl:Fe,u_frustum_tr:Xe,u_frustum_br:lt,u_frustum_bl:st,u_horizon:dt,u_transition:Dt,u_fadeout_range:Vt,u_color:kt,u_high_color:Ot,u_space_color:is,u_star_intensity:ts,u_star_size:5*n.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Pt,u_horizon_angle:bs,u_rotation_matrix:ws}))(Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.frustumCorners.horizon,se,Me,F,K,ae,be,Be,Qe,_e);D.prepareDrawProgram(O,Y);const nt=D.atmosphereBuffer;nt&&Y.draw(O,G.TRIANGLES,ee,n.StencilMode.disabled,n.ColorMode.alphaBlended,n.CullFaceMode.backCW,Ve,"skybox",nt.vertexBuffer,nt.indexBuffer,nt.segments)}(this,this.style.fog),this.renderPass="sky",(n.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);D.isSky()&&this.renderLayer(this,I,D,I?j[I.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);if(D.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(D)){if(D.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=I?(D.type==="symbol"?S:j)[I.id]:void 0;this._renderTileClippingMasks(D,I,I?_[I.id]:void 0),this.renderLayer(this,I,D,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let D=null;n.values(this.style._layers).forEach(I=>{const O=i._getLayerSourceCache(I);O&&!I.isHidden(this.transform.zoom)&&(!D||D.getSource().maxzoom<O.getSource().maxzoom)&&(D=O)}),D&&this.options.showTileBoundaries&&Yn.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const I=D.transform.padding;Tu(D,D.transform.height-(I.top||0),3,Sa),Tu(D,I.bottom||0,3,Em),fl(D,I.left||0,3,Cm),fl(D,D.transform.width-(I.right||0),3,km);const O=D.transform.centerPoint;(function(G,Q,ee,Y){Ta(G,Q-1,ee-10,2,20,Y),Ta(G,Q-10,ee-1,20,2,Y)})(D,O.x,D.transform.height-O.y,Am)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(n.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,o,m,g){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||g&&g.length)&&(this.id=m.id,this.gpuTimingStart(m),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(m.type)||i.terrain&&m.type==="custom")&&Yn[m.type](i,o,m,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),m.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),i.beginQueryEXT(i.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const m in i){const g=i[m],_=this.context.extTimerQuery,j=_.getQueryObjectEXT(g.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(g.query),o[m]=j}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let m=0;for(const g of i)m+=o.getQueryObjectEXT(g,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(g);return m}translatePosMatrix(i,o,m,g,_){if(!m[0]&&!m[1])return i;const j=_?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(j){const D=Math.sin(j),I=Math.cos(j);m=[m[0]*I-m[1]*D,m[0]*D+m[1]*I]}const S=[_?m[0]:_s(o,m[0],this.transform.zoom),_?m[1]:_s(o,m[1],this.transform.zoom),0],C=new Float32Array(16);return n.translate(C,i,S),C}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){return i===null||i!==void 0&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,o=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,g=[];return this.terrainRenderModeElevated()&&g.push("TERRAIN"),this.transform.projection.name==="globe"&&g.push("GLOBE"),o&&g.push("ZERO_EXAGGERATION"),m&&!i&&m.getOpacity(this.transform.pitch)!==0&&g.push("FOG"),i&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(i,o,m){this.cache=this.cache||{};const g=m||[],_=this.currentGlobalDefines().concat(g),j=us.cacheKey(Sc[i],i,_,o);return this.cache[j]||(this.cache[j]=new us(this.context,i,Sc[i],o,Uc[i],_)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=n.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,o,m){if(this.terrain&&this.terrain.renderingToTexture)return;const g=this.style.fog;if(g){const _=g.getOpacity(this.transform.pitch),j=((S,C,D,I,O,G,Q,ee,Y,se,F)=>{const K=S.transform,ae=C.properties.get("color").toArray01();ae[3]=I;const le=S.frameCounter/1e3%1;return{u_fog_matrix:D?K.calculateFogTileMatrix(D):S.identityMat,u_fog_range:C.getFovAdjustedRange(K._fov),u_fog_color:ae,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:le,u_frustum_tl:O,u_frustum_tr:G,u_frustum_br:Q,u_frustum_bl:ee,u_globe_pos:Y,u_globe_radius:se,u_viewport:F,u_globe_transition:n.globeToMercatorTransition(K.zoom),u_is_globe:+(K.projection.name==="globe")}})(this,g,m,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.exported.devicePixelRatio,this.transform.height*n.exported.devicePixelRatio]);o.setFogUniformValues(i,j)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const g of m)o[g.key]=i[g.key]||new n.Tile(g,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class xl{constructor(i=0,o=0,m=0,g=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(m)||m<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=m,this.right=g}interpolate(i,o,m){return o.top!=null&&i.top!=null&&(this.top=n.number(i.top,o.top,m)),o.bottom!=null&&i.bottom!=null&&(this.bottom=n.number(i.bottom,o.bottom,m)),o.left!=null&&i.left!=null&&(this.left=n.number(i.left,o.left,m)),o.right!=null&&i.right!=null&&(this.right=n.number(i.right,o.right,m)),this}getCenter(i,o){const m=n.clamp((this.left+i-this.right)/2,0,i),g=n.clamp((this.top+o-this.bottom)/2,0,o);return new n.Point(m,g)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new xl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yl(d,i){const o=n.getColumn(d,3);n.fromQuat(d,i),n.setColumn(d,3,o)}function ms(d,i){const o=n.identity$1([]);return n.rotateZ$1(o,o,-i),n.rotateX$1(o,o,-d),o}function wo(d,i){const o=[d[0],d[1],0],m=[i[0],i[1],0];if(n.length(o)>=1e-15){const j=n.normalize([],o);n.scale$2(m,j,n.dot(m,j)),i[0]=m[0],i[1]=m[1]}const g=n.cross([],i,d);if(n.len(g)<1e-15)return null;const _=Math.atan2(-g[1],g[0]);return ms(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),_)}class Au{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof n.MercatorCoordinate?i:new n.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=n.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const m=this.position,g=this._elevation?this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(i)):0,_=n.MercatorCoordinate.fromLngLat(i,g),j=[_.x-m.x,_.y-m.y,_.z-m.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=wo(j,o)}setPitchBearing(i,o){this.orientation=ms(n.degToRad(i),n.degToRad(-o))}}class _l{constructor(i,o){this._transform=n.identity([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new n.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=n.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&n.setColumn(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||n.identity$1([]),i&&yl(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=ms(i,o),yl(this._transform,this._orientation)}forward(){const i=n.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=n.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=n.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const m=new Float64Array(16);return n.invert(m,this.getWorldToCamera(i,o)),m}getWorldToCameraPosition(i,o,m){const g=this.position;n.scale$2(g,g,-i);const _=new Float64Array(16);return n.fromScaling(_,[m,m,m]),n.translate(_,_,g),_[10]*=o,_}getWorldToCamera(i,o){const m=new Float64Array(16),g=new Float64Array(4),_=this.position;return n.conjugate(g,this._orientation),n.scale$2(_,_,-i),n.fromQuat(m,g),n.translate(m,m,_),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=o,m[9]*=o,m[10]*=o,m[11]*=o,m}getCameraToClipPerspective(i,o,m,g){const _=new Float64Array(16);return n.perspective(_,i,o,m,g),_}getDistanceToElevation(i,o=!1){const m=i===0?0:n.mercatorZfromAltitude(i,o?n.latFromMercatorY(this.position[1]):this.position[1]),g=this.forward();return(m-this.position[2])/g[2]}clone(){return new _l([...this.position],[...this.orientation])}}function Ca(d,i){const o=vl(d.projection,d.zoom,d.width,d.height),m=function(_,j,S,C,D){const I=new n.LngLat(S.lng-180*hn,S.lat),O=new n.LngLat(S.lng+180*hn,S.lat),G=_.project(I.lng,I.lat),Q=_.project(O.lng,O.lat),ee=-Math.atan2(Q.y-G.y,Q.x-G.x),Y=n.MercatorCoordinate.fromLngLat(S);Y.y=n.clamp(Y.y,-1+hn,1-hn);const se=Y.toLngLat(),F=_.project(se.lng,se.lat),K=n.MercatorCoordinate.fromLngLat(se);K.x+=hn;const ae=K.toLngLat(),le=_.project(ae.lng,ae.lat),_e=bl(le.x-F.x,le.y-F.y,ee),be=n.MercatorCoordinate.fromLngLat(se);be.y+=hn;const ve=be.toLngLat(),Me=_.project(ve.lng,ve.lat),ke=bl(Me.x-F.x,Me.y-F.y,ee),Be=Math.abs(_e.x)/Math.abs(ke.y),at=n.identity([]);n.rotateZ(at,at,-ee*(1-(D?0:C)));const ze=n.identity([]);return n.scale(ze,ze,[1,1-(1-Be)*C,1]),ze[4]=-ke.x/ke.y*C,n.rotateZ(ze,ze,ee),n.multiply(ze,at,ze),ze}(d.projection,0,d.center,o,i),g=Mu(d);return n.scale(m,m,[g,g,1]),m}function Mu(d){const i=d.projection,o=vl(d.projection,d.zoom,d.width,d.height),m=Pu(i,d.center),g=Pu(i,n.LngLat.convert(i.center));return Math.pow(2,m*o+(1-o)*g)}function vl(d,i,o,m,g=1/0){const _=d.range;if(!_)return 0;const j=Math.min(g,Math.max(o,m)),S=Math.log(j/1024)/Math.LN2;return n.smoothstep(_[0]+S,_[1]+S,i)}const hn=1/4e4;function Pu(d,i){const o=n.clamp(i.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=new n.LngLat(i.lng-180*hn,o),g=new n.LngLat(i.lng+180*hn,o),_=d.project(m.lng,o),j=d.project(g.lng,o),S=n.MercatorCoordinate.fromLngLat(m),C=n.MercatorCoordinate.fromLngLat(g),D=j.x-_.x,I=j.y-_.y,O=C.x-S.x,G=C.y-S.y,Q=Math.sqrt((O*O+G*G)/(D*D+I*I));return Math.log(Q)/Math.LN2}function bl(d,i,o){const m=Math.cos(o),g=Math.sin(o);return{x:d*m-i*g,y:d*g+i*m}}class ka{constructor(i,o,m,g,_,j,S){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=m??0,this._maxPitch=g??60,this.setProjection(j),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new _l,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,o=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(i||m)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=n.getProjection(this.projectionOptions);const m=!P(o,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.getProjection({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.Point(this.width,this.height)}get bearing(){return n.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;var m;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(m=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(g,_,j){var S=_[0],C=_[1],D=_[2],I=_[3],O=Math.sin(j),G=Math.cos(j);g[0]=S*G+D*O,g[1]=C*G+I*O,g[2]=S*-O+D*G,g[3]=C*-O+I*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=n.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=n.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let g=0,_=0;for(let j=0;j<o.length;j++){const S=new n.Point(o[j][0]*this.width,m+o[j][1]*(this.height-m)),C=i.pointCoordinate(S);if(!C)continue;const D=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);g+=C[3]*D,_+=D}return _===0?NaN:g/_}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*o,g=this._mercatorZfromZoom(i),_=this._mercatorZfromZoom(this._maxZoom),j=Math.max(g-m,_);this._setZoom(this._zoomFromMercatorZ(j))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const g=n.length(n.sub([],this._camera.position,m));return n.clamp(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!n.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];n.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new Au;return o.position=new n.MercatorCoordinate(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!n.length$1(i))return!1;n.normalize$1(i,i);const o=n.transformQuat([],[0,0,-1],i),m=n.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const g=wo(o,m);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;i[2]=n.clamp(i[2],g/m,g/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,m){this._unmodified=!1,this._edgeInsets.interpolate(i,o,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new n.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new n.Point(0,0)),g=this.pointCoordinate(new n.Point(this.width,0)),_=this.pointCoordinate(new n.Point(this.width,this.height)),j=this.pointCoordinate(new n.Point(0,this.height)),S=Math.floor(Math.min(m.x,g.x,_.x,j.x)),C=Math.floor(Math.max(m.x,g.x,_.x,j.x)),D=1;for(let I=S-D;I<=C+D;I++)I!==0&&o.push(new n.UnwrappedTileID(I,i))}return o}coveringTiles(i){let o=this.coveringZoomLevel(i);const m=o,g=this.elevation&&!i.isTerrainDEM,_=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const j=this.locationCoordinate(this.center),S=this.center.lat,C=1<<o,D=[C*j.x,C*j.y,0],I=this.projection.name==="globe",O=!I,G=n.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,O),Q=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=C*n.mercatorZfromAltitude(1,this.center.lat),Y=this._camera.position[2]/n.mercatorZfromAltitude(1,this.center.lat),se=[C*Q.x,C*Q.y,Y*(O?1:ee)],F=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,ae=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=i.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,_e=this.projection.isReprojectedInTileSpace?Mu(this):1,be=Fe=>{const lt=new n.MercatorCoordinate(Fe.x+25e-6,Fe.y,Fe.z),st=new n.MercatorCoordinate(Fe.x,Fe.y+25e-6,Fe.z),dt=Fe.toLngLat(),Dt=lt.toLngLat(),Vt=st.toLngLat(),kt=this.locationCoordinate(dt),Ot=this.locationCoordinate(Dt),is=this.locationCoordinate(Vt),ts=Math.hypot(Ot.x-kt.x,Ot.y-kt.y),Pt=Math.hypot(is.x-kt.x,is.y-kt.y);return Math.sqrt(ts*Pt)*_e/25e-6},ve=Fe=>{const Xe=ae,lt=le;return{aabb:n.tileAABB(this,C,0,0,0,Fe,lt,Xe,this.projection),zoom:0,x:0,y:0,minZ:lt,maxZ:Xe,wrap:Fe,fullyVisible:!1}},Me=[];let ke=[];const Be=o,at=i.reparseOverscaled?m:o,ze=Fe=>Fe*Fe,Qe=ze((Y-this._centerAltitude)*ee),Ve=Fe=>{if(!this._elevation||!Fe.tileID||!_)return;const Xe=this._elevation.getMinMaxForTile(Fe.tileID),lt=Fe.aabb;Xe?(lt.min[2]=Xe.min,lt.max[2]=Xe.max,lt.center[2]=(lt.min[2]+lt.max[2])/2):(Fe.shouldSplit=nt(Fe),Fe.shouldSplit||(lt.min[2]=lt.max[2]=lt.center[2]=this._centerAltitude))},nt=Fe=>{if(Fe.zoom<K)return!0;if(Fe.zoom===Be)return!1;if(Fe.shouldSplit!=null)return Fe.shouldSplit;const Xe=Fe.aabb.distanceX(se),lt=Fe.aabb.distanceY(se);let st=Qe,dt=1;if(I){st=ze(Fe.aabb.distanceZ(se));const kt=Math.pow(2,Fe.zoom),Ot=n.latFromMercatorY((Fe.y+1)/kt),is=n.latFromMercatorY(Fe.y/kt),ts=Math.min(Math.max(S,Ot),is),Pt=n.circumferenceAtLatitude(ts)/n.circumferenceAtLatitude(S);if(dt=ts===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pt/this._mercatorScaleRatio),this.zoom<=n.GLOBE_ZOOM_THRESHOLD_MIN&&Fe.zoom===Be-1&&Pt>=.9)return!0}else if(g&&(st=ze(Fe.aabb.distanceZ(se)*ee)),this.projection.isReprojectedInTileSpace&&m<=5){const kt=Math.pow(2,Fe.zoom),Ot=be(new n.MercatorCoordinate((Fe.x+.5)/kt,(Fe.y+.5)/kt));dt=Ot>.85?1:Ot}const Dt=Xe*Xe+lt*lt+st,Vt=ze((1<<Be-Fe.zoom)*F*dt*((kt,Ot)=>{if(Ot*ze(.707)<kt)return 1;const is=Math.sqrt(Ot/kt);return is/(1.4144271570014144+(Math.pow(1.1,is-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(st,Qe),Dt));return Dt<Vt};if(this.renderWorldCopies)for(let Fe=1;Fe<=3;Fe++)Me.push(ve(-Fe)),Me.push(ve(Fe));for(Me.push(ve(0));Me.length>0;){const Fe=Me.pop(),Xe=Fe.x,lt=Fe.y;let st=Fe.fullyVisible;if(!st){const dt=Fe.aabb.intersects(G);if(dt===0)continue;st=dt===2}if(Fe.zoom!==Be&&nt(Fe))for(let dt=0;dt<4;dt++){const Dt=(Xe<<1)+dt%2,Vt=(lt<<1)+(dt>>1),kt={aabb:_?Fe.aabb.quadrant(dt):n.tileAABB(this,C,Fe.zoom+1,Dt,Vt,Fe.wrap,Fe.minZ,Fe.maxZ,this.projection),zoom:Fe.zoom+1,x:Dt,y:Vt,wrap:Fe.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Fe.minZ,maxZ:Fe.maxZ};g&&!I&&(kt.tileID=new n.OverscaledTileID(Fe.zoom+1===Be?at:Fe.zoom+1,Fe.wrap,Fe.zoom+1,Dt,Vt),Ve(kt)),Me.push(kt)}else{const dt=Fe.zoom===Be?at:Fe.zoom;if(i.minzoom&&i.minzoom>dt)continue;const Dt=D[0]-(.5+Xe+(Fe.wrap<<Fe.zoom))*(1<<o-Fe.zoom),Vt=D[1]-.5-lt,kt=Fe.tileID?Fe.tileID:new n.OverscaledTileID(dt,Fe.wrap,Fe.zoom,Xe,lt);ke.push({tileID:kt,distanceSq:Dt*Dt+Vt*Vt})}}if(this.fogCullDistSq){const Fe=this.fogCullDistSq,Xe=this.horizonLineFromTop();ke=ke.filter(lt=>{const st=[0,0,0,1],dt=[n.EXTENT,n.EXTENT,0,1],Dt=this.calculateFogTileMatrix(lt.tileID.toUnwrapped());n.transformMat4$1(st,st,Dt),n.transformMat4$1(dt,dt,Dt);const Vt=n.getAABBPointSquareDist(st,dt);if(Vt===0)return!0;let kt=!1;const Ot=this._elevation;if(Ot&&Vt>Fe&&Xe!==0){const is=this.calculateProjMatrix(lt.tileID.toUnwrapped());let ts;i.isTerrainDEM||(ts=Ot.getMinMaxForTile(lt.tileID)),ts||(ts={min:le,max:ae});const Pt=n.furthestTileCorner(this.rotation),bs=[Pt[0]*n.EXTENT,Pt[1]*n.EXTENT,ts.max];n.transformMat4(bs,bs,is),kt=(1-bs[1])*this.height*.5<Xe}return Vt<Fe||kt})}return ke.sort((Fe,Xe)=>Fe.distanceSq-Xe.distanceSq).map(Fe=>Fe.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=n.clamp(i.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=this.projection.project(i.lng,o);return new n.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let m,g;const _=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;m=(o.x-_.x)/S,g=(o.y-_.y)/S}else{const S=this.pointCoordinate(o),C=this.pointCoordinate(_);m=S.x-C.x,g=S.y-C.y}const j=this.locationCoordinate(i);this.setLocation(new n.MercatorCoordinate(j.x-m,j.y-g))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const m=o?n.mercatorZfromAltitude(o,i.lat):void 0,g=this.projection.project(i.lng,i.lat);return new n.MercatorCoordinate(g.x,g.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const m=o??this._centerAltitude,g=[i.x,i.y,0,1],_=[i.x,i.y,1,1];n.transformMat4$1(g,g,this.pixelMatrixInverse),n.transformMat4$1(_,_,this.pixelMatrixInverse);const j=_[3];n.scale$1(g,g,1/g[3]),n.scale$1(_,_,1/j);const S=g[2],C=_[2];return{p0:g,p1:_,t:S===C?0:(m-S)/(C-S)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return n.transformMat4$1(o,o,this.pixelMatrixInverse),n.transformMat4$1(m,m,this.pixelMatrixInverse),n.scale$1(o,o,1/o[3]),n.scale$1(m,m,1/m[3]),o[2]=n.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,m[2]=n.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,n.scale$1(o,o,1/this.worldSize),n.scale$1(m,m,1/this.worldSize),new n.Ray([o[0],o[1],o[2]],n.normalize([],n.sub([],m,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:m,t:g}=i,_=n.mercatorZfromAltitude(o[2],this._center.lat),j=n.mercatorZfromAltitude(m[2],this._center.lat);return new n.MercatorCoordinate(n.number(o[0],m[0],g)/this.worldSize,n.number(o[1],m[1],g)/this.worldSize,n.number(_,j,g))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let o=this.projection.pointCoordinate3D(this,i.x,i.y);if(o)return new n.MercatorCoordinate(o[0],o[1],o[2]);let m=0,g=this.horizonLineFromTop();if(i.y>g)return this.pointCoordinate(i);const _=.02*g,j=i.clone();for(let S=0;S<10&&g-m>_;S++){j.y=n.number(m,g,.66);const C=this.projection.pointCoordinate3D(this,j.x,j.y);C?(g=j.y,o=C):m=j.y}return o?new n.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const m=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,g=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return n.transformMat4$1(g,g,this.pixelMatrix),g[3]>0?new n.Point(g[0]/g[3],g[1]/g[3]):new n.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,_=this.pointLocation3D(new n.Point(o,i)),j=this.pointLocation3D(new n.Point(g,i)),S=this.pointLocation3D(new n.Point(g,m)),C=this.pointLocation3D(new n.Point(o,m));let D=Math.min(_.lng,j.lng,S.lng,C.lng),I=Math.max(_.lng,j.lng,S.lng,C.lng),O=Math.min(_.lat,j.lat,S.lat,C.lat),G=Math.max(_.lat,j.lat,S.lat,C.lat);const Q=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,Y=(se,F,K,ae,le)=>{const _e=(se+K)/2,be=(F+ae)/2,ve=new n.Point(_e,be),{lng:Me,lat:ke}=this.pointLocation3D(ve),Be=Math.max(0,D-Me,O-ke,Me-I,ke-G);D=Math.min(D,Me),I=Math.max(I,Me),O=Math.min(O,ke),G=Math.max(G,ke),(le<ee||Be>Q)&&(Y(se,F,_e,be,le+1),Y(_e,be,K,ae,le+1))};if(Y(o,i,g,i,1),Y(g,i,g,m,1),Y(g,m,o,m,1),Y(o,m,o,i,1),this.projection.name==="globe"){const[se,F]=n.polesInViewport(this);se?(G=90,I=180,D=-180):F&&(O=-90,I=180,D=-180)}return new n.LngLatBounds(new n.LngLat(D,O),new n.LngLat(I,G))}_getBoundsRectangular(i,o){const{top:m,left:g}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,j=this.width-this._edgeInsets.right,S=new n.Point(g,m),C=new n.Point(j,m),D=new n.Point(j,_),I=new n.Point(g,_);let O=this.pointCoordinate(S,i),G=this.pointCoordinate(C,i);const Q=this.pointCoordinate(D,o),ee=this.pointCoordinate(I,o),Y=(se,F)=>(F.y-se.y)/(F.x-se.x);return O.y>1&&G.y>=0?O=new n.MercatorCoordinate((1-ee.y)/Y(ee,O)+ee.x,1):O.y<0&&G.y<=1&&(O=new n.MercatorCoordinate(-ee.y/Y(ee,O)+ee.x,0)),G.y>1&&O.y>=0?G=new n.MercatorCoordinate((1-Q.y)/Y(Q,G)+Q.x,1):G.y<0&&O.y<=1&&(G=new n.MercatorCoordinate(-Q.y/Y(Q,G)+Q.x,0)),new n.LngLatBounds().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((m,g)=>{if(g.dem){const _=g.dem.tree;m.min=Math.min(m.min,_.minimums[0]),m.max=Math.max(m.max,_.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-n.MAX_MERCATOR_LATITUDE,this.maxLat=n.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=n.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=n.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=n.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,m=this._distanceTileDataCache;if(m[o])return m[o];const g=i.canonical,_=1/this.height,j=this.cameraWorldSize,S=j/this.zoomScale(g.z),C=(g.x+Math.pow(2,g.z)*i.wrap)*S,D=g.y*S,I=this.point;I.x*=j/this.worldSize,I.y*=j/this.worldSize;const O=this.angle,G=Math.sin(-O),Q=-Math.cos(-O);return m[o]={bearing:[G,Q],center:[(I.x-C)*_,(I.y-D)*_],scale:S/n.EXTENT*_},m[o]}calculateFogTileMatrix(i){const o=i.key,m=this._fogTileMatrixCache;if(m[o])return m[o];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return n.multiply(g,this.worldToFogMatrix,g),m[o]=new Float32Array(g),m[o]}calculateProjMatrix(i,o=!1){const m=i.key,g=o?this._alignedProjMatrixCache:this._projMatrixCache;if(g[m])return g[m];const _=this.calculatePosMatrix(i,this.worldSize);return n.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,_),g[m]=new Float32Array(_),g[m]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[o])return m[o];const g=function(_,j){const{scale:S}=_.tileTransform,C=S*n.EXTENT/(_.tileSize*Math.pow(2,j.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return D=new Float32Array(4),G=(I=j.inverseAdjustmentMatrix)[1],Q=I[2],ee=I[3],se=(O=[C,C])[1],D[0]=I[0]*(Y=O[0]),D[1]=G*Y,D[2]=Q*se,D[3]=ee*se,D;var D,I,O,G,Q,ee,Y,se}(i,this);return m[o]=g,m[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,o=n.fromScaling([],[i,i,i]);return n.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const o=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(o),g=this._camera.forward(),_=n.mercatorZfromAltitude(1,this._center.lat);m[2]/=_,g[2]/=_,n.normalize(g,g);const j=i.raycast(m,g,i.exaggeration());if(j){const S=n.scaleAndAdd([],m,g,j),C=new n.MercatorCoordinate(S[0],S[1],n.mercatorZfromAltitude(S[2],n.latFromMercatorY(S[1]))),D=(C.z+n.length([C.x-m[0],C.y-m[1],C.z-m[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,m=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(m),_=o.getAtPointOrZero(new n.MercatorCoordinate(...g)),j=this.pixelsPerMeter/this.worldSize*_,S=this._minimumHeightOverTerrain(),C=g[2]-j;if(C<=S)if(C<0||i){const D=this.locationCoordinate(this._center,this._centerAltitude),I=[g[0],g[1],D.z-g[2]],O=n.length(I);I[2]-=(S-C)/this._pixelsPerMercatorPixel;const G=n.length(I);if(G===0)return;n.scale$2(I,I,O/G*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],D.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const G=this.center;return G.lat=n.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(G.lng=n.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const o=this._unmodified,{x:m,y:g}=this.point;let _=0,j=m,S=g;const C=this.width/2,D=this.height/2,I=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(g-D<I&&(S=I+D),g+D>O&&(S=O-D),O-I<this.height&&(_=Math.max(_,this.height/(O-I)),S=(O+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,ee=this.worldSize/2-(G+Q)/2;j=(m+ee+this.worldSize)%this.worldSize-ee,j-C<G&&(j=G+C),j+C>Q&&(j=Q-C),Q-G<this.width&&(_=Math.max(_,this.width/(Q-G)),j=(Q+G)/2)}j===m&&S===g||(this.center=this.unproject(new n.Point(j,S))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.mercatorZfromAltitude(1,this.center.lat)/n.mercatorZfromAltitude(1,n.GLOBE_SCALE_MATCH_LATITUDE));const m=vl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?o:1,_=this._camera.getWorldToCamera(this.worldSize,g),j=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);j[8]=2*-i.x/this.width,j[9]=2*i.y/this.height;let S=n.mul([],j,_);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),ve=n.identity([]);n.translate(ve,ve,[be.x*this.worldSize,be.y*this.worldSize,0]),n.multiply(ve,ve,Ca(this)),n.translate(ve,ve,[-be.x*this.worldSize,-be.y*this.worldSize,0]),n.multiply(S,S,ve),this.inverseAdjustmentMatrix=function(Me){const ke=Ca(Me,!0);return Ee([],[ke[0],ke[1],ke[4],ke[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=n.scale([],S,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=S,this.invProjMatrix=n.invert(new Float64Array(16),this.projMatrix);const C=n.invert([],j);this.frustumCorners=n.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);n.identity(D),n.scale(D,D,[1,-1,1]),n.rotateX(D,D,this._pitch),n.rotateZ(D,D,this.angle);const I=n.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;I[8]=2*-i.x/this.width,I[9]=2*(i.y+O)/this.height,this.skyboxMatrix=n.multiply(D,I,D);const G=this.point,Q=G.x,ee=G.y,Y=this.width%2/2,se=this.height%2/2,F=Math.cos(this.angle),K=Math.sin(this.angle),ae=Q-Math.round(Q)+F*Y+K*se,le=ee-Math.round(ee)+F*se+K*Y,_e=new Float64Array(S);if(n.translate(_e,_e,[ae>.5?ae-1:ae,le>.5?le-1:le,0]),this.alignedProjMatrix=_e,S=n.create(),n.scale(S,S,[this.width/2,-this.height/2,1]),n.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=n.create(),n.scale(S,S,[1,-1,1]),n.translate(S,S,[-1,-1,0]),n.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=n.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.calculateGlobeMatrix(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.transformMat4(be,be,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,m=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,_=[i,i,o];n.scale$2(_,_,g),n.scale$2(m,m,-1),n.multiply$2(m,m,_);const j=n.create();n.translate(j,j,m),n.scale(j,j,_),this.mercatorFogMatrix=j,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,g)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),g=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-m[0]*_,g.y/this.worldSize-m[1]*_,i/this.worldSize*this._centerAltitude-m[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],g=i[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(_=Math.min((o-m)/g,1)),this._camera.position=n.scaleAndAdd([],this._camera.position,i,_),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:m,bearing:g}=this._camera.getPitchBearing(),_=n.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,j=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.degToRad(this._maxPitch)),S=Math.max((i[2]-_)/Math.cos(m),j),C=this._zoomFromMercatorZ(S);n.scaleAndAdd(i,i,o,S),this._pitch=n.clamp(m,n.degToRad(this.minPitch),n.degToRad(this.maxPitch)),this.angle=n.wrap(g,-Math.PI,Math.PI),this._setZoom(n.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,m=n.GLOBE_ZOOM_THRESHOLD_MAX,g=0,_=1/0;for(;m-o>1e-6&&m>o;){const j=o+.5*(m-o),S=this.tileSize*Math.pow(2,j),C=this.getCameraToCenterDistance(this.projection,j,S),D=this.scaleZoom(C/(i*this.tileSize)),I=Math.abs(j-D);I<_&&(_=I,g=j),j<D?o=j:m=j}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const m=Math.min(i.x,o.x),g=Math.max(i.x,o.x),_=Math.min(i.y,o.y),j=Math.max(i.y,o.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new n.Point(m,_),new n.Point(g,j),new n.Point(m,j),new n.Point(g,_)],C=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const I of S){const O=this.pointRayIntersection(I);if(O.t<0)return!0;const G=this.rayIntersectionCoordinate(O);if(G.x<C||G.y<0||G.x>D||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.Point(0,0),new n.Point(this.width,this.height))}zoomDeltaToMovement(i,o){const m=n.length(n.sub([],this._camera.position,i)),g=this._zoomFromMercatorZ(m)+o;return m-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([o,m,g],_){const j=[o,m,g,1];n.transformMat4$1(j,j,_);const S=j[3]=Math.max(j[3],1e-6);return j[0]/=S,j[1]/=S,j[2]/=S,j}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.Point(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.Point(0,i))}}getCameraToCenterDistance(i,o=this.zoom,m=this.worldSize){const g=vl(i,o,this.width,this.height,1024),_=i.pixelSpaceConversion(this.center.lat,m,g);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.multiply(i,i,this.globeMatrix),i}}function Aa(d,i){let o=!1,m=null;const g=()=>{m=null,o&&(d(),m=setTimeout(g,i),o=!1)};return()=>(o=!0,m||g(),m)}class $c{constructor(i){this._hashName=i&&encodeURIComponent(i),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Aa(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,n.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),n.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=jo(i);if(this._hashName){const m=this._hashName;let g=!1;const _=n.window.location.hash.slice(1).split("&").map(j=>{const S=j.split("=")[0];return S===m?(g=!0,`${S}=${o}`):j}).filter(j=>j);return g||_.push(`${m}=${o}`),`#${_.join("&")}`}return`#${o}`}_getCurrentHash(){const i=n.window.location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(o=m)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(m=>isNaN(m))){const m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:m,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=n.window.location.href.replace(/(#.+)?$/,this.getHashString());n.window.history.replaceState(n.window.history.state,null,i)}}function jo(d,i){const o=d.getCenter(),m=Math.round(100*d.getZoom())/100,g=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,g),j=Math.round(o.lng*_)/_,S=Math.round(o.lat*_)/_,C=d.getBearing(),D=d.getPitch();let I=i?`/${j}/${S}/${m}`:`${m}/${S}/${j}`;return(C||D)&&(I+="/"+Math.round(10*C)/10),D&&(I+=`/${Math.round(D)}`),I}const No={linearity:.3,easing:n.bezier(0,0,.3,1)},wl=n.extend({deceleration:2500,maxSpeed:1400},No),jl=n.extend({deceleration:20,maxSpeed:1400},No),Tt=n.extend({deceleration:1e3,maxSpeed:360},No),Ii=n.extend({deceleration:1e3,maxSpeed:90},No);class Iu{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=n.exported.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new n.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(o.pan.mag()){const _=To(o.pan.mag(),m,n.extend({},wl,i||{}));g.offset=o.pan.mult(_.amount/o.pan.mag()),g.center=this._map.transform.center,So(g,_)}if(o.zoom){const _=To(o.zoom,m,jl);g.zoom=this._map.transform.zoom+_.amount,So(g,_)}if(o.bearing){const _=To(o.bearing,m,Tt);g.bearing=this._map.transform.bearing+n.clamp(_.amount,-179,179),So(g,_)}if(o.pitch){const _=To(o.pitch,m,Ii);g.pitch=this._map.transform.pitch+_.amount,So(g,_)}if(g.zoom||g.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;g.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function So(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function To(d,i,o){const{maxSpeed:m,linearity:g,deceleration:_}=o,j=n.clamp(d*g/(i/1e3),-m,m),S=Math.abs(j)/(_*g);return{easing:o.easing,duration:1e3*S,amount:j*(S/2)}}class Tr extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m,g={}){const _=Ce(o.getCanvasContainer(),m),j=o.unproject(_);super(i,n.extend({point:_,lngLat:j,originalEvent:m},g)),this._defaultPrevented=!1,this.target=o}}class Eo extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m){const g=i==="touchend"?m.changedTouches:m.touches,_=Ae(o.getCanvasContainer(),g),j=_.map(C=>o.unproject(C)),S=_.reduce((C,D,I,O)=>C.add(D.div(O.length)),new n.Point(0,0));super(i,{points:_,point:S,lngLats:j,lngLat:o.unproject(S),originalEvent:m}),this._defaultPrevented=!1}}class Nl extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class Gc{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Nl(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Tr(i.type,this._map,i))}mouseup(i){this._map.fire(new Tr(i.type,this._map,i))}preclick(i){const o=n.extend({},i);o.type="preclick",this._map.fire(new Tr(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Tr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Tr(i.type,this._map,i))}mouseover(i){this._map.fire(new Tr(i.type,this._map,i))}mouseout(i){this._map.fire(new Tr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Eo(i.type,this._map,i))}touchmove(i){this._map.fire(new Eo(i.type,this._map,i))}touchend(i){this._map.fire(new Eo(i.type,this._map,i))}touchcancel(i){this._map.fire(new Eo(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sl{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Tr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Tr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Du{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(ne(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const m=o,g=this._startPos,_=this._lastPos;if(!g||!_||_.equals(m)||!this._box&&m.dist(g)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=W("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const j=Math.min(g.x,m.x),S=Math.max(g.x,m.x),C=Math.min(g.y,m.y),D=Math.max(g.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${j}px,${C}px)`,this._box.style.width=S-j+"px",this._box.style.height=D-C+"px")})}mouseupWindow(i,o){if(!this._active)return;const m=this._startPos,g=o;if(m&&i.button===0){if(this.reset(),he(),m.x!==g.x||m.y!==g.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(m,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),te(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new n.Event(i,{originalEvent:o}))}}function Tl(d,i){const o={};for(let m=0;m<d.length;m++)o[d[m].identifier]=i[m];return o}class Ma{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(g){const _=new n.Point(0,0);for(const j of g)_._add(j);return _.div(g.length)}(o),this.touches=Tl(m,o)))}touchmove(i,o,m){if(this.aborted||!this.centroid)return;const g=Tl(m,o);for(const _ in this.touches){const j=g[_];(!j||j.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Zc{constructor(i){this.singleTap=new Ma(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,m){this.singleTap.touchstart(i,o,m)}touchmove(i,o,m){this.singleTap.touchmove(i,o,m)}touchend(i,o,m){const g=this.singleTap.touchend(i,o,m);if(g){const _=i.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(g)<30;if(_&&j||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Pm{constructor(){this._zoomIn=new Zc({numTouches:1,numTaps:2}),this._zoomOut=new Zc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,m){this._zoomIn.touchstart(i,o,m),this._zoomOut.touchstart(i,o,m)}touchmove(i,o,m){this._zoomIn.touchmove(i,o,m),this._zoomOut.touchmove(i,o,m)}touchend(i,o,m){const g=this._zoomIn.touchend(i,o,m),_=this._zoomOut.touchend(i,o,m);return g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()+1,around:j.unproject(g)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()-1,around:j.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Lu={0:1,2:2};class Pa{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const m=fe(i);this._correctButton(i,m)&&(this._lastPoint=o,this._eventButton=m)}mousemoveWindow(i,o){const m=this._lastPoint;if(m){if(i.preventDefault(),this._eventButton!=null&&function(g,_){const j=Lu[_];return g.buttons===void 0||(g.buttons&j)!==j}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(m,o)}}mouseupWindow(i){this._lastPoint&&fe(i)===this._eventButton&&(this._moved&&he(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wc extends Pa{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class Hc extends Pa{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const m=.8*(o.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class Xc extends Pa{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const m=-.5*(o.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class El{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.Point(0,0)}touchstart(i,o,m){return this._calculateTransform(i,o,m)}touchmove(i,o,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!n.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,m)}}touchend(i,o,m){this._calculateTransform(i,o,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,m){m.length>0&&(this._active=!0);const g=Tl(m,o),_=new n.Point(0,0),j=new n.Point(0,0);let S=0;for(const D in g){const I=g[D],O=this._touches[D];O&&(_._add(I),j._add(I.sub(O)),S++,g[D]=I)}if(this._touches=g,S<this._minTouches||!j.mag())return;const C=j.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Co{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,m){return{}}touchstart(i,o,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,m){const g=this._firstTwoTouches;if(!g)return;i.preventDefault();const[_,j]=g,S=ko(m,o,_),C=ko(m,o,j);if(!S||!C)return;const D=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],D,i)}touchend(i,o,m){if(!this._firstTwoTouches)return;const[g,_]=this._firstTwoTouches,j=ko(m,o,g),S=ko(m,o,_);j&&S||(this._active&&he(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ko(d,i,o){for(let m=0;m<d.length;m++)if(d[m].identifier===o)return i[m]}function Kc(d,i){return Math.log(d/i)/Math.LN2}class Ru extends Co{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,m),pinchAround:o}}}function Qc(d,i){return 180*d.angleWith(i)/Math.PI}class zu extends Co{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const m=this._vector;if(this._vector=i[0].sub(i[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Qc(this._vector,m),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const g=Qc(i,m);return Math.abs(g)<o}}function Mn(d){return Math.abs(d.y)>Math.abs(d.x)}class Ou extends Co{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Mn(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,m){const g=this._lastPoints;if(!g)return;const _=i[0].sub(g[0]),j=i[1].sub(g[1]);return this._map._cooperativeGestures&&!n.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(_,j,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+j.y)/2*-.5})}gestureBeginsVertically(i,o,m){if(this._valid!==void 0)return this._valid;const g=i.mag()>=2,_=o.mag()>=2;if(!g&&!_)return;if(!g||!_)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const j=i.y>0==o.y>0;return Mn(i)&&Mn(o)&&j}}const Fu={panStep:100,bearingStep:15,pitchStep:10};class Im{constructor(){const i=Fu;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,m=0,g=0,_=0,j=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),j=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(m=0,g=0),{cameraAnimation:S=>{const C=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Bu,zoom:o?Math.round(C)+o*(i.shiftKey?2:1):C,bearing:S.getBearing()+m*this._bearingStep,pitch:S.getPitch()+g*this._pitchStep,offset:[-_*this._panStep,-j*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bu(d){return d*(2-d)}const Jc=4.000244140625;class Uu{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||n.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===n.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=n.exported.now(),g=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,o!==0&&o%Jc==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(g*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Ce(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Jc?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&D!==0&&(D=1/D);const I=o(),O=Math.pow(2,I),G=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(G*D))),this._type==="wheel"&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:o(),g=this._startZoom,_=this._easing;let j,S=!1;if(this._type==="wheel"&&g&&_){const C=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),D=_(C);j=n.number(g,m,D),C<1?this._frameId||(this._frameId=!0):S=!0}else j=m,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:j-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=n.ease;if(this._prevEase){const m=this._prevEase,g=(n.exported.now()-m.start)/m.duration,_=m.easing(g+.01)-m.easing(g),j=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-j*j);o=n.bezier(j,S,.25,1)}return this._prevEase={start:n.exported.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(n.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Vu{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dm{constructor(){this._tap=new Zc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=o[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,o,m))}touchmove(i,o,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const g=o[0],_=g.y-this._swipePoint.y;return this._swipePoint=g,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,m)}touchend(i,o,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(i,o,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qu{constructor(i,o,m){this._el=i,this._mousePan=o,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Lm{constructor(i,o,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rm{constructor(i,o,m,g){this._el=i,this._touchZoom=o,this._touchRotate=m,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wi=d=>d.zoom||d.drag||d.pitch||d.rotate;class $u extends n.Event{}class zm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const m=n.sub([],o,i);this.radius=n.length(m[2]<0?n.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){n.div(i,i,this.constants),n.normalize(i,i),n.mul$1(i,i,this.constants);const o=n.scale$2([],i,this.radius);if(o[2]>0){const m=n.scale$2([],[0,0,1],n.dot(o,[0,0,1])),g=n.scale$2([],n.normalize([],[o[0],o[1],0]),this.radius),_=n.add([],o,n.scale$2([],n.sub([],n.add([],g,m),o),2));o[0]=_[0],o[1]=_[1]}return o}}function Di(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class $i{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Iu(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[n.window.document,"mousemove",{capture:!0}],[n.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[n.window,"blur",void 0]];for(const[g,_,j]of this._listeners)g.addEventListener(_,g===n.window.document?this.handleWindowEvent:this.handleEvent,j)}destroy(){for(const[i,o,m]of this._listeners)i.removeEventListener(o,i===n.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const o=this._map,m=o.getCanvasContainer();this._add("mapEvent",new Gc(o,i));const g=o.boxZoom=new Du(o,i);this._add("boxZoom",g);const _=new Pm,j=new Vr;o.doubleClickZoom=new Vu(j,_),this._add("tapZoom",_),this._add("clickZoom",j);const S=new Dm;this._add("tapDragZoom",S);const C=o.touchPitch=new Ou(o);this._add("touchPitch",C);const D=new Hc(i),I=new Xc(i);o.dragRotate=new Lm(i,D,I),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const O=new Wc(i),G=new El(o,i);o.dragPan=new qu(m,O,G),this._add("mousePan",O),this._add("touchPan",G,["touchZoom","touchRotate"]);const Q=new zu,ee=new Ru;o.touchZoomRotate=new Rm(m,ee,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sl(o));const Y=o.scrollZoom=new Uu(o,this);this._add("scrollZoom",Y,["mousePan"]);const se=o.keyboard=new Im;this._add("keyboard",se);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[F]&&o[F].enable(i[F])}_add(i,o,m){this._handlers.push({handlerName:i,handler:o,allowed:m}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,m){for(const g in i)if(g!==m&&(!o||o.indexOf(g)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const m of i)this._el.contains(m.target)&&o.push(m);return o}handleEvent(i,o){this._updatingCamera=!0;const m=i.type==="renderFrame",g=m?void 0:i,_={needsRenderFrame:!1},j={},S={},C=i.touches?this._getMapTouches(i.touches):void 0,D=C?Ae(this._el,C):m?void 0:Ce(this._el,i);for(const{handlerName:G,handler:Q,allowed:ee}of this._handlers){if(!Q.isEnabled())continue;let Y;this._blockedByActive(S,ee,G)?Q.reset():Q[o||i.type]&&(Y=Q[o||i.type](i,D,C),this.mergeHandlerResult(_,j,Y,G,g),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||Q.isActive())&&(S[G]=Q)}const I={};for(const G in this._previousActiveHandlers)S[G]||(I[G]=g);this._previousActiveHandlers=S,(Object.keys(I).length||Di(_))&&(this._changes.push([_,j,I]),this._triggerRenderFrame()),(Object.keys(S).length||Di(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=_;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(i,o,m,g,_){if(!m)return;n.extend(i,m);const j={handlerName:g,originalEvent:m.originalEvent||_};m.zoomDelta!==void 0&&(o.zoom=j),m.panDelta!==void 0&&(o.drag=j),m.pitchDelta!==void 0&&(o.pitch=j),m.bearingDelta!==void 0&&(o.rotate=j)}_applyChanges(){const i={},o={},m={};for(const[g,_,j]of this._changes)g.panDelta&&(i.panDelta=(i.panDelta||new n.Point(0,0))._add(g.panDelta)),g.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(i.around=g.around),g.aroundCoord!==void 0&&(i.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(i.pinchAround=g.pinchAround),g.noInertia&&(i.noInertia=g.noInertia),n.extend(o,_),n.extend(m,j);this._updateMapTransform(i,o,m),this._changes=[]}_updateMapTransform(i,o,m){const g=this._map,_=g.transform,j=K=>[K.x,K.y,K.z];if((K=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!Di(i)){const K=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",K!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&g._stop(!0),!Di(i))return void this._fireEvents(o,m,!0);let{panDelta:S,zoomDelta:C,bearingDelta:D,pitchDelta:I,around:O,aroundCoord:G,pinchAround:Q}=i;_._isCameraConstrained&&(C>0&&(C=0),_._isCameraConstrained=!1),Q!==void 0&&(O=Q),(C||(K=>o[K]&&!this._eventsInProgress[K])("drag"))&&O&&(this._dragOrigin=j(_.pointCoordinate3D(O)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",g._stop(!0),O=O||g.transform.centerPoint,D&&(_.bearing+=D),I&&(_.pitch+=I),_._updateCameraState();const ee=[0,0,0];if(S)if(_.projection.name==="mercator"){const K=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O).dir),ae=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O.sub(S)).dir);ee[0]=ae[0]-K[0],ee[1]=ae[1]-K[1]}else{const K=_.pointCoordinate(O);if(_.projection.name==="globe"){S=S.rotate(-_.angle);const ae=_._pixelsPerMercatorPixel/_.worldSize;ee[0]=-S.x*n.mercatorScale(n.latFromMercatorY(K.y))*ae,ee[1]=-S.y*n.mercatorScale(_.center.lat)*ae}else{const ae=_.pointCoordinate(O.sub(S));K&&ae&&(ee[0]=ae.x-K.x,ee[1]=ae.y-K.y)}}const Y=_.zoom,se=[0,0,0];if(C){const K=j(G||_.pointCoordinate3D(O)),ae={dir:n.normalize([],n.sub([],K,_._camera.position))};if(ae.dir[2]<0){const le=_.zoomDeltaToMovement(K,C);n.scale$2(se,ae.dir,le)}}const F=n.add(ee,ee,se);_._translateCameraConstrained(F),C&&Math.abs(_.zoom-Y)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,m,!0)}_fireEvents(i,o,m){const g=wi(this._eventsInProgress),_=wi(i),j={};for(const I in i){const{originalEvent:O}=i[I];this._eventsInProgress[I]||(j[`${I}start`]=O),this._eventsInProgress[I]=i[I]}!g&&_&&this._fireEvent("movestart",_.originalEvent);for(const I in j)this._fireEvent(I,j[I]);_&&this._fireEvent("move",_.originalEvent);for(const I in i){const{originalEvent:O}=i[I];this._fireEvent(I,O)}const S={};let C;for(const I in this._eventsInProgress){const{handlerName:O,originalEvent:G}=this._eventsInProgress[I];this._handlersById[O].isActive()||(delete this._eventsInProgress[I],C=o[O]||G,S[`${I}end`]=C)}for(const I in S)this._fireEvent(I,S[I]);const D=wi(this._eventsInProgress);if(m&&(g||_)&&!D){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;I?(O(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:C})):(this._map.fire(new n.Event("moveend",{originalEvent:C})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new n.Event(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new $u("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ea="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Cl extends n.Evented{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,m){return i=n.Point.convert(i).mult(-1),this.panTo(this.transform.center,n.extend({offset:i},o),m)}panTo(i,o,m){return this.easeTo(n.extend({center:i},o),m)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,m){return this.easeTo(n.extend({zoom:i},o),m)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,m){return this.easeTo(n.extend({bearing:i},o),m)}resetNorth(i,o){return this.rotateTo(0,n.extend({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=n.LngLatBounds.convert(i);const m=o&&o.bearing||0,g=o&&o.pitch||0,_=i.getNorthWest(),j=i.getSouthEast();return this._cameraForBounds(this.transform,_,j,m,g,o)}_extendCameraOptions(i){const o={top:0,bottom:0,right:0,left:0};if(typeof(i=n.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const m=i.padding;i.padding={top:m,bottom:m,right:m,left:m}}return i.padding=n.extend(o,i.padding),i}_minimumAABBFrustumDistance(i,o){const m=o.max[0]-o.min[0],g=o.max[1]-o.min[1];return m/g>i.aspect?m/(2*Math.tan(.5*i.fovX)*i.aspect):g/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,m,g,_,j){const S=i.clone(),C=this._extendCameraOptions(j);S.bearing=g,S.pitch=_;const D=n.LngLat.convert(o),I=n.LngLat.convert(m),O=.5*(D.lat+I.lat),G=.5*(D.lng+I.lng),Q=n.latLngToECEF(O,G),ee=n.normalize([],Q),Y=n.normalize([],n.cross([],ee,[0,1,0])),se=n.cross([],Y,ee),F=[Y[0],Y[1],Y[2],0,se[0],se[1],se[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],K=[Q,n.latLngToECEF(D.lat,D.lng),n.latLngToECEF(I.lat,D.lng),n.latLngToECEF(I.lat,I.lng),n.latLngToECEF(D.lat,I.lng),n.latLngToECEF(O,D.lng),n.latLngToECEF(O,I.lng),n.latLngToECEF(D.lat,G),n.latLngToECEF(I.lat,G)];let ae=n.Aabb.fromPoints(K.map(st=>[n.dot(Y,st),n.dot(se,st),n.dot(ee,st)]));const le=n.transformMat4([],ae.center,F);n.squaredLength(le)===0&&n.set(le,0,0,1),n.normalize(le,le),n.scale$2(le,le,n.GLOBE_RADIUS),S.center=n.ecefToLatLng(le);const _e=S.getWorldToCameraMatrix(),be=n.invert(new Float64Array(16),_e);ae=n.Aabb.applyTransform(ae,n.multiply([],_e,F)),n.transformMat4(le,le,_e);const ve=.5*(ae.max[2]-ae.min[2]),Me=this._minimumAABBFrustumDistance(S,ae),ke=n.scale$2([],[0,0,1],ve),Be=n.add(ke,le,ke),at=Me+(S.pitch===0?0:n.distance(le,Be)),ze=S.globeCenterInViewSpace,Qe=n.sub([],le,[ze[0],ze[1],ze[2]]);n.normalize(Qe,Qe),n.scale$2(Qe,Qe,at);const Ve=n.add([],le,Qe);n.transformMat4(Ve,Ve,be);const nt=n.earthRadius/n.GLOBE_RADIUS,Fe=n.length(Ve),Xe=n.mercatorZfromAltitude(Math.max(Fe*nt-n.earthRadius,Number.EPSILON),0),lt=Math.min(S.zoomFromMercatorZAdjusted(Xe),C.maxZoom);return lt>.5*(n.GLOBE_ZOOM_THRESHOLD_MIN+n.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=lt,this._cameraForBounds(S,o,m,g,_,j)):{center:S.center,zoom:lt,bearing:g,pitch:_}}queryTerrainElevation(i,o){const m=this.transform.elevation;return m?(o=n.extend({},{exaggerated:!0},o),m.getAtPoint(n.MercatorCoordinate.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,m,g,_,j){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,o,m,g,_,j);const S=i.clone(),C=this._extendCameraOptions(j),D=S.padding;S.bearing=g,S.pitch=_;const I=n.LngLat.convert(o),O=n.LngLat.convert(m),G=new n.LngLat(I.lng,O.lat),Q=new n.LngLat(O.lng,I.lat),ee=S.project(I),Y=S.project(O),se=this.queryTerrainElevation(I),F=this.queryTerrainElevation(O),K=this.queryTerrainElevation(G),ae=this.queryTerrainElevation(Q),le=[[ee.x,ee.y,Math.min(se||0,F||0,K||0,ae||0)],[Y.x,Y.y,Math.max(se||0,F||0,K||0,ae||0)]];let _e=n.Aabb.fromPoints(le);const be=S.getWorldToCameraMatrix(),ve=n.invert(new Float64Array(16),be);_e=n.Aabb.applyTransform(_e,be);const Me=n.sub([],_e.max,_e.min),ke=D.left||0,Be=D.right||0,at=D.bottom||0,ze=D.top||0,{left:Qe,right:Ve,top:nt,bottom:Fe}=C.padding,Xe=.5*(ke+Be),lt=.5*(ze+at),st=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(ke+Be+Qe+Ve))/Me[0],(S.height-(at+ze+Fe+nt))/Me[1])),C.maxZoom),dt=S.scale/S.zoomScale(st);_e=new n.Aabb([_e.min[0]-(Qe+Xe)*dt,_e.min[1]-(Fe+lt)*dt,_e.min[2]],[_e.max[0]+(Ve+Xe)*dt,_e.max[1]+(nt+lt)*dt,_e.max[2]]);const Dt=.5*Me[2],Vt=this._minimumAABBFrustumDistance(S,_e),kt=[0,0,1,0];n.transformMat4$1(kt,kt,be),n.normalize$2(kt,kt);const Ot=n.scale$2([],kt,Vt+Dt),is=n.add([],_e.center,Ot),ts=(typeof C.offset.x=="number"&&typeof C.offset.y=="number"?new n.Point(C.offset.x,C.offset.y):n.Point.convert(C.offset)).rotate(-n.degToRad(g));_e.center[0]-=ts.x*dt,_e.center[1]+=ts.y*dt,n.transformMat4(_e.center,_e.center,ve),n.transformMat4(is,is,ve);const Pt=[_e.center[0],_e.center[1],is[2]*S.pixelsPerMeter];n.scale$2(Pt,Pt,1/S.worldSize);const bs=n.lngFromMercatorX(Pt[0]),ws=n.latFromMercatorY(Pt[1]),js=Math.min(S._zoomFromMercatorZ(Pt[2]),C.maxZoom),Ns=new n.LngLat(bs,ws);return S.mercatorFromTransition&&js<.5*(n.GLOBE_ZOOM_THRESHOLD_MIN+n.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=js,this._cameraForBounds(S,o,m,g,_,j)):{center:Ns,zoom:js,bearing:g,pitch:_}}fitBounds(i,o,m){const g=this.cameraForBounds(i,o);return this._fitInternal(g,o,m)}fitScreenCoordinates(i,o,m,g,_){const j=n.Point.convert(i),S=n.Point.convert(o),C=new n.Point(Math.min(j.x,S.x),Math.min(j.y,S.y)),D=new n.Point(Math.max(j.x,S.x),Math.max(j.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(j,S))return this;const I=this.transform.pointLocation3D(C),O=this.transform.pointLocation3D(D),G=this.transform.pointLocation3D(new n.Point(C.x,D.y)),Q=this.transform.pointLocation3D(new n.Point(D.x,C.y)),ee=[Math.min(I.lng,O.lng,G.lng,Q.lng),Math.min(I.lat,O.lat,G.lat,Q.lat)],Y=[Math.max(I.lng,O.lng,G.lng,Q.lng),Math.max(I.lat,O.lat,G.lat,Q.lat)],se=g&&g.pitch?g.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,ee,Y,m,se,g);return this._fitInternal(F,g,_)}_fitInternal(i,o,m){return i?(delete(o=n.extend(i,o)).padding,o.linear?this.easeTo(o,m):this.flyTo(o,m)):this}jumpTo(i,o){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let g=!1,_=!1,j=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(g=!0,m.zoom=+i.zoom),i.center!==void 0&&(m.center=n.LngLat.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(_=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(j=!0,m.pitch=+i.pitch),i.padding==null||m.isPaddingEqual(i.padding)||(m.padding=i.padding),i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),g&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),_&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),j&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.warnOnce(ea),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const m=this.transform;if(!m.projection.supportsFreeCamera)return n.warnOnce(ea),this;this.stop();const g=m.zoom,_=m.pitch,j=m.bearing;m.setFreeCameraOptions(i);const S=g!==m.zoom,C=_!==m.pitch,D=j!==m.bearing;return this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),S&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),D&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),C&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=n.extend({offset:[0,0],duration:500,easing:n.ease},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const m=this.transform,g=this.getZoom(),_=this.getBearing(),j=this.getPitch(),S=this.getPadding(),C="zoom"in i?+i.zoom:g,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:j,O="padding"in i?i.padding:m.padding,G=n.Point.convert(i.offset);let Q,ee,Y;if(m.projection.name==="globe"){const ke=n.MercatorCoordinate.fromLngLat(m.center),Be=G.rotate(-m.angle);ke.x+=Be.x/m.worldSize,ke.y+=Be.y/m.worldSize;const at=ke.toLngLat(),ze=n.LngLat.convert(i.center||at);this._normalizeCenter(ze),Q=m.centerPoint.add(Be),ee=new n.Point(ke.x,ke.y).mult(m.worldSize),Y=new n.Point(n.mercatorXfromLng(ze.lng),n.mercatorYfromLat(ze.lat)).mult(m.worldSize).sub(ee)}else{Q=m.centerPoint.add(G);const ke=m.pointLocation(Q),Be=n.LngLat.convert(i.center||ke);this._normalizeCenter(Be),ee=m.project(ke),Y=m.project(Be).sub(ee)}const se=m.zoomScale(C-g);let F,K;i.around&&(F=n.LngLat.convert(i.around),K=m.locationPoint(F));const ae=this._zooming||C!==g,le=this._rotating||_!==D,_e=this._pitching||I!==j,be=!m.isPaddingEqual(O),ve=ke=>Be=>{if(ae&&(ke.zoom=n.number(g,C,Be)),le&&(ke.bearing=n.number(_,D,Be)),_e&&(ke.pitch=n.number(j,I,Be)),be&&(ke.interpolatePadding(S,O,Be),Q=ke.centerPoint.add(G)),F)ke.setLocationAtPoint(F,K);else{const at=ke.zoomScale(ke.zoom-g),ze=C>g?Math.min(2,se):Math.max(.5,se),Qe=Math.pow(ze,1-Be),Ve=ke.unproject(ee.add(Y.mult(Be*Qe)).mult(at));ke.setLocationAtPoint(ke.renderWorldCopies?Ve.wrap():Ve,Q)}return i.preloadOnly||this._fireMoveEvents(o),ke};if(i.preloadOnly){const ke=this._emulate(ve,i.duration,m);return this._preloadTiles(ke),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=le,this._pitching=_e,this._padding=be,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,Me),this._ease(ve(m),ke=>{m.recenterOnTerrain(),this._afterEase(o,ke)},i),this}_prepareEase(i,o,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||m.moving||this.fire(new n.Event("movestart",i)),this._zooming&&!m.zooming&&this.fire(new n.Event("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new n.Event("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new n.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new n.Event("move",i)),this._zooming&&this.fire(new n.Event("zoom",i)),this._rotating&&this.fire(new n.Event("rotate",i)),this._pitching&&this.fire(new n.Event("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,g=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new n.Event("zoomend",i)),g&&this.fire(new n.Event("rotateend",i)),_&&this.fire(new n.Event("pitchend",i)),this.fire(new n.Event("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const st=n.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,o)}this.stop(),i=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},i);const m=this.transform,g=this.getZoom(),_=this.getBearing(),j=this.getPitch(),S=this.getPadding(),C="zoom"in i?n.clamp(+i.zoom,m.minZoom,m.maxZoom):g,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:j,O="padding"in i?i.padding:m.padding,G=m.zoomScale(C-g),Q=n.Point.convert(i.offset);let ee=m.centerPoint.add(Q);const Y=m.pointLocation(ee),se=n.LngLat.convert(i.center||Y);this._normalizeCenter(se);const F=m.project(Y),K=m.project(se).sub(F);let ae=i.curve;const le=Math.max(m.width,m.height),_e=le/G,be=K.mag();if("minZoom"in i){const st=n.clamp(Math.min(i.minZoom,g,C),m.minZoom,m.maxZoom),dt=le/m.zoomScale(st-g);ae=Math.sqrt(dt/be*2)}const ve=ae*ae;function Me(st){const dt=(_e*_e-le*le+(st?-1:1)*ve*ve*be*be)/(2*(st?_e:le)*ve*be);return Math.log(Math.sqrt(dt*dt+1)-dt)}function ke(st){return(Math.exp(st)-Math.exp(-st))/2}function Be(st){return(Math.exp(st)+Math.exp(-st))/2}const at=Me(0);let ze=function(st){return Be(at)/Be(at+ae*st)},Qe=function(st){return le*((Be(at)*(ke(dt=at+ae*st)/Be(dt))-ke(at))/ve)/be;var dt},Ve=(Me(1)-at)/ae;if(Math.abs(be)<1e-6||!isFinite(Ve)){if(Math.abs(le-_e)<1e-6)return this.easeTo(i,o);const st=_e<le?-1:1;Ve=Math.abs(Math.log(_e/le))/ae,Qe=function(){return 0},ze=function(dt){return Math.exp(st*ae*dt)}}i.duration="duration"in i?+i.duration:1e3*Ve/("screenSpeed"in i?+i.screenSpeed/ae:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const nt=_!==D,Fe=I!==j,Xe=!m.isPaddingEqual(O),lt=st=>dt=>{const Dt=dt*Ve,Vt=1/ze(Dt);st.zoom=dt===1?C:g+st.scaleZoom(Vt),nt&&(st.bearing=n.number(_,D,dt)),Fe&&(st.pitch=n.number(j,I,dt)),Xe&&(st.interpolatePadding(S,O,dt),ee=st.centerPoint.add(Q));const kt=dt===1?se:st.unproject(F.add(K.mult(Qe(Dt))).mult(Vt));return st.setLocationAtPoint(st.renderWorldCopies?kt.wrap():kt,ee),st._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),st};if(i.preloadOnly){const st=this._emulate(lt,i.duration,m);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=nt,this._pitching=Fe,this._padding=Xe,this._prepareEase(o,!1),this._ease(lt(m),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,o)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,o,m){m.animate===!1||m.duration===0?(i(1),o()):(this._easeStart=n.exported.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=n.wrap(i,-180,180);const m=Math.abs(i-o);return Math.abs(i-360-o)<m&&(i-=360),Math.abs(i+360-o)<m&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const m=i.lng-o.center.lng;i.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&n.exported.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,m){const g=Math.ceil(15*o/1e3),_=[],j=i(m.clone());for(let S=0;S<=g;S++){const C=j(S/g);_.push(C.clone())}return _}}class Et{constructor(i={}){this.options=i,n.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact;return this._map=i,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W("button","mapboxgl-ctrl-attrib-button",this._container),W("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const m=this._map._getUIString(`AttributionControl.${o}`);i.setAttribute("aria-label",m),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.config.ACCESS_TOKEN}];if(i){const m=o.reduce((g,_,j)=>(_.value&&(g+=`${_.key}=${_.value}${j<o.length-1?"&":""}`),g),"?");i.href=`${n.config.FEEDBACK_URL}/${m}#${jo(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const o=this._map.style._sourceCaches;for(const g in o){const _=o[g];if(_.used){const j=_.getSource();j.attribution&&i.indexOf(j.attribution)<0&&i.push(j.attribution)}}i.sort((g,_)=>g.length-_.length),i=i.filter((g,_)=>{for(let j=_+1;j<i.length;j++)if(i[j].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yc{constructor(){n.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=W("div","mapboxgl-ctrl");const o=W("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const m=i[o].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class ed{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,m=o?this._queue.concat(o):this._queue;for(const g of m)if(g.id===i)return void(g.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const m of o)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ia(d,i,o){if(d=new n.LngLat(d.lng,d.lat),i){const m=new n.LngLat(d.lng-360,d.lat),g=new n.LngLat(d.lng+360,d.lat),_=360*Math.ceil(Math.abs(d.lng-o.center.lng)/360),j=o.locationPoint(d).distSqr(i),S=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(m).distSqr(i)<j&&(S||Math.abs(m.lng-o.center.lng)<_)?d=m:o.locationPoint(g).distSqr(i)<j&&(S||Math.abs(g.lng-o.center.lng)<_)&&(d=g)}for(;Math.abs(d.lng-o.center.lng)>180;){const m=o.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=o.width&&m.y<=o.height)break;d.lng>o.center.lng?d.lng-=360:d.lng+=360}return d}const ta={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class jt extends n.Evented{constructor(i,o){if(super(),(i instanceof n.window.HTMLElement||o)&&(i=n.extend({element:i},o)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=n.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=W("div");const g=41,_=27,j=X("svg",{display:"block",height:g*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${g}`},this._element),S=X("radialGradient",{id:"shadowGradient"},X("defs",{},j));X("stop",{offset:"10%","stop-opacity":.4},S),X("stop",{offset:"100%","stop-opacity":.05},S),X("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},j),X("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},j),X("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},j),X("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},j),this._offset=n.Point.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const m=this._element.classList;for(const g in ta)m.remove(`mapboxgl-marker-anchor-${g}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=n.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,m=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,m=this._element;this._popup&&(o===m||m.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const m=i.unproject(o),g=i.getFreeCameraOptions();if(!g.position)return!1;const _=g.position.toLngLat();return _.distanceTo(m)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const m=i.unproject(o);let g;i._showingGlobe()&&n.isLngLatBehindGlobe(i.transform,this._lngLat)?g=0:(g=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${ta[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const i=this._pos,o=this._map,m=this.getPitchAlignment();if(!o||!i||m!=="map")return"";if(!o._showingGlobe()){const C=o.getPitch();return C?`rotateX(${C}deg)`:""}const g=n.radToDeg(n.globeTiltAtLngLat(o.transform,this._lngLat)),_=i.sub(n.globeCenterToScreenPoint(o.transform)),j=Math.abs(_.x)+Math.abs(_.y);if(j===0)return"";const S=g/j;return`rotateX(${-_.y*S}deg) rotateY(${_.x*S}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let m=0;const g=this.getRotationAlignment();if(g==="map")if(o._showingGlobe()){const _=o.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),j=o.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);m=n.radToDeg(Math.atan2(j.y,j.x))-90}else m=-o.getBearing();else if(g==="horizon"){const _=n.smoothstep(4,6,o.getZoom()),j=n.globeCenterToScreenPoint(o.transform);j.y+=_*o.transform.height;const S=i.sub(j),C=n.radToDeg(Math.atan2(S.y,S.x));m=(C>90?C-270:C+90)*(1-_)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){n.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Ia(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),i===!0?this._updateFrameId=n.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=n.Point.convert(i),this._update(),this}_onMove(i){const o=this._map;if(!o)return;const m=this._pointerdownPos,g=this._positionDelta;if(m&&g){if(!this._isDragging){const _=this._clickTolerance||o._clickTolerance;if(i.point.dist(m)<_)return;this._isDragging=!0}this._pos=i.point.sub(g),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,m=this._pos;o&&m&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(m),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const td={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Om=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Gu(d=new n.Point(0,0),i="bottom"){if(typeof d=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(i){case"top":return new n.Point(0,d);case"top-left":return new n.Point(o,o);case"top-right":return new n.Point(-o,o);case"bottom":return new n.Point(0,-d);case"bottom-left":return new n.Point(o,-o);case"bottom-right":return new n.Point(-o,-o);case"left":return new n.Point(d,0);case"right":return new n.Point(-d,0)}return new n.Point(0,0)}return d instanceof n.Point||Array.isArray(d)?n.Point.convert(d):n.Point.convert(d[i]||[0,0])}class sd{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=n.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,m){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+m}}const Zu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Wu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Fm={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bm{constructor(i,o,m=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Hc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new Xc({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),ne()}move(i,o){const m=this.map,g=this.mouseRotate.mousemoveWindow(i,o),_=g&&g.bearingDelta;if(_&&m.setBearing(m.getBearing()+_),this.mousePitch){const j=this.mousePitch.mousemoveWindow(i,o),S=j&&j.pitchDelta;S&&m.setPitch(m.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){te(),n.window.removeEventListener("mousemove",this.mousemove),n.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(n.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Ce(this.element,i)),n.window.addEventListener("mousemove",this.mousemove),n.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Ce(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ae(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Ae(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const rd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},id={maxWidth:100,unit:"metric"},nd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Da={version:n.version,supported:z,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends Cl{constructor(d){if(n.LivePerformanceUtils.mark(n.PerformanceMarkers.create),(d=n.extend({},Wu,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&n.isSafariWithAntialiasingBug(n.window)&&(d.antialias=!1,n.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ka(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new ed,this._domRenderTaskQueue=new ed,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.uniqueId(),this._locale=n.extend({},Zu,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new n.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=n.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof n.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&n.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),n.window!==void 0&&(n.window.addEventListener("online",this._onWindowOnline,!1),n.window.addEventListener("resize",this._onWindowResize,!1),n.window.addEventListener("orientationchange",this._onWindowResize,!1),n.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new $i(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new $c(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,n.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Et({customAttribution:d.customAttribution})),this._logoControl=new Yc,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new n.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new n.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=d.onAdd(this);this._controls.push(d);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(o,m.firstChild):m.appendChild(o),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new n.Event("movestart",d)).fire(new n.Event("move",d)),this.fire(new n.Event("resize",d)),i&&this.fire(new n.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(n.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?n.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(i=>i==="auto"?n.window.navigator.language:i):d}setLanguage(d){const i=this._parseLanguage(d);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,i=d.projection.name;let o;i==="globe"&&d.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),o=!0):i==="mercator"&&d.zoom<n.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,i){return this._updateProjection(d||i||{name:"mercator"})}_updateProjection(d){let i;if(i=d.name==="globe"&&this.transform.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(n.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(n.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,i,o){if(d==="mouseenter"||d==="mouseover"){let m=!1;const g=j=>{const S=i.filter(D=>this.getLayer(D)),C=S.length?this.queryRenderedFeatures(j.point,{layers:S}):[];C.length?m||(m=!0,o.call(this,new Tr(d,this,j.originalEvent,{features:C}))):m=!1},_=()=>{m=!1};return{layers:new Set(i),listener:o,delegates:{mousemove:g,mouseout:_}}}if(d==="mouseleave"||d==="mouseout"){let m=!1;const g=j=>{const S=i.filter(C=>this.getLayer(C));(S.length?this.queryRenderedFeatures(j.point,{layers:S}):[]).length?m=!0:m&&(m=!1,o.call(this,new Tr(d,this,j.originalEvent)))},_=j=>{m&&(m=!1,o.call(this,new Tr(d,this,j.originalEvent)))};return{layers:new Set(i),listener:o,delegates:{mousemove:g,mouseout:_}}}{const m=g=>{const _=i.filter(S=>this.getLayer(S)),j=_.length?this.queryRenderedFeatures(g.point,{layers:_}):[];j.length&&(g.features=j,o.call(this,g),delete g.features)};return{layers:new Set(i),listener:o,delegates:{[d]:m}}}}on(d,i,o){if(o===void 0)return super.on(d,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(d,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(const g in m.delegates)this.on(g,m.delegates[g]);return this}once(d,i,o){if(o===void 0)return super.once(d,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(d,i,o);for(const g in m.delegates)this.once(g,m.delegates[g]);return this}off(d,i,o){if(o===void 0)return super.off(d,i);i=new Set(Array.isArray(i)?i:[i]);const m=(_,j)=>{if(_.size!==j.size)return!1;for(const S of _)if(!j.has(S))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[d]:void 0;return g&&(_=>{for(let j=0;j<_.length;j++){const S=_[j];if(S.listener===o&&m(S.layers,i)){for(const C in S.delegates)this.off(C,S.delegates[C]);return _.splice(j,1),this}}})(g),this}queryRenderedFeatures(d,i){return this.style?(i!==void 0||d===void 0||d instanceof n.Point||Array.isArray(d)||(i=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(d,i){return this.style.querySourceFeatures(d,i)}isPointOnSurface(d){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&n.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.Point.convert(d))}setStyle(d,i){return(i=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(d,i))}_getUIString(d){const i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Vi(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Vi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,i){if(typeof d=="string"){const o=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(o,n.ResourceType.Style);n.getJSON(m,(g,_)=>{g?this.fire(new n.ErrorEvent(g)):_&&this._updateDiff(_,i)})}else typeof d=="object"&&this._updateDiff(d,i)}_updateDiff(d,i){try{this.style.setState(d)&&this._update(!0)}catch(o){n.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(d,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.warnOnce("There is no style added to the map."),!1)}addSource(d,i){return this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const i in d){const o=d[i]._tiles;for(const m in o){const g=o[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(d,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,o)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,i,{pixelRatio:o=1,sdf:m=!1,stretchX:g,stretchY:_,content:j}={}){if(this._lazyInitEmptyStyle(),i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap){const{width:S,height:C,data:D}=n.exported.getImageData(i);this.style.addImage(d,{data:new n.RGBAImage({width:S,height:C},D),pixelRatio:o,stretchX:g,stretchY:_,content:j,sdf:m,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:C}=i,D=i;this.style.addImage(d,{data:new n.RGBAImage({width:S,height:C},new Uint8Array(D.data)),pixelRatio:o,stretchX:g,stretchY:_,content:j,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,d)}}updateImage(d,i){const o=this.style.getImage(d);if(!o)return void this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap?n.exported.getImageData(i):i,{width:g,height:_}=m;g!==void 0&&_!==void 0?g===o.data.width&&_===o.data.height?(o.data.replace(m.data,!(i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap)),this.style.updateImage(d,o)):this.fire(new n.ErrorEvent(new Error(`The width and height of the updated image (${g}, ${_})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`))):this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){n.getImage(this._requestManager.transformRequest(d,n.ResourceType.Image),(o,m)=>{i(o,m instanceof n.window.HTMLImageElement?n.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,i){return this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)}moveLayer(d,i){return this.style.moveLayer(d,i),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,i,o){return this.style.setLayerZoomRange(d,i,o),this._update(!0)}setFilter(d,i,o={}){return this.style.setFilter(d,i,o),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,i,o,m={}){return this.style.setPaintProperty(d,i,o,m),this._update(!0)}getPaintProperty(d,i){return this.style.getPaintProperty(d,i)}setLayoutProperty(d,i,o,m={}){return this.style.setLayoutProperty(d,i,o,m),this._update(!0)}getLayoutProperty(d,i){return this.style.getLayoutProperty(d,i)}setLight(d,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.LngLat.convert(d),this.transform):0}setFeatureState(d,i){return this.style.setFeatureState(d,i),this._update()}removeFeatureState(d,i){return this.style.removeFeatureState(d,i),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,m,g,_=this._container;for(;_&&(!m||!g);){const j=n.window.getComputedStyle(_).transform;j&&j!=="none"&&(o=j.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(m=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(g=o[3])),_=_.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=g?Math.abs(i/g):i}_detectMissingCSS(){n.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=W("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=W("div","mapboxgl-canvas-container",d);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=W("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=W("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{m[g]=W("div",`mapboxgl-ctrl-${g}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,i){const o=n.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(d),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const i=this._markers.indexOf(d);i!==-1&&this._markers.splice(i,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const i=this._popups.indexOf(d);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const d=n.extend({},z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._useWebGL2&&this._canvas.getContext("webgl2",d),o=i||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);o?(this._useWebGL2&&!i&&n.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),n.storeAuthState(o,!0),this.painter=new Ea(o,this.transform,!!i),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.exported$1.testSupport(o)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let i;const o=this.painter.context.extTimerQuery,m=n.exported.now();if(this.listens("gpu-timing-frame")&&(i=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],n.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],n.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,C=this.transform.pitch,D=n.exported.now(),I=new n.EvaluationParameters(S,{now:D,fadeDuration:g,pitch:C,transition:this.style.getTransition()});this.style.update(I)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new n.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const S=n.exported.now()-m;o.endQueryEXT(o.TIME_ELAPSED_EXT,i),setTimeout(()=>{const C=o.getQueryObjectEXT(i,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(i),this.fire(new n.Event("gpu-timing-frame",{cpuTime:S,gpuTime:C})),n.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:C}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const C=this.painter.queryGpuTimers(S);this.fire(new n.Event("gpu-timing-layer",{layerTimes:C}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const C=this.painter.queryGpuTimeDeferredRender(S);this.fire(new n.Event("gpu-timing-deferred-render",{gpuTime:C}))},50)}const j=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(j||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(_=this._updateAverageElevation(m,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new n.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const C=this._calculateSpeedIndex();this.fire(new n.Event("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,n.LivePerformanceUtils.mark(n.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&n.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const i of this._markers)d&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!d||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(d,i=!1){const o=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((i||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let g=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=d;const j=Math.abs(m-g);if(j>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(g),o(g);this._averageElevation.easeTo(g,d,300)}else if(j>1e-4)return this._averageElevation.jumpTo(g),o(g)}return!!this._averageElevation.isEasing(d)&&o(this._averageElevation.getValue(d))}_authenticate(){n.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===n.AUTH_ERR_MSG||d.status===401)){const i=this.painter.context.gl;n.storeAuthState(i,!1),this._logoControl instanceof Yc&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),n.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,m=o.createFramebuffer();function g(_){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,_,0);const j=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,j),j}return o.bindFramebuffer(o.FRAMEBUFFER,m),this._canvasPixelComparison(g(d),i.canvasCopies.map(g),i.timeStamps)}_canvasPixelComparison(d,i,o){let m=o[1]-o[0];const g=d.length/4;for(let _=0;_<i.length;_++){const j=i[_];let S=0;for(let C=0;C<j.length;C+=4)j[C]===d[C]&&j[C+1]===d[C+1]&&j[C+2]===d[C+2]&&j[C+3]===d[C+3]&&(S+=1);m+=(o[_+2]-o[_+1])*(1-S/g)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),n.window!==void 0&&(n.window.removeEventListener("resize",this._onWindowResize,!1),n.window.removeEventListener("orientationchange",this._onWindowResize,!1),n.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.removeEventListener("online",this._onWindowOnline,!1),n.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),n.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=n.exported.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(d){const i=this.style?Object.values(this.style._sourceCaches):[];return n.asyncAll(i,(o,m)=>o._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){n.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,i){n.setCacheLimits(d,i)}get version(){return n.version}},NavigationControl:class{constructor(d){this.options=n.extend({},Fm,d),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),W("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),W("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=W("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const i=d.getZoom(),o=i===d.getMaxZoom(),m=i===d.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bm(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,i){const o=W("button",d,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(d,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);d.setAttribute("aria-label",o),d.firstElementChild&&d.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.Evented{constructor(d){super(),this.options=n.extend({geolocation:n.window.navigator.geolocation},rd,d),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Aa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,d(o)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):n.window.navigator.permissions!==void 0?n.window.navigator.permissions.query({name:"geolocation"}).then(o=>i(o.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(d){const i=this._map.getMaxBounds(),o=d.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("geolocate",d)),this._finish()}}_updateCamera(d){const i=new n.LngLat(d.coords.longitude,d.coords.latitude),o=d.coords.accuracy,m=this._map.getBearing(),g=n.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),g,{geolocateSource:!0})}_updateMarker(d){if(d){const i=new n.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,i=n.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=W("button","mapboxgl-ctrl-geolocate",this._container),W("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W("div","mapboxgl-user-location"),this._dotElement.appendChild(W("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(W("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new jt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=W("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{n.window.addEventListener("ondeviceorientationabsolute"in n.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};n.window.DeviceMotionEvent!==void 0&&typeof n.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),n.window.removeEventListener("deviceorientation",this._onDeviceOrientation),n.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Et,ScaleControl:class{constructor(d){this.options=n.extend({},id,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,m=i._containerWidth/2-d/2,g=i.unproject([m,o]),_=i.unproject([m+d,o]),j=g.distanceTo(_);if(this.options.unit==="imperial"){const S=3.2808*j;S>5280?this._setScale(d,S/5280,"mile"):this._setScale(d,S,"foot")}else this.options.unit==="nautical"?this._setScale(d,j/1852,"nautical-mile"):j>=1e3?this._setScale(d,j/1e3,"kilometer"):this._setScale(d,j,"meter")}_setScale(d,i,o){this._map._requestDomTask(()=>{const m=function(_){const j=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/j;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const D=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*D)/D}(S),j*S}(i),g=m/i;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(m):`${m}&nbsp;${nd[o]}`,this._container.style.width=d*g+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof n.window.HTMLElement?this._container=d.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in n.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in n.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,n.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!n.window.document.fullscreenEnabled&&!n.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=W("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),n.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(n.window.document.fullscreenElement||n.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?n.window.document.exitFullscreen?n.window.document.exitFullscreen():n.window.document.webkitCancelFullScreen&&n.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.Evented{constructor(d){super(),this.options=n.extend(Object.create(td),d),n.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=n.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(n.window.document.createTextNode(d))}setHTML(d){const i=n.window.document.createDocumentFragment(),o=n.window.document.createElement("body");let m;for(o.innerHTML=d;m=o.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=W("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(d),this.options.closeButton){const o=this._closeButton=W("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let i;return this._classList.delete(d)?i=!1:(this._classList.add(d),i=!0),this._updateClassList(),i}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,m=this._pos;if(!i||!o||!m)return"bottom";const g=o.offsetWidth,_=o.offsetHeight,j=m.x<g/2,S=m.x>i.transform.width-g/2;if(m.y+d<_)return j?"top-left":S?"top-right":"top";if(m.y>i.transform.height-_){if(j)return"bottom-left";if(S)return"bottom-right"}return j?"left":S?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),d.className=i.join(" ")}_update(d){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let m=this._container;if(m||(m=this._container=W("div","mapboxgl-popup",i.getContainer()),this._tip=W("div","mapboxgl-popup-tip",m),m.appendChild(o)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ia(this._lngLat,this._pos,i.transform)),!this._trackPointer||d){const g=this._pos=this._trackPointer&&d?d:i.project(this._lngLat),_=Gu(this.options.offset),j=this._anchor=this._getAnchor(_.y),S=Gu(this.options.offset,j),C=g.add(S).round();i._requestDomTask(()=>{this._container&&j&&(this._container.style.transform=`${ta[j]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&i._showingGlobe()){const g=n.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Om);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:jt,Style:Vi,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.Point,MercatorCoordinate:n.MercatorCoordinate,FreeCameraOptions:Au,Evented:n.Evented,config:n.config,prewarm:function(){ga().acquire(Fi)},clearPrewarmedResources:function(){const d=Hr;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Fi),Hr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return n.config.ACCESS_TOKEN},set accessToken(d){n.config.ACCESS_TOKEN=d},get baseApiUrl(){return n.config.API_URL},set baseApiUrl(d){n.config.API_URL=d},get workerCount(){return Nr.workerCount},set workerCount(d){Nr.workerCount=d},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){n.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){n.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:n.exported.setNow,restoreNow:n.exported.restoreNow};return Da});var A=N;return A})})(iv);var yE=iv.exports;const fi=x1(yE);async function av(c,u){var x,f;if(!c||c.trim().length<3)return u(!1),[];u(!0);try{const w=await Pr.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(c)}.json`,{params:{access_token:void 0,autocomplete:"true",language:"en",limit:5}});return(f=(x=w==null?void 0:w.data)==null?void 0:x.features)==null?void 0:f.map(N=>{const E=N.context||[],A=P=>E.find(z=>z.id.startsWith(P))||{};let n=A("country").short_code||"";return n=n?n.toUpperCase():"",{display_name:N.place_name,address_line1:N.text||"",address_line2:"",city:A("place").text||"",state:A("region").text||"",postal_code:A("postcode").text||"",country:n,lat:N.geometry.coordinates[1],lng:N.geometry.coordinates[0]}})}finally{u(!1)}}const ov=({isOpen:c,onClose:u,onSubmit:x,customer:f,loading:w=!1,title:N})=>{const{register:E,handleSubmit:A,reset:n,formState:{errors:P},setValue:z,watch:q}=Cn({defaultValues:{name:"",external_id:"",tax_id:"",phone:"",email:"",account_status:"active",credit_terms_days:30}}),[U,W]=oe.useState(""),[X,Z]=oe.useState(!1),[J,de]=oe.useState(null),[ne,te]=oe.useState([]),Ne=oe.useRef(null),[he,Ce]=oe.useState(null),[Ae,fe]=oe.useState(null),[Ie,Ee]=oe.useState(!1),tt=q("latitude"),je=q("longitude");q("delivery_window_start"),q("delivery_window_end");const Pe=async ft=>{try{const Mt=await yt.customers.validate.mutate({...ft,exclude_id:f==null?void 0:f.id});return Mt.valid?(Mt.warnings.length>0&&console.warn("Customer warnings:",Mt.warnings),!0):Mt.errors[0]||"Customer validation failed"}catch(Mt){return console.error("Customer validation error:",Mt),"Failed to validate customer data"}},it=async(ft,Mt)=>{try{const ht=await yt.customers.validateCreditTerms.mutate({credit_terms_days:ft,account_status:Mt,customer_id:f==null?void 0:f.id});return ht.valid?(ht.warnings.length>0&&console.warn("Credit terms warnings:",ht.warnings),!0):ht.errors[0]||"Credit terms validation failed"}catch(ht){return console.error("Credit terms validation error:",ht),"Failed to validate credit terms"}},ct=async(ft,Mt)=>{try{const ht=await yt.customers.validateDeliveryWindow.mutate({delivery_window_start:ft,delivery_window_end:Mt});return ht.valid?(ht.warnings.length>0&&console.warn("Delivery window warnings:",ht.warnings),!0):ht.errors[0]||"Delivery window validation failed"}catch(ht){return console.error("Delivery window validation error:",ht),"Failed to validate delivery window"}};oe.useEffect(()=>{var ft,Mt,ht,Os,ns,_s,pr,Ut,fr,Fr,jr,gr,Br;if(f){if(n({name:f.name,external_id:f.external_id||"",tax_id:f.tax_id||"",phone:f.phone||"",email:f.email||"",account_status:f.account_status,credit_terms_days:f.credit_terms_days,address_label:((ft=f.primary_address)==null?void 0:ft.label)||"",line1:((Mt=f.primary_address)==null?void 0:Mt.line1)||"",line2:((ht=f.primary_address)==null?void 0:ht.line2)||"",city:((Os=f.primary_address)==null?void 0:Os.city)||"",state:((ns=f.primary_address)==null?void 0:ns.state)||"",postal_code:((_s=f.primary_address)==null?void 0:_s.postal_code)||"",country:((pr=f.primary_address)==null?void 0:pr.country)||"US",delivery_window_start:((Ut=f.primary_address)==null?void 0:Ut.delivery_window_start)||"",delivery_window_end:((fr=f.primary_address)==null?void 0:fr.delivery_window_end)||"",is_primary:((Fr=f.primary_address)==null?void 0:Fr.is_primary)||!0,instructions:((jr=f.primary_address)==null?void 0:jr.instructions)||"",latitude:(gr=f.primary_address)==null?void 0:gr.latitude,longitude:(Br=f.primary_address)==null?void 0:Br.longitude}),f.primary_address){const _r=[f.primary_address.line1,f.primary_address.line2,f.primary_address.city,f.primary_address.state,f.primary_address.postal_code].filter(Boolean);W(_r.join(", "))}}else n({name:"",external_id:"",tax_id:"",phone:"",email:"",account_status:"active",credit_terms_days:30,address_label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:!0,instructions:"",latitude:void 0,longitude:void 0}),W("")},[f,n]),oe.useEffect(()=>{let ft=!0;return U&&U.length>=3?(Z(!0),av(U,Z).then(Mt=>{ft&&te(Mt||[])})):(te([]),Z(!1)),()=>{ft=!1}},[U]),oe.useEffect(()=>{if(!he&&Ne.current&&tt&&je){fi.accessToken=void 0;const ft=new fi.Map({container:Ne.current,style:"mapbox://styles/mapbox/streets-v11",center:[je,tt],zoom:14});ft.addControl(new fi.NavigationControl,"top-right"),Ce(ft);const Mt=new fi.Marker({anchor:"center",draggable:Ie}).setLngLat([je,tt]).addTo(ft);fe(Mt),Mt.on("dragend",()=>{const ht=Mt.getLngLat();z("latitude",ht.lat),z("longitude",ht.lng)}),ft.on("load",()=>{ft.resize()})}},[Ne,tt,je]),oe.useEffect(()=>{he&&Ae&&tt&&je&&(Ae.setLngLat([je,tt]),Ae.setDraggable(Ie),he.setCenter([je,tt]),he.setZoom(14),he.resize())},[tt,je,Ie,he,Ae]),oe.useEffect(()=>()=>{Ae&&Ae.remove(),he&&he.remove()},[]);const Nt=async ft=>{try{if(await Pe({name:ft.name,email:ft.email||void 0,phone:ft.phone||void 0,external_id:ft.external_id||void 0,tax_id:ft.tax_id||void 0})!==!0||await it(ft.credit_terms_days,ft.account_status)!==!0||ft.delivery_window_start&&ft.delivery_window_end&&await ct(ft.delivery_window_start,ft.delivery_window_end)!==!0)return;const{address_label:Os,line1:ns,line2:_s,city:pr,state:Ut,postal_code:fr,country:Fr,delivery_window_start:jr,delivery_window_end:gr,is_primary:Br,instructions:_r,latitude:Jr,longitude:Qt,...gi}=ft;x({...gi,address:{label:Os,line1:ns,line2:_s,city:pr,state:Ut,postal_code:fr,country:Fr,delivery_window_start:jr||void 0,delivery_window_end:gr||void 0,is_primary:Br,instructions:_r,latitude:Jr,longitude:Qt}})}catch(Mt){console.error("Form validation error:",Mt)}};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(Nt),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Business Name *"}),t.jsx("input",{type:"text",id:"name",...E("name",{required:"Business name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),P.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"external_id",className:"block text-sm font-medium text-gray-700",children:"External ID"}),t.jsx("input",{type:"text",id:"external_id",...E("external_id"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"QuickBooks ID"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tax_id",className:"block text-sm font-medium text-gray-700",children:"Tax ID (VAT/EIN)"}),t.jsx("input",{type:"text",id:"tax_id",...E("tax_id"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone"}),t.jsx("input",{type:"tel",id:"phone",...E("phone"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),t.jsx("input",{type:"email",id:"email",...E("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),P.email&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.email.message})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"account_status",className:"block text-sm font-medium text-gray-700",children:"Account Status"}),t.jsxs("select",{id:"account_status",...E("account_status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"credit_terms_days",className:"block text-sm font-medium text-gray-700",children:"Credit Terms (Days)"}),t.jsx("input",{type:"number",id:"credit_terms_days",min:"0",...E("credit_terms_days",{required:"Credit terms is required",min:{value:0,message:"Credit terms must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),P.credit_terms_days&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.credit_terms_days.message})]})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200 mt-4",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Address"}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"address_autosuggest",className:"block text-sm font-medium text-gray-700",children:"Address *"}),t.jsx("input",{type:"text",id:"address_autosuggest",value:U,onChange:ft=>{W(ft.target.value),de(null)},className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",autoComplete:"off",placeholder:"Start typing address..."}),X&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Searching..."}),ne.length>0&&!J&&t.jsx("ul",{className:"border border-gray-200 rounded bg-white mt-1 max-h-48 overflow-y-auto z-10 relative",children:ne.map((ft,Mt)=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-50",onClick:()=>{de(ft),W(ft.display_name),z("line1",ft.address_line1||""),z("line2",ft.address_line2||""),z("city",ft.city||""),z("state",ft.state||""),z("postal_code",ft.postal_code||""),z("country",ft.country||""),z("latitude",ft.lat),z("longitude",ft.lng)},children:ft.display_name},Mt))}),J&&t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Address selected"})]})]}),tt&&je&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{ref:Ne,style:{width:"100%",height:200,borderRadius:8,overflow:"hidden",position:"relative"}}),t.jsx("div",{className:"flex justify-end mt-2",children:Ie?t.jsx("button",{type:"button",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",onClick:()=>Ee(!1),children:"Save Pin Location"}):t.jsx("button",{type:"button",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs",onClick:()=>Ee(!0),children:"Adjust Pin"})})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200 mt-4",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Delivery Preferences"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_start",className:"block text-sm font-medium text-gray-700",children:"Delivery Window Start"}),t.jsx("input",{type:"time",id:"delivery_window_start",...E("delivery_window_start"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_end",className:"block text-sm font-medium text-gray-700",children:"Delivery Window End"}),t.jsx("input",{type:"time",id:"delivery_window_end",...E("delivery_window_end"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]})]}),t.jsx("div",{className:"pt-4 border-t border-gray-200 mt-4",children:t.jsxs("div",{children:[t.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-gray-700",children:"Delivery Instructions"}),t.jsx("textarea",{id:"instructions",rows:3,...E("instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate codes, special access requirements, loading dock information..."})]})})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Customer"}),t.jsx("button",{type:"button",onClick:u,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},so=({isOpen:c,onClose:u,onConfirm:x,title:f,message:w,confirmText:N="Confirm",cancelText:E="Cancel",type:A="danger",loading:n=!1})=>{if(!c)return null;const z=(()=>{switch(A){case"danger":return{icon:"text-red-600",button:"bg-red-600 hover:bg-red-700 focus:ring-red-500"};case"warning":return{icon:"text-yellow-600",button:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"};default:return{icon:"text-blue-600",button:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}}})();return t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsx("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:t.jsxs("div",{className:"sm:flex sm:items-start",children:[t.jsx("div",{className:`mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full ${A==="danger"?"bg-red-100":A==="warning"?"bg-yellow-100":"bg-blue-100"} sm:mx-0 sm:h-10 sm:w-10`,children:t.jsx(Us,{className:`h-6 w-6 ${z.icon}`})}),t.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[t.jsx("h3",{className:"text-base font-semibold leading-6 text-gray-900",children:f}),t.jsx("div",{className:"mt-2",children:t.jsx("p",{className:"text-sm text-gray-500",children:w})})]})]})}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"button",onClick:x,disabled:n,className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto ${z.button} disabled:opacity-50 disabled:cursor-not-allowed`,children:n?"Processing...":N}),t.jsx("button",{type:"button",onClick:u,disabled:n,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:E})]})]})]})})},_E=()=>{const c=Qr(),[u,x]=oe.useState({page:1}),[f,w]=oe.useState(!1),[N,E]=oe.useState(null),{data:A,isLoading:n,error:P,refetch:z}=N_(u),q=yS(),U=S_(),W=_S();oe.useEffect(()=>{console.log("CustomersPage state:",{filters:u,data:A,isLoading:n,error:P,isFormOpen:f})},[u,A,n,P,f]);const X=()=>{console.log("Adding new customer"),w(!0)},Z=Ce=>{console.log("Viewing customer:",Ce),c(`/customers/${Ce.id}`)},J=async Ce=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await W(Ce.id),E(null)}catch(Ae){console.error("Error deleting customer:",Ae),alert("Failed to delete customer. Please try again.")}},de=async(Ce,Ae)=>{try{await U.mutateAsync({id:Ce.id,account_status:Ae})}catch(fe){console.error("Error updating customer status:",fe)}},ne=async Ce=>{console.log("Form submit:",Ce);try{await q.mutateAsync(Ce),w(!1)}catch(Ae){console.error("Form submit error:",Ae)}},te=async()=>{if(N){console.log("Confirming delete:",N);try{await W.mutateAsync(N.id),E(null)}catch(Ce){console.error("Delete error:",Ce)}}},Ne=Ce=>{console.log("Page change:",Ce),x(Ae=>({...Ae,page:Ce}))},he=()=>{console.log("Refreshing customers"),z()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),t.jsx("p",{className:"text-gray-600",children:"Manage your customer database"}),P&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",P.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:he,disabled:n,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${n?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:X,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Customer"})]})]})]}),t.jsx(bS,{filters:u,onFiltersChange:x}),t.jsx(vS,{customers:(A==null?void 0:A.customers)||[],loading:n,onView:Z,onDelete:J,onStatusChange:de}),A&&A.totalPages>1&&t.jsx(ac,{currentPage:A.currentPage,totalPages:A.totalPages,totalCount:A.totalCount,onPageChange:Ne}),t.jsx(ov,{isOpen:f,onClose:()=>{console.log("Closing form"),w(!1)},onSubmit:ne,customer:void 0,loading:q.isPending,title:"Add New Customer"}),t.jsx(so,{isOpen:!!N,onClose:()=>E(null),onConfirm:te,title:"Delete Customer",message:`Are you sure you want to delete "${N==null?void 0:N.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:W.isPending})]})},vE=(c,u=5)=>yt.customers.getOrderHistory.useQuery({customer_id:c,limit:u,offset:0},{enabled:!!c&&c!=="null"&&c!=="undefined",retry:1,staleTime:3e4,select:x=>x.orders}),lv=c=>yt.customers.getAddresses.useQuery({customer_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",retry:1,staleTime:3e4}),cv=()=>yt.customers.createAddress.useMutation({onSuccess:c=>{console.log("Address created successfully:",c),It.success("Address created successfully")},onError:c=>{console.error("Create address mutation error:",c),It.error(c.message||"Failed to create address")}}),bE=()=>yt.customers.updateAddress.useMutation({onSuccess:c=>{console.log("Address updated successfully:",c),It.success("Address updated successfully")},onError:c=>{console.error("Update address mutation error:",c),It.error(c.message||"Failed to update address")}}),wE=()=>yt.customers.deleteAddress.useMutation({onSuccess:(c,u)=>{console.log("Address deleted successfully:",u.address_id),It.success("Address deleted successfully")},onError:c=>{console.error("Delete address mutation error:",c),It.error(c.message||"Failed to delete address")}}),jE=()=>yt.customers.setPrimaryAddress.useMutation({onSuccess:(c,u)=>{console.log("Primary address set successfully:",u.address_id),It.success("Primary address updated successfully")},onError:c=>{console.error("Set primary address mutation error:",c),It.error(c.message||"Failed to set primary address")}}),NE=[{code:"AF",name:"Afghanistan",flag:""},{code:"AL",name:"Albania",flag:""},{code:"DZ",name:"Algeria",flag:""},{code:"AD",name:"Andorra",flag:""},{code:"AO",name:"Angola",flag:""},{code:"AG",name:"Antigua and Barbuda",flag:""},{code:"AR",name:"Argentina",flag:""},{code:"AM",name:"Armenia",flag:""},{code:"AU",name:"Australia",flag:""},{code:"AT",name:"Austria",flag:""},{code:"AZ",name:"Azerbaijan",flag:""},{code:"BS",name:"Bahamas",flag:""},{code:"BH",name:"Bahrain",flag:""},{code:"BD",name:"Bangladesh",flag:""},{code:"BB",name:"Barbados",flag:""},{code:"BY",name:"Belarus",flag:""},{code:"BE",name:"Belgium",flag:""},{code:"BZ",name:"Belize",flag:""},{code:"BJ",name:"Benin",flag:""},{code:"BT",name:"Bhutan",flag:""},{code:"BO",name:"Bolivia",flag:""},{code:"BA",name:"Bosnia and Herzegovina",flag:""},{code:"BW",name:"Botswana",flag:""},{code:"BR",name:"Brazil",flag:""},{code:"BN",name:"Brunei",flag:""},{code:"BG",name:"Bulgaria",flag:""},{code:"BF",name:"Burkina Faso",flag:""},{code:"BI",name:"Burundi",flag:""},{code:"CV",name:"Cabo Verde",flag:""},{code:"KH",name:"Cambodia",flag:""},{code:"CM",name:"Cameroon",flag:""},{code:"CA",name:"Canada",flag:""},{code:"CF",name:"Central African Republic",flag:""},{code:"TD",name:"Chad",flag:""},{code:"CL",name:"Chile",flag:""},{code:"CN",name:"China",flag:""},{code:"CO",name:"Colombia",flag:""},{code:"KM",name:"Comoros",flag:""},{code:"CG",name:"Congo",flag:""},{code:"CD",name:"Congo (Democratic Republic)",flag:""},{code:"CR",name:"Costa Rica",flag:""},{code:"CI",name:"Cte d'Ivoire",flag:""},{code:"HR",name:"Croatia",flag:""},{code:"CU",name:"Cuba",flag:""},{code:"CY",name:"Cyprus",flag:""},{code:"CZ",name:"Czech Republic",flag:""},{code:"DK",name:"Denmark",flag:""},{code:"DJ",name:"Djibouti",flag:""},{code:"DM",name:"Dominica",flag:""},{code:"DO",name:"Dominican Republic",flag:""},{code:"EC",name:"Ecuador",flag:""},{code:"EG",name:"Egypt",flag:""},{code:"SV",name:"El Salvador",flag:""},{code:"GQ",name:"Equatorial Guinea",flag:""},{code:"ER",name:"Eritrea",flag:""},{code:"EE",name:"Estonia",flag:""},{code:"SZ",name:"Eswatini",flag:""},{code:"ET",name:"Ethiopia",flag:""},{code:"FJ",name:"Fiji",flag:""},{code:"FI",name:"Finland",flag:""},{code:"FR",name:"France",flag:""},{code:"GA",name:"Gabon",flag:""},{code:"GM",name:"Gambia",flag:""},{code:"GE",name:"Georgia",flag:""},{code:"DE",name:"Germany",flag:""},{code:"GH",name:"Ghana",flag:""},{code:"GR",name:"Greece",flag:""},{code:"GD",name:"Grenada",flag:""},{code:"GT",name:"Guatemala",flag:""},{code:"GN",name:"Guinea",flag:""},{code:"GW",name:"Guinea-Bissau",flag:""},{code:"GY",name:"Guyana",flag:""},{code:"HT",name:"Haiti",flag:""},{code:"HN",name:"Honduras",flag:""},{code:"HU",name:"Hungary",flag:""},{code:"IS",name:"Iceland",flag:""},{code:"IN",name:"India",flag:""},{code:"ID",name:"Indonesia",flag:""},{code:"IR",name:"Iran",flag:""},{code:"IQ",name:"Iraq",flag:""},{code:"IE",name:"Ireland",flag:""},{code:"IL",name:"Israel",flag:""},{code:"IT",name:"Italy",flag:""},{code:"JM",name:"Jamaica",flag:""},{code:"JP",name:"Japan",flag:""},{code:"JO",name:"Jordan",flag:""},{code:"KZ",name:"Kazakhstan",flag:""},{code:"KE",name:"Kenya",flag:""},{code:"KI",name:"Kiribati",flag:""},{code:"KP",name:"Korea (North)",flag:""},{code:"KR",name:"Korea (South)",flag:""},{code:"KW",name:"Kuwait",flag:""},{code:"KG",name:"Kyrgyzstan",flag:""},{code:"LA",name:"Laos",flag:""},{code:"LV",name:"Latvia",flag:""},{code:"LB",name:"Lebanon",flag:""},{code:"LS",name:"Lesotho",flag:""},{code:"LR",name:"Liberia",flag:""},{code:"LY",name:"Libya",flag:""},{code:"LI",name:"Liechtenstein",flag:""},{code:"LT",name:"Lithuania",flag:""},{code:"LU",name:"Luxembourg",flag:""},{code:"MG",name:"Madagascar",flag:""},{code:"MW",name:"Malawi",flag:""},{code:"MY",name:"Malaysia",flag:""},{code:"MV",name:"Maldives",flag:""},{code:"ML",name:"Mali",flag:""},{code:"MT",name:"Malta",flag:""},{code:"MH",name:"Marshall Islands",flag:""},{code:"MR",name:"Mauritania",flag:""},{code:"MU",name:"Mauritius",flag:""},{code:"MX",name:"Mexico",flag:""},{code:"FM",name:"Micronesia",flag:""},{code:"MD",name:"Moldova",flag:""},{code:"MC",name:"Monaco",flag:""},{code:"MN",name:"Mongolia",flag:""},{code:"ME",name:"Montenegro",flag:""},{code:"MA",name:"Morocco",flag:""},{code:"MZ",name:"Mozambique",flag:""},{code:"MM",name:"Myanmar",flag:""},{code:"NA",name:"Namibia",flag:""},{code:"NR",name:"Nauru",flag:""},{code:"NP",name:"Nepal",flag:""},{code:"NL",name:"Netherlands",flag:""},{code:"NZ",name:"New Zealand",flag:""},{code:"NI",name:"Nicaragua",flag:""},{code:"NE",name:"Niger",flag:""},{code:"NG",name:"Nigeria",flag:""},{code:"MK",name:"North Macedonia",flag:""},{code:"NO",name:"Norway",flag:""},{code:"OM",name:"Oman",flag:""},{code:"PK",name:"Pakistan",flag:""},{code:"PW",name:"Palau",flag:""},{code:"PA",name:"Panama",flag:""},{code:"PG",name:"Papua New Guinea",flag:""},{code:"PY",name:"Paraguay",flag:""},{code:"PE",name:"Peru",flag:""},{code:"PH",name:"Philippines",flag:""},{code:"PL",name:"Poland",flag:""},{code:"PT",name:"Portugal",flag:""},{code:"QA",name:"Qatar",flag:""},{code:"RO",name:"Romania",flag:""},{code:"RU",name:"Russia",flag:""},{code:"RW",name:"Rwanda",flag:""},{code:"KN",name:"Saint Kitts and Nevis",flag:""},{code:"LC",name:"Saint Lucia",flag:""},{code:"VC",name:"Saint Vincent and the Grenadines",flag:""},{code:"WS",name:"Samoa",flag:""},{code:"SM",name:"San Marino",flag:""},{code:"ST",name:"So Tom and Prncipe",flag:""},{code:"SA",name:"Saudi Arabia",flag:""},{code:"SN",name:"Senegal",flag:""},{code:"RS",name:"Serbia",flag:""},{code:"SC",name:"Seychelles",flag:""},{code:"SL",name:"Sierra Leone",flag:""},{code:"SG",name:"Singapore",flag:""},{code:"SK",name:"Slovakia",flag:""},{code:"SI",name:"Slovenia",flag:""},{code:"SB",name:"Solomon Islands",flag:""},{code:"SO",name:"Somalia",flag:""},{code:"ZA",name:"South Africa",flag:""},{code:"SS",name:"South Sudan",flag:""},{code:"ES",name:"Spain",flag:""},{code:"LK",name:"Sri Lanka",flag:""},{code:"SD",name:"Sudan",flag:""},{code:"SR",name:"Suriname",flag:""},{code:"SE",name:"Sweden",flag:""},{code:"CH",name:"Switzerland",flag:""},{code:"SY",name:"Syria",flag:""},{code:"TJ",name:"Tajikistan",flag:""},{code:"TZ",name:"Tanzania",flag:""},{code:"TH",name:"Thailand",flag:""},{code:"TL",name:"Timor-Leste",flag:""},{code:"TG",name:"Togo",flag:""},{code:"TO",name:"Tonga",flag:""},{code:"TT",name:"Trinidad and Tobago",flag:""},{code:"TN",name:"Tunisia",flag:""},{code:"TR",name:"Turkey",flag:""},{code:"TM",name:"Turkmenistan",flag:""},{code:"TV",name:"Tuvalu",flag:""},{code:"UG",name:"Uganda",flag:""},{code:"UA",name:"Ukraine",flag:""},{code:"AE",name:"United Arab Emirates",flag:""},{code:"GB",name:"United Kingdom",flag:""},{code:"US",name:"United States",flag:""},{code:"UY",name:"Uruguay",flag:""},{code:"UZ",name:"Uzbekistan",flag:""},{code:"VU",name:"Vanuatu",flag:""},{code:"VA",name:"Vatican City",flag:""},{code:"VE",name:"Venezuela",flag:""},{code:"VN",name:"Vietnam",flag:""},{code:"YE",name:"Yemen",flag:""},{code:"ZM",name:"Zambia",flag:""},{code:"ZW",name:"Zimbabwe",flag:""}],dv=()=>NE.map(c=>({value:c.code,label:`${c.flag} ${c.name}`,name:c.name,flag:c.flag})),uv=c=>[c.line1,c.line2,c.city,c.state,c.postal_code].filter(Boolean).join(", "),SE=c=>{const u=c.label||`Address #${c.id.slice(-4)}`,x=uv(c);return`${u} - ${x}`},TE=(c,u)=>{if(!c||!u)return"";const x=f=>{const[w,N]=f.split(":"),E=parseInt(w,10),A=E>=12?"PM":"AM";return`${E===0?12:E>12?E-12:E}:${N} ${A}`};return`${x(c)} - ${x(u)}`},v0=(c,u)=>(console.warn("validateDeliveryWindow is deprecated - use backend API validation instead"),!0),EE=async c=>{try{const u=[c.line1,c.line2,c.city,c.state,c.postal_code].filter(Boolean).join(", "),f=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(u)}&limit=1`)).json();return f&&f.length>0?{latitude:parseFloat(f[0].lat),longitude:parseFloat(f[0].lon)}:null}catch(u){return console.error("Geocoding error:",u),null}},CE=({address:c,onEdit:u,onDelete:x,onSetPrimary:f})=>{const w=oe.useRef(null),[N,E]=oe.useState(null),[A,n]=oe.useState(null),P=TE(c.delivery_window_start,c.delivery_window_end);return oe.useEffect(()=>{if(!N&&w.current&&c.latitude&&c.longitude){fi.accessToken=void 0;const z=new fi.Map({container:w.current,style:"mapbox://styles/mapbox/streets-v11",center:[c.longitude,c.latitude],zoom:14,interactive:!1}),q=new fi.Marker().setLngLat([c.longitude,c.latitude]).addTo(z);E(z),n(q),z.on("load",()=>{z.resize()})}},[w,c.latitude,c.longitude]),oe.useEffect(()=>()=>{A&&A.remove(),N&&N.remove()},[]),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Tn,{className:"h-4 w-4 text-gray-400 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900",children:c.label||`Address #${c.id.slice(-4)}`}),c.is_primary&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx(Wh,{className:"h-3 w-3 mr-1"}),"Primary"]})]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[c.latitude&&c.longitude&&t.jsx("div",{className:"p-1 text-green-600",title:"Geocoded",children:t.jsx(v_,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>u(c),className:"p-1 text-gray-400 hover:text-blue-600 rounded hover:bg-blue-50 transition-colors",title:"Edit address",children:t.jsx(di,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>x(c),className:"p-1 text-gray-400 hover:text-red-600 rounded hover:bg-red-50 transition-colors",title:"Delete address",children:t.jsx(to,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-gray-900",children:uv(c)}),P&&t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(Qi,{className:"h-4 w-4"}),t.jsxs("span",{children:["Delivery: ",P]})]}),c.instructions&&t.jsxs("div",{className:"flex items-start space-x-2 text-sm text-gray-600",children:[t.jsx(y_,{className:"h-4 w-4 mt-0.5"}),t.jsx("p",{className:"line-clamp-2",children:c.instructions})]}),c.latitude&&c.longitude&&t.jsx("div",{className:"mt-3 h-32 rounded-md overflow-hidden border border-gray-200",children:t.jsx("div",{ref:w,className:"w-full h-full"})}),!c.is_primary&&t.jsx("button",{onClick:()=>f(c),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Set as Primary"})]})]})},hv=({isOpen:c,onClose:u,onSubmit:x,address:f,customerId:w,loading:N=!1,title:E,isFirstAddress:A=!1})=>{const[n,P]=oe.useState(!1),[z,q]=oe.useState(!1),{register:U,handleSubmit:W,reset:X,watch:Z,setValue:J,formState:{errors:de}}=Cn({defaultValues:{customer_id:w,label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:A,instructions:""}}),ne=Z(["line1","city","state","postal_code"]),te=Z("delivery_window_start"),Ne=Z("delivery_window_end");oe.useEffect(()=>{f?(X({customer_id:f.customer_id,label:f.label||"",line1:f.line1,line2:f.line2||"",city:f.city,state:f.state||"",postal_code:f.postal_code||"",country:f.country,delivery_window_start:f.delivery_window_start||"",delivery_window_end:f.delivery_window_end||"",is_primary:f.is_primary,instructions:f.instructions||"",latitude:f.latitude,longitude:f.longitude}),q(!!(f.latitude&&f.longitude))):(X({customer_id:w,label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:A,instructions:""}),q(!1))},[f,w,A,X]);const he=async()=>{const[fe,Ie,Ee,tt]=ne;if(!(!fe||!Ie)){P(!0);try{const je=await EE({line1:fe,city:Ie,state:Ee,postal_code:tt});je&&(J("latitude",je.latitude),J("longitude",je.longitude),q(!0))}catch(je){console.error("Geocoding failed:",je)}finally{P(!1)}}},Ce=fe=>{fe.delivery_window_start&&fe.delivery_window_end&&v0(fe.delivery_window_start,fe.delivery_window_end),fe.delivery_window_start&&!fe.delivery_window_end&&(fe.delivery_window_end=void 0),fe.delivery_window_end&&!fe.delivery_window_start&&(fe.delivery_window_start=void 0),x(fe)},Ae=dv();return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:W(Ce),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:E}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Address Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"label",className:"block text-sm font-medium text-gray-700",children:"Address Label"}),t.jsx("input",{type:"text",id:"label",...U("label"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Main Location, Loading Dock, etc."})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"line1",className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),t.jsx("input",{type:"text",id:"line1",...U("line1",{required:"Address line 1 is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),de.line1&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:de.line1.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"line2",className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),t.jsx("input",{type:"text",id:"line2",...U("line2"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Apartment, suite, unit, etc."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700",children:"City *"}),t.jsx("input",{type:"text",id:"city",...U("city",{required:"City is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),de.city&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:de.city.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700",children:"State/Province"}),t.jsx("input",{type:"text",id:"state",...U("state"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postal_code",className:"block text-sm font-medium text-gray-700",children:"Postal Code"}),t.jsx("input",{type:"text",id:"postal_code",...U("postal_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700",children:"Country"}),t.jsx("select",{id:"country",...U("country"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:Ae.map(fe=>t.jsx("option",{value:fe.value,children:fe.label},fe.value))})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Geocoding"}),t.jsxs("button",{type:"button",onClick:he,disabled:n||!ne[0]||!ne[1],className:"flex items-center space-x-2 text-sm text-blue-600 hover:text-blue-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:[n?t.jsx(tr,{className:"h-4 w-4 animate-spin"}):z?t.jsx(v_,{className:"h-4 w-4 text-green-600"}):t.jsx(Tn,{className:"h-4 w-4"}),t.jsx("span",{children:n?"Geocoding...":z?"Geocoded":"Geocode Address"})]})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Geocoding helps with delivery route optimization"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Delivery Preferences"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_start",className:"block text-sm font-medium text-gray-700",children:"Delivery Window Start"}),t.jsx("input",{type:"time",id:"delivery_window_start",...U("delivery_window_start"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_end",className:"block text-sm font-medium text-gray-700",children:"Delivery Window End"}),t.jsx("input",{type:"time",id:"delivery_window_end",...U("delivery_window_end"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),te&&Ne&&!v0()&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:"End time must be after start time"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"is_primary",...U("is_primary"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"is_primary",className:"ml-2 block text-sm text-gray-900",children:"Set as primary address"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Primary address will be used as the default for orders"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Access & Security"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"access_code",className:"block text-sm font-medium text-gray-700",children:"Access Code"}),t.jsx("input",{type:"text",id:"access_code",...U("access_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Building access code"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"gate_code",className:"block text-sm font-medium text-gray-700",children:"Gate Code"}),t.jsx("input",{type:"text",id:"gate_code",...U("gate_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate or entrance code"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"building_type",className:"block text-sm font-medium text-gray-700",children:"Building Type"}),t.jsxs("select",{id:"building_type",...U("building_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select type..."}),t.jsx("option",{value:"residential",children:"Residential"}),t.jsx("option",{value:"commercial",children:"Commercial"}),t.jsx("option",{value:"industrial",children:"Industrial"}),t.jsx("option",{value:"other",children:"Other"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"preferred_delivery_time",className:"block text-sm font-medium text-gray-700",children:"Preferred Time"}),t.jsx("input",{type:"time",id:"preferred_delivery_time",...U("preferred_delivery_time"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Preferred time within delivery window"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"security_requirements",className:"block text-sm font-medium text-gray-700",children:"Security Requirements"}),t.jsx("textarea",{id:"security_requirements",rows:2,...U("security_requirements"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Security checkpoints, ID requirements, visitor procedures..."})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"On-Site Contact"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"contact_person",className:"block text-sm font-medium text-gray-700",children:"Contact Person"}),t.jsx("input",{type:"text",id:"contact_person",...U("contact_person"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"On-site contact name"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"contact_phone",className:"block text-sm font-medium text-gray-700",children:"Contact Phone"}),t.jsx("input",{type:"tel",id:"contact_phone",...U("contact_phone"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Phone number for delivery"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Logistics & Access"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"parking_instructions",className:"block text-sm font-medium text-gray-700",children:"Parking Instructions"}),t.jsx("textarea",{id:"parking_instructions",rows:2,...U("parking_instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Where to park, parking restrictions, loading zones..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"loading_dock_info",className:"block text-sm font-medium text-gray-700",children:"Loading Dock Information"}),t.jsx("textarea",{id:"loading_dock_info",rows:2,...U("loading_dock_info"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Loading dock location, height restrictions, equipment availability..."})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Delivery Instructions"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_notes",className:"block text-sm font-medium text-gray-700",children:"Delivery Notes"}),t.jsx("textarea",{id:"delivery_notes",rows:3,...U("delivery_notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Specific delivery instructions, handling requirements..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"special_instructions",className:"block text-sm font-medium text-gray-700",children:"Special Instructions"}),t.jsx("textarea",{id:"special_instructions",rows:3,...U("special_instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Special handling, fragile items, temperature requirements..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-gray-700",children:"General Instructions"}),t.jsx("textarea",{id:"instructions",rows:2,...U("instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"General delivery notes and instructions..."})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Address"}),t.jsx("button",{type:"button",onClick:u,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},kE=({customerId:c})=>{const[u,x]=oe.useState(!1),[f,w]=oe.useState(null),[N,E]=oe.useState(null),{data:A=[],isLoading:n}=lv(c),P=cv(),z=bE(),q=wE(),U=jE(),W=()=>{w(null),x(!0)},X=te=>{w(te),x(!0)},Z=te=>{E(te)},J=async te=>{if(!te.is_primary)try{await U.mutateAsync(te)}catch{}},de=async te=>{try{f?await z.mutateAsync({id:f.id,...te}):await P.mutateAsync(te),x(!1),w(null)}catch{}},ne=async()=>{if(N)try{await q.mutateAsync(N),E(null)}catch{}};return n?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-20 bg-gray-200 rounded"}),t.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Tn,{className:"h-5 w-5 text-gray-400"}),t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Delivery Addresses (",A.length,")"]})]}),t.jsxs("button",{onClick:W,className:"flex items-center space-x-2 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Address"})]})]}),A.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Tn,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"No delivery addresses added yet"}),t.jsx("button",{onClick:W,className:"text-blue-600 hover:text-blue-800 font-medium",children:"Add the first address"})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:A.map(te=>t.jsx(CE,{address:te,onEdit:X,onDelete:Z,onSetPrimary:J},te.id))}),t.jsx(hv,{isOpen:u,onClose:()=>{x(!1),w(null)},onSubmit:de,address:f||void 0,customerId:c,loading:P.isPending||z.isPending,title:f?"Edit Address":"Add New Address",isFirstAddress:A.length===0}),t.jsx(so,{isOpen:!!N,onClose:()=>E(null),onConfirm:ne,title:"Delete Address",message:`Are you sure you want to delete this address? ${N!=null&&N.is_primary?"This is the primary address for this customer.":""}`,confirmText:"Delete",type:"danger",loading:q.isPending})]})};let nf=null;const AE=async()=>{if(nf)return nf;try{const c=await yt.orders.getWorkflow.query();return nf=c,c}catch(c){throw console.error("Failed to fetch workflow from backend:",c),new Error("Order workflow fetch failed. Please try again.")}},ic=async c=>{const u=await AE();return u.find(x=>x.status===c)||u[0]},mv=async(c,u=0)=>{try{return await yt.orders.calculateTotals.mutate({lines:c,tax_percent:u})}catch(x){throw console.error("Failed to calculate totals via API:",x),new Error("Order total calculation failed. Please try again.")}},ME=async c=>{try{return(await yt.orders.formatDate.mutate({date:c})).formatted_date}catch(u){throw console.error("Failed to format date via API:",u),new Error("Date formatting failed. Please try again.")}},af=async c=>(await ic(c)).allowedTransitions,PE=async c=>{try{return await yt.orders.validateForConfirmation.mutate({order:c})}catch(u){throw console.error("Failed to validate order for confirmation via API:",u),new Error("Order confirmation validation failed. Please try again.")}},IE=({orders:c,loading:u})=>{const x=Qr();return u?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"})]})]})}):c.length?t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Orders"}),t.jsx("div",{className:"space-y-4",children:c.map(f=>{var w;return t.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>x(`/orders/${f.id}`),children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:["Order #",f.id]}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[t.jsx($s,{className:"h-4 w-4"}),t.jsx("span",{children:ME(f.order_date)})]})]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${f.status==="completed"?"bg-green-100 text-green-800":f.status==="cancelled"?"bg-red-100 text-red-800":f.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:f.status.charAt(0).toUpperCase()+f.status.slice(1)})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(hs,{className:"h-4 w-4"}),t.jsxs("span",{children:[((w=f.order_lines)==null?void 0:w.length)||0," items"]})]}),f.total_amount!==void 0&&t.jsxs("p",{className:"text-sm font-medium text-gray-900 mt-1",children:["Total: $",f.total_amount.toFixed(2)]})]})]},f.id)})})]}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Orders"}),t.jsx("p",{className:"text-gray-500 text-center py-4",children:"No orders found"})]})},xm=({status:c,className:u="",children:x})=>{const f=()=>{switch(c){case"active":return"bg-green-100 text-green-800 border-green-200";case"credit_hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"closed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},w=()=>{if(x)return x;switch(c){case"active":return"Active";case"credit_hold":return"Credit Hold";case"closed":return"Closed";default:return c}};return t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${f()} ${u}`,children:w()})},DE=()=>{const{id:c}=nc(),u=Qr(),[x,f]=oe.useState(!1),{data:w,isLoading:N,error:E}=xS(c),A=S_(),{data:n,isLoading:P}=vE((w==null?void 0:w.id)||"",5),z=async U=>{if(w)try{await A.mutateAsync({id:w.id,...U}),f(!1)}catch{}},q=U=>new Date(U).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return N?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]}):E||!w?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Customer not found or error loading customer details."})})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>u("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:w.name})]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(di,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Customer"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Business Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(f_,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:w.name})]})]}),w.external_id&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"External ID"}),t.jsx("span",{className:"text-gray-900",children:w.external_id})]}),w.tax_id&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Tax ID (VAT/EIN)"}),t.jsx("span",{className:"text-gray-900",children:w.tax_id})]}),w.email&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Email"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(eS,{className:"h-4 w-4 text-gray-400"}),t.jsx("a",{href:`mailto:${w.email}`,className:"text-blue-600 hover:text-blue-800",children:w.email})]})]}),w.phone&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Phone"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(iS,{className:"h-4 w-4 text-gray-400"}),t.jsx("a",{href:`tel:${w.phone}`,className:"text-blue-600 hover:text-blue-800",children:w.phone})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Account Status"}),t.jsx(xm,{status:w.account_status})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Credit Terms"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(HN,{className:"h-4 w-4 text-gray-400"}),t.jsxs("span",{className:"text-gray-900",children:[w.credit_terms_days," days"]})]})]})]})]})}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(w.created_at)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Last Updated"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(w.updated_at)})]})]})]})]})})]}),t.jsx(kE,{customerId:w.id}),t.jsx(IE,{orders:n||[],loading:P}),t.jsx(ov,{isOpen:x,onClose:()=>f(!1),onSubmit:z,customer:w,loading:A.isPending,title:"Edit Customer"})]})},cc=(c={})=>yt.products.list.useQuery({search:c.search,status:c.status,unit_of_measure:c.unit_of_measure,page:c.page||1,limit:c.limit||50,sort_by:c.sort_by||"created_at",sort_order:c.sort_order||"desc",show_obsolete:c.show_obsolete||!1},{retry:1,staleTime:3e4}),LE=c=>yt.products.getById.useQuery({id:c},{enabled:!!c}),RE=()=>yt.products.getStats.useQuery(void 0,{staleTime:6e4}),zE=()=>yt.products.create.useMutation({onSuccess:c=>{console.log("Product created successfully:",c),It.success("Product created successfully")},onError:c=>{console.error("Create product mutation error:",c),It.error(c.message||"Failed to create product")}}),pv=()=>yt.products.update.useMutation({onSuccess:c=>{console.log("Product updated successfully:",c),It.success("Product updated successfully")},onError:c=>{console.error("Update product mutation error:",c),It.error(c.message||"Failed to update product")}}),OE=()=>yt.products.delete.useMutation({onSuccess:(c,u)=>{console.log("Product deleted successfully:",u.id),It.success("Product status set to obsolete")},onError:c=>{console.error("Delete product mutation error:",c),It.error(c.message||"Failed to delete product")}}),FE=()=>yt.products.bulkUpdateStatus.useMutation({onSuccess:c=>{console.log("Bulk product status update successful:",c),It.success(`Updated ${c.updated_count} products successfully`)},onError:c=>{console.error("Bulk update status mutation error:",c),It.error(c.message||"Failed to update product status")}}),BE=()=>yt.products.reactivate.useMutation({onSuccess:c=>{console.log("Product reactivated successfully:",c),It.success("Product reactivated successfully")},onError:c=>{console.error("Reactivate product mutation error:",c),It.error(c.message||"Failed to reactivate product")}}),UE=({products:c,loading:u=!1,onView:x,onEdit:f,onDelete:w,selectedProducts:N=[],onSelectionChange:E})=>{const[A,n]=oe.useState(!1),P=BE(),z=J=>new Date(J).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),q=J=>J==="cylinder"?Uf:qf,U=J=>{switch(J){case"active":return"active";case"end_of_sale":return"credit_hold";case"obsolete":return"closed";default:return"active"}},W=J=>{n(J),E&&E(J?c.map(de=>de.id):[])},X=(J,de)=>{if(E){const ne=de?[...N,J]:N.filter(te=>te!==J);E(ne),n(ne.length===c.length)}},Z=async J=>{try{await P.mutateAsync(J.id)}catch{}};return console.log("ProductTable render:",{products:c,loading:u}),u?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading products..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load products. Please check your connection.":"Get started by adding your first product."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Products (",c.length,")"]}),N.length>0&&t.jsxs("span",{className:"text-sm text-blue-600",children:[N.length," selected"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[E&&t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:A,onChange:J=>W(J.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type & Specs"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(J=>{const de=q(J.unit_of_measure),ne=J.status==="obsolete";return t.jsxs("tr",{className:`hover:bg-gray-50 ${ne?"opacity-60":""}`,children:[E&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",checked:N.includes(J.id),onChange:te=>X(J.id,te.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[J.name,ne&&t.jsx("span",{className:"ml-2 text-xs text-red-600",children:"(Obsolete)"})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",J.sku]}),J.description&&t.jsx("div",{className:"text-xs text-gray-400 mt-1 max-w-xs truncate",children:J.description})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(de,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsx("div",{className:"capitalize",children:J.unit_of_measure}),J.unit_of_measure==="cylinder"&&t.jsxs("div",{className:"text-xs text-gray-500",children:[J.capacity_kg&&`${J.capacity_kg} kg capacity`,J.tare_weight_kg&&`  ${J.tare_weight_kg} kg tare`]}),J.valve_type&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Valve: ",J.valve_type]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(xm,{status:U(J.status),className:"capitalize",children:J.status.replace("_"," ")})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:z(J.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>x(J),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View product",children:t.jsx(om,{className:"h-4 w-4"})}),!ne&&t.jsx("button",{onClick:()=>f(J),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit product",children:t.jsx(di,{className:"h-4 w-4"})}),ne?t.jsx("button",{onClick:()=>Z(J),disabled:P.isPending,className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors disabled:opacity-50",title:"Reactivate product",children:t.jsx(Ya,{className:"h-4 w-4"})}):t.jsx("button",{onClick:()=>w(J),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Mark as obsolete",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},J.id)})})]})})]})},VE=({filters:c,onFiltersChange:u})=>{const x=n=>{u({...c,search:n.target.value||void 0,page:1})},f=n=>{u({...c,status:n.target.value||void 0,page:1})},w=n=>{u({...c,unit_of_measure:n.target.value||void 0,page:1})},N=n=>{const[P,z]=n.target.value.split(":");u({...c,sort_by:P||"created_at",sort_order:z||"desc",page:1})},E=()=>{u({...c,show_obsolete:!c.show_obsolete,page:1})},A=()=>{u({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by SKU, name, or description...",value:c.search||"",onChange:x,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]})}),t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(hs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.unit_of_measure||"",onChange:w,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"cylinder",children:"Cylinders"}),t.jsx("option",{value:"kg",children:"By Weight (kg)"})]})]})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("select",{value:`${c.sort_by||"created_at"}:${c.sort_order||"desc"}`,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"created_at:desc",children:"Newest First"}),t.jsx("option",{value:"created_at:asc",children:"Oldest First"}),t.jsx("option",{value:"name:asc",children:"Name A-Z"}),t.jsx("option",{value:"name:desc",children:"Name Z-A"}),t.jsx("option",{value:"sku:asc",children:"SKU A-Z"}),t.jsx("option",{value:"sku:desc",children:"SKU Z-A"}),t.jsx("option",{value:"capacity_kg:desc",children:"Capacity High-Low"}),t.jsx("option",{value:"capacity_kg:asc",children:"Capacity Low-High"})]})}),t.jsxs("button",{onClick:E,className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${c.show_obsolete?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,title:c.show_obsolete?"Hide obsolete products":"Show obsolete products",children:[c.show_obsolete?t.jsx(XN,{className:"h-4 w-4"}):t.jsx(om,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:c.show_obsolete?"Hide Obsolete":"Show Obsolete"})]}),t.jsxs("button",{onClick:A,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},fv=({isOpen:c,onClose:u,onSubmit:x,product:f,loading:w=!1,title:N})=>{const[E,A]=oe.useState(!1),{register:n,handleSubmit:P,reset:z,watch:q,formState:{errors:U}}=Cn({defaultValues:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:void 0,tare_weight_kg:void 0,valve_type:"",status:"active",barcode_uid:""}}),W=q("unit_of_measure"),X=q("status");oe.useEffect(()=>{z(f?{sku:f.sku,name:f.name,description:f.description||"",unit_of_measure:f.unit_of_measure,capacity_kg:f.capacity_kg,tare_weight_kg:f.tare_weight_kg,valve_type:f.valve_type||"",status:f.status,barcode_uid:f.barcode_uid||""}:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:void 0,tare_weight_kg:void 0,valve_type:"",status:"active",barcode_uid:""})},[f,z]),oe.useEffect(()=>{A(X==="obsolete")},[X]);const Z=async de=>{try{const ne=await yt.products.validateSku.mutate({sku:de.sku,exclude_id:f==null?void 0:f.id});if(!ne.valid)return console.error("SKU validation failed:",ne.errors),!1;ne.warnings.length>0&&console.warn("SKU warnings:",ne.warnings)}catch(ne){return console.error("SKU validation error:",ne),!1}if(de.unit_of_measure==="cylinder"&&(de.capacity_kg||de.tare_weight_kg))try{const ne=await yt.products.validateWeight.mutate({capacity_kg:de.capacity_kg,tare_weight_kg:de.tare_weight_kg,unit_of_measure:de.unit_of_measure});if(!ne.valid)return console.error("Weight validation failed:",ne.errors),!1;ne.warnings.length>0&&console.warn("Weight warnings:",ne.warnings)}catch(ne){return console.error("Weight validation error:",ne),!1}return!0},J=async de=>{try{if(!await Z(de))return;const te={...de};de.unit_of_measure!=="cylinder"&&(te.capacity_kg=void 0,te.tare_weight_kg=void 0,te.valve_type=void 0),Object.keys(te).forEach(Ne=>{te[Ne]===""&&(te[Ne]=void 0)}),x(te)}catch(ne){console.error("Form validation error:",ne)}};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:P(J),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU *"}),t.jsx("input",{type:"text",id:"sku",...n("sku",{required:"SKU is required",pattern:{value:/^[A-Z0-9-]+$/,message:"SKU must contain only uppercase letters, numbers, and hyphens"},minLength:{value:3,message:"SKU must be at least 3 characters long"},maxLength:{value:50,message:"SKU must be 50 characters or less"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 uppercase",placeholder:"CYL-50KG-S"}),U.sku&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.sku.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",...n("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),t.jsx("input",{type:"text",id:"name",...n("name",{required:"Product name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"LPG Cylinder 50kg"}),U.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.name.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...n("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Detailed product description..."})]})]}),E&&t.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:'Warning: Setting status to "Obsolete" will make this product unavailable for future orders.'})]})})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Physical Properties"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_of_measure",className:"block text-sm font-medium text-gray-700",children:"Unit of Measure"}),t.jsxs("select",{id:"unit_of_measure",...n("unit_of_measure"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"kg",children:"By Weight (kg)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"barcode_uid",className:"block text-sm font-medium text-gray-700",children:"Barcode/RFID UID"}),t.jsx("input",{type:"text",id:"barcode_uid",...n("barcode_uid"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional unique identifier"})]}),W==="cylinder"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_kg",className:"block text-sm font-medium text-gray-700",children:"Capacity (kg)"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"500",id:"capacity_kg",...n("capacity_kg",{valueAsNumber:!0,min:{value:.1,message:"Capacity must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"50.0"}),U.capacity_kg&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.capacity_kg.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tare_weight_kg",className:"block text-sm font-medium text-gray-700",children:"Tare Weight (kg)"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"500",id:"tare_weight_kg",...n("tare_weight_kg",{valueAsNumber:!0,min:{value:.1,message:"Tare weight must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"15.0"}),U.tare_weight_kg&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.tare_weight_kg.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"valve_type",className:"block text-sm font-medium text-gray-700",children:"Valve Type"}),t.jsx("input",{type:"text",id:"valve_type",...n("valve_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Standard valve specifications"})]})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Product"}),t.jsx("button",{type:"button",onClick:u,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},b0=async(c,u)=>{try{return(await yt.products.generateVariantSku.mutate({parent_sku:c,variant_name:u})).variant_sku}catch(x){throw console.error("Failed to generate variant SKU via API:",x),new Error("Variant SKU generation failed. Please try again.")}},w0=[{name:"Loading...",description:"Please use getStandardCylinderVariants() API"}],qE=c=>({delivery:"Delivery",refill:"Refill",exchange:"Exchange",pickup:"Pickup"})[c]||c,$E=c=>({standard:"Standard",express:"Express",emergency:"Emergency",scheduled:"Scheduled"})[c]||c,of=async c=>{try{return(await yt.products.shouldRequirePickup.mutate({order_type:c})).requires_pickup}catch(u){throw console.error("Failed to check pickup requirement via API:",u),new Error("Pickup requirement check failed. Please try again.")}},GE=({isOpen:c,onClose:u,onSubmit:x,product:f,loading:w=!1,title:N})=>{const[E,A]=oe.useState(!1),[n,P]=oe.useState([]),{register:z,handleSubmit:q,reset:U,watch:W,setValue:X,formState:{errors:Z}}=Cn({defaultValues:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:0,tare_weight_kg:0,valve_type:"",status:"active",barcode_uid:"",requires_tag:!1,variant_type:"cylinder",parent_product_id:void 0,variant_name:void 0,is_variant:!1}}),J=W("variant_type"),de=W("sku");oe.useEffect(()=>{f&&U({sku:f.sku,name:f.name,description:f.description||"",unit_of_measure:f.unit_of_measure,capacity_kg:f.capacity_kg||0,tare_weight_kg:f.tare_weight_kg||0,valve_type:f.valve_type||"",status:f.status,barcode_uid:f.barcode_uid||"",requires_tag:f.requires_tag,variant_type:f.variant_type,parent_product_id:f.parent_product_id,variant_name:f.variant_name,is_variant:f.is_variant})},[f,U]),oe.useEffect(()=>{J==="cylinder"&&n.length===0&&E&&P(w0.map(Ae=>({name:Ae.name,description:Ae.description,status:"active"})))},[J,E,n.length]);const ne=()=>{P([...n,{name:"",description:"",status:"active"}])},te=Ae=>{P(n.filter((fe,Ie)=>Ie!==Ae))},Ne=(Ae,fe,Ie)=>{const Ee=[...n];Ee[Ae]={...Ee[Ae],[fe]:Ie},P(Ee)},he=Ae=>{const fe={...Ae,is_variant:!1,parent_product_id:void 0,variant_name:void 0};let Ie;E&&n.length>0&&(Ie=n.map(Ee=>({parent_product_id:"",variant_name:Ee.name,sku:b0(Ae.sku,Ee.name),name:`${Ae.name} (${Ee.name})`,description:Ee.description||`${Ee.name} variant of ${Ae.name}`,status:Ee.status,barcode_uid:void 0}))),x(fe,Ie)},Ce=()=>{P(w0.map(Ae=>({name:Ae.name,description:Ae.description,status:"active"})))};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:t.jsxs("form",{onSubmit:q(he),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h4",{className:"text-md font-semibold text-gray-900 flex items-center space-x-2",children:[t.jsx(hs,{className:"h-5 w-5"}),t.jsx("span",{children:"Product Information"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU *"}),t.jsx("input",{type:"text",id:"sku",...z("sku",{required:"SKU is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., PROGAS-13KG"}),Z.sku&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:Z.sku.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),t.jsx("input",{type:"text",id:"name",...z("name",{required:"Product name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., ProGas 13kg Cylinder"}),Z.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:Z.name.message})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...z("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Product description..."})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"variant_type",className:"block text-sm font-medium text-gray-700",children:"Variant Type *"}),t.jsxs("select",{id:"variant_type",...z("variant_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"refillable",children:"Refillable"}),t.jsx("option",{value:"disposable",children:"Disposable"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_of_measure",className:"block text-sm font-medium text-gray-700",children:"Unit of Measure"}),t.jsxs("select",{id:"unit_of_measure",...z("unit_of_measure"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"kg",children:"Kilogram"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_kg",className:"block text-sm font-medium text-gray-700",children:"Capacity (kg)"}),t.jsx("input",{type:"number",step:"0.1",id:"capacity_kg",...z("capacity_kg",{min:0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tare_weight_kg",className:"block text-sm font-medium text-gray-700",children:"Tare Weight (kg)"}),t.jsx("input",{type:"number",step:"0.1",id:"tare_weight_kg",...z("tare_weight_kg",{min:0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"valve_type",className:"block text-sm font-medium text-gray-700",children:"Valve Type"}),t.jsx("input",{type:"text",id:"valve_type",...z("valve_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., POL, ACME"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",...z("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]})]}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"requires_tag",...z("requires_tag"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"requires_tag",className:"ml-2 block text-sm text-gray-700",children:"Requires Tag"})]})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"text-md font-semibold text-gray-900 flex items-center space-x-2",children:[t.jsx(oS,{className:"h-5 w-5"}),t.jsx("span",{children:"Product Variants"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"create_variants",checked:E,onChange:Ae=>A(Ae.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"create_variants",className:"block text-sm text-gray-700",children:"Create Variants"})]})]}),E&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(tu,{className:"h-5 w-5 text-blue-600 mt-0.5"}),t.jsx("div",{children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Product Variants:"})," Create different variants of this product (e.g., full vs empty cylinders). Each variant will have its own SKU and inventory tracking."]})})]})}),J==="cylinder"&&n.length===0&&t.jsx("div",{className:"text-center py-4",children:t.jsxs("button",{type:"button",onClick:Ce,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Standard Cylinder Variants"})]})}),n.map((Ae,fe)=>t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h5",{className:"text-sm font-medium text-gray-900",children:["Variant ",fe+1]}),t.jsx("button",{type:"button",onClick:()=>te(fe),className:"text-red-600 hover:text-red-800",children:t.jsx(to,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Variant Name *"}),t.jsx("input",{type:"text",value:Ae.name,onChange:Ie=>Ne(fe,"name",Ie.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., full, empty"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("input",{type:"text",value:Ae.description||"",onChange:Ie=>Ne(fe,"description",Ie.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Variant description"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("strong",{children:"Generated SKU:"})," ",de?b0(de,Ae.name):"Enter parent SKU first"]})]})]},fe)),t.jsxs("button",{type:"button",onClick:ne,className:"w-full flex items-center justify-center space-x-2 border border-gray-300 rounded-lg px-4 py-3 text-gray-600 hover:bg-gray-50 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Another Variant"})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Creating...":"Create Product"}),t.jsx("button",{type:"button",onClick:u,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},ZE=()=>{const{data:c,isLoading:u}=RE();if(u)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const x=[{name:"Total Products",value:c.total,icon:hs,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Active",value:c.active,icon:Gn,color:"text-green-600",bgColor:"bg-green-50"},{name:"End of Sale",value:c.end_of_sale,icon:Us,color:"text-yellow-600",bgColor:"bg-yellow-50"},{name:"Obsolete",value:c.obsolete,icon:pa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Cylinders",value:c.cylinders,icon:Uf,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"By Weight",value:c.kg_products,icon:qf,color:"text-indigo-600",bgColor:"bg-indigo-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:x.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]})},WE=({selectedProducts:c,onClearSelection:u})=>{const[x,f]=oe.useState(!1),w=FE(),N=async A=>{try{await w.mutateAsync({productIds:c,status:A}),u(),f(!1)}catch{}},E=()=>{console.log("Exporting products:",c),f(!1)};return c.length===0?null:t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[c.length," product",c.length>1?"s":""," selected"]}),t.jsx("button",{onClick:u,className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear selection"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>f(!x),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(rS,{className:"h-4 w-4"}),t.jsx("span",{children:"Bulk Actions"}),t.jsx(am,{className:"h-4 w-4"})]}),x&&t.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-10",children:t.jsxs("div",{className:"py-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Change Status"}),t.jsx("button",{onClick:()=>N("active"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as Active"}),t.jsx("button",{onClick:()=>N("end_of_sale"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as End of Sale"}),t.jsx("button",{onClick:()=>N("obsolete"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as Obsolete"}),t.jsx("div",{className:"border-t border-gray-100 mt-1",children:t.jsxs("button",{onClick:E,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Vf,{className:"h-4 w-4"}),t.jsx("span",{children:"Export Selected"})]})})]})})]})]})})},HE=()=>{const c=Qr(),[u,x]=oe.useState({page:1}),[f,w]=oe.useState(!1),[N,E]=oe.useState(!1),[A,n]=oe.useState(null),[P,z]=oe.useState(null),[q,U]=oe.useState([]),{data:W,isLoading:X,error:Z,refetch:J}=cc(u),de=zE(),ne=pv(),te=OE();oe.useEffect(()=>{console.log("ProductsPage state:",{filters:u,data:W,isLoading:X,error:Z,isFormOpen:f,editingProduct:A,selectedProducts:q})},[u,W,X,Z,f,A,q]);const Ne=()=>{console.log("Adding new product"),n(null),w(!0)},he=()=>{console.log("Adding product with variants"),E(!0)},Ce=Mt=>{console.log("Editing product:",Mt),n(Mt),w(!0)},Ae=Mt=>{console.log("Viewing product:",Mt),c(`/products/${Mt.id}`)},fe=Mt=>{console.log("Marking product as obsolete:",Mt),z(Mt)},Ie=async Mt=>{console.log("Form submit:",Mt);try{A?await ne.mutateAsync({id:A.id,...Mt}):await de.mutateAsync(Mt),w(!1),n(null)}catch(ht){console.error("Form submit error:",ht)}},Ee=async(Mt,ht)=>{console.log("Variant form submit:",Mt,ht);try{const Os=await de.mutateAsync(Mt);if(ht&&ht.length>0)for(const ns of ht){const _s={...ns,parent_product_id:Os.id};await de.mutateAsync(_s)}E(!1),J()}catch(Os){console.error("Variant form submit error:",Os)}},tt=async()=>{if(P){console.log("Confirming mark as obsolete:",P);try{await te.mutateAsync(P.id),z(null)}catch(Mt){console.error("Mark obsolete error:",Mt)}}},je=Mt=>{console.log("Page change:",Mt),x(ht=>({...ht,page:Mt}))},Pe=()=>{console.log("Refreshing products"),J()},it=Mt=>{U(Mt)},ct=()=>{U([])},ft=P?P.status==="obsolete"?{title:"Product Already Obsolete",message:`"${P.name}" is already marked as obsolete and hidden from active lists.`}:{title:"Mark Product as Obsolete",message:`Are you sure you want to mark "${P.name}" as obsolete? This will hide it from active product lists but preserve all historical data including price lists, inventory records, and order history. The product can be reactivated later if needed.`}:{title:"",message:""};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Products"}),t.jsx("p",{className:"text-gray-600",children:"Manage your LPG product catalog"}),Z&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",Z.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Pe,disabled:X,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${X?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:he,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(b_,{className:"h-4 w-4"}),t.jsx("span",{children:"Create with Variants"})]}),t.jsxs("button",{onClick:Ne,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]})]}),t.jsx(ZE,{}),t.jsx(VE,{filters:u,onFiltersChange:x}),t.jsx(WE,{selectedProducts:q,onClearSelection:ct}),t.jsx(UE,{products:(W==null?void 0:W.products)||[],loading:X,onView:Ae,onEdit:Ce,onDelete:fe,selectedProducts:q,onSelectionChange:it}),W&&W.totalPages>1&&t.jsx(ac,{currentPage:W.currentPage,totalPages:W.totalPages,totalCount:W.totalCount,onPageChange:je}),t.jsx(fv,{isOpen:f,onClose:()=>{console.log("Closing form"),w(!1),n(null)},onSubmit:Ie,product:A||void 0,loading:de.isPending||ne.isPending,title:A?"Edit Product":"Add New Product"}),t.jsx(GE,{isOpen:N,onClose:()=>E(!1),onSubmit:Ee,loading:de.isPending,title:"Create Product with Variants"}),t.jsx(so,{isOpen:!!P,onClose:()=>z(null),onConfirm:tt,title:ft.title,message:ft.message,confirmText:(P==null?void 0:P.status)==="obsolete"?"OK":"Mark as Obsolete",type:(P==null?void 0:P.status)==="obsolete"?"info":"warning",loading:te.isPending})]})},Jf=(c={})=>yt.pricing.listPriceLists.useQuery({search:c.search,currency:c.currency,status:c.status,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:u=>{console.error("Price lists fetch error:",u),It.error("Failed to load price lists")}}),XE=c=>yt.pricing.getPriceList.useQuery({price_list_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:u=>{console.error("Price list fetch error:",u),It.error("Failed to load price list details")}}),KE=()=>{const c=yt.useContext();return yt.pricing.createPriceList.useMutation({onSuccess:u=>{console.log("Price list created successfully:",u),c.pricing.listPriceLists.invalidate(),c.pricing.getStats.invalidate(),It.success("Price list created successfully")},onError:u=>{console.error("Create price list error:",u),It.error(u.message||"Failed to create price list")}})},gv=()=>{const c=yt.useContext();return yt.pricing.updatePriceList.useMutation({onSuccess:u=>{console.log("Price list updated successfully:",u),c.pricing.listPriceLists.invalidate(),c.pricing.getPriceList.invalidate({price_list_id:u.id}),c.pricing.getStats.invalidate(),It.success("Price list updated successfully")},onError:u=>{console.error("Update price list error:",u),It.error(u.message||"Failed to update price list")}})},QE=()=>yt.pricing.getStats.useQuery(void 0,{enabled:!0,staleTime:6e4,retry:1,onError:c=>{console.error("Pricing stats fetch error:",c),It.error("Failed to load pricing statistics")}}),xv=(c,u={})=>yt.pricing.getPriceListItems.useQuery({price_list_id:c,search:u.search,page:u.page||1,limit:u.limit||50},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:x=>{console.error("Price list items fetch error:",x),It.error("Failed to load price list items")}}),yv=()=>{const c=yt.useContext();return yt.pricing.createPriceListItem.useMutation({onSuccess:u=>{console.log("Price list item created successfully:",u),c.pricing.getPriceListItems.invalidate({price_list_id:u.price_list_id}),c.pricing.getPriceList.invalidate({price_list_id:u.price_list_id}),It.success("Price list item created successfully")},onError:u=>{console.error("Create price list item error:",u),It.error(u.message||"Failed to create price list item")}})},JE=()=>[{code:"KES",name:"Kenyan Shilling",symbol:"Ksh"}],ls=(c,u="KES")=>{const x=JE().find(w=>w.code===u);return`${(x==null?void 0:x.symbol)||"Ksh"} ${c.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`},nu=(c,u)=>(console.warn("calculateFinalPriceSync is deprecated - use calculateFinalPrice() API instead"),c),_v=(c,u)=>{const x=new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});if(!u)return`${x} - Ongoing`;const f=new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return`${x} - ${f}`},Mf=(c,u)=>{const x=new Date().toISOString().split("T")[0];return c>x?{status:"future",label:"Future",color:"bg-blue-100 text-blue-800 border-blue-200"}:u&&u<x?{status:"expired",label:"Expired",color:"bg-red-100 text-red-800 border-red-200"}:{status:"active",label:"Active",color:"bg-green-100 text-green-800 border-green-200"}},YE=async(c,u)=>{try{return(await yt.pricing.validateDateRange.query({startDate:c,endDate:u})).valid}catch(x){throw console.error("Failed to validate date range via API:",x),new Error("Date range validation failed. Please try again.")}},eC=({isOpen:c,onClose:u,onSubmit:x,priceListId:f,item:w,loading:N=!1,title:E,existingProductIds:A=[]})=>{const[n,P]=oe.useState([]),[z,q]=oe.useState(0),[U,W]=oe.useState(!1),{register:X,handleSubmit:Z,reset:J,watch:de,setValue:ne,formState:{errors:te}}=Cn({defaultValues:{price_list_id:f,product_id:"",unit_price:0,min_qty:1,surcharge_pct:0}}),{data:Ne}=cc({limit:1e3}),Ce=((Ne==null?void 0:Ne.products)||[]).filter(je=>je.status==="active"&&!A.includes(je.id)),Ae=de("unit_price"),fe=de("surcharge_pct");oe.useEffect(()=>{J(w?{price_list_id:w.price_list_id,product_id:w.product_id,unit_price:w.unit_price,min_qty:w.min_qty,surcharge_pct:w.surcharge_pct||0}:{price_list_id:f,product_id:"",unit_price:0,min_qty:1,surcharge_pct:0})},[w,f,J]);const Ie=je=>{w?x(je):n.length>0?n.forEach(Pe=>{x({...je,product_id:Pe,unit_price:U?z:je.unit_price})}):x(je)},Ee=je=>{P(Pe=>Pe.includes(je)?Pe.filter(it=>it!==je):[...Pe,je])},tt=(je,Pe)=>nu(je);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:Z(Ie),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:E}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[!w&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Products"}),t.jsx("div",{className:"border border-gray-300 rounded-md p-2 max-h-60 overflow-y-auto",children:Ce.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500",children:"No available products to add"}):t.jsx("div",{className:"space-y-2",children:Ce.map(je=>t.jsxs("div",{className:`flex items-center p-2 rounded-md ${n.includes(je.id)?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:[t.jsx("input",{type:"checkbox",id:`product-${je.id}`,checked:n.includes(je.id),onChange:()=>Ee(je.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsxs("label",{htmlFor:`product-${je.id}`,className:"ml-2 block text-sm text-gray-900 cursor-pointer flex-1",children:[t.jsx("div",{className:"font-medium",children:je.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",je.sku]})]})]},je.id))})}),n.length>0&&t.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:[n.length," product",n.length!==1?"s":""," selected"]})]}),!w&&n.length>0&&t.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("input",{type:"checkbox",id:"use-bulk-price",checked:U,onChange:()=>W(!U),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"use-bulk-price",className:"ml-2 block text-sm font-medium text-blue-800",children:"Apply same price to all selected products"})]}),U&&t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"block text-sm font-medium text-blue-800 mb-1",children:"Bulk Price (KSh)"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:z,onChange:je=>q(parseFloat(je.target.value)||0),className:"w-full rounded-md border border-blue-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"})]})]}),(w||!U)&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700",children:"Unit Price (KSh) *"}),t.jsx("input",{type:"number",id:"unit_price",min:"0",step:"0.01",...X("unit_price",{required:"Unit price is required",min:{value:0,message:"Price must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"}),te.unit_price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.unit_price.message})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"min_qty",className:"block text-sm font-medium text-gray-700",children:"Minimum Quantity"}),t.jsx("input",{type:"number",id:"min_qty",min:"1",...X("min_qty",{required:"Minimum quantity is required",min:{value:1,message:"Minimum quantity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),te.min_qty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.min_qty.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"surcharge_pct",className:"block text-sm font-medium text-gray-700",children:"Surcharge %"}),t.jsx("input",{type:"number",id:"surcharge_pct",min:"0",step:"0.1",...X("surcharge_pct",{min:{value:0,message:"Surcharge must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"}),te.surcharge_pct&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.surcharge_pct.message})]})]}),(Ae>0||z>0)&&fe>0&&t.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:t.jsxs("div",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Final Price:"})," ",ls(tt(U?z:Ae)),t.jsxs("div",{className:"text-xs mt-1",children:["(Base price + ",fe,"% surcharge)"]})]})}),w&&t.jsx("input",{type:"hidden",...X("product_id"),value:w.product_id}),t.jsx("input",{type:"hidden",...X("price_list_id"),value:f})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||n.length===0&&!w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):w?"Update Price":"Add Products"}),t.jsx("button",{type:"button",onClick:u,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},tC=({productId:c})=>{const[u,x]=oe.useState(null),[f,w]=oe.useState(!1),[N,E]=oe.useState(null),{data:A={priceLists:[]}}=Jf(),n=A.priceLists||[],P={},z=yv(),q=ne=>{x(ne),E(null),w(!0)},U=ne=>{x(ne.price_list_id),E(ne),w(!0)},W=async ne=>{try{if(N){alert("Edit functionality is temporarily disabled");return}else await z.mutateAsync({...ne,product_id:c});w(!1),E(null)}catch{}},X=n.filter(ne=>!Object.keys(P).includes(ne.id));new Date().toISOString().split("T")[0];const Z=n.filter(ne=>Mf(ne.start_date,ne.end_date).status==="active"),J=Object.keys(P).length===0,de=!Z.some(ne=>Object.keys(P).includes(ne.id));return t.jsxs("div",{className:"space-y-6",children:[(J||de)&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Sn,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:J?"No Pricing Defined":"No Active Pricing"}),t.jsx("p",{className:"text-sm text-yellow-700",children:J?"This product has no pricing defined in any price list.":"This product has pricing defined, but not in any active price list."})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Current Pricing"}),X.length>0&&t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:"",onChange:ne=>{ne.target.value&&q(ne.target.value)},className:"appearance-none bg-blue-600 text-white px-3 py-1 pr-8 rounded text-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[t.jsx("option",{value:"",children:"Add to Price List..."}),X.map(ne=>t.jsx("option",{value:ne.id,children:ne.name},ne.id))]}),t.jsx(wr,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white pointer-events-none"})]})]}),Object.keys(P).length===0?t.jsxs("div",{className:"p-8 text-center",children:[t.jsx(Sn,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"No pricing defined for this product"}),X.length>0&&t.jsx("button",{onClick:()=>q(X[0].id),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Add pricing to a price list"})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price List"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Min Qty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Surcharge"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(P).map(([ne,te])=>{const Ne=n.find(fe=>fe.id===ne);if(!Ne||!te.length)return null;const he=te[0],Ce=Mf(Ne.start_date,Ne.end_date),Ae=nu(he.unit_price,he.surcharge_pct);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:Ne.name}),Ne.is_default&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Default"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Ce.color}`,children:Ce.label})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(he.unit_price)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:he.min_qty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:he.surcharge_pct?`${he.surcharge_pct}%`:"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-green-600",children:ls(Ae)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx("button",{onClick:()=>U(he),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit price",children:t.jsx(di,{className:"h-4 w-4"})})})]},ne)})})]})})]}),f&&u&&t.jsx(eC,{isOpen:f,onClose:()=>{w(!1),E(null)},onSubmit:W,priceListId:u,item:N||void 0,loading:z.isPending,title:N?"Edit Product Price":"Add Product to Price List"})]})},sC=()=>{const{id:c}=nc(),u=Qr(),[x,f]=oe.useState(!1),[w,N]=oe.useState("details"),{data:E,isLoading:A,error:n}=LE(c),P=pv(),z=async X=>{if(E)try{await P.mutateAsync({id:E.id,...X}),f(!1)}catch{}},q=X=>new Date(X).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=X=>{switch(X){case"active":return"active";case"end_of_sale":return"credit_hold";case"obsolete":return"closed";default:return"active"}};if(A)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(n||!E)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Product not found or error loading product details."})})})]});const W=E.unit_of_measure==="cylinder"?Uf:qf;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>u("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:E.name})]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(di,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Product"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"flex space-x-8 px-6",children:[t.jsxs("button",{onClick:()=>N("details"),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${w==="details"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(hs,{className:"h-4 w-4"}),t.jsx("span",{children:"Product Details"})]}),t.jsxs("button",{onClick:()=>N("pricing"),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${w==="pricing"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(Sn,{className:"h-4 w-4"}),t.jsx("span",{children:"Pricing"})]})]})}),t.jsxs("div",{className:"p-6",children:[w==="details"&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Product Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:E.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"SKU"}),t.jsx("span",{className:"text-gray-900 font-mono",children:E.sku})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Unit of Measure"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(W,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900 capitalize",children:E.unit_of_measure})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),t.jsx(xm,{status:U(E.status),className:"capitalize",children:E.status.replace("_"," ")})]}),E.unit_of_measure==="cylinder"&&t.jsxs(t.Fragment,{children:[E.capacity_kg&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Capacity"}),t.jsxs("span",{className:"text-gray-900",children:[E.capacity_kg," kg"]})]}),E.tare_weight_kg&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Tare Weight"}),t.jsxs("span",{className:"text-gray-900",children:[E.tare_weight_kg," kg"]})]}),E.valve_type&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Valve Type"}),t.jsx("span",{className:"text-gray-900",children:E.valve_type})]})]}),E.barcode_uid&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Barcode/RFID UID"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(qN,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900 font-mono",children:E.barcode_uid})]})]}),E.description&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),t.jsx("p",{className:"text-gray-900",children:E.description})]})]}),E.status==="obsolete"&&t.jsx("div",{className:"mt-6 p-4 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-600"}),t.jsx("span",{className:"text-sm font-medium text-red-800",children:"This product is marked as obsolete and is no longer available for new orders."})]})})]}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Details"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(E.created_at)})]})]})})]})})]}),w==="pricing"&&t.jsx(tC,{productId:E.id})]})]}),t.jsx(fv,{isOpen:x,onClose:()=>f(!1),onSubmit:z,product:E,loading:P.isPending,title:"Edit Product"})]})},Yf=(c={})=>yt.warehouses.list.useQuery(c,{retry:1,staleTime:3e4}),rC=c=>yt.warehouses.get.useQuery({id:c},{enabled:!!c}),iC=()=>yt.warehouses.getStats.useQuery(void 0,{staleTime:6e4}),eg=()=>yt.warehouses.getOptions.useQuery(void 0,{staleTime:3e5}),nC=()=>yt.warehouses.create.useMutation({onSuccess:c=>{console.log("Warehouse created successfully:",c),It.success("Warehouse created successfully")},onError:c=>{console.error("Create warehouse mutation error:",c),It.error(c.message||"Failed to create warehouse")}}),vv=()=>yt.warehouses.update.useMutation({onSuccess:c=>{console.log("Warehouse updated successfully:",c),It.success("Warehouse updated successfully")},onError:c=>{console.error("Update warehouse mutation error:",c),It.error(c.message||"Failed to update warehouse")}}),aC=()=>yt.warehouses.delete.useMutation({onSuccess:(c,u)=>{console.log("Warehouse deleted successfully:",u.id),It.success("Warehouse deleted successfully")},onError:c=>{console.error("Delete warehouse mutation error:",c),It.error(c.message||"Failed to delete warehouse")}}),oC=({warehouses:c,loading:u=!1,onView:x,onEdit:f,onDelete:w})=>{const N=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),E=n=>n?n.toLocaleString()+" cylinders":"-",A=n=>n?[n.city,n.state].filter(Boolean).join(", ")||"Address incomplete":"No address";return console.log("WarehouseTable render:",{warehouses:c,loading:u}),u?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading warehouses..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(En,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No warehouses found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load warehouses. Please check your connection.":"Get started by adding your first warehouse."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Warehouses (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(n=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx(En,{className:"h-5 w-5 text-blue-600"})})}),t.jsx("div",{children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.name})})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Tn,{className:"h-4 w-4 text-gray-400"}),t.jsx("div",{className:"text-sm text-gray-900",children:A(n.address)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:E(n.capacity_cylinders)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(n.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>x(n),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View warehouse",children:t.jsx(om,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>f(n),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit warehouse",children:t.jsx(di,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>w(n),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete warehouse",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},n.id))})]})})]})},lC=({filters:c,onFiltersChange:u})=>{const x=w=>{u({...c,search:w.target.value||void 0,page:1})},f=()=>{u({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by warehouse name...",value:c.search||"",onChange:x,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("button",{onClick:f,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{children:"Reset"})]})]})})},bv=({isOpen:c,onClose:u,onSubmit:x,warehouse:f,loading:w=!1,title:N})=>{const[E,A]=oe.useState(!0),[n,P]=oe.useState(""),[z,q]=oe.useState(!1),[U,W]=oe.useState(null),[X,Z]=oe.useState([]),J=li.useRef(null),[de,ne]=oe.useState(null),[te,Ne]=oe.useState(null),[he,Ce]=oe.useState(!1),{register:Ae,handleSubmit:fe,reset:Ie,setValue:Ee,watch:tt,formState:{errors:je}}=Cn({defaultValues:{name:"",capacity_cylinders:void 0,address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}}),Pe=tt("address.latitude"),it=tt("address.longitude");oe.useEffect(()=>{if(f){const Nt=!!f.address;A(Nt),Ie({name:f.name,capacity_cylinders:f.capacity_cylinders,address:f.address?{line1:f.address.line1,line2:f.address.line2||"",city:f.address.city,state:f.address.state||"",postal_code:f.address.postal_code||"",country:f.address.country,instructions:f.address.instructions||"",latitude:f.address.latitude,longitude:f.address.longitude}:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}),P(f.address?[f.address.line1,f.address.city,f.address.state,f.address.postal_code,f.address.country].filter(Boolean).join(", "):"")}else A(!0),Ie({name:"",capacity_cylinders:void 0,address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}),P("")},[f,Ie]),oe.useEffect(()=>{let Nt=!0;return n&&n.length>=3?(q(!0),av(n,q).then(ft=>{Nt&&Z(ft||[])})):(Z([]),q(!1)),()=>{Nt=!1}},[n]),oe.useEffect(()=>{if(!de&&J.current&&Pe&&it){fi.accessToken=void 0;const Nt=new fi.Map({container:J.current,style:"mapbox://styles/mapbox/streets-v11",center:[it,Pe],zoom:14});Nt.addControl(new fi.NavigationControl,"top-right"),ne(Nt);const ft=new fi.Marker({anchor:"center",draggable:he}).setLngLat([it,Pe]).addTo(Nt);Ne(ft),ft.on("dragend",()=>{const Mt=ft.getLngLat();Ee("address.latitude",Mt.lat),Ee("address.longitude",Mt.lng)}),Nt.on("load",()=>{Nt.resize()})}},[J,Pe,it]),oe.useEffect(()=>{de&&te&&Pe&&it&&(te.setLngLat([it,Pe]),te.setDraggable(he),de.setCenter([it,Pe]),de.setZoom(14),de.resize())},[Pe,it,he,de,te]),oe.useEffect(()=>()=>{te&&te.remove(),de&&de.remove()},[]);const ct=Nt=>{x(Nt)};return dv(),c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:fe(ct),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Warehouse Name *"}),t.jsx("input",{type:"text",id:"name",...Ae("name",{required:"Warehouse name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Main Depot"}),je.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:je.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_cylinders",className:"block text-sm font-medium text-gray-700",children:"Storage Capacity (cylinders)"}),t.jsx("input",{type:"number",min:"1",id:"capacity_cylinders",...Ae("capacity_cylinders",{valueAsNumber:!0,min:{value:1,message:"Capacity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"1000"}),je.capacity_cylinders&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:je.capacity_cylinders.message})]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Location"})}),E&&t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("label",{htmlFor:"addressInput",className:"block text-sm font-medium text-gray-700",children:"Address *"}),t.jsx("input",{type:"text",id:"addressInput",value:n,onChange:Nt=>{P(Nt.target.value),W(null)},className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Start typing address..."}),z&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Searching..."}),X.length>0&&!U&&t.jsx("ul",{className:"border border-gray-200 rounded bg-white mt-1 max-h-48 overflow-y-auto z-10 relative",children:X.map((Nt,ft)=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-50",onClick:()=>{W(Nt),P(Nt.display_name),Ee("address.line1",Nt.address_line1||""),Ee("address.line2",Nt.address_line2||""),Ee("address.city",Nt.city||""),Ee("address.state",Nt.state||""),Ee("address.postal_code",Nt.postal_code||""),Ee("address.country",Nt.country||""),Ee("address.latitude",Nt.lat),Ee("address.longitude",Nt.lng)},children:Nt.display_name},ft))}),U&&t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Address selected"}),Pe&&it&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{ref:J,style:{width:"100%",height:200,borderRadius:8,overflow:"hidden",position:"relative"}}),t.jsx("div",{className:"flex justify-end mt-2",children:he?t.jsx("button",{type:"button",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",onClick:()=>Ce(!1),children:"Save Pin Location"}):t.jsx("button",{type:"button",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs",onClick:()=>Ce(!0),children:"Adjust Pin"})})]}),t.jsx("label",{htmlFor:"address.instructions",className:"block text-sm font-medium text-gray-700 mt-4",children:"Access Instructions"}),t.jsx("textarea",{rows:2,...Ae("address.instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate codes, special access requirements, loading dock information..."})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse",children:[t.jsxs("button",{type:"submit",className:"inline-flex w-full justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",disabled:w,children:[w?t.jsx(tr,{className:"animate-spin h-5 w-5 mr-2"}):null,"Save"]}),t.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:u,children:"Cancel"})]})]})})]})}):null},cC=()=>{const{data:c,isLoading:u}=iC();if(u)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(3)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const x=[{name:"Total Warehouses",value:c.total,icon:En,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Total Capacity",value:c.total_capacity.toLocaleString()+" cylinders",icon:Xo,color:"text-green-600",bgColor:"bg-green-50"},{name:"Average Capacity",value:c.average_capacity.toLocaleString()+" cylinders",icon:rc,color:"text-purple-600",bgColor:"bg-purple-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Warehouse Overview"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:x.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-lg font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]})},dC=()=>{const c=Qr(),[u,x]=oe.useState({page:1}),[f,w]=oe.useState(!1),[N,E]=oe.useState(null),[A,n]=oe.useState(null),{data:P,isLoading:z,error:q,refetch:U}=Yf(u),W=nC(),X=vv(),Z=aC();oe.useEffect(()=>{console.log("WarehousesPage state:",{filters:u,data:P,isLoading:z,error:q,isFormOpen:f,editingWarehouse:N})},[u,P,z,q,f,N]);const J=()=>{console.log("Adding new warehouse"),E(null),w(!0)},de=fe=>{console.log("Editing warehouse:",fe),E(fe),w(!0)},ne=fe=>{console.log("Viewing warehouse:",fe),c(`/warehouses/${fe.id}`)},te=fe=>{console.log("Deleting warehouse:",fe),n(fe)},Ne=async fe=>{console.log("Form submit:",fe);try{N?await X.mutateAsync({id:N.id,...fe}):await W.mutateAsync(fe),w(!1),E(null)}catch(Ie){console.error("Form submit error:",Ie)}},he=async()=>{if(A){console.log("Confirming delete:",A);try{await Z.mutateAsync(A.id),n(null)}catch(fe){console.error("Delete error:",fe)}}},Ce=fe=>{console.log("Page change:",fe),x(Ie=>({...Ie,page:fe}))},Ae=()=>{console.log("Refreshing warehouses"),U()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Warehouses"}),t.jsx("p",{className:"text-gray-600",children:"Manage storage facilities and inventory locations"}),q&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",q.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Ae,disabled:z,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${z?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:J,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Warehouse"})]})]})]}),t.jsx(cC,{}),t.jsx(lC,{filters:u,onFiltersChange:x}),t.jsx(oC,{warehouses:(P==null?void 0:P.warehouses)||[],loading:z,onView:ne,onEdit:de,onDelete:te}),P&&P.totalPages>1&&t.jsx(ac,{currentPage:P.currentPage,totalPages:P.totalPages,totalCount:P.totalCount,onPageChange:Ce}),t.jsx(bv,{isOpen:f,onClose:()=>{console.log("Closing form"),w(!1),E(null)},onSubmit:Ne,warehouse:N||void 0,loading:W.isPending||X.isPending,title:N?"Edit Warehouse":"Add New Warehouse"}),t.jsx(so,{isOpen:!!A,onClose:()=>n(null),onConfirm:he,title:"Delete Warehouse",message:`Are you sure you want to delete "${A==null?void 0:A.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:Z.isPending})]})},uC=(c={})=>yt.inventory.list.useQuery({warehouse_id:c.warehouse_id,product_id:c.product_id,low_stock_only:c.low_stock_only||!1},{enabled:!0,staleTime:3e4,retry:1,onError:u=>{console.error("Inventory fetch error:",u),It.error("Failed to load inventory")}}),wv=c=>yt.inventory.getByWarehouse.useQuery({warehouse_id:c},{enabled:!!c,staleTime:3e4,retry:1,onError:u=>{console.error("Warehouse inventory fetch error:",u),It.error("Failed to load warehouse inventory")}}),hC=c=>yt.inventory.getStats.useQuery({warehouse_id:c},{enabled:!0,staleTime:6e4,retry:1,onError:u=>{console.error("Inventory stats fetch error:",u),It.error("Failed to load inventory statistics")}}),mC=()=>{const c=yt.useContext();return yt.inventory.adjustStock.useMutation({onSuccess:u=>{console.log("Stock adjusted successfully:",u),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Stock levels updated successfully")},onError:u=>{console.error("Stock adjustment error:",u),It.error(u.message||"Failed to adjust stock levels")}})},pC=()=>{const c=yt.useContext();return yt.inventory.transferStock.useMutation({onSuccess:u=>{console.log("Stock transferred successfully:",u),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Stock transferred successfully")},onError:u=>{console.error("Stock transfer error:",u),It.error(u.message||"Failed to transfer stock")}})},fC=()=>{const c=yt.useContext();return yt.inventory.create.useMutation({onSuccess:u=>{console.log("Inventory balance created successfully:",u),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Inventory balance created successfully")},onError:u=>{console.error("Create inventory error:",u),It.error(u.message||"Failed to create inventory balance")}})},lf={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_URL:"/api/v1/trpc",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRyY3JqaW5yZGpnaXpxaGpkZ3ZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNDE2NTAsImV4cCI6MjA2NDYxNzY1MH0.2-y5r5UzIfcGoHc6BPkRy5rnxWxl4SJwxUehPWBxAao",VITE_SUPABASE_URL:"https://trcrjinrdjgizqhjdgvc.supabase.co"},gC=()=>{var J,de;const{id:c}=nc(),u=Qr(),[x,f]=oe.useState(!1),w=oe.useRef(null),[N,E]=oe.useState(null),{data:A,isLoading:n,error:P}=rC(c),{data:z=[],isLoading:q}=wv(c),U=vv(),W=async ne=>{if(A)try{await U.mutateAsync({id:A.id,...ne}),f(!1)}catch{}},X=ne=>new Date(ne).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=ne=>ne?ne.toLocaleString()+" cylinders":"Not specified";return oe.useEffect(()=>{var te,Ne;if(!((te=A==null?void 0:A.address)!=null&&te.latitude)||!((Ne=A==null?void 0:A.address)!=null&&Ne.longitude)||!w.current)return;const ne=lf==null?void 0:lf.VITE_MAPBOX_API_KEY;if(!ne){console.warn("Mapbox access token not found");return}if(N){try{N.remove()}catch(he){console.warn("Error removing existing map:",he)}E(null)}try{fi.accessToken=ne;const he=new fi.Map({container:w.current,style:"mapbox://styles/mapbox/streets-v11",center:[A.address.longitude,A.address.latitude],zoom:14});he.addControl(new fi.NavigationControl,"top-right"),new fi.Marker({anchor:"center"}).setLngLat([A.address.longitude,A.address.latitude]).addTo(he),he.on("load",()=>{try{he.resize()}catch(Ce){console.warn("Error resizing map:",Ce)}}),E(he)}catch(he){console.error("Error initializing map:",he)}},[(J=A==null?void 0:A.address)==null?void 0:J.latitude,(de=A==null?void 0:A.address)==null?void 0:de.longitude]),oe.useEffect(()=>()=>{if(N){try{N.remove()}catch(ne){console.warn("Error cleaning up map:",ne)}E(null)}},[N]),n?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]}):P||!A?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Warehouse not found or error loading warehouse details."})})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>u("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:A.name})]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(di,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Warehouse"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Warehouse Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Warehouse Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(En,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:A.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Storage Capacity"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:Z(A.capacity_cylinders)})]})]})]})]}),A.address&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Location"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Physical Address"}),t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Tn,{className:"h-4 w-4 text-gray-400 mt-0.5"}),t.jsxs("div",{className:"text-gray-900",children:[t.jsx("div",{children:A.address.line1}),A.address.line2&&t.jsx("div",{children:A.address.line2}),t.jsxs("div",{children:[A.address.city,A.address.state&&`, ${A.address.state}`,A.address.postal_code&&` ${A.address.postal_code}`]}),t.jsx("div",{children:A.address.country})]})]})]}),A.address.latitude&&A.address.longitude&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-2",children:"Map Location"}),t.jsx("div",{ref:w,className:"w-full h-64 rounded-lg border border-gray-300",style:{minHeight:"256px"}})]}),A.address.instructions&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Access Instructions"}),t.jsx("p",{className:"text-gray-900",children:A.address.instructions})]})]})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Details"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:X(A.created_at)})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Inventory"}),q?t.jsx("div",{className:"flex justify-center py-4",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):z.length>0?t.jsx("div",{className:"space-y-3",children:z.map(ne=>{var te,Ne,he;return t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-900",children:(te=ne.product)==null?void 0:te.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",(Ne=ne.product)==null?void 0:Ne.sku]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm font-medium text-gray-600",children:(he=ne.product)==null?void 0:he.unit_of_measure})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center border border-green-200",children:[t.jsx("div",{className:"text-2xl font-bold text-green-700",children:ne.qty_full}),t.jsx("div",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Full"})]}),t.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 text-center border border-gray-300",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-700",children:ne.qty_empty}),t.jsx("div",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Empty"})]}),t.jsxs("div",{className:`rounded-lg p-3 text-center border ${ne.qty_reserved>0?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}`,children:[t.jsx("div",{className:`text-2xl font-bold ${ne.qty_reserved>0?"text-yellow-700":"text-blue-700"}`,children:ne.qty_reserved}),t.jsx("div",{className:`text-xs font-medium uppercase tracking-wide ${ne.qty_reserved>0?"text-yellow-600":"text-blue-600"}`,children:"Reserved"})]})]}),t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-gray-500",children:"Available:"}),t.jsxs("span",{className:"font-semibold text-gray-900",children:[ne.qty_full-ne.qty_reserved," units"]})]})})]},ne.id)})}):t.jsxs("div",{className:"text-center py-4",children:[t.jsx(hs,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"This warehouse has no inventory yet."})]})]})]})]}),t.jsx(bv,{isOpen:x,onClose:()=>f(!1),onSubmit:W,warehouse:A,loading:U.isPending,title:"Edit Warehouse"})]})},xC=({inventory:c,loading:u=!1,onAdjustStock:x,onTransferStock:f})=>{const w=A=>new Date(A).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=A=>A===0?"text-red-600 bg-red-50":A<=10?"text-yellow-600 bg-yellow-50":"text-green-600 bg-green-50",E=A=>A===0?t.jsx(Us,{className:"h-4 w-4"}):A<=10?t.jsx(Us,{className:"h-4 w-4"}):null;return u?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading inventory..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No inventory found"}),t.jsx("p",{className:"text-gray-500",children:"No inventory records found for the selected filters."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Inventory (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reserved"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Available"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(A=>{var q,U,W;const n=A.qty_full-A.qty_reserved,P=N(n),z=E(n);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((q=A.product)==null?void 0:q.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((U=A.product)==null?void 0:U.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:((W=A.warehouse)==null?void 0:W.name)||"Unknown Warehouse"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_reserved})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-sm font-medium ${P}`,children:[z,t.jsx("span",{children:n})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:w(A.updated_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>x(A),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Adjust stock",children:t.jsx(di,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>f(A),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors",title:"Transfer stock",children:t.jsx(p_,{className:"h-4 w-4"})})]})})]},A.id)})})]})})]})},Yh=({value:c,onChange:u,placeholder:x="Select warehouse...",className:f="",required:w=!1})=>{const{data:N,isLoading:E}=eg();return E?t.jsx("div",{className:`relative ${f}`,children:t.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:[t.jsx(En,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-500",children:"Loading warehouses..."})]})}):t.jsx("div",{className:`relative ${f}`,children:t.jsxs("div",{className:"relative",children:[t.jsx(En,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c||"",onChange:A=>u(A.target.value),required:w,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:x}),N==null?void 0:N.map(A=>t.jsx("option",{value:A.id,children:A.city&&A.state?`${A.name} (${A.city}, ${A.state})`:A.name},A.id))]}),t.jsx(am,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"})]})})},yC=({filters:c,onFiltersChange:u})=>{const x=E=>{u({...c,search:E.target.value||void 0,page:1})},f=E=>{u({...c,warehouse_id:E||void 0,page:1})},w=()=>{u({...c,low_stock_only:!c.low_stock_only,page:1})},N=()=>{u({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by product SKU or name...",value:c.search||"",onChange:x,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-64",children:t.jsx(Yh,{value:c.warehouse_id,onChange:f,placeholder:"All Warehouses"})}),t.jsxs("button",{onClick:w,className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${c.low_stock_only?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,title:"Show items with intelligent low stock detection",children:[t.jsx(Us,{className:"h-4 w-4"}),t.jsx("span",{children:"Smart Low Stock"})]}),t.jsxs("button",{onClick:N,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},_C=()=>{const{data:c,isLoading:u}=hC();if(u)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[...Array(6)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const x=[{name:"Total Cylinders",value:c.total_cylinders.toLocaleString(),icon:hs,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Full Cylinders",value:c.total_full.toLocaleString(),icon:Gn,color:"text-green-600",bgColor:"bg-green-50"},{name:"Empty Cylinders",value:c.total_empty.toLocaleString(),icon:ZN,color:"text-gray-600",bgColor:"bg-gray-50"},{name:"Reserved",value:c.total_reserved.toLocaleString(),icon:JN,color:"text-orange-600",bgColor:"bg-orange-50"},{name:"Available",value:c.total_available.toLocaleString(),icon:Ji,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"Low Stock Items",value:c.low_stock_products.toLocaleString(),icon:Us,color:"text-red-600",bgColor:"bg-red-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Inventory Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:x.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]})},vC=({isOpen:c,onClose:u,onSubmit:x,inventory:f,loading:w=!1})=>{var J,de;const{register:N,handleSubmit:E,reset:A,watch:n,formState:{errors:P}}=Cn({defaultValues:{inventory_id:f.id,adjustment_type:"physical_count",qty_full_change:0,qty_empty_change:0,reason:""}}),z=n("qty_full_change")||0,q=n("qty_empty_change")||0,U=async ne=>{try{const te=await yt.inventory.validateAdjustment.mutate({inventory_id:ne.inventory_id,qty_full_change:ne.qty_full_change,qty_empty_change:ne.qty_empty_change,adjustment_type:ne.adjustment_type});return te.valid?(te.warnings.length>0&&console.warn("Stock adjustment warnings:",te.warnings),!0):te.errors[0]||"Stock adjustment validation failed"}catch(te){return console.error("Stock adjustment validation error:",te),"Failed to validate stock adjustment"}};oe.useEffect(()=>{f&&A({inventory_id:f.id,adjustment_type:"physical_count",qty_full_change:0,qty_empty_change:0,reason:""})},[f,A]);const W=async ne=>{try{if(await U({inventory_id:ne.inventory_id,qty_full_change:ne.qty_full_change,qty_empty_change:ne.qty_empty_change,adjustment_type:ne.adjustment_type})!==!0)return;x(ne)}catch(te){console.error("Form validation error:",te)}},X=f.qty_full+z,Z=f.qty_empty+q;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:E(W),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Adjust Stock"}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Current Stock Levels"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.qty_full}),t.jsx("div",{className:"text-sm text-gray-600",children:"Full Cylinders"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-600",children:f.qty_empty}),t.jsx("div",{className:"text-sm text-gray-600",children:"Empty Cylinders"})]})]}),t.jsxs("div",{className:"mt-3 text-center",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Product: ",t.jsx("span",{className:"font-medium",children:(J=f.product)==null?void 0:J.name})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Warehouse: ",t.jsx("span",{className:"font-medium",children:(de=f.warehouse)==null?void 0:de.name})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"adjustment_type",className:"block text-sm font-medium text-gray-700",children:"Adjustment Type *"}),t.jsxs("select",{id:"adjustment_type",...N("adjustment_type",{required:"Adjustment type is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"received_full",children:"Received Full Cylinders"}),t.jsx("option",{value:"received_empty",children:"Received Empty Cylinders"}),t.jsx("option",{value:"physical_count",children:"Physical Count Adjustment"}),t.jsx("option",{value:"damage_loss",children:"Damage/Loss"}),t.jsx("option",{value:"other",children:"Other"})]}),P.adjustment_type&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.adjustment_type.message})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_full_change",className:"block text-sm font-medium text-gray-700",children:"Full Cylinders Change"}),t.jsx("input",{type:"number",id:"qty_full_change",...N("qty_full_change",{valueAsNumber:!0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),P.qty_full_change&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.qty_full_change.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_empty_change",className:"block text-sm font-medium text-gray-700",children:"Empty Cylinders Change"}),t.jsx("input",{type:"number",id:"qty_empty_change",...N("qty_empty_change",{valueAsNumber:!0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),P.qty_empty_change&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.qty_empty_change.message})]})]}),(z!==0||q!==0)&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"Resulting Stock Levels"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:X}),z>0&&t.jsx(Ji,{className:"h-4 w-4 text-green-600"}),z<0&&t.jsx(Wy,{className:"h-4 w-4 text-red-600"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Full Cylinders"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:Z}),q>0&&t.jsx(Ji,{className:"h-4 w-4 text-green-600"}),q<0&&t.jsx(Wy,{className:"h-4 w-4 text-red-600"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Empty Cylinders"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700",children:"Reason/Notes *"}),t.jsx("textarea",{id:"reason",rows:3,...N("reason",{required:"Reason is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Explain the reason for this stock adjustment..."}),P.reason&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.reason.message})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Adjusting..."})]}):"Adjust Stock"}),t.jsx("button",{type:"button",onClick:u,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},bC=({isOpen:c,onClose:u,onSubmit:x,inventory:f,loading:w=!1})=>{var J,de,ne;const{register:N,handleSubmit:E,reset:A,watch:n,setValue:P,formState:{errors:z}}=Cn({defaultValues:{from_warehouse_id:f.warehouse_id,to_warehouse_id:"",product_id:f.product_id,qty_full:0,qty_empty:0,notes:""}}),q=n("qty_full")||0,U=n("qty_empty")||0,W=n("to_warehouse_id");oe.useEffect(()=>{f&&A({from_warehouse_id:f.warehouse_id,to_warehouse_id:"",product_id:f.product_id,qty_full:0,qty_empty:0,notes:""})},[f,A]);const X=te=>{x(te)},Z=te=>{P("to_warehouse_id",te)};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:E(X),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Transfer Stock"}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Product Information"}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Product:"})," ",(J=f.product)==null?void 0:J.name]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"SKU:"})," ",(de=f.product)==null?void 0:de.sku]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"From Warehouse"}),t.jsx("div",{className:"text-sm text-blue-800 font-medium",children:(ne=f.warehouse)==null?void 0:ne.name}),t.jsxs("div",{className:"mt-2 space-y-1 text-xs text-blue-700",children:[t.jsxs("div",{children:["Full: ",f.qty_full]}),t.jsxs("div",{children:["Empty: ",f.qty_empty]})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(VN,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"To Warehouse"}),t.jsx(Yh,{value:W,onChange:Z,placeholder:"Select destination...",className:"w-full",required:!0}),z.to_warehouse_id&&t.jsx("p",{className:"mt-1 text-xs text-red-600",children:"Destination warehouse is required"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Transfer Quantities"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_full",className:"block text-sm font-medium text-gray-700",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",max:f.qty_full,id:"qty_full",...N("qty_full",{valueAsNumber:!0,min:{value:0,message:"Quantity must be positive"},max:{value:f.qty_full,message:`Cannot exceed available quantity (${f.qty_full})`}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Available: ",f.qty_full]}),z.qty_full&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.qty_full.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_empty",className:"block text-sm font-medium text-gray-700",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",max:f.qty_empty,id:"qty_empty",...N("qty_empty",{valueAsNumber:!0,min:{value:0,message:"Quantity must be positive"},max:{value:f.qty_empty,message:`Cannot exceed available quantity (${f.qty_empty})`}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Available: ",f.qty_empty]}),z.qty_empty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.qty_empty.message})]})]}),(q>0||U>0)&&t.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsxs("div",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Transfer Summary:"})," ",q," full + ",U," empty cylinders"]})})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Transfer Notes"}),t.jsx("textarea",{id:"notes",rows:3,...N("notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional notes about this transfer..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w||!W||q===0&&U===0,className:"inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Transferring..."})]}):"Transfer Stock"}),t.jsx("button",{type:"button",onClick:u,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},wC=()=>{const[c,u]=oe.useState({page:1}),[x,f]=oe.useState(null),[w,N]=oe.useState(null),[E,A]=oe.useState(!1),{data:n,isLoading:P,error:z,refetch:q}=uC(c),{data:U}=cc({limit:1e3}),{data:W}=Yf({limit:1e3}),X=mC(),Z=pC(),J=fC(),de=(U==null?void 0:U.products)||[],ne=(W==null?void 0:W.warehouses)||[];oe.useEffect(()=>{console.log("InventoryPage state:",{filters:c,data:n,isLoading:P,error:z,adjustingInventory:x,transferringInventory:w})},[c,n,P,z,x,w]);const te=tt=>{console.log("Adjusting stock for:",tt),f(tt)},Ne=tt=>{console.log("Transferring stock for:",tt),N(tt)},he=()=>{console.log("Adding new stock"),A(!0)},Ce=async tt=>{console.log("Adjustment submit:",tt);try{await X.mutateAsync(tt),f(null)}catch(je){console.error("Adjustment error:",je)}},Ae=async tt=>{console.log("Transfer submit:",tt);try{await Z.mutateAsync(tt),N(null)}catch(je){console.error("Transfer error:",je)}},fe=async tt=>{console.log("Add stock submit:",tt);try{await J.mutateAsync(tt),A(!1)}catch(je){console.error("Add stock error:",je)}},Ie=tt=>{console.log("Page change:",tt),u(je=>({...je,page:tt}))},Ee=()=>{console.log("Refreshing inventory"),q()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),t.jsx("p",{className:"text-gray-600",children:"Track stock levels across all warehouses"}),z&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",z.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Ee,disabled:P,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${P?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:he,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",title:"Add new inventory record",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Stock"})]})]})]}),t.jsx(_C,{}),t.jsx(yC,{filters:c,onFiltersChange:u}),t.jsx(xC,{inventory:(n==null?void 0:n.inventory)||[],loading:P,onAdjustStock:te,onTransferStock:Ne}),n&&n.totalPages>1&&t.jsx(ac,{currentPage:n.currentPage,totalPages:n.totalPages,totalCount:n.totalCount,onPageChange:Ie}),x&&t.jsx(vC,{isOpen:!!x,onClose:()=>f(null),onSubmit:Ce,inventory:x,loading:X.isPending}),w&&t.jsx(bC,{isOpen:!!w,onClose:()=>N(null),onSubmit:Ae,inventory:w,loading:Z.isPending}),E&&t.jsx(jC,{isOpen:E,onClose:()=>A(!1),onSubmit:fe,products:de,warehouses:ne,loading:J.isPending})]})},jC=({isOpen:c,onClose:u,onSubmit:x,products:f,warehouses:w,loading:N=!1})=>{const[E,A]=oe.useState({warehouse_id:"",product_id:"",qty_full:0,qty_empty:0,qty_reserved:0}),n=z=>{z.preventDefault(),E.warehouse_id&&E.product_id&&x(E)},P=(z,q)=>{A(U=>({...U,[z]:q}))};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:n,children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Add New Stock Record"}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(wr,{className:"h-6 w-6 rotate-45"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warehouse *"}),t.jsxs("select",{value:E.warehouse_id,onChange:z=>P("warehouse_id",z.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select a warehouse..."}),w.map(z=>t.jsx("option",{value:z.id,children:z.name},z.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product *"}),t.jsxs("select",{value:E.product_id,onChange:z=>P("product_id",z.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select a product..."}),f.filter(z=>z.status==="active").map(z=>t.jsxs("option",{value:z.id,children:[z.name," (",z.sku,")"]},z.id))]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:E.qty_full,onChange:z=>P("qty_full",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:E.qty_empty,onChange:z=>P("qty_empty",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reserved Cylinders"}),t.jsx("input",{type:"number",min:"0",max:E.qty_full,value:E.qty_reserved,onChange:z=>P("qty_reserved",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Cannot exceed full cylinders quantity"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||!E.warehouse_id||!E.product_id,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Adding...":"Add Stock Record"}),t.jsx("button",{type:"button",onClick:u,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},NC=({priceLists:c,loading:u=!1,onView:x,onEdit:f,onDuplicate:w,onSetDefault:N,onDelete:E})=>{const A=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return u?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading price lists..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(Sn,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No price lists found"}),t.jsx("p",{className:"text-gray-500",children:"Get started by creating your first price list."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Price Lists (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price List"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Currency"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Range"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Products"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(n=>{const P=n.statusInfo||{status:"active",label:"Active",color:"bg-green-100 text-green-800 border-green-200"},z=n.isExpiringSoon||!1;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>x(n),className:"text-sm font-medium text-blue-600 hover:text-blue-900 hover:underline",children:n.name}),n.is_default&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx(Wh,{className:"h-3 w-3 mr-1"}),"Default"]}),z&&t.jsx(Us,{className:"h-4 w-4 text-yellow-500",title:"Expiring soon"})]}),n.description&&t.jsx("div",{className:"text-sm text-gray-500 mt-1 max-w-xs truncate",children:n.description})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900 font-mono",children:n.currency_code})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("div",{className:"text-sm text-gray-900",children:_v(n.start_date,n.end_date)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${P.color}`,children:P.label})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.product_count||0})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:A(n.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>f(n),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit price list",children:t.jsx(di,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>w(n),className:"text-purple-600 hover:text-purple-900 p-1 rounded hover:bg-purple-50 transition-colors",title:"Duplicate price list",children:t.jsx(WN,{className:"h-4 w-4"})}),!n.is_default&&t.jsx("button",{onClick:()=>N(n),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors",title:"Set as default",children:t.jsx(Wh,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>E(n),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete price list",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},n.id)})})]})})]})},SC=({filters:c,onFiltersChange:u})=>{const x=N=>{u({...c,search:N.target.value||void 0,page:1})},f=N=>{u({...c,status:N.target.value||void 0,page:1})},w=()=>{u({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name or description...",value:c.search||"",onChange:x,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-32",children:t.jsxs("div",{className:"relative",children:[t.jsx($s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"future",children:"Future"}),t.jsx("option",{value:"expired",children:"Expired"})]})]})}),t.jsxs("button",{onClick:w,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},jv=({isOpen:c,onClose:u,onSubmit:x,priceList:f,loading:w=!1,title:N})=>{const{register:E,handleSubmit:A,reset:n,watch:P,formState:{errors:z}}=Cn({defaultValues:{name:"",description:"",currency_code:"KES",start_date:new Date().toISOString().split("T")[0],end_date:"",is_default:!1}}),q=P("start_date"),U=P("end_date"),W=P("is_default");oe.useEffect(()=>{n(f?{name:f.name,description:f.description||"",currency_code:"KES",start_date:f.start_date,end_date:f.end_date||"",is_default:f.is_default}:{name:"",description:"",currency_code:"KES",start_date:new Date().toISOString().split("T")[0],end_date:"",is_default:!1})},[f,n]);const X=J=>{const de={...J,currency_code:"KES",end_date:J.end_date||void 0,description:J.description||void 0};x(de)},Z=!U||YE(q,U);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(X),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Price List Name *"}),t.jsx("input",{type:"text",id:"name",...E("name",{required:"Price list name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Standard 2025"}),z.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...E("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional description of this price list..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"currency_code",className:"block text-sm font-medium text-gray-700",children:"Currency"}),t.jsx("div",{className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm bg-gray-50",children:t.jsx("span",{className:"text-gray-900",children:"KES - Kenyan Shilling (KSh)"})}),t.jsx("input",{type:"hidden",...E("currency_code"),value:"KES"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:"Start Date *"}),t.jsx("input",{type:"date",id:"start_date",...E("start_date",{required:"Start date is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.start_date&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.start_date.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:"End Date"}),t.jsx("input",{type:"date",id:"end_date",...E("end_date"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave empty for no end date"})]})]}),!Z&&t.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:"End date must be after start date"})]})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"is_default",...E("is_default"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"is_default",className:"ml-2 block text-sm text-gray-900",children:"Set as default price list"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Only one price list can be set as default at a time"}),W&&t.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsx("p",{className:"text-xs text-yellow-800",children:"Setting this as default will unset any existing default price list"})})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w||!Z,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Price List"}),t.jsx("button",{type:"button",onClick:u,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},TC=()=>{const{data:c,isLoading:u}=QE();if(u)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[...Array(6)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const x=[{name:"Total Price Lists",value:c.total_price_lists,icon:Sn,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Active",value:c.active_price_lists,icon:Gn,color:"text-green-600",bgColor:"bg-green-50"},{name:"Future",value:c.future_price_lists,icon:Qi,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Expired",value:c.expired_price_lists,icon:pa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Expiring Soon",value:c.expiring_soon,icon:Us,color:"text-yellow-600",bgColor:"bg-yellow-50"},{name:"No Pricing",value:c.products_without_pricing,icon:hs,color:"text-gray-600",bgColor:"bg-gray-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Pricing Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:x.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]})},EC=()=>{const c=Qr(),[u,x]=oe.useState({page:1}),[f,w]=oe.useState(!1),[N,E]=oe.useState(null),[A,n]=oe.useState(null),{data:P,isLoading:z,error:q,refetch:U}=Jf(u),W=KE(),X=gv();oe.useEffect(()=>{console.log("PricingPage state:",{filters:u,data:P,isLoading:z,error:q,isFormOpen:f,editingPriceList:N})},[u,P,z,q,f,N]);const Z=()=>{console.log("Adding new price list"),E(null),w(!0)},J=Ie=>{console.log("Editing price list:",Ie),E(Ie),w(!0)},de=Ie=>{console.log("Viewing price list:",Ie),c(`/pricing/${Ie.id}`)},ne=Ie=>{console.log("Duplicating price list:",Ie),E({...Ie,id:"",name:`Copy of ${Ie.name}`,is_default:!1}),w(!0)},te=async Ie=>{console.log("Setting default price list:",Ie),alert("Set default price list functionality is temporarily disabled")},Ne=Ie=>{console.log("Deleting price list:",Ie),n(Ie)},he=async Ie=>{console.log("Form submit:",Ie);try{N!=null&&N.id?await X.mutateAsync({id:N.id,...Ie}):await W.mutateAsync(Ie),w(!1),E(null)}catch(Ee){console.error("Form submit error:",Ee)}},Ce=async()=>{A&&(console.log("Confirming delete:",A),alert("Delete price list functionality is temporarily disabled"),n(null))},Ae=Ie=>{console.log("Page change:",Ie),x(Ee=>({...Ee,page:Ie}))},fe=()=>{console.log("Refreshing price lists"),U()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Price Catalog"}),t.jsx("p",{className:"text-gray-600",children:"Manage pricing for your products across different markets"}),q&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",q.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:fe,disabled:z,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${z?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:Z,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Create Price List"})]})]})]}),t.jsx(TC,{}),t.jsx(SC,{filters:u,onFiltersChange:x}),t.jsx(NC,{priceLists:(P==null?void 0:P.priceLists)||[],loading:z,onView:de,onEdit:J,onDuplicate:ne,onSetDefault:te,onDelete:Ne}),P&&P.totalPages>1&&t.jsx(ac,{currentPage:P.currentPage,totalPages:P.totalPages,totalCount:P.totalCount,onPageChange:Ae}),t.jsx(jv,{isOpen:f,onClose:()=>{console.log("Closing form"),w(!1),E(null)},onSubmit:he,priceList:N||void 0,loading:W.isPending||X.isPending,title:N!=null&&N.id?"Edit Price List":"Create New Price List"}),t.jsx(so,{isOpen:!!A,onClose:()=>n(null),onConfirm:Ce,title:"Delete Price List",message:`Are you sure you want to delete "${A==null?void 0:A.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:!1})]})},CC=({isOpen:c,onClose:u,onSubmit:x,priceList:f,loading:w=!1})=>{const[N,E]=oe.useState([]),[A,n]=oe.useState({}),[P,z]=oe.useState(""),{data:q}=cc({limit:1e3}),{data:U=[]}=xv(f.id),W=(q==null?void 0:q.products)||[],X=U.map(Ne=>Ne.product_id),Z=W.filter(Ne=>Ne.status==="active"&&!X.includes(Ne.id)&&(P===""||Ne.name.toLowerCase().includes(P.toLowerCase())||Ne.sku.toLowerCase().includes(P.toLowerCase())));oe.useEffect(()=>{c||(E([]),n({}),z(""))},[c]);const J=(Ne,he)=>{if(he){const Ce=Z.find(Ae=>Ae.id===Ne);Ce&&(E(Ae=>[...Ae,Ne]),n(Ae=>({...Ae,[Ne]:{productId:Ne,productName:Ce.name,productSku:Ce.sku,unitPrice:0,minQty:1,surchargeRate:void 0}})))}else E(Ce=>Ce.filter(Ae=>Ae!==Ne)),n(Ce=>{const Ae={...Ce};return delete Ae[Ne],Ae})},de=(Ne,he,Ce)=>{n(Ae=>({...Ae,[Ne]:{...Ae[Ne],[he]:Ce}}))},ne=()=>{const Ne=Object.values(A).filter(he=>he.unitPrice>0);Ne.length!==0&&x(Ne)},te=N.length>0&&N.every(Ne=>{var he;return((he=A[Ne])==null?void 0:he.unitPrice)>0});return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:["Add Products to: ",f.name]}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search products by name or SKU...",value:P,onChange:Ne=>z(Ne.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:["Select Products (",Z.length," available)"]}),t.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:Z.length>0?t.jsx("div",{className:"divide-y divide-gray-200",children:Z.map(Ne=>t.jsx("div",{className:"p-3 hover:bg-gray-50",children:t.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:N.includes(Ne.id),onChange:he=>J(Ne.id,he.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ne.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Ne.sku,"  ",Ne.unit_of_measure,Ne.capacity_kg&&`  ${Ne.capacity_kg}kg`]})]})]})},Ne.id))}):t.jsxs("div",{className:"p-8 text-center",children:[t.jsx(hs,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500",children:P?"No products found matching your search.":"All products are already in this price list."})]})})]}),N.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Set Prices for Selected Products"}),t.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:N.map(Ne=>{const he=A[Ne];return he?t.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gray-50",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("h5",{className:"font-medium text-gray-900",children:he.productName}),t.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",he.productSku]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Unit Price (",f.currency_code,") *"]}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:he.unitPrice||"",onChange:Ce=>de(Ne,"unitPrice",parseFloat(Ce.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Quantity"}),t.jsx("input",{type:"number",min:"1",value:he.minQty,onChange:Ce=>de(Ne,"minQty",parseInt(Ce.target.value)||1),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Surcharge (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:he.surchargeRate||"",onChange:Ce=>de(Ne,"surchargeRate",parseFloat(Ce.target.value)||void 0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"})]})]}),he.unitPrice>0&&t.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded",children:t.jsxs("span",{className:"text-sm text-blue-800",children:["Final Price: ",ls(nu(he.unitPrice,he.surchargeRate),f.currency_code)]})})]},Ne):null})})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:ne,disabled:w||!te,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Adding..."})]}):`Add ${N.length} Product${N.length!==1?"s":""}`}),t.jsx("button",{type:"button",onClick:u,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]})}):null},kC=({isOpen:c,onClose:u,onSubmit:x,item:f,currencyCode:w,loading:N=!1})=>{var Z,J;const{register:E,handleSubmit:A,reset:n,watch:P,formState:{errors:z}}=Cn({defaultValues:{unit_price:f.unit_price,min_qty:f.min_qty,surcharge_pct:f.surcharge_pct||void 0}}),q=P("unit_price"),U=P("surcharge_pct");oe.useEffect(()=>{f&&n({unit_price:f.unit_price,min_qty:f.min_qty,surcharge_pct:f.surcharge_pct||void 0})},[f,n]);const W=de=>{x({unit_price:de.unit_price,min_qty:de.min_qty,surcharge_pct:de.surcharge_pct||null})},X=()=>nu(q||0);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(W),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Edit Product Price"}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:(Z=f.product)==null?void 0:Z.name}),t.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",(J=f.product)==null?void 0:J.sku]})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700",children:["Unit Price (",w,") *"]}),t.jsx("input",{type:"number",min:"0",step:"0.01",id:"unit_price",...E("unit_price",{required:"Unit price is required",min:{value:.01,message:"Price must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.unit_price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.unit_price.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"min_qty",className:"block text-sm font-medium text-gray-700",children:"Minimum Quantity"}),t.jsx("input",{type:"number",min:"1",id:"min_qty",...E("min_qty",{required:"Minimum quantity is required",min:{value:1,message:"Minimum quantity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.min_qty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.min_qty.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"surcharge_pct",className:"block text-sm font-medium text-gray-700",children:"Surcharge Percentage (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",id:"surcharge_pct",...E("surcharge_pct",{min:{value:0,message:"Surcharge cannot be negative"},max:{value:100,message:"Surcharge cannot exceed 100%"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"}),z.surcharge_pct&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.surcharge_pct.message})]}),q>0&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Final Price:"}),t.jsx("span",{className:"text-lg font-bold text-blue-900",children:ls(X(),w)})]}),U&&U>0&&t.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Base: ",ls(q,w)," + ",U,"% surcharge"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Changes"}),t.jsx("button",{type:"button",onClick:u,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},AC=()=>{var Ee;const{id:c}=nc(),u=Qr(),[x,f]=oe.useState(!1),[w,N]=oe.useState(!1),[E,A]=oe.useState(null),[n,P]=oe.useState(null),{data:z,isLoading:q,error:U}=XE(c),{data:W=[],refetch:X}=xv(c),Z=gv(),J=yv(),de=async tt=>{if(z)try{await Z.mutateAsync({id:z.id,...tt}),f(!1)}catch{}},ne=async tt=>{try{for(const je of tt)await J.mutateAsync({price_list_id:c,product_id:je.productId,unit_price:je.unitPrice,min_qty:je.minQty||1,surcharge_pct:je.surchargeRate||void 0});N(!1),X()}catch{}},te=tt=>{A(tt)},Ne=async tt=>{E&&(alert("Update price list item functionality is temporarily disabled"),A(null))},he=tt=>{P(tt)},Ce=async()=>{n&&(alert("Delete price list item functionality is temporarily disabled"),P(null))},Ae=tt=>new Date(tt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),fe=(tt,je)=>nu(tt);if(q)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(U||!z)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Price list not found or error loading details."})})})]});const Ie=Mf(z.start_date,z.end_date);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>u("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:z.name})]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(di,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Price List"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Price List Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Sn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:z.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Currency"}),t.jsx("span",{className:"text-gray-900 font-mono",children:z.currency_code})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Ie.color}`,children:Ie.label})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Date Range"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:_v(z.start_date,z.end_date)})]})]}),z.description&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),t.jsx("p",{className:"text-gray-900",children:z.description})]})]})]})}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:Ae(z.created_at)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Products"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsxs("span",{className:"text-sm text-gray-900",children:[W.length," products"]})]})]})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Products in this Price List (",W.length,")"]}),t.jsxs("button",{onClick:()=>N(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Products"})]})]}),W.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Min Qty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Surcharge"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:W.map(tt=>{var je,Pe;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((je=tt.product)==null?void 0:je.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((Pe=tt.product)==null?void 0:Pe.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(tt.unit_price,z.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:tt.min_qty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:tt.surcharge_pct?`${tt.surcharge_pct}%`:"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(fe(tt.unit_price,tt.surcharge_pct),z.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>te(tt),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit price",children:t.jsx(di,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>he(tt),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Remove from list",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},tt.id)})})]})}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products added yet"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"Add products to this price list to set their pricing."}),t.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Products"})]})]})]}),t.jsx(jv,{isOpen:x,onClose:()=>f(!1),onSubmit:de,priceList:z,loading:Z.isPending,title:"Edit Price List"}),t.jsx(CC,{isOpen:w,onClose:()=>N(!1),onSubmit:ne,priceList:z,loading:J.isPending}),E&&t.jsx(kC,{isOpen:!!E,onClose:()=>A(null),onSubmit:Ne,item:E,currencyCode:z.currency_code,loading:!1}),t.jsx(so,{isOpen:!!n,onClose:()=>P(null),onConfirm:Ce,title:"Remove Product",message:`Are you sure you want to remove "${(Ee=n==null?void 0:n.product)==null?void 0:Ee.name}" from this price list?`,confirmText:"Remove",type:"danger",loading:!1})]})},Nv=(c={})=>yt.orders.list.useQuery({status:c.status,customer_id:c.customer_id,search:c.search,order_date_from:c.order_date_from,order_date_to:c.order_date_to,scheduled_date_from:c.scheduled_date_from,scheduled_date_to:c.scheduled_date_to,include_analytics:c.include_analytics||!1,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:u=>{console.error("Orders fetch error:",u),It.error("Failed to load orders")}}),MC=c=>yt.orders.getById.useQuery({order_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:u=>{console.error("Order fetch error:",u),It.error("Failed to load order details")}}),PC=()=>{const c=yt.useContext();return yt.orders.create.useMutation({onSuccess:u=>{console.log("Order created successfully:",u),c.orders.list.invalidate(),It.success("Order created successfully")},onError:u=>{console.error("Create order error:",u),It.error(u.message||"Failed to create order")}})},Sv=()=>{const c=yt.useContext();return yt.orders.updateStatus.useMutation({onSuccess:u=>{console.log("Order status updated successfully:",u),c.orders.list.invalidate(),c.orders.getById.invalidate({order_id:u.id}),It.success("Order status updated successfully")},onError:u=>{console.error("Update order status error:",u),It.error(u.message||"Failed to update order status")}})},IC=()=>{const c=yt.useContext();return yt.orders.updateTax.useMutation({onSuccess:(u,x)=>{console.log("Order tax updated:",u),c.orders.getById.invalidate({order_id:x.order_id}),c.orders.list.invalidate(),It.success("Order tax updated successfully")},onError:u=>{console.error("Update tax error:",u),It.error(u.message||"Failed to update order tax")}})},DC=({orders:c,loading:u=!1,onView:x,onEdit:f,onChangeStatus:w,selectedOrders:N=[],onSelectionChange:E})=>{const[A,n]=oe.useState(!1),P=Z=>new Date(Z).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),z=Z=>{switch(Z){case"draft":return"bg-gray-100 text-gray-800 border-gray-300";case"confirmed":return"bg-blue-100 text-blue-800 border-blue-300";case"scheduled":return"bg-purple-100 text-purple-800 border-purple-300";case"en_route":return"bg-orange-100 text-orange-800 border-orange-300";case"delivered":return"bg-green-100 text-green-800 border-green-300";case"invoiced":return"bg-teal-100 text-teal-800 border-teal-300";case"cancelled":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},q=Z=>`ORD-${Z.substring(0,8).toUpperCase()}`,U=Z=>{const J=[];switch(Z.status){case"draft":J.push({label:"Confirm",action:()=>w(Z,"confirmed"),icon:hs,color:"text-blue-600 hover:text-blue-900"});break;case"confirmed":J.push({label:"Schedule",action:()=>w(Z,"scheduled"),icon:$s,color:"text-purple-600 hover:text-purple-900"});break;case"scheduled":J.push({label:"En Route",action:()=>w(Z,"en_route"),icon:mr,color:"text-orange-600 hover:text-orange-900"});break;case"en_route":J.push({label:"Delivered",action:()=>w(Z,"delivered"),icon:hs,color:"text-green-600 hover:text-green-900"});break;case"delivered":J.push({label:"Invoice",action:()=>w(Z,"invoiced"),icon:w_,color:"text-teal-600 hover:text-teal-900"});break}return["draft","confirmed","scheduled"].includes(Z.status)&&J.push({label:"Cancel",action:()=>w(Z,"cancelled"),icon:pa,color:"text-red-600 hover:text-red-900"}),J},W=Z=>{n(Z),E&&E(Z?c.map(J=>J.id):[])},X=(Z,J)=>{if(E){const de=J?[...N,Z]:N.filter(ne=>ne!==Z);E(de),n(de.length===c.length)}};return u?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading orders..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(sc,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No orders found"}),t.jsx("p",{className:"text-gray-500",children:"Get started by creating your first order."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Orders (",c.length,")"]}),N.length>0&&t.jsxs("span",{className:"text-sm text-blue-600",children:[N.length," selected"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[E&&t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:A,onChange:Z=>W(Z.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delivery Address"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dates"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(Z=>{var de,ne,te,Ne;const J=U(Z);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[E&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",checked:N.includes(Z.id),onChange:he=>X(Z.id,he.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("button",{onClick:()=>x(Z),className:"text-sm font-medium text-blue-600 hover:text-blue-900",children:q(Z.id)}),t.jsxs("div",{className:"text-sm text-gray-500",children:[((de=Z.order_lines)==null?void 0:de.length)||0," item",(((ne=Z.order_lines)==null?void 0:ne.length)||0)!==1?"s":""]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((te=Z.customer)==null?void 0:te.name)||"Unknown Customer"}),((Ne=Z.customer)==null?void 0:Ne.email)&&t.jsx("div",{className:"text-sm text-gray-500",children:Z.customer.email})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:Z.delivery_address?t.jsxs(t.Fragment,{children:[t.jsx("div",{children:Z.delivery_address.city}),Z.delivery_address.state&&t.jsx("div",{className:"text-gray-500",children:Z.delivery_address.state})]}):"No address"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsxs("div",{children:["Order: ",P(Z.order_date)]}),Z.scheduled_date&&t.jsxs("div",{className:"text-gray-500",children:["Scheduled: ",P(Z.scheduled_date)]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${z(Z.status)}`,children:Z.status.replace("_"," ").toUpperCase()})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:Z.total_amount?ls(Z.total_amount):"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>x(Z),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View order",children:t.jsx(om,{className:"h-4 w-4"})}),["draft","confirmed"].includes(Z.status)&&t.jsx("button",{onClick:()=>f(Z),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit order",children:t.jsx(di,{className:"h-4 w-4"})}),J.slice(0,2).map((he,Ce)=>t.jsx("button",{onClick:he.action,className:`p-1 rounded hover:bg-gray-50 transition-colors ${he.color}`,title:he.label,children:t.jsx(he.icon,{className:"h-4 w-4"})},Ce))]})})]},Z.id)})})]})})]})},LC=({filters:c,onFiltersChange:u,savedFilters:x=[],onSaveFilter:f,onLoadFilter:w})=>{const[N,E]=oe.useState(!1),[A,n]=oe.useState(!1),[P,z]=oe.useState(""),q=te=>{u({...c,search:te.target.value||void 0,page:1})},U=te=>{u({...c,status:te.target.value||void 0,page:1})},W=(te,Ne)=>{u({...c,[te]:Ne||void 0,page:1})},X=(te,Ne)=>{u({...c,[te]:Ne?parseFloat(Ne):void 0,page:1})},Z=te=>{u({...c,delivery_area:te.target.value||void 0,page:1})},J=()=>{u({page:1})},de=()=>{P.trim()&&f&&(f(P.trim(),c),n(!1),z(""))},ne=[{name:"Today's Deliveries",filters:{scheduled_date_from:new Date().toISOString().split("T")[0],scheduled_date_to:new Date().toISOString().split("T")[0]}},{name:"Overdue Orders",filters:{is_overdue:!0}},{name:"Draft Orders",filters:{status:"draft"}},{name:"High Value Orders",filters:{amount_min:1e3}},{name:"This Week",filters:{order_date_from:new Date(Date.now()-7*864e5).toISOString().split("T")[0]}},{name:"Payment Overdue",filters:{payment_status:"overdue"}}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6 space-y-4",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by order ID, customer name, or product SKU...",value:c.search||"",onChange:q,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:U,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"confirmed",children:"Confirmed"}),t.jsx("option",{value:"scheduled",children:"Scheduled"}),t.jsx("option",{value:"en_route",children:"En Route"}),t.jsx("option",{value:"delivered",children:"Delivered"}),t.jsx("option",{value:"invoiced",children:"Invoiced"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})}),t.jsxs("button",{onClick:()=>E(!N),className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${N?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[t.jsx(Qd,{className:"h-4 w-4"}),t.jsx("span",{children:"Advanced"})]}),t.jsxs("button",{onClick:J,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(te=>t.jsx("button",{onClick:()=>u({...te.filters,page:1}),className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors",children:te.name},te.name))}),x.length>0&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Wh,{className:"h-4 w-4 text-yellow-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Saved Filters:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(te=>t.jsx("button",{onClick:()=>w==null?void 0:w(te),className:"px-3 py-1 text-sm bg-yellow-100 text-yellow-800 rounded-full hover:bg-yellow-200 transition-colors",children:te.name},te.id))})]}),N&&t.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Date From"}),t.jsxs("div",{className:"relative",children:[t.jsx($s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:c.order_date_from||"",onChange:te=>W("order_date_from",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Date To"}),t.jsx("input",{type:"date",value:c.order_date_to||"",onChange:te=>W("order_date_to",te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled From"}),t.jsxs("div",{className:"relative",children:[t.jsx($s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:c.scheduled_date_from||"",onChange:te=>W("scheduled_date_from",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled To"}),t.jsx("input",{type:"date",value:c.scheduled_date_to||"",onChange:te=>W("scheduled_date_to",te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx(Sn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:c.amount_min||"",onChange:te=>X("amount_min",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx(Sn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:c.amount_max||"",onChange:te=>X("amount_max",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Area"}),t.jsxs("div",{className:"relative",children:[t.jsx(Tn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:c.delivery_area||"",onChange:Z,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"City or region"})]})]})]}),f&&t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{onClick:()=>n(!0),className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(j_,{className:"h-4 w-4"}),t.jsx("span",{children:"Save Filter"})]})})]}),A&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>n(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Save Filter"}),t.jsx("button",{onClick:()=>n(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(Ya,{className:"h-6 w-6"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter Name"}),t.jsx("input",{type:"text",value:P,onChange:te=>z(te.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter a name for this filter..."})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:de,disabled:!P.trim(),className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Save Filter"}),t.jsx("button",{onClick:()=>n(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})})]})},RC=(c,u)=>yt.analytics.getComprehensiveOrderAnalytics.useQuery({start_date:c,end_date:u},{enabled:!!(c&&u),staleTime:6e4,retry:1,onError:x=>{console.error("Comprehensive order analytics error:",x),It.error("Failed to load order analytics")}}),zC=(c="month")=>yt.analytics.getOrderStats.useQuery({period:c},{staleTime:6e4,retry:1,refetchInterval:5*60*1e3,onError:u=>{console.error("Order stats error:",u),It.error("Failed to load order statistics")}}),OC=()=>{const{data:c,isLoading:u}=zC();if(u)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[...Array(10)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const x=[{name:"Total Orders",value:c.total_orders,icon:sc,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Draft",value:c.draft_orders,icon:sc,color:"text-gray-600",bgColor:"bg-gray-50"},{name:"Confirmed",value:c.confirmed_orders,icon:Gn,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Scheduled",value:c.scheduled_orders,icon:$s,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"En Route",value:c.en_route_orders,icon:mr,color:"text-orange-600",bgColor:"bg-orange-50"},{name:"Delivered",value:c.delivered_orders,icon:hs,color:"text-green-600",bgColor:"bg-green-50"},{name:"Invoiced",value:c.invoiced_orders,icon:w_,color:"text-teal-600",bgColor:"bg-teal-50"},{name:"Cancelled",value:c.cancelled_orders,icon:pa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Today's Deliveries",value:c.todays_deliveries,icon:$s,color:"text-indigo-600",bgColor:"bg-indigo-50"},{name:"Overdue",value:c.overdue_orders,icon:Us,color:"text-red-600",bgColor:"bg-red-50"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:x.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Revenue"}),t.jsx("p",{className:"text-sm text-gray-600",children:"From invoiced orders"})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-green-50 rounded-full",children:t.jsx(Ji,{className:"h-6 w-6 text-green-600"})}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"text-3xl font-bold text-gray-900",children:c.total_revenue?ls(c.total_revenue):"Ksh 0.00"})})]})]})}),(c.overdue_orders>0||c.todays_deliveries>0)&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.todays_deliveries>0&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-5 w-5 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Today's Deliveries"}),t.jsxs("p",{className:"text-sm text-blue-700",children:[c.todays_deliveries," order",c.todays_deliveries>1?"s":""," scheduled for delivery today"]})]})]})}),c.overdue_orders>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Overdue Orders"}),t.jsxs("p",{className:"text-sm text-red-700",children:[c.overdue_orders," order",c.overdue_orders>1?"s are":" is"," past scheduled delivery date"]})]})]})})]})]})},Tv=({isOpen:c,onClose:u,onSubmit:x,order:f,newStatus:w,loading:N=!1})=>{const{register:E,handleSubmit:A,reset:n,formState:{errors:P},watch:z}=Cn({defaultValues:{order_id:f.id,new_status:w,notes:"",scheduled_date:""}}),q=z("scheduled_date");oe.useEffect(()=>{n({order_id:f.id,new_status:w,notes:"",scheduled_date:w==="scheduled"?new Date().toISOString().split("T")[0]:""})},[f.id,w,n]);const U=ne=>{x(ne)},W=ic(w),X=w==="scheduled",J=(()=>{const ne=[];if(w==="confirmed"){const te=PE(f);ne.push(...te.errors)}else w==="scheduled"&&(q||ne.push("Scheduled date is required"),f.delivery_address||ne.push("Delivery address is required"));return ne})(),de=J.length===0;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:u}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(U),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Change Order Status"}),t.jsx("button",{type:"button",onClick:u,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current Status:"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${ic(f.status).color}`,children:f.status.replace("_"," ").toUpperCase()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"New Status:"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${W.color}`,children:w.replace("_"," ").toUpperCase()})]}),t.jsx("div",{className:"mt-2 text-sm text-gray-600",children:W.description})]}),J.length>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Cannot proceed:"}),t.jsx("ul",{className:"mt-1 text-sm text-red-700 list-disc list-inside",children:J.map((ne,te)=>t.jsx("li",{children:ne},te))})]})]})}),X&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"scheduled_date",className:"block text-sm font-medium text-gray-700",children:"Scheduled Delivery Date *"}),t.jsx("input",{type:"date",id:"scheduled_date",...E("scheduled_date",{required:X?"Scheduled date is required":!1,validate:ne=>{if(X&&ne){const te=new Date(ne),Ne=new Date;if(Ne.setHours(0,0,0,0),te<Ne)return"Scheduled date cannot be in the past"}return!0}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]}),P.scheduled_date&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.scheduled_date.message})]}),w==="confirmed"&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Note:"})," Confirming this order will reserve inventory for all products."]})}),w==="delivered"&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Note:"})," Marking as delivered will deduct inventory and release reserved stock."]})}),w==="cancelled"&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-red-800",children:[t.jsx("strong",{children:"Warning:"})," Cancelling this order will release any reserved inventory."]})})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||!de,className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed ${w==="cancelled"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}`,children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Updating..."})]}):`Change to ${W.label}`}),t.jsx("button",{type:"button",onClick:u,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},FC=({selectedOrders:c,onClearSelection:u,onBulkOperation:x})=>{const[f,w]=oe.useState(!1),[N,E]=oe.useState(!1),[A,n]=oe.useState(!1),[P,z]=oe.useState(""),[q,U]=oe.useState(""),[W,X]=oe.useState("");if(c.length===0)return null;const Z=he=>c.every(Ce=>{switch(he){case"confirmed":return Ce.status==="draft";case"scheduled":return Ce.status==="confirmed";case"cancelled":return["draft","confirmed","scheduled"].includes(Ce.status);default:return!1}}),J=()=>{P&&(x({order_ids:c.map(he=>he.id),operation:"schedule",scheduled_date:P,notes:W}),E(!1),z(""),X(""))},de=()=>{q&&(x({order_ids:c.map(he=>he.id),operation:"status_change",new_status:q,notes:W}),n(!1),U(""),X(""))},ne=()=>{x({order_ids:c.map(he=>he.id),operation:"export"}),w(!1)},te=()=>{x({order_ids:c.map(he=>he.id),operation:"print"}),w(!1)},Ne=c.reduce((he,Ce)=>he+(Ce.total_amount||0),0);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[c.length," order",c.length>1?"s":""," selected"]}),t.jsxs("span",{className:"text-sm text-blue-700",children:["Total value: $",Ne.toLocaleString()]}),t.jsxs("button",{onClick:u,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center space-x-1",children:[t.jsx(er,{className:"h-3 w-3"}),t.jsx("span",{children:"Clear selection"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>w(!f),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx("span",{children:"Bulk Actions"}),t.jsx(am,{className:"h-4 w-4"})]}),f&&t.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg border border-gray-200 z-10",children:t.jsxs("div",{className:"py-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Status Changes"}),Z("confirmed")&&t.jsxs("button",{onClick:()=>{U("confirmed"),n(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Gn,{className:"h-4 w-4 text-blue-600"}),t.jsx("span",{children:"Confirm Orders"})]}),Z("scheduled")&&t.jsxs("button",{onClick:()=>{E(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx($s,{className:"h-4 w-4 text-purple-600"}),t.jsx("span",{children:"Schedule Deliveries"})]}),Z("cancelled")&&t.jsxs("button",{onClick:()=>{U("cancelled"),n(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(er,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{children:"Cancel Orders"})]}),t.jsxs("div",{className:"border-t border-gray-100 mt-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Export & Print"}),t.jsxs("button",{onClick:ne,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Vf,{className:"h-4 w-4 text-green-600"}),t.jsx("span",{children:"Export to CSV"})]}),t.jsxs("button",{onClick:te,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(y_,{className:"h-4 w-4 text-gray-600"}),t.jsx("span",{children:"Print Manifests"})]})]})]})})]})]})}),N&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>E(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:["Schedule ",c.length," Orders"]}),t.jsx("button",{onClick:()=>E(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Delivery Date *"}),t.jsx("input",{type:"date",value:P,onChange:he=>z(he.target.value),min:new Date().toISOString().split("T")[0],className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),t.jsx("textarea",{value:W,onChange:he=>X(he.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Add notes for this bulk scheduling..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:J,disabled:!P,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Schedule Orders"}),t.jsx("button",{onClick:()=>E(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})}),A&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>n(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:[q==="confirmed"&&"Confirm Orders",q==="cancelled"&&"Cancel Orders"]}),t.jsx("button",{onClick:()=>n(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-gray-700",children:["This will change the status of ",c.length," selected orders to"," ",t.jsx("span",{className:"font-medium",children:q}),"."]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:q==="cancelled"?"Cancellation Reason *":"Notes (Optional)"}),t.jsx("textarea",{value:W,onChange:he=>X(he.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:q==="cancelled"?"Please provide a reason for cancellation...":"Add notes for this status change..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsxs("button",{onClick:de,disabled:q==="cancelled"&&!W.trim(),className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed ${q==="cancelled"?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"}`,children:[q==="confirmed"&&"Confirm Orders",q==="cancelled"&&"Cancel Orders"]}),t.jsx("button",{onClick:()=>n(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})})]})},BC=()=>{const c=Qr(),[u,x]=oe.useState({page:1}),[f,w]=oe.useState(null),[N,E]=oe.useState([]),{data:A,isLoading:n,error:P,refetch:z}=Nv(u),q=Sv();oe.useEffect(()=>{console.log("OrdersPage state:",{filters:u,data:A,isLoading:n,error:P,statusChangeOrder:f,selectedOrders:N})},[u,A,n,P,f,N]);const U=()=>{console.log("Creating new order"),c("/orders/new")},W=fe=>{console.log("Viewing order:",fe),c(`/orders/${fe.id}`)},X=fe=>{console.log("Editing order:",fe),c(`/orders/${fe.id}/edit`)},Z=(fe,Ie)=>{console.log("Changing order status:",fe,Ie),w({order:fe,newStatus:Ie})},J=async fe=>{console.log("Status change submit:",fe);try{await q.mutateAsync(fe),w(null)}catch(Ie){console.error("Status change error:",Ie)}},de=async fe=>{switch(console.log("Bulk operation:",fe),fe.operation){case"status_change":if(fe.new_status)for(const Ie of fe.order_ids)(A==null?void 0:A.orders.find(tt=>tt.id===Ie))&&await q.mutateAsync({order_id:Ie,new_status:fe.new_status,notes:fe.notes});break;case"schedule":if(fe.scheduled_date)for(const Ie of fe.order_ids)await q.mutateAsync({order_id:Ie,new_status:"scheduled",scheduled_date:fe.scheduled_date,notes:fe.notes});break;case"export":ne(fe.order_ids);break;case"print":te(fe.order_ids);break}E([])},ne=fe=>{const Ie=(A==null?void 0:A.orders.filter(it=>fe.includes(it.id)))||[],Ee=[["Order ID","Customer","Status","Order Date","Scheduled Date","Total Amount"],...Ie.map(it=>{var ct,Nt;return[it.id,((ct=it.customer)==null?void 0:ct.name)||"",it.status,it.order_date,it.scheduled_date||"",((Nt=it.total_amount)==null?void 0:Nt.toString())||"0"]})].map(it=>it.join(",")).join(`
`),tt=new Blob([Ee],{type:"text/csv"}),je=window.URL.createObjectURL(tt),Pe=document.createElement("a");Pe.href=je,Pe.download=`orders-export-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Pe),Pe.click(),document.body.removeChild(Pe),window.URL.revokeObjectURL(je)},te=fe=>{console.log("Print manifests for orders:",fe)},Ne=fe=>{console.log("Page change:",fe),x(Ie=>({...Ie,page:fe}))},he=()=>{console.log("Refreshing orders"),z()},Ce=fe=>{E(fe)},Ae=()=>{E([])};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Management"}),t.jsx("p",{className:"text-gray-600",children:"Manage customer orders and deliveries"}),P&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",P.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>c("/orders/reports"),className:"flex items-center space-x-2 bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:[t.jsx(Xo,{className:"h-4 w-4"}),t.jsx("span",{children:"Reports"})]}),t.jsxs("button",{onClick:()=>c("/orders/schedule"),className:"flex items-center space-x-2 bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx($s,{className:"h-4 w-4"}),t.jsx("span",{children:"Schedule"})]}),t.jsxs("button",{onClick:he,disabled:n,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${n?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:U,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Create Order"})]})]})]}),t.jsx(OC,{}),t.jsx(LC,{filters:u,onFiltersChange:x}),t.jsx(FC,{selectedOrders:(A==null?void 0:A.orders.filter(fe=>N.includes(fe.id)))||[],onClearSelection:Ae,onBulkOperation:de}),t.jsx(DC,{orders:(A==null?void 0:A.orders)||[],loading:n,onView:W,onEdit:X,onChangeStatus:Z,selectedOrders:N,onSelectionChange:Ce}),A&&A.totalPages>1&&t.jsx(ac,{currentPage:A.currentPage,totalPages:A.totalPages,totalCount:A.totalCount,onPageChange:Ne}),f&&t.jsx(Tv,{isOpen:!!f,onClose:()=>w(null),onSubmit:J,order:f.order,newStatus:f.newStatus,loading:q.isPending})]})},UC=({value:c,onChange:u,customers:x,placeholder:f="Search customer...",className:w=""})=>{const[N,E]=oe.useState(!1),[A,n]=oe.useState(""),[P,z]=oe.useState([]);oe.useEffect(()=>{if(A){const X=x.filter(Z=>Z.name.toLowerCase().includes(A.toLowerCase())||Z.external_id&&Z.external_id.toLowerCase().includes(A.toLowerCase())||Z.tax_id&&Z.tax_id.toLowerCase().includes(A.toLowerCase()));z(X)}else z(x)},[A,x]);const q=x.find(X=>X.id===c),U=X=>{u(X),E(!1),n("")},W=()=>{u(""),n("")};return t.jsxs("div",{className:`relative ${w}`,children:[t.jsx("div",{className:"relative",children:t.jsx("div",{onClick:()=>E(!N),className:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 cursor-pointer",children:q?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:q.name}),q.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",q.external_id]})]}),t.jsx("button",{onClick:X=>{X.stopPropagation(),W()},className:"text-gray-400 hover:text-gray-600",children:t.jsx(er,{className:"h-4 w-4"})})]}):t.jsxs("div",{className:"flex items-center justify-between text-gray-500",children:[t.jsx("span",{children:f}),t.jsx(am,{className:"h-4 w-4"})]})})}),N&&t.jsxs("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:[t.jsx("div",{className:"p-2",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:A,onChange:X=>n(X.target.value),placeholder:"Type to search...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0})]})}),t.jsx("div",{className:"max-h-60 overflow-auto",children:P.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No customers found"}):P.map(X=>t.jsxs("div",{onClick:()=>U(X.id),className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsx("div",{className:"font-medium text-gray-900",children:X.name}),X.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",X.external_id]}),X.tax_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Tax ID: ",X.tax_id]})]},X.id))})]})]})},VC=({orderType:c,serviceType:u,exchangeEmptyQty:x,requiresPickup:f,onOrderTypeChange:w,onServiceTypeChange:N,onExchangeEmptyQtyChange:E,onRequiresPickupChange:A,disabled:n=!1})=>{const P=[{value:"delivery",label:"Standard Delivery",description:"Deliver full cylinders to customer",icon:mr,color:"bg-blue-50 border-blue-200 text-blue-800",selectedColor:"bg-blue-100 border-blue-300"},{value:"refill",label:"Refill Service",description:"Deliver full cylinders and collect empties",icon:Ya,color:"bg-green-50 border-green-200 text-green-800",selectedColor:"bg-green-100 border-green-300"},{value:"exchange",label:"Cylinder Exchange",description:"Exchange empties for full cylinders",icon:p_,color:"bg-orange-50 border-orange-200 text-orange-800",selectedColor:"bg-orange-100 border-orange-300"},{value:"pickup",label:"Empty Pickup",description:"Collect empty cylinders only",icon:b_,color:"bg-purple-50 border-purple-200 text-purple-800",selectedColor:"bg-purple-100 border-purple-300"}],z=[{value:"standard",label:"Standard Service",description:"Regular delivery schedule",icon:Qi},{value:"express",label:"Express Service",description:"Priority delivery",icon:cS},{value:"scheduled",label:"Scheduled Service",description:"Specific delivery time",icon:$s}],q=U=>{w(U),of(U)?A(!0):U==="delivery"&&A(!1),U==="delivery"&&E(0)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Type"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:P.map(U=>{const W=U.icon,X=c===U.value;return t.jsxs("button",{type:"button",onClick:()=>q(U.value),disabled:n,className:`relative p-4 border-2 rounded-lg text-left transition-all hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${X?U.selectedColor:U.color}`,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(W,{className:"h-6 w-6 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:U.label}),t.jsx("p",{className:"text-sm opacity-80 mt-1",children:U.description})]})]}),X&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("div",{className:"w-3 h-3 bg-current rounded-full"})})]},U.value)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Service Type"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:z.map(U=>{const W=U.icon,X=u===U.value;return t.jsxs("button",{type:"button",onClick:()=>N(U.value),disabled:n,className:`relative p-4 border-2 rounded-lg text-left transition-all hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${X?"bg-gray-100 border-gray-300 text-gray-900":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(W,{className:"h-5 w-5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:U.label}),t.jsx("p",{className:"text-sm opacity-80 mt-1",children:U.description})]})]}),X&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"})})]},U.value)})})]}),(c==="refill"||c==="exchange"||c==="pickup")&&t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:c==="pickup"?"Pickup Details":"Exchange Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"exchange_empty_qty",className:"block text-sm font-medium text-gray-700",children:c==="pickup"?"Empty Cylinders to Collect *":"Empty Cylinders to Exchange *"}),t.jsx("input",{type:"number",id:"exchange_empty_qty",min:"0",value:x,onChange:U=>E(parseInt(U.target.value)||0),disabled:n,className:"mt-1 block w-full sm:w-32 rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50",placeholder:"0"}),t.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[c==="refill"&&"Number of empty cylinders customer will return",c==="exchange"&&"Number of empty cylinders to collect from customer",c==="pickup"&&"Number of empty cylinders to collect"]})]}),c!=="pickup"&&t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"requires_pickup",checked:f,onChange:U=>A(U.target.checked),disabled:n||of(c),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded disabled:opacity-50"}),t.jsxs("label",{htmlFor:"requires_pickup",className:"ml-2 block text-sm text-gray-700",children:["Requires pickup of empty cylinders",of(c)&&t.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Required for this order type)"})]})]})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:[qE(c)," - ",$E(u)]}),t.jsxs("div",{className:"text-sm text-blue-800",children:[c==="delivery"&&t.jsx("p",{children:"Standard delivery of full cylinders to the customer's address."}),c==="refill"&&t.jsxs("div",{children:[t.jsx("p",{children:"Delivery of full cylinders with collection of empty cylinders."}),t.jsx("p",{className:"mt-1",children:" Deliver: Full cylinders as per order"}),t.jsxs("p",{children:[" Collect: ",x||0," empty cylinders"]})]}),c==="exchange"&&t.jsxs("div",{children:[t.jsx("p",{children:"Exchange service where empties are swapped for full cylinders."}),t.jsx("p",{className:"mt-1",children:" Deliver: Full cylinders as per order"}),t.jsxs("p",{children:[" Collect: ",x||0," empty cylinders"]})]}),c==="pickup"&&t.jsxs("div",{children:[t.jsx("p",{children:"Collection of empty cylinders only."}),t.jsxs("p",{className:"mt-1",children:[" Collect: ",x||0," empty cylinders"]})]})]})]})]})},qC=(c,u,x=!0)=>s_({queryKey:["productPrices",c.sort().join(","),u],queryFn:async()=>c.length?await yt.pricing.getProductPrices.query({productIds:c,customerId:u}):{},enabled:!!(x&&c.length>0),staleTime:5*60*1e3}),$C=()=>{const c=Qr(),[u,x]=oe.useState(1),[f,w]=oe.useState(""),[N,E]=oe.useState(""),[A,n]=oe.useState(new Date().toISOString().split("T")[0]),[P,z]=oe.useState([]),[q,U]=oe.useState(""),[W,X]=oe.useState(0),[Z,J]=oe.useState(!1),[de,ne]=oe.useState("delivery"),[te,Ne]=oe.useState("standard"),[he,Ce]=oe.useState(0),[Ae,fe]=oe.useState(!1),{data:Ie}=N_({limit:1e3}),{data:Ee=[]}=lv(f),{data:tt}=cc({limit:1e3}),{data:je}=Jf({limit:1e3}),Pe=PC(),it=cv(),ct=(Ie==null?void 0:Ie.customers)||[],Nt=(tt==null?void 0:tt.products)||[],ft=(je==null?void 0:je.priceLists)||[],Mt=Nt.map(De=>De.id),{data:ht}=qC(Mt,f||void 0),Os=new Date().toISOString().split("T")[0],ns=ft.filter(De=>!(De.end_date&&De.end_date<Os||De.start_date&&De.start_date>Os)),_s=ns.find(De=>De.is_default)||ns[0];Nt.filter(De=>De.status==="active").map(De=>De.id);const pr=ct.find(De=>De.id===f),Ut=Ee.find(De=>De.id===N),[fr,Fr]=oe.useState({subtotal:0,taxAmount:0,grandTotal:0}),[jr,gr]=oe.useState(!1);oe.useEffect(()=>{(async()=>{if(P.length===0){Fr({subtotal:0,taxAmount:0,grandTotal:0});return}gr(!0);try{const xt=await mv(P,W);Fr(xt)}catch(xt){console.error("Failed to calculate order totals:",xt)}finally{gr(!1)}})()},[P,W]);const Br=fr.subtotal,_r=fr.taxAmount,Jr=fr.grandTotal,Qt=De=>{w(De),E("")};oe.useEffect(()=>{if(f&&Ee.length>0&&!N){const De=Ee.find(xt=>xt.is_primary);De&&E(De.id)}},[f,Ee,N]);const gi=async De=>{try{const xt=await yt.pricing.getProductPrice.query({productId:De,customerId:f||void 0});return(xt==null?void 0:xt.finalPrice)||0}catch(xt){return console.error("Failed to fetch product price:",xt),0}},vr=De=>ht&&ht[De]?ht[De].finalPrice:0,Mi=async De=>{const xt=Nt.find(sr=>sr.id===De);if(!xt)return;const Jt=P.find(sr=>sr.product_id===De),qt=await gi(De),vs=Ge();if(Jt){if(Jt.quantity>=vs){alert(`Cannot add more items. Only ${vs} units available in stock.`);return}z(sr=>sr.map(Ls=>Ls.product_id===De?{...Ls,quantity:Ls.quantity+1,subtotal:(Ls.quantity+1)*Ls.unit_price}:Ls))}else{const sr={product_id:De,product_name:xt.name,product_sku:xt.sku,quantity:1,unit_price:qt,subtotal:qt};z(Ls=>[...Ls,sr])}},As=(De,xt)=>{if(xt<=0){Ir(De);return}const Jt=Ge();if(xt>Jt){alert(`Cannot set quantity to ${xt}. Only ${Jt} units available in stock.`);return}z(qt=>qt.map(vs=>vs.product_id===De?{...vs,quantity:xt,subtotal:xt*vs.unit_price}:vs))},Ir=De=>{z(xt=>xt.filter(Jt=>Jt.product_id!==De))},Zn=async()=>{if(!(!f||!N||P.length===0))try{const De={customer_id:f,delivery_address_id:N,order_date:A,status:"draft",notes:q,tax_percent:W,tax_amount:_r,total_amount:Jr,order_type:de,service_type:te,exchange_empty_qty:he,requires_pickup:Ae},xt=await Pe.mutateAsync(De);c(`/orders/${xt.id}`)}catch(De){console.error("Error creating order:",De)}},Zr=f&&N,we=Zr&&P.length>0,Ge=De=>999,et=De=>(console.log("Stock status for quantity",De),"text-green-600"),Ct=()=>{f&&J(!0)},wt=async De=>{try{const xt=await it.mutateAsync(De);E(xt.id),J(!1)}catch{}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create New Order"})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("div",{className:"flex items-center justify-between mb-6",children:t.jsxs("div",{className:"flex items-center space-x-8",children:[t.jsxs("div",{className:`flex items-center space-x-2 ${u>=1?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${u>=1?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),t.jsx("span",{className:"font-medium",children:"Customer & Delivery"})]}),t.jsx("div",{className:`w-16 h-0.5 ${u>=2?"bg-blue-600":"bg-gray-200"}`}),t.jsxs("div",{className:`flex items-center space-x-2 ${u>=2?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${u>=2?"bg-blue-600 text-white":"bg-gray-200"}`,children:"2"}),t.jsx("span",{className:"font-medium",children:"Add Products"})]}),t.jsx("div",{className:`w-16 h-0.5 ${u>=3?"bg-blue-600":"bg-gray-200"}`}),t.jsxs("div",{className:`flex items-center space-x-2 ${u>=3?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${u>=3?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),t.jsx("span",{className:"font-medium",children:"Review & Create"})]})]})}),u===1&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"mb-6",children:t.jsx(VC,{selectedOrderType:de,selectedServiceType:te,exchangeEmptyQty:he,requiresPickup:Ae,onOrderTypeChange:ne,onServiceTypeChange:Ne,onExchangeEmptyQtyChange:Ce,onRequiresPickupChange:fe})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(lm,{className:"inline h-4 w-4 mr-1"}),"Select Customer *"]}),t.jsx(UC,{value:f,onChange:Qt,customers:ct,placeholder:"Search for a customer..."})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx($s,{className:"inline h-4 w-4 mr-1"}),"Order Date *"]}),t.jsx("input",{type:"date",value:A,onChange:De=>n(De.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),f&&t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Tn,{className:"inline h-4 w-4 mr-1"}),"Delivery Address *"]}),Ee.length>0?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("select",{value:N,onChange:De=>E(De.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Choose a delivery address..."}),Ee.map(De=>t.jsx("option",{value:De.id,children:SE(De)},De.id))]}),Ut&&t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Selected Address:"}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("div",{children:Ut.line1}),Ut.line2&&t.jsx("div",{children:Ut.line2}),t.jsxs("div",{children:[Ut.city,", ",Ut.state," ",Ut.postal_code]}),Ut.instructions&&t.jsxs("div",{className:"mt-2 text-gray-600",children:[t.jsx("strong",{children:"Instructions:"})," ",Ut.instructions]})]})]})]}):t.jsxs("div",{className:"text-center py-8 border border-gray-200 rounded-lg bg-yellow-50",children:[t.jsx(Us,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No delivery addresses found"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"This customer doesn't have any delivery addresses yet."}),t.jsxs("button",{onClick:Ct,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Address for Customer"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Notes"}),t.jsx("textarea",{value:q,onChange:De=>U(De.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional notes about this order..."})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>x(2),disabled:!Zr,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Add Products"})})]}),u===2&&t.jsxs("div",{className:"space-y-6",children:[!_s&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("span",{className:"text-sm text-yellow-800",children:["No active price list found. Product prices may not be available.",ft.length>0?`Found ${ft.length} price list(s) but none are currently active.`:"No price lists exist yet."]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Available Products"}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:Nt.filter(De=>De.status==="active").map(De=>{const xt=Ge(De.id),Jt=vr(De.id),qt=P.find(yi=>yi.product_id===De.id),vs=!!qt,sr=(qt==null?void 0:qt.quantity)||0;et(xt);const Ls=sr<xt,xi=xt===0,Wr=Jt===0,Dr=Wr||!Ls;return t.jsx("div",{className:`p-3 border rounded-lg transition-all ${vs?"bg-blue-50 border-blue-200":Dr?"bg-gray-50 border-gray-200 opacity-75":"border-gray-200 hover:border-gray-300"}`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"font-medium text-gray-900",children:De.name}),vs&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"In Order"})]}),t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["SKU: ",De.sku]}),t.jsx("div",{className:"flex items-center space-x-2 mb-2",children:t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(GN,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:[xt," available",vs?` (${sr} in order)`:""]})]})}),t.jsx("div",{className:"flex items-center space-x-2 mb-3",children:Wr?t.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[t.jsx(Sn,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm font-medium",children:["No price set",_s?` in ${_s.name}`:""]})]}):t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(Sn,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:ls(Jt)}),_s&&t.jsxs("span",{className:"text-xs text-gray-500",children:["(",_s.name,")"]})]})}),Dr&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-2 mt-2",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(KN,{className:"h-4 w-4 text-yellow-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-yellow-800",children:[xi,Wr&&!xi&&t.jsxs(t.Fragment,{children:["No pricing configured for this product.",t.jsx("button",{onClick:()=>window.open("/pricing","_blank"),className:"ml-1 text-blue-600 hover:text-blue-800 underline",children:"Set up pricing"})]}),!Ls&&!xi&&!Wr&&`Maximum quantity (${xt}) already in order.`]})]})})]}),t.jsx("div",{className:"ml-4 flex-shrink-0",children:t.jsx("button",{onClick:()=>Mi(De.id),disabled:Dr,title:Dr?Wr?"No price set":"Maximum quantity reached":"Add to order",className:`
                                flex items-center justify-center w-10 h-10 rounded-lg text-sm font-medium transition-all
                                ${Dr?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm hover:shadow"}
                              `,children:t.jsx(wr,{className:"h-4 w-4"})})})]})},De.id)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Items"}),P.length>0?t.jsxs("div",{className:"space-y-3",children:[P.map(De=>{const xt=Ge(De.product_id);return t.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:De.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",De.product_sku]})]}),t.jsx("button",{onClick:()=>Ir(De.product_id),className:"text-red-600 hover:text-red-800",children:t.jsx(to,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("label",{className:"text-sm text-gray-600",children:"Qty:"}),t.jsx("input",{type:"number",min:"1",max:xt,value:De.quantity,onChange:Jt=>As(De.product_id,parseInt(Jt.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(max: ",xt,")"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(De.unit_price)," each"]}),t.jsx("div",{className:"font-medium text-gray-900",children:ls(De.subtotal)})]})]})]},De.product_id)}),t.jsxs("div",{className:"border-t pt-3",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Subtotal:"}),t.jsx("span",{className:"text-xl font-bold text-gray-900",children:ls(Br)})]}),t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tax (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",value:W,onChange:De=>X(Number(De.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm text-right"})]}),t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Tax:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:ls(_r)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:ls(Jr)})]})]})]}):t.jsxs("div",{className:"text-center py-8 border border-gray-200 rounded-lg",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No products added yet."}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Select products from the left to add them to the order."})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("button",{onClick:()=>x(1),className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200",children:"Back"}),t.jsx("button",{onClick:()=>x(3),disabled:P.length===0,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Review"})]})]}),u===3&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Customer:"}),t.jsx("div",{className:"text-gray-900",children:pr==null?void 0:pr.name})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Delivery Address:"}),t.jsxs("div",{className:"text-gray-900",children:[Ut==null?void 0:Ut.line1,(Ut==null?void 0:Ut.line2)&&t.jsx("div",{children:Ut.line2}),t.jsxs("div",{children:[Ut==null?void 0:Ut.city,", ",Ut==null?void 0:Ut.state," ",Ut==null?void 0:Ut.postal_code]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Order Date:"}),t.jsx("div",{className:"text-gray-900",children:new Date(A).toLocaleDateString()})]}),q&&t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notes:"}),t.jsx("div",{className:"text-gray-900",children:q})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tax (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",value:W,onChange:De=>X(Number(De.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm text-right"})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Items"}),t.jsxs("div",{className:"space-y-2",children:[P.map(De=>t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-200",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:De.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:[De.quantity,"  ",ls(De.unit_price)]})]}),t.jsx("div",{className:"font-medium text-gray-900",children:ls(De.subtotal)})]},De.product_id)),t.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-300",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Subtotal:"}),t.jsx("span",{className:"text-xl font-bold text-gray-900",children:ls(Br)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Tax:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:ls(_r)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:ls(Jr)})]})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("button",{onClick:()=>x(2),className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200",children:"Back"}),t.jsxs("button",{onClick:Zn,disabled:!we||Pe.isPending,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(sc,{className:"h-4 w-4"}),t.jsx("span",{children:Pe.isPending?"Creating...":"Create Order"})]})]})]})]}),t.jsx(hv,{isOpen:Z,onClose:()=>J(!1),onSubmit:wt,customerId:f,loading:it.isPending,title:"Add New Address",isFirstAddress:Ee.length===0})]})},GC=({statusHistory:c,currentStatus:u,estimatedDates:x={}})=>{const f=n=>new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=(n,P)=>(ic(n),P?t.jsx(Gn,{className:"h-5 w-5 text-green-600"}):n===u?t.jsx(Qi,{className:"h-5 w-5 text-blue-600"}):t.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-gray-300 bg-white"})),N=(n,P)=>P?"border-green-200 bg-green-50":n===u?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50",E=["draft","confirmed","scheduled","en_route","delivered","invoiced"],A=E.indexOf(u);return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Order Timeline"}),t.jsx("div",{className:"space-y-4",children:E.map((n,P)=>{const z=P<A||n===u&&u!=="cancelled",q=n===u,U=ic(n),W=c.find(Z=>Z.status===n),X=x[n];return n==="cancelled"&&u!=="cancelled"?null:t.jsxs("div",{className:`relative flex items-start space-x-4 p-4 rounded-lg border ${N(n,z)}`,children:[P<E.length-1&&n!=="cancelled"&&t.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-8 bg-gray-200"}),t.jsx("div",{className:"flex-shrink-0 mt-1",children:w(n,z)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:`text-sm font-medium ${z||q?"text-gray-900":"text-gray-500"}`,children:U.label}),W&&t.jsx("span",{className:"text-xs text-gray-500",children:f(W.changed_at)})]}),t.jsx("p",{className:`text-sm mt-1 ${z||q?"text-gray-600":"text-gray-400"}`,children:U.description}),(W||X)&&t.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs",children:[W&&t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(Gn,{className:"h-3 w-3"}),t.jsxs("span",{children:["Completed: ",f(W.changed_at)]})]}),X&&!W&&t.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[t.jsx($s,{className:"h-3 w-3"}),t.jsxs("span",{children:["Estimated: ",f(X)]})]})]}),W&&t.jsxs("div",{className:"mt-3 space-y-2",children:[W.user_name&&t.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[t.jsx(lm,{className:"h-3 w-3"}),t.jsxs("span",{children:["Changed by: ",W.user_name]})]}),W.notes&&t.jsxs("div",{className:"flex items-start space-x-1 text-xs text-gray-600",children:[t.jsx(sS,{className:"h-3 w-3 mt-0.5"}),t.jsx("span",{children:W.notes})]})]}),q&&t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Current Status"})})]})]},n)})}),c.length>1&&t.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Performance Metrics"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Order Processing Time:"}),t.jsx("div",{className:"font-medium text-gray-900",children:(()=>{var z,q;const n=(z=c.find(U=>U.status==="draft"))==null?void 0:z.changed_at,P=(q=c.find(U=>U.status==="confirmed"))==null?void 0:q.changed_at;return n&&P?`${Math.round((new Date(P).getTime()-new Date(n).getTime())/36e5)} hours`:"N/A"})()})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Fulfillment Time:"}),t.jsx("div",{className:"font-medium text-gray-900",children:(()=>{var z,q;const n=(z=c.find(U=>U.status==="confirmed"))==null?void 0:z.changed_at,P=(q=c.find(U=>U.status==="delivered"))==null?void 0:q.changed_at;return n&&P?`${Math.round((new Date(P).getTime()-new Date(n).getTime())/864e5)} days`:"N/A"})()})]})]})]})]})},ZC=({isOpen:c,onClose:u,order:x})=>{const[f,w]=oe.useState(0),[N,E]=oe.useState(""),[A,n]=oe.useState({subtotal:0,taxAmount:0,grandTotal:0}),[P,z]=oe.useState(!1),q=IC();if(oe.useEffect(()=>{x&&(w(x.tax_percent||0),E(x.notes||""))},[x]),oe.useEffect(()=>{(async()=>{if(!(x!=null&&x.order_lines)||x.order_lines.length===0){n({subtotal:0,taxAmount:0,grandTotal:0});return}z(!0);try{const de=x.order_lines.map(te=>({quantity:te.quantity,unit_price:te.unit_price,subtotal:te.subtotal||te.quantity*te.unit_price})),ne=await mv(de,f);n(ne)}catch(de){console.error("Failed to calculate order totals:",de)}finally{z(!1)}})()},[x,f]),!c||!x)return null;const U=A.subtotal,W=A.taxAmount,X=A.grandTotal,Z=async J=>{J.preventDefault();try{await q.mutateAsync({id:x.id,tax_percent:f,tax_amount:W,total_amount:X,notes:N}),u()}catch(de){console.error("Error updating order:",de)}};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Edit Order"}),t.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(er,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:Z,className:"p-6 space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Order Summary"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),t.jsx("span",{className:"font-medium text-gray-900",children:ls(U)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600",children:["Tax (",f,"%):"]}),t.jsx("span",{className:"font-medium text-gray-900",children:ls(W)})]}),t.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-2",children:[t.jsx("span",{className:"font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"font-bold text-gray-900",children:ls(X)})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"taxPercent",className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Percentage (%)"}),t.jsx("input",{type:"number",id:"taxPercent",min:"0",max:"100",step:"0.01",value:f,onChange:J=>w(Number(J.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),t.jsx("textarea",{id:"notes",rows:3,value:N,onChange:J=>E(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Add any additional notes..."})]}),t.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{type:"button",onClick:async()=>{try{await q(x.id,f),Kr.success("Total amount recalculated")}catch(J){console.error("Error recalculating total:",J),Kr.error("Failed to recalculate total")}},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Recalculate Total"}),t.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:updateOrder.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(j_,{className:"h-4 w-4"}),t.jsx("span",{children:updateOrder.isPending?"Saving...":"Save Changes"})]})]})]})]})})},WC=()=>{var ne,te,Ne,he,Ce,Ae,fe,Ie,Ee,tt;const{id:c}=nc(),u=Qr(),[x,f]=oe.useState(null),[w,N]=oe.useState(!1),[E,A]=oe.useState(!1),{data:n,isLoading:P,error:z}=MC(c),q=Sv(),U=je=>{n&&f({order:n,newStatus:je})},W=async je=>{try{await q.mutateAsync(je),f(null)}catch(Pe){console.error("Status change error:",Pe)}},X=je=>new Date(je).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(P)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(z||!n)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>u("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Order not found or error loading order details."})})})]});const Z=ic(n.status),J=af(n.status),de=[{id:"1",order_id:n.id,status:"draft",changed_by:"system",changed_at:n.created_at,user_name:"System",notes:"Order created"},...n.status!=="draft"?[{id:"2",order_id:n.id,status:"confirmed",changed_by:"admin",changed_at:new Date(new Date(n.created_at).getTime()+36e5).toISOString(),user_name:"Admin User",notes:"Order confirmed and inventory reserved"}]:[]];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>u("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Order ",formatOrderIdSync(n.id)]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>N(!w),className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(Qi,{className:"h-4 w-4"}),t.jsxs("span",{children:[w?"Hide":"Show"," Timeline"]})]}),["draft","confirmed"].includes(n.status)&&t.jsxs("button",{onClick:()=>A(!0),className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(di,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Order"})]}),J.map(je=>t.jsxs("button",{onClick:()=>U(je),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[je==="confirmed"&&"Confirm Order",je==="scheduled"&&"Schedule Delivery",je==="en_route"&&"Mark En Route",je==="delivered"&&"Mark Delivered",je==="invoiced"&&"Generate Invoice",je==="cancelled"&&"Cancel Order"]},je))]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Order ",formatOrderIdSync(n.id)]}),t.jsxs("p",{className:"text-gray-600",children:["Created on ",X(n.created_at)]})]}),t.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${Z.color}`,children:n.status.replace("_"," ").toUpperCase()})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:t.jsx(lm,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Customer"}),t.jsx("p",{className:"text-gray-600",children:(ne=n.customer)==null?void 0:ne.name}),((te=n.customer)==null?void 0:te.email)&&t.jsx("p",{className:"text-sm text-gray-500",children:n.customer.email}),((Ne=n.customer)==null?void 0:Ne.phone)&&t.jsx("p",{className:"text-sm text-gray-500",children:n.customer.phone})]})]}),t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:t.jsx(Tn,{className:"h-5 w-5 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Delivery Address"}),n.delivery_address?t.jsxs("div",{className:"text-gray-600",children:[t.jsx("p",{children:n.delivery_address.line1}),n.delivery_address.line2&&t.jsx("p",{children:n.delivery_address.line2}),t.jsxs("p",{children:[n.delivery_address.city,", ",n.delivery_address.state," ",n.delivery_address.postal_code]}),n.delivery_address.instructions&&t.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Note: ",n.delivery_address.instructions]})]}):t.jsx("p",{className:"text-gray-500",children:"No address specified"})]})]}),t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:t.jsx($s,{className:"h-5 w-5 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Important Dates"}),t.jsxs("div",{className:"text-gray-600 space-y-1",children:[t.jsxs("p",{children:["Order: ",new Date(n.order_date).toLocaleDateString()]}),n.scheduled_date&&t.jsxs("p",{children:["Scheduled: ",new Date(n.scheduled_date).toLocaleDateString()]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Updated: ",X(n.updated_at)]})]})]})]})]}),n.notes&&t.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Order Notes"}),t.jsx("p",{className:"text-gray-700",children:n.notes})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Order Items"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-5 w-5 text-gray-400"}),t.jsxs("span",{className:"text-gray-600",children:[((he=n.order_lines)==null?void 0:he.length)||0," item",(((Ce=n.order_lines)==null?void 0:Ce.length)||0)!==1?"s":""]})]})]}),n.order_lines&&n.order_lines.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subtotal"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.order_lines.map(je=>{var Pe,it;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((Pe=je.product)==null?void 0:Pe.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((it=je.product)==null?void 0:it.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:je.quantity})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm text-gray-900",children:ls(je.unit_price)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(je.subtotal||je.quantity*je.unit_price)})})]},je.id)})}),t.jsx("tfoot",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"Total:"}),t.jsx("td",{className:"px-6 py-4 text-right text-lg font-bold text-gray-900",children:n.total_amount?ls(n.total_amount):ls(n.order_lines.reduce((je,Pe)=>je+(Pe.subtotal||Pe.quantity*Pe.unit_price),0))})]})})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No items in this order"})]})]}),w&&t.jsx(GC,{statusHistory:de,currentStatus:n.status})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Summary"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),t.jsx("span",{className:"font-medium text-gray-900",children:ls(((Ae=n.order_lines)==null?void 0:Ae.reduce((je,Pe)=>je+(Pe.subtotal||Pe.quantity*Pe.unit_price),0))||0)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600",children:["Tax",n.tax_percent!=null?` (${n.tax_percent}%)`:"",":"]}),t.jsx("span",{className:"font-medium text-gray-900",children:ls(n.tax_amount!=null?n.tax_amount:0)})]}),t.jsx("div",{className:"border-t border-gray-200 pt-4",children:t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:ls((((fe=n.order_lines)==null?void 0:fe.reduce((je,Pe)=>je+(Pe.subtotal||Pe.quantity*Pe.unit_price),0))||0)+(n.tax_amount!=null?n.tax_amount:0))})]})})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Details"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Account Status:"}),t.jsx("div",{className:"mt-1",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${((Ie=n.customer)==null?void 0:Ie.account_status)==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:((Ee=n.customer)==null?void 0:Ee.account_status)||"Unknown"})})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Credit Terms:"}),t.jsxs("div",{className:"mt-1 text-sm text-gray-900",children:[((tt=n.customer)==null?void 0:tt.credit_terms_days)||0," days"]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"space-y-3",children:[["draft","confirmed"].includes(n.status)&&t.jsxs("button",{onClick:()=>A(!0),className:"w-full flex items-center justify-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(di,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Order"})]}),t.jsxs("button",{onClick:()=>U(af(n.status)[0]),disabled:af(n.status).length===0,className:"w-full flex items-center justify-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(Qi,{className:"h-4 w-4"}),t.jsx("span",{children:"Change Status"})]}),t.jsxs("button",{onClick:()=>N(!w),className:"w-full flex items-center justify-center space-x-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:[t.jsx(Qi,{className:"h-4 w-4"}),t.jsxs("span",{children:[w?"Hide":"Show"," Timeline"]})]})]})]})]})]}),x&&t.jsx(Tv,{isOpen:!!x,onClose:()=>f(null),onSubmit:W,order:x.order,newStatus:x.newStatus,loading:q.isPending}),E&&t.jsx(ZC,{isOpen:E,onClose:()=>A(!1),order:n})]})},HC=({orders:c,onOrderClick:u,onDateChange:x,onReschedule:f})=>{const[w,N]=oe.useState(new Date),[E,A]=oe.useState(null),n=te=>te.toISOString().split("T")[0],P=te=>te.toLocaleDateString("en-US",{month:"long",year:"numeric"}),z=te=>{const Ne=te.getFullYear(),he=te.getMonth(),Ce=new Date(Ne,he,1),fe=new Date(Ne,he+1,0).getDate(),Ie=Ce.getDay(),Ee=[];for(let tt=0;tt<Ie;tt++)Ee.push(null);for(let tt=1;tt<=fe;tt++)Ee.push(new Date(Ne,he,tt));return Ee},q=te=>{const Ne=n(te);return c.filter(he=>he.scheduled_date===Ne)},U=te=>{N(Ne=>{const he=new Date(Ne);return te==="prev"?he.setMonth(Ne.getMonth()-1):he.setMonth(Ne.getMonth()+1),he})},W=te=>{const Ne=n(te),he=q(te);A(Ne),x(Ne,he)},X=te=>{const Ne=q(te),he=new Date;return he.setHours(0,0,0,0),Ne.length===0?"empty":te<he?"past":n(te)===n(he)?"today":"scheduled"},Z=te=>{const Ne=X(te),he=E===n(te),Ce="min-h-[80px] p-2 border border-gray-200 cursor-pointer transition-colors relative";if(he)return`${Ce} bg-blue-100 border-blue-300`;switch(Ne){case"today":return`${Ce} bg-yellow-50 border-yellow-300 hover:bg-yellow-100`;case"scheduled":return`${Ce} bg-green-50 border-green-200 hover:bg-green-100`;case"past":return`${Ce} bg-gray-50 text-gray-500 hover:bg-gray-100`;default:return`${Ce} hover:bg-gray-50`}},J=z(w),de=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ne=oe.useMemo(()=>{if(!E)return[];const te=new Date(E+"T00:00:00");return q(te)},[E,c]);return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Delivery Schedule"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:()=>U("prev"),className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:t.jsx(g_,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-lg font-medium text-gray-900 min-w-[200px] text-center",children:P(w)}),t.jsx("button",{onClick:()=>U("next"),className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:t.jsx(x_,{className:"h-4 w-4"})})]})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-4",children:de.map(te=>t.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500 border-b border-gray-200",children:te},te))}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-6",children:J.map((te,Ne)=>t.jsx("div",{children:te?t.jsxs("div",{className:Z(te),onClick:()=>W(te),children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:te.getDate()}),q(te).length>0&&t.jsxs("div",{className:"space-y-1",children:[q(te).slice(0,2).map(he=>{var Ce,Ae;return t.jsx("div",{className:"text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded truncate",title:`${(Ce=he.customer)==null?void 0:Ce.name} - ${ls(he.total_amount||0)}`,children:(Ae=he.customer)==null?void 0:Ae.name},he.id)}),q(te).length>2&&t.jsxs("div",{className:"text-xs text-gray-500",children:["+",q(te).length-2," more"]})]})]}):t.jsx("div",{className:"min-h-[80px] p-2"})},Ne))}),E&&ne.length>0&&t.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Deliveries for ",new Date(E).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})]}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(mr,{className:"h-4 w-4"}),t.jsxs("span",{children:[ne.length," deliveries"]})]})]}),t.jsx("div",{className:"space-y-3",children:ne.map(te=>{var Ne,he,Ce,Ae;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",onClick:()=>u(te),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(hs,{className:"h-4 w-4 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:(Ne=te.customer)==null?void 0:Ne.name}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(Tn,{className:"h-3 w-3"}),t.jsxs("span",{children:[(he=te.delivery_address)==null?void 0:he.city,", ",(Ce=te.delivery_address)==null?void 0:Ce.state]})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(te.total_amount||0)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[((Ae=te.order_lines)==null?void 0:Ae.length)||0," items"]})]})]},te.id)})}),t.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"h-4 w-4 text-blue-600"}),t.jsx("span",{className:"text-blue-800",children:"Estimated Route Time:"})]}),t.jsxs("span",{className:"font-medium text-blue-900",children:[Math.ceil(ne.length*.5)," hours"]})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[t.jsx("span",{className:"text-blue-800",children:"Total Revenue:"}),t.jsx("span",{className:"font-medium text-blue-900",children:ls(ne.reduce((te,Ne)=>te+(Ne.total_amount||0),0))})]})]})]})]})},XC=()=>{const c=Qr(),[u,x]=oe.useState(null),[f,w]=oe.useState([]),{data:N}=Nv({status:"scheduled",limit:1e3}),E=(N==null?void 0:N.orders)||[],A=X=>{c(`/orders/${X.id}`)},n=(X,Z)=>{x(X),w(Z)},P=async(X,Z)=>{console.log("Reschedule order",X,"to",Z)},z=()=>{const X=new Date().toISOString().split("T")[0];return E.filter(Z=>Z.scheduled_date===X)},q=()=>{const X=new Date().toISOString().split("T")[0];return E.filter(Z=>Z.scheduled_date&&Z.scheduled_date>X)},U=z(),W=q();return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Delivery Schedule"})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:t.jsx($s,{className:"h-6 w-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Deliveries"}),t.jsx("p",{className:"text-3xl font-bold text-blue-600",children:U.length}),t.jsxs("p",{className:"text-sm text-gray-600",children:[U.reduce((X,Z)=>X+(Z.total_amount||0),0).toLocaleString("en-US",{style:"currency",currency:"USD"})," total value"]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:t.jsx(mr,{className:"h-6 w-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Deliveries"}),t.jsx("p",{className:"text-3xl font-bold text-green-600",children:W.length}),t.jsx("p",{className:"text-sm text-gray-600",children:"Next 30 days"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:t.jsx(hs,{className:"h-6 w-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Scheduled"}),t.jsx("p",{className:"text-3xl font-bold text-purple-600",children:E.length}),t.jsx("p",{className:"text-sm text-gray-600",children:"All scheduled orders"})]})]})})]}),t.jsx(HC,{orders:E,onOrderClick:A,onDateChange:n,onReschedule:P}),U.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Today's Delivery Route"}),t.jsx("div",{className:"space-y-3",children:U.map((X,Z)=>{var J,de,ne,te;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>A(X),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:Z+1}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:(J=X.customer)==null?void 0:J.name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[(de=X.delivery_address)==null?void 0:de.city,", ",(ne=X.delivery_address)==null?void 0:ne.state]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:(X.total_amount||0).toLocaleString("en-US",{style:"currency",currency:"USD"})}),t.jsxs("div",{className:"text-sm text-gray-600",children:[((te=X.order_lines)==null?void 0:te.length)||0," items"]})]})]},X.id)})}),t.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Estimated Route Time:"}),t.jsxs("span",{className:"font-medium text-gray-900",children:[Math.ceil(U.length*.5)," hours"]})]}),t.jsxs("div",{className:"flex justify-between text-sm mt-1",children:[t.jsx("span",{className:"text-gray-600",children:"Total Stops:"}),t.jsx("span",{className:"font-medium text-gray-900",children:U.length})]})]})]})]})},KC=({analytics:c,dateRange:u,onDateRangeChange:x})=>{const[f,w]=oe.useState("overview"),N=n=>`${n.toFixed(1)}%`,E=n=>({draft:"bg-gray-500",confirmed:"bg-blue-500",scheduled:"bg-purple-500",en_route:"bg-orange-500",delivered:"bg-green-500",invoiced:"bg-teal-500",cancelled:"bg-red-500"})[n]||"bg-gray-500",A=[{id:"overview",label:"Overview",icon:Xo},{id:"trends",label:"Trends",icon:Ji},{id:"customers",label:"Customers",icon:rc},{id:"products",label:"Products",icon:hs},{id:"delivery",label:"Delivery",icon:Qi}];return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Order Analytics"}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:u.start,onChange:n=>x({...u,start:n.target.value}),className:"text-sm border border-gray-300 rounded px-2 py-1"}),t.jsx("span",{className:"text-gray-500",children:"to"}),t.jsx("input",{type:"date",value:u.end,onChange:n=>x({...u,end:n.target.value}),className:"text-sm border border-gray-300 rounded px-2 py-1"})]})})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"flex space-x-8 px-6",children:A.map(n=>t.jsxs("button",{onClick:()=>w(n.id),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${f===n.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(n.icon,{className:"h-4 w-4"}),t.jsx("span",{children:n.label})]},n.id))})}),t.jsxs("div",{className:"p-6",children:[f==="overview"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Orders by Status"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx("div",{className:"space-y-3",children:c.orders_by_status.map(n=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${E(n.status)}`}),t.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:n.status.replace("_"," ")})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm text-gray-600",children:n.count}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",N(n.percentage),")"]})]})]},n.status))}),t.jsx("div",{className:"relative",children:t.jsx("div",{className:"w-48 h-48 mx-auto relative",children:t.jsx("div",{className:"w-full h-full rounded-full bg-gray-200 relative overflow-hidden",children:c.orders_by_status.map((n,P)=>{const z=c.orders_by_status.slice(0,P).reduce((U,W)=>U+W.percentage,0)*3.6,q=n.percentage*3.6;return t.jsx("div",{className:`absolute inset-0 ${E(n.status)} opacity-80`,style:{clipPath:`polygon(50% 50%, ${50+50*Math.cos((z-90)*Math.PI/180)}% ${50+50*Math.sin((z-90)*Math.PI/180)}%, ${50+50*Math.cos((z+q-90)*Math.PI/180)}% ${50+50*Math.sin((z+q-90)*Math.PI/180)}%)`}},n.status)})})})})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Delivery Performance"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"h-5 w-5 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-900",children:"On-Time Deliveries"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-2xl font-bold text-green-900",children:c.delivery_performance.on_time_deliveries}),t.jsxs("div",{className:"text-sm text-green-700",children:[N(c.delivery_performance.on_time_deliveries+c.delivery_performance.late_deliveries>0?c.delivery_performance.on_time_deliveries/(c.delivery_performance.on_time_deliveries+c.delivery_performance.late_deliveries)*100:0)," success rate"]})]})]}),t.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"h-5 w-5 text-red-600"}),t.jsx("span",{className:"text-sm font-medium text-red-900",children:"Late Deliveries"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-2xl font-bold text-red-900",children:c.delivery_performance.late_deliveries}),t.jsx("div",{className:"text-sm text-red-700",children:"Need attention"})]})]}),t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ji,{className:"h-5 w-5 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Avg Fulfillment"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[c.delivery_performance.avg_fulfillment_time,"h"]}),t.jsx("div",{className:"text-sm text-blue-700",children:"Average time"})]})]})]})]})]}),f==="trends"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Daily Order Trends"}),t.jsx("div",{className:"space-y-4",children:c.daily_trends.slice(-7).map(n=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:new Date(n.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.orders," orders"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(n.orders>0?n.revenue/n.orders:0)," avg"]})]})]},n.date))})]}),f==="customers"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Top Customers"}),t.jsx("div",{className:"space-y-3",children:c.top_customers.map((n,P)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["#",P+1]})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.customer_name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.order_count," orders"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(n.total_revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(n.order_count>0?n.total_revenue/n.order_count:0)," avg"]})]})]},n.customer_id))})]}),f==="products"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Top Products"}),t.jsx("div",{className:"space-y-3",children:c.top_products.map((n,P)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-green-600",children:["#",P+1]})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.product_name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.quantity_sold," units sold"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(n.quantity_sold>0?n.revenue/n.quantity_sold:0)," per unit"]})]})]},n.product_id))})]}),f==="delivery"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Regional Breakdown"}),t.jsx("div",{className:"space-y-3",children:c.regional_breakdown.map((n,P)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Tn,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.region}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.order_count," orders"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(n.order_count>0?n.revenue/n.order_count:0)," avg"]})]})]},n.region))})]})]})]})]})},QC=()=>{const c=Qr(),[u,x]=oe.useState({start:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),{data:f,isLoading:w}=RC(u.start,u.end),N=f||{orders_by_status:[],daily_trends:[],top_customers:[],top_products:[],delivery_performance:{on_time_deliveries:0,late_deliveries:0,avg_fulfillment_time:0},regional_breakdown:[]},E=()=>{if(!f)return;const A=[["Date Range",`${u.start} to ${u.end}`],["Total Orders",f.summary.totalOrders.toString()],["Total Revenue",f.summary.totalRevenue.toString()],["Average Order Value",f.summary.avgOrderValue.toString()],["Completion Rate",`${f.summary.completionRate.toFixed(1)}%`],[],["Status","Count","Percentage"],...N.orders_by_status.map(q=>[q.status,q.count.toString(),`${q.percentage.toFixed(1)}%`]),[],["Top Customers","Orders","Revenue"],...N.top_customers.map(q=>[q.customer_name,q.order_count.toString(),q.total_revenue.toString()])].map(q=>q.join(",")).join(`
`),n=new Blob([A],{type:"text/csv"}),P=window.URL.createObjectURL(n),z=document.createElement("a");z.href=P,z.download=`order-report-${u.start}-to-${u.end}.csv`,document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(P)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Reports & Analytics"})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("button",{onClick:E,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(Vf,{className:"h-4 w-4"}),t.jsx("span",{children:"Export Report"})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Xo,{className:"h-8 w-8 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Orders"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((f==null?void 0:f.summary.totalOrders)||0).toLocaleString()})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($s,{className:"h-8 w-8 text-green-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((f==null?void 0:f.summary.totalRevenue)||0).toLocaleString("en-US",{style:"currency",currency:"USD"})})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Xo,{className:"h-8 w-8 text-purple-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Avg Order Value"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((f==null?void 0:f.summary.avgOrderValue)||0).toLocaleString("en-US",{style:"currency",currency:"USD"})})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($s,{className:"h-8 w-8 text-orange-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Completion Rate"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":`${((f==null?void 0:f.summary.completionRate)||0).toFixed(1)}%`})]})]})})]}),t.jsx(KC,{analytics:N,dateRange:u,onDateRangeChange:x})]})},JC=({warehouseId:c})=>{const{data:u=[],isLoading:x,error:f}=wv(c);return c?x?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(tr,{className:"h-8 w-8 animate-spin text-blue-500"})}):f?t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:f.message||"Failed to load warehouse inventory"})})})}):u.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Inventory"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This warehouse has no inventory yet."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(w=>{var N,E;return t.jsxs("tr",{children:[" ",t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((N=w.product)==null?void 0:N.name)||w.product_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:((E=w.product)==null?void 0:E.sku)||w.product_sku})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:w.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:w.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:new Date(w.updated_at).toLocaleString()})})]},w.id||`${w.product_id}`)})})]})}):null},Ev=({isOpen:c,onClose:u,onSelect:x})=>{const[f,w]=oe.useState(""),{data:N}=cc({search:f,limit:1e3}),E=(N==null?void 0:N.products)||[];return c?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Select Product"}),t.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600",children:t.jsx(er,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"p-4 border-b",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:f,onChange:A=>w(A.target.value),placeholder:"Search by product name or SKU...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:E.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No products found"})]}):t.jsx("div",{className:"space-y-2",children:E.map(A=>t.jsx("button",{onClick:()=>{x(A),u()},className:"w-full text-left p-3 hover:bg-blue-50 rounded-lg transition-colors",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:A.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",A.sku,"  ",A.unit_of_measure]})]}),t.jsx("div",{className:"text-sm text-gray-500",children:A.unit_of_measure})]})},A.id))})})]})}):null},YC=({onSuccess:c})=>{var Ee,tt;const[u,x]=oe.useState(""),[f,w]=oe.useState(""),[N,E]=oe.useState([]),[A,n]=oe.useState(!1),[P,z]=oe.useState(!1),[q,U]=oe.useState(null),[W,X]=oe.useState(""),{data:Z=[]}=eg(),[J,de]=oe.useState(!1),[ne,te]=oe.useState(null),{data:Ne}=yt.trucks.list.useQuery({active:!0}),he=(Ne==null?void 0:Ne.trucks)||[],Ce=async je=>{je.preventDefault(),n(!0),U(null);try{if(!u)throw new Error("Please select a truck");if(!f)throw new Error("Please select a source warehouse");if(N.length===0)throw new Error("Please add at least one product");if(N.filter(ct=>(!ct.qty_full||ct.qty_full<0)&&(!ct.qty_empty||ct.qty_empty<0)).length>0)throw new Error("Please enter valid quantities for all products");if(N.filter(ct=>(ct.qty_full||0)===0&&(ct.qty_empty||0)===0).length>0)throw new Error("Each line must have at least one full or empty cylinder");console.log("Loading truck with products from warehouse");for(const ct of N){const Nt=Number(ct.qty_full)||0,ft=Number(ct.qty_empty)||0;(Nt>0||ft>0)&&console.log(`Loading ${Nt} full and ${ft} empty ${ct.product_name} to truck`)}await new Promise(ct=>setTimeout(ct,1e3)),console.log("Truck loading completed successfully"),x(""),w(""),E([]),z(!1),c&&c()}catch(Pe){console.error("Transfer creation error:",Pe),U(Pe.message||"Failed to create transfer")}finally{n(!1)}},Ae=()=>{te(N.length),de(!0)},fe=je=>{if(ne!==null){const Pe=[...N];ne<N.length?Pe[ne]={...Pe[ne],product_id:je.id,product_name:je.name,product_sku:je.sku,unit_of_measure:je.unit_of_measure}:Pe.push({product_id:je.id,product_name:je.name,product_sku:je.sku,unit_of_measure:je.unit_of_measure,qty_full:"",qty_empty:""}),E(Pe)}de(!1),te(null)},Ie=he.filter(je=>{var Pe,it;return((Pe=je.fleet_number)==null?void 0:Pe.toLowerCase().includes(W.toLowerCase()))||((it=je.license_plate)==null?void 0:it.toLowerCase().includes(W.toLowerCase()))});return t.jsxs("div",{className:"space-y-6",children:[q&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:q})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Warehouse (Source)"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:f,onChange:je=>{w(je.target.value)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select warehouse to load from..."}),Z.map(je=>t.jsx("option",{value:je.id,children:je.name},je.id))]}),t.jsx(En,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Truck (Destination)"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:W,onChange:je=>X(je.target.value),placeholder:"Search by fleet number or license plate...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),W&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:t.jsx("div",{className:"max-h-60 overflow-auto",children:Ie.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No trucks found"}):Ie.map(je=>t.jsxs("div",{onClick:()=>{x(je.id),X("")},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(mr,{className:"inline h-4 w-4 mr-1"}),je.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",je.license_plate]})]},je.id))})})]}),u&&t.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(mr,{className:"inline h-4 w-4 mr-1"}),(Ee=he.find(je=>je.id===u))==null?void 0:Ee.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",(tt=he.find(je=>je.id===u))==null?void 0:tt.license_plate]})]}),t.jsx("button",{onClick:()=>x(""),className:"text-gray-400 hover:text-gray-600",children:t.jsx(er,{className:"h-4 w-4"})})]})})]})]}),f&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Available Warehouse Inventory"}),t.jsx(JC,{warehouseId:f})]}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Items to Load"}),t.jsxs("button",{type:"button",onClick:Ae,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]}),t.jsx("div",{className:"space-y-4",children:N.map((je,Pe)=>t.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:je.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",je.product_sku]})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:je.qty_full,onChange:it=>{const ct=[...N];ct[Pe].qty_full=it.target.value===""?"":parseInt(it.target.value),E(ct)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:je.qty_empty,onChange:it=>{const ct=[...N];ct[Pe].qty_empty=it.target.value===""?"":parseInt(it.target.value),E(ct)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx("button",{type:"button",onClick:()=>{const it=[...N];it.splice(Pe,1),E(it)},className:"text-red-600 hover:text-red-800",children:t.jsx(er,{className:"h-5 w-5"})})]},Pe))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>z(!0),disabled:A||!u||!f||N.length===0,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Load Truck"})}),t.jsx(so,{isOpen:P,onClose:()=>z(!1),onConfirm:Ce,title:"Confirm Truck Loading",message:"Are you sure you want to load this truck? This will move inventory from the warehouse to the selected truck.",confirmText:"Load Truck",type:"info",loading:A}),t.jsx(Ev,{isOpen:J,onClose:()=>{de(!1),te(null)},onSelect:fe})]})},ek=({truckId:c})=>{const{data:u,isLoading:x,error:f}=yt.trucks.get.useQuery({id:c}),w=(f==null?void 0:f.message)||null,N=(u==null?void 0:u.inventory)||[];return x?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(tr,{className:"h-8 w-8 animate-spin text-blue-500"})}):w?t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:w})})})}):N.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Inventory"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This truck has no inventory yet."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(E=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:E.product_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:E.product_sku})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:E.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:E.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:new Date(E.updated_at).toLocaleString()})})]},E.product_id))})]})})},tk=({onSuccess:c})=>{var tt,je;const[u,x]=oe.useState(""),[f,w]=oe.useState(""),[N,E]=oe.useState([]),[A,n]=oe.useState(!1),[P,z]=oe.useState(!1),[q,U]=oe.useState(null),[W,X]=oe.useState(""),{data:Z=[]}=eg(),[J,de]=oe.useState(!1),[ne,te]=oe.useState(null),{data:Ne}=yt.trucks.list.useQuery({active:!0}),he=(Ne==null?void 0:Ne.trucks)||[],Ce=yt.transfers.create.useMutation(),Ae=async Pe=>{var it;Pe.preventDefault(),n(!0),U(null);try{if(!u)throw new Error("Please select a truck");if(!f)throw new Error("Please select a destination warehouse");if(N.length===0)throw new Error("Please add at least one product");if(N.filter(ht=>(!ht.qty_full||ht.qty_full<0)&&(!ht.qty_empty||ht.qty_empty<0)).length>0)throw new Error("Please enter valid quantities for all products");if(N.filter(ht=>(ht.qty_full||0)===0&&(ht.qty_empty||0)===0).length>0)throw new Error("Each line must have at least one full or empty cylinder");const ft={truck_id:u,warehouse_id:f,lines:N.map(ht=>({product_id:ht.product_id,qty_full:ht.qty_full||0,qty_empty:ht.qty_empty||0}))};console.log("Creating return transfer with data:",ft);const Mt=await Ce.mutateAsync({source_warehouse_id:f,destination_warehouse_id:f,transfer_date:new Date().toISOString().split("T")[0],reason:"Return from truck",notes:`Return transfer from truck ${((it=he.find(ht=>ht.id===u))==null?void 0:it.fleet_number)||u}`,items:ft.lines.map(ht=>({product_id:ht.product_id,quantity_to_transfer:(ht.qty_full||0)+(ht.qty_empty||0)}))});console.log("Transfer created successfully:",Mt),x(""),w(""),E([]),z(!1),c&&c()}catch(ct){console.error("Transfer creation error:",ct),U(ct.message||"Failed to create transfer")}finally{n(!1)}},fe=()=>{te(N.length),de(!0)},Ie=Pe=>{if(ne!==null){const it=[...N];ne<N.length?it[ne]={...it[ne],product_id:Pe.id,product_name:Pe.name,product_sku:Pe.sku,unit_of_measure:Pe.unit_of_measure}:it.push({product_id:Pe.id,product_name:Pe.name,product_sku:Pe.sku,unit_of_measure:Pe.unit_of_measure,qty_full:"",qty_empty:""}),E(it)}de(!1),te(null)},Ee=he.filter(Pe=>{var it,ct;return((it=Pe.fleet_number)==null?void 0:it.toLowerCase().includes(W.toLowerCase()))||((ct=Pe.license_plate)==null?void 0:ct.toLowerCase().includes(W.toLowerCase()))});return t.jsxs("div",{className:"space-y-6",children:[q&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:q})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(mr,{className:"inline h-4 w-4 mr-1"}),"Select Truck (Source)"]}),t.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Choose the truck that has products to return"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:W,onChange:Pe=>X(Pe.target.value),placeholder:"Search by fleet number or license plate...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),W&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:t.jsx("div",{className:"max-h-60 overflow-auto",children:Ee.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No trucks found"}):Ee.map(Pe=>t.jsxs("div",{onClick:()=>{x(Pe.id),X("")},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(mr,{className:"inline h-4 w-4 mr-1"}),Pe.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",Pe.license_plate]})]},Pe.id))})})]}),u&&t.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(mr,{className:"inline h-4 w-4 mr-1"}),(tt=he.find(Pe=>Pe.id===u))==null?void 0:tt.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",(je=he.find(Pe=>Pe.id===u))==null?void 0:je.license_plate]})]}),t.jsx("button",{onClick:()=>x(""),className:"text-gray-400 hover:text-gray-600",children:t.jsx(er,{className:"h-4 w-4"})})]})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(En,{className:"inline h-4 w-4 mr-1"}),"Select Destination Warehouse"]}),t.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Choose the warehouse to return products to"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:f,onChange:Pe=>w(Pe.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select destination warehouse..."}),Z.map(Pe=>t.jsx("option",{value:Pe.id,children:Pe.name},Pe.id))]}),t.jsx(En,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]})]}),u&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Truck Inventory"}),t.jsx(ek,{truckId:u})]}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transfer Lines"}),t.jsxs("button",{type:"button",onClick:fe,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]}),t.jsx("div",{className:"space-y-4",children:N.map((Pe,it)=>t.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:Pe.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Pe.product_sku]})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Pe.qty_full,onChange:ct=>{const Nt=[...N];Nt[it].qty_full=ct.target.value===""?"":parseInt(ct.target.value),E(Nt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Pe.qty_empty,onChange:ct=>{const Nt=[...N];Nt[it].qty_empty=ct.target.value===""?"":parseInt(ct.target.value),E(Nt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx("button",{type:"button",onClick:()=>{const ct=[...N];ct.splice(it,1),E(ct)},className:"text-red-600 hover:text-red-800",children:t.jsx(er,{className:"h-5 w-5"})})]},it))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>z(!0),disabled:A||!u||!f||N.length===0,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Return Transfer"})}),t.jsx(so,{isOpen:P,onClose:()=>z(!1),onConfirm:Ae,title:"Confirm Return Transfer",message:"Are you sure you want to create this return transfer? This will move inventory from the selected truck back to the warehouse.",confirmText:"Create Return Transfer",type:"info",loading:A}),t.jsx(Ev,{isOpen:J,onClose:()=>{de(!1),te(null)},onSelect:Ie})]})},sk=c=>{const[u,x]=oe.useState(null),{data:f,isLoading:w,refetch:N}=yt.transfers.list.useQuery({source_warehouse_id:c==null?void 0:c.source_warehouse_id,destination_warehouse_id:c==null?void 0:c.destination_warehouse_id,status:c==null?void 0:c.status,transfer_type:c==null?void 0:c.transfer_type,date_from:c==null?void 0:c.date_from,date_to:c==null?void 0:c.date_to,created_by_user_id:c==null?void 0:c.created_by_user_id,search_text:c==null?void 0:c.search_text,page:1,limit:20,sort_by:"created_at",sort_order:"desc"},{retry:1,staleTime:3e4,onError:ne=>{x(ne.message),It.error("Failed to fetch transfers")}}),E=(f==null?void 0:f.transfers)||[],A=(f==null?void 0:f.totalCount)||0,n=oe.useCallback(async ne=>{if(!ne||!Cv.test(ne))return console.error("Invalid warehouse ID format:",ne),x("Invalid warehouse ID format"),null;try{return await yt.transfers.getWarehouseStock.query({warehouse_id:ne})}catch(te){return console.error("Error fetching warehouse stock:",te),x("Failed to fetch warehouse stock"),null}},[]),{data:P,isLoading:z}=yt.transfers.searchProducts.useQuery({search:"",warehouse_id:c==null?void 0:c.source_warehouse_id,include_variants:!0,limit:50},{enabled:!1}),q=yt.transfers.validate.useMutation({onError:ne=>{x(ne.message),It.error("Transfer validation failed")}}),U=yt.transfers.create.useMutation({onSuccess:()=>{It.success("Transfer created successfully"),N()},onError:ne=>{x(ne.message),It.error("Failed to create transfer")}}),W=yt.transfers.updateStatus.useMutation({onSuccess:()=>{It.success("Transfer status updated"),N()},onError:ne=>{x(ne.message),It.error("Failed to update transfer status")}}),X=oe.useCallback(async ne=>{try{return x(null),await q.mutateAsync(ne)}catch(te){return console.error("Transfer validation error:",te),{isValid:!1,errors:[te.message||"Validation failed"],warnings:[]}}},[q]),Z=oe.useCallback(async ne=>{try{return x(null),await U.mutateAsync(ne)}catch(te){return console.error("Create transfer error:",te),null}},[U]),J=oe.useCallback(async(ne,te,Ne)=>{try{x(null),await W.mutateAsync({transfer_id:ne,status:te,notes:Ne})}catch(he){console.error("Update transfer status error:",he)}},[W]),{data:de}=yt.transfers.getCostAnalysis.useQuery({transfer_id:""},{enabled:!1});return{transfers:E,totalCount:A,loading:w,error:u,products:(P==null?void 0:P.products)||[],productsLoading:z,fetchTransfers:N,fetchWarehouseStock:n,validateTransfer:X,createTransfer:Z,updateTransferStatus:J,costAnalysis:de,isValidating:q.isLoading,isCreating:U.isLoading,isUpdating:W.isLoading}},rk=c=>{const{data:u,isLoading:x,refetch:f}=yt.transfers.searchProducts.useQuery({search:"",warehouse_id:c,include_variants:!0,limit:100},{enabled:!!c,retry:1,staleTime:6e4});return{products:(u==null?void 0:u.products)||[],isLoading:x,refetch:f}},Cv=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,kv=c=>{const u=c&&Cv.test(c),{data:x,isLoading:f,refetch:w}=yt.transfers.getWarehouseStock.useQuery({warehouse_id:c},{enabled:!!u,retry:1,staleTime:6e4});return{stockInfo:x||[],isLoading:f,refetch:()=>w(),fetchStockInfo:w}},ik=()=>{const[c,u]=oe.useState([]),[x,f]=oe.useState([]),[w,N]=oe.useState({is_valid:!0,errors:[],warnings:[]}),[E,A]=oe.useState(null),n=oe.useCallback((q,U,W)=>{const X={product_id:q.id,product_sku:q.sku,product_name:q.name,variant_name:q.variant_name,quantity_to_transfer:U,unit_weight_kg:q.weight_kg||0,total_weight_kg:(q.weight_kg||0)*U,unit_cost:W.unit_cost||0,total_cost:(W.unit_cost||0)*U,available_stock:W.available_quantity||0};u(Z=>{const J=Z.findIndex(de=>de.product_id===q.id&&de.variant_name===q.variant_name);if(J>=0){const de=[...Z];return de[J]={...de[J],quantity_to_transfer:U},de}else return[...Z,X]})},[]),P=oe.useCallback((q,U)=>{u(W=>W.filter(X=>!(X.product_id===q&&X.variant_name===U)))},[]),z=oe.useCallback((q,U,W)=>{const X=[],Z=[];(!q||!U)&&X.push("Source and destination warehouses are required"),q===U&&X.push("Source and destination warehouses must be different"),c.length===0&&X.push("At least one item must be selected for transfer"),c.forEach(de=>{de.quantity_to_transfer>de.available_stock&&X.push(`Insufficient stock for ${de.product_name}: requested ${de.quantity_to_transfer}, available ${de.available_stock}`)});const J={is_valid:X.length===0,errors:X,warnings:Z};if(N(J),J.is_valid){const de={total_items:c.length,total_quantity:c.reduce((ne,te)=>ne+te.quantity_to_transfer,0),total_weight:c.reduce((ne,te)=>ne+te.total_weight_kg,0),total_cost:c.reduce((ne,te)=>ne+te.total_cost,0)};A(de)}return J},[c]);return{selectedItems:c,validationResult:w,transferSummary:E,warehouseStockData:x,setWarehouseStockData:f,addItem:n,removeItem:P,validateTransfer:z}},nk=({warehouseId:c,onProductSelect:u,selectedProductIds:x,disabled:f=!1})=>{const[w,N]=oe.useState({warehouse_id:c,has_stock:!0,search_text:"",variant_type:void 0,variant_name:void 0}),[E,A]=oe.useState(!1),[n,P]=oe.useState({}),{products:z,loading:q,searchProducts:U}=rk(),{stockInfo:W,loading:X,fetchStockInfo:Z}=kv(c);oe.useEffect(()=>{w.warehouse_id&&(U(w),Z())},[w,U,Z]);const J=fe=>{N(Ie=>({...Ie,search_text:fe}))},de=(fe,Ie)=>{N(Ee=>({...Ee,[fe]:Ie}))},ne=(fe,Ie)=>{P(Ee=>({...Ee,[fe]:Ie}))},te=fe=>{const Ie=`${fe.id}-${fe.variant_name||"default"}`,Ee=n[Ie]||1,tt=W.find(je=>je.product_id===fe.id&&je.variant_name===fe.variant_name);if(!tt){alert("Stock information not found for this product");return}if(Ee>tt.qty_available){alert(`Quantity exceeds available stock (${tt.qty_available})`);return}u(fe,Ee,tt),P(je=>({...je,[Ie]:1}))},Ne=(fe,Ie)=>W.find(Ee=>Ee.product_id===fe&&Ee.variant_name===Ie),he=(fe,Ie)=>{const Ee=`${fe}-${Ie||"default"}`;return x.includes(Ee)},Ce=fe=>!fe||fe.qty_available===0?{status:"out-of-stock",color:"text-red-600 bg-red-100",text:"Out of Stock"}:fe.qty_available<=10?{status:"low-stock",color:"text-yellow-600 bg-yellow-100",text:"Low Stock"}:{status:"in-stock",color:"text-green-600 bg-green-100",text:"In Stock"},Ae=q||X;return t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Products"}),t.jsxs("button",{onClick:()=>A(!E),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-800",children:[t.jsx(Qd,{className:"h-4 w-4"}),t.jsx("span",{children:"Filters"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(Yi,{className:"h-5 w-5 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search products by name or SKU...",value:w.search_text||"",onChange:fe=>J(fe.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),E&&t.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg space-y-4",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Type"}),t.jsxs("select",{value:w.variant_type||"",onChange:fe=>de("variant_type",fe.target.value||void 0),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"cylinder",children:"Cylinders"}),t.jsx("option",{value:"refillable",children:"Refillable"}),t.jsx("option",{value:"disposable",children:"Disposable"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Variant"}),t.jsxs("select",{value:w.variant_name||"",onChange:fe=>de("variant_name",fe.target.value||void 0),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"",children:"All Variants"}),t.jsx("option",{value:"full",children:"Full"}),t.jsx("option",{value:"empty",children:"Empty"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Status"}),t.jsxs("select",{value:w.has_stock?"in-stock":"all",onChange:fe=>de("has_stock",fe.target.value==="in-stock"),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"all",children:"All Products"}),t.jsx("option",{value:"in-stock",children:"In Stock Only"})]})]})]})})]}),t.jsx("div",{className:"p-4",children:Ae?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),t.jsx("span",{className:"ml-2 text-gray-600",children:"Loading products..."})]}):z.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 mb-2",children:"No products found"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your search criteria or filters"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:z.map(fe=>{const Ie=Ne(fe.id,fe.variant_name),Ee=Ce(Ie),tt=`${fe.id}-${fe.variant_name||"default"}`,je=he(fe.id,fe.variant_name),Pe=n[tt]||1;return t.jsxs("div",{className:`border rounded-lg p-4 transition-all duration-200 ${je?"border-blue-500 bg-blue-50":f||Ee.status==="out-of-stock"?"border-gray-200 bg-gray-50 opacity-75":"border-gray-300 hover:border-blue-300 hover:shadow-sm"}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:fe.name}),t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["SKU: ",fe.sku]}),fe.variant_name&&t.jsx("span",{className:"inline-block bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded mt-1",children:fe.variant_name})]}),t.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ee.color}`,children:Ee.text})]}),Ie&&t.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Available:"}),t.jsx("span",{className:"font-medium",children:Ie.qty_available})]}),Ie.qty_reserved>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Reserved:"}),t.jsx("span",{children:Ie.qty_reserved})]}),fe.capacity_kg&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Weight:"}),t.jsxs("span",{children:[fe.capacity_kg,"kg"]})]})]}),Ee.status!=="out-of-stock"&&!f&&t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"number",min:"1",max:(Ie==null?void 0:Ie.qty_available)||999,value:Pe,onChange:it=>ne(tt,parseInt(it.target.value)||1),className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["max ",(Ie==null?void 0:Ie.qty_available)||0]})]})]}),t.jsx("div",{children:je?t.jsxs("div",{className:"flex items-center justify-center py-2 text-sm text-blue-600",children:[t.jsx($N,{className:"h-4 w-4 mr-1"}),"Selected"]}):Ee.status==="out-of-stock"?t.jsxs("div",{className:"flex items-center justify-center py-2 text-sm text-gray-500",children:[t.jsx(tu,{className:"h-4 w-4 mr-1"}),"Out of Stock"]}):t.jsxs("button",{onClick:()=>te(fe),disabled:f||Pe>((Ie==null?void 0:Ie.qty_available)||0),className:`w-full flex items-center justify-center py-2 px-3 text-sm font-medium rounded-md ${f||Pe>((Ie==null?void 0:Ie.qty_available)||0)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[t.jsx(wr,{className:"h-4 w-4 mr-1"}),"Add to Transfer"]})})]},tt)})})}),z.length>0&&t.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50 text-sm text-gray-600",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{children:["Showing ",z.length," product",z.length!==1?"s":""]}),t.jsxs("span",{children:[x.length," selected for transfer"]})]})})]})};async function ak(c){try{return await yt.transfers.formatValidationErrors.mutate({validation_result:c})}catch(u){throw console.error("Failed to format validation errors via API:",u),new Error("Validation error formatting failed. Please try again.")}}function ok(c,u,x){const f=x?new Date(x):new Date,w=f.toISOString().slice(0,10).replace(/-/g,""),N=f.toISOString().slice(11,19).replace(/:/g,""),E=c.slice(-4).toUpperCase(),A=u.slice(-4).toUpperCase();return`TRF-${w}-${N}-${E}-${A}`}const j0=({summary:c,validationResult:u,selectedItems:x,onRemoveItem:f,showItemDetails:w=!0})=>{var n,P;if(!c||x.length===0)return t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:t.jsxs("div",{className:"text-center text-gray-500",children:[t.jsx(hs,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{children:"No items selected for transfer"})]})});const N=u?ak(u):[],E=u&&!u.is_valid,A=u&&u.warnings.length>0;return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(hs,{className:"h-5 w-5 text-blue-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Items"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_products})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ji,{className:"h-5 w-5 text-green-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Quantity"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_quantity})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(jf,{className:"h-5 w-5 text-purple-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Weight"}),t.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[c.total_weight_kg.toFixed(1),"kg"]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(mr,{className:"h-5 w-5 text-orange-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Variants"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.unique_variants})]})]})})]}),u&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center mb-3",children:[E?t.jsx(pa,{className:"h-5 w-5 text-red-500 mr-2"}):A?t.jsx(Us,{className:"h-5 w-5 text-yellow-500 mr-2"}):t.jsx(Gn,{className:"h-5 w-5 text-green-500 mr-2"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Validation Status"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.validation_summary.valid_items}),t.jsx("p",{className:"text-sm text-gray-600",children:"Valid Items"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.validation_summary.invalid_items}),t.jsx("p",{className:"text-sm text-gray-600",children:"Invalid Items"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.validation_summary.items_with_warnings}),t.jsx("p",{className:"text-sm text-gray-600",children:"Warnings"})]})]}),N.length>0&&t.jsx("div",{className:"space-y-2",children:N.map((z,q)=>t.jsxs("div",{className:`flex items-start p-3 rounded-md ${z.severity==="error"?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[z.severity==="error"?t.jsx(pa,{className:"h-4 w-4 text-red-500 mr-2 mt-0.5 flex-shrink-0"}):t.jsx(Us,{className:"h-4 w-4 text-yellow-500 mr-2 mt-0.5 flex-shrink-0"}),t.jsx("span",{className:`text-sm ${z.severity==="error"?"text-red-700":"text-yellow-700"}`,children:z.message})]},q))})]}),w&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Selected Items"})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"space-y-3",children:x.map((z,q)=>t.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${z.is_valid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center mb-1",children:[t.jsx("h4",{className:"font-medium text-gray-900 mr-2",children:z.product_name}),z.variant_name&&t.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:z.variant_name}),!z.is_valid&&t.jsx(pa,{className:"h-4 w-4 text-red-500 ml-2"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("span",{children:["SKU: ",z.product_sku]}),t.jsx("span",{className:"mx-2",children:""}),t.jsxs("span",{children:["Qty: ",z.quantity_to_transfer]}),z.total_weight_kg&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mx-2",children:""}),t.jsxs("span",{children:["Weight: ",z.total_weight_kg.toFixed(1),"kg"]})]})]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Available: ",z.available_stock,z.reserved_stock&&z.reserved_stock>0&&t.jsxs("span",{children:["  Reserved: ",z.reserved_stock]})]}),(z.validation_errors.length>0||z.validation_warnings.length>0)&&t.jsxs("div",{className:"mt-2 space-y-1",children:[z.validation_errors.map((U,W)=>t.jsxs("div",{className:"text-xs text-red-600 flex items-center",children:[t.jsx(pa,{className:"h-3 w-3 mr-1"}),U]},W)),z.validation_warnings.map((U,W)=>t.jsxs("div",{className:"text-xs text-yellow-600 flex items-center",children:[t.jsx(Us,{className:"h-3 w-3 mr-1"}),U]},W))]})]}),f&&t.jsx("button",{onClick:()=>f(z.product_id,z.variant_name),className:"ml-4 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full",title:"Remove item",children:t.jsx(pa,{className:"h-4 w-4"})})]},`${z.product_id}-${z.variant_name||"default"}`))})})]}),(c.heaviest_item||c.most_expensive_item)&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Additional Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.heaviest_item&&t.jsxs("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(jf,{className:"h-4 w-4 text-purple-500 mr-2"}),t.jsx("span",{className:"font-medium text-purple-700",children:"Heaviest Item"})]}),t.jsxs("p",{className:"text-sm text-purple-600",children:[c.heaviest_item.product_name," - ",(n=c.heaviest_item.total_weight_kg)==null?void 0:n.toFixed(1),"kg"]})]}),c.most_expensive_item&&c.total_cost&&t.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(Ji,{className:"h-4 w-4 text-green-500 mr-2"}),t.jsx("span",{className:"font-medium text-green-700",children:"Most Expensive Item"})]}),t.jsxs("p",{className:"text-sm text-green-600",children:[c.most_expensive_item.product_name," - $",(P=c.most_expensive_item.total_cost)==null?void 0:P.toFixed(2)]})]})]}),c.total_cost&&t.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-blue-700",children:"Estimated Total Cost"}),t.jsxs("span",{className:"text-lg font-bold text-blue-900",children:["$",c.total_cost.toFixed(2)]})]})})]})]})},lk=({onTransferCreated:c,onCancel:u,initialSourceWarehouseId:x,initialDestinationWarehouseId:f})=>{var Pe,it;const[w,N]=oe.useState({source_warehouse_id:x||"",destination_warehouse_id:f||"",transfer_date:new Date().toISOString().split("T")[0],priority:"normal",transfer_reference:"",reason:"",notes:"",instructions:"",selected_items:[]}),[E,A]=oe.useState("setup"),{data:n}=Yf(),P=(n==null?void 0:n.warehouses)||[],{createTransfer:z,loading:q}=sk(),{selectedItems:U,validationResult:W,transferSummary:X,setWarehouseStockData:Z,addItem:J,removeItem:de,validateTransfer:ne}=ik(),{stockInfo:te,fetchStockInfo:Ne}=kv(w.source_warehouse_id);oe.useEffect(()=>{if(w.source_warehouse_id&&w.destination_warehouse_id&&!w.transfer_reference&&P.length>0){const ct=P.find(ft=>ft.id===w.source_warehouse_id),Nt=P.find(ft=>ft.id===w.destination_warehouse_id);if(ct&&Nt){const ft=ok(ct.name.substring(0,3).toUpperCase(),Nt.name.substring(0,3).toUpperCase(),w.transfer_date);N(Mt=>({...Mt,transfer_reference:ft}))}}},[w.source_warehouse_id,w.destination_warehouse_id,w.transfer_date,P]),oe.useEffect(()=>{w.source_warehouse_id&&Ne()},[w.source_warehouse_id,Ne]),oe.useEffect(()=>{Z(te)},[te,Z]),oe.useEffect(()=>{U.length>0&&w.source_warehouse_id&&w.destination_warehouse_id&&ne(w.source_warehouse_id,w.destination_warehouse_id,w.transfer_date)},[U,w,ne]);const he=(ct,Nt)=>{N(ft=>({...ft,[ct]:Nt}))},Ce=(ct,Nt,ft)=>{J(ct,Nt,ft)},Ae=(ct,Nt)=>{de(ct,Nt)},fe=()=>{if(E==="setup"){if(!w.source_warehouse_id||!w.destination_warehouse_id){alert("Please select both source and destination warehouses");return}if(w.source_warehouse_id===w.destination_warehouse_id){alert("Source and destination warehouses must be different");return}A("products")}else if(E==="products"){if(U.length===0){alert("Please select at least one product for transfer");return}A("review")}},Ie=()=>{E==="products"?A("setup"):E==="review"&&A("products")},Ee=async()=>{if(!(W!=null&&W.is_valid)){alert("Please fix validation errors before submitting");return}try{const ct={source_warehouse_id:w.source_warehouse_id,destination_warehouse_id:w.destination_warehouse_id,transfer_date:w.transfer_date,items:U.map(ft=>({product_id:ft.product_id,product_sku:ft.product_sku,product_name:ft.product_name,variant_name:ft.variant_name,quantity_to_transfer:ft.quantity_to_transfer,unit_weight_kg:ft.unit_weight_kg,total_weight_kg:ft.total_weight_kg,unit_cost:ft.unit_cost,total_cost:ft.total_cost})),notes:w.notes,reason:w.reason,priority:w.priority,transfer_reference:w.transfer_reference},Nt=await z(ct);Nt&&c&&c(Nt.id)}catch(ct){console.error("Error submitting transfer:",ct)}},tt=()=>E==="setup"?w.source_warehouse_id&&w.destination_warehouse_id&&w.source_warehouse_id!==w.destination_warehouse_id:E==="products"?U.length>0:!0,je=U.map(ct=>`${ct.product_id}-${ct.variant_name||"default"}`);return t.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Multi-SKU Transfer"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${E==="setup"?"bg-blue-500 text-white":"bg-blue-100 text-blue-600"}`,children:"1"}),t.jsx("div",{className:"w-8 h-1 bg-gray-200"}),t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${E==="products"?"bg-blue-500 text-white":E==="review"?"bg-blue-100 text-blue-600":"bg-gray-200 text-gray-500"}`,children:"2"}),t.jsx("div",{className:"w-8 h-1 bg-gray-200"}),t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${E==="review"?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:"3"})]})]}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{className:E==="setup"?"font-medium text-blue-600":"",children:"Setup Transfer"}),t.jsx("span",{className:E==="products"?"font-medium text-blue-600":"",children:"Select Products"}),t.jsx("span",{className:E==="review"?"font-medium text-blue-600":"",children:"Review & Submit"})]})]}),E==="setup"&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transfer Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(f_,{className:"h-4 w-4 inline mr-1"}),"Source Warehouse"]}),t.jsx(Yh,{value:w.source_warehouse_id,onChange:ct=>he("source_warehouse_id",ct),placeholder:"Select source warehouse"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Bf,{className:"h-4 w-4 inline mr-1"}),"Destination Warehouse"]}),t.jsx(Yh,{value:w.destination_warehouse_id,onChange:ct=>he("destination_warehouse_id",ct),placeholder:"Select destination warehouse",excludeIds:w.source_warehouse_id?[w.source_warehouse_id]:[]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx($s,{className:"h-4 w-4 inline mr-1"}),"Transfer Date"]}),t.jsx("input",{type:"date",value:w.transfer_date,onChange:ct=>he("transfer_date",ct.target.value),min:new Date().toISOString().split("T")[0],className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),t.jsxs("select",{value:w.priority,onChange:ct=>he("priority",ct.target.value),className:"block w-full border border-gray-300 rounded-md py-2 px-3",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"normal",children:"Normal"}),t.jsx("option",{value:"high",children:"High"}),t.jsx("option",{value:"urgent",children:"Urgent"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Transfer"}),t.jsxs("select",{value:w.reason,onChange:ct=>he("reason",ct.target.value),className:"block w-full border border-gray-300 rounded-md py-2 px-3",children:[t.jsx("option",{value:"",children:"Select reason"}),t.jsx("option",{value:"restock",children:"Restock"}),t.jsx("option",{value:"redistribution",children:"Redistribution"}),t.jsx("option",{value:"shortage",children:"Stock Shortage"}),t.jsx("option",{value:"maintenance",children:"Maintenance"}),t.jsx("option",{value:"optimization",children:"Inventory Optimization"}),t.jsx("option",{value:"other",children:"Other"})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Reference"}),t.jsx("input",{type:"text",value:w.transfer_reference,onChange:ct=>he("transfer_reference",ct.target.value),placeholder:"Auto-generated",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),t.jsx("textarea",{value:w.notes,onChange:ct=>he("notes",ct.target.value),rows:4,placeholder:"Add any additional notes about this transfer...",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions"}),t.jsx("textarea",{value:w.instructions,onChange:ct=>he("instructions",ct.target.value),rows:3,placeholder:"Any special handling instructions...",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]})]})]})]}),E==="products"&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[t.jsx("div",{children:t.jsx(nk,{warehouseId:w.source_warehouse_id,onProductSelect:Ce,selectedProductIds:je})}),t.jsx("div",{children:t.jsx(j0,{summary:X,validationResult:W,selectedItems:U,onRemoveItem:Ae,showItemDetails:!0})})]}),E==="review"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transfer Overview"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Source"}),t.jsx("p",{className:"font-medium",children:(Pe=P.find(ct=>ct.id===w.source_warehouse_id))==null?void 0:Pe.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Destination"}),t.jsx("p",{className:"font-medium",children:(it=P.find(ct=>ct.id===w.destination_warehouse_id))==null?void 0:it.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Transfer Date"}),t.jsx("p",{className:"font-medium",children:w.transfer_date})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Priority"}),t.jsx("p",{className:"font-medium capitalize",children:w.priority})]})]})]}),W&&!W.is_valid&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-500 mr-2"}),t.jsx("h3",{className:"font-semibold text-red-800",children:"Validation Errors"})]}),t.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:W.errors.map((ct,Nt)=>t.jsxs("li",{children:[" ",ct]},Nt))})]}),t.jsx(j0,{summary:X,validationResult:W,selectedItems:U,onRemoveItem:Ae,showItemDetails:!0})]}),t.jsxs("div",{className:"flex justify-between items-center bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("div",{children:E!=="setup"&&t.jsx("button",{onClick:Ie,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Previous"})}),t.jsxs("div",{className:"flex space-x-3",children:[u&&t.jsx("button",{onClick:u,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),E!=="review"?t.jsx("button",{onClick:fe,disabled:!tt(),className:`px-4 py-2 rounded-md font-medium ${tt()?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"}):t.jsxs("button",{onClick:Ee,disabled:!(W!=null&&W.is_valid)||q,className:`flex items-center px-6 py-2 rounded-md font-medium ${W!=null&&W.is_valid&&!q?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[t.jsx(nS,{className:"h-4 w-4 mr-2"}),q?"Creating...":"Submit Transfer"]})]})]})]})};function Av(c){var u,x,f="";if(typeof c=="string"||typeof c=="number")f+=c;else if(typeof c=="object")if(Array.isArray(c)){var w=c.length;for(u=0;u<w;u++)c[u]&&(x=Av(c[u]))&&(f&&(f+=" "),f+=x)}else for(x in c)c[x]&&(f&&(f+=" "),f+=x);return f}function ck(){for(var c,u,x=0,f="",w=arguments.length;x<w;x++)(c=arguments[x])&&(u=Av(c))&&(f&&(f+=" "),f+=u);return f}const tg="-",dk=c=>{const u=hk(c),{conflictingClassGroups:x,conflictingClassGroupModifiers:f}=c;return{getClassGroupId:E=>{const A=E.split(tg);return A[0]===""&&A.length!==1&&A.shift(),Mv(A,u)||uk(E)},getConflictingClassGroupIds:(E,A)=>{const n=x[E]||[];return A&&f[E]?[...n,...f[E]]:n}}},Mv=(c,u)=>{var E;if(c.length===0)return u.classGroupId;const x=c[0],f=u.nextPart.get(x),w=f?Mv(c.slice(1),f):void 0;if(w)return w;if(u.validators.length===0)return;const N=c.join(tg);return(E=u.validators.find(({validator:A})=>A(N)))==null?void 0:E.classGroupId},N0=/^\[(.+)\]$/,uk=c=>{if(N0.test(c)){const u=N0.exec(c)[1],x=u==null?void 0:u.substring(0,u.indexOf(":"));if(x)return"arbitrary.."+x}},hk=c=>{const{theme:u,prefix:x}=c,f={nextPart:new Map,validators:[]};return pk(Object.entries(c.classGroups),x).forEach(([N,E])=>{Pf(E,f,N,u)}),f},Pf=(c,u,x,f)=>{c.forEach(w=>{if(typeof w=="string"){const N=w===""?u:S0(u,w);N.classGroupId=x;return}if(typeof w=="function"){if(mk(w)){Pf(w(f),u,x,f);return}u.validators.push({validator:w,classGroupId:x});return}Object.entries(w).forEach(([N,E])=>{Pf(E,S0(u,N),x,f)})})},S0=(c,u)=>{let x=c;return u.split(tg).forEach(f=>{x.nextPart.has(f)||x.nextPart.set(f,{nextPart:new Map,validators:[]}),x=x.nextPart.get(f)}),x},mk=c=>c.isThemeGetter,pk=(c,u)=>u?c.map(([x,f])=>{const w=f.map(N=>typeof N=="string"?u+N:typeof N=="object"?Object.fromEntries(Object.entries(N).map(([E,A])=>[u+E,A])):N);return[x,w]}):c,fk=c=>{if(c<1)return{get:()=>{},set:()=>{}};let u=0,x=new Map,f=new Map;const w=(N,E)=>{x.set(N,E),u++,u>c&&(u=0,f=x,x=new Map)};return{get(N){let E=x.get(N);if(E!==void 0)return E;if((E=f.get(N))!==void 0)return w(N,E),E},set(N,E){x.has(N)?x.set(N,E):w(N,E)}}},Pv="!",gk=c=>{const{separator:u,experimentalParseClassName:x}=c,f=u.length===1,w=u[0],N=u.length,E=A=>{const n=[];let P=0,z=0,q;for(let J=0;J<A.length;J++){let de=A[J];if(P===0){if(de===w&&(f||A.slice(J,J+N)===u)){n.push(A.slice(z,J)),z=J+N;continue}if(de==="/"){q=J;continue}}de==="["?P++:de==="]"&&P--}const U=n.length===0?A:A.substring(z),W=U.startsWith(Pv),X=W?U.substring(1):U,Z=q&&q>z?q-z:void 0;return{modifiers:n,hasImportantModifier:W,baseClassName:X,maybePostfixModifierPosition:Z}};return x?A=>x({className:A,parseClassName:E}):E},xk=c=>{if(c.length<=1)return c;const u=[];let x=[];return c.forEach(f=>{f[0]==="["?(u.push(...x.sort(),f),x=[]):x.push(f)}),u.push(...x.sort()),u},yk=c=>({cache:fk(c.cacheSize),parseClassName:gk(c),...dk(c)}),_k=/\s+/,vk=(c,u)=>{const{parseClassName:x,getClassGroupId:f,getConflictingClassGroupIds:w}=u,N=[],E=c.trim().split(_k);let A="";for(let n=E.length-1;n>=0;n-=1){const P=E[n],{modifiers:z,hasImportantModifier:q,baseClassName:U,maybePostfixModifierPosition:W}=x(P);let X=!!W,Z=f(X?U.substring(0,W):U);if(!Z){if(!X){A=P+(A.length>0?" "+A:A);continue}if(Z=f(U),!Z){A=P+(A.length>0?" "+A:A);continue}X=!1}const J=xk(z).join(":"),de=q?J+Pv:J,ne=de+Z;if(N.includes(ne))continue;N.push(ne);const te=w(Z,X);for(let Ne=0;Ne<te.length;++Ne){const he=te[Ne];N.push(de+he)}A=P+(A.length>0?" "+A:A)}return A};function bk(){let c=0,u,x,f="";for(;c<arguments.length;)(u=arguments[c++])&&(x=Iv(u))&&(f&&(f+=" "),f+=x);return f}const Iv=c=>{if(typeof c=="string")return c;let u,x="";for(let f=0;f<c.length;f++)c[f]&&(u=Iv(c[f]))&&(x&&(x+=" "),x+=u);return x};function wk(c,...u){let x,f,w,N=E;function E(n){const P=u.reduce((z,q)=>q(z),c());return x=yk(P),f=x.cache.get,w=x.cache.set,N=A,A(n)}function A(n){const P=f(n);if(P)return P;const z=vk(n,x);return w(n,z),z}return function(){return N(bk.apply(null,arguments))}}const Xs=c=>{const u=x=>x[c]||[];return u.isThemeGetter=!0,u},Dv=/^\[(?:([a-z-]+):)?(.+)\]$/i,jk=/^\d+\/\d+$/,Nk=new Set(["px","full","screen"]),Sk=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Tk=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Ek=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ck=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kk=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ma=c=>ec(c)||Nk.has(c)||jk.test(c),Wa=c=>dc(c,"length",zk),ec=c=>!!c&&!Number.isNaN(Number(c)),cf=c=>dc(c,"number",ec),Gd=c=>!!c&&Number.isInteger(Number(c)),Ak=c=>c.endsWith("%")&&ec(c.slice(0,-1)),ds=c=>Dv.test(c),Ha=c=>Sk.test(c),Mk=new Set(["length","size","percentage"]),Pk=c=>dc(c,Mk,Lv),Ik=c=>dc(c,"position",Lv),Dk=new Set(["image","url"]),Lk=c=>dc(c,Dk,Fk),Rk=c=>dc(c,"",Ok),Zd=()=>!0,dc=(c,u,x)=>{const f=Dv.exec(c);return f?f[1]?typeof u=="string"?f[1]===u:u.has(f[1]):x(f[2]):!1},zk=c=>Tk.test(c)&&!Ek.test(c),Lv=()=>!1,Ok=c=>Ck.test(c),Fk=c=>kk.test(c),Bk=()=>{const c=Xs("colors"),u=Xs("spacing"),x=Xs("blur"),f=Xs("brightness"),w=Xs("borderColor"),N=Xs("borderRadius"),E=Xs("borderSpacing"),A=Xs("borderWidth"),n=Xs("contrast"),P=Xs("grayscale"),z=Xs("hueRotate"),q=Xs("invert"),U=Xs("gap"),W=Xs("gradientColorStops"),X=Xs("gradientColorStopPositions"),Z=Xs("inset"),J=Xs("margin"),de=Xs("opacity"),ne=Xs("padding"),te=Xs("saturate"),Ne=Xs("scale"),he=Xs("sepia"),Ce=Xs("skew"),Ae=Xs("space"),fe=Xs("translate"),Ie=()=>["auto","contain","none"],Ee=()=>["auto","hidden","clip","visible","scroll"],tt=()=>["auto",ds,u],je=()=>[ds,u],Pe=()=>["",ma,Wa],it=()=>["auto",ec,ds],ct=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Nt=()=>["solid","dashed","dotted","double","none"],ft=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Mt=()=>["start","end","center","between","around","evenly","stretch"],ht=()=>["","0",ds],Os=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ns=()=>[ec,ds];return{cacheSize:500,separator:":",theme:{colors:[Zd],spacing:[ma,Wa],blur:["none","",Ha,ds],brightness:ns(),borderColor:[c],borderRadius:["none","","full",Ha,ds],borderSpacing:je(),borderWidth:Pe(),contrast:ns(),grayscale:ht(),hueRotate:ns(),invert:ht(),gap:je(),gradientColorStops:[c],gradientColorStopPositions:[Ak,Wa],inset:tt(),margin:tt(),opacity:ns(),padding:je(),saturate:ns(),scale:ns(),sepia:ht(),skew:ns(),space:je(),translate:je()},classGroups:{aspect:[{aspect:["auto","square","video",ds]}],container:["container"],columns:[{columns:[Ha]}],"break-after":[{"break-after":Os()}],"break-before":[{"break-before":Os()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ct(),ds]}],overflow:[{overflow:Ee()}],"overflow-x":[{"overflow-x":Ee()}],"overflow-y":[{"overflow-y":Ee()}],overscroll:[{overscroll:Ie()}],"overscroll-x":[{"overscroll-x":Ie()}],"overscroll-y":[{"overscroll-y":Ie()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[Z]}],"inset-x":[{"inset-x":[Z]}],"inset-y":[{"inset-y":[Z]}],start:[{start:[Z]}],end:[{end:[Z]}],top:[{top:[Z]}],right:[{right:[Z]}],bottom:[{bottom:[Z]}],left:[{left:[Z]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Gd,ds]}],basis:[{basis:tt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ds]}],grow:[{grow:ht()}],shrink:[{shrink:ht()}],order:[{order:["first","last","none",Gd,ds]}],"grid-cols":[{"grid-cols":[Zd]}],"col-start-end":[{col:["auto",{span:["full",Gd,ds]},ds]}],"col-start":[{"col-start":it()}],"col-end":[{"col-end":it()}],"grid-rows":[{"grid-rows":[Zd]}],"row-start-end":[{row:["auto",{span:[Gd,ds]},ds]}],"row-start":[{"row-start":it()}],"row-end":[{"row-end":it()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ds]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ds]}],gap:[{gap:[U]}],"gap-x":[{"gap-x":[U]}],"gap-y":[{"gap-y":[U]}],"justify-content":[{justify:["normal",...Mt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Mt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Mt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ne]}],px:[{px:[ne]}],py:[{py:[ne]}],ps:[{ps:[ne]}],pe:[{pe:[ne]}],pt:[{pt:[ne]}],pr:[{pr:[ne]}],pb:[{pb:[ne]}],pl:[{pl:[ne]}],m:[{m:[J]}],mx:[{mx:[J]}],my:[{my:[J]}],ms:[{ms:[J]}],me:[{me:[J]}],mt:[{mt:[J]}],mr:[{mr:[J]}],mb:[{mb:[J]}],ml:[{ml:[J]}],"space-x":[{"space-x":[Ae]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ae]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ds,u]}],"min-w":[{"min-w":[ds,u,"min","max","fit"]}],"max-w":[{"max-w":[ds,u,"none","full","min","max","fit","prose",{screen:[Ha]},Ha]}],h:[{h:[ds,u,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ds,u,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ds,u,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ds,u,"auto","min","max","fit"]}],"font-size":[{text:["base",Ha,Wa]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",cf]}],"font-family":[{font:[Zd]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ds]}],"line-clamp":[{"line-clamp":["none",ec,cf]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ma,ds]}],"list-image":[{"list-image":["none",ds]}],"list-style-type":[{list:["none","disc","decimal",ds]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[c]}],"placeholder-opacity":[{"placeholder-opacity":[de]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[c]}],"text-opacity":[{"text-opacity":[de]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Nt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ma,Wa]}],"underline-offset":[{"underline-offset":["auto",ma,ds]}],"text-decoration-color":[{decoration:[c]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:je()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ds]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ds]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[de]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ct(),Ik]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Pk]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Lk]}],"bg-color":[{bg:[c]}],"gradient-from-pos":[{from:[X]}],"gradient-via-pos":[{via:[X]}],"gradient-to-pos":[{to:[X]}],"gradient-from":[{from:[W]}],"gradient-via":[{via:[W]}],"gradient-to":[{to:[W]}],rounded:[{rounded:[N]}],"rounded-s":[{"rounded-s":[N]}],"rounded-e":[{"rounded-e":[N]}],"rounded-t":[{"rounded-t":[N]}],"rounded-r":[{"rounded-r":[N]}],"rounded-b":[{"rounded-b":[N]}],"rounded-l":[{"rounded-l":[N]}],"rounded-ss":[{"rounded-ss":[N]}],"rounded-se":[{"rounded-se":[N]}],"rounded-ee":[{"rounded-ee":[N]}],"rounded-es":[{"rounded-es":[N]}],"rounded-tl":[{"rounded-tl":[N]}],"rounded-tr":[{"rounded-tr":[N]}],"rounded-br":[{"rounded-br":[N]}],"rounded-bl":[{"rounded-bl":[N]}],"border-w":[{border:[A]}],"border-w-x":[{"border-x":[A]}],"border-w-y":[{"border-y":[A]}],"border-w-s":[{"border-s":[A]}],"border-w-e":[{"border-e":[A]}],"border-w-t":[{"border-t":[A]}],"border-w-r":[{"border-r":[A]}],"border-w-b":[{"border-b":[A]}],"border-w-l":[{"border-l":[A]}],"border-opacity":[{"border-opacity":[de]}],"border-style":[{border:[...Nt(),"hidden"]}],"divide-x":[{"divide-x":[A]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[A]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[de]}],"divide-style":[{divide:Nt()}],"border-color":[{border:[w]}],"border-color-x":[{"border-x":[w]}],"border-color-y":[{"border-y":[w]}],"border-color-s":[{"border-s":[w]}],"border-color-e":[{"border-e":[w]}],"border-color-t":[{"border-t":[w]}],"border-color-r":[{"border-r":[w]}],"border-color-b":[{"border-b":[w]}],"border-color-l":[{"border-l":[w]}],"divide-color":[{divide:[w]}],"outline-style":[{outline:["",...Nt()]}],"outline-offset":[{"outline-offset":[ma,ds]}],"outline-w":[{outline:[ma,Wa]}],"outline-color":[{outline:[c]}],"ring-w":[{ring:Pe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[c]}],"ring-opacity":[{"ring-opacity":[de]}],"ring-offset-w":[{"ring-offset":[ma,Wa]}],"ring-offset-color":[{"ring-offset":[c]}],shadow:[{shadow:["","inner","none",Ha,Rk]}],"shadow-color":[{shadow:[Zd]}],opacity:[{opacity:[de]}],"mix-blend":[{"mix-blend":[...ft(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ft()}],filter:[{filter:["","none"]}],blur:[{blur:[x]}],brightness:[{brightness:[f]}],contrast:[{contrast:[n]}],"drop-shadow":[{"drop-shadow":["","none",Ha,ds]}],grayscale:[{grayscale:[P]}],"hue-rotate":[{"hue-rotate":[z]}],invert:[{invert:[q]}],saturate:[{saturate:[te]}],sepia:[{sepia:[he]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[x]}],"backdrop-brightness":[{"backdrop-brightness":[f]}],"backdrop-contrast":[{"backdrop-contrast":[n]}],"backdrop-grayscale":[{"backdrop-grayscale":[P]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[z]}],"backdrop-invert":[{"backdrop-invert":[q]}],"backdrop-opacity":[{"backdrop-opacity":[de]}],"backdrop-saturate":[{"backdrop-saturate":[te]}],"backdrop-sepia":[{"backdrop-sepia":[he]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[E]}],"border-spacing-x":[{"border-spacing-x":[E]}],"border-spacing-y":[{"border-spacing-y":[E]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ds]}],duration:[{duration:ns()}],ease:[{ease:["linear","in","out","in-out",ds]}],delay:[{delay:ns()}],animate:[{animate:["none","spin","ping","pulse","bounce",ds]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Ne]}],"scale-x":[{"scale-x":[Ne]}],"scale-y":[{"scale-y":[Ne]}],rotate:[{rotate:[Gd,ds]}],"translate-x":[{"translate-x":[fe]}],"translate-y":[{"translate-y":[fe]}],"skew-x":[{"skew-x":[Ce]}],"skew-y":[{"skew-y":[Ce]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ds]}],accent:[{accent:["auto",c]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ds]}],"caret-color":[{caret:[c]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":je()}],"scroll-mx":[{"scroll-mx":je()}],"scroll-my":[{"scroll-my":je()}],"scroll-ms":[{"scroll-ms":je()}],"scroll-me":[{"scroll-me":je()}],"scroll-mt":[{"scroll-mt":je()}],"scroll-mr":[{"scroll-mr":je()}],"scroll-mb":[{"scroll-mb":je()}],"scroll-ml":[{"scroll-ml":je()}],"scroll-p":[{"scroll-p":je()}],"scroll-px":[{"scroll-px":je()}],"scroll-py":[{"scroll-py":je()}],"scroll-ps":[{"scroll-ps":je()}],"scroll-pe":[{"scroll-pe":je()}],"scroll-pt":[{"scroll-pt":je()}],"scroll-pr":[{"scroll-pr":je()}],"scroll-pb":[{"scroll-pb":je()}],"scroll-pl":[{"scroll-pl":je()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ds]}],fill:[{fill:[c,"none"]}],"stroke-w":[{stroke:[ma,Wa,cf]}],stroke:[{stroke:[c,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Uk=wk(Bk);function au(...c){return Uk(ck(c))}const sg=oe.createContext(void 0),Vk=({value:c,onValueChange:u,children:x,className:f})=>t.jsx(sg.Provider,{value:{value:c,onValueChange:u},children:t.jsx("div",{className:au("w-full",f),"data-state":c,children:x})}),qk=({children:c,className:u})=>t.jsx("div",{className:au("inline-flex h-10 items-center justify-center rounded-lg bg-gray-100 p-1 text-gray-500",u),children:c}),df=({value:c,children:u,className:x})=>{const f=oe.useContext(sg);if(!f)throw new Error("TabsTrigger must be used within a Tabs component");const{value:w,onValueChange:N}=f,E=w===c;return t.jsx("button",{role:"tab","data-state":E?"active":"inactive",onClick:()=>N(c),className:au("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",E?"bg-white text-gray-950 shadow-sm":"hover:bg-gray-200",x),children:u})},uf=({value:c,children:u,className:x})=>{const f=oe.useContext(sg);if(!f)throw new Error("TabsContent must be used within a Tabs component");const{value:w}=f,N=w===c;return N?t.jsx("div",{role:"tabpanel","data-state":N?"active":"inactive",className:au("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2",x),children:u}):null},T0=({children:c,className:u})=>t.jsx("div",{className:au("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm",u),children:c});class Ih extends li.Component{constructor(u){super(u),this.state={hasError:!1}}static getDerivedStateFromError(u){return{hasError:!0,error:u}}componentDidCatch(u,x){console.error("Transfer page error:",u,x)}render(){return this.state.hasError?this.props.fallback||t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(tu,{className:"h-5 w-5 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Something went wrong"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"There was an error loading this section. Please refresh the page or try again later."}),this.state.error&&t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"cursor-pointer",children:"Error details"}),t.jsx("pre",{className:"mt-1 text-xs",children:this.state.error.message})]})]})]})]})}):this.props.children}}const $k=()=>{const[c,u]=oe.useState("load");return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Transfers"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage inventory transfers between warehouses and trucks"})]}),t.jsx(Ih,{children:t.jsxs(Vk,{value:c,onValueChange:u,className:"space-y-6",children:[t.jsxs(qk,{className:"grid w-full grid-cols-3",children:[t.jsxs(df,{value:"load",className:"flex items-center space-x-2",children:[t.jsx(mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Load Truck"})]}),t.jsxs(df,{value:"return",className:"flex items-center space-x-2",children:[t.jsx(Bf,{className:"h-4 w-4"}),t.jsx("span",{children:"Return to Warehouse"})]}),t.jsxs(df,{value:"multi-sku",className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4"}),t.jsx("span",{children:"Multi-SKU Transfer"})]})]}),t.jsx(uf,{value:"load",children:t.jsx(T0,{children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Load Truck"}),t.jsx(Ih,{children:t.jsx(YC,{})})]})})}),t.jsx(uf,{value:"return",children:t.jsx(T0,{children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Return to Warehouse"}),t.jsx(Ih,{children:t.jsx(tk,{})})]})})}),t.jsx(uf,{value:"multi-sku",children:t.jsx(Ih,{children:t.jsx(lk,{onTransferCreated:x=>{console.log("Transfer created:",x)}})})})]})})]})},Gk=()=>t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),t.jsx("p",{className:"text-gray-600",children:"System configuration and preferences"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx(aS,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"System Settings"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"This page will contain system configuration options, user preferences, and administrative settings."}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-500",children:[t.jsx("p",{children:" User account management"}),t.jsx("p",{children:" System preferences and configuration"}),t.jsx("p",{children:" Security settings and permissions"}),t.jsx("p",{children:" Backup and maintenance options"})]})]})})]}),Zk=({trucks:c,loading:u,onStatusChange:x})=>u?t.jsx("div",{className:"flex justify-center items-center h-32",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):c.length?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Truck Details"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Load"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"relative px-6 py-3",children:t.jsx("span",{className:"sr-only",children:"Actions"})})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(f=>{const w=(f.inventory||[]).reduce((A,n)=>A+(n.qty_full||0)+(n.qty_empty||0),0),N=w/f.capacity_cylinders*100,E=N>100;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(mr,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.fleet_number}),t.jsx("div",{className:"text-sm text-gray-500",children:f.license_plate})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:f.driver_name||"Unassigned"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("div",{className:"text-sm text-gray-900",children:f.capacity_cylinders})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("div",{className:"w-48",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("span",{className:"text-xs font-medium text-gray-500",children:[w," / ",f.capacity_cylinders]}),E&&t.jsx(tu,{className:"h-4 w-4 text-red-500",title:"Overloaded"})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full ${E?"bg-red-500":"bg-blue-500"}`,style:{width:`${Math.min(N,100)}%`}})})]})})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("select",{value:f.active?"active":"inactive",onChange:A=>x(f,A.target.value==="active"),className:`block w-full pl-3 pr-10 py-2 text-sm border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${f.active?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx(hf,{to:`/trucks/${f.id}`,className:"text-blue-600 hover:text-blue-900",children:"View Details"})})]},f.id)})})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(mr,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No trucks"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new truck."}),t.jsx("div",{className:"mt-6",children:t.jsx(hf,{to:"/trucks/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"Add Truck"})})]}),Wk=(c={})=>yt.trucks.list.useQuery(c,{retry:1,staleTime:3e4,select:u=>({trucks:u.trucks,isLoading:!1,error:null,totalCount:u.totalCount,totalPages:u.totalPages,currentPage:u.currentPage})}),Hk=c=>yt.trucks.get.useQuery({id:c},{enabled:!!c}),Xk=()=>yt.trucks.create.useMutation({onSuccess:c=>{console.log("Truck created successfully:",c),It.success("Truck created successfully")},onError:c=>{console.error("Create truck mutation error:",c),It.error(c.message||"Failed to create truck")}}),Rv=()=>yt.trucks.update.useMutation({onSuccess:c=>{console.log("Truck updated successfully:",c),It.success("Truck updated successfully")},onError:c=>{console.error("Update truck mutation error:",c),It.error(c.message||"Failed to update truck")}}),Kk=()=>{const{data:c,isLoading:u,error:x}=Wk(),f=Rv(),w=(c==null?void 0:c.trucks)||[],N=async(E,A)=>{try{await f.mutateAsync({id:E.id,active:A})}catch(n){console.error("Error updating truck status:",n),alert("Failed to update truck status. Please try again.")}};return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Trucks"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage your fleet and monitor truck inventory"})]}),t.jsxs(hf,{to:"/trucks/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[t.jsx(wr,{className:"-ml-1 mr-2 h-5 w-5"}),"Add Truck"]})]}),x&&t.jsx("div",{className:"rounded-md bg-red-50 p-4 mb-8",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:x.message})})})}),t.jsx(Zk,{trucks:w,loading:u,onStatusChange:N})]})},zv=({initialData:c,onSuccess:u})=>{const x=Qr(),f=Xk(),w=Rv(),[N,E]=oe.useState(null),[A,n]=oe.useState({fleet_number:(c==null?void 0:c.fleet_number)||"",license_plate:(c==null?void 0:c.license_plate)||"",capacity_cylinders:(c==null?void 0:c.capacity_cylinders)||"",driver_name:(c==null?void 0:c.driver_name)||"",active:(c==null?void 0:c.active)??!0}),P=f.isLoading||w.isLoading,z=async q=>{if(q.preventDefault(),!P){E(null);try{if(!A.fleet_number)throw new Error("Fleet number is required");if(!A.license_plate)throw new Error("License plate is required");const U=parseInt(String(A.capacity_cylinders));if(isNaN(U)||U<=0)throw new Error("Capacity must be a valid number greater than 0");const W={fleet_number:A.fleet_number,license_plate:A.license_plate,capacity_cylinders:U,driver_name:A.driver_name||null,active:A.active};let X;c!=null&&c.id?X=await w.mutateAsync({id:c.id,...W}):X=await f.mutateAsync(W),console.log("Operation successful, result:",X),u?u():(console.log("Navigating to:",`/trucks/${X.id}`),x(`/trucks/${X.id}`))}catch(U){console.error("Form submission error:",U),E(U.message||"Failed to save truck")}}};return t.jsxs("form",{onSubmit:z,className:"space-y-6",children:[N&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:N})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(mr,{className:"h-6 w-6 text-gray-400"}),t.jsx("h3",{className:"ml-2 text-lg font-medium text-gray-900",children:c?"Edit Truck":"New Truck"})]})}),t.jsxs("div",{className:"px-6 py-5 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"fleet_number",className:"block text-sm font-medium text-gray-700",children:"Fleet Number"}),t.jsx("input",{type:"text",id:"fleet_number",value:A.fleet_number,onChange:q=>n({...A,fleet_number:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"license_plate",className:"block text-sm font-medium text-gray-700",children:"License Plate"}),t.jsx("input",{type:"text",id:"license_plate",value:A.license_plate,onChange:q=>n({...A,license_plate:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_cylinders",className:"block text-sm font-medium text-gray-700",children:"Capacity (Cylinders)"}),t.jsx("input",{type:"number",id:"capacity_cylinders",min:"1",placeholder:"Enter capacity",value:A.capacity_cylinders||"",onChange:q=>{const U=q.target.value;n(W=>({...W,capacity_cylinders:U===""?"":parseInt(U)}))},className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"driver_name",className:"block text-sm font-medium text-gray-700",children:"Driver Name"}),t.jsx("input",{type:"text",id:"driver_name",value:A.driver_name,onChange:q=>n({...A,driver_name:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"active",checked:A.active,onChange:q=>n({...A,active:q.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"active",className:"ml-2 block text-sm text-gray-900",children:"Active"})]})]}),t.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>x("/trucks"),className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:P,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:P?t.jsxs("div",{className:"flex items-center",children:[t.jsx(tr,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Saving..."]}):"Save Truck"})]})})]})]})},Qk=()=>{const{id:c}=nc(),u=Qr(),[x,f]=oe.useState(!1),{data:w,isLoading:N,error:E}=Hk(c||"");if(N)return t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})});if(E||!w)return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:(E==null?void 0:E.message)||"Truck not found"})})})})});if(x)return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("button",{onClick:()=>f(!1),className:"mb-6 inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t.jsx(Mr,{className:"h-4 w-4 mr-1"}),"Back to Details"]}),t.jsx(zv,{initialData:w,onSuccess:()=>{f(!1),loadTruckDetails()}})]});const A=w.inventory.reduce((n,P)=>n+(P.qty_full||0)+(P.qty_empty||0),0);return A/w.capacity_cylinders*100,t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("button",{onClick:()=>u("/trucks"),className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t.jsx(Mr,{className:"h-4 w-4 mr-1"}),"Back to Trucks"]})}),t.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(mr,{className:"h-6 w-6 text-gray-400"}),t.jsx("h1",{className:"ml-2 text-xl font-semibold text-gray-900",children:w.fleet_number}),t.jsx("span",{className:`ml-4 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${w.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:w.active?"Active":"Inactive"})]}),t.jsxs("button",{onClick:()=>f(!0),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[t.jsx(di,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),t.jsxs("div",{className:"px-6 py-5 grid grid-cols-1 gap-6 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Truck Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"License Plate"}),t.jsx("p",{className:"mt-1",children:w.license_plate})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Driver"}),t.jsx("p",{className:"mt-1",children:w.driver_name||"Not assigned"})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Capacity"}),t.jsxs("p",{className:"mt-1",children:[w.capacity_cylinders," cylinders"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Current Load"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("p",{className:"text-lg font-medium",children:[A," / ",w.capacity_cylinders," cylinders"]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:t.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${A/(w.capacity_cylinders||1)*100}%`}})})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Inventory Breakdown"}),w.inventory.length===0?t.jsx("p",{className:"text-sm text-gray-500",children:"No inventory items"}):t.jsx("div",{className:"space-y-3",children:w.inventory.map(n=>t.jsxs("div",{className:"flex items-start",children:[t.jsx(hs,{className:"h-5 w-5 text-gray-400 mt-0.5"}),t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.product_name}),t.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",n.product_sku]}),t.jsxs("div",{className:"mt-1 flex space-x-4",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:["Full: ",n.qty_full||0]}),t.jsxs("span",{className:"text-xs text-gray-500",children:["Empty: ",n.qty_empty||0]})]})]})]},n.product_id))})]})]})]})]})]})},Jk=()=>{const c=Qr();return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Add New Truck"}),t.jsx(zv,{onSuccess:()=>c("/trucks")})]})},Yk=({schedule:c,onClick:u})=>{const{truck:x,capacity_info:f,allocations:w,maintenance_due:N,fuel_sufficient:E}=c,A=q=>{switch(q){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-gray-600 bg-gray-100";case"maintenance":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}},n=(q,U)=>U?"bg-red-500":q>85?"bg-orange-500":q>60?"bg-yellow-500":"bg-green-500",P=q=>q>=1e3?`${(q/1e3).toFixed(1)}t`:`${q}kg`,z=[];return N&&z.push("Maintenance Due"),E||z.push("Low Fuel"),f.is_overallocated&&z.push("Overallocated"),t.jsxs("div",{className:`bg-white rounded-lg shadow border-2 transition-all duration-200 hover:shadow-md ${u?"cursor-pointer hover:border-blue-300":"border-gray-200"} ${f.is_overallocated?"border-red-300":"border-gray-200"}`,onClick:u,children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(mr,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:x.fleet_number}),t.jsx("p",{className:"text-sm text-gray-600",children:x.license_plate})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(xm,{status:x.status,className:A(x.status)}),z.length>0&&t.jsxs("div",{className:"flex items-center text-red-600",children:[t.jsx(Us,{className:"h-4 w-4"}),t.jsx("span",{className:"text-xs ml-1",children:z.length})]})]})]})}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Capacity"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[P(f.allocated_weight_kg)," / ",P(f.total_capacity_kg)]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:t.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${n(f.utilization_percentage,f.is_overallocated)}`,style:{width:`${Math.min(f.utilization_percentage,100)}%`}})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[t.jsx("span",{children:"0%"}),t.jsxs("span",{className:"font-medium",children:[f.utilization_percentage.toFixed(1),"%"]}),t.jsx("span",{children:"100%"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Orders"}),t.jsx("p",{className:"font-semibold",children:f.orders_count})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(mr,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Available"}),t.jsx("p",{className:"font-semibold",children:P(f.available_weight_kg)})]})]}),x.driver_name&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"h-4 w-4 bg-gray-400 rounded-full"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Driver"}),t.jsx("p",{className:"font-semibold text-sm",children:x.driver_name})]})]}),c.route&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Route"}),t.jsx("p",{className:"font-semibold",children:c.route.route_status})]})]})]}),z.length>0&&t.jsxs("div",{className:"space-y-1",children:[N&&t.jsxs("div",{className:"flex items-center space-x-2 text-yellow-700 bg-yellow-50 p-2 rounded",children:[t.jsx(lS,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Maintenance due"})]}),!E&&t.jsxs("div",{className:"flex items-center space-x-2 text-orange-700 bg-orange-50 p-2 rounded",children:[t.jsx(__,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Check fuel level"})]}),f.is_overallocated&&t.jsxs("div",{className:"flex items-center space-x-2 text-red-700 bg-red-50 p-2 rounded",children:[t.jsx(Us,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:["Capacity exceeded by ",P(f.allocated_weight_kg-f.total_capacity_kg)]})]})]}),w.length>0&&t.jsxs("div",{className:"border-t pt-3 mt-3",children:[t.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-2",children:["Today's Orders (",w.length,")"]}),t.jsxs("div",{className:"space-y-1",children:[w.slice(0,3).map((q,U)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-gray-600",children:["Order #",q.order_id.slice(-6)]}),t.jsx("span",{className:"font-medium",children:P(q.estimated_weight_kg)})]},q.id)),w.length>3&&t.jsxs("p",{className:"text-xs text-gray-500",children:["+",w.length-3," more orders"]})]})]})]})})]})},eA=({order:c,orderWeight:u,recommendations:x,selectedTruckId:f,onTruckSelect:w,onCancel:N,onConfirm:E,isLoading:A=!1})=>{const[n,P]=oe.useState(!1),z=Z=>Z>=1e3?`${(Z/1e3).toFixed(1)}t`:`${Z}kg`,q=x.filter(Z=>Z.can_accommodate),U=x.filter(Z=>!Z.can_accommodate),W=x.find(Z=>Z.truck.id===f),X=f&&(W==null?void 0:W.can_accommodate);return t.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 max-w-4xl w-full",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Assign Truck for Order #",c.id.slice(-6)]}),t.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(hs,{className:"h-4 w-4"}),t.jsxs("span",{children:["Order Weight: ",z(u)]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(jf,{className:"h-4 w-4"}),t.jsxs("span",{children:["Delivery Date: ",c.scheduled_date||"Today"]})]})]})]}),t.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600",children:""})]})}),t.jsxs("div",{className:"px-6 py-4",children:[q.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center",children:[t.jsx(Gn,{className:"h-5 w-5 text-green-500 mr-2"}),"Available Trucks (",q.length,")"]}),t.jsx("div",{className:"grid gap-3",children:q.map(Z=>t.jsx(E0,{recommendation:Z,orderWeight:u,isSelected:f===Z.truck.id,onClick:()=>w(Z.truck.id)},Z.truck.id))})]}),U.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-700 flex items-center",children:[t.jsx(Us,{className:"h-5 w-5 text-red-500 mr-2"}),"Unavailable Trucks (",U.length,")"]}),t.jsxs("button",{onClick:()=>P(!n),className:"text-sm text-blue-600 hover:text-blue-800",children:[n?"Hide":"Show"," unavailable trucks"]})]}),n&&t.jsx("div",{className:"grid gap-3 opacity-75",children:U.map(Z=>t.jsx(E0,{recommendation:Z,orderWeight:u,isSelected:!1,onClick:()=>{},disabled:!0},Z.truck.id))})]}),x.length===0&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(mr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"No trucks available for this order"})]})]}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-gray-600",children:W&&t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{children:["Selected: ",W.truck.fleet_number]}),t.jsxs("span",{children:["Utilization after: ",((W.capacity_info.allocated_weight_kg+u)/W.capacity_info.total_capacity_kg*100).toFixed(1),"%"]})]})}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:N,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:E,disabled:!X||A,className:`px-4 py-2 rounded-md font-medium ${X&&!A?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:A?"Assigning...":"Assign Truck"})]})]})})]})},E0=({recommendation:c,orderWeight:u,isSelected:x,onClick:f,disabled:w=!1})=>{const{truck:N,capacity_info:E,warnings:A,errors:n}=c,P=q=>q>=1e3?`${(q/1e3).toFixed(1)}t`:`${q}kg`,z=(E.allocated_weight_kg+u)/E.total_capacity_kg*100;return t.jsxs("div",{className:`border-2 rounded-lg p-4 transition-all duration-200 ${w?"cursor-not-allowed opacity-75":"cursor-pointer"} ${x?"border-blue-500 bg-blue-50":n.length>0?"border-red-300 hover:border-red-400":A.length>0?"border-yellow-300 hover:border-yellow-400":"border-gray-200 hover:border-blue-300"}`,onClick:w?void 0:f,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${x?"bg-blue-200":"bg-gray-100"}`,children:t.jsx(mr,{className:`h-5 w-5 ${x?"text-blue-600":"text-gray-600"}`})}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900",children:N.fleet_number}),t.jsx("p",{className:"text-sm text-gray-600",children:N.license_plate}),N.driver_name&&t.jsxs("p",{className:"text-xs text-gray-500",children:["Driver: ",N.driver_name]})]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:n.length>0?t.jsx(Us,{className:"h-5 w-5 text-red-500"}):A.length>0?t.jsx(Us,{className:"h-5 w-5 text-yellow-500"}):t.jsx(Gn,{className:"h-5 w-5 text-green-500"})})]}),t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[t.jsxs("span",{children:["Current: ",E.utilization_percentage.toFixed(1),"%"]}),t.jsxs("span",{children:["After: ",z.toFixed(1),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsxs("div",{className:"flex h-2 rounded-full overflow-hidden",children:[t.jsx("div",{className:"bg-blue-500",style:{width:`${Math.min(E.utilization_percentage,100)}%`}}),t.jsx("div",{className:`${z>100?"bg-red-500":z>85?"bg-orange-500":"bg-blue-300"}`,style:{width:`${Math.min(Math.max(0,z-E.utilization_percentage),100-E.utilization_percentage)}%`}})]})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[t.jsxs("span",{children:[P(E.allocated_weight_kg)," / ",P(E.total_capacity_kg)]}),t.jsxs("span",{children:["Available: ",P(E.available_weight_kg)]})]})]}),(n.length>0||A.length>0)&&t.jsxs("div",{className:"mt-3 space-y-1",children:[n.map((q,U)=>t.jsx("div",{className:"text-xs text-red-700 bg-red-50 p-2 rounded",children:q},U)),A.map((q,U)=>t.jsx("div",{className:"text-xs text-yellow-700 bg-yellow-50 p-2 rounded",children:q},U))]})]})},tA=()=>{const[c,u]=oe.useState(new Date().toISOString().split("T")[0]),[x,f]=oe.useState(!1),w={total_capacity_kg:5400,total_allocated_kg:3780,overall_utilization:70,active_trucks:8,overallocated_trucks:1,maintenance_due_trucks:2},N=[],E=P=>P>=1e3?`${(P/1e3).toFixed(1)}t`:`${P}kg`,A=P=>new Date(P).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),n=P=>"text-yellow-600 bg-yellow-100";return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsx("div",{className:"py-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Fleet Capacity Dashboard"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Monitor truck capacity and optimize delivery allocations"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-5 w-5 text-gray-400"}),t.jsx("input",{type:"date",value:c,onChange:P=>u(P.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),t.jsxs("button",{onClick:()=>f(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center space-x-2",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Allocate Order"})]})]})]})})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Ji,{className:`h-8 w-8 ${n()}`})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Fleet Utilization"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[w.overall_utilization.toFixed(1),"%"]}),t.jsxs("p",{className:"text-xs text-gray-500",children:[E(w.total_allocated_kg)," / ",E(w.total_capacity_kg)]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(mr,{className:"h-8 w-8 text-blue-600 bg-blue-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Trucks"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.active_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Available for delivery"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Us,{className:"h-8 w-8 text-red-600 bg-red-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overallocated"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.overallocated_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Need attention"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(hs,{className:"h-8 w-8 text-yellow-600 bg-yellow-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Maintenance Due"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.maintenance_due_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Schedule soon"})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Fleet Capacity for ",A(c)]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[E(w.total_allocated_kg)," allocated of ",E(w.total_capacity_kg)," total capacity"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-2",children:t.jsx("div",{className:"h-4 rounded-full transition-all duration-500 bg-yellow-500",style:{width:`${Math.min(w.overall_utilization,100)}%`}})}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{children:"0%"}),t.jsxs("span",{className:"font-medium",children:[w.overall_utilization.toFixed(1),"% Utilized"]}),t.jsx("span",{children:"100%"})]})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Truck Capacity Details"}),t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),t.jsx("span",{children:"Good utilization"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),t.jsx("span",{children:"High utilization"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),t.jsx("span",{children:"Overallocated"})]})]})]}),N.length>0?t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:N.map(P=>t.jsx(Yk,{schedule:P,onClick:()=>{console.log("Truck clicked:",P.truck_id)}},P.truck_id))}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(mr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsxs("p",{className:"text-gray-600 mb-2",children:["No truck schedules for ",A(c)]}),t.jsx("p",{className:"text-sm text-gray-500",children:"Try selecting a different date or ensure trucks are properly configured"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(wr,{className:"h-6 w-6 text-blue-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Allocate Orders"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Assign pending orders to trucks"})]})]})}),t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-green-400 hover:bg-green-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ji,{className:"h-6 w-6 text-green-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Optimize Routes"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Auto-optimize truck allocations"})]})]})}),t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-yellow-400 hover:bg-yellow-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Us,{className:"h-6 w-6 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Maintenance"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Schedule truck maintenance"})]})]})})]})]})]}),x&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsx(eA,{order:{id:"sample-order",scheduled_date:c},orderWeight:150,recommendations:[],onTruckSelect:P=>console.log("Selected:",P),onCancel:()=>f(!1),onConfirm:()=>{f(!1)}})})]})};function sA(){return t.jsxs(FN,{children:[t.jsx(y1,{children:t.jsxs(_1,{children:[t.jsx(Hs,{path:"/login",element:t.jsx(fS,{})}),t.jsxs(Hs,{path:"/*",element:t.jsx(dS,{children:t.jsx(pS,{})}),children:[t.jsx(Hs,{index:!0,element:t.jsx(Hy,{})}),t.jsx(Hs,{path:"dashboard",element:t.jsx(Hy,{})}),t.jsx(Hs,{path:"customers",element:t.jsx(_E,{})}),t.jsx(Hs,{path:"customers/:id",element:t.jsx(DE,{})}),t.jsx(Hs,{path:"products",element:t.jsx(HE,{})}),t.jsx(Hs,{path:"products/:id",element:t.jsx(sC,{})}),t.jsx(Hs,{path:"warehouses",element:t.jsx(dC,{})}),t.jsx(Hs,{path:"warehouses/:id",element:t.jsx(gC,{})}),t.jsx(Hs,{path:"inventory",element:t.jsx(wC,{})}),t.jsx(Hs,{path:"pricing",element:t.jsx(EC,{})}),t.jsx(Hs,{path:"pricing/:id",element:t.jsx(AC,{})}),t.jsx(Hs,{path:"orders",element:t.jsx(BC,{})}),t.jsx(Hs,{path:"orders/new",element:t.jsx($C,{})}),t.jsx(Hs,{path:"orders/schedule",element:t.jsx(XC,{})}),t.jsx(Hs,{path:"orders/reports",element:t.jsx(QC,{})}),t.jsx(Hs,{path:"orders/:id",element:t.jsx(WC,{})}),t.jsx(Hs,{path:"transfers",element:t.jsx($k,{})}),t.jsx(Hs,{path:"settings",element:t.jsx(Gk,{})}),t.jsxs(Hs,{path:"trucks",children:[t.jsx(Hs,{index:!0,element:t.jsx(Kk,{})}),t.jsx(Hs,{path:"new",element:t.jsx(Jk,{})}),t.jsx(Hs,{path:"capacity",element:t.jsx(tA,{})}),t.jsx(Hs,{path:":id",element:t.jsx(Qk,{})})]})]})]})}),t.jsx(Yj,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})}const C0=new U1({defaultOptions:{queries:{retry:1,staleTime:3e4,refetchOnWindowFocus:!1}}});window.addEventListener("error",c=>{console.error("Global error:",c.error)});window.addEventListener("unhandledrejection",c=>{console.error("Unhandled promise rejection:",c.reason)});const Ov=document.getElementById("root");if(!Ov)throw new Error("Failed to find the root element");try{P0(Ov).render(t.jsx(oe.StrictMode,{children:t.jsx(yt.Provider,{client:ON,queryClient:C0,children:t.jsx(rj,{client:C0,children:t.jsx(sA,{})})})}))}catch(c){console.error("Error rendering app:",c)}
//# sourceMappingURL=index-Bh08_deV.js.map
