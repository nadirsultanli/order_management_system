import{r as le,a as f1,R as mi,N as k0,b as g1,O as x1,c as y1,g as _1,u as Qr,d as nc,L as mf,B as b1,e as v1,f as Hs}from"./vendor-BeIN97dW.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))g(w);new MutationObserver(w=>{for(const N of w)if(N.type==="childList")for(const T of N.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&g(T)}).observe(document,{childList:!0,subtree:!0});function f(w){const N={};return w.integrity&&(N.integrity=w.integrity),w.referrerPolicy&&(N.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?N.credentials="include":w.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function g(w){if(w.ep)return;w.ep=!0;const N=f(w);fetch(w.href,N)}})();var A0={exports:{}},Jh={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w1=le,j1=Symbol.for("react.element"),N1=Symbol.for("react.fragment"),S1=Object.prototype.hasOwnProperty,T1=w1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,E1={key:!0,ref:!0,__self:!0,__source:!0};function M0(c,d,f){var g,w={},N=null,T=null;f!==void 0&&(N=""+f),d.key!==void 0&&(N=""+d.key),d.ref!==void 0&&(T=d.ref);for(g in d)S1.call(d,g)&&!E1.hasOwnProperty(g)&&(w[g]=d[g]);if(c&&c.defaultProps)for(g in d=c.defaultProps,d)w[g]===void 0&&(w[g]=d[g]);return{$$typeof:j1,type:c,key:N,ref:T,props:w,_owner:T1.current}}Jh.Fragment=N1;Jh.jsx=M0;Jh.jsxs=M0;A0.exports=Jh;var t=A0.exports,P0,Iy=f1;P0=Iy.createRoot,Iy.hydrateRoot;class Qo{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(d){const f={listener:d};return this.listeners.add(f),this.onSubscribe(),()=>{this.listeners.delete(f),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const Ku=typeof window>"u"||"Deno"in window;function Ki(){}function C1(c,d){return typeof c=="function"?c(d):c}function pf(c){return typeof c=="number"&&c>=0&&c!==1/0}function Dy(c,d){return c.filter(f=>!d.includes(f))}function k1(c,d,f){const g=c.slice(0);return g[d]=f,g}function I0(c,d){return Math.max(c+(d||0)-Date.now(),0)}function Yl(c,d,f){return Yu(c)?typeof d=="function"?{...f,queryKey:c,queryFn:d}:{...d,queryKey:c}:c}function A1(c,d,f){return Yu(c)?{...d,mutationKey:c}:typeof c=="function"?{...d,mutationFn:c}:{...c}}function Xa(c,d,f){return Yu(c)?[{...d,queryKey:c},f]:[c||{},d]}function Ly(c,d){const{type:f="all",exact:g,fetchStatus:w,predicate:N,queryKey:T,stale:A}=c;if(Yu(T)){if(g){if(d.queryHash!==Df(T,d.options))return!1}else if(!Oh(d.queryKey,T))return!1}if(f!=="all"){const n=d.isActive();if(f==="active"&&!n||f==="inactive"&&n)return!1}return!(typeof A=="boolean"&&d.isStale()!==A||typeof w<"u"&&w!==d.state.fetchStatus||N&&!N(d))}function Ry(c,d){const{exact:f,fetching:g,predicate:w,mutationKey:N}=c;if(Yu(N)){if(!d.options.mutationKey)return!1;if(f){if(Ja(d.options.mutationKey)!==Ja(N))return!1}else if(!Oh(d.options.mutationKey,N))return!1}return!(typeof g=="boolean"&&d.state.status==="loading"!==g||w&&!w(d))}function Df(c,d){return((d==null?void 0:d.queryKeyHashFn)||Ja)(c)}function Ja(c){return JSON.stringify(c,(d,f)=>ff(f)?Object.keys(f).sort().reduce((g,w)=>(g[w]=f[w],g),{}):f)}function Oh(c,d){return D0(c,d)}function D0(c,d){return c===d?!0:typeof c!=typeof d?!1:c&&d&&typeof c=="object"&&typeof d=="object"?!Object.keys(d).some(f=>!D0(c[f],d[f])):!1}function L0(c,d){if(c===d)return c;const f=zy(c)&&zy(d);if(f||ff(c)&&ff(d)){const g=f?c.length:Object.keys(c).length,w=f?d:Object.keys(d),N=w.length,T=f?[]:{};let A=0;for(let n=0;n<N;n++){const M=f?n:w[n];T[M]=L0(c[M],d[M]),T[M]===c[M]&&A++}return g===N&&A===g?c:T}return d}function Fh(c,d){if(c&&!d||d&&!c)return!1;for(const f in c)if(c[f]!==d[f])return!1;return!0}function zy(c){return Array.isArray(c)&&c.length===Object.keys(c).length}function ff(c){if(!Oy(c))return!1;const d=c.constructor;if(typeof d>"u")return!0;const f=d.prototype;return!(!Oy(f)||!f.hasOwnProperty("isPrototypeOf"))}function Oy(c){return Object.prototype.toString.call(c)==="[object Object]"}function Yu(c){return Array.isArray(c)}function R0(c){return new Promise(d=>{setTimeout(d,c)})}function Fy(c){R0(0).then(c)}function M1(){if(typeof AbortController=="function")return new AbortController}function gf(c,d,f){return f.isDataEqual!=null&&f.isDataEqual(c,d)?c:typeof f.structuralSharing=="function"?f.structuralSharing(c,d):f.structuralSharing!==!1?L0(c,d):d}class P1 extends Qo{constructor(){super(),this.setup=d=>{if(!Ku&&window.addEventListener){const f=()=>d();return window.addEventListener("visibilitychange",f,!1),window.addEventListener("focus",f,!1),()=>{window.removeEventListener("visibilitychange",f),window.removeEventListener("focus",f)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.cleanup)==null||d.call(this),this.cleanup=void 0}}setEventListener(d){var f;this.setup=d,(f=this.cleanup)==null||f.call(this),this.cleanup=d(g=>{typeof g=="boolean"?this.setFocused(g):this.onFocus()})}setFocused(d){this.focused!==d&&(this.focused=d,this.onFocus())}onFocus(){this.listeners.forEach(({listener:d})=>{d()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const Bh=new P1,By=["online","offline"];class I1 extends Qo{constructor(){super(),this.setup=d=>{if(!Ku&&window.addEventListener){const f=()=>d();return By.forEach(g=>{window.addEventListener(g,f,!1)}),()=>{By.forEach(g=>{window.removeEventListener(g,f)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.cleanup)==null||d.call(this),this.cleanup=void 0}}setEventListener(d){var f;this.setup=d,(f=this.cleanup)==null||f.call(this),this.cleanup=d(g=>{typeof g=="boolean"?this.setOnline(g):this.onOnline()})}setOnline(d){this.online!==d&&(this.online=d,this.onOnline())}onOnline(){this.listeners.forEach(({listener:d})=>{d()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const Uh=new I1;function D1(c){return Math.min(1e3*2**c,3e4)}function Yh(c){return(c??"online")==="online"?Uh.isOnline():!0}class z0{constructor(d){this.revert=d==null?void 0:d.revert,this.silent=d==null?void 0:d.silent}}function Ph(c){return c instanceof z0}function O0(c){let d=!1,f=0,g=!1,w,N,T;const A=new Promise((K,ue)=>{N=K,T=ue}),n=K=>{g||(G(new z0(K)),c.abort==null||c.abort())},M=()=>{d=!0},z=()=>{d=!1},V=()=>!Bh.isFocused()||c.networkMode!=="always"&&!Uh.isOnline(),U=K=>{g||(g=!0,c.onSuccess==null||c.onSuccess(K),w==null||w(),N(K))},G=K=>{g||(g=!0,c.onError==null||c.onError(K),w==null||w(),T(K))},W=()=>new Promise(K=>{w=ue=>{const re=g||!V();return re&&K(ue),re},c.onPause==null||c.onPause()}).then(()=>{w=void 0,g||c.onContinue==null||c.onContinue()}),$=()=>{if(g)return;let K;try{K=c.fn()}catch(ue){K=Promise.reject(ue)}Promise.resolve(K).then(U).catch(ue=>{var re,te;if(g)return;const je=(re=c.retry)!=null?re:3,me=(te=c.retryDelay)!=null?te:D1,Ce=typeof me=="function"?me(f,ue):me,Ae=je===!0||typeof je=="number"&&f<je||typeof je=="function"&&je(f,ue);if(d||!Ae){G(ue);return}f++,c.onFail==null||c.onFail(f,ue),R0(Ce).then(()=>{if(V())return W()}).then(()=>{d?G(ue):$()})})};return Yh(c.networkMode)?$():W().then($),{promise:A,cancel:n,continue:()=>(w==null?void 0:w())?A:Promise.resolve(),cancelRetry:M,continueRetry:z}}const Lf=console;function L1(){let c=[],d=0,f=z=>{z()},g=z=>{z()};const w=z=>{let V;d++;try{V=z()}finally{d--,d||A()}return V},N=z=>{d?c.push(z):Fy(()=>{f(z)})},T=z=>(...V)=>{N(()=>{z(...V)})},A=()=>{const z=c;c=[],z.length&&Fy(()=>{g(()=>{z.forEach(V=>{f(V)})})})};return{batch:w,batchCalls:T,schedule:N,setNotifyFunction:z=>{f=z},setBatchNotifyFunction:z=>{g=z}}}const Qs=L1();class F0{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),pf(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(d){this.cacheTime=Math.max(this.cacheTime||0,d??(Ku?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class R1 extends F0{constructor(d){super(),this.abortSignalConsumed=!1,this.defaultOptions=d.defaultOptions,this.setOptions(d.options),this.observers=[],this.cache=d.cache,this.logger=d.logger||Lf,this.queryKey=d.queryKey,this.queryHash=d.queryHash,this.initialState=d.state||z1(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(d){this.options={...this.defaultOptions,...d},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(d,f){const g=gf(this.state.data,d,this.options);return this.dispatch({data:g,type:"success",dataUpdatedAt:f==null?void 0:f.updatedAt,manual:f==null?void 0:f.manual}),g}setState(d,f){this.dispatch({type:"setState",state:d,setStateOptions:f})}cancel(d){var f;const g=this.promise;return(f=this.retryer)==null||f.cancel(d),g?g.then(Ki).catch(Ki):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(d=>d.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(d=>d.getCurrentResult().isStale)}isStaleByTime(d=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!I0(this.state.dataUpdatedAt,d)}onFocus(){var d;const f=this.observers.find(g=>g.shouldFetchOnWindowFocus());f&&f.refetch({cancelRefetch:!1}),(d=this.retryer)==null||d.continue()}onOnline(){var d;const f=this.observers.find(g=>g.shouldFetchOnReconnect());f&&f.refetch({cancelRefetch:!1}),(d=this.retryer)==null||d.continue()}addObserver(d){this.observers.includes(d)||(this.observers.push(d),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:d}))}removeObserver(d){this.observers.includes(d)&&(this.observers=this.observers.filter(f=>f!==d),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:d}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(d,f){var g,w;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&f!=null&&f.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var N;return(N=this.retryer)==null||N.continueRetry(),this.promise}}if(d&&this.setOptions(d),!this.options.queryFn){const G=this.observers.find(W=>W.options.queryFn);G&&this.setOptions(G.options)}const T=M1(),A={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},n=G=>{Object.defineProperty(G,"signal",{enumerable:!0,get:()=>{if(T)return this.abortSignalConsumed=!0,T.signal}})};n(A);const M=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(A)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'"),z={fetchOptions:f,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:M};if(n(z),(g=this.options.behavior)==null||g.onFetch(z),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==((w=z.fetchOptions)==null?void 0:w.meta)){var V;this.dispatch({type:"fetch",meta:(V=z.fetchOptions)==null?void 0:V.meta})}const U=G=>{if(Ph(G)&&G.silent||this.dispatch({type:"error",error:G}),!Ph(G)){var W,$,K,ue;(W=($=this.cache.config).onError)==null||W.call($,G,this),(K=(ue=this.cache.config).onSettled)==null||K.call(ue,this.state.data,G,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=O0({fn:z.fetchFn,abort:T==null?void 0:T.abort.bind(T),onSuccess:G=>{var W,$,K,ue;if(typeof G>"u"){U(new Error(this.queryHash+" data is undefined"));return}this.setData(G),(W=($=this.cache.config).onSuccess)==null||W.call($,G,this),(K=(ue=this.cache.config).onSettled)==null||K.call(ue,G,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:U,onFail:(G,W)=>{this.dispatch({type:"failed",failureCount:G,error:W})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:z.options.retry,retryDelay:z.options.retryDelay,networkMode:z.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(d){const f=g=>{var w,N;switch(d.type){case"failed":return{...g,fetchFailureCount:d.failureCount,fetchFailureReason:d.error};case"pause":return{...g,fetchStatus:"paused"};case"continue":return{...g,fetchStatus:"fetching"};case"fetch":return{...g,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:(w=d.meta)!=null?w:null,fetchStatus:Yh(this.options.networkMode)?"fetching":"paused",...!g.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...g,data:d.data,dataUpdateCount:g.dataUpdateCount+1,dataUpdatedAt:(N=d.dataUpdatedAt)!=null?N:Date.now(),error:null,isInvalidated:!1,status:"success",...!d.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const T=d.error;return Ph(T)&&T.revert&&this.revertState?{...this.revertState,fetchStatus:"idle"}:{...g,error:T,errorUpdateCount:g.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:g.fetchFailureCount+1,fetchFailureReason:T,fetchStatus:"idle",status:"error"};case"invalidate":return{...g,isInvalidated:!0};case"setState":return{...g,...d.state}}};this.state=f(this.state),Qs.batch(()=>{this.observers.forEach(g=>{g.onQueryUpdate(d)}),this.cache.notify({query:this,type:"updated",action:d})})}}function z1(c){const d=typeof c.initialData=="function"?c.initialData():c.initialData,f=typeof d<"u",g=f?typeof c.initialDataUpdatedAt=="function"?c.initialDataUpdatedAt():c.initialDataUpdatedAt:0;return{data:d,dataUpdateCount:0,dataUpdatedAt:f?g??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:f?"success":"loading",fetchStatus:"idle"}}class O1 extends Qo{constructor(d){super(),this.config=d||{},this.queries=[],this.queriesMap={}}build(d,f,g){var w;const N=f.queryKey,T=(w=f.queryHash)!=null?w:Df(N,f);let A=this.get(T);return A||(A=new R1({cache:this,logger:d.getLogger(),queryKey:N,queryHash:T,options:d.defaultQueryOptions(f),state:g,defaultOptions:d.getQueryDefaults(N)}),this.add(A)),A}add(d){this.queriesMap[d.queryHash]||(this.queriesMap[d.queryHash]=d,this.queries.push(d),this.notify({type:"added",query:d}))}remove(d){const f=this.queriesMap[d.queryHash];f&&(d.destroy(),this.queries=this.queries.filter(g=>g!==d),f===d&&delete this.queriesMap[d.queryHash],this.notify({type:"removed",query:d}))}clear(){Qs.batch(()=>{this.queries.forEach(d=>{this.remove(d)})})}get(d){return this.queriesMap[d]}getAll(){return this.queries}find(d,f){const[g]=Xa(d,f);return typeof g.exact>"u"&&(g.exact=!0),this.queries.find(w=>Ly(g,w))}findAll(d,f){const[g]=Xa(d,f);return Object.keys(g).length>0?this.queries.filter(w=>Ly(g,w)):this.queries}notify(d){Qs.batch(()=>{this.listeners.forEach(({listener:f})=>{f(d)})})}onFocus(){Qs.batch(()=>{this.queries.forEach(d=>{d.onFocus()})})}onOnline(){Qs.batch(()=>{this.queries.forEach(d=>{d.onOnline()})})}}class F1 extends F0{constructor(d){super(),this.defaultOptions=d.defaultOptions,this.mutationId=d.mutationId,this.mutationCache=d.mutationCache,this.logger=d.logger||Lf,this.observers=[],this.state=d.state||B0(),this.setOptions(d.options),this.scheduleGc()}setOptions(d){this.options={...this.defaultOptions,...d},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(d){this.dispatch({type:"setState",state:d})}addObserver(d){this.observers.includes(d)||(this.observers.push(d),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:d}))}removeObserver(d){this.observers=this.observers.filter(f=>f!==d),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:d})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var d,f;return(d=(f=this.retryer)==null?void 0:f.continue())!=null?d:this.execute()}async execute(){const d=()=>{var Ae;return this.retryer=O0({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(fe,Ie)=>{this.dispatch({type:"failed",failureCount:fe,error:Ie})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(Ae=this.options.retry)!=null?Ae:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},f=this.state.status==="loading";try{var g,w,N,T,A,n,M,z;if(!f){var V,U,G,W;this.dispatch({type:"loading",variables:this.options.variables}),await((V=(U=this.mutationCache.config).onMutate)==null?void 0:V.call(U,this.state.variables,this));const fe=await((G=(W=this.options).onMutate)==null?void 0:G.call(W,this.state.variables));fe!==this.state.context&&this.dispatch({type:"loading",context:fe,variables:this.state.variables})}const Ae=await d();return await((g=(w=this.mutationCache.config).onSuccess)==null?void 0:g.call(w,Ae,this.state.variables,this.state.context,this)),await((N=(T=this.options).onSuccess)==null?void 0:N.call(T,Ae,this.state.variables,this.state.context)),await((A=(n=this.mutationCache.config).onSettled)==null?void 0:A.call(n,Ae,null,this.state.variables,this.state.context,this)),await((M=(z=this.options).onSettled)==null?void 0:M.call(z,Ae,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:Ae}),Ae}catch(Ae){try{var $,K,ue,re,te,je,me,Ce;throw await(($=(K=this.mutationCache.config).onError)==null?void 0:$.call(K,Ae,this.state.variables,this.state.context,this)),await((ue=(re=this.options).onError)==null?void 0:ue.call(re,Ae,this.state.variables,this.state.context)),await((te=(je=this.mutationCache.config).onSettled)==null?void 0:te.call(je,void 0,Ae,this.state.variables,this.state.context,this)),await((me=(Ce=this.options).onSettled)==null?void 0:me.call(Ce,void 0,Ae,this.state.variables,this.state.context)),Ae}finally{this.dispatch({type:"error",error:Ae})}}}dispatch(d){const f=g=>{switch(d.type){case"failed":return{...g,failureCount:d.failureCount,failureReason:d.error};case"pause":return{...g,isPaused:!0};case"continue":return{...g,isPaused:!1};case"loading":return{...g,context:d.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!Yh(this.options.networkMode),status:"loading",variables:d.variables};case"success":return{...g,data:d.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...g,data:void 0,error:d.error,failureCount:g.failureCount+1,failureReason:d.error,isPaused:!1,status:"error"};case"setState":return{...g,...d.state}}};this.state=f(this.state),Qs.batch(()=>{this.observers.forEach(g=>{g.onMutationUpdate(d)}),this.mutationCache.notify({mutation:this,type:"updated",action:d})})}}function B0(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class B1 extends Qo{constructor(d){super(),this.config=d||{},this.mutations=[],this.mutationId=0}build(d,f,g){const w=new F1({mutationCache:this,logger:d.getLogger(),mutationId:++this.mutationId,options:d.defaultMutationOptions(f),state:g,defaultOptions:f.mutationKey?d.getMutationDefaults(f.mutationKey):void 0});return this.add(w),w}add(d){this.mutations.push(d),this.notify({type:"added",mutation:d})}remove(d){this.mutations=this.mutations.filter(f=>f!==d),this.notify({type:"removed",mutation:d})}clear(){Qs.batch(()=>{this.mutations.forEach(d=>{this.remove(d)})})}getAll(){return this.mutations}find(d){return typeof d.exact>"u"&&(d.exact=!0),this.mutations.find(f=>Ry(d,f))}findAll(d){return this.mutations.filter(f=>Ry(d,f))}notify(d){Qs.batch(()=>{this.listeners.forEach(({listener:f})=>{f(d)})})}resumePausedMutations(){var d;return this.resuming=((d=this.resuming)!=null?d:Promise.resolve()).then(()=>{const f=this.mutations.filter(g=>g.state.isPaused);return Qs.batch(()=>f.reduce((g,w)=>g.then(()=>w.continue().catch(Ki)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function xf(){return{onFetch:c=>{c.fetchFn=()=>{var d,f,g,w,N,T;const A=(d=c.fetchOptions)==null||(f=d.meta)==null?void 0:f.refetchPage,n=(g=c.fetchOptions)==null||(w=g.meta)==null?void 0:w.fetchMore,M=n==null?void 0:n.pageParam,z=(n==null?void 0:n.direction)==="forward",V=(n==null?void 0:n.direction)==="backward",U=((N=c.state.data)==null?void 0:N.pages)||[],G=((T=c.state.data)==null?void 0:T.pageParams)||[];let W=G,$=!1;const K=Ce=>{Object.defineProperty(Ce,"signal",{enumerable:!0,get:()=>{var Ae;if((Ae=c.signal)!=null&&Ae.aborted)$=!0;else{var fe;(fe=c.signal)==null||fe.addEventListener("abort",()=>{$=!0})}return c.signal}})},ue=c.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+c.options.queryHash+"'")),re=(Ce,Ae,fe,Ie)=>(W=Ie?[Ae,...W]:[...W,Ae],Ie?[fe,...Ce]:[...Ce,fe]),te=(Ce,Ae,fe,Ie)=>{if($)return Promise.reject("Cancelled");if(typeof fe>"u"&&!Ae&&Ce.length)return Promise.resolve(Ce);const Ee={queryKey:c.queryKey,pageParam:fe,meta:c.options.meta};K(Ee);const tt=ue(Ee);return Promise.resolve(tt).then(Te=>re(Ce,fe,Te,Ie))};let je;if(!U.length)je=te([]);else if(z){const Ce=typeof M<"u",Ae=Ce?M:yf(c.options,U);je=te(U,Ce,Ae)}else if(V){const Ce=typeof M<"u",Ae=Ce?M:U0(c.options,U);je=te(U,Ce,Ae,!0)}else{W=[];const Ce=typeof c.options.getNextPageParam>"u";je=(A&&U[0]?A(U[0],0,U):!0)?te([],Ce,G[0]):Promise.resolve(re([],G[0],U[0]));for(let fe=1;fe<U.length;fe++)je=je.then(Ie=>{if(A&&U[fe]?A(U[fe],fe,U):!0){const tt=Ce?G[fe]:yf(c.options,Ie);return te(Ie,Ce,tt)}return Promise.resolve(re(Ie,G[fe],U[fe]))})}return je.then(Ce=>({pages:Ce,pageParams:W}))}}}}function yf(c,d){return c.getNextPageParam==null?void 0:c.getNextPageParam(d[d.length-1],d)}function U0(c,d){return c.getPreviousPageParam==null?void 0:c.getPreviousPageParam(d[0],d)}function U1(c,d){if(c.getNextPageParam&&Array.isArray(d)){const f=yf(c,d);return typeof f<"u"&&f!==null&&f!==!1}}function V1(c,d){if(c.getPreviousPageParam&&Array.isArray(d)){const f=U0(c,d);return typeof f<"u"&&f!==null&&f!==!1}}class V0{constructor(d={}){this.queryCache=d.queryCache||new O1,this.mutationCache=d.mutationCache||new B1,this.logger=d.logger||Lf,this.defaultOptions=d.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=Bh.subscribe(()=>{Bh.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=Uh.subscribe(()=>{Uh.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var d,f;this.mountCount--,this.mountCount===0&&((d=this.unsubscribeFocus)==null||d.call(this),this.unsubscribeFocus=void 0,(f=this.unsubscribeOnline)==null||f.call(this),this.unsubscribeOnline=void 0)}isFetching(d,f){const[g]=Xa(d,f);return g.fetchStatus="fetching",this.queryCache.findAll(g).length}isMutating(d){return this.mutationCache.findAll({...d,fetching:!0}).length}getQueryData(d,f){var g;return(g=this.queryCache.find(d,f))==null?void 0:g.state.data}ensureQueryData(d,f,g){const w=Yl(d,f,g),N=this.getQueryData(w.queryKey);return N?Promise.resolve(N):this.fetchQuery(w)}getQueriesData(d){return this.getQueryCache().findAll(d).map(({queryKey:f,state:g})=>{const w=g.data;return[f,w]})}setQueryData(d,f,g){const w=this.queryCache.find(d),N=w==null?void 0:w.state.data,T=C1(f,N);if(typeof T>"u")return;const A=Yl(d),n=this.defaultQueryOptions(A);return this.queryCache.build(this,n).setData(T,{...g,manual:!0})}setQueriesData(d,f,g){return Qs.batch(()=>this.getQueryCache().findAll(d).map(({queryKey:w})=>[w,this.setQueryData(w,f,g)]))}getQueryState(d,f){var g;return(g=this.queryCache.find(d,f))==null?void 0:g.state}removeQueries(d,f){const[g]=Xa(d,f),w=this.queryCache;Qs.batch(()=>{w.findAll(g).forEach(N=>{w.remove(N)})})}resetQueries(d,f,g){const[w,N]=Xa(d,f,g),T=this.queryCache,A={type:"active",...w};return Qs.batch(()=>(T.findAll(w).forEach(n=>{n.reset()}),this.refetchQueries(A,N)))}cancelQueries(d,f,g){const[w,N={}]=Xa(d,f,g);typeof N.revert>"u"&&(N.revert=!0);const T=Qs.batch(()=>this.queryCache.findAll(w).map(A=>A.cancel(N)));return Promise.all(T).then(Ki).catch(Ki)}invalidateQueries(d,f,g){const[w,N]=Xa(d,f,g);return Qs.batch(()=>{var T,A;if(this.queryCache.findAll(w).forEach(M=>{M.invalidate()}),w.refetchType==="none")return Promise.resolve();const n={...w,type:(T=(A=w.refetchType)!=null?A:w.type)!=null?T:"active"};return this.refetchQueries(n,N)})}refetchQueries(d,f,g){const[w,N]=Xa(d,f,g),T=Qs.batch(()=>this.queryCache.findAll(w).filter(n=>!n.isDisabled()).map(n=>{var M;return n.fetch(void 0,{...N,cancelRefetch:(M=N==null?void 0:N.cancelRefetch)!=null?M:!0,meta:{refetchPage:w.refetchPage}})}));let A=Promise.all(T).then(Ki);return N!=null&&N.throwOnError||(A=A.catch(Ki)),A}fetchQuery(d,f,g){const w=Yl(d,f,g),N=this.defaultQueryOptions(w);typeof N.retry>"u"&&(N.retry=!1);const T=this.queryCache.build(this,N);return T.isStaleByTime(N.staleTime)?T.fetch(N):Promise.resolve(T.state.data)}prefetchQuery(d,f,g){return this.fetchQuery(d,f,g).then(Ki).catch(Ki)}fetchInfiniteQuery(d,f,g){const w=Yl(d,f,g);return w.behavior=xf(),this.fetchQuery(w)}prefetchInfiniteQuery(d,f,g){return this.fetchInfiniteQuery(d,f,g).then(Ki).catch(Ki)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(d){this.defaultOptions=d}setQueryDefaults(d,f){const g=this.queryDefaults.find(w=>Ja(d)===Ja(w.queryKey));g?g.defaultOptions=f:this.queryDefaults.push({queryKey:d,defaultOptions:f})}getQueryDefaults(d){if(!d)return;const f=this.queryDefaults.find(g=>Oh(d,g.queryKey));return f==null?void 0:f.defaultOptions}setMutationDefaults(d,f){const g=this.mutationDefaults.find(w=>Ja(d)===Ja(w.mutationKey));g?g.defaultOptions=f:this.mutationDefaults.push({mutationKey:d,defaultOptions:f})}getMutationDefaults(d){if(!d)return;const f=this.mutationDefaults.find(g=>Oh(d,g.mutationKey));return f==null?void 0:f.defaultOptions}defaultQueryOptions(d){if(d!=null&&d._defaulted)return d;const f={...this.defaultOptions.queries,...this.getQueryDefaults(d==null?void 0:d.queryKey),...d,_defaulted:!0};return!f.queryHash&&f.queryKey&&(f.queryHash=Df(f.queryKey,f)),typeof f.refetchOnReconnect>"u"&&(f.refetchOnReconnect=f.networkMode!=="always"),typeof f.useErrorBoundary>"u"&&(f.useErrorBoundary=!!f.suspense),f}defaultMutationOptions(d){return d!=null&&d._defaulted?d:{...this.defaultOptions.mutations,...this.getMutationDefaults(d==null?void 0:d.mutationKey),...d,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}class Rf extends Qo{constructor(d,f){super(),this.client=d,this.options=f,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(f)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),Uy(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return _f(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return _f(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(d,f){const g=this.options,w=this.currentQuery;if(this.options=this.client.defaultQueryOptions(d),Fh(g,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=g.queryKey),this.updateQuery();const N=this.hasListeners();N&&Vy(this.currentQuery,w,this.options,g)&&this.executeFetch(),this.updateResult(f),N&&(this.currentQuery!==w||this.options.enabled!==g.enabled||this.options.staleTime!==g.staleTime)&&this.updateStaleTimeout();const T=this.computeRefetchInterval();N&&(this.currentQuery!==w||this.options.enabled!==g.enabled||T!==this.currentRefetchInterval)&&this.updateRefetchInterval(T)}getOptimisticResult(d){const f=this.client.getQueryCache().build(this.client,d),g=this.createResult(f,d);return $1(this,g,d)&&(this.currentResult=g,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),g}getCurrentResult(){return this.currentResult}trackResult(d){const f={};return Object.keys(d).forEach(g=>{Object.defineProperty(f,g,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(g),d[g])})}),f}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:d,...f}={}){return this.fetch({...f,meta:{refetchPage:d}})}fetchOptimistic(d){const f=this.client.defaultQueryOptions(d),g=this.client.getQueryCache().build(this.client,f);return g.isFetchingOptimistic=!0,g.fetch().then(()=>this.createResult(g,f))}fetch(d){var f;return this.executeFetch({...d,cancelRefetch:(f=d.cancelRefetch)!=null?f:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(d){this.updateQuery();let f=this.currentQuery.fetch(this.options,d);return d!=null&&d.throwOnError||(f=f.catch(Ki)),f}updateStaleTimeout(){if(this.clearStaleTimeout(),Ku||this.currentResult.isStale||!pf(this.options.staleTime))return;const f=I0(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},f)}computeRefetchInterval(){var d;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(d=this.options.refetchInterval)!=null?d:!1}updateRefetchInterval(d){this.clearRefetchInterval(),this.currentRefetchInterval=d,!(Ku||this.options.enabled===!1||!pf(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||Bh.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(d,f){const g=this.currentQuery,w=this.options,N=this.currentResult,T=this.currentResultState,A=this.currentResultOptions,n=d!==g,M=n?d.state:this.currentQueryInitialState,z=n?this.currentResult:this.previousQueryResult,{state:V}=d;let{dataUpdatedAt:U,error:G,errorUpdatedAt:W,fetchStatus:$,status:K}=V,ue=!1,re=!1,te;if(f._optimisticResults){const fe=this.hasListeners(),Ie=!fe&&Uy(d,f),Ee=fe&&Vy(d,g,f,w);(Ie||Ee)&&($=Yh(d.options.networkMode)?"fetching":"paused",U||(K="loading")),f._optimisticResults==="isRestoring"&&($="idle")}if(f.keepPreviousData&&!V.dataUpdatedAt&&z!=null&&z.isSuccess&&K!=="error")te=z.data,U=z.dataUpdatedAt,K=z.status,ue=!0;else if(f.select&&typeof V.data<"u")if(N&&V.data===(T==null?void 0:T.data)&&f.select===this.selectFn)te=this.selectResult;else try{this.selectFn=f.select,te=f.select(V.data),te=gf(N==null?void 0:N.data,te,f),this.selectResult=te,this.selectError=null}catch(fe){this.selectError=fe}else te=V.data;if(typeof f.placeholderData<"u"&&typeof te>"u"&&K==="loading"){let fe;if(N!=null&&N.isPlaceholderData&&f.placeholderData===(A==null?void 0:A.placeholderData))fe=N.data;else if(fe=typeof f.placeholderData=="function"?f.placeholderData():f.placeholderData,f.select&&typeof fe<"u")try{fe=f.select(fe),this.selectError=null}catch(Ie){this.selectError=Ie}typeof fe<"u"&&(K="success",te=gf(N==null?void 0:N.data,fe,f),re=!0)}this.selectError&&(G=this.selectError,te=this.selectResult,W=Date.now(),K="error");const je=$==="fetching",me=K==="loading",Ce=K==="error";return{status:K,fetchStatus:$,isLoading:me,isSuccess:K==="success",isError:Ce,isInitialLoading:me&&je,data:te,dataUpdatedAt:U,error:G,errorUpdatedAt:W,failureCount:V.fetchFailureCount,failureReason:V.fetchFailureReason,errorUpdateCount:V.errorUpdateCount,isFetched:V.dataUpdateCount>0||V.errorUpdateCount>0,isFetchedAfterMount:V.dataUpdateCount>M.dataUpdateCount||V.errorUpdateCount>M.errorUpdateCount,isFetching:je,isRefetching:je&&!me,isLoadingError:Ce&&V.dataUpdatedAt===0,isPaused:$==="paused",isPlaceholderData:re,isPreviousData:ue,isRefetchError:Ce&&V.dataUpdatedAt!==0,isStale:zf(d,f),refetch:this.refetch,remove:this.remove}}updateResult(d){const f=this.currentResult,g=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,Fh(g,f))return;this.currentResult=g;const w={cache:!0},N=()=>{if(!f)return!0;const{notifyOnChangeProps:T}=this.options,A=typeof T=="function"?T():T;if(A==="all"||!A&&!this.trackedProps.size)return!0;const n=new Set(A??this.trackedProps);return this.options.useErrorBoundary&&n.add("error"),Object.keys(this.currentResult).some(M=>{const z=M;return this.currentResult[z]!==f[z]&&n.has(z)})};(d==null?void 0:d.listeners)!==!1&&N()&&(w.listeners=!0),this.notify({...w,...d})}updateQuery(){const d=this.client.getQueryCache().build(this.client,this.options);if(d===this.currentQuery)return;const f=this.currentQuery;this.currentQuery=d,this.currentQueryInitialState=d.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(f==null||f.removeObserver(this),d.addObserver(this))}onQueryUpdate(d){const f={};d.type==="success"?f.onSuccess=!d.manual:d.type==="error"&&!Ph(d.error)&&(f.onError=!0),this.updateResult(f),this.hasListeners()&&this.updateTimers()}notify(d){Qs.batch(()=>{if(d.onSuccess){var f,g,w,N;(f=(g=this.options).onSuccess)==null||f.call(g,this.currentResult.data),(w=(N=this.options).onSettled)==null||w.call(N,this.currentResult.data,null)}else if(d.onError){var T,A,n,M;(T=(A=this.options).onError)==null||T.call(A,this.currentResult.error),(n=(M=this.options).onSettled)==null||n.call(M,void 0,this.currentResult.error)}d.listeners&&this.listeners.forEach(({listener:z})=>{z(this.currentResult)}),d.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function q1(c,d){return d.enabled!==!1&&!c.state.dataUpdatedAt&&!(c.state.status==="error"&&d.retryOnMount===!1)}function Uy(c,d){return q1(c,d)||c.state.dataUpdatedAt>0&&_f(c,d,d.refetchOnMount)}function _f(c,d,f){if(d.enabled!==!1){const g=typeof f=="function"?f(c):f;return g==="always"||g!==!1&&zf(c,d)}return!1}function Vy(c,d,f,g){return f.enabled!==!1&&(c!==d||g.enabled===!1)&&(!f.suspense||c.state.status!=="error")&&zf(c,f)}function zf(c,d){return c.isStaleByTime(d.staleTime)}function $1(c,d,f){return f.keepPreviousData?!1:f.placeholderData!==void 0?d.isPlaceholderData:!Fh(c.getCurrentResult(),d)}class G1 extends Qo{constructor(d,f){super(),this.client=d,this.queries=[],this.result=[],this.observers=[],this.observersMap={},f&&this.setQueries(f)}onSubscribe(){this.listeners.size===1&&this.observers.forEach(d=>{d.subscribe(f=>{this.onUpdate(d,f)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.observers.forEach(d=>{d.destroy()})}setQueries(d,f){this.queries=d,Qs.batch(()=>{const g=this.observers,w=this.findMatchingObservers(this.queries);w.forEach(M=>M.observer.setOptions(M.defaultedQueryOptions,f));const N=w.map(M=>M.observer),T=Object.fromEntries(N.map(M=>[M.options.queryHash,M])),A=N.map(M=>M.getCurrentResult()),n=N.some((M,z)=>M!==g[z]);g.length===N.length&&!n||(this.observers=N,this.observersMap=T,this.result=A,this.hasListeners()&&(Dy(g,N).forEach(M=>{M.destroy()}),Dy(N,g).forEach(M=>{M.subscribe(z=>{this.onUpdate(M,z)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(d=>d.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(d){return this.findMatchingObservers(d).map(f=>f.observer.getOptimisticResult(f.defaultedQueryOptions))}findMatchingObservers(d){const f=this.observers,g=new Map(f.map(G=>[G.options.queryHash,G])),w=d.map(G=>this.client.defaultQueryOptions(G)),N=w.flatMap(G=>{const W=g.get(G.queryHash);return W!=null?[{defaultedQueryOptions:G,observer:W}]:[]}),T=new Set(N.map(G=>G.defaultedQueryOptions.queryHash)),A=w.filter(G=>!T.has(G.queryHash)),n=new Set(N.map(G=>G.observer)),M=f.filter(G=>!n.has(G)),z=G=>{const W=this.client.defaultQueryOptions(G),$=this.observersMap[W.queryHash];return $??new Rf(this.client,W)},V=A.map((G,W)=>{if(G.keepPreviousData){const $=M[W];if($!==void 0)return{defaultedQueryOptions:G,observer:$}}return{defaultedQueryOptions:G,observer:z(G)}}),U=(G,W)=>w.indexOf(G.defaultedQueryOptions)-w.indexOf(W.defaultedQueryOptions);return N.concat(V).sort(U)}onUpdate(d,f){const g=this.observers.indexOf(d);g!==-1&&(this.result=k1(this.result,g,f),this.notify())}notify(){Qs.batch(()=>{this.listeners.forEach(({listener:d})=>{d(this.result)})})}}class Z1 extends Rf{constructor(d,f){super(d,f)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(d,f){super.setOptions({...d,behavior:xf()},f)}getOptimisticResult(d){return d.behavior=xf(),super.getOptimisticResult(d)}fetchNextPage({pageParam:d,...f}={}){return this.fetch({...f,meta:{fetchMore:{direction:"forward",pageParam:d}}})}fetchPreviousPage({pageParam:d,...f}={}){return this.fetch({...f,meta:{fetchMore:{direction:"backward",pageParam:d}}})}createResult(d,f){var g,w,N,T,A,n;const{state:M}=d,z=super.createResult(d,f),{isFetching:V,isRefetching:U}=z,G=V&&((g=M.fetchMeta)==null||(w=g.fetchMore)==null?void 0:w.direction)==="forward",W=V&&((N=M.fetchMeta)==null||(T=N.fetchMore)==null?void 0:T.direction)==="backward";return{...z,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:U1(f,(A=M.data)==null?void 0:A.pages),hasPreviousPage:V1(f,(n=M.data)==null?void 0:n.pages),isFetchingNextPage:G,isFetchingPreviousPage:W,isRefetching:U&&!G&&!W}}}let W1=class extends Qo{constructor(d,f){super(),this.client=d,this.setOptions(f),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(d){var f;const g=this.options;this.options=this.client.defaultMutationOptions(d),Fh(g,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(f=this.currentMutation)==null||f.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.currentMutation)==null||d.removeObserver(this)}}onMutationUpdate(d){this.updateResult();const f={listeners:!0};d.type==="success"?f.onSuccess=!0:d.type==="error"&&(f.onError=!0),this.notify(f)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(d,f){return this.mutateOptions=f,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof d<"u"?d:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const d=this.currentMutation?this.currentMutation.state:B0(),f=d.status==="loading",g={...d,isLoading:f,isPending:f,isSuccess:d.status==="success",isError:d.status==="error",isIdle:d.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=g}notify(d){Qs.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(d.onSuccess){var f,g,w,N;(f=(g=this.mutateOptions).onSuccess)==null||f.call(g,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(w=(N=this.mutateOptions).onSettled)==null||w.call(N,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(d.onError){var T,A,n,M;(T=(A=this.mutateOptions).onError)==null||T.call(A,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(n=(M=this.mutateOptions).onSettled)==null||n.call(M,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}d.listeners&&this.listeners.forEach(({listener:z})=>{z(this.currentResult)})})}};var q0={exports:{}},$0={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tc=le;function H1(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var X1=typeof Object.is=="function"?Object.is:H1,K1=tc.useState,Q1=tc.useEffect,J1=tc.useLayoutEffect,Y1=tc.useDebugValue;function ej(c,d){var f=d(),g=K1({inst:{value:f,getSnapshot:d}}),w=g[0].inst,N=g[1];return J1(function(){w.value=f,w.getSnapshot=d,Kp(w)&&N({inst:w})},[c,f,d]),Q1(function(){return Kp(w)&&N({inst:w}),c(function(){Kp(w)&&N({inst:w})})},[c]),Y1(f),f}function Kp(c){var d=c.getSnapshot;c=c.value;try{var f=d();return!X1(c,f)}catch{return!0}}function tj(c,d){return d()}var sj=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?tj:ej;$0.useSyncExternalStore=tc.useSyncExternalStore!==void 0?tc.useSyncExternalStore:sj;q0.exports=$0;var rj=q0.exports;const Of=rj.useSyncExternalStore,qy=le.createContext(void 0),G0=le.createContext(!1);function Z0(c,d){return c||(d&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=qy),window.ReactQueryClientContext):qy)}const em=({context:c}={})=>{const d=le.useContext(Z0(c,le.useContext(G0)));if(!d)throw new Error("No QueryClient set, use QueryClientProvider to set one");return d},W0=({client:c,children:d,context:f,contextSharing:g=!1})=>{le.useEffect(()=>(c.mount(),()=>{c.unmount()}),[c]);const w=Z0(f,g);return le.createElement(G0.Provider,{value:!f&&g},le.createElement(w.Provider,{value:c},d))},H0=le.createContext(!1),X0=()=>le.useContext(H0);H0.Provider;function ij(){let c=!1;return{clearReset:()=>{c=!1},reset:()=>{c=!0},isReset:()=>c}}const nj=le.createContext(ij()),K0=()=>le.useContext(nj);function Q0(c,d){return typeof c=="function"?c(...d):!!c}const J0=(c,d)=>{(c.suspense||c.useErrorBoundary)&&(d.isReset()||(c.retryOnMount=!1))},Y0=c=>{le.useEffect(()=>{c.clearReset()},[c])},e_=({result:c,errorResetBoundary:d,useErrorBoundary:f,query:g})=>c.isError&&!d.isReset()&&!c.isFetching&&Q0(f,[c.error,g]),t_=c=>{c.suspense&&typeof c.staleTime!="number"&&(c.staleTime=1e3)},s_=(c,d)=>c.isLoading&&c.isFetching&&!d,bf=(c,d,f)=>(c==null?void 0:c.suspense)&&s_(d,f),vf=(c,d,f)=>d.fetchOptimistic(c).then(({data:g})=>{c.onSuccess==null||c.onSuccess(g),c.onSettled==null||c.onSettled(g,null)}).catch(g=>{f.clearReset(),c.onError==null||c.onError(g),c.onSettled==null||c.onSettled(void 0,g)});function aj({queries:c,context:d}){const f=em({context:d}),g=X0(),w=K0(),N=le.useMemo(()=>c.map(U=>{const G=f.defaultQueryOptions(U);return G._optimisticResults=g?"isRestoring":"optimistic",G}),[c,f,g]);N.forEach(U=>{t_(U),J0(U,w)}),Y0(w);const[T]=le.useState(()=>new G1(f,N)),A=T.getOptimisticResult(N);Of(le.useCallback(U=>g?()=>{}:T.subscribe(Qs.batchCalls(U)),[T,g]),()=>T.getCurrentResult(),()=>T.getCurrentResult()),le.useEffect(()=>{T.setQueries(N,{listeners:!1})},[N,T]);const M=A.some((U,G)=>bf(N[G],U,g))?A.flatMap((U,G)=>{const W=N[G],$=T.getObservers()[G];if(W&&$){if(bf(W,U,g))return vf(W,$,w);s_(U,g)&&vf(W,$,w)}return[]}):[];if(M.length>0)throw Promise.all(M);const z=T.getQueries(),V=A.find((U,G)=>{var W,$;return e_({result:U,errorResetBoundary:w,useErrorBoundary:(W=($=N[G])==null?void 0:$.useErrorBoundary)!=null?W:!1,query:z[G]})});if(V!=null&&V.error)throw V.error;return A}function r_(c,d){const f=em({context:c.context}),g=X0(),w=K0(),N=f.defaultQueryOptions(c);N._optimisticResults=g?"isRestoring":"optimistic",N.onError&&(N.onError=Qs.batchCalls(N.onError)),N.onSuccess&&(N.onSuccess=Qs.batchCalls(N.onSuccess)),N.onSettled&&(N.onSettled=Qs.batchCalls(N.onSettled)),t_(N),J0(N,w),Y0(w);const[T]=le.useState(()=>new d(f,N)),A=T.getOptimisticResult(N);if(Of(le.useCallback(n=>{const M=g?()=>{}:T.subscribe(Qs.batchCalls(n));return T.updateResult(),M},[T,g]),()=>T.getCurrentResult(),()=>T.getCurrentResult()),le.useEffect(()=>{T.setOptions(N,{listeners:!1})},[N,T]),bf(N,A,g))throw vf(N,T,w);if(e_({result:A,errorResetBoundary:w,useErrorBoundary:N.useErrorBoundary,query:T.getCurrentQuery()}))throw A.error;return N.notifyOnChangeProps?A:T.trackResult(A)}function i_(c,d,f){const g=Yl(c,d,f);return r_(g,Rf)}function oj(c,d,f){const g=A1(c,d),w=em({context:g.context}),[N]=le.useState(()=>new W1(w,g));le.useEffect(()=>{N.setOptions(g)},[N,g]);const T=Of(le.useCallback(n=>N.subscribe(Qs.batchCalls(n)),[N]),()=>N.getCurrentResult(),()=>N.getCurrentResult()),A=le.useCallback((n,M)=>{N.mutate(n,M).catch(lj)},[N]);if(T.error&&Q0(N.options.useErrorBoundary,[T.error]))throw T.error;return{...T,mutate:A,mutateAsync:T.mutate}}function lj(){}function cj(c,d,f){const g=Yl(c,d,f);return r_(g,Z1)}let uj={data:""},dj=c=>typeof window=="object"?((c?c.querySelector("#_goober"):window._goober)||Object.assign((c||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:c||uj,hj=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,mj=/\/\*[^]*?\*\/|  +/g,$y=/\n+/g,Ka=(c,d)=>{let f="",g="",w="";for(let N in c){let T=c[N];N[0]=="@"?N[1]=="i"?f=N+" "+T+";":g+=N[1]=="f"?Ka(T,N):N+"{"+Ka(T,N[1]=="k"?"":d)+"}":typeof T=="object"?g+=Ka(T,d?d.replace(/([^,])+/g,A=>N.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,n=>/&/.test(n)?n.replace(/&/g,A):A?A+" "+n:n)):N):T!=null&&(N=/^--/.test(N)?N:N.replace(/[A-Z]/g,"-$&").toLowerCase(),w+=Ka.p?Ka.p(N,T):N+":"+T+";")}return f+(d&&w?d+"{"+w+"}":w)+g},da={},n_=c=>{if(typeof c=="object"){let d="";for(let f in c)d+=f+n_(c[f]);return d}return c},pj=(c,d,f,g,w)=>{let N=n_(c),T=da[N]||(da[N]=(n=>{let M=0,z=11;for(;M<n.length;)z=101*z+n.charCodeAt(M++)>>>0;return"go"+z})(N));if(!da[T]){let n=N!==c?c:(M=>{let z,V,U=[{}];for(;z=hj.exec(M.replace(mj,""));)z[4]?U.shift():z[3]?(V=z[3].replace($y," ").trim(),U.unshift(U[0][V]=U[0][V]||{})):U[0][z[1]]=z[2].replace($y," ").trim();return U[0]})(c);da[T]=Ka(w?{["@keyframes "+T]:n}:n,f?"":"."+T)}let A=f&&da.g?da.g:null;return f&&(da.g=da[T]),((n,M,z,V)=>{V?M.data=M.data.replace(V,n):M.data.indexOf(n)===-1&&(M.data=z?n+M.data:M.data+n)})(da[T],d,g,A),T},fj=(c,d,f)=>c.reduce((g,w,N)=>{let T=d[N];if(T&&T.call){let A=T(f),n=A&&A.props&&A.props.className||/^go/.test(A)&&A;T=n?"."+n:A&&typeof A=="object"?A.props?"":Ka(A,""):A===!1?"":A}return g+w+(T??"")},"");function tm(c){let d=this||{},f=c.call?c(d.p):c;return pj(f.unshift?f.raw?fj(f,[].slice.call(arguments,1),d.p):f.reduce((g,w)=>Object.assign(g,w&&w.call?w(d.p):w),{}):f,dj(d.target),d.g,d.o,d.k)}let a_,wf,jf;tm.bind({g:1});let fa=tm.bind({k:1});function gj(c,d,f,g){Ka.p=d,a_=c,wf=f,jf=g}function eo(c,d){let f=this||{};return function(){let g=arguments;function w(N,T){let A=Object.assign({},N),n=A.className||w.className;f.p=Object.assign({theme:wf&&wf()},A),f.o=/ *go\d+/.test(n),A.className=tm.apply(f,g)+(n?" "+n:"");let M=c;return c[0]&&(M=A.as||c,delete A.as),jf&&M[0]&&jf(A),a_(M,A)}return w}}var xj=c=>typeof c=="function",Vh=(c,d)=>xj(c)?c(d):c,yj=(()=>{let c=0;return()=>(++c).toString()})(),o_=(()=>{let c;return()=>{if(c===void 0&&typeof window<"u"){let d=matchMedia("(prefers-reduced-motion: reduce)");c=!d||d.matches}return c}})(),_j=20,l_=(c,d)=>{switch(d.type){case 0:return{...c,toasts:[d.toast,...c.toasts].slice(0,_j)};case 1:return{...c,toasts:c.toasts.map(N=>N.id===d.toast.id?{...N,...d.toast}:N)};case 2:let{toast:f}=d;return l_(c,{type:c.toasts.find(N=>N.id===f.id)?1:0,toast:f});case 3:let{toastId:g}=d;return{...c,toasts:c.toasts.map(N=>N.id===g||g===void 0?{...N,dismissed:!0,visible:!1}:N)};case 4:return d.toastId===void 0?{...c,toasts:[]}:{...c,toasts:c.toasts.filter(N=>N.id!==d.toastId)};case 5:return{...c,pausedAt:d.time};case 6:let w=d.time-(c.pausedAt||0);return{...c,pausedAt:void 0,toasts:c.toasts.map(N=>({...N,pauseDuration:N.pauseDuration+w}))}}},Ih=[],Go={toasts:[],pausedAt:void 0},Jo=c=>{Go=l_(Go,c),Ih.forEach(d=>{d(Go)})},bj={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},vj=(c={})=>{let[d,f]=le.useState(Go),g=le.useRef(Go);le.useEffect(()=>(g.current!==Go&&f(Go),Ih.push(f),()=>{let N=Ih.indexOf(f);N>-1&&Ih.splice(N,1)}),[]);let w=d.toasts.map(N=>{var T,A,n;return{...c,...c[N.type],...N,removeDelay:N.removeDelay||((T=c[N.type])==null?void 0:T.removeDelay)||(c==null?void 0:c.removeDelay),duration:N.duration||((A=c[N.type])==null?void 0:A.duration)||(c==null?void 0:c.duration)||bj[N.type],style:{...c.style,...(n=c[N.type])==null?void 0:n.style,...N.style}}});return{...d,toasts:w}},wj=(c,d="blank",f)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:d,ariaProps:{role:"status","aria-live":"polite"},message:c,pauseDuration:0,...f,id:(f==null?void 0:f.id)||yj()}),ed=c=>(d,f)=>{let g=wj(d,c,f);return Jo({type:2,toast:g}),g.id},Kr=(c,d)=>ed("blank")(c,d);Kr.error=ed("error");Kr.success=ed("success");Kr.loading=ed("loading");Kr.custom=ed("custom");Kr.dismiss=c=>{Jo({type:3,toastId:c})};Kr.remove=c=>Jo({type:4,toastId:c});Kr.promise=(c,d,f)=>{let g=Kr.loading(d.loading,{...f,...f==null?void 0:f.loading});return typeof c=="function"&&(c=c()),c.then(w=>{let N=d.success?Vh(d.success,w):void 0;return N?Kr.success(N,{id:g,...f,...f==null?void 0:f.success}):Kr.dismiss(g),w}).catch(w=>{let N=d.error?Vh(d.error,w):void 0;N?Kr.error(N,{id:g,...f,...f==null?void 0:f.error}):Kr.dismiss(g)}),c};var jj=(c,d)=>{Jo({type:1,toast:{id:c,height:d}})},Nj=()=>{Jo({type:5,time:Date.now()})},Wu=new Map,Sj=1e3,Tj=(c,d=Sj)=>{if(Wu.has(c))return;let f=setTimeout(()=>{Wu.delete(c),Jo({type:4,toastId:c})},d);Wu.set(c,f)},Ej=c=>{let{toasts:d,pausedAt:f}=vj(c);le.useEffect(()=>{if(f)return;let N=Date.now(),T=d.map(A=>{if(A.duration===1/0)return;let n=(A.duration||0)+A.pauseDuration-(N-A.createdAt);if(n<0){A.visible&&Kr.dismiss(A.id);return}return setTimeout(()=>Kr.dismiss(A.id),n)});return()=>{T.forEach(A=>A&&clearTimeout(A))}},[d,f]);let g=le.useCallback(()=>{f&&Jo({type:6,time:Date.now()})},[f]),w=le.useCallback((N,T)=>{let{reverseOrder:A=!1,gutter:n=8,defaultPosition:M}=T||{},z=d.filter(G=>(G.position||M)===(N.position||M)&&G.height),V=z.findIndex(G=>G.id===N.id),U=z.filter((G,W)=>W<V&&G.visible).length;return z.filter(G=>G.visible).slice(...A?[U+1]:[0,U]).reduce((G,W)=>G+(W.height||0)+n,0)},[d]);return le.useEffect(()=>{d.forEach(N=>{if(N.dismissed)Tj(N.id,N.removeDelay);else{let T=Wu.get(N.id);T&&(clearTimeout(T),Wu.delete(N.id))}})},[d]),{toasts:d,handlers:{updateHeight:jj,startPause:Nj,endPause:g,calculateOffset:w}}},Cj=fa`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,kj=fa`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Aj=fa`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Mj=eo("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Cj} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${kj} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${c=>c.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Aj} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Pj=fa`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ij=eo("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${c=>c.secondary||"#e0e0e0"};
  border-right-color: ${c=>c.primary||"#616161"};
  animation: ${Pj} 1s linear infinite;
`,Dj=fa`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Lj=fa`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Rj=eo("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Dj} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Lj} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${c=>c.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,zj=eo("div")`
  position: absolute;
`,Oj=eo("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Fj=fa`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Bj=eo("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Fj} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Uj=({toast:c})=>{let{icon:d,type:f,iconTheme:g}=c;return d!==void 0?typeof d=="string"?le.createElement(Bj,null,d):d:f==="blank"?null:le.createElement(Oj,null,le.createElement(Ij,{...g}),f!=="loading"&&le.createElement(zj,null,f==="error"?le.createElement(Mj,{...g}):le.createElement(Rj,{...g})))},Vj=c=>`
0% {transform: translate3d(0,${c*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,qj=c=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${c*-150}%,-1px) scale(.6); opacity:0;}
`,$j="0%{opacity:0;} 100%{opacity:1;}",Gj="0%{opacity:1;} 100%{opacity:0;}",Zj=eo("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Wj=eo("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Hj=(c,d)=>{let f=c.includes("top")?1:-1,[g,w]=o_()?[$j,Gj]:[Vj(f),qj(f)];return{animation:d?`${fa(g)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${fa(w)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Xj=le.memo(({toast:c,position:d,style:f,children:g})=>{let w=c.height?Hj(c.position||d||"top-center",c.visible):{opacity:0},N=le.createElement(Uj,{toast:c}),T=le.createElement(Wj,{...c.ariaProps},Vh(c.message,c));return le.createElement(Zj,{className:c.className,style:{...w,...f,...c.style}},typeof g=="function"?g({icon:N,message:T}):le.createElement(le.Fragment,null,N,T))});gj(le.createElement);var Kj=({id:c,className:d,style:f,onHeightUpdate:g,children:w})=>{let N=le.useCallback(T=>{if(T){let A=()=>{let n=T.getBoundingClientRect().height;g(c,n)};A(),new MutationObserver(A).observe(T,{subtree:!0,childList:!0,characterData:!0})}},[c,g]);return le.createElement("div",{ref:N,className:d,style:f},w)},Qj=(c,d)=>{let f=c.includes("top"),g=f?{top:0}:{bottom:0},w=c.includes("center")?{justifyContent:"center"}:c.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:o_()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${d*(f?1:-1)}px)`,...g,...w}},Jj=tm`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Mh=16,Yj=({reverseOrder:c,position:d="top-center",toastOptions:f,gutter:g,children:w,containerStyle:N,containerClassName:T})=>{let{toasts:A,handlers:n}=Ej(f);return le.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Mh,left:Mh,right:Mh,bottom:Mh,pointerEvents:"none",...N},className:T,onMouseEnter:n.startPause,onMouseLeave:n.endPause},A.map(M=>{let z=M.position||d,V=n.calculateOffset(M,{reverseOrder:c,gutter:g,defaultPosition:d}),U=Qj(z,V);return le.createElement(Kj,{id:M.id,key:M.id,onHeightUpdate:n.updateHeight,className:M.visible?Jj:"",style:U},M.type==="custom"?Vh(M.message,M):w?w(M):le.createElement(Xj,{toast:M,position:z}))}))},It=Kr;function eN(c){return c}function tN(c){return c.length===0?eN:c.length===1?c[0]:function(f){return c.reduce((g,w)=>w(g),f)}}function c_(c){const d={subscribe(f){let g=null,w=!1,N=!1,T=!1;function A(){if(g===null){T=!0;return}N||(N=!0,typeof g=="function"?g():g&&g.unsubscribe())}return g=c({next(n){var M;w||(M=f.next)==null||M.call(f,n)},error(n){var M;w||(w=!0,(M=f.error)==null||M.call(f,n),A())},complete(){var n;w||(w=!0,(n=f.complete)==null||n.call(f),A())}}),T&&A(),{unsubscribe:A}},pipe(...f){return tN(f)(d)}};return d}function sN(c){return d=>{let f=0,g=null;const w=[];function N(){g||(g=d.subscribe({next(A){var n;for(const M of w)(n=M.next)==null||n.call(M,A)},error(A){var n;for(const M of w)(n=M.error)==null||n.call(M,A)},complete(){var A;for(const n of w)(A=n.complete)==null||A.call(n)}}))}function T(){if(f===0&&g){const A=g;g=null,A.unsubscribe()}}return{subscribe(A){return f++,w.push(A),N(),{unsubscribe(){f--,T();const n=w.findIndex(M=>M===A);n>-1&&w.splice(n,1)}}}}}}class Ff extends Error{constructor(d){super(d),this.name="ObservableAbortError",Object.setPrototypeOf(this,Ff.prototype)}}function rN(c){let d;return{promise:new Promise((g,w)=>{let N=!1;function T(){N||(N=!0,w(new Ff("This operation was aborted.")),A.unsubscribe())}const A=c.subscribe({next(n){N=!0,g(n),T()},error(n){N=!0,w(n),T()},complete(){N=!0,T()}});d=T}),abort:d}}function iN(c){return c_(d=>{function f(w=0,N=c.op){const T=c.links[w];if(!T)throw new Error("No more links to execute - did you forget to add an ending link?");return T({op:N,next(n){return f(w+1,n)}})}return f().subscribe(d)})}function u_(c){const d=Object.create(null);for(const f in c){const g=c[f];d[g]=f}return d}const d_={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};u_(d_);u_(d_);const h_=()=>{};function m_(c,d){return new Proxy(h_,{get(g,w){if(!(typeof w!="string"||w==="then"))return m_(c,[...d,w])},apply(g,w,N){const T=d[d.length-1]==="apply";return c({args:T?N.length>=2?N[1]:[]:N,path:T?d.slice(0,-1):d})}})}const sm=c=>m_(c,[]),Bf=c=>new Proxy(h_,{get(d,f){if(!(typeof f!="string"||f==="then"))return c(f)}});function nN(c){return!!c&&!Array.isArray(c)&&typeof c=="object"}class aN extends Error{}function oN(c){if(c instanceof Error)return c;const d=typeof c;if(!(d==="undefined"||d==="function"||c===null)){if(d!=="object")return new Error(String(c));if(nN(c)){const f=new aN;for(const g in c)f[g]=c[g];return f}}}function qh(c){return!!c&&!Array.isArray(c)&&typeof c=="object"}function lN(c,d){if("error"in c){const g=d.transformer.deserialize(c.error);return{ok:!1,error:{...c,error:g}}}return{ok:!0,result:{...c.result,...(!c.result.type||c.result.type==="data")&&{type:"data",data:d.transformer.deserialize(c.result.data)}}}}class Qp extends Error{constructor(){super("Unable to transform response from server")}}function cN(c,d){let f;try{f=lN(c,d)}catch{throw new Qp}if(!f.ok&&(!qh(f.error.error)||typeof f.error.error.code!="number"))throw new Qp;if(f.ok&&!qh(f.result))throw new Qp;return f}function uN(c){return c instanceof Vn||c instanceof Error&&c.name==="TRPCClientError"}function dN(c){return qh(c)&&qh(c.error)&&typeof c.error.code=="number"&&typeof c.error.message=="string"}class Vn extends Error{static from(d,f={}){const g=d;return uN(g)?(f.meta&&(g.meta={...g.meta,...f.meta}),g):dN(g)?new Vn(g.error.message,{...f,result:g}):g instanceof Error?new Vn(g.message,{...f,cause:oN(g)}):new Vn("Unknown error",{...f,cause:g})}constructor(d,f){var w,N;const g=f==null?void 0:f.cause;super(d,{cause:g}),this.meta=f==null?void 0:f.meta,this.cause=g,this.shape=(w=f==null?void 0:f.result)==null?void 0:w.error,this.data=(N=f==null?void 0:f.result)==null?void 0:N.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,Vn.prototype)}}const Gy=c=>typeof c=="function";function hN(c){if(c)return c;if(typeof window<"u"&&Gy(window.fetch))return window.fetch;if(typeof globalThis<"u"&&Gy(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}function mN(c){return c||(typeof window<"u"&&window.AbortController?window.AbortController:typeof globalThis<"u"&&globalThis.AbortController?globalThis.AbortController:null)}function pN(c){return{url:c.url.toString().replace(/\/$/,""),fetch:c.fetch,AbortController:mN(c.AbortController)}}function fN(c){const d={};for(let f=0;f<c.length;f++){const g=c[f];d[f]=g}return d}const gN={query:"GET",mutation:"POST"};function p_(c){return"input"in c?c.runtime.transformer.serialize(c.input):fN(c.inputs.map(d=>c.runtime.transformer.serialize(d)))}const f_=c=>{let d=c.url+"/"+c.path;const f=[];if("inputs"in c&&f.push("batch=1"),c.type==="query"){const g=p_(c);g!==void 0&&f.push(`input=${encodeURIComponent(JSON.stringify(g))}`)}return f.length&&(d+="?"+f.join("&")),d},xN=c=>{if(c.type==="query")return;const d=p_(c);return d!==void 0?JSON.stringify(d):void 0},yN=c=>bN({...c,contentTypeHeader:"application/json",getUrl:f_,getBody:xN});async function _N(c,d){const f=c.getUrl(c),g=c.getBody(c),{type:w}=c,N=await c.headers();/* istanbul ignore if -- @preserve */if(w==="subscription")throw new Error("Subscriptions should use wsLink");const T={...c.contentTypeHeader?{"content-type":c.contentTypeHeader}:{},...c.batchModeHeader?{"trpc-batch-mode":c.batchModeHeader}:{},...N};return hN(c.fetch)(f,{method:gN[w],signal:d==null?void 0:d.signal,body:g,headers:T})}function bN(c){const d=c.AbortController?new c.AbortController:null,f={};let g=!1;return{promise:new Promise((T,A)=>{_N(c,d).then(n=>(f.response=n,g=!0,n.json())).then(n=>{f.responseJSON=n,T({json:n,meta:f})}).catch(n=>{g=!0,A(Vn.from(n,{meta:f}))})}),cancel:()=>{g||d==null||d.abort()}}}const Jp=()=>{throw new Error("Something went wrong. Please submit an issue at https://github.com/trpc/trpc/issues/new")};function Yp(c){let d=null,f=null;const g=()=>{clearTimeout(f),f=null,d=null};function w(A){var z,V;const n=[[]];let M=0;for(;;){const U=A[M];if(!U)break;const G=n[n.length-1];if(U.aborted){(z=U.reject)==null||z.call(U,new Error("Aborted")),M++;continue}if(c.validate(G.concat(U).map($=>$.key))){G.push(U),M++;continue}if(G.length===0){(V=U.reject)==null||V.call(U,new Error("Input is too big for a single dispatch")),M++;continue}n.push([])}return n}function N(){const A=w(d);g();for(const n of A){if(!n.length)continue;const M={items:n,cancel:Jp};for(const G of n)G.batch=M;const z=(G,W)=>{var K;const $=M.items[G];(K=$.resolve)==null||K.call($,W),$.batch=null,$.reject=null,$.resolve=null},{promise:V,cancel:U}=c.fetch(M.items.map(G=>G.key),z);M.cancel=U,V.then(G=>{var W;for(let $=0;$<G.length;$++){const K=G[$];z($,K)}for(const $ of M.items)(W=$.reject)==null||W.call($,new Error("Missing result")),$.batch=null}).catch(G=>{var W;for(const $ of M.items)(W=$.reject)==null||W.call($,G),$.batch=null})}}function T(A){const n={aborted:!1,key:A,batch:null,resolve:Jp,reject:Jp},M=new Promise((V,U)=>{n.reject=U,n.resolve=V,d||(d=[]),d.push(n)});return f||(f=setTimeout(N)),{promise:M,cancel:()=>{var V;n.aborted=!0,(V=n.batch)!=null&&V.items.every(U=>U.aborted)&&(n.batch.cancel(),n.batch=null)}}}return{load:T}}function vN(c){return function(f){const g=pN(f),w=f.maxURLLength??1/0;return N=>{const T=V=>{const U=W=>{if(w===1/0)return!0;const $=W.map(re=>re.path).join(","),K=W.map(re=>re.input);return f_({...g,runtime:N,type:V,path:$,inputs:K}).length<=w},G=c({...g,runtime:N,type:V,opts:f});return{validate:U,fetch:G}},A=Yp(T("query")),n=Yp(T("mutation")),M=Yp(T("subscription")),z={query:A,subscription:M,mutation:n};return({op:V})=>c_(U=>{const G=z[V.type],{promise:W,cancel:$}=G.load(V);let K;return W.then(ue=>{K=ue;const re=cN(ue.json,N);if(!re.ok){U.error(Vn.from(re.error,{meta:ue.meta}));return}U.next({context:ue.meta,result:re.result}),U.complete()}).catch(ue=>{U.error(Vn.from(ue,{meta:K==null?void 0:K.meta}))}),()=>{$()}})}}}const wN=c=>d=>{const f=d.map(T=>T.path).join(","),g=d.map(T=>T.input),{promise:w,cancel:N}=yN({...c,path:f,inputs:g,headers(){return c.opts.headers?typeof c.opts.headers=="function"?c.opts.headers({opList:d}):c.opts.headers:{}}});return{promise:w.then(T=>(Array.isArray(T.json)?T.json:d.map(()=>T.json)).map(M=>({meta:T.meta,json:M}))),cancel:N}},jN=vN(wN);class NN{$request({type:d,input:f,path:g,context:w={}}){return iN({links:this.links,op:{id:++this.requestId,type:d,path:g,input:f,context:w}}).pipe(sN())}requestAsPromise(d){const f=this.$request(d),{promise:g,abort:w}=rN(f);return new Promise((T,A)=>{var n;(n=d.signal)==null||n.addEventListener("abort",w),g.then(M=>{T(M.result.data)}).catch(M=>{A(Vn.from(M))})})}query(d,f,g){return this.requestAsPromise({type:"query",path:d,input:f,context:g==null?void 0:g.context,signal:g==null?void 0:g.signal})}mutation(d,f,g){return this.requestAsPromise({type:"mutation",path:d,input:f,context:g==null?void 0:g.context,signal:g==null?void 0:g.signal})}subscription(d,f,g){return this.$request({type:"subscription",path:d,input:f,context:g==null?void 0:g.context}).subscribe({next(N){var T,A,n;N.result.type==="started"?(T=g.onStarted)==null||T.call(g):N.result.type==="stopped"?(A=g.onStopped)==null||A.call(g):(n=g.onData)==null||n.call(g,N.result.data)},error(N){var T;(T=g.onError)==null||T.call(g,N)},complete(){var N;(N=g.onComplete)==null||N.call(g)}})}constructor(d){this.requestId=0;const f=(()=>{const g=d.transformer;return g?"input"in g?d.transformer:{input:g,output:g}:{input:{serialize:w=>w,deserialize:w=>w},output:{serialize:w=>w,deserialize:w=>w}}})();this.runtime={transformer:{serialize:g=>f.input.serialize(g),deserialize:g=>f.output.deserialize(g)},combinedTransformer:f},this.links=d.links.map(g=>g(this.runtime))}}function SN(c){return new NN(c)}const TN={query:"query",mutate:"mutation",subscribe:"subscription"},EN=c=>TN[c];function CN(c){return Bf(d=>c.hasOwnProperty(d)?c[d]:d==="__untypedClient"?c:sm(({path:f,args:g})=>{const w=[d,...f],N=EN(w.pop()),T=w.join(".");return c[N](T,...g)}))}function hr(c,d){const f=Array.isArray(c)?c:[c],[g,w]=f,N=typeof g!="string"||g===""?[]:g.split(".");return!w&&(!d||d==="any")?N.length?[N]:[]:[N,{...typeof w<"u"&&{input:w},...d&&d!=="any"&&{type:d}}]}function $h(c,d){return c.length?d===void 0?[c]:[c,d]:[]}function kN(c,d){return sm(f=>{const g=f.args,w=[c,...f.path],N=w.pop(),T=w.join(".");if(N==="useMutation")return d[N](T,...g);const[A,...n]=g,M=$h(T,A);if(N==="getQueryKey")return hr(M,n[0]??"any");if(N==="_def")return{path:w};if(N.startsWith("useSuspense")){const z=n[0]||{},U=d[N==="useSuspenseQuery"?"useQuery":"useInfiniteQuery"](M,{...z,suspense:!0,enabled:!0});return[U.data,U]}return d[N](M,...n)})}const AN=["client","ssrContext","ssrState","abortOnUnmount"],MN=le.createContext(null);function PN(c){return Bf(d=>{const f=d;return f==="client"?CN(c.client):AN.includes(f)?c[f]:sm(({path:g,args:w})=>{const N=[d,...g],T=N.pop(),A=N.join("."),n=G=>{if(["setData","setInfiniteData"].includes(G)){const[ue,re,...te]=w;return{queryKey:$h(A,ue),updater:re,rest:te}}const[W,...$]=w;return{queryKey:$h(A,W),rest:$}},{queryKey:M,rest:z,updater:V}=n(T);return{fetch:()=>c.fetchQuery(M,...z),fetchInfinite:()=>c.fetchInfiniteQuery(M,...z),prefetch:()=>c.prefetchQuery(M,...z),prefetchInfinite:()=>c.prefetchInfiniteQuery(M,...z),ensureData:()=>c.ensureQueryData(M,...z),invalidate:()=>c.invalidateQueries(M,...z),reset:()=>c.resetQueries(M,...z),refetch:()=>c.refetchQueries(M,...z),cancel:()=>c.cancelQuery(M,...z),setData:()=>{c.setQueryData(M,V,...z)},setInfiniteData:()=>{c.setInfiniteQueryData(M,V,...z)},getData:()=>c.getQueryData(M),getInfiniteData:()=>c.getInfiniteQueryData(M)}[T]()})})}function IN(c){return sm(d=>{const f=d.path.join("."),[g,w]=d.args;return{queryKey:$h(f,g),queryFn:()=>c.query(f,g,w==null?void 0:w.trpc),...w}})}function Za(c,d){const[f,g]=c;return[f,g,d==null?void 0:d.trpc]}function ef(c){const{path:d}=c;return le.useMemo(()=>({path:d}),[d])}function DN(c){const d=W=>W.originalFn(),f=MN,g=c==null?void 0:c.reactQueryContext,w=W=>SN(W),N=W=>{const{abortOnUnmount:$=!1,client:K,queryClient:ue,ssrContext:re}=W,[te,je]=le.useState(W.ssrState??!1);return le.useEffect(()=>{je(me=>me?"mounted":!1)},[]),mi.createElement(f.Provider,{value:{abortOnUnmount:$,queryClient:ue,client:K,ssrContext:re??null,ssrState:te,fetchQuery:le.useCallback((me,Ce)=>ue.fetchQuery({...Ce,queryKey:hr(me,"query"),queryFn:()=>K.query(...Za(me,Ce))}),[K,ue]),fetchInfiniteQuery:le.useCallback((me,Ce)=>ue.fetchInfiniteQuery({...Ce,queryKey:hr(me,"infinite"),queryFn:({pageParam:Ae})=>{const[fe,Ie]=me,Ee={...Ie,cursor:Ae};return K.query(...Za([fe,Ee],Ce))}}),[K,ue]),prefetchQuery:le.useCallback((me,Ce)=>ue.prefetchQuery({...Ce,queryKey:hr(me,"query"),queryFn:()=>K.query(...Za(me,Ce))}),[K,ue]),prefetchInfiniteQuery:le.useCallback((me,Ce)=>ue.prefetchInfiniteQuery({...Ce,queryKey:hr(me,"infinite"),queryFn:({pageParam:Ae})=>{const[fe,Ie]=me,Ee={...Ie,cursor:Ae};return K.query(...Za([fe,Ee],Ce))}}),[K,ue]),ensureQueryData:le.useCallback((me,Ce)=>ue.ensureQueryData({...Ce,queryKey:hr(me,"query"),queryFn:()=>K.query(...Za(me,Ce))}),[K,ue]),invalidateQueries:le.useCallback((me,Ce,Ae)=>ue.invalidateQueries({...Ce,queryKey:hr(me,"any")},Ae),[ue]),resetQueries:le.useCallback((...me)=>{const[Ce,Ae,fe]=me;return ue.resetQueries({...Ae,queryKey:hr(Ce,"any")},fe)},[ue]),refetchQueries:le.useCallback((...me)=>{const[Ce,Ae,fe]=me;return ue.refetchQueries({...Ae,queryKey:hr(Ce,"any")},fe)},[ue]),cancelQuery:le.useCallback(me=>ue.cancelQueries({queryKey:hr(me,"any")}),[ue]),setQueryData:le.useCallback((...me)=>{const[Ce,...Ae]=me;return ue.setQueryData(hr(Ce,"query"),...Ae)},[ue]),getQueryData:le.useCallback((...me)=>{const[Ce,...Ae]=me;return ue.getQueryData(hr(Ce,"query"),...Ae)},[ue]),setInfiniteQueryData:le.useCallback((...me)=>{const[Ce,...Ae]=me;return ue.setQueryData(hr(Ce,"infinite"),...Ae)},[ue]),getInfiniteQueryData:le.useCallback((...me)=>{const[Ce,...Ae]=me;return ue.getQueryData(hr(Ce,"infinite"),...Ae)},[ue])}},W.children)};function T(){return mi.useContext(f)}function A(W,$,K){var te;const{queryClient:ue,ssrState:re}=T();return re&&re!=="mounted"&&((te=ue.getQueryCache().find(hr(W,$)))==null?void 0:te.state.status)==="error"?{retryOnMount:!1,...K}:K}function n(W,$){var Ee,tt;const K=T();if(!K)throw new Error("Unable to retrieve application context. Did you forget to wrap your App inside `withTRPC` HoC?");const{abortOnUnmount:ue,client:re,ssrState:te,queryClient:je,prefetchQuery:me}=K,Ce=je.getQueryDefaults(hr(W,"query"));typeof window>"u"&&te==="prepass"&&((Ee=$==null?void 0:$.trpc)==null?void 0:Ee.ssr)!==!1&&(($==null?void 0:$.enabled)??(Ce==null?void 0:Ce.enabled))!==!1&&!je.getQueryCache().find(hr(W,"query"))&&me(W,$);const Ae=A(W,"query",{...Ce,...$}),fe=((tt=$==null?void 0:$.trpc)==null?void 0:tt.abortOnUnmount)??(c==null?void 0:c.abortOnUnmount)??ue,Ie=i_({...Ae,queryKey:hr(W,"query"),queryFn:Pe=>{const Te={...Ae,trpc:{...Ae==null?void 0:Ae.trpc,...fe?{signal:Pe.signal}:{}}};return re.query(...Za(W,Te))},context:g});return Ie.trpc=ef({path:W[0]}),Ie}function M(W,$){const{client:K}=T(),ue=em({context:g}),re=Array.isArray(W)?W[0]:W,te=ue.getMutationDefaults([re.split(".")]),je=oj({...$,mutationKey:[re.split(".")],mutationFn:me=>K.mutation(...Za([re,me],$)),context:g,onSuccess(...me){return d({originalFn:()=>{var Ae,fe;return((Ae=$==null?void 0:$.onSuccess)==null?void 0:Ae.call($,...me))??((fe=te==null?void 0:te.onSuccess)==null?void 0:fe.call(te,...me))},queryClient:ue,meta:($==null?void 0:$.meta)??(te==null?void 0:te.meta)??{}})}});return je.trpc=ef({path:re}),je}/* istanbul ignore next -- @preserve */function z(W,$){const K=($==null?void 0:$.enabled)??!0,ue=Ja(W),{client:re}=T(),te=le.useRef($);te.current=$,le.useEffect(()=>{if(!K)return;const[je,me]=W;let Ce=!1;const Ae=re.subscription(je,me??void 0,{onStarted:()=>{var fe,Ie;Ce||(Ie=(fe=te.current).onStarted)==null||Ie.call(fe)},onData:fe=>{Ce||te.current.onData(fe)},onError:fe=>{var Ie,Ee;Ce||(Ee=(Ie=te.current).onError)==null||Ee.call(Ie,fe)}});return()=>{Ce=!0,Ae.unsubscribe()}},[ue,K])}function V(W,$){var tt,Pe;const[K,ue]=W,{client:re,ssrState:te,prefetchInfiniteQuery:je,queryClient:me,abortOnUnmount:Ce}=T(),Ae=me.getQueryDefaults(hr(W,"infinite"));typeof window>"u"&&te==="prepass"&&((tt=$==null?void 0:$.trpc)==null?void 0:tt.ssr)!==!1&&(($==null?void 0:$.enabled)??(Ae==null?void 0:Ae.enabled))!==!1&&!me.getQueryCache().find(hr(W,"infinite"))&&je(W,{...Ae,...$});const fe=A(W,"infinite",{...Ae,...$}),Ie=((Pe=$==null?void 0:$.trpc)==null?void 0:Pe.abortOnUnmount)??Ce,Ee=cj({...fe,queryKey:hr(W,"infinite"),queryFn:Te=>{const rt={...fe,trpc:{...fe==null?void 0:fe.trpc,...Ie?{signal:Te.signal}:{}}},gt={...ue??{},cursor:Te.pageParam??($==null?void 0:$.initialCursor)};return re.query(...Za([K,gt],rt))},context:g});return Ee.trpc=ef({path:K}),Ee}return{Provider:N,createClient:w,useContext:T,useUtils:T,useQuery:n,useQueries:(W,$)=>{var Ce;const{ssrState:K,queryClient:ue,prefetchQuery:re,client:te}=T(),je=IN(te),me=W(je);if(typeof window>"u"&&K==="prepass")for(const Ae of me){const fe=Ae;((Ce=fe.trpc)==null?void 0:Ce.ssr)!==!1&&!ue.getQueryCache().find(hr(fe.queryKey,"query"))&&re(fe.queryKey,fe)}return aj({queries:me.map(Ae=>({...Ae,queryKey:hr(Ae.queryKey,"query")})),context:$})},useMutation:M,useSubscription:z,useDehydratedState:(W,$)=>le.useMemo(()=>$&&W.runtime.transformer.deserialize($),[$,W]),useInfiniteQuery:V}}function LN(c){return DN(c)}function RN(c){return Bf(d=>d==="useContext"||d==="useUtils"?()=>{const f=c.useUtils();return le.useMemo(()=>PN(f),[f])}:c.hasOwnProperty(d)?c[d]:kN(d,c))}function zN(c){const d=LN(c);return RN(d)}const _t=zN(),ON=_t.createClient({links:[jN({url:"/api/v1/trpc",headers:async()=>{try{let c=localStorage.getItem("auth_token");if(!c){const d=Object.keys(localStorage);for(const f of d)if(f.includes("auth-token")){const g=localStorage.getItem(f);try{const w=JSON.parse(g);if(w&&w.access_token){c=w.access_token;break}}catch{}}}return c?{Authorization:`Bearer ${c}`}:{}}catch(c){return console.warn("Failed to get auth token for tRPC:",c),{}}}})]}),g_=le.createContext(void 0),rm=()=>{const c=le.useContext(g_);if(c===void 0)throw new Error("useAuth must be used within an AuthProvider");return c},FN=({children:c})=>{const[d,f]=le.useState({user:null,adminUser:null,loading:!0,error:null}),g=_t.auth.login.useMutation(),w=_t.auth.register.useMutation(),N=_t.auth.logout.useMutation(),T=async(z,V)=>{f(U=>({...U,loading:!0,error:null}));try{const U=await g.mutateAsync({email:z,password:V});localStorage.setItem("auth_token",U.session.access_token),localStorage.setItem("refresh_token",U.session.refresh_token),f({user:U.user,adminUser:U.user,loading:!1,error:null}),window.location.href="/dashboard"}catch(U){throw console.error("Login error:",U),f(G=>({...G,loading:!1,error:U.message||"Authentication failed"})),U}},A=async(z,V,U)=>{f(G=>({...G,loading:!0,error:null}));try{const G=await w.mutateAsync({email:z,password:V,name:U});f(W=>({...W,loading:!1,error:null}))}catch(G){throw f(W=>({...W,loading:!1,error:G.message||"Registration failed"})),G}},n=async()=>{f(z=>({...z,loading:!0}));try{await N.mutateAsync()}catch{}localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),f({user:null,adminUser:null,loading:!1,error:null})};le.useEffect(()=>{(async()=>{let V=localStorage.getItem("auth_token");if(!V){const G=Object.keys(localStorage);for(const W of G){const $=localStorage.getItem(W);try{const K=JSON.parse($);if(K&&K.access_token){V=K.access_token;break}}catch{}}}const U=window.location.pathname==="/login"||window.location.pathname==="/";if(!V){f(G=>({...G,user:null,adminUser:null,loading:!1})),U||(window.location.href="/login");return}try{const $=await(await fetch("https://ordermanagementsystem-production-3ed7.up.railway.app/api/v1/trpc/auth.me",{method:"GET",headers:{Authorization:`Bearer ${V}`}})).json();if($&&$.result&&$.result.data){const K=$.result.data;f({user:K.user,adminUser:K.user,loading:!1,error:null})}else throw new Error("Invalid response format from auth.me")}catch(G){console.error("Auth initialization failed:",G==null?void 0:G.message),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),f({user:null,adminUser:null,loading:!1,error:null}),U||(window.location.href="/login")}})()},[]);const M={...d,signIn:T,signOut:n,register:A};return t.jsx(g_.Provider,{value:M,children:c})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var BN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Lt=(c,d)=>{const f=le.forwardRef(({color:g="currentColor",size:w=24,strokeWidth:N=2,absoluteStrokeWidth:T,className:A="",children:n,...M},z)=>le.createElement("svg",{ref:z,...BN,width:w,height:w,stroke:g,strokeWidth:T?Number(N)*24/Number(w):N,className:["lucide",`lucide-${UN(c)}`,A].join(" "),...M},[...d.map(([V,U])=>le.createElement(V,U)),...Array.isArray(n)?n:[n]]));return f.displayName=`${c}`,f};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zy=Lt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const im=Lt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=Lt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uf=Lt("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=Lt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=Lt("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VN=Lt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=Lt("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qN=Lt("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=Lt("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=Lt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $N=Lt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=Lt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GN=Lt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nm=Lt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=Lt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_=Lt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZN=Lt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=Lt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WN=Lt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=Lt("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=Lt("Cylinder",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5v14a9 3 0 0 0 18 0V5",key:"aqi0yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=Lt("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qf=Lt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XN=Lt("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const am=Lt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_=Lt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qu=Lt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=Lt("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"8ur5zv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=Lt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QN=Lt("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=Lt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JN=Lt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=Lt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eS=Lt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=Lt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tS=Lt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=Lt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_=Lt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N_=Lt("Package2",[["path",{d:"M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z",key:"1ront0"}],["path",{d:"m3 9 2.45-4.9A2 2 0 0 1 7.24 3h9.52a2 2 0 0 1 1.8 1.1L21 9",key:"19h2x1"}],["path",{d:"M12 3v6",key:"1holv5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=Lt("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rS=Lt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iS=Lt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=Lt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S_=Lt("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=Lt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=Lt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T_=Lt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nf=Lt("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yi=Lt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nS=Lt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=Lt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sc=Lt("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ci=Lt("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gh=Lt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oS=Lt("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=Lt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wy=Lt("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=Lt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=Lt("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const om=Lt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rc=Lt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=Lt("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $f=Lt("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lS=Lt("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Lt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=Lt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cS=Lt("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),uS=({children:c})=>{const{user:d,adminUser:f,loading:g}=rm();return g?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}):!d||!f?t.jsx(k0,{to:"/login",replace:!0}):t.jsx(t.Fragment,{children:c})},dS=({onMenuClick:c})=>{const{adminUser:d,signOut:f}=rm(),g=async()=>{try{await f()}catch(w){console.error("Error signing out:",w)}};return t.jsxs("header",{className:"bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:c,className:"lg:hidden p-2 rounded-md hover:bg-gray-100 transition-colors",children:t.jsx(tS,{className:"h-6 w-6 text-gray-600"})}),t.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"LPG Order Management"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(om,{className:"h-4 w-4"}),t.jsxs("div",{className:"flex flex-col items-end",children:[t.jsx("span",{className:"font-medium text-gray-900",children:d==null?void 0:d.name}),t.jsx("span",{className:"text-xs capitalize",children:d==null?void 0:d.role})]})]})}),t.jsxs("button",{onClick:g,className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:[t.jsx(YN,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Sign Out"})]})]})]})},hS=[{name:"Dashboard",href:"/",icon:QN},{name:"Customers",href:"/customers",icon:rc},{name:"Products",href:"/products",icon:hs},{name:"Warehouses",href:"/warehouses",icon:Gn},{name:"Inventory",href:"/inventory",icon:Xo},{name:"Trucks",href:"/trucks",icon:yr},{name:"Fleet Capacity",href:"/trucks/capacity",icon:Ji},{name:"Pricing",href:"/pricing",icon:Sn},{name:"Orders",href:"/orders",icon:sc},{name:"Transfers",href:"/transfers",icon:Uf}],mS=({isOpen:c,onClose:d})=>t.jsxs(t.Fragment,{children:[c&&t.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden",onClick:d}),t.jsxs("aside",{className:`
          fixed top-0 left-0 z-50 h-full w-64 bg-gray-900 transform transition-transform duration-300 ease-in-out
          ${c?"translate-x-0":"-translate-x-full"}
          lg:translate-x-0 lg:static lg:z-auto lg:flex-shrink-0
        `,children:[t.jsxs("div",{className:"flex items-center justify-between p-4 lg:hidden border-b border-gray-700",children:[t.jsx("span",{className:"text-lg font-semibold text-white",children:"Menu"}),t.jsx("button",{onClick:d,className:"p-2 rounded-md hover:bg-gray-800 transition-colors",children:t.jsx(er,{className:"h-5 w-5 text-gray-300"})})]}),t.jsx("div",{className:"hidden lg:flex items-center justify-center h-16 bg-gray-800 border-b border-gray-700",children:t.jsx("span",{className:"text-lg font-semibold text-white",children:"LPG Admin"})}),t.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-y-auto",children:hS.map(f=>t.jsxs(g1,{to:f.href,onClick:d,className:({isActive:g})=>`flex items-center space-x-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${g?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-800"}`,children:[t.jsx(f.icon,{className:"h-5 w-5"}),t.jsx("span",{children:f.name})]},f.name))})]})]}),pS=()=>{const[c,d]=le.useState(!1);return t.jsxs("div",{className:"h-screen flex overflow-hidden bg-gray-50",children:[t.jsx(mS,{isOpen:c,onClose:()=>d(!1)}),t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[t.jsx(dS,{onMenuClick:()=>d(!c)}),t.jsx("main",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"p-6",children:t.jsx(x1,{})})})]})]})},fS=()=>{const{user:c,signIn:d,loading:f,error:g}=rm(),[w,N]=le.useState({email:"",password:""}),[T,A]=le.useState(!1);if(c)return t.jsx(k0,{to:"/",replace:!0});const n=async z=>{z.preventDefault(),A(!0);try{await d(w.email,w.password)}catch{}finally{A(!1)}},M=z=>{N(V=>({...V,[z.target.name]:z.target.value}))};return f?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"max-w-md w-full space-y-8",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mx-auto h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center",children:t.jsx(w_,{className:"h-8 w-8 text-white"})}),t.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Admin Portal"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"LPG Order Management System"})]}),t.jsxs("form",{className:"mt-8 space-y-6",onSubmit:n,children:[g&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(im,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-600",children:g})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),t.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:w.email,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter your email"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),t.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:w.password,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter your password"})]})]}),t.jsx("button",{type:"submit",disabled:T,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:T?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Signing in..."})]}):"Sign In"})]}),t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-xs text-gray-500",children:"Authorized personnel only. Please contact your administrator if you need access."})})]})})},gS=(c="month")=>_t.analytics.getDashboardStats.useQuery({period:c},{retry:1,staleTime:6e4,refetchInterval:5*60*1e3}),Hy=()=>{const{adminUser:c}=rm(),{data:d,isLoading:f,refetch:g}=gS(),w=[{name:"Active Customers",value:f?"...":((d==null?void 0:d.activeCustomers)||0).toLocaleString(),total:f?"...":((d==null?void 0:d.totalCustomers)||0).toLocaleString(),change:f?"...":`${(d==null?void 0:d.totalCustomers)||0} total`,changeType:"neutral",icon:rc},{name:"Active Products",value:f?"...":((d==null?void 0:d.activeProducts)||0).toLocaleString(),total:f?"...":((d==null?void 0:d.totalProducts)||0).toLocaleString(),change:f?"...":`${(d==null?void 0:d.totalProducts)||0} total`,changeType:"neutral",icon:hs},{name:"Total Cylinders",value:f?"...":((d==null?void 0:d.totalCylinders)||0).toLocaleString(),change:f?"...":"across all warehouses",changeType:"positive",icon:Ji},{name:"Warehouses",value:f?"...":((d==null?void 0:d.totalWarehouses)||0).toLocaleString(),change:f?"...":"storage locations",changeType:"neutral",icon:Gn}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),t.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",c==null?void 0:c.name,"!"]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>g(),disabled:f,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${f?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsx(Xo,{className:"h-8 w-8 text-blue-600"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:w.map(N=>t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:N.name}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.value})]}),t.jsx("div",{className:"p-3 bg-blue-50 rounded-full",children:t.jsx(N.icon,{className:"h-6 w-6 text-blue-600"})})]}),t.jsx("div",{className:"mt-4 flex items-center",children:t.jsx("span",{className:"text-sm text-gray-500",children:N.change})})]},N.name))}),!f&&d&&d.lowStockProducts>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Low Stock Alert"}),t.jsxs("p",{className:"text-sm text-red-700",children:[d.lowStockProducts," product",d.lowStockProducts>1?"s have":" has"," low stock levels (10 available)"]})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("button",{onClick:()=>window.location.href="/orders",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(sc,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"New Order"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Create a new customer order"})]}),t.jsxs("button",{onClick:()=>window.location.href="/customers",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(rc,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"Add Customer"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Register a new customer"})]}),t.jsxs("button",{onClick:()=>window.location.href="/inventory",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(hs,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"Manage Inventory"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Update product stock levels"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),t.jsx(Zy,{className:"h-5 w-5 text-gray-400"})]}),t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Zy,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"Recent activity tracking coming soon"})]})]})]})},E_=(c={})=>_t.customers.list.useQuery({search:c.search,status:c.status,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Customers fetch error:",d),It.error("Failed to load customers")}}),xS=c=>_t.customers.getById.useQuery({customer_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Customer fetch error:",d),It.error("Failed to load customer details")}}),yS=()=>{const c=_t.useContext();return _t.customers.create.useMutation({onSuccess:d=>{console.log("Customer created successfully:",d),c.customers.list.invalidate(),It.success("Customer created successfully")},onError:d=>{console.error("Create customer error:",d),It.error(d.message||"Failed to create customer")}})},C_=()=>{const c=_t.useContext();return _t.customers.update.useMutation({onSuccess:d=>{console.log("Customer updated successfully:",d),c.customers.list.invalidate(),c.customers.getById.invalidate({customer_id:d.id}),It.success("Customer updated successfully")},onError:d=>{console.error("Update customer error:",d),It.error(d.message||"Failed to update customer")}})},_S=()=>{const c=_t.useContext();return _t.customers.delete.useMutation({onSuccess:()=>{console.log("Customer deleted successfully"),c.customers.list.invalidate(),It.success("Customer deleted successfully")},onError:d=>{console.error("Delete customer error:",d),It.error(d.message||"Failed to delete customer")}})},bS=({customers:c,loading:d=!1,onView:f,onDelete:g,onStatusChange:w})=>{const N=T=>new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return console.log("CustomerTable render:",{customers:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading customers..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(rc,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No customers found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load customers. Please check your connection.":"Get started by adding your first customer."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Customers (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credit Terms"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(T=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:T.name}),T.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",T.external_id]}),T.tax_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Tax ID: ",T.tax_id]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[T.email&&t.jsx("div",{className:"mb-1",children:T.email}),T.phone&&t.jsx("div",{className:"text-gray-500",children:T.phone}),!T.email&&!T.phone&&t.jsx("span",{className:"text-gray-400",children:"No contact info"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("select",{value:T.account_status,onChange:A=>w(T,A.target.value),className:`block w-full pl-3 pr-10 py-2 text-sm border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${T.account_status==="active"?"bg-green-50 text-green-700 border-green-200":T.account_status==="credit_hold"?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-red-50 text-red-700 border-red-200"}`,children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[T.credit_terms_days," days"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(T.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>f(T),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View/Edit customer",children:t.jsx(ci,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>g(T),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete customer",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},T.id))})]})})]})},vS=({filters:c,onFiltersChange:d})=>{const f=w=>{d({...c,search:w.target.value||void 0,page:1})},g=w=>{d({...c,account_status:w.target.value||void 0,page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name, email, or tax ID...",value:c.search||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.account_status||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]})})]})})},ac=({currentPage:c,totalPages:d,totalCount:f,onPageChange:g})=>{if(d<=1)return null;const N=(()=>{const A=[],n=[];for(let M=Math.max(2,c-2);M<=Math.min(d-1,c+2);M++)A.push(M);return c-2>2?n.push(1,"..."):n.push(1),n.push(...A),c+2<d-1?n.push("...",d):n.push(d),n})();return t.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[t.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[t.jsx("button",{onClick:()=>g(c-1),disabled:c===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),t.jsx("button",{onClick:()=>g(c+1),disabled:c===d,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),t.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[t.jsx("div",{children:t.jsxs("p",{className:"text-sm text-gray-700",children:["Showing"," ",t.jsx("span",{className:"font-medium",children:Math.min((c-1)*50+1,f)})," ","to"," ",t.jsx("span",{className:"font-medium",children:Math.min(c*50,f)})," ","of ",t.jsx("span",{className:"font-medium",children:f})," results"]})}),t.jsx("div",{children:t.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[t.jsx("button",{onClick:()=>g(c-1),disabled:c===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(__,{className:"h-5 w-5"})}),N.map((T,A)=>t.jsx(mi.Fragment,{children:T==="..."?t.jsx("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:"..."}):t.jsx("button",{onClick:()=>g(T),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${c===T?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:T})},A)),t.jsx("button",{onClick:()=>g(c+1),disabled:c===d,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(b_,{className:"h-5 w-5"})})]})})]})]})};var td=c=>c.type==="checkbox",Zo=c=>c instanceof Date,pi=c=>c==null;const k_=c=>typeof c=="object";var vr=c=>!pi(c)&&!Array.isArray(c)&&k_(c)&&!Zo(c),wS=c=>vr(c)&&c.target?td(c.target)?c.target.checked:c.target.value:c,jS=c=>c.substring(0,c.search(/\.\d+(\.|$)/))||c,NS=(c,d)=>c.has(jS(d)),SS=c=>{const d=c.constructor&&c.constructor.prototype;return vr(d)&&d.hasOwnProperty("isPrototypeOf")},Gf=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function oi(c){let d;const f=Array.isArray(c),g=typeof FileList<"u"?c instanceof FileList:!1;if(c instanceof Date)d=new Date(c);else if(c instanceof Set)d=new Set(c);else if(!(Gf&&(c instanceof Blob||g))&&(f||vr(c)))if(d=f?[]:{},!f&&!SS(c))d=c;else for(const w in c)c.hasOwnProperty(w)&&(d[w]=oi(c[w]));else return c;return d}var lm=c=>Array.isArray(c)?c.filter(Boolean):[],Ar=c=>c===void 0,Bt=(c,d,f)=>{if(!d||!vr(c))return f;const g=lm(d.split(/[,[\].]+?/)).reduce((w,N)=>pi(w)?w:w[N],c);return Ar(g)||g===c?Ar(c[d])?f:c[d]:g},Un=c=>typeof c=="boolean",Zf=c=>/^\w*$/.test(c),A_=c=>lm(c.replace(/["|']|\]/g,"").split(/\.|\[/)),Ks=(c,d,f)=>{let g=-1;const w=Zf(d)?[d]:A_(d),N=w.length,T=N-1;for(;++g<N;){const A=w[g];let n=f;if(g!==T){const M=c[A];n=vr(M)||Array.isArray(M)?M:isNaN(+w[g+1])?{}:[]}if(A==="__proto__"||A==="constructor"||A==="prototype")return;c[A]=n,c=c[A]}};const Xy={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},jn={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ha={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};mi.createContext(null);var TS=(c,d,f,g=!0)=>{const w={defaultValues:d._defaultValues};for(const N in c)Object.defineProperty(w,N,{get:()=>{const T=N;return d._proxyFormState[T]!==jn.all&&(d._proxyFormState[T]=!g||jn.all),c[T]}});return w};const ES=typeof window<"u"?le.useLayoutEffect:le.useEffect;var qn=c=>typeof c=="string",CS=(c,d,f,g,w)=>qn(c)?(g&&d.watch.add(c),Bt(f,c,w)):Array.isArray(c)?c.map(N=>(g&&d.watch.add(N),Bt(f,N))):(g&&(d.watchAll=!0),f),kS=(c,d,f,g,w)=>d?{...f[c],types:{...f[c]&&f[c].types?f[c].types:{},[g]:w||!0}}:{},Hu=c=>Array.isArray(c)?c:[c],Ky=()=>{let c=[];return{get observers(){return c},next:w=>{for(const N of c)N.next&&N.next(w)},subscribe:w=>(c.push(w),{unsubscribe:()=>{c=c.filter(N=>N!==w)}}),unsubscribe:()=>{c=[]}}},Sf=c=>pi(c)||!k_(c);function Qa(c,d){if(Sf(c)||Sf(d))return c===d;if(Zo(c)&&Zo(d))return c.getTime()===d.getTime();const f=Object.keys(c),g=Object.keys(d);if(f.length!==g.length)return!1;for(const w of f){const N=c[w];if(!g.includes(w))return!1;if(w!=="ref"){const T=d[w];if(Zo(N)&&Zo(T)||vr(N)&&vr(T)||Array.isArray(N)&&Array.isArray(T)?!Qa(N,T):N!==T)return!1}}return!0}var Ci=c=>vr(c)&&!Object.keys(c).length,Wf=c=>c.type==="file",Nn=c=>typeof c=="function",Zh=c=>{if(!Gf)return!1;const d=c?c.ownerDocument:0;return c instanceof(d&&d.defaultView?d.defaultView.HTMLElement:HTMLElement)},M_=c=>c.type==="select-multiple",Hf=c=>c.type==="radio",AS=c=>Hf(c)||td(c),tf=c=>Zh(c)&&c.isConnected;function MS(c,d){const f=d.slice(0,-1).length;let g=0;for(;g<f;)c=Ar(c)?g++:c[d[g++]];return c}function PS(c){for(const d in c)if(c.hasOwnProperty(d)&&!Ar(c[d]))return!1;return!0}function Or(c,d){const f=Array.isArray(d)?d:Zf(d)?[d]:A_(d),g=f.length===1?c:MS(c,f),w=f.length-1,N=f[w];return g&&delete g[N],w!==0&&(vr(g)&&Ci(g)||Array.isArray(g)&&PS(g))&&Or(c,f.slice(0,-1)),c}var P_=c=>{for(const d in c)if(Nn(c[d]))return!0;return!1};function Wh(c,d={}){const f=Array.isArray(c);if(vr(c)||f)for(const g in c)Array.isArray(c[g])||vr(c[g])&&!P_(c[g])?(d[g]=Array.isArray(c[g])?[]:{},Wh(c[g],d[g])):pi(c[g])||(d[g]=!0);return d}function I_(c,d,f){const g=Array.isArray(c);if(vr(c)||g)for(const w in c)Array.isArray(c[w])||vr(c[w])&&!P_(c[w])?Ar(d)||Sf(f[w])?f[w]=Array.isArray(c[w])?Wh(c[w],[]):{...Wh(c[w])}:I_(c[w],pi(d)?{}:d[w],f[w]):f[w]=!Qa(c[w],d[w]);return f}var Vu=(c,d)=>I_(c,d,Wh(d));const Qy={value:!1,isValid:!1},Jy={value:!0,isValid:!0};var D_=c=>{if(Array.isArray(c)){if(c.length>1){const d=c.filter(f=>f&&f.checked&&!f.disabled).map(f=>f.value);return{value:d,isValid:!!d.length}}return c[0].checked&&!c[0].disabled?c[0].attributes&&!Ar(c[0].attributes.value)?Ar(c[0].value)||c[0].value===""?Jy:{value:c[0].value,isValid:!0}:Jy:Qy}return Qy},L_=(c,{valueAsNumber:d,valueAsDate:f,setValueAs:g})=>Ar(c)?c:d?c===""?NaN:c&&+c:f&&qn(c)?new Date(c):g?g(c):c;const Yy={isValid:!1,value:null};var R_=c=>Array.isArray(c)?c.reduce((d,f)=>f&&f.checked&&!f.disabled?{isValid:!0,value:f.value}:d,Yy):Yy;function e0(c){const d=c.ref;return Wf(d)?d.files:Hf(d)?R_(c.refs).value:M_(d)?[...d.selectedOptions].map(({value:f})=>f):td(d)?D_(c.refs).value:L_(Ar(d.value)?c.ref.value:d.value,c)}var IS=(c,d,f,g)=>{const w={};for(const N of c){const T=Bt(d,N);T&&Ks(w,N,T._f)}return{criteriaMode:f,names:[...c],fields:w,shouldUseNativeValidation:g}},Hh=c=>c instanceof RegExp,qu=c=>Ar(c)?c:Hh(c)?c.source:vr(c)?Hh(c.value)?c.value.source:c.value:c,t0=c=>({isOnSubmit:!c||c===jn.onSubmit,isOnBlur:c===jn.onBlur,isOnChange:c===jn.onChange,isOnAll:c===jn.all,isOnTouch:c===jn.onTouched});const s0="AsyncFunction";var DS=c=>!!c&&!!c.validate&&!!(Nn(c.validate)&&c.validate.constructor.name===s0||vr(c.validate)&&Object.values(c.validate).find(d=>d.constructor.name===s0)),LS=c=>c.mount&&(c.required||c.min||c.max||c.maxLength||c.minLength||c.pattern||c.validate),r0=(c,d,f)=>!f&&(d.watchAll||d.watch.has(c)||[...d.watch].some(g=>c.startsWith(g)&&/^\.\w+/.test(c.slice(g.length))));const Xu=(c,d,f,g)=>{for(const w of f||Object.keys(c)){const N=Bt(c,w);if(N){const{_f:T,...A}=N;if(T){if(T.refs&&T.refs[0]&&d(T.refs[0],w)&&!g)return!0;if(T.ref&&d(T.ref,T.name)&&!g)return!0;if(Xu(A,d))break}else if(vr(A)&&Xu(A,d))break}}};function i0(c,d,f){const g=Bt(c,f);if(g||Zf(f))return{error:g,name:f};const w=f.split(".");for(;w.length;){const N=w.join("."),T=Bt(d,N),A=Bt(c,N);if(T&&!Array.isArray(T)&&f!==N)return{name:f};if(A&&A.type)return{name:N,error:A};if(A&&A.root&&A.root.type)return{name:`${N}.root`,error:A.root};w.pop()}return{name:f}}var RS=(c,d,f,g)=>{f(c);const{name:w,...N}=c;return Ci(N)||Object.keys(N).length>=Object.keys(d).length||Object.keys(N).find(T=>d[T]===(!g||jn.all))},zS=(c,d,f)=>!c||!d||c===d||Hu(c).some(g=>g&&(f?g===d:g.startsWith(d)||d.startsWith(g))),OS=(c,d,f,g,w)=>w.isOnAll?!1:!f&&w.isOnTouch?!(d||c):(f?g.isOnBlur:w.isOnBlur)?!c:(f?g.isOnChange:w.isOnChange)?c:!0,FS=(c,d)=>!lm(Bt(c,d)).length&&Or(c,d),BS=(c,d,f)=>{const g=Hu(Bt(c,f));return Ks(g,"root",d[f]),Ks(c,f,g),c},Dh=c=>qn(c);function n0(c,d,f="validate"){if(Dh(c)||Array.isArray(c)&&c.every(Dh)||Un(c)&&!c)return{type:f,message:Dh(c)?c:"",ref:d}}var Jl=c=>vr(c)&&!Hh(c)?c:{value:c,message:""},a0=async(c,d,f,g,w,N)=>{const{ref:T,refs:A,required:n,maxLength:M,minLength:z,min:V,max:U,pattern:G,validate:W,name:$,valueAsNumber:K,mount:ue}=c._f,re=Bt(f,$);if(!ue||d.has($))return{};const te=A?A[0]:T,je=Pe=>{w&&te.reportValidity&&(te.setCustomValidity(Un(Pe)?"":Pe||""),te.reportValidity())},me={},Ce=Hf(T),Ae=td(T),fe=Ce||Ae,Ie=(K||Wf(T))&&Ar(T.value)&&Ar(re)||Zh(T)&&T.value===""||re===""||Array.isArray(re)&&!re.length,Ee=kS.bind(null,$,g,me),tt=(Pe,Te,rt,gt=ha.maxLength,yt=ha.minLength)=>{const pt=Pe?Te:rt;me[$]={type:Pe?gt:yt,message:pt,ref:T,...Ee(Pe?gt:yt,pt)}};if(N?!Array.isArray(re)||!re.length:n&&(!fe&&(Ie||pi(re))||Un(re)&&!re||Ae&&!D_(A).isValid||Ce&&!R_(A).isValid)){const{value:Pe,message:Te}=Dh(n)?{value:!!n,message:n}:Jl(n);if(Pe&&(me[$]={type:ha.required,message:Te,ref:te,...Ee(ha.required,Te)},!g))return je(Te),me}if(!Ie&&(!pi(V)||!pi(U))){let Pe,Te;const rt=Jl(U),gt=Jl(V);if(!pi(re)&&!isNaN(re)){const yt=T.valueAsNumber||re&&+re;pi(rt.value)||(Pe=yt>rt.value),pi(gt.value)||(Te=yt<gt.value)}else{const yt=T.valueAsDate||new Date(re),pt=Os=>new Date(new Date().toDateString()+" "+Os),ft=T.type=="time",wt=T.type=="week";qn(rt.value)&&re&&(Pe=ft?pt(re)>pt(rt.value):wt?re>rt.value:yt>new Date(rt.value)),qn(gt.value)&&re&&(Te=ft?pt(re)<pt(gt.value):wt?re<gt.value:yt<new Date(gt.value))}if((Pe||Te)&&(tt(!!Pe,rt.message,gt.message,ha.max,ha.min),!g))return je(me[$].message),me}if((M||z)&&!Ie&&(qn(re)||N&&Array.isArray(re))){const Pe=Jl(M),Te=Jl(z),rt=!pi(Pe.value)&&re.length>+Pe.value,gt=!pi(Te.value)&&re.length<+Te.value;if((rt||gt)&&(tt(rt,Pe.message,Te.message),!g))return je(me[$].message),me}if(G&&!Ie&&qn(re)){const{value:Pe,message:Te}=Jl(G);if(Hh(Pe)&&!re.match(Pe)&&(me[$]={type:ha.pattern,message:Te,ref:T,...Ee(ha.pattern,Te)},!g))return je(Te),me}if(W){if(Nn(W)){const Pe=await W(re,f),Te=n0(Pe,te);if(Te&&(me[$]={...Te,...Ee(ha.validate,Te.message)},!g))return je(Te.message),me}else if(vr(W)){let Pe={};for(const Te in W){if(!Ci(Pe)&&!g)break;const rt=n0(await W[Te](re,f),te,Te);rt&&(Pe={...rt,...Ee(Te,rt.message)},je(rt.message),g&&(me[$]=Pe))}if(!Ci(Pe)&&(me[$]={ref:te,...Pe},!g))return me}}return je(!0),me};const US={mode:jn.onSubmit,reValidateMode:jn.onChange,shouldFocusError:!0};function VS(c={}){let d={...US,...c},f={submitCount:0,isDirty:!1,isReady:!1,isLoading:Nn(d.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:d.errors||{},disabled:d.disabled||!1};const g={};let w=vr(d.defaultValues)||vr(d.values)?oi(d.defaultValues||d.values)||{}:{},N=d.shouldUnregister?{}:oi(w),T={action:!1,mount:!1,watch:!1},A={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},n,M=0;const z={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let V={...z};const U={array:Ky(),state:Ky()},G=d.criteriaMode===jn.all,W=we=>Ge=>{clearTimeout(M),M=setTimeout(we,Ge)},$=async we=>{if(!d.disabled&&(z.isValid||V.isValid||we)){const Ge=d.resolver?Ci((await Ae()).errors):await Ie(g,!0);Ge!==f.isValid&&U.state.next({isValid:Ge})}},K=(we,Ge)=>{!d.disabled&&(z.isValidating||z.validatingFields||V.isValidating||V.validatingFields)&&((we||Array.from(A.mount)).forEach(et=>{et&&(Ge?Ks(f.validatingFields,et,Ge):Or(f.validatingFields,et))}),U.state.next({validatingFields:f.validatingFields,isValidating:!Ci(f.validatingFields)}))},ue=(we,Ge=[],et,kt,Nt=!0,De=!0)=>{if(kt&&et&&!d.disabled){if(T.action=!0,De&&Array.isArray(Bt(g,we))){const xt=et(Bt(g,we),kt.argA,kt.argB);Nt&&Ks(g,we,xt)}if(De&&Array.isArray(Bt(f.errors,we))){const xt=et(Bt(f.errors,we),kt.argA,kt.argB);Nt&&Ks(f.errors,we,xt),FS(f.errors,we)}if((z.touchedFields||V.touchedFields)&&De&&Array.isArray(Bt(f.touchedFields,we))){const xt=et(Bt(f.touchedFields,we),kt.argA,kt.argB);Nt&&Ks(f.touchedFields,we,xt)}(z.dirtyFields||V.dirtyFields)&&(f.dirtyFields=Vu(w,N)),U.state.next({name:we,isDirty:tt(we,Ge),dirtyFields:f.dirtyFields,errors:f.errors,isValid:f.isValid})}else Ks(N,we,Ge)},re=(we,Ge)=>{Ks(f.errors,we,Ge),U.state.next({errors:f.errors})},te=we=>{f.errors=we,U.state.next({errors:f.errors,isValid:!1})},je=(we,Ge,et,kt)=>{const Nt=Bt(g,we);if(Nt){const De=Bt(N,we,Ar(et)?Bt(w,we):et);Ar(De)||kt&&kt.defaultChecked||Ge?Ks(N,we,Ge?De:e0(Nt._f)):rt(we,De),T.mount&&$()}},me=(we,Ge,et,kt,Nt)=>{let De=!1,xt=!1;const Jt={name:we};if(!d.disabled){if(!et||kt){(z.isDirty||V.isDirty)&&(xt=f.isDirty,f.isDirty=Jt.isDirty=tt(),De=xt!==Jt.isDirty);const qt=Qa(Bt(w,we),Ge);xt=!!Bt(f.dirtyFields,we),qt?Or(f.dirtyFields,we):Ks(f.dirtyFields,we,!0),Jt.dirtyFields=f.dirtyFields,De=De||(z.dirtyFields||V.dirtyFields)&&xt!==!qt}if(et){const qt=Bt(f.touchedFields,we);qt||(Ks(f.touchedFields,we,et),Jt.touchedFields=f.touchedFields,De=De||(z.touchedFields||V.touchedFields)&&qt!==et)}De&&Nt&&U.state.next(Jt)}return De?Jt:{}},Ce=(we,Ge,et,kt)=>{const Nt=Bt(f.errors,we),De=(z.isValid||V.isValid)&&Un(Ge)&&f.isValid!==Ge;if(d.delayError&&et?(n=W(()=>re(we,et)),n(d.delayError)):(clearTimeout(M),n=null,et?Ks(f.errors,we,et):Or(f.errors,we)),(et?!Qa(Nt,et):Nt)||!Ci(kt)||De){const xt={...kt,...De&&Un(Ge)?{isValid:Ge}:{},errors:f.errors,name:we};f={...f,...xt},U.state.next(xt)}},Ae=async we=>{K(we,!0);const Ge=await d.resolver(N,d.context,IS(we||A.mount,g,d.criteriaMode,d.shouldUseNativeValidation));return K(we),Ge},fe=async we=>{const{errors:Ge}=await Ae(we);if(we)for(const et of we){const kt=Bt(Ge,et);kt?Ks(f.errors,et,kt):Or(f.errors,et)}else f.errors=Ge;return Ge},Ie=async(we,Ge,et={valid:!0})=>{for(const kt in we){const Nt=we[kt];if(Nt){const{_f:De,...xt}=Nt;if(De){const Jt=A.array.has(De.name),qt=Nt._f&&DS(Nt._f);qt&&z.validatingFields&&K([kt],!0);const bs=await a0(Nt,A.disabled,N,G,d.shouldUseNativeValidation&&!Ge,Jt);if(qt&&z.validatingFields&&K([kt]),bs[De.name]&&(et.valid=!1,Ge))break;!Ge&&(Bt(bs,De.name)?Jt?BS(f.errors,bs,De.name):Ks(f.errors,De.name,bs[De.name]):Or(f.errors,De.name))}!Ci(xt)&&await Ie(xt,Ge,et)}}return et.valid},Ee=()=>{for(const we of A.unMount){const Ge=Bt(g,we);Ge&&(Ge._f.refs?Ge._f.refs.every(et=>!tf(et)):!tf(Ge._f.ref))&&jr(we)}A.unMount=new Set},tt=(we,Ge)=>!d.disabled&&(we&&Ge&&Ks(N,we,Ge),!Qa(Os(),w)),Pe=(we,Ge,et)=>CS(we,A,{...T.mount?N:Ar(Ge)?w:qn(we)?{[we]:Ge}:Ge},et,Ge),Te=we=>lm(Bt(T.mount?N:w,we,d.shouldUnregister?Bt(w,we,[]):[])),rt=(we,Ge,et={})=>{const kt=Bt(g,we);let Nt=Ge;if(kt){const De=kt._f;De&&(!De.disabled&&Ks(N,we,L_(Ge,De)),Nt=Zh(De.ref)&&pi(Ge)?"":Ge,M_(De.ref)?[...De.ref.options].forEach(xt=>xt.selected=Nt.includes(xt.value)):De.refs?td(De.ref)?De.refs.forEach(xt=>{(!xt.defaultChecked||!xt.disabled)&&(Array.isArray(Nt)?xt.checked=!!Nt.find(Jt=>Jt===xt.value):xt.checked=Nt===xt.value||!!Nt)}):De.refs.forEach(xt=>xt.checked=xt.value===Nt):Wf(De.ref)?De.ref.value="":(De.ref.value=Nt,De.ref.type||U.state.next({name:we,values:oi(N)})))}(et.shouldDirty||et.shouldTouch)&&me(we,Nt,et.shouldTouch,et.shouldDirty,!0),et.shouldValidate&&wt(we)},gt=(we,Ge,et)=>{for(const kt in Ge){if(!Ge.hasOwnProperty(kt))return;const Nt=Ge[kt],De=we+"."+kt,xt=Bt(g,De);(A.array.has(we)||vr(Nt)||xt&&!xt._f)&&!Zo(Nt)?gt(De,Nt,et):rt(De,Nt,et)}},yt=(we,Ge,et={})=>{const kt=Bt(g,we),Nt=A.array.has(we),De=oi(Ge);Ks(N,we,De),Nt?(U.array.next({name:we,values:oi(N)}),(z.isDirty||z.dirtyFields||V.isDirty||V.dirtyFields)&&et.shouldDirty&&U.state.next({name:we,dirtyFields:Vu(w,N),isDirty:tt(we,De)})):kt&&!kt._f&&!pi(De)?gt(we,De,et):rt(we,De,et),r0(we,A)&&U.state.next({...f}),U.state.next({name:T.mount?we:void 0,values:oi(N)})},pt=async we=>{T.mount=!0;const Ge=we.target;let et=Ge.name,kt=!0;const Nt=Bt(g,et),De=qt=>{kt=Number.isNaN(qt)||Zo(qt)&&isNaN(qt.getTime())||Qa(qt,Bt(N,et,qt))},xt=t0(d.mode),Jt=t0(d.reValidateMode);if(Nt){let qt,bs;const sr=Ge.type?e0(Nt._f):wS(we),Ls=we.type===Xy.BLUR||we.type===Xy.FOCUS_OUT,xi=!LS(Nt._f)&&!d.resolver&&!Bt(f.errors,et)&&!Nt._f.deps||OS(Ls,Bt(f.touchedFields,et),f.isSubmitted,Jt,xt),Wr=r0(et,A,Ls);Ks(N,et,sr),Ls?(Nt._f.onBlur&&Nt._f.onBlur(we),n&&n(0)):Nt._f.onChange&&Nt._f.onChange(we);const Dr=me(et,sr,Ls),yi=!Ci(Dr)||Wr;if(!Ls&&U.state.next({name:et,type:we.type,values:oi(N)}),xi)return(z.isValid||V.isValid)&&(d.mode==="onBlur"?Ls&&$():Ls||$()),yi&&U.state.next({name:et,...Wr?{}:Dr});if(!Ls&&Wr&&U.state.next({...f}),d.resolver){const{errors:Oi}=await Ae([et]);if(De(sr),kt){const en=i0(f.errors,g,et),tn=i0(Oi,g,en.name||et);qt=tn.error,et=tn.name,bs=Ci(Oi)}}else K([et],!0),qt=(await a0(Nt,A.disabled,N,G,d.shouldUseNativeValidation))[et],K([et]),De(sr),kt&&(qt?bs=!1:(z.isValid||V.isValid)&&(bs=await Ie(g,!0)));kt&&(Nt._f.deps&&wt(Nt._f.deps),Ce(et,bs,qt,Dr))}},ft=(we,Ge)=>{if(Bt(f.errors,Ge)&&we.focus)return we.focus(),1},wt=async(we,Ge={})=>{let et,kt;const Nt=Hu(we);if(d.resolver){const De=await fe(Ar(we)?we:Nt);et=Ci(De),kt=we?!Nt.some(xt=>Bt(De,xt)):et}else we?(kt=(await Promise.all(Nt.map(async De=>{const xt=Bt(g,De);return await Ie(xt&&xt._f?{[De]:xt}:xt)}))).every(Boolean),!(!kt&&!f.isValid)&&$()):kt=et=await Ie(g);return U.state.next({...!qn(we)||(z.isValid||V.isValid)&&et!==f.isValid?{}:{name:we},...d.resolver||!we?{isValid:et}:{},errors:f.errors}),Ge.shouldFocus&&!kt&&Xu(g,ft,we?Nt:A.mount),kt},Os=we=>{const Ge={...T.mount?N:w};return Ar(we)?Ge:qn(we)?Bt(Ge,we):we.map(et=>Bt(Ge,et))},ns=(we,Ge)=>({invalid:!!Bt((Ge||f).errors,we),isDirty:!!Bt((Ge||f).dirtyFields,we),error:Bt((Ge||f).errors,we),isValidating:!!Bt(f.validatingFields,we),isTouched:!!Bt((Ge||f).touchedFields,we)}),_s=we=>{we&&Hu(we).forEach(Ge=>Or(f.errors,Ge)),U.state.next({errors:we?f.errors:{}})},mr=(we,Ge,et)=>{const kt=(Bt(g,we,{_f:{}})._f||{}).ref,Nt=Bt(f.errors,we)||{},{ref:De,message:xt,type:Jt,...qt}=Nt;Ks(f.errors,we,{...qt,...Ge,ref:kt}),U.state.next({name:we,errors:f.errors,isValid:!1}),et&&et.shouldFocus&&kt&&kt.focus&&kt.focus()},Ut=(we,Ge)=>Nn(we)?U.state.subscribe({next:et=>we(Pe(void 0,Ge),et)}):Pe(we,Ge,!0),pr=we=>U.state.subscribe({next:Ge=>{zS(we.name,Ge.name,we.exact)&&RS(Ge,we.formState||z,Ir,we.reRenderRoot)&&we.callback({values:{...N},...f,...Ge})}}).unsubscribe,Fr=we=>(T.mount=!0,V={...V,...we.formState},pr({...we,formState:V})),jr=(we,Ge={})=>{for(const et of we?Hu(we):A.mount)A.mount.delete(et),A.array.delete(et),Ge.keepValue||(Or(g,et),Or(N,et)),!Ge.keepError&&Or(f.errors,et),!Ge.keepDirty&&Or(f.dirtyFields,et),!Ge.keepTouched&&Or(f.touchedFields,et),!Ge.keepIsValidating&&Or(f.validatingFields,et),!d.shouldUnregister&&!Ge.keepDefaultValue&&Or(w,et);U.state.next({values:oi(N)}),U.state.next({...f,...Ge.keepDirty?{isDirty:tt()}:{}}),!Ge.keepIsValid&&$()},fr=({disabled:we,name:Ge})=>{(Un(we)&&T.mount||we||A.disabled.has(Ge))&&(we?A.disabled.add(Ge):A.disabled.delete(Ge))},Br=(we,Ge={})=>{let et=Bt(g,we);const kt=Un(Ge.disabled)||Un(d.disabled);return Ks(g,we,{...et||{},_f:{...et&&et._f?et._f:{ref:{name:we}},name:we,mount:!0,...Ge}}),A.mount.add(we),et?fr({disabled:Un(Ge.disabled)?Ge.disabled:d.disabled,name:we}):je(we,!0,Ge.value),{...kt?{disabled:Ge.disabled||d.disabled}:{},...d.progressive?{required:!!Ge.required,min:qu(Ge.min),max:qu(Ge.max),minLength:qu(Ge.minLength),maxLength:qu(Ge.maxLength),pattern:qu(Ge.pattern)}:{},name:we,onChange:pt,onBlur:pt,ref:Nt=>{if(Nt){Br(we,Ge),et=Bt(g,we);const De=Ar(Nt.value)&&Nt.querySelectorAll&&Nt.querySelectorAll("input,select,textarea")[0]||Nt,xt=AS(De),Jt=et._f.refs||[];if(xt?Jt.find(qt=>qt===De):De===et._f.ref)return;Ks(g,we,{_f:{...et._f,...xt?{refs:[...Jt.filter(tf),De,...Array.isArray(Bt(w,we))?[{}]:[]],ref:{type:De.type,name:we}}:{ref:De}}}),je(we,!1,void 0,De)}else et=Bt(g,we,{}),et._f&&(et._f.mount=!1),(d.shouldUnregister||Ge.shouldUnregister)&&!(NS(A.array,we)&&T.action)&&A.unMount.add(we)}}},_r=()=>d.shouldFocusError&&Xu(g,ft,A.mount),Jr=we=>{Un(we)&&(U.state.next({disabled:we}),Xu(g,(Ge,et)=>{const kt=Bt(g,et);kt&&(Ge.disabled=kt._f.disabled||we,Array.isArray(kt._f.refs)&&kt._f.refs.forEach(Nt=>{Nt.disabled=kt._f.disabled||we}))},0,!1))},Qt=(we,Ge)=>async et=>{let kt;et&&(et.preventDefault&&et.preventDefault(),et.persist&&et.persist());let Nt=oi(N);if(U.state.next({isSubmitting:!0}),d.resolver){const{errors:De,values:xt}=await Ae();f.errors=De,Nt=xt}else await Ie(g);if(A.disabled.size)for(const De of A.disabled)Ks(Nt,De,void 0);if(Or(f.errors,"root"),Ci(f.errors)){U.state.next({errors:{}});try{await we(Nt,et)}catch(De){kt=De}}else Ge&&await Ge({...f.errors},et),_r(),setTimeout(_r);if(U.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ci(f.errors)&&!kt,submitCount:f.submitCount+1,errors:f.errors}),kt)throw kt},gi=(we,Ge={})=>{Bt(g,we)&&(Ar(Ge.defaultValue)?yt(we,oi(Bt(w,we))):(yt(we,Ge.defaultValue),Ks(w,we,oi(Ge.defaultValue))),Ge.keepTouched||Or(f.touchedFields,we),Ge.keepDirty||(Or(f.dirtyFields,we),f.isDirty=Ge.defaultValue?tt(we,oi(Bt(w,we))):tt()),Ge.keepError||(Or(f.errors,we),z.isValid&&$()),U.state.next({...f}))},br=(we,Ge={})=>{const et=we?oi(we):w,kt=oi(et),Nt=Ci(we),De=Nt?w:kt;if(Ge.keepDefaultValues||(w=et),!Ge.keepValues){if(Ge.keepDirtyValues){const xt=new Set([...A.mount,...Object.keys(Vu(w,N))]);for(const Jt of Array.from(xt))Bt(f.dirtyFields,Jt)?Ks(De,Jt,Bt(N,Jt)):yt(Jt,Bt(De,Jt))}else{if(Gf&&Ar(we))for(const xt of A.mount){const Jt=Bt(g,xt);if(Jt&&Jt._f){const qt=Array.isArray(Jt._f.refs)?Jt._f.refs[0]:Jt._f.ref;if(Zh(qt)){const bs=qt.closest("form");if(bs){bs.reset();break}}}}for(const xt of A.mount)yt(xt,Bt(De,xt))}N=oi(De),U.array.next({values:{...De}}),U.state.next({values:{...De}})}A={mount:Ge.keepDirtyValues?A.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},T.mount=!z.isValid||!!Ge.keepIsValid||!!Ge.keepDirtyValues,T.watch=!!d.shouldUnregister,U.state.next({submitCount:Ge.keepSubmitCount?f.submitCount:0,isDirty:Nt?!1:Ge.keepDirty?f.isDirty:!!(Ge.keepDefaultValues&&!Qa(we,w)),isSubmitted:Ge.keepIsSubmitted?f.isSubmitted:!1,dirtyFields:Nt?{}:Ge.keepDirtyValues?Ge.keepDefaultValues&&N?Vu(w,N):f.dirtyFields:Ge.keepDefaultValues&&we?Vu(w,we):Ge.keepDirty?f.dirtyFields:{},touchedFields:Ge.keepTouched?f.touchedFields:{},errors:Ge.keepErrors?f.errors:{},isSubmitSuccessful:Ge.keepIsSubmitSuccessful?f.isSubmitSuccessful:!1,isSubmitting:!1})},Mi=(we,Ge)=>br(Nn(we)?we(N):we,Ge),As=(we,Ge={})=>{const et=Bt(g,we),kt=et&&et._f;if(kt){const Nt=kt.refs?kt.refs[0]:kt.ref;Nt.focus&&(Nt.focus(),Ge.shouldSelect&&Nn(Nt.select)&&Nt.select())}},Ir=we=>{f={...f,...we}},Zr={control:{register:Br,unregister:jr,getFieldState:ns,handleSubmit:Qt,setError:mr,_subscribe:pr,_runSchema:Ae,_focusError:_r,_getWatch:Pe,_getDirty:tt,_setValid:$,_setFieldArray:ue,_setDisabledField:fr,_setErrors:te,_getFieldArray:Te,_reset:br,_resetDefaultValues:()=>Nn(d.defaultValues)&&d.defaultValues().then(we=>{Mi(we,d.resetOptions),U.state.next({isLoading:!1})}),_removeUnmounted:Ee,_disableForm:Jr,_subjects:U,_proxyFormState:z,get _fields(){return g},get _formValues(){return N},get _state(){return T},set _state(we){T=we},get _defaultValues(){return w},get _names(){return A},set _names(we){A=we},get _formState(){return f},get _options(){return d},set _options(we){d={...d,...we}}},subscribe:Fr,trigger:wt,register:Br,handleSubmit:Qt,watch:Ut,setValue:yt,getValues:Os,reset:Mi,resetField:gi,clearErrors:_s,unregister:jr,setError:mr,setFocus:As,getFieldState:ns};return{...Zr,formControl:Zr}}function En(c={}){const d=mi.useRef(void 0),f=mi.useRef(void 0),[g,w]=mi.useState({isDirty:!1,isValidating:!1,isLoading:Nn(c.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:c.errors||{},disabled:c.disabled||!1,isReady:!1,defaultValues:Nn(c.defaultValues)?void 0:c.defaultValues});d.current||(d.current={...c.formControl?c.formControl:VS(c),formState:g},c.formControl&&c.defaultValues&&!Nn(c.defaultValues)&&c.formControl.reset(c.defaultValues,c.resetOptions));const N=d.current.control;return N._options=c,ES(()=>{const T=N._subscribe({formState:N._proxyFormState,callback:()=>w({...N._formState}),reRenderRoot:!0});return w(A=>({...A,isReady:!0})),N._formState.isReady=!0,T},[N]),mi.useEffect(()=>N._disableForm(c.disabled),[N,c.disabled]),mi.useEffect(()=>{c.mode&&(N._options.mode=c.mode),c.reValidateMode&&(N._options.reValidateMode=c.reValidateMode)},[N,c.mode,c.reValidateMode]),mi.useEffect(()=>{c.errors&&(N._setErrors(c.errors),N._focusError())},[N,c.errors]),mi.useEffect(()=>{c.shouldUnregister&&N._subjects.state.next({values:N._getWatch()})},[N,c.shouldUnregister]),mi.useEffect(()=>{if(N._proxyFormState.isDirty){const T=N._getDirty();T!==g.isDirty&&N._subjects.state.next({isDirty:T})}},[N,g.isDirty]),mi.useEffect(()=>{c.values&&!Qa(c.values,f.current)?(N._reset(c.values,N._options.resetOptions),f.current=c.values,w(T=>({...T}))):N._resetDefaultValues()},[N,c.values]),mi.useEffect(()=>{N._state.mount||(N._setValid(),N._state.mount=!0),N._state.watch&&(N._state.watch=!1,N._subjects.state.next({...N._formState})),N._removeUnmounted()}),d.current.formState=TS(g,N),d.current}function z_(c,d){return function(){return c.apply(d,arguments)}}const{toString:qS}=Object.prototype,{getPrototypeOf:Xf}=Object,{iterator:cm,toStringTag:O_}=Symbol,um=(c=>d=>{const f=qS.call(d);return c[f]||(c[f]=f.slice(8,-1).toLowerCase())})(Object.create(null)),Cn=c=>(c=c.toLowerCase(),d=>um(d)===c),dm=c=>d=>typeof d===c,{isArray:oc}=Array,Ju=dm("undefined");function $S(c){return c!==null&&!Ju(c)&&c.constructor!==null&&!Ju(c.constructor)&&ki(c.constructor.isBuffer)&&c.constructor.isBuffer(c)}const F_=Cn("ArrayBuffer");function GS(c){let d;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?d=ArrayBuffer.isView(c):d=c&&c.buffer&&F_(c.buffer),d}const ZS=dm("string"),ki=dm("function"),B_=dm("number"),hm=c=>c!==null&&typeof c=="object",WS=c=>c===!0||c===!1,Lh=c=>{if(um(c)!=="object")return!1;const d=Xf(c);return(d===null||d===Object.prototype||Object.getPrototypeOf(d)===null)&&!(O_ in c)&&!(cm in c)},HS=Cn("Date"),XS=Cn("File"),KS=Cn("Blob"),QS=Cn("FileList"),JS=c=>hm(c)&&ki(c.pipe),YS=c=>{let d;return c&&(typeof FormData=="function"&&c instanceof FormData||ki(c.append)&&((d=um(c))==="formdata"||d==="object"&&ki(c.toString)&&c.toString()==="[object FormData]"))},eT=Cn("URLSearchParams"),[tT,sT,rT,iT]=["ReadableStream","Request","Response","Headers"].map(Cn),nT=c=>c.trim?c.trim():c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function sd(c,d,{allOwnKeys:f=!1}={}){if(c===null||typeof c>"u")return;let g,w;if(typeof c!="object"&&(c=[c]),oc(c))for(g=0,w=c.length;g<w;g++)d.call(null,c[g],g,c);else{const N=f?Object.getOwnPropertyNames(c):Object.keys(c),T=N.length;let A;for(g=0;g<T;g++)A=N[g],d.call(null,c[A],A,c)}}function U_(c,d){d=d.toLowerCase();const f=Object.keys(c);let g=f.length,w;for(;g-- >0;)if(w=f[g],d===w.toLowerCase())return w;return null}const Wo=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,V_=c=>!Ju(c)&&c!==Wo;function Tf(){const{caseless:c}=V_(this)&&this||{},d={},f=(g,w)=>{const N=c&&U_(d,w)||w;Lh(d[N])&&Lh(g)?d[N]=Tf(d[N],g):Lh(g)?d[N]=Tf({},g):oc(g)?d[N]=g.slice():d[N]=g};for(let g=0,w=arguments.length;g<w;g++)arguments[g]&&sd(arguments[g],f);return d}const aT=(c,d,f,{allOwnKeys:g}={})=>(sd(d,(w,N)=>{f&&ki(w)?c[N]=z_(w,f):c[N]=w},{allOwnKeys:g}),c),oT=c=>(c.charCodeAt(0)===65279&&(c=c.slice(1)),c),lT=(c,d,f,g)=>{c.prototype=Object.create(d.prototype,g),c.prototype.constructor=c,Object.defineProperty(c,"super",{value:d.prototype}),f&&Object.assign(c.prototype,f)},cT=(c,d,f,g)=>{let w,N,T;const A={};if(d=d||{},c==null)return d;do{for(w=Object.getOwnPropertyNames(c),N=w.length;N-- >0;)T=w[N],(!g||g(T,c,d))&&!A[T]&&(d[T]=c[T],A[T]=!0);c=f!==!1&&Xf(c)}while(c&&(!f||f(c,d))&&c!==Object.prototype);return d},uT=(c,d,f)=>{c=String(c),(f===void 0||f>c.length)&&(f=c.length),f-=d.length;const g=c.indexOf(d,f);return g!==-1&&g===f},dT=c=>{if(!c)return null;if(oc(c))return c;let d=c.length;if(!B_(d))return null;const f=new Array(d);for(;d-- >0;)f[d]=c[d];return f},hT=(c=>d=>c&&d instanceof c)(typeof Uint8Array<"u"&&Xf(Uint8Array)),mT=(c,d)=>{const g=(c&&c[cm]).call(c);let w;for(;(w=g.next())&&!w.done;){const N=w.value;d.call(c,N[0],N[1])}},pT=(c,d)=>{let f;const g=[];for(;(f=c.exec(d))!==null;)g.push(f);return g},fT=Cn("HTMLFormElement"),gT=c=>c.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(f,g,w){return g.toUpperCase()+w}),o0=(({hasOwnProperty:c})=>(d,f)=>c.call(d,f))(Object.prototype),xT=Cn("RegExp"),q_=(c,d)=>{const f=Object.getOwnPropertyDescriptors(c),g={};sd(f,(w,N)=>{let T;(T=d(w,N,c))!==!1&&(g[N]=T||w)}),Object.defineProperties(c,g)},yT=c=>{q_(c,(d,f)=>{if(ki(c)&&["arguments","caller","callee"].indexOf(f)!==-1)return!1;const g=c[f];if(ki(g)){if(d.enumerable=!1,"writable"in d){d.writable=!1;return}d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+f+"'")})}})},_T=(c,d)=>{const f={},g=w=>{w.forEach(N=>{f[N]=!0})};return oc(c)?g(c):g(String(c).split(d)),f},bT=()=>{},vT=(c,d)=>c!=null&&Number.isFinite(c=+c)?c:d;function wT(c){return!!(c&&ki(c.append)&&c[O_]==="FormData"&&c[cm])}const jT=c=>{const d=new Array(10),f=(g,w)=>{if(hm(g)){if(d.indexOf(g)>=0)return;if(!("toJSON"in g)){d[w]=g;const N=oc(g)?[]:{};return sd(g,(T,A)=>{const n=f(T,w+1);!Ju(n)&&(N[A]=n)}),d[w]=void 0,N}}return g};return f(c,0)},NT=Cn("AsyncFunction"),ST=c=>c&&(hm(c)||ki(c))&&ki(c.then)&&ki(c.catch),$_=((c,d)=>c?setImmediate:d?((f,g)=>(Wo.addEventListener("message",({source:w,data:N})=>{w===Wo&&N===f&&g.length&&g.shift()()},!1),w=>{g.push(w),Wo.postMessage(f,"*")}))(`axios@${Math.random()}`,[]):f=>setTimeout(f))(typeof setImmediate=="function",ki(Wo.postMessage)),TT=typeof queueMicrotask<"u"?queueMicrotask.bind(Wo):typeof process<"u"&&process.nextTick||$_,ET=c=>c!=null&&ki(c[cm]),Ke={isArray:oc,isArrayBuffer:F_,isBuffer:$S,isFormData:YS,isArrayBufferView:GS,isString:ZS,isNumber:B_,isBoolean:WS,isObject:hm,isPlainObject:Lh,isReadableStream:tT,isRequest:sT,isResponse:rT,isHeaders:iT,isUndefined:Ju,isDate:HS,isFile:XS,isBlob:KS,isRegExp:xT,isFunction:ki,isStream:JS,isURLSearchParams:eT,isTypedArray:hT,isFileList:QS,forEach:sd,merge:Tf,extend:aT,trim:nT,stripBOM:oT,inherits:lT,toFlatObject:cT,kindOf:um,kindOfTest:Cn,endsWith:uT,toArray:dT,forEachEntry:mT,matchAll:pT,isHTMLForm:fT,hasOwnProperty:o0,hasOwnProp:o0,reduceDescriptors:q_,freezeMethods:yT,toObjectSet:_T,toCamelCase:gT,noop:bT,toFiniteNumber:vT,findKey:U_,global:Wo,isContextDefined:V_,isSpecCompliantForm:wT,toJSONObject:jT,isAsyncFn:NT,isThenable:ST,setImmediate:$_,asap:TT,isIterable:ET};function cs(c,d,f,g,w){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=c,this.name="AxiosError",d&&(this.code=d),f&&(this.config=f),g&&(this.request=g),w&&(this.response=w,this.status=w.status?w.status:null)}Ke.inherits(cs,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ke.toJSONObject(this.config),code:this.code,status:this.status}}});const G_=cs.prototype,Z_={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(c=>{Z_[c]={value:c}});Object.defineProperties(cs,Z_);Object.defineProperty(G_,"isAxiosError",{value:!0});cs.from=(c,d,f,g,w,N)=>{const T=Object.create(G_);return Ke.toFlatObject(c,T,function(n){return n!==Error.prototype},A=>A!=="isAxiosError"),cs.call(T,c.message,d,f,g,w),T.cause=c,T.name=c.name,N&&Object.assign(T,N),T};const CT=null;function Ef(c){return Ke.isPlainObject(c)||Ke.isArray(c)}function W_(c){return Ke.endsWith(c,"[]")?c.slice(0,-2):c}function l0(c,d,f){return c?c.concat(d).map(function(w,N){return w=W_(w),!f&&N?"["+w+"]":w}).join(f?".":""):d}function kT(c){return Ke.isArray(c)&&!c.some(Ef)}const AT=Ke.toFlatObject(Ke,{},null,function(d){return/^is[A-Z]/.test(d)});function mm(c,d,f){if(!Ke.isObject(c))throw new TypeError("target must be an object");d=d||new FormData,f=Ke.toFlatObject(f,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,K){return!Ke.isUndefined(K[$])});const g=f.metaTokens,w=f.visitor||z,N=f.dots,T=f.indexes,n=(f.Blob||typeof Blob<"u"&&Blob)&&Ke.isSpecCompliantForm(d);if(!Ke.isFunction(w))throw new TypeError("visitor must be a function");function M(W){if(W===null)return"";if(Ke.isDate(W))return W.toISOString();if(Ke.isBoolean(W))return W.toString();if(!n&&Ke.isBlob(W))throw new cs("Blob is not supported. Use a Buffer instead.");return Ke.isArrayBuffer(W)||Ke.isTypedArray(W)?n&&typeof Blob=="function"?new Blob([W]):Buffer.from(W):W}function z(W,$,K){let ue=W;if(W&&!K&&typeof W=="object"){if(Ke.endsWith($,"{}"))$=g?$:$.slice(0,-2),W=JSON.stringify(W);else if(Ke.isArray(W)&&kT(W)||(Ke.isFileList(W)||Ke.endsWith($,"[]"))&&(ue=Ke.toArray(W)))return $=W_($),ue.forEach(function(te,je){!(Ke.isUndefined(te)||te===null)&&d.append(T===!0?l0([$],je,N):T===null?$:$+"[]",M(te))}),!1}return Ef(W)?!0:(d.append(l0(K,$,N),M(W)),!1)}const V=[],U=Object.assign(AT,{defaultVisitor:z,convertValue:M,isVisitable:Ef});function G(W,$){if(!Ke.isUndefined(W)){if(V.indexOf(W)!==-1)throw Error("Circular reference detected in "+$.join("."));V.push(W),Ke.forEach(W,function(ue,re){(!(Ke.isUndefined(ue)||ue===null)&&w.call(d,ue,Ke.isString(re)?re.trim():re,$,U))===!0&&G(ue,$?$.concat(re):[re])}),V.pop()}}if(!Ke.isObject(c))throw new TypeError("data must be an object");return G(c),d}function c0(c){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(c).replace(/[!'()~]|%20|%00/g,function(g){return d[g]})}function Kf(c,d){this._pairs=[],c&&mm(c,this,d)}const H_=Kf.prototype;H_.append=function(d,f){this._pairs.push([d,f])};H_.toString=function(d){const f=d?function(g){return d.call(this,g,c0)}:c0;return this._pairs.map(function(w){return f(w[0])+"="+f(w[1])},"").join("&")};function MT(c){return encodeURIComponent(c).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function X_(c,d,f){if(!d)return c;const g=f&&f.encode||MT;Ke.isFunction(f)&&(f={serialize:f});const w=f&&f.serialize;let N;if(w?N=w(d,f):N=Ke.isURLSearchParams(d)?d.toString():new Kf(d,f).toString(g),N){const T=c.indexOf("#");T!==-1&&(c=c.slice(0,T)),c+=(c.indexOf("?")===-1?"?":"&")+N}return c}class u0{constructor(){this.handlers=[]}use(d,f,g){return this.handlers.push({fulfilled:d,rejected:f,synchronous:g?g.synchronous:!1,runWhen:g?g.runWhen:null}),this.handlers.length-1}eject(d){this.handlers[d]&&(this.handlers[d]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(d){Ke.forEach(this.handlers,function(g){g!==null&&d(g)})}}const K_={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},PT=typeof URLSearchParams<"u"?URLSearchParams:Kf,IT=typeof FormData<"u"?FormData:null,DT=typeof Blob<"u"?Blob:null,LT={isBrowser:!0,classes:{URLSearchParams:PT,FormData:IT,Blob:DT},protocols:["http","https","file","blob","url","data"]},Qf=typeof window<"u"&&typeof document<"u",Cf=typeof navigator=="object"&&navigator||void 0,RT=Qf&&(!Cf||["ReactNative","NativeScript","NS"].indexOf(Cf.product)<0),zT=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",OT=Qf&&window.location.href||"http://localhost",FT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Qf,hasStandardBrowserEnv:RT,hasStandardBrowserWebWorkerEnv:zT,navigator:Cf,origin:OT},Symbol.toStringTag,{value:"Module"})),li={...FT,...LT};function BT(c,d){return mm(c,new li.classes.URLSearchParams,Object.assign({visitor:function(f,g,w,N){return li.isNode&&Ke.isBuffer(f)?(this.append(g,f.toString("base64")),!1):N.defaultVisitor.apply(this,arguments)}},d))}function UT(c){return Ke.matchAll(/\w+|\[(\w*)]/g,c).map(d=>d[0]==="[]"?"":d[1]||d[0])}function VT(c){const d={},f=Object.keys(c);let g;const w=f.length;let N;for(g=0;g<w;g++)N=f[g],d[N]=c[N];return d}function Q_(c){function d(f,g,w,N){let T=f[N++];if(T==="__proto__")return!0;const A=Number.isFinite(+T),n=N>=f.length;return T=!T&&Ke.isArray(w)?w.length:T,n?(Ke.hasOwnProp(w,T)?w[T]=[w[T],g]:w[T]=g,!A):((!w[T]||!Ke.isObject(w[T]))&&(w[T]=[]),d(f,g,w[T],N)&&Ke.isArray(w[T])&&(w[T]=VT(w[T])),!A)}if(Ke.isFormData(c)&&Ke.isFunction(c.entries)){const f={};return Ke.forEachEntry(c,(g,w)=>{d(UT(g),w,f,0)}),f}return null}function qT(c,d,f){if(Ke.isString(c))try{return(d||JSON.parse)(c),Ke.trim(c)}catch(g){if(g.name!=="SyntaxError")throw g}return(0,JSON.stringify)(c)}const rd={transitional:K_,adapter:["xhr","http","fetch"],transformRequest:[function(d,f){const g=f.getContentType()||"",w=g.indexOf("application/json")>-1,N=Ke.isObject(d);if(N&&Ke.isHTMLForm(d)&&(d=new FormData(d)),Ke.isFormData(d))return w?JSON.stringify(Q_(d)):d;if(Ke.isArrayBuffer(d)||Ke.isBuffer(d)||Ke.isStream(d)||Ke.isFile(d)||Ke.isBlob(d)||Ke.isReadableStream(d))return d;if(Ke.isArrayBufferView(d))return d.buffer;if(Ke.isURLSearchParams(d))return f.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),d.toString();let A;if(N){if(g.indexOf("application/x-www-form-urlencoded")>-1)return BT(d,this.formSerializer).toString();if((A=Ke.isFileList(d))||g.indexOf("multipart/form-data")>-1){const n=this.env&&this.env.FormData;return mm(A?{"files[]":d}:d,n&&new n,this.formSerializer)}}return N||w?(f.setContentType("application/json",!1),qT(d)):d}],transformResponse:[function(d){const f=this.transitional||rd.transitional,g=f&&f.forcedJSONParsing,w=this.responseType==="json";if(Ke.isResponse(d)||Ke.isReadableStream(d))return d;if(d&&Ke.isString(d)&&(g&&!this.responseType||w)){const T=!(f&&f.silentJSONParsing)&&w;try{return JSON.parse(d)}catch(A){if(T)throw A.name==="SyntaxError"?cs.from(A,cs.ERR_BAD_RESPONSE,this,null,this.response):A}}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:li.classes.FormData,Blob:li.classes.Blob},validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ke.forEach(["delete","get","head","post","put","patch"],c=>{rd.headers[c]={}});const $T=Ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),GT=c=>{const d={};let f,g,w;return c&&c.split(`
`).forEach(function(T){w=T.indexOf(":"),f=T.substring(0,w).trim().toLowerCase(),g=T.substring(w+1).trim(),!(!f||d[f]&&$T[f])&&(f==="set-cookie"?d[f]?d[f].push(g):d[f]=[g]:d[f]=d[f]?d[f]+", "+g:g)}),d},d0=Symbol("internals");function $u(c){return c&&String(c).trim().toLowerCase()}function Rh(c){return c===!1||c==null?c:Ke.isArray(c)?c.map(Rh):String(c)}function ZT(c){const d=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=f.exec(c);)d[g[1]]=g[2];return d}const WT=c=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(c.trim());function sf(c,d,f,g,w){if(Ke.isFunction(g))return g.call(this,d,f);if(w&&(d=f),!!Ke.isString(d)){if(Ke.isString(g))return d.indexOf(g)!==-1;if(Ke.isRegExp(g))return g.test(d)}}function HT(c){return c.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(d,f,g)=>f.toUpperCase()+g)}function XT(c,d){const f=Ke.toCamelCase(" "+d);["get","set","has"].forEach(g=>{Object.defineProperty(c,g+f,{value:function(w,N,T){return this[g].call(this,d,w,N,T)},configurable:!0})})}class Ai{constructor(d){d&&this.set(d)}set(d,f,g){const w=this;function N(A,n,M){const z=$u(n);if(!z)throw new Error("header name must be a non-empty string");const V=Ke.findKey(w,z);(!V||w[V]===void 0||M===!0||M===void 0&&w[V]!==!1)&&(w[V||n]=Rh(A))}const T=(A,n)=>Ke.forEach(A,(M,z)=>N(M,z,n));if(Ke.isPlainObject(d)||d instanceof this.constructor)T(d,f);else if(Ke.isString(d)&&(d=d.trim())&&!WT(d))T(GT(d),f);else if(Ke.isObject(d)&&Ke.isIterable(d)){let A={},n,M;for(const z of d){if(!Ke.isArray(z))throw TypeError("Object iterator must return a key-value pair");A[M=z[0]]=(n=A[M])?Ke.isArray(n)?[...n,z[1]]:[n,z[1]]:z[1]}T(A,f)}else d!=null&&N(f,d,g);return this}get(d,f){if(d=$u(d),d){const g=Ke.findKey(this,d);if(g){const w=this[g];if(!f)return w;if(f===!0)return ZT(w);if(Ke.isFunction(f))return f.call(this,w,g);if(Ke.isRegExp(f))return f.exec(w);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,f){if(d=$u(d),d){const g=Ke.findKey(this,d);return!!(g&&this[g]!==void 0&&(!f||sf(this,this[g],g,f)))}return!1}delete(d,f){const g=this;let w=!1;function N(T){if(T=$u(T),T){const A=Ke.findKey(g,T);A&&(!f||sf(g,g[A],A,f))&&(delete g[A],w=!0)}}return Ke.isArray(d)?d.forEach(N):N(d),w}clear(d){const f=Object.keys(this);let g=f.length,w=!1;for(;g--;){const N=f[g];(!d||sf(this,this[N],N,d,!0))&&(delete this[N],w=!0)}return w}normalize(d){const f=this,g={};return Ke.forEach(this,(w,N)=>{const T=Ke.findKey(g,N);if(T){f[T]=Rh(w),delete f[N];return}const A=d?HT(N):String(N).trim();A!==N&&delete f[N],f[A]=Rh(w),g[A]=!0}),this}concat(...d){return this.constructor.concat(this,...d)}toJSON(d){const f=Object.create(null);return Ke.forEach(this,(g,w)=>{g!=null&&g!==!1&&(f[w]=d&&Ke.isArray(g)?g.join(", "):g)}),f}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([d,f])=>d+": "+f).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d,...f){const g=new this(d);return f.forEach(w=>g.set(w)),g}static accessor(d){const g=(this[d0]=this[d0]={accessors:{}}).accessors,w=this.prototype;function N(T){const A=$u(T);g[A]||(XT(w,T),g[A]=!0)}return Ke.isArray(d)?d.forEach(N):N(d),this}}Ai.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ke.reduceDescriptors(Ai.prototype,({value:c},d)=>{let f=d[0].toUpperCase()+d.slice(1);return{get:()=>c,set(g){this[f]=g}}});Ke.freezeMethods(Ai);function rf(c,d){const f=this||rd,g=d||f,w=Ai.from(g.headers);let N=g.data;return Ke.forEach(c,function(A){N=A.call(f,N,w.normalize(),d?d.status:void 0)}),w.normalize(),N}function J_(c){return!!(c&&c.__CANCEL__)}function lc(c,d,f){cs.call(this,c??"canceled",cs.ERR_CANCELED,d,f),this.name="CanceledError"}Ke.inherits(lc,cs,{__CANCEL__:!0});function Y_(c,d,f){const g=f.config.validateStatus;!f.status||!g||g(f.status)?c(f):d(new cs("Request failed with status code "+f.status,[cs.ERR_BAD_REQUEST,cs.ERR_BAD_RESPONSE][Math.floor(f.status/100)-4],f.config,f.request,f))}function KT(c){const d=/^([-+\w]{1,25})(:?\/\/|:)/.exec(c);return d&&d[1]||""}function QT(c,d){c=c||10;const f=new Array(c),g=new Array(c);let w=0,N=0,T;return d=d!==void 0?d:1e3,function(n){const M=Date.now(),z=g[N];T||(T=M),f[w]=n,g[w]=M;let V=N,U=0;for(;V!==w;)U+=f[V++],V=V%c;if(w=(w+1)%c,w===N&&(N=(N+1)%c),M-T<d)return;const G=z&&M-z;return G?Math.round(U*1e3/G):void 0}}function JT(c,d){let f=0,g=1e3/d,w,N;const T=(M,z=Date.now())=>{f=z,w=null,N&&(clearTimeout(N),N=null),c.apply(null,M)};return[(...M)=>{const z=Date.now(),V=z-f;V>=g?T(M,z):(w=M,N||(N=setTimeout(()=>{N=null,T(w)},g-V)))},()=>w&&T(w)]}const Xh=(c,d,f=3)=>{let g=0;const w=QT(50,250);return JT(N=>{const T=N.loaded,A=N.lengthComputable?N.total:void 0,n=T-g,M=w(n),z=T<=A;g=T;const V={loaded:T,total:A,progress:A?T/A:void 0,bytes:n,rate:M||void 0,estimated:M&&A&&z?(A-T)/M:void 0,event:N,lengthComputable:A!=null,[d?"download":"upload"]:!0};c(V)},f)},h0=(c,d)=>{const f=c!=null;return[g=>d[0]({lengthComputable:f,total:c,loaded:g}),d[1]]},m0=c=>(...d)=>Ke.asap(()=>c(...d)),YT=li.hasStandardBrowserEnv?((c,d)=>f=>(f=new URL(f,li.origin),c.protocol===f.protocol&&c.host===f.host&&(d||c.port===f.port)))(new URL(li.origin),li.navigator&&/(msie|trident)/i.test(li.navigator.userAgent)):()=>!0,eE=li.hasStandardBrowserEnv?{write(c,d,f,g,w,N){const T=[c+"="+encodeURIComponent(d)];Ke.isNumber(f)&&T.push("expires="+new Date(f).toGMTString()),Ke.isString(g)&&T.push("path="+g),Ke.isString(w)&&T.push("domain="+w),N===!0&&T.push("secure"),document.cookie=T.join("; ")},read(c){const d=document.cookie.match(new RegExp("(^|;\\s*)("+c+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove(c){this.write(c,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function tE(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}function sE(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}function eb(c,d,f){let g=!tE(d);return c&&(g||f==!1)?sE(c,d):d}const p0=c=>c instanceof Ai?{...c}:c;function Ko(c,d){d=d||{};const f={};function g(M,z,V,U){return Ke.isPlainObject(M)&&Ke.isPlainObject(z)?Ke.merge.call({caseless:U},M,z):Ke.isPlainObject(z)?Ke.merge({},z):Ke.isArray(z)?z.slice():z}function w(M,z,V,U){if(Ke.isUndefined(z)){if(!Ke.isUndefined(M))return g(void 0,M,V,U)}else return g(M,z,V,U)}function N(M,z){if(!Ke.isUndefined(z))return g(void 0,z)}function T(M,z){if(Ke.isUndefined(z)){if(!Ke.isUndefined(M))return g(void 0,M)}else return g(void 0,z)}function A(M,z,V){if(V in d)return g(M,z);if(V in c)return g(void 0,M)}const n={url:N,method:N,data:N,baseURL:T,transformRequest:T,transformResponse:T,paramsSerializer:T,timeout:T,timeoutMessage:T,withCredentials:T,withXSRFToken:T,adapter:T,responseType:T,xsrfCookieName:T,xsrfHeaderName:T,onUploadProgress:T,onDownloadProgress:T,decompress:T,maxContentLength:T,maxBodyLength:T,beforeRedirect:T,transport:T,httpAgent:T,httpsAgent:T,cancelToken:T,socketPath:T,responseEncoding:T,validateStatus:A,headers:(M,z,V)=>w(p0(M),p0(z),V,!0)};return Ke.forEach(Object.keys(Object.assign({},c,d)),function(z){const V=n[z]||w,U=V(c[z],d[z],z);Ke.isUndefined(U)&&V!==A||(f[z]=U)}),f}const tb=c=>{const d=Ko({},c);let{data:f,withXSRFToken:g,xsrfHeaderName:w,xsrfCookieName:N,headers:T,auth:A}=d;d.headers=T=Ai.from(T),d.url=X_(eb(d.baseURL,d.url,d.allowAbsoluteUrls),c.params,c.paramsSerializer),A&&T.set("Authorization","Basic "+btoa((A.username||"")+":"+(A.password?unescape(encodeURIComponent(A.password)):"")));let n;if(Ke.isFormData(f)){if(li.hasStandardBrowserEnv||li.hasStandardBrowserWebWorkerEnv)T.setContentType(void 0);else if((n=T.getContentType())!==!1){const[M,...z]=n?n.split(";").map(V=>V.trim()).filter(Boolean):[];T.setContentType([M||"multipart/form-data",...z].join("; "))}}if(li.hasStandardBrowserEnv&&(g&&Ke.isFunction(g)&&(g=g(d)),g||g!==!1&&YT(d.url))){const M=w&&N&&eE.read(N);M&&T.set(w,M)}return d},rE=typeof XMLHttpRequest<"u",iE=rE&&function(c){return new Promise(function(f,g){const w=tb(c);let N=w.data;const T=Ai.from(w.headers).normalize();let{responseType:A,onUploadProgress:n,onDownloadProgress:M}=w,z,V,U,G,W;function $(){G&&G(),W&&W(),w.cancelToken&&w.cancelToken.unsubscribe(z),w.signal&&w.signal.removeEventListener("abort",z)}let K=new XMLHttpRequest;K.open(w.method.toUpperCase(),w.url,!0),K.timeout=w.timeout;function ue(){if(!K)return;const te=Ai.from("getAllResponseHeaders"in K&&K.getAllResponseHeaders()),me={data:!A||A==="text"||A==="json"?K.responseText:K.response,status:K.status,statusText:K.statusText,headers:te,config:c,request:K};Y_(function(Ae){f(Ae),$()},function(Ae){g(Ae),$()},me),K=null}"onloadend"in K?K.onloadend=ue:K.onreadystatechange=function(){!K||K.readyState!==4||K.status===0&&!(K.responseURL&&K.responseURL.indexOf("file:")===0)||setTimeout(ue)},K.onabort=function(){K&&(g(new cs("Request aborted",cs.ECONNABORTED,c,K)),K=null)},K.onerror=function(){g(new cs("Network Error",cs.ERR_NETWORK,c,K)),K=null},K.ontimeout=function(){let je=w.timeout?"timeout of "+w.timeout+"ms exceeded":"timeout exceeded";const me=w.transitional||K_;w.timeoutErrorMessage&&(je=w.timeoutErrorMessage),g(new cs(je,me.clarifyTimeoutError?cs.ETIMEDOUT:cs.ECONNABORTED,c,K)),K=null},N===void 0&&T.setContentType(null),"setRequestHeader"in K&&Ke.forEach(T.toJSON(),function(je,me){K.setRequestHeader(me,je)}),Ke.isUndefined(w.withCredentials)||(K.withCredentials=!!w.withCredentials),A&&A!=="json"&&(K.responseType=w.responseType),M&&([U,W]=Xh(M,!0),K.addEventListener("progress",U)),n&&K.upload&&([V,G]=Xh(n),K.upload.addEventListener("progress",V),K.upload.addEventListener("loadend",G)),(w.cancelToken||w.signal)&&(z=te=>{K&&(g(!te||te.type?new lc(null,c,K):te),K.abort(),K=null)},w.cancelToken&&w.cancelToken.subscribe(z),w.signal&&(w.signal.aborted?z():w.signal.addEventListener("abort",z)));const re=KT(w.url);if(re&&li.protocols.indexOf(re)===-1){g(new cs("Unsupported protocol "+re+":",cs.ERR_BAD_REQUEST,c));return}K.send(N||null)})},nE=(c,d)=>{const{length:f}=c=c?c.filter(Boolean):[];if(d||f){let g=new AbortController,w;const N=function(M){if(!w){w=!0,A();const z=M instanceof Error?M:this.reason;g.abort(z instanceof cs?z:new lc(z instanceof Error?z.message:z))}};let T=d&&setTimeout(()=>{T=null,N(new cs(`timeout ${d} of ms exceeded`,cs.ETIMEDOUT))},d);const A=()=>{c&&(T&&clearTimeout(T),T=null,c.forEach(M=>{M.unsubscribe?M.unsubscribe(N):M.removeEventListener("abort",N)}),c=null)};c.forEach(M=>M.addEventListener("abort",N));const{signal:n}=g;return n.unsubscribe=()=>Ke.asap(A),n}},aE=function*(c,d){let f=c.byteLength;if(f<d){yield c;return}let g=0,w;for(;g<f;)w=g+d,yield c.slice(g,w),g=w},oE=async function*(c,d){for await(const f of lE(c))yield*aE(f,d)},lE=async function*(c){if(c[Symbol.asyncIterator]){yield*c;return}const d=c.getReader();try{for(;;){const{done:f,value:g}=await d.read();if(f)break;yield g}}finally{await d.cancel()}},f0=(c,d,f,g)=>{const w=oE(c,d);let N=0,T,A=n=>{T||(T=!0,g&&g(n))};return new ReadableStream({async pull(n){try{const{done:M,value:z}=await w.next();if(M){A(),n.close();return}let V=z.byteLength;if(f){let U=N+=V;f(U)}n.enqueue(new Uint8Array(z))}catch(M){throw A(M),M}},cancel(n){return A(n),w.return()}},{highWaterMark:2})},pm=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",sb=pm&&typeof ReadableStream=="function",cE=pm&&(typeof TextEncoder=="function"?(c=>d=>c.encode(d))(new TextEncoder):async c=>new Uint8Array(await new Response(c).arrayBuffer())),rb=(c,...d)=>{try{return!!c(...d)}catch{return!1}},uE=sb&&rb(()=>{let c=!1;const d=new Request(li.origin,{body:new ReadableStream,method:"POST",get duplex(){return c=!0,"half"}}).headers.has("Content-Type");return c&&!d}),g0=64*1024,kf=sb&&rb(()=>Ke.isReadableStream(new Response("").body)),Kh={stream:kf&&(c=>c.body)};pm&&(c=>{["text","arrayBuffer","blob","formData","stream"].forEach(d=>{!Kh[d]&&(Kh[d]=Ke.isFunction(c[d])?f=>f[d]():(f,g)=>{throw new cs(`Response type '${d}' is not supported`,cs.ERR_NOT_SUPPORT,g)})})})(new Response);const dE=async c=>{if(c==null)return 0;if(Ke.isBlob(c))return c.size;if(Ke.isSpecCompliantForm(c))return(await new Request(li.origin,{method:"POST",body:c}).arrayBuffer()).byteLength;if(Ke.isArrayBufferView(c)||Ke.isArrayBuffer(c))return c.byteLength;if(Ke.isURLSearchParams(c)&&(c=c+""),Ke.isString(c))return(await cE(c)).byteLength},hE=async(c,d)=>{const f=Ke.toFiniteNumber(c.getContentLength());return f??dE(d)},mE=pm&&(async c=>{let{url:d,method:f,data:g,signal:w,cancelToken:N,timeout:T,onDownloadProgress:A,onUploadProgress:n,responseType:M,headers:z,withCredentials:V="same-origin",fetchOptions:U}=tb(c);M=M?(M+"").toLowerCase():"text";let G=nE([w,N&&N.toAbortSignal()],T),W;const $=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let K;try{if(n&&uE&&f!=="get"&&f!=="head"&&(K=await hE(z,g))!==0){let me=new Request(d,{method:"POST",body:g,duplex:"half"}),Ce;if(Ke.isFormData(g)&&(Ce=me.headers.get("content-type"))&&z.setContentType(Ce),me.body){const[Ae,fe]=h0(K,Xh(m0(n)));g=f0(me.body,g0,Ae,fe)}}Ke.isString(V)||(V=V?"include":"omit");const ue="credentials"in Request.prototype;W=new Request(d,{...U,signal:G,method:f.toUpperCase(),headers:z.normalize().toJSON(),body:g,duplex:"half",credentials:ue?V:void 0});let re=await fetch(W,U);const te=kf&&(M==="stream"||M==="response");if(kf&&(A||te&&$)){const me={};["status","statusText","headers"].forEach(Ie=>{me[Ie]=re[Ie]});const Ce=Ke.toFiniteNumber(re.headers.get("content-length")),[Ae,fe]=A&&h0(Ce,Xh(m0(A),!0))||[];re=new Response(f0(re.body,g0,Ae,()=>{fe&&fe(),$&&$()}),me)}M=M||"text";let je=await Kh[Ke.findKey(Kh,M)||"text"](re,c);return!te&&$&&$(),await new Promise((me,Ce)=>{Y_(me,Ce,{data:je,headers:Ai.from(re.headers),status:re.status,statusText:re.statusText,config:c,request:W})})}catch(ue){throw $&&$(),ue&&ue.name==="TypeError"&&/Load failed|fetch/i.test(ue.message)?Object.assign(new cs("Network Error",cs.ERR_NETWORK,c,W),{cause:ue.cause||ue}):cs.from(ue,ue&&ue.code,c,W)}}),Af={http:CT,xhr:iE,fetch:mE};Ke.forEach(Af,(c,d)=>{if(c){try{Object.defineProperty(c,"name",{value:d})}catch{}Object.defineProperty(c,"adapterName",{value:d})}});const x0=c=>`- ${c}`,pE=c=>Ke.isFunction(c)||c===null||c===!1,ib={getAdapter:c=>{c=Ke.isArray(c)?c:[c];const{length:d}=c;let f,g;const w={};for(let N=0;N<d;N++){f=c[N];let T;if(g=f,!pE(f)&&(g=Af[(T=String(f)).toLowerCase()],g===void 0))throw new cs(`Unknown adapter '${T}'`);if(g)break;w[T||"#"+N]=g}if(!g){const N=Object.entries(w).map(([A,n])=>`adapter ${A} `+(n===!1?"is not supported by the environment":"is not available in the build"));let T=d?N.length>1?`since :
`+N.map(x0).join(`
`):" "+x0(N[0]):"as no adapter specified";throw new cs("There is no suitable adapter to dispatch the request "+T,"ERR_NOT_SUPPORT")}return g},adapters:Af};function nf(c){if(c.cancelToken&&c.cancelToken.throwIfRequested(),c.signal&&c.signal.aborted)throw new lc(null,c)}function y0(c){return nf(c),c.headers=Ai.from(c.headers),c.data=rf.call(c,c.transformRequest),["post","put","patch"].indexOf(c.method)!==-1&&c.headers.setContentType("application/x-www-form-urlencoded",!1),ib.getAdapter(c.adapter||rd.adapter)(c).then(function(g){return nf(c),g.data=rf.call(c,c.transformResponse,g),g.headers=Ai.from(g.headers),g},function(g){return J_(g)||(nf(c),g&&g.response&&(g.response.data=rf.call(c,c.transformResponse,g.response),g.response.headers=Ai.from(g.response.headers))),Promise.reject(g)})}const nb="1.10.0",fm={};["object","boolean","number","function","string","symbol"].forEach((c,d)=>{fm[c]=function(g){return typeof g===c||"a"+(d<1?"n ":" ")+c}});const _0={};fm.transitional=function(d,f,g){function w(N,T){return"[Axios v"+nb+"] Transitional option '"+N+"'"+T+(g?". "+g:"")}return(N,T,A)=>{if(d===!1)throw new cs(w(T," has been removed"+(f?" in "+f:"")),cs.ERR_DEPRECATED);return f&&!_0[T]&&(_0[T]=!0,console.warn(w(T," has been deprecated since v"+f+" and will be removed in the near future"))),d?d(N,T,A):!0}};fm.spelling=function(d){return(f,g)=>(console.warn(`${g} is likely a misspelling of ${d}`),!0)};function fE(c,d,f){if(typeof c!="object")throw new cs("options must be an object",cs.ERR_BAD_OPTION_VALUE);const g=Object.keys(c);let w=g.length;for(;w-- >0;){const N=g[w],T=d[N];if(T){const A=c[N],n=A===void 0||T(A,N,c);if(n!==!0)throw new cs("option "+N+" must be "+n,cs.ERR_BAD_OPTION_VALUE);continue}if(f!==!0)throw new cs("Unknown option "+N,cs.ERR_BAD_OPTION)}}const zh={assertOptions:fE,validators:fm},Bn=zh.validators;class Ho{constructor(d){this.defaults=d||{},this.interceptors={request:new u0,response:new u0}}async request(d,f){try{return await this._request(d,f)}catch(g){if(g instanceof Error){let w={};Error.captureStackTrace?Error.captureStackTrace(w):w=new Error;const N=w.stack?w.stack.replace(/^.+\n/,""):"";try{g.stack?N&&!String(g.stack).endsWith(N.replace(/^.+\n.+\n/,""))&&(g.stack+=`
`+N):g.stack=N}catch{}}throw g}}_request(d,f){typeof d=="string"?(f=f||{},f.url=d):f=d||{},f=Ko(this.defaults,f);const{transitional:g,paramsSerializer:w,headers:N}=f;g!==void 0&&zh.assertOptions(g,{silentJSONParsing:Bn.transitional(Bn.boolean),forcedJSONParsing:Bn.transitional(Bn.boolean),clarifyTimeoutError:Bn.transitional(Bn.boolean)},!1),w!=null&&(Ke.isFunction(w)?f.paramsSerializer={serialize:w}:zh.assertOptions(w,{encode:Bn.function,serialize:Bn.function},!0)),f.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?f.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:f.allowAbsoluteUrls=!0),zh.assertOptions(f,{baseUrl:Bn.spelling("baseURL"),withXsrfToken:Bn.spelling("withXSRFToken")},!0),f.method=(f.method||this.defaults.method||"get").toLowerCase();let T=N&&Ke.merge(N.common,N[f.method]);N&&Ke.forEach(["delete","get","head","post","put","patch","common"],W=>{delete N[W]}),f.headers=Ai.concat(T,N);const A=[];let n=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(f)===!1||(n=n&&$.synchronous,A.unshift($.fulfilled,$.rejected))});const M=[];this.interceptors.response.forEach(function($){M.push($.fulfilled,$.rejected)});let z,V=0,U;if(!n){const W=[y0.bind(this),void 0];for(W.unshift.apply(W,A),W.push.apply(W,M),U=W.length,z=Promise.resolve(f);V<U;)z=z.then(W[V++],W[V++]);return z}U=A.length;let G=f;for(V=0;V<U;){const W=A[V++],$=A[V++];try{G=W(G)}catch(K){$.call(this,K);break}}try{z=y0.call(this,G)}catch(W){return Promise.reject(W)}for(V=0,U=M.length;V<U;)z=z.then(M[V++],M[V++]);return z}getUri(d){d=Ko(this.defaults,d);const f=eb(d.baseURL,d.url,d.allowAbsoluteUrls);return X_(f,d.params,d.paramsSerializer)}}Ke.forEach(["delete","get","head","options"],function(d){Ho.prototype[d]=function(f,g){return this.request(Ko(g||{},{method:d,url:f,data:(g||{}).data}))}});Ke.forEach(["post","put","patch"],function(d){function f(g){return function(N,T,A){return this.request(Ko(A||{},{method:d,headers:g?{"Content-Type":"multipart/form-data"}:{},url:N,data:T}))}}Ho.prototype[d]=f(),Ho.prototype[d+"Form"]=f(!0)});class Jf{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let f;this.promise=new Promise(function(N){f=N});const g=this;this.promise.then(w=>{if(!g._listeners)return;let N=g._listeners.length;for(;N-- >0;)g._listeners[N](w);g._listeners=null}),this.promise.then=w=>{let N;const T=new Promise(A=>{g.subscribe(A),N=A}).then(w);return T.cancel=function(){g.unsubscribe(N)},T},d(function(N,T,A){g.reason||(g.reason=new lc(N,T,A),f(g.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const f=this._listeners.indexOf(d);f!==-1&&this._listeners.splice(f,1)}toAbortSignal(){const d=new AbortController,f=g=>{d.abort(g)};return this.subscribe(f),d.signal.unsubscribe=()=>this.unsubscribe(f),d.signal}static source(){let d;return{token:new Jf(function(w){d=w}),cancel:d}}}function gE(c){return function(f){return c.apply(null,f)}}function xE(c){return Ke.isObject(c)&&c.isAxiosError===!0}const Mf={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Mf).forEach(([c,d])=>{Mf[d]=c});function ab(c){const d=new Ho(c),f=z_(Ho.prototype.request,d);return Ke.extend(f,Ho.prototype,d,{allOwnKeys:!0}),Ke.extend(f,d,null,{allOwnKeys:!0}),f.create=function(w){return ab(Ko(c,w))},f}const Pr=ab(rd);Pr.Axios=Ho;Pr.CanceledError=lc;Pr.CancelToken=Jf;Pr.isCancel=J_;Pr.VERSION=nb;Pr.toFormData=mm;Pr.AxiosError=cs;Pr.Cancel=Pr.CanceledError;Pr.all=function(d){return Promise.all(d)};Pr.spread=gE;Pr.isAxiosError=xE;Pr.mergeConfig=Ko;Pr.AxiosHeaders=Ai;Pr.formToJSON=c=>Q_(Ke.isHTMLForm(c)?new FormData(c):c);Pr.getAdapter=ib.getAdapter;Pr.HttpStatusCode=Mf;Pr.default=Pr;var ob={exports:{}};(function(c,d){var f={};(function(g,w){c.exports=w()})(y1,function(){var g,w,N;function T(n,M){if(!g)g=M;else if(!w)w=M;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+w+")(sharedChunk); self.onerror = null;",V={};g(V),N=M(V),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(N.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}T(["exports"],function(n){var M=typeof self<"u"?self:{},z="2.15.0";let V;const U={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(V==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{V=f.API_URL_REGEX!=null?new RegExp(f.API_URL_REGEX):s}catch{V=s}}return V},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!U.API_URL)return null;try{const s=new URL(U.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},G={supported:!1,testSupport:function(s){!K&&$&&(ue?re(s):W=s)}};let W,$,K=!1,ue=!1;function re(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,$),s.isContextLost())return;G.supported=!0}catch{}s.deleteTexture(e),K=!0}M.document&&($=M.document.createElement("img"),$.onload=function(){W&&re(W),W=null,ue=!0},$.onerror=function(){K=!0,W=null},$.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const te="01";function je(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var me=Ce;function Ce(s,e,r,a){this.cx=3*s,this.bx=3*(r-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=e,this.p2x=r,this.p2y=a}Ce.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,e){if(e===void 0&&(e=1e-6),s<0)return 0;if(s>1)return 1;for(var r=s,a=0;a<8;a++){var l=this.sampleCurveX(r)-s;if(Math.abs(l)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var p=0,y=1;for(r=s,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-s)<e));a++)s>l?p=r:y=r,r=.5*(y-p)+p;return r},solve:function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))}};var Ae=je(me),fe=Ie;function Ie(s,e){this.x=s,this.y=e}Ie.prototype={clone:function(){return new Ie(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,e){return this.clone()._rotateAround(s,e)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var e=s.x-this.x,r=s.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult:function(s){var e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var e=Math.cos(s),r=Math.sin(s),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(s,e){var r=Math.cos(s),a=Math.sin(s),l=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ie.convert=function(s){return s instanceof Ie?s:Array.isArray(s)?new Ie(s[0],s[1]):s};var Ee=je(fe);const tt=Math.PI/180,Pe=180/Math.PI;function Te(s){return s*tt}function rt(s){return s*Pe}const gt=[[0,0],[1,0],[1,1],[0,1]];function yt(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,r=e*s;return 4*(s<.5?r:3*(s-e)+r-.75)}function pt(s,e,r,a){const l=new Ae(s,e,r,a);return function(h){return l.solve(h)}}const ft=pt(.25,.1,.25,1);function wt(s,e,r){return Math.min(r,Math.max(e,s))}function Os(s,e,r){return(r=wt((r-s)/(e-s),0,1))*r*(3-2*r)}function ns(s,e,r){const a=r-e,l=((s-e)%a+a)%a+e;return l===e?r:l}function _s(s,e,r){if(!s.length)return r(null,[]);let a=s.length;const l=new Array(s.length);let h=null;s.forEach((p,y)=>{e(p,(b,v)=>{b&&(h=b),l[y]=v,--a==0&&r(h,l)})})}function mr(s){const e=[];for(const r in s)e.push(s[r]);return e}function Ut(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}let pr=1;function Fr(){return pr++}function jr(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function fr(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Br(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function _r(s,e){s.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Jr(s,e){return s.indexOf(e,s.length-e.length)!==-1}function Qt(s,e,r){const a={};for(const l in s)a[l]=e.call(this,s[l],l,s);return a}function gi(s,e,r){const a={};for(const l in s)e.call(r||this,s[l],l,s)&&(a[l]=s[l]);return a}function br(s){return Array.isArray(s)?s.map(br):typeof s=="object"&&s?Qt(s,br):s}const Mi={};function As(s){Mi[s]||(typeof console<"u"&&console.warn(s),Mi[s]=!0)}function Ir(s,e,r){return(r.y-s.y)*(e.x-s.x)>(e.y-s.y)*(r.x-s.x)}function Zn(s){let e=0;for(let r,a,l=0,h=s.length,p=h-1;l<h;p=l++)r=s[l],a=s[p],e+=(a.x-r.x)*(r.y+a.y);return e}function Zr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function we(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,h)=>{const p=l||h;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Ge=null;function et(s){if(Ge==null){const e=s.navigator?s.navigator.userAgent:null;Ge=!!s.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ge}function kt(s){try{const e=M[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Nt(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}const De="mapbox-tiles";let xt=500,Jt=50,qt,bs;function sr(){try{return M.caches}catch{}}function Ls(){sr()&&!qt&&(qt=M.caches.open(De))}function xi(s){const e=s.indexOf("?");if(e<0)return s;const r=function(l){const h=l.indexOf("?");return h>0?l.slice(h+1).split("&"):[]}(s),a=r.filter(l=>{const h=l.split("=");return h[0]==="language"||h[0]==="worldview"});return a.length?`${s.slice(0,e)}?${a.join("&")}`:s.slice(0,e)}let Wr=1/0;const Dr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Dr);class yi extends Error{constructor(e,r,a){r===401&&Re(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Oi=Zr()?()=>self.worker&&self.worker.referrer:()=>(M.location.protocol==="blob:"?M.parent:M).location.href,en=function(s,e){if(!(/^file:/.test(r=s.url)||/^file:/.test(Oi())&&!/^\w+:/.test(r))){if(M.fetch&&M.Request&&M.AbortController&&M.Request.prototype.hasOwnProperty("signal"))return function(a,l){const h=new M.AbortController,p=new M.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Oi(),referrerPolicy:a.referrerPolicy,signal:h.signal});let y=!1,b=!1;const v=(E=p.url).indexOf("sku=")>0&&Re(E);var E;a.type==="json"&&p.headers.set("Accept","application/json");const k=(L,R,B)=>{if(b)return;if(L&&L.message!=="SecurityError"&&As(L.toString()),R&&B)return P(R);const X=Date.now();M.fetch(p).then(ie=>{if(ie.ok){const pe=v?ie.clone():null;return P(ie,pe,X)}return l(new yi(ie.statusText,ie.status,a.url))}).catch(ie=>{ie.name!=="AbortError"&&l(new Error(`${ie.message} ${a.url}`))})},P=(L,R,B)=>{(a.type==="arrayBuffer"?L.arrayBuffer():a.type==="json"?L.json():L.text()).then(X=>{b||(R&&B&&function(ie,pe,ne){if(Ls(),!qt)return;const de={status:pe.status,statusText:pe.statusText,headers:new M.Headers};pe.headers.forEach((Ue,Oe)=>de.headers.set(Oe,Ue));const xe=we(pe.headers.get("Cache-Control")||"");if(xe["no-store"])return;xe["max-age"]&&de.headers.set("Expires",new Date(ne+1e3*xe["max-age"]).toUTCString());const ge=de.headers.get("Expires");ge&&(new Date(ge).getTime()-ne<42e4||function(Ue,Oe){if(bs===void 0)try{new Response(new ReadableStream),bs=!0}catch{bs=!1}bs?Oe(Ue.body):Ue.blob().then(Oe)}(pe,Ue=>{const Oe=new M.Response(Ue,de);Ls(),qt&&qt.then(He=>He.put(xi(ie.url),Oe)).catch(He=>As(He.message))}))}(p,R,B),y=!0,l(null,X,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(X=>{b||l(new Error(X.message))})};return v?function(L,R){if(Ls(),!qt)return R(null);const B=xi(L.url);qt.then(X=>{X.match(B).then(ie=>{const pe=function(ne){if(!ne)return!1;const de=new Date(ne.headers.get("Expires")||0),xe=we(ne.headers.get("Cache-Control")||"");return de>Date.now()&&!xe["no-cache"]}(ie);X.delete(B),pe&&X.put(B,ie.clone()),R(null,ie,pe)}).catch(R)}).catch(R)}(p,k):k(null,null),{cancel:()=>{b=!0,y||h.abort()}}}(s,e);if(Zr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var r;return function(a,l){const h=new M.XMLHttpRequest;h.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in a.headers)h.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=a.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(a.type==="json")try{p=JSON.parse(h.response)}catch(y){return l(y)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else l(new yi(h.statusText,h.status,a.url))},h.send(a.body),{cancel:()=>h.abort()}}(s,e)},tn=function(s,e){return en(Ut(s,{type:"arrayBuffer"}),e)};function el(s){const e=M.document.createElement("a");return e.href=s,e.protocol===M.document.location.protocol&&e.host===M.document.location.host}const he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let q,Z;q=[],Z=0;const ce=function(s,e){if(G.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Z>=U.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return q.push(h),h}Z++;let r=!1;const a=()=>{if(!r)for(r=!0,Z--;q.length&&Z<U.MAX_PARALLEL_IMAGE_REQUESTS;){const h=q.shift(),{requestParameters:p,callback:y,cancelled:b}=h;b||(h.cancel=ce(p,y).cancel)}},l=tn(s,(h,p,y,b)=>{a(),h?e(h):p&&(M.createImageBitmap?function(v,E){const k=new M.Blob([new Uint8Array(v)],{type:"image/png"});M.createImageBitmap(k).then(P=>{E(null,P)}).catch(P=>{E(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(v,E)=>e(v,E,y,b)):function(v,E){const k=new M.Image,P=M.URL;k.onload=()=>{E(null,k),P.revokeObjectURL(k.src),k.onload=null,M.requestAnimationFrame(()=>{k.src=he})},k.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new M.Blob([new Uint8Array(v)],{type:"image/png"});k.src=v.byteLength?P.createObjectURL(L):he}(p,(v,E)=>e(v,E,y,b)))});return{cancel:()=>{l.cancel(),a()}}},ye="NO_ACCESS_TOKEN";function Se(s){return s.indexOf("mapbox:")===0}function Re(s){return U.API_URL_REGEX.test(s)}function Le(s){return U.API_CDN_URL_REGEX.test(s)}function Ne(s){return U.API_STYLE_REGEX.test(s)&&!$e(s)}function $e(s){return U.API_SPRITE_REGEX.test(s)}const mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bt(s){const e=s.match(mt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ut(s){const e=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${e}`}const Wt="mapbox.eventData";function Yt(s){if(!s)return null;const e=s.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(M.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ht{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Yt(U.ACCESS_TOKEN);let a="";return a=r&&r.u?M.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,h)=>String.fromCharCode(+("0x"+h)))):U.ACCESS_TOKEN||"",e?`${Wt}.${e}:${a}`:`${Wt}:${a}`}fetchEventData(){const e=kt("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const l=M.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const h=M.localStorage.getItem(a);h&&(this.anonId=h)}catch{As("Unable to read from LocalStorage")}}saveEventData(){const e=kt("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{M.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&M.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{As("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,l){if(!U.EVENTS_URL)return;const h=bt(U.EVENTS_URL);h.params.push(`access_token=${l||U.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},y=r?Ut(p,r):p,b={url:ut(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(v,E){return en(Ut(v,{method:"POST"}),E)}(b,v=>{this.pendingRequest=null,a(v),this.saveEventData(),this.processRequests(l)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const es=new class extends Ht{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,e){U.EVENTS_URL&&U.ACCESS_TOKEN&&Array.isArray(s)&&s.some(r=>Se(r)||Re(r))&&this.queueRequest(Date.now(),e)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Yt(U.ACCESS_TOKEN),r=e?e.u:U.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;Br(this.anonId)||(this.anonId=jr(),a=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),p=new Date(l),y=(l-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||h.getDate()!==p.getDate()}else a=!0;a?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:te,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},s):this.processRequests()}},os=es.postTurnstileEvent.bind(es),Vs=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,e,r,a){this.skuToken=e,this.errorCb=a,U.EVENTS_URL&&(r||U.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},r):this.errorCb(new Error(ye)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Br(this.anonId)||(this.anonId=jr()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:te,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},s))}},rr=Vs.postMapLoadEvent.bind(Vs),Ur=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(s,e){U.EVENTS_URL&&(s||U.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),a=function(l){const h=M.performance.getEntriesByType("resource"),p=M.performance.getEntriesByType("mark"),y=function(P){const L={};if(P){for(const R in P)if(R!=="other")for(const B of P[R]){const X=`${R}ResolveRangeMin`,ie=`${R}ResolveRangeMax`,pe=`${R}RequestCount`,ne=`${R}RequestCachedCount`;L[X]=Math.min(L[X]||1/0,B.startTime),L[ie]=Math.max(L[ie]||-1/0,B.responseEnd);const de=xe=>{L[xe]===void 0&&(L[xe]=0),++L[xe]};B.transferSize!==void 0&&B.transferSize===0&&de(ne),de(pe)}}return L}(function(P,L){const R={};if(P)for(const B of P){const X=L(B);R[X]===void 0&&(R[X]=[]),R[X].push(B)}return R}(h,ad)),b=M.devicePixelRatio,v=M.navigator.connection||M.navigator.mozConnection||M.navigator.webkitConnection,E={counters:[],metadata:[],attributes:[]},k=(P,L,R)=>{R!=null&&P.push({name:L,value:R.toString()})};for(const P in y)k(E.counters,P,y[P]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(k(E.counters,"interactionRangeMin",l.interactionRange[0]),k(E.counters,"interactionRangeMax",l.interactionRange[1])),p)for(const P of Object.keys(ga)){const L=ga[P],R=p.find(B=>B.name===L);R&&k(E.counters,L,R.startTime)}return k(E.counters,"visibilityHidden",l.visibilityHidden),k(E.attributes,"style",function(P){if(P)for(const L of P){const R=L.name.split("?")[0];if(Ne(R)){const B=R.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(h)),k(E.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),k(E.attributes,"fogEnabled",l.fogEnabled?"true":"false"),k(E.attributes,"projection",l.projection),k(E.attributes,"zoom",l.zoom),k(E.metadata,"devicePixelRatio",b),k(E.metadata,"connectionEffectiveType",v?v.effectiveType:void 0),k(E.metadata,"navigatorUserAgent",M.navigator.userAgent),k(E.metadata,"screenWidth",M.screen.width),k(E.metadata,"screenHeight",M.screen.height),k(E.metadata,"windowWidth",M.innerWidth),k(E.metadata,"windowHeight",M.innerHeight),k(E.metadata,"mapWidth",l.width/b),k(E.metadata,"mapHeight",l.height/b),k(E.metadata,"webglRenderer",l.renderer),k(E.metadata,"webglVendor",l.vendor),k(E.metadata,"sdkVersion",z),k(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(r);for(const l of a.metadata);for(const l of a.counters);for(const l of a.attributes);this.postEvent(e,a,()=>{},s)}},gr=Ur.postPerformanceEvent.bind(Ur),Fi=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,e,r,a){if(!U.API_URL||!U.SESSION_PATH)return;const l=bt(U.API_URL+U.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${a||U.ACCESS_TOKEN||""}`);const h={url:ut(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,y){return en(Ut(p,{method:"GET"}),y)}(h,p=>{this.pendingRequest=null,r(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(s,e,r,a){this.skuToken=e,this.errorCb=a,U.SESSION_PATH&&U.API_URL&&(r||U.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},r):this.errorCb(new Error(ye)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},s)}},Nr=Fi.getSessionAPI.bind(Fi),Hr=new Set,ga={create:"create",load:"load",fullLoad:"fullLoad"},xm={mark(s){M.performance.mark(s)},measure(s,e,r){M.performance.measure(s,e,r)}};function ad(s){const e=s.name.split("?")[0];return Le(e)&&e.includes("mapbox-gl.js")?"javascript":Le(e)&&e.includes("mapbox-gl.css")?"css":function(r){return U.API_FONTS_REGEX.test(r)}(e)?"fontRange":$e(e)?"sprite":Ne(e)?"style":function(r){return U.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}const xs=M.performance;function dc(s){const e=s?s.url.toString():void 0;return xs.getEntriesByName(e)}let ro,hc,tl,Bi;const sn={now:()=>tl!==void 0?tl:M.performance.now(),setNow(s){tl=s},restoreNow(){tl=void 0},frame(s){const e=M.requestAnimationFrame(s);return{cancel:()=>M.cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:r,height:a}=s;Bi||(Bi=M.document.createElement("canvas"));const l=Bi.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>Bi.width||a>Bi.height)&&(Bi.width=r,Bi.height=a),l.clearRect(-e,-e,r+2*e,a+2*e),l.drawImage(s,0,0,r,a),l.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:s=>(ro||(ro=M.document.createElement("a")),ro.href=s,ro.href),get devicePixelRatio(){return M.devicePixelRatio},get prefersReducedMotion(){return!!M.matchMedia&&(hc==null&&(hc=M.matchMedia("(prefers-reduced-motion: reduce)")),hc.matches)}};function mc(s,e,r){r[s]&&r[s].indexOf(e)!==-1||(r[s]=r[s]||[],r[s].push(e))}function pc(s,e,r){if(r&&r[s]){const a=r[s].indexOf(e);a!==-1&&r[s].splice(a,1)}}class Wn{constructor(e,r={}){Ut(this,r),this.type=e}}class rn extends Wn{constructor(e,r={}){super("error",Ut({error:e},r))}}class io{on(e,r){return this._listeners=this._listeners||{},mc(e,r,this._listeners),this}off(e,r){return pc(e,r,this._listeners),pc(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},mc(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Wn(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of l)y.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of h)pc(a,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(Ut(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof rn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function nn(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}function ir(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Sr(s){if(Array.isArray(s))return s.map(Sr);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const r in s)e[r]=Sr(s[r]);return e}return ir(s)}class od extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Ui=od;class fc{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,l]of r)this.bindings[a]=l}concat(e){return new fc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var ld=fc;const xa={kind:"null"},Tt={kind:"number"},as={kind:"string"},ss={kind:"boolean"},ui={kind:"color"},Pi={kind:"object"},rs={kind:"value"},di={kind:"collator"},no={kind:"formatted"},Hn={kind:"resolvedImage"};function _i(s,e){return{kind:"array",itemType:s,N:e}}function Fs(s){if(s.kind==="array"){const e=Fs(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const cd=[xa,Tt,as,ss,ui,no,Pi,_i(rs),Hn];function an(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!an(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const r of cd)if(!an(r,e))return null}}return`Expected ${Fs(s)} but found ${Fs(e)} instead.`}function ao(s,e){return e.some(r=>r.kind===s.kind)}function oo(s,e){return e.some(r=>r==="null"?s===null:r==="array"?Array.isArray(s):r==="object"?s&&!Array.isArray(s)&&typeof s=="object":r===typeof s)}var gc,ud={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function lo(s){return(s=Math.round(s))<0?0:s>255?255:s}function co(s){return lo(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function sl(s){return(e=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:e>1?1:e;var e}function ya(s,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?s+(e-s)*r*6:2*r<1?e:3*r<2?s+(e-s)*(2/3-r)*6:s}try{gc={}.parseCSSColor=function(s){var e,r=s.replace(/ /g,"").toLowerCase();if(r in ud)return ud[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),l=r.indexOf(")");if(a!==-1&&l+1===r.length){var h=r.substr(0,a),p=r.substr(a+1,l-(a+1)).split(","),y=1;switch(h){case"rgba":if(p.length!==4)return null;y=sl(p.pop());case"rgb":return p.length!==3?null:[co(p[0]),co(p[1]),co(p[2]),y];case"hsla":if(p.length!==4)return null;y=sl(p.pop());case"hsl":if(p.length!==3)return null;var b=(parseFloat(p[0])%360+360)%360/360,v=sl(p[1]),E=sl(p[2]),k=E<=.5?E*(v+1):E+v-E*v,P=2*E-k;return[lo(255*ya(P,k,b+1/3)),lo(255*ya(P,k,b)),lo(255*ya(P,k,b-1/3)),y];default:return null}}return null}}catch{}class Yr{constructor(e,r,a,l=1){this.r=e,this.g=r,this.b=a,this.a=l}static parse(e){if(!e)return;if(e instanceof Yr)return e;if(typeof e!="string")return;const r=gc(e);return r?new Yr(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${l})`}toArray(){const{r:e,g:r,b:a,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*a/l,l]}toArray01(){const{r:e,g:r,b:a,a:l}=this;return l===0?[0,0,0,0]:[e/l,r/l,a/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:l}=this;return[e,r,a,l]}}Yr.black=new Yr(0,0,0,1),Yr.white=new Yr(1,1,1,1),Yr.transparent=new Yr(0,0,0,0),Yr.red=new Yr(1,0,0,1),Yr.blue=new Yr(0,0,1,1);var Js=Yr;class xc{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yc{constructor(e,r,a,l,h){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=l,this.textColor=h}}class ei{constructor(e){this.sections=e}static fromString(e){return new ei([new yc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ei?e:ei.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class bi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new bi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function dd(s,e,r,a){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[s,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[s,e,r,a]:[s,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function uo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Js||s instanceof xc||s instanceof ei||s instanceof bi)return!0;if(Array.isArray(s)){for(const e of s)if(!uo(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!uo(s[e]))return!1;return!0}return!1}function Zs(s){if(s===null)return xa;if(typeof s=="string")return as;if(typeof s=="boolean")return ss;if(typeof s=="number")return Tt;if(s instanceof Js)return ui;if(s instanceof xc)return di;if(s instanceof ei)return no;if(s instanceof bi)return Hn;if(Array.isArray(s)){const e=s.length;let r;for(const a of s){const l=Zs(a);if(r){if(r===l)continue;r=rs;break}r=l}return _i(r||rs,e)}return Pi}function ho(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Js||s instanceof ei||s instanceof bi?s.toString():JSON.stringify(s)}class _c{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!uo(e[1]))return r.error("invalid value");const a=e[1];let l=Zs(a);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new _c(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Js?["rgba"].concat(this.value.toArray()):this.value instanceof ei?this.value.serialize():this.value}}var Xn=_c,Lr=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const bc={string:as,number:Tt,boolean:ss,object:Pi};class vc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,l=1;const h=e[0];if(h==="array"){let y,b;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in bc)||v==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=bc[v],l++}else y=rs;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],l++}a=_i(y,b)}else a=bc[h];const p=[];for(;l<e.length;l++){const y=r.parse(e[l],l,rs);if(!y)return null;p.push(y)}return new vc(a,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!an(this.type,Zs(a)))return a;if(r===this.args.length-1)throw new Lr(`Expected value to be of type ${Fs(this.type)}, but found ${Fs(Zs(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(a=>a.serialize()))}}var on=vc;class kn{constructor(e){this.type=no,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,Tt),!b))return null;let v=null;if(y["text-font"]&&(v=r.parse(y["text-font"],1,_i(as)),!v))return null;let E=null;if(y["text-color"]&&(E=r.parse(y["text-color"],1,ui),!E))return null;const k=l[l.length-1];k.scale=b,k.font=v,k.textColor=E}else{const b=r.parse(e[p],1,rs);if(!b)return null;const v=b.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:b,scale:null,font:null,textColor:null})}}return new kn(l)}evaluate(e){return new ei(this.sections.map(r=>{const a=r.content.evaluate(e);return Zs(a)===Hn?new yc("",a,null,null,null):new yc(ho(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class rl{constructor(e){this.type=Hn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,as);return a?new rl(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=bi.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ym={"to-boolean":ss,"to-color":ui,"to-number":Tt,"to-string":as};class wc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=ym[a],h=[];for(let p=1;p<e.length;p++){const y=r.parse(e[p],p,rs);if(!y)return null;h.push(y)}return new wc(l,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const l of this.args){if(r=l.evaluate(e),a=null,r instanceof Js)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:dd(r[0],r[1],r[2],r[3]),!a))return new Js(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Lr(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Lr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ei.fromString(ho(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?bi.fromString(ho(this.args[0].evaluate(e))):ho(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new kn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var _a=wc;const Vi=["Unknown","Point","LineString","Polygon"];var jc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-s[0])+this.featureDistanceData.bearing[1]*(a*e-s[1])}return 0}parseColor(s){let e=this._parseColorCache[s];return e||(e=this._parseColorCache[s]=Js.parse(s)),e}};class Kn{constructor(e,r,a,l){this.name=e,this.type=r,this._evaluate=a,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],l=Kn.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=p.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let b=null;for(const[v,E]of y){b=new kc(r.registry,r.path,null,r.scope);const k=[];let P=!1;for(let L=1;L<e.length;L++){const R=e[L],B=Array.isArray(v)?v[L-1]:v.type,X=b.parse(R,1+k.length,B);if(!X){P=!0;break}k.push(X)}if(!P)if(Array.isArray(v)&&v.length!==k.length)b.error(`Expected ${v.length} arguments, but found ${k.length} instead.`);else{for(let L=0;L<k.length;L++){const R=Array.isArray(v)?v[L]:v.type,B=k[L];b.concat(L+1).checkSubtype(R,B.type)}if(b.errors.length===0)return new Kn(a,h,E,k)}}if(y.length===1)r.errors.push(...b.errors);else{const v=(y.length?y:p).map(([k])=>{return P=k,Array.isArray(P)?`(${P.map(Fs).join(", ")})`:`(${Fs(P.type)}...)`;var P}).join(" | "),E=[];for(let k=1;k<e.length;k++){const P=r.parse(e[k],1+E.length);if(!P)return null;E.push(Fs(P.type))}r.error(`Expected arguments of type ${v}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){Kn.definitions=r;for(const a in r)e[a]=Kn}}var ln=Kn;class mo{constructor(e,r,a){this.type=di,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const l=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ss);if(!l)return null;const h=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ss);if(!h)return null;let p=null;return a.locale&&(p=r.parse(a.locale,1,as),!p)?null:new mo(l,h,p)}evaluate(e){return new xc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const cn=8192;function il(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function ba(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function po(s,e){const r=(180+s[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*cn),Math.round(a*l*cn)]}function hd(s,e,r){const a=s[0]-e[0],l=s[1]-e[1],h=s[0]-r[0],p=s[1]-r[1];return a*p-h*l==0&&a*h<=0&&l*p<=0}function nl(s,e){let r=!1;for(let p=0,y=e.length;p<y;p++){const b=e[p];for(let v=0,E=b.length;v<E-1;v++){if(hd(s,b[v],b[v+1]))return!1;(l=b[v])[1]>(a=s)[1]!=(h=b[v+1])[1]>a[1]&&a[0]<(h[0]-l[0])*(a[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var a,l,h;return r}function Nc(s,e){for(let r=0;r<e.length;r++)if(nl(s,e[r]))return!0;return!1}function Sc(s,e,r,a){const l=a[0]-r[0],h=a[1]-r[1],p=(s[0]-r[0])*h-l*(s[1]-r[1]),y=(e[0]-r[0])*h-l*(e[1]-r[1]);return p>0&&y<0||p<0&&y>0}function va(s,e,r){for(const v of r)for(let E=0;E<v.length-1;++E)if((y=[(p=v[E+1])[0]-(h=v[E])[0],p[1]-h[1]])[0]*(b=[(l=e)[0]-(a=s)[0],l[1]-a[1]])[1]-y[1]*b[0]!=0&&Sc(a,l,h,p)&&Sc(h,p,a,l))return!0;var a,l,h,p,y,b;return!1}function ys(s,e){for(let r=0;r<s.length;++r)if(!nl(s[r],e))return!1;for(let r=0;r<s.length-1;++r)if(va(s[r],s[r+1],e))return!1;return!0}function _m(s,e){for(let r=0;r<e.length;r++)if(ys(s,e[r]))return!0;return!1}function Tc(s,e,r){const a=[];for(let l=0;l<s.length;l++){const h=[];for(let p=0;p<s[l].length;p++){const y=po(s[l][p],r);il(e,y),h.push(y)}a.push(h)}return a}function md(s,e,r){const a=[];for(let l=0;l<s.length;l++){const h=Tc(s[l],e,r);a.push(h)}return a}function Ec(s,e,r,a){if(s[0]<r[0]||s[0]>r[2]){const l=.5*a;let h=s[0]-r[0]>l?-a:r[0]-s[0]>l?a:0;h===0&&(h=s[0]-r[2]>l?-a:r[2]-s[0]>l?a:0),s[0]+=h}il(e,s)}function pd(s,e,r,a){const l=Math.pow(2,a.z)*cn,h=[a.x*cn,a.y*cn],p=[];if(!s)return p;for(const y of s)for(const b of y){const v=[b.x+h[0],b.y+h[1]];Ec(v,e,r,l),p.push(v)}return p}function Cc(s,e,r,a){const l=Math.pow(2,a.z)*cn,h=[a.x*cn,a.y*cn],p=[];if(!s)return p;for(const b of s){const v=[];for(const E of b){const k=[E.x+h[0],E.y+h[1]];il(e,k),v.push(k)}p.push(v)}if(e[2]-e[0]<=l/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of p)for(const v of b)Ec(v,e,r,l)}var y;return p}class wa{constructor(e,r){this.type=ss,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(uo(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let l=0;l<a.features.length;++l){const h=a.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new wa(a,a.features[l].geometry)}else if(a.type==="Feature"){const l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new wa(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new wa(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=Tc(a.coordinates,h,p),b=pd(r.geometry(),l,h,p);if(!ba(l,h))return!1;for(const v of b)if(!nl(v,y))return!1}if(a.type==="MultiPolygon"){const y=md(a.coordinates,h,p),b=pd(r.geometry(),l,h,p);if(!ba(l,h))return!1;for(const v of b)if(!Nc(v,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=Tc(a.coordinates,h,p),b=Cc(r.geometry(),l,h,p);if(!ba(l,h))return!1;for(const v of b)if(!ys(v,y))return!1}if(a.type==="MultiPolygon"){const y=md(a.coordinates,h,p),b=Cc(r.geometry(),l,h,p);if(!ba(l,h))return!1;for(const v of b)if(!_m(v,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var al=wa;function ja(s){if(s instanceof ln&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof al)return!1;let e=!0;return s.eachChild(r=>{e&&!ja(r)&&(e=!1)}),e}function un(s){if(s instanceof ln&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(r=>{e&&!un(r)&&(e=!1)}),e}function Qn(s,e){if(s instanceof ln&&e.indexOf(s.name)>=0)return!1;let r=!0;return s.eachChild(a=>{r&&!Qn(a,e)&&(r=!1)}),r}class ol{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new ol(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var fd=ol;class fo{constructor(e,r=[],a,l=new ld,h=[]){this.registry=e,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=h,this.expectedType=a}parse(e,r,a,l,h={}){return r?this.concat(r,a,l)._parse(e,h):this._parse(e,h)}_parse(e,r){function a(l,h,p){return p==="assert"?new on(h,[l]):p==="coerce"?new _a(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,b=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else p=a(p,y,r.typeAnnotation||"coerce");else p=a(p,y,r.typeAnnotation||"assert")}if(!(p instanceof Xn)&&p.type.kind!=="resolvedImage"&&Ac(p)){const y=new jc;try{p=new Xn(p.type,p.evaluate(y))}catch(b){return this.error(b.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const l=typeof e=="number"?this.path.concat(e):this.path,h=a?this.scope.concat(a):this.scope;return new fo(this.registry,l,r||null,h,this.errors)}error(e,...r){const a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Ui(a,e))}checkSubtype(e,r){const a=an(e,r);return a&&this.error(a),a}}var kc=fo;function Ac(s){if(s instanceof fd)return Ac(s.boundExpression);if(s instanceof ln&&s.name==="error"||s instanceof mo||s instanceof al)return!1;const e=s instanceof _a||s instanceof on;let r=!0;return s.eachChild(a=>{r=e?r&&Ac(a):r&&a instanceof Xn}),!!r&&ja(s)&&Qn(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ll(s,e){const r=s.length-1;let a,l,h=0,p=r,y=0;for(;h<=p;)if(y=Math.floor((h+p)/2),a=s[y],l=s[y+1],a<=e){if(y===r||e<l)return y;h=y+1}else{if(!(a>e))throw new Lr("Input is not a number.");p=y-1}return 0}class cl{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of a)this.labels.push(l),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Tt);if(!a)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],b=e[p+1],v=p,E=p+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(l.length&&l[l.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const k=r.parse(b,E,h);if(!k)return null;h=h||k.type,l.push([y,k])}return new cl(h,a,l)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const h=r.length;return l>=r[h-1]?a[h-1].evaluate(e):a[ll(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var Mc=cl;function ds(s,e,r){return s*(1-r)+e*r}var go=Object.freeze({__proto__:null,array:function(s,e,r){return s.map((a,l)=>ds(a,e[l],r))},color:function(s,e,r){return new Js(ds(s.r,e.r,r),ds(s.g,e.g,r),ds(s.b,e.b,r),ds(s.a,e.a,r))},number:ds});const gd=.95047,Pc=1.08883,xd=4/29,Jn=6/29,Ic=3*Jn*Jn,bm=Jn*Jn*Jn,vm=Math.PI/180,wm=180/Math.PI;function Dc(s){return s>bm?Math.pow(s,1/3):s/Ic+xd}function Lc(s){return s>Jn?s*s*s:Ic*(s-xd)}function Rc(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function ul(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function yd(s){const e=ul(s.r),r=ul(s.g),a=ul(s.b),l=Dc((.4124564*e+.3575761*r+.1804375*a)/gd),h=Dc((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*h-16,a:500*(l-h),b:200*(h-Dc((.0193339*e+.119192*r+.9503041*a)/Pc)),alpha:s.a}}function _d(s){let e=(s.l+16)/116,r=isNaN(s.a)?e:e+s.a/500,a=isNaN(s.b)?e:e-s.b/200;return e=1*Lc(e),r=gd*Lc(r),a=Pc*Lc(a),new Js(Rc(3.2404542*r-1.5371385*e-.4985314*a),Rc(-.969266*r+1.8760108*e+.041556*a),Rc(.0556434*r-.2040259*e+1.0572252*a),s.alpha)}function jm(s,e,r){const a=e-s;return s+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const xo={forward:yd,reverse:_d,interpolate:function(s,e,r){return{l:ds(s.l,e.l,r),a:ds(s.a,e.a,r),b:ds(s.b,e.b,r),alpha:ds(s.alpha,e.alpha,r)}}},Na={forward:function(s){const{l:e,a:r,b:a}=yd(s),l=Math.atan2(a,r)*wm;return{h:l<0?l+360:l,c:Math.sqrt(r*r+a*a),l:e,alpha:s.a}},reverse:function(s){const e=s.h*vm,r=s.c;return _d({l:s.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:s.alpha})},interpolate:function(s,e,r){return{h:jm(s.h,e.h,r),c:ds(s.c,e.c,r),l:ds(s.l,e.l,r),alpha:ds(s.alpha,e.alpha,r)}}};var zc=Object.freeze({__proto__:null,hcl:Na,lab:xo});class yo{constructor(e,r,a,l,h){this.type=e,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of h)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,r,a,l){let h=0;if(e.name==="exponential")h=Oc(r,e.base,a,l);else if(e.name==="linear")h=Oc(r,1,a,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new Ae(p[0],p[1],p[2],p[3]).solve(Oc(r,1,a,l))}return h}static parse(e,r){let[a,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const v=l[1];if(typeof v!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:v}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const v=l.slice(1);if(v.length!==4||v.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,Tt),!h)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=ui:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let v=0;v<p.length;v+=2){const E=p[v],k=p[v+1],P=v+3,L=v+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(y.length&&y[y.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const R=r.parse(k,L,b);if(!R)return null;b=b||R.type,y.push([E,R])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new yo(b,a,l,h,y):r.error(`Type ${Fs(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const h=r.length;if(l>=r[h-1])return a[h-1].evaluate(e);const p=ll(r,l),y=yo.interpolationFactor(this.interpolation,l,r[p],r[p+1]),b=a[p].evaluate(e),v=a[p+1].evaluate(e);return this.operator==="interpolate"?go[this.type.kind.toLowerCase()](b,v,y):this.operator==="interpolate-hcl"?Na.reverse(Na.interpolate(Na.forward(b),Na.forward(v),y)):xo.reverse(xo.interpolate(xo.forward(b),xo.forward(v),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function Oc(s,e,r,a){const l=a-r,h=s-r;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}var qi=yo;class dl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const l=r.expectedType;l&&l.kind!=="value"&&(a=l);const h=[];for(const y of e.slice(1)){const b=r.parse(y,1+h.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,h.push(b)}const p=l&&h.some(y=>an(l,y.type));return new dl(p?rs:a,h)}evaluate(e){let r,a=null,l=0;for(const h of this.args){if(l++,a=h.evaluate(e),a&&a instanceof bi&&!a.available&&(r||(r=a),a=null,l===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Fc=dl;class hl{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const y=r.parse(e[h+1],h+1);if(!y)return null;a.push([p,y])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return l?new hl(a,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}var bd=hl;class Bc{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Tt),l=r.parse(e[2],2,_i(r.expectedType||rs));return a&&l?new Bc(l.type.itemType,a,l):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Lr(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Lr(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Lr(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Nm=Bc;class Uc{constructor(e,r){this.type=ss,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,rs);return a&&l?ao(a.type,[ss,as,Tt,xa,rs])?new Uc(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!oo(r,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(Zs(r))} instead.`);if(!oo(a,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${Fs(Zs(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ml=Uc;class _o{constructor(e,r,a){this.type=Tt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,rs);if(!a||!l)return null;if(!ao(a.type,[ss,as,Tt,xa,rs]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(a.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Tt);return h?new _o(a,l,h):null}return new _o(a,l)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!oo(r,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(Zs(r))} instead.`);if(!oo(a,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${Fs(Zs(a))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return a.indexOf(r,l)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var vd=_o;class Vc{constructor(e,r,a,l,h,p){this.inputType=e,this.type=r,this.input=a,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},p=[];for(let v=2;v<e.length-1;v+=2){let E=e[v];const k=e[v+1];Array.isArray(E)||(E=[E]);const P=r.concat(v);if(E.length===0)return P.error("Expected at least one branch label.");for(const R of E){if(typeof R!="number"&&typeof R!="string")return P.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,Zs(R)))return null}else a=Zs(R);if(h[String(R)]!==void 0)return P.error("Branch labels must be unique.");h[String(R)]=p.length}const L=r.parse(k,v,l);if(!L)return null;l=l||L.type,p.push(L)}const y=r.parse(e[1],1,rs);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,l);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new Vc(a,l,y,h,p,b):null}evaluate(e){const r=this.input.evaluate(e);return(Zs(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],l={};for(const p of r){const y=l[this.cases[p]];y===void 0?(l[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[y][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of a)e.push(y.length===1?h(y[0]):y.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Sm=Vc;class qc{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const y=r.parse(e[p],p,ss);if(!y)return null;const b=r.parse(e[p+1],p+1,a);if(!b)return null;l.push([y,b]),a=a||b.type}const h=r.parse(e[e.length-1],e.length-1,a);return h?new qc(a,l,h):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var wd=qc;class bo{constructor(e,r,a,l){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rs),l=r.parse(e[2],2,Tt);if(!a||!l)return null;if(!ao(a.type,[_i(rs),as,rs]))return r.error(`Expected first argument to be of type array or string, but found ${Fs(a.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Tt);return h?new bo(a.type,a,l,h):null}return new bo(a.type,a,l)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!oo(r,["string","array"]))throw new Lr(`Expected first argument to be of type array or string, but found ${Fs(Zs(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(a,l)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var jd=bo;function pl(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Nd(s,e,r,a){return a.compare(e,r)===0}function Sa(s,e,r){const a=s!=="=="&&s!=="!=";return class lb{constructor(h,p,y){this.type=ss,this.lhs=h,this.rhs=p,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const y=h[0];let b=p.parse(h[1],1,rs);if(!b)return null;if(!pl(y,b.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Fs(b.type)}'.`);let v=p.parse(h[2],2,rs);if(!v)return null;if(!pl(y,v.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Fs(v.type)}'.`);if(b.type.kind!==v.type.kind&&b.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${Fs(b.type)}' and '${Fs(v.type)}'.`);a&&(b.type.kind==="value"&&v.type.kind!=="value"?b=new on(v.type,[b]):b.type.kind!=="value"&&v.type.kind==="value"&&(v=new on(b.type,[v])));let E=null;if(h.length===4){if(b.type.kind!=="string"&&v.type.kind!=="string"&&b.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(h[3],3,di),!E)return null}return new lb(b,v,E)}evaluate(h){const p=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(a&&this.hasUntypedArgument){const b=Zs(p),v=Zs(y);if(b.kind!==v.kind||b.kind!=="string"&&b.kind!=="number")throw new Lr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${b.kind}, ${v.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Zs(p),v=Zs(y);if(b.kind!=="string"||v.kind!=="string")return e(h,p,y)}return this.collator?r(h,p,y,this.collator.evaluate(h)):e(h,p,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[s];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const Tm=Sa("==",function(s,e,r){return e===r},Nd),Em=Sa("!=",function(s,e,r){return e!==r},function(s,e,r,a){return!Nd(0,e,r,a)}),Cm=Sa("<",function(s,e,r){return e<r},function(s,e,r,a){return a.compare(e,r)<0}),km=Sa(">",function(s,e,r){return e>r},function(s,e,r,a){return a.compare(e,r)>0}),Am=Sa("<=",function(s,e,r){return e<=r},function(s,e,r,a){return a.compare(e,r)<=0}),Sd=Sa(">=",function(s,e,r){return e>=r},function(s,e,r,a){return a.compare(e,r)>=0});class fl{constructor(e,r,a,l,h,p){this.type=as,this.number=e,this.locale=r,this.currency=a,this.unit=l,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Tt);if(!a)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,as),!h))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,as),!p))return null;let y=null;if(l.unit&&(y=r.parse(l.unit,1,as),!y))return null;let b=null;if(l["min-fraction-digits"]&&(b=r.parse(l["min-fraction-digits"],1,Tt),!b))return null;let v=null;return l["max-fraction-digits"]&&(v=r.parse(l["max-fraction-digits"],1,Tt),!v)?null:new fl(a,h,p,y,b,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ta{constructor(e){this.type=Tt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Fs(a.type)} instead.`):new Ta(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Lr(`Expected value to be of type string or array, but found ${Fs(Zs(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Td={"==":Tm,"!=":Em,">":km,"<":Cm,">=":Sd,"<=":Am,array:on,at:Nm,boolean:on,case:wd,coalesce:Fc,collator:mo,format:kn,image:rl,in:ml,"index-of":vd,interpolate:qi,"interpolate-hcl":qi,"interpolate-lab":qi,length:Ta,let:bd,literal:Xn,match:Sm,number:on,"number-format":fl,object:on,slice:jd,step:Mc,string:on,"to-boolean":_a,"to-color":_a,"to-number":_a,"to-string":_a,var:fd,within:al};function Ed(s,[e,r,a,l]){e=e.evaluate(s),r=r.evaluate(s),a=a.evaluate(s);const h=l?l.evaluate(s):1,p=dd(e,r,a,h);if(p)throw new Lr(p);return new Js(e/255*h,r/255*h,a/255*h,h)}function dn(s,e){return s in e}function gl(s,e){const r=e[s];return r===void 0?null:r}function vi(s){return{type:s}}ln.register(Td,{error:[{kind:"error"},[as],(s,[e])=>{throw new Lr(e.evaluate(s))}],typeof:[as,[rs],(s,[e])=>Fs(Zs(e.evaluate(s)))],"to-rgba":[_i(Tt,4),[ui],(s,[e])=>e.evaluate(s).toArray()],rgb:[ui,[Tt,Tt,Tt],Ed],rgba:[ui,[Tt,Tt,Tt,Tt],Ed],has:{type:ss,overloads:[[[as],(s,[e])=>dn(e.evaluate(s),s.properties())],[[as,Pi],(s,[e,r])=>dn(e.evaluate(s),r.evaluate(s))]]},get:{type:rs,overloads:[[[as],(s,[e])=>gl(e.evaluate(s),s.properties())],[[as,Pi],(s,[e,r])=>gl(e.evaluate(s),r.evaluate(s))]]},"feature-state":[rs,[as],(s,[e])=>gl(e.evaluate(s),s.featureState||{})],properties:[Pi,[],s=>s.properties()],"geometry-type":[as,[],s=>s.geometryType()],id:[rs,[],s=>s.id()],zoom:[Tt,[],s=>s.globals.zoom],pitch:[Tt,[],s=>s.globals.pitch||0],"distance-from-center":[Tt,[],s=>s.distanceFromCenter()],"heatmap-density":[Tt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Tt,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[Tt,[],s=>s.globals.skyRadialProgress||0],accumulated:[rs,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Tt,vi(Tt),(s,e)=>{let r=0;for(const a of e)r+=a.evaluate(s);return r}],"*":[Tt,vi(Tt),(s,e)=>{let r=1;for(const a of e)r*=a.evaluate(s);return r}],"-":{type:Tt,overloads:[[[Tt,Tt],(s,[e,r])=>e.evaluate(s)-r.evaluate(s)],[[Tt],(s,[e])=>-e.evaluate(s)]]},"/":[Tt,[Tt,Tt],(s,[e,r])=>e.evaluate(s)/r.evaluate(s)],"%":[Tt,[Tt,Tt],(s,[e,r])=>e.evaluate(s)%r.evaluate(s)],ln2:[Tt,[],()=>Math.LN2],pi:[Tt,[],()=>Math.PI],e:[Tt,[],()=>Math.E],"^":[Tt,[Tt,Tt],(s,[e,r])=>Math.pow(e.evaluate(s),r.evaluate(s))],sqrt:[Tt,[Tt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Tt,[Tt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Tt,[Tt],(s,[e])=>Math.log(e.evaluate(s))],log2:[Tt,[Tt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[Tt,[Tt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Tt,[Tt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Tt,[Tt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Tt,[Tt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Tt,[Tt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Tt,[Tt],(s,[e])=>Math.atan(e.evaluate(s))],min:[Tt,vi(Tt),(s,e)=>Math.min(...e.map(r=>r.evaluate(s)))],max:[Tt,vi(Tt),(s,e)=>Math.max(...e.map(r=>r.evaluate(s)))],abs:[Tt,[Tt],(s,[e])=>Math.abs(e.evaluate(s))],round:[Tt,[Tt],(s,[e])=>{const r=e.evaluate(s);return r<0?-Math.round(-r):Math.round(r)}],floor:[Tt,[Tt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Tt,[Tt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[ss,[as,rs],(s,[e,r])=>s.properties()[e.value]===r.value],"filter-id-==":[ss,[rs],(s,[e])=>s.id()===e.value],"filter-type-==":[ss,[as],(s,[e])=>s.geometryType()===e.value],"filter-<":[ss,[as,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[ss,[as,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[ss,[as,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[ss,[as,rs],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[ss,[rs],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[ss,[rs],(s,[e])=>e.value in s.properties()],"filter-has-id":[ss,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ss,[_i(as)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[ss,[_i(rs)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[ss,[as,_i(rs)],(s,[e,r])=>r.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[ss,[as,_i(rs)],(s,[e,r])=>function(a,l,h,p){for(;h<=p;){const y=h+p>>1;if(l[y]===a)return!0;l[y]>a?p=y-1:h=y+1}return!1}(s.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ss,overloads:[[[ss,ss],(s,[e,r])=>e.evaluate(s)&&r.evaluate(s)],[vi(ss),(s,e)=>{for(const r of e)if(!r.evaluate(s))return!1;return!0}]]},any:{type:ss,overloads:[[[ss,ss],(s,[e,r])=>e.evaluate(s)||r.evaluate(s)],[vi(ss),(s,e)=>{for(const r of e)if(r.evaluate(s))return!0;return!1}]]},"!":[ss,[ss],(s,[e])=>!e.evaluate(s)],"is-supported-script":[ss,[as],(s,[e])=>{const r=s.globals&&s.globals.isSupportedScript;return!r||r(e.evaluate(s))}],upcase:[as,[as],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[as,[as],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[as,vi(rs),(s,e)=>e.map(r=>ho(r.evaluate(s))).join("")],"resolved-locale":[as,[di],(s,[e])=>e.evaluate(s).resolvedLocale()]});var vo=Td;function Cd(s){return{result:"success",value:s}}function Yn(s){return{result:"error",value:s}}function Ea(s){return s["property-type"]==="data-driven"}function xl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function yl(s){return!!s.expression&&s.expression.interpolated}function ms(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function wo(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function kd(s){return s}function _l(s,e){const r=e.type==="color",a=s.stops&&typeof s.stops[0][0]=="object",l=a||!(a||s.property!==void 0),h=s.type||(yl(e)?"exponential":"interval");if(r&&((s=nn({},s)).stops&&(s.stops=s.stops.map(v=>[v[0],Js.parse(v[1])])),s.default=Js.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!zc[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let p,y,b;if(h==="exponential")p=hn;else if(h==="interval")p=bl;else if(h==="categorical"){p=Ad,y=Object.create(null);for(const v of s.stops)y[v[0]]=v[1];b=typeof s.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=Md}if(a){const v={},E=[];for(let L=0;L<s.stops.length;L++){const R=s.stops[L],B=R[0].zoom;v[B]===void 0&&(v[B]={zoom:B,type:s.type,property:s.property,default:s.default,stops:[]},E.push(B)),v[B].stops.push([R[0].value,R[1]])}const k=[];for(const L of E)k.push([v[L].zoom,_l(v[L],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:qi.interpolationFactor.bind(void 0,P),zoomStops:k.map(L=>L[0]),evaluate:({zoom:L},R)=>hn({stops:k,base:s.base},e,L).evaluate(L,R)}}if(l){const v=h==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:qi.interpolationFactor.bind(void 0,v),zoomStops:s.stops.map(E=>E[0]),evaluate:({zoom:E})=>p(s,e,E,y,b)}}return{kind:"source",evaluate(v,E){const k=E&&E.properties?E.properties[s.property]:void 0;return k===void 0?Ca(s.default,e.default):p(s,e,k,y,b)}}}function Ca(s,e,r){return s!==void 0?s:e!==void 0?e:r!==void 0?r:void 0}function Ad(s,e,r,a,l){return Ca(typeof r===l?a[r]:void 0,s.default,e.default)}function bl(s,e,r){if(ms(r)!=="number")return Ca(s.default,e.default);const a=s.stops.length;if(a===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[a-1][0])return s.stops[a-1][1];const l=ll(s.stops.map(h=>h[0]),r);return s.stops[l][1]}function hn(s,e,r){const a=s.base!==void 0?s.base:1;if(ms(r)!=="number")return Ca(s.default,e.default);const l=s.stops.length;if(l===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[l-1][0])return s.stops[l-1][1];const h=ll(s.stops.map(E=>E[0]),r),p=function(E,k,P,L){const R=L-P,B=E-P;return R===0?0:k===1?B/R:(Math.pow(k,B)-1)/(Math.pow(k,R)-1)}(r,a,s.stops[h][0],s.stops[h+1][0]),y=s.stops[h][1],b=s.stops[h+1][1];let v=go[e.type]||kd;if(s.colorSpace&&s.colorSpace!=="rgb"){const E=zc[s.colorSpace];v=(k,P)=>E.reverse(E.interpolate(E.forward(k),E.forward(P),p))}return typeof y.evaluate=="function"?{evaluate(...E){const k=y.evaluate.apply(void 0,E),P=b.evaluate.apply(void 0,E);if(k!==void 0&&P!==void 0)return v(k,P,p)}}:v(y,b,p)}function Md(s,e,r){return e.type==="color"?r=Js.parse(r):e.type==="formatted"?r=ei.fromString(r.toString()):e.type==="resolvedImage"?r=bi.fromString(r.toString()):ms(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Ca(r,s.default,e.default)}class vl{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new jc,this._defaultValue=r?function(a){return a.type==="color"&&(wo(a.default)||Array.isArray(a.default))?new Js(0,0,0,0):a.type==="color"?Js.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,l,h,p,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,l,h,p,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Lr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function ka(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in vo}function Aa(s,e){const r=new kc(vo,[],e?function(l){const h={color:ui,string:as,number:Tt,enum:as,boolean:ss,formatted:no,resolvedImage:Hn};return l.type==="array"?_i(h[l.value]||rs,l.length):h[l.type]}(e):void 0),a=r.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Cd(new vl(a,e)):Yn(r.errors)}class $c{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!un(r.expression)}evaluateWithoutErrorHandling(e,r,a,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,h,p)}evaluate(e,r,a,l,h,p){return this._styleExpression.evaluate(e,r,a,l,h,p)}}class jo{constructor(e,r,a,l){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!un(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,a,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,h,p)}evaluate(e,r,a,l,h,p){return this._styleExpression.evaluate(e,r,a,l,h,p)}interpolationFactor(e,r,a){return this.interpolationType?qi.interpolationFactor(this.interpolationType,e,r,a):0}}function No(s,e){if((s=Aa(s,e)).result==="error")return s;const r=s.value.expression,a=ja(r);if(!a&&!Ea(e))return Yn([new Ui("","data expressions not supported")]);const l=Qn(r,["zoom","pitch","distance-from-center"]);if(!l&&!xl(e))return Yn([new Ui("","zoom expressions not supported")]);const h=jl(r);return h||l?h instanceof Ui?Yn([h]):h instanceof qi&&!yl(e)?Yn([new Ui("",'"interpolate" expressions cannot be used with this property')]):Cd(h?new jo(a?"camera":"composite",s.value,h.labels,h instanceof qi?h.interpolation:void 0):new $c(a?"constant":"source",s.value)):Yn([new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class wl{constructor(e,r){this._parameters=e,this._specification=r,nn(this,_l(this._parameters,this._specification))}static deserialize(e){return new wl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function jl(s){let e=null;if(s instanceof bd)e=jl(s.result);else if(s instanceof Fc){for(const r of s.args)if(e=jl(r),e)break}else(s instanceof Mc||s instanceof qi)&&s.input instanceof ln&&s.input.name==="zoom"&&(e=s);return e instanceof Ui||s.eachChild(r=>{const a=jl(r);a instanceof Ui?e=a:!e&&a?e=new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Et{constructor(e,r,a,l){this.message=(e?`${e}: `:"")+a,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ii(s){const e=s.key,r=s.value,a=s.valueSpec||{},l=s.objectElementValidators||{},h=s.style,p=s.styleSpec;let y=[];const b=ms(r);if(b!=="object")return[new Et(e,r,`object expected, ${b} found`)];for(const v in r){const E=v.split(".")[0];let k;l[E]?k=l[E]:a[E]?k=Vr:l["*"]?k=l["*"]:a["*"]&&(k=Vr),k?y=y.concat(k({key:(e&&`${e}.`)+v,value:r[v],valueSpec:a[E]||a["*"],style:h,styleSpec:p,object:r,objectKey:v},r)):y.push(new Et(e,r[v],`unknown property "${v}"`))}for(const v in a)l[v]||a[v].required&&a[v].default===void 0&&r[v]===void 0&&y.push(new Et(e,r,`missing required property "${v}"`));return y}function Pd(s){const e=s.value,r=s.valueSpec,a=s.style,l=s.styleSpec,h=s.key,p=s.arrayElementValidator||Vr;if(ms(e)!=="array")return[new Et(h,e,`array expected, ${ms(e)} found`)];if(r.length&&e.length!==r.length)return[new Et(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Et(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(y.function=r.function),ms(r.value)==="object"&&(y=r.value);let b=[];for(let v=0;v<e.length;v++)b=b.concat(p({array:e,arrayIndex:v,value:e[v],valueSpec:y,style:a,styleSpec:l,key:`${h}[${v}]`}));return b}function So(s){const e=s.key,r=s.value,a=s.valueSpec;let l=ms(r);if(l==="number"&&r!=r&&(l="NaN"),l!=="number")return[new Et(e,r,`number expected, ${l} found`)];if("minimum"in a){let h=a.minimum;if(ms(a.minimum)==="array"&&(h=a.minimum[s.arrayIndex]),r<h)return[new Et(e,r,`${r} is less than the minimum value ${h}`)]}if("maximum"in a){let h=a.maximum;if(ms(a.maximum)==="array"&&(h=a.maximum[s.arrayIndex]),r>h)return[new Et(e,r,`${r} is greater than the maximum value ${h}`)]}return[]}function To(s){const e=s.valueSpec,r=ir(s.value.type);let a,l,h,p={};const y=r!=="categorical"&&s.value.property===void 0,b=!y,v=ms(s.value.stops)==="array"&&ms(s.value.stops[0])==="array"&&ms(s.value.stops[0][0])==="object",E=Ii({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new Et(L.key,L.value,'identity function may not have a "stops" property')];let R=[];const B=L.value;return R=R.concat(Pd({key:L.key,value:B,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:k})),ms(B)==="array"&&B.length===0&&R.push(new Et(L.key,B,"array must have at least one stop")),R},default:function(L){return Vr({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&y&&E.push(new Et(s.key,s.value,'missing required property "property"')),r==="identity"||s.value.stops||E.push(new Et(s.key,s.value,'missing required property "stops"')),r==="exponential"&&s.valueSpec.expression&&!yl(s.valueSpec)&&E.push(new Et(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(b&&!Ea(s.valueSpec)?E.push(new Et(s.key,s.value,"property functions not supported")):y&&!xl(s.valueSpec)&&E.push(new Et(s.key,s.value,"zoom functions not supported"))),r!=="categorical"&&!v||s.value.property!==void 0||E.push(new Et(s.key,s.value,'"property" property is required')),E;function k(L){let R=[];const B=L.value,X=L.key;if(ms(B)!=="array")return[new Et(X,B,`array expected, ${ms(B)} found`)];if(B.length!==2)return[new Et(X,B,`array length 2 expected, length ${B.length} found`)];if(v){if(ms(B[0])!=="object")return[new Et(X,B,`object expected, ${ms(B[0])} found`)];if(B[0].zoom===void 0)return[new Et(X,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new Et(X,B,"object stop key must have value")];const ie=ir(B[0].zoom);if(typeof ie!="number")return[new Et(X,B[0].zoom,"stop zoom values must be numbers")];if(h&&h>ie)return[new Et(X,B[0].zoom,"stop zoom values must appear in ascending order")];ie!==h&&(h=ie,l=void 0,p={}),R=R.concat(Ii({key:`${X}[0]`,value:B[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:So,value:P}}))}else R=R.concat(P({key:`${X}[0]`,value:B[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},B));return ka(Sr(B[1]))?R.concat([new Et(`${X}[1]`,B[1],"expressions are not allowed in function stops.")]):R.concat(Vr({key:`${X}[1]`,value:B[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function P(L,R){const B=ms(L.value),X=ir(L.value),ie=L.value!==null?L.value:R;if(a){if(B!==a)return[new Et(L.key,ie,`${B} stop domain type must match previous stop domain type ${a}`)]}else a=B;if(B!=="number"&&B!=="string"&&B!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new Et(L.key,ie,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&r!=="categorical"){let pe=`number expected, ${B} found`;return Ea(e)&&r===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Et(L.key,ie,pe)]}return r!=="categorical"||B!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&B==="number"&&typeof X=="number"&&typeof l=="number"&&l!==void 0&&X<l?[new Et(L.key,ie,"stop domain values must appear in ascending order")]:(l=X,r==="categorical"&&X in p?[new Et(L.key,ie,"stop domain values must be unique")]:(p[X]=!0,[])):[new Et(L.key,ie,`integer expected, found ${String(X)}`)]}}function Tr(s){const e=(s.expressionContext==="property"?No:Aa)(Sr(s.value),s.valueSpec);if(e.result==="error")return e.value.map(a=>new Et(`${s.key}${a.key}`,s.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!r.outputDefined())return[new Et(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!un(r))return[new Et(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return Eo(r,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Qn(r,["zoom","feature-state"]))return[new Et(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!ja(r))return[new Et(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Eo(s,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)r.delete(l);if(r.size===0)return[];const a=[];return s instanceof ln&&r.has(s.name)?[new Et(e.key,e.value,`["${s.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(s.eachChild(l=>{a.push(...Eo(l,e))}),a)}function Nl(s){const e=s.key,r=s.value,a=s.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(ir(r))===-1&&l.push(new Et(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ir(r))===-1&&l.push(new Et(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Gc(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Gc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Sl(s,e="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gc(s)||(s=Pa(s));const r=s;let a=!0;try{a=function(v){if(!Ma(v))return v;let E=Sr(v);return Tl(E),E=Id(E),E}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=We[`filter_${e}`],h=Aa(a,l);let p=null;if(h.result==="error")throw new Error(h.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,E,k)=>h.value.evaluate(v,E,{},k);let y=null,b=null;if(a!==r){const v=Aa(r,l);if(v.result==="error")throw new Error(v.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,k,P,L,R)=>v.value.evaluate(E,k,{},P,void 0,void 0,L,R),b=!ja(v.value.expression)}return{filter:p,dynamicFilter:y||void 0,needGeometry:Dd(a),needFeature:!!b}}function Id(s){if(!Array.isArray(s))return s;const e=function(r){if(Zc.has(r[0])){for(let a=1;a<r.length;a++)if(Ma(r[a]))return!0}return r}(s);return e===!0?e:e.map(r=>Id(r))}function Tl(s){let e=!1;const r=[];if(s[0]==="case"){for(let a=1;a<s.length-1;a+=2)e=e||Ma(s[a]),r.push(s[a+1]);r.push(s[s.length-1])}else if(s[0]==="match"){e=e||Ma(s[1]);for(let a=2;a<s.length-1;a+=2)r.push(s[a+1]);r.push(s[s.length-1])}else if(s[0]==="step"){e=e||Ma(s[1]);for(let a=1;a<s.length-1;a+=2)r.push(s[a+1])}e&&(s.length=0,s.push("any",...r));for(let a=1;a<s.length;a++)Tl(s[a])}function Ma(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<s.length;r++)if(Ma(s[r]))return!0;return!1}const Zc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Mm(s,e){return s<e?-1:s>e?1:0}function Dd(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let e=1;e<s.length;e++)if(Dd(s[e]))return!0;return!1}function Pa(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Wc(s[1],s[2],"=="):e==="!="?El(Wc(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Wc(s[1],s[2],e):e==="any"?(r=s.slice(1),["any"].concat(r.map(Pa))):e==="all"?["all"].concat(s.slice(1).map(Pa)):e==="none"?["all"].concat(s.slice(1).map(Pa).map(El)):e==="in"?Hc(s[1],s.slice(2)):e==="!in"?El(Hc(s[1],s.slice(2))):e==="has"?Xc(s[1]):e==="!has"?El(Xc(s[1])):e!=="within"||s;var r}function Wc(s,e,r){switch(s){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,s,e]}}function Hc(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",s,["literal",e.sort(Mm)]]:["filter-in-small",s,["literal",e]]}}function Xc(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function El(s){return["!",s]}function Co(s){return Gc(Sr(s.value))?Tr(nn({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):ko(s)}function ko(s){const e=s.value,r=s.key;if(ms(e)!=="array")return[new Et(r,e,`array expected, ${ms(e)} found`)];const a=s.styleSpec;let l,h=[];if(e.length<1)return[new Et(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Nl({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:s.style,styleSpec:s.styleSpec})),ir(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ir(e[1])==="$type"&&h.push(new Et(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Et(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=ms(e[1]),l!=="string"&&h.push(new Et(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=ms(e[p]),ir(e[1])==="$type"?h=h.concat(Nl({key:`${r}[${p}]`,value:e[p],valueSpec:a.geometry_type,style:s.style,styleSpec:s.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Et(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(ko({key:`${r}[${p}]`,value:e[p],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":l=ms(e[1]),e.length!==2?h.push(new Et(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Et(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=ms(e[1]),e.length!==2?h.push(new Et(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new Et(`${r}[1]`,e[1],`object expected, ${l} found`))}return h}function Kc(s,e){const r=s.key,a=s.style,l=s.styleSpec,h=s.value,p=s.objectKey,y=l[`${e}_${s.layerType}`];if(!y)return[];const b=p.match(/^(.*)-transition$/);if(e==="paint"&&b&&y[b[1]]&&y[b[1]].transition)return Vr({key:r,value:h,valueSpec:l.transition,style:a,styleSpec:l});const v=s.valueSpec||y[p];if(!v)return[new Et(r,h,`unknown property "${p}"`)];let E;if(ms(h)==="string"&&Ea(v)&&!v.tokens&&(E=/^{([^}]+)}$/.exec(h))){const P=`\`{ "type": "identity", "property": ${E?JSON.stringify(E[1]):'"_"'} }\``;return[new Et(r,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: ${P}.`)]}const k=[];return s.layerType==="symbol"&&(p==="text-field"&&a&&!a.glyphs&&k.push(new Et(r,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&wo(Sr(h))&&ir(h.type)==="identity"&&k.push(new Et(r,h,'"text-font" does not support identity functions'))),k.concat(Vr({key:s.key,value:h,valueSpec:v,style:a,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function Ld(s){return Kc(s,"paint")}function Qc(s){return Kc(s,"layout")}function Rd(s){let e=[];const r=s.value,a=s.key,l=s.style,h=s.styleSpec;r.type||r.ref||e.push(new Et(a,r,'either "type" or "ref" is required'));let p=ir(r.type);const y=ir(r.ref);if(r.id){const b=ir(r.id);for(let v=0;v<s.arrayIndex;v++){const E=l.layers[v];ir(E.id)===b&&e.push(new Et(a,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(v=>{v in r&&e.push(new Et(a,r[v],`"${v}" is prohibited for ref layers`))}),l.layers.forEach(v=>{ir(v.id)===y&&(b=v)}),b?b.ref?e.push(new Et(a,r.ref,"ref cannot reference another ref layer")):p=ir(b.type):typeof y=="string"&&e.push(new Et(a,r.ref,`ref layer "${y}" not found`))}else if(p!=="background"&&p!=="sky")if(r.source){const b=l.sources&&l.sources[r.source],v=b&&ir(b.type);b?v==="vector"&&p==="raster"?e.push(new Et(a,r.source,`layer "${r.id}" requires a raster source`)):v==="raster"&&p!=="raster"?e.push(new Et(a,r.source,`layer "${r.id}" requires a vector source`)):v!=="vector"||r["source-layer"]?v==="raster-dem"&&p!=="hillshade"?e.push(new Et(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||v==="geojson"&&b.lineMetrics||e.push(new Et(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Et(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Et(a,r.source,`source "${r.source}" not found`))}else e.push(new Et(a,r,'missing required property "source"'));return e=e.concat(Ii({key:a,value:r,valueSpec:h.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Vr({key:`${a}.type`,value:r.type,valueSpec:h.layer.type,style:s.style,styleSpec:s.styleSpec,object:r,objectKey:"type"}),filter:b=>Co(nn({layerType:p},b)),layout:b=>Ii({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":v=>Qc(nn({layerType:p},v))}}),paint:b=>Ii({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":v=>Ld(nn({layerType:p},v))}})}})),e}function An(s){const e=s.value,r=s.key,a=ms(e);return a!=="string"?[new Et(r,e,`string expected, ${a} found`)]:[]}const zd={promoteId:function({key:s,value:e}){if(ms(e)==="string")return An({key:s,value:e});{const r=[];for(const a in e)r.push(...An({key:`${s}.${a}`,value:e[a]}));return r}}};function Od(s){const e=s.value,r=s.key,a=s.styleSpec,l=s.style;if(!e.type)return[new Et(r,e,'"type" is required')];const h=ir(e.type);let p;switch(h){case"vector":case"raster":case"raster-dem":return p=Ii({key:r,value:e,valueSpec:a[`source_${h.replace("-","_")}`],style:s.style,styleSpec:a,objectElementValidators:zd}),p;case"geojson":if(p=Ii({key:r,value:e,valueSpec:a.source_geojson,style:l,styleSpec:a,objectElementValidators:zd}),e.cluster)for(const y in e.clusterProperties){const[b,v]=e.clusterProperties[y],E=typeof b=="string"?[b,["accumulated"],["get",y]]:b;p.push(...Tr({key:`${r}.${y}.map`,value:v,expressionContext:"cluster-map"})),p.push(...Tr({key:`${r}.${y}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return p;case"video":return Ii({key:r,value:e,valueSpec:a.source_video,style:l,styleSpec:a});case"image":return Ii({key:r,value:e,valueSpec:a.source_image,style:l,styleSpec:a});case"canvas":return[new Et(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nl({key:`${r}.type`,value:e.type,valueSpec:{values:Pm(a)},style:l,styleSpec:a})}}function Pm(s){return s.source.reduce((e,r)=>{const a=s[r];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Fd(s){const e=s.value,r=s.styleSpec,a=r.light,l=s.style;let h=[];const p=ms(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Et("light",e,`object expected, ${p} found`)]),h;for(const y in e){const b=y.match(/^(.*)-transition$/);h=h.concat(b&&a[b[1]]&&a[b[1]].transition?Vr({key:y,value:e[y],valueSpec:r.transition,style:l,styleSpec:r}):a[y]?Vr({key:y,value:e[y],valueSpec:a[y],style:l,styleSpec:r}):[new Et(y,e[y],`unknown property "${y}"`)])}return h}function Jc(s){const e=s.value,r=s.key,a=s.style,l=s.styleSpec,h=l.terrain;let p=[];const y=ms(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new Et("terrain",e,`object expected, ${y} found`)]),p;for(const b in e){const v=b.match(/^(.*)-transition$/);p=p.concat(v&&h[v[1]]&&h[v[1]].transition?Vr({key:b,value:e[b],valueSpec:l.transition,style:a,styleSpec:l}):h[b]?Vr({key:b,value:e[b],valueSpec:h[b],style:a,styleSpec:l}):[new Et(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],v=b&&ir(b.type);b?v!=="raster-dem"&&p.push(new Et(r,e.source,`terrain cannot be used with a source of type ${String(v)}, it only be used with a "raster-dem" source type`)):p.push(new Et(r,e.source,`source "${e.source}" not found`))}else p.push(new Et(r,e,'terrain is missing required property "source"'));return p}function Bd(s){const e=s.value,r=s.style,a=s.styleSpec,l=a.fog;let h=[];const p=ms(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Et("fog",e,`object expected, ${p} found`)]),h;for(const y in e){const b=y.match(/^(.*)-transition$/);h=h.concat(b&&l[b[1]]&&l[b[1]].transition?Vr({key:y,value:e[y],valueSpec:a.transition,style:r,styleSpec:a}):l[y]?Vr({key:y,value:e[y],valueSpec:l[y],style:r,styleSpec:a}):[new Et(y,e[y],`unknown property "${y}"`)])}return h}const Ud={"*":()=>[],array:Pd,boolean:function(s){const e=s.value,r=s.key,a=ms(e);return a!=="boolean"?[new Et(r,e,`boolean expected, ${a} found`)]:[]},number:So,color:function(s){const e=s.key,r=s.value,a=ms(r);return a!=="string"?[new Et(e,r,`color expected, ${a} found`)]:gc(r)===null?[new Et(e,r,`color expected, "${r}" found`)]:[]},enum:Nl,filter:Co,function:To,layer:Rd,object:Ii,source:Od,light:Fd,terrain:Jc,fog:Bd,string:An,formatted:function(s){return An(s).length===0?[]:Tr(s)},resolvedImage:function(s){return An(s).length===0?[]:Tr(s)},projection:function(s){const e=s.value,r=s.styleSpec,a=r.projection,l=s.style;let h=[];const p=ms(e);if(p==="object")for(const y in e)h=h.concat(Vr({key:y,value:e[y],valueSpec:a[y],style:l,styleSpec:r}));else p!=="string"&&(h=h.concat([new Et("projection",e,`object or string expected, ${p} found`)]));return h}};function Vr(s){const e=s.value,r=s.valueSpec,a=s.styleSpec;return r.expression&&wo(ir(e))?To(s):r.expression&&ka(Sr(e))?Tr(s):r.type&&Ud[r.type]?Ud[r.type](s):Ii(nn({},s,{valueSpec:r.type?a[r.type]:r}))}function Im(s){const e=s.value,r=s.key,a=An(s);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Et(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Et(r,e,'"glyphs" url must include a "{range}" token'))),a}function Vd(s,e=We){return wi(Vr({key:"",value:s,valueSpec:e.$root,styleSpec:e,style:s,objectElementValidators:{glyphs:Im,"*":()=>[]}}))}const Dm=s=>wi(Ld(s)),Lm=s=>wi(Qc(s));function wi(s){return s.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function qd(s,e){let r=!1;if(e&&e.length)for(const a of e)s.fire(new rn(new Error(a.message))),r=!0;return r}var Rm=$i,Di=3;function $i(s,e,r){var a=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var l=new Int32Array(this.arrayBuffer);s=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var h=0;h<this.d*this.d;h++){var p=l[Di+h],y=l[Di+h+1];a.push(p===y?null:l.subarray(p,y))}var b=l[Di+a.length+1];this.keys=l.subarray(l[Di+a.length],b),this.bboxes=l.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var v=0;v<this.d*this.d;v++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=s,this.padding=r,this.scale=e/s,this.uid=0;var E=r/e*s;this.min=-E,this.max=s+E}$i.prototype.insert=function(s,e,r,a,l){this._forEachCell(e,r,a,l,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l)},$i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},$i.prototype._insertCell=function(s,e,r,a,l,h){this.cells[l].push(h)},$i.prototype.query=function(s,e,r,a,l){var h=this.min,p=this.max;if(s<=h&&e<=h&&p<=r&&p<=a&&!l)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(s,e,r,a,this._queryCell,y,{},l),y},$i.prototype._queryCell=function(s,e,r,a,l,h,p,y){var b=this.cells[l];if(b!==null)for(var v=this.keys,E=this.bboxes,k=0;k<b.length;k++){var P=b[k];if(p[P]===void 0){var L=4*P;(y?y(E[L+0],E[L+1],E[L+2],E[L+3]):s<=E[L+2]&&e<=E[L+3]&&r>=E[L+0]&&a>=E[L+1])?(p[P]=!0,h.push(v[P])):p[P]=!1}}},$i.prototype._forEachCell=function(s,e,r,a,l,h,p,y){for(var b=this._convertToCellCoord(s),v=this._convertToCellCoord(e),E=this._convertToCellCoord(r),k=this._convertToCellCoord(a),P=b;P<=E;P++)for(var L=v;L<=k;L++){var R=this.d*L+P;if((!y||y(this._convertFromCellCoord(P),this._convertFromCellCoord(L),this._convertFromCellCoord(P+1),this._convertFromCellCoord(L+1)))&&l.call(this,s,e,r,a,R,h,p,y))return}},$i.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},$i.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},$i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,e=Di+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var h=e,p=0;p<s.length;p++){var y=s[p];l[Di+p]=h,l.set(y,h),h+=y.length}return l[Di+s.length]=h,l.set(this.keys,h),l[Di+s.length+1]=h+=this.keys.length,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer};var ea=je(Rm);const Cl={};function Ct(s,e,r={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writeable:!1}),Cl[e]={klass:s,omit:r.omit||[]}}Ct(Object,"Object"),ea.serialize=function(s,e){const r=s.toArrayBuffer();return e&&e.push(r),{buffer:r}},ea.deserialize=function(s){return new ea(s.buffer)},Object.defineProperty(ea,"name",{value:"Grid"}),Ct(ea,"Grid"),Ct(Js,"Color"),Ct(Error,"Error"),Ct(yi,"AJAXError"),Ct(bi,"ResolvedImage"),Ct(wl,"StylePropertyFunction"),Ct(vl,"StyleExpression",{omit:["_evaluator"]}),Ct(jo,"ZoomDependentExpression"),Ct($c,"ZoomConstantExpression"),Ct(ln,"CompoundExpression",{omit:["_evaluate"]});for(const s in vo)Cl[vo[s]._classRegistryKey]||Ct(vo[s],`Expression${s}`);function Yc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function eu(s){return M.ImageBitmap&&s instanceof M.ImageBitmap}function Ia(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Yc(s)||eu(s))return e&&e.push(s),s;if(ArrayBuffer.isView(s)){const r=s;return e&&e.push(r.buffer),r}if(s instanceof M.ImageData)return e&&e.push(s.data.buffer),s;if(Array.isArray(s)){const r=[];for(const a of s)r.push(Ia(a,e));return r}if(typeof s=="object"){const r=s.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const l=r.serialize?r.serialize(s,e):{};if(!r.serialize){for(const h in s)s.hasOwnProperty(h)&&(Cl[a].omit.indexOf(h)>=0||(l[h]=Ia(s[h],e)));s instanceof Error&&(l.message=s.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(l.$name=a),l}throw new Error("can't serialize object of type "+typeof s)}function ta(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Yc(s)||eu(s)||ArrayBuffer.isView(s)||s instanceof M.ImageData)return s;if(Array.isArray(s))return s.map(ta);if(typeof s=="object"){const e=s.$name||"Object",{klass:r}=Cl[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(s);const a=Object.create(r.prototype);for(const l of Object.keys(s))l!=="$name"&&(a[l]=ta(s[l]));return a}throw new Error("can't deserialize object of type "+typeof s)}const St={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function tu(s){for(const e of s)if(su(e.charCodeAt(0)))return!0;return!1}function zm(s){for(const e of s)if(!$d(e.charCodeAt(0)))return!1;return!0}function $d(s){return!(St.Arabic(s)||St["Arabic Supplement"](s)||St["Arabic Extended-A"](s)||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s))}function su(s){return!(s!==746&&s!==747&&(s<4352||!(St["Bopomofo Extended"](s)||St.Bopomofo(s)||St["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||St["CJK Compatibility Ideographs"](s)||St["CJK Compatibility"](s)||St["CJK Radicals Supplement"](s)||St["CJK Strokes"](s)||!(!St["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||St["CJK Unified Ideographs Extension A"](s)||St["CJK Unified Ideographs"](s)||St["Enclosed CJK Letters and Months"](s)||St["Hangul Compatibility Jamo"](s)||St["Hangul Jamo Extended-A"](s)||St["Hangul Jamo Extended-B"](s)||St["Hangul Jamo"](s)||St["Hangul Syllables"](s)||St.Hiragana(s)||St["Ideographic Description Characters"](s)||St.Kanbun(s)||St["Kangxi Radicals"](s)||St["Katakana Phonetic Extensions"](s)||St.Katakana(s)&&s!==12540||!(!St["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!St["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||St["Unified Canadian Aboriginal Syllabics"](s)||St["Unified Canadian Aboriginal Syllabics Extended"](s)||St["Vertical Forms"](s)||St["Yijing Hexagram Symbols"](s)||St["Yi Syllables"](s)||St["Yi Radicals"](s))))}function Gd(s){return!(su(s)||function(e){return!!(St["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||St["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||St["Letterlike Symbols"](e)||St["Number Forms"](e)||St["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||St["Control Pictures"](e)&&e!==9251||St["Optical Character Recognition"](e)||St["Enclosed Alphanumerics"](e)||St["Geometric Shapes"](e)||St["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||St["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||St["CJK Symbols and Punctuation"](e)||St.Katakana(e)||St["Private Use Area"](e)||St["CJK Compatibility Forms"](e)||St["Small Form Variants"](e)||St["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Zd(s){return s>=1424&&s<=2303||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s)}function Om(s,e){return!(!e&&Zd(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||St.Khmer(s))}function Fm(s){for(const e of s)if(Zd(e.charCodeAt(0)))return!0;return!1}const ru="deferred",iu="loading",nu="loaded";let Da=null,u="unavailable",i=null;const o=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(u="error"),Da&&Da(s)};function m(){x.fire(new Wn("pluginStateChange",{pluginStatus:u,pluginURL:i}))}const x=new io,_=function(){return u},j=function(){if(u!==ru||!i)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");u=iu,m(),i&&tn({url:i},s=>{s?o(s):(u=nu,m())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>u===nu||S.applyArabicShaping!=null,isLoading:()=>u===iu,setState(s){u=s.pluginStatus,i=s.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>i};class C{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,a){for(const l of r)if(!Om(l.charCodeAt(0),a))return!1;return!0}(e,S.isLoaded())}}class D{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,l){if(wo(a))return new wl(a,l);if(ka(a)){const h=No(a,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=a;return typeof a=="string"&&l.type==="color"&&(h=Js.parse(a)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class I{constructor(e){this.property=e,this.value=new D(e,void 0)}transitioned(e,r){return new H(this.property,this.value,r,Ut({},e.transition,this.transition),e.now)}untransitioned(){return new H(this.property,this.value,null,{},0)}}class O{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return br(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].value=new D(this._values[e].property,r===null?void 0:br(r))}getTransition(e){return br(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].transition=br(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const a=new J(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(e,r._values[l]);return a}untransitioned(){const e=new J(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class H{constructor(e,r,a,l,h){const p=l.delay||0,y=l.duration||0;h=h||0,this.property=e,this.value=r,this.begin=h+p,this.end=this.begin+y,e.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const l=e.now||0,h=this.value.possiblyEvaluate(e,r,a),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,r,a);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,a),h,yt(y))}}return h}}class J{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const l=new se(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,a);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return br(this._values[e].value)}setValue(e,r){this._values[e]=new D(this._values[e].property,r===null?void 0:br(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const l=new se(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,a);return l}}class Y{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,l){return this.property.evaluate(this.value,this.parameters,e,r,a,l)}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class F{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const l=go[this.specification.type];return l?l(e,r,a):e}}class Q{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,l){return new Y(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,l)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Y(this,{kind:"constant",value:void 0},e.parameters);const l=go[this.specification.type];return l?new Y(this,{kind:"constant",value:l(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,l,h,p){return e.kind==="constant"?e.value:e.evaluate(r,a,l,h,p)}}class ae{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,l){return!!e.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class oe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new C(0,{});for(const a in e){const l=e[a];l.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new D(l,void 0),p=this.defaultTransitionablePropertyValues[a]=new I(l);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate(r)}}}function _e(s,e){return 256*(s=wt(Math.floor(s),0,255))+wt(Math.floor(e),0,255)}Ct(Q,"DataDrivenProperty"),Ct(F,"DataConstantProperty"),Ct(ae,"ColorRampProperty");const ve={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class be{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Me{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ke(s,e=1){let r=0,a=0;return{members:s.map(l=>{const h=ve[l.type].BYTES_PER_ELEMENT,p=r=Be(r,Math.max(e,h)),y=l.components||1;return a=Math.max(a,h),r+=h*y,{name:l.name,type:l.type,components:y,offset:p}}),size:Be(r,Math.max(a,e)),alignment:e}}function Be(s,e){return Math.ceil(s/e)*e}class at extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=a,e}}at.prototype.bytesPerElement=4,Ct(at,"StructArrayLayout2i4");class ze extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=a,this.int16[h+2]=l,e}}ze.prototype.bytesPerElement=6,Ct(ze,"StructArrayLayout3i6");class Qe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=l,this.int16[p+3]=h,e}}Qe.prototype.bytesPerElement=8,Ct(Qe,"StructArrayLayout4i8");class Ve extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,l,h,p,y)}emplace(e,r,a,l,h,p,y,b){const v=6*e,E=12*e,k=3*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.uint8[E+4]=l,this.uint8[E+5]=h,this.uint8[E+6]=p,this.uint8[E+7]=y,this.float32[k+2]=b,e}}Ve.prototype.bytesPerElement=12,Ct(Ve,"StructArrayLayout2i4ub1f12");class nt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=l,this.float32[p+3]=h,e}}nt.prototype.bytesPerElement=16,Ct(nt,"StructArrayLayout4f16");class Fe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=6*e,b=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=a,this.uint16[y+2]=l,this.uint16[y+3]=h,this.float32[b+2]=p,e}}Fe.prototype.bytesPerElement=12,Ct(Fe,"StructArrayLayout4ui1f12");class Xe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=l,this.uint16[p+3]=h,e}}Xe.prototype.bytesPerElement=8,Ct(Xe,"StructArrayLayout4ui8");class lt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,l,h,p)}emplace(e,r,a,l,h,p,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+3]=h,this.int16[b+4]=p,this.int16[b+5]=y,e}}lt.prototype.bytesPerElement=12,Ct(lt,"StructArrayLayout6i12");class st extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,v,E,k,P){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,l,h,p,y,b,v,E,k,P)}emplace(e,r,a,l,h,p,y,b,v,E,k,P,L){const R=12*e;return this.int16[R+0]=r,this.int16[R+1]=a,this.int16[R+2]=l,this.int16[R+3]=h,this.uint16[R+4]=p,this.uint16[R+5]=y,this.uint16[R+6]=b,this.uint16[R+7]=v,this.int16[R+8]=E,this.int16[R+9]=k,this.int16[R+10]=P,this.int16[R+11]=L,e}}st.prototype.bytesPerElement=24,Ct(st,"StructArrayLayout4i4ui4i24");class ct extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,l,h,p)}emplace(e,r,a,l,h,p,y){const b=10*e,v=5*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=l,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=y,e}}ct.prototype.bytesPerElement=20,Ct(ct,"StructArrayLayout3i3f20");class Dt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Dt.prototype.bytesPerElement=4,Ct(Dt,"StructArrayLayout1ul4");class Vt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,v,E,k,P,L){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,a,l,h,p,y,b,v,E,k,P,L)}emplace(e,r,a,l,h,p,y,b,v,E,k,P,L,R){const B=20*e,X=10*e;return this.int16[B+0]=r,this.int16[B+1]=a,this.int16[B+2]=l,this.int16[B+3]=h,this.int16[B+4]=p,this.float32[X+3]=y,this.float32[X+4]=b,this.float32[X+5]=v,this.float32[X+6]=E,this.int16[B+14]=k,this.uint32[X+8]=P,this.uint16[B+18]=L,this.uint16[B+19]=R,e}}Vt.prototype.bytesPerElement=40,Ct(Vt,"StructArrayLayout5i4f1i1ul2ui40");class At extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,l,h,p,y)}emplace(e,r,a,l,h,p,y,b){const v=8*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=l,this.int16[v+4]=h,this.int16[v+5]=p,this.int16[v+6]=y,this.int16[v+7]=b,e}}At.prototype.bytesPerElement=16,Ct(At,"StructArrayLayout3i2i2i16");class Ot extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=l,this.int16[b+6]=h,this.int16[b+7]=p,e}}Ot.prototype.bytesPerElement=16,Ct(Ot,"StructArrayLayout2f1f2i16");class is extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=12*e,y=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=a,this.float32[y+1]=l,this.float32[y+2]=h,e}}is.prototype.bytesPerElement=12,Ct(is,"StructArrayLayout2ub2f12");class ts extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=a,this.float32[h+2]=l,e}}ts.prototype.bytesPerElement=12,Ct(ts,"StructArrayLayout3f12");class Pt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=a,this.uint16[h+2]=l,e}}Pt.prototype.bytesPerElement=6,Ct(Pt,"StructArrayLayout3ui6");class vs extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,v,E,k,P,L,R,B,X,ie,pe,ne,de,xe){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,r,a,l,h,p,y,b,v,E,k,P,L,R,B,X,ie,pe,ne,de,xe)}emplace(e,r,a,l,h,p,y,b,v,E,k,P,L,R,B,X,ie,pe,ne,de,xe,ge){const Ue=30*e,Oe=15*e,He=60*e;return this.int16[Ue+0]=r,this.int16[Ue+1]=a,this.int16[Ue+2]=l,this.float32[Oe+2]=h,this.float32[Oe+3]=p,this.uint16[Ue+8]=y,this.uint16[Ue+9]=b,this.uint32[Oe+5]=v,this.uint32[Oe+6]=E,this.uint32[Oe+7]=k,this.uint16[Ue+16]=P,this.uint16[Ue+17]=L,this.uint16[Ue+18]=R,this.float32[Oe+10]=B,this.float32[Oe+11]=X,this.uint8[He+48]=ie,this.uint8[He+49]=pe,this.uint8[He+50]=ne,this.uint32[Oe+13]=de,this.int16[Ue+28]=xe,this.uint8[He+58]=ge,e}}vs.prototype.bytesPerElement=60,Ct(vs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ws extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,v,E,k,P,L,R,B,X,ie,pe,ne,de,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,it){const dt=this.length;return this.resize(dt+1),this.emplace(dt,e,r,a,l,h,p,y,b,v,E,k,P,L,R,B,X,ie,pe,ne,de,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,it)}emplace(e,r,a,l,h,p,y,b,v,E,k,P,L,R,B,X,ie,pe,ne,de,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,it,dt){const Ze=38*e,vt=19*e;return this.int16[Ze+0]=r,this.int16[Ze+1]=a,this.int16[Ze+2]=l,this.float32[vt+2]=h,this.float32[vt+3]=p,this.int16[Ze+8]=y,this.int16[Ze+9]=b,this.int16[Ze+10]=v,this.int16[Ze+11]=E,this.int16[Ze+12]=k,this.int16[Ze+13]=P,this.uint16[Ze+14]=L,this.uint16[Ze+15]=R,this.uint16[Ze+16]=B,this.uint16[Ze+17]=X,this.uint16[Ze+18]=ie,this.uint16[Ze+19]=pe,this.uint16[Ze+20]=ne,this.uint16[Ze+21]=de,this.uint16[Ze+22]=xe,this.uint16[Ze+23]=ge,this.uint16[Ze+24]=Ue,this.uint16[Ze+25]=Oe,this.uint16[Ze+26]=He,this.uint16[Ze+27]=ot,this.uint16[Ze+28]=qe,this.uint32[vt+15]=Je,this.float32[vt+16]=Ye,this.float32[vt+17]=it,this.float32[vt+18]=dt,e}}ws.prototype.bytesPerElement=76,Ct(ws,"StructArrayLayout3i2f6i15ui1ul3f76");class js extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}js.prototype.bytesPerElement=4,Ct(js,"StructArrayLayout1f4");class Ns extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=l,this.float32[y+3]=h,this.float32[y+4]=p,e}}Ns.prototype.bytesPerElement=20,Ct(Ns,"StructArrayLayout5f20");class qr extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=l,this.uint16[p+4]=h,e}}qr.prototype.bytesPerElement=12,Ct(qr,"StructArrayLayout1ul3ui12");class Er extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=a,e}}Er.prototype.bytesPerElement=4,Ct(Er,"StructArrayLayout2ui4");class ji extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ji.prototype.bytesPerElement=2,Ct(ji,"StructArrayLayout1ui2");class Gi extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=a,e}}Gi.prototype.bytesPerElement=8,Ct(Gi,"StructArrayLayout2f8");class Bs extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Bs.prototype.size=40;class Ss extends Vt{get(e){return new Bs(this,e)}}Ct(Ss,"CollisionBoxArray");class fs extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}fs.prototype.size=60;class nr extends vs{get(e){return new fs(this,e)}}Ct(nr,"PlacedSymbolArray");class Xr extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Xr.prototype.size=76;class zs extends ws{get(e){return new Xr(this,e)}}Ct(zs,"SymbolInstanceArray");class ti extends js{getoffsetX(e){return this.float32[1*e+0]}}Ct(ti,"GlyphOffsetArray");class kl extends at{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ct(kl,"SymbolLineVertexArray");class sa extends be{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sa.prototype.size=12;class Ao extends qr{get(e){return new sa(this,e)}}Ct(Ao,"FeatureIndexArray");class mn extends Er{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ct(mn,"FillExtrusionCentroidArray");const Mn=ke([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ra=ke([{name:"a_dash",components:4,type:"Uint16"}]);var Al={exports:{}},Mo={exports:{}};Mo.exports=function(s,e){var r,a,l,h,p,y,b,v;for(a=s.length-(r=3&s.length),l=e,p=3432918353,y=461845907,v=0;v<a;)b=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24,++v,l=27492+(65535&(h=5*(65535&(l=(l^=b=(65535&(b=(b=(65535&b)*p+(((b>>>16)*p&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&s.charCodeAt(v+2))<<16;case 2:b^=(255&s.charCodeAt(v+1))<<8;case 1:l^=b=(65535&(b=(b=(65535&(b^=255&s.charCodeAt(v)))*p+(((b>>>16)*p&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return l^=s.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var au=Mo.exports,rg={exports:{}};rg.exports=function(s,e){for(var r,a=s.length,l=e^a,h=0;a>=4;)r=1540483477*(65535&(r=255&s.charCodeAt(h)|(255&s.charCodeAt(++h))<<8|(255&s.charCodeAt(++h))<<16|(255&s.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++h;switch(a){case 3:l^=(255&s.charCodeAt(h+2))<<16;case 2:l^=(255&s.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&s.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var ig=au,Ub=rg.exports;Al.exports=ig,Al.exports.murmur3=ig,Al.exports.murmur2=Ub;var Bm=je(Al.exports);class Wd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,l){this.ids.push(ng(e)),this.positions.push(r,a,l)}getPositions(e){const r=ng(e);let a=0,l=this.ids.length-1;for(;a<l;){const p=a+l>>1;this.ids[p]>=r?l=p:a=p+1}const h=[];for(;this.ids[a]===r;)h.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return h}static serialize(e,r){const a=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Um(a,l,0,a.length-1),r&&r.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(e){const r=new Wd;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ng(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Bm(String(s))}function Um(s,e,r,a){for(;r<a;){const l=s[r+a>>1];let h=r-1,p=a+1;for(;;){do h++;while(s[h]<l);do p--;while(s[p]>l);if(h>=p)break;Hd(s,h,p),Hd(e,3*h,3*p),Hd(e,3*h+1,3*p+1),Hd(e,3*h+2,3*p+2)}p-r<a-p?(Um(s,e,r,p),r=p+1):(Um(s,e,p+1,a),a=p)}}function Hd(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}Ct(Wd,"FeaturePositionMap");class ia{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class Xd extends ia{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ag extends ia{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class og extends ia{constructor(e){super(e),this.current=Js.transparent}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Vb=new Float32Array(16),qb=new Float32Array(9),$b=new Float32Array(4);function Vm(s){return[_e(255*s.r,255*s.g),_e(255*s.b,255*s.a)]}class ou{constructor(e,r,a){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(e,r,a,l,h){r.set(e,h,l.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new og(e):new Xd(e)}}class Ml{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,l,h){const p=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;p&&r.set(e,h,p)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new ag(e):new Xd(e)}}class na{constructor(e,r,a,l){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,a,l,h,p){const y=this.paintVertexArray.length,b=this.expression.evaluate(new C(0),r,{},h,l,p);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,a,l,h){const p=this.expression.evaluate({zoom:0},a,l,void 0,h);this._setPaintValue(e,r,p)}_setPaintValue(e,r,a){if(this.type==="color"){const l=Vm(a);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pn{constructor(e,r,a,l,h,p){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,a,l,h,p){const y=this.expression.evaluate(new C(this.zoom),r,{},h,l,p),b=this.expression.evaluate(new C(this.zoom+1),r,{},h,l,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,y,b)}updatePaintArray(e,r,a,l,h){const p=this.expression.evaluate({zoom:this.zoom},a,l,void 0,h),y=this.expression.evaluate({zoom:this.zoom+1},a,l,void 0,h);this._setPaintValue(e,r,p,y)}_setPaintValue(e,r,a,l){if(this.type==="color"){const h=Vm(a),p=Vm(l);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,l,h){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=wt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(e,h,y)}getBinding(e,r){return new Xd(e)}}class La{constructor(e,r,a,l,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(a==="array"?ra:Mn).members;for(let p=0;p<r.length;++p);this.paintVertexArray=new l}populatePaintArray(e,r,a){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,l,h,p){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,r,a,l){if(!l||!a)return;const h=l[a];if(!h)return;const{tl:p,br:y,pixelRatio:b}=h;for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,p[0],p[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ra{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!a(h))continue;const p=e.paint.get(h);if(!(p instanceof Y&&Ea(p.property.specification)))continue;const y=Zb(h,e.type),b=p.value,v=p.property.specification.type,E=!!p.property.useIntegerZoom,k=h==="line-dasharray"||h.endsWith("pattern"),P=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||P)if(b.kind==="source"||P||k){const L=lg(h,v,"source");this.binders[h]=k?new La(b,y,v,L,e.id):new na(b,y,v,L),l.push(`/a_${h}`)}else{const L=lg(h,v,"composite");this.binders[h]=new pn(b,y,v,E,r,L),l.push(`/z_${h}`)}else this.binders[h]=k?new Ml(b.value,y):new ou(b.value,y,v),l.push(`/u_${h}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof na||r instanceof pn?r.maxValue:0}populatePaintArrays(e,r,a,l,h,p){for(const y in this.binders){const b=this.binders[y];(b instanceof na||b instanceof pn||b instanceof La)&&b.populatePaintArray(e,r,a,l,h,p)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof Ml&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,l,h,p){let y=!1;for(const b in e){const v=r.getPositions(b);for(const E of v){const k=a.feature(E.index);for(const P in this.binders){const L=this.binders[P];if((L instanceof na||L instanceof pn||L instanceof La)&&L.expression.isStateDependent===!0){const R=l.paint.get(P);L.expression=R.value,L.updatePaintArray(E.start,E.end,k,e[b],h,p),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof ou||a instanceof Ml)&&e.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof na||a instanceof pn||a instanceof La)for(let l=0;l<a.paintVertexAttributes.length;l++)e.push(a.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof ou||a instanceof Ml||a instanceof pn)for(const l of a.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof ou||l instanceof Ml||l instanceof pn)for(const h of l.uniformNames)r.push({name:h,property:a,binding:l.getBinding(e,h)})}return r}setUniforms(e,r,a,l,h){for(const{name:p,property:y,binding:b}of a)this.binders[y].setUniform(e,b,h,l.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof na||r instanceof pn||r instanceof La)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof na||a instanceof pn||a instanceof La)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof na||r instanceof pn||r instanceof La)&&r.destroy()}}}class Po{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ra(l,r,a);this.needsUpload=!1,this._featureMap=new Wd,this._bufferOffset=0}populatePaintArrays(e,r,a,l,h,p,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,l,h,p,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,l,h){for(const p of a)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,l,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Gb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Zb(s,e){return Gb[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const Wb={"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe},"line-dasharray":{source:Xe,composite:Xe}},Hb={color:{source:Gi,composite:nt},number:{source:js,composite:Gi}};function lg(s,e,r){const a=Wb[s];return a&&a[r]||Hb[e][r]}Ct(ou,"ConstantBinder"),Ct(Ml,"PatternConstantBinder"),Ct(na,"SourceExpressionBinder"),Ct(La,"PatternCompositeBinder"),Ct(pn,"CompositeExpressionBinder"),Ct(Ra,"ProgramConfiguration",{omit:["_buffers"]}),Ct(Po,"ProgramConfigurationSet");const cg="-transition";class fn extends io{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ee(r.layout)),r.paint)){this._transitionablePaint=new O(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Lm,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Jr(e,cg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Dm,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(Jr(e,cg))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.value.isDataDriven(),p=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,b=y.isDataDriven(),v=Jr(e,"pattern")||e==="line-dasharray";return b||h||v||this._handleOverridablePaintPropertyUpdate(e,p,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),gi(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,l,h={}){return(!h||h.validate!==!1)&&qd(this,e.call(Vd,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:We,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Y&&Ea(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Xb=ke([{name:"a_pos",components:2,type:"Int16"}],4),Kb=ke([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ar{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,l){let h=this.segments[this.segments.length-1];return e>ar.MAX_VERTEX_ARRAY_LENGTH&&As(`Max vertices per segment is ${ar.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ar.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,l){return new ar([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}ar.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct(ar,"SegmentVector");var zt=8192;class za{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ts?new Ts(e.lng,e.lat):Ts.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ts?new Ts(e.lng,e.lat):Ts.convert(e),this}extend(e){const r=this._sw,a=this._ne;let l,h;if(e instanceof Ts)l=e,h=e;else{if(!(e instanceof za))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(za.convert(e)):this.extend(Ts.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Ts.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return r||a?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new Ts(l.lng,l.lat),this._ne=new Ts(h.lng,h.lat)),this}getCenter(){return new Ts((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ts(this.getWest(),this.getNorth())}getSouthEast(){return new Ts(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=Ts.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return!e||e instanceof za?e:new za(e)}}var Kd=1e-6,Ni=typeof Float32Array<"u"?Float32Array:Array;function ug(){var s=new Ni(9);return Ni!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function dg(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],v=e[6],E=e[7],k=e[8],P=r[0],L=r[1],R=r[2],B=r[3],X=r[4],ie=r[5],pe=r[6],ne=r[7],de=r[8];return s[0]=P*a+L*p+R*v,s[1]=P*l+L*y+R*E,s[2]=P*h+L*b+R*k,s[3]=B*a+X*p+ie*v,s[4]=B*l+X*y+ie*E,s[5]=B*h+X*b+ie*k,s[6]=pe*a+ne*p+de*v,s[7]=pe*l+ne*y+de*E,s[8]=pe*h+ne*b+de*k,s}function gn(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function qm(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=e[4],y=e[5],b=e[6],v=e[7],E=e[8],k=e[9],P=e[10],L=e[11],R=e[12],B=e[13],X=e[14],ie=e[15],pe=r*y-a*p,ne=r*b-l*p,de=r*v-h*p,xe=a*b-l*y,ge=a*v-h*y,Ue=l*v-h*b,Oe=E*B-k*R,He=E*X-P*R,ot=E*ie-L*R,qe=k*X-P*B,Je=k*ie-L*B,Ye=P*ie-L*X,it=pe*Ye-ne*Je+de*qe+xe*ot-ge*He+Ue*Oe;return it?(s[0]=(y*Ye-b*Je+v*qe)*(it=1/it),s[1]=(l*Je-a*Ye-h*qe)*it,s[2]=(B*Ue-X*ge+ie*xe)*it,s[3]=(P*ge-k*Ue-L*xe)*it,s[4]=(b*ot-p*Ye-v*He)*it,s[5]=(r*Ye-l*ot+h*He)*it,s[6]=(X*de-R*Ue-ie*ne)*it,s[7]=(E*Ue-P*de+L*ne)*it,s[8]=(p*Je-y*ot+v*Oe)*it,s[9]=(a*ot-r*Je-h*Oe)*it,s[10]=(R*ge-B*de+ie*pe)*it,s[11]=(k*de-E*ge-L*pe)*it,s[12]=(y*He-p*qe-b*Oe)*it,s[13]=(r*qe-a*He+l*Oe)*it,s[14]=(B*ne-R*xe-X*pe)*it,s[15]=(E*xe-k*ne+P*pe)*it,s):null}function Io(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],v=e[6],E=e[7],k=e[8],P=e[9],L=e[10],R=e[11],B=e[12],X=e[13],ie=e[14],pe=e[15],ne=r[0],de=r[1],xe=r[2],ge=r[3];return s[0]=ne*a+de*y+xe*k+ge*B,s[1]=ne*l+de*b+xe*P+ge*X,s[2]=ne*h+de*v+xe*L+ge*ie,s[3]=ne*p+de*E+xe*R+ge*pe,s[4]=(ne=r[4])*a+(de=r[5])*y+(xe=r[6])*k+(ge=r[7])*B,s[5]=ne*l+de*b+xe*P+ge*X,s[6]=ne*h+de*v+xe*L+ge*ie,s[7]=ne*p+de*E+xe*R+ge*pe,s[8]=(ne=r[8])*a+(de=r[9])*y+(xe=r[10])*k+(ge=r[11])*B,s[9]=ne*l+de*b+xe*P+ge*X,s[10]=ne*h+de*v+xe*L+ge*ie,s[11]=ne*p+de*E+xe*R+ge*pe,s[12]=(ne=r[12])*a+(de=r[13])*y+(xe=r[14])*k+(ge=r[15])*B,s[13]=ne*l+de*b+xe*P+ge*X,s[14]=ne*h+de*v+xe*L+ge*ie,s[15]=ne*p+de*E+xe*R+ge*pe,s}function lu(s,e,r){var a,l,h,p,y,b,v,E,k,P,L,R,B=r[0],X=r[1],ie=r[2];return e===s?(s[12]=e[0]*B+e[4]*X+e[8]*ie+e[12],s[13]=e[1]*B+e[5]*X+e[9]*ie+e[13],s[14]=e[2]*B+e[6]*X+e[10]*ie+e[14],s[15]=e[3]*B+e[7]*X+e[11]*ie+e[15]):(l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],v=e[6],E=e[7],k=e[8],P=e[9],L=e[10],R=e[11],s[0]=a=e[0],s[1]=l,s[2]=h,s[3]=p,s[4]=y,s[5]=b,s[6]=v,s[7]=E,s[8]=k,s[9]=P,s[10]=L,s[11]=R,s[12]=a*B+y*X+k*ie+e[12],s[13]=l*B+b*X+P*ie+e[13],s[14]=h*B+v*X+L*ie+e[14],s[15]=p*B+E*X+R*ie+e[15]),s}function Do(s,e,r){var a=r[0],l=r[1],h=r[2];return s[0]=e[0]*a,s[1]=e[1]*a,s[2]=e[2]*a,s[3]=e[3]*a,s[4]=e[4]*l,s[5]=e[5]*l,s[6]=e[6]*l,s[7]=e[7]*l,s[8]=e[8]*h,s[9]=e[9]*h,s[10]=e[10]*h,s[11]=e[11]*h,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function $m(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[4],p=e[5],y=e[6],b=e[7],v=e[8],E=e[9],k=e[10],P=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=h*l+v*a,s[5]=p*l+E*a,s[6]=y*l+k*a,s[7]=b*l+P*a,s[8]=v*l-h*a,s[9]=E*l-p*a,s[10]=k*l-y*a,s[11]=P*l-b*a,s}function Qd(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],y=e[2],b=e[3],v=e[8],E=e[9],k=e[10],P=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=h*l-v*a,s[1]=p*l-E*a,s[2]=y*l-k*a,s[3]=b*l-P*a,s[8]=h*a+v*l,s[9]=p*a+E*l,s[10]=y*a+k*l,s[11]=b*a+P*l,s}function hg(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function mg(s,e,r){var a,l,h,p=r[0],y=r[1],b=r[2],v=Math.hypot(p,y,b);return v<Kd?null:(p*=v=1/v,y*=v,b*=v,a=Math.sin(e),l=Math.cos(e),s[0]=p*p*(h=1-l)+l,s[1]=y*p*h+b*a,s[2]=b*p*h-y*a,s[3]=0,s[4]=p*y*h-b*a,s[5]=y*y*h+l,s[6]=b*y*h+p*a,s[7]=0,s[8]=p*b*h+y*a,s[9]=y*b*h-p*a,s[10]=b*b*h+l,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});var Qb=Io;function Gm(){var s=new Ni(3);return Ni!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function pg(s){var e=new Ni(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function cu(s){return Math.hypot(s[0],s[1],s[2])}function Pl(s,e,r){var a=new Ni(3);return a[0]=s,a[1]=e,a[2]=r,a}function aa(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s[2]=e[2]+r[2],s}function Zm(s,e,r){return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],s}function fg(s,e,r){return s[0]=e[0]*r[0],s[1]=e[1]*r[1],s[2]=e[2]*r[2],s}function uu(s,e,r){return s[0]=Math.min(e[0],r[0]),s[1]=Math.min(e[1],r[1]),s[2]=Math.min(e[2],r[2]),s}function du(s,e,r){return s[0]=Math.max(e[0],r[0]),s[1]=Math.max(e[1],r[1]),s[2]=Math.max(e[2],r[2]),s}function Li(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s}function hu(s,e,r,a){return s[0]=e[0]+r[0]*a,s[1]=e[1]+r[1]*a,s[2]=e[2]+r[2]*a,s}function si(s,e){var r=e[0],a=e[1],l=e[2],h=r*r+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),s[0]=e[0]*h,s[1]=e[1]*h,s[2]=e[2]*h,s}function Zi(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Wm(s,e,r){var a=e[0],l=e[1],h=e[2],p=r[0],y=r[1],b=r[2];return s[0]=l*b-h*y,s[1]=h*p-a*b,s[2]=a*y-l*p,s}function Ys(s,e,r){var a=e[0],l=e[1],h=e[2],p=r[3]*a+r[7]*l+r[11]*h+r[15];return s[0]=(r[0]*a+r[4]*l+r[8]*h+r[12])/(p=p||1),s[1]=(r[1]*a+r[5]*l+r[9]*h+r[13])/p,s[2]=(r[2]*a+r[6]*l+r[10]*h+r[14])/p,s}function gg(s,e,r){var a=r[0],l=r[1],h=r[2],p=e[0],y=e[1],b=e[2],v=l*b-h*y,E=h*p-a*b,k=a*y-l*p,P=l*k-h*E,L=h*v-a*k,R=a*E-l*v,B=2*r[3];return E*=B,k*=B,L*=2,R*=2,s[0]=p+(v*=B)+(P*=2),s[1]=y+E+L,s[2]=b+k+R,s}var mu,xn=Zm,Jb=fg,Yb=cu;function xg(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s[3]=e[3]*r,s}function yg(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=r*r+a*a+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),s[0]=r*p,s[1]=a*p,s[2]=l*p,s[3]=h*p,s}function Lo(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3];return s[0]=r[0]*a+r[4]*l+r[8]*h+r[12]*p,s[1]=r[1]*a+r[5]*l+r[9]*h+r[13]*p,s[2]=r[2]*a+r[6]*l+r[10]*h+r[14]*p,s[3]=r[3]*a+r[7]*l+r[11]*h+r[15]*p,s}function _g(){var s=new Ni(4);return Ni!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function bg(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function vg(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b+p*y,s[1]=l*b+h*y,s[2]=h*b-l*y,s[3]=p*b-a*y,s}function wg(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b-h*y,s[1]=l*b+p*y,s[2]=h*b+a*y,s[3]=p*b-l*y,s}Gm(),mu=new Ni(4),Ni!=Float32Array&&(mu[0]=0,mu[1]=0,mu[2]=0,mu[3]=0);var ev=yg;Gm(),Pl(1,0,0),Pl(0,1,0),_g(),_g(),ug();const tv=ke([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jg}=tv,Ng=ke([{name:"a_pos_3",components:3,type:"Int16"}]);var pu=ke([{name:"a_pos",type:"Int16",components:2}]);class Hm{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const l=Zi(r,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/l;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,r,a){if(function(L,R){var B=L[0],X=L[1],ie=L[2],pe=R[0],ne=R[1],de=R[2];return Math.abs(B-pe)<=Kd*Math.max(1,Math.abs(B),Math.abs(pe))&&Math.abs(X-ne)<=Kd*Math.max(1,Math.abs(X),Math.abs(ne))&&Math.abs(ie-de)<=Kd*Math.max(1,Math.abs(ie),Math.abs(de))}(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[l,h,p]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],v=this.pos[2]-e[2],E=l*l+h*h+p*p,k=2*(y*l+b*h+v*p),P=k*k-4*E*(y*y+b*b+v*v-r*r);if(P<0){const L=Math.max(-k/2,0),R=y+l*L,B=b+h*L,X=v+p*L,ie=Math.hypot(R,B,X);return a[0]=R*r/ie,a[1]=B*r/ie,a[2]=X*r/ie,!1}{const L=(-k-Math.sqrt(P))/(2*E);if(L<0){const R=Math.hypot(y,b,v);return a[0]=y*r/R,a[1]=b*r/R,a[2]=v*r/R,!1}return a[0]=y+l*L,a[1]=b+h*L,a[2]=v+p*L,!0}}}class Xm{constructor(e,r,a,l,h){this.TL=e,this.TR=r,this.BR=a,this.BL=l,this.horizon=h}static fromInvProjectionMatrix(e,r,a){const l=[-1,1,1],h=[1,1,1],p=[1,-1,1],y=[-1,-1,1],b=Ys(l,l,e),v=Ys(h,h,e),E=Ys(p,p,e),k=Ys(y,y,e);return new Xm(b,v,E,k,r/a)}}class Km{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a,l){const h=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const v=Lo([],b,e),E=1/v[3]/r*h;return function(k,P,L){return k[0]=P[0]*L[0],k[1]=P[1]*L[1],k[2]=P[2]*L[2],k[3]=P[3]*L[3],k}(v,v,[E,E,l?1/v[3]:E,E])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const v=si([],Wm([],xn([],p[b[0]],p[b[1]]),xn([],p[b[2]],p[b[1]]))),E=-Zi(v,p[b[1]]);return v.concat(E)});return new Km(p,y)}}class ri{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const l of e)uu(r,r,l),du(a,a,l);return new ri(r,a)}static applyTransform(e,r){const a=e.getCorners();for(let l=0;l<a.length;++l)Ys(a[l],a[l],r);return ri.fromPoints(a)}constructor(e,r){this.min=e,this.max=r,this.center=Li([],aa([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=pg(this.min),l=pg(this.max);for(let h=0;h<r.length;h++)a[h]=r[h]?this.min[h]:this.center[h],l[h]=r[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new ri(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let a=!0;for(let l=0;l<e.planes.length;l++){const h=e.planes[l];let p=0;for(let y=0;y<r.length;y++)p+=Zi(h,r[y])+h[3]>=0;if(p===0)return 0;p!==r.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let h=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][l]-this.min[l];h=Math.min(h,b),p=Math.max(p,b)}if(p<0||h>this.max[l]-this.min[l])return 0}return 1}}const Qm=5,Sg=6,Pn=zt/Math.PI/2,sv=16383,Ro=64,fu=[Ro,32,16],Wi=-Pn,Hi=Pn,rv=[new ri([Wi,Wi,Wi],[Hi,Hi,Hi]),new ri([Wi,Wi,Wi],[0,0,Hi]),new ri([0,Wi,Wi],[Hi,0,Hi]),new ri([Wi,0,Wi],[0,Hi,Hi]),new ri([0,0,Wi],[Hi,Hi,Hi])];function Jd(s){return s*Pn/yu}function Tg(s,e,r,a=!0){const l=Li([],s._camera.position,s.worldSize),h=[e,r,1,1];Lo(h,h,s.pixelMatrixInverse),xg(h,h,1/h[3]);const p=si([],xn([],h,l)),y=s.globeMatrix,b=[y[12],y[13],y[14]],v=xn([],b,l),E=cu(v),k=si([],v),P=s.worldSize/(2*Math.PI),L=Zi(k,p),R=Math.asin(P/E);if(R<Math.acos(L)){if(!a)return null;const ot=[],qe=[];Li(ot,p,E/L),si(qe,xn(qe,ot,v)),si(p,aa(p,v,Li(p,qe,Math.tan(R)*E)))}const B=[];new Hm(l,p).closestPointOnSphere(b,P,B);const X=si([],Nt(y,0)),ie=si([],Nt(y,1)),pe=si([],Nt(y,2)),ne=Zi(X,B),de=Zi(ie,B),xe=Zi(pe,B),ge=rt(Math.asin(-de/P));let Ue=rt(Math.atan2(ne,xe));Ue=s.center.lng+function(ot,qe){const Je=(qe-ot+180)%360-180;return Je<-180?Je+360:Je}(s.center.lng,Ue);const Oe=Dn(Ue),He=wt(Ln(ge),0,1);return new Rl(Oe,He)}class iv{constructor(e,r,a){this.a=xn([],e,a),this.b=xn([],r,a),this.center=a;const l=si([],this.a),h=si([],this.b);this.angle=Math.acos(Zi(l,h))}}function Jm(s,e){if(s.angle===0)return null;let r;return r=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),r<0||r>1?null:function(a,l,h,p){const y=Math.sin(h);return a*(Math.sin((1-p)*h)/y)+l*(Math.sin(p*h)/y)}(s.a[e],s.b[e],s.angle,wt(r,0,1))+s.center[e]}function In(s){if(s.z<=1)return rv[s.z+2*s.y+s.x];const e=Ym(Yd(s));return ri.fromPoints(e)}function zo(s,e,r){return Li(s,s,1-r),hu(s,s,e,r)}function Eg(s,e){const r=Ll(e.zoom);if(r===0)return In(s);const a=Yd(s),l=Ym(a),h=Dn(a.getWest())*e.worldSize,p=Dn(a.getEast())*e.worldSize,y=Ln(a.getNorth())*e.worldSize,b=Ln(a.getSouth())*e.worldSize,v=[h,y,0],E=[p,y,0],k=[h,b,0],P=[p,b,0],L=qm([],e.globeMatrix);return Ys(v,v,L),Ys(E,E,L),Ys(k,k,L),Ys(P,P,L),l[0]=zo(l[0],k,r),l[1]=zo(l[1],P,r),l[2]=zo(l[2],E,r),l[3]=zo(l[3],v,r),ri.fromPoints(l)}function Cg(s,e,r){for(const a of s)Ys(a,a,e),Li(a,a,r)}function nv(s,e,r){const a=e/s.worldSize,l=s.globeMatrix;if(r.z<=1){const Oe=In(r).getCorners();return Cg(Oe,l,a),ri.fromPoints(Oe)}const h=Yd(r),p=Ym(h);Cg(p,l,a);const y=Number.MAX_VALUE,b=[-y,-y,-y],v=[y,y,y];if(h.contains(s.center)){for(const ot of p)uu(v,v,ot),du(b,b,ot);b[2]=0;const Oe=s.point,He=[Oe.x*a,Oe.y*a,0];return uu(v,v,He),du(b,b,He),new ri(v,b)}const E=[l[12]*a,l[13]*a,l[14]*a],k=h.getCenter(),P=wt(s.center.lat,-Gr,Gr),L=wt(k.lat,-Gr,Gr),R=Dn(s.center.lng),B=Ln(P);let X=R-Dn(k.lng);const ie=B-Ln(L);X>.5?X-=1:X<-.5&&(X+=1);let pe=0;Math.abs(X)>Math.abs(ie)?pe=X>=0?1:3:(pe=ie>=0?0:2,hu(E,E,[l[4]*a,l[5]*a,l[6]*a],-Math.sin(Te(ie>=0?h.getSouth():h.getNorth()))*Pn));const ne=p[pe],de=p[(pe+1)%4],xe=new iv(ne,de,E),ge=[Jm(xe,0)||ne[0],Jm(xe,1)||ne[1],Jm(xe,2)||ne[2]],Ue=Ll(s.zoom);if(Ue>0){const Oe=function({x:ot,y:qe,z:Je},Ye,it,dt,Ze){const vt=1/(1<<Je);let Mt=ot*vt,jt=Mt+vt,$t=qe*vt,ht=$t+vt,Rt=0;const Gt=(Mt+jt)/2-dt;return Gt>.5?Rt=-1:Gt<-.5&&(Rt=1),Mt=((Mt+Rt)*Ye-(dt*=Ye))*it+dt,jt=((jt+Rt)*Ye-dt)*it+dt,$t=($t*Ye-(Ze*=Ye))*it+Ze,ht=(ht*Ye-Ze)*it+Ze,[[Mt,ht,0],[jt,ht,0],[jt,$t,0],[Mt,$t,0]]}(r,e,s._pixelsPerMercatorPixel,R,B);for(let ot=0;ot<p.length;ot++)zo(p[ot],Oe[ot],Ue);const He=aa([],Oe[pe],Oe[(pe+1)%4]);Li(He,He,.5),zo(ge,He,Ue)}for(const Oe of p)uu(v,v,Oe),du(b,b,Oe);return v[2]=Math.min(ne[2],de[2]),uu(v,v,ge),du(b,b,ge),new ri(v,b)}function Yd({x:s,y:e,z:r}){const a=1/(1<<r),l=new Ts(Ri(s*a),$r((e+1)*a)),h=new Ts(Ri((s+1)*a),$r(e*a));return new za(l,h)}function Ym(s){const e=Te(s.getNorth()),r=Te(s.getSouth()),a=Math.cos(e),l=Math.cos(r),h=Math.sin(e),p=Math.sin(r),y=s.getWest(),b=s.getEast();return[Il(l,p,y),Il(l,p,b),Il(a,h,b),Il(a,h,y)]}function Il(s,e,r,a=Pn){return r=Te(r),[s*Math.sin(r)*a,-e*a,s*Math.cos(r)*a]}function Dl(s,e,r){return Il(Math.cos(Te(s)),Math.sin(Te(s)),e,r)}function gu(s,e,r,a){const l=1<<r.z,h=(s/zt+r.x)/l;return Dl($r((e/zt+r.y)/l),Ri(h),a)}function eh({min:s,max:e}){return sv/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const kg=new Float64Array(16);function xu(s){const e=eh(s),r=hg(kg,[e,e,e]);return lu(r,r,((a=[])[0]=-(l=s.min)[0],a[1]=-l[1],a[2]=-l[2],a));var a,l}function ep(s){const e=(a=s.min,(r=kg)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r);var r,a;const l=1/eh(s);return Do(e,e,[l,l,l])}function Ag(s,e,r,a,l){const h=function(b){const v=zt/(2*Math.PI);return b/(2*Math.PI)/v}(r),p=[s,e,-r/(2*Math.PI)],y=gn(new Float64Array(16));return lu(y,y,p),Do(y,y,[h,h,h]),$m(y,y,Te(-l)),Qd(y,y,Te(-a)),y}function Ll(s){return Os(Qm,Sg,s)}function Mg(s,e){const r=Dl(e.lat,e.lng),a=function(R){const B=Dl(R._center.lat,R._center.lng);let X=Wm([],Pl(0,1,0),B);const ie=mg([],-R.angle,B);X=Ys(X,X,ie),mg(ie,-R._pitch,X);const pe=si([],B);return Li(pe,pe,Jd(R.cameraToCenterDistance/R.pixelsPerMeter)),Ys(pe,pe,ie),aa([],B,pe)}(s);return p=(l=Zm([],a,r))[0],y=l[1],b=l[2],v=(h=r)[0],E=h[1],k=h[2],L=(P=Math.sqrt(p*p+y*y+b*b)*Math.sqrt(v*v+E*E+k*k))&&Zi(l,h)/P,Math.acos(Math.min(Math.max(L,-1),1));var l,h,p,y,b,v,E,k,P,L}function tp(s,e){return Mg(s,e)>Math.PI/2*1.01}const Pg=Te(85),av=Math.cos(Pg),ov=Math.sin(Pg),yu=63710088e-1,Ig=2*Math.PI*yu;class Oa{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oa(ns(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,l=e.lat*r,h=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return yu*Math.acos(Math.min(h,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new za(new Oa(this.lng-a,this.lat-r),new Oa(this.lng+a,this.lat+r))}toEcef(e){const r=Jd(e);return Dl(this.lat,this.lng,Pn+r)}static convert(e){if(e instanceof Oa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ts=Oa;function sp(s){return Ig*Math.cos(s*Math.PI/180)}function Dn(s){return(180+s)/360}function Ln(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function yn(s,e){return s/sp(e)}function Ri(s){return 360*s-180}function $r(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Dg(s,e){return s*sp($r(e))}const Gr=85.051129;function Lg(s){return 1/Math.cos(s*Math.PI/180)}class Rl{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Ts.convert(e);return new Rl(Dn(a.lng),Ln(a.lat),yn(r,a.lat))}toLngLat(){return new Ts(Ri(this.x),$r(this.y))}toAltitude(){return Dg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ig*Lg($r(this.y))}}function rp(s,e,r,a,l,h,p,y,b){const v=(e+a)/2,E=(r+l)/2,k=new Ee(v,E);y(k),function(P,L,R,B,X,ie){const pe=R-X,ne=B-ie;return Math.abs((B-L)*pe-(R-P)*ne)/Math.hypot(pe,ne)}(k.x,k.y,h.x,h.y,p.x,p.y)>=b?(rp(s,e,r,v,E,h,k,y,b),rp(s,v,E,a,l,k,p,y,b)):s.push(p)}function Rg(s,e,r){let a=s[0],l=a.x,h=a.y;e(a);const p=[a];for(let y=1;y<s.length;y++){const b=s[y],{x:v,y:E}=b;e(b),rp(p,l,h,v,E,a,b,e,r),l=v,h=E,a=b}return p}function ip(s,e,r,a){if(a(e,r)){const l=e.add(r)._mult(.5);ip(s,e,l,a),ip(s,l,r,a)}else s.push(r)}function lv(s,e){let r=s[0];const a=[r];for(let l=1;l<s.length;l++){const h=s[l];ip(a,r,h,e),r=h}return a}const np=Math.pow(2,14)-1,zg=-np-1;function cv(s,e){const r=Math.round(s.x*e),a=Math.round(s.y*e);return s.x=wt(r,zg,np),s.y=wt(a,zg,np),(r<s.x||r>s.x+1||a<s.y||a>s.y+1)&&As("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function oa(s,e,r){const a=s.loadGeometry(),l=s.extent,h=zt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:b,y:v,projection:E}=r,k=P=>{const L=Ri((e.x+P.x/l)/p),R=$r((e.y+P.y/l)/p),B=E.project(L,R);P.x=(B.x*y-b)*l,P.y=(B.y*y-v)*l};for(let P=0;P<a.length;P++)if(s.type!==1)a[P]=Rg(a[P],k,1);else{const L=[];for(const R of a[P])R.x<0||R.x>=l||R.y<0||R.y>=l||(k(R),L.push(R));a[P]=L}}for(const p of a)for(const y of p)cv(y,h);return a}function Oo(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?oa(s):[]}}function th(s,e,r,a,l){s.emplaceBack(2*e+(a+1)/2,2*r+(l+1)/2)}function sh(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class ap{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new at,this.indexArray=new Pt,this.segments=new ar,this.programConfigurations=new Po(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,l){const h=this.layers[0],p=[];let y=null;h.type==="circle"&&(y=h.layout.get("circle-sort-key"));for(const{feature:v,id:E,index:k,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,R=Oo(v,L);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),R,a))continue;const B=y?y.evaluate(R,{},a):void 0,X={id:E,properties:v.properties,type:v.type,sourceLayerIndex:P,index:k,geometry:L?R.geometry:oa(v,a,l),patterns:{},sortKey:B};p.push(X)}y&&p.sort((v,E)=>v.sortKey-E.sortKey);let b=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new lt,b=l.projection);for(const v of p){const{geometry:E,index:k,sourceLayerIndex:P}=v,L=e[k].feature;this.addFeature(v,E,k,r.availableImages,a,b),r.featureIndex.insert(L,E,k,P,this.index)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Kb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,l,h,p){for(const y of r)for(const b of y){const v=b.x,E=b.y;if(v<0||v>=zt||E<0||E>=zt)continue;if(p){const L=p.projectTilePoint(v,E,h),R=p.upVector(h,v,E),B=this.globeExtVertexArray;sh(B,L,R),sh(B,L,R),sh(B,L,R),sh(B,L,R)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=k.vertexLength;th(this.layoutVertexArray,v,E,-1,-1),th(this.layoutVertexArray,v,E,1,-1),th(this.layoutVertexArray,v,E,1,1),th(this.layoutVertexArray,v,E,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},l,h)}}function Og(s,e){for(let r=0;r<s.length;r++)if(Fo(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(Fo(s,e[r]))return!0;return!!op(s,e)}function uv(s,e,r){return!!Fo(s,e)||!!lp(e,s,r)}function Fg(s,e){if(s.length===1)return Ug(e,s[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let l=0;l<a.length;l++)if(Fo(s,a[l]))return!0}for(let r=0;r<s.length;r++)if(Ug(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(op(s,e[r]))return!0;return!1}function dv(s,e,r){if(s.length>1){if(op(s,e))return!0;for(let a=0;a<e.length;a++)if(lp(e[a],s,r))return!0}for(let a=0;a<s.length;a++)if(lp(s[a],e,r))return!0;return!1}function op(s,e){if(s.length===0||e.length===0)return!1;for(let r=0;r<s.length-1;r++){const a=s[r],l=s[r+1];for(let h=0;h<e.length-1;h++)if(hv(a,l,e[h],e[h+1]))return!0}return!1}function hv(s,e,r,a){return Ir(s,r,a)!==Ir(e,r,a)&&Ir(s,e,r)!==Ir(s,e,a)}function lp(s,e,r){const a=r*r;if(e.length===1)return s.distSqr(e[0])<a;for(let l=1;l<e.length;l++)if(Bg(s,e[l-1],e[l])<a)return!0;return!1}function Bg(s,e,r){const a=e.distSqr(r);if(a===0)return s.distSqr(e);const l=((s.x-e.x)*(r.x-e.x)+(s.y-e.y)*(r.y-e.y))/a;return s.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function Ug(s,e){let r,a,l,h=!1;for(let p=0;p<s.length;p++){r=s[p];for(let y=0,b=r.length-1;y<r.length;b=y++)a=r[y],l=r[b],a.y>e.y!=l.y>e.y&&e.x<(l.x-a.x)*(e.y-a.y)/(l.y-a.y)+a.x&&(h=!h)}return h}function Fo(s,e){let r=!1;for(let a=0,l=s.length-1;a<s.length;l=a++){const h=s[a],p=s[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(r=!r)}return r}function Vg(s,e,r,a,l){for(const p of s)if(e<=p.x&&r<=p.y&&a>=p.x&&l>=p.y)return!0;const h=[new Ee(e,r),new Ee(e,l),new Ee(a,l),new Ee(a,r)];if(s.length>2){for(const p of h)if(Fo(s,p))return!0}for(let p=0;p<s.length-1;p++)if(mv(s[p],s[p+1],h))return!0;return!1}function mv(s,e,r){const a=r[0],l=r[2];if(s.x<a.x&&e.x<a.x||s.x>l.x&&e.x>l.x||s.y<a.y&&e.y<a.y||s.y>l.y&&e.y>l.y)return!1;const h=Ir(s,e,r[0]);return h!==Ir(s,e,r[1])||h!==Ir(s,e,r[2])||h!==Ir(s,e,r[3])}function zl(s,e,r){const a=e.paint.get(s).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(s)}function rh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function qg(s,e,r,a,l){if(!e[0]&&!e[1])return s;const h=Ee.convert(e)._mult(l);r==="viewport"&&h._rotate(-a);const p=[];for(let y=0;y<s.length;y++)p.push(s[y].sub(h));return p}function $g(s,e,r,a){const l=Ee.convert(s)._mult(a);return e==="viewport"&&l._rotate(-r),l}Ct(ap,"CircleBucket",{omit:["layers"]});const pv=new oe({"circle-sort-key":new Q(We.layout_circle["circle-sort-key"])});var fv={paint:new oe({"circle-radius":new Q(We.paint_circle["circle-radius"]),"circle-color":new Q(We.paint_circle["circle-color"]),"circle-blur":new Q(We.paint_circle["circle-blur"]),"circle-opacity":new Q(We.paint_circle["circle-opacity"]),"circle-translate":new F(We.paint_circle["circle-translate"]),"circle-translate-anchor":new F(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new F(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new F(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Q(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Q(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Q(We.paint_circle["circle-stroke-opacity"])}),layout:pv};function Gg(s,e,r,a,l,h,p,y,b){if(h&&s.queryGeometry.isAboveHorizon)return!1;h&&(b*=s.pixelToTileUnitsFactor);const v=s.tileID.canonical,E=r.projection.upVectorScale(v,r.center.lat,r.worldSize).metersToTile;for(const k of e)for(const P of k){const L=P.add(y),R=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(L.x,L.y,!0):0,B=r.projection.projectTilePoint(L.x,L.y,v);if(R>0){const ne=r.projection.upVector(v,L.x,L.y);B.x+=ne[0]*E*R,B.y+=ne[1]*E*R,B.z+=ne[2]*E*R}const X=h?L:gv(B.x,B.y,B.z,a),ie=h?s.tilespaceRays.map(ne=>yv(ne,R)):s.queryGeometry.screenGeometry,pe=Lo([],[B.x,B.y,B.z,1],a);if(!p&&h?b*=pe[3]/r.cameraToCenterDistance:p&&!h&&(b*=r.cameraToCenterDistance/pe[3]),h){const ne=$r((P.y/zt+v.y)/(1<<v.z));b/=r.projection.pixelsPerMeter(ne,1)/yn(1,ne)}if(uv(ie,X,b))return!0}return!1}function gv(s,e,r,a){const l=Lo([],[s,e,r,1],a);return new Ee(l[0]/l[3],l[1]/l[3])}const Zg=Pl(0,0,0),xv=Pl(0,0,1);function yv(s,e){const r=Gm();return Zg[2]=e,s.intersectsPlane(Zg,xv,r),new Ee(r[0],r[1])}class Wg extends ap{}function Hg(s,{width:e,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*a)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*a);return s.width=e,s.height=r,s.data=l,s}function Xg(s,e,r){const{width:a,height:l}=e;a===s.width&&l===s.height||(cp(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,a),height:Math.min(s.height,l)},r),s.width=a,s.height=l,s.data=e.data)}function cp(s,e,r,a,l,h){if(l.width===0||l.height===0)return e;if(l.width>s.width||l.height>s.height||r.x>s.width-l.width||r.y>s.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||a.x>e.width-l.width||a.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=s.data,y=e.data;for(let b=0;b<l.height;b++){const v=((r.y+b)*s.width+r.x)*h,E=((a.y+b)*e.width+a.x)*h;for(let k=0;k<l.width*h;k++)y[E+k]=p[v+k]}return e}Ct(Wg,"HeatmapBucket",{omit:["layers"]});class la{constructor(e,r){Hg(this,e,1,r)}resize(e){Xg(this,new la(e),1)}clone(){return new la({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,h){cp(e,r,a,l,h,1)}}class Si{constructor(e,r){Hg(this,e,4,r)}resize(e){Xg(this,new Si(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Si({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,h){cp(e,r,a,l,h,4)}}Ct(la,"AlphaImage"),Ct(Si,"RGBAImage");var _v={paint:new oe({"heatmap-radius":new Q(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Q(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new F(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ae(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new F(We.paint_heatmap["heatmap-opacity"])})};function up(s){const e={},r=s.resolution||256,a=s.clips?s.clips.length:1,l=s.image||new Si({width:r,height:a}),h=(p,y,b)=>{e[s.evaluationKey]=b;const v=s.expression.evaluate(e);l.data[p+y+0]=Math.floor(255*v.r/v.a),l.data[p+y+1]=Math.floor(255*v.g/v.a),l.data[p+y+2]=Math.floor(255*v.b/v.a),l.data[p+y+3]=Math.floor(255*v.a)};if(s.clips)for(let p=0,y=0;p<a;++p,y+=4*r)for(let b=0,v=0;b<r;b++,v+=4){const E=b/(r-1),{start:k,end:P}=s.clips[p];h(y,v,k*(1-E)+P*E)}else for(let p=0,y=0;p<r;p++,y+=4)h(0,y,p/(r-1));return l}var bv={paint:new oe({"hillshade-illumination-direction":new F(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new F(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new F(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new F(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new F(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new F(We.paint_hillshade["hillshade-accent-color"])})};const vv=ke([{name:"a_pos",components:2,type:"Int16"}],4),{members:wv}=vv;var dp={exports:{}};function ih(s,e,r){r=r||2;var a,l,h,p,y,b,v,E=e&&e.length,k=E?e[0]*r:s.length,P=Kg(s,0,k,r,!0),L=[];if(!P||P.next===P.prev)return L;if(E&&(P=function(B,X,ie,pe){var ne,de,xe,ge=[];for(ne=0,de=X.length;ne<de;ne++)(xe=Kg(B,X[ne]*pe,ne<de-1?X[ne+1]*pe:B.length,pe,!1))===xe.next&&(xe.steiner=!0),ge.push(Av(xe));for(ge.sort(Ev),ne=0;ne<ge.length;ne++)ie=Cv(ge[ne],ie);return ie}(s,e,P,r)),s.length>80*r){a=h=s[0],l=p=s[1];for(var R=r;R<k;R+=r)(y=s[R])<a&&(a=y),(b=s[R+1])<l&&(l=b),y>h&&(h=y),b>p&&(p=b);v=(v=Math.max(h-a,p-l))!==0?32767/v:0}return _u(P,L,r,a,l,v,0),L}function Kg(s,e,r,a,l){var h,p;if(l===pp(s,e,r,a)>0)for(h=e;h<r;h+=a)p=Yg(h,s[h],s[h+1],p);else for(h=r-a;h>=e;h-=a)p=Yg(h,s[h],s[h+1],p);return p&&nh(p,p.next)&&(vu(p),p=p.next),p}function Bo(s,e){if(!s)return s;e||(e=s);var r,a=s;do if(r=!1,a.steiner||!nh(a,a.next)&&or(a.prev,a,a.next)!==0)a=a.next;else{if(vu(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function _u(s,e,r,a,l,h,p){if(s){!p&&h&&function(E,k,P,L){var R=E;do R.z===0&&(R.z=hp(R.x,R.y,k,P,L)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==E);R.prevZ.nextZ=null,R.prevZ=null,function(B){var X,ie,pe,ne,de,xe,ge,Ue,Oe=1;do{for(ie=B,B=null,de=null,xe=0;ie;){for(xe++,pe=ie,ge=0,X=0;X<Oe&&(ge++,pe=pe.nextZ);X++);for(Ue=Oe;ge>0||Ue>0&&pe;)ge!==0&&(Ue===0||!pe||ie.z<=pe.z)?(ne=ie,ie=ie.nextZ,ge--):(ne=pe,pe=pe.nextZ,Ue--),de?de.nextZ=ne:B=ne,ne.prevZ=de,de=ne;ie=pe}de.nextZ=null,Oe*=2}while(xe>1)}(R)}(s,a,l,h);for(var y,b,v=s;s.prev!==s.next;)if(y=s.prev,b=s.next,h?Nv(s,a,l,h):jv(s))e.push(y.i/r|0),e.push(s.i/r|0),e.push(b.i/r|0),vu(s),s=b.next,v=b.next;else if((s=b)===v){p?p===1?_u(s=Sv(Bo(s),e,r),e,r,a,l,h,2):p===2&&Tv(s,e,r,a,l,h):_u(Bo(s),e,r,a,l,h,1);break}}}function jv(s){var e=s.prev,r=s,a=s.next;if(or(e,r,a)>=0)return!1;for(var l=e.x,h=r.x,p=a.x,y=e.y,b=r.y,v=a.y,E=l<h?l<p?l:p:h<p?h:p,k=y<b?y<v?y:v:b<v?b:v,P=l>h?l>p?l:p:h>p?h:p,L=y>b?y>v?y:v:b>v?b:v,R=a.next;R!==e;){if(R.x>=E&&R.x<=P&&R.y>=k&&R.y<=L&&Ol(l,y,h,b,p,v,R.x,R.y)&&or(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function Nv(s,e,r,a){var l=s.prev,h=s,p=s.next;if(or(l,h,p)>=0)return!1;for(var y=l.x,b=h.x,v=p.x,E=l.y,k=h.y,P=p.y,L=y<b?y<v?y:v:b<v?b:v,R=E<k?E<P?E:P:k<P?k:P,B=y>b?y>v?y:v:b>v?b:v,X=E>k?E>P?E:P:k>P?k:P,ie=hp(L,R,e,r,a),pe=hp(B,X,e,r,a),ne=s.prevZ,de=s.nextZ;ne&&ne.z>=ie&&de&&de.z<=pe;){if(ne.x>=L&&ne.x<=B&&ne.y>=R&&ne.y<=X&&ne!==l&&ne!==p&&Ol(y,E,b,k,v,P,ne.x,ne.y)&&or(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,de.x>=L&&de.x<=B&&de.y>=R&&de.y<=X&&de!==l&&de!==p&&Ol(y,E,b,k,v,P,de.x,de.y)&&or(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ne&&ne.z>=ie;){if(ne.x>=L&&ne.x<=B&&ne.y>=R&&ne.y<=X&&ne!==l&&ne!==p&&Ol(y,E,b,k,v,P,ne.x,ne.y)&&or(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;de&&de.z<=pe;){if(de.x>=L&&de.x<=B&&de.y>=R&&de.y<=X&&de!==l&&de!==p&&Ol(y,E,b,k,v,P,de.x,de.y)&&or(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function Sv(s,e,r){var a=s;do{var l=a.prev,h=a.next.next;!nh(l,h)&&Qg(l,a,a.next,h)&&bu(l,h)&&bu(h,l)&&(e.push(l.i/r|0),e.push(a.i/r|0),e.push(h.i/r|0),vu(a),vu(a.next),a=s=h),a=a.next}while(a!==s);return Bo(a)}function Tv(s,e,r,a,l,h){var p=s;do{for(var y=p.next.next;y!==p.prev;){if(p.i!==y.i&&Mv(p,y)){var b=Jg(p,y);return p=Bo(p,p.next),b=Bo(b,b.next),_u(p,e,r,a,l,h,0),void _u(b,e,r,a,l,h,0)}y=y.next}p=p.next}while(p!==s)}function Ev(s,e){return s.x-e.x}function Cv(s,e){var r=function(l,h){var p,y=h,b=l.x,v=l.y,E=-1/0;do{if(v<=y.y&&v>=y.next.y&&y.next.y!==y.y){var k=y.x+(v-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(k<=b&&k>E&&(E=k,p=y.x<y.next.x?y:y.next,k===b))return p}y=y.next}while(y!==h);if(!p)return null;var P,L=p,R=p.x,B=p.y,X=1/0;y=p;do b>=y.x&&y.x>=R&&b!==y.x&&Ol(v<B?b:E,v,R,B,v<B?E:b,v,y.x,y.y)&&(P=Math.abs(v-y.y)/(b-y.x),bu(y,l)&&(P<X||P===X&&(y.x>p.x||y.x===p.x&&kv(p,y)))&&(p=y,X=P)),y=y.next;while(y!==L);return p}(s,e);if(!r)return e;var a=Jg(r,s);return Bo(a,a.next),Bo(r,r.next)}function kv(s,e){return or(s.prev,s,e.prev)<0&&or(e.next,s,s.next)<0}function hp(s,e,r,a,l){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-r)*l|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Av(s){var e=s,r=s;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==s);return r}function Ol(s,e,r,a,l,h,p,y){return(l-p)*(e-y)>=(s-p)*(h-y)&&(s-p)*(a-y)>=(r-p)*(e-y)&&(r-p)*(h-y)>=(l-p)*(a-y)}function Mv(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(r,a){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&Qg(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(s,e)&&(bu(s,e)&&bu(e,s)&&function(r,a){var l=r,h=!1,p=(r.x+a.x)/2,y=(r.y+a.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&p<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(s,e)&&(or(s.prev,s,e.prev)||or(s,e.prev,e))||nh(s,e)&&or(s.prev,s,s.next)>0&&or(e.prev,e,e.next)>0)}function or(s,e,r){return(e.y-s.y)*(r.x-e.x)-(e.x-s.x)*(r.y-e.y)}function nh(s,e){return s.x===e.x&&s.y===e.y}function Qg(s,e,r,a){var l=oh(or(s,e,r)),h=oh(or(s,e,a)),p=oh(or(r,a,s)),y=oh(or(r,a,e));return l!==h&&p!==y||!(l!==0||!ah(s,r,e))||!(h!==0||!ah(s,a,e))||!(p!==0||!ah(r,s,a))||!(y!==0||!ah(r,e,a))}function ah(s,e,r){return e.x<=Math.max(s.x,r.x)&&e.x>=Math.min(s.x,r.x)&&e.y<=Math.max(s.y,r.y)&&e.y>=Math.min(s.y,r.y)}function oh(s){return s>0?1:s<0?-1:0}function bu(s,e){return or(s.prev,s,s.next)<0?or(s,e,s.next)>=0&&or(s,s.prev,e)>=0:or(s,e,s.prev)<0||or(s,s.next,e)<0}function Jg(s,e){var r=new mp(s.i,s.x,s.y),a=new mp(e.i,e.x,e.y),l=s.next,h=e.prev;return s.next=e,e.prev=s,r.next=l,l.prev=r,a.next=r,r.prev=a,h.next=a,a.prev=h,a}function Yg(s,e,r,a){var l=new mp(s,e,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function vu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function mp(s,e,r){this.i=s,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pp(s,e,r,a){for(var l=0,h=e,p=r-a;h<r;h+=a)l+=(s[p]-s[h])*(s[h+1]+s[p+1]),p=h;return l}dp.exports=ih,dp.exports.default=ih,ih.deviation=function(s,e,r,a){var l=e&&e.length,h=Math.abs(pp(s,0,l?e[0]*r:s.length,r));if(l)for(var p=0,y=e.length;p<y;p++)h-=Math.abs(pp(s,e[p]*r,p<y-1?e[p+1]*r:s.length,r));var b=0;for(p=0;p<a.length;p+=3){var v=a[p]*r,E=a[p+1]*r,k=a[p+2]*r;b+=Math.abs((s[v]-s[k])*(s[E+1]-s[v+1])-(s[v]-s[E])*(s[k+1]-s[v+1]))}return h===0&&b===0?0:Math.abs((b-h)/h)},ih.flatten=function(s){for(var e=s[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,l=0;l<s.length;l++){for(var h=0;h<s[l].length;h++)for(var p=0;p<e;p++)r.vertices.push(s[l][h][p]);l>0&&r.holes.push(a+=s[l-1].length)}return r};var fp=je(dp.exports);function Pv(s,e,r,a,l){ex(s,e,r,a||s.length-1,l||Iv)}function ex(s,e,r,a,l){for(;a>r;){if(a-r>600){var h=a-r+1,p=e-r+1,y=Math.log(h),b=.5*Math.exp(2*y/3),v=.5*Math.sqrt(y*b*(h-b)/h)*(p-h/2<0?-1:1);ex(s,e,Math.max(r,Math.floor(e-p*b/h+v)),Math.min(a,Math.floor(e+(h-p)*b/h+v)),l)}var E=s[e],k=r,P=a;for(wu(s,r,e),l(s[a],E)>0&&wu(s,r,a);k<P;){for(wu(s,k,P),k++,P--;l(s[k],E)<0;)k++;for(;l(s[P],E)>0;)P--}l(s[r],E)===0?wu(s,r,P):wu(s,++P,a),P<=e&&(r=P+1),e<=P&&(a=P-1)}}function wu(s,e,r){var a=s[e];s[e]=s[r],s[r]=a}function Iv(s,e){return s<e?-1:s>e?1:0}function gp(s,e){const r=s.length;if(r<=1)return[s];const a=[];let l,h;for(let p=0;p<r;p++){const y=Zn(s[p]);y!==0&&(s[p].area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(l&&a.push(l),l=[s[p]]):l.push(s[p]))}if(l&&a.push(l),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(Pv(a[p],e,1,a[p].length-1,Dv),a[p]=a[p].slice(0,e));return a}function Dv(s,e){return e.area-s.area}function xp(s,e,r){const a=r.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${s}-pattern`);p.isConstant()||(l=!0);const y=p.constantOr(null);y&&(l=!0,a[y]=!0)}return l}function yp(s,e,r,a,l){const h=l.patternDependencies;for(const p of e){const y=p.paint.get(`${s}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:a},r,{},l.availableImages);b=b&&b.name?b.name:b,h[b]=!0,r.patterns[p.id]=b}}return r}class lh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new at,this.indexArray=new Pt,this.indexArray2=new Er,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new ar,this.segments2=new ar,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,a,l){this.hasPattern=xp("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:b,index:v,sourceLayerIndex:E}of e){const k=this.layers[0]._featureFilter.needGeometry,P=Oo(y,k);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),P,a))continue;const L=h?h.evaluate(P,{},a,r.availableImages):void 0,R={id:b,properties:y.properties,type:y.type,sourceLayerIndex:E,index:v,geometry:k?P.geometry:oa(y,a,l),patterns:{},sortKey:L};p.push(R)}h&&p.sort((y,b)=>y.sortKey-b.sortKey);for(const y of p){const{geometry:b,index:v,sourceLayerIndex:E}=y;if(this.hasPattern){const k=yp("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(y,b,v,a,{},r.availableImages);r.featureIndex.insert(e[v].feature,b,v,E,this.index)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}addFeatures(e,r,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,l,h,p=[]){for(const y of gp(r,500)){let b=0;for(const R of y)b+=R.length;const v=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),E=v.vertexLength,k=[],P=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&P.push(k.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),X=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(X+R.length-1,X),k.push(R[0].x),k.push(R[0].y);for(let ie=1;ie<R.length;ie++)this.layoutVertexArray.emplaceBack(R[ie].x,R[ie].y),this.indexArray2.emplaceBack(X+ie-1,X+ie),k.push(R[ie].x),k.push(R[ie].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const L=fp(k,P);for(let R=0;R<L.length;R+=3)this.indexArray.emplaceBack(E+L[R],E+L[R+1],E+L[R+2]);v.vertexLength+=b,v.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}}Ct(lh,"FillBucket",{omit:["layers","patternFeatures"]});const Lv=new oe({"fill-sort-key":new Q(We.layout_fill["fill-sort-key"])});var Rv={paint:new oe({"fill-antialias":new F(We.paint_fill["fill-antialias"]),"fill-opacity":new Q(We.paint_fill["fill-opacity"]),"fill-color":new Q(We.paint_fill["fill-color"]),"fill-outline-color":new Q(We.paint_fill["fill-outline-color"]),"fill-translate":new F(We.paint_fill["fill-translate"]),"fill-translate-anchor":new F(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new Q(We.paint_fill["fill-pattern"])}),layout:Lv};const zv=ke([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ov=ke([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Fv=ke([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Bv}=zv;var ch={},Uv=fe,tx=Fl;function Fl(s,e,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=s,this._geometry=-1,this._keys=a,this._values=l,s.readFields(Vv,this,e)}function Vv(s,e,r){s==1?e.id=r.readVarint():s==2?function(a,l){for(var h=a.readVarint()+a.pos;a.pos<h;){var p=l._keys[a.readVarint()],y=l._values[a.readVarint()];l.properties[p]=y}}(r,e):s==3?e.type=r.readVarint():s==4&&(e._geometry=r.pos)}function qv(s){for(var e,r,a=0,l=0,h=s.length,p=h-1;l<h;p=l++)a+=((r=s[p]).x-(e=s[l]).x)*(e.y+r.y);return a}Fl.types=["Unknown","Point","LineString","Polygon"],Fl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var e,r=s.readVarint()+s.pos,a=1,l=0,h=0,p=0,y=[];s.pos<r;){if(l<=0){var b=s.readVarint();a=7&b,l=b>>3}if(l--,a===1||a===2)h+=s.readSVarint(),p+=s.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new Uv(h,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Fl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var e=s.readVarint()+s.pos,r=1,a=0,l=0,h=0,p=1/0,y=-1/0,b=1/0,v=-1/0;s.pos<e;){if(a<=0){var E=s.readVarint();r=7&E,a=E>>3}if(a--,r===1||r===2)(l+=s.readSVarint())<p&&(p=l),l>y&&(y=l),(h+=s.readSVarint())<b&&(b=h),h>v&&(v=h);else if(r!==7)throw new Error("unknown command "+r)}return[p,b,y,v]},Fl.prototype.toGeoJSON=function(s,e,r){var a,l,h=this.extent*Math.pow(2,r),p=this.extent*s,y=this.extent*e,b=this.loadGeometry(),v=Fl.types[this.type];function E(L){for(var R=0;R<L.length;R++){var B=L[R];L[R]=[360*(B.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(a=0;a<b.length;a++)k[a]=b[a][0];E(b=k);break;case 2:for(a=0;a<b.length;a++)E(b[a]);break;case 3:for(b=function(L){var R=L.length;if(R<=1)return[L];for(var B,X,ie=[],pe=0;pe<R;pe++){var ne=qv(L[pe]);ne!==0&&(X===void 0&&(X=ne<0),X===ne<0?(B&&ie.push(B),B=[L[pe]]):B.push(L[pe]))}return B&&ie.push(B),ie}(b),a=0;a<b.length;a++)for(l=0;l<b[a].length;l++)E(b[a][l])}b.length===1?b=b[0]:v="Multi"+v;var P={type:"Feature",geometry:{type:v,coordinates:b},properties:this.properties};return"id"in this&&(P.id=this.id),P};var $v=tx,sx=rx;function rx(s,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Gv,this,e),this.length=this._features.length}function Gv(s,e,r){s===15?e.version=r.readVarint():s===1?e.name=r.readString():s===5?e.extent=r.readVarint():s===2?e._features.push(r.pos):s===3?e._keys.push(r.readString()):s===4&&e._values.push(function(a){for(var l=null,h=a.readVarint()+a.pos;a.pos<h;){var p=a.readVarint()>>3;l=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return l}(r))}rx.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var e=this._pbf.readVarint()+this._pbf.pos;return new $v(this._pbf,e,this.extent,this._keys,this._values)};var Zv=sx;function Wv(s,e,r){if(s===3){var a=new Zv(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var _p=ch.VectorTile=function(s,e){this.layers=s.readFields(Wv,{},e)},uh=ch.VectorTileFeature=tx;function dh(s,e,r,a){const l=[],h=a===0?(p,y,b,v,E,k)=>{p.push(new Ee(k,b+(k-y)/(v-y)*(E-b)))}:(p,y,b,v,E,k)=>{p.push(new Ee(y+(k-b)/(E-b)*(v-y),k))};for(const p of s){const y=[];for(const b of p){if(b.length<=2)continue;const v=[];for(let P=0;P<b.length-1;P++){const L=b[P].x,R=b[P].y,B=b[P+1].x,X=b[P+1].y,ie=a===0?L:R,pe=a===0?B:X;ie<e?pe>e&&h(v,L,R,B,X,e):ie>r?pe<r&&h(v,L,R,B,X,r):v.push(b[P]),pe<e&&ie>=e&&h(v,L,R,B,X,e),pe>r&&ie<=r&&h(v,L,R,B,X,r)}let E=b[b.length-1];const k=a===0?E.x:E.y;k>=e&&k<=r&&v.push(E),v.length&&(E=v[v.length-1],v[0].x===E.x&&v[0].y===E.y||v.push(v[0]),y.push(v))}y.length&&l.push(y)}return l}ch.VectorTileLayer=sx;const Hv=uh.types,Xv=Math.pow(2,13);function ju(s,e,r,a,l,h,p,y){s.emplaceBack((e<<1)+p,(r<<1)+h,(Math.floor(a*Xv)<<1)+l,Math.round(y))}function Nu(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class ix{constructor(){this.acc=new Ee(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ee(e.x,e.y),this.max=new Ee(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,l=this.max;e.x<a.x?a.x=e.x:e.x>l.x&&(l.x=e.x),e.y<a.y?a.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===zt)&&e.x===r.x)!=((e.y===0||e.y===zt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,ds(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>zt!=e.x>zt&&this.addBorderIntersection(1,ds(r.y,e.y,(zt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,ds(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>zt!=e.y>zt&&this.addBorderIntersection(3,ds(r.x,e.x,(zt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((r,a)=>r+a.edges,0);return e!==0?this.acc.div(e)._round():new Ee(0,0)}span(){return new Ee(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Su{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Qe,this.centroidVertexArray=new mn,this.indexArray=new Pt,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new ar,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,a,l){this.features=[],this.hasPattern=xp("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(h){const p=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*p/(p*p+1)/zt/(1<<h.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:h,id:p,index:y,sourceLayerIndex:b}of e){const v=this.layers[0]._featureFilter.needGeometry,E=Oo(h,v);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),E,a))continue;const k={id:p,sourceLayerIndex:b,index:y,geometry:v?E.geometry:oa(h,a,l),properties:h.properties,type:h.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(yp("fill-extrusion",this.layers,k,this.zoom,r)):this.addFeature(k,k.geometry,y,a,{},r.availableImages,l),r.featureIndex.insert(h,k.geometry,y,b,this.index,P)}this.sortBorders()}addFeatures(e,r,a,l,h){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,r,a,l,h)}this.sortBorders()}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Fv.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ov.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,l,h,p,y){const b=[new Ee(0,0),new Ee(zt,zt)],v=y.projection,E=v.name==="globe",k=this.enableTerrain&&!E?new ix:null,P=Hv[e.type]==="Polygon";E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new lt);const L=gp(r,500);for(let ie=L.length-1;ie>=0;ie--){const pe=L[ie];(pe.length===0||(R=pe[0]).every(ne=>ne.x<=0)||R.every(ne=>ne.x>=zt)||R.every(ne=>ne.y<=0)||R.every(ne=>ne.y>=zt))&&L.splice(ie,1)}var R;let B;if(E)B=dx(L,b,l);else{B=[];for(const ie of L)B.push({polygon:ie,bounds:b})}const X=P?this.edgeRadius:0;for(const{polygon:ie,bounds:pe}of B){let ne=0,de=0;for(const ge of ie)P&&!ge[0].equals(ge[ge.length-1])&&ge.push(ge[0]),de+=P?ge.length-1:ge.length;const xe=this.segments.prepareSegment((P?5:4)*de,this.layoutVertexArray,this.indexArray);if(P){const ge=[],Ue=[];ne=xe.vertexLength;for(const He of ie){let ot,qe;He.length&&He!==ie[0]&&Ue.push(ge.length/2),ot=He[1].sub(He[0])._perp()._unit();for(let Je=1;Je<He.length;Je++){const Ye=He[Je],it=He[Je===He.length-1?1:Je+1];let{x:dt,y:Ze}=Ye;if(X){qe=it.sub(Ye)._perp()._unit();const vt=ot.add(qe)._unit(),Mt=X*Math.min(4,1/(ot.x*vt.x+ot.y*vt.y));dt+=Mt*vt.x,Ze+=Mt*vt.y,ot=qe}ju(this.layoutVertexArray,dt,Ze,0,0,1,1,0),xe.vertexLength++,ge.push(Ye.x,Ye.y),E&&Nu(this.layoutVertexExtArray,v.projectTilePoint(dt,Ze,l),v.upVector(l,dt,Ze))}}const Oe=fp(ge,Ue);for(let He=0;He<Oe.length;He+=3)this.indexArray.emplaceBack(ne+Oe[He],ne+Oe[He+2],ne+Oe[He+1]),xe.primitiveLength++}for(const ge of ie){k&&ge.length&&k.startRing(ge[0]);let Ue,Oe,He,ot=ge.length>4&&lx(ge[ge.length-2],ge[0],ge[1]),qe=X?Kv(ge[ge.length-2],ge[0],ge[1],X):0;Oe=ge[1].sub(ge[0])._perp()._unit();let Je=!0;for(let Ye=1,it=0;Ye<ge.length;Ye++){let dt=ge[Ye-1],Ze=ge[Ye];const vt=ge[Ye===ge.length-1?1:Ye+1];if(k&&P&&k.currentPolyCount.top++,ox(Ze,dt,pe)){X&&(Oe=vt.sub(Ze)._perp()._unit(),Je=!Je);continue}k&&k.append(Ze,dt);const Mt=Ze.sub(dt)._perp(),jt=Mt.x/(Math.abs(Mt.x)+Math.abs(Mt.y)),$t=Mt.y>0?1:0,ht=dt.dist(Ze);if(it+ht>32768&&(it=0),X){He=vt.sub(Ze)._perp()._unit();let Zt=ax(dt,Ze,vt,nx(Oe,He),X);isNaN(Zt)&&(Zt=0);const Ft=Ze.sub(dt)._unit();dt=dt.add(Ft.mult(qe))._round(),Ze=Ze.add(Ft.mult(-Zt))._round(),qe=Zt,Oe=He}const Rt=xe.vertexLength,Gt=ge.length>4&&lx(dt,Ze,vt);let ps=cx(it,ot,Je);if(ju(this.layoutVertexArray,dt.x,dt.y,jt,$t,0,0,ps),ju(this.layoutVertexArray,dt.x,dt.y,jt,$t,0,1,ps),it+=ht,ps=cx(it,Gt,!Je),ot=Gt,ju(this.layoutVertexArray,Ze.x,Ze.y,jt,$t,0,0,ps),ju(this.layoutVertexArray,Ze.x,Ze.y,jt,$t,0,1,ps),xe.vertexLength+=4,this.indexArray.emplaceBack(Rt+0,Rt+1,Rt+2),this.indexArray.emplaceBack(Rt+1,Rt+3,Rt+2),xe.primitiveLength+=2,X){const Zt=ne+(Ye===1?ge.length-2:Ye-2),Ft=Ye===1?ne:Zt+1;if(this.indexArray.emplaceBack(Rt+1,Zt,Rt+3),this.indexArray.emplaceBack(Zt,Ft,Rt+3),xe.primitiveLength+=2,Ue===void 0&&(Ue=Rt),!ox(vt,ge[Ye],pe)){const Rs=Ye===ge.length-1?Ue:xe.vertexLength;this.indexArray.emplaceBack(Rt+2,Rt+3,Rs),this.indexArray.emplaceBack(Rt+3,Rs+1,Rs),this.indexArray.emplaceBack(Rt+3,Ft,Rs+1),xe.primitiveLength+=3}Je=!Je}if(E){const Zt=this.layoutVertexExtArray,Ft=v.projectTilePoint(dt.x,dt.y,l),Rs=v.projectTilePoint(Ze.x,Ze.y,l),Xt=v.upVector(l,dt.x,dt.y),Kt=v.upVector(l,Ze.x,Ze.y);Nu(Zt,Ft,Xt),Nu(Zt,Ft,Xt),Nu(Zt,Rs,Kt),Nu(Zt,Rs,Kt)}}P&&(ne+=ge.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const ie=k.borders,pe=this.featuresOnBorder.push(k)-1;for(let ne=0;ne<4;ne++)ie[ne][0]!==Number.MAX_VALUE&&this.borders[ne].push(pe)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,r,a=!0){let l,h;if(e)if(e.y!==0){const y=r.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else l=Math.ceil(7*(e.x+450)),h=0;else l=0,h=+a;let p=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(p++,l,h);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(p++,0,h),this.centroidVertexArray.emplace(p++,l,h)}}}function nx(s,e){const r=s.add(e)._unit();return s.x*r.x+s.y*r.y}function Kv(s,e,r,a){const l=e.sub(s)._perp()._unit(),h=r.sub(e)._perp()._unit();return ax(s,e,r,nx(l,h),a)}function ax(s,e,r,a,l){const h=Math.sqrt(1-a*a);return Math.min(s.dist(e)/3,e.dist(r)/3,l*h/a)}function ox(s,e,r){return s.x<r[0].x&&e.x<r[0].x||s.x>r[1].x&&e.x>r[1].x||s.y<r[0].y&&e.y<r[0].y||s.y>r[1].y&&e.y>r[1].y}function lx(s,e,r){if(s.x<0||s.x>=zt||e.x<0||e.x>=zt||r.x<0||r.x>=zt)return!1;const a=r.sub(e),l=a.perp(),h=s.sub(e);return(a.x*h.x+a.y*h.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(h.x*h.x+h.y*h.y))>-.866&&l.x*h.x+l.y*h.y<0}function cx(s,e,r){const a=e?2|s:-3&s;return r?1|a:-2&a}function ux(){const s=Math.PI/32,e=Math.tan(s),r=yu;return r*Math.sqrt(1+2*e*e)-r}function dx(s,e,r){const a=1<<r.z,l=Ri(r.x/a),h=Ri((r.x+1)/a),p=$r(r.y/a),y=$r((r.y+1)/a);return function(b,v,E,k,P=0,L){const R=[];if(!b.length||!E||!k)return R;const B=(ge,Ue)=>{for(const Oe of ge)R.push({polygon:Oe,bounds:Ue})},X=Math.ceil(Math.log2(E)),ie=Math.ceil(Math.log2(k)),pe=X-ie,ne=[];for(let ge=0;ge<Math.abs(pe);ge++)ne.push(pe>0?0:1);for(let ge=0;ge<Math.min(X,ie);ge++)ne.push(0),ne.push(1);let de=b;if(de=dh(de,v[0].y-P,v[1].y+P,1),de=dh(de,v[0].x-P,v[1].x+P,0),!de.length)return R;const xe=[];for(ne.length?xe.push({polygons:de,bounds:v,depth:0}):B(de,v);xe.length;){const ge=xe.pop(),Ue=ge.depth,Oe=ne[Ue],He=ge.bounds[0],ot=ge.bounds[1],qe=Oe===0?He.x:He.y,Je=Oe===0?ot.x:ot.y,Ye=L?L(Oe,qe,Je):.5*(qe+Je),it=dh(ge.polygons,qe-P,Ye+P,Oe),dt=dh(ge.polygons,Ye-P,Je+P,Oe);if(it.length){const Ze=[He,new Ee(Oe===0?Ye:ot.x,Oe===1?Ye:ot.y)];ne.length>Ue+1?xe.push({polygons:it,bounds:Ze,depth:Ue+1}):B(it,Ze)}if(dt.length){const Ze=[new Ee(Oe===0?Ye:He.x,Oe===1?Ye:He.y),ot];ne.length>Ue+1?xe.push({polygons:dt,bounds:Ze,depth:Ue+1}):B(dt,Ze)}}return R}(s,e,Math.ceil((h-l)/11.25),Math.ceil((p-y)/11.25),1,(b,v,E)=>{if(b===0)return .5*(v+E);{const k=$r((r.y+v/zt)/a);return(Ln(.5*($r((r.y+E/zt)/a)+k))*a-r.y)*zt}})}Ct(Su,"FillExtrusionBucket",{omit:["layers","features"]}),Ct(ix,"PartMetadata");const Qv=new oe({"fill-extrusion-edge-radius":new F(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Jv={paint:new oe({"fill-extrusion-opacity":new F(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Q(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new F(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new F(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Q(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Q(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Q(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new F(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new F(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new F(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new F(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Qv};function hx(s,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[s*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class hh{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Tu(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=function(h,p,y){var b=hx(256*h,256*(p=Math.pow(2,y)-p-1),y),v=hx(256*(h+1),256*(p+1),y);return b[0]+","+b[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),l=function(h,p,y){let b,v="";for(let E=h;E>0;E--)b=1<<E-1,v+=(p&b?1:0)+(y&b?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mx{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Tu(e,r.z,r.z,r.x,r.y)}}class ii{constructor(e,r,a,l,h){this.overscaledZ=e,this.wrap=r,this.canonical=new hh(a,+l,+h),this.key=r===0&&e===a?this.canonical.key:Tu(r,e,a,l,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new ii(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ii(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Tu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Tu(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ii(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new ii(r,this.wrap,r,a,l),new ii(r,this.wrap,r,a+1,l),new ii(r,this.wrap,r,a,l+1),new ii(r,this.wrap,r,a+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ii(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ii(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Tu(s,e,r,a,l){const h=1<<Math.min(r,22);let p=h*(l%h)+a%h;return s&&r<22&&(p+=h*h*((s<0?-2*s-1:2*s)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}Ct(hh,"CanonicalTileID"),Ct(ii,"OverscaledTileID",{omit:["projMatrix"]});class Bl extends Ee{constructor(e,r,a){super(e,r),this.z=a}}function Eu(s,e){return s.x*e.x+s.y*e.y}function px(s,e){if(s.length===1){let r=0;const a=e[r++];let l;for(;!l||a.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const h=e[r],p=s[0],y=l.sub(a),b=h.sub(a),v=p.sub(a),E=Eu(y,y),k=Eu(y,b),P=Eu(b,b),L=Eu(v,y),R=Eu(v,b),B=E*P-k*k,X=(P*L-k*R)/B,ie=(E*R-k*L)/B,pe=a.z*(1-X-ie)+l.z*X+h.z*ie;if(isFinite(pe))return pe}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function fx(s,e,r,a,l,h,p,y){const b=p*l.getElevationAt(s,e,!0,!0),v=h[0]!==0,E=v?h[1]===0?p*(h[0]/7-450):p*function(k,P,L){const R=Math.floor(P[0]/8),B=Math.floor(P[1]/8),X=10*(P[0]-8*R),ie=10*(P[1]-8*B),pe=k.getElevationAt(R,B,!0,!0),ne=k.getMeterToDEM(L),de=Math.floor(.5*(X*ne-1)),xe=Math.floor(.5*(ie*ne-1)),ge=k.tileCoordToPixel(R,B),Ue=2*de+1,Oe=2*xe+1,He=function(dt,Ze,vt,Mt,jt){return[dt.getElevationAtPixel(Ze,vt,!0),dt.getElevationAtPixel(Ze+jt,vt,!0),dt.getElevationAtPixel(Ze,vt+jt,!0),dt.getElevationAtPixel(Ze+Mt,vt+jt,!0)]}(k,ge.x-de,ge.y-xe,Ue,Oe),ot=Math.abs(He[0]-He[1]),qe=Math.abs(He[2]-He[3]),Je=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),Ye=Math.min(.25,.5*ne*(ot+qe)/Ue),it=Math.min(.25,.5*ne*Je/Oe);return pe+Math.max(Ye*X,it*ie)}(l,h,y):b;return{base:b+(r===0)?-1:r,top:v?Math.max(E+a,b+r+2):b+a}}const Yv=ke([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ew}=Yv,tw=ke([{name:"a_packed",components:4,type:"Float32"}]),{members:sw}=tw,rw=uh.types,iw=Math.cos(Math.PI/180*37.5);class mh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ve,this.layoutVertexArray2=new nt,this.indexArray=new Pt,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new ar,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,l){this.hasPattern=xp("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:E,id:k,index:P,sourceLayerIndex:L}of e){const R=this.layers[0]._featureFilter.needGeometry,B=Oo(E,R);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),B,a))continue;const X=h?h.evaluate(B,{},a):void 0,ie={id:k,properties:E.properties,type:E.type,sourceLayerIndex:L,index:P,geometry:R?B.geometry:oa(E,a,l),patterns:{},sortKey:X};p.push(ie)}h&&p.sort((E,k)=>E.sortKey-k.sortKey);const{lineAtlas:y,featureIndex:b}=r,v=this.addConstantDashes(y);for(const E of p){const{geometry:k,index:P,sourceLayerIndex:L}=E;if(v&&this.addFeatureDashes(E,y),this.hasPattern){const R=yp("line",this.layers,E,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(E,k,P,a,y.positions,r.availableImages);b.insert(e[P].feature,k,P,L,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind!=="constant"||h.kind!=="constant")r=!0;else{const p=h.value,y=l.value;if(!y)continue;e.addDash(y,p)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(h.kind==="constant"&&p.kind==="constant")continue;let y,b;if(h.kind==="constant"){if(y=h.value,!y)continue}else y=h.evaluate({zoom:a},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),r.addDash(y,b),e.patterns[l.id]=r.getKey(y,b)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}addFeatures(e,r,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,sw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ew),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,l,h,p){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),v=y.get("line-cap").evaluate(e,{}),E=y.get("line-miter-limit"),k=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of r)this.addLine(P,e,b,v,E,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}addLine(e,r,a,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=rw[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let v=0;for(;v<b-1&&e[v].equals(e[v+1]);)v++;if(b<(y?3:2))return;a==="bevel"&&(h=1.05);const E=this.overscaling<=16?15*zt/(512*this.overscaling):0,k=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let P,L,R,B,X;this.e1=this.e2=-1,y&&(P=e[b-2],X=e[v].sub(P)._unit()._perp());for(let ie=v;ie<b;ie++){if(R=ie===b-1?y?e[v+1]:void 0:e[ie+1],R&&e[ie].equals(R))continue;X&&(B=X),P&&(L=P),P=e[ie],X=R?R.sub(P)._unit()._perp():B,B=B||X;let pe=B.add(X);pe.x===0&&pe.y===0||pe._unit();const ne=B.x*X.x+B.y*X.y,de=pe.x*X.x+pe.y*X.y,xe=de!==0?1/de:1/0,ge=2*Math.sqrt(2-2*de),Ue=de<iw&&L&&R,Oe=B.x*X.y-B.y*X.x>0;if(Ue&&ie>v){const qe=P.dist(L);if(qe>2*E){const Je=P.sub(P.sub(L)._mult(E/qe)._round());this.updateDistance(L,Je),this.addCurrentVertex(Je,B,0,0,k),L=Je}}const He=L&&R;let ot=He?a:y?"butt":l;if(He&&ot==="round"&&(xe<p?ot="miter":xe<=2&&(ot="fakeround")),ot==="miter"&&xe>h&&(ot="bevel"),ot==="bevel"&&(xe>2&&(ot="flipbevel"),xe<h&&(ot="miter")),L&&this.updateDistance(L,P),ot==="miter")pe._mult(xe),this.addCurrentVertex(P,pe,0,0,k);else if(ot==="flipbevel"){if(xe>100)pe=X.mult(-1);else{const qe=xe*B.add(X).mag()/B.sub(X).mag();pe._perp()._mult(qe*(Oe?-1:1))}this.addCurrentVertex(P,pe,0,0,k),this.addCurrentVertex(P,pe.mult(-1),0,0,k)}else if(ot==="bevel"||ot==="fakeround"){const qe=-Math.sqrt(xe*xe-1),Je=Oe?qe:0,Ye=Oe?0:qe;if(L&&this.addCurrentVertex(P,B,Je,Ye,k),ot==="fakeround"){const it=Math.round(180*ge/Math.PI/20);for(let dt=1;dt<it;dt++){let Ze=dt/it;if(Ze!==.5){const Mt=Ze-.5;Ze+=Ze*Mt*(Ze-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*Mt*Mt+(.848013+ne*(.215638*ne-1.06021)))}const vt=X.sub(B)._mult(Ze)._add(B)._unit()._mult(Oe?-1:1);this.addHalfVertex(P,vt.x,vt.y,!1,Oe,0,k)}}R&&this.addCurrentVertex(P,X,-Je,-Ye,k)}else if(ot==="butt")this.addCurrentVertex(P,pe,0,0,k);else if(ot==="square"){const qe=L?1:-1;L||this.addCurrentVertex(P,pe,qe,qe,k),this.addCurrentVertex(P,pe,0,0,k),L&&this.addCurrentVertex(P,pe,qe,qe,k)}else ot==="round"&&(L&&(this.addCurrentVertex(P,B,0,0,k),this.addCurrentVertex(P,B,1,1,k,!0)),R&&(this.addCurrentVertex(P,X,-1,-1,k,!0),this.addCurrentVertex(P,X,0,0,k)));if(Ue&&ie<b-1){const qe=P.dist(R);if(qe>2*E){const Je=P.add(R.sub(P)._mult(E/qe)._round());this.updateDistance(P,Je),this.addCurrentVertex(Je,X,0,0,k),P=Je}}}}addCurrentVertex(e,r,a,l,h,p=!1){const y=r.y*l-r.x,b=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,p,!1,a,h),this.addHalfVertex(e,y,b,p,!0,-l,h)}addHalfVertex({x:e,y:r},a,l,h,p,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),b.primitiveLength++),p?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ct(mh,"LineBucket",{omit:["layers","patternFeatures"]});const nw=new oe({"line-cap":new Q(We.layout_line["line-cap"]),"line-join":new Q(We.layout_line["line-join"]),"line-miter-limit":new F(We.layout_line["line-miter-limit"]),"line-round-limit":new F(We.layout_line["line-round-limit"]),"line-sort-key":new Q(We.layout_line["line-sort-key"])});var gx={paint:new oe({"line-opacity":new Q(We.paint_line["line-opacity"]),"line-color":new Q(We.paint_line["line-color"]),"line-translate":new F(We.paint_line["line-translate"]),"line-translate-anchor":new F(We.paint_line["line-translate-anchor"]),"line-width":new Q(We.paint_line["line-width"]),"line-gap-width":new Q(We.paint_line["line-gap-width"]),"line-offset":new Q(We.paint_line["line-offset"]),"line-blur":new Q(We.paint_line["line-blur"]),"line-dasharray":new Q(We.paint_line["line-dasharray"]),"line-pattern":new Q(We.paint_line["line-pattern"]),"line-gradient":new ae(We.paint_line["line-gradient"]),"line-trim-offset":new F(We.paint_line["line-trim-offset"])}),layout:nw};const xx=new class extends Q{possiblyEvaluate(s,e){return e=new C(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(s,e)}evaluate(s,e,r,a){return e=Ut({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(s,e,r,a)}}(gx.paint.properties["line-width"].specification);function yx(s,e){return e>0?e+2*s:s}xx.useIntegerZoom=!0;const aw=ke([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ow=ke([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),lw=ke([{name:"a_projected_pos",components:4,type:"Float32"}],4);ke([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cw=ke([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),uw=ke([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _x=ke([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dw=ke([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ke([{name:"triangle",components:3,type:"Uint16"}]),ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ke([{type:"Float32",name:"offsetX"}]),ke([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Rr=24;const _n=128;function bp(s,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new C(s+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:l}=r;let h=0;for(;h<a.length&&a[h]<=s;)h++;h=Math.max(0,h-1);let p=h;for(;p<a.length&&a[p]<s+1;)p++;p=Math.min(a.length-1,p);const y=a[h],b=a[p];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new C(y)),maxSize:r.evaluate(new C(b)),interpolationType:l}}}function ph(s,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:l}){return s.kind==="source"?a/_n:s.kind==="composite"?ds(a/_n,l/_n,r):e}function Ul(s,e){let r=0,a=0;if(s.kind==="constant")a=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=s,y=l?wt(qi.interpolationFactor(l,e,h,p),0,1):0;s.kind==="camera"?a=ds(s.minSize,s.maxSize,y):r=y}return{uSizeT:r,uSize:a}}var hw=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:_n,evaluateSizeForFeature:ph,evaluateSizeForZoom:Ul,getSizeData:bp});function mw(s,e,r){return s.sections.forEach(a=>{a.text=function(l,h,p){const y=h.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),S.applyArabicShaping&&(l=S.applyArabicShaping(l)),l}(a.text,e,r)}),s}const Cu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function pw(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function fw(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var bx=Ms,vx=function(s,e,r,a,l){var h,p,y=8*l-a-1,b=(1<<y)-1,v=b>>1,E=-7,k=l-1,P=-1,L=s[e+k];for(k+=P,h=L&(1<<-E)-1,L>>=-E,E+=y;E>0;h=256*h+s[e+k],k+=P,E-=8);for(p=h&(1<<-E)-1,h>>=-E,E+=a;E>0;p=256*p+s[e+k],k+=P,E-=8);if(h===0)h=1-v;else{if(h===b)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,a),h-=v}return(L?-1:1)*p*Math.pow(2,h-a)},wx=function(s,e,r,a,l,h){var p,y,b,v=8*h-l-1,E=(1<<v)-1,k=E>>1,P=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=0,R=1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,p=E):(p=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-p))<1&&(p--,b*=2),(e+=p+k>=1?P/b:P*Math.pow(2,1-k))*b>=2&&(p++,b/=2),p+k>=E?(y=0,p=E):p+k>=1?(y=(e*b-1)*Math.pow(2,l),p+=k):(y=e*Math.pow(2,k-1)*Math.pow(2,l),p=0));l>=8;s[r+L]=255&y,L+=R,y/=256,l-=8);for(p=p<<l|y,v+=l;v>0;s[r+L]=255&p,L+=R,p/=256,v-=8);s[r+L-R]|=128*B};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Ms(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Ms.Varint=0,Ms.Fixed64=1,Ms.Bytes=2,Ms.Fixed32=5;var vp=4294967296,jx=1/vp,Nx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ca(s){return s.type===Ms.Bytes?s.readVarint()+s.pos:s.pos+1}function Vl(s,e,r){return r?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function Sx(s,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=s;l--)r.buf[l+a]=r.buf[l]}function gw(s,e){for(var r=0;r<s.length;r++)e.writeVarint(s[r])}function xw(s,e){for(var r=0;r<s.length;r++)e.writeSVarint(s[r])}function yw(s,e){for(var r=0;r<s.length;r++)e.writeFloat(s[r])}function _w(s,e){for(var r=0;r<s.length;r++)e.writeDouble(s[r])}function bw(s,e){for(var r=0;r<s.length;r++)e.writeBoolean(s[r])}function vw(s,e){for(var r=0;r<s.length;r++)e.writeFixed32(s[r])}function ww(s,e){for(var r=0;r<s.length;r++)e.writeSFixed32(s[r])}function jw(s,e){for(var r=0;r<s.length;r++)e.writeFixed64(s[r])}function Nw(s,e){for(var r=0;r<s.length;r++)e.writeSFixed64(s[r])}function fh(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+16777216*s[e+3]}function ql(s,e,r){s[r]=e,s[r+1]=e>>>8,s[r+2]=e>>>16,s[r+3]=e>>>24}function Tx(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+(s[e+3]<<24)}Ms.prototype={destroy:function(){this.buf=null},readFields:function(s,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,h=this.pos;this.type=7&a,s(l,e,this),this.pos===h&&this.skip(a)}return e},readMessage:function(s,e){return this.readFields(s,e,this.readVarint()+this.pos)},readFixed32:function(){var s=fh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Tx(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=fh(this.buf,this.pos)+fh(this.buf,this.pos+4)*vp;return this.pos+=8,s},readSFixed64:function(){var s=fh(this.buf,this.pos)+Tx(this.buf,this.pos+4)*vp;return this.pos+=8,s},readFloat:function(){var s=vx(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=vx(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(l,h,p){var y,b,v=p.buf;if(y=(112&(b=v[p.pos++]))>>4,b<128||(y|=(127&(b=v[p.pos++]))<<3,b<128)||(y|=(127&(b=v[p.pos++]))<<10,b<128)||(y|=(127&(b=v[p.pos++]))<<17,b<128)||(y|=(127&(b=v[p.pos++]))<<24,b<128)||(y|=(1&(b=v[p.pos++]))<<31,b<128))return Vl(l,y,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&Nx?function(r,a,l){return Nx.decode(r.subarray(a,l))}(this.buf,e,s):function(r,a,l){for(var h="",p=a;p<l;){var y,b,v,E=r[p],k=null,P=E>239?4:E>223?3:E>191?2:1;if(p+P>l)break;P===1?E<128&&(k=E):P===2?(192&(y=r[p+1]))==128&&(k=(31&E)<<6|63&y)<=127&&(k=null):P===3?(b=r[p+2],(192&(y=r[p+1]))==128&&(192&b)==128&&((k=(15&E)<<12|(63&y)<<6|63&b)<=2047||k>=55296&&k<=57343)&&(k=null)):P===4&&(b=r[p+2],v=r[p+3],(192&(y=r[p+1]))==128&&(192&b)==128&&(192&v)==128&&((k=(15&E)<<18|(63&y)<<12|(63&b)<<6|63&v)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,P=1):k>65535&&(k-=65536,h+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),h+=String.fromCharCode(k),p+=P}return h}(this.buf,e,s)},readBytes:function(){var s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e},readPackedVarint:function(s,e){if(this.type!==Ms.Bytes)return s.push(this.readVarint(e));var r=ca(this);for(s=s||[];this.pos<r;)s.push(this.readVarint(e));return s},readPackedSVarint:function(s){if(this.type!==Ms.Bytes)return s.push(this.readSVarint());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Ms.Bytes)return s.push(this.readBoolean());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Ms.Bytes)return s.push(this.readFloat());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Ms.Bytes)return s.push(this.readDouble());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Ms.Bytes)return s.push(this.readFixed32());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Ms.Bytes)return s.push(this.readSFixed32());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Ms.Bytes)return s.push(this.readFixed64());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Ms.Bytes)return s.push(this.readSFixed64());var e=ca(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed64());return s},skip:function(s){var e=7&s;if(e===Ms.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ms.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ms.Fixed32)this.pos+=4;else{if(e!==Ms.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(s,e){this.writeVarint(s<<3|e)},realloc:function(s){for(var e=this.length||16;e<this.pos+s;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),ql(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),ql(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),ql(this.buf,-1&s,this.pos),ql(this.buf,Math.floor(s*jx),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),ql(this.buf,-1&s,this.pos),ql(this.buf,Math.floor(s*jx),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(e,r){var a,l;if(e>=0?(a=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,p,y){y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,y.buf[y.pos]=127&(h>>>=7)}(a,0,r),function(h,p){var y=(7&h)<<4;p.buf[p.pos++]|=y|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,r)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var e=this.pos;this.pos=function(a,l,h){for(var p,y,b=0;b<l.length;b++){if((p=l.charCodeAt(b))>55295&&p<57344){if(!y){p>56319||b+1===l.length?(a[h++]=239,a[h++]=191,a[h++]=189):y=p;continue}if(p<56320){a[h++]=239,a[h++]=191,a[h++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(a[h++]=239,a[h++]=191,a[h++]=189,y=null);p<128?a[h++]=p:(p<2048?a[h++]=p>>6|192:(p<65536?a[h++]=p>>12|224:(a[h++]=p>>18|240,a[h++]=p>>12&63|128),a[h++]=p>>6&63|128),a[h++]=63&p|128)}return h}(this.buf,s,this.pos);var r=this.pos-e;r>=128&&Sx(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(s){this.realloc(4),wx(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),wx(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var e=s.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=s[r]},writeRawMessage:function(s,e){this.pos++;var r=this.pos;s(e,this);var a=this.pos-r;a>=128&&Sx(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(s,e,r){this.writeTag(s,Ms.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(s,e){e.length&&this.writeMessage(s,gw,e)},writePackedSVarint:function(s,e){e.length&&this.writeMessage(s,xw,e)},writePackedBoolean:function(s,e){e.length&&this.writeMessage(s,bw,e)},writePackedFloat:function(s,e){e.length&&this.writeMessage(s,yw,e)},writePackedDouble:function(s,e){e.length&&this.writeMessage(s,_w,e)},writePackedFixed32:function(s,e){e.length&&this.writeMessage(s,vw,e)},writePackedSFixed32:function(s,e){e.length&&this.writeMessage(s,ww,e)},writePackedFixed64:function(s,e){e.length&&this.writeMessage(s,jw,e)},writePackedSFixed64:function(s,e){e.length&&this.writeMessage(s,Nw,e)},writeBytesField:function(s,e){this.writeTag(s,Ms.Bytes),this.writeBytes(e)},writeFixed32Field:function(s,e){this.writeTag(s,Ms.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(s,e){this.writeTag(s,Ms.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(s,e){this.writeTag(s,Ms.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(s,e){this.writeTag(s,Ms.Fixed64),this.writeSFixed64(e)},writeVarintField:function(s,e){this.writeTag(s,Ms.Varint),this.writeVarint(e)},writeSVarintField:function(s,e){this.writeTag(s,Ms.Varint),this.writeSVarint(e)},writeStringField:function(s,e){this.writeTag(s,Ms.Bytes),this.writeString(e)},writeFloatField:function(s,e){this.writeTag(s,Ms.Fixed32),this.writeFloat(e)},writeDoubleField:function(s,e){this.writeTag(s,Ms.Fixed64),this.writeDouble(e)},writeBooleanField:function(s,e){this.writeVarintField(s,!!e)}};var gh=je(bx);const wp=3;function Sw(s,e,r){e.glyphs=[],s===1&&r.readMessage(Tw,e)}function Tw(s,e,r){if(s===3){const{id:a,bitmap:l,width:h,height:p,left:y,top:b,advance:v}=r.readMessage(Ew,{});e.glyphs.push({id:a,bitmap:new la({width:h+2*wp,height:p+2*wp},l),metrics:{width:h,height:p,left:y,top:b,advance:v}})}else s===4?e.ascender=r.readSVarint():s===5&&(e.descender=r.readSVarint())}function Ew(s,e,r){s===1?e.id=r.readVarint():s===2?e.bitmap=r.readBytes():s===3?e.width=r.readVarint():s===4?e.height=r.readVarint():s===5?e.left=r.readSVarint():s===6?e.top=r.readSVarint():s===7&&(e.advance=r.readVarint())}const Ex=wp;function jp(s){let e=0,r=0;for(const p of s)e+=p.w*p.h,r=Math.max(r,p.w);s.sort((p,y)=>y.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,h=0;for(const p of s)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===b.w&&p.h===b.h){const v=a.pop();y<a.length&&(a[y]=v)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(a.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}const hi=1;class Np{constructor(e,{pixelRatio:r,version:a,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+hi,this.paddedRect.y+hi]}get br(){return[this.paddedRect.x+this.paddedRect.w-hi,this.paddedRect.y+this.paddedRect.h-hi]}get displaySize(){return[(this.paddedRect.w-2*hi)/this.pixelRatio,(this.paddedRect.h-2*hi)/this.pixelRatio]}}class Cx{constructor(e,r){const a={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,a,h),this.addImages(r,l,h);const{w:p,h:y}=jp(h),b=new Si({width:p||1,height:y||1});for(const v in e){const E=e[v],k=a[v].paddedRect;Si.copy(E.data,b,{x:0,y:0},{x:k.x+hi,y:k.y+hi},E.data)}for(const v in r){const E=r[v],k=l[v].paddedRect,P=k.x+hi,L=k.y+hi,R=E.data.width,B=E.data.height;Si.copy(E.data,b,{x:0,y:0},{x:P,y:L},E.data),Si.copy(E.data,b,{x:0,y:B-1},{x:P,y:L-1},{width:R,height:1}),Si.copy(E.data,b,{x:0,y:0},{x:P,y:L+B},{width:R,height:1}),Si.copy(E.data,b,{x:R-1,y:0},{x:P-1,y:L},{width:1,height:B}),Si.copy(E.data,b,{x:0,y:0},{x:P+R,y:L},{width:1,height:B})}this.image=b,this.iconPositions=a,this.patternPositions=l}addImages(e,r,a){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2*hi,h:h.data.height+2*hi};a.push(p),r[l]=new Np(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,h]=e.tl;a.update(r.data,void 0,{x:l,y:h})}}Ct(Np,"ImagePosition"),Ct(Cx,"ImageAtlas");const zi={horizontal:1,vertical:2,horizontalOnly:3},kx=-17;class ku{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new ku;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new ku;return r.imageName=e,r}}class $l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new $l;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?a.addImageSection(h):a.addTextSection(h,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,a){let l="";for(let h=0;h<r.length;h++){const p=r.charCodeAt(h+1)||null,y=r.charCodeAt(h-1)||null;l+=!a&&(p&&Gd(p)&&!Cu[r[h+1]]||y&&Gd(y)&&!Cu[r[h-1]])||!Cu[r[h]]?r[h]:Cu[r[h]]}return l}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&xh[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&xh[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new $l;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(ku.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void As("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(ku.forImage(r)),this.sectionIndex.push(this.sections.length-1)):As("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sp(s,e,r,a,l,h,p,y,b,v,E,k,P,L,R){const B=$l.fromFeature(s,l);k===zi.vertical&&B.verticalizePunctuation(P);let X=[];const ie=function(ge,Ue,Oe,He,ot,qe){if(!ge)return[];const Je=[],Ye=function(vt,Mt,jt,$t,ht,Rt){let Gt=0;for(let ps=0;ps<vt.length();ps++){const Zt=vt.getSection(ps);Gt+=Ax(vt.getCharCode(ps),Zt,$t,ht,Mt,Rt)}return Gt/Math.max(1,Math.ceil(Gt/jt))}(ge,Ue,Oe,He,ot,qe),it=ge.text.indexOf("")>=0;let dt=0;for(let vt=0;vt<ge.length();vt++){const Mt=ge.getSection(vt),jt=ge.getCharCode(vt);if(xh[jt]||(dt+=Ax(jt,Mt,He,ot,Ue,qe)),vt<ge.length()-1){const $t=!((Ze=jt)<11904||!(St["Bopomofo Extended"](Ze)||St.Bopomofo(Ze)||St["CJK Compatibility Forms"](Ze)||St["CJK Compatibility Ideographs"](Ze)||St["CJK Compatibility"](Ze)||St["CJK Radicals Supplement"](Ze)||St["CJK Strokes"](Ze)||St["CJK Symbols and Punctuation"](Ze)||St["CJK Unified Ideographs Extension A"](Ze)||St["CJK Unified Ideographs"](Ze)||St["Enclosed CJK Letters and Months"](Ze)||St["Halfwidth and Fullwidth Forms"](Ze)||St.Hiragana(Ze)||St["Ideographic Description Characters"](Ze)||St["Kangxi Radicals"](Ze)||St["Katakana Phonetic Extensions"](Ze)||St.Katakana(Ze)||St["Vertical Forms"](Ze)||St["Yi Radicals"](Ze)||St["Yi Syllables"](Ze)));(Cw[jt]||$t||Mt.imageName)&&Je.push(Px(vt+1,dt,Ye,Je,kw(jt,ge.getCharCode(vt+1),$t&&it),!1))}}var Ze;return Ix(Px(ge.length(),dt,Ye,Je,0,!0))}(B,v,h,e,a,L),{processBidirectionalText:pe,processStyledBidirectionalText:ne}=S;if(pe&&B.sections.length===1){const ge=pe(B.toString(),ie);for(const Ue of ge){const Oe=new $l;Oe.text=Ue,Oe.sections=B.sections;for(let He=0;He<Ue.length;He++)Oe.sectionIndex.push(0);X.push(Oe)}}else if(ne){const ge=ne(B.text,B.sectionIndex,ie);for(const Ue of ge){const Oe=new $l;Oe.text=Ue[0],Oe.sectionIndex=Ue[1],Oe.sections=B.sections,X.push(Oe)}}else X=function(ge,Ue){const Oe=[],He=ge.text;let ot=0;for(const qe of Ue)Oe.push(ge.substring(ot,qe)),ot=qe;return ot<He.length&&Oe.push(ge.substring(ot,He.length)),Oe}(B,ie);const de=[],xe={positionedLines:de,text:B.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Ue,Oe,He,ot,qe,Je,Ye,it,dt,Ze,vt){let Mt=0,jt=0,$t=0;const ht=Ye==="right"?1:Ye==="left"?0:.5;let Rt=!1;for(const Xt of ot){const Kt=Xt.getSections();for(const Es of Kt){if(Es.imageName)continue;const Ps=Ue[Es.fontStack];if(Ps&&(Rt=Ps.ascender!==void 0&&Ps.descender!==void 0,!Rt))break}if(!Rt)break}let Gt=0;for(const Xt of ot){Xt.trim();const Kt=Xt.getMaxScale(),Es=(Kt-1)*Rr,Ps={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Gt]=Ps;const Is=Ps.positionedGlyphs;let Cs=0;if(!Xt.length()){jt+=qe,++Gt;continue}let qs=0,Ws=0;for(let ks=0;ks<Xt.length();ks++){const xr=Xt.getSection(ks),cr=Xt.getSectionIndex(ks),Gs=Xt.getCharCode(ks);let gs=xr.scale,ur=null,Ds=null,ni=null,dr=Rr,zr=0;const Cr=!(it===zi.horizontal||!Ze&&!su(Gs)||Ze&&(xh[Gs]||(ps=Gs,St.Arabic(ps)||St["Arabic Supplement"](ps)||St["Arabic Extended-A"](ps)||St["Arabic Presentation Forms-A"](ps)||St["Arabic Presentation Forms-B"](ps))));if(xr.imageName){const ai=He[xr.imageName];if(!ai)continue;ni=xr.imageName,ge.iconsInText=ge.iconsInText||!0,Ds=ai.paddedRect;const kr=ai.displaySize;gs=gs*Rr/vt,ur={width:kr[0],height:kr[1],left:hi,top:-Ex,advance:Cr?kr[1]:kr[0],localGlyph:!1},zr=Rt?-ur.height*gs:kx+Kt*Rr-kr[1]*gs,dr=ur.advance;const wn=(Cr?kr[0]:kr[1])*gs-Rr*Kt;wn>0&&wn>Cs&&(Cs=wn)}else{const ai=Oe[xr.fontStack];if(!ai)continue;ai[Gs]&&(Ds=ai[Gs]);const kr=Ue[xr.fontStack];if(!kr)continue;const wn=kr.glyphs[Gs];if(!wn)continue;if(ur=wn.metrics,dr=Gs!==8203?Rr:0,Rt){const Ql=kr.ascender!==void 0?Math.abs(kr.ascender):0,Fu=kr.descender!==void 0?Math.abs(kr.descender):0,Bu=(Ql+Fu)*gs;qs<Bu&&(qs=Bu,Ws=(Ql-Fu)/2*gs),zr=-Ql*gs}else zr=kx+(Kt-gs)*Rr}Cr?(ge.verticalizable=!0,Is.push({glyph:Gs,imageName:ni,x:Mt,y:jt+zr,vertical:Cr,scale:gs,localGlyph:ur.localGlyph,fontStack:xr.fontStack,sectionIndex:cr,metrics:ur,rect:Ds}),Mt+=dr*gs+dt):(Is.push({glyph:Gs,imageName:ni,x:Mt,y:jt+zr,vertical:Cr,scale:gs,localGlyph:ur.localGlyph,fontStack:xr.fontStack,sectionIndex:cr,metrics:ur,rect:Ds}),Mt+=ur.advance*gs+dt)}Is.length!==0&&($t=Math.max(Mt-dt,$t),Rt?Dx(Is,ht,Cs,Ws,qe*Kt/2):Dx(Is,ht,Cs,0,qe/2)),Mt=0;const lr=qe*Kt+Cs;Ps.lineOffset=Math.max(Cs,Es),jt+=lr,++Gt}var ps;const Zt=jt,{horizontalAlign:Ft,verticalAlign:Rs}=Tp(Je);(function(Xt,Kt,Es,Ps,Is,Cs){const qs=(Kt-Es)*Is,Ws=-Cs*Ps;for(const lr of Xt)for(const ks of lr.positionedGlyphs)ks.x+=qs,ks.y+=Ws})(ge.positionedLines,ht,Ft,Rs,$t,Zt),ge.top+=-Rs*Zt,ge.bottom=ge.top+Zt,ge.left+=-Ft*$t,ge.right=ge.left+$t,ge.hasBaseline=Rt}(xe,e,r,a,X,p,y,b,k,v,P,R),!function(ge){for(const Ue of ge)if(Ue.positionedGlyphs.length!==0)return!1;return!0}(de)&&xe}const xh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ax(s,e,r,a,l,h){if(e.imageName){const p=a[e.imageName];return p?p.displaySize[0]*e.scale*Rr/h+l:0}{const p=r[e.fontStack],y=p&&p.glyphs[s];return y?y.metrics.advance*e.scale+l:0}}function Mx(s,e,r,a){const l=Math.pow(s-e,2);return a?s<e?l/2:2*l:l+Math.abs(r)*r}function kw(s,e,r){let a=0;return s===10&&(a-=1e4),r&&(a+=150),s!==40&&s!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Px(s,e,r,a,l,h){let p=null,y=Mx(e,r,l,h);for(const b of a){const v=Mx(e-b.x,r,l,h)+b.badness;v<=y&&(p=b,y=v)}return{index:s,x:e,priorBreak:p,badness:y}}function Ix(s){return s?Ix(s.priorBreak).concat(s.index):[]}function Tp(s){let e=.5,r=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Dx(s,e,r,a,l){if(!(e||r||a||l))return;const h=s.length-1,p=s[h],y=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=h;b++)s[b].x-=y,s[b].y+=r+a+l}function Aw(s,e,r){const{horizontalAlign:a,verticalAlign:l}=Tp(r),h=e[0]-s.displaySize[0]*a,p=e[1]-s.displaySize[1]*l;return{image:s,top:p,bottom:p+s.displaySize[1],left:h,right:h+s.displaySize[0]}}function Lx(s,e,r,a,l,h){const p=s.image;let y;if(p.content){const X=p.content,ie=p.pixelRatio||1;y=[X[0]/ie,X[1]/ie,p.displaySize[0]-X[2]/ie,p.displaySize[1]-X[3]/ie]}const b=e.left*h,v=e.right*h;let E,k,P,L;r==="width"||r==="both"?(L=l[0]+b-a[3],k=l[0]+v+a[1]):(L=l[0]+(b+v-p.displaySize[0])/2,k=L+p.displaySize[0]);const R=e.top*h,B=e.bottom*h;return r==="height"||r==="both"?(E=l[1]+R-a[0],P=l[1]+B+a[2]):(E=l[1]+(R+B-p.displaySize[1])/2,P=E+p.displaySize[1]),{image:p,top:E,right:k,bottom:P,left:L,collisionPadding:y}}class ua extends Ee{constructor(e,r,a,l,h){super(e,r),this.angle=l,this.z=a,h!==void 0&&(this.segment=h)}clone(){return new ua(this.x,this.y,this.z,this.angle,this.segment)}}function Rx(s,e,r,a,l){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,y=0;for(;y>-r/2;){if(p--,p<0)return!1;y-=s[p].dist(h),h=s[p]}y+=s[p].dist(s[p+1]),p++;const b=[];let v=0;for(;y<r/2;){const E=s[p],k=s[p+1];if(!k)return!1;let P=s[p-1].angleTo(E)-E.angleTo(k);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:P}),v+=P;y-b[0].distance>a;)v-=b.shift().angleDelta;if(v>l)return!1;p++,y+=E.dist(k)}return!0}function zx(s){let e=0;for(let r=0;r<s.length-1;r++)e+=s[r].dist(s[r+1]);return e}function Ox(s,e,r){return s?.6*e*r:0}function Fx(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function Mw(s,e,r,a,l,h){const p=Ox(r,l,h),y=Fx(r,a)*h;let b=0;const v=zx(s)/2;for(let E=0;E<s.length-1;E++){const k=s[E],P=s[E+1],L=k.dist(P);if(b+L>v){const R=(v-b)/L,B=ds(k.x,P.x,R),X=ds(k.y,P.y,R),ie=new ua(B,X,0,P.angleTo(k),E);return!p||Rx(s,ie,y,p,e)?ie:void 0}b+=L}}function Pw(s,e,r,a,l,h,p,y,b){const v=Ox(a,h,p),E=Fx(a,l),k=E*p,P=s[0].x===0||s[0].x===b||s[0].y===0||s[0].y===b;return e-k<e/4&&(e=k+e/4),Bx(s,P?e/2*y%e:(E/2+2*h)*p*y%e,e,v,r,k,P,!1,b)}function Bx(s,e,r,a,l,h,p,y,b){const v=h/2,E=zx(s);let k=0,P=e-r,L=[];for(let R=0;R<s.length-1;R++){const B=s[R],X=s[R+1],ie=B.dist(X),pe=X.angleTo(B);for(;P+r<k+ie;){P+=r;const ne=(P-k)/ie,de=ds(B.x,X.x,ne),xe=ds(B.y,X.y,ne);if(de>=0&&de<b&&xe>=0&&xe<b&&P-v>=0&&P+v<=E){const ge=new ua(de,xe,0,pe,R);ge._round(),a&&!Rx(s,ge,h,a,l)||L.push(ge)}}k+=ie}return y||L.length||p||(L=Bx(s,k/2,r,a,l,h,p,!0,b)),L}function Ux(s,e,r,a,l){const h=[];for(let p=0;p<s.length;p++){const y=s[p];let b;for(let v=0;v<y.length-1;v++){let E=y[v],k=y[v+1];E.x<e&&k.x<e||(E.x<e?E=new Ee(e,E.y+(e-E.x)/(k.x-E.x)*(k.y-E.y))._round():k.x<e&&(k=new Ee(e,E.y+(e-E.x)/(k.x-E.x)*(k.y-E.y))._round()),E.y<r&&k.y<r||(E.y<r?E=new Ee(E.x+(r-E.y)/(k.y-E.y)*(k.x-E.x),r)._round():k.y<r&&(k=new Ee(E.x+(r-E.y)/(k.y-E.y)*(k.x-E.x),r)._round()),E.x>=a&&k.x>=a||(E.x>=a?E=new Ee(a,E.y+(a-E.x)/(k.x-E.x)*(k.y-E.y))._round():k.x>=a&&(k=new Ee(a,E.y+(a-E.x)/(k.x-E.x)*(k.y-E.y))._round()),E.y>=l&&k.y>=l||(E.y>=l?E=new Ee(E.x+(l-E.y)/(k.y-E.y)*(k.x-E.x),l)._round():k.y>=l&&(k=new Ee(E.x+(l-E.y)/(k.y-E.y)*(k.x-E.x),l)._round()),b&&E.equals(b[b.length-1])||(b=[E],h.push(b)),b.push(k)))))}}return h}Ct(ua,"Anchor");const Au=1e20;function Vx(s,e,r,a,l,h,p,y,b){for(let v=e;v<e+a;v++)qx(s,r*h+v,h,l,p,y,b);for(let v=r;v<r+l;v++)qx(s,v*h+e,1,a,p,y,b)}function qx(s,e,r,a,l,h,p){h[0]=0,p[0]=-Au,p[1]=Au,l[0]=s[e];for(let y=1,b=0,v=0;y<a;y++){l[y]=s[e+y*r];const E=y*y;do{const k=h[b];v=(l[y]-l[k]+E-k*k)/(y-k)/2}while(v<=p[b]&&--b>-1);b++,h[b]=y,p[b]=v,p[b+1]=Au}for(let y=0,b=0;y<a;y++){for(;p[b+1]<y;)b++;const v=h[b],E=y-v;s[e+y*r]=l[v]+E*E}}const bn=2,Ep={none:0,ideographs:1,all:2};class Gl{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const a=[];for(const l in e)for(const h of e[l])a.push({stack:l,id:h});_s(a,({stack:l,id:h},p)=>{let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[h];if(b!==void 0)return void p(null,{stack:l,id:h,glyph:b});if(b=this._tinySDF(y,l,h),b)return y.glyphs[h]=b,void p(null,{stack:l,id:h,glyph:b});const v=Math.floor(h/256);if(256*v>65535)return void p(new Error("glyphs > 65535 not supported"));if(y.ranges[v])return void p(null,{stack:l,id:h,glyph:b});let E=y.requests[v];E||(E=y.requests[v]=[],Gl.loadGlyphRange(l,v,this.url,this.requestManager,(k,P)=>{if(P){y.ascender=P.ascender,y.descender=P.descender;for(const L in P.glyphs)this._doesCharSupportLocalGlyph(+L)||(y.glyphs[+L]=P.glyphs[+L]);y.ranges[v]=!0}for(const L of E)L(k,P);delete y.requests[v]})),E.push((k,P)=>{k?p(k):P&&p(null,{stack:l,id:h,glyph:P.glyphs[h]||null})})},(l,h)=>{if(l)r(l);else if(h){const p={};for(const{stack:y,id:b,glyph:v}of h)p[y]===void 0&&(p[y]={}),p[y].glyphs===void 0&&(p[y].glyphs={}),p[y].glyphs[b]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},p[y].ascender=this.entries[y].ascender,p[y].descender=this.entries[y].descender;r(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ep.none&&(this.localGlyphMode===Ep.all?!!this.localFontFamily:!!this.localFontFamily&&(St["CJK Unified Ideographs"](e)||St["Hangul Syllables"](e)||St.Hiragana(e)||St.Katakana(e)||St["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,a){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let B="400";/bold/i.test(r)?B="900":/medium/i.test(r)?B="500":/light/i.test(r)&&(B="200"),h=e.tinySDF=new Gl.TinySDF({fontFamily:l,fontWeight:B,fontSize:24*bn,buffer:3*bn,radius:8*bn}),h.fontWeight=B}if(this.localGlyphs[h.fontWeight][a])return this.localGlyphs[h.fontWeight][a];const p=String.fromCharCode(a),{data:y,width:b,height:v,glyphWidth:E,glyphHeight:k,glyphLeft:P,glyphTop:L,glyphAdvance:R}=h.draw(p);return this.localGlyphs[h.fontWeight][a]={id:a,bitmap:new la({width:b,height:v},y),metrics:{width:E/bn,height:k/bn,left:P/bn,top:L/bn-27,advance:R/bn,localGlyph:!0}}}}Gl.loadGlyphRange=function(s,e,r,a,l){const h=256*e,p=h+255,y=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",s).replace("{range}",`${h}-${p}`),Dr.Glyphs);tn(y,(b,v)=>{if(b)l(b);else if(v){const E={},k=function(P){return new gh(P).readFields(Sw,{})}(v);for(const P of k.glyphs)E[P.id]=P;l(null,{glyphs:E,ascender:k.ascender,descender:k.descender})}})},Gl.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const y=this.size=s+4*e,b=this._createCanvas(y),v=this.ctx=b.getContext("2d",{willReadFrequently:!0});v.font=`${p} ${h} ${s}px ${l}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(s),p=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),b=Math.min(this.size-this.buffer,p+Math.ceil(a)),v=y+2*this.buffer,E=b+2*this.buffer,k=Math.max(v*E,0),P=new Uint8ClampedArray(k),L={data:P,width:v,height:E,glyphWidth:y,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return L;const{ctx:R,buffer:B,gridInner:X,gridOuter:ie}=this;R.clearRect(B,B,y,b),R.fillText(s,B,B+p);const pe=R.getImageData(B,B,y,b);ie.fill(Au,0,k),X.fill(0,0,k);for(let ne=0;ne<b;ne++)for(let de=0;de<y;de++){const xe=pe.data[4*(ne*y+de)+3]/255;if(xe===0)continue;const ge=(ne+B)*v+de+B;if(xe===1)ie[ge]=0,X[ge]=Au;else{const Ue=.5-xe;ie[ge]=Ue>0?Ue*Ue:0,X[ge]=Ue<0?Ue*Ue:0}}Vx(ie,0,0,v,E,v,this.f,this.v,this.z),Vx(X,B,B,y,b,v,this.f,this.v,this.z);for(let ne=0;ne<k;ne++){const de=Math.sqrt(ie[ne])-Math.sqrt(X[ne]);P[ne]=Math.round(255-255*(de/this.radius+this.cutoff))}return L}};const Zl=hi;function $x(s,e,r,a){const l=[],h=s.image,p=h.pixelRatio,y=h.paddedRect.w-2*Zl,b=h.paddedRect.h-2*Zl,v=s.right-s.left,E=s.bottom-s.top,k=h.stretchX||[[0,y]],P=h.stretchY||[[0,b]],L=(qe,Je)=>qe+Je[1]-Je[0],R=k.reduce(L,0),B=P.reduce(L,0),X=y-R,ie=b-B;let pe=0,ne=R,de=0,xe=B,ge=0,Ue=X,Oe=0,He=ie;if(h.content&&a){const qe=h.content;pe=yh(k,0,qe[0]),de=yh(P,0,qe[1]),ne=yh(k,qe[0],qe[2]),xe=yh(P,qe[1],qe[3]),ge=qe[0]-pe,Oe=qe[1]-de,Ue=qe[2]-qe[0]-ne,He=qe[3]-qe[1]-xe}const ot=(qe,Je,Ye,it)=>{const dt=_h(qe.stretch-pe,ne,v,s.left),Ze=bh(qe.fixed-ge,Ue,qe.stretch,R),vt=_h(Je.stretch-de,xe,E,s.top),Mt=bh(Je.fixed-Oe,He,Je.stretch,B),jt=_h(Ye.stretch-pe,ne,v,s.left),$t=bh(Ye.fixed-ge,Ue,Ye.stretch,R),ht=_h(it.stretch-de,xe,E,s.top),Rt=bh(it.fixed-Oe,He,it.stretch,B),Gt=new Ee(dt,vt),ps=new Ee(jt,vt),Zt=new Ee(jt,ht),Ft=new Ee(dt,ht),Rs=new Ee(Ze/p,Mt/p),Xt=new Ee($t/p,Rt/p),Kt=e*Math.PI/180;if(Kt){const Is=Math.sin(Kt),Cs=Math.cos(Kt),qs=[Cs,-Is,Is,Cs];Gt._matMult(qs),ps._matMult(qs),Ft._matMult(qs),Zt._matMult(qs)}const Es=qe.stretch+qe.fixed,Ps=Je.stretch+Je.fixed;return{tl:Gt,tr:ps,bl:Ft,br:Zt,tex:{x:h.paddedRect.x+Zl+Es,y:h.paddedRect.y+Zl+Ps,w:Ye.stretch+Ye.fixed-Es,h:it.stretch+it.fixed-Ps},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rs,pixelOffsetBR:Xt,minFontScaleX:Ue/p/v,minFontScaleY:He/p/E,isSDF:r}};if(a&&(h.stretchX||h.stretchY)){const qe=Gx(k,X,R),Je=Gx(P,ie,B);for(let Ye=0;Ye<qe.length-1;Ye++){const it=qe[Ye],dt=qe[Ye+1];for(let Ze=0;Ze<Je.length-1;Ze++)l.push(ot(it,Je[Ze],dt,Je[Ze+1]))}}else l.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return l}function yh(s,e,r){let a=0;for(const l of s)a+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return a}function Gx(s,e,r){const a=[{fixed:-Zl,stretch:0}];for(const[l,h]of s){const p=a[a.length-1];a.push({fixed:l-p.stretch,stretch:p.stretch}),a.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return a.push({fixed:e+Zl,stretch:r}),a}function _h(s,e,r,a){return s/e*r+a}function bh(s,e,r,a){return s-e*r/a}function Iw(s,e,r,a){const l=e+s.positionedLines[a].lineOffset;return a===0?r+l/2:r+(l+(e+s.positionedLines[a-1].lineOffset))/2}class Dw{constructor(e=[],r=Lw){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,l=r[e];for(;e>0;){const h=e-1>>1,p=r[h];if(a(l,p)>=0)break;r[e]=p,e=h}r[e]=l}_down(e){const{data:r,compare:a}=this,l=this.length>>1,h=r[e];for(;e<l;){let p=1+(e<<1),y=r[p];const b=p+1;if(b<this.length&&a(r[b],y)<0&&(p=b,y=r[b]),a(y,h)>=0)break;r[e]=y,e=p}r[e]=h}}function Lw(s,e){return s<e?-1:s>e?1:0}function Rw(s,e=1,r=!1){let a=1/0,l=1/0,h=-1/0,p=-1/0;const y=s[0];for(let L=0;L<y.length;L++){const R=y[L];(!L||R.x<a)&&(a=R.x),(!L||R.y<l)&&(l=R.y),(!L||R.x>h)&&(h=R.x),(!L||R.y>p)&&(p=R.y)}const b=Math.min(h-a,p-l);let v=b/2;const E=new Dw([],zw);if(b===0)return new Ee(a,l);for(let L=a;L<h;L+=b)for(let R=l;R<p;R+=b)E.push(new Wl(L+v,R+v,v,s));let k=function(L){let R=0,B=0,X=0;const ie=L[0];for(let pe=0,ne=ie.length,de=ne-1;pe<ne;de=pe++){const xe=ie[pe],ge=ie[de],Ue=xe.x*ge.y-ge.x*xe.y;B+=(xe.x+ge.x)*Ue,X+=(xe.y+ge.y)*Ue,R+=3*Ue}return new Wl(B/R,X/R,0,L)}(s),P=E.length;for(;E.length;){const L=E.pop();(L.d>k.d||!k.d)&&(k=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,P)),L.max-k.d<=e||(v=L.h/2,E.push(new Wl(L.p.x-v,L.p.y-v,v,s)),E.push(new Wl(L.p.x+v,L.p.y-v,v,s)),E.push(new Wl(L.p.x-v,L.p.y+v,v,s)),E.push(new Wl(L.p.x+v,L.p.y+v,v,s)),P+=4)}return r&&(console.log(`num probes: ${P}`),console.log(`best distance: ${k.d}`)),k.p}function zw(s,e){return e.max-s.max}class Wl{constructor(e,r,a,l){this.p=new Ee(e,r),this.h=a,this.d=function(h,p){let y=!1,b=1/0;for(let v=0;v<p.length;v++){const E=p[v];for(let k=0,P=E.length,L=P-1;k<P;L=k++){const R=E[k],B=E[L];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(y=!y),b=Math.min(b,Bg(h,R,B))}}return(y?1:-1)*Math.sqrt(b)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Hl=7,Cp=Number.POSITIVE_INFINITY,Ow=Math.sqrt(2);function Zx(s,[e,r]){let a=0,l=0;if(r===Cp){e<0&&(e=0);const h=e/Ow;switch(s){case"top-right":case"top-left":l=h-Hl;break;case"bottom-right":case"bottom-left":l=-h+Hl;break;case"bottom":l=-e+Hl;break;case"top":l=e-Hl}switch(s){case"top-right":case"bottom-right":a=-h;break;case"top-left":case"bottom-left":a=h;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),s){case"top-right":case"top-left":case"top":l=r-Hl;break;case"bottom-right":case"bottom-left":case"bottom":l=-r+Hl}switch(s){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,l]}function Fw(s,e,r,a,l,h,p,y,b,v){s.createArrays(),s.tilePixelRatio=zt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const E=s.layers[0].layout,k=s.layers[0]._unevaluatedLayout._values,P={};if(s.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:X}=s.textSizeData;P.compositeTextSizes=[k["text-size"].possiblyEvaluate(new C(B),y),k["text-size"].possiblyEvaluate(new C(X),y)]}if(s.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:X}=s.iconSizeData;P.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new C(B),y),k["icon-size"].possiblyEvaluate(new C(X),y)]}P.layoutTextSize=k["text-size"].possiblyEvaluate(new C(b+1),y),P.layoutIconSize=k["icon-size"].possiblyEvaluate(new C(b+1),y),P.textMaxSize=k["text-size"].possiblyEvaluate(new C(18),y);const L=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",R=E.get("text-size");for(const B of s.features){const X=E.get("text-font").evaluate(B,{},y).join(","),ie=R.evaluate(B,{},y),pe=P.layoutTextSize.evaluate(B,{},y),ne=(P.layoutIconSize.evaluate(B,{},y),{horizontal:{},vertical:void 0}),de=B.text;let xe,ge=[0,0];if(de){const He=de.toString(),ot=E.get("text-letter-spacing").evaluate(B,{},y)*Rr,qe=E.get("text-line-height").evaluate(B,{},y)*Rr,Je=zm(He)?ot:0,Ye=E.get("text-anchor").evaluate(B,{},y),it=E.get("text-variable-anchor");if(!it){const jt=E.get("text-radial-offset").evaluate(B,{},y);ge=jt?Zx(Ye,[jt*Rr,Cp]):E.get("text-offset").evaluate(B,{},y).map($t=>$t*Rr)}let dt=L?"center":E.get("text-justify").evaluate(B,{},y);const Ze=E.get("symbol-placement")==="point",vt=Ze?E.get("text-max-width").evaluate(B,{},y)*Rr:1/0,Mt=jt=>{s.allowVerticalPlacement&&tu(He)&&(ne.vertical=Sp(de,e,r,l,X,vt,qe,Ye,jt,Je,ge,zi.vertical,!0,pe,ie))};if(!L&&it){const jt=dt==="auto"?it.map(ht=>kp(ht)):[dt];let $t=!1;for(let ht=0;ht<jt.length;ht++){const Rt=jt[ht];if(!ne.horizontal[Rt])if($t)ne.horizontal[Rt]=ne.horizontal[0];else{const Gt=Sp(de,e,r,l,X,vt,qe,"center",Rt,Je,ge,zi.horizontal,!1,pe,ie);Gt&&(ne.horizontal[Rt]=Gt,$t=Gt.positionedLines.length===1)}}Mt("left")}else{if(dt==="auto"&&(dt=kp(Ye)),Ze||E.get("text-writing-mode").indexOf("horizontal")>=0||!tu(He)){const jt=Sp(de,e,r,l,X,vt,qe,Ye,dt,Je,ge,zi.horizontal,!1,pe,ie);jt&&(ne.horizontal[dt]=jt)}Mt(Ze?"left":dt)}}let Ue=!1;if(B.icon&&B.icon.name){const He=a[B.icon.name];He&&(xe=Aw(l[B.icon.name],E.get("icon-offset").evaluate(B,{},y),E.get("icon-anchor").evaluate(B,{},y)),Ue=He.sdf,s.sdfIcons===void 0?s.sdfIcons=He.sdf:s.sdfIcons!==He.sdf&&As("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==s.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const Oe=Hx(ne.horizontal)||ne.vertical;s.iconsInText||(s.iconsInText=!!Oe&&Oe.iconsInText),(Oe||xe)&&Bw(s,B,ne,xe,a,P,pe,0,ge,Ue,p,y,v)}h&&s.generateCollisionDebugBuffers(b,s.collisionBoxArray)}function kp(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bw(s,e,r,a,l,h,p,y,b,v,E,k,P){let L=h.textMaxSize.evaluate(e,{},k);L===void 0&&(L=p);const R=s.layers[0].layout,B=R.get("icon-offset").evaluate(e,{},k),X=Hx(r.horizontal)||r.vertical,ie=P.name==="globe",pe=Rr,ne=p/pe,de=s.tilePixelRatio*L/pe,xe=(Ye=s.overscaling,s.zoom>18&&Ye>2&&(Ye>>=1),Math.max(zt/(512*Ye),1)*R.get("symbol-spacing")),ge=R.get("text-padding")*s.tilePixelRatio,Ue=R.get("icon-padding")*s.tilePixelRatio,Oe=Te(R.get("text-max-angle")),He=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ot=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",qe=R.get("symbol-placement"),Je=xe/2;var Ye;const it=R.get("icon-text-fit");let dt;a&&it!=="none"&&(s.allowVerticalPlacement&&r.vertical&&(dt=Lx(a,r.vertical,it,R.get("icon-text-fit-padding"),B,ne)),X&&(a=Lx(a,X,it,R.get("icon-text-fit-padding"),B,ne)));const Ze=(vt,Mt,jt)=>{if(Mt.x<0||Mt.x>=zt||Mt.y<0||Mt.y>=zt)return;let $t=null;if(ie){const{x:ht,y:Rt,z:Gt}=P.projectTilePoint(Mt.x,Mt.y,jt);$t={anchor:new ua(ht,Rt,Gt,0,void 0),up:P.upVector(jt,Mt.x,Mt.y)}}(function(ht,Rt,Gt,ps,Zt,Ft,Rs,Xt,Kt,Es,Ps,Is,Cs,qs,Ws,lr,ks,xr,cr,Gs,gs,ur,Ds,ni,dr){const zr=ht.addToLineVertexArray(Rt,ps);let Cr,ai,kr,wn,Ql,Fu,Bu,Ey=0,Cy=0,ky=0,Ay=0,$p=-1,Gp=-1;const Fn={};let My=Bm("");const qo=Gt?Gt.anchor:Rt;let Zp=0,Wp=0;if(Kt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Zp,Wp]=Kt.layout.get("text-offset").evaluate(gs,{},dr).map(Ti=>Ti*Rr):(Zp=Kt.layout.get("text-radial-offset").evaluate(gs,{},dr)*Rr,Wp=Cp),ht.allowVerticalPlacement&&Zt.vertical){const Ti=Zt.vertical;if(Ws)Fu=Ap(Ti),Xt&&(Bu=Ap(Xt));else{const Ei=Kt.layout.get("text-rotate").evaluate(gs,{},dr)+90;kr=vh(Es,qo,Rt,Ps,Is,Cs,Ti,qs,Ei,lr),Xt&&(wn=vh(Es,qo,Rt,Ps,Is,Cs,Xt,xr,Ei))}}if(Ft){const Ti=Kt.layout.get("icon-rotate").evaluate(gs,{},dr),Ei=Kt.layout.get("icon-text-fit")!=="none",Uu=$x(Ft,Ti,Ds,Ei),Xp=Xt?$x(Xt,Ti,Ds,Ei):void 0;ai=vh(Es,qo,Rt,Ps,Is,Cs,Ft,xr,Ti),Ey=4*Uu.length;const Py=ht.iconSizeData;let $o=null;Py.kind==="source"?($o=[_n*Kt.layout.get("icon-size").evaluate(gs,{},dr)],$o[0]>Fa&&As(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Mu}. Reduce your "icon-size".`)):Py.kind==="composite"&&($o=[_n*ur.compositeIconSizes[0].evaluate(gs,{},dr),_n*ur.compositeIconSizes[1].evaluate(gs,{},dr)],($o[0]>Fa||$o[1]>Fa)&&As(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Mu}. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,Uu,$o,Gs,cr,gs,!1,Gt,Rt,zr.lineStartIndex,zr.lineLength,-1,ni,dr),$p=ht.icon.placedSymbolArray.length-1,Xp&&(Cy=4*Xp.length,ht.addSymbols(ht.icon,Xp,$o,Gs,cr,gs,zi.vertical,Gt,Rt,zr.lineStartIndex,zr.lineLength,-1,ni,dr),Gp=ht.icon.placedSymbolArray.length-1)}for(const Ti in Zt.horizontal){const Ei=Zt.horizontal[Ti];Cr||(My=Bm(Ei.text),Ws?Ql=Ap(Ei):Cr=vh(Es,qo,Rt,Ps,Is,Cs,Ei,qs,Kt.layout.get("text-rotate").evaluate(gs,{},dr),lr));const Uu=Ei.positionedLines.length===1;if(ky+=Wx(ht,Gt,Rt,Ei,Rs,Kt,Ws,gs,lr,zr,Zt.vertical?zi.horizontal:zi.horizontalOnly,Uu?Object.keys(Zt.horizontal):[Ti],Fn,$p,ur,ni,dr),Uu)break}Zt.vertical&&(Ay+=Wx(ht,Gt,Rt,Zt.vertical,Rs,Kt,Ws,gs,lr,zr,zi.vertical,["vertical"],Fn,Gp,ur,ni,dr));let Ga=-1;const Hp=(Ti,Ei)=>Ti?Math.max(Ti,Ei):Ei;Ga=Hp(Ql,Ga),Ga=Hp(Fu,Ga),Ga=Hp(Bu,Ga);const p1=Ga>-1?1:0;ht.glyphOffsetArray.length>=Ua.MAX_GLYPHS&&As("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gs.sortKey!==void 0&&ht.addToSortKeyRanges(ht.symbolInstances.length,gs.sortKey),ht.symbolInstances.emplaceBack(qo.x,qo.y,qo.z,Rt.x,Rt.y,Fn.right>=0?Fn.right:-1,Fn.center>=0?Fn.center:-1,Fn.left>=0?Fn.left:-1,Fn.vertical>=0?Fn.vertical:-1,$p,Gp,My,Cr!==void 0?Cr:ht.collisionBoxArray.length,Cr!==void 0?Cr+1:ht.collisionBoxArray.length,kr!==void 0?kr:ht.collisionBoxArray.length,kr!==void 0?kr+1:ht.collisionBoxArray.length,ai!==void 0?ai:ht.collisionBoxArray.length,ai!==void 0?ai+1:ht.collisionBoxArray.length,wn||ht.collisionBoxArray.length,wn?wn+1:ht.collisionBoxArray.length,Ps,ky,Ay,Ey,Cy,p1,0,Zp,Wp,Ga)})(s,Mt,$t,vt,r,a,l,dt,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,ge,He,b,0,Ue,ot,B,e,h,v,E,k)};if(qe==="line")for(const vt of Ux(e.geometry,0,0,zt,zt)){const Mt=Pw(vt,xe,Oe,r.vertical||X,a,pe,de,s.overscaling,zt);for(const jt of Mt)X&&Uw(s,X.text,Je,jt)||Ze(vt,jt,k)}else if(qe==="line-center"){for(const vt of e.geometry)if(vt.length>1){const Mt=Mw(vt,Oe,r.vertical||X,a,pe,de);Mt&&Ze(vt,Mt,k)}}else if(e.type==="Polygon")for(const vt of gp(e.geometry,0)){const Mt=Rw(vt,16);Ze(vt[0],new ua(Mt.x,Mt.y,0,0,void 0),k)}else if(e.type==="LineString")for(const vt of e.geometry)Ze(vt,new ua(vt[0].x,vt[0].y,0,0,void 0),k);else if(e.type==="Point")for(const vt of e.geometry)for(const Mt of vt)Ze([Mt],new ua(Mt.x,Mt.y,0,0,void 0),k)}const Mu=255,Fa=Mu*_n;function Wx(s,e,r,a,l,h,p,y,b,v,E,k,P,L,R,B,X){const ie=function(de,xe,ge,Ue,Oe,He,ot,qe){const Je=[];if(xe.positionedLines.length===0)return Je;const Ye=Ue.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,it=function(jt){const $t=jt[0],ht=jt[1],Rt=$t*ht;return Rt>0?[$t,-ht]:Rt<0?[-$t,ht]:$t===0?[ht,$t]:[ht,-$t]}(ge);let dt=Math.abs(xe.top-xe.bottom);for(const jt of xe.positionedLines)dt-=jt.lineOffset;const Ze=xe.positionedLines.length,vt=dt/Ze;let Mt=xe.top-ge[1];for(let jt=0;jt<Ze;++jt){const $t=xe.positionedLines[jt];Mt=Iw(xe,vt,Mt,jt);for(const ht of $t.positionedGlyphs){if(!ht.rect)continue;const Rt=ht.rect||{};let Gt=Ex+1,ps=!0,Zt=1,Ft=0;if(ht.imageName){const Ds=ot[ht.imageName];if(!Ds)continue;if(Ds.sdf){As("SDF images are not supported in formatted text and will be ignored.");continue}ps=!1,Zt=Ds.pixelRatio,Gt=hi/Zt}const Rs=(Oe||qe)&&ht.vertical,Xt=ht.metrics.advance*ht.scale/2,Kt=ht.metrics,Es=ht.rect;if(Es===null)continue;qe&&xe.verticalizable&&(Ft=ht.imageName?Xt-ht.metrics.width*ht.scale/2:0);const Ps=Oe?[ht.x+Xt,ht.y]:[0,0];let Is=[0,0],Cs=[0,0],qs=!1;Oe||(Rs?(Cs=[ht.x+Xt+it[0],ht.y+it[1]-Ft],qs=!0):Is=[ht.x+Xt+ge[0],ht.y+ge[1]-Ft]);const Ws=Es.w*ht.scale/(Zt*(ht.localGlyph?bn:1)),lr=Es.h*ht.scale/(Zt*(ht.localGlyph?bn:1));let ks,xr,cr,Gs;if(Rs){const Ds=ht.y-Mt,ni=new Ee(-Xt,Xt-Ds),dr=-Math.PI/2,zr=new Ee(...Cs);ks=new Ee(-Xt+Is[0],Is[1]),ks._rotateAround(dr,ni)._add(zr),ks.x+=-Ds+Xt,ks.y-=(Kt.left-Gt)*ht.scale;const Cr=ht.imageName?Kt.advance*ht.scale:Rr*ht.scale,ai=String.fromCharCode(ht.glyph);pw(ai)?ks.x+=(1-Gt)*ht.scale:fw(ai)?ks.x+=Cr-Kt.height*ht.scale+(-Gt-1)*ht.scale:ks.x+=ht.imageName||Kt.width+2*Gt===Es.w&&Kt.height+2*Gt===Es.h?(Cr-lr)/2:(Cr-(Kt.height+2*Gt)*ht.scale)/2,xr=new Ee(ks.x,ks.y-Ws),cr=new Ee(ks.x+lr,ks.y),Gs=new Ee(ks.x+lr,ks.y-Ws)}else{const Ds=(Kt.left-Gt)*ht.scale-Xt+Is[0],ni=(-Kt.top-Gt)*ht.scale+Is[1],dr=Ds+Ws,zr=ni+lr;ks=new Ee(Ds,ni),xr=new Ee(dr,ni),cr=new Ee(Ds,zr),Gs=new Ee(dr,zr)}if(Ye){let Ds;Ds=Oe?new Ee(0,0):qs?new Ee(it[0],it[1]):new Ee(ge[0],ge[1]),ks._rotateAround(Ye,Ds),xr._rotateAround(Ye,Ds),cr._rotateAround(Ye,Ds),Gs._rotateAround(Ye,Ds)}const gs=new Ee(0,0),ur=new Ee(0,0);Je.push({tl:ks,tr:xr,bl:cr,br:Gs,tex:Rt,writingMode:xe.writingMode,glyphOffset:Ps,sectionIndex:ht.sectionIndex,isSDF:ps,pixelOffsetTL:gs,pixelOffsetBR:ur,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,a,b,h,p,y,l,s.allowVerticalPlacement),pe=s.textSizeData;let ne=null;pe.kind==="source"?(ne=[_n*h.layout.get("text-size").evaluate(y,{},X)],ne[0]>Fa&&As(`${s.layerIds[0]}: Value for "text-size" is >= ${Mu}. Reduce your "text-size".`)):pe.kind==="composite"&&(ne=[_n*R.compositeTextSizes[0].evaluate(y,{},X),_n*R.compositeTextSizes[1].evaluate(y,{},X)],(ne[0]>Fa||ne[1]>Fa)&&As(`${s.layerIds[0]}: Value for "text-size" is >= ${Mu}. Reduce your "text-size".`)),s.addSymbols(s.text,ie,ne,b,p,y,E,e,r,v.lineStartIndex,v.lineLength,L,B,X);for(const de of k)P[de]=s.text.placedSymbolArray.length-1;return 4*ie.length}function Hx(s){for(const e in s)return s[e];return null}function vh(s,e,r,a,l,h,p,y,b,v){let E=p.top,k=p.bottom,P=p.left,L=p.right;const R=p.collisionPadding;if(R&&(P-=R[0],E-=R[1],L+=R[2],k+=R[3]),b){const B=new Ee(P,E),X=new Ee(L,E),ie=new Ee(P,k),pe=new Ee(L,k),ne=Te(b);let de=new Ee(0,0);v&&(de=new Ee(v[0],v[1])),B._rotateAround(ne,de),X._rotateAround(ne,de),ie._rotateAround(ne,de),pe._rotateAround(ne,de),P=Math.min(B.x,X.x,ie.x,pe.x),L=Math.max(B.x,X.x,ie.x,pe.x),E=Math.min(B.y,X.y,ie.y,pe.y),k=Math.max(B.y,X.y,ie.y,pe.y)}return s.emplaceBack(e.x,e.y,e.z,r.x,r.y,P,E,L,k,y,a,l,h),s.length-1}function Ap(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function Uw(s,e,r,a){const l=s.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(a.dist(h[p])<r)return!0}else l[e]=[];return l[e].push(a),!1}function Xx(s,e){const r=s.fovAboveCenter,a=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,l=(s._camera.position[2]*s.worldSize-a)/Math.cos(s._pitch),h=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-s._pitch-r,.01)),p=Math.sin(s._pitch)*h+l;return Math.min(1.01*p,l*(1/s._horizonShift))}function Uo(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const r=Math.pow(2,-s.z),a=s.x*r,l=(s.x+1)*r,h=s.y*r,p=(s.y+1)*r,y=Ri(a),b=Ri(l),v=$r(h),E=$r(p),k=e.project(y,v),P=e.project(b,v),L=e.project(b,E),R=e.project(y,E);let B=Math.min(k.x,P.x,L.x,R.x),X=Math.min(k.y,P.y,L.y,R.y),ie=Math.max(k.x,P.x,L.x,R.x),pe=Math.max(k.y,P.y,L.y,R.y);const ne=r/16;function de(ge,Ue,Oe,He,ot,qe){const Je=(Oe+ot)/2,Ye=(He+qe)/2,it=e.project(Ri(Je),$r(Ye)),dt=Math.max(0,B-it.x,X-it.y,it.x-ie,it.y-pe);B=Math.min(B,it.x),ie=Math.max(ie,it.x),X=Math.min(X,it.y),pe=Math.max(pe,it.y),dt>ne&&(de(ge,it,Oe,He,Je,Ye),de(it,Ue,Je,Ye,ot,qe))}de(k,P,a,h,l,h),de(P,L,l,h,l,p),de(L,R,l,p,a,p),de(R,k,a,p,a,h),B-=ne,X-=ne,ie+=ne,pe+=ne;const xe=1/Math.max(ie-B,pe-X);return{scale:xe,x:B*xe,y:X*xe,x2:ie*xe,y2:pe*xe,projection:e}}const Vw=gn(new Float32Array(16));class Ba{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Ts(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return yn(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return Xx(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,l){const h=e.horizonLineFromTop(!1),p=new Ee(r,Math.max(h,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}pointCoordinate3D(e,r,a){const l=new Ee(r,a);if(e.elevation)return e.elevation.pointCoordinate(l);{const h=this.pointCoordinate(e,l.x,l.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return Vw}createTileMatrix(e,r,a){let l,h,p;const y=a.canonical,b=gn(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=Uo(y,this);l=1,h=v.x+a.wrap*v.scale,p=v.y,Do(b,b,[l/v.scale,l/v.scale,e.pixelsPerMeter/r])}else l=r/e.zoomScale(y.z),h=(y.x+Math.pow(2,y.z)*a.wrap)*l,p=y.y*l;return lu(b,b,[h,p,0]),Do(b,b,[l/zt,l/zt,1]),b}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class qw extends Ba{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Te(r));this.n=(l+Math.sin(Te(a)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:l,r0:h}=this,p=Te(e-this.center[0]),y=Te(r),b=Math.sqrt(l-2*a*Math.sin(y))/a;return{x:b*Math.sin(p*a),y:b*Math.cos(p*a)-h,z:0}}unproject(e,r){const{n:a,c:l,r0:h}=this,p=h+r;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const b=Te(this.center[0])*a;y=ns(y,-Math.PI-b,Math.PI-b);const v=wt(rt(y/a)+this.center[0],-180,180),E=Math.asin(wt((l-(e*e+p*p)*a*a)/(2*a),-1,1)),k=wt(rt(E),-Gr,Gr);return new Ts(v,k)}}const Pu=1.340264,Iu=-.081106,Du=893e-6,Lu=.003796,wh=Math.sqrt(3)/2;class $w extends Ba{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(wh*Math.sin(r)),l=a*a,h=l*l*l;return{x:.5*(e*Math.cos(a)/(wh*(Pu+3*Iu*l+h*(7*Du+9*Lu*l)))/Math.PI+.5),y:1-.5*(a*(Pu+Iu*l+h*(Du+Lu*l))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=a*a,h=l*l*l;for(let E,k,P,L=0;L<12&&(k=a*(Pu+Iu*l+h*(Du+Lu*l))-r,P=Pu+3*Iu*l+h*(7*Du+9*Lu*l),E=k/P,a=wt(a-E,-Math.PI/3,Math.PI/3),l=a*a,h=l*l*l,!(Math.abs(E)<1e-12));++L);const p=wh*e*(Pu+3*Iu*l+h*(7*Du+9*Lu*l))/Math.cos(a),y=Math.asin(Math.sin(a)/wh),b=wt(180*p/Math.PI,-180,180),v=wt(180*y/Math.PI,-Gr,Gr);return new Ts(b,v)}}class Gw extends Ba{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),l=wt(360*(.5-r),-Gr,Gr);return new Ts(a,l)}}const Xl=Math.PI/2;function jh(s){return Math.tan((Xl+s)/2)}class Zw extends Ba{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let l=Te(r),h=Te(a);this.southernCenter=l+h<0,this.southernCenter&&(l=-l,h=-h);const p=Math.cos(l),y=jh(l);this.n=l===h?Math.sin(l):Math.log(p/Math.cos(h))/Math.log(jh(h)/y),this.f=p*Math.pow(jh(l),this.n)/this.n}project(e,r){r=Te(r),this.southernCenter&&(r=-r),e=Te(e-this.center[0]);const a=1e-6,{n:l,f:h}=this;h>0?r<-Xl+a&&(r=-Xl+a):r>Xl-a&&(r=Xl-a);const p=h/Math.pow(jh(r),l);let y=p*Math.sin(l*e),b=h-p*Math.cos(l*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:l}=this,h=l-r,p=Math.sign(h),y=Math.sign(a)*Math.sqrt(e*e+h*h);let b=Math.atan2(e,Math.abs(h))*p;h*a<0&&(b-=Math.PI*Math.sign(e)*p);const v=wt(rt(b/a)+this.center[0],-180,180),E=wt(rt(2*Math.atan(Math.pow(l/y,1/a))-Xl),-Gr,Gr);return new Ts(v,this.southernCenter?-E:E)}}class Kx extends Ba{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Dn(e),y:Ln(r),z:0}}unproject(e,r){const a=Ri(e),l=$r(r);return new Ts(a,l)}}const Qx=Te(Gr);class Ww extends Ba{project(e,r){const a=(r=Te(r))*r,l=a*a;return{x:.5*((e=Te(e))*(.8707-.131979*a+l*(l*(.003971*a-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+l*(.028874*a-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=25,h=0,p=a*a;do{p=a*a;const v=p*p;h=(a*(1.007226+p*(.015085+v*(.028874*p-.044475-.005916*v)))-r)/(1.007226+p*(.045255+v*(.259866*p-.311325-.005916*11*v))),a=wt(a-h,-Qx,Qx)}while(Math.abs(h)>1e-6&&--l>0);p=a*a;const y=wt(rt(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=rt(a);return new Ts(y,b)}}const Jx=Te(Gr);class Hw extends Ba{project(e,r){r=Te(r),e=Te(e);const a=Math.cos(r),l=2/Math.PI,h=Math.acos(a*Math.cos(e/2)),p=Math.sin(h)/h,y=.5*(e*l+2*a*Math.sin(e/2)/p)||0,b=.5*(r+Math.sin(r)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,h=25;const p=1e-6;let y=0,b=0;do{const v=Math.cos(l),E=Math.sin(l),k=2*E*v,P=E*E,L=v*v,R=Math.cos(a/2),B=Math.sin(a/2),X=2*R*B,ie=B*B,pe=1-L*R*R,ne=pe?1/pe:0,de=pe?Math.acos(v*R)*Math.sqrt(1/pe):0,xe=.5*(2*de*v*B+2*a/Math.PI)-e,ge=.5*(de*E+l)-r,Ue=.5*ne*(L*ie+de*v*R*P)+1/Math.PI,Oe=ne*(X*k/4-de*E*B),He=.125*ne*(k*B-de*E*L*X),ot=.5*ne*(P*R+de*ie*v)+.5,qe=Oe*He-ot*Ue;y=(ge*Oe-xe*ot)/qe,b=(xe*He-ge*Ue)/qe,a=wt(a-y,-Math.PI,Math.PI),l=wt(l-b,-Jx,Jx)}while((Math.abs(y)>p||Math.abs(b)>p)&&--h>0);return new Ts(rt(a),rt(l))}}class Yx extends Ba{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Te(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:l}=this;return{x:Te(e)*l*a+.5,y:-Math.sin(Te(r))/l*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:l}=this,h=-(r-.5)/a,p=wt(rt((e-.5)/a)/l,-180,180),y=Math.asin(wt(h*l,-1,1)),b=wt(rt(y),-Gr,Gr);return new Ts(p,b)}}class Xw extends Kx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const l=gu(e,r,a);return Ys(l,l,xu(In(a))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,r){const a=Dl(r.lat,r.lng),l=si([],a),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;hu(a,a,l,yn(1,0)*zt*h);const p=gn(new Float64Array(16));return Io(p,e.pixelMatrix,e.globeMatrix),Ys(a,a,p),new Ee(a[0],a[1])}pixelsPerMeter(e,r){return yn(1,0)*r}pixelSpaceConversion(e,r,a){const l=yn(1,e)*r,h=ds(yn(1,45)*r,l,a);return this.pixelsPerMeter(e,r)/h}createTileMatrix(e,r,a){const l=ep(In(a.canonical));return Io(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,r){const{center:a}=e,l=xu(In(r));return Qd(l,l,Te(a.lng)),$m(l,l,Te(a.lat)),Do(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,r,a,l){return Tg(e,r,a,!0)||new Rl(0,0)}pointCoordinate3D(e,r,a){const l=this.pointCoordinate(e,r,a,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,r){return!Tg(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(l,h){const p=l.cameraToCenterDistance,y=l._centerAltitude*h,b=l._camera,v=l._camera.forward(),E=aa([],Li([],v,-p),[0,0,y]),k=l.worldSize/(2*Math.PI),P=[0,0,-k],L=l.width/l.height,R=Math.tan(l.fovAboveCenter),B=Li([],b.up(),R),X=Li([],b.right(),R*L),ie=si([],aa([],aa([],v,B),X)),pe=[];let ne;if(new Hm(E,ie).closestPointOnSphere(P,k,pe)){const de=aa([],pe,P),xe=xn([],de,E);ne=Math.cos(l.fovAboveCenter)*cu(xe)}else{const de=xn([],E,P),xe=xn([],P,E);si(xe,xe);const ge=cu(de)-k;ne=Math.sqrt(ge*(ge+2*k));const Ue=Math.acos(ne/(k+ge))-Math.acos(Zi(v,xe));ne*=Math.cos(Ue)}return 1.01*ne}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Ll(e.zoom);if(a>0){const l=Xx(e,yn(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ds(r,l+h*(1-Math.cos(p)),Math.pow(a,10))}return r}upVector(e,r,a){return gu(r,a,e,1)}upVectorScale(e){return{metersToTile:Jd(eh(In(e)))}}}function ey(s){const e=s.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new Kx(s);case"equirectangular":return new Gw(s);case"naturalEarth":return new Ww(s);case"equalEarth":return new $w(s);case"winkelTripel":return new Hw(s);case"albers":return r?new Yx(s):new qw(s);case"lambertConformalConic":return r?new Yx(s):new Zw(s);case"globe":return new Xw(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Kw=uh.types,Qw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nh(s,e,r,a,l,h,p,y,b,v,E,k,P){const L=y?Math.min(Fa,Math.round(y[0])):0,R=y?Math.min(Fa,Math.round(y[1])):0;s.emplaceBack(e,r,Math.round(32*a),Math.round(32*l),h,p,(L<<1)+(b?1:0),R,16*v,16*E,256*k,256*P)}function Sh(s,e,r,a,l,h,p){s.emplaceBack(e,r,a,l,h,p)}function Th(s,e,r,a,l){s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l)}function Jw(s){for(const e of s.sections)if(Fm(e.text))return!0;return!1}class Mp{constructor(e){this.layoutVertexArray=new st,this.indexArray=new Pt,this.programConfigurations=e,this.segments=new ar,this.dynamicLayoutVertexArray=new nt,this.opacityVertexArray=new Dt,this.placedSymbolArray=new nr,this.globeExtVertexArray=new ct}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,lw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Qw,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ow.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ct(Mp,"SymbolBuffers");class Pp{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new ar,this.collisionVertexArray=new is,this.collisionVertexArrayExt=new ts}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,cw.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,uw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ct(Pp,"CollisionBuffers");class Ua{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gn([]),this.placementViewportMatrix=gn([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bp(this.zoom,r["text-size"]),this.iconSizeData=bp(this.zoom,r["icon-size"]);const a=this.layers[0].layout,l=a.get("symbol-sort-key"),h=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>zi[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Mp(new Po(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Mp(new Po(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ti,this.lineVertexArray=new kl,this.symbolInstances=new zs}calculateGlyphDependencies(e,r,a,l,h){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,l&&h){const y=Cu[e.charAt(p)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,a,l){const h=this.layers[0],p=h.layout,y=this.projection.name==="globe",b=p.get("text-font"),v=p.get("text-field"),E=p.get("icon-image"),k=(v.value.kind!=="constant"||v.value.value instanceof ei&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),P=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!k&&!P)return;const R=r.iconDependencies,B=r.glyphDependencies,X=r.availableImages,ie=new C(this.zoom);for(const{feature:pe,id:ne,index:de,sourceLayerIndex:xe}of e){const ge=h._featureFilter.needGeometry,Ue=Oo(pe,ge);if(!h._featureFilter.filter(ie,Ue,a))continue;if(ge||(Ue.geometry=oa(pe,a,l)),y&&pe.type!==1&&a.z<=5){const qe=Ue.geometry,Je=.98078528056,Ye=(it,dt)=>Zi(gu(it.x,it.y,a,1),gu(dt.x,dt.y,a,1))<Je;for(let it=0;it<qe.length;it++)qe[it]=lv(qe[it],Ye)}let Oe,He;if(k){const qe=h.getValueAndResolveTokens("text-field",Ue,a,X),Je=ei.factory(qe);Jw(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||_()==="unavailable"||this.hasRTLText&&S.isParsed())&&(Oe=mw(Je,h,Ue))}if(P){const qe=h.getValueAndResolveTokens("icon-image",Ue,a,X);He=qe instanceof bi?qe:bi.fromString(qe)}if(!Oe&&!He)continue;const ot=this.sortFeaturesByKey?L.evaluate(Ue,{},a):void 0;if(this.features.push({id:ne,text:Oe,icon:He,index:de,sourceLayerIndex:xe,geometry:Ue.geometry,properties:pe.properties,type:Kw[pe.type],sortKey:ot}),He&&(R[He.name]=!0),Oe){const qe=b.evaluate(Ue,{},a).join(","),Je=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zi.vertical)>=0;for(const Ye of Oe.sections)if(Ye.image)R[Ye.image.name]=!0;else{const it=tu(Oe.toString()),dt=Ye.fontStack||qe,Ze=B[dt]=B[dt]||{};this.calculateGlyphDependencies(Ye.text,Ze,Je,this.allowVerticalPlacement,it)}}}p.get("symbol-placement")==="line"&&(this.features=function(pe){const ne={},de={},xe=[];let ge=0;function Ue(qe){xe.push(pe[qe]),ge++}function Oe(qe,Je,Ye){const it=de[qe];return delete de[qe],de[Je]=it,xe[it].geometry[0].pop(),xe[it].geometry[0]=xe[it].geometry[0].concat(Ye[0]),it}function He(qe,Je,Ye){const it=ne[Je];return delete ne[Je],ne[qe]=it,xe[it].geometry[0].shift(),xe[it].geometry[0]=Ye[0].concat(xe[it].geometry[0]),it}function ot(qe,Je,Ye){const it=Ye?Je[0][Je[0].length-1]:Je[0][0];return`${qe}:${it.x}:${it.y}`}for(let qe=0;qe<pe.length;qe++){const Je=pe[qe],Ye=Je.geometry,it=Je.text?Je.text.toString():null;if(!it){Ue(qe);continue}const dt=ot(it,Ye),Ze=ot(it,Ye,!0);if(dt in de&&Ze in ne&&de[dt]!==ne[Ze]){const vt=He(dt,Ze,Ye),Mt=Oe(dt,Ze,xe[vt].geometry);delete ne[dt],delete de[Ze],de[ot(it,xe[Mt].geometry,!0)]=Mt,xe[vt].geometry=null}else dt in de?Oe(dt,Ze,Ye):Ze in ne?He(dt,Ze,Ye):(Ue(qe),ne[dt]=ge-1,de[Ze]=ge-1)}return xe.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,ne)=>pe.sortKey-ne.sortKey)}update(e,r,a,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ey(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:h}of r)this.lineVertexArray.emplaceBack(l,h);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,l,h,p,y,b,v,E,k,P,L,R){const B=e.indexArray,X=e.layoutVertexArray,ie=e.globeExtVertexArray,pe=e.segments.prepareSegment(4*r.length,X,B,this.canOverlap?p.sortKey:void 0),ne=this.glyphOffsetArray.length,de=pe.vertexLength,xe=this.allowVerticalPlacement&&y===zi.vertical?Math.PI/2:0,ge=p.text&&p.text.sections;for(let Oe=0;Oe<r.length;Oe++){const{tl:He,tr:ot,bl:qe,br:Je,tex:Ye,pixelOffsetTL:it,pixelOffsetBR:dt,minFontScaleX:Ze,minFontScaleY:vt,glyphOffset:Mt,isSDF:jt,sectionIndex:$t}=r[Oe],ht=pe.vertexLength,Rt=Mt[1];if(Nh(X,v.x,v.y,He.x,Rt+He.y,Ye.x,Ye.y,a,jt,it.x,it.y,Ze,vt),Nh(X,v.x,v.y,ot.x,Rt+ot.y,Ye.x+Ye.w,Ye.y,a,jt,dt.x,it.y,Ze,vt),Nh(X,v.x,v.y,qe.x,Rt+qe.y,Ye.x,Ye.y+Ye.h,a,jt,it.x,dt.y,Ze,vt),Nh(X,v.x,v.y,Je.x,Rt+Je.y,Ye.x+Ye.w,Ye.y+Ye.h,a,jt,dt.x,dt.y,Ze,vt),b){const{x:Gt,y:ps,z:Zt}=b.anchor,[Ft,Rs,Xt]=b.up;Sh(ie,Gt,ps,Zt,Ft,Rs,Xt),Sh(ie,Gt,ps,Zt,Ft,Rs,Xt),Sh(ie,Gt,ps,Zt,Ft,Rs,Xt),Sh(ie,Gt,ps,Zt,Ft,Rs,Xt),Th(e.dynamicLayoutVertexArray,Gt,ps,Zt,xe)}else Th(e.dynamicLayoutVertexArray,v.x,v.y,v.z,xe);B.emplaceBack(ht,ht+1,ht+2),B.emplaceBack(ht+1,ht+2,ht+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mt[0]),Oe!==r.length-1&&$t===r[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,p,p.index,{},L,R,ge&&ge[$t])}const Ue=b?b.anchor:v;e.placedSymbolArray.emplaceBack(Ue.x,Ue.y,Ue.z,v.x,v.y,ne,this.glyphOffsetArray.length-ne,de,E,k,v.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],y,0,!1,0,P,0)}_commitLayoutVertex(e,r,a,l,h,p,y){e.emplaceBack(r,a,l,h,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,a,l,h,p,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),v=b.vertexLength,E=y.tileAnchorX,k=y.tileAnchorY;for(let L=0;L<4;L++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,E,k,new Ee(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,E,k,new Ee(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,E,k,new Ee(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,E,k,new Ee(e.x1,e.y2)),b.vertexLength+=4;const P=a.indexArray;P.emplaceBack(v,v+1),P.emplaceBack(v+1,v+2),P.emplaceBack(v+2,v+3),P.emplaceBack(v+3,v),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),v=this.getSymbolInstanceTextSize(e,p,r,y);this._addCollisionDebugVertices(b,v,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),v=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,v,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pp(At,_x.members,Er),this.iconCollisionBox=new Pp(At,_x.members,Er);const a=Ul(this.iconSizeData,e),l=Ul(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,r,a,l){const h=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),p=ph(this.textSizeData,e,h)/Rr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,a){const l=this.icon.placedSymbolArray.get(a),h=ph(this.iconSizeData,e,l);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,r,a){e.emplaceBack(r,-a,-a),e.emplaceBack(r,a,-a),e.emplaceBack(r,a,a),e.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),v=this.getSymbolInstanceTextSize(e,p,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,b.padding)}}_updateIconDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),v=this.getSymbolInstanceIconSize(e,r,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,b.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Ul(this.iconSizeData,e),l=Ul(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,l,h,p,y,b,v){const E={};if(r<a){const{x1:k,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:pe,tileAnchorX:ne,tileAnchorY:de,featureIndex:xe}=e.get(r);E.textBox={x1:k,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:pe,tileAnchorX:ne,tileAnchorY:de},E.textFeatureIndex=xe}if(l<h){const{x1:k,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:pe,tileAnchorX:ne,tileAnchorY:de,featureIndex:xe}=e.get(l);E.verticalTextBox={x1:k,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:pe,tileAnchorX:ne,tileAnchorY:de},E.verticalTextFeatureIndex=xe}if(p<y){const{x1:k,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:pe,tileAnchorX:ne,tileAnchorY:de,featureIndex:xe}=e.get(p);E.iconBox={x1:k,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:pe,tileAnchorX:ne,tileAnchorY:de},E.iconFeatureIndex=xe}if(b<v){const{x1:k,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:pe,tileAnchorX:ne,tileAnchorY:de,featureIndex:xe}=e.get(b);E.verticalIconBox={x1:k,y1:P,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:pe,tileAnchorX:ne,tileAnchorY:de},E.verticalIconFeatureIndex=xe}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let h=a.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),l=[],h=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const b=this.symbolInstances.get(y);l.push(0|Math.round(r*b.tileAnchorX+a*b.tileAnchorY)),h.push(b.featureIndex)}return p.sort((y,b)=>l[y]-l[b]||h[b]-h[y]),p}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:v}=a;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&p!==l&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ct(Ua,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ua.MAX_GLYPHS=65535,Ua.addDynamicAttributes=Th;const Yw=new oe({"symbol-placement":new F(We.layout_symbol["symbol-placement"]),"symbol-spacing":new F(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new F(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Q(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new F(We.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new F(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new F(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new F(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new F(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new Q(We.layout_symbol["icon-size"]),"icon-text-fit":new F(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new F(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new Q(We.layout_symbol["icon-image"]),"icon-rotate":new Q(We.layout_symbol["icon-rotate"]),"icon-padding":new F(We.layout_symbol["icon-padding"]),"icon-keep-upright":new F(We.layout_symbol["icon-keep-upright"]),"icon-offset":new Q(We.layout_symbol["icon-offset"]),"icon-anchor":new Q(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new F(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new F(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new F(We.layout_symbol["text-rotation-alignment"]),"text-field":new Q(We.layout_symbol["text-field"]),"text-font":new Q(We.layout_symbol["text-font"]),"text-size":new Q(We.layout_symbol["text-size"]),"text-max-width":new Q(We.layout_symbol["text-max-width"]),"text-line-height":new Q(We.layout_symbol["text-line-height"]),"text-letter-spacing":new Q(We.layout_symbol["text-letter-spacing"]),"text-justify":new Q(We.layout_symbol["text-justify"]),"text-radial-offset":new Q(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new F(We.layout_symbol["text-variable-anchor"]),"text-anchor":new Q(We.layout_symbol["text-anchor"]),"text-max-angle":new F(We.layout_symbol["text-max-angle"]),"text-writing-mode":new F(We.layout_symbol["text-writing-mode"]),"text-rotate":new Q(We.layout_symbol["text-rotate"]),"text-padding":new F(We.layout_symbol["text-padding"]),"text-keep-upright":new F(We.layout_symbol["text-keep-upright"]),"text-transform":new Q(We.layout_symbol["text-transform"]),"text-offset":new Q(We.layout_symbol["text-offset"]),"text-allow-overlap":new F(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new F(We.layout_symbol["text-ignore-placement"]),"text-optional":new F(We.layout_symbol["text-optional"])});var Ip={paint:new oe({"icon-opacity":new Q(We.paint_symbol["icon-opacity"]),"icon-color":new Q(We.paint_symbol["icon-color"]),"icon-halo-color":new Q(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new Q(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Q(We.paint_symbol["icon-halo-blur"]),"icon-translate":new F(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new F(We.paint_symbol["icon-translate-anchor"]),"text-opacity":new Q(We.paint_symbol["text-opacity"]),"text-color":new Q(We.paint_symbol["text-color"],{runtimeType:ui,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Q(We.paint_symbol["text-halo-color"]),"text-halo-width":new Q(We.paint_symbol["text-halo-width"]),"text-halo-blur":new Q(We.paint_symbol["text-halo-blur"]),"text-translate":new F(We.paint_symbol["text-translate"]),"text-translate-anchor":new F(We.paint_symbol["text-translate-anchor"])}),layout:Yw};class ty{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct(ty,"FormatSectionOverride",{omit:["defaultValue"]});class Eh extends fn{constructor(e){super(e,Ip)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const l=[];for(const h of a)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,l){const h=this.layout.get(e).evaluate(r,{},a,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ka(p.value)||!h?h:function(y,b){return b.replace(/{([^{}]+)}/g,(v,E)=>E in y?String(y[E]):"")}(r.properties,h)}createBucket(e){return new Ua(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ip.paint.overridableProperties){if(!Eh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new ty(r),l=new vl(a,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new $c("source",l):new jo("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Y(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Eh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),l=Ip.paint.properties[r];let h=!1;const p=y=>{for(const b of y)if(l.overrides&&l.overrides.hasOverride(b))return void(h=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ei)p(a.value.value.sections);else if(a.value.kind==="source"){const y=v=>{h||(v instanceof Xn&&Zs(v.value)===no?p(v.value.sections):v instanceof kn?p(v.sections):v.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return h}getProgramConfiguration(e){return new Ra(this,e)}}var e1={paint:new oe({"background-color":new F(We.paint_background["background-color"]),"background-pattern":new F(We.paint_background["background-pattern"]),"background-opacity":new F(We.paint_background["background-opacity"])})},t1={paint:new oe({"raster-opacity":new F(We.paint_raster["raster-opacity"]),"raster-hue-rotate":new F(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new F(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new F(We.paint_raster["raster-brightness-max"]),"raster-saturation":new F(We.paint_raster["raster-saturation"]),"raster-contrast":new F(We.paint_raster["raster-contrast"]),"raster-resampling":new F(We.paint_raster["raster-resampling"]),"raster-fade-duration":new F(We.paint_raster["raster-fade-duration"])})};class s1 extends fn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var r1={paint:new oe({"sky-type":new F(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new F(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new F(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new F(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new F(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new ae(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new F(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new F(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new F(We.paint_sky["sky-opacity"])})};function Dp(s,e,r){const a=[0,0,1],l=bg([]);return wg(l,l,r?-Te(s)+Math.PI:Te(s)),vg(l,l,-Te(e)),gg(a,a,l),si(a,a)}const i1={circle:class extends fn{constructor(s){super(s,fv)}createBucket(s){return new ap(s)}queryRadius(s){const e=s;return zl("circle-radius",this,e)+zl("circle-stroke-width",this,e)+rh(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,r,a,l,h,p,y){const b=$g(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Gg(s,a,h,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,v)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Ra(this,s)}},heatmap:class extends fn{createBucket(s){return new Wg(s)}constructor(s){super(s,_v),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=up({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return zl("heatmap-radius",this,s)}queryIntersectsFeature(s,e,r,a,l,h,p,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return Gg(s,a,h,p,y,!0,!0,new Ee(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Ra(this,s)}},hillshade:class extends fn{constructor(s){super(s,bv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends fn{constructor(s){super(s,Rv)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(s){return new Ra(this,s)}recalculate(s,e){super.recalculate(s,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new lh(s)}queryRadius(){return rh(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,r,a,l,h){return!s.queryGeometry.isAboveHorizon&&Fg(qg(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends fn{constructor(s){super(s,Jv)}createBucket(s){return new Su(s)}queryRadius(){return rh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Ra(this,s)}queryIntersectsFeature(s,e,r,a,l,h,p,y,b){const v=$g(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,r),k=this.paint.get("fill-extrusion-base").evaluate(e,r),P=[0,0],L=y&&h.elevation,R=h.elevation?h.elevation.exaggeration():1,B=s.tile.getBucket(this);if(L&&B instanceof Su){const de=B.centroidVertexArray,xe=b+1;xe<de.length&&(P[0]=de.geta_centroid_pos0(xe),P[1]=de.geta_centroid_pos1(xe))}if(P[0]===0&&P[1]===1)return!1;h.projection.name==="globe"&&(a=dx([a],[new Ee(0,0),new Ee(zt,zt)],s.tileID.canonical).map(de=>de.polygon).flat());const X=L?y:null,[ie,pe]=function(de,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,it){return de.projection.name==="globe"?function(dt,Ze,vt,Mt,jt,$t,ht,Rt,Gt,ps,Zt){const Ft=[],Rs=[],Xt=dt.projection.upVectorScale(Zt,dt.center.lat,dt.worldSize).metersToTile,Kt=[0,0,0,1],Es=[0,0,0,1],Ps=(Cs,qs,Ws,lr)=>{Cs[0]=qs,Cs[1]=Ws,Cs[2]=lr,Cs[3]=1},Is=ux();vt>0&&(vt+=Is),Mt+=Is;for(const Cs of Ze){const qs=[],Ws=[];for(const lr of Cs){const ks=lr.x+jt.x,xr=lr.y+jt.y,cr=dt.projection.projectTilePoint(ks,xr,Zt),Gs=dt.projection.upVector(Zt,lr.x,lr.y);let gs=vt,ur=Mt;if(ht){const Ds=fx(ks,xr,vt,Mt,ht,Rt,Gt,ps);gs+=Ds.base,ur+=Ds.top}vt!==0?Ps(Kt,cr.x+Gs[0]*Xt*gs,cr.y+Gs[1]*Xt*gs,cr.z+Gs[2]*Xt*gs):Ps(Kt,cr.x,cr.y,cr.z),Ps(Es,cr.x+Gs[0]*Xt*ur,cr.y+Gs[1]*Xt*ur,cr.z+Gs[2]*Xt*ur),Ys(Kt,Kt,$t),Ys(Es,Es,$t),qs.push(new Bl(Kt[0],Kt[1],Kt[2])),Ws.push(new Bl(Es[0],Es[1],Es[2]))}Ft.push(qs),Rs.push(Ws)}return[Ft,Rs]}(de,xe,ge,Ue,Oe,He,ot,qe,Je,Ye,it):ot?function(dt,Ze,vt,Mt,jt,$t,ht,Rt,Gt){const ps=[],Zt=[],Ft=[0,0,0,1];for(const Rs of dt){const Xt=[],Kt=[];for(const Es of Rs){const Ps=Es.x+Mt.x,Is=Es.y+Mt.y,Cs=fx(Ps,Is,Ze,vt,$t,ht,Rt,Gt);Ft[0]=Ps,Ft[1]=Is,Ft[2]=Cs.base,Ft[3]=1,Lo(Ft,Ft,jt),Ft[3]=Math.max(Ft[3],1e-5);const qs=new Bl(Ft[0]/Ft[3],Ft[1]/Ft[3],Ft[2]/Ft[3]);Ft[0]=Ps,Ft[1]=Is,Ft[2]=Cs.top,Ft[3]=1,Lo(Ft,Ft,jt),Ft[3]=Math.max(Ft[3],1e-5);const Ws=new Bl(Ft[0]/Ft[3],Ft[1]/Ft[3],Ft[2]/Ft[3]);Xt.push(qs),Kt.push(Ws)}ps.push(Xt),Zt.push(Kt)}return[ps,Zt]}(xe,ge,Ue,Oe,He,ot,qe,Je,Ye):function(dt,Ze,vt,Mt,jt){const $t=[],ht=[],Rt=jt[8]*Ze,Gt=jt[9]*Ze,ps=jt[10]*Ze,Zt=jt[11]*Ze,Ft=jt[8]*vt,Rs=jt[9]*vt,Xt=jt[10]*vt,Kt=jt[11]*vt;for(const Es of dt){const Ps=[],Is=[];for(const Cs of Es){const qs=Cs.x+Mt.x,Ws=Cs.y+Mt.y,lr=jt[0]*qs+jt[4]*Ws+jt[12],ks=jt[1]*qs+jt[5]*Ws+jt[13],xr=jt[2]*qs+jt[6]*Ws+jt[14],cr=jt[3]*qs+jt[7]*Ws+jt[15],Gs=lr+Rt,gs=ks+Gt,ur=xr+ps,Ds=Math.max(cr+Zt,1e-5),ni=lr+Ft,dr=ks+Rs,zr=xr+Xt,Cr=Math.max(cr+Kt,1e-5);Ps.push(new Bl(Gs/Ds,gs/Ds,ur/Ds)),Is.push(new Bl(ni/Cr,dr/Cr,zr/Cr))}$t.push(Ps),ht.push(Is)}return[$t,ht]}(xe,ge,Ue,Oe,He)}(h,a,k,E,v,p,X,P,R,h.center.lat,s.tileID.canonical),ne=s.queryGeometry;return function(de,xe,ge){let Ue=1/0;Fg(ge,xe)&&(Ue=px(ge,xe[0]));for(let Oe=0;Oe<xe.length;Oe++){const He=xe[Oe],ot=de[Oe];for(let qe=0;qe<He.length-1;qe++){const Je=He[qe],Ye=[Je,He[qe+1],ot[qe+1],ot[qe],Je];Og(ge,Ye)&&(Ue=Math.min(Ue,px(ge,Ye)))}}return Ue!==1/0&&Ue}(ie,pe,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends fn{constructor(s){super(s,gx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Mc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=xx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new mh(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Ra(this,s)}queryRadius(s){const e=s,r=yx(zl("line-width",this,e),zl("line-gap-width",this,e)),a=zl("line-offset",this,e);return r/2+Math.abs(a)+rh(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,r,a,l,h){if(s.queryGeometry.isAboveHorizon)return!1;const p=qg(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),y=s.pixelToTileUnitsFactor/2*yx(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(a=function(v,E){const k=[],P=new Ee(0,0);for(let L=0;L<v.length;L++){const R=v[L],B=[];for(let X=0;X<R.length;X++){const ie=R[X],pe=R[X+1],ne=X===0?P:ie.sub(R[X-1])._unit()._perp(),de=X===R.length-1?P:pe.sub(ie)._unit()._perp(),xe=ne._add(de)._unit();xe._mult(1/(xe.x*de.x+xe.y*de.y)),B.push(xe._mult(E)._add(ie))}k.push(B)}return k}(a,b*s.pixelToTileUnitsFactor)),function(v,E,k){for(let P=0;P<E.length;P++){const L=E[P];if(v.length>=3){for(let R=0;R<L.length;R++)if(Fo(v,L[R]))return!0}if(dv(v,L,k))return!0}return!1}(p,a,y)}isTileClipped(){return!0}},symbol:Eh,background:class extends fn{constructor(s){super(s,e1)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends fn{constructor(s){super(s,t1)}getProgramIds(){return["raster"]}},sky:class extends fn{constructor(s){super(s,r1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=up({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),l=!a,h=s.style.light,p=h.properties.get("position");return l&&h.properties.get("anchor")==="viewport"&&As("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Dp(p.azimuthal,90-p.polar,e):Dp(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Dp(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class Ru{constructor(e,r,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,a){const{width:l,height:h}=e,{context:p}=this,{gl:y}=p,{HTMLImageElement:b,HTMLCanvasElement:v,HTMLVideoElement:E,ImageData:k,ImageBitmap:P}=M;if(y.bindTexture(y.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===l&&this.size[1]===h){const{x:L,y:R}=a||{x:0,y:0};e instanceof b||e instanceof v||e instanceof E||e instanceof k||P&&e instanceof P?y.texSubImage2D(y.TEXTURE_2D,0,L,R,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,L,R,l,h,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[l,h],e instanceof b||e instanceof v||e instanceof E||e instanceof k||P&&e instanceof P?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,l,h,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class n1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class a1{constructor(){this.tasks={},this.taskQueue=[],_r(["process"],this),this.invoker=new n1(this.process),this.nextId=0}add(e,r){const a=this.nextId++,l=function({type:h,isSymbolTile:p,zoom:y}){return y=y||0,h==="message"?0:h!=="maybePrepare"||p?h!=="parseTile"||p?h==="parseTile"&&p?300-y:h==="maybePrepare"&&p?400-y:500:200-y:100-y}(r);if(l===0){Zr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:r,priority:l,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Zr();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const h=this.tasks[this.taskQueue[l]];h.priority<r&&(r=h.priority,e=l)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class sy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const o1=["tile","layer","source","sourceLayer","state"];class ry{constructor(e,r,a,l,h){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of o1)this[r]!==void 0&&(e[r]=this[r]);return e}}const Xi=32,Rn=33,Va=new Uint16Array(8184);for(let s=0;s<2046;s++){let e=s+2,r=0,a=0,l=0,h=0,p=0,y=0;for(1&e?l=h=p=Xi:r=a=y=Xi;(e>>=1)>1;){const v=r+l>>1,E=a+h>>1;1&e?(l=r,h=a,r=p,a=y):(r=l,a=h,l=p,h=y),p=v,y=E}const b=4*s;Va[b+0]=r,Va[b+1]=a,Va[b+2]=l,Va[b+3]=h}const zn=new Uint16Array(2178),qa=new Uint8Array(1089),Ch=new Uint16Array(1089);function iy(s){return s===0?-.03125:s===32?.03125:0}var ny=ke([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ay={type:2,extent:zt,loadGeometry:()=>[[new Ee(0,0),new Ee(zt+1,0),new Ee(zt+1,zt+1),new Ee(0,zt+1),new Ee(0,0)]]};class Lp{constructor(e,r,a,l,h){this.tileID=e,this.uid=Fr(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<sn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Uo(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const p={};if(!h)return p;for(const y of l){const b=y.layerIds.map(v=>h.getLayer(v)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(v=>b.filter(E=>E.id===v)[0]));for(const v of b)p[v.id]=y}}return p}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Ua){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Ua&&h.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||_()!=="deferred"||j();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ss}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ru(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ru(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ru(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,l,h,p,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:y,transform:p,params:h,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),h=r?r.sourceLayer:"",p=l._geojsonTileLayer||l[h];if(!p)return;const y=Sl(r&&r.filter),{z:b,x:v,y:E}=this.tileID.canonical,k={z:b,x:v,y:E};for(let P=0;P<p.length;P++){const L=p.feature(P);if(y.needGeometry){const X=Oo(L,!0);if(!y.filter(new C(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!y.filter(new C(this.tileID.overscaledZ),L))continue;const R=a.getId(L,h),B=new ry(L,b,v,E,R);B.tile=k,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=we(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const h=this.expirationTime-r;h?this.expirationTime=a+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const a=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const p=this.buckets[h],y=p.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],v=e[y];if(!b||!v||Object.keys(v).length===0)continue;if(p.update(v,b,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof mh||p instanceof lh){const k=r.style._getSourceCache(p.layers[0].source);r._terrain&&r._terrain.enabled&&k&&p.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(k.id,this.tileID)}const E=r&&r.style&&r.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<sn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=sn.now()+e}setTexture(e,r){const a=r.context,l=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ru(a,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,r){const a={};for(const l of r)a[l]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const l=this.dependencies[a];if(l){for(const h of r)if(l[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const a=oa(ay,this.tileID.canonical,this.tileTransform)[0],l=new at,h=new ji;for(let p=0;p<a.length;p++){const{x:y,y:b}=a[p];l.emplaceBack(y,b),h.emplaceBack(p)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(l,pu.members),this._tileDebugSegments=ar.simpleSegment(0,0,l.length,h.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const a=oa(ay,this.tileID.canonical,this.tileTransform)[0];let l,h;if(this.isRaster){const p=function(y,b){const v=Uo(y,b),E=Math.pow(2,y.z);for(let X=0;X<Rn;X++)for(let ie=0;ie<Rn;ie++){const pe=Ri((y.x+(ie+iy(ie))/Xi)/E),ne=$r((y.y+(X+iy(X))/Xi)/E),de=b.project(pe,ne),xe=X*Rn+ie;zn[2*xe+0]=Math.round((de.x*v.scale-v.x)*zt),zn[2*xe+1]=Math.round((de.y*v.scale-v.y)*zt)}qa.fill(0),Ch.fill(0);for(let X=2045;X>=0;X--){const ie=4*X,pe=Va[ie+0],ne=Va[ie+1],de=Va[ie+2],xe=Va[ie+3],ge=pe+de>>1,Ue=ne+xe>>1,Oe=ge+Ue-ne,He=Ue+pe-ge,ot=ne*Rn+pe,qe=xe*Rn+de,Je=Ue*Rn+ge,Ye=Math.hypot((zn[2*ot+0]+zn[2*qe+0])/2-zn[2*Je+0],(zn[2*ot+1]+zn[2*qe+1])/2-zn[2*Je+1])>=16;qa[Je]=qa[Je]||(Ye?1:0),X<1022&&(qa[Je]=qa[Je]||qa[(ne+He>>1)*Rn+(pe+Oe>>1)]||qa[(xe+He>>1)*Rn+(de+Oe>>1)])}const k=new Qe,P=new Pt;let L=0;function R(X,ie){const pe=ie*Rn+X;return Ch[pe]===0&&(k.emplaceBack(zn[2*pe+0],zn[2*pe+1],X*zt/Xi,ie*zt/Xi),Ch[pe]=++L),Ch[pe]-1}function B(X,ie,pe,ne,de,xe){const ge=X+pe>>1,Ue=ie+ne>>1;if(Math.abs(X-de)+Math.abs(ie-xe)>1&&qa[Ue*Rn+ge])B(de,xe,X,ie,ge,Ue),B(pe,ne,de,xe,ge,Ue);else{const Oe=R(X,ie),He=R(pe,ne),ot=R(de,xe);P.emplaceBack(Oe,He,ot)}}return B(0,0,Xi,Xi,Xi,0),B(Xi,Xi,0,0,0,Xi),{vertices:k,indices:P}}(this.tileID.canonical,r);l=p.vertices,h=p.indices}else{l=new Qe,h=new Pt;for(const{x:y,y:b}of a)l.emplaceBack(y,b,0,0);const p=fp(l.int16,void 0,4);for(let y=0;y<p.length;y+=3)h.emplaceBack(p[y],p[y+1],p[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,ny.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=ar.simpleSegment(0,0,l.length,h.length)}_makeGlobeTileDebugBuffers(e,r){const a=r.projection;if(!a||a.name!=="globe"||r.freezeTileCoverage)return;const l=this.tileID.canonical,h=xu(Eg(l,r)),p=Ll(r.zoom);let y;p>0&&(y=qm(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,r,h,y,p),this._makeGlobeTileDebugTextBuffer(e,l,r,h,y,p)}_globePoint(e,r,a,l,h,p,y){let b=gu(e,r,a);if(p){const v=1<<a.z,E=Dn(l.center.lng),k=Ln(l.center.lat),P=(a.x+.5)/v-E;let L=0;P>.5?L=-1:P<-.5&&(L=1);let R=(e/zt+a.x)/v+L,B=(r/zt+a.y)/v;R=(R-E)*l._pixelsPerMercatorPixel+E,B=(B-k)*l._pixelsPerMercatorPixel+k;const X=[R*l.worldSize,B*l.worldSize,0];Ys(X,X,p),b=zo(b,X,y)}return Ys(b,b,h)}_makeGlobeTileDebugBorderBuffer(e,r,a,l,h,p){const y=new at,b=new ji,v=new ze,E=(P,L,R,B,X)=>{const ie=(R-P)/(X-1),pe=(B-L)/(X-1),ne=y.length;for(let de=0;de<X;de++){const xe=P+de*ie,ge=L+de*pe;y.emplaceBack(xe,ge);const Ue=this._globePoint(xe,ge,r,a,l,h,p);v.emplaceBack(Ue[0],Ue[1],Ue[2]),b.emplaceBack(ne+de)}},k=zt;E(0,0,k,0,16),E(k,0,k,k,16),E(k,k,0,k,16),E(0,k,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,pu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(v,Ng.members),this._tileDebugSegments=ar.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,r,a,l,h,p){const y=zt/4,b=new at,v=new Pt,E=new ze,k=25;v.reserve(32),b.reserve(k),E.reserve(k);const P=(L,R)=>k*L+R;for(let L=0;L<k;L++){const R=L*y;for(let B=0;B<k;B++){const X=B*y;b.emplaceBack(X,R);const ie=this._globePoint(X,R,r,a,l,h,p);E.emplaceBack(ie[0],ie[1],ie[2])}}for(let L=0;L<4;L++)for(let R=0;R<4;R++){const B=P(L,R),X=P(L,R+1),ie=P(L+1,R),pe=P(L+1,R+1);v.emplaceBack(B,X,ie),v.emplaceBack(ie,X,pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(v),this._tileDebugTextBuffer=e.createVertexBuffer(b,pu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,Ng.members),this._tileDebugTextSegments=ar.simpleSegment(0,0,k,32)}}class l1{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Ut(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])a[h]||(this.deletedStates[e][l][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),l=Ut({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][r];if(h===null)return{};for(const p in h)delete l[p]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const p in this.stateChanges[l])this.state[l][p]||(this.state[l][p]={}),Ut(this.state[l][p],this.stateChanges[l][p]),h[p]=this.state[l][p];a[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const p in this.state[l])h[p]={},this.state[l][p]={};else for(const p in this.deletedStates[l]){if(this.deletedStates[l][p]===null)this.state[l][p]={};else if(this.state[l][p])for(const y of Object.keys(this.deletedStates[l][p]))delete this.state[l][p][y];h[p]=this.state[l][p]}a[l]=a[l]||{},Ut(a[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,r)}}class oy{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function ly(s,e,r,a){let l=0,h=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(r[p]<s[p]||r[p]>e[p])return null}else{const y=1/a[p];let b=(s[p]-r[p])*y,v=(e[p]-r[p])*y;if(b>v){const E=b;b=v,v=E}if(b>l&&(l=b),v<h&&(h=v),l>h)return null}return l}function cy(s,e,r,a,l,h,p,y,b,v,E){const k=a-s,P=l-e,L=h-r,R=p-s,B=y-e,X=b-r,ie=E[1]*X-E[2]*B,pe=E[2]*R-E[0]*X,ne=E[0]*B-E[1]*R,de=k*ie+P*pe+L*ne;if(Math.abs(de)<1e-15)return null;const xe=1/de,ge=v[0]-s,Ue=v[1]-e,Oe=v[2]-r,He=(ge*ie+Ue*pe+Oe*ne)*xe;if(He<0||He>1)return null;const ot=Ue*L-Oe*P,qe=Oe*k-ge*L,Je=ge*P-Ue*k,Ye=(E[0]*ot+E[1]*qe+E[2]*Je)*xe;return Ye<0||He+Ye>1?null:(R*ot+B*qe+X*Je)*xe}function uy(s,e,r){return(s-e)/(r-e)}function dy(s,e,r,a,l,h,p,y,b){const v=1<<r,E=h-a,k=p-l,P=(s+1)/v*E+a,L=(e+0)/v*k+l,R=(e+1)/v*k+l;y[0]=(s+0)/v*E+a,y[1]=L,b[0]=P,b[1]=R}class hy{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(h){const p=Math.ceil(Math.log2(h.dim/8)),y=[];let b=Math.ceil(Math.pow(2,p));const v=1/b,E=(L,R,B,X,ie)=>{const pe=X?1:0,ne=(L+1)*B-pe,de=R*B,xe=(R+1)*B-pe;ie[0]=L*B,ie[1]=de,ie[2]=ne,ie[3]=xe};let k=new oy(b);const P=[];for(let L=0;L<b*b;L++){E(L%b,Math.floor(L/b),v,!1,P);const R=$a(P[0],P[1],h),B=$a(P[2],P[1],h),X=$a(P[2],P[3],h),ie=$a(P[0],P[3],h);k.minimums.push(Math.min(R,B,X,ie)),k.maximums.push(Math.max(R,B,X,ie)),k.leaves.push(1)}for(y.push(k),b/=2;b>=1;b/=2){const L=y[y.length-1];k=new oy(b);for(let R=0;R<b*b;R++){E(R%b,Math.floor(R/b),2,!0,P);const B=L.getElevation(P[0],P[1]),X=L.getElevation(P[2],P[1]),ie=L.getElevation(P[2],P[3]),pe=L.getElevation(P[0],P[3]),ne=L.isLeaf(P[0],P[1]),de=L.isLeaf(P[2],P[1]),xe=L.isLeaf(P[2],P[3]),ge=L.isLeaf(P[0],P[3]),Ue=Math.min(B.min,X.min,ie.min,pe.min),Oe=Math.max(B.max,X.max,ie.max,pe.max),He=ne&&de&&xe&&ge;k.maximums.push(Oe),k.minimums.push(Ue),k.leaves.push(Oe-Ue<=5&&He?1:0)}y.push(k)}return y}(this.dem),a=r.length-1,l=r[a];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,l,h,p,y=1){return ly([e,r,-100],[a,l,this.maximums[0]*y],h,p)}raycast(e,r,a,l,h,p,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,a,l,h,p,y);if(b==null)return null;const v=[],E=[],k=[],P=[],L=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:R,t:B,nodex:X,nodey:ie,depth:pe}=L.pop();if(this.leaves[R]){dy(X,ie,pe,e,r,a,l,k,P);const de=1<<pe,xe=(X+0)/de,ge=(X+1)/de,Ue=(ie+0)/de,Oe=(ie+1)/de,He=$a(xe,Ue,this.dem)*y,ot=$a(ge,Ue,this.dem)*y,qe=$a(ge,Oe,this.dem)*y,Je=$a(xe,Oe,this.dem)*y,Ye=cy(k[0],k[1],He,P[0],k[1],ot,P[0],P[1],qe,h,p),it=cy(P[0],P[1],qe,k[0],P[1],Je,k[0],k[1],He,h,p),dt=Math.min(Ye!==null?Ye:Number.MAX_VALUE,it!==null?it:Number.MAX_VALUE);if(dt!==Number.MAX_VALUE)return dt;{const Ze=hu([],h,p,B);if(my(He,ot,Je,qe,uy(Ze[0],k[0],P[0]),uy(Ze[1],k[1],P[1]))>=Ze[2])return B}continue}let ne=0;for(let de=0;de<this._siblingOffset.length;de++){dy((X<<1)+this._siblingOffset[de][0],(ie<<1)+this._siblingOffset[de][1],pe+1,e,r,a,l,k,P),k[2]=-100,P[2]=this.maximums[this.childOffsets[R]+de]*y;const xe=ly(k,P,h,p);if(xe!=null){const ge=xe;v[de]=ge;let Ue=!1;for(let Oe=0;Oe<ne&&!Ue;Oe++)ge>=v[E[Oe]]&&(E.splice(Oe,0,de),Ue=!0);Ue||(E[ne]=de),ne++}}for(let de=0;de<ne;de++){const xe=E[de];L.push({idx:this.childOffsets[R]+xe,t:v[xe],nodex:(X<<1)+this._siblingOffset[xe][0],nodey:(ie<<1)+this._siblingOffset[xe][1],depth:pe+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,l,h){if(e[l].isLeaf(r,a)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const p=l-1,y=e[p];let b=0,v=0;for(let E=0;E<this._siblingOffset.length;E++){const k=2*r+this._siblingOffset[E][0],P=2*a+this._siblingOffset[E][1],L=y.getElevation(k,P),R=y.isLeaf(k,P),B=this._addNode(L.min,L.max,R);R&&(b|=1<<E),v||(v=B)}for(let E=0;E<this._siblingOffset.length;E++)b&1<<E||this._construct(e,2*r+this._siblingOffset[E][0],2*a+this._siblingOffset[E][1],p,v+E)}}function my(s,e,r,a,l,h){return ds(ds(s,r,h),ds(e,a,h),l)}function $a(s,e,r){const a=r.dim,l=wt(s*a-.5,0,a-1),h=wt(e*a-.5,0,a-1),p=Math.floor(l),y=Math.floor(h),b=Math.min(p+1,a-1),v=Math.min(y+1,a-1);return my(r.get(p,y),r.get(b,y),r.get(p,v),r.get(b,v),l-p,h-y)}const py={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function c1(s,e,r){return(256*s*256+256*e+r)/10-1e4}function u1(s,e,r){return 256*s+e+r/256-32768}class kh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,l=!1,h=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return As(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2,y=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=l,!l){for(let b=0;b<p;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(p,b)]=y[this._idx(p-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,p)]=y[this._idx(b,p-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(p,-1)]=y[this._idx(p-1,0)],y[this._idx(-1,p)]=y[this._idx(0,p-1)],y[this._idx(p,p)]=y[this._idx(p-1,p-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new hy(this)}get(e,r,a=!1){a&&(e=wt(e,-1,this.dim),r=wt(r,-1,this.dim));const l=4*this._idx(e,r);return(this.encoding==="terrarium"?u1:c1)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return py[e]}get unpackVector(){return py[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],l=kh.getUnpackVector(r);let h=Math.floor((e+l[3])/l[2]);return a[2]=h%256,h=Math.floor(h/256),a[1]=h%256,h=Math.floor(h/256),a[0]=h,a}getPixels(){return new Si({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,p=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(a){case-1:p=y-1;break;case 1:y=p+1}const b=-r*this.dim,v=-a*this.dim;for(let E=p;E<y;E++)for(let k=l;k<h;k++){const P=4*this._idx(k,E),L=4*this._idx(k+b,E+v);this.pixels[P+0]=e.pixels[L+0],this.pixels[P+1]=e.pixels[L+1],this.pixels[P+2]=e.pixels[L+2],this.pixels[P+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ct(kh,"DEMData"),Ct(hy,"DemMinMaxQuadTree",{omit:["dem"]});class d1{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:r,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,l=r===void 0?0:this.data[a].indexOf(r),h=this.data[a][l];return this.data[a].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||r.push(l);for(const a of r)this.remove(a.value.tileID,a)}}class Kl{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}Kl.ReadOnly=!1,Kl.ReadWrite=!0,Kl.disabled=new Kl(519,Kl.ReadOnly,[0,1]);const Rp=7680;class zp{constructor(e,r,a,l,h,p){this.test=e,this.ref=r,this.mask=a,this.fail=l,this.depthFail=h,this.pass=p}}zp.disabled=new zp({func:519,mask:0},0,0,Rp,Rp,Rp);class On{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}On.Replace=[1,0],On.disabled=new On(On.Replace,Js.transparent,[!1,!1,!1,!1]),On.unblended=new On(On.Replace,Js.transparent,[!0,!0,!0,!0]),On.alphaBlended=new On([1,771],Js.transparent,[!0,!0,!0,!0]);const Op=1029,Fp=2305;class vn{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}vn.disabled=new vn(!1,Op,Fp),vn.backCCW=new vn(!0,Op,Fp),vn.backCW=new vn(!0,Op,2304),vn.frontCW=new vn(!0,1028,2304),vn.frontCCW=new vn(!0,1028,Fp);class Vo extends io{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new d1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new l1,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return mr(this._tiles).map(e=>e.tileID).sort(fy).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&r.push(this._tiles[a]);return e?r.sort((a,l)=>{const h=a.tileID,p=l.tileID,y=new Ee(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),b=new Ee(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-p.overscaledZ||b.y-y.y||b.x-y.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(fy).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new rn(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=sn.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Wn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const h=r[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const p=this.getTileByID(h);a(e,p),a(p,e)}}function a(l,h){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let p=h.tileID.canonical.x-l.tileID.canonical.x;const y=h.tileID.canonical.y-l.tileID.canonical.y,b=Math.pow(2,l.tileID.canonical.z),v=h.tileID.key;p===0&&y===0||Math.abs(y)>1||(Math.abs(p)>1&&(Math.abs(p+b)===1?p+=b:Math.abs(p-b)===1&&(p-=b)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,p,y),l.neighboringTiles&&l.neighboringTiles[v]&&(l.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,l){for(const h in this._tiles){let p=this._tiles[h];if(l[h]||!p.hasData()||p.tileID.overscaledZ<=r||p.tileID.overscaledZ>a)continue;let y=p.tileID;for(;p&&p.tileID.overscaledZ>r+1;){const v=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[v.key],p&&p.hasData()&&(y=v)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){l[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const l=e.scaledTo(a),h=this._getLoadedTile(l);if(h)return h}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,l=Math.ceil(e.height/r)+1,h=Math.floor(a*l*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+r),a[h.tileID.key]=h}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,r,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let l;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new ii(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(l=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(y=>this._source.hasTile(y)))):l=[];const h=this._updateRetainedTiles(l);if(gy(this._source.type)&&l.length!==0){const y={},b={},v=Object.keys(h);for(const k of v){const P=h[k],L=this._tiles[k];if(!L||L.fadeEndTime&&L.fadeEndTime<=sn.now())continue;const R=this.findLoadedParent(P,Math.max(P.overscaledZ-Vo.maxOverzooming,this._source.minzoom));R&&(this._addTile(R.tileID),y[R.tileID.key]=R.tileID),b[k]=P}const E=l[l.length-1].overscaledZ;for(const k in this._tiles){const P=this._tiles[k];if(h[k]||!P.hasData())continue;let L=P.tileID;for(;L.overscaledZ>E;){L=L.scaledTo(L.overscaledZ-1);const R=this._tiles[L.key];if(R&&R.hasData()&&b[L.key]){h[k]=P.tileID;break}}}for(const k in y)h[k]||(this._coveredTiles[k]=!0,h[k]=y[k])}for(const y in h)this._tiles[y].clearFadeHold();const p=function(y,b){const v=[];for(const E in y)E in b||v.push(E);return v}(this._tiles,h);for(const y of p){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const a={},l=e.reduce((v,E)=>Math.min(v,E.overscaledZ),1/0),h=e[0].overscaledZ,p=Math.max(h-Vo.maxOverzooming,this._source.minzoom),y=Math.max(h+Vo.maxUnderzooming,this._source.minzoom),b={};for(const v of e){const E=this._addTile(v);r[v.key]=v,E.hasData()||l<this._source.maxzoom&&(b[v.key]=v)}this._retainLoadedChildren(b,l,y,r);for(const v of e){let E=this._tiles[v.key];if(E.hasData())continue;if(v.canonical.z>=this._source.maxzoom){const P=v.children(this._source.maxzoom)[0],L=this.getTile(P);if(L&&L.hasData()){r[P.key]=P;continue}}else{const P=v.children(this._source.maxzoom);if(r[P[0].key]&&r[P[1].key]&&r[P[2].key]&&r[P[3].key])continue}let k=E.wasRequested();for(let P=v.overscaledZ-1;P>=p;--P){const L=v.scaledTo(P);if(a[L.key]||(a[L.key]=!0,E=this.getTile(L),!E&&k&&(E=this._addTile(L)),E&&(r[L.key]=L,k=E.wasRequested(),E.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}r.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;l=h}for(const h of r)this._loadedParentTiles[h]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=!!r;if(!a){const l=this.map?this.map.painter:null;r=new Lp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new Wn("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){const l=[],h=this.transform;if(!h)return l;const p=h.projection.name==="globe",y=Dn(h.center.lng);for(const b in this._tiles){const v=this._tiles[b];if(a&&v.clearQueryDebugViz(),v.holdingForFade())continue;let E;if(p){const k=v.tileID.canonical;if(k.z===0){const P=[Math.abs(wt(y,...zu(k,-1))-y),Math.abs(wt(y,...zu(k,1))-y)];E=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(wt(y,...zu(k,-1))-y),Math.abs(wt(y,...zu(k,0))-y),Math.abs(wt(y,...zu(k,1))-y)];E=[P.indexOf(Math.min(...P))-1]}}else E=[0];for(const k of E){const P=e.containsTile(v,h,r,k);P&&l.push(P)}}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(gy(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=sn.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const l=this._tiles[e];l&&l.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,r))};return void this._source.on("data",y)}const a=new Map,l=Array.isArray(e)?e:[e],h=this.map.painter.terrain,p=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const y of l){const b=y.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const v of b)a.set(v.key,v);this.usedForTerrain&&y.updateElevation(!1)}_s(Array.from(a.values()),(y,b)=>{const v=new Lp(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(v,E=>{this._source.type==="raster-dem"&&v.dem&&this._backfillDEM(v),b(E,v)})},r)}}function fy(s,e){const r=Math.abs(2*s.wrap)-+(s.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return s.overscaledZ-e.overscaledZ||a-r||e.canonical.y-s.canonical.y||e.canonical.x-s.canonical.x}function gy(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function zu(s,e){const r=1<<s.z;return[s.x/r+e,(s.x+1)/r+e]}Vo.maxOverzooming=10,Vo.maxUnderzooming=3;class Ah{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const l=a||e.findDEMTileFor(r);if(!l||!l.dem)return;const h=l.dem,p=l.tileID,y=1<<r.canonical.z-p.canonical.z;return new Ah(l,l.tileSize/zt/y,[(r.canonical.x/y-p.canonical.x)*h.dim,(r.canonical.y/y-p.canonical.y)*h.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(a);return new Ee(l,h)}getElevationAt(e,r,a,l){const h=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],y=Math.floor(h),b=Math.floor(p),v=this._dem;return l=!!l,a?ds(ds(v.get(y,b,l),v.get(y,b+1,l),p-b),ds(v.get(y+1,b,l),v.get(y+1,b+1,l),p-b),h-y):v.get(y,b,l)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*yn(1,e)*this._dem.stride}}class xy{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ea(zt,16,0),this.featureIndexArray=new Ao,this.promoteId=r}insert(e,r,a,l,h,p=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,h,p);const b=this.grid;for(let v=0;v<r.length;v++){const E=r[v],k=[1/0,1/0,-1/0,-1/0];for(let P=0;P<E.length;P++){const L=E[P];k[0]=Math.min(k[0],L.x),k[1]=Math.min(k[1],L.y),k[2]=Math.max(k[2],L.x),k[3]=Math.max(k[3],L.y)}k[0]<zt&&k[1]<zt&&k[2]>=0&&k[3]>=0&&b.insert(y,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new _p(new gh(this.rawTileData)).layers,this.sourceLayerCoder=new sy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,l){this.loadVTLayers();const h=e.params||{},p=Sl(h.filter),y=e.tileResult,b=e.transform,v=y.bufferedTilespaceBounds,E=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(R,B,X,ie)=>Vg(y.bufferedTilespaceGeometry,R,B,X,ie));E.sort(h1);let k=null;b.elevation&&E.length>0&&(k=Ah.create(b.elevation,this.tileID));const P={};let L;for(let R=0;R<E.length;R++){const B=E[R];if(B===L)continue;L=B;const X=this.featureIndexArray.get(B);let ie=null;this.loadMatchingFeature(P,X,p,h.layers,h.availableImages,r,a,l,(pe,ne,de,xe=0)=>(ie||(ie=oa(pe,this.tileID.canonical,e.tileTransform)),ne.queryIntersectsFeature(y,pe,de,ie,this.z,e.transform,e.pixelPosMatrix,k,xe)))}return P}loadMatchingFeature(e,r,a,l,h,p,y,b,v){const{featureIndex:E,bucketIndex:k,sourceLayerIndex:P,layoutVertexArrayOffset:L}=r,R=this.bucketLayerIDs[k];if(l&&!function(pe,ne){for(let de=0;de<pe.length;de++)if(ne.indexOf(pe[de])>=0)return!0;return!1}(l,R))return;const B=this.sourceLayerCoder.decode(P),X=this.vtLayers[B].feature(E);if(a.needGeometry){const pe=Oo(X,!0);if(!a.filter(new C(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!a.filter(new C(this.tileID.overscaledZ),X))return;const ie=this.getId(X,B);for(let pe=0;pe<R.length;pe++){const ne=R[pe];if(l&&l.indexOf(ne)<0)continue;const de=p[ne];if(!de)continue;let xe={};ie!==void 0&&b&&(xe=b.getState(de.sourceLayer||"_geojsonTileLayer",ie));const ge=Ut({},y[ne]);ge.paint=yy(ge.paint,de.paint,X,xe,h),ge.layout=yy(ge.layout,de.layout,X,xe,h);const Ue=!v||v(X,de,xe,L);if(!Ue)continue;const Oe=new ry(X,this.z,this.x,this.y,ie);Oe.layer=ge;let He=e[ne];He===void 0&&(He=e[ne]=[]),He.push({featureIndex:E,feature:Oe,intersectionZ:Ue})}}lookupSymbolFeatures(e,r,a,l,h,p,y,b){const v={};this.loadVTLayers();const E=Sl(h);for(const k of e)this.loadMatchingFeature(v,{bucketIndex:a,sourceLayerIndex:l,featureIndex:k,layoutVertexArrayOffset:0},E,p,y,b,r);return v}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(a),h=this.vtFeatures[l];if(h[r])return h[r];const p=this.vtLayers[l].feature(r);return h[r]=p,p}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];l!=null&&(a=e.properties[l]),typeof a=="boolean"&&(a=Number(a))}return a}}function yy(s,e,r,a,l){return Qt(s,(h,p)=>{const y=e instanceof se?e.get(p):null;return y&&y.evaluate?y.evaluate(r,a,l):y})}function h1(s,e){return e-s}Ct(xy,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class _y{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new la({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=fr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,y=!0;l.push({left:h,right:p,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let v=1;v<e.length;v++){y=!y;const E=e[v];h=b*a,b+=E,p=b*a,l.push({left:h,right:p,isDash:y,zeroLength:E===0})}return l}addRoundDash(e,r,a){const l=r/2;for(let h=-a;h<=a;h++){const p=this.width*(this.nextRow+a+h);let y=0,b=e[y];for(let v=0;v<this.width;v++){v/b.right>1&&(b=e[++y]);const E=Math.abs(v-b.left),k=Math.abs(v-b.right),P=Math.min(E,k);let L;const R=h/a*(l+1);if(b.isDash){const B=l-Math.abs(R);L=Math.sqrt(P*P+B*B)}else L=l-Math.sqrt(P*P+R*R);this.image.data[p+v]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const v=e[b],E=e[b+1];v.zeroLength?e.splice(b,1):E&&E.isDash===v.isDash&&(E.left=v.left,e.splice(b,1))}const a=e[0],l=e[e.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let p=0,y=e[p];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++p]);const v=Math.abs(b-y.left),E=Math.abs(b-y.right),k=Math.min(v,E);this.image.data[h+b]=Math.max(0,Math.min(255,(y.isDash?k:-k)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const l=r==="round",h=l?7:0,p=2*h+1;if(this.nextRow+p>this.height)return As("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let E=0;E<e.length;E++)e[E]<0&&(As("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),y+=e[E];if(y!==0){const E=this.width/y,k=this.getDashRanges(e,this.width,E);l?this.addRoundDash(k,E,h):this.addRegularDash(k,r==="square"?.5*E:0)}const b=this.nextRow+h;this.nextRow+=p;const v={tl:[b,h],br:[y,0]};return this.positions[a]=v,v}}Ct(_y,"LineAtlas");const by=1*bn;class vy{constructor(e){const r={},a=[];for(const y in e){const b=e[y],v=r[y]={};for(const E in b.glyphs){const k=b.glyphs[+E];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const P=k.metrics.localGlyph?by:1,L={x:0,y:0,w:k.bitmap.width+2*P,h:k.bitmap.height+2*P};a.push(L),v[E]=L}}const{w:l,h}=jp(a),p=new la({width:l||1,height:h||1});for(const y in e){const b=e[y];for(const v in b.glyphs){const E=b.glyphs[+v];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const k=r[y][v],P=E.metrics.localGlyph?by:1;la.copy(E.bitmap,p,{x:0,y:0},{x:k.x+P,y:k.y+P},E.bitmap)}}this.image=p,this.positions=r}}Ct(vy,"GlyphAtlas");class m1{constructor(e){this.tileID=new ii(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Uo(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,a,l,h){this.status="parsing",this.data=e,this.collisionBoxArray=new Ss;const p=new sy(Object.keys(e.layers).sort()),y=new xy(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},v=new _y(256,256),E={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:v,availableImages:a},k=r.familiesBySource[this.source];for(const xe in k){const ge=e.layers[xe];if(!ge)continue;let Ue=!1,Oe=!1;for(const qe of k[xe])qe[0].type==="symbol"?Ue=!0:Oe=!0;if(this.isSymbolTile===!0&&!Ue||this.isSymbolTile===!1&&!Oe)continue;ge.version===1&&As(`Vector tile source "${this.source}" layer "${xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const He=p.encode(xe),ot=[];for(let qe=0;qe<ge.length;qe++){const Je=ge.feature(qe),Ye=y.getId(Je,xe);ot.push({feature:Je,id:Ye,index:qe,sourceLayerIndex:He})}for(const qe of k[xe]){const Je=qe[0];this.isSymbolTile!==void 0&&Je.type==="symbol"!==this.isSymbolTile||Je.minzoom&&this.zoom<Math.floor(Je.minzoom)||Je.maxzoom&&this.zoom>=Je.maxzoom||Je.visibility!=="none"&&(Bp(qe,this.zoom,a),(b[Je.id]=Je.createBucket({index:y.bucketLayerIDs.length,layers:qe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:He,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(ot,E,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(qe.map(Ye=>Ye.id)))}}let P,L,R,B;v.trim();const X={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ie=()=>{if(P)return h(P);if(L&&R&&B){const xe=new vy(L),ge=new Cx(R,B);for(const Ue in b){const Oe=b[Ue];Oe instanceof Ua?(Bp(Oe.layers,this.zoom,a),Fw(Oe,L,xe.positions,R,ge.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Oe.hasPattern&&(Oe instanceof mh||Oe instanceof lh||Oe instanceof Su)&&(Bp(Oe.layers,this.zoom,a),Oe.addFeatures(E,this.tileID.canonical,ge.patternPositions,a,this.tileTransform))}this.status="done",h(null,{buckets:mr(b).filter(Ue=>!Ue.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,lineAtlas:v,imageAtlas:ge,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?R:null,glyphPositions:this.returnDependencies?xe.positions:null})}},pe=Qt(E.glyphDependencies,xe=>Object.keys(xe).map(Number));Object.keys(pe).length?l.send("getGlyphs",{uid:this.uid,stacks:pe},(xe,ge)=>{P||(P=xe,L=ge,ie())},void 0,!1,X):L={};const ne=Object.keys(E.iconDependencies);ne.length?l.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(xe,ge)=>{P||(P=xe,R=ge,ie())},void 0,!1,X):R={};const de=Object.keys(E.patternDependencies);de.length?l.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"patterns"},(xe,ge)=>{P||(P=xe,B=ge,ie())},void 0,!1,X):B={},ie()}}function Bp(s,e,r){const a=new C(e);for(const l of s)l.recalculate(a,r)}class wy{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,l){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[p,y]=h.result;return this.scheduler?this.scheduler.add(()=>{l(p,y)},r):l(p,y),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=a((p,y)=>{h.result=[p,y];for(const b of h.callbacks)this.scheduler?this.scheduler.add(()=>{b(p,y)},r):b(p,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==l),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function jy(s,e,r){const a=JSON.stringify(s.request);return s.data&&(this.deduped.entries[a]={result:[null,s.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},l=>{const h=tn(s.request,(p,y,b,v)=>{p?l(p):y&&l(null,{vectorTile:r?void 0:new _p(new gh(y)),rawData:y,cacheControl:b,expires:v})});return()=>{h.cancel(),l()}},e)}const Ny=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Up{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=Ny[15&a];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Up(y,p,h,e)}constructor(e,r=64,a=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=Ny.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Vp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:y}=this,b=[0,h.length-1,0],v=[];for(;b.length;){const E=b.pop()||0,k=b.pop()||0,P=b.pop()||0;if(k-P<=y){for(let X=P;X<=k;X++){const ie=p[2*X],pe=p[2*X+1];ie>=e&&ie<=a&&pe>=r&&pe<=l&&v.push(h[X])}continue}const L=P+k>>1,R=p[2*L],B=p[2*L+1];R>=e&&R<=a&&B>=r&&B<=l&&v.push(h[L]),(E===0?e<=R:r<=B)&&(b.push(P),b.push(L-1),b.push(1-E)),(E===0?a>=R:l>=B)&&(b.push(L+1),b.push(k),b.push(1-E))}return v}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,y=[0,l.length-1,0],b=[],v=a*a;for(;y.length;){const E=y.pop()||0,k=y.pop()||0,P=y.pop()||0;if(k-P<=p){for(let X=P;X<=k;X++)Ty(h[2*X],h[2*X+1],e,r)<=v&&b.push(l[X]);continue}const L=P+k>>1,R=h[2*L],B=h[2*L+1];Ty(R,B,e,r)<=v&&b.push(l[L]),(E===0?e-a<=R:r-a<=B)&&(y.push(P),y.push(L-1),y.push(1-E)),(E===0?e+a>=R:r+a>=B)&&(y.push(L+1),y.push(k),y.push(1-E))}return b}}function Vp(s,e,r,a,l,h){if(l-a<=r)return;const p=a+l>>1;Sy(s,e,p,a,l,h),Vp(s,e,r,a,p-1,1-h),Vp(s,e,r,p+1,l,1-h)}function Sy(s,e,r,a,l,h){for(;l>a;){if(l-a>600){const v=l-a+1,E=r-a+1,k=Math.log(v),P=.5*Math.exp(2*k/3),L=.5*Math.sqrt(k*P*(v-P)/v)*(E-v/2<0?-1:1);Sy(s,e,r,Math.max(a,Math.floor(r-E*P/v+L)),Math.min(l,Math.floor(r+(v-E)*P/v+L)),h)}const p=e[2*r+h];let y=a,b=l;for(Ou(s,e,a,r),e[2*l+h]>p&&Ou(s,e,a,l);y<b;){for(Ou(s,e,y,b),y++,b--;e[2*y+h]<p;)y++;for(;e[2*b+h]>p;)b--}e[2*a+h]===p?Ou(s,e,a,b):(b++,Ou(s,e,b,l)),b<=r&&(a=b+1),r<=b&&(l=b-1)}}function Ou(s,e,r,a){qp(s,r,a),qp(e,2*r,2*a),qp(e,2*r+1,2*a+1)}function qp(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}function Ty(s,e,r,a){const l=s-r,h=e-a;return l*l+h*h}n.ARRAY_TYPE=Ni,n.AUTH_ERR_MSG=ye,n.Aabb=ri,n.Actor=class{constructor(s,e,r){this.target=s,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},_r(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Zr()?s:M,this.scheduler=new a1}send(s,e,r,a,l=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=h,this.callbacks[p]=r);const y=et(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:s,hasCallback:!!r,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:Ia(e,y)},y),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(s){const e=s.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(e.mustQueue||Zr()){const a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),a&&a.metadata||{type:"message"})}else this.processTask(r,e)}processTask(s,e){if(e.type==="<response>"){const r=this.callbacks[s];delete this.callbacks[s],r&&(e.error?r(ta(e.error)):r(null,ta(e.data)))}else{const r=et(this.globalScope)?void 0:[],a=e.hasCallback?(h,p)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:h?Ia(h):null,data:Ia(p,r)},r)}:h=>{},l=ta(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,a);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],l.source)[h[1]](l,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.CanonicalTileID=hh,n.Color=Js,n.ColorMode=On,n.CullFaceMode=vn,n.DEMData=kh,n.DataConstantProperty=F,n.DedupedRequest=wy,n.DepthMode=Kl,n.EXTENT=zt,n.Elevation=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,l=Math.floor(s.x),h=Math.floor((s.x-l)*a),p=Math.floor(s.y*a),y=this.findDEMTileFor(new ii(r,l,r,h,p));return!(!y||!y.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||s.y<0||s.y>1)return e;const l=a.getSource().maxzoom,h=1<<l,p=Math.floor(s.x),y=s.x-p,b=new ii(l,p,l,Math.floor(y*h),Math.floor(s.y*h)),v=this.findDEMTileFor(b);if(!v||!v.dem)return e;const E=v.dem,k=1<<v.tileID.canonical.z,P=(y*k-v.tileID.canonical.x)*E.dim,L=(s.y*k-v.tileID.canonical.y)*E.dim,R=Math.floor(P),B=Math.floor(L);return(r?this.exaggeration():1)*ds(ds(E.get(R,B),E.get(R,B+1),L-B),ds(E.get(R+1,B),E.get(R+1,B+1),L-B),P-R)}getAtTileOffset(s,e,r){const a=1<<s.canonical.z;return this.getAtPointOrZero(new Rl(s.wrap+(s.canonical.x+e/zt)/a,(s.canonical.y+r/zt)/a))}getAtTileOffsetFunc(s,e,r,a){return l=>{const h=this.getAtTileOffset(s,l.x,l.y),p=a.upVector(s.canonical,l.x,l.y);return Li(p,p,h*a.upVectorScale(s.canonical,e,r).metersToTile),p}}getForTilePoints(s,e,r,a){if(this.isUsingMockSource())return!1;const l=Ah.create(this,s,a);return!!l&&(e.forEach(h=>{h[2]=this.exaggeration()*l.getElevationAt(h[0],h[1],r)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,l=1<<s.canonical.z-a.canonical.z;let h=s.canonical.x/l-a.canonical.x,p=s.canonical.y/l-a.canonical.y,y=0;for(let b=0;b<s.canonical.z-a.canonical.z&&!r.leaves[y];b++){h*=2,p*=2;const v=2*Math.floor(p)+Math.floor(h);y=r.childOffsets[y]+v,h%=1,p%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},n.ErrorEvent=rn,n.EvaluationParameters=C,n.Event=Wn,n.Evented=io,n.FillExtrusionBucket=Su,n.Frustum=Km,n.FrustumCorners=Xm,n.GLOBE_RADIUS=Pn,n.GLOBE_SCALE_MATCH_LATITUDE=45,n.GLOBE_ZOOM_THRESHOLD_MAX=Sg,n.GLOBE_ZOOM_THRESHOLD_MIN=Qm,n.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,e){const r=new at,a=new Pt,l=[],h=s+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),b=(v,E,k)=>{let P=v===h-1?v-2:v===0?v:v-1;return P+=k?24575:0,[P,E]};for(let v=0;v<h;++v)r.emplaceBack(...b(v,0,!0));for(let v=0;v<p;++v)for(let E=0;E<h;++E)r.emplaceBack(...b(E,v,(E===0||E===h-1)&&!0));for(let v=0;v<e.length;++v){const E=e[v];for(let k=0;k<h;++k)r.emplaceBack(...b(k,E,!0))}for(let v=0;v<e.length;++v){const E=a.length,k=e[v]+1+2,P=new Pt;for(let B=0;B<k-1;B++){const X=B===k-2,ie=X?h*(y-e.length+v-B):h;for(let pe=0;pe<h-1;pe++){const ne=B*h+pe;B===0||X||pe===0||pe===h-2?(P.emplaceBack(ne+1,ne,ne+ie),P.emplaceBack(ne+ie,ne+ie+1,ne+1)):(a.emplaceBack(ne+1,ne,ne+ie),a.emplaceBack(ne+ie,ne+ie+1,ne+1))}}const L=ar.simpleSegment(0,E,r.length,a.length-E);for(let B=0;B<P.uint16.length;B+=3)a.emplaceBack(P.uint16[B],P.uint16[B+1],P.uint16[B+2]);const R=ar.simpleSegment(0,E,r.length,a.length-E);l.push({withoutSkirts:L,withSkirts:R})}return{vertices:r,indices:a,segments:l}}_createGrid(s){const e=this._fillGridMeshWithLods(Ro,fu);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,pu.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new Pt;for(let l=0;l<=Ro;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const r=new Ns,a=new Ns;this._poleSegments=[];for(let l=0,h=0;l<Qm;l++){const p=360/(1<<l);r.emplaceBack(0,-Pn,0,.5,0),a.emplaceBack(0,-Pn,0,.5,1);for(let y=0;y<=Ro;y++){const b=y/Ro,v=ds(0,p,b),[E,k,P]=Il(av,ov,v,Pn);r.emplaceBack(E,k,P,b,0),a.emplaceBack(E,k,P,b,1)}this._poleSegments.push(ar.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(r,jg,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(a,jg,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,e){if(!this._wireframeSegments){const r=new Er,a=Ro,l=a+1+2,h=1;this._wireframeSegments=[];for(let p=0,y=0;p<fu.length;p++){const b=fu[p];for(let E=h;E<b+h;E++)for(let k=h;k<a+h;k++){const P=E*l+k;r.emplaceBack(P,P+1),r.emplaceBack(P,P+l),r.emplaceBack(P,P+l+1)}const v=b*a*3;this._wireframeSegments.push(ar.simpleSegment(0,y,(b+1)*l,v)),y+=v}this._wireframeIndexBuffer=s.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},n.GlyphManager=Gl,n.ImagePosition=Np,n.KDBush=Up,n.LivePerformanceUtils=xm,n.LngLat=Ts,n.LngLatBounds=za,n.LocalGlyphMode=Ep,n.MAX_MERCATOR_LATITUDE=Gr,n.MercatorCoordinate=Rl,n.ONE_EM=Rr,n.OverscaledTileID=ii,n.PerformanceMarkers=ga,n.Point=Ee,n.Properties=oe,n.RGBAImage=Si,n.Ray=Hm,n.RequestManager=class{constructor(s,e,r){this._transformRequestFn=s,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const s=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",te,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,e){return this._transformRequestFn&&this._transformRequestFn(s,e)||{url:s}}normalizeStyleURL(s,e){if(!Se(s))return s;const r=bt(s);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(s,e){if(!Se(s))return s;const r=bt(s);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(s,e,r,a){if(!Se(s))return s;const l=bt(s);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),r&&l.params.push(`language=${r}`),a&&l.params.push(`worldview=${a}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(s,e,r,a){const l=bt(s);return Se(s)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=`${e}${r}`,ut(l))}normalizeTileURL(s,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Se(s))return s;const a=bt(s);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${G.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${U.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${U.TILE_URL_VERSION}${a.path}`);const l=this._customAccessToken||function(h){for(const p of h){const y=p.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||U.ACCESS_TOKEN;return U.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,l)}canonicalizeTileURL(s,e){const r=bt(s);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return s;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${U.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${U.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter(h=>!h.match(/^access_token=/))),l.length&&(a+=`?${l.join("&")}`),a}canonicalizeTileset(s,e){const r=!!e&&Se(e),a=[];for(const l of s.tiles||[])Re(l)?a.push(this.canonicalizeTileURL(l,r)):a.push(l);return a}_makeAPIURL(s,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=bt(U.API_URL);if(s.protocol=a.protocol,s.authority=a.authority,s.protocol==="http"){const l=s.params.indexOf("secure");l>=0&&s.params.splice(l,1)}if(a.path!=="/"&&(s.path=`${a.path}${s.path}`),!U.REQUIRE_ACCESS_TOKEN)return ut(s);if(e=e||U.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return s.params=s.params.filter(l=>l.indexOf("access_token")===-1),s.params.push(`access_token=${e||""}`),ut(s)}},n.ResourceType=Dr,n.SegmentVector=ar,n.SourceCache=Vo,n.StencilMode=zp,n.StructArrayLayout1ui2=ji,n.StructArrayLayout2f1f2i16=Ot,n.StructArrayLayout2i4=at,n.StructArrayLayout2ui4=Er,n.StructArrayLayout3f12=ts,n.StructArrayLayout3ui6=Pt,n.StructArrayLayout4i8=Qe,n.StructArrayLayout5f20=Ns,n.Texture=Ru,n.Tile=Lp,n.Transitionable=O,n.Uniform1f=Xd,n.Uniform1i=class extends ia{constructor(s){super(s),this.current=0}set(s,e,r){this.fetchUniformLocation(s,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},n.Uniform2f=class extends ia{constructor(s){super(s),this.current=[0,0]}set(s,e,r){this.fetchUniformLocation(s,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},n.Uniform3f=class extends ia{constructor(s){super(s),this.current=[0,0,0]}set(s,e,r){this.fetchUniformLocation(s,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},n.Uniform4f=ag,n.UniformColor=og,n.UniformMatrix2f=class extends ia{constructor(s){super(s),this.current=$b}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let a=0;a<4;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},n.UniformMatrix3f=class extends ia{constructor(s){super(s),this.current=qb}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.UniformMatrix4f=class extends ia{constructor(s){super(s),this.current=Vb}set(s,e,r){if(this.fetchUniformLocation(s,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},n.UnwrappedTileID=mx,n.ValidationError=Et,n.VectorTileFeature=uh,n.VectorTileWorkerSource=class extends io{constructor(s,e,r,a,l){super(),this.actor=s,this.layerIndex=e,this.availableImages=r,this.loadVectorData=l||jy,this.loading={},this.loaded={},this.deduped=new wy(s.scheduler),this.isSpriteLoaded=a,this.scheduler=s.scheduler}loadTile(s,e){const r=s.uid,a=s&&s.request,l=a&&a.collectResourceTiming,h=this.loading[r]=new m1(s);h.abort=this.loadVectorData(s,(p,y)=>{const b=!this.loading[r];if(delete this.loading[r],b||p||!y)return h.status="done",b||(this.loaded[r]=h),e(p);const v=y.rawData,E={};y.expires&&(E.expires=y.expires),y.cacheControl&&(E.cacheControl=y.cacheControl),h.vectorTile=y.vectorTile||new _p(new gh(v));const k=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,L)=>{if(P||!L)return e(P);const R={};if(l){const B=dc(a);B.length>0&&(R.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,Ut({rawTileData:v.slice(0)},L,E,R))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[r]=h})}reloadTile(s,e){const r=this.loaded,a=s.uid,l=this;if(r&&r[a]){const h=r[a];h.showCollisionBoxes=s.showCollisionBoxes,h.enableTerrain=!!s.enableTerrain,h.projection=s.projection,h.tileTransform=Uo(s.tileID.canonical,s.projection);const p=(y,b)=>{const v=h.reloadCallback;v&&(delete h.reloadCallback,h.parse(h.vectorTile,l.layerIndex,this.availableImages,l.actor,v)),e(y,b)};h.status==="parsing"?h.reloadCallback=p:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(s,e){const r=s.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(s,e){const r=this.loaded,a=s.uid;r&&r[a]&&delete r[a],e()}},n.WritingMode=zi,n.ZoomDependentExpression=jo,n.add=aa,n.addDynamicAttributes=Th,n.adjoint=function(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=e[4],y=e[5],b=e[6],v=e[7],E=e[8];return s[0]=p*E-y*v,s[1]=l*v-a*E,s[2]=a*y-l*p,s[3]=y*b-h*E,s[4]=r*E-l*b,s[5]=l*h-r*y,s[6]=h*v-p*b,s[7]=a*b-r*v,s[8]=r*p-a*h,s},n.asyncAll=_s,n.bezier=pt,n.bindAll=_r,n.boundsAttributes=ny,n.bufferConvexPolygon=function(s,e){const r=[];for(let a=0;a<s.length;a++){const l=ns(a-1,-1,s.length-1),h=ns(a+1,-1,s.length-1),p=s[a],y=s[h],b=s[l].sub(p).unit(),v=y.sub(p).unit(),E=v.angleWithSep(b.x,b.y),k=b.add(v).unit().mult(-1*e/Math.sin(E/2));r.push(p.add(k))}return r},n.cacheEntryPossiblyAdded=function(s){Wr++,Wr>Jt&&(s.getActor().send("enforceCacheSizeLimit",xt),Wr=0)},n.calculateGlobeLabelMatrix=function(s,e){const{x:r,y:a}=s.point,l=Ag(r,a,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Io(l,l,ep(In(e)))},n.calculateGlobeMatrix=function(s){const{x:e,y:r}=s.point,{lng:a,lat:l}=s._center;return Ag(e,r,s.worldSize,a,l)},n.calculateGlobeMercatorMatrix=function(s){const e=s.pixelsPerMeter,r=e/yn(1,s.center.lat),a=gn(new Float64Array(16));return lu(a,a,[s.point.x,s.point.y,0]),Do(a,a,[r,r,e]),Float32Array.from(a)},n.circumferenceAtLatitude=sp,n.clamp=wt,n.clearTileCache=function(s){if(!sr())return;const e=M.caches.delete(De);s&&e.catch(s).then(()=>s())},n.clipLine=Ux,n.clone=function(s){var e=new Ni(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},n.clone$1=br,n.collisionCircleLayout=dw,n.config=U,n.conjugate=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},n.create=function(){var s=new Ni(16);return Ni!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},n.create$1=ug,n.createExpression=Aa,n.createLayout=ke,n.createStyleLayer=function(s){return s.type==="custom"?new s1(s):new i1[s.type](s)},n.cross=Wm,n.degToRad=Te,n.distance=function(s,e){return Math.hypot(e[0]-s[0],e[1]-s[1],e[2]-s[2])},n.div=function(s,e,r){return s[0]=e[0]/r[0],s[1]=e[1]/r[1],s[2]=e[2]/r[2],s},n.dot=Zi,n.earthRadius=yu,n.ease=ft,n.easeCubicInOut=yt,n.ecefToLatLng=function([s,e,r]){const a=Math.hypot(s,e,r),l=Math.atan2(s,r),h=.5*Math.PI-Math.acos(-e/a);return new Ts(rt(l),rt(h))},n.emitValidationErrors=qd,n.endsWith=Jr,n.enforceCacheSizeLimit=function(s){Ls(),qt&&qt.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-s;a++)e.delete(r[a])})})},n.evaluateSizeForFeature=ph,n.evaluateSizeForZoom=Ul,n.evaluateVariableOffset=Zx,n.evented=x,n.exactEquals=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},n.exactEquals$1=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]},n.exported=sn,n.exported$1=G,n.extend=Ut,n.extend$1=nn,n.fillExtrusionHeightLift=ux,n.filterObject=gi,n.fromMat4=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},n.fromQuat=function(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=r+r,y=a+a,b=l+l,v=r*p,E=a*p,k=a*y,P=l*p,L=l*y,R=l*b,B=h*p,X=h*y,ie=h*b;return s[0]=1-k-R,s[1]=E+ie,s[2]=P-X,s[3]=0,s[4]=E-ie,s[5]=1-v-R,s[6]=L+B,s[7]=0,s[8]=P+X,s[9]=L-B,s[10]=1-v-k,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},n.fromRotation=function(s,e){var r=Math.sin(e),a=Math.cos(e);return s[0]=a,s[1]=r,s[2]=0,s[3]=-r,s[4]=a,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},n.fromScaling=hg,n.furthestTileCorner=function(s){const e=Math.round((s+45+360)%360/90)%4;return gt[e]},n.getAABBPointSquareDist=function(s,e,r){let a=0;for(let l=0;l<2;++l){const h=r?r[l]:0;s[l]>h&&(a+=(s[l]-h)*(s[l]-h)),e[l]<h&&(a+=(h-e[l])*(h-e[l]))}return a},n.getAnchorAlignment=Tp,n.getAnchorJustification=kp,n.getBounds=function(s){let e=1/0,r=1/0,a=-1/0,l=-1/0;for(const h of s)e=Math.min(e,h.x),r=Math.min(r,h.y),a=Math.max(a,h.x),l=Math.max(l,h.y);return{min:new Ee(e,r),max:new Ee(a,l)}},n.getColumn=Nt,n.getDefaultExportFromCjs=je,n.getGridMatrix=function(s,e,r,a){const l=e.getNorth(),h=e.getSouth(),p=e.getWest(),y=e.getEast(),b=1<<s.z,v=y-p,E=l-h,k=v/Ro,P=-E/fu[r],L=[0,k,0,P,0,0,l,p,0];if(s.z>0){const R=180/a;dg(L,L,[R/v+1,0,0,0,R/E+1,0,-.5*R/k,.5*R/P,1])}return L[2]=b,L[5]=s.x,L[8]=s.y,L},n.getImage=ce,n.getJSON=function(s,e){return en(Ut(s,{type:"json"}),e)},n.getLatitudinalLod=function(s){const e=Gr-5;s=wt(s,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Te(s))),3);return Math.round(r*(fu.length-1))},n.getMapSessionAPI=Nr,n.getPerformanceMeasurement=dc,n.getProjection=ey,n.getRTLTextPluginStatus=_,n.getReferrer=Oi,n.getTilePoint=function(s,{x:e,y:r},a=0){return new Ee(((e-a)*s.scale-s.x)*zt,(r*s.scale-s.y)*zt)},n.getTileVec3=function(s,e,r=0){return Pl(((e.x-r)*s.scale-s.x)*zt,(e.y*s.scale-s.y)*zt,Dg(e.z,e.y))},n.getVideo=function(s,e){const r=M.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<s.length;a++){const l=M.document.createElement("source");el(s[a])||(r.crossOrigin="Anonymous"),l.src=s[a],r.appendChild(l)}return{cancel:()=>{}}},n.globeCenterToScreenPoint=function(s){const e=[0,0,0],r=gn(new Float64Array(16));return Io(r,s.pixelMatrix,s.globeMatrix),Ys(e,e,r),new Ee(e[0],e[1])},n.globeDenormalizeECEF=ep,n.globeECEFOrigin=function(s,e){const r=[0,0,0];return Ys(r,r,xu(In(e.canonical))),Ys(r,r,s),r},n.globeMetersToEcef=Jd,n.globeNormalizeECEF=xu,n.globePixelsToTileUnits=function(s,e){return zt/(512*Math.pow(2,s))*eh(In(e))},n.globePoleMatrixForTile=function(s,e,r){const a=gn(new Float64Array(16)),l=(e/(1<<s)-.5)*Math.PI*2;return Qd(a,r.globeMatrix,l),Float32Array.from(a)},n.globeTileBounds=In,n.globeTiltAtLngLat=Mg,n.globeToMercatorTransition=Ll,n.globeUseCustomAntiAliasing=function(s,e,r){const a=Ll(r.zoom),l=s.style.map._antialias,h=!!e.extStandardDerivatives,p=e.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return a===0&&!l&&!p&&h},n.identity=gn,n.identity$1=bg,n.invert=qm,n.isFullscreen=function(){return!!M.document.fullscreenElement||!!M.document.webkitFullscreenElement},n.isLngLatBehindGlobe=tp,n.isMapAuthenticated=function(s){return Hr.has(s)},n.isMapboxURL=Se,n.isSafariWithAntialiasingBug=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!et(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.latFromMercatorY=$r,n.latLngToECEF=Dl,n.len=Yb,n.length=cu,n.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},n.lngFromMercatorX=Ri,n.loadVectorTile=jy,n.makeRequest=en,n.mapValue=function(s,e,r,a,l){return wt((s-e)/(r-e)*(l-a)+a,a,l)},n.mercatorScale=Lg,n.mercatorXfromLng=Dn,n.mercatorYfromLat=Ln,n.mercatorZfromAltitude=yn,n.mul=Qb,n.mul$1=Jb,n.multiply=Io,n.multiply$1=dg,n.multiply$2=fg,n.nextPowerOfTwo=fr,n.normalize=si,n.normalize$1=ev,n.normalize$2=yg,n.number=ds,n.ortho=function(s,e,r,a,l,h,p){var y=1/(e-r),b=1/(a-l),v=1/(h-p);return s[0]=-2*y,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*v,s[11]=0,s[12]=(e+r)*y,s[13]=(l+a)*b,s[14]=(p+h)*v,s[15]=1,s},n.pbf=bx,n.perspective=function(s,e,r,a,l){var h,p=1/Math.tan(e/2);return s[0]=p/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,l!=null&&l!==1/0?(s[10]=(l+a)*(h=1/(a-l)),s[14]=2*l*a*h):(s[10]=-1,s[14]=-2*a),s},n.pick=function(s,e){const r={};for(let a=0;a<e.length;a++){const l=e[a];l in s&&(r[l]=s[l])}return r},n.plugin=S,n.pointGeometry=fe,n.polesInViewport=function(s){const e=gn(new Float64Array(16));Io(e,s.pixelMatrix,s.globeMatrix);const r=[0,Wi,0],a=[0,Hi,0];return Ys(r,r,e),Ys(a,a,e),[r[0]>0&&r[0]<=s.width&&r[1]>0&&r[1]<=s.height&&!tp(s,new Ts(s.center.lat,90)),a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!tp(s,new Ts(s.center.lat,-90))]},n.polygonContainsPoint=Fo,n.polygonIntersectsBox=Vg,n.polygonIntersectsPolygon=Og,n.polygonizeBounds=function(s,e,r=0,a=!0){const l=new Ee(r,r),h=s.sub(l),p=e.add(l),y=[h,new Ee(p.x,h.y),p,new Ee(h.x,p.y)];return a&&y.push(h.clone()),y},n.posAttributes=pu,n.postMapLoadEvent=rr,n.postPerformanceEvent=gr,n.postTurnstileEvent=os,n.potpack=jp,n.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},n.radToDeg=rt,n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.registerForPluginStateChange=function(s){return s({pluginStatus:u,pluginURL:i}),x.on("pluginStateChange",s),s},n.removeAuthState=function(s){Hr.delete(s)},n.renderColorRamp=up,n.resample=Rg,n.rotateX=$m,n.rotateX$1=vg,n.rotateY=Qd,n.rotateY$1=wg,n.rotateZ=function(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],y=e[2],b=e[3],v=e[4],E=e[5],k=e[6],P=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=h*l+v*a,s[1]=p*l+E*a,s[2]=y*l+k*a,s[3]=b*l+P*a,s[4]=v*l-h*a,s[5]=E*l-p*a,s[6]=k*l-y*a,s[7]=P*l-b*a,s},n.rotateZ$1=function(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b+l*y,s[1]=l*b-a*y,s[2]=h*b+p*y,s[3]=p*b-h*y,s},n.scale=Do,n.scale$1=xg,n.scale$2=Li,n.scaleAndAdd=hu,n.set=function(s,e,r,a){return s[0]=e,s[1]=r,s[2]=a,s},n.setCacheLimits=function(s,e){xt=s,Jt=e},n.setColumn=function(s,e,r){s[4*e+0]=r[0],s[4*e+1]=r[1],s[4*e+2]=r[2],s[4*e+3]=r[3]},n.setRTLTextPlugin=function(s,e,r=!1){if(u===ru||u===iu||u===nu)throw new Error("setRTLTextPlugin cannot be called multiple times.");i=sn.resolveURL(s),u=ru,Da=e,m(),r||j()},n.smoothstep=Os,n.spec=We,n.squaredLength=function(s){var e=s[0],r=s[1],a=s[2];return e*e+r*r+a*a},n.storeAuthState=function(s,e){e?Hr.add(s):Hr.delete(s)},n.sub=xn,n.subtract=Zm,n.symbolSize=hw,n.tileAABB=function(s,e,r,a,l,h,p,y,b){if(b.name==="globe")return nv(s,e,new hh(r,a,l));const v=Uo({z:r,x:a,y:l},b);return new ri([(h+v.x/v.scale)*e,e*(v.y/v.scale),p],[(h+v.x2/v.scale)*e,e*(v.y2/v.scale),y])},n.tileCornersToBounds=Yd,n.tileTransform=Uo,n.transformMat3=function(s,e,r){var a=e[0],l=e[1],h=e[2];return s[0]=a*r[0]+l*r[3]+h*r[6],s[1]=a*r[1]+l*r[4]+h*r[7],s[2]=a*r[2]+l*r[5]+h*r[8],s},n.transformMat4=Ys,n.transformMat4$1=Lo,n.transformQuat=gg,n.transitionTileAABBinECEF=Eg,n.translate=lu,n.transpose=function(s,e){if(s===e){var r=e[1],a=e[2],l=e[5];s[1]=e[3],s[2]=e[6],s[3]=r,s[5]=e[7],s[6]=a,s[7]=l}else s[0]=e[0],s[1]=e[3],s[2]=e[6],s[3]=e[1],s[4]=e[4],s[5]=e[7],s[6]=e[2],s[7]=e[5],s[8]=e[8];return s},n.triggerPluginCompletionEvent=o,n.uniqueId=Fr,n.updateGlobeVertexNormal=function(s,e,r,a,l){const h=5*e+2;s.float32[h+0]=r,s.float32[h+1]=a,s.float32[h+2]=l},n.validateCustomStyleLayer=function(s){const e=[],r=s.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateFilter=s=>wi(Co(s)),n.validateFog=s=>wi(Bd(s)),n.validateLayer=s=>wi(Rd(s)),n.validateLight=s=>wi(Fd(s)),n.validateSource=s=>wi(Od(s)),n.validateStyle=Vd,n.validateTerrain=s=>wi(Jc(s)),n.values=mr,n.vectorTile=ch,n.version=z,n.warnOnce=As,n.window=M,n.wrap=ns}),T(["./shared"],function(n){function M(he){if(typeof he=="number"||typeof he=="boolean"||typeof he=="string"||he==null)return JSON.stringify(he);if(Array.isArray(he)){let Z="[";for(const ce of he)Z+=`${M(ce)},`;return`${Z}]`}let q="{";for(const Z of Object.keys(he).sort())q+=`${Z}:${M(he[Z])},`;return`${q}}`}function z(he){let q="";for(const Z of n.refProperties)q+=`/${M(he[Z])}`;return q}class V{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q){this._layerConfigs={},this._layers={},this.update(q,[])}update(q,Z){for(const ye of q)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=n.createStyleLayer(ye)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of Z)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ce=function(ye,Se){const Re={};for(let Ne=0;Ne<ye.length;Ne++){const $e=Se&&Se[ye[Ne].id]||z(ye[Ne]);Se&&(Se[ye[Ne].id]=$e);let mt=Re[$e];mt||(mt=Re[$e]=[]),mt.push(ye[Ne])}const Le=[];for(const Ne in Re)Le.push(Re[Ne]);return Le}(n.values(this._layerConfigs),this.keyCache);for(const ye of ce){const Se=ye.map(bt=>this._layers[bt.id]),Re=Se[0];if(Re.visibility==="none")continue;const Le=Re.source||"";let Ne=this.familiesBySource[Le];Ne||(Ne=this.familiesBySource[Le]={});const $e=Re.sourceLayer||"_geojsonTileLayer";let mt=Ne[$e];mt||(mt=Ne[$e]=[]),mt.push(Se)}}}class U{loadTile(q,Z){const{uid:ce,encoding:ye,rawImageData:Se,padding:Re,buildQuadTree:Le}=q,Ne=n.window.ImageBitmap&&Se instanceof n.window.ImageBitmap?this.getImageData(Se,Re):Se;Z(null,new n.DEMData(ce,Ne,ye,Re<1,Le))}getImageData(q,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const ce=this.offscreenCanvasContext.getImageData(-Z,-Z,q.width+2*Z,q.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}function G(he,q){if(he.length!==0){W(he[0],q);for(var Z=1;Z<he.length;Z++)W(he[Z],!q)}}function W(he,q){for(var Z=0,ce=0,ye=0,Se=he.length,Re=Se-1;ye<Se;Re=ye++){var Le=(he[ye][0]-he[Re][0])*(he[Re][1]+he[ye][1]),Ne=Z+Le;ce+=Math.abs(Z)>=Math.abs(Le)?Z-Ne+Le:Le-Ne+Z,Z=Ne}Z+ce>=0!=!!q&&he.reverse()}var $=n.getDefaultExportFromCjs(function he(q,Z){var ce,ye=q&&q.type;if(ye==="FeatureCollection")for(ce=0;ce<q.features.length;ce++)he(q.features[ce],Z);else if(ye==="GeometryCollection")for(ce=0;ce<q.geometries.length;ce++)he(q.geometries[ce],Z);else if(ye==="Feature")he(q.geometry,Z);else if(ye==="Polygon")G(q.coordinates,Z);else if(ye==="MultiPolygon")for(ce=0;ce<q.coordinates.length;ce++)G(q.coordinates[ce],Z);return q});const K=n.VectorTileFeature.prototype.toGeoJSON;var ue={exports:{}},re=n.pointGeometry,te=n.vectorTile.VectorTileFeature,je=me;function me(he,q){this.options=q||{},this.features=he,this.length=he.length}function Ce(he,q){this.id=typeof he.id=="number"?he.id:void 0,this.type=he.type,this.rawGeometry=he.type===1?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=q||4096}me.prototype.feature=function(he){return new Ce(this.features[he],this.options.extent)},Ce.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var q=0;q<he.length;q++){for(var Z=he[q],ce=[],ye=0;ye<Z.length;ye++)ce.push(new re(Z[ye][0],Z[ye][1]));this.geometry.push(ce)}return this.geometry},Ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,q=1/0,Z=-1/0,ce=1/0,ye=-1/0,Se=0;Se<he.length;Se++)for(var Re=he[Se],Le=0;Le<Re.length;Le++){var Ne=Re[Le];q=Math.min(q,Ne.x),Z=Math.max(Z,Ne.x),ce=Math.min(ce,Ne.y),ye=Math.max(ye,Ne.y)}return[q,ce,Z,ye]},Ce.prototype.toGeoJSON=te.prototype.toGeoJSON;var Ae=n.pbf,fe=je;function Ie(he){var q=new Ae;return function(Z,ce){for(var ye in Z.layers)ce.writeMessage(3,Ee,Z.layers[ye])}(he,q),q.finish()}function Ee(he,q){var Z;q.writeVarintField(15,he.version||1),q.writeStringField(1,he.name||""),q.writeVarintField(5,he.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<he.length;Z++)ce.feature=he.feature(Z),q.writeMessage(2,tt,ce);var ye=ce.keys;for(Z=0;Z<ye.length;Z++)q.writeStringField(3,ye[Z]);var Se=ce.values;for(Z=0;Z<Se.length;Z++)q.writeMessage(4,yt,Se[Z])}function tt(he,q){var Z=he.feature;Z.id!==void 0&&q.writeVarintField(1,Z.id),q.writeMessage(2,Pe,he),q.writeVarintField(3,Z.type),q.writeMessage(4,gt,Z)}function Pe(he,q){var Z=he.feature,ce=he.keys,ye=he.values,Se=he.keycache,Re=he.valuecache;for(var Le in Z.properties){var Ne=Z.properties[Le],$e=Se[Le];if(Ne!==null){$e===void 0&&(ce.push(Le),Se[Le]=$e=ce.length-1),q.writeVarint($e);var mt=typeof Ne;mt!=="string"&&mt!=="boolean"&&mt!=="number"&&(Ne=JSON.stringify(Ne));var bt=mt+":"+Ne,ut=Re[bt];ut===void 0&&(ye.push(Ne),Re[bt]=ut=ye.length-1),q.writeVarint(ut)}}}function Te(he,q){return(q<<3)+(7&he)}function rt(he){return he<<1^he>>31}function gt(he,q){for(var Z=he.loadGeometry(),ce=he.type,ye=0,Se=0,Re=Z.length,Le=0;Le<Re;Le++){var Ne=Z[Le],$e=1;ce===1&&($e=Ne.length),q.writeVarint(Te(1,$e));for(var mt=ce===3?Ne.length-1:Ne.length,bt=0;bt<mt;bt++){bt===1&&ce!==1&&q.writeVarint(Te(2,mt-1));var ut=Ne[bt].x-ye,Wt=Ne[bt].y-Se;q.writeVarint(rt(ut)),q.writeVarint(rt(Wt)),ye+=ut,Se+=Wt}ce===3&&q.writeVarint(Te(7,1))}}function yt(he,q){var Z=typeof he;Z==="string"?q.writeStringField(1,he):Z==="boolean"?q.writeBooleanField(7,he):Z==="number"&&(he%1!=0?q.writeDoubleField(3,he):he<0?q.writeSVarintField(6,he):q.writeVarintField(5,he))}ue.exports=Ie,ue.exports.fromVectorTileJs=Ie,ue.exports.fromGeojsonVt=function(he,q){q=q||{};var Z={};for(var ce in he)Z[ce]=new fe(he[ce].features,q),Z[ce].name=ce,Z[ce].version=q.version,Z[ce].extent=q.extent;return Ie({layers:Z})},ue.exports.GeoJSONWrapper=fe;var pt=n.getDefaultExportFromCjs(ue.exports);const ft={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},wt=Math.fround||(Os=new Float32Array(1),he=>(Os[0]=+he,Os[0]));var Os;const ns=3,_s=5,mr=6;class Ut{constructor(q){this.options=Object.assign(Object.create(ft),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:Z,minZoom:ce,maxZoom:ye}=this.options;Z&&console.time("total time");const Se=`prepare ${q.length} points`;Z&&console.time(Se),this.points=q;const Re=[];for(let Ne=0;Ne<q.length;Ne++){const $e=q[Ne];if(!$e.geometry)continue;const[mt,bt]=$e.geometry.coordinates,ut=wt(jr(mt)),Wt=wt(fr(bt));Re.push(ut,Wt,1/0,Ne,-1,1),this.options.reduce&&Re.push(0)}let Le=this.trees[ye+1]=this._createTree(Re);Z&&console.timeEnd(Se);for(let Ne=ye;Ne>=ce;Ne--){const $e=+Date.now();Le=this.trees[Ne]=this._createTree(this._cluster(Le,Ne)),Z&&console.log("z%d: %d clusters in %dms",Ne,Le.numItems,+Date.now()-$e)}return Z&&console.timeEnd("total time"),this}getClusters(q,Z){let ce=((q[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,q[1]));let Se=q[2]===180?180:((q[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)ce=-180,Se=180;else if(ce>Se){const bt=this.getClusters([ce,ye,180,Re],Z),ut=this.getClusters([-180,ye,Se,Re],Z);return bt.concat(ut)}const Le=this.trees[this._limitZoom(Z)],Ne=Le.range(jr(ce),fr(Re),jr(Se),fr(ye)),$e=Le.data,mt=[];for(const bt of Ne){const ut=this.stride*bt;mt.push($e[ut+_s]>1?pr($e,ut,this.clusterProps):this.points[$e[ut+ns]])}return mt}getChildren(q){const Z=this._getOriginId(q),ce=this._getOriginZoom(q),ye="No cluster with the specified id.",Se=this.trees[ce];if(!Se)throw new Error(ye);const Re=Se.data;if(Z*this.stride>=Re.length)throw new Error(ye);const Le=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Ne=Se.within(Re[Z*this.stride],Re[Z*this.stride+1],Le),$e=[];for(const mt of Ne){const bt=mt*this.stride;Re[bt+4]===q&&$e.push(Re[bt+_s]>1?pr(Re,bt,this.clusterProps):this.points[Re[bt+ns]])}if($e.length===0)throw new Error(ye);return $e}getLeaves(q,Z,ce){const ye=[];return this._appendLeaves(ye,q,Z=Z||10,ce=ce||0,0),ye}getTile(q,Z,ce){const ye=this.trees[this._limitZoom(q)],Se=Math.pow(2,q),{extent:Re,radius:Le}=this.options,Ne=Le/Re,$e=(ce-Ne)/Se,mt=(ce+1+Ne)/Se,bt={features:[]};return this._addTileFeatures(ye.range((Z-Ne)/Se,$e,(Z+1+Ne)/Se,mt),ye.data,Z,ce,Se,bt),Z===0&&this._addTileFeatures(ye.range(1-Ne/Se,$e,1,mt),ye.data,Se,ce,Se,bt),Z===Se-1&&this._addTileFeatures(ye.range(0,$e,Ne/Se,mt),ye.data,-1,ce,Se,bt),bt.features.length?bt:null}getClusterExpansionZoom(q){let Z=this._getOriginZoom(q)-1;for(;Z<=this.options.maxZoom;){const ce=this.getChildren(q);if(Z++,ce.length!==1)break;q=ce[0].properties.cluster_id}return Z}_appendLeaves(q,Z,ce,ye,Se){const Re=this.getChildren(Z);for(const Le of Re){const Ne=Le.properties;if(Ne&&Ne.cluster?Se+Ne.point_count<=ye?Se+=Ne.point_count:Se=this._appendLeaves(q,Ne.cluster_id,ce,ye,Se):Se<ye?Se++:q.push(Le),q.length===ce)break}return Se}_createTree(q){const Z=new n.KDBush(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<q.length;ce+=this.stride)Z.add(q[ce],q[ce+1]);return Z.finish(),Z.data=q,Z}_addTileFeatures(q,Z,ce,ye,Se,Re){for(const Le of q){const Ne=Le*this.stride,$e=Z[Ne+_s]>1;let mt,bt,ut;if($e)mt=Fr(Z,Ne,this.clusterProps),bt=Z[Ne],ut=Z[Ne+1];else{const Ht=this.points[Z[Ne+ns]];mt=Ht.properties;const[es,os]=Ht.geometry.coordinates;bt=jr(es),ut=fr(os)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(bt*Se-ce)),Math.round(this.options.extent*(ut*Se-ye))]],tags:mt};let Yt;Yt=$e||this.options.generateId?Z[Ne+ns]:this.points[Z[Ne+ns]].id,Yt!==void 0&&(Wt.id=Yt),Re.features.push(Wt)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,Z){const{radius:ce,extent:ye,reduce:Se,minPoints:Re}=this.options,Le=ce/(ye*Math.pow(2,Z)),Ne=q.data,$e=[],mt=this.stride;for(let bt=0;bt<Ne.length;bt+=mt){if(Ne[bt+2]<=Z)continue;Ne[bt+2]=Z;const ut=Ne[bt],Wt=Ne[bt+1],Yt=q.within(Ne[bt],Ne[bt+1],Le),Ht=Ne[bt+_s];let es=Ht;for(const os of Yt){const Vs=os*mt;Ne[Vs+2]>Z&&(es+=Ne[Vs+_s])}if(es>Ht&&es>=Re){let os,Vs=ut*Ht,rr=Wt*Ht,Ur=-1;const gr=((bt/mt|0)<<5)+(Z+1)+this.points.length;for(const Fi of Yt){const Nr=Fi*mt;if(Ne[Nr+2]<=Z)continue;Ne[Nr+2]=Z;const Hr=Ne[Nr+_s];Vs+=Ne[Nr]*Hr,rr+=Ne[Nr+1]*Hr,Ne[Nr+4]=gr,Se&&(os||(os=this._map(Ne,bt,!0),Ur=this.clusterProps.length,this.clusterProps.push(os)),Se(os,this._map(Ne,Nr)))}Ne[bt+4]=gr,$e.push(Vs/es,rr/es,1/0,gr,-1,es),Se&&$e.push(Ur)}else{for(let os=0;os<mt;os++)$e.push(Ne[bt+os]);if(es>1)for(const os of Yt){const Vs=os*mt;if(!(Ne[Vs+2]<=Z)){Ne[Vs+2]=Z;for(let rr=0;rr<mt;rr++)$e.push(Ne[Vs+rr])}}}}return $e}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,Z,ce){if(q[Z+_s]>1){const Re=this.clusterProps[q[Z+mr]];return ce?Object.assign({},Re):Re}const ye=this.points[q[Z+ns]].properties,Se=this.options.map(ye);return ce&&Se===ye?Object.assign({},Se):Se}}function pr(he,q,Z){return{type:"Feature",id:he[q+ns],properties:Fr(he,q,Z),geometry:{type:"Point",coordinates:[(ce=he[q],360*(ce-.5)),Br(he[q+1])]}};var ce}function Fr(he,q,Z){const ce=he[q+_s],ye=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,Se=he[q+mr],Re=Se===-1?{}:Object.assign({},Z[Se]);return Object.assign(Re,{cluster:!0,cluster_id:he[q+ns],point_count:ce,point_count_abbreviated:ye})}function jr(he){return he/360+.5}function fr(he){const q=Math.sin(he*Math.PI/180),Z=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return Z<0?0:Z>1?1:Z}function Br(he){const q=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function _r(he,q,Z,ce){for(var ye,Se=ce,Re=Z-q>>1,Le=Z-q,Ne=he[q],$e=he[q+1],mt=he[Z],bt=he[Z+1],ut=q+3;ut<Z;ut+=3){var Wt=Jr(he[ut],he[ut+1],Ne,$e,mt,bt);if(Wt>Se)ye=ut,Se=Wt;else if(Wt===Se){var Yt=Math.abs(ut-Re);Yt<Le&&(ye=ut,Le=Yt)}}Se>ce&&(ye-q>3&&_r(he,q,ye,ce),he[ye+2]=Se,Z-ye>3&&_r(he,ye,Z,ce))}function Jr(he,q,Z,ce,ye,Se){var Re=ye-Z,Le=Se-ce;if(Re!==0||Le!==0){var Ne=((he-Z)*Re+(q-ce)*Le)/(Re*Re+Le*Le);Ne>1?(Z=ye,ce=Se):Ne>0&&(Z+=Re*Ne,ce+=Le*Ne)}return(Re=he-Z)*Re+(Le=q-ce)*Le}function Qt(he,q,Z,ce){var ye={id:he===void 0?null:he,type:q,geometry:Z,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Se){var Re=Se.geometry,Le=Se.type;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")gi(Se,Re);else if(Le==="Polygon"||Le==="MultiLineString")for(var Ne=0;Ne<Re.length;Ne++)gi(Se,Re[Ne]);else if(Le==="MultiPolygon")for(Ne=0;Ne<Re.length;Ne++)for(var $e=0;$e<Re[Ne].length;$e++)gi(Se,Re[Ne][$e])}(ye),ye}function gi(he,q){for(var Z=0;Z<q.length;Z+=3)he.minX=Math.min(he.minX,q[Z]),he.minY=Math.min(he.minY,q[Z+1]),he.maxX=Math.max(he.maxX,q[Z]),he.maxY=Math.max(he.maxY,q[Z+1])}function br(he,q,Z,ce){if(q.geometry){var ye=q.geometry.coordinates,Se=q.geometry.type,Re=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Le=[],Ne=q.id;if(Z.promoteId?Ne=q.properties[Z.promoteId]:Z.generateId&&(Ne=ce||0),Se==="Point")Mi(ye,Le);else if(Se==="MultiPoint")for(var $e=0;$e<ye.length;$e++)Mi(ye[$e],Le);else if(Se==="LineString")As(ye,Le,Re,!1);else if(Se==="MultiLineString"){if(Z.lineMetrics){for($e=0;$e<ye.length;$e++)As(ye[$e],Le=[],Re,!1),he.push(Qt(Ne,"LineString",Le,q.properties));return}Ir(ye,Le,Re,!1)}else if(Se==="Polygon")Ir(ye,Le,Re,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for($e=0;$e<q.geometry.geometries.length;$e++)br(he,{id:Ne,geometry:q.geometry.geometries[$e],properties:q.properties},Z,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for($e=0;$e<ye.length;$e++){var mt=[];Ir(ye[$e],mt,Re,!0),Le.push(mt)}}he.push(Qt(Ne,Se,Le,q.properties))}}function Mi(he,q){q.push(Zn(he[0])),q.push(Zr(he[1])),q.push(0)}function As(he,q,Z,ce){for(var ye,Se,Re=0,Le=0;Le<he.length;Le++){var Ne=Zn(he[Le][0]),$e=Zr(he[Le][1]);q.push(Ne),q.push($e),q.push(0),Le>0&&(Re+=ce?(ye*$e-Ne*Se)/2:Math.sqrt(Math.pow(Ne-ye,2)+Math.pow($e-Se,2))),ye=Ne,Se=$e}var mt=q.length-3;q[2]=1,_r(q,0,mt,Z),q[mt+2]=1,q.size=Math.abs(Re),q.start=0,q.end=q.size}function Ir(he,q,Z,ce){for(var ye=0;ye<he.length;ye++){var Se=[];As(he[ye],Se,Z,ce),q.push(Se)}}function Zn(he){return he/360+.5}function Zr(he){var q=Math.sin(he*Math.PI/180),Z=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return Z<0?0:Z>1?1:Z}function we(he,q,Z,ce,ye,Se,Re,Le){if(ce/=q,Se>=(Z/=q)&&Re<ce)return he;if(Re<Z||Se>=ce)return null;for(var Ne=[],$e=0;$e<he.length;$e++){var mt=he[$e],bt=mt.geometry,ut=mt.type,Wt=ye===0?mt.minX:mt.minY,Yt=ye===0?mt.maxX:mt.maxY;if(Wt>=Z&&Yt<ce)Ne.push(mt);else if(!(Yt<Z||Wt>=ce)){var Ht=[];if(ut==="Point"||ut==="MultiPoint")Ge(bt,Ht,Z,ce,ye);else if(ut==="LineString")et(bt,Ht,Z,ce,ye,!1,Le.lineMetrics);else if(ut==="MultiLineString")Nt(bt,Ht,Z,ce,ye,!1);else if(ut==="Polygon")Nt(bt,Ht,Z,ce,ye,!0);else if(ut==="MultiPolygon")for(var es=0;es<bt.length;es++){var os=[];Nt(bt[es],os,Z,ce,ye,!0),os.length&&Ht.push(os)}if(Ht.length){if(Le.lineMetrics&&ut==="LineString"){for(es=0;es<Ht.length;es++)Ne.push(Qt(mt.id,ut,Ht[es],mt.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(Ht.length===1?(ut="LineString",Ht=Ht[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=Ht.length===3?"Point":"MultiPoint"),Ne.push(Qt(mt.id,ut,Ht,mt.tags))}}}return Ne.length?Ne:null}function Ge(he,q,Z,ce,ye){for(var Se=0;Se<he.length;Se+=3){var Re=he[Se+ye];Re>=Z&&Re<=ce&&(q.push(he[Se]),q.push(he[Se+1]),q.push(he[Se+2]))}}function et(he,q,Z,ce,ye,Se,Re){for(var Le,Ne,$e=kt(he),mt=ye===0?xt:Jt,bt=he.start,ut=0;ut<he.length-3;ut+=3){var Wt=he[ut],Yt=he[ut+1],Ht=he[ut+2],es=he[ut+3],os=he[ut+4],Vs=ye===0?Wt:Yt,rr=ye===0?es:os,Ur=!1;Re&&(Le=Math.sqrt(Math.pow(Wt-es,2)+Math.pow(Yt-os,2))),Vs<Z?rr>Z&&(Ne=mt($e,Wt,Yt,es,os,Z),Re&&($e.start=bt+Le*Ne)):Vs>ce?rr<ce&&(Ne=mt($e,Wt,Yt,es,os,ce),Re&&($e.start=bt+Le*Ne)):De($e,Wt,Yt,Ht),rr<Z&&Vs>=Z&&(Ne=mt($e,Wt,Yt,es,os,Z),Ur=!0),rr>ce&&Vs<=ce&&(Ne=mt($e,Wt,Yt,es,os,ce),Ur=!0),!Se&&Ur&&(Re&&($e.end=bt+Le*Ne),q.push($e),$e=kt(he)),Re&&(bt+=Le)}var gr=he.length-3;Wt=he[gr],Yt=he[gr+1],Ht=he[gr+2],(Vs=ye===0?Wt:Yt)>=Z&&Vs<=ce&&De($e,Wt,Yt,Ht),gr=$e.length-3,Se&&gr>=3&&($e[gr]!==$e[0]||$e[gr+1]!==$e[1])&&De($e,$e[0],$e[1],$e[2]),$e.length&&q.push($e)}function kt(he){var q=[];return q.size=he.size,q.start=he.start,q.end=he.end,q}function Nt(he,q,Z,ce,ye,Se){for(var Re=0;Re<he.length;Re++)et(he[Re],q,Z,ce,ye,Se,!1)}function De(he,q,Z,ce){he.push(q),he.push(Z),he.push(ce)}function xt(he,q,Z,ce,ye,Se){var Re=(Se-q)/(ce-q);return he.push(Se),he.push(Z+(ye-Z)*Re),he.push(1),Re}function Jt(he,q,Z,ce,ye,Se){var Re=(Se-Z)/(ye-Z);return he.push(q+(ce-q)*Re),he.push(Se),he.push(1),Re}function qt(he,q){for(var Z=[],ce=0;ce<he.length;ce++){var ye,Se=he[ce],Re=Se.type;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")ye=bs(Se.geometry,q);else if(Re==="MultiLineString"||Re==="Polygon"){ye=[];for(var Le=0;Le<Se.geometry.length;Le++)ye.push(bs(Se.geometry[Le],q))}else if(Re==="MultiPolygon")for(ye=[],Le=0;Le<Se.geometry.length;Le++){for(var Ne=[],$e=0;$e<Se.geometry[Le].length;$e++)Ne.push(bs(Se.geometry[Le][$e],q));ye.push(Ne)}Z.push(Qt(Se.id,Re,ye,Se.tags))}return Z}function bs(he,q){var Z=[];Z.size=he.size,he.start!==void 0&&(Z.start=he.start,Z.end=he.end);for(var ce=0;ce<he.length;ce+=3)Z.push(he[ce]+q,he[ce+1],he[ce+2]);return Z}function sr(he,q){if(he.transformed)return he;var Z,ce,ye,Se=1<<he.z,Re=he.x,Le=he.y;for(Z=0;Z<he.features.length;Z++){var Ne=he.features[Z],$e=Ne.geometry,mt=Ne.type;if(Ne.geometry=[],mt===1)for(ce=0;ce<$e.length;ce+=2)Ne.geometry.push(Ls($e[ce],$e[ce+1],q,Se,Re,Le));else for(ce=0;ce<$e.length;ce++){var bt=[];for(ye=0;ye<$e[ce].length;ye+=2)bt.push(Ls($e[ce][ye],$e[ce][ye+1],q,Se,Re,Le));Ne.geometry.push(bt)}}return he.transformed=!0,he}function Ls(he,q,Z,ce,ye,Se){return[Math.round(Z*(he*ce-ye)),Math.round(Z*(q*ce-Se))]}function xi(he,q,Z,ce,ye){for(var Se=q===ye.maxZoom?0:ye.tolerance/((1<<q)*ye.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:ce,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Le=0;Le<he.length;Le++){Re.numFeatures++,Wr(Re,he[Le],Se,ye);var Ne=he[Le].minX,$e=he[Le].minY,mt=he[Le].maxX,bt=he[Le].maxY;Ne<Re.minX&&(Re.minX=Ne),$e<Re.minY&&(Re.minY=$e),mt>Re.maxX&&(Re.maxX=mt),bt>Re.maxY&&(Re.maxY=bt)}return Re}function Wr(he,q,Z,ce){var ye=q.geometry,Se=q.type,Re=[];if(Se==="Point"||Se==="MultiPoint")for(var Le=0;Le<ye.length;Le+=3)Re.push(ye[Le]),Re.push(ye[Le+1]),he.numPoints++,he.numSimplified++;else if(Se==="LineString")Dr(Re,ye,he,Z,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(Le=0;Le<ye.length;Le++)Dr(Re,ye[Le],he,Z,Se==="Polygon",Le===0);else if(Se==="MultiPolygon")for(var Ne=0;Ne<ye.length;Ne++){var $e=ye[Ne];for(Le=0;Le<$e.length;Le++)Dr(Re,$e[Le],he,Z,!0,Le===0)}if(Re.length){var mt=q.tags||null;if(Se==="LineString"&&ce.lineMetrics){for(var bt in mt={},q.tags)mt[bt]=q.tags[bt];mt.mapbox_clip_start=ye.start/ye.size,mt.mapbox_clip_end=ye.end/ye.size}var ut={geometry:Re,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:mt};q.id!==null&&(ut.id=q.id),he.features.push(ut)}}function Dr(he,q,Z,ce,ye,Se){var Re=ce*ce;if(ce>0&&q.size<(ye?Re:ce))Z.numPoints+=q.length/3;else{for(var Le=[],Ne=0;Ne<q.length;Ne+=3)(ce===0||q[Ne+2]>Re)&&(Z.numSimplified++,Le.push(q[Ne]),Le.push(q[Ne+1])),Z.numPoints++;ye&&function($e,mt){for(var bt=0,ut=0,Wt=$e.length,Yt=Wt-2;ut<Wt;Yt=ut,ut+=2)bt+=($e[ut]-$e[Yt])*($e[ut+1]+$e[Yt+1]);if(bt>0===mt)for(ut=0,Wt=$e.length;ut<Wt/2;ut+=2){var Ht=$e[ut],es=$e[ut+1];$e[ut]=$e[Wt-2-ut],$e[ut+1]=$e[Wt-1-ut],$e[Wt-2-ut]=Ht,$e[Wt-1-ut]=es}}(Le,Se),he.push(Le)}}function yi(he,q){var Z=(q=this.options=function(ye,Se){for(var Re in Se)ye[Re]=Se[Re];return ye}(Object.create(this.options),q)).debug;if(Z&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var ce=function(ye,Se){var Re=[];if(ye.type==="FeatureCollection")for(var Le=0;Le<ye.features.length;Le++)br(Re,ye.features[Le],Se,Le);else br(Re,ye.type==="Feature"?ye:{geometry:ye},Se);return Re}(he,q);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(ye,Se){var Re=Se.buffer/Se.extent,Le=ye,Ne=we(ye,1,-1-Re,Re,0,-1,2,Se),$e=we(ye,1,1-Re,2+Re,0,-1,2,Se);return(Ne||$e)&&(Le=we(ye,1,-Re,1+Re,0,-1,2,Se)||[],Ne&&(Le=qt(Ne,1).concat(Le)),$e&&(Le=Le.concat(qt($e,-1)))),Le}(ce,q),ce.length&&this.splitTile(ce,0,0,0),Z&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Oi(he,q,Z){return 32*((1<<he)*Z+q)+he}function en(he,q){const Z=he.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const ce=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!ce)return q(null,null);const ye=new class{constructor(Re){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=Re.length,this._features=Re}feature(Re){return new class{constructor(Le){this._feature=Le,this.extent=n.EXTENT,this.type=Le.type,this.properties=Le.tags,"id"in Le&&!isNaN(Le.id)&&(this.id=parseInt(Le.id,10))}loadGeometry(){if(this._feature.type===1){const Le=[];for(const Ne of this._feature.geometry)Le.push([new n.Point(Ne[0],Ne[1])]);return Le}{const Le=[];for(const Ne of this._feature.geometry){const $e=[];for(const mt of Ne)$e.push(new n.Point(mt[0],mt[1]));Le.push($e)}return Le}}toGeoJSON(Le,Ne,$e){return K.call(this,Le,Ne,$e)}}(this._features[Re])}}(ce.features);let Se=pt(ye);Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),q(null,{vectorTile:ye,rawData:Se.buffer})}yi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yi.prototype.splitTile=function(he,q,Z,ce,ye,Se,Re){for(var Le=[he,q,Z,ce],Ne=this.options,$e=Ne.debug;Le.length;){ce=Le.pop(),Z=Le.pop(),q=Le.pop(),he=Le.pop();var mt=1<<q,bt=Oi(q,Z,ce),ut=this.tiles[bt];if(!ut&&($e>1&&console.time("creation"),ut=this.tiles[bt]=xi(he,q,Z,ce,Ne),this.tileCoords.push({z:q,x:Z,y:ce}),$e)){$e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,Z,ce,ut.numFeatures,ut.numPoints,ut.numSimplified),console.timeEnd("creation"));var Wt="z"+q;this.stats[Wt]=(this.stats[Wt]||0)+1,this.total++}if(ut.source=he,ye){if(q===Ne.maxZoom||q===ye)continue;var Yt=1<<ye-q;if(Z!==Math.floor(Se/Yt)||ce!==Math.floor(Re/Yt))continue}else if(q===Ne.indexMaxZoom||ut.numPoints<=Ne.indexMaxPoints)continue;if(ut.source=null,he.length!==0){$e>1&&console.time("clipping");var Ht,es,os,Vs,rr,Ur,gr=.5*Ne.buffer/Ne.extent,Fi=.5-gr,Nr=.5+gr,Hr=1+gr;Ht=es=os=Vs=null,rr=we(he,mt,Z-gr,Z+Nr,0,ut.minX,ut.maxX,Ne),Ur=we(he,mt,Z+Fi,Z+Hr,0,ut.minX,ut.maxX,Ne),he=null,rr&&(Ht=we(rr,mt,ce-gr,ce+Nr,1,ut.minY,ut.maxY,Ne),es=we(rr,mt,ce+Fi,ce+Hr,1,ut.minY,ut.maxY,Ne),rr=null),Ur&&(os=we(Ur,mt,ce-gr,ce+Nr,1,ut.minY,ut.maxY,Ne),Vs=we(Ur,mt,ce+Fi,ce+Hr,1,ut.minY,ut.maxY,Ne),Ur=null),$e>1&&console.timeEnd("clipping"),Le.push(Ht||[],q+1,2*Z,2*ce),Le.push(es||[],q+1,2*Z,2*ce+1),Le.push(os||[],q+1,2*Z+1,2*ce),Le.push(Vs||[],q+1,2*Z+1,2*ce+1)}}},yi.prototype.getTile=function(he,q,Z){var ce=this.options,ye=ce.extent,Se=ce.debug;if(he<0||he>24)return null;var Re=1<<he,Le=Oi(he,q=(q%Re+Re)%Re,Z);if(this.tiles[Le])return sr(this.tiles[Le],ye);Se>1&&console.log("drilling down to z%d-%d-%d",he,q,Z);for(var Ne,$e=he,mt=q,bt=Z;!Ne&&$e>0;)$e--,mt=Math.floor(mt/2),bt=Math.floor(bt/2),Ne=this.tiles[Oi($e,mt,bt)];return Ne&&Ne.source?(Se>1&&console.log("found parent tile z%d-%d-%d",$e,mt,bt),Se>1&&console.time("drilling down"),this.splitTile(Ne.source,$e,mt,bt,he,q,Z),Se>1&&console.timeEnd("drilling down"),this.tiles[Le]?sr(this.tiles[Le],ye):null):null};class tn extends n.VectorTileWorkerSource{constructor(q,Z,ce,ye,Se){super(q,Z,ce,ye,en),Se&&(this.loadGeoJSON=Se)}loadData(q,Z){const ce=q&&q.request,ye=ce&&ce.collectResourceTiming;this.loadGeoJSON(q,(Se,Re)=>{if(Se||!Re)return Z(Se);if(typeof Re!="object")return Z(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{$(Re,!0);try{if(q.filter){const Ne=n.createExpression(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ne.result==="error")throw new Error(Ne.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));Re={type:"FeatureCollection",features:Re.features.filter(mt=>Ne.value.evaluate({zoom:0},mt))}}this._geoJSONIndex=q.cluster?new Ut(function({superclusterOptions:Ne,clusterProperties:$e}){if(!$e||!Ne)return Ne;const mt={},bt={},ut={accumulated:null,zoom:0},Wt={properties:null},Yt=Object.keys($e);for(const Ht of Yt){const[es,os]=$e[Ht],Vs=n.createExpression(os),rr=n.createExpression(typeof es=="string"?[es,["accumulated"],["get",Ht]]:es);mt[Ht]=Vs.value,bt[Ht]=rr.value}return Ne.map=Ht=>{Wt.properties=Ht;const es={};for(const os of Yt)es[os]=mt[os].evaluate(ut,Wt);return es},Ne.reduce=(Ht,es)=>{Wt.properties=es;for(const os of Yt)ut.accumulated=Ht[os],Ht[os]=bt[os].evaluate(ut,Wt)},Ne}(q)).load(Re.features):function(Ne,$e){return new yi(Ne,$e)}(Re,q.geojsonVtOptions)}catch(Ne){return Z(Ne)}this.loaded={};const Le={};if(ye){const Ne=n.getPerformanceMeasurement(ce);Ne&&(Le.resourceTiming={},Le.resourceTiming[q.source]=JSON.parse(JSON.stringify(Ne)))}Z(null,Le)}})}reloadTile(q,Z){const ce=this.loaded;return ce&&ce[q.uid]?super.reloadTile(q,Z):this.loadTile(q,Z)}loadGeoJSON(q,Z){if(q.request)n.getJSON(q.request,Z);else{if(typeof q.data!="string")return Z(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(q.data))}catch{return Z(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(ce){Z(ce)}}getClusterChildren(q,Z){try{Z(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(ce){Z(ce)}}getClusterLeaves(q,Z){try{Z(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(ce){Z(ce)}}}class el{constructor(q){this.self=q,this.actor=new n.Actor(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.getProjection({name:"mercator"}),this.workerSourceTypes={vector:n.VectorTileWorkerSource,geojson:tn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,ce)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=ce},this.self.registerRTLTextPlugin=Z=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=Z.applyArabicShaping,n.plugin.processBidirectionalText=Z.processBidirectionalText,n.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(q,Z,ce){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],ce()}checkIfReady(q,Z,ce){ce()}setReferrer(q,Z){this.referrer=Z}spriteLoaded(q,Z){this.isSpriteLoaded[q]=Z;for(const ce in this.workerSources[q]){const ye=this.workerSources[q][ce];for(const Se in ye)ye[Se]instanceof n.VectorTileWorkerSource&&(ye[Se].isSpriteLoaded=Z,ye[Se].fire(new n.Event("isSpriteLoaded")))}}setImages(q,Z,ce){this.availableImages[q]=Z;for(const ye in this.workerSources[q]){const Se=this.workerSources[q][ye];for(const Re in Se)Se[Re].availableImages=Z}ce()}enableTerrain(q,Z,ce){this.terrain=Z,ce()}setProjection(q,Z){this.projections[q]=n.getProjection(Z)}setLayers(q,Z,ce){this.getLayerIndex(q).replace(Z),ce()}updateLayers(q,Z,ce){this.getLayerIndex(q).update(Z.layers,Z.removedIds),ce()}loadTile(q,Z,ce){const ye=this.enableTerrain?n.extend({enableTerrain:this.terrain},Z):Z;ye.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,Z.type,Z.source).loadTile(ye,ce)}loadDEMTile(q,Z,ce){const ye=this.enableTerrain?n.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(q,Z.source).loadTile(ye,ce)}reloadTile(q,Z,ce){const ye=this.enableTerrain?n.extend({enableTerrain:this.terrain},Z):Z;ye.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,Z.type,Z.source).reloadTile(ye,ce)}abortTile(q,Z,ce){this.getWorkerSource(q,Z.type,Z.source).abortTile(Z,ce)}removeTile(q,Z,ce){this.getWorkerSource(q,Z.type,Z.source).removeTile(Z,ce)}removeSource(q,Z,ce){if(!this.workerSources[q]||!this.workerSources[q][Z.type]||!this.workerSources[q][Z.type][Z.source])return;const ye=this.workerSources[q][Z.type][Z.source];delete this.workerSources[q][Z.type][Z.source],ye.removeSource!==void 0?ye.removeSource(Z,ce):ce()}loadWorkerSource(q,Z,ce){try{this.self.importScripts(Z.url),ce()}catch(ye){ce(ye.toString())}}syncRTLPluginState(q,Z,ce){try{n.plugin.setState(Z);const ye=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);const Se=n.plugin.isParsed();ce(Se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),Se)}}catch(ye){ce(ye.toString())}}getAvailableImages(q){let Z=this.availableImages[q];return Z||(Z=[]),Z}getLayerIndex(q){let Z=this.layerIndexes[q];return Z||(Z=this.layerIndexes[q]=new V),Z}getWorkerSource(q,Z,ce){if(this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][Z]||(this.workerSources[q][Z]={}),!this.workerSources[q][Z][ce]){const ye={send:(Se,Re,Le,Ne,$e,mt)=>{this.actor.send(Se,Re,Le,q,$e,mt)},scheduler:this.actor.scheduler};this.workerSources[q][Z][ce]=new this.workerSourceTypes[Z](ye,this.getLayerIndex(q),this.getAvailableImages(q),this.isSpriteLoaded[q])}return this.workerSources[q][Z][ce]}getDEMWorkerSource(q,Z){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][Z]||(this.demWorkerSources[q][Z]=new U),this.demWorkerSources[q][Z]}enforceCacheSizeLimit(q,Z){n.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(q,Z,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new el(self)),el}),T(["./shared"],function(n){function M(u,i){if(Array.isArray(u)){if(!Array.isArray(i)||u.length!==i.length)return!1;for(let o=0;o<u.length;o++)if(!M(u[o],i[o]))return!1;return!0}if(typeof u=="object"&&u!==null&&i!==null){if(typeof i!="object"||Object.keys(u).length!==Object.keys(i).length)return!1;for(const o in u)if(!M(u[o],i[o]))return!1;return!0}return u===i}var z=V;function V(u){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,x,_=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(_);try{x=new Worker(j),m=!0}catch{m=!1}return x&&x.terminate(),URL.revokeObjectURL(j),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var x=m.getContext("2d");if(!x)return!1;var _=x.getImageData(0,0,1,1);return _&&_.width===m.width}()?(U[o=i&&i.failIfMajorPerformanceCaveat]===void 0&&(U[o]=function(m){var x,_=function(j){var S=document.createElement("canvas"),C=Object.create(V.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=j,S.getContext("webgl",C)||S.getContext("experimental-webgl",C)}(m);if(!_)return!1;try{x=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!x||_.isContextLost())&&(_.shaderSource(x,"void main() {}"),_.compileShader(x),_.getShaderParameter(x,_.COMPILE_STATUS)===!0)}(o)),U[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o}(u)}var U={};function G(u,i,o){const m=n.window.document.createElement(u);return i!==void 0&&(m.className=i),o&&o.appendChild(m),m}function W(u,i,o){const m=n.window.document.createElementNS("http://www.w3.org/2000/svg",u);for(const x of Object.keys(i))m.setAttributeNS(null,x,i[x]);return o&&o.appendChild(m),m}V.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $=n.window.document&&n.window.document.documentElement.style,K=$&&$.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ue;function re(){$&&K&&(ue=$[K],$[K]="none")}function te(){$&&K&&($[K]=ue)}function je(u){u.preventDefault(),u.stopPropagation(),n.window.removeEventListener("click",je,!0)}function me(){n.window.addEventListener("click",je,!0),n.window.setTimeout(()=>{n.window.removeEventListener("click",je,!0)},0)}function Ce(u,i){const o=u.getBoundingClientRect();return Ie(u,o,i)}function Ae(u,i){const o=u.getBoundingClientRect(),m=[];for(let x=0;x<i.length;x++)m.push(Ie(u,o,i[x]));return m}function fe(u){return n.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&n.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function Ie(u,i,o){const m=u.offsetWidth===i.width?1:u.offsetWidth/i.width;return new n.Point((o.clientX-i.left)*m,(o.clientY-i.top)*m)}function Ee(u,i){var o=i[0],m=i[1],x=i[2],_=i[3],j=o*_-x*m;return j?(u[0]=_*(j=1/j),u[1]=-m*j,u[2]=-x*j,u[3]=o*j,u):null}function tt(u){const{userImage:i}=u;return!!(i&&i.render&&i.render())&&(u.data.replace(new Uint8Array(i.data.buffer)),!0)}class Pe extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,callback:m}of this.requestors)this._notify(o,m);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,o){this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let m=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(o.content,o)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,o){if(!i)return!0;let m=0;for(const x of i){if(x[0]<m||x[1]<x[0]||o<x[1])return!1;m=x[1]}return!0}_validateContent(i,o){return!(i&&(i.length!==4||i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,o){o.version=this.images[i].version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,o){let m=!0;if(!this.isLoaded())for(const x of i)this.images[x]||(m=!1);this.isLoaded()||m?this._notify(i,o):this.requestors.push({ids:i,callback:o})}_notify(i,o){const m={};for(const x of i){this.images[x]||this.fire(new n.Event("styleimagemissing",{id:x}));const _=this.images[x];_?m[x]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:n.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,m)}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],m=this.getImage(i);if(!m)return null;if(o&&o.position.version===m.version)return o.position;if(o)o.position.version=m.version;else{const x={w:m.data.width+2,h:m.data.height+2,x:0,y:0},_=new n.ImagePosition(x,m);this.patterns[i]={bin:x,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new n.Texture(i,this.atlasImage,o.RGBA),this.atlasTexture&&this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h:m}=n.potpack(i),x=this.atlasImage;x.resize({width:o||1,height:m||1});for(const _ in this.patterns){const{bin:j}=this.patterns[_],S=j.x+1,C=j.y+1,D=this.images[_].data,I=D.width,O=D.height;n.RGBAImage.copy(D,x,{x:0,y:0},{x:S,y:C},{width:I,height:O}),n.RGBAImage.copy(D,x,{x:0,y:O-1},{x:S,y:C-1},{width:I,height:1}),n.RGBAImage.copy(D,x,{x:0,y:0},{x:S,y:C+O},{width:I,height:1}),n.RGBAImage.copy(D,x,{x:I-1,y:0},{x:S-1,y:C},{width:1,height:O}),n.RGBAImage.copy(D,x,{x:0,y:0},{x:S+I,y:C},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const m=this.images[o];tt(m)&&this.updateImage(o,m)}}}const Te=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(u,i){return function([o,m,x]){const _=n.degToRad(m+90),j=n.degToRad(x);return{x:o*Math.cos(_)*Math.sin(j),y:o*Math.sin(_)*Math.sin(j),z:o*Math.cos(j),azimuthal:m,polar:x}}(u.expression.evaluate(i))}interpolate(u,i,o){return{x:n.number(u.x,i.x,o),y:n.number(u.y,i.y,o),z:n.number(u.z,i.z,o),azimuthal:n.number(u.azimuthal,i.azimuthal,o),polar:n.number(u.polar,i.polar,o)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)});class rt extends n.Evented{constructor(i){super(),this._transitionable=new n.Transitionable(Te),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(n.validateLight,i,o))for(const m in i){const x=i[m];n.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),x):this._transitionable.setValue(m,x)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,i.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}const gt=new n.Properties({source:new n.DataConstantProperty(n.spec.terrain.source),exaggeration:new n.DataConstantProperty(n.spec.terrain.exaggeration)});let yt=class extends n.Evented{constructor(u,i){super(),this._transitionable=new n.Transitionable(gt),this.set(u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(u){for(const i in u){const o=u[i];n.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),o):this._transitionable.setValue(i,o)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}};function pt(u,i,o,m){const x=n.smoothstep(45,65,o),[_,j]=ft(u,m),S=n.length(i);let C=1-Math.min(1,Math.exp((S-_)/(j-_)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*x*u.alpha}function ft(u,i){const o=.5/Math.tan(.5*i);return[u.range[0]+o,u.range[1]+o]}const wt=new n.Properties({range:new n.DataConstantProperty(n.spec.fog.range),color:new n.DataConstantProperty(n.spec.fog.color),"high-color":new n.DataConstantProperty(n.spec.fog["high-color"]),"space-color":new n.DataConstantProperty(n.spec.fog["space-color"]),"horizon-blend":new n.DataConstantProperty(n.spec.fog["horizon-blend"]),"star-intensity":new n.DataConstantProperty(n.spec.fog["star-intensity"])});class Os extends n.Evented{constructor(i,o){super(),this._transitionable=new n.Transitionable(wt),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const i=this._transform,o=i.projection.name==="globe",m=n.globeToMercatorTransition(i.zoom),x=this.properties.get("range"),_=[.5,3];return{range:o?[n.number(_[0],x[0],m),n.number(_[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o={}){if(!this._validate(n.validateFog,i,o)){for(const m of Object.keys(n.spec.fog))i&&i[m]===void 0&&(i[m]=n.spec.fog[m].default);for(const m in i){const x=i[m];n.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),x):this._transitionable.setValue(m,x)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.smoothstep(45,65,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(m,x,_){const j=n.MercatorCoordinate.fromLngLat(x),S=_.elevation?_.elevation.getAtPointOrZero(j):0,C=[j.x,j.y,S];return n.transformMat4(C,C,_.mercatorFogMatrix),pt(m,C,_.pitch,_._fov)}(this.state,i,o):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?ft(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,i.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class ns{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=n.uniqueId();const m=this.workerPool.acquire(this.id);for(let x=0;x<m.length;x++){const _=new ns.Actor(m[x],o,this.id);_.name=`Worker ${x}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,m){n.asyncAll(this.actors,(x,_)=>{x.send(i,o,_)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function _s(u,i,o){return i*(n.EXTENT/(u.tileSize*Math.pow(2,o-u.tileID.overscaledZ)))}ns.Actor=n.Actor;class mr{constructor(i,o,m,x){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,o){let m,x;if(i instanceof n.Point||typeof i[0]=="number"){const _=n.Point.convert(i);m=[_],x=o.isPointAboveHorizon(_)}else{const _=n.Point.convert(i[0]),j=n.Point.convert(i[1]);m=[_,j],x=n.polygonizeBounds(_,j).every(S=>o.isPointAboveHorizon(S))}return new mr(m,o.getCameraPoint(),x,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return n.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.Point(1,1)):this.screenBounds[1],x=n.polygonizeBounds(o,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(x[3]=this.cameraPoint)),n.bufferConvexPolygon(x,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.Point(1,1)):this.screenBounds[1],x=n.polygonizeBounds(o,m,i),_=this.cameraPoint.clone();switch(3*((_.y>o.y)+(_.y>m.y))+((_.x>o.x)+(_.x>m.x))){case 0:x[0]=_,x[4]=_.clone();break;case 1:x.splice(1,0,_);break;case 2:x[1]=_;break;case 3:x.splice(4,0,_);break;case 5:x.splice(2,0,_);break;case 6:x[3]=_;break;case 7:x.splice(3,0,_);break;case 8:x[2]=_}return x}containsTile(i,o,m,x=0){const _=i.queryPadding/o._pixelsPerMercatorPixel+1,j=m?this._bufferedCameraMercator(_,o):this._bufferedScreenMercator(_,o);let S=i.tileID.wrap+(j.unwrapped?x:0);const C=j.polygon.map(se=>n.getTilePoint(i.tileTransform,se,S));if(!n.polygonIntersectsBox(C,0,0,n.EXTENT,n.EXTENT))return;S=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const D=this.screenGeometryMercator.polygon.map(se=>n.getTileVec3(i.tileTransform,se,S)),I=D.map(se=>new n.Point(se[0],se[1])),O=o.getFreeCameraOptions().position||new n.MercatorCoordinate(0,0,0),H=n.getTileVec3(i.tileTransform,O,S),J=D.map(se=>{const F=n.sub(se,se,H);return n.normalize(F,F),new n.Ray(H,F)}),ee=_s(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:J,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Y=n.getBounds(C),Y.min.x=n.clamp(Y.min.x,0,n.EXTENT),Y.min.y=n.clamp(Y.min.y,0,n.EXTENT),Y.max.x=n.clamp(Y.max.x,0,n.EXTENT),Y.max.y=n.clamp(Y.max.y,0,n.EXTENT),Y),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:ee};var Y}_bufferedScreenMercator(i,o){const m=Fr(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(i,o){const m=Fr(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(i,o){const m=function(_,j){const S=n.multiply([],j.pixelMatrix,j.globeMatrix),C=[0,-n.GLOBE_RADIUS,0,1],D=[0,n.GLOBE_RADIUS,0,1],I=[0,0,0,1];n.transformMat4$1(C,C,S),n.transformMat4$1(D,D,S),n.transformMat4$1(I,I,S);const O=new n.Point(C[0]/C[3],C[1]/C[3]),H=new n.Point(D[0]/D[3],D[1]/D[3]),J=n.polygonContainsPoint(_,O)&&C[3]<I[3],ee=n.polygonContainsPoint(_,H)&&D[3]<I[3];if(!J&&!ee)return null;const Y=function(be,Me,ke){for(let Be=1;Be<be.length;Be++){const at=pr(Me.pointCoordinate3D(be[Be-1]).x),ze=pr(Me.pointCoordinate3D(be[Be]).x);if(ke<0){if(at<ze)return{idx:Be,t:-at/(ze-1-at)}}else if(ze<at)return{idx:Be,t:(1-at)/(ze+1-at)}}return null}(_,j,J?-1:1);if(!Y)return null;const{idx:se,t:F}=Y;let Q=se>1?Ut(_.slice(0,se),j):[],ae=se<_.length?Ut(_.slice(se),j):[];Q=Q.map(be=>new n.Point(pr(be.x),be.y)),ae=ae.map(be=>new n.Point(pr(be.x),be.y));const oe=[...Q];oe.length===0&&oe.push(ae[ae.length-1]);const _e=n.number(oe[oe.length-1].y,(ae.length===0?Q[0]:ae[0]).y,F);let ve;return ve=J?[new n.Point(0,_e),new n.Point(0,0),new n.Point(1,0),new n.Point(1,_e)]:[new n.Point(1,_e),new n.Point(1,1),new n.Point(0,1),new n.Point(0,_e)],oe.push(...ve),ae.length===0?oe.push(Q[0]):oe.push(...ae),{polygon:oe.map(be=>new n.MercatorCoordinate(be.x,be.y)),unwrapped:!1}}(i,o);if(m)return m;const x=function(_,j){let S=!1,C=-1/0,D=0;for(let O=0;O<_.length-1;O++)_[O].x>C&&(C=_[O].x,D=O);for(let O=0;O<_.length-1;O++){const H=(D+O)%(_.length-1),J=_[H],ee=_[H+1];Math.abs(J.x-ee.x)>.5&&(J.x<ee.x?(J.x+=1,H===0&&(_[_.length-1].x+=1)):(ee.x+=1,H+1===_.length-1&&(_[0].x+=1)),S=!0)}const I=n.mercatorXfromLng(j.center.lng);return S&&I<Math.abs(I-1)&&_.forEach(O=>{O.x-=1}),{polygon:_,unwrapped:S}}(Ut(i,o).map(_=>new n.Point(pr(_.x),_.y)),o);return{polygon:x.polygon.map(_=>new n.MercatorCoordinate(_.x,_.y)),unwrapped:x.unwrapped}}}function Ut(u,i){return n.resample(u,o=>{const m=i.pointCoordinate3D(o);o.x=m.x,o.y=m.y},1/256)}function pr(u){return u<0?1+u%1:u%1}function Fr(u){return 100*u|0}function jr(u,i,o,m,x){const _=function(j,S){if(j)return x(j);if(S){u.url&&S.tiles&&u.tiles&&delete u.tiles;const C=n.pick(n.extend(S,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(C.vectorLayers=S.vector_layers,C.vectorLayerIds=C.vectorLayers.map(D=>D.id)),C.tiles=i.canonicalizeTileset(C,u.url),x(null,C)}};return u.url?n.getJSON(i.transformRequest(i.normalizeSourceURL(u.url,null,o,m),n.ResourceType.Source),_):n.exported.frame(()=>_(null,u))}class fr{constructor(i,o,m){this.bounds=n.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),m=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*o),x=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*o),_=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*o),j=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*o);return i.x>=m&&i.x<_&&i.y>=x&&i.y<j}}class Br{constructor(i,o,m){this.context=i;const x=i.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _r={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jr{constructor(i,o,m,x){this.length=o.length,this.attributes=m,this.itemSize=o.bytesPerElement,this.dynamicDraw=x,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let m=0;m<this.attributes.length;m++){const x=o.attributes[this.attributes[m].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,o,m){for(let x=0;x<this.attributes.length;x++){const _=this.attributes[x],j=o.attributes[_.name];j!==void 0&&i.vertexAttribPointer(j,_.components,i[_r[_.type]],!1,this.itemSize,_.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gi extends Qt{getDefault(){return n.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class br extends Qt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Mi extends Qt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class As extends Qt{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ir extends Qt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Zn extends Qt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Zr extends Qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class we extends Qt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ge extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class et extends Qt{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class kt extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class Nt extends Qt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class De extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class xt extends Qt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Jt extends Qt{getDefault(){return n.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class qt extends Qt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class bs extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class sr extends Qt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Ls extends Qt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let xi,Wr=class extends Qt{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class Dr extends Qt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class yi extends Qt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Oi extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class en extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class tn extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class el extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class he extends Qt{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class q extends Qt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Z extends Qt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class ce extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class ye extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Se extends Qt{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Re extends Se{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Le extends Se{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ne extends Le{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class $e{constructor(i,o,m,x){this.context=i,this.width=o,this.height=m;const _=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Re(i,_),x&&(this.depthAttachment=new Le(i,_))}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class mt{constructor(i,o=!1){if(this.gl=i,this.isWebGL2=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),o){const m=i;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(i),deleteVertexArrayOES:m.deleteVertexArray.bind(i),bindVertexArrayOES:m.bindVertexArray.bind(i)}}this.clearColor=new gi(this),this.clearDepth=new br(this),this.clearStencil=new Mi(this),this.colorMask=new As(this),this.depthMask=new Ir(this),this.stencilMask=new Zn(this),this.stencilFunc=new Zr(this),this.stencilOp=new we(this),this.stencilTest=new Ge(this),this.depthRange=new et(this),this.depthTest=new kt(this),this.depthFunc=new Nt(this),this.blend=new De(this),this.blendFunc=new xt(this),this.blendColor=new Jt(this),this.blendEquation=new qt(this),this.cullFace=new bs(this),this.cullFaceSide=new sr(this),this.frontFace=new Ls(this),this.program=new Wr(this),this.activeTexture=new Dr(this),this.viewport=new yi(this),this.bindFramebuffer=new Oi(this),this.bindRenderbuffer=new en(this),this.bindTexture=new tn(this),this.bindVertexBuffer=new el(this),this.bindElementBuffer=new he(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new q(this),this.pixelStoreUnpack=new Z(this),this.pixelStoreUnpackPremultiplyAlpha=new ce(this),this.pixelStoreUnpackFlipY=new ye(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),o||(this.extTextureHalfFloat=i.getExtension("OES_texture_half_float")),(o||this.extTextureHalfFloat&&i.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o||i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new Br(this,i,o)}createVertexBuffer(i,o,m){return new Jr(this,i,o,m)}createRenderbuffer(i,o,m){const x=this.gl,_=x.createRenderbuffer();return this.bindRenderbuffer.set(_),x.renderbufferStorage(x.RENDERBUFFER,i,o,m),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,m){return new $e(this,i,o,m)}clear({color:i,depth:o,stencil:m}){const x=this.gl;let _=0;i&&(_|=x.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),m!==void 0&&(_|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){M(i.blendFunction,n.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class bt extends n.Evented{constructor(i,o,m,x){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(o,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new n.DedupedRequest}load(i){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=jr(this._options,this.map._requestManager,o,m,(x,_)=>{this._tileJSONRequest=null,this._loaded=!0,x?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new n.ErrorEvent(x))):_&&(n.extend(this,_),_.bounds&&(this.tileBounds=new fr(_.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(x)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return n.extend({},this._options)}loadTile(i,o){const m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(m,n.ResourceType.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=o:i.request=i.actor.send("reloadTile",x,_.bind(this));else if(i.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",x,_.bind(this),void 0,!0);else{const j=n.loadVectorTile.call({deduped:this._deduped},x,(S,C)=>{S||!C?_.call(this,S):(x.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},i.actor&&i.actor.send("loadTile",x,_.bind(this),void 0,!0))},!0);i.request={cancel:j}}function _(j,S){return delete i.request,i.aborted?o(null):j&&j.status!==404?o(j):(S&&S.resourceTiming&&(i.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&i.setExpiryData(S),i.loadVectorData(S,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id})}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ut extends n.Evented{constructor(i,o,m,x){super(),this.id=i,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},o),n.extend(this,n.pick(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=jr(this._options,this.map._requestManager,null,null,(o,m)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new n.ErrorEvent(o)):m&&(n.extend(this,m),m.bounds&&(this.tileBounds=new fr(m.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(m.tiles),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return n.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const m=n.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=n.getImage(this.map._requestManager.transformRequest(x,n.ResourceType.Tile),(_,j,S,C)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):_?(i.state="errored",o(_)):j?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:C}),i.setTexture(j,this.map.painter),i.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(i,o,m){i.setTexture(o,m)}static unloadTileData(i,o){i.texture&&o.saveTileTexture(i.texture)}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o()}unloadTile(i,o){i.texture&&this.map.painter.saveTileTexture(i.texture),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Wt(u,i,o,m,x,_,j,S){const C=[u,o,x,i,m,_,1,1,1],D=[j,S,1],I=n.adjoint([],C),[O,H,J]=n.transformMat3(D,D,n.transpose(I,I));return n.multiply$1(C,[O,0,0,0,H,0,0,0,J],C)}class Yt extends n.Evented{constructor(i,o,m,x){super(),this.id=i,this.dispatcher=m,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=o,this._dirty=!1}load(i,o){this._loaded=o||!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(m,x)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new n.ErrorEvent(m));else if(x){const{HTMLImageElement:_}=n.window;this.image=x instanceof _?n.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const o=i.map(n.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let x=1/0,_=1/0,j=-1/0,S=-1/0;for(const O of m)x=Math.min(x,O.x),_=Math.min(_,O.y),j=Math.max(j,O.x),S=Math.max(S,O.y);const C=Math.max(j-x,S-_),D=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),I=Math.pow(2,D);return new n.CanonicalTileID(D,Math.floor((x+j)/2*I),Math.floor((_+S)/2*I))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const C in this.tiles){const D=this.tiles[C];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const o=n.tileTransform(this.tileID,this.map.transform.projection),[m,x,_,j]=this.coordinates.map(C=>{const D=o.projection.project(C[0],C[1]);return n.getTilePoint(o,D)._round()});this.perspectiveTransform=function(C,D,I,O,H,J,ee,Y,se,F){const Q=Wt(0,0,C,0,0,D,C,D),ae=Wt(I,O,H,J,ee,Y,se,F);return n.multiply$1(ae,n.adjoint(Q,Q),ae),[ae[6]/ae[8]*C/n.EXTENT,ae[7]/ae[8]*D/n.EXTENT]}(this.width,this.height,m.x,m.y,x.x,x.y,j.x,j.y,_.x,_.y);const S=this._boundsArray=new n.StructArrayLayout4i8;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(x.x,x.y,n.EXTENT,0),S.emplaceBack(j.x,j.y,0,n.EXTENT),S.emplaceBack(_.x,_.y,n.EXTENT,n.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(S,n.boundsAttributes.members),this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new n.Texture(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,o){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},o(null)):(i.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ht={vector:bt,raster:ut,"raster-dem":class extends ut{constructor(u,i,o,m){super(u,i,o,m),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(u,i){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,_){x&&(u.state="errored",i(x)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",i(null))}u.request=n.getImage(this.map._requestManager.transformRequest(o,n.ResourceType.Tile),(function(x,_,j,S){if(delete u.request,u.aborted)u.state="unloaded",i(null);else if(x)u.state="errored",i(x);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:j,expires:S});const C=n.window.ImageBitmap&&_ instanceof n.window.ImageBitmap&&(xi==null&&(xi=n.window.OffscreenCanvas&&new n.window.OffscreenCanvas(1,1).getContext("2d")&&typeof n.window.createImageBitmap=="function"),xi),D=1-(_.width-n.prevPowerOfTwo(_.width))/2;D<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const I=C?_:n.exported.getImageData(_,D),O={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:D};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",O,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const i=u.canonical,o=Math.pow(2,i.z),m=(i.x-1+o)%o,x=i.x===0?u.wrap-1:u.wrap,_=(i.x+1+o)%o,j=i.x+1===o?u.wrap+1:u.wrap,S={};return S[new n.OverscaledTileID(u.overscaledZ,x,i.z,m,i.y).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y).key]={backfilled:!1},i.y>0&&(S[new n.OverscaledTileID(u.overscaledZ,x,i.z,m,i.y-1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,u.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y-1).key]={backfilled:!1}),i.y+1<o&&(S[new n.OverscaledTileID(u.overscaledZ,x,i.z,m,i.y+1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,u.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y+1).key]={backfilled:!1}),S}unloadTile(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded"}},geojson:class extends n.Evented{constructor(u,i,o,m){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(m),this._data=i.data,this._options=n.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:n.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},i),this}getClusterChildren(u,i){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},i),this}getClusterLeaves(u,i,o,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:i,offset:o},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.Event("dataloading",{dataType:"source"})),this._loaded=!1;const u=n.extend({},this.workerOptions),i=this._data;typeof i=="string"?(u.request=this.map._requestManager.transformRequest(n.exported.resolveURL(i),n.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(o,m)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new n.ErrorEvent(o));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x.resourceTiming=m.resourceTiming[this.id]),this.fire(new n.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,i){const o=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(o,{type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,x)=>(delete u.request,u.unloadVectorData(),u.aborted?i(null):m?i(m):(u.loadVectorData(x,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Yt{constructor(u,i,o,m){super(u,i,o,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const i of u.urls)this.urls.push(this.map._requestManager.transformRequest(i,n.ResourceType.Source).url);n.getVideo(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new n.ErrorEvent(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const i=this.video.seekable;u<i.start(0)||u>i.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,i=u.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new n.Texture(u,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Yt,canvas:class extends Yt{constructor(u,i,o,m){super(u,i,o,m),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(_=>typeof _!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof n.window.HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof n.window.HTMLCanvasElement?this.options.canvas:n.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends n.Evented{constructor(u,i,o,m){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fr(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),n.extend(this,n.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:i,y:o,z:m}=u.canonical;return this._implementation.hasTile({x:i,y:o,z:m})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,i){const{x:o,y:m,z:x}=u.tileID.canonical,_=new n.window.AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:o,y:m,z:x},{signal:_.signal})).then((function(j){return delete u.request,u.aborted?(u.state="unloaded",i(null)):j===void 0?(u.state="errored",i(null)):j===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",i(null)):function(S){return S instanceof n.window.ImageData||S instanceof n.window.HTMLCanvasElement||S instanceof n.window.ImageBitmap||S instanceof n.window.HTMLImageElement}(j)?(this.loadTileData(u,j),u.state="loaded",void i(null)):(u.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(j=>{j.code!==20&&(u.state="errored",i(j))}),u.request.cancel=()=>_.abort()}loadTileData(u,i){ut.loadTileData(u,i,this._map.painter)}unloadTileData(u){ut.unloadTileData(u,this._map.painter)}unloadTile(u,i){if(this.unloadTileData(u),this._implementation.unloadTile){const{x:o,y:m,z:x}=u.tileID.canonical;this._implementation.unloadTile({x:o,y:m,z:x})}i()}abortTile(u,i){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}}},es=function(u,i,o,m){const x=new Ht[i.type](u,i,o,m);if(x.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${x.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],x),x};function os(u,i){const o=n.identity([]);return n.scale(o,o,[.5*u.width,.5*-u.height,1]),n.translate(o,o,[1,-1,0]),n.multiply(o,o,u.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(o)}function Vs(u,i,o,m,x,_,j,S=!1){const C=u.tilesIn(m,j,S);C.sort(Ur);const D=[];for(const O of C)D.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(i,o,u._state,O,x,_,os(u.transform,O.tile.tileID),S)});const I=function(O){const H={},J={};for(const ee of O){const Y=ee.queryResults,se=ee.wrappedTileID,F=J[se]=J[se]||{};for(const Q in Y){const ae=Y[Q],oe=F[Q]=F[Q]||{},_e=H[Q]=H[Q]||[];for(const ve of ae)oe[ve.featureIndex]||(oe[ve.featureIndex]=!0,_e.push(ve))}}return H}(D);for(const O in I)I[O].forEach(H=>{const J=H.feature,ee=J.layer;ee&&ee.type!=="background"&&ee.type!=="sky"&&(J.source=ee.source,ee["source-layer"]&&(J.sourceLayer=ee["source-layer"]),J.state=J.id!==void 0?u.getFeatureState(ee["source-layer"],J.id):{})});return I}function rr(u,i){const o=u.getRenderableIds().map(_=>u.getTileByID(_)),m=[],x={};for(let _=0;_<o.length;_++){const j=o[_],S=j.tileID.canonical.key;x[S]||(x[S]=!0,j.querySourceFeatures(m,i))}return m}function Ur(u,i){const o=u.tileID,m=i.tileID;return o.overscaledZ-m.overscaledZ||o.canonical.y-m.canonical.y||o.wrap-m.wrap||o.canonical.x-m.canonical.x}function gr(){return Da.workerClass!=null?new Da.workerClass:new n.window.Worker(Da.workerUrl)}const Fi="mapboxgl_preloaded_worker_pool";class Nr{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Nr.workerCount;)this.workers.push(new gr);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Fi]}numActive(){return Object.keys(this.active).length}}let Hr;function ga(){return Hr||(Hr=new Nr),Hr}function xm(u,i){const o={};for(const m in u)m!=="ref"&&(o[m]=u[m]);return n.refProperties.forEach(m=>{m in i&&(o[m]=i[m])}),o}function ad(u){u=u.slice();const i=Object.create(null);for(let o=0;o<u.length;o++)i[u[o].id]=u[o];for(let o=0;o<u.length;o++)"ref"in u[o]&&(u[o]=xm(u[o],i[u[o].ref]));return u}Nr.workerCount=2;const xs={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function dc(u,i,o){o.push({command:xs.addSource,args:[u,i[u]]})}function ro(u,i,o){i.push({command:xs.removeSource,args:[u]}),o[u]=!0}function hc(u,i,o,m){ro(u,o,m),dc(u,i,o)}function tl(u,i,o){let m;for(m in u[o])if(u[o].hasOwnProperty(m)&&m!=="data"&&!M(u[o][m],i[o][m]))return!1;for(m in i[o])if(i[o].hasOwnProperty(m)&&m!=="data"&&!M(u[o][m],i[o][m]))return!1;return!0}function Bi(u,i,o,m,x,_){let j;for(j in i=i||{},u=u||{})u.hasOwnProperty(j)&&(M(u[j],i[j])||o.push({command:_,args:[m,j,i[j],x]}));for(j in i)i.hasOwnProperty(j)&&!u.hasOwnProperty(j)&&(M(u[j],i[j])||o.push({command:_,args:[m,j,i[j],x]}))}function sn(u){return u.id}function mc(u,i){return u[i.id]=i,u}class pc{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=n.clamp(i,0,1);let o=1,m=this._distances[o];const x=i*this.paddedLength+this.padding;for(;m<x&&o<this._distances.length;)m=this._distances[++o];const _=o-1,j=this._distances[_],S=m-j,C=S>0?(x-j)/S:0;return this.points[_].mult(1-C).add(this.points[o].mult(C))}}class Wn{constructor(i,o,m){const x=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(o/m);for(let j=0;j<this.xCellCount*this.yCellCount;j++)x.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,m,x,_){this._forEachCell(o,m,x,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(_)}insertCircle(i,o,m,x){this._forEachCell(o-x,m-x,o+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(m),this.circles.push(x)}_insertBoxCell(i,o,m,x,_,j){this.boxCells[_].push(j)}_insertCircleCell(i,o,m,x,_,j){this.circleCells[_].push(j)}_query(i,o,m,x,_,j){if(m<0||i>this.width||x<0||o>this.height)return!_&&[];const S=[];if(i<=0&&o<=0&&this.width<=m&&this.height<=x){if(_)return!0;for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const D=this.circles[3*C],I=this.circles[3*C+1],O=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:D-O,y1:I-O,x2:D+O,y2:I+O})}return j?S.filter(j):S}return this._forEachCell(i,o,m,x,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},j),_?S.length>0:S}_queryCircle(i,o,m,x,_){const j=i-m,S=i+m,C=o-m,D=o+m;if(S<0||j>this.width||D<0||C>this.height)return!x&&[];const I=[];return this._forEachCell(j,C,S,D,this._queryCellCircle,I,{hitTest:x,circle:{x:i,y:o,radius:m},seenUids:{box:{},circle:{}}},_),x?I.length>0:I}query(i,o,m,x,_){return this._query(i,o,m,x,!1,_)}hitTest(i,o,m,x,_){return this._query(i,o,m,x,!0,_)}hitTestCircle(i,o,m,x){return this._queryCircle(i,o,m,!0,x)}_queryCell(i,o,m,x,_,j,S,C){const D=S.seenUids,I=this.boxCells[_];if(I!==null){const H=this.bboxes;for(const J of I)if(!D.box[J]){D.box[J]=!0;const ee=4*J;if(i<=H[ee+2]&&o<=H[ee+3]&&m>=H[ee+0]&&x>=H[ee+1]&&(!C||C(this.boxKeys[J]))){if(S.hitTest)return j.push(!0),!0;j.push({key:this.boxKeys[J],x1:H[ee],y1:H[ee+1],x2:H[ee+2],y2:H[ee+3]})}}}const O=this.circleCells[_];if(O!==null){const H=this.circles;for(const J of O)if(!D.circle[J]){D.circle[J]=!0;const ee=3*J;if(this._circleAndRectCollide(H[ee],H[ee+1],H[ee+2],i,o,m,x)&&(!C||C(this.circleKeys[J]))){if(S.hitTest)return j.push(!0),!0;{const Y=H[ee],se=H[ee+1],F=H[ee+2];j.push({key:this.circleKeys[J],x1:Y-F,y1:se-F,x2:Y+F,y2:se+F})}}}}}_queryCellCircle(i,o,m,x,_,j,S,C){const D=S.circle,I=S.seenUids,O=this.boxCells[_];if(O!==null){const J=this.bboxes;for(const ee of O)if(!I.box[ee]){I.box[ee]=!0;const Y=4*ee;if(this._circleAndRectCollide(D.x,D.y,D.radius,J[Y+0],J[Y+1],J[Y+2],J[Y+3])&&(!C||C(this.boxKeys[ee])))return j.push(!0),!0}}const H=this.circleCells[_];if(H!==null){const J=this.circles;for(const ee of H)if(!I.circle[ee]){I.circle[ee]=!0;const Y=3*ee;if(this._circlesCollide(J[Y],J[Y+1],J[Y+2],D.x,D.y,D.radius)&&(!C||C(this.circleKeys[ee])))return j.push(!0),!0}}}_forEachCell(i,o,m,x,_,j,S,C){const D=this._convertToXCellCoord(i),I=this._convertToYCellCoord(o),O=this._convertToXCellCoord(m),H=this._convertToYCellCoord(x);for(let J=D;J<=O;J++)for(let ee=I;ee<=H;ee++)if(_.call(this,i,o,m,x,this.xCellCount*ee+J,j,S,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,m,x,_,j){const S=x-i,C=_-o,D=m+j;return D*D>S*S+C*C}_circleAndRectCollide(i,o,m,x,_,j,S){const C=(j-x)/2,D=Math.abs(i-(x+C));if(D>C+m)return!1;const I=(S-_)/2,O=Math.abs(o-(_+I));if(O>I+m)return!1;if(D<=C||O<=I)return!0;const H=D-C,J=O-I;return H*H+J*J<=m*m}}const rn={unknown:0,flipRequired:1,flipNotRequired:2},io=Math.tan(85*Math.PI/180);function We(u,i,o,m,x,_,j){const S=n.create();if(o)if(_.name==="globe"){const C=n.calculateGlobeLabelMatrix(x,i);n.multiply(S,S,C)}else{const C=Ee([],j);S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],m||n.rotateZ(S,S,x.angle)}else n.multiply(S,x.labelPlaneMatrix,u);return S}function nn(u,i,o,m,x,_,j){const S=We(u,i,o,m,x,_,j);return _.name==="globe"&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function ir(u,i,o,m,x,_,j){if(o){if(_.name==="globe"){const S=We(u,i,o,m,x,_,j);return n.invert(S,S),n.multiply(S,u,S),S}{const S=n.clone(u),C=n.identity([]);return C[0]=j[0],C[1]=j[1],C[4]=j[2],C[5]=j[3],n.multiply(S,S,C),m||n.rotateZ(S,S,-x.angle),S}}return x.glCoordMatrix}function Sr(u,i,o,m){const x=[u,i,o,1];o?n.transformMat4$1(x,x,m):rs(x,x,m);const _=x[3];return x[0]/=_,x[1]/=_,x[2]/=_,x}function od(u,i){return Math.min(.5+u/i*.5,1.5)}function Ui(u,i){const o=u[0]/u[3],m=u[1]/u[3];return o>=-i[0]&&o<=i[0]&&m>=-i[1]&&m<=i[1]}function fc(u,i,o,m,x,_,j,S,C,D){const I=o.transform,O=m?u.textSizeData:u.iconSizeData,H=n.evaluateSizeForZoom(O,o.transform.zoom),J=I.projection.name==="globe",ee=[256/o.width*2+1,256/o.height*2+1],Y=m?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;Y.clear();let se=null;J&&(se=m?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const F=u.lineVertexArray,Q=m?u.text.placedSymbolArray:u.icon.placedSymbolArray,ae=o.transform.width/o.transform.height;let oe,_e=!1;for(let ve=0;ve<Q.length;ve++){const be=Q.get(ve),{numGlyphs:Me,writingMode:ke}=be;if(ke!==n.WritingMode.vertical||_e||oe===n.WritingMode.horizontal||(_e=!0),oe=ke,(be.hidden||ke===n.WritingMode.vertical)&&!_e){Pi(Me,Y);continue}_e=!1;const Be=new n.Point(be.tileAnchorX,be.tileAnchorY);let{x:at,y:ze,z:Qe}=I.projection.projectTilePoint(Be.x,Be.y,D.canonical);if(C){const[Vt,At,Ot]=C(Be);at+=Vt,ze+=At,Qe+=Ot}const Ve=[at,ze,Qe,1];if(n.transformMat4$1(Ve,Ve,i),!Ui(Ve,ee)){Pi(Me,Y);continue}const nt=od(o.transform.cameraToCenterDistance,Ve[3]),Fe=n.evaluateSizeForFeature(O,H,be),Xe=j?Fe/nt:Fe*nt,lt=Sr(at,ze,Qe,x);if(lt[3]<=0){Pi(Me,Y);continue}let st={};const ct=j?null:C,Dt=Tt(be,Xe,!1,S,i,x,_,u.glyphOffsetArray,F,Y,se,lt,Be,st,ae,ct,I.projection,D,j);_e=Dt.useVertical,ct&&Dt.needsFlipping&&(st={}),(Dt.notEnoughRoom||_e||Dt.needsFlipping&&Tt(be,Xe,!0,S,i,x,_,u.glyphOffsetArray,F,Y,se,lt,Be,st,ae,ct,I.projection,D,j).notEnoughRoom)&&Pi(Me,Y)}m?(u.text.dynamicLayoutVertexBuffer.updateData(Y),se&&u.text.globeExtVertexBuffer.updateData(se)):(u.icon.dynamicLayoutVertexBuffer.updateData(Y),se&&u.icon.globeExtVertexBuffer.updateData(se))}function ld(u,i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y){const{lineStartIndex:se,glyphStartIndex:F,segment:Q}=S,ae=F+S.numGlyphs,oe=se+S.lineLength,_e=i.getoffsetX(F),ve=i.getoffsetX(ae-1),be=ui(u*_e,o,m,x,_,j,Q,se,oe,C,D,I,O,H,!0,J,ee,Y);if(!be)return null;const Me=ui(u*ve,o,m,x,_,j,Q,se,oe,C,D,I,O,H,!0,J,ee,Y);return Me?{first:be,last:Me}:null}function xa(u,i,o,m){return u===n.WritingMode.horizontal&&Math.abs(m)>Math.abs(o)?{useVertical:!0}:u===n.WritingMode.vertical?m>0?{needsFlipping:!0}:null:i!==rn.unknown&&function(x,_){return x===0||Math.abs(_/x)>io}(o,m)?i===rn.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Tt(u,i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y,se,F,Q){const ae=i/24,oe=u.lineOffsetX*ae,_e=u.lineOffsetY*ae,{lineStartIndex:ve,glyphStartIndex:be,numGlyphs:Me,segment:ke,writingMode:Be,flipState:at}=u,ze=ve+u.lineLength,Qe=Ve=>{if(I){const[lt,st,ct]=Ve.up,Dt=D.length;n.updateGlobeVertexNormal(I,Dt+0,lt,st,ct),n.updateGlobeVertexNormal(I,Dt+1,lt,st,ct),n.updateGlobeVertexNormal(I,Dt+2,lt,st,ct),n.updateGlobeVertexNormal(I,Dt+3,lt,st,ct)}const[nt,Fe,Xe]=Ve.point;n.addDynamicAttributes(D,nt,Fe,Xe,Ve.angle)};if(Me>1){const Ve=ld(ae,S,oe,_e,o,O,H,u,C,_,J,Y,!1,se,F,Q);if(!Ve)return{notEnoughRoom:!0};if(m&&!o){let[nt,Fe,Xe]=Ve.first.point,[lt,st,ct]=Ve.last.point;[nt,Fe]=Sr(nt,Fe,Xe,j),[lt,st]=Sr(lt,st,ct,j);const Dt=xa(Be,at,(lt-nt)*ee,st-Fe);if(u.flipState=Dt&&Dt.needsFlipping?rn.flipRequired:rn.flipNotRequired,Dt)return Dt}Qe(Ve.first);for(let nt=be+1;nt<be+Me-1;nt++){const Fe=ui(ae*S.getoffsetX(nt),oe,_e,o,O,H,ke,ve,ze,C,_,J,Y,!1,!1,se,F,Q);if(!Fe)return D.length-=4*(nt-be),{notEnoughRoom:!0};Qe(Fe)}Qe(Ve.last)}else{if(m&&!o){const nt=Sr(H.x,H.y,0,x),Fe=ve+ke+1,Xe=new n.Point(C.getx(Fe),C.gety(Fe)),lt=Sr(Xe.x,Xe.y,0,x),st=lt[3]>0?lt:ss(H,Xe,nt,1,x,void 0,se,F.canonical),ct=xa(Be,at,(st[0]-nt[0])*ee,st[1]-nt[1]);if(u.flipState=ct&&ct.needsFlipping?rn.flipRequired:rn.flipNotRequired,ct)return ct}const Ve=ui(ae*S.getoffsetX(be),oe,_e,o,O,H,ke,ve,ze,C,_,J,Y,!1,!1,se,F,Q);if(!Ve)return{notEnoughRoom:!0};Qe(Ve)}return{}}function as(u,i,o,m,x){const{x:_,y:j,z:S}=m.projectTilePoint(u.x,u.y,i);if(!x)return Sr(_,j,S,o);const[C,D,I]=x(u);return Sr(_+C,j+D,S+I,o)}function ss(u,i,o,m,x,_,j,S){const C=as(u.sub(i)._unit()._add(u),S,x,j,_);return n.sub(C,o,C),n.normalize(C,C),n.scaleAndAdd(C,o,C,m)}function ui(u,i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y,se,F){const Q=m?u-i:u+i;let ae=Q>0?1:-1,oe=0;m&&(ae*=-1,oe=Math.PI),ae<0&&(oe+=Math.PI);let _e=S+j+(ae>0?0:1)|0,ve=x,be=x,Me=0,ke=0;const Be=Math.abs(Q),at=[],ze=[];let Qe=_,Ve=Qe;const nt=()=>ss(Ve,Qe,be,Be-Me+1,I,H,Y,se.canonical);for(;Me+ke<=Be;){if(_e+=ae,_e<S||_e>=C)return null;if(be=ve,Ve=Qe,at.push(be),J&&ze.push(Ve),Qe=new n.Point(D.getx(_e),D.gety(_e)),ve=O[_e],!ve){const Ot=as(Qe,se.canonical,I,Y,H);ve=Ot[3]>0?O[_e]=Ot:nt()}Me+=ke,ke=n.distance(be,ve)}ee&&H&&(O[_e]&&(ve=nt(),ke=n.distance(be,ve)),O[_e]=ve);const Fe=(Be-Me)/ke,Xe=Qe.sub(Ve)._mult(Fe)._add(Ve),lt=n.sub([],ve,be),st=n.scaleAndAdd([],be,lt,Fe);let ct=[0,0,1],Dt=lt[0],Vt=lt[1];if(F&&(ct=Y.upVector(se.canonical,Xe.x,Xe.y),ct[0]!==0||ct[1]!==0||ct[2]!==1)){const Ot=[ct[2],0,-ct[0]],is=n.cross([],ct,Ot);n.normalize(Ot,Ot),n.normalize(is,is),Dt=n.dot(lt,Ot),Vt=n.dot(lt,is)}if(o){const Ot=n.cross([],ct,lt);n.normalize(Ot,Ot),n.scaleAndAdd(st,st,Ot,o*ae)}const At=oe+Math.atan2(Vt,Dt);return at.push(st),J&&ze.push(Xe),{point:st,angle:At,path:at,tilePath:ze,up:ct}}function Pi(u,i){const o=i.length,m=o+4*u;i.resize(m),i.float32.fill(-1/0,4*o,4*m)}function rs(u,i,o){const m=i[0],x=i[1];return u[0]=o[0]*m+o[4]*x+o[12],u[1]=o[1]*m+o[5]*x+o[13],u[3]=o[3]*m+o[7]*x+o[15],u}const di=100;class no{constructor(i,o,m=new Wn(i.width+200,i.height+200,25),x=new Wn(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+di,this.screenBottomBoundary=i.height+di,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,m,x,_,j,S,C){let D=m.projectedAnchorX,I=m.projectedAnchorY,O=m.projectedAnchorZ;const H=m.elevation,J=m.tileID,ee=i.getProjection();if(H&&J){const[ve,be,Me]=ee.upVector(J.canonical,m.tileAnchorX,m.tileAnchorY),ke=ee.upVectorScale(J.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ve*H*ke,I+=be*H*ke,O+=Me*H*ke}const Y=this.projectAndGetPerspectiveRatio(S,D,I,O,m.tileID,ee.name==="globe"||!!H||this.transform.pitch>0,ee),se=j*Y.perspectiveRatio,F=(m.x1*o+x.x-m.padding)*se+Y.point.x,Q=(m.y1*o+x.y-m.padding)*se+Y.point.y,ae=(m.x2*o+x.x+m.padding)*se+Y.point.x,oe=(m.y2*o+x.y+m.padding)*se+Y.point.y,_e=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(F,Q,ae,oe)||!_&&this.grid.hitTest(F,Q,ae,oe,C)||_e?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[F,Q,ae,oe],offscreen:this.isOffscreen(F,Q,ae,oe),occluded:!1}}placeCollisionCircles(i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y){const se=[],F=this.transform.elevation,Q=i.getProjection(),ae=F?F.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,Q):null,oe=new n.Point(m.tileAnchorX,m.tileAnchorY);let{x:_e,y:ve,z:be}=Q.projectTilePoint(oe.x,oe.y,Y.canonical);if(ae){const[Xe,lt,st]=ae(oe);_e+=Xe,ve+=lt,be+=st}const Me=Q.name==="globe",ke=this.projectAndGetPerspectiveRatio(S,_e,ve,be,Y,Me||!!F||this.transform.pitch>0,Q),{perspectiveRatio:Be}=ke,at=(O?j/Be:j*Be)/n.ONE_EM,ze=Sr(_e,ve,be,C),Qe=ke.signedDistanceFromCamera>0?ld(at,_,m.lineOffsetX*at,m.lineOffsetY*at,!1,ze,oe,m,x,C,{},F&&!O?ae:null,O&&!!F,Q,Y,O):null;let Ve=!1,nt=!1,Fe=!0;if(Qe&&!ke.occluded){const Xe=.5*J*Be+ee,lt=new n.Point(-100,-100),st=new n.Point(this.screenRightBoundary,this.screenBottomBoundary),ct=new pc,{first:Dt,last:Vt}=Qe,At=Dt.path.length;let Ot=[];for(let Pt=At-1;Pt>=1;Pt--)Ot.push(Dt.path[Pt]);for(let Pt=1;Pt<Vt.path.length;Pt++)Ot.push(Vt.path[Pt]);const is=2.5*Xe;D&&(Ot=Ot.map(([Pt,vs,ws],js)=>(ae&&!Me&&(ws=ae(js<At-1?Dt.tilePath[At-1-js]:Vt.tilePath[js-At+2])[2]),Sr(Pt,vs,ws,D))),Ot.some(Pt=>Pt[3]<=0)&&(Ot=[]));let ts=[];if(Ot.length>0){let Pt=1/0,vs=-1/0,ws=1/0,js=-1/0;for(const Ns of Ot)Pt=Math.min(Pt,Ns[0]),ws=Math.min(ws,Ns[1]),vs=Math.max(vs,Ns[0]),js=Math.max(js,Ns[1]);vs>=lt.x&&Pt<=st.x&&js>=lt.y&&ws<=st.y&&(ts=[Ot.map(Ns=>new n.Point(Ns[0],Ns[1]))],(Pt<lt.x||vs>st.x||ws<lt.y||js>st.y)&&(ts=n.clipLine(ts,lt.x,lt.y,st.x,st.y)))}for(const Pt of ts){ct.reset(Pt,.25*Xe);let vs=0;vs=ct.length<=.5*Xe?1:Math.ceil(ct.paddedLength/is)+1;for(let ws=0;ws<vs;ws++){const js=ws/Math.max(vs-1,1),Ns=ct.lerp(js),qr=Ns.x+di,Er=Ns.y+di;se.push(qr,Er,Xe,0);const ji=qr-Xe,Gi=Er-Xe,Bs=qr+Xe,Ss=Er+Xe;if(Fe=Fe&&this.isOffscreen(ji,Gi,Bs,Ss),nt=nt||this.isInsideGrid(ji,Gi,Bs,Ss),!o&&this.grid.hitTestCircle(qr,Er,Xe,H)&&(Ve=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!I&&Ve||!nt?[]:se,offscreen:Fe,collisionDetected:Ve,occluded:ke.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let m=1/0,x=1/0,_=-1/0,j=-1/0;for(const I of i){const O=new n.Point(I.x+di,I.y+di);m=Math.min(m,O.x),x=Math.min(x,O.y),_=Math.max(_,O.x),j=Math.max(j,O.y),o.push(O)}const S=this.grid.query(m,x,_,j).concat(this.ignoredGrid.query(m,x,_,j)),C={},D={};for(const I of S){const O=I.key;if(C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]={}),C[O.bucketInstanceId][O.featureIndex])continue;const H=[new n.Point(I.x1,I.y1),new n.Point(I.x2,I.y1),new n.Point(I.x2,I.y2),new n.Point(I.x1,I.y2)];n.polygonIntersectsPolygon(o,H)&&(C[O.bucketInstanceId][O.featureIndex]=!0,D[O.bucketInstanceId]===void 0&&(D[O.bucketInstanceId]=[]),D[O.bucketInstanceId].push(O.featureIndex))}return D}insertCollisionBox(i,o,m,x,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:_},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,m,x,_){const j=o?this.ignoredGrid:this.grid,S={bucketInstanceId:m,featureIndex:x,collisionGroupID:_};for(let C=0;C<i.length;C+=4)j.insertCircle(S,i[C],i[C+1],i[C+2])}projectAndGetPerspectiveRatio(i,o,m,x,_,j,S){const C=[o,m,x,1];let D=!1;x||this.transform.pitch>0?(n.transformMat4$1(C,C,i),this.fogState&&_&&S.name!=="globe"&&(D=function(H,J,ee,Y,se,F){const Q=F.calculateFogTileMatrix(se),ae=[J,ee,Y];return n.transformMat4(ae,ae,Q),pt(H,ae,F.pitch,F._fov)}(this.fogState,o,m,x,_.toUnwrapped(),this.transform)>.9)):rs(C,C,i);const I=C[3];return{point:new n.Point((C[0]/I+1)/2*this.transform.width+di,(-C[1]/I+1)/2*this.transform.height+di),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/I*.5,1.5),signedDistanceFromCamera:I,occluded:j&&C[2]>I||D}}isOffscreen(i,o,m,x){return m<di||i>=this.screenRightBoundary||x<di||o>this.screenBottomBoundary}isInsideGrid(i,o,m,x){return m>=0&&i<this.gridRightBoundary&&x>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=n.identity([]);return n.translate(i,i,[-100,-100,0]),i}}function Hn(u,i,o){const m=i.createTileMatrix(u,u.worldSize,o.toUnwrapped());return n.multiply(new Float32Array(16),u.projMatrix,m)}function _i(u,i,o){if(i.projection.name===o.projection.name)return u.projMatrix;const m=o.clone();return m.setProjection(i.projection),Hn(m,i.getProjection(),u)}function Fs(u,i,o){return i.name===o.projection.name?u.projMatrix:Hn(o,i,u)}class cd{constructor(i,o,m,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):x&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class an{constructor(i,o,m,x,_,j=!1){this.text=new cd(i?i.text:null,o,m,_),this.icon=new cd(i?i.icon:null,o,x,_),this.clipped=j}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ao{constructor(i,o,m,x=!1){this.text=i,this.icon=o,this.skipFade=m,this.clipped=x}}class oo{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class gc{constructor(i,o,m,x,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=_}}class ud{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:m=>m.collisionGroupID===o}}return this.collisionGroups[i]}}function lo(u,i,o,m,x){const{horizontalAlign:_,verticalAlign:j}=n.getAnchorAlignment(u),S=-(_-.5)*i,C=-(j-.5)*o,D=n.evaluateVariableOffset(u,m);return new n.Point(S+D[0]*x,C+D[1]*x)}function co(u,i,o,m,x){const _=new n.Point(u,i);return o&&_._rotate(m?x:-x),_}class sl{constructor(i,o,m,x,_){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new no(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new ud(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,m,x){const _=m.getBucket(o),j=m.latestFeatureIndex;if(!_||!j||o.id!==_.layerIds[0])return;const S=_.layers[0].layout,C=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),I=m.tileSize/n.EXTENT,O=m.tileID.toUnwrapped();this.transform.setProjection(_.projection);const H=(J=m.tileID,ee=_.getProjection(),Y=this.transform,ee.name===this.projection?Y.calculateProjMatrix(J.toUnwrapped()):Hn(Y,ee,J));var J,ee,Y;const se=S.get("text-pitch-alignment")==="map",F=S.get("text-rotation-alignment")==="map";o.compileFilter();const Q=o.dynamicFilter(),ae=o.dynamicFilterNeedsFeature(),oe=this.transform.calculatePixelsToTileUnitsMatrix(m),_e=nn(H,m.tileID.canonical,se,F,this.transform,_.getProjection(),oe);let ve=null;if(se){const ke=ir(H,m.tileID.canonical,se,F,this.transform,_.getProjection(),oe);ve=n.multiply([],this.transform.labelPlaneMatrix,ke)}let be=null;Q&&m.latestFeatureIndex&&(be={unwrappedTileID:O,dynamicFilter:Q,dynamicFilterNeedsFeature:ae,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new gc(_.bucketInstanceId,j,_.sourceLayerIndex,_.index,m.tileID);const Me={bucket:_,layout:S,posMatrix:H,textLabelPlaneMatrix:_e,labelToScreenMatrix:ve,clippingData:be,scale:D,textPixelRatio:I,holdingForFade:m.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(x)for(const ke of _.sortKeyRanges){const{sortKey:Be,symbolInstanceStart:at,symbolInstanceEnd:ze}=ke;i.push({sortKey:Be,symbolInstanceStart:at,symbolInstanceEnd:ze,parameters:Me})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y,se,F,Q){const{textOffset0:ae,textOffset1:oe,crossTileID:_e}=H,ve=[ae,oe],be=lo(i,m,x,ve,_),Me=this.collisionIndex.placeCollisionBox(ee,_,o,co(be.x,be.y,j,S,this.transform.angle),O,C,D,I.predicate);if(se){const ke=ee.getSymbolInstanceIconSize(Q,this.transform.zoom,H.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,ke,se,co(be.x,be.y,j,S,this.transform.angle),O,C,D,I.predicate).box.length===0)return}if(Me.box.length>0){let ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(ke=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:ve,width:m,height:x,anchor:i,textScale:_,prevAnchor:ke},this.markUsedJustification(ee,i,H,Y),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,Y,H),this.placedOrientations[_e]=Y),{shift:be,placedGlyphBoxes:Me}}}placeLayerBucketPart(i,o,m,x){const{bucket:_,layout:j,posMatrix:S,textLabelPlaneMatrix:C,labelToScreenMatrix:D,clippingData:I,textPixelRatio:O,holdingForFade:H,collisionBoxArray:J,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:Y,collisionGroup:se}=i.parameters,F=j.get("text-optional"),Q=j.get("icon-optional"),ae=j.get("text-allow-overlap"),oe=j.get("icon-allow-overlap"),_e=j.get("text-rotation-alignment")==="map",ve=j.get("text-pitch-alignment")==="map",be=j.get("icon-text-fit")!=="none",Me=j.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let ke=ae&&(oe||!_.hasIconData()||Q),Be=oe&&(ae||!_.hasTextData()||F);!_.collisionArrays&&J&&_.deserializeCollisionBoxes(J),m&&x&&_.updateCollisionDebugBuffers(this.transform.zoom,J);const at=(ze,Qe,Ve)=>{const{crossTileID:nt,numVerticalGlyphVertices:Fe}=ze;if(I){const Bs={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ss=null;if(I.dynamicFilterNeedsFeature){const fs=this.retainedQueryData[_.bucketInstanceId];Ss=I.featureIndex.loadFeature({featureIndex:ze.featureIndex,bucketIndex:fs.bucketIndex,sourceLayerIndex:fs.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(Bs,Ss,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new n.Point(ze.tileAnchorX,ze.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[nt]=new ao(!1,!1,!1,!0),void o.add(nt)}if(o.has(nt))return;if(H)return void(this.placements[nt]=new ao(!1,!1,!1));let Xe=!1,lt=!1,st=!0,ct=!1,Dt=!1,Vt=null,At={box:null,offscreen:null,occluded:null},Ot={box:null,offscreen:null,occluded:null},is=null,ts=null,Pt=null,vs=0,ws=0,js=0;Ve.textFeatureIndex?vs=Ve.textFeatureIndex:ze.useRuntimeCollisionCircles&&(vs=ze.featureIndex),Ve.verticalTextFeatureIndex&&(ws=Ve.verticalTextFeatureIndex);const Ns=Bs=>{Bs.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const Ss=this.transform.elevation;(Ss||Bs.elevation)&&(Bs.elevation=Ss?Ss.getAtTileOffset(Bs.tileID,Bs.tileAnchorX,Bs.tileAnchorY):0)},qr=Ve.textBox;if(qr){Ns(qr);const Bs=fs=>{let nr=n.WritingMode.horizontal;if(_.allowVerticalPlacement&&!fs&&this.prevPlacement){const Xr=this.prevPlacement.placedOrientations[nt];Xr&&(this.placedOrientations[nt]=Xr,nr=Xr,this.markUsedOrientation(_,nr,ze))}return nr},Ss=(fs,nr)=>{if(_.allowVerticalPlacement&&Fe>0&&Ve.verticalTextBox){for(const Xr of _.writingModes)if(Xr===n.WritingMode.vertical?(At=nr(),Ot=At):At=fs(),At&&At.box&&At.box.length)break}else At=fs()};if(j.get("text-variable-anchor")){let fs=j.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt]){const zs=this.prevPlacement.variableOffsets[nt];fs.indexOf(zs.anchor)>0&&(fs=fs.filter(ti=>ti!==zs.anchor),fs.unshift(zs.anchor))}const nr=(zs,ti,kl)=>{const sa=_.getSymbolInstanceTextSize(ee,ze,this.transform.zoom,Qe),Ao=(zs.x2-zs.x1)*sa+2*zs.padding,mn=(zs.y2-zs.y1)*sa+2*zs.padding,Mn=be&&!oe?ti:null;Mn&&Ns(Mn);let ra={box:[],offscreen:!1,occluded:!1};const Al=ae?2*fs.length:fs.length;for(let Mo=0;Mo<Al;++Mo){const au=this.attemptAnchorPlacement(fs[Mo%fs.length],zs,Ao,mn,sa,_e,ve,O,S,se,Mo>=fs.length,ze,Qe,_,kl,Mn,ee,Y);if(au&&(ra=au.placedGlyphBoxes,ra&&ra.box&&ra.box.length)){Xe=!0,Vt=au.shift;break}}return ra};Ss(()=>nr(qr,Ve.iconBox,n.WritingMode.horizontal),()=>{const zs=Ve.verticalTextBox;return zs&&Ns(zs),_.allowVerticalPlacement&&!(At&&At.box&&At.box.length)&&Fe>0&&zs?nr(zs,Ve.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),At&&(Xe=At.box,st=At.offscreen,ct=At.occluded);const Xr=Bs(!(!At||!At.box));if(!Xe&&this.prevPlacement){const zs=this.prevPlacement.variableOffsets[nt];zs&&(this.variableOffsets[nt]=zs,this.markUsedJustification(_,zs.anchor,ze,Xr))}}else{const fs=(nr,Xr)=>{const zs=_.getSymbolInstanceTextSize(ee,ze,this.transform.zoom,Qe),ti=this.collisionIndex.placeCollisionBox(_,zs,nr,new n.Point(0,0),ae,O,S,se.predicate);return ti&&ti.box&&ti.box.length&&(this.markUsedOrientation(_,Xr,ze),this.placedOrientations[nt]=Xr),ti};Ss(()=>fs(qr,n.WritingMode.horizontal),()=>{const nr=Ve.verticalTextBox;return _.allowVerticalPlacement&&Fe>0&&nr?(Ns(nr),fs(nr,n.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Bs(!!(At&&At.box&&At.box.length))}}if(is=At,Xe=is&&is.box&&is.box.length>0,st=is&&is.offscreen,ct=is&&is.occluded,ze.useRuntimeCollisionCircles){const Bs=_.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex>=0?ze.centerJustifiedTextSymbolIndex:ze.verticalPlacedTextSymbolIndex),Ss=n.evaluateSizeForFeature(_.textSizeData,ee,Bs),fs=j.get("text-padding");ts=this.collisionIndex.placeCollisionCircles(_,ae,Bs,_.lineVertexArray,_.glyphOffsetArray,Ss,S,C,D,m,ve,se.predicate,ze.collisionCircleDiameter*Ss/n.ONE_EM,fs,this.retainedQueryData[_.bucketInstanceId].tileID),Xe=ae||ts.circles.length>0&&!ts.collisionDetected,st=st&&ts.offscreen,ct=ts.occluded}if(Ve.iconFeatureIndex&&(js=Ve.iconFeatureIndex),Ve.iconBox){const Bs=Ss=>{Ns(Ss);const fs=be&&Vt?co(Vt.x,Vt.y,_e,ve,this.transform.angle):new n.Point(0,0),nr=_.getSymbolInstanceIconSize(Y,this.transform.zoom,ze.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,nr,Ss,fs,oe,O,S,se.predicate)};Ot&&Ot.box&&Ot.box.length&&Ve.verticalIconBox?(Pt=Bs(Ve.verticalIconBox),lt=Pt.box.length>0):(Pt=Bs(Ve.iconBox),lt=Pt.box.length>0),st=st&&Pt.offscreen,Dt=Pt.occluded}const Er=F||ze.numHorizontalGlyphVertices===0&&Fe===0,ji=Q||ze.numIconVertices===0;if(Er||ji?ji?Er||(lt=lt&&Xe):Xe=lt&&Xe:lt=Xe=lt&&Xe,Xe&&is&&is.box&&this.collisionIndex.insertCollisionBox(is.box,j.get("text-ignore-placement"),_.bucketInstanceId,Ot&&Ot.box&&ws?ws:vs,se.ID),lt&&Pt&&this.collisionIndex.insertCollisionBox(Pt.box,j.get("icon-ignore-placement"),_.bucketInstanceId,js,se.ID),ts&&(Xe&&this.collisionIndex.insertCollisionCircles(ts.circles,j.get("text-ignore-placement"),_.bucketInstanceId,vs,se.ID),m)){const Bs=_.bucketInstanceId;let Ss=this.collisionCircleArrays[Bs];Ss===void 0&&(Ss=this.collisionCircleArrays[Bs]=new oo);for(let fs=0;fs<ts.circles.length;fs+=4)Ss.circles.push(ts.circles[fs+0]),Ss.circles.push(ts.circles[fs+1]),Ss.circles.push(ts.circles[fs+2]),Ss.circles.push(ts.collisionDetected?1:0)}const Gi=_.projection.name!=="globe";ke=ke&&(Gi||!ct),Be=Be&&(Gi||!Dt),this.placements[nt]=new ao(Xe||ke,lt||Be,st||_.justReloaded),o.add(nt)};if(Me){const ze=_.getSortedSymbolIndexes(this.transform.angle);for(let Qe=ze.length-1;Qe>=0;--Qe){const Ve=ze[Qe];at(_.symbolInstances.get(Ve),Ve,_.collisionArrays[Ve])}}else for(let ze=i.symbolInstanceStart;ze<i.symbolInstanceEnd;ze++)at(_.symbolInstances.get(ze),ze,_.collisionArrays[ze]);if(m&&_.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[_.bucketInstanceId];n.invert(ze.invProjMatrix,S),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(i,o,m,x){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:C,crossTileID:D}=m,I=n.getAnchorJustification(o),O=x===n.WritingMode.vertical?C:I==="left"?_:I==="center"?j:I==="right"?S:-1;_>=0&&(i.text.placedSymbolArray.get(_).crossTileID=O>=0&&_!==O?0:D),j>=0&&(i.text.placedSymbolArray.get(j).crossTileID=O>=0&&j!==O?0:D),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=O>=0&&S!==O?0:D),C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=O>=0&&C!==O?0:D)}markUsedOrientation(i,o,m){const x=o===n.WritingMode.horizontal||o===n.WritingMode.horizontalOnly?o:0,_=o===n.WritingMode.vertical?o:0,{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D}=m,I=i.text.placedSymbolArray;j>=0&&(I.get(j).placedOrientation=x),S>=0&&(I.get(S).placedOrientation=x),C>=0&&(I.get(C).placedOrientation=x),D>=0&&(I.get(D).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let m=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const x=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},j=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const C in this.placements){const D=this.placements[C],I=_[C];I?(this.opacities[C]=new an(I,x,D.text,D.icon,null,D.clipped),m=m||D.text!==I.text.placed||D.icon!==I.icon.placed):(this.opacities[C]=new an(null,x,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const C in _){const D=_[C];if(!this.opacities[C]){const I=new an(D,x,!1,!1);I.isHidden()||(this.opacities[C]=I,m=m||D.text.placed||D.icon.placed)}}for(const C in j)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=j[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const m=new Set;for(const x of o){const _=x.getBucket(i);_&&x.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,m,x.collisionBoxArray)}}updateBucketOpacities(i,o,m){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const x=i.layers[0].layout,_=!!i.layers[0].dynamicFilter(),j=new an(null,0,!1,!1,!0),S=x.get("text-allow-overlap"),C=x.get("icon-allow-overlap"),D=x.get("text-variable-anchor"),I=x.get("text-rotation-alignment")==="map",O=x.get("text-pitch-alignment")==="map",H=x.get("icon-text-fit")!=="none",J=new an(null,0,S&&(C||!i.hasIconData()||x.get("icon-optional")),C&&(S||!i.hasTextData()||x.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const ee=(se,F,Q)=>{for(let ae=0;ae<F/4;ae++)se.opacityVertexArray.emplaceBack(Q)};let Y=0;for(let se=0;se<i.symbolInstances.length;se++){const F=i.symbolInstances.get(se),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:ae,crossTileID:oe,numIconVertices:_e}=F,ve=o.has(oe);let be=this.opacities[oe];ve?be=j:be||(be=J,this.opacities[oe]=be),o.add(oe);const Me=Q>0||ae>0,ke=_e>0,Be=this.placedOrientations[oe],at=Be===n.WritingMode.vertical,ze=Be===n.WritingMode.horizontal||Be===n.WritingMode.horizontalOnly;if(!Me&&!ke||be.isHidden()||Y++,Me){const Qe=uo(be.text);ee(i.text,Q,at?Zs:Qe),ee(i.text,ae,ze?Zs:Qe);const Ve=be.text.isHidden(),{leftJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:Fe,rightJustifiedTextSymbolIndex:Xe,verticalPlacedTextSymbolIndex:lt}=F,st=i.text.placedSymbolArray,ct=Ve||at?1:0;nt>=0&&(st.get(nt).hidden=ct),Fe>=0&&(st.get(Fe).hidden=ct),Xe>=0&&(st.get(Xe).hidden=ct),lt>=0&&(st.get(lt).hidden=Ve||ze?1:0);const Dt=this.variableOffsets[oe];Dt&&this.markUsedJustification(i,Dt.anchor,F,Be);const Vt=this.placedOrientations[oe];Vt&&(this.markUsedJustification(i,"left",F,Vt),this.markUsedOrientation(i,Vt,F))}if(ke){const Qe=uo(be.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:nt}=F,Fe=i.icon.placedSymbolArray,Xe=be.icon.isHidden()?1:0;Ve>=0&&(ee(i.icon,_e,at?Zs:Qe),Fe.get(Ve).hidden=Xe),nt>=0&&(ee(i.icon,F.numVerticalIconVertices,ze?Zs:Qe),Fe.get(nt).hidden=Xe)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Qe=i.collisionArrays[se];if(Qe){let Ve=new n.Point(0,0),nt=!0;if(Qe.textBox||Qe.verticalTextBox){if(D){const Xe=this.variableOffsets[oe];Xe?(Ve=lo(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textScale),I&&Ve._rotate(O?this.transform.angle:-this.transform.angle)):nt=!1}_&&(nt=!be.clipped),Qe.textBox&&ya(i.textCollisionBox.collisionVertexArray,be.text.placed,!nt||at,Ve.x,Ve.y),Qe.verticalTextBox&&ya(i.textCollisionBox.collisionVertexArray,be.text.placed,!nt||ze,Ve.x,Ve.y)}const Fe=nt&&!!(!ze&&Qe.verticalIconBox);Qe.iconBox&&ya(i.iconCollisionBox.collisionVertexArray,be.icon.placed,Fe,H?Ve.x:0,H?Ve.y:0),Qe.verticalIconBox&&ya(i.iconCollisionBox.collisionVertexArray,be.icon.placed,!Fe,H?Ve.x:0,H?Ve.y:0)}}}if(i.fullyClipped=Y===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=se.invProjMatrix,i.placementViewportMatrix=se.viewportMatrix,i.collisionCircleArray=se.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const m=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function ya(u,i,o,m,x){u.emplaceBack(i?1:0,o?1:0,m||0,x||0),u.emplaceBack(i?1:0,o?1:0,m||0,x||0),u.emplaceBack(i?1:0,o?1:0,m||0,x||0),u.emplaceBack(i?1:0,o?1:0,m||0,x||0)}const Yr=Math.pow(2,25),Js=Math.pow(2,24),xc=Math.pow(2,17),yc=Math.pow(2,16),ei=Math.pow(2,9),bi=Math.pow(2,8),dd=Math.pow(2,1);function uo(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const i=u.placed?1:0,o=Math.floor(127*u.opacity);return o*Yr+i*Js+o*xc+i*yc+o*ei+i*bi+o*dd+i}const Zs=0;class ho{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,m,x,_){const j=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(j,x,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<j.length;){const S=j[this._currentPartIndex];if(o.placeLayerBucketPart(S,this._seenCrossTileIDs,m,S.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class _c{constructor(i,o,m,x,_,j,S,C){this.placement=new sl(i,_,j,S,C),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,o,m){const x=n.exported.now(),_=()=>{const j=n.exported.now()-x;return!this._forceFullPlacement&&j>2};for(;this._currentPlacementIndex>=0;){const j=o[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=S)&&(!j.maxzoom||j.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ho(j)),this._inProgressLayer.continuePlacement(m[j.source],this.placement,this._showCollisionBoxes,j,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Xn=512/n.EXTENT/2;class Lr{constructor(i,o,m){this.tileID=i,this.bucketInstanceId=m,this.index=new n.KDBush(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*n.EXTENT,_=i.canonical.y*n.EXTENT;for(let j=0;j<o.length;j++){const{key:S,crossTileID:C,tileAnchorX:D,tileAnchorY:I}=o.get(j),O=Math.floor((x+D)*Xn),H=Math.floor((_+I)*Xn);this.index.add(O,H),this.keys.push(S),this.crossTileIDs.push(C)}this.index.finish()}findMatches(i,o,m){const x=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),_=Xn/Math.pow(2,o.canonical.z-this.tileID.canonical.z),j=o.canonical.x*n.EXTENT,S=o.canonical.y*n.EXTENT;for(let C=0;C<i.length;C++){const D=i.get(C);if(D.crossTileID)continue;const{key:I,tileAnchorX:O,tileAnchorY:H}=D,J=Math.floor((j+O)*_),ee=Math.floor((S+H)*_),Y=this.index.range(J-x,ee-x,J+x,ee+x);for(const se of Y){const F=this.crossTileIDs[se];if(this.keys[se]===I&&!m.has(F)){m.add(F),D.crossTileID=F;break}}}}}class bc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const m in this.indexes){const x=this.indexes[m],_={};for(const j in x){const S=x[j];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),_[S.tileID.key]=S}this.indexes[m]=_}this.lng=i}addBucket(i,o,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const j=this.indexes[_];if(Number(_)>i.overscaledZ)for(const S in j){const C=j[S];C.tileID.isChildOf(i)&&C.findMatches(o.symbolInstances,i,x)}else{const S=j[i.scaledTo(Number(_)).key];S&&S.findMatches(o.symbolInstances,i,x)}}for(let _=0;_<o.symbolInstances.length;_++){const j=o.symbolInstances.get(_);j.crossTileID||(j.crossTileID=m.generate(),x.add(j.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Lr(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const m of o.crossTileIDs)this.usedCrossTileIDs[i].delete(m)}removeStaleBuckets(i){let o=!1;for(const m in this.indexes){const x=this.indexes[m];for(const _ in x)i[x[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[_]),delete x[_],o=!0)}return o}}class on{constructor(){this.layerIndexes={},this.crossTileIDs=new bc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,m,x){let _=this.layerIndexes[i.id];_===void 0&&(_=this.layerIndexes[i.id]=new vc);let j=!1;const S={};x.name!=="globe"&&_.handleWrapJump(m);for(const C of o){const D=C.getBucket(i);D&&i.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,D,this.crossTileIDs)&&(j=!0),S[D.bucketInstanceId]=!0)}return _.removeStaleBuckets(S)&&(j=!0),j}pruneUnusedLayers(i){const o={};i.forEach(m=>{o[m]=!0});for(const m in this.layerIndexes)o[m]||delete this.layerIndexes[m]}}const kn=(u,i)=>n.emitValidationErrors(u,i&&i.filter(o=>o.identifier!=="source.canvas")),rl=n.pick(xs,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ym=n.pick(xs,["setCenter","setZoom","setBearing","setPitch"]),wc={version:8,layers:[],sources:{}},_a={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Vi extends n.Evented{constructor(i,o={}){super(),this.map=i,this.dispatcher=new ns(ga(),this),this.imageManager=new Pe,this.imageManager.setEventedParent(this),this.glyphManager=new n.GlyphManager(i._requestManager,o.localFontFamily?n.LocalGlyphMode.all:o.localIdeographFontFamily?n.LocalGlyphMode.ideographs:n.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new on,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const m=this;this._rtlTextPluginCallback=Vi.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(_,j)=>{if(n.triggerPluginCompletionEvent(_),j&&j.every(S=>S))for(const S in m._sourceCaches){const C=m._sourceCaches[S],D=C.getSource().type;D!=="vector"&&D!=="geojson"||C.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const _=this.getSource(x.sourceId);if(_&&_.vectorLayerIds)for(const j in this._layers){const S=this._layers[j];S.source===_.id&&this._validateLayer(S)}})}loadURL(i,o={}){this.fire(new n.Event("dataloading",{dataType:"style"}));const m=typeof o.validate=="boolean"?o.validate:!n.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,o.accessToken);const x=this.map._requestManager.transformRequest(i,n.ResourceType.Style);this._request=n.getJSON(x,(_,j)=>{this._request=null,_?this.fire(new n.ErrorEvent(_)):j&&this._load(j,m)})}loadJSON(i,o={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(wc,!1)}_updateLayerCount(i,o){const m=o?1:-1;i.is3D()&&(this._num3DLayers+=m),i.type==="circle"&&(this._numCircleLayers+=m),i.type==="symbol"&&(this._numSymbolLayers+=m)}_load(i,o){if(o&&kn(this,n.validateStyle(i)))return;this._loaded=!0,this.stylesheet=n.clone$1(i),this._updateMapProjection();for(const x in i.sources)this.addSource(x,i.sources[x],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const m=ad(this.stylesheet.layers);this._order=m.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of m){const _=n.createStyleLayer(x);_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new rt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(o,m,x){let _,j,S;const C=n.exported.devicePixelRatio>1?"@2x":"";let D=n.getJSON(m.transformRequest(m.normalizeSpriteURL(o,C,".json"),n.ResourceType.SpriteJSON),(H,J)=>{D=null,S||(S=H,_=J,O())}),I=n.getImage(m.transformRequest(m.normalizeSpriteURL(o,C,".png"),n.ResourceType.SpriteImage),(H,J)=>{I=null,S||(S=H,j=J,O())});function O(){if(S)x(S);else if(_&&j){const H=n.exported.getImageData(j),J={};for(const ee in _){const{width:Y,height:se,x:F,y:Q,sdf:ae,pixelRatio:oe,stretchX:_e,stretchY:ve,content:be}=_[ee],Me=new n.RGBAImage({width:Y,height:se});n.RGBAImage.copy(H,Me,{x:F,y:Q},{x:0,y:0},{width:Y,height:se}),J[ee]={data:Me,pixelRatio:oe,sdf:ae,stretchX:_e,stretchY:ve,content:be}}x(null,J)}}return{cancel(){D&&(D.cancel(),D=null),I&&(I.cancel(),I=null)}}}(i,this.map._requestManager,(o,m)=>{if(this._spriteRequest=null,o)this.fire(new n.ErrorEvent(o));else if(m)for(const x in m)this.imageManager.addImage(x,m[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(i){const o=this.getSource(i.source);if(!o)return;const m=i.sourceLayer;m&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(m)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const o=[];for(const m of i){const x=this._layers[m];x.type!=="custom"&&o.push(x.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&(typeof i.isLayerDraped=="function"?i.isLayerDraped():_a[i.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const o=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(x.length||_.length)&&this._updateWorkerLayers(x,_);for(const j in this._updatedSources){const S=this._updatedSources[j];S==="reload"?this._reloadSource(j):S==="clear"&&this._clearSource(j)}this._updateTilesForChangedImages();for(const j in this._updatedPaintProps)this._layers[j].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const m={};for(const x in this._sourceCaches){const _=this._sourceCaches[x];m[x]=_.used,_.used=!1}for(const x of this._order){const _=this._layers[x];if(_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)){const S=this._getLayerSourceCache(_);S&&(S.used=!0)}const j=this.map.painter;if(j){const S=_.getProgramIds();if(!S)continue;const C=_.getProgramConfiguration(i.zoom);for(const D of S)j.useProgram(D,C)}}for(const x in m){const _=this._sourceCaches[x];m[x]!==_.used&&_.getSource().fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),kn(this,n.validateStyle(i)))return!1;(i=n.clone$1(i)).layers=ad(i.layers);const o=function(x,_){if(!x)return[{command:xs.setStyle,args:[_]}];let j=[];try{if(!M(x.version,_.version))return[{command:xs.setStyle,args:[_]}];M(x.center,_.center)||j.push({command:xs.setCenter,args:[_.center]}),M(x.zoom,_.zoom)||j.push({command:xs.setZoom,args:[_.zoom]}),M(x.bearing,_.bearing)||j.push({command:xs.setBearing,args:[_.bearing]}),M(x.pitch,_.pitch)||j.push({command:xs.setPitch,args:[_.pitch]}),M(x.sprite,_.sprite)||j.push({command:xs.setSprite,args:[_.sprite]}),M(x.glyphs,_.glyphs)||j.push({command:xs.setGlyphs,args:[_.glyphs]}),M(x.transition,_.transition)||j.push({command:xs.setTransition,args:[_.transition]}),M(x.light,_.light)||j.push({command:xs.setLight,args:[_.light]}),M(x.fog,_.fog)||j.push({command:xs.setFog,args:[_.fog]}),M(x.projection,_.projection)||j.push({command:xs.setProjection,args:[_.projection]});const S={},C=[];(function(O,H,J,ee){let Y;for(Y in H=H||{},O=O||{})O.hasOwnProperty(Y)&&(H.hasOwnProperty(Y)||ro(Y,J,ee));for(Y in H){if(!H.hasOwnProperty(Y))continue;const se=H[Y];O.hasOwnProperty(Y)?M(O[Y],se)||(O[Y].type==="geojson"&&se.type==="geojson"&&tl(O,H,Y)?J.push({command:xs.setGeoJSONSourceData,args:[Y,se.data]}):hc(Y,H,J,ee)):dc(Y,H,J)}})(x.sources,_.sources,C,S);const D=[];x.layers&&x.layers.forEach(O=>{O.source&&S[O.source]?j.push({command:xs.removeLayer,args:[O.id]}):D.push(O)});let I=x.terrain;I&&S[I.source]&&(j.push({command:xs.setTerrain,args:[void 0]}),I=void 0),j=j.concat(C),M(I,_.terrain)||j.push({command:xs.setTerrain,args:[_.terrain]}),function(O,H,J){H=H||[];const ee=(O=O||[]).map(sn),Y=H.map(sn),se=O.reduce(mc,{}),F=H.reduce(mc,{}),Q=ee.slice(),ae=Object.create(null);let oe,_e,ve,be,Me,ke,Be;for(oe=0,_e=0;oe<ee.length;oe++)ve=ee[oe],F.hasOwnProperty(ve)?_e++:(J.push({command:xs.removeLayer,args:[ve]}),Q.splice(Q.indexOf(ve,_e),1));for(oe=0,_e=0;oe<Y.length;oe++)ve=Y[Y.length-1-oe],Q[Q.length-1-oe]!==ve&&(se.hasOwnProperty(ve)?(J.push({command:xs.removeLayer,args:[ve]}),Q.splice(Q.lastIndexOf(ve,Q.length-_e),1)):_e++,ke=Q[Q.length-oe],J.push({command:xs.addLayer,args:[F[ve],ke]}),Q.splice(Q.length-oe,0,ve),ae[ve]=!0);for(oe=0;oe<Y.length;oe++)if(ve=Y[oe],be=se[ve],Me=F[ve],!ae[ve]&&!M(be,Me))if(M(be.source,Me.source)&&M(be["source-layer"],Me["source-layer"])&&M(be.type,Me.type)){for(Be in Bi(be.layout,Me.layout,J,ve,null,xs.setLayoutProperty),Bi(be.paint,Me.paint,J,ve,null,xs.setPaintProperty),M(be.filter,Me.filter)||J.push({command:xs.setFilter,args:[ve,Me.filter]}),M(be.minzoom,Me.minzoom)&&M(be.maxzoom,Me.maxzoom)||J.push({command:xs.setLayerZoomRange,args:[ve,Me.minzoom,Me.maxzoom]}),be)be.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?Bi(be[Be],Me[Be],J,ve,Be.slice(6),xs.setPaintProperty):M(be[Be],Me[Be])||J.push({command:xs.setLayerProperty,args:[ve,Be,Me[Be]]}));for(Be in Me)Me.hasOwnProperty(Be)&&!be.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?Bi(be[Be],Me[Be],J,ve,Be.slice(6),xs.setPaintProperty):M(be[Be],Me[Be])||J.push({command:xs.setLayerProperty,args:[ve,Be,Me[Be]]}))}else J.push({command:xs.removeLayer,args:[ve]}),ke=Q[Q.lastIndexOf(ve)+1],J.push({command:xs.addLayer,args:[Me,ke]})}(D,_.layers,j)}catch(S){console.warn("Unable to compute style diff:",S),j=[{command:xs.setStyle,args:[_]}]}return j}(this.serialize(),i).filter(x=>!(x.command in ym));if(o.length===0)return!1;const m=o.filter(x=>!(x.command in rl));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);return o.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,o){return this.getImage(i)?this.fire(new n.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,o),this._afterImageUpdated(i),this)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new n.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,o,m={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(n.validateSource,`sources.${i}`,o,null,m))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const x=es(i,o,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:x.serialize(),sourceId:i}));const _=j=>{const S=(j?"symbol:":"other:")+i,C=this._sourceCaches[S]=new n.SourceCache(S,x,j);(j?this._symbolSourceCaches:this._otherSourceCaches)[i]=C,C.style=this,C.onAdd(this.map)};_(!1),o.type!=="vector"&&o.type!=="geojson"||_(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const o=this.getSource(i);if(!o)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new n.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new n.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(i);for(const x of m)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getSource(i).setData(o),this._changed=!0}getSource(i){const o=this._getSourceCache(i);return o&&o.getSource()}_getSources(){const i=[];for(const o in this._otherSourceCaches){const m=this._getSourceCache(o);m&&i.push(m.getSource())}return i}addLayer(i,o,m={}){this._checkLoaded();const x=i.id;if(this.getLayer(x))return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let _;if(i.type==="custom"){if(kn(this,n.validateCustomStyleLayer(i)))return;_=n.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=n.clone$1(i),i=n.extend(i,{source:x})),this._validate(n.validateLayer,`layers.${x}`,i,{arrayIndex:-1},m))return;_=n.createStyleLayer(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const j=o?this._order.indexOf(o):this._order.length;if(o&&j===-1)return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(j,0,x),this._layerOrderChanged=!0,this._layers[x]=_;const S=this._getLayerSourceCache(_);if(this._removedLayers[x]&&_.source&&S&&_.type!=="custom"){const C=this._removedLayers[x];delete this._removedLayers[x],C.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",S.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const m=this._order.indexOf(i);this._order.splice(m,1);const x=o?this._order.indexOf(o):this._order.length;o&&x===-1?this.fire(new n.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(x,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,m){this._checkLoaded();const x=this.getLayer(i);x?x.minzoom===o&&x.maxzoom===m||(o!=null&&(x.minzoom=o),m!=null&&(x.maxzoom=m),this._updateLayer(x)):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,o,m={}){this._checkLoaded();const x=this.getLayer(i);if(x){if(!M(x.filter,o))return o==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(n.validateFilter,`layers.${x.id}.filter`,o,{layerType:x.type},m)||(x.filter=n.clone$1(o),this._updateLayer(x)))}else this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const o=this.getLayer(i);return o&&n.clone$1(o.filter)}setLayoutProperty(i,o,m,x={}){this._checkLoaded();const _=this.getLayer(i);_?M(_.getLayoutProperty(o),m)||(_.setLayoutProperty(o,m,x),this._updateLayer(_)):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,o){const m=this.getLayer(i);if(m)return m.getLayoutProperty(o);this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,o,m,x={}){this._checkLoaded();const _=this.getLayer(i);_?M(_.getPaintProperty(o),m)||(_.setPaintProperty(o,m,x)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,o){const m=this.getLayer(i);return m&&m.getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const m=i.source,x=i.sourceLayer,_=this.getSource(m);if(!_)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const j=_.type;if(j==="geojson"&&x)return void this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(j==="vector"&&!x)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(m);for(const C of S)C.setFeatureState(x,i.id,o)}removeFeatureState(i,o){this._checkLoaded();const m=i.source,x=this.getSource(m);if(!x)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const _=x.type,j=_==="vector"?i.sourceLayer:void 0;if(_==="vector"&&!j)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(m);for(const C of S)C.removeFeatureState(j,i.id,o)}getFeatureState(i){this._checkLoaded();const o=i.source,m=i.sourceLayer,x=this.getSource(o);if(x){if(x.type!=="vector"||m)return i.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(m,i.id);this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new n.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const o in this._sourceCaches){const m=this._sourceCaches[o].getSource();i[m.id]||(i[m.id]=m.serialize())}return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const o=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",o.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=j=>this._layers[j].type==="fill-extrusion",m={},x=[];for(let j=this._order.length-1;j>=0;j--){const S=this._order[j];if(o(S)){m[S]=j;for(const C of i){const D=C[S];if(D)for(const I of D)x.push(I)}}}x.sort((j,S)=>S.intersectionZ-j.intersectionZ);const _=[];for(let j=this._order.length-1;j>=0;j--){const S=this._order[j];if(o(S))for(let C=x.length-1;C>=0;C--){const D=x[C].feature;if(m[D.layer.id]<j)break;_.push(D),x.pop()}else for(const C of i){const D=C[S];if(D)for(const I of D)_.push(I.feature)}}return _}queryRenderedFeatures(i,o,m){o&&o.filter&&this._validate(n.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const x={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of o.layers){const D=this._layers[C];if(!D)return this.fire(new n.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];x[D.source]=!0}}const _=[];o.availableImages=this._availableImages;const j=o&&o.layers?o.layers.some(C=>{const D=this.getLayer(C);return D&&D.is3D()}):this.has3DLayers(),S=mr.createFromScreenPoints(i,m);for(const C in this._sourceCaches){const D=this._sourceCaches[C].getSource().id;o.layers&&!x[D]||_.push(Vs(this._sourceCaches[C],this._layers,this._serializedLayers,S,o,m,j,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(C,D,I,O,H,J,ee){const Y={},se=J.queryRenderedSymbols(O),F=[];for(const Q of Object.keys(se).map(Number))F.push(ee[Q]);F.sort(Ur);for(const Q of F){const ae=Q.featureIndex.lookupSymbolFeatures(se[Q.bucketInstanceId],D,Q.bucketIndex,Q.sourceLayerIndex,H.filter,H.layers,H.availableImages,C);for(const oe in ae){const _e=Y[oe]=Y[oe]||[],ve=ae[oe];ve.sort((be,Me)=>{const ke=Q.featureSortOrder;if(ke){const Be=ke.indexOf(be.featureIndex);return ke.indexOf(Me.featureIndex)-Be}return Me.featureIndex-be.featureIndex});for(const be of ve)_e.push(be)}}for(const Q in Y)Y[Q].forEach(ae=>{const oe=ae.feature,_e=I(C[Q]);if(!_e)return;const ve=_e.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ve});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(n.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const m=this._getSourceCaches(i);let x=[];for(const _ of m)x=x.concat(rr(_,o));return x}addSourceType(i,o,m){return Vi.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(Vi.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const m=this.light.getLight();let x=!1;for(const j in i)if(!M(i[j],m[j])){x=!0;break}if(!x)return;const _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,o),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,o=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=i;if(o===1){if(typeof m.source=="object"){const x="terrain-dem-src";this.addSource(x,m.source),m=n.clone$1(m),m=n.extend(m,{source:x})}if(this._validate(n.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,o)}else{const x=this.terrain,_=x.get();for(const j of Object.keys(n.spec.terrain))!m.hasOwnProperty(j)&&n.spec.terrain[j].default&&(m[j]=n.spec.terrain[j].default);for(const j in m)if(!M(m[j],_[j])){x.set(m),this.stylesheet.terrain=m;const S=this._setTransitionParameters({duration:0});x.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new Os(i,this.map.transform);this.stylesheet.fog=i;const m=this._setTransitionParameters({duration:0});o.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,m=o.get();Object.keys(i).length===0&&o.set(i);for(const x in i)if(!M(i[x],m[x])){o.set(i),this.stylesheet.fog=i;const _=this._setTransitionParameters({duration:0});o.updateTransitions(_);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:n.exported.now(),transition:n.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(m=>this.isLayerDraped(this._layers[m])),o=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const m=this.terrain=new yt(i,o);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,m,x,_={}){return(!_||_.validate!==!1)&&kn(this,i.call(n.validateStyle,n.extend({key:o,style:this.serialize(),value:m,styleSpec:n.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const o=this._getSourceCaches(i);for(const m of o)m.clearTiles()}_reloadSource(i){const o=this._getSourceCaches(i);for(const m of o)m.resume(),m.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const o in this._sourceCaches)this._sourceCaches[o].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,m,x,_=!1){let j=!1,S=!1;const C={};for(const D of this._order){const I=this._layers[D];if(I.type!=="symbol")continue;if(!C[I.source]){const H=this._getLayerSourceCache(I);if(!H)continue;C[I.source]=H.getRenderableIds(!0).map(J=>H.getTileByID(J)).sort((J,ee)=>ee.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(ee.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(I,C[I.source],i.center.lng,i.projection);j=j||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new n.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),i.zoom))&&(this.pauseablePlacement=new _c(i,this._order,_,o,m,x,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),S=!0),j&&this.pauseablePlacement.placement.setStale()),S||j)for(const D of this._order){const I=this._layers[D];I.type==="symbol"&&this.placement.updateLayerOpacities(I,C[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o,m){this.imageManager.getImages(o.icons,m),this._updateTilesForChangedImages();const x=_=>{_&&_.setDependencies(o.tileID.key,o.type,o.icons)};x(this._otherSourceCaches[o.source]),x(this._symbolSourceCaches[o.source])}getGlyphs(i,o,m){this.glyphManager.getGlyphs(o.stacks,m)}getResource(i,o,m){return n.makeRequest(o,m)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this._getSourceCaches(i);return o.length===0?(this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):o.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Vi.getSourceType=function(u){return Ht[u]},Vi.setSourceType=function(u,i){Ht[u]=i},Vi.registerForPluginStateChange=n.registerForPluginStateChange;var jc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Kn="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ln=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,mo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,cn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let il={},ba={};const po=[];va(jc,po),va(ln,po),va(mo,po),va(cn,po),il=ys("",ln),ba=ys(cn,mo);const hd=ys(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),nl=jc,Nc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Sc={background:ys(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ys(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ys(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ys("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ys(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ys(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ys("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ys("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ys("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ys(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ys(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ys(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ys(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ys(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:ys(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:ys(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ys(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ys(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ys(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ys(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:ys(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:ys(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:ys(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:ys(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:ys(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ys(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Kn),skyboxGradient:ys(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Kn),skyboxCapture:ys(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ys(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ys(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function va(u,i){const o=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of o)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const _ of x)i.includes(_)||i.push(_)}}function ys(u,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},_=[...po];return va(u,_),va(i,_),{fragmentSource:u=u.replace(o,(j,S,C,D,I)=>(x[I]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${C} ${D} ${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = u_${I};
#endif
`)),vertexSource:i=i.replace(o,(j,S,C,D,I)=>{const O=D==="float"?"vec2":"vec4",H=I.match(/color/)?"color":O;return x[I]?S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${C} ${O} a_${I};
varying ${C} ${D} ${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${H}(a_${I}, u_${I}_t);
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${C} ${O} a_${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = a_${I};
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = unpack_mix_${H}(a_${I}, u_${I}_t);
#else
    ${C} ${D} ${I} = u_${I};
#endif
`}),staticAttributes:m,usedDefines:_}}class _m{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,m,x,_,j,S){this.context=i;let C=this.boundPaintVertexBuffers.length!==x.length;for(let I=0;!C&&I<x.length;I++)this.boundPaintVertexBuffers[I]!==x[I]&&(C=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let I=0;!D&&I<S.length;I++)this.boundDynamicVertexBuffers[I]!==S[I]&&(D=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==m||C||D||this.boundIndexBuffer!==_||this.boundVertexOffset!==j)this.freshBind(o,m,x,_,j,S);else{i.bindVertexArrayOES.set(this.vao);for(const I of S)I&&I.bind();_&&_.dynamicDraw&&_.bind()}}freshBind(i,o,m,x,_,j){let S;const C=i.numAttributes,D=this.context,I=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=j;else{S=D.currentNumAttributes||0;for(let O=C;O<S;O++)I.disableVertexAttribArray(O)}o.enableAttributes(I,i),o.bind(),o.setVertexAttribPointers(I,i,_);for(const O of m)O.enableAttributes(I,i),O.bind(),O.setVertexAttribPointers(I,i,_);for(const O of j)O&&(O.enableAttributes(I,i),O.bind(),O.setVertexAttribPointers(I,i,_));x&&x.bind(),D.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Tc(u,i){const o=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new n.MercatorCoordinate(0,m/o).toLngLat().lat,new n.MercatorCoordinate(0,(m+1)/o).toLngLat().lat]}function md(u,i,o,m,x,_,j){const S=u.context,C=S.gl,D=o.fbo;if(!D)return;u.prepareDrawTile();const I=u.useProgram("hillshade");S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get());const O=((Y,se,F,Q)=>{const ae=F.paint.get("hillshade-shadow-color"),oe=F.paint.get("hillshade-highlight-color"),_e=F.paint.get("hillshade-accent-color");let ve=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=Y.transform.angle);const be=!Y.options.moving;return{u_matrix:Q||Y.transform.calculateProjMatrix(se.tileID.toUnwrapped(),be),u_image:0,u_latrange:Tc(0,se.tileID),u_light:[F.paint.get("hillshade-exaggeration"),ve],u_shadow:ae,u_highlight:oe,u_accent:_e}})(u,o,m,u.terrain?i.projMatrix:null);u.prepareDrawProgram(S,I,i.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:J,tileBoundsSegments:ee}=u.getTileBoundsBuffers(o);I.draw(S,C.TRIANGLES,x,_,j,n.CullFaceMode.disabled,O,m.id,H,J,ee)}function Ec(u,i,o){if(!i.needsDEMTextureUpload)return;const m=u.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||u.getTileTexture(o.stride);const _=o.getPixels();i.demTexture?i.demTexture.update(_,{premultiply:!1}):i.demTexture=new n.Texture(m,_,x.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function pd(u,i,o,m,x,_){const j=u.context,S=j.gl;if(!i.dem)return;const C=i.dem;if(j.activeTexture.set(S.TEXTURE1),Ec(u,i,C),!i.demTexture)return;i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const D=C.dim;j.activeTexture.set(S.TEXTURE0);let I=i.fbo;if(!I){const ee=new n.Texture(j,{width:D,height:D,data:null},S.RGBA);ee.bind(S.LINEAR,S.CLAMP_TO_EDGE),I=i.fbo=j.createFramebuffer(D,D,!0),I.colorAttachment.set(ee.texture)}j.bindFramebuffer.set(I.framebuffer),j.viewport.set([0,0,D,D]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:H,tileBoundsSegments:J}=u.getMercatorTileBoundsBuffers();u.useProgram("hillshadePrepare").draw(j,S.TRIANGLES,m,x,_,n.CullFaceMode.disabled,((ee,Y)=>{const se=Y.stride,F=n.create();return n.ortho(F,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(F,F,[0,-n.EXTENT,0]),{u_matrix:F,u_image:1,u_dimension:[se,se],u_zoom:ee.overscaledZ,u_unpack:Y.unpackVector}})(i.tileID,C),o.id,O,H,J),i.needsHillshadePrepare=!1}const Cc=u=>({u_matrix:new n.UniformMatrix4f(u),u_image0:new n.Uniform1i(u),u_skirt_height:new n.Uniform1f(u)}),wa=(u,i)=>({u_matrix:u,u_image0:0,u_skirt_height:i}),al=(u,i,o,m,x,_,j,S,C,D,I,O,H,J,ee)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:o,u_zoom_transition:x,u_merc_center:_,u_image0:0,u_frustum_tl:j,u_frustum_tr:S,u_frustum_br:C,u_frustum_bl:D,u_globe_pos:I,u_globe_radius:O,u_viewport:H,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:J});function ja(u,i){return u!=null&&i!=null&&!(!u.hasData()||!i.hasData())&&u.demTexture!=null&&i.demTexture!=null&&u.tileID.key!==i.tileID.key}const un=new class{constructor(){this.operations={}}newMorphing(u,i,o,m,x){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==o.tileID.key&&(_.queued=o)}else this.operations[u]={startTime:m,phase:0,duration:x,from:i,to:o,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const i=this.operations[u];return{from:i.from,to:i.to,phase:i.phase}}update(u){for(const i in this.operations){const o=this.operations[i];for(o.phase=(u-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,u)){delete this.operations[i];break}}}_nextOp(u,i){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=i,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Qn={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ol(u){return 6*Math.pow(1.5,22-u)}function fd(u,i){const o=1<<u.z;return!i&&(u.x===0||u.x===o-1)||u.y===0||u.y===o-1}const fo=u=>({u_matrix:u});function kc(u,i,o,m,x){if(x>0){const _=n.exported.now(),j=(_-u.timeAdded)/x,S=i?(_-i.timeAdded)/x:-1,C=o.getSource(),D=m.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),I=!i||Math.abs(i.tileID.overscaledZ-D)>Math.abs(u.tileID.overscaledZ-D),O=I&&u.refreshedUponExpiration?1:n.clamp(I?j:1-S,0,1);return u.refreshedUponExpiration&&j>=1&&(u.refreshedUponExpiration=!1),i?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class Ac extends n.SourceCache{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new ns(ga(),null),x=es("mock-dem",o,m,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class ll extends n.SourceCache{constructor(i){const o=es("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new ns(ga(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,m){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,j)=>{if(_[j.key]="",!this._tiles[j.key]){const S=new n.Tile(j,this._source.tileSize*j.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[j.key]=S}return _},{});for(const _ in this._tiles)_ in x||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const m=Object.values(o);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cl extends n.OverscaledTileID{constructor(i,o,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=m}}class Mc extends n.Elevation{constructor(i,o){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,_]=function(C){const D=new n.StructArrayLayout2i4,I=new n.StructArrayLayout3ui6,O=131;D.reserve(17161),I.reserve(33800);const H=n.EXTENT/128,J=n.EXTENT+H/2,ee=J+H;for(let se=-H;se<ee;se+=H)for(let F=-H;F<ee;F+=H){const Q=F<0||F>J||se<0||se>J?24575:0,ae=n.clamp(Math.round(F),0,n.EXTENT),oe=n.clamp(Math.round(se),0,n.EXTENT);D.emplaceBack(ae+Q,oe)}const Y=(se,F)=>{const Q=F*O+se;I.emplaceBack(Q+1,Q,Q+O),I.emplaceBack(Q+O,Q+O+1,Q+1)};for(let se=1;se<129;se++)for(let F=1;F<129;F++)Y(F,se);return[0,129].forEach(se=>{for(let F=0;F<130;F++)Y(F,se),Y(se,F)}),[D,I,32768]}(),j=i.context;this.gridBuffer=j.createVertexBuffer(m,n.posAttributes.members),this.gridIndexBuffer=j.createIndexBuffer(x),this.gridSegments=n.SegmentVector.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=n.SegmentVector.simpleSegment(0,0,m.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ll(o.map),this.orthoMatrix=n.create(),n.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.EXTENT,0,n.EXTENT,0,1);const S=j.gl;this._overlapStencilMode=new n.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ac(o.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,m){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const x=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const _=()=>{this.sourceCache.used&&n.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(o,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),o.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&n.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=o.getIds().map(C=>{const D=o.getTileByID(C).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(C,D){const I=D.transform.pointCoordinate(D.transform.getCameraPoint()),O=new n.Point(I.x,I.y);C.sort((H,J)=>{if(J.overscaledZ-H.overscaledZ)return J.overscaledZ-H.overscaledZ;const ee=new n.Point(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),Y=new n.Point(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),se=O.mult(1<<H.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(ee)-se.distSqr(Y)})})(x,this.painter),this._previousZoom=m.zoom;const _=this.proxyToSource||{};this.proxyToSource={},x.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const j=this._style._sourceCaches;for(const C in j){const D=j[C];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,i[C],_),D.usedForTerrain))continue;const I=i[C];D.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[o.id]=x.map(C=>new cl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=n.exported.now();const S={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const D=this.terrainTileForTile[C.key];if(!D)continue;const I=D.tileID.key;I in S||(this._visibleDemTiles.push(D),S[I]=I)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const m=this._findTileCoveringTileID(o,this.sourceCache);m&&(this.terrainTileForTile[o.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],_=x.dem;!_||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),Ec(this.painter,x,_))}}_prepareDemTileUniforms(i,o,m,x){if(!o||o.demTexture==null)return!1;const _=i.tileID.canonical,j=Math.pow(2,o.tileID.canonical.z-_.z),S=x||"";return m[`u_dem_tl${S}`]=[_.x*j%1,_.y*j%1],m[`u_dem_scale${S}`]=j,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,o=i.gl;if(!this._emptyDepthBufferTexture){const m=new n.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new n.Texture(i,m,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const o=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const _=x.dem.tree.minimums[0];return _>0&&i++,m+_},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new n.RGBAImage({width:1,height:1},new Uint8Array(n.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(x,{premultiply:!1}):_=this._emptyDEMTexture=new n.Texture(i,x,o.RGBA,{premultiply:!1}),_}setupElevationDraw(i,o,m){const x=this.painter.context,_=x.gl,j=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:n.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;j.u_dem_size=this.sourceCache.getSource().tileSize,j.u_exaggeration=this.exaggeration();let C=null,D=null,I=1;if(m&&m.morphing&&this._useVertexMorphing){const O=m.morphing.srcDemTile,H=m.morphing.dstDemTile;I=m.morphing.phase,O&&H&&(this._prepareDemTileUniforms(i,O,j,"_prev")&&(D=O),this._prepareDemTileUniforms(i,H,j)&&(C=H))}if(D&&C?(x.activeTexture.set(_.TEXTURE2),C.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),x.activeTexture.set(_.TEXTURE4),D.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),j.u_dem_lerp=I):(C=this.terrainTileForTile[i.tileID.key],x.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(i,C,j)?C.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),x.activeTexture.set(_.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(j.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),j.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&C){const O=(1<<C.tileID.canonical.z)*n.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;j.u_meter_to_dem=O}if(m&&m.labelPlaneMatrixInv&&(j.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),o.setTerrainUniformValues(x,j),this.painter.transform.projection.name==="globe"){const O=this.globeUniformValues(this.painter.transform,i.tileID.canonical,m&&m.useDenormalizedUpVectorScale);o.setGlobeUniformValues(x,O)}}globeUniformValues(i,o,m){const x=i.projection;return{u_tile_tl_up:x.upVector(o,0,0),u_tile_tr_up:x.upVector(o,n.EXTENT,0),u_tile_br_up:x.upVector(o,n.EXTENT,n.EXTENT),u_tile_bl_up:x.upVector(o,0,n.EXTENT),u_tile_up_scale:m?n.globeMetersToEcef(1):x.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,m=this.painter.context;i.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,_,j,S,C){if(x.transform.projection.name==="globe")(function(D,I,O,H,J){const ee=D.context,Y=ee.gl;let se,F;const Q=D.options.showTerrainWireframe?2:0,ae=D.transform,oe=n.globeUseCustomAntiAliasing(D,ee,ae),_e=(nt,Fe)=>{if(F===nt)return;const Xe=[Qn[nt],"PROJECTION_GLOBE_VIEW"];oe&&Xe.push("CUSTOM_ANTIALIASING"),Fe&&Xe.push(Qn[Q]),se=D.useProgram("globeRaster",null,Xe),F=nt},ve=D.colorModeForRenderPass(),be=new n.DepthMode(Y.LEQUAL,n.DepthMode.ReadWrite,D.depthRangeFor3D);un.update(J);const Me=n.calculateGlobeMercatorMatrix(ae),ke=[n.mercatorXfromLng(ae.center.lng),n.mercatorYfromLat(ae.center.lat)],Be=Q?[!1,!0]:[!1],at=D.globeSharedBuffers,ze=[ae.width*n.exported.devicePixelRatio,ae.height*n.exported.devicePixelRatio],Qe=Float32Array.from(ae.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};if(Be.forEach(nt=>{const Fe=D.transform,Xe=ol(Fe.zoom)*I.exaggeration();F=-1;const lt=nt?Y.LINES:Y.TRIANGLES;for(const st of H){const ct=O.getTile(st),Dt=n.StencilMode.disabled,Vt=I.prevTerrainTileForTile[st.key],At=I.terrainTileForTile[st.key];ja(Vt,At)&&un.newMorphing(st.key,Vt,At,J,250),ee.activeTexture.set(Y.TEXTURE0),ct.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const Ot=un.getMorphValuesForProxy(st.key),is=Ot?1:0;Ot&&n.extend$1(Ve,{morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:n.easeCubicInOut(Ot.phase)}});const ts=n.tileCornersToBounds(st.canonical),Pt=n.getLatitudinalLod(ts.getCenter().lat),vs=n.getGridMatrix(st.canonical,ts,Pt,Fe.worldSize/Fe._pixelsPerMercatorPixel),ws=n.globeNormalizeECEF(n.globeTileBounds(st.canonical)),js=al(Fe.projMatrix,Qe,Me,ws,n.globeToMercatorTransition(Fe.zoom),ke,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,ze,Xe,vs);if(_e(is,nt),I.setupElevationDraw(ct,se,Ve),D.prepareDrawProgram(ee,se,st.toUnwrapped()),at){const[Ns,qr,Er]=nt?at.getWirefameBuffers(D.context,Pt):at.getGridBuffers(Pt,Xe!==0);se.draw(ee,lt,be,Dt,ve,n.CullFaceMode.backCCW,js,"globe_raster",Ns,qr,Er)}}}),at){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&nt.push("CUSTOM_ANTIALIASING"),se=D.useProgram("globeRaster",null,nt);for(const Fe of H){const{x:Xe,y:lt,z:st}=Fe.canonical,ct=lt===0,Dt=lt===(1<<st)-1,[Vt,At,Ot,is]=at.getPoleBuffers(st);if(is&&(ct||Dt)){const ts=O.getTile(Fe);ee.activeTexture.set(Y.TEXTURE0),ts.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let Pt=n.globePoleMatrixForTile(st,Xe,ae);const vs=n.globeNormalizeECEF(n.globeTileBounds(Fe.canonical)),ws=(js,Ns)=>js.draw(ee,Y.TRIANGLES,be,n.StencilMode.disabled,ve,n.CullFaceMode.disabled,al(ae.projMatrix,Pt,Pt,vs,0,ke,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,ze,0),"globe_pole_raster",Ns,Ot,is);I.setupElevationDraw(ts,se,Ve),D.prepareDrawProgram(ee,se,Fe.toUnwrapped()),ct&&ws(se,Vt),Dt&&(Pt=n.scale(n.create(),Pt,[1,-1,1]),ws(se,At))}}}})(x,_,j,S,C);else{const D=x.context,I=D.gl;let O,H;const J=x.options.showTerrainWireframe?2:0,ee=(ae,oe)=>{if(H===ae)return;const _e=[Qn[ae]];oe&&_e.push(Qn[J]),O=x.useProgram("terrainRaster",null,_e),H=ae},Y=x.colorModeForRenderPass(),se=new n.DepthMode(I.LEQUAL,n.DepthMode.ReadWrite,x.depthRangeFor3D);un.update(C);const F=x.transform,Q=ol(F.zoom)*_.exaggeration();(J?[!1,!0]:[!1]).forEach(ae=>{H=-1;const oe=ae?I.LINES:I.TRIANGLES,[_e,ve]=ae?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const be of S){const Me=j.getTile(be),ke=n.StencilMode.disabled,Be=_.prevTerrainTileForTile[be.key],at=_.terrainTileForTile[be.key];ja(Be,at)&&un.newMorphing(be.key,Be,at,C,250),D.activeTexture.set(I.TEXTURE0),Me.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const ze=un.getMorphValuesForProxy(be.key),Qe=ze?1:0;let Ve;ze&&(Ve={morphing:{srcDemTile:ze.from,dstDemTile:ze.to,phase:n.easeCubicInOut(ze.phase)}});const nt=wa(be.projMatrix,fd(be.canonical,F.renderWorldCopies)?Q/10:Q);ee(Qe,ae),_.setupElevationDraw(Me,O,Ve),x.prepareDrawProgram(D,O,be.toUnwrapped()),O.draw(D,oe,se,ke,Y,n.CullFaceMode.backCCW,nt,"terrain_raster",_.gridBuffer,_e,ve)}})}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,m=this.painter.context,x=this.proxySourceCache,_=this.proxiedCoords[x.id],j=this._drapedRenderBatches.shift(),S=[],C=o.style.order;let D=0;for(const I of _){const O=x.getTileByID(I.proxyTileKey),H=x.proxyCachedFBO[I.key]?x.proxyCachedFBO[I.key][i]:void 0,J=H!==void 0?x.renderCache[H]:this.pool[D++],ee=H!==void 0;if(O.texture=J.tex,ee&&!J.dirty){S.push(O.tileID);continue}let Y;m.bindFramebuffer.set(J.fb.framebuffer),this.renderedToTile=!1,J.dirty&&(m.clear({color:n.Color.transparent,stencil:0}),J.dirty=!1);for(let se=j.start;se<=j.end;++se){const F=o.style._layers[C[se]];if(F.isHidden(o.transform.zoom))continue;const Q=o.style._getLayerSourceCache(F),ae=Q?this.proxyToSource[I.key][Q.id]:[I];if(!ae)continue;const oe=ae;m.viewport.set([0,0,J.fb.width,J.fb.height]),Y!==(Q?Q.id:null)&&(this._setupStencil(J,ae,F,Q),Y=Q?Q.id:null),o.renderLayer(o,Q,F,oe)}this.renderedToTile?(J.dirty=!0,S.push(O.tileID)):ee||--D,D===5&&(D=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,o.width,o.height]),j.end+1}postRender(){}renderCacheEfficiency(i){const o=i.order.length;if(o===0)return{efficiency:100};let m,x=0,_=0,j=!1;for(let S=0;S<o;++S){const C=i._layers[i.order[S]];this._style.isLayerDraped(C)?(j&&++x,++_):j||(j=!0,m=C.id)}return _===0?{efficiency:100}:{efficiency:100*(1-x/_),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const j=_.tileID,S=1<<j.overscaledZ,{x:C,y:D}=j.canonical,I=C/S,O=(C+1)/S,H=D/S,J=(D+1)/S;return{minx:I,miny:H,maxx:O,maxy:J,t:_.dem.tree.raycastRoot(I,H,O,J,i,o,m),tile:_}});x.sort((_,j)=>(_.t!==null?_.t:Number.MAX_VALUE)-(j.t!==null?j.t:Number.MAX_VALUE));for(const _ of x){if(_.t==null)return null;const j=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,i,o,m);if(j!=null)return j}return null}_createFBO(){const i=this.painter.context,o=i.gl,m=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const x=new n.Texture(i,{width:m[0],height:m[1],data:null},o.RGBA);x.bind(o.LINEAR,o.CLAMP_TO_EDGE);const _=i.createFramebuffer(m[0],m[1],!1);return _.colorAttachment.set(x.texture),_.depthAttachment=new Ne(i,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:_,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._layers[i],m=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!m&&o.shouldRedrape():!m&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const m of this._style._getSources())if(m instanceof bt){i=!0;break}if(!i)return;const o={};for(let m=0;m<this._style.order.length;++m){const x=this._style._layers[this._style.order[m]],_=this._style._getLayerSourceCache(x);if(_&&!o[_.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof n.ZoomDependentExpression){o[_.id]=!0;for(const j of this.proxyCoords){const S=this.proxyToSource[j.key][_.id];if(S)for(const C of S)this._clearRenderCacheForTile(_.id,C)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof ut){i=!0;break}if(!i)return;const o={};for(let m=0;m<this._style.order.length;++m){const x=this._style._layers[this._style.order[m]],_=this._style._getLayerSourceCache(x);if(!_||o[_.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const j=x.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][_.id];if(C)for(const D of C){const I=kc(_.getTile(D),_.findLoadedParent(D,0),_,this.painter.transform,j);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(_.id,D)}}}}_setupDrapedRenderBatches(){const i=this._style.order,o=i.length;if(o===0)return;const m=[];let x,_=0,j=this._style._layers[i[_]];for(;!this._style.isLayerDraped(j)&&j.isHidden(this.painter.transform.zoom)&&++_<o;)j=this._style._layers[i[_]];for(;_<o;++_){const S=this._style._layers[i[_]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?x===void 0&&(x=_):x!==void 0&&(m.push({start:x,end:_-1}),x=void 0))}x!==void 0&&m.push({start:x,end:_-1}),this._drapedRenderBatches=m}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const j=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<j.length;++S){const C=Object.values(j[S]);o.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let j=m.length-1;j>=0;j--){const S=m[j];if(o.getTileByID(S.key),o.proxyCachedFBO[S.key]!==void 0){const C=i[S.key],D=this.proxyToSource[S.key];let I=0;for(const O in D){const H=D[O],J=C[O];if(!J||J.length!==H.length||H.some((ee,Y)=>ee!==J[Y]||x[O]&&x[O].hasOwnProperty(ee.key))){I=-1;break}++I}for(const O in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][O]].dirty=I<0||I!==Object.values(C).length}}const _=[...this._drapedRenderBatches];_.sort((j,S)=>S.end-S.start-(j.end-j.start));for(const j of _)for(const S of m){if(o.proxyCachedFBO[S.key])continue;let C=o.renderCachePool.pop();C===void 0&&o.renderCache.length<50&&(C=o.renderCache.length,o.renderCache.push(this._createFBO())),C!==void 0&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][j.start]=C,o.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,j=_.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(m.isTileClipped())S=o.length,this._overlapStencilMode.test={func:j.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:j.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):n.StencilMode.disabled}_renderTileClippingMasks(i,o){const m=this.painter,x=this.painter.context,_=x.gl;m._tileClippingMaskIDs={},x.setColorMode(n.ColorMode.disabled),x.setDepthMode(n.DepthMode.disabled);const j=m.useProgram("clippingMask");for(const S of i){const C=m._tileClippingMaskIDs[S.key]=--o;j.draw(x,_.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,fo(S.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const m=[i.x,i.y,1,1];n.transformMat4$1(m,m,o.pixelMatrixInverse),n.scale$1(m,m,1/m[3]),m[0]/=o.worldSize,m[1]/=o.worldSize;const x=o._camera.position,_=n.mercatorZfromAltitude(1,o.center.lat),j=[x[0],x[1],x[2]/_,0],S=n.subtract([],m.slice(0,3),j);n.normalize(S,S);const C=this.raycast(j,S,this._exaggeration);return C!==null&&C?(n.scaleAndAdd(j,j,S,C),j[3]=j[2],j[2]*=_,j):null}drawDepth(){const i=this.painter,o=i.context,m=this.proxySourceCache,x=Math.ceil(i.width),_=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const j=o.gl,S=o.createFramebuffer(x,_,!0);o.activeTexture.set(j.TEXTURE0);const C=new n.Texture(o,{width:x,height:_,data:null},j.RGBA);C.bind(j.NEAREST,j.CLAMP_TO_EDGE),S.colorAttachment.set(C.texture);const D=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,x,_);S.depthAttachment.set(D),this._depthFBO=S,this._depthTexture=C}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,x,_]),function(j,S,C,D){if(j.transform.projection.name==="globe")return;const I=j.context,O=I.gl;I.clear({depth:1});const H=j.useProgram("terrainDepth"),J=new n.DepthMode(O.LESS,n.DepthMode.ReadWrite,j.depthRangeFor3D);for(const ee of D){const Y=C.getTile(ee),se=wa(ee.projMatrix,0);S.setupElevationDraw(Y,H),H.draw(I,O.TRIANGLES,J,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.backCCW,se,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,o,m){if(i.getSource()instanceof Yt)return this._setupProxiedCoordsForImageSource(i,o,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],_=this.proxyCoords;for(let S=0;S<_.length;S++){const C=_[S],D=this._findTileCoveringTileID(C,i);if(D){const I=this._createProxiedId(C,D,m[C.key]&&m[C.key][i.id]);x.push(I),this.proxyToSource[C.key][i.id]=[I]}}let j=!1;for(let S=0;S<o.length;S++){const C=i.getTile(o[S]);if(!C||!C.hasData())continue;const D=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==C.tileID.canonical.z){const I=this.proxyToSource[D.tileID.key][i.id],O=this._createProxiedId(D.tileID,C,m[D.tileID.key]&&m[D.tileID.key][i.id]);I?I.splice(I.length-1,0,O):this.proxyToSource[D.tileID.key][i.id]=[O],x.push(O),j=!0}}this._sourceTilesOverlap[i.id]=j}_setupProxiedCoordsForImageSource(i,o,m){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],_=this.proxyCoords,j=i.getSource(),S=new n.Point(j.tileID.x,j.tileID.y)._div(1<<j.tileID.z),C=j.coordinates.map(n.MercatorCoordinate.fromLngLat).reduce((I,O)=>(I.min.x=Math.min(I.min.x,O.x-S.x),I.min.y=Math.min(I.min.y,O.y-S.y),I.max.x=Math.max(I.max.x,O.x-S.x),I.max.y=Math.max(I.max.y,O.y-S.y),I),{min:new n.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(I,O)=>{const H=I.wrap+I.canonical.x/(1<<I.canonical.z),J=I.canonical.y/(1<<I.canonical.z),ee=n.EXTENT/(1<<I.canonical.z),Y=O.wrap+O.canonical.x/(1<<O.canonical.z),se=O.canonical.y/(1<<O.canonical.z);return H+ee<Y+C.min.x||H>Y+C.max.x||J+ee<se+C.min.y||J>se+C.max.y};for(let I=0;I<_.length;I++){const O=_[I];for(let H=0;H<o.length;H++){const J=i.getTile(o[H]);if(!J||!J.hasData()||D(O,J.tileID))continue;const ee=this._createProxiedId(O,J,m[O.key]&&m[O.key][i.id]),Y=this.proxyToSource[O.key][i.id];Y?Y.push(ee):this.proxyToSource[O.key][i.id]=[ee],x.push(ee)}}}_createProxiedId(i,o,m){let x=this.orthoMatrix;if(m){const _=m.find(j=>j.key===o.tileID.key);if(_)return _}if(o.tileID.key!==i.key){const _=i.canonical.z-o.tileID.canonical.z;let j,S,C;x=n.create();const D=o.tileID.wrap-i.wrap<<i.overscaledZ;_>0?(j=n.EXTENT>>_,S=j*((o.tileID.canonical.x<<_)-i.canonical.x+D),C=j*((o.tileID.canonical.y<<_)-i.canonical.y)):(j=n.EXTENT<<-_,S=n.EXTENT*(o.tileID.canonical.x-(i.canonical.x+D<<-_)),C=n.EXTENT*(o.tileID.canonical.y-(i.canonical.y<<-_))),n.ortho(x,0,j,0,j,0,1),n.translate(x,x,[S,C,0])}return new cl(o.tileID,i.key,x)}_findTileCoveringTileID(i,o){let m=o.getTile(i);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[o.id],_=x[i.key];if(m=_?o.getTileByID(_):null,m&&m.hasData()||_===null)return m;let j=m?m.tileID:i,S=j.overscaledZ;const C=o.getSource().minzoom,D=[];if(!_){const O=o.getSource().maxzoom;if(i.canonical.z>=O){const H=i.canonical.z-O;o.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,o.transform.tileZoom),j=new n.OverscaledTileID(S,i.wrap,O,i.canonical.x>>H,i.canonical.y>>H)):H!==0&&(S=O,j=new n.OverscaledTileID(S,i.wrap,O,i.canonical.x>>H,i.canonical.y>>H))}j.key!==i.key&&(D.push(j.key),m=o.getTile(j))}const I=O=>{D.forEach(H=>{x[H]=O}),D.length=0};for(S-=1;S>=C&&(!m||!m.hasData());S--){m&&I(m.tileID.key);const O=j.calculateScaledKey(S);if(m=o.getTileByID(O),m&&m.hasData())break;const H=x[O];if(H===null)break;H===void 0?D.push(O):m=o.getTileByID(H)}return I(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(o){let m=0;const x=new n.StructArrayLayout2ui4,_=131;for(let j=1;j<129;j++){for(let S=1;S<129;S++)m=j*_+S,x.emplaceBack(m,m+1),x.emplaceBack(m,m+_),x.emplaceBack(m+1,m+_),j===128&&x.emplaceBack(m+_,m+_+1);x.emplaceBack(m+1,m+1+_)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=n.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ds{static cacheKey(i,o,m,x){let _=`${o}${x?x.cacheKey:""}`;for(const j of m)i.usedDefines.includes(j)&&(_+=`/${j}`);return _}constructor(i,o,m,x,_,j){const S=i.gl;this.program=S.createProgram();const C=function(F){const Q=[];for(let ae=0;ae<F.length;ae++){if(F[ae]===null)continue;const oe=F[ae].split(" ");Q.push(oe.pop())}return Q}(m.staticAttributes),D=x?x.getBinderAttributes():[],I=C.concat(D);let O=x?x.defines():[];O=O.concat(j.map(F=>`#define ${F}`));const H=i.isWebGL2?`#version 300 es
`:"",J=H+O.concat(i.extStandardDerivatives&&H.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Nc):Nc,Nc,nl,hd.fragmentSource,ba.fragmentSource,m.fragmentSource).join(`
`),ee=H+O.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,nl,hd.vertexSource,ba.vertexSource,il.vertexSource,m.vertexSource).join(`
`),Y=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(Y,J),S.compileShader(Y),S.attachShader(this.program,Y);const se=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(se,ee),S.compileShader(se),S.attachShader(this.program,se),this.attributes={},this.numAttributes=I.length;for(let F=0;F<this.numAttributes;F++)I[F]&&(S.bindAttribLocation(this.program,F,I[F]),this.attributes[I[F]]=F);S.linkProgram(this.program),S.deleteShader(se),S.deleteShader(Y),this.fixedUniforms=_(i),this.binderUniforms=x?x.getUniforms(i):[],j.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new n.Uniform1i(F),u_dem_prev:new n.Uniform1i(F),u_dem_unpack:new n.Uniform4f(F),u_dem_tl:new n.Uniform2f(F),u_dem_scale:new n.Uniform1f(F),u_dem_tl_prev:new n.Uniform2f(F),u_dem_scale_prev:new n.Uniform1f(F),u_dem_size:new n.Uniform1f(F),u_dem_lerp:new n.Uniform1f(F),u_exaggeration:new n.Uniform1f(F),u_depth:new n.Uniform1i(F),u_depth_size_inv:new n.Uniform2f(F),u_meter_to_dem:new n.Uniform1f(F),u_label_plane_matrix_inv:new n.UniformMatrix4f(F)}))(i)),j.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new n.Uniform3f(F),u_tile_tr_up:new n.Uniform3f(F),u_tile_br_up:new n.Uniform3f(F),u_tile_bl_up:new n.Uniform3f(F),u_tile_up_scale:new n.Uniform1f(F)}))(i)),j.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new n.UniformMatrix4f(F),u_fog_range:new n.Uniform2f(F),u_fog_color:new n.Uniform4f(F),u_fog_horizon_blend:new n.Uniform1f(F),u_fog_temporal_offset:new n.Uniform1f(F),u_frustum_tl:new n.Uniform3f(F),u_frustum_tr:new n.Uniform3f(F),u_frustum_br:new n.Uniform3f(F),u_frustum_bl:new n.Uniform3f(F),u_globe_pos:new n.Uniform3f(F),u_globe_radius:new n.Uniform1f(F),u_globe_transition:new n.Uniform1f(F),u_is_globe:new n.Uniform1i(F),u_viewport:new n.Uniform2f(F)}))(i))}}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in o)m[x]&&m[x].set(this.program,x,o[x])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in o)m[x]&&m[x].set(this.program,x,o[x])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in o)m[x].set(this.program,x,o[x])}}draw(i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y){const se=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(x),i.setColorMode(_),i.setCullFace(j);for(const Q of Object.keys(this.fixedUniforms))this.fixedUniforms[Q].set(this.program,Q,S[Q]);ee&&ee.setUniforms(this.program,i,this.binderUniforms,H,{zoom:J});const F={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[o];for(const Q of O.get()){const ae=Q.vaos||(Q.vaos={});(ae[C]||(ae[C]=new _m)).bind(i,this,D,ee?ee.getPaintVertexBuffers():[],I,Q.vertexOffset,Y||[]),se.drawElements(o,Q.primitiveLength*F,se.UNSIGNED_SHORT,Q.primitiveOffset*F*2)}}}function go(u,i){const o=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,u.transform.tileZoom)/o,x=m*(i.tileID.canonical.x+i.tileID.wrap*o),_=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/_s(i,1,u.transform.tileZoom),u_pixel_coord_upper:[x>>16,_>>16],u_pixel_coord_lower:[65535&x,65535&_]}}const gd=n.create(),Pc=(u,i,o,m,x,_,j,S,C,D,I)=>{const O=i.style.light,H=O.properties.get("position"),J=[H.x,H.y,H.z],ee=n.create$1();O.properties.get("anchor")==="viewport"&&(n.fromRotation(ee,-i.transform.angle),n.transformMat3(J,J,ee));const Y=O.properties.get("color"),se=i.transform,F={u_matrix:u,u_lightpos:J,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+o,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:_};return se.projection.name==="globe"&&(F.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],F.u_zoom_transition=C,F.u_inv_rot_matrix=I,F.u_merc_center=D,F.u_up_dir=se.projection.upVector(new n.CanonicalTileID(0,0,0),D[0]*n.EXTENT,D[1]*n.EXTENT),F.u_height_lift=S),F},xd=(u,i,o,m,x,_,j,S,C,D,I,O)=>{const H=Pc(u,i,o,m,x,_,j,C,D,I,O),J={u_height_factor:-Math.pow(2,j.overscaledZ)/S.tileSize/8};return n.extend(H,go(i,S),J)},Jn=u=>({u_matrix:u}),Ic=(u,i,o)=>n.extend(Jn(u),go(i,o)),bm=(u,i)=>({u_matrix:u,u_world:i}),vm=(u,i,o,m)=>n.extend(Ic(u,i,o),{u_world:m}),wm=n.create(),Dc=(u,i,o,m,x,_)=>{const j=u.transform,S=j.projection.name==="globe";let C;if(_.paint.get("circle-pitch-alignment")==="map")if(S){const I=n.globePixelsToTileUnits(j.zoom,i.canonical)*j._pixelsPerMercatorPixel;C=Float32Array.from([I,0,0,I])}else C=j.calculatePixelsToTileUnitsMatrix(o);else C=new Float32Array([j.pixelsToGLUnits[0],0,0,j.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:j.cameraToCenterDistance,u_matrix:u.translatePosMatrix(i.projMatrix,o,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:n.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:wm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){D.u_inv_rot_matrix=m,D.u_merc_center=x,D.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],D.u_zoom_transition=n.globeToMercatorTransition(j.zoom);const I=x[0]*n.EXTENT,O=x[1]*n.EXTENT;D.u_up_dir=j.projection.upVector(new n.CanonicalTileID(0,0,0),I,O)}return D},Lc=u=>{const i=[];return u.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},Rc=(u,i,o,m)=>{const x=n.EXTENT/o.tileSize;return{u_matrix:u,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},ul=(u,i,o=1)=>({u_matrix:u,u_color:i,u_overlay:0,u_overlay_scale:o}),yd=n.create(),_d=(u,i,o,m,x,_,j)=>{const S=u.transform,C=S.projection.name==="globe",D=C?n.globePixelsToTileUnits(S.zoom,i.canonical)*S._pixelsPerMercatorPixel:_s(o,1,_),I={u_matrix:i.projMatrix,u_extrude_scale:D,u_intensity:j,u_inv_rot_matrix:yd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){I.u_inv_rot_matrix=m,I.u_merc_center=x,I.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],I.u_zoom_transition=n.globeToMercatorTransition(S.zoom);const O=x[0]*n.EXTENT,H=x[1]*n.EXTENT;I.u_up_dir=S.projection.upVector(new n.CanonicalTileID(0,0,0),O,H)}return I},jm=(u,i,o,m,x,_,j)=>{const S=u.transform,C=S.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:zc(u,i,o,m),u_pixels_to_tile_units:C,u_device_pixel_ratio:_,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:yo(o)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Na(i,u.transform),u_alpha_discard_threshold:0,u_trim_offset:j}},xo=(u,i,o,m,x)=>{const _=u.transform;return{u_matrix:zc(u,i,o,m),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Na(i,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Na(u,i){return 1/_s(u,1,i.tileZoom)}function zc(u,i,o,m){return u.translatePosMatrix(m||i.tileID.projMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function yo(u){const i=u.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const Oc=(u,i,o,m,x,_)=>{return{u_matrix:u,u_tl_parent:i,u_scale_parent:o,u_fade_t:m.mix,u_opacity:m.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(S=x.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(j=x.paint.get("raster-contrast"),j>0?1/(1-j):1+j),u_spin_weights:qi(x.paint.get("raster-hue-rotate")),u_perspective_transform:_};var j,S};function qi(u){u*=Math.PI/180;const i=Math.sin(u),o=Math.cos(u);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const dl=n.create(),Fc=(u,i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y)=>{const se=x.transform,F={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:se.width/se.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:j,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:dl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:dl,u_up_vector:[0,-1,0]};return Y.name==="globe"&&(F.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],F.u_zoom_transition=O,F.u_inv_rot_matrix=J,F.u_merc_center=H,F.u_camera_forward=se._camera.forward(),F.u_ecef_origin=n.globeECEFOrigin(se.globeMatrix,I.toUnwrapped()),F.u_tile_matrix=Float32Array.from(se.globeMatrix),F.u_up_vector=ee),F},hl=(u,i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y,se)=>n.extend(Fc(u,i,o,m,x,_,j,S,C,D,O,H,J,ee,Y,se),{u_gamma_scale:m?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:n.exported.devicePixelRatio,u_is_halo:+I}),bd=(u,i,o,m,x,_,j,S,C,D,I,O,H,J,ee,Y)=>n.extend(hl(u,i,o,m,x,_,j,S,!0,C,!0,I,O,H,J,ee,Y),{u_texsize_icon:D,u_texture_icon:1}),Bc=(u,i,o)=>({u_matrix:u,u_opacity:i,u_color:o}),Nm=(u,i,o,m,x)=>n.extend(function(_,j,S){const C=j.imageManager.getPattern(_.toString()),{width:D,height:I}=j.imageManager.getPixelSize(),O=Math.pow(2,S.tileID.overscaledZ),H=S.tileSize*Math.pow(2,j.transform.tileZoom)/O,J=H*(S.tileID.canonical.x+S.tileID.wrap*O),ee=H*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:C.tl,u_pattern_br:C.br,u_texsize:[D,I],u_pattern_size:C.displaySize,u_tile_units_to_pixels:1/_s(S,1,j.transform.tileZoom),u_pixel_coord_upper:[J>>16,ee>>16],u_pixel_coord_lower:[65535&J,65535&ee]}}(m,o,x),{u_matrix:u,u_opacity:i}),Uc={fillExtrusion:u=>({u_matrix:new n.UniformMatrix4f(u),u_lightpos:new n.Uniform3f(u),u_lightintensity:new n.Uniform1f(u),u_lightcolor:new n.Uniform3f(u),u_vertical_gradient:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_edge_radius:new n.Uniform1f(u),u_ao:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_up_dir:new n.Uniform3f(u),u_height_lift:new n.Uniform1f(u)}),fillExtrusionPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_lightpos:new n.Uniform3f(u),u_lightintensity:new n.Uniform1f(u),u_lightcolor:new n.Uniform3f(u),u_vertical_gradient:new n.Uniform1f(u),u_height_factor:new n.Uniform1f(u),u_edge_radius:new n.Uniform1f(u),u_ao:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_up_dir:new n.Uniform3f(u),u_height_lift:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u)}),fill:u=>({u_matrix:new n.UniformMatrix4f(u)}),fillPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),fillOutline:u=>({u_matrix:new n.UniformMatrix4f(u),u_world:new n.Uniform2f(u)}),fillOutlinePattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_world:new n.Uniform2f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),circle:u=>({u_camera_to_center_distance:new n.Uniform1f(u),u_extrude_scale:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_up_dir:new n.Uniform3f(u)}),collisionBox:u=>({u_matrix:new n.UniformMatrix4f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_extrude_scale:new n.Uniform2f(u)}),collisionCircle:u=>({u_matrix:new n.UniformMatrix4f(u),u_inv_matrix:new n.UniformMatrix4f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_viewport_size:new n.Uniform2f(u)}),debug:u=>({u_color:new n.UniformColor(u),u_matrix:new n.UniformMatrix4f(u),u_overlay:new n.Uniform1i(u),u_overlay_scale:new n.Uniform1f(u)}),clippingMask:u=>({u_matrix:new n.UniformMatrix4f(u)}),heatmap:u=>({u_extrude_scale:new n.Uniform1f(u),u_intensity:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_up_dir:new n.Uniform3f(u)}),heatmapTexture:u=>({u_image:new n.Uniform1i(u),u_color_ramp:new n.Uniform1i(u),u_opacity:new n.Uniform1f(u)}),hillshade:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_latrange:new n.Uniform2f(u),u_light:new n.Uniform2f(u),u_shadow:new n.UniformColor(u),u_highlight:new n.UniformColor(u),u_accent:new n.UniformColor(u)}),hillshadePrepare:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_dimension:new n.Uniform2f(u),u_zoom:new n.Uniform1f(u),u_unpack:new n.Uniform4f(u)}),line:u=>({u_matrix:new n.UniformMatrix4f(u),u_pixels_to_tile_units:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_units_to_pixels:new n.Uniform2f(u),u_dash_image:new n.Uniform1i(u),u_gradient_image:new n.Uniform1i(u),u_image_height:new n.Uniform1f(u),u_texsize:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_alpha_discard_threshold:new n.Uniform1f(u),u_trim_offset:new n.Uniform2f(u)}),linePattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_texsize:new n.Uniform2f(u),u_pixels_to_tile_units:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_units_to_pixels:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_alpha_discard_threshold:new n.Uniform1f(u)}),raster:u=>({u_matrix:new n.UniformMatrix4f(u),u_tl_parent:new n.Uniform2f(u),u_scale_parent:new n.Uniform1f(u),u_fade_t:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_image0:new n.Uniform1i(u),u_image1:new n.Uniform1i(u),u_brightness_low:new n.Uniform1f(u),u_brightness_high:new n.Uniform1f(u),u_saturation_factor:new n.Uniform1f(u),u_contrast_factor:new n.Uniform1f(u),u_spin_weights:new n.Uniform3f(u),u_perspective_transform:new n.Uniform2f(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_camera_forward:new n.Uniform3f(u),u_tile_matrix:new n.UniformMatrix4f(u),u_up_vector:new n.Uniform3f(u),u_ecef_origin:new n.Uniform3f(u),u_texture:new n.Uniform1i(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_texture:new n.Uniform1i(u),u_gamma_scale:new n.Uniform1f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_camera_forward:new n.Uniform3f(u),u_tile_matrix:new n.UniformMatrix4f(u),u_up_vector:new n.Uniform3f(u),u_ecef_origin:new n.Uniform3f(u),u_is_halo:new n.Uniform1i(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_texsize_icon:new n.Uniform2f(u),u_texture:new n.Uniform1i(u),u_texture_icon:new n.Uniform1i(u),u_gamma_scale:new n.Uniform1f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_is_halo:new n.Uniform1i(u)}),background:u=>({u_matrix:new n.UniformMatrix4f(u),u_opacity:new n.Uniform1f(u),u_color:new n.UniformColor(u)}),backgroundPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_opacity:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_pattern_tl:new n.Uniform2f(u),u_pattern_br:new n.Uniform2f(u),u_texsize:new n.Uniform2f(u),u_pattern_size:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),terrainRaster:Cc,terrainDepth:Cc,skybox:u=>({u_matrix:new n.UniformMatrix4f(u),u_sun_direction:new n.Uniform3f(u),u_cubemap:new n.Uniform1i(u),u_opacity:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u)}),skyboxGradient:u=>({u_matrix:new n.UniformMatrix4f(u),u_color_ramp:new n.Uniform1i(u),u_center_direction:new n.Uniform3f(u),u_radius:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u)}),skyboxCapture:u=>({u_matrix_3f:new n.UniformMatrix3f(u),u_sun_direction:new n.Uniform3f(u),u_sun_intensity:new n.Uniform1f(u),u_color_tint_r:new n.Uniform4f(u),u_color_tint_m:new n.Uniform4f(u),u_luminance:new n.Uniform1f(u)}),globeRaster:u=>({u_proj_matrix:new n.UniformMatrix4f(u),u_globe_matrix:new n.UniformMatrix4f(u),u_normalize_matrix:new n.UniformMatrix4f(u),u_merc_matrix:new n.UniformMatrix4f(u),u_zoom_transition:new n.Uniform1f(u),u_merc_center:new n.Uniform2f(u),u_image0:new n.Uniform1i(u),u_grid_matrix:new n.UniformMatrix3f(u),u_skirt_height:new n.Uniform1f(u),u_frustum_tl:new n.Uniform3f(u),u_frustum_tr:new n.Uniform3f(u),u_frustum_br:new n.Uniform3f(u),u_frustum_bl:new n.Uniform3f(u),u_globe_pos:new n.Uniform3f(u),u_globe_radius:new n.Uniform1f(u),u_viewport:new n.Uniform2f(u)}),globeAtmosphere:u=>({u_frustum_tl:new n.Uniform3f(u),u_frustum_tr:new n.Uniform3f(u),u_frustum_br:new n.Uniform3f(u),u_frustum_bl:new n.Uniform3f(u),u_horizon:new n.Uniform1f(u),u_transition:new n.Uniform1f(u),u_fadeout_range:new n.Uniform1f(u),u_color:new n.Uniform4f(u),u_high_color:new n.Uniform4f(u),u_space_color:new n.Uniform4f(u),u_star_intensity:new n.Uniform1f(u),u_star_density:new n.Uniform1f(u),u_star_size:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u),u_horizon_angle:new n.Uniform1f(u),u_rotation_matrix:new n.UniformMatrix4f(u)})};let ml;function _o(u,i,o,m,x,_,j){const S=u.context,C=S.gl,D=u.transform,I=u.useProgram("collisionBox"),O=[];let H=0,J=0;for(let oe=0;oe<m.length;oe++){const _e=m[oe],ve=i.getTile(_e),be=ve.getBucket(o);if(!be)continue;const Me=_i(_e,be,D);let ke=Me;x[0]===0&&x[1]===0||(ke=u.translatePosMatrix(Me,ve,x,_));const Be=j?be.textCollisionBox:be.iconCollisionBox,at=be.collisionCircleArray;if(at.length>0){const ze=n.create(),Qe=ke;n.mul(ze,be.placementInvProjMatrix,D.glCoordMatrix),n.mul(ze,ze,be.placementViewportMatrix),O.push({circleArray:at,circleOffset:J,transform:Qe,invTransform:ze,projection:be.getProjection()}),H+=at.length/4,J=H}Be&&(u.terrain&&u.terrain.setupElevationDraw(ve,I),I.draw(S,C.LINES,n.DepthMode.disabled,n.StencilMode.disabled,u.colorModeForRenderPass(),n.CullFaceMode.disabled,Rc(ke,D,ve,be.getProjection()),o.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,D.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!j||!O.length)return;const ee=u.useProgram("collisionCircle"),Y=new n.StructArrayLayout2f1f2i16;Y.resize(4*H),Y._trim();let se=0;for(const oe of O)for(let _e=0;_e<oe.circleArray.length/4;_e++){const ve=4*_e,be=oe.circleArray[ve+0],Me=oe.circleArray[ve+1],ke=oe.circleArray[ve+2],Be=oe.circleArray[ve+3];Y.emplace(se++,be,Me,ke,Be,0),Y.emplace(se++,be,Me,ke,Be,1),Y.emplace(se++,be,Me,ke,Be,2),Y.emplace(se++,be,Me,ke,Be,3)}(!ml||ml.length<2*H)&&(ml=function(oe){const _e=2*oe,ve=new n.StructArrayLayout3ui6;ve.resize(_e),ve._trim();for(let be=0;be<_e;be++){const Me=6*be;ve.uint16[Me+0]=4*be+0,ve.uint16[Me+1]=4*be+1,ve.uint16[Me+2]=4*be+2,ve.uint16[Me+3]=4*be+2,ve.uint16[Me+4]=4*be+3,ve.uint16[Me+5]=4*be+0}return ve}(H));const F=S.createIndexBuffer(ml,!0),Q=S.createVertexBuffer(Y,n.collisionCircleLayout.members,!0);for(const oe of O){const _e={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(ae=D).getCameraToCenterDistance(oe.projection),u_viewport_size:[ae.width,ae.height]};ee.draw(S,C.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,u.colorModeForRenderPass(),n.CullFaceMode.disabled,_e,o.id,Q,F,n.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,D.zoom)}var ae;Q.destroy(),F.destroy()}const vd=n.create();function Vc({width:u,height:i,anchor:o,textOffset:m,textScale:x},_){const{horizontalAlign:j,verticalAlign:S}=n.getAnchorAlignment(o),C=-(j-.5)*u,D=-(S-.5)*i,I=n.evaluateVariableOffset(o,m);return new n.Point((C/x+I[0])*_,(D/x+I[1])*_)}function Sm(u,i,o,m,x,_,j,S,C,D,I){const O=u.text.placedSymbolArray,H=u.text.dynamicLayoutVertexArray,J=u.icon.dynamicLayoutVertexArray,ee={},Y=u.getProjection(),se=Fs(S,Y,_),F=_.elevation,Q=Y.upVectorScale(S.canonical,_.center.lat,_.worldSize).metersToTile;H.clear();for(let ae=0;ae<O.length;ae++){const oe=O.get(ae),{tileAnchorX:_e,tileAnchorY:ve,numGlyphs:be}=oe,Me=oe.hidden||!oe.crossTileID||u.allowVerticalPlacement&&!oe.placedOrientation?null:m[oe.crossTileID];if(Me){let ke=0,Be=0,at=0;if(F){const ct=F?F.getAtTileOffset(S,_e,ve):0,[Dt,Vt,At]=Y.upVector(S.canonical,_e,ve);ke=ct*Dt*Q,Be=ct*Vt*Q,at=ct*At*Q}let[ze,Qe,Ve,nt]=Sr(oe.projectedAnchorX+ke,oe.projectedAnchorY+Be,oe.projectedAnchorZ+at,o?se:j);const Fe=od(_.getCameraToCenterDistance(Y),nt);let Xe=x.evaluateSizeForFeature(u.textSizeData,D,oe)*Fe/n.ONE_EM;o&&(Xe*=u.tilePixelRatio/C);const lt=Vc(Me,Xe);o?({x:ze,y:Qe,z:Ve}=Y.projectTilePoint(_e+lt.x,ve+lt.y,S.canonical),[ze,Qe,Ve]=Sr(ze+ke,Qe+Be,Ve+at,j)):(i&&lt._rotate(-_.angle),ze+=lt.x,Qe+=lt.y,Ve=0);const st=u.allowVerticalPlacement&&oe.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let ct=0;ct<be;ct++)n.addDynamicAttributes(H,ze,Qe,Ve,st);I&&oe.associatedIconIndex>=0&&(ee[oe.associatedIconIndex]={x:ze,y:Qe,z:Ve,angle:st})}else Pi(be,H)}if(I){J.clear();const ae=u.icon.placedSymbolArray;for(let oe=0;oe<ae.length;oe++){const _e=ae.get(oe),{numGlyphs:ve}=_e,be=ee[oe];if(_e.hidden||!be)Pi(ve,J);else{const{x:Me,y:ke,z:Be,angle:at}=be;for(let ze=0;ze<ve;ze++)n.addDynamicAttributes(J,Me,ke,Be,at)}}u.icon.dynamicLayoutVertexBuffer.updateData(J)}u.text.dynamicLayoutVertexBuffer.updateData(H)}function qc(u,i,o){return o.iconsInText&&i?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function wd(u,i,o,m,x,_,j,S,C,D,I,O){const H=u.context,J=H.gl,ee=u.transform,Y=S==="map",se=C==="map",F=Y&&o.layout.get("symbol-placement")!=="point",Q=Y&&!se&&!F,ae=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let oe=!1;const _e=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),ve=[n.mercatorXfromLng(ee.center.lng),n.mercatorYfromLat(ee.center.lat)],be=o.layout.get("text-variable-anchor"),Me=ee.projection.name==="globe",ke=[],Be=[0,-1,0];let at=Be;!Me&&!ee.mercatorFromTransition||Y||(at=function(ze){const Qe=ze._camera.getWorldToCamera(ze.worldSize,1),Ve=n.multiply([],Qe,ze.globeMatrix);n.invert(Ve,Ve);const nt=[0,0,0],Fe=[0,1,0,0];return n.transformMat4$1(Fe,Fe,Ve),nt[0]=Fe[0],nt[1]=Fe[1],nt[2]=Fe[2],n.normalize(nt,nt),nt}(ee));for(const ze of m){const Qe=i.getTile(ze),Ve=Qe.getBucket(o);if(!Ve||Ve.projection.name==="mercator"&&Me)continue;const nt=x?Ve.text:Ve.icon;if(!nt||Ve.fullyClipped||!nt.segments.get().length)continue;const Fe=nt.programConfigurations.get(o.id),Xe=x||Ve.sdfIcons,lt=x?Ve.textSizeData:Ve.iconSizeData,st=se||ee.pitch!==0,ct=n.evaluateSizeForZoom(lt,ee.zoom);let Dt,Vt,At,Ot,is=[0,0],ts=null;if(x)Vt=Qe.glyphAtlasTexture,At=J.LINEAR,Dt=Qe.glyphAtlasTexture.size,Ve.iconsInText&&(is=Qe.imageAtlasTexture.size,ts=Qe.imageAtlasTexture,Ot=st||u.options.rotating||u.options.zooming||lt.kind==="composite"||lt.kind==="camera"?J.LINEAR:J.NEAREST);else{const mn=o.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;Vt=Qe.imageAtlasTexture,At=Xe||u.options.rotating||u.options.zooming||mn||st?J.LINEAR:J.NEAREST,Dt=Qe.imageAtlasTexture.size}const Pt=Ve.projection.name==="globe",vs=Pt?at:Be,ws=Pt?n.globeToMercatorTransition(ee.zoom):0,js=Fs(ze,Ve.getProjection(),ee),Ns=ee.calculatePixelsToTileUnitsMatrix(Qe),qr=We(js,Qe.tileID.canonical,se,Y,ee,Ve.getProjection(),Ns),Er=u.terrain&&se&&F?n.invert(n.create(),qr):vd,ji=ir(js,Qe.tileID.canonical,se,Y,ee,Ve.getProjection(),Ns),Gi=be&&Ve.hasTextData(),Bs=o.layout.get("icon-text-fit")!=="none"&&Gi&&Ve.hasIconData();if(F){const mn=ee.elevation,Mn=mn?mn.getAtTileOffsetFunc(ze,ee.center.lat,ee.worldSize,Ve.getProjection()):null,ra=nn(js,Qe.tileID.canonical,se,Y,ee,Ve.getProjection(),Ns);fc(Ve,js,u,x,ra,ji,se,D,Mn,ze)}const Ss=F||x&&be||Bs,fs=u.translatePosMatrix(js,Qe,_,j),nr=Ss?vd:qr,Xr=u.translatePosMatrix(ji,Qe,_,j,!0),zs=Ve.getProjection().createInversionMatrix(ee,ze.canonical),ti=[];u.terrainRenderModeElevated()&&se&&ti.push("PITCH_WITH_MAP_TERRAIN"),Pt&&ti.push("PROJECTION_GLOBE_VIEW"),Ss&&ti.push("PROJECTED_POS_ON_VIEWPORT");const kl=Xe&&o.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let sa;sa=Xe?Ve.iconsInText?bd(lt.kind,ct,Q,se,u,fs,nr,Xr,Dt,is,ze,ws,ve,zs,vs,Ve.getProjection()):hl(lt.kind,ct,Q,se,u,fs,nr,Xr,x,Dt,!0,ze,ws,ve,zs,vs,Ve.getProjection()):Fc(lt.kind,ct,Q,se,u,fs,nr,Xr,x,Dt,ze,ws,ve,zs,vs,Ve.getProjection());const Ao={program:u.useProgram(qc(Xe,x,Ve),Fe,ti),buffers:nt,uniformValues:sa,atlasTexture:Vt,atlasTextureIcon:ts,atlasInterpolation:At,atlasInterpolationIcon:Ot,isSDF:Xe,hasHalo:kl,tile:Qe,labelPlaneMatrixInv:Er};if(ae&&Ve.canOverlap){oe=!0;const mn=nt.segments.get();for(const Mn of mn)ke.push({segments:new n.SegmentVector([Mn]),sortKey:Mn.sortKey,state:Ao})}else ke.push({segments:nt.segments,sortKey:0,state:Ao})}oe&&ke.sort((ze,Qe)=>ze.sortKey-Qe.sortKey);for(const ze of ke){const Qe=ze.state;if(u.terrain&&u.terrain.setupElevationDraw(Qe.tile,Qe.program,{useDepthForOcclusion:!Me,labelPlaneMatrixInv:Qe.labelPlaneMatrixInv}),H.activeTexture.set(J.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,J.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(H.activeTexture.set(J.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),Qe.isSDF){const Ve=Qe.uniformValues;Qe.hasHalo&&(Ve.u_is_halo=1,bo(Qe.buffers,ze.segments,o,u,Qe.program,_e,I,O,Ve)),Ve.u_is_halo=0}bo(Qe.buffers,ze.segments,o,u,Qe.program,_e,I,O,Qe.uniformValues)}}function bo(u,i,o,m,x,_,j,S,C){const D=m.context,I=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.globeExtVertexBuffer];x.draw(D,D.gl.TRIANGLES,_,j,S,n.CullFaceMode.disabled,C,o.id,u.layoutVertexBuffer,u.indexBuffer,i,o.paint,m.transform.zoom,u.programConfigurations.get(o.id),I)}function jd(u,i,o,m,x,_,j){const S=u.context.gl,C=o.paint.get("fill-pattern"),D=C&&C.constantOr(1);let I,O,H,J,ee;j?(O=D&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=S.LINES):(O=D?"fillPattern":"fill",I=S.TRIANGLES);for(const Y of m){const se=i.getTile(Y);if(D&&!se.patternsLoaded())continue;const F=se.getBucket(o);if(!F)continue;u.prepareDrawTile();const Q=F.programConfigurations.get(o.id),ae=u.useProgram(O,Q);D&&(u.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Q.updatePaintBuffers());const oe=C.constantOr(null);if(oe&&se.imageAtlas){const ve=se.imageAtlas.patternPositions[oe.toString()];ve&&Q.setConstantPatternPositions(ve)}const _e=u.translatePosMatrix(Y.projMatrix,se,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(j){J=F.indexBuffer2,ee=F.segments2;const ve=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];H=O==="fillOutlinePattern"&&D?vm(_e,u,se,ve):bm(_e,ve)}else J=F.indexBuffer,ee=F.segments,H=D?Ic(_e,u,se):Jn(_e);u.prepareDrawProgram(u.context,ae,Y.toUnwrapped()),ae.draw(u.context,I,x,u.stencilModeForClipping(Y),_,n.CullFaceMode.disabled,H,o.id,F.layoutVertexBuffer,J,ee,o.paint,u.transform.zoom,Q)}}function pl(u,i,o,m,x,_,j){const S=u.context,C=S.gl,D=u.transform,I=o.paint.get("fill-extrusion-pattern"),O=I.constantOr(1),H=o.paint.get("fill-extrusion-opacity"),J=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],ee=o.layout.get("fill-extrusion-edge-radius"),Y=ee>0&&!o.paint.get("fill-extrusion-rounded-roof"),se=Y?0:ee,F=D.projection.name==="globe"?n.fillExtrusionHeightLift():0,Q=D.projection.name==="globe",ae=Q?n.globeToMercatorTransition(D.zoom):0,oe=[n.mercatorXfromLng(D.center.lng),n.mercatorYfromLat(D.center.lat)],_e=[];Q&&_e.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&_e.push("FAUX_AO"),Y&&_e.push("ZERO_ROOF_RADIUS");for(const ve of m){const be=i.getTile(ve),Me=be.getBucket(o);if(!Me||Me.projection.name!==D.projection.name)continue;const ke=Me.programConfigurations.get(o.id),Be=u.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ke,_e);if(u.terrain){const Xe=u.terrain;if(u.style.terrainSetForDrapingOnly())Xe.setupElevationDraw(be,Be,{useMeterToDem:!0});else{if(!Me.enableTerrain)continue;if(Xe.setupElevationDraw(be,Be,{useMeterToDem:!0}),Nd(S,i,ve,Me,o,Xe),!Me.centroidVertexBuffer){const lt=Be.attributes.a_centroid_pos;lt!==void 0&&C.vertexAttrib2f(lt,0,0)}}}O&&(u.context.activeTexture.set(C.TEXTURE0),be.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ke.updatePaintBuffers());const at=I.constantOr(null);if(at&&be.imageAtlas){const Xe=be.imageAtlas.patternPositions[at.toString()];Xe&&ke.setConstantPatternPositions(Xe)}const ze=u.translatePosMatrix(ve.projMatrix,be,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Qe=D.projection.createInversionMatrix(D,ve.canonical),Ve=o.paint.get("fill-extrusion-vertical-gradient"),nt=O?xd(ze,u,Ve,H,J,se,ve,be,F,ae,oe,Qe):Pc(ze,u,Ve,H,J,se,ve,F,ae,oe,Qe);u.prepareDrawProgram(S,Be,ve.toUnwrapped());const Fe=[];u.terrain&&Fe.push(Me.centroidVertexBuffer),Q&&Fe.push(Me.layoutVertexExtBuffer),Be.draw(S,S.gl.TRIANGLES,x,_,j,n.CullFaceMode.backCCW,nt,o.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,o.paint,u.transform.zoom,ke,Fe)}}function Nd(u,i,o,m,x,_){const j=[F=>{let Q=F.canonical.x-1,ae=F.wrap;return Q<0&&(Q=(1<<F.canonical.z)-1,ae--),new n.OverscaledTileID(F.overscaledZ,ae,F.canonical.z,Q,F.canonical.y)},F=>{let Q=F.canonical.x+1,ae=F.wrap;return Q===1<<F.canonical.z&&(Q=0,ae++),new n.OverscaledTileID(F.overscaledZ,ae,F.canonical.z,Q,F.canonical.y)},F=>new n.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,(F.canonical.y===0?1<<F.canonical.z:F.canonical.y)-1),F=>new n.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y===(1<<F.canonical.z)-1?0:F.canonical.y+1)],S=F=>{const Q=i.getSource().minzoom,ae=_e=>{const ve=i.getTileByID(_e);if(ve&&ve.hasData())return ve.getBucket(x)},oe=[0,-1,1];for(const _e of oe){if(F.overscaledZ+_e<Q)continue;const ve=ae(F.calculateScaledKey(F.overscaledZ+_e));if(ve)return ve}},C=[0,0,0],D=(F,Q)=>(C[0]=Math.min(F.min.y,Q.min.y),C[1]=Math.max(F.max.y,Q.max.y),C[2]=n.EXTENT-Q.min.x>F.max.x?Q.min.x-n.EXTENT:F.max.x,C),I=(F,Q)=>(C[0]=Math.min(F.min.x,Q.min.x),C[1]=Math.max(F.max.x,Q.max.x),C[2]=n.EXTENT-Q.min.y>F.max.y?Q.min.y-n.EXTENT:F.max.y,C),O=[(F,Q)=>D(F,Q),(F,Q)=>D(Q,F),(F,Q)=>I(F,Q),(F,Q)=>I(Q,F)],H=new n.Point(0,0);let J,ee,Y;const se=(F,Q,ae,oe,_e)=>{const ve=[[oe?ae:F,oe?F:ae,0],[oe?ae:Q,oe?Q:ae,0]],be=_e<0?n.EXTENT+_e:_e,Me=[oe?be:(F+Q)/2,oe?(F+Q)/2:be,0];return ae===0&&_e<0||ae!==0&&_e>0?_.getForTilePoints(Y,[Me],!0,ee):ve.push(Me),_.getForTilePoints(o,ve,!0,J),Math.max(ve[0][2],ve[1][2],Me[2])/_.exaggeration()};for(let F=0;F<4;F++){const Q=(F<2?1:5)-F,ae=m.borders[F];if(ae.length===0)continue;const oe=Y=j[F](o),_e=S(oe);if(!(_e&&_e instanceof n.FillExtrusionBucket&&_e.enableTerrain)||m.borderDoneWithNeighborZ[F]===_e.canonical.z&&_e.borderDoneWithNeighborZ[Q]===m.canonical.z||(ee=_.findDEMTileFor(oe),!ee||!ee.dem))continue;if(!J){const ke=_.findDEMTileFor(o);if(!ke||!ke.dem)return;J=ke}const ve=_e.borders[Q];let be=0;const Me=_e.borderDoneWithNeighborZ[Q]!==m.canonical.z;if(m.canonical.z===_e.canonical.z){for(let ke=0;ke<ae.length;ke++){const Be=m.featuresOnBorder[ae[ke]],at=Be.borders[F];let ze;for(;be<ve.length&&(ze=_e.featuresOnBorder[ve[be]],!(ze.borders[Q][1]>at[0]+3));)Me&&_e.encodeCentroid(void 0,ze,!1),be++;if(ze&&be<ve.length){const Qe=be;let Ve=0;for(;!(ze.borders[Q][0]>at[1]-3)&&(Ve++,++be!==ve.length);)ze=_e.featuresOnBorder[ve[be]];if(ze=_e.featuresOnBorder[ve[Qe]],Be.intersectsCount()>1||ze.intersectsCount()>1||Ve!==1){Ve!==1&&(be=Qe),m.encodeCentroid(void 0,Be,!1),Me&&_e.encodeCentroid(void 0,ze,!1);continue}const nt=O[F](Be,ze),Fe=F%2?n.EXTENT-1:0;H.x=se(nt[0],Math.min(n.EXTENT-1,nt[1]),Fe,F<2,nt[2]),H.y=0,m.encodeCentroid(H,Be,!1),Me&&_e.encodeCentroid(H,ze,!1)}else m.encodeCentroid(void 0,Be,!1)}m.borderDoneWithNeighborZ[F]=_e.canonical.z,m.needsCentroidUpdate=!0,Me&&(_e.borderDoneWithNeighborZ[Q]=m.canonical.z,_e.needsCentroidUpdate=!0)}else{for(const ke of ae)m.encodeCentroid(void 0,m.featuresOnBorder[ke],!1);if(Me){for(const ke of ve)_e.encodeCentroid(void 0,_e.featuresOnBorder[ke],!1);_e.borderDoneWithNeighborZ[Q]=m.canonical.z,_e.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[F]=_e.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(u)}const Sa=new n.Color(1,0,0,1),Tm=new n.Color(0,1,0,1),Em=new n.Color(0,0,1,1),Cm=new n.Color(1,0,1,1),km=new n.Color(0,1,1,1);function Am(u,i,o){const m=u.context,x=u.transform,_=m.gl,j=x.projection.name==="globe",S=j?["PROJECTION_GLOBE_VIEW"]:null;let C=o.projMatrix;if(j&&n.globeToMercatorTransition(x.zoom)>0){const Be=n.transitionTileAABBinECEF(o.canonical,x),at=n.globeDenormalizeECEF(Be);C=n.multiply(new Float32Array(16),x.globeMatrix,at),n.multiply(C,x.projMatrix,C)}const D=u.useProgram("debug",null,S),I=i.getTileByID(o.key);u.terrain&&u.terrain.setupElevationDraw(I,D);const O=n.DepthMode.disabled,H=n.StencilMode.disabled,J=u.colorModeForRenderPass(),ee="$debug";m.activeTexture.set(_.TEXTURE0),u.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),j?I._makeGlobeTileDebugBuffers(u.context,x):I._makeDebugTileBoundsBuffers(u.context,x.projection);const Y=I._tileDebugBuffer||u.debugBuffer,se=I._tileDebugIndexBuffer||u.debugIndexBuffer,F=I._tileDebugSegments||u.debugSegments;D.draw(m,_.LINE_STRIP,O,H,J,n.CullFaceMode.disabled,ul(C,n.Color.red),ee,Y,se,F,null,null,null,[I._globeTileDebugBorderBuffer]);const Q=I.latestRawTileData,ae=Math.floor((Q&&Q.byteLength||0)/1024),oe=i.getTile(o).tileSize,_e=512/Math.min(oe,512)*(o.overscaledZ/x.zoom)*.5;let ve=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(ve+=` => ${o.overscaledZ}`),ve+=` ${ae}kb`,function(Be,at){Be.initDebugOverlayCanvas();const ze=Be.debugOverlayCanvas,Qe=Be.context.gl,Ve=Be.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,ze.width,ze.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(at,5,5),Ve.strokeText(at,5,5),Be.debugOverlayTexture.update(ze),Be.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(u,ve);const be=I._tileDebugTextBuffer||u.debugBuffer,Me=I._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,ke=I._tileDebugTextSegments||u.debugSegments;D.draw(m,_.TRIANGLES,O,H,n.ColorMode.alphaBlended,n.CullFaceMode.disabled,ul(C,n.Color.transparent,_e),ee,be,Me,ke,null,null,null,[I._globeTileDebugTextBuffer])}function Sd(u,i,o,m){Ta(u,0,i+o/2,u.transform.width,o,m)}function fl(u,i,o,m){Ta(u,i-o/2,0,o,u.transform.height,m)}function Ta(u,i,o,m,x,_){const j=u.context,S=j.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*n.exported.devicePixelRatio,o*n.exported.devicePixelRatio,m*n.exported.devicePixelRatio,x*n.exported.devicePixelRatio),j.clear({color:_}),S.disable(S.SCISSOR_TEST)}const Td=n.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ed}=Td;function dn(u,i,o,m){u.emplaceBack(i,o,m)}class gl{constructor(i){this.vertexArray=new n.StructArrayLayout3f12,this.indices=new n.StructArrayLayout3ui6,dn(this.vertexArray,-1,-1,1),dn(this.vertexArray,1,-1,1),dn(this.vertexArray,-1,1,1),dn(this.vertexArray,1,1,1),dn(this.vertexArray,-1,-1,-1),dn(this.vertexArray,1,-1,-1),dn(this.vertexArray,-1,1,-1),dn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Ed),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=n.SegmentVector.simpleSegment(0,0,36,12)}}function vi(u,i,o,m,x,_){const j=u.gl,S=i.paint.get("sky-atmosphere-color"),C=i.paint.get("sky-atmosphere-halo-color"),D=i.paint.get("sky-atmosphere-sun-intensity"),I=((O,H,J,ee,Y)=>({u_matrix_3f:O,u_sun_direction:H,u_sun_intensity:J,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(n.fromMat4(n.create$1(),m),x,D,S,C);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+_,i.skyboxTexture,0),o.draw(u,j.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.frontCW,I,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const vo=n.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Cd{constructor(i){const o=new n.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const m=new n.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,vo.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=n.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Yn={symbol:function(u,i,o,m,x){if(u.renderPass!=="translucent")return;const _=n.StencilMode.disabled,j=u.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(S,C,D,I,O,H,J){const ee=C.transform,Y=O==="map",se=H==="map";for(const F of S){const Q=I.getTile(F),ae=Q.getBucket(D);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const oe=n.evaluateSizeForZoom(ae.textSizeData,ee.zoom),_e=Fs(F,ae.getProjection(),ee),ve=ee.calculatePixelsToTileUnitsMatrix(Q),be=We(_e,Q.tileID.canonical,se,Y,ee,ae.getProjection(),ve),Me=D.layout.get("icon-text-fit")!=="none"&&ae.hasIconData();if(oe){const ke=Math.pow(2,ee.zoom-Q.tileID.overscaledZ);Sm(ae,Y,se,J,n.symbolSize,ee,be,F,ke,oe,Me)}}}(m,u,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),x),o.paint.get("icon-opacity").constantOr(1)!==0&&wd(u,i,o,m,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),_,j),o.paint.get("text-opacity").constantOr(1)!==0&&wd(u,i,o,m,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),_,j),i.map.showCollisionBoxes&&(_o(u,i,o,m,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),_o(u,i,o,m,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(u,i,o,m){if(u.renderPass!=="translucent")return;const x=o.paint.get("circle-opacity"),_=o.paint.get("circle-stroke-width"),j=o.paint.get("circle-stroke-opacity"),S=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(_.constantOr(1)===0||j.constantOr(1)===0))return;const C=u.context,D=C.gl,I=u.transform,O=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),H=n.StencilMode.disabled,J=u.colorModeForRenderPass(),ee=I.projection.name==="globe",Y=[n.mercatorXfromLng(I.center.lng),n.mercatorYfromLat(I.center.lat)],se=[];for(let Q=0;Q<m.length;Q++){const ae=m[Q],oe=i.getTile(ae),_e=oe.getBucket(o);if(!_e||_e.projection.name!==I.projection.name)continue;const ve=_e.programConfigurations.get(o.id),be=Lc(o);ee&&be.push("PROJECTION_GLOBE_VIEW");const Me=u.useProgram("circle",ve,be),ke=_e.layoutVertexBuffer,Be=_e.globeExtVertexBuffer,at=_e.indexBuffer,ze=I.projection.createInversionMatrix(I,ae.canonical),Qe={programConfiguration:ve,program:Me,layoutVertexBuffer:ke,globeExtVertexBuffer:Be,indexBuffer:at,uniformValues:Dc(u,ae,oe,ze,Y,o),tile:oe};if(S){const Ve=_e.segments.get();for(const nt of Ve)se.push({segments:new n.SegmentVector([nt]),sortKey:nt.sortKey,state:Qe})}else se.push({segments:_e.segments,sortKey:0,state:Qe})}S&&se.sort((Q,ae)=>Q.sortKey-ae.sortKey);const F={useDepthForOcclusion:!ee};for(const Q of se){const{programConfiguration:ae,program:oe,layoutVertexBuffer:_e,globeExtVertexBuffer:ve,indexBuffer:be,uniformValues:Me,tile:ke}=Q.state,Be=Q.segments;u.terrain&&u.terrain.setupElevationDraw(ke,oe,F),u.prepareDrawProgram(C,oe,ke.tileID.toUnwrapped()),oe.draw(C,D.TRIANGLES,O,H,J,n.CullFaceMode.disabled,Me,o.id,_e,be,Be,o.paint,I.zoom,ae,[ve])}},heatmap:function(u,i,o,m){if(o.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const x=u.context,_=x.gl,j=n.StencilMode.disabled,S=new n.ColorMode([_.ONE,_.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(J,ee,Y,se){const F=J.gl,Q=ee.width*se,ae=ee.height*se;J.activeTexture.set(F.TEXTURE1),J.viewport.set([0,0,Q,ae]);let oe=Y.heatmapFbo;if(!oe||oe&&(oe.width!==Q||oe.height!==ae)){oe&&oe.destroy();const _e=F.createTexture();F.bindTexture(F.TEXTURE_2D,_e),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),oe=Y.heatmapFbo=J.createFramebuffer(Q,ae,!1),function(ve,be,Me,ke,Be,at){const ze=ve.gl;ze.texImage2D(ze.TEXTURE_2D,0,ve.isWebGL2&&ve.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,Be,at,0,ze.RGBA,ve.extRenderToTextureHalfFloat?ve.isWebGL2?ze.HALF_FLOAT:ve.extTextureHalfFloat.HALF_FLOAT_OES:ze.UNSIGNED_BYTE,null),ke.colorAttachment.set(Me)}(J,0,_e,oe,Q,ae)}else F.bindTexture(F.TEXTURE_2D,oe.colorAttachment.get()),J.bindFramebuffer.set(oe.framebuffer)})(x,u,o,u.transform.projection.name==="globe"?.5:.25),x.clear({color:n.Color.transparent});const C=u.transform,D=C.projection.name==="globe",I=D?["PROJECTION_GLOBE_VIEW"]:null,O=D?n.CullFaceMode.frontCCW:n.CullFaceMode.disabled,H=[n.mercatorXfromLng(C.center.lng),n.mercatorYfromLat(C.center.lat)];for(let J=0;J<m.length;J++){const ee=m[J];if(i.hasRenderableParent(ee))continue;const Y=i.getTile(ee),se=Y.getBucket(o);if(!se||se.projection.name!==C.projection.name)continue;const F=se.programConfigurations.get(o.id),Q=u.useProgram("heatmap",F,I),{zoom:ae}=u.transform;u.terrain&&u.terrain.setupElevationDraw(Y,Q),u.prepareDrawProgram(x,Q,ee.toUnwrapped());const oe=C.projection.createInversionMatrix(C,ee.canonical);Q.draw(x,_.TRIANGLES,n.DepthMode.disabled,j,S,O,_d(u,ee,Y,oe,H,ae,o.paint.get("heatmap-intensity")),o.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,o.paint,u.transform.zoom,F,D?[se.globeExtVertexBuffer]:null)}x.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(x,_){const j=x.context,S=j.gl,C=_.heatmapFbo;if(!C)return;j.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),j.activeTexture.set(S.TEXTURE1);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new n.Texture(j,_.colorRamp,S.RGBA)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(j,S.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,x.colorModeForRenderPass(),n.CullFaceMode.disabled,((I,O,H,J)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,_),_.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,_.paint,x.transform.zoom)}(u,o))},line:function(u,i,o,m){if(u.renderPass!=="translucent")return;const x=o.paint.get("line-opacity"),_=o.paint.get("line-width");if(x.constantOr(1)===0||_.constantOr(1)===0)return;const j=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),S=u.colorModeForRenderPass(),C=u.terrain&&u.terrain.renderingToTexture?1:n.exported.devicePixelRatio,D=o.paint.get("line-dasharray"),I=D.constantOr(1),O=o.layout.get("line-cap"),H=o.paint.get("line-pattern"),J=H.constantOr(1),ee=o.paint.get("line-gradient"),Y=J?"linePattern":"line",se=u.context,F=se.gl,Q=(oe=>{const _e=[];yo(oe)&&_e.push("RENDER_LINE_DASH"),oe.paint.get("line-gradient")&&_e.push("RENDER_LINE_GRADIENT");const ve=oe.paint.get("line-trim-offset");ve[0]===0&&ve[1]===0||_e.push("RENDER_LINE_TRIM_OFFSET");const be=oe.paint.get("line-pattern").constantOr(1),Me=oe.paint.get("line-opacity").constantOr(1)!==1;return!be&&Me&&_e.push("RENDER_LINE_ALPHA_DISCARD"),_e})(o);let ae=Q.includes("RENDER_LINE_ALPHA_DISCARD");u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(ae=!1);for(const oe of m){const _e=i.getTile(oe);if(J&&!_e.patternsLoaded())continue;const ve=_e.getBucket(o);if(!ve)continue;u.prepareDrawTile();const be=ve.programConfigurations.get(o.id),Me=u.useProgram(Y,be,Q),ke=H.constantOr(null);if(ke&&_e.imageAtlas){const Xe=_e.imageAtlas.patternPositions[ke.toString()];Xe&&be.setConstantPatternPositions(Xe)}const Be=D.constantOr(null),at=O.constantOr(null);if(!J&&Be&&at&&_e.lineAtlas){const Xe=_e.lineAtlas.getDash(Be,at);Xe&&be.setConstantPatternPositions(Xe)}let[ze,Qe]=o.paint.get("line-trim-offset");(at==="round"||at==="square")&&ze!==Qe&&(ze===0&&(ze-=1),Qe===1&&(Qe+=1));const Ve=u.terrain?oe.projMatrix:null,nt=J?xo(u,_e,o,Ve,C):jm(u,_e,o,Ve,ve.lineClipsArray.length,C,[ze,Qe]);if(ee){const Xe=ve.gradients[o.id];let lt=Xe.texture;if(o.gradientVersion!==Xe.version){let st=256;if(o.stepInterpolant){const ct=i.getSource().maxzoom,Dt=oe.canonical.z===ct?Math.ceil(1<<u.transform.maxZoom-oe.canonical.z):1;st=n.clamp(n.nextPowerOfTwo(ve.maxLineLength/n.EXTENT*1024*Dt),256,se.maxTextureSize)}Xe.gradient=n.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:st,image:Xe.gradient||void 0,clips:ve.lineClipsArray}),Xe.texture?Xe.texture.update(Xe.gradient):Xe.texture=new n.Texture(se,Xe.gradient,F.RGBA),Xe.version=o.gradientVersion,lt=Xe.texture}se.activeTexture.set(F.TEXTURE1),lt.bind(o.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}I&&(se.activeTexture.set(F.TEXTURE0),_e.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),be.updatePaintBuffers()),J&&(se.activeTexture.set(F.TEXTURE0),_e.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),be.updatePaintBuffers()),u.prepareDrawProgram(se,Me,oe.toUnwrapped());const Fe=Xe=>{Me.draw(se,F.TRIANGLES,j,Xe,S,n.CullFaceMode.disabled,nt,o.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,o.paint,u.transform.zoom,be,[ve.layoutVertexBuffer2])};if(ae){const Xe=u.stencilModeForClipping(oe).ref;Xe===0&&u.terrain&&se.clear({stencil:0});const lt={func:F.EQUAL,mask:255};nt.u_alpha_discard_threshold=.8,Fe(new n.StencilMode(lt,Xe,255,F.KEEP,F.KEEP,F.INVERT)),nt.u_alpha_discard_threshold=0,Fe(new n.StencilMode(lt,Xe,255,F.KEEP,F.KEEP,F.KEEP))}else Fe(u.stencilModeForClipping(oe))}ae&&(u.resetStencilClippingMasks(),u.terrain&&se.clear({stencil:0}))},fill:function(u,i,o,m){const x=o.paint.get("fill-color"),_=o.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const j=u.colorModeForRenderPass(),S=o.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!S.constantOr(1)&&x.constantOr(n.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===C){const D=u.depthModeForSublayer(1,u.renderPass==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly);jd(u,i,o,m,D,j,!1)}if(u.renderPass==="translucent"&&o.paint.get("fill-antialias")){const D=u.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,n.DepthMode.ReadOnly);jd(u,i,o,m,D,j,!0)}},"fill-extrusion":function(u,i,o,m){const x=o.paint.get("fill-extrusion-opacity");if(x!==0&&u.renderPass==="translucent"){const _=new n.DepthMode(u.context.gl.LEQUAL,n.DepthMode.ReadWrite,u.depthRangeFor3D);if(x!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))pl(u,i,o,m,_,n.StencilMode.disabled,n.ColorMode.disabled),pl(u,i,o,m,_,u.stencilModeFor3D(),u.colorModeForRenderPass()),u.resetStencilClippingMasks();else{const j=u.colorModeForRenderPass();pl(u,i,o,m,_,n.StencilMode.disabled,j)}}},hillshade:function(u,i,o,m){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const x=u.context,_=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),j=u.colorModeForRenderPass(),S=u.terrain&&u.terrain.renderingToTexture,[C,D]=u.renderPass!=="translucent"||S?[{},m]:u.stencilConfigForOverlap(m);for(const I of D){const O=i.getTile(I);if(O.needsHillshadePrepare&&u.renderPass==="offscreen")pd(u,O,o,_,n.StencilMode.disabled,j);else if(u.renderPass==="translucent"){const H=S&&u.terrain?u.terrain.stencilModeForRTTOverlap(I):C[I.overscaledZ];md(u,I,O,o,_,H,j)}}x.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,i,o,m,x,_){if(u.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!m.length)return;const j=u.context,S=j.gl,C=i.getSource(),D=u.useProgram("raster"),I=u.colorModeForRenderPass(),O=u.terrain&&u.terrain.renderingToTexture,[H,J]=C instanceof Yt||O?[{},m]:u.stencilConfigForOverlap(m),ee=J[J.length-1].overscaledZ,Y=!u.options.moving;for(const se of J){const F=O?n.DepthMode.disabled:u.depthModeForSublayer(se.overscaledZ-ee,o.paint.get("raster-opacity")===1?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly,S.LESS),Q=se.toUnwrapped(),ae=i.getTile(se);if(O&&(!ae||!ae.hasData()))continue;const oe=O?se.projMatrix:u.transform.calculateProjMatrix(Q,Y),_e=u.terrain&&O?u.terrain.stencilModeForRTTOverlap(se):H[se.overscaledZ],ve=_?0:o.paint.get("raster-fade-duration");ae.registerFadeDuration(ve);const be=i.findLoadedParent(se,0),Me=kc(ae,be,i,u.transform,ve);let ke,Be;u.terrain&&u.terrain.prepareDrawTile();const at=o.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;j.activeTexture.set(S.TEXTURE0),ae.texture.bind(at,S.CLAMP_TO_EDGE),j.activeTexture.set(S.TEXTURE1),be?(be.texture.bind(at,S.CLAMP_TO_EDGE),ke=Math.pow(2,be.tileID.overscaledZ-ae.tileID.overscaledZ),Be=[ae.tileID.canonical.x*ke%1,ae.tileID.canonical.y*ke%1]):ae.texture.bind(at,S.CLAMP_TO_EDGE),ae.texture.useMipmap&&j.extTextureFilterAnisotropic&&u.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const ze=Oc(oe,Be||[0,0],ke||1,Me,o,C instanceof Yt?C.perspectiveTransform:[0,0]);if(u.prepareDrawProgram(j,D,Q),C instanceof Yt)C.boundsBuffer&&C.boundsSegments&&D.draw(j,S.TRIANGLES,F,n.StencilMode.disabled,I,n.CullFaceMode.disabled,ze,o.id,C.boundsBuffer,u.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Qe,tileBoundsIndexBuffer:Ve,tileBoundsSegments:nt}=u.getTileBoundsBuffers(ae);D.draw(j,S.TRIANGLES,F,_e,I,n.CullFaceMode.disabled,ze,o.id,Qe,Ve,nt)}}u.resetStencilClippingMasks()},background:function(u,i,o,m){const x=o.paint.get("background-color"),_=o.paint.get("background-opacity");if(_===0)return;const j=u.context,S=j.gl,C=u.transform,D=C.tileSize,I=o.paint.get("background-pattern");if(u.isPatternMissing(I))return;const O=!I&&x.a===1&&_===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==O)return;const H=n.StencilMode.disabled,J=u.depthModeForSublayer(0,O==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly),ee=u.colorModeForRenderPass(),Y=u.useProgram(I?"backgroundPattern":"background");let se,F=m;F||(se=u.getBackgroundTiles(),F=Object.values(se).map(Q=>Q.tileID)),I&&(j.activeTexture.set(S.TEXTURE0),u.imageManager.bind(u.context));for(const Q of F){const ae=Q.toUnwrapped(),oe=m?Q.projMatrix:u.transform.calculateProjMatrix(ae);u.prepareDrawTile();const _e=i?i.getTile(Q):se?se[Q.key]:new n.Tile(Q,D,C.zoom,u),ve=I?Nm(oe,_,u,I,{tileID:Q,tileSize:D}):Bc(oe,_,x);u.prepareDrawProgram(j,Y,ae);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:Me,tileBoundsSegments:ke}=u.getTileBoundsBuffers(_e);Y.draw(j,S.TRIANGLES,J,H,ee,n.CullFaceMode.disabled,ve,o.id,be,Me,ke)}},sky:function(u,i,o){const m=u.transform,x=m.projection.name==="mercator"||m.projection.name==="globe"?1:n.smoothstep(7,8,m.zoom),_=o.paint.get("sky-opacity")*x;if(_===0)return;const j=u.context,S=o.paint.get("sky-type"),C=new n.DepthMode(j.gl.LEQUAL,n.DepthMode.ReadOnly,[0,1]),D=u.frameCounter/1e3%1;S==="atmosphere"?u.renderPass==="offscreen"?o.needsSkyboxCapture(u)&&(function(I,O,H,J){const ee=I.context,Y=ee.gl;let se=O.skyboxFbo;if(!se){se=O.skyboxFbo=ee.createFramebuffer(32,32,!1),O.skyboxGeometry=new gl(ee),O.skyboxTexture=ee.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,O.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let oe=0;oe<6;++oe)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(se.framebuffer),ee.viewport.set([0,0,32,32]);const F=O.getCenter(I,!0),Q=I.useProgram("skyboxCapture"),ae=new Float64Array(16);n.identity(ae),n.rotateY(ae,ae,.5*-Math.PI),vi(ee,O,Q,ae,F,0),n.identity(ae),n.rotateY(ae,ae,.5*Math.PI),vi(ee,O,Q,ae,F,1),n.identity(ae),n.rotateX(ae,ae,.5*-Math.PI),vi(ee,O,Q,ae,F,2),n.identity(ae),n.rotateX(ae,ae,.5*Math.PI),vi(ee,O,Q,ae,F,3),n.identity(ae),vi(ee,O,Q,ae,F,4),n.identity(ae),n.rotateY(ae,ae,Math.PI),vi(ee,O,Q,ae,F,5),ee.viewport.set([0,0,I.width,I.height])}(u,o),o.markSkyboxValid(u)):u.renderPass==="sky"&&function(I,O,H,J,ee){const Y=I.context,se=Y.gl,F=I.transform,Q=I.useProgram("skybox");Y.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,O.skyboxTexture);const ae=((oe,_e,ve,be,Me)=>({u_matrix:oe,u_sun_direction:_e,u_cubemap:0,u_opacity:be,u_temporal_offset:Me}))(F.skyboxMatrix,O.getCenter(I,!1),0,J,ee);I.prepareDrawProgram(Y,Q),Q.draw(Y,se.TRIANGLES,H,n.StencilMode.disabled,I.colorModeForRenderPass(),n.CullFaceMode.backCW,ae,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(u,o,C,_,D):S==="gradient"&&u.renderPass==="sky"&&function(I,O,H,J,ee){const Y=I.context,se=Y.gl,F=I.transform,Q=I.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new gl(Y)),Y.activeTexture.set(se.TEXTURE0);let ae=O.colorRampTexture;ae||(ae=O.colorRampTexture=new n.Texture(Y,O.colorRamp,se.RGBA)),ae.bind(se.LINEAR,se.CLAMP_TO_EDGE);const oe=((_e,ve,be,Me,ke)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:ve,u_radius:n.degToRad(be),u_opacity:Me,u_temporal_offset:ke}))(F.skyboxMatrix,O.getCenter(I,!1),O.paint.get("sky-gradient-radius"),J,ee);I.prepareDrawProgram(Y,Q),Q.draw(Y,se.TRIANGLES,H,n.StencilMode.disabled,I.colorModeForRenderPass(),n.CullFaceMode.backCW,oe,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(u,o,C,_,D)},debug:function(u,i,o){for(let m=0;m<o.length;m++)Am(u,i,o[m])},custom:function(u,i,o,m){const x=u.context,_=o.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&o.isLayerDraped()){if(u.renderPass==="offscreen"){const j=_.prerender;if(j){if(u.setCustomLayerDefaults(),x.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const S=u.transform.pointMerc;j.call(_,x.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.globeToMercatorTransition(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else j.call(_,x.gl,u.transform.customLayerMatrix());x.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const S=_.renderToTile;if(S){const C=m[0].canonical,D=new n.MercatorCoordinate(C.x+m[0].wrap*(1<<C.z),C.y,C.z);x.setDepthMode(n.DepthMode.disabled),x.setStencilMode(n.StencilMode.disabled),x.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),S.call(_,x.gl,D),x.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),x.setColorMode(u.colorModeForRenderPass()),x.setStencilMode(n.StencilMode.disabled);const j=_.renderingMode==="3d"?new n.DepthMode(u.context.gl.LEQUAL,n.DepthMode.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,n.DepthMode.ReadOnly);if(x.setDepthMode(j),u.transform.projection.name==="globe"){const S=u.transform.pointMerc;_.render(x.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.globeToMercatorTransition(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else _.render(x.gl,u.transform.customLayerMatrix());x.setDirty(),u.setBaseState(),x.bindFramebuffer.set(null)}}else n.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ea{constructor(i,o,m=!1){this.context=new mt(i,m),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=n.SourceCache.maxUnderzooming+n.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,o){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Mc(this,i));const x=this._terrain;this.transform.elevation=m?x:null,x.update(i,this.transform,o)}_updateFog(i){const o=i.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=o.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const _=m+.78*(x-m);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,o){if(this.width=i*n.exported.devicePixelRatio,this.height=o*n.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const i=this.context,o=new n.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(n.EXTENT,0),o.emplaceBack(0,n.EXTENT),o.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(o,n.posAttributes.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const m=new n.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(n.EXTENT,0),m.emplaceBack(0,n.EXTENT),m.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=i.createVertexBuffer(m,n.posAttributes.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const x=new n.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,n.posAttributes.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const _=new n.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(n.EXTENT,0,n.EXTENT,0),_.emplaceBack(0,n.EXTENT,0,n.EXTENT),_.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(_,n.boundsAttributes.members),this.mercatorBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const j=new n.StructArrayLayout3ui6;j.emplaceBack(0,1,2),j.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(j);const S=new n.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])S.emplaceBack(D);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new n.Texture(i,new n.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=n.create();const C=this.context.gl;this.stencilClearMode=new n.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(n.window.performance.now()),this.atmosphereBuffer=new Cd(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,o.TRIANGLES,n.DepthMode.disabled,this.stencilClearMode,n.ColorMode.disabled,n.CullFaceMode.disabled,fo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,m){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const C of m)if(this._tileClippingMaskIDs[C.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=o.id;const x=this.context,_=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(n.ColorMode.disabled),x.setDepthMode(n.DepthMode.disabled);const j=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of m){const C=o.getTile(S),D=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:O,tileBoundsSegments:H}=this.getTileBoundsBuffers(C);j.draw(x,_.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:_.ALWAYS,mask:0},D,255,_.KEEP,_.KEEP,_.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,fo(S.projMatrix),"$clipping",I,O,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new n.StencilMode({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new n.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,m=i.sort((j,S)=>S.overscaledZ-j.overscaledZ),x=m[m.length-1].overscaledZ,_=m[0].overscaledZ-x+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const j={};for(let S=0;S<_;S++)j[S+x]=new n.StencilMode({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[j,m]}return[{[x]:n.StencilMode.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new n.ColorMode([i.CONSTANT_COLOR,i.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?n.ColorMode.unblended:n.ColorMode.alphaBlended}depthModeForSublayer(i,o,m){if(!this.opaquePassEnabledForLayer())return n.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new n.DepthMode(m||this.context.gl.LEQUAL,o,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();const m=this.style.order,x=this.style._sourceCaches;for(const D in x){const I=x[D];I.used&&I.prepare(this.context)}const _={},j={},S={};for(const D in x){const I=x[D];_[D]=I.getVisibleCoordinates(),j[D]=_[D].slice().reverse(),S[D]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<m.length;D++)if(this.style._layers[m[D]].is3D()){this.opaquePassCutoff=D;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.GlobeSharedBuffers(this.context)),!n.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const D of m){const I=this.style._layers[D],O=i._getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const H=O?j[O.id]:void 0;(I.type==="custom"||I.isSky()||H&&H.length)&&this.renderLayer(this,O,I,H)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon];const C=this.terrain;if(C&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&C.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);if(D.isSky())continue;const O=I?j[I.id]:void 0;this._renderTileClippingMasks(D,I,O),this.renderLayer(this,I,D,O)}if(this.style.fog&&this.transform.projection.supportsFog&&function(D,I){const O=D.context,H=O.gl,J=D.transform,ee=new n.DepthMode(H.LEQUAL,n.DepthMode.ReadOnly,[0,1]),Y=D.useProgram("globeAtmosphere",null,J.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),se=n.globeToMercatorTransition(J.zoom),F=I.properties.get("color").toArray01(),Q=I.properties.get("high-color").toArray01(),ae=I.properties.get("space-color").toArray01PremultipliedAlpha(),oe=n.identity$1([]);n.rotateY$1(oe,oe,-n.degToRad(J._center.lng)),n.rotateX$1(oe,oe,n.degToRad(J._center.lat)),n.rotateZ$1(oe,oe,J.angle),n.rotateX$1(oe,oe,-J._pitch);const _e=n.fromQuat(new Float32Array(16),oe),ve=n.mapValue(I.properties.get("star-intensity"),0,1,0,.25),be=5e-4,Me=n.mapValue(I.properties.get("horizon-blend"),0,1,be,.25),ke=n.globeUseCustomAntiAliasing(D,O,J)&&Me===be?J.worldSize/(2*Math.PI*1.025)-1:J.globeRadius,Be=D.frameCounter/1e3%1,at=n.length(J.globeCenterInViewSpace),ze=Math.sqrt(Math.pow(at,2)-Math.pow(ke,2)),Qe=Math.acos(ze/at),Ve=((Fe,Xe,lt,st,ct,Dt,Vt,At,Ot,is,ts,Pt,vs,ws)=>({u_frustum_tl:Fe,u_frustum_tr:Xe,u_frustum_br:lt,u_frustum_bl:st,u_horizon:ct,u_transition:Dt,u_fadeout_range:Vt,u_color:At,u_high_color:Ot,u_space_color:is,u_star_intensity:ts,u_star_size:5*n.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Pt,u_horizon_angle:vs,u_rotation_matrix:ws}))(J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.frustumCorners.horizon,se,Me,F,Q,ae,ve,Be,Qe,_e);D.prepareDrawProgram(O,Y);const nt=D.atmosphereBuffer;nt&&Y.draw(O,H.TRIANGLES,ee,n.StencilMode.disabled,n.ColorMode.alphaBlended,n.CullFaceMode.backCW,Ve,"skybox",nt.vertexBuffer,nt.indexBuffer,nt.segments)}(this,this.style.fog),this.renderPass="sky",(n.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);D.isSky()&&this.renderLayer(this,I,D,I?j[I.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);if(D.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(D)){if(D.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=I?(D.type==="symbol"?S:j)[I.id]:void 0;this._renderTileClippingMasks(D,I,I?_[I.id]:void 0),this.renderLayer(this,I,D,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let D=null;n.values(this.style._layers).forEach(I=>{const O=i._getLayerSourceCache(I);O&&!I.isHidden(this.transform.zoom)&&(!D||D.getSource().maxzoom<O.getSource().maxzoom)&&(D=O)}),D&&this.options.showTileBoundaries&&Yn.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const I=D.transform.padding;Sd(D,D.transform.height-(I.top||0),3,Sa),Sd(D,I.bottom||0,3,Tm),fl(D,I.left||0,3,Em),fl(D,D.transform.width-(I.right||0),3,Cm);const O=D.transform.centerPoint;(function(H,J,ee,Y){Ta(H,J-1,ee-10,2,20,Y),Ta(H,J-10,ee-1,20,2,Y)})(D,O.x,D.transform.height-O.y,km)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(n.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,o,m,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(m.type)||i.terrain&&m.type==="custom")&&Yn[m.type](i,o,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),m.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),i.beginQueryEXT(i.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const m in i){const x=i[m],_=this.context.extTimerQuery,j=_.getQueryObjectEXT(x.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(x.query),o[m]=j}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let m=0;for(const x of i)m+=o.getQueryObjectEXT(x,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(x);return m}translatePosMatrix(i,o,m,x,_){if(!m[0]&&!m[1])return i;const j=_?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(j){const D=Math.sin(j),I=Math.cos(j);m=[m[0]*I-m[1]*D,m[0]*D+m[1]*I]}const S=[_?m[0]:_s(o,m[0],this.transform.zoom),_?m[1]:_s(o,m[1],this.transform.zoom),0],C=new Float32Array(16);return n.translate(C,i,S),C}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){return i===null||i!==void 0&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,o=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),o&&x.push("ZERO_EXAGGERATION"),m&&!i&&m.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),i&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(i,o,m){this.cache=this.cache||{};const x=m||[],_=this.currentGlobalDefines().concat(x),j=ds.cacheKey(Sc[i],i,_,o);return this.cache[j]||(this.cache[j]=new ds(this.context,i,Sc[i],o,Uc[i],_)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=n.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,o,m){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const _=x.getOpacity(this.transform.pitch),j=((S,C,D,I,O,H,J,ee,Y,se,F)=>{const Q=S.transform,ae=C.properties.get("color").toArray01();ae[3]=I;const oe=S.frameCounter/1e3%1;return{u_fog_matrix:D?Q.calculateFogTileMatrix(D):S.identityMat,u_fog_range:C.getFovAdjustedRange(Q._fov),u_fog_color:ae,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:oe,u_frustum_tl:O,u_frustum_tr:H,u_frustum_br:J,u_frustum_bl:ee,u_globe_pos:Y,u_globe_radius:se,u_viewport:F,u_globe_transition:n.globeToMercatorTransition(Q.zoom),u_is_globe:+(Q.projection.name==="globe")}})(this,x,m,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.exported.devicePixelRatio,this.transform.height*n.exported.devicePixelRatio]);o.setFogUniformValues(i,j)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)o[x.key]=i[x.key]||new n.Tile(x,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class xl{constructor(i=0,o=0,m=0,x=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=m,this.right=x}interpolate(i,o,m){return o.top!=null&&i.top!=null&&(this.top=n.number(i.top,o.top,m)),o.bottom!=null&&i.bottom!=null&&(this.bottom=n.number(i.bottom,o.bottom,m)),o.left!=null&&i.left!=null&&(this.left=n.number(i.left,o.left,m)),o.right!=null&&i.right!=null&&(this.right=n.number(i.right,o.right,m)),this}getCenter(i,o){const m=n.clamp((this.left+i-this.right)/2,0,i),x=n.clamp((this.top+o-this.bottom)/2,0,o);return new n.Point(m,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new xl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yl(u,i){const o=n.getColumn(u,3);n.fromQuat(u,i),n.setColumn(u,3,o)}function ms(u,i){const o=n.identity$1([]);return n.rotateZ$1(o,o,-i),n.rotateX$1(o,o,-u),o}function wo(u,i){const o=[u[0],u[1],0],m=[i[0],i[1],0];if(n.length(o)>=1e-15){const j=n.normalize([],o);n.scale$2(m,j,n.dot(m,j)),i[0]=m[0],i[1]=m[1]}const x=n.cross([],i,u);if(n.len(x)<1e-15)return null;const _=Math.atan2(-x[1],x[0]);return ms(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}class kd{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof n.MercatorCoordinate?i:new n.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=n.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const m=this.position,x=this._elevation?this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(i)):0,_=n.MercatorCoordinate.fromLngLat(i,x),j=[_.x-m.x,_.y-m.y,_.z-m.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=wo(j,o)}setPitchBearing(i,o){this.orientation=ms(n.degToRad(i),n.degToRad(-o))}}class _l{constructor(i,o){this._transform=n.identity([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new n.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=n.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&n.setColumn(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||n.identity$1([]),i&&yl(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=ms(i,o),yl(this._transform,this._orientation)}forward(){const i=n.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=n.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=n.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const m=new Float64Array(16);return n.invert(m,this.getWorldToCamera(i,o)),m}getWorldToCameraPosition(i,o,m){const x=this.position;n.scale$2(x,x,-i);const _=new Float64Array(16);return n.fromScaling(_,[m,m,m]),n.translate(_,_,x),_[10]*=o,_}getWorldToCamera(i,o){const m=new Float64Array(16),x=new Float64Array(4),_=this.position;return n.conjugate(x,this._orientation),n.scale$2(_,_,-i),n.fromQuat(m,x),n.translate(m,m,_),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=o,m[9]*=o,m[10]*=o,m[11]*=o,m}getCameraToClipPerspective(i,o,m,x){const _=new Float64Array(16);return n.perspective(_,i,o,m,x),_}getDistanceToElevation(i,o=!1){const m=i===0?0:n.mercatorZfromAltitude(i,o?n.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(m-this.position[2])/x[2]}clone(){return new _l([...this.position],[...this.orientation])}}function Ca(u,i){const o=bl(u.projection,u.zoom,u.width,u.height),m=function(_,j,S,C,D){const I=new n.LngLat(S.lng-180*hn,S.lat),O=new n.LngLat(S.lng+180*hn,S.lat),H=_.project(I.lng,I.lat),J=_.project(O.lng,O.lat),ee=-Math.atan2(J.y-H.y,J.x-H.x),Y=n.MercatorCoordinate.fromLngLat(S);Y.y=n.clamp(Y.y,-1+hn,1-hn);const se=Y.toLngLat(),F=_.project(se.lng,se.lat),Q=n.MercatorCoordinate.fromLngLat(se);Q.x+=hn;const ae=Q.toLngLat(),oe=_.project(ae.lng,ae.lat),_e=vl(oe.x-F.x,oe.y-F.y,ee),ve=n.MercatorCoordinate.fromLngLat(se);ve.y+=hn;const be=ve.toLngLat(),Me=_.project(be.lng,be.lat),ke=vl(Me.x-F.x,Me.y-F.y,ee),Be=Math.abs(_e.x)/Math.abs(ke.y),at=n.identity([]);n.rotateZ(at,at,-ee*(1-(D?0:C)));const ze=n.identity([]);return n.scale(ze,ze,[1,1-(1-Be)*C,1]),ze[4]=-ke.x/ke.y*C,n.rotateZ(ze,ze,ee),n.multiply(ze,at,ze),ze}(u.projection,0,u.center,o,i),x=Ad(u);return n.scale(m,m,[x,x,1]),m}function Ad(u){const i=u.projection,o=bl(u.projection,u.zoom,u.width,u.height),m=Md(i,u.center),x=Md(i,n.LngLat.convert(i.center));return Math.pow(2,m*o+(1-o)*x)}function bl(u,i,o,m,x=1/0){const _=u.range;if(!_)return 0;const j=Math.min(x,Math.max(o,m)),S=Math.log(j/1024)/Math.LN2;return n.smoothstep(_[0]+S,_[1]+S,i)}const hn=1/4e4;function Md(u,i){const o=n.clamp(i.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=new n.LngLat(i.lng-180*hn,o),x=new n.LngLat(i.lng+180*hn,o),_=u.project(m.lng,o),j=u.project(x.lng,o),S=n.MercatorCoordinate.fromLngLat(m),C=n.MercatorCoordinate.fromLngLat(x),D=j.x-_.x,I=j.y-_.y,O=C.x-S.x,H=C.y-S.y,J=Math.sqrt((O*O+H*H)/(D*D+I*I));return Math.log(J)/Math.LN2}function vl(u,i,o){const m=Math.cos(o),x=Math.sin(o);return{x:u*m-i*x,y:u*x+i*m}}class ka{constructor(i,o,m,x,_,j,S){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(j),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new _l,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,o=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(i||m)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=n.getProjection(this.projectionOptions);const m=!M(o,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.getProjection({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.Point(this.width,this.height)}get bearing(){return n.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;var m;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(m=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(x,_,j){var S=_[0],C=_[1],D=_[2],I=_[3],O=Math.sin(j),H=Math.cos(j);x[0]=S*H+D*O,x[1]=C*H+I*O,x[2]=S*-O+D*H,x[3]=C*-O+I*H}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=n.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=n.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,_=0;for(let j=0;j<o.length;j++){const S=new n.Point(o[j][0]*this.width,m+o[j][1]*(this.height-m)),C=i.pointCoordinate(S);if(!C)continue;const D=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);x+=C[3]*D,_+=D}return _===0?NaN:x/_}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*o,x=this._mercatorZfromZoom(i),_=this._mercatorZfromZoom(this._maxZoom),j=Math.max(x-m,_);this._setZoom(this._zoomFromMercatorZ(j))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const x=n.length(n.sub([],this._camera.position,m));return n.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!n.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];n.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new kd;return o.position=new n.MercatorCoordinate(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!n.length$1(i))return!1;n.normalize$1(i,i);const o=n.transformQuat([],[0,0,-1],i),m=n.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const x=wo(o,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=n.clamp(i[2],x/m,x/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,m){this._unmodified=!1,this._edgeInsets.interpolate(i,o,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new n.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new n.Point(0,0)),x=this.pointCoordinate(new n.Point(this.width,0)),_=this.pointCoordinate(new n.Point(this.width,this.height)),j=this.pointCoordinate(new n.Point(0,this.height)),S=Math.floor(Math.min(m.x,x.x,_.x,j.x)),C=Math.floor(Math.max(m.x,x.x,_.x,j.x)),D=1;for(let I=S-D;I<=C+D;I++)I!==0&&o.push(new n.UnwrappedTileID(I,i))}return o}coveringTiles(i){let o=this.coveringZoomLevel(i);const m=o,x=this.elevation&&!i.isTerrainDEM,_=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const j=this.locationCoordinate(this.center),S=this.center.lat,C=1<<o,D=[C*j.x,C*j.y,0],I=this.projection.name==="globe",O=!I,H=n.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,O),J=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=C*n.mercatorZfromAltitude(1,this.center.lat),Y=this._camera.position[2]/n.mercatorZfromAltitude(1,this.center.lat),se=[C*J.x,C*J.y,Y*(O?1:ee)],F=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,ae=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,oe=i.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,_e=this.projection.isReprojectedInTileSpace?Ad(this):1,ve=Fe=>{const lt=new n.MercatorCoordinate(Fe.x+25e-6,Fe.y,Fe.z),st=new n.MercatorCoordinate(Fe.x,Fe.y+25e-6,Fe.z),ct=Fe.toLngLat(),Dt=lt.toLngLat(),Vt=st.toLngLat(),At=this.locationCoordinate(ct),Ot=this.locationCoordinate(Dt),is=this.locationCoordinate(Vt),ts=Math.hypot(Ot.x-At.x,Ot.y-At.y),Pt=Math.hypot(is.x-At.x,is.y-At.y);return Math.sqrt(ts*Pt)*_e/25e-6},be=Fe=>{const Xe=ae,lt=oe;return{aabb:n.tileAABB(this,C,0,0,0,Fe,lt,Xe,this.projection),zoom:0,x:0,y:0,minZ:lt,maxZ:Xe,wrap:Fe,fullyVisible:!1}},Me=[];let ke=[];const Be=o,at=i.reparseOverscaled?m:o,ze=Fe=>Fe*Fe,Qe=ze((Y-this._centerAltitude)*ee),Ve=Fe=>{if(!this._elevation||!Fe.tileID||!_)return;const Xe=this._elevation.getMinMaxForTile(Fe.tileID),lt=Fe.aabb;Xe?(lt.min[2]=Xe.min,lt.max[2]=Xe.max,lt.center[2]=(lt.min[2]+lt.max[2])/2):(Fe.shouldSplit=nt(Fe),Fe.shouldSplit||(lt.min[2]=lt.max[2]=lt.center[2]=this._centerAltitude))},nt=Fe=>{if(Fe.zoom<Q)return!0;if(Fe.zoom===Be)return!1;if(Fe.shouldSplit!=null)return Fe.shouldSplit;const Xe=Fe.aabb.distanceX(se),lt=Fe.aabb.distanceY(se);let st=Qe,ct=1;if(I){st=ze(Fe.aabb.distanceZ(se));const At=Math.pow(2,Fe.zoom),Ot=n.latFromMercatorY((Fe.y+1)/At),is=n.latFromMercatorY(Fe.y/At),ts=Math.min(Math.max(S,Ot),is),Pt=n.circumferenceAtLatitude(ts)/n.circumferenceAtLatitude(S);if(ct=ts===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pt/this._mercatorScaleRatio),this.zoom<=n.GLOBE_ZOOM_THRESHOLD_MIN&&Fe.zoom===Be-1&&Pt>=.9)return!0}else if(x&&(st=ze(Fe.aabb.distanceZ(se)*ee)),this.projection.isReprojectedInTileSpace&&m<=5){const At=Math.pow(2,Fe.zoom),Ot=ve(new n.MercatorCoordinate((Fe.x+.5)/At,(Fe.y+.5)/At));ct=Ot>.85?1:Ot}const Dt=Xe*Xe+lt*lt+st,Vt=ze((1<<Be-Fe.zoom)*F*ct*((At,Ot)=>{if(Ot*ze(.707)<At)return 1;const is=Math.sqrt(Ot/At);return is/(1.4144271570014144+(Math.pow(1.1,is-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(st,Qe),Dt));return Dt<Vt};if(this.renderWorldCopies)for(let Fe=1;Fe<=3;Fe++)Me.push(be(-Fe)),Me.push(be(Fe));for(Me.push(be(0));Me.length>0;){const Fe=Me.pop(),Xe=Fe.x,lt=Fe.y;let st=Fe.fullyVisible;if(!st){const ct=Fe.aabb.intersects(H);if(ct===0)continue;st=ct===2}if(Fe.zoom!==Be&&nt(Fe))for(let ct=0;ct<4;ct++){const Dt=(Xe<<1)+ct%2,Vt=(lt<<1)+(ct>>1),At={aabb:_?Fe.aabb.quadrant(ct):n.tileAABB(this,C,Fe.zoom+1,Dt,Vt,Fe.wrap,Fe.minZ,Fe.maxZ,this.projection),zoom:Fe.zoom+1,x:Dt,y:Vt,wrap:Fe.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Fe.minZ,maxZ:Fe.maxZ};x&&!I&&(At.tileID=new n.OverscaledTileID(Fe.zoom+1===Be?at:Fe.zoom+1,Fe.wrap,Fe.zoom+1,Dt,Vt),Ve(At)),Me.push(At)}else{const ct=Fe.zoom===Be?at:Fe.zoom;if(i.minzoom&&i.minzoom>ct)continue;const Dt=D[0]-(.5+Xe+(Fe.wrap<<Fe.zoom))*(1<<o-Fe.zoom),Vt=D[1]-.5-lt,At=Fe.tileID?Fe.tileID:new n.OverscaledTileID(ct,Fe.wrap,Fe.zoom,Xe,lt);ke.push({tileID:At,distanceSq:Dt*Dt+Vt*Vt})}}if(this.fogCullDistSq){const Fe=this.fogCullDistSq,Xe=this.horizonLineFromTop();ke=ke.filter(lt=>{const st=[0,0,0,1],ct=[n.EXTENT,n.EXTENT,0,1],Dt=this.calculateFogTileMatrix(lt.tileID.toUnwrapped());n.transformMat4$1(st,st,Dt),n.transformMat4$1(ct,ct,Dt);const Vt=n.getAABBPointSquareDist(st,ct);if(Vt===0)return!0;let At=!1;const Ot=this._elevation;if(Ot&&Vt>Fe&&Xe!==0){const is=this.calculateProjMatrix(lt.tileID.toUnwrapped());let ts;i.isTerrainDEM||(ts=Ot.getMinMaxForTile(lt.tileID)),ts||(ts={min:oe,max:ae});const Pt=n.furthestTileCorner(this.rotation),vs=[Pt[0]*n.EXTENT,Pt[1]*n.EXTENT,ts.max];n.transformMat4(vs,vs,is),At=(1-vs[1])*this.height*.5<Xe}return Vt<Fe||At})}return ke.sort((Fe,Xe)=>Fe.distanceSq-Xe.distanceSq).map(Fe=>Fe.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=n.clamp(i.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=this.projection.project(i.lng,o);return new n.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let m,x;const _=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;m=(o.x-_.x)/S,x=(o.y-_.y)/S}else{const S=this.pointCoordinate(o),C=this.pointCoordinate(_);m=S.x-C.x,x=S.y-C.y}const j=this.locationCoordinate(i);this.setLocation(new n.MercatorCoordinate(j.x-m,j.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const m=o?n.mercatorZfromAltitude(o,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new n.MercatorCoordinate(x.x,x.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const m=o??this._centerAltitude,x=[i.x,i.y,0,1],_=[i.x,i.y,1,1];n.transformMat4$1(x,x,this.pixelMatrixInverse),n.transformMat4$1(_,_,this.pixelMatrixInverse);const j=_[3];n.scale$1(x,x,1/x[3]),n.scale$1(_,_,1/j);const S=x[2],C=_[2];return{p0:x,p1:_,t:S===C?0:(m-S)/(C-S)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return n.transformMat4$1(o,o,this.pixelMatrixInverse),n.transformMat4$1(m,m,this.pixelMatrixInverse),n.scale$1(o,o,1/o[3]),n.scale$1(m,m,1/m[3]),o[2]=n.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,m[2]=n.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,n.scale$1(o,o,1/this.worldSize),n.scale$1(m,m,1/this.worldSize),new n.Ray([o[0],o[1],o[2]],n.normalize([],n.sub([],m,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:m,t:x}=i,_=n.mercatorZfromAltitude(o[2],this._center.lat),j=n.mercatorZfromAltitude(m[2],this._center.lat);return new n.MercatorCoordinate(n.number(o[0],m[0],x)/this.worldSize,n.number(o[1],m[1],x)/this.worldSize,n.number(_,j,x))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let o=this.projection.pointCoordinate3D(this,i.x,i.y);if(o)return new n.MercatorCoordinate(o[0],o[1],o[2]);let m=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const _=.02*x,j=i.clone();for(let S=0;S<10&&x-m>_;S++){j.y=n.number(m,x,.66);const C=this.projection.pointCoordinate3D(this,j.x,j.y);C?(x=j.y,o=C):m=j.y}return o?new n.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const m=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return n.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new n.Point(x[0]/x[3],x[1]/x[3]):new n.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,_=this.pointLocation3D(new n.Point(o,i)),j=this.pointLocation3D(new n.Point(x,i)),S=this.pointLocation3D(new n.Point(x,m)),C=this.pointLocation3D(new n.Point(o,m));let D=Math.min(_.lng,j.lng,S.lng,C.lng),I=Math.max(_.lng,j.lng,S.lng,C.lng),O=Math.min(_.lat,j.lat,S.lat,C.lat),H=Math.max(_.lat,j.lat,S.lat,C.lat);const J=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,Y=(se,F,Q,ae,oe)=>{const _e=(se+Q)/2,ve=(F+ae)/2,be=new n.Point(_e,ve),{lng:Me,lat:ke}=this.pointLocation3D(be),Be=Math.max(0,D-Me,O-ke,Me-I,ke-H);D=Math.min(D,Me),I=Math.max(I,Me),O=Math.min(O,ke),H=Math.max(H,ke),(oe<ee||Be>J)&&(Y(se,F,_e,ve,oe+1),Y(_e,ve,Q,ae,oe+1))};if(Y(o,i,x,i,1),Y(x,i,x,m,1),Y(x,m,o,m,1),Y(o,m,o,i,1),this.projection.name==="globe"){const[se,F]=n.polesInViewport(this);se?(H=90,I=180,D=-180):F&&(O=-90,I=180,D=-180)}return new n.LngLatBounds(new n.LngLat(D,O),new n.LngLat(I,H))}_getBoundsRectangular(i,o){const{top:m,left:x}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,j=this.width-this._edgeInsets.right,S=new n.Point(x,m),C=new n.Point(j,m),D=new n.Point(j,_),I=new n.Point(x,_);let O=this.pointCoordinate(S,i),H=this.pointCoordinate(C,i);const J=this.pointCoordinate(D,o),ee=this.pointCoordinate(I,o),Y=(se,F)=>(F.y-se.y)/(F.x-se.x);return O.y>1&&H.y>=0?O=new n.MercatorCoordinate((1-ee.y)/Y(ee,O)+ee.x,1):O.y<0&&H.y<=1&&(O=new n.MercatorCoordinate(-ee.y/Y(ee,O)+ee.x,0)),H.y>1&&O.y>=0?H=new n.MercatorCoordinate((1-J.y)/Y(J,H)+J.x,1):H.y<0&&O.y<=1&&(H=new n.MercatorCoordinate(-J.y/Y(J,H)+J.x,0)),new n.LngLatBounds().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(J))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((m,x)=>{if(x.dem){const _=x.dem.tree;m.min=Math.min(m.min,_.minimums[0]),m.max=Math.max(m.max,_.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-n.MAX_MERCATOR_LATITUDE,this.maxLat=n.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=n.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=n.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=n.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,m=this._distanceTileDataCache;if(m[o])return m[o];const x=i.canonical,_=1/this.height,j=this.cameraWorldSize,S=j/this.zoomScale(x.z),C=(x.x+Math.pow(2,x.z)*i.wrap)*S,D=x.y*S,I=this.point;I.x*=j/this.worldSize,I.y*=j/this.worldSize;const O=this.angle,H=Math.sin(-O),J=-Math.cos(-O);return m[o]={bearing:[H,J],center:[(I.x-C)*_,(I.y-D)*_],scale:S/n.EXTENT*_},m[o]}calculateFogTileMatrix(i){const o=i.key,m=this._fogTileMatrixCache;if(m[o])return m[o];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return n.multiply(x,this.worldToFogMatrix,x),m[o]=new Float32Array(x),m[o]}calculateProjMatrix(i,o=!1){const m=i.key,x=o?this._alignedProjMatrixCache:this._projMatrixCache;if(x[m])return x[m];const _=this.calculatePosMatrix(i,this.worldSize);return n.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,_),x[m]=new Float32Array(_),x[m]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[o])return m[o];const x=function(_,j){const{scale:S}=_.tileTransform,C=S*n.EXTENT/(_.tileSize*Math.pow(2,j.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return D=new Float32Array(4),H=(I=j.inverseAdjustmentMatrix)[1],J=I[2],ee=I[3],se=(O=[C,C])[1],D[0]=I[0]*(Y=O[0]),D[1]=H*Y,D[2]=J*se,D[3]=ee*se,D;var D,I,O,H,J,ee,Y,se}(i,this);return m[o]=x,m[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,o=n.fromScaling([],[i,i,i]);return n.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const o=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(o),x=this._camera.forward(),_=n.mercatorZfromAltitude(1,this._center.lat);m[2]/=_,x[2]/=_,n.normalize(x,x);const j=i.raycast(m,x,i.exaggeration());if(j){const S=n.scaleAndAdd([],m,x,j),C=new n.MercatorCoordinate(S[0],S[1],n.mercatorZfromAltitude(S[2],n.latFromMercatorY(S[1]))),D=(C.z+n.length([C.x-m[0],C.y-m[1],C.z-m[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,m=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(m),_=o.getAtPointOrZero(new n.MercatorCoordinate(...x)),j=this.pixelsPerMeter/this.worldSize*_,S=this._minimumHeightOverTerrain(),C=x[2]-j;if(C<=S)if(C<0||i){const D=this.locationCoordinate(this._center,this._centerAltitude),I=[x[0],x[1],D.z-x[2]],O=n.length(I);I[2]-=(S-C)/this._pixelsPerMercatorPixel;const H=n.length(I);if(H===0)return;n.scale$2(I,I,O/H*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],D.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const H=this.center;return H.lat=n.clamp(H.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(H.lng=n.clamp(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const o=this._unmodified,{x:m,y:x}=this.point;let _=0,j=m,S=x;const C=this.width/2,D=this.height/2,I=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(x-D<I&&(S=I+D),x+D>O&&(S=O-D),O-I<this.height&&(_=Math.max(_,this.height/(O-I)),S=(O+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,ee=this.worldSize/2-(H+J)/2;j=(m+ee+this.worldSize)%this.worldSize-ee,j-C<H&&(j=H+C),j+C>J&&(j=J-C),J-H<this.width&&(_=Math.max(_,this.width/(J-H)),j=(J+H)/2)}j===m&&S===x||(this.center=this.unproject(new n.Point(j,S))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.mercatorZfromAltitude(1,this.center.lat)/n.mercatorZfromAltitude(1,n.GLOBE_SCALE_MATCH_LATITUDE));const m=bl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?o:1,_=this._camera.getWorldToCamera(this.worldSize,x),j=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);j[8]=2*-i.x/this.width,j[9]=2*i.y/this.height;let S=n.mul([],j,_);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),be=n.identity([]);n.translate(be,be,[ve.x*this.worldSize,ve.y*this.worldSize,0]),n.multiply(be,be,Ca(this)),n.translate(be,be,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),n.multiply(S,S,be),this.inverseAdjustmentMatrix=function(Me){const ke=Ca(Me,!0);return Ee([],[ke[0],ke[1],ke[4],ke[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=n.scale([],S,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=S,this.invProjMatrix=n.invert(new Float64Array(16),this.projMatrix);const C=n.invert([],j);this.frustumCorners=n.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);n.identity(D),n.scale(D,D,[1,-1,1]),n.rotateX(D,D,this._pitch),n.rotateZ(D,D,this.angle);const I=n.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;I[8]=2*-i.x/this.width,I[9]=2*(i.y+O)/this.height,this.skyboxMatrix=n.multiply(D,I,D);const H=this.point,J=H.x,ee=H.y,Y=this.width%2/2,se=this.height%2/2,F=Math.cos(this.angle),Q=Math.sin(this.angle),ae=J-Math.round(J)+F*Y+Q*se,oe=ee-Math.round(ee)+F*se+Q*Y,_e=new Float64Array(S);if(n.translate(_e,_e,[ae>.5?ae-1:ae,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=_e,S=n.create(),n.scale(S,S,[this.width/2,-this.height/2,1]),n.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=n.create(),n.scale(S,S,[1,-1,1]),n.translate(S,S,[-1,-1,0]),n.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=n.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.calculateGlobeMatrix(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.transformMat4(ve,ve,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,_=[i,i,o];n.scale$2(_,_,x),n.scale$2(m,m,-1),n.multiply$2(m,m,_);const j=n.create();n.translate(j,j,m),n.scale(j,j,_),this.mercatorFogMatrix=j,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,x)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*_,x.y/this.worldSize-m[1]*_,i/this.worldSize*this._centerAltitude-m[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],x=i[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(_=Math.min((o-m)/x,1)),this._camera.position=n.scaleAndAdd([],this._camera.position,i,_),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),_=n.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,j=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.degToRad(this._maxPitch)),S=Math.max((i[2]-_)/Math.cos(m),j),C=this._zoomFromMercatorZ(S);n.scaleAndAdd(i,i,o,S),this._pitch=n.clamp(m,n.degToRad(this.minPitch),n.degToRad(this.maxPitch)),this.angle=n.wrap(x,-Math.PI,Math.PI),this._setZoom(n.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,m=n.GLOBE_ZOOM_THRESHOLD_MAX,x=0,_=1/0;for(;m-o>1e-6&&m>o;){const j=o+.5*(m-o),S=this.tileSize*Math.pow(2,j),C=this.getCameraToCenterDistance(this.projection,j,S),D=this.scaleZoom(C/(i*this.tileSize)),I=Math.abs(j-D);I<_&&(_=I,x=j),j<D?o=j:m=j}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const m=Math.min(i.x,o.x),x=Math.max(i.x,o.x),_=Math.min(i.y,o.y),j=Math.max(i.y,o.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new n.Point(m,_),new n.Point(x,j),new n.Point(m,j),new n.Point(x,_)],C=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const I of S){const O=this.pointRayIntersection(I);if(O.t<0)return!0;const H=this.rayIntersectionCoordinate(O);if(H.x<C||H.y<0||H.x>D||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.Point(0,0),new n.Point(this.width,this.height))}zoomDeltaToMovement(i,o){const m=n.length(n.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(m)+o;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([o,m,x],_){const j=[o,m,x,1];n.transformMat4$1(j,j,_);const S=j[3]=Math.max(j[3],1e-6);return j[0]/=S,j[1]/=S,j[2]/=S,j}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.Point(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.Point(0,i))}}getCameraToCenterDistance(i,o=this.zoom,m=this.worldSize){const x=bl(i,o,this.width,this.height,1024),_=i.pixelSpaceConversion(this.center.lat,m,x);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.multiply(i,i,this.globeMatrix),i}}function Aa(u,i){let o=!1,m=null;const x=()=>{m=null,o&&(u(),m=setTimeout(x,i),o=!1)};return()=>(o=!0,m||x(),m)}class $c{constructor(i){this._hashName=i&&encodeURIComponent(i),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Aa(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,n.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),n.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=jo(i);if(this._hashName){const m=this._hashName;let x=!1;const _=n.window.location.hash.slice(1).split("&").map(j=>{const S=j.split("=")[0];return S===m?(x=!0,`${S}=${o}`):j}).filter(j=>j);return x||_.push(`${m}=${o}`),`#${_.join("&")}`}return`#${o}`}_getCurrentHash(){const i=n.window.location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(o=m)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(m=>isNaN(m))){const m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:m,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=n.window.location.href.replace(/(#.+)?$/,this.getHashString());n.window.history.replaceState(n.window.history.state,null,i)}}function jo(u,i){const o=u.getCenter(),m=Math.round(100*u.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,x),j=Math.round(o.lng*_)/_,S=Math.round(o.lat*_)/_,C=u.getBearing(),D=u.getPitch();let I=i?`/${j}/${S}/${m}`:`${m}/${S}/${j}`;return(C||D)&&(I+="/"+Math.round(10*C)/10),D&&(I+=`/${Math.round(D)}`),I}const No={linearity:.3,easing:n.bezier(0,0,.3,1)},wl=n.extend({deceleration:2500,maxSpeed:1400},No),jl=n.extend({deceleration:20,maxSpeed:1400},No),Et=n.extend({deceleration:1e3,maxSpeed:360},No),Ii=n.extend({deceleration:1e3,maxSpeed:90},No);class Pd{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=n.exported.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new n.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(o.pan.mag()){const _=To(o.pan.mag(),m,n.extend({},wl,i||{}));x.offset=o.pan.mult(_.amount/o.pan.mag()),x.center=this._map.transform.center,So(x,_)}if(o.zoom){const _=To(o.zoom,m,jl);x.zoom=this._map.transform.zoom+_.amount,So(x,_)}if(o.bearing){const _=To(o.bearing,m,Et);x.bearing=this._map.transform.bearing+n.clamp(_.amount,-179,179),So(x,_)}if(o.pitch){const _=To(o.pitch,m,Ii);x.pitch=this._map.transform.pitch+_.amount,So(x,_)}if(x.zoom||x.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;x.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function So(u,i){(!u.duration||u.duration<i.duration)&&(u.duration=i.duration,u.easing=i.easing)}function To(u,i,o){const{maxSpeed:m,linearity:x,deceleration:_}=o,j=n.clamp(u*x/(i/1e3),-m,m),S=Math.abs(j)/(_*x);return{easing:o.easing,duration:1e3*S,amount:j*(S/2)}}class Tr extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m,x={}){const _=Ce(o.getCanvasContainer(),m),j=o.unproject(_);super(i,n.extend({point:_,lngLat:j,originalEvent:m},x)),this._defaultPrevented=!1,this.target=o}}class Eo extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m){const x=i==="touchend"?m.changedTouches:m.touches,_=Ae(o.getCanvasContainer(),x),j=_.map(C=>o.unproject(C)),S=_.reduce((C,D,I,O)=>C.add(D.div(O.length)),new n.Point(0,0));super(i,{points:_,point:S,lngLats:j,lngLat:o.unproject(S),originalEvent:m}),this._defaultPrevented=!1}}class Nl extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class Gc{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Nl(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Tr(i.type,this._map,i))}mouseup(i){this._map.fire(new Tr(i.type,this._map,i))}preclick(i){const o=n.extend({},i);o.type="preclick",this._map.fire(new Tr(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Tr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Tr(i.type,this._map,i))}mouseover(i){this._map.fire(new Tr(i.type,this._map,i))}mouseout(i){this._map.fire(new Tr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Eo(i.type,this._map,i))}touchmove(i){this._map.fire(new Eo(i.type,this._map,i))}touchend(i){this._map.fire(new Eo(i.type,this._map,i))}touchcancel(i){this._map.fire(new Eo(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sl{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Tr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Tr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Id{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(re(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const m=o,x=this._startPos,_=this._lastPos;if(!x||!_||_.equals(m)||!this._box&&m.dist(x)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=G("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const j=Math.min(x.x,m.x),S=Math.max(x.x,m.x),C=Math.min(x.y,m.y),D=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${j}px,${C}px)`,this._box.style.width=S-j+"px",this._box.style.height=D-C+"px")})}mouseupWindow(i,o){if(!this._active)return;const m=this._startPos,x=o;if(m&&i.button===0){if(this.reset(),me(),m.x!==x.x||m.y!==x.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),te(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new n.Event(i,{originalEvent:o}))}}function Tl(u,i){const o={};for(let m=0;m<u.length;m++)o[u[m].identifier]=i[m];return o}class Ma{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const _=new n.Point(0,0);for(const j of x)_._add(j);return _.div(x.length)}(o),this.touches=Tl(m,o)))}touchmove(i,o,m){if(this.aborted||!this.centroid)return;const x=Tl(m,o);for(const _ in this.touches){const j=x[_];(!j||j.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Zc{constructor(i){this.singleTap=new Ma(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,m){this.singleTap.touchstart(i,o,m)}touchmove(i,o,m){this.singleTap.touchmove(i,o,m)}touchend(i,o,m){const x=this.singleTap.touchend(i,o,m);if(x){const _=i.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(x)<30;if(_&&j||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Mm{constructor(){this._zoomIn=new Zc({numTouches:1,numTaps:2}),this._zoomOut=new Zc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,m){this._zoomIn.touchstart(i,o,m),this._zoomOut.touchstart(i,o,m)}touchmove(i,o,m){this._zoomIn.touchmove(i,o,m),this._zoomOut.touchmove(i,o,m)}touchend(i,o,m){const x=this._zoomIn.touchend(i,o,m),_=this._zoomOut.touchend(i,o,m);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()+1,around:j.unproject(x)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()-1,around:j.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Dd={0:1,2:2};class Pa{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const m=fe(i);this._correctButton(i,m)&&(this._lastPoint=o,this._eventButton=m)}mousemoveWindow(i,o){const m=this._lastPoint;if(m){if(i.preventDefault(),this._eventButton!=null&&function(x,_){const j=Dd[_];return x.buttons===void 0||(x.buttons&j)!==j}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(m,o)}}mouseupWindow(i){this._lastPoint&&fe(i)===this._eventButton&&(this._moved&&me(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wc extends Pa{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class Hc extends Pa{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const m=.8*(o.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class Xc extends Pa{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const m=-.5*(o.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class El{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.Point(0,0)}touchstart(i,o,m){return this._calculateTransform(i,o,m)}touchmove(i,o,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!n.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,m)}}touchend(i,o,m){this._calculateTransform(i,o,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,m){m.length>0&&(this._active=!0);const x=Tl(m,o),_=new n.Point(0,0),j=new n.Point(0,0);let S=0;for(const D in x){const I=x[D],O=this._touches[D];O&&(_._add(I),j._add(I.sub(O)),S++,x[D]=I)}if(this._touches=x,S<this._minTouches||!j.mag())return;const C=j.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Co{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,m){return{}}touchstart(i,o,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,m){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[_,j]=x,S=ko(m,o,_),C=ko(m,o,j);if(!S||!C)return;const D=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],D,i)}touchend(i,o,m){if(!this._firstTwoTouches)return;const[x,_]=this._firstTwoTouches,j=ko(m,o,x),S=ko(m,o,_);j&&S||(this._active&&me(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ko(u,i,o){for(let m=0;m<u.length;m++)if(u[m].identifier===o)return i[m]}function Kc(u,i){return Math.log(u/i)/Math.LN2}class Ld extends Co{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,m),pinchAround:o}}}function Qc(u,i){return 180*u.angleWith(i)/Math.PI}class Rd extends Co{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const m=this._vector;if(this._vector=i[0].sub(i[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Qc(this._vector,m),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const x=Qc(i,m);return Math.abs(x)<o}}function An(u){return Math.abs(u.y)>Math.abs(u.x)}class zd extends Co{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,An(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,m){const x=this._lastPoints;if(!x)return;const _=i[0].sub(x[0]),j=i[1].sub(x[1]);return this._map._cooperativeGestures&&!n.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(_,j,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+j.y)/2*-.5})}gestureBeginsVertically(i,o,m){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,_=o.mag()>=2;if(!x&&!_)return;if(!x||!_)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const j=i.y>0==o.y>0;return An(i)&&An(o)&&j}}const Od={panStep:100,bearingStep:15,pitchStep:10};class Pm{constructor(){const i=Od;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,m=0,x=0,_=0,j=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),j=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:S=>{const C=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Fd,zoom:o?Math.round(C)+o*(i.shiftKey?2:1):C,bearing:S.getBearing()+m*this._bearingStep,pitch:S.getPitch()+x*this._pitchStep,offset:[-_*this._panStep,-j*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fd(u){return u*(2-u)}const Jc=4.000244140625;class Bd{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||n.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===n.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=n.exported.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,o!==0&&o%Jc==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Ce(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Jc?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&D!==0&&(D=1/D);const I=o(),O=Math.pow(2,I),H=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(H*D))),this._type==="wheel"&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:o(),x=this._startZoom,_=this._easing;let j,S=!1;if(this._type==="wheel"&&x&&_){const C=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),D=_(C);j=n.number(x,m,D),C<1?this._frameId||(this._frameId=!0):S=!0}else j=m,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:j-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=n.ease;if(this._prevEase){const m=this._prevEase,x=(n.exported.now()-m.start)/m.duration,_=m.easing(x+.01)-m.easing(x),j=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-j*j);o=n.bezier(j,S,.25,1)}return this._prevEase={start:n.exported.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(n.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ud{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Im{constructor(){this._tap=new Zc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=o[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,o,m))}touchmove(i,o,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=o[0],_=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,m)}touchend(i,o,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(i,o,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vd{constructor(i,o,m){this._el=i,this._mousePan=o,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Dm{constructor(i,o,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Lm{constructor(i,o,m,x){this._el=i,this._touchZoom=o,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wi=u=>u.zoom||u.drag||u.pitch||u.rotate;class qd extends n.Event{}class Rm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const m=n.sub([],o,i);this.radius=n.length(m[2]<0?n.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){n.div(i,i,this.constants),n.normalize(i,i),n.mul$1(i,i,this.constants);const o=n.scale$2([],i,this.radius);if(o[2]>0){const m=n.scale$2([],[0,0,1],n.dot(o,[0,0,1])),x=n.scale$2([],n.normalize([],[o[0],o[1],0]),this.radius),_=n.add([],o,n.scale$2([],n.sub([],n.add([],x,m),o),2));o[0]=_[0],o[1]=_[1]}return o}}function Di(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class $i{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pd(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Rm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[n.window.document,"mousemove",{capture:!0}],[n.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[n.window,"blur",void 0]];for(const[x,_,j]of this._listeners)x.addEventListener(_,x===n.window.document?this.handleWindowEvent:this.handleEvent,j)}destroy(){for(const[i,o,m]of this._listeners)i.removeEventListener(o,i===n.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const o=this._map,m=o.getCanvasContainer();this._add("mapEvent",new Gc(o,i));const x=o.boxZoom=new Id(o,i);this._add("boxZoom",x);const _=new Mm,j=new Vr;o.doubleClickZoom=new Ud(j,_),this._add("tapZoom",_),this._add("clickZoom",j);const S=new Im;this._add("tapDragZoom",S);const C=o.touchPitch=new zd(o);this._add("touchPitch",C);const D=new Hc(i),I=new Xc(i);o.dragRotate=new Dm(i,D,I),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const O=new Wc(i),H=new El(o,i);o.dragPan=new Vd(m,O,H),this._add("mousePan",O),this._add("touchPan",H,["touchZoom","touchRotate"]);const J=new Rd,ee=new Ld;o.touchZoomRotate=new Lm(m,ee,J,S),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sl(o));const Y=o.scrollZoom=new Bd(o,this);this._add("scrollZoom",Y,["mousePan"]);const se=o.keyboard=new Pm;this._add("keyboard",se);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[F]&&o[F].enable(i[F])}_add(i,o,m){this._handlers.push({handlerName:i,handler:o,allowed:m}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,m){for(const x in i)if(x!==m&&(!o||o.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const m of i)this._el.contains(m.target)&&o.push(m);return o}handleEvent(i,o){this._updatingCamera=!0;const m=i.type==="renderFrame",x=m?void 0:i,_={needsRenderFrame:!1},j={},S={},C=i.touches?this._getMapTouches(i.touches):void 0,D=C?Ae(this._el,C):m?void 0:Ce(this._el,i);for(const{handlerName:H,handler:J,allowed:ee}of this._handlers){if(!J.isEnabled())continue;let Y;this._blockedByActive(S,ee,H)?J.reset():J[o||i.type]&&(Y=J[o||i.type](i,D,C),this.mergeHandlerResult(_,j,Y,H,x),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||J.isActive())&&(S[H]=J)}const I={};for(const H in this._previousActiveHandlers)S[H]||(I[H]=x);this._previousActiveHandlers=S,(Object.keys(I).length||Di(_))&&(this._changes.push([_,j,I]),this._triggerRenderFrame()),(Object.keys(S).length||Di(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=_;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(i,o,m,x,_){if(!m)return;n.extend(i,m);const j={handlerName:x,originalEvent:m.originalEvent||_};m.zoomDelta!==void 0&&(o.zoom=j),m.panDelta!==void 0&&(o.drag=j),m.pitchDelta!==void 0&&(o.pitch=j),m.bearingDelta!==void 0&&(o.rotate=j)}_applyChanges(){const i={},o={},m={};for(const[x,_,j]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new n.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),n.extend(o,_),n.extend(m,j);this._updateMapTransform(i,o,m),this._changes=[]}_updateMapTransform(i,o,m){const x=this._map,_=x.transform,j=Q=>[Q.x,Q.y,Q.z];if((Q=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!Di(i)){const Q=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",Q!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&x._stop(!0),!Di(i))return void this._fireEvents(o,m,!0);let{panDelta:S,zoomDelta:C,bearingDelta:D,pitchDelta:I,around:O,aroundCoord:H,pinchAround:J}=i;_._isCameraConstrained&&(C>0&&(C=0),_._isCameraConstrained=!1),J!==void 0&&(O=J),(C||(Q=>o[Q]&&!this._eventsInProgress[Q])("drag"))&&O&&(this._dragOrigin=j(_.pointCoordinate3D(O)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",x._stop(!0),O=O||x.transform.centerPoint,D&&(_.bearing+=D),I&&(_.pitch+=I),_._updateCameraState();const ee=[0,0,0];if(S)if(_.projection.name==="mercator"){const Q=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O).dir),ae=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O.sub(S)).dir);ee[0]=ae[0]-Q[0],ee[1]=ae[1]-Q[1]}else{const Q=_.pointCoordinate(O);if(_.projection.name==="globe"){S=S.rotate(-_.angle);const ae=_._pixelsPerMercatorPixel/_.worldSize;ee[0]=-S.x*n.mercatorScale(n.latFromMercatorY(Q.y))*ae,ee[1]=-S.y*n.mercatorScale(_.center.lat)*ae}else{const ae=_.pointCoordinate(O.sub(S));Q&&ae&&(ee[0]=ae.x-Q.x,ee[1]=ae.y-Q.y)}}const Y=_.zoom,se=[0,0,0];if(C){const Q=j(H||_.pointCoordinate3D(O)),ae={dir:n.normalize([],n.sub([],Q,_._camera.position))};if(ae.dir[2]<0){const oe=_.zoomDeltaToMovement(Q,C);n.scale$2(se,ae.dir,oe)}}const F=n.add(ee,ee,se);_._translateCameraConstrained(F),C&&Math.abs(_.zoom-Y)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,m,!0)}_fireEvents(i,o,m){const x=wi(this._eventsInProgress),_=wi(i),j={};for(const I in i){const{originalEvent:O}=i[I];this._eventsInProgress[I]||(j[`${I}start`]=O),this._eventsInProgress[I]=i[I]}!x&&_&&this._fireEvent("movestart",_.originalEvent);for(const I in j)this._fireEvent(I,j[I]);_&&this._fireEvent("move",_.originalEvent);for(const I in i){const{originalEvent:O}=i[I];this._fireEvent(I,O)}const S={};let C;for(const I in this._eventsInProgress){const{handlerName:O,originalEvent:H}=this._eventsInProgress[I];this._handlersById[O].isActive()||(delete this._eventsInProgress[I],C=o[O]||H,S[`${I}end`]=C)}for(const I in S)this._fireEvent(I,S[I]);const D=wi(this._eventsInProgress);if(m&&(x||_)&&!D){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;I?(O(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:C})):(this._map.fire(new n.Event("moveend",{originalEvent:C})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new n.Event(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new qd("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ea="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Cl extends n.Evented{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,m){return i=n.Point.convert(i).mult(-1),this.panTo(this.transform.center,n.extend({offset:i},o),m)}panTo(i,o,m){return this.easeTo(n.extend({center:i},o),m)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,m){return this.easeTo(n.extend({zoom:i},o),m)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,m){return this.easeTo(n.extend({bearing:i},o),m)}resetNorth(i,o){return this.rotateTo(0,n.extend({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=n.LngLatBounds.convert(i);const m=o&&o.bearing||0,x=o&&o.pitch||0,_=i.getNorthWest(),j=i.getSouthEast();return this._cameraForBounds(this.transform,_,j,m,x,o)}_extendCameraOptions(i){const o={top:0,bottom:0,right:0,left:0};if(typeof(i=n.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const m=i.padding;i.padding={top:m,bottom:m,right:m,left:m}}return i.padding=n.extend(o,i.padding),i}_minimumAABBFrustumDistance(i,o){const m=o.max[0]-o.min[0],x=o.max[1]-o.min[1];return m/x>i.aspect?m/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,m,x,_,j){const S=i.clone(),C=this._extendCameraOptions(j);S.bearing=x,S.pitch=_;const D=n.LngLat.convert(o),I=n.LngLat.convert(m),O=.5*(D.lat+I.lat),H=.5*(D.lng+I.lng),J=n.latLngToECEF(O,H),ee=n.normalize([],J),Y=n.normalize([],n.cross([],ee,[0,1,0])),se=n.cross([],Y,ee),F=[Y[0],Y[1],Y[2],0,se[0],se[1],se[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],Q=[J,n.latLngToECEF(D.lat,D.lng),n.latLngToECEF(I.lat,D.lng),n.latLngToECEF(I.lat,I.lng),n.latLngToECEF(D.lat,I.lng),n.latLngToECEF(O,D.lng),n.latLngToECEF(O,I.lng),n.latLngToECEF(D.lat,H),n.latLngToECEF(I.lat,H)];let ae=n.Aabb.fromPoints(Q.map(st=>[n.dot(Y,st),n.dot(se,st),n.dot(ee,st)]));const oe=n.transformMat4([],ae.center,F);n.squaredLength(oe)===0&&n.set(oe,0,0,1),n.normalize(oe,oe),n.scale$2(oe,oe,n.GLOBE_RADIUS),S.center=n.ecefToLatLng(oe);const _e=S.getWorldToCameraMatrix(),ve=n.invert(new Float64Array(16),_e);ae=n.Aabb.applyTransform(ae,n.multiply([],_e,F)),n.transformMat4(oe,oe,_e);const be=.5*(ae.max[2]-ae.min[2]),Me=this._minimumAABBFrustumDistance(S,ae),ke=n.scale$2([],[0,0,1],be),Be=n.add(ke,oe,ke),at=Me+(S.pitch===0?0:n.distance(oe,Be)),ze=S.globeCenterInViewSpace,Qe=n.sub([],oe,[ze[0],ze[1],ze[2]]);n.normalize(Qe,Qe),n.scale$2(Qe,Qe,at);const Ve=n.add([],oe,Qe);n.transformMat4(Ve,Ve,ve);const nt=n.earthRadius/n.GLOBE_RADIUS,Fe=n.length(Ve),Xe=n.mercatorZfromAltitude(Math.max(Fe*nt-n.earthRadius,Number.EPSILON),0),lt=Math.min(S.zoomFromMercatorZAdjusted(Xe),C.maxZoom);return lt>.5*(n.GLOBE_ZOOM_THRESHOLD_MIN+n.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=lt,this._cameraForBounds(S,o,m,x,_,j)):{center:S.center,zoom:lt,bearing:x,pitch:_}}queryTerrainElevation(i,o){const m=this.transform.elevation;return m?(o=n.extend({},{exaggerated:!0},o),m.getAtPoint(n.MercatorCoordinate.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,m,x,_,j){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,o,m,x,_,j);const S=i.clone(),C=this._extendCameraOptions(j),D=S.padding;S.bearing=x,S.pitch=_;const I=n.LngLat.convert(o),O=n.LngLat.convert(m),H=new n.LngLat(I.lng,O.lat),J=new n.LngLat(O.lng,I.lat),ee=S.project(I),Y=S.project(O),se=this.queryTerrainElevation(I),F=this.queryTerrainElevation(O),Q=this.queryTerrainElevation(H),ae=this.queryTerrainElevation(J),oe=[[ee.x,ee.y,Math.min(se||0,F||0,Q||0,ae||0)],[Y.x,Y.y,Math.max(se||0,F||0,Q||0,ae||0)]];let _e=n.Aabb.fromPoints(oe);const ve=S.getWorldToCameraMatrix(),be=n.invert(new Float64Array(16),ve);_e=n.Aabb.applyTransform(_e,ve);const Me=n.sub([],_e.max,_e.min),ke=D.left||0,Be=D.right||0,at=D.bottom||0,ze=D.top||0,{left:Qe,right:Ve,top:nt,bottom:Fe}=C.padding,Xe=.5*(ke+Be),lt=.5*(ze+at),st=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(ke+Be+Qe+Ve))/Me[0],(S.height-(at+ze+Fe+nt))/Me[1])),C.maxZoom),ct=S.scale/S.zoomScale(st);_e=new n.Aabb([_e.min[0]-(Qe+Xe)*ct,_e.min[1]-(Fe+lt)*ct,_e.min[2]],[_e.max[0]+(Ve+Xe)*ct,_e.max[1]+(nt+lt)*ct,_e.max[2]]);const Dt=.5*Me[2],Vt=this._minimumAABBFrustumDistance(S,_e),At=[0,0,1,0];n.transformMat4$1(At,At,ve),n.normalize$2(At,At);const Ot=n.scale$2([],At,Vt+Dt),is=n.add([],_e.center,Ot),ts=(typeof C.offset.x=="number"&&typeof C.offset.y=="number"?new n.Point(C.offset.x,C.offset.y):n.Point.convert(C.offset)).rotate(-n.degToRad(x));_e.center[0]-=ts.x*ct,_e.center[1]+=ts.y*ct,n.transformMat4(_e.center,_e.center,be),n.transformMat4(is,is,be);const Pt=[_e.center[0],_e.center[1],is[2]*S.pixelsPerMeter];n.scale$2(Pt,Pt,1/S.worldSize);const vs=n.lngFromMercatorX(Pt[0]),ws=n.latFromMercatorY(Pt[1]),js=Math.min(S._zoomFromMercatorZ(Pt[2]),C.maxZoom),Ns=new n.LngLat(vs,ws);return S.mercatorFromTransition&&js<.5*(n.GLOBE_ZOOM_THRESHOLD_MIN+n.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=js,this._cameraForBounds(S,o,m,x,_,j)):{center:Ns,zoom:js,bearing:x,pitch:_}}fitBounds(i,o,m){const x=this.cameraForBounds(i,o);return this._fitInternal(x,o,m)}fitScreenCoordinates(i,o,m,x,_){const j=n.Point.convert(i),S=n.Point.convert(o),C=new n.Point(Math.min(j.x,S.x),Math.min(j.y,S.y)),D=new n.Point(Math.max(j.x,S.x),Math.max(j.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(j,S))return this;const I=this.transform.pointLocation3D(C),O=this.transform.pointLocation3D(D),H=this.transform.pointLocation3D(new n.Point(C.x,D.y)),J=this.transform.pointLocation3D(new n.Point(D.x,C.y)),ee=[Math.min(I.lng,O.lng,H.lng,J.lng),Math.min(I.lat,O.lat,H.lat,J.lat)],Y=[Math.max(I.lng,O.lng,H.lng,J.lng),Math.max(I.lat,O.lat,H.lat,J.lat)],se=x&&x.pitch?x.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,ee,Y,m,se,x);return this._fitInternal(F,x,_)}_fitInternal(i,o,m){return i?(delete(o=n.extend(i,o)).padding,o.linear?this.easeTo(o,m):this.flyTo(o,m)):this}jumpTo(i,o){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let x=!1,_=!1,j=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(x=!0,m.zoom=+i.zoom),i.center!==void 0&&(m.center=n.LngLat.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(_=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(j=!0,m.pitch=+i.pitch),i.padding==null||m.isPaddingEqual(i.padding)||(m.padding=i.padding),i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),x&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),_&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),j&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.warnOnce(ea),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const m=this.transform;if(!m.projection.supportsFreeCamera)return n.warnOnce(ea),this;this.stop();const x=m.zoom,_=m.pitch,j=m.bearing;m.setFreeCameraOptions(i);const S=x!==m.zoom,C=_!==m.pitch,D=j!==m.bearing;return this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),S&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),D&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),C&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=n.extend({offset:[0,0],duration:500,easing:n.ease},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const m=this.transform,x=this.getZoom(),_=this.getBearing(),j=this.getPitch(),S=this.getPadding(),C="zoom"in i?+i.zoom:x,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:j,O="padding"in i?i.padding:m.padding,H=n.Point.convert(i.offset);let J,ee,Y;if(m.projection.name==="globe"){const ke=n.MercatorCoordinate.fromLngLat(m.center),Be=H.rotate(-m.angle);ke.x+=Be.x/m.worldSize,ke.y+=Be.y/m.worldSize;const at=ke.toLngLat(),ze=n.LngLat.convert(i.center||at);this._normalizeCenter(ze),J=m.centerPoint.add(Be),ee=new n.Point(ke.x,ke.y).mult(m.worldSize),Y=new n.Point(n.mercatorXfromLng(ze.lng),n.mercatorYfromLat(ze.lat)).mult(m.worldSize).sub(ee)}else{J=m.centerPoint.add(H);const ke=m.pointLocation(J),Be=n.LngLat.convert(i.center||ke);this._normalizeCenter(Be),ee=m.project(ke),Y=m.project(Be).sub(ee)}const se=m.zoomScale(C-x);let F,Q;i.around&&(F=n.LngLat.convert(i.around),Q=m.locationPoint(F));const ae=this._zooming||C!==x,oe=this._rotating||_!==D,_e=this._pitching||I!==j,ve=!m.isPaddingEqual(O),be=ke=>Be=>{if(ae&&(ke.zoom=n.number(x,C,Be)),oe&&(ke.bearing=n.number(_,D,Be)),_e&&(ke.pitch=n.number(j,I,Be)),ve&&(ke.interpolatePadding(S,O,Be),J=ke.centerPoint.add(H)),F)ke.setLocationAtPoint(F,Q);else{const at=ke.zoomScale(ke.zoom-x),ze=C>x?Math.min(2,se):Math.max(.5,se),Qe=Math.pow(ze,1-Be),Ve=ke.unproject(ee.add(Y.mult(Be*Qe)).mult(at));ke.setLocationAtPoint(ke.renderWorldCopies?Ve.wrap():Ve,J)}return i.preloadOnly||this._fireMoveEvents(o),ke};if(i.preloadOnly){const ke=this._emulate(be,i.duration,m);return this._preloadTiles(ke),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=oe,this._pitching=_e,this._padding=ve,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,Me),this._ease(be(m),ke=>{m.recenterOnTerrain(),this._afterEase(o,ke)},i),this}_prepareEase(i,o,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||m.moving||this.fire(new n.Event("movestart",i)),this._zooming&&!m.zooming&&this.fire(new n.Event("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new n.Event("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new n.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new n.Event("move",i)),this._zooming&&this.fire(new n.Event("zoom",i)),this._rotating&&this.fire(new n.Event("rotate",i)),this._pitching&&this.fire(new n.Event("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new n.Event("zoomend",i)),x&&this.fire(new n.Event("rotateend",i)),_&&this.fire(new n.Event("pitchend",i)),this.fire(new n.Event("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const st=n.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,o)}this.stop(),i=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},i);const m=this.transform,x=this.getZoom(),_=this.getBearing(),j=this.getPitch(),S=this.getPadding(),C="zoom"in i?n.clamp(+i.zoom,m.minZoom,m.maxZoom):x,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:j,O="padding"in i?i.padding:m.padding,H=m.zoomScale(C-x),J=n.Point.convert(i.offset);let ee=m.centerPoint.add(J);const Y=m.pointLocation(ee),se=n.LngLat.convert(i.center||Y);this._normalizeCenter(se);const F=m.project(Y),Q=m.project(se).sub(F);let ae=i.curve;const oe=Math.max(m.width,m.height),_e=oe/H,ve=Q.mag();if("minZoom"in i){const st=n.clamp(Math.min(i.minZoom,x,C),m.minZoom,m.maxZoom),ct=oe/m.zoomScale(st-x);ae=Math.sqrt(ct/ve*2)}const be=ae*ae;function Me(st){const ct=(_e*_e-oe*oe+(st?-1:1)*be*be*ve*ve)/(2*(st?_e:oe)*be*ve);return Math.log(Math.sqrt(ct*ct+1)-ct)}function ke(st){return(Math.exp(st)-Math.exp(-st))/2}function Be(st){return(Math.exp(st)+Math.exp(-st))/2}const at=Me(0);let ze=function(st){return Be(at)/Be(at+ae*st)},Qe=function(st){return oe*((Be(at)*(ke(ct=at+ae*st)/Be(ct))-ke(at))/be)/ve;var ct},Ve=(Me(1)-at)/ae;if(Math.abs(ve)<1e-6||!isFinite(Ve)){if(Math.abs(oe-_e)<1e-6)return this.easeTo(i,o);const st=_e<oe?-1:1;Ve=Math.abs(Math.log(_e/oe))/ae,Qe=function(){return 0},ze=function(ct){return Math.exp(st*ae*ct)}}i.duration="duration"in i?+i.duration:1e3*Ve/("screenSpeed"in i?+i.screenSpeed/ae:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const nt=_!==D,Fe=I!==j,Xe=!m.isPaddingEqual(O),lt=st=>ct=>{const Dt=ct*Ve,Vt=1/ze(Dt);st.zoom=ct===1?C:x+st.scaleZoom(Vt),nt&&(st.bearing=n.number(_,D,ct)),Fe&&(st.pitch=n.number(j,I,ct)),Xe&&(st.interpolatePadding(S,O,ct),ee=st.centerPoint.add(J));const At=ct===1?se:st.unproject(F.add(Q.mult(Qe(Dt))).mult(Vt));return st.setLocationAtPoint(st.renderWorldCopies?At.wrap():At,ee),st._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),st};if(i.preloadOnly){const st=this._emulate(lt,i.duration,m);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=nt,this._pitching=Fe,this._padding=Xe,this._prepareEase(o,!1),this._ease(lt(m),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,o)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,o,m){m.animate===!1||m.duration===0?(i(1),o()):(this._easeStart=n.exported.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=n.wrap(i,-180,180);const m=Math.abs(i-o);return Math.abs(i-360-o)<m&&(i-=360),Math.abs(i+360-o)<m&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const m=i.lng-o.center.lng;i.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&n.exported.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,m){const x=Math.ceil(15*o/1e3),_=[],j=i(m.clone());for(let S=0;S<=x;S++){const C=j(S/x);_.push(C.clone())}return _}}class Ct{constructor(i={}){this.options=i,n.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact;return this._map=i,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G("button","mapboxgl-ctrl-attrib-button",this._container),G("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const m=this._map._getUIString(`AttributionControl.${o}`);i.setAttribute("aria-label",m),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.config.ACCESS_TOKEN}];if(i){const m=o.reduce((x,_,j)=>(_.value&&(x+=`${_.key}=${_.value}${j<o.length-1?"&":""}`),x),"?");i.href=`${n.config.FEEDBACK_URL}/${m}#${jo(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const o=this._map.style._sourceCaches;for(const x in o){const _=o[x];if(_.used){const j=_.getSource();j.attribution&&i.indexOf(j.attribution)<0&&i.push(j.attribution)}}i.sort((x,_)=>x.length-_.length),i=i.filter((x,_)=>{for(let j=_+1;j<i.length;j++)if(i[j].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yc{constructor(){n.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=G("div","mapboxgl-ctrl");const o=G("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const m=i[o].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class eu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,m=o?this._queue.concat(o):this._queue;for(const x of m)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const m of o)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ia(u,i,o){if(u=new n.LngLat(u.lng,u.lat),i){const m=new n.LngLat(u.lng-360,u.lat),x=new n.LngLat(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-o.center.lng)/360),j=o.locationPoint(u).distSqr(i),S=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(m).distSqr(i)<j&&(S||Math.abs(m.lng-o.center.lng)<_)?u=m:o.locationPoint(x).distSqr(i)<j&&(S||Math.abs(x.lng-o.center.lng)<_)&&(u=x)}for(;Math.abs(u.lng-o.center.lng)>180;){const m=o.locationPoint(u);if(m.x>=0&&m.y>=0&&m.x<=o.width&&m.y<=o.height)break;u.lng>o.center.lng?u.lng-=360:u.lng+=360}return u}const ta={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class St extends n.Evented{constructor(i,o){if(super(),(i instanceof n.window.HTMLElement||o)&&(i=n.extend({element:i},o)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=n.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=G("div");const x=41,_=27,j=W("svg",{display:"block",height:x*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${x}`},this._element),S=W("radialGradient",{id:"shadowGradient"},W("defs",{},j));W("stop",{offset:"10%","stop-opacity":.4},S),W("stop",{offset:"100%","stop-opacity":.05},S),W("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},j),W("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},j),W("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},j),W("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},j),this._offset=n.Point.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const m=this._element.classList;for(const x in ta)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=n.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,m=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,m=this._element;this._popup&&(o===m||m.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const m=i.unproject(o),x=i.getFreeCameraOptions();if(!x.position)return!1;const _=x.position.toLngLat();return _.distanceTo(m)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const m=i.unproject(o);let x;i._showingGlobe()&&n.isLngLatBehindGlobe(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${ta[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const i=this._pos,o=this._map,m=this.getPitchAlignment();if(!o||!i||m!=="map")return"";if(!o._showingGlobe()){const C=o.getPitch();return C?`rotateX(${C}deg)`:""}const x=n.radToDeg(n.globeTiltAtLngLat(o.transform,this._lngLat)),_=i.sub(n.globeCenterToScreenPoint(o.transform)),j=Math.abs(_.x)+Math.abs(_.y);if(j===0)return"";const S=x/j;return`rotateX(${-_.y*S}deg) rotateY(${_.x*S}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let m=0;const x=this.getRotationAlignment();if(x==="map")if(o._showingGlobe()){const _=o.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),j=o.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);m=n.radToDeg(Math.atan2(j.y,j.x))-90}else m=-o.getBearing();else if(x==="horizon"){const _=n.smoothstep(4,6,o.getZoom()),j=n.globeCenterToScreenPoint(o.transform);j.y+=_*o.transform.height;const S=i.sub(j),C=n.radToDeg(Math.atan2(S.y,S.x));m=(C>90?C-270:C+90)*(1-_)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){n.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Ia(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),i===!0?this._updateFrameId=n.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=n.Point.convert(i),this._update(),this}_onMove(i){const o=this._map;if(!o)return;const m=this._pointerdownPos,x=this._positionDelta;if(m&&x){if(!this._isDragging){const _=this._clickTolerance||o._clickTolerance;if(i.point.dist(m)<_)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,m=this._pos;o&&m&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(m),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $d(u=new n.Point(0,0),i="bottom"){if(typeof u=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(i){case"top":return new n.Point(0,u);case"top-left":return new n.Point(o,o);case"top-right":return new n.Point(-o,o);case"bottom":return new n.Point(0,-u);case"bottom-left":return new n.Point(o,-o);case"bottom-right":return new n.Point(-o,-o);case"left":return new n.Point(u,0);case"right":return new n.Point(-u,0)}return new n.Point(0,0)}return u instanceof n.Point||Array.isArray(u)?n.Point.convert(u):n.Point.convert(u[i]||[0,0])}class su{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=n.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,m){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+m}}const Gd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Zd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Om={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fm{constructor(i,o,m=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Hc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new Xc({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),re()}move(i,o){const m=this.map,x=this.mouseRotate.mousemoveWindow(i,o),_=x&&x.bearingDelta;if(_&&m.setBearing(m.getBearing()+_),this.mousePitch){const j=this.mousePitch.mousemoveWindow(i,o),S=j&&j.pitchDelta;S&&m.setPitch(m.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){te(),n.window.removeEventListener("mousemove",this.mousemove),n.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(n.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Ce(this.element,i)),n.window.addEventListener("mousemove",this.mousemove),n.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Ce(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ae(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Ae(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ru={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},iu={maxWidth:100,unit:"metric"},nu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Da={version:n.version,supported:z,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends Cl{constructor(u){if(n.LivePerformanceUtils.mark(n.PerformanceMarkers.create),(u=n.extend({},Zd,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&n.isSafariWithAntialiasingBug(n.window)&&(u.antialias=!1,n.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ka(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._useWebGL2=u.useWebGL2,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._optimizeForTerrain=u.optimizeForTerrain,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new eu,this._domRenderTaskQueue=new eu,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.uniqueId(),this._locale=n.extend({},Gd,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new su(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new n.RequestManager(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,typeof u.container=="string"){if(this._container=n.window.document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof n.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&n.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),n.window!==void 0&&(n.window.addEventListener("online",this._onWindowOnline,!1),n.window.addEventListener("resize",this._onWindowResize,!1),n.window.addEventListener("orientationchange",this._onWindowResize,!1),n.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new $i(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this._hash=u.hash&&new $c(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,n.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),u.attributionControl&&this.addControl(new Ct({customAttribution:u.customAttribution})),this._logoControl=new Yc,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new n.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new n.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(u,i){if(i===void 0&&(i=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=u.onAdd(this);this._controls.push(u);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(o,m.firstChild):m.appendChild(o),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(u);return i>-1&&this._controls.splice(i,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new n.Event("movestart",u)).fire(new n.Event("move",u)),this.fire(new n.Event("resize",u)),i&&this.fire(new n.Event("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(n.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?n.window.navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(i=>i==="auto"?n.window.navigator.language:i):u}setLanguage(u){const i=this._parseLanguage(u);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,i=u.projection.name;let o;i==="globe"&&u.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?(u.setMercatorFromTransition(),o=!0):i==="mercator"&&u.zoom<n.GLOBE_ZOOM_THRESHOLD_MAX&&(u.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,i){return this._updateProjection(u||i||{name:"mercator"})}_updateProjection(u){let i;if(i=u.name==="globe"&&this.transform.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(u){return this.transform.locationPoint3D(n.LngLat.convert(u))}unproject(u){return this.transform.pointLocation3D(n.Point.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,i,o){if(u==="mouseenter"||u==="mouseover"){let m=!1;const x=j=>{const S=i.filter(D=>this.getLayer(D)),C=S.length?this.queryRenderedFeatures(j.point,{layers:S}):[];C.length?m||(m=!0,o.call(this,new Tr(u,this,j.originalEvent,{features:C}))):m=!1},_=()=>{m=!1};return{layers:new Set(i),listener:o,delegates:{mousemove:x,mouseout:_}}}if(u==="mouseleave"||u==="mouseout"){let m=!1;const x=j=>{const S=i.filter(C=>this.getLayer(C));(S.length?this.queryRenderedFeatures(j.point,{layers:S}):[]).length?m=!0:m&&(m=!1,o.call(this,new Tr(u,this,j.originalEvent)))},_=j=>{m&&(m=!1,o.call(this,new Tr(u,this,j.originalEvent)))};return{layers:new Set(i),listener:o,delegates:{mousemove:x,mouseout:_}}}{const m=x=>{const _=i.filter(S=>this.getLayer(S)),j=_.length?this.queryRenderedFeatures(x.point,{layers:_}):[];j.length&&(x.features=j,o.call(this,x),delete x.features)};return{layers:new Set(i),listener:o,delegates:{[u]:m}}}}on(u,i,o){if(o===void 0)return super.on(u,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(u,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(u,i,o){if(o===void 0)return super.once(u,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(u,i,o);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(u,i,o){if(o===void 0)return super.off(u,i);i=new Set(Array.isArray(i)?i:[i]);const m=(_,j)=>{if(_.size!==j.size)return!1;for(const S of _)if(!j.has(S))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[u]:void 0;return x&&(_=>{for(let j=0;j<_.length;j++){const S=_[j];if(S.listener===o&&m(S.layers,i)){for(const C in S.delegates)this.off(C,S.delegates[C]);return _.splice(j,1),this}}})(x),this}queryRenderedFeatures(u,i){return this.style?(i!==void 0||u===void 0||u instanceof n.Point||Array.isArray(u)||(i=u,u=void 0),this.style.queryRenderedFeatures(u=u||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(u,i){return this.style.querySourceFeatures(u,i)}isPointOnSurface(u){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&n.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.Point.convert(u))}setStyle(u,i){return(i=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(u,i))}_getUIString(u){const i=this._locale[u];if(i==null)throw new Error(`Missing UI string '${u}'`);return i}_updateStyle(u,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new Vi(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Vi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,i){if(typeof u=="string"){const o=this._requestManager.normalizeStyleURL(u),m=this._requestManager.transformRequest(o,n.ResourceType.Style);n.getJSON(m,(x,_)=>{x?this.fire(new n.ErrorEvent(x)):_&&this._updateDiff(_,i)})}else typeof u=="object"&&this._updateDiff(u,i)}_updateDiff(u,i){try{this.style.setState(u)&&this._update(!0)}catch(o){n.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(u,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.warnOnce("There is no style added to the map."),!1)}addSource(u,i){return this._lazyInitEmptyStyle(),this.style.addSource(u,i),this._update(!0)}isSourceLoaded(u){return!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){const u=this.style&&this.style._sourceCaches;for(const i in u){const o=u[i]._tiles;for(const m in o){const x=o[m];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(u,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(u,i,o)}removeSource(u){return this.style.removeSource(u),this._updateTerrain(),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,i,{pixelRatio:o=1,sdf:m=!1,stretchX:x,stretchY:_,content:j}={}){if(this._lazyInitEmptyStyle(),i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap){const{width:S,height:C,data:D}=n.exported.getImageData(i);this.style.addImage(u,{data:new n.RGBAImage({width:S,height:C},D),pixelRatio:o,stretchX:x,stretchY:_,content:j,sdf:m,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:C}=i,D=i;this.style.addImage(u,{data:new n.RGBAImage({width:S,height:C},new Uint8Array(D.data)),pixelRatio:o,stretchX:x,stretchY:_,content:j,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,u)}}updateImage(u,i){const o=this.style.getImage(u);if(!o)return void this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap?n.exported.getImageData(i):i,{width:x,height:_}=m;x!==void 0&&_!==void 0?x===o.data.width&&_===o.data.height?(o.data.replace(m.data,!(i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap)),this.style.updateImage(u,o)):this.fire(new n.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${_})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`))):this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,i){n.getImage(this._requestManager.transformRequest(u,n.ResourceType.Image),(o,m)=>{i(o,m instanceof n.window.HTMLImageElement?n.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(u,i){return this._lazyInitEmptyStyle(),this.style.addLayer(u,i),this._update(!0)}moveLayer(u,i){return this.style.moveLayer(u,i),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,i,o){return this.style.setLayerZoomRange(u,i,o),this._update(!0)}setFilter(u,i,o={}){return this.style.setFilter(u,i,o),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,i,o,m={}){return this.style.setPaintProperty(u,i,o,m),this._update(!0)}getPaintProperty(u,i){return this.style.getPaintProperty(u,i)}setLayoutProperty(u,i,o,m={}){return this.style.setLayoutProperty(u,i,o,m),this._update(!0)}getLayoutProperty(u,i){return this.style.getLayoutProperty(u,i)}setLight(u,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.LngLat.convert(u),this.transform):0}setFeatureState(u,i){return this.style.setFeatureState(u,i),this._update()}removeFeatureState(u,i){return this.style.removeFeatureState(u,i),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,m,x,_=this._container;for(;_&&(!m||!x);){const j=n.window.getComputedStyle(_).transform;j&&j!=="none"&&(o=j.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(m=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(x=o[3])),_=_.parentElement}this._containerWidth=m?Math.abs(u/m):u,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){n.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=G("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=G("div","mapboxgl-canvas-container",u);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=G("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=G("div","mapboxgl-control-container",u),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=G("div",`mapboxgl-ctrl-${x}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,i){const o=n.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(u),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${i}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const i=this._markers.indexOf(u);i!==-1&&this._markers.splice(i,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const i=this._popups.indexOf(u);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const u=n.extend({},z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._useWebGL2&&this._canvas.getContext("webgl2",u),o=i||this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);o?(this._useWebGL2&&!i&&n.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),n.storeAuthState(o,!0),this.painter=new Ea(o,this.transform,!!i),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.exported$1.testSupport(o)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let i;const o=this.painter.context.extTimerQuery,m=n.exported.now();if(this.listens("gpu-timing-frame")&&(i=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],n.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],n.window.performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,C=this.transform.pitch,D=n.exported.now(),I=new n.EvaluationParameters(S,{now:D,fadeDuration:x,pitch:C,transition:this.style.getTransition()});this.style.update(I)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new n.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const S=n.exported.now()-m;o.endQueryEXT(o.TIME_ELAPSED_EXT,i),setTimeout(()=>{const C=o.getQueryObjectEXT(i,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(i),this.fire(new n.Event("gpu-timing-frame",{cpuTime:S,gpuTime:C})),n.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:C}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const C=this.painter.queryGpuTimers(S);this.fire(new n.Event("gpu-timing-layer",{layerTimes:C}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const C=this.painter.queryGpuTimeDeferredRender(S);this.fire(new n.Event("gpu-timing-deferred-render",{gpuTime:C}))},50)}const j=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(j||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(_=this._updateAverageElevation(m,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new n.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const C=this._calculateSpeedIndex();this.fire(new n.Event("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,n.LivePerformanceUtils.mark(n.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&n.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const i of this._markers)u&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!u||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(u,i=!1){const o=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((i||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const m=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=u;const j=Math.abs(m-x);if(j>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(x),o(x);this._averageElevation.easeTo(x,u,300)}else if(j>1e-4)return this._averageElevation.jumpTo(x),o(x)}return!!this._averageElevation.isEasing(u)&&o(this._averageElevation.getValue(u))}_authenticate(){n.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===n.AUTH_ERR_MSG||u.status===401)){const i=this.painter.context.gl;n.storeAuthState(i,!1),this._logoControl instanceof Yc&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),n.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,m=o.createFramebuffer();function x(_){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,_,0);const j=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,j),j}return o.bindFramebuffer(o.FRAMEBUFFER,m),this._canvasPixelComparison(x(u),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(u,i,o){let m=o[1]-o[0];const x=u.length/4;for(let _=0;_<i.length;_++){const j=i[_];let S=0;for(let C=0;C<j.length;C+=4)j[C]===u[C]&&j[C+1]===u[C+1]&&j[C+2]===u[C+2]&&j[C+3]===u[C+3]&&(S+=1);m+=(o[_+2]-o[_+1])*(1-S/x)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),n.window!==void 0&&(n.window.removeEventListener("resize",this._onWindowResize,!1),n.window.removeEventListener("orientationchange",this._onWindowResize,!1),n.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.removeEventListener("online",this._onWindowOnline,!1),n.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),n.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=n.exported.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(u){const i=this.style?Object.values(this.style._sourceCaches):[];return n.asyncAll(i,(o,m)=>o._preloadTiles(u,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){n.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,i){n.setCacheLimits(u,i)}get version(){return n.version}},NavigationControl:class{constructor(u){this.options=n.extend({},Om,u),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),G("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),G("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=G("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const i=u.getZoom(),o=i===u.getMaxZoom(),m=i===u.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fm(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,i){const o=G("button",u,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(u,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);u.setAttribute("aria-label",o),u.firstElementChild&&u.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.Evented{constructor(u){super(),this.options=n.extend({geolocation:n.window.navigator.geolocation},ru,u),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Aa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,u(o)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):n.window.navigator.permissions!==void 0?n.window.navigator.permissions.query({name:"geolocation"}).then(o=>i(o.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(u){const i=this._map.getMaxBounds(),o=u.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("geolocate",u)),this._finish()}}_updateCamera(u){const i=new n.LngLat(u.coords.longitude,u.coords.latitude),o=u.coords.accuracy,m=this._map.getBearing(),x=n.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),x,{geolocateSource:!0})}_updateMarker(u){if(u){const i=new n.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,i=n.mercatorZfromAltitude(1,u._center.lat)*u.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=G("button","mapboxgl-ctrl-geolocate",this._container),G("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G("div","mapboxgl-user-location"),this._dotElement.appendChild(G("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new St({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new St({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{n.window.addEventListener("ondeviceorientationabsolute"in n.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};n.window.DeviceMotionEvent!==void 0&&typeof n.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),n.window.removeEventListener("deviceorientation",this._onDeviceOrientation),n.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ct,ScaleControl:class{constructor(u){this.options=n.extend({},iu,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,m=i._containerWidth/2-u/2,x=i.unproject([m,o]),_=i.unproject([m+u,o]),j=x.distanceTo(_);if(this.options.unit==="imperial"){const S=3.2808*j;S>5280?this._setScale(u,S/5280,"mile"):this._setScale(u,S,"foot")}else this.options.unit==="nautical"?this._setScale(u,j/1852,"nautical-mile"):j>=1e3?this._setScale(u,j/1e3,"kilometer"):this._setScale(u,j,"meter")}_setScale(u,i,o){this._map._requestDomTask(()=>{const m=function(_){const j=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/j;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const D=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*D)/D}(S),j*S}(i),x=m/i;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(m):`${m}&nbsp;${nu[o]}`,this._container.style.width=u*x+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof n.window.HTMLElement?this._container=u.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in n.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in n.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,n.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!n.window.document.fullscreenEnabled&&!n.window.document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=G("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),n.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(n.window.document.fullscreenElement||n.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?n.window.document.exitFullscreen?n.window.document.exitFullscreen():n.window.document.webkitCancelFullScreen&&n.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.Evented{constructor(u){super(),this.options=n.extend(Object.create(tu),u),n.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=n.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(n.window.document.createTextNode(u))}setHTML(u){const i=n.window.document.createDocumentFragment(),o=n.window.document.createElement("body");let m;for(o.innerHTML=u;m=o.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=G("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(u),this.options.closeButton){const o=this._closeButton=G("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let i;return this._classList.delete(u)?i=!1:(this._classList.add(u),i=!0),this._updateClassList(),i}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,m=this._pos;if(!i||!o||!m)return"bottom";const x=o.offsetWidth,_=o.offsetHeight,j=m.x<x/2,S=m.x>i.transform.width-x/2;if(m.y+u<_)return j?"top-left":S?"top-right":"top";if(m.y>i.transform.height-_){if(j)return"bottom-left";if(S)return"bottom-right"}return j?"left":S?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),u.className=i.join(" ")}_update(u){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let m=this._container;if(m||(m=this._container=G("div","mapboxgl-popup",i.getContainer()),this._tip=G("div","mapboxgl-popup-tip",m),m.appendChild(o)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ia(this._lngLat,this._pos,i.transform)),!this._trackPointer||u){const x=this._pos=this._trackPointer&&u?u:i.project(this._lngLat),_=$d(this.options.offset),j=this._anchor=this._getAnchor(_.y),S=$d(this.options.offset,j),C=x.add(S).round();i._requestDomTask(()=>{this._container&&j&&(this._container.style.transform=`${ta[j]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=n.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(zm);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:St,Style:Vi,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.Point,MercatorCoordinate:n.MercatorCoordinate,FreeCameraOptions:kd,Evented:n.Evented,config:n.config,prewarm:function(){ga().acquire(Fi)},clearPrewarmedResources:function(){const u=Hr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Fi),Hr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return n.config.ACCESS_TOKEN},set accessToken(u){n.config.ACCESS_TOKEN=u},get baseApiUrl(){return n.config.API_URL},set baseApiUrl(u){n.config.API_URL=u},get workerCount(){return Nr.workerCount},set workerCount(u){Nr.workerCount=u},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){n.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){n.clearTileCache(u)},workerUrl:"",workerClass:null,setNow:n.exported.setNow,restoreNow:n.exported.restoreNow};return Da});var A=N;return A})})(ob);var yE=ob.exports;const fi=_1(yE);async function cb(c,d){var f,g;if(!c||c.trim().length<3)return d(!1),[];d(!0);try{const w=await Pr.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(c)}.json`,{params:{access_token:void 0,autocomplete:"true",language:"en",limit:5}});return(g=(f=w==null?void 0:w.data)==null?void 0:f.features)==null?void 0:g.map(N=>{const T=N.context||[],A=M=>T.find(z=>z.id.startsWith(M))||{};let n=A("country").short_code||"";return n=n?n.toUpperCase():"",{display_name:N.place_name,address_line1:N.text||"",address_line2:"",city:A("place").text||"",state:A("region").text||"",postal_code:A("postcode").text||"",country:n,lat:N.geometry.coordinates[1],lng:N.geometry.coordinates[0]}})}finally{d(!1)}}const ub=({isOpen:c,onClose:d,onSubmit:f,customer:g,loading:w=!1,title:N})=>{const{register:T,handleSubmit:A,reset:n,formState:{errors:M},setValue:z,watch:V}=En({defaultValues:{name:"",external_id:"",tax_id:"",phone:"",email:"",account_status:"active",credit_terms_days:30}}),[U,G]=le.useState(""),[W,$]=le.useState(!1),[K,ue]=le.useState(null),[re,te]=le.useState([]),je=le.useRef(null),[me,Ce]=le.useState(null),[Ae,fe]=le.useState(null),[Ie,Ee]=le.useState(!1),tt=V("latitude"),Pe=V("longitude");V("delivery_window_start"),V("delivery_window_end");const Te=async pt=>{try{const ft=await _t.customers.validate.mutate({...pt,exclude_id:g==null?void 0:g.id});return ft.valid?(ft.warnings.length>0&&console.warn("Customer warnings:",ft.warnings),!0):ft.errors[0]||"Customer validation failed"}catch(ft){return console.error("Customer validation error:",ft),"Failed to validate customer data"}},rt=async(pt,ft)=>{try{const wt=await _t.customers.validateCreditTerms.mutate({credit_terms_days:pt,account_status:ft,customer_id:g==null?void 0:g.id});return wt.valid?(wt.warnings.length>0&&console.warn("Credit terms warnings:",wt.warnings),!0):wt.errors[0]||"Credit terms validation failed"}catch(wt){return console.error("Credit terms validation error:",wt),"Failed to validate credit terms"}},gt=async(pt,ft)=>{try{const wt=await _t.customers.validateDeliveryWindow.mutate({delivery_window_start:pt,delivery_window_end:ft});return wt.valid?(wt.warnings.length>0&&console.warn("Delivery window warnings:",wt.warnings),!0):wt.errors[0]||"Delivery window validation failed"}catch(wt){return console.error("Delivery window validation error:",wt),"Failed to validate delivery window"}};le.useEffect(()=>{var pt,ft,wt,Os,ns,_s,mr,Ut,pr,Fr,jr,fr,Br;if(g){if(n({name:g.name,external_id:g.external_id||"",tax_id:g.tax_id||"",phone:g.phone||"",email:g.email||"",account_status:g.account_status,credit_terms_days:g.credit_terms_days,address_label:((pt=g.primary_address)==null?void 0:pt.label)||"",line1:((ft=g.primary_address)==null?void 0:ft.line1)||"",line2:((wt=g.primary_address)==null?void 0:wt.line2)||"",city:((Os=g.primary_address)==null?void 0:Os.city)||"",state:((ns=g.primary_address)==null?void 0:ns.state)||"",postal_code:((_s=g.primary_address)==null?void 0:_s.postal_code)||"",country:((mr=g.primary_address)==null?void 0:mr.country)||"US",delivery_window_start:((Ut=g.primary_address)==null?void 0:Ut.delivery_window_start)||"",delivery_window_end:((pr=g.primary_address)==null?void 0:pr.delivery_window_end)||"",is_primary:((Fr=g.primary_address)==null?void 0:Fr.is_primary)||!0,instructions:((jr=g.primary_address)==null?void 0:jr.instructions)||"",latitude:(fr=g.primary_address)==null?void 0:fr.latitude,longitude:(Br=g.primary_address)==null?void 0:Br.longitude}),g.primary_address){const _r=[g.primary_address.line1,g.primary_address.line2,g.primary_address.city,g.primary_address.state,g.primary_address.postal_code].filter(Boolean);G(_r.join(", "))}}else n({name:"",external_id:"",tax_id:"",phone:"",email:"",account_status:"active",credit_terms_days:30,address_label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:!0,instructions:"",latitude:void 0,longitude:void 0}),G("")},[g,n]),le.useEffect(()=>{let pt=!0;return U&&U.length>=3?($(!0),cb(U,$).then(ft=>{pt&&te(ft||[])})):(te([]),$(!1)),()=>{pt=!1}},[U]),le.useEffect(()=>{if(!me&&je.current&&tt&&Pe){fi.accessToken=void 0;const pt=new fi.Map({container:je.current,style:"mapbox://styles/mapbox/streets-v11",center:[Pe,tt],zoom:14});pt.addControl(new fi.NavigationControl,"top-right"),Ce(pt);const ft=new fi.Marker({anchor:"center",draggable:Ie}).setLngLat([Pe,tt]).addTo(pt);fe(ft),ft.on("dragend",()=>{const wt=ft.getLngLat();z("latitude",wt.lat),z("longitude",wt.lng)}),pt.on("load",()=>{pt.resize()})}},[je,tt,Pe]),le.useEffect(()=>{me&&Ae&&tt&&Pe&&(Ae.setLngLat([Pe,tt]),Ae.setDraggable(Ie),me.setCenter([Pe,tt]),me.setZoom(14),me.resize())},[tt,Pe,Ie,me,Ae]),le.useEffect(()=>()=>{Ae&&Ae.remove(),me&&me.remove()},[]);const yt=async pt=>{try{if(await Te({name:pt.name,email:pt.email||void 0,phone:pt.phone||void 0,external_id:pt.external_id||void 0,tax_id:pt.tax_id||void 0})!==!0||await rt(pt.credit_terms_days,pt.account_status)!==!0||pt.delivery_window_start&&pt.delivery_window_end&&await gt(pt.delivery_window_start,pt.delivery_window_end)!==!0)return;const{address_label:Os,line1:ns,line2:_s,city:mr,state:Ut,postal_code:pr,country:Fr,delivery_window_start:jr,delivery_window_end:fr,is_primary:Br,instructions:_r,latitude:Jr,longitude:Qt,...gi}=pt;f({...gi,address:{label:Os,line1:ns,line2:_s,city:mr,state:Ut,postal_code:pr,country:Fr,delivery_window_start:jr||void 0,delivery_window_end:fr||void 0,is_primary:Br,instructions:_r,latitude:Jr,longitude:Qt}})}catch(ft){console.error("Form validation error:",ft)}};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(yt),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Business Name *"}),t.jsx("input",{type:"text",id:"name",...T("name",{required:"Business name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),M.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"external_id",className:"block text-sm font-medium text-gray-700",children:"External ID"}),t.jsx("input",{type:"text",id:"external_id",...T("external_id"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"QuickBooks ID"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tax_id",className:"block text-sm font-medium text-gray-700",children:"Tax ID (VAT/EIN)"}),t.jsx("input",{type:"text",id:"tax_id",...T("tax_id"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone"}),t.jsx("input",{type:"tel",id:"phone",...T("phone"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),t.jsx("input",{type:"email",id:"email",...T("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),M.email&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.email.message})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"account_status",className:"block text-sm font-medium text-gray-700",children:"Account Status"}),t.jsxs("select",{id:"account_status",...T("account_status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"credit_terms_days",className:"block text-sm font-medium text-gray-700",children:"Credit Terms (Days)"}),t.jsx("input",{type:"number",id:"credit_terms_days",min:"0",...T("credit_terms_days",{required:"Credit terms is required",min:{value:0,message:"Credit terms must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),M.credit_terms_days&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.credit_terms_days.message})]})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200 mt-4",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Address"}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"address_autosuggest",className:"block text-sm font-medium text-gray-700",children:"Address *"}),t.jsx("input",{type:"text",id:"address_autosuggest",value:U,onChange:pt=>{G(pt.target.value),ue(null)},className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",autoComplete:"off",placeholder:"Start typing address..."}),W&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Searching..."}),re.length>0&&!K&&t.jsx("ul",{className:"border border-gray-200 rounded bg-white mt-1 max-h-48 overflow-y-auto z-10 relative",children:re.map((pt,ft)=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-50",onClick:()=>{ue(pt),G(pt.display_name),z("line1",pt.address_line1||""),z("line2",pt.address_line2||""),z("city",pt.city||""),z("state",pt.state||""),z("postal_code",pt.postal_code||""),z("country",pt.country||""),z("latitude",pt.lat),z("longitude",pt.lng)},children:pt.display_name},ft))}),K&&t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Address selected"})]})]}),tt&&Pe&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{ref:je,style:{width:"100%",height:200,borderRadius:8,overflow:"hidden",position:"relative"}}),t.jsx("div",{className:"flex justify-end mt-2",children:Ie?t.jsx("button",{type:"button",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",onClick:()=>Ee(!1),children:"Save Pin Location"}):t.jsx("button",{type:"button",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs",onClick:()=>Ee(!0),children:"Adjust Pin"})})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200 mt-4",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Delivery Preferences"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_start",className:"block text-sm font-medium text-gray-700",children:"Delivery Window Start"}),t.jsx("input",{type:"time",id:"delivery_window_start",...T("delivery_window_start"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_end",className:"block text-sm font-medium text-gray-700",children:"Delivery Window End"}),t.jsx("input",{type:"time",id:"delivery_window_end",...T("delivery_window_end"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]})]}),t.jsx("div",{className:"pt-4 border-t border-gray-200 mt-4",children:t.jsxs("div",{children:[t.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-gray-700",children:"Delivery Instructions"}),t.jsx("textarea",{id:"instructions",rows:3,...T("instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate codes, special access requirements, loading dock information..."})]})})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Customer"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},so=({isOpen:c,onClose:d,onConfirm:f,title:g,message:w,confirmText:N="Confirm",cancelText:T="Cancel",type:A="danger",loading:n=!1})=>{if(!c)return null;const z=(()=>{switch(A){case"danger":return{icon:"text-red-600",button:"bg-red-600 hover:bg-red-700 focus:ring-red-500"};case"warning":return{icon:"text-yellow-600",button:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"};default:return{icon:"text-blue-600",button:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}}})();return t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsx("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:t.jsxs("div",{className:"sm:flex sm:items-start",children:[t.jsx("div",{className:`mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full ${A==="danger"?"bg-red-100":A==="warning"?"bg-yellow-100":"bg-blue-100"} sm:mx-0 sm:h-10 sm:w-10`,children:t.jsx(Us,{className:`h-6 w-6 ${z.icon}`})}),t.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[t.jsx("h3",{className:"text-base font-semibold leading-6 text-gray-900",children:g}),t.jsx("div",{className:"mt-2",children:t.jsx("p",{className:"text-sm text-gray-500",children:w})})]})]})}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"button",onClick:f,disabled:n,className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto ${z.button} disabled:opacity-50 disabled:cursor-not-allowed`,children:n?"Processing...":N}),t.jsx("button",{type:"button",onClick:d,disabled:n,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:T})]})]})]})})},_E=()=>{const c=Qr(),[d,f]=le.useState({page:1}),[g,w]=le.useState(!1),[N,T]=le.useState(null),{data:A,isLoading:n,error:M,refetch:z}=E_(d),V=yS(),U=C_(),G=_S();le.useEffect(()=>{console.log("CustomersPage state:",{filters:d,data:A,isLoading:n,error:M,isFormOpen:g})},[d,A,n,M,g]);const W=()=>{console.log("Adding new customer"),w(!0)},$=Ce=>{console.log("Viewing customer:",Ce),c(`/customers/${Ce.id}`)},K=async Ce=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await G(Ce.id),T(null)}catch(Ae){console.error("Error deleting customer:",Ae),alert("Failed to delete customer. Please try again.")}},ue=async(Ce,Ae)=>{try{await U.mutateAsync({id:Ce.id,account_status:Ae})}catch(fe){console.error("Error updating customer status:",fe)}},re=async Ce=>{console.log("Form submit:",Ce);try{await V.mutateAsync(Ce),w(!1)}catch(Ae){console.error("Form submit error:",Ae)}},te=async()=>{if(N){console.log("Confirming delete:",N);try{await G.mutateAsync(N.id),T(null)}catch(Ce){console.error("Delete error:",Ce)}}},je=Ce=>{console.log("Page change:",Ce),f(Ae=>({...Ae,page:Ce}))},me=()=>{console.log("Refreshing customers"),z()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),t.jsx("p",{className:"text-gray-600",children:"Manage your customer database"}),M&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",M.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:me,disabled:n,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${n?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:W,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Customer"})]})]})]}),t.jsx(vS,{filters:d,onFiltersChange:f}),t.jsx(bS,{customers:(A==null?void 0:A.customers)||[],loading:n,onView:$,onDelete:K,onStatusChange:ue}),A&&A.totalPages>1&&t.jsx(ac,{currentPage:A.currentPage,totalPages:A.totalPages,totalCount:A.totalCount,onPageChange:je}),t.jsx(ub,{isOpen:g,onClose:()=>{console.log("Closing form"),w(!1)},onSubmit:re,customer:void 0,loading:V.isPending,title:"Add New Customer"}),t.jsx(so,{isOpen:!!N,onClose:()=>T(null),onConfirm:te,title:"Delete Customer",message:`Are you sure you want to delete "${N==null?void 0:N.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:G.isPending})]})},bE=(c,d=5)=>_t.customers.getOrderHistory.useQuery({customer_id:c,limit:d,offset:0},{enabled:!!c&&c!=="null"&&c!=="undefined",retry:1,staleTime:3e4,select:f=>f.orders}),db=c=>_t.customers.getAddresses.useQuery({customer_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",retry:1,staleTime:3e4}),hb=()=>_t.customers.createAddress.useMutation({onSuccess:c=>{console.log("Address created successfully:",c),It.success("Address created successfully")},onError:c=>{console.error("Create address mutation error:",c),It.error(c.message||"Failed to create address")}}),vE=()=>_t.customers.updateAddress.useMutation({onSuccess:c=>{console.log("Address updated successfully:",c),It.success("Address updated successfully")},onError:c=>{console.error("Update address mutation error:",c),It.error(c.message||"Failed to update address")}}),wE=()=>_t.customers.deleteAddress.useMutation({onSuccess:(c,d)=>{console.log("Address deleted successfully:",d.address_id),It.success("Address deleted successfully")},onError:c=>{console.error("Delete address mutation error:",c),It.error(c.message||"Failed to delete address")}}),jE=()=>_t.customers.setPrimaryAddress.useMutation({onSuccess:(c,d)=>{console.log("Primary address set successfully:",d.address_id),It.success("Primary address updated successfully")},onError:c=>{console.error("Set primary address mutation error:",c),It.error(c.message||"Failed to set primary address")}}),NE=[{code:"AF",name:"Afghanistan",flag:""},{code:"AL",name:"Albania",flag:""},{code:"DZ",name:"Algeria",flag:""},{code:"AD",name:"Andorra",flag:""},{code:"AO",name:"Angola",flag:""},{code:"AG",name:"Antigua and Barbuda",flag:""},{code:"AR",name:"Argentina",flag:""},{code:"AM",name:"Armenia",flag:""},{code:"AU",name:"Australia",flag:""},{code:"AT",name:"Austria",flag:""},{code:"AZ",name:"Azerbaijan",flag:""},{code:"BS",name:"Bahamas",flag:""},{code:"BH",name:"Bahrain",flag:""},{code:"BD",name:"Bangladesh",flag:""},{code:"BB",name:"Barbados",flag:""},{code:"BY",name:"Belarus",flag:""},{code:"BE",name:"Belgium",flag:""},{code:"BZ",name:"Belize",flag:""},{code:"BJ",name:"Benin",flag:""},{code:"BT",name:"Bhutan",flag:""},{code:"BO",name:"Bolivia",flag:""},{code:"BA",name:"Bosnia and Herzegovina",flag:""},{code:"BW",name:"Botswana",flag:""},{code:"BR",name:"Brazil",flag:""},{code:"BN",name:"Brunei",flag:""},{code:"BG",name:"Bulgaria",flag:""},{code:"BF",name:"Burkina Faso",flag:""},{code:"BI",name:"Burundi",flag:""},{code:"CV",name:"Cabo Verde",flag:""},{code:"KH",name:"Cambodia",flag:""},{code:"CM",name:"Cameroon",flag:""},{code:"CA",name:"Canada",flag:""},{code:"CF",name:"Central African Republic",flag:""},{code:"TD",name:"Chad",flag:""},{code:"CL",name:"Chile",flag:""},{code:"CN",name:"China",flag:""},{code:"CO",name:"Colombia",flag:""},{code:"KM",name:"Comoros",flag:""},{code:"CG",name:"Congo",flag:""},{code:"CD",name:"Congo (Democratic Republic)",flag:""},{code:"CR",name:"Costa Rica",flag:""},{code:"CI",name:"Cte d'Ivoire",flag:""},{code:"HR",name:"Croatia",flag:""},{code:"CU",name:"Cuba",flag:""},{code:"CY",name:"Cyprus",flag:""},{code:"CZ",name:"Czech Republic",flag:""},{code:"DK",name:"Denmark",flag:""},{code:"DJ",name:"Djibouti",flag:""},{code:"DM",name:"Dominica",flag:""},{code:"DO",name:"Dominican Republic",flag:""},{code:"EC",name:"Ecuador",flag:""},{code:"EG",name:"Egypt",flag:""},{code:"SV",name:"El Salvador",flag:""},{code:"GQ",name:"Equatorial Guinea",flag:""},{code:"ER",name:"Eritrea",flag:""},{code:"EE",name:"Estonia",flag:""},{code:"SZ",name:"Eswatini",flag:""},{code:"ET",name:"Ethiopia",flag:""},{code:"FJ",name:"Fiji",flag:""},{code:"FI",name:"Finland",flag:""},{code:"FR",name:"France",flag:""},{code:"GA",name:"Gabon",flag:""},{code:"GM",name:"Gambia",flag:""},{code:"GE",name:"Georgia",flag:""},{code:"DE",name:"Germany",flag:""},{code:"GH",name:"Ghana",flag:""},{code:"GR",name:"Greece",flag:""},{code:"GD",name:"Grenada",flag:""},{code:"GT",name:"Guatemala",flag:""},{code:"GN",name:"Guinea",flag:""},{code:"GW",name:"Guinea-Bissau",flag:""},{code:"GY",name:"Guyana",flag:""},{code:"HT",name:"Haiti",flag:""},{code:"HN",name:"Honduras",flag:""},{code:"HU",name:"Hungary",flag:""},{code:"IS",name:"Iceland",flag:""},{code:"IN",name:"India",flag:""},{code:"ID",name:"Indonesia",flag:""},{code:"IR",name:"Iran",flag:""},{code:"IQ",name:"Iraq",flag:""},{code:"IE",name:"Ireland",flag:""},{code:"IL",name:"Israel",flag:""},{code:"IT",name:"Italy",flag:""},{code:"JM",name:"Jamaica",flag:""},{code:"JP",name:"Japan",flag:""},{code:"JO",name:"Jordan",flag:""},{code:"KZ",name:"Kazakhstan",flag:""},{code:"KE",name:"Kenya",flag:""},{code:"KI",name:"Kiribati",flag:""},{code:"KP",name:"Korea (North)",flag:""},{code:"KR",name:"Korea (South)",flag:""},{code:"KW",name:"Kuwait",flag:""},{code:"KG",name:"Kyrgyzstan",flag:""},{code:"LA",name:"Laos",flag:""},{code:"LV",name:"Latvia",flag:""},{code:"LB",name:"Lebanon",flag:""},{code:"LS",name:"Lesotho",flag:""},{code:"LR",name:"Liberia",flag:""},{code:"LY",name:"Libya",flag:""},{code:"LI",name:"Liechtenstein",flag:""},{code:"LT",name:"Lithuania",flag:""},{code:"LU",name:"Luxembourg",flag:""},{code:"MG",name:"Madagascar",flag:""},{code:"MW",name:"Malawi",flag:""},{code:"MY",name:"Malaysia",flag:""},{code:"MV",name:"Maldives",flag:""},{code:"ML",name:"Mali",flag:""},{code:"MT",name:"Malta",flag:""},{code:"MH",name:"Marshall Islands",flag:""},{code:"MR",name:"Mauritania",flag:""},{code:"MU",name:"Mauritius",flag:""},{code:"MX",name:"Mexico",flag:""},{code:"FM",name:"Micronesia",flag:""},{code:"MD",name:"Moldova",flag:""},{code:"MC",name:"Monaco",flag:""},{code:"MN",name:"Mongolia",flag:""},{code:"ME",name:"Montenegro",flag:""},{code:"MA",name:"Morocco",flag:""},{code:"MZ",name:"Mozambique",flag:""},{code:"MM",name:"Myanmar",flag:""},{code:"NA",name:"Namibia",flag:""},{code:"NR",name:"Nauru",flag:""},{code:"NP",name:"Nepal",flag:""},{code:"NL",name:"Netherlands",flag:""},{code:"NZ",name:"New Zealand",flag:""},{code:"NI",name:"Nicaragua",flag:""},{code:"NE",name:"Niger",flag:""},{code:"NG",name:"Nigeria",flag:""},{code:"MK",name:"North Macedonia",flag:""},{code:"NO",name:"Norway",flag:""},{code:"OM",name:"Oman",flag:""},{code:"PK",name:"Pakistan",flag:""},{code:"PW",name:"Palau",flag:""},{code:"PA",name:"Panama",flag:""},{code:"PG",name:"Papua New Guinea",flag:""},{code:"PY",name:"Paraguay",flag:""},{code:"PE",name:"Peru",flag:""},{code:"PH",name:"Philippines",flag:""},{code:"PL",name:"Poland",flag:""},{code:"PT",name:"Portugal",flag:""},{code:"QA",name:"Qatar",flag:""},{code:"RO",name:"Romania",flag:""},{code:"RU",name:"Russia",flag:""},{code:"RW",name:"Rwanda",flag:""},{code:"KN",name:"Saint Kitts and Nevis",flag:""},{code:"LC",name:"Saint Lucia",flag:""},{code:"VC",name:"Saint Vincent and the Grenadines",flag:""},{code:"WS",name:"Samoa",flag:""},{code:"SM",name:"San Marino",flag:""},{code:"ST",name:"So Tom and Prncipe",flag:""},{code:"SA",name:"Saudi Arabia",flag:""},{code:"SN",name:"Senegal",flag:""},{code:"RS",name:"Serbia",flag:""},{code:"SC",name:"Seychelles",flag:""},{code:"SL",name:"Sierra Leone",flag:""},{code:"SG",name:"Singapore",flag:""},{code:"SK",name:"Slovakia",flag:""},{code:"SI",name:"Slovenia",flag:""},{code:"SB",name:"Solomon Islands",flag:""},{code:"SO",name:"Somalia",flag:""},{code:"ZA",name:"South Africa",flag:""},{code:"SS",name:"South Sudan",flag:""},{code:"ES",name:"Spain",flag:""},{code:"LK",name:"Sri Lanka",flag:""},{code:"SD",name:"Sudan",flag:""},{code:"SR",name:"Suriname",flag:""},{code:"SE",name:"Sweden",flag:""},{code:"CH",name:"Switzerland",flag:""},{code:"SY",name:"Syria",flag:""},{code:"TJ",name:"Tajikistan",flag:""},{code:"TZ",name:"Tanzania",flag:""},{code:"TH",name:"Thailand",flag:""},{code:"TL",name:"Timor-Leste",flag:""},{code:"TG",name:"Togo",flag:""},{code:"TO",name:"Tonga",flag:""},{code:"TT",name:"Trinidad and Tobago",flag:""},{code:"TN",name:"Tunisia",flag:""},{code:"TR",name:"Turkey",flag:""},{code:"TM",name:"Turkmenistan",flag:""},{code:"TV",name:"Tuvalu",flag:""},{code:"UG",name:"Uganda",flag:""},{code:"UA",name:"Ukraine",flag:""},{code:"AE",name:"United Arab Emirates",flag:""},{code:"GB",name:"United Kingdom",flag:""},{code:"US",name:"United States",flag:""},{code:"UY",name:"Uruguay",flag:""},{code:"UZ",name:"Uzbekistan",flag:""},{code:"VU",name:"Vanuatu",flag:""},{code:"VA",name:"Vatican City",flag:""},{code:"VE",name:"Venezuela",flag:""},{code:"VN",name:"Vietnam",flag:""},{code:"YE",name:"Yemen",flag:""},{code:"ZM",name:"Zambia",flag:""},{code:"ZW",name:"Zimbabwe",flag:""}],mb=()=>NE.map(c=>({value:c.code,label:`${c.flag} ${c.name}`,name:c.name,flag:c.flag})),pb=c=>[c.line1,c.line2,c.city,c.state,c.postal_code].filter(Boolean).join(", "),SE=c=>{const d=c.label||`Address #${c.id.slice(-4)}`,f=pb(c);return`${d} - ${f}`},TE=(c,d)=>{if(!c||!d)return"";const f=g=>{const[w,N]=g.split(":"),T=parseInt(w,10),A=T>=12?"PM":"AM";return`${T===0?12:T>12?T-12:T}:${N} ${A}`};return`${f(c)} - ${f(d)}`},b0=(c,d)=>(console.warn("validateDeliveryWindow is deprecated - use backend API validation instead"),!0),EE=async c=>{try{const d=[c.line1,c.line2,c.city,c.state,c.postal_code].filter(Boolean).join(", "),g=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d)}&limit=1`)).json();return g&&g.length>0?{latitude:parseFloat(g[0].lat),longitude:parseFloat(g[0].lon)}:null}catch(d){return console.error("Geocoding error:",d),null}},CE=({address:c,onEdit:d,onDelete:f,onSetPrimary:g})=>{const w=le.useRef(null),[N,T]=le.useState(null),[A,n]=le.useState(null),M=TE(c.delivery_window_start,c.delivery_window_end);return le.useEffect(()=>{if(!N&&w.current&&c.latitude&&c.longitude){fi.accessToken=void 0;const z=new fi.Map({container:w.current,style:"mapbox://styles/mapbox/streets-v11",center:[c.longitude,c.latitude],zoom:14,interactive:!1}),V=new fi.Marker().setLngLat([c.longitude,c.latitude]).addTo(z);T(z),n(V),z.on("load",()=>{z.resize()})}},[w,c.latitude,c.longitude]),le.useEffect(()=>()=>{A&&A.remove(),N&&N.remove()},[]),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Tn,{className:"h-4 w-4 text-gray-400 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900",children:c.label||`Address #${c.id.slice(-4)}`}),c.is_primary&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx(Gh,{className:"h-3 w-3 mr-1"}),"Primary"]})]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[c.latitude&&c.longitude&&t.jsx("div",{className:"p-1 text-green-600",title:"Geocoded",children:t.jsx(j_,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>d(c),className:"p-1 text-gray-400 hover:text-blue-600 rounded hover:bg-blue-50 transition-colors",title:"Edit address",children:t.jsx(ci,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>f(c),className:"p-1 text-gray-400 hover:text-red-600 rounded hover:bg-red-50 transition-colors",title:"Delete address",children:t.jsx(to,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-gray-900",children:pb(c)}),M&&t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(Qi,{className:"h-4 w-4"}),t.jsxs("span",{children:["Delivery: ",M]})]}),c.instructions&&t.jsxs("div",{className:"flex items-start space-x-2 text-sm text-gray-600",children:[t.jsx(v_,{className:"h-4 w-4 mt-0.5"}),t.jsx("p",{className:"line-clamp-2",children:c.instructions})]}),c.latitude&&c.longitude&&t.jsx("div",{className:"mt-3 h-32 rounded-md overflow-hidden border border-gray-200",children:t.jsx("div",{ref:w,className:"w-full h-full"})}),!c.is_primary&&t.jsx("button",{onClick:()=>g(c),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Set as Primary"})]})]})},fb=({isOpen:c,onClose:d,onSubmit:f,address:g,customerId:w,loading:N=!1,title:T,isFirstAddress:A=!1})=>{const[n,M]=le.useState(!1),[z,V]=le.useState(!1),{register:U,handleSubmit:G,reset:W,watch:$,setValue:K,formState:{errors:ue}}=En({defaultValues:{customer_id:w,label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:A,instructions:""}}),re=$(["line1","city","state","postal_code"]),te=$("delivery_window_start"),je=$("delivery_window_end");le.useEffect(()=>{g?(W({customer_id:g.customer_id,label:g.label||"",line1:g.line1,line2:g.line2||"",city:g.city,state:g.state||"",postal_code:g.postal_code||"",country:g.country,delivery_window_start:g.delivery_window_start||"",delivery_window_end:g.delivery_window_end||"",is_primary:g.is_primary,instructions:g.instructions||"",latitude:g.latitude,longitude:g.longitude}),V(!!(g.latitude&&g.longitude))):(W({customer_id:w,label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:A,instructions:""}),V(!1))},[g,w,A,W]);const me=async()=>{const[fe,Ie,Ee,tt]=re;if(!(!fe||!Ie)){M(!0);try{const Pe=await EE({line1:fe,city:Ie,state:Ee,postal_code:tt});Pe&&(K("latitude",Pe.latitude),K("longitude",Pe.longitude),V(!0))}catch(Pe){console.error("Geocoding failed:",Pe)}finally{M(!1)}}},Ce=fe=>{fe.delivery_window_start&&fe.delivery_window_end&&b0(fe.delivery_window_start,fe.delivery_window_end),fe.delivery_window_start&&!fe.delivery_window_end&&(fe.delivery_window_end=void 0),fe.delivery_window_end&&!fe.delivery_window_start&&(fe.delivery_window_start=void 0),f(fe)},Ae=mb();return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:G(Ce),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:T}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Address Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"label",className:"block text-sm font-medium text-gray-700",children:"Address Label"}),t.jsx("input",{type:"text",id:"label",...U("label"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Main Location, Loading Dock, etc."})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"line1",className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),t.jsx("input",{type:"text",id:"line1",...U("line1",{required:"Address line 1 is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),ue.line1&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:ue.line1.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"line2",className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),t.jsx("input",{type:"text",id:"line2",...U("line2"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Apartment, suite, unit, etc."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700",children:"City *"}),t.jsx("input",{type:"text",id:"city",...U("city",{required:"City is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),ue.city&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:ue.city.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700",children:"State/Province"}),t.jsx("input",{type:"text",id:"state",...U("state"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postal_code",className:"block text-sm font-medium text-gray-700",children:"Postal Code"}),t.jsx("input",{type:"text",id:"postal_code",...U("postal_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700",children:"Country"}),t.jsx("select",{id:"country",...U("country"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:Ae.map(fe=>t.jsx("option",{value:fe.value,children:fe.label},fe.value))})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Geocoding"}),t.jsxs("button",{type:"button",onClick:me,disabled:n||!re[0]||!re[1],className:"flex items-center space-x-2 text-sm text-blue-600 hover:text-blue-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:[n?t.jsx(tr,{className:"h-4 w-4 animate-spin"}):z?t.jsx(j_,{className:"h-4 w-4 text-green-600"}):t.jsx(Tn,{className:"h-4 w-4"}),t.jsx("span",{children:n?"Geocoding...":z?"Geocoded":"Geocode Address"})]})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Geocoding helps with delivery route optimization"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Delivery Preferences"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_start",className:"block text-sm font-medium text-gray-700",children:"Delivery Window Start"}),t.jsx("input",{type:"time",id:"delivery_window_start",...U("delivery_window_start"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_end",className:"block text-sm font-medium text-gray-700",children:"Delivery Window End"}),t.jsx("input",{type:"time",id:"delivery_window_end",...U("delivery_window_end"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),te&&je&&!b0()&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:"End time must be after start time"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"is_primary",...U("is_primary"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"is_primary",className:"ml-2 block text-sm text-gray-900",children:"Set as primary address"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Primary address will be used as the default for orders"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Access & Security"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"access_code",className:"block text-sm font-medium text-gray-700",children:"Access Code"}),t.jsx("input",{type:"text",id:"access_code",...U("access_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Building access code"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"gate_code",className:"block text-sm font-medium text-gray-700",children:"Gate Code"}),t.jsx("input",{type:"text",id:"gate_code",...U("gate_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate or entrance code"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"building_type",className:"block text-sm font-medium text-gray-700",children:"Building Type"}),t.jsxs("select",{id:"building_type",...U("building_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select type..."}),t.jsx("option",{value:"residential",children:"Residential"}),t.jsx("option",{value:"commercial",children:"Commercial"}),t.jsx("option",{value:"industrial",children:"Industrial"}),t.jsx("option",{value:"other",children:"Other"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"preferred_delivery_time",className:"block text-sm font-medium text-gray-700",children:"Preferred Time"}),t.jsx("input",{type:"time",id:"preferred_delivery_time",...U("preferred_delivery_time"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Preferred time within delivery window"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"security_requirements",className:"block text-sm font-medium text-gray-700",children:"Security Requirements"}),t.jsx("textarea",{id:"security_requirements",rows:2,...U("security_requirements"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Security checkpoints, ID requirements, visitor procedures..."})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"On-Site Contact"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"contact_person",className:"block text-sm font-medium text-gray-700",children:"Contact Person"}),t.jsx("input",{type:"text",id:"contact_person",...U("contact_person"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"On-site contact name"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"contact_phone",className:"block text-sm font-medium text-gray-700",children:"Contact Phone"}),t.jsx("input",{type:"tel",id:"contact_phone",...U("contact_phone"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Phone number for delivery"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Logistics & Access"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"parking_instructions",className:"block text-sm font-medium text-gray-700",children:"Parking Instructions"}),t.jsx("textarea",{id:"parking_instructions",rows:2,...U("parking_instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Where to park, parking restrictions, loading zones..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"loading_dock_info",className:"block text-sm font-medium text-gray-700",children:"Loading Dock Information"}),t.jsx("textarea",{id:"loading_dock_info",rows:2,...U("loading_dock_info"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Loading dock location, height restrictions, equipment availability..."})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Delivery Instructions"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_notes",className:"block text-sm font-medium text-gray-700",children:"Delivery Notes"}),t.jsx("textarea",{id:"delivery_notes",rows:3,...U("delivery_notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Specific delivery instructions, handling requirements..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"special_instructions",className:"block text-sm font-medium text-gray-700",children:"Special Instructions"}),t.jsx("textarea",{id:"special_instructions",rows:3,...U("special_instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Special handling, fragile items, temperature requirements..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-gray-700",children:"General Instructions"}),t.jsx("textarea",{id:"instructions",rows:2,...U("instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"General delivery notes and instructions..."})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Address"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},kE=({customerId:c})=>{const[d,f]=le.useState(!1),[g,w]=le.useState(null),[N,T]=le.useState(null),{data:A=[],isLoading:n}=db(c),M=hb(),z=vE(),V=wE(),U=jE(),G=()=>{w(null),f(!0)},W=te=>{w(te),f(!0)},$=te=>{T(te)},K=async te=>{if(!te.is_primary)try{await U.mutateAsync(te)}catch{}},ue=async te=>{try{g?await z.mutateAsync({id:g.id,...te}):await M.mutateAsync(te),f(!1),w(null)}catch{}},re=async()=>{if(N)try{await V.mutateAsync(N),T(null)}catch{}};return n?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-20 bg-gray-200 rounded"}),t.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Tn,{className:"h-5 w-5 text-gray-400"}),t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Delivery Addresses (",A.length,")"]})]}),t.jsxs("button",{onClick:G,className:"flex items-center space-x-2 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Address"})]})]}),A.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Tn,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"No delivery addresses added yet"}),t.jsx("button",{onClick:G,className:"text-blue-600 hover:text-blue-800 font-medium",children:"Add the first address"})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:A.map(te=>t.jsx(CE,{address:te,onEdit:W,onDelete:$,onSetPrimary:K},te.id))}),t.jsx(fb,{isOpen:d,onClose:()=>{f(!1),w(null)},onSubmit:ue,address:g||void 0,customerId:c,loading:M.isPending||z.isPending,title:g?"Edit Address":"Add New Address",isFirstAddress:A.length===0}),t.jsx(so,{isOpen:!!N,onClose:()=>T(null),onConfirm:re,title:"Delete Address",message:`Are you sure you want to delete this address? ${N!=null&&N.is_primary?"This is the primary address for this customer.":""}`,confirmText:"Delete",type:"danger",loading:V.isPending})]})};let af=null;const AE=async()=>{if(af)return af;try{const c=await _t.orders.getWorkflow.query();return af=c,c}catch(c){throw console.error("Failed to fetch workflow from backend:",c),new Error("Order workflow fetch failed. Please try again.")}},ic=async c=>{const d=await AE();return d.find(f=>f.status===c)||d[0]},gb=async(c,d=0)=>{try{return await _t.orders.calculateTotals.mutate({lines:c,tax_percent:d})}catch(f){throw console.error("Failed to calculate totals via API:",f),new Error("Order total calculation failed. Please try again.")}},ME=async c=>{try{return(await _t.orders.formatDate.mutate({date:c})).formatted_date}catch(d){throw console.error("Failed to format date via API:",d),new Error("Date formatting failed. Please try again.")}},of=async c=>(await ic(c)).allowedTransitions,PE=async c=>{try{return await _t.orders.validateForConfirmation.mutate({order:c})}catch(d){throw console.error("Failed to validate order for confirmation via API:",d),new Error("Order confirmation validation failed. Please try again.")}},IE=({orders:c,loading:d})=>{const f=Qr();return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"})]})]})}):c.length?t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Orders"}),t.jsx("div",{className:"space-y-4",children:c.map(g=>{var w;return t.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>f(`/orders/${g.id}`),children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:["Order #",g.id]}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[t.jsx($s,{className:"h-4 w-4"}),t.jsx("span",{children:ME(g.order_date)})]})]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${g.status==="completed"?"bg-green-100 text-green-800":g.status==="cancelled"?"bg-red-100 text-red-800":g.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:g.status.charAt(0).toUpperCase()+g.status.slice(1)})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(hs,{className:"h-4 w-4"}),t.jsxs("span",{children:[((w=g.order_lines)==null?void 0:w.length)||0," items"]})]}),g.total_amount!==void 0&&t.jsxs("p",{className:"text-sm font-medium text-gray-900 mt-1",children:["Total: $",g.total_amount.toFixed(2)]})]})]},g.id)})})]}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Orders"}),t.jsx("p",{className:"text-gray-500 text-center py-4",children:"No orders found"})]})},gm=({status:c,className:d="",children:f})=>{const g=()=>{switch(c){case"active":return"bg-green-100 text-green-800 border-green-200";case"credit_hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"closed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},w=()=>{if(f)return f;switch(c){case"active":return"Active";case"credit_hold":return"Credit Hold";case"closed":return"Closed";default:return c}};return t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${g()} ${d}`,children:w()})},DE=()=>{const{id:c}=nc(),d=Qr(),[f,g]=le.useState(!1),{data:w,isLoading:N,error:T}=xS(c),A=C_(),{data:n,isLoading:M}=bE((w==null?void 0:w.id)||"",5),z=async U=>{if(w)try{await A.mutateAsync({id:w.id,...U}),g(!1)}catch{}},V=U=>new Date(U).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return N?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]}):T||!w?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Customer not found or error loading customer details."})})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:w.name})]}),t.jsxs("button",{onClick:()=>g(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ci,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Customer"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Business Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(y_,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:w.name})]})]}),w.external_id&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"External ID"}),t.jsx("span",{className:"text-gray-900",children:w.external_id})]}),w.tax_id&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Tax ID (VAT/EIN)"}),t.jsx("span",{className:"text-gray-900",children:w.tax_id})]}),w.email&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Email"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(eS,{className:"h-4 w-4 text-gray-400"}),t.jsx("a",{href:`mailto:${w.email}`,className:"text-blue-600 hover:text-blue-800",children:w.email})]})]}),w.phone&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Phone"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(iS,{className:"h-4 w-4 text-gray-400"}),t.jsx("a",{href:`tel:${w.phone}`,className:"text-blue-600 hover:text-blue-800",children:w.phone})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Account Status"}),t.jsx(gm,{status:w.account_status})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Credit Terms"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(HN,{className:"h-4 w-4 text-gray-400"}),t.jsxs("span",{className:"text-gray-900",children:[w.credit_terms_days," days"]})]})]})]})]})}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:V(w.created_at)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Last Updated"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:V(w.updated_at)})]})]})]})]})})]}),t.jsx(kE,{customerId:w.id}),t.jsx(IE,{orders:n||[],loading:M}),t.jsx(ub,{isOpen:f,onClose:()=>g(!1),onSubmit:z,customer:w,loading:A.isPending,title:"Edit Customer"})]})},cc=(c={})=>_t.products.list.useQuery({search:c.search,status:c.status,unit_of_measure:c.unit_of_measure,page:c.page||1,limit:c.limit||50,sort_by:c.sort_by||"created_at",sort_order:c.sort_order||"desc",show_obsolete:c.show_obsolete||!1},{retry:1,staleTime:3e4}),LE=c=>_t.products.getById.useQuery({id:c},{enabled:!!c}),RE=()=>_t.products.getStats.useQuery(void 0,{staleTime:6e4}),zE=()=>_t.products.create.useMutation({onSuccess:c=>{console.log("Product created successfully:",c),It.success("Product created successfully")},onError:c=>{console.error("Create product mutation error:",c),It.error(c.message||"Failed to create product")}}),xb=()=>_t.products.update.useMutation({onSuccess:c=>{console.log("Product updated successfully:",c),It.success("Product updated successfully")},onError:c=>{console.error("Update product mutation error:",c),It.error(c.message||"Failed to update product")}}),OE=()=>_t.products.delete.useMutation({onSuccess:(c,d)=>{console.log("Product deleted successfully:",d.id),It.success("Product status set to obsolete")},onError:c=>{console.error("Delete product mutation error:",c),It.error(c.message||"Failed to delete product")}}),FE=()=>_t.products.bulkUpdateStatus.useMutation({onSuccess:c=>{console.log("Bulk product status update successful:",c),It.success(`Updated ${c.updated_count} products successfully`)},onError:c=>{console.error("Bulk update status mutation error:",c),It.error(c.message||"Failed to update product status")}}),BE=()=>_t.products.reactivate.useMutation({onSuccess:c=>{console.log("Product reactivated successfully:",c),It.success("Product reactivated successfully")},onError:c=>{console.error("Reactivate product mutation error:",c),It.error(c.message||"Failed to reactivate product")}}),UE=({products:c,loading:d=!1,onView:f,onEdit:g,onDelete:w,selectedProducts:N=[],onSelectionChange:T})=>{const[A,n]=le.useState(!1),M=BE(),z=K=>new Date(K).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),V=K=>K==="cylinder"?Vf:$f,U=K=>{switch(K){case"active":return"active";case"end_of_sale":return"credit_hold";case"obsolete":return"closed";default:return"active"}},G=K=>{n(K),T&&T(K?c.map(ue=>ue.id):[])},W=(K,ue)=>{if(T){const re=ue?[...N,K]:N.filter(te=>te!==K);T(re),n(re.length===c.length)}},$=async K=>{try{await M.mutateAsync(K.id)}catch{}};return console.log("ProductTable render:",{products:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading products..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load products. Please check your connection.":"Get started by adding your first product."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Products (",c.length,")"]}),N.length>0&&t.jsxs("span",{className:"text-sm text-blue-600",children:[N.length," selected"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[T&&t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:A,onChange:K=>G(K.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type & Specs"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(K=>{const ue=V(K.unit_of_measure),re=K.status==="obsolete";return t.jsxs("tr",{className:`hover:bg-gray-50 ${re?"opacity-60":""}`,children:[T&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",checked:N.includes(K.id),onChange:te=>W(K.id,te.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[K.name,re&&t.jsx("span",{className:"ml-2 text-xs text-red-600",children:"(Obsolete)"})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",K.sku]}),K.description&&t.jsx("div",{className:"text-xs text-gray-400 mt-1 max-w-xs truncate",children:K.description})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ue,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsx("div",{className:"capitalize",children:K.unit_of_measure}),K.unit_of_measure==="cylinder"&&t.jsxs("div",{className:"text-xs text-gray-500",children:[K.capacity_kg&&`${K.capacity_kg} kg capacity`,K.tare_weight_kg&&`  ${K.tare_weight_kg} kg tare`]}),K.valve_type&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Valve: ",K.valve_type]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(gm,{status:U(K.status),className:"capitalize",children:K.status.replace("_"," ")})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:z(K.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>f(K),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View product",children:t.jsx(am,{className:"h-4 w-4"})}),!re&&t.jsx("button",{onClick:()=>g(K),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit product",children:t.jsx(ci,{className:"h-4 w-4"})}),re?t.jsx("button",{onClick:()=>$(K),disabled:M.isPending,className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors disabled:opacity-50",title:"Reactivate product",children:t.jsx(Ya,{className:"h-4 w-4"})}):t.jsx("button",{onClick:()=>w(K),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Mark as obsolete",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},K.id)})})]})})]})},VE=({filters:c,onFiltersChange:d})=>{const f=n=>{d({...c,search:n.target.value||void 0,page:1})},g=n=>{d({...c,status:n.target.value||void 0,page:1})},w=n=>{d({...c,unit_of_measure:n.target.value||void 0,page:1})},N=n=>{const[M,z]=n.target.value.split(":");d({...c,sort_by:M||"created_at",sort_order:z||"desc",page:1})},T=()=>{d({...c,show_obsolete:!c.show_obsolete,page:1})},A=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by SKU, name, or description...",value:c.search||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]})}),t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(hs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.unit_of_measure||"",onChange:w,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"cylinder",children:"Cylinders"}),t.jsx("option",{value:"kg",children:"By Weight (kg)"})]})]})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("select",{value:`${c.sort_by||"created_at"}:${c.sort_order||"desc"}`,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"created_at:desc",children:"Newest First"}),t.jsx("option",{value:"created_at:asc",children:"Oldest First"}),t.jsx("option",{value:"name:asc",children:"Name A-Z"}),t.jsx("option",{value:"name:desc",children:"Name Z-A"}),t.jsx("option",{value:"sku:asc",children:"SKU A-Z"}),t.jsx("option",{value:"sku:desc",children:"SKU Z-A"}),t.jsx("option",{value:"capacity_kg:desc",children:"Capacity High-Low"}),t.jsx("option",{value:"capacity_kg:asc",children:"Capacity Low-High"})]})}),t.jsxs("button",{onClick:T,className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${c.show_obsolete?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,title:c.show_obsolete?"Hide obsolete products":"Show obsolete products",children:[c.show_obsolete?t.jsx(XN,{className:"h-4 w-4"}):t.jsx(am,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:c.show_obsolete?"Hide Obsolete":"Show Obsolete"})]}),t.jsxs("button",{onClick:A,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},yb=({isOpen:c,onClose:d,onSubmit:f,product:g,loading:w=!1,title:N})=>{const[T,A]=le.useState(!1),{register:n,handleSubmit:M,reset:z,watch:V,formState:{errors:U}}=En({defaultValues:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:void 0,tare_weight_kg:void 0,valve_type:"",status:"active",barcode_uid:""}}),G=V("unit_of_measure"),W=V("status");le.useEffect(()=>{z(g?{sku:g.sku,name:g.name,description:g.description||"",unit_of_measure:g.unit_of_measure,capacity_kg:g.capacity_kg,tare_weight_kg:g.tare_weight_kg,valve_type:g.valve_type||"",status:g.status,barcode_uid:g.barcode_uid||""}:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:void 0,tare_weight_kg:void 0,valve_type:"",status:"active",barcode_uid:""})},[g,z]),le.useEffect(()=>{A(W==="obsolete")},[W]);const $=async ue=>{try{const re=await _t.products.validateSku.mutate({sku:ue.sku,exclude_id:g==null?void 0:g.id});if(!re.valid)return console.error("SKU validation failed:",re.errors),!1;re.warnings.length>0&&console.warn("SKU warnings:",re.warnings)}catch(re){return console.error("SKU validation error:",re),!1}if(ue.unit_of_measure==="cylinder"&&(ue.capacity_kg||ue.tare_weight_kg))try{const re=await _t.products.validateWeight.mutate({capacity_kg:ue.capacity_kg,tare_weight_kg:ue.tare_weight_kg,unit_of_measure:ue.unit_of_measure});if(!re.valid)return console.error("Weight validation failed:",re.errors),!1;re.warnings.length>0&&console.warn("Weight warnings:",re.warnings)}catch(re){return console.error("Weight validation error:",re),!1}return!0},K=async ue=>{try{if(!await $(ue))return;const te={...ue};ue.unit_of_measure!=="cylinder"&&(te.capacity_kg=void 0,te.tare_weight_kg=void 0,te.valve_type=void 0),Object.keys(te).forEach(je=>{te[je]===""&&(te[je]=void 0)}),f(te)}catch(re){console.error("Form validation error:",re)}};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:M(K),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU *"}),t.jsx("input",{type:"text",id:"sku",...n("sku",{required:"SKU is required",pattern:{value:/^[A-Z0-9-]+$/,message:"SKU must contain only uppercase letters, numbers, and hyphens"},minLength:{value:3,message:"SKU must be at least 3 characters long"},maxLength:{value:50,message:"SKU must be 50 characters or less"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 uppercase",placeholder:"CYL-50KG-S"}),U.sku&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.sku.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",...n("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),t.jsx("input",{type:"text",id:"name",...n("name",{required:"Product name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"LPG Cylinder 50kg"}),U.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.name.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...n("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Detailed product description..."})]})]}),T&&t.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:'Warning: Setting status to "Obsolete" will make this product unavailable for future orders.'})]})})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Physical Properties"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_of_measure",className:"block text-sm font-medium text-gray-700",children:"Unit of Measure"}),t.jsxs("select",{id:"unit_of_measure",...n("unit_of_measure"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"kg",children:"By Weight (kg)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"barcode_uid",className:"block text-sm font-medium text-gray-700",children:"Barcode/RFID UID"}),t.jsx("input",{type:"text",id:"barcode_uid",...n("barcode_uid"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional unique identifier"})]}),G==="cylinder"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_kg",className:"block text-sm font-medium text-gray-700",children:"Capacity (kg)"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"500",id:"capacity_kg",...n("capacity_kg",{valueAsNumber:!0,min:{value:.1,message:"Capacity must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"50.0"}),U.capacity_kg&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.capacity_kg.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tare_weight_kg",className:"block text-sm font-medium text-gray-700",children:"Tare Weight (kg)"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"500",id:"tare_weight_kg",...n("tare_weight_kg",{valueAsNumber:!0,min:{value:.1,message:"Tare weight must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"15.0"}),U.tare_weight_kg&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.tare_weight_kg.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"valve_type",className:"block text-sm font-medium text-gray-700",children:"Valve Type"}),t.jsx("input",{type:"text",id:"valve_type",...n("valve_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Standard valve specifications"})]})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Product"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},v0=async(c,d)=>{try{return(await _t.products.generateVariantSku.mutate({parent_sku:c,variant_name:d})).variant_sku}catch(f){throw console.error("Failed to generate variant SKU via API:",f),new Error("Variant SKU generation failed. Please try again.")}},w0=[{name:"Loading...",description:"Please use getStandardCylinderVariants() API"}],qE=c=>({delivery:"Delivery",refill:"Refill",exchange:"Exchange",pickup:"Pickup"})[c]||c,$E=c=>({standard:"Standard",express:"Express",emergency:"Emergency",scheduled:"Scheduled"})[c]||c,lf=async c=>{try{return(await _t.products.shouldRequirePickup.mutate({order_type:c})).requires_pickup}catch(d){throw console.error("Failed to check pickup requirement via API:",d),new Error("Pickup requirement check failed. Please try again.")}},GE=({isOpen:c,onClose:d,onSubmit:f,product:g,loading:w=!1,title:N})=>{const[T,A]=le.useState(!1),[n,M]=le.useState([]),{register:z,handleSubmit:V,reset:U,watch:G,setValue:W,formState:{errors:$}}=En({defaultValues:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:0,tare_weight_kg:0,valve_type:"",status:"active",barcode_uid:"",requires_tag:!1,variant_type:"cylinder",parent_product_id:void 0,variant_name:void 0,is_variant:!1}}),K=G("variant_type"),ue=G("sku");le.useEffect(()=>{g&&U({sku:g.sku,name:g.name,description:g.description||"",unit_of_measure:g.unit_of_measure,capacity_kg:g.capacity_kg||0,tare_weight_kg:g.tare_weight_kg||0,valve_type:g.valve_type||"",status:g.status,barcode_uid:g.barcode_uid||"",requires_tag:g.requires_tag,variant_type:g.variant_type,parent_product_id:g.parent_product_id,variant_name:g.variant_name,is_variant:g.is_variant})},[g,U]),le.useEffect(()=>{K==="cylinder"&&n.length===0&&T&&M(w0.map(Ae=>({name:Ae.name,description:Ae.description,status:"active"})))},[K,T,n.length]);const re=()=>{M([...n,{name:"",description:"",status:"active"}])},te=Ae=>{M(n.filter((fe,Ie)=>Ie!==Ae))},je=(Ae,fe,Ie)=>{const Ee=[...n];Ee[Ae]={...Ee[Ae],[fe]:Ie},M(Ee)},me=Ae=>{const fe={...Ae,is_variant:!1,parent_product_id:void 0,variant_name:void 0};let Ie;T&&n.length>0&&(Ie=n.map(Ee=>({parent_product_id:"",variant_name:Ee.name,sku:v0(Ae.sku,Ee.name),name:`${Ae.name} (${Ee.name})`,description:Ee.description||`${Ee.name} variant of ${Ae.name}`,status:Ee.status,barcode_uid:void 0}))),f(fe,Ie)},Ce=()=>{M(w0.map(Ae=>({name:Ae.name,description:Ae.description,status:"active"})))};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:t.jsxs("form",{onSubmit:V(me),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h4",{className:"text-md font-semibold text-gray-900 flex items-center space-x-2",children:[t.jsx(hs,{className:"h-5 w-5"}),t.jsx("span",{children:"Product Information"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU *"}),t.jsx("input",{type:"text",id:"sku",...z("sku",{required:"SKU is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., PROGAS-13KG"}),$.sku&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:$.sku.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),t.jsx("input",{type:"text",id:"name",...z("name",{required:"Product name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., ProGas 13kg Cylinder"}),$.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:$.name.message})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...z("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Product description..."})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"variant_type",className:"block text-sm font-medium text-gray-700",children:"Variant Type *"}),t.jsxs("select",{id:"variant_type",...z("variant_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"refillable",children:"Refillable"}),t.jsx("option",{value:"disposable",children:"Disposable"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_of_measure",className:"block text-sm font-medium text-gray-700",children:"Unit of Measure"}),t.jsxs("select",{id:"unit_of_measure",...z("unit_of_measure"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"kg",children:"Kilogram"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_kg",className:"block text-sm font-medium text-gray-700",children:"Capacity (kg)"}),t.jsx("input",{type:"number",step:"0.1",id:"capacity_kg",...z("capacity_kg",{min:0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tare_weight_kg",className:"block text-sm font-medium text-gray-700",children:"Tare Weight (kg)"}),t.jsx("input",{type:"number",step:"0.1",id:"tare_weight_kg",...z("tare_weight_kg",{min:0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"valve_type",className:"block text-sm font-medium text-gray-700",children:"Valve Type"}),t.jsx("input",{type:"text",id:"valve_type",...z("valve_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., POL, ACME"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",...z("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]})]}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"requires_tag",...z("requires_tag"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"requires_tag",className:"ml-2 block text-sm text-gray-700",children:"Requires Tag"})]})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"text-md font-semibold text-gray-900 flex items-center space-x-2",children:[t.jsx(oS,{className:"h-5 w-5"}),t.jsx("span",{children:"Product Variants"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"create_variants",checked:T,onChange:Ae=>A(Ae.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"create_variants",className:"block text-sm text-gray-700",children:"Create Variants"})]})]}),T&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(im,{className:"h-5 w-5 text-blue-600 mt-0.5"}),t.jsx("div",{children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Product Variants:"})," Create different variants of this product (e.g., full vs empty cylinders). Each variant will have its own SKU and inventory tracking."]})})]})}),K==="cylinder"&&n.length===0&&t.jsx("div",{className:"text-center py-4",children:t.jsxs("button",{type:"button",onClick:Ce,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Standard Cylinder Variants"})]})}),n.map((Ae,fe)=>t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h5",{className:"text-sm font-medium text-gray-900",children:["Variant ",fe+1]}),t.jsx("button",{type:"button",onClick:()=>te(fe),className:"text-red-600 hover:text-red-800",children:t.jsx(to,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Variant Name *"}),t.jsx("input",{type:"text",value:Ae.name,onChange:Ie=>je(fe,"name",Ie.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., full, empty"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("input",{type:"text",value:Ae.description||"",onChange:Ie=>je(fe,"description",Ie.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Variant description"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("strong",{children:"Generated SKU:"})," ",ue?v0(ue,Ae.name):"Enter parent SKU first"]})]})]},fe)),t.jsxs("button",{type:"button",onClick:re,className:"w-full flex items-center justify-center space-x-2 border border-gray-300 rounded-lg px-4 py-3 text-gray-600 hover:bg-gray-50 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Another Variant"})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Creating...":"Create Product"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},ZE=()=>{const{data:c,isLoading:d}=RE();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((g,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const f=[{name:"Total Products",value:c.total,icon:hs,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Active",value:c.active,icon:$n,color:"text-green-600",bgColor:"bg-green-50"},{name:"End of Sale",value:c.end_of_sale,icon:Us,color:"text-yellow-600",bgColor:"bg-yellow-50"},{name:"Obsolete",value:c.obsolete,icon:pa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Cylinders",value:c.cylinders,icon:Vf,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"By Weight",value:c.kg_products,icon:$f,color:"text-indigo-600",bgColor:"bg-indigo-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:f.map(g=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${g.bgColor} mb-2`,children:t.jsx(g.icon,{className:`h-6 w-6 ${g.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.value}),t.jsx("div",{className:"text-sm text-gray-600",children:g.name})]},g.name))})]})},WE=({selectedProducts:c,onClearSelection:d})=>{const[f,g]=le.useState(!1),w=FE(),N=async A=>{try{await w.mutateAsync({productIds:c,status:A}),d(),g(!1)}catch{}},T=()=>{console.log("Exporting products:",c),g(!1)};return c.length===0?null:t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[c.length," product",c.length>1?"s":""," selected"]}),t.jsx("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear selection"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>g(!f),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(rS,{className:"h-4 w-4"}),t.jsx("span",{children:"Bulk Actions"}),t.jsx(nm,{className:"h-4 w-4"})]}),f&&t.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-10",children:t.jsxs("div",{className:"py-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Change Status"}),t.jsx("button",{onClick:()=>N("active"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as Active"}),t.jsx("button",{onClick:()=>N("end_of_sale"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as End of Sale"}),t.jsx("button",{onClick:()=>N("obsolete"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as Obsolete"}),t.jsx("div",{className:"border-t border-gray-100 mt-1",children:t.jsxs("button",{onClick:T,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(qf,{className:"h-4 w-4"}),t.jsx("span",{children:"Export Selected"})]})})]})})]})]})})},HE=()=>{const c=Qr(),[d,f]=le.useState({page:1}),[g,w]=le.useState(!1),[N,T]=le.useState(!1),[A,n]=le.useState(null),[M,z]=le.useState(null),[V,U]=le.useState([]),{data:G,isLoading:W,error:$,refetch:K}=cc(d),ue=zE(),re=xb(),te=OE();le.useEffect(()=>{console.log("ProductsPage state:",{filters:d,data:G,isLoading:W,error:$,isFormOpen:g,editingProduct:A,selectedProducts:V})},[d,G,W,$,g,A,V]);const je=()=>{console.log("Adding new product"),n(null),w(!0)},me=()=>{console.log("Adding product with variants"),T(!0)},Ce=ft=>{console.log("Editing product:",ft),n(ft),w(!0)},Ae=ft=>{console.log("Viewing product:",ft),c(`/products/${ft.id}`)},fe=ft=>{console.log("Marking product as obsolete:",ft),z(ft)},Ie=async ft=>{console.log("Form submit:",ft);try{A?await re.mutateAsync({id:A.id,...ft}):await ue.mutateAsync(ft),w(!1),n(null)}catch(wt){console.error("Form submit error:",wt)}},Ee=async(ft,wt)=>{console.log("Variant form submit:",ft,wt);try{const Os=await ue.mutateAsync(ft);if(wt&&wt.length>0)for(const ns of wt){const _s={...ns,parent_product_id:Os.id};await ue.mutateAsync(_s)}T(!1),K()}catch(Os){console.error("Variant form submit error:",Os)}},tt=async()=>{if(M){console.log("Confirming mark as obsolete:",M);try{await te.mutateAsync(M.id),z(null)}catch(ft){console.error("Mark obsolete error:",ft)}}},Pe=ft=>{console.log("Page change:",ft),f(wt=>({...wt,page:ft}))},Te=()=>{console.log("Refreshing products"),K()},rt=ft=>{U(ft)},gt=()=>{U([])},pt=M?M.status==="obsolete"?{title:"Product Already Obsolete",message:`"${M.name}" is already marked as obsolete and hidden from active lists.`}:{title:"Mark Product as Obsolete",message:`Are you sure you want to mark "${M.name}" as obsolete? This will hide it from active product lists but preserve all historical data including price lists, inventory records, and order history. The product can be reactivated later if needed.`}:{title:"",message:""};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Products"}),t.jsx("p",{className:"text-gray-600",children:"Manage your LPG product catalog"}),$&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",$.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Te,disabled:W,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${W?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:me,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(N_,{className:"h-4 w-4"}),t.jsx("span",{children:"Create with Variants"})]}),t.jsxs("button",{onClick:je,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]})]}),t.jsx(ZE,{}),t.jsx(VE,{filters:d,onFiltersChange:f}),t.jsx(WE,{selectedProducts:V,onClearSelection:gt}),t.jsx(UE,{products:(G==null?void 0:G.products)||[],loading:W,onView:Ae,onEdit:Ce,onDelete:fe,selectedProducts:V,onSelectionChange:rt}),G&&G.totalPages>1&&t.jsx(ac,{currentPage:G.currentPage,totalPages:G.totalPages,totalCount:G.totalCount,onPageChange:Pe}),t.jsx(yb,{isOpen:g,onClose:()=>{console.log("Closing form"),w(!1),n(null)},onSubmit:Ie,product:A||void 0,loading:ue.isPending||re.isPending,title:A?"Edit Product":"Add New Product"}),t.jsx(GE,{isOpen:N,onClose:()=>T(!1),onSubmit:Ee,loading:ue.isPending,title:"Create Product with Variants"}),t.jsx(so,{isOpen:!!M,onClose:()=>z(null),onConfirm:tt,title:pt.title,message:pt.message,confirmText:(M==null?void 0:M.status)==="obsolete"?"OK":"Mark as Obsolete",type:(M==null?void 0:M.status)==="obsolete"?"info":"warning",loading:te.isPending})]})},Yf=(c={})=>_t.pricing.listPriceLists.useQuery({search:c.search,currency:c.currency,status:c.status,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Price lists fetch error:",d),It.error("Failed to load price lists")}}),XE=c=>_t.pricing.getPriceList.useQuery({price_list_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Price list fetch error:",d),It.error("Failed to load price list details")}}),KE=()=>{const c=_t.useContext();return _t.pricing.createPriceList.useMutation({onSuccess:d=>{console.log("Price list created successfully:",d),c.pricing.listPriceLists.invalidate(),c.pricing.getStats.invalidate(),It.success("Price list created successfully")},onError:d=>{console.error("Create price list error:",d),It.error(d.message||"Failed to create price list")}})},_b=()=>{const c=_t.useContext();return _t.pricing.updatePriceList.useMutation({onSuccess:d=>{console.log("Price list updated successfully:",d),c.pricing.listPriceLists.invalidate(),c.pricing.getPriceList.invalidate({price_list_id:d.id}),c.pricing.getStats.invalidate(),It.success("Price list updated successfully")},onError:d=>{console.error("Update price list error:",d),It.error(d.message||"Failed to update price list")}})},QE=()=>_t.pricing.getStats.useQuery(void 0,{enabled:!0,staleTime:6e4,retry:1,onError:c=>{console.error("Pricing stats fetch error:",c),It.error("Failed to load pricing statistics")}}),bb=(c,d={})=>_t.pricing.getPriceListItems.useQuery({price_list_id:c,search:d.search,page:d.page||1,limit:d.limit||50},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:f=>{console.error("Price list items fetch error:",f),It.error("Failed to load price list items")}}),vb=()=>{const c=_t.useContext();return _t.pricing.createPriceListItem.useMutation({onSuccess:d=>{console.log("Price list item created successfully:",d),c.pricing.getPriceListItems.invalidate({price_list_id:d.price_list_id}),c.pricing.getPriceList.invalidate({price_list_id:d.price_list_id}),It.success("Price list item created successfully")},onError:d=>{console.error("Create price list item error:",d),It.error(d.message||"Failed to create price list item")}})},JE=()=>[{code:"KES",name:"Kenyan Shilling",symbol:"Ksh"}],ls=(c,d="KES")=>{const f=JE().find(w=>w.code===d);return`${(f==null?void 0:f.symbol)||"Ksh"} ${c.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`},id=(c,d)=>(console.warn("calculateFinalPriceSync is deprecated - use calculateFinalPrice() API instead"),c),wb=(c,d)=>{const f=new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});if(!d)return`${f} - Ongoing`;const g=new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return`${f} - ${g}`},Pf=(c,d)=>{const f=new Date().toISOString().split("T")[0];return c>f?{status:"future",label:"Future",color:"bg-blue-100 text-blue-800 border-blue-200"}:d&&d<f?{status:"expired",label:"Expired",color:"bg-red-100 text-red-800 border-red-200"}:{status:"active",label:"Active",color:"bg-green-100 text-green-800 border-green-200"}},YE=async(c,d)=>{try{return(await _t.pricing.validateDateRange.query({startDate:c,endDate:d})).valid}catch(f){throw console.error("Failed to validate date range via API:",f),new Error("Date range validation failed. Please try again.")}},eC=({isOpen:c,onClose:d,onSubmit:f,priceListId:g,item:w,loading:N=!1,title:T,existingProductIds:A=[]})=>{const[n,M]=le.useState([]),[z,V]=le.useState(0),[U,G]=le.useState(!1),{register:W,handleSubmit:$,reset:K,watch:ue,setValue:re,formState:{errors:te}}=En({defaultValues:{price_list_id:g,product_id:"",unit_price:0,min_qty:1,surcharge_pct:0}}),{data:je}=cc({limit:1e3}),Ce=((je==null?void 0:je.products)||[]).filter(Pe=>Pe.status==="active"&&!A.includes(Pe.id)),Ae=ue("unit_price"),fe=ue("surcharge_pct");le.useEffect(()=>{K(w?{price_list_id:w.price_list_id,product_id:w.product_id,unit_price:w.unit_price,min_qty:w.min_qty,surcharge_pct:w.surcharge_pct||0}:{price_list_id:g,product_id:"",unit_price:0,min_qty:1,surcharge_pct:0})},[w,g,K]);const Ie=Pe=>{w?f(Pe):n.length>0?n.forEach(Te=>{f({...Pe,product_id:Te,unit_price:U?z:Pe.unit_price})}):f(Pe)},Ee=Pe=>{M(Te=>Te.includes(Pe)?Te.filter(rt=>rt!==Pe):[...Te,Pe])},tt=(Pe,Te)=>id(Pe);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:$(Ie),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:T}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[!w&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Products"}),t.jsx("div",{className:"border border-gray-300 rounded-md p-2 max-h-60 overflow-y-auto",children:Ce.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500",children:"No available products to add"}):t.jsx("div",{className:"space-y-2",children:Ce.map(Pe=>t.jsxs("div",{className:`flex items-center p-2 rounded-md ${n.includes(Pe.id)?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:[t.jsx("input",{type:"checkbox",id:`product-${Pe.id}`,checked:n.includes(Pe.id),onChange:()=>Ee(Pe.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsxs("label",{htmlFor:`product-${Pe.id}`,className:"ml-2 block text-sm text-gray-900 cursor-pointer flex-1",children:[t.jsx("div",{className:"font-medium",children:Pe.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",Pe.sku]})]})]},Pe.id))})}),n.length>0&&t.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:[n.length," product",n.length!==1?"s":""," selected"]})]}),!w&&n.length>0&&t.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("input",{type:"checkbox",id:"use-bulk-price",checked:U,onChange:()=>G(!U),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"use-bulk-price",className:"ml-2 block text-sm font-medium text-blue-800",children:"Apply same price to all selected products"})]}),U&&t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"block text-sm font-medium text-blue-800 mb-1",children:"Bulk Price (KSh)"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:z,onChange:Pe=>V(parseFloat(Pe.target.value)||0),className:"w-full rounded-md border border-blue-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"})]})]}),(w||!U)&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700",children:"Unit Price (KSh) *"}),t.jsx("input",{type:"number",id:"unit_price",min:"0",step:"0.01",...W("unit_price",{required:"Unit price is required",min:{value:0,message:"Price must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"}),te.unit_price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.unit_price.message})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"min_qty",className:"block text-sm font-medium text-gray-700",children:"Minimum Quantity"}),t.jsx("input",{type:"number",id:"min_qty",min:"1",...W("min_qty",{required:"Minimum quantity is required",min:{value:1,message:"Minimum quantity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),te.min_qty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.min_qty.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"surcharge_pct",className:"block text-sm font-medium text-gray-700",children:"Surcharge %"}),t.jsx("input",{type:"number",id:"surcharge_pct",min:"0",step:"0.1",...W("surcharge_pct",{min:{value:0,message:"Surcharge must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"}),te.surcharge_pct&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.surcharge_pct.message})]})]}),(Ae>0||z>0)&&fe>0&&t.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:t.jsxs("div",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Final Price:"})," ",ls(tt(U?z:Ae)),t.jsxs("div",{className:"text-xs mt-1",children:["(Base price + ",fe,"% surcharge)"]})]})}),w&&t.jsx("input",{type:"hidden",...W("product_id"),value:w.product_id}),t.jsx("input",{type:"hidden",...W("price_list_id"),value:g})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||n.length===0&&!w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):w?"Update Price":"Add Products"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},tC=({productId:c})=>{const[d,f]=le.useState(null),[g,w]=le.useState(!1),[N,T]=le.useState(null),{data:A={priceLists:[]}}=Yf(),n=A.priceLists||[],M={},z=vb(),V=re=>{f(re),T(null),w(!0)},U=re=>{f(re.price_list_id),T(re),w(!0)},G=async re=>{try{if(N){alert("Edit functionality is temporarily disabled");return}else await z.mutateAsync({...re,product_id:c});w(!1),T(null)}catch{}},W=n.filter(re=>!Object.keys(M).includes(re.id));new Date().toISOString().split("T")[0];const $=n.filter(re=>Pf(re.start_date,re.end_date).status==="active"),K=Object.keys(M).length===0,ue=!$.some(re=>Object.keys(M).includes(re.id));return t.jsxs("div",{className:"space-y-6",children:[(K||ue)&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Sn,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:K?"No Pricing Defined":"No Active Pricing"}),t.jsx("p",{className:"text-sm text-yellow-700",children:K?"This product has no pricing defined in any price list.":"This product has pricing defined, but not in any active price list."})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Current Pricing"}),W.length>0&&t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:"",onChange:re=>{re.target.value&&V(re.target.value)},className:"appearance-none bg-blue-600 text-white px-3 py-1 pr-8 rounded text-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[t.jsx("option",{value:"",children:"Add to Price List..."}),W.map(re=>t.jsx("option",{value:re.id,children:re.name},re.id))]}),t.jsx(wr,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white pointer-events-none"})]})]}),Object.keys(M).length===0?t.jsxs("div",{className:"p-8 text-center",children:[t.jsx(Sn,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"No pricing defined for this product"}),W.length>0&&t.jsx("button",{onClick:()=>V(W[0].id),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Add pricing to a price list"})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price List"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Min Qty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Surcharge"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(M).map(([re,te])=>{const je=n.find(fe=>fe.id===re);if(!je||!te.length)return null;const me=te[0],Ce=Pf(je.start_date,je.end_date),Ae=id(me.unit_price,me.surcharge_pct);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:je.name}),je.is_default&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Default"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Ce.color}`,children:Ce.label})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(me.unit_price)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:me.min_qty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:me.surcharge_pct?`${me.surcharge_pct}%`:"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-green-600",children:ls(Ae)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx("button",{onClick:()=>U(me),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit price",children:t.jsx(ci,{className:"h-4 w-4"})})})]},re)})})]})})]}),g&&d&&t.jsx(eC,{isOpen:g,onClose:()=>{w(!1),T(null)},onSubmit:G,priceListId:d,item:N||void 0,loading:z.isPending,title:N?"Edit Product Price":"Add Product to Price List"})]})},sC=()=>{const{id:c}=nc(),d=Qr(),[f,g]=le.useState(!1),[w,N]=le.useState("details"),{data:T,isLoading:A,error:n}=LE(c),M=xb(),z=async W=>{if(T)try{await M.mutateAsync({id:T.id,...W}),g(!1)}catch{}},V=W=>new Date(W).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=W=>{switch(W){case"active":return"active";case"end_of_sale":return"credit_hold";case"obsolete":return"closed";default:return"active"}};if(A)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(n||!T)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Product not found or error loading product details."})})})]});const G=T.unit_of_measure==="cylinder"?Vf:$f;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:T.name})]}),t.jsxs("button",{onClick:()=>g(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ci,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Product"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"flex space-x-8 px-6",children:[t.jsxs("button",{onClick:()=>N("details"),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${w==="details"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(hs,{className:"h-4 w-4"}),t.jsx("span",{children:"Product Details"})]}),t.jsxs("button",{onClick:()=>N("pricing"),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${w==="pricing"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(Sn,{className:"h-4 w-4"}),t.jsx("span",{children:"Pricing"})]})]})}),t.jsxs("div",{className:"p-6",children:[w==="details"&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Product Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:T.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"SKU"}),t.jsx("span",{className:"text-gray-900 font-mono",children:T.sku})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Unit of Measure"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(G,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900 capitalize",children:T.unit_of_measure})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),t.jsx(gm,{status:U(T.status),className:"capitalize",children:T.status.replace("_"," ")})]}),T.unit_of_measure==="cylinder"&&t.jsxs(t.Fragment,{children:[T.capacity_kg&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Capacity"}),t.jsxs("span",{className:"text-gray-900",children:[T.capacity_kg," kg"]})]}),T.tare_weight_kg&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Tare Weight"}),t.jsxs("span",{className:"text-gray-900",children:[T.tare_weight_kg," kg"]})]}),T.valve_type&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Valve Type"}),t.jsx("span",{className:"text-gray-900",children:T.valve_type})]})]}),T.barcode_uid&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Barcode/RFID UID"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(qN,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900 font-mono",children:T.barcode_uid})]})]}),T.description&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),t.jsx("p",{className:"text-gray-900",children:T.description})]})]}),T.status==="obsolete"&&t.jsx("div",{className:"mt-6 p-4 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-600"}),t.jsx("span",{className:"text-sm font-medium text-red-800",children:"This product is marked as obsolete and is no longer available for new orders."})]})})]}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Details"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:V(T.created_at)})]})]})})]})})]}),w==="pricing"&&t.jsx(tC,{productId:T.id})]})]}),t.jsx(yb,{isOpen:f,onClose:()=>g(!1),onSubmit:z,product:T,loading:M.isPending,title:"Edit Product"})]})},eg=(c={})=>_t.warehouses.list.useQuery(c,{retry:1,staleTime:3e4}),rC=c=>_t.warehouses.get.useQuery({id:c},{enabled:!!c}),iC=()=>_t.warehouses.getStats.useQuery(void 0,{staleTime:6e4}),tg=()=>_t.warehouses.getOptions.useQuery(void 0,{staleTime:3e5}),nC=()=>_t.warehouses.create.useMutation({onSuccess:c=>{console.log("Warehouse created successfully:",c),It.success("Warehouse created successfully")},onError:c=>{console.error("Create warehouse mutation error:",c),It.error(c.message||"Failed to create warehouse")}}),jb=()=>_t.warehouses.update.useMutation({onSuccess:c=>{console.log("Warehouse updated successfully:",c),It.success("Warehouse updated successfully")},onError:c=>{console.error("Update warehouse mutation error:",c),It.error(c.message||"Failed to update warehouse")}}),aC=()=>_t.warehouses.delete.useMutation({onSuccess:(c,d)=>{console.log("Warehouse deleted successfully:",d.id),It.success("Warehouse deleted successfully")},onError:c=>{console.error("Delete warehouse mutation error:",c),It.error(c.message||"Failed to delete warehouse")}}),oC=({warehouses:c,loading:d=!1,onView:f,onEdit:g,onDelete:w})=>{const N=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),T=n=>n?n.toLocaleString()+" cylinders":"-",A=n=>n?[n.city,n.state].filter(Boolean).join(", ")||"Address incomplete":"No address";return console.log("WarehouseTable render:",{warehouses:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading warehouses..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(Gn,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No warehouses found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load warehouses. Please check your connection.":"Get started by adding your first warehouse."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Warehouses (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(n=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx(Gn,{className:"h-5 w-5 text-blue-600"})})}),t.jsx("div",{children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.name})})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Tn,{className:"h-4 w-4 text-gray-400"}),t.jsx("div",{className:"text-sm text-gray-900",children:A(n.address)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:T(n.capacity_cylinders)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(n.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>f(n),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View warehouse",children:t.jsx(am,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>g(n),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit warehouse",children:t.jsx(ci,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>w(n),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete warehouse",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},n.id))})]})})]})},lC=({filters:c,onFiltersChange:d})=>{const f=w=>{d({...c,search:w.target.value||void 0,page:1})},g=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by warehouse name...",value:c.search||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("button",{onClick:g,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{children:"Reset"})]})]})})},Nb=({isOpen:c,onClose:d,onSubmit:f,warehouse:g,loading:w=!1,title:N})=>{const[T,A]=le.useState(!0),[n,M]=le.useState(""),[z,V]=le.useState(!1),[U,G]=le.useState(null),[W,$]=le.useState([]),K=mi.useRef(null),[ue,re]=le.useState(null),[te,je]=le.useState(null),[me,Ce]=le.useState(!1),{register:Ae,handleSubmit:fe,reset:Ie,setValue:Ee,watch:tt,formState:{errors:Pe}}=En({defaultValues:{name:"",capacity_cylinders:void 0,address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}}),Te=tt("address.latitude"),rt=tt("address.longitude");le.useEffect(()=>{if(g){const yt=!!g.address;A(yt),Ie({name:g.name,capacity_cylinders:g.capacity_cylinders,address:g.address?{line1:g.address.line1,line2:g.address.line2||"",city:g.address.city,state:g.address.state||"",postal_code:g.address.postal_code||"",country:g.address.country,instructions:g.address.instructions||"",latitude:g.address.latitude,longitude:g.address.longitude}:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}),M(g.address?[g.address.line1,g.address.city,g.address.state,g.address.postal_code,g.address.country].filter(Boolean).join(", "):"")}else A(!0),Ie({name:"",capacity_cylinders:void 0,address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}),M("")},[g,Ie]),le.useEffect(()=>{let yt=!0;return n&&n.length>=3?(V(!0),cb(n,V).then(pt=>{yt&&$(pt||[])})):($([]),V(!1)),()=>{yt=!1}},[n]),le.useEffect(()=>{if(!ue&&K.current&&Te&&rt){fi.accessToken=void 0;const yt=new fi.Map({container:K.current,style:"mapbox://styles/mapbox/streets-v11",center:[rt,Te],zoom:14});yt.addControl(new fi.NavigationControl,"top-right"),re(yt);const pt=new fi.Marker({anchor:"center",draggable:me}).setLngLat([rt,Te]).addTo(yt);je(pt),pt.on("dragend",()=>{const ft=pt.getLngLat();Ee("address.latitude",ft.lat),Ee("address.longitude",ft.lng)}),yt.on("load",()=>{yt.resize()})}},[K,Te,rt]),le.useEffect(()=>{ue&&te&&Te&&rt&&(te.setLngLat([rt,Te]),te.setDraggable(me),ue.setCenter([rt,Te]),ue.setZoom(14),ue.resize())},[Te,rt,me,ue,te]),le.useEffect(()=>()=>{te&&te.remove(),ue&&ue.remove()},[]);const gt=yt=>{f(yt)};return mb(),c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:fe(gt),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Warehouse Name *"}),t.jsx("input",{type:"text",id:"name",...Ae("name",{required:"Warehouse name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Main Depot"}),Pe.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:Pe.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_cylinders",className:"block text-sm font-medium text-gray-700",children:"Storage Capacity (cylinders)"}),t.jsx("input",{type:"number",min:"1",id:"capacity_cylinders",...Ae("capacity_cylinders",{valueAsNumber:!0,min:{value:1,message:"Capacity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"1000"}),Pe.capacity_cylinders&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:Pe.capacity_cylinders.message})]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Location"})}),T&&t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("label",{htmlFor:"addressInput",className:"block text-sm font-medium text-gray-700",children:"Address *"}),t.jsx("input",{type:"text",id:"addressInput",value:n,onChange:yt=>{M(yt.target.value),G(null)},className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Start typing address..."}),z&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Searching..."}),W.length>0&&!U&&t.jsx("ul",{className:"border border-gray-200 rounded bg-white mt-1 max-h-48 overflow-y-auto z-10 relative",children:W.map((yt,pt)=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-50",onClick:()=>{G(yt),M(yt.display_name),Ee("address.line1",yt.address_line1||""),Ee("address.line2",yt.address_line2||""),Ee("address.city",yt.city||""),Ee("address.state",yt.state||""),Ee("address.postal_code",yt.postal_code||""),Ee("address.country",yt.country||""),Ee("address.latitude",yt.lat),Ee("address.longitude",yt.lng)},children:yt.display_name},pt))}),U&&t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Address selected"}),Te&&rt&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{ref:K,style:{width:"100%",height:200,borderRadius:8,overflow:"hidden",position:"relative"}}),t.jsx("div",{className:"flex justify-end mt-2",children:me?t.jsx("button",{type:"button",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",onClick:()=>Ce(!1),children:"Save Pin Location"}):t.jsx("button",{type:"button",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs",onClick:()=>Ce(!0),children:"Adjust Pin"})})]}),t.jsx("label",{htmlFor:"address.instructions",className:"block text-sm font-medium text-gray-700 mt-4",children:"Access Instructions"}),t.jsx("textarea",{rows:2,...Ae("address.instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate codes, special access requirements, loading dock information..."})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse",children:[t.jsxs("button",{type:"submit",className:"inline-flex w-full justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",disabled:w,children:[w?t.jsx(tr,{className:"animate-spin h-5 w-5 mr-2"}):null,"Save"]}),t.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:d,children:"Cancel"})]})]})})]})}):null},cC=()=>{const{data:c,isLoading:d}=iC();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(3)].map((g,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const f=[{name:"Total Warehouses",value:c.total,icon:Gn,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Total Capacity",value:c.total_capacity.toLocaleString()+" cylinders",icon:Xo,color:"text-green-600",bgColor:"bg-green-50"},{name:"Average Capacity",value:c.average_capacity.toLocaleString()+" cylinders",icon:rc,color:"text-purple-600",bgColor:"bg-purple-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Warehouse Overview"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:f.map(g=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${g.bgColor} mb-2`,children:t.jsx(g.icon,{className:`h-6 w-6 ${g.color}`})}),t.jsx("div",{className:"text-lg font-bold text-gray-900",children:g.value}),t.jsx("div",{className:"text-sm text-gray-600",children:g.name})]},g.name))})]})},uC=()=>{const c=Qr(),[d,f]=le.useState({page:1}),[g,w]=le.useState(!1),[N,T]=le.useState(null),[A,n]=le.useState(null),{data:M,isLoading:z,error:V,refetch:U}=eg(d),G=nC(),W=jb(),$=aC();le.useEffect(()=>{console.log("WarehousesPage state:",{filters:d,data:M,isLoading:z,error:V,isFormOpen:g,editingWarehouse:N})},[d,M,z,V,g,N]);const K=()=>{console.log("Adding new warehouse"),T(null),w(!0)},ue=fe=>{console.log("Editing warehouse:",fe),T(fe),w(!0)},re=fe=>{console.log("Viewing warehouse:",fe),c(`/warehouses/${fe.id}`)},te=fe=>{console.log("Deleting warehouse:",fe),n(fe)},je=async fe=>{console.log("Form submit:",fe);try{N?await W.mutateAsync({id:N.id,...fe}):await G.mutateAsync(fe),w(!1),T(null)}catch(Ie){console.error("Form submit error:",Ie)}},me=async()=>{if(A){console.log("Confirming delete:",A);try{await $.mutateAsync(A.id),n(null)}catch(fe){console.error("Delete error:",fe)}}},Ce=fe=>{console.log("Page change:",fe),f(Ie=>({...Ie,page:fe}))},Ae=()=>{console.log("Refreshing warehouses"),U()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Warehouses"}),t.jsx("p",{className:"text-gray-600",children:"Manage storage facilities and inventory locations"}),V&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",V.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Ae,disabled:z,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${z?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:K,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Warehouse"})]})]})]}),t.jsx(cC,{}),t.jsx(lC,{filters:d,onFiltersChange:f}),t.jsx(oC,{warehouses:(M==null?void 0:M.warehouses)||[],loading:z,onView:re,onEdit:ue,onDelete:te}),M&&M.totalPages>1&&t.jsx(ac,{currentPage:M.currentPage,totalPages:M.totalPages,totalCount:M.totalCount,onPageChange:Ce}),t.jsx(Nb,{isOpen:g,onClose:()=>{console.log("Closing form"),w(!1),T(null)},onSubmit:je,warehouse:N||void 0,loading:G.isPending||W.isPending,title:N?"Edit Warehouse":"Add New Warehouse"}),t.jsx(so,{isOpen:!!A,onClose:()=>n(null),onConfirm:me,title:"Delete Warehouse",message:`Are you sure you want to delete "${A==null?void 0:A.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:$.isPending})]})},dC=(c={})=>_t.inventory.list.useQuery({warehouse_id:c.warehouse_id,product_id:c.product_id,low_stock_only:c.low_stock_only||!1},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Inventory fetch error:",d),It.error("Failed to load inventory")}}),Sb=c=>_t.inventory.getByWarehouse.useQuery({warehouse_id:c},{enabled:!!c,staleTime:3e4,retry:1,onError:d=>{console.error("Warehouse inventory fetch error:",d),It.error("Failed to load warehouse inventory")}}),hC=c=>_t.inventory.getStats.useQuery({warehouse_id:c},{enabled:!0,staleTime:6e4,retry:1,onError:d=>{console.error("Inventory stats fetch error:",d),It.error("Failed to load inventory statistics")}}),mC=()=>{const c=_t.useContext();return _t.inventory.adjustStock.useMutation({onSuccess:d=>{console.log("Stock adjusted successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Stock levels updated successfully")},onError:d=>{console.error("Stock adjustment error:",d),It.error(d.message||"Failed to adjust stock levels")}})},pC=()=>{const c=_t.useContext();return _t.inventory.transferStock.useMutation({onSuccess:d=>{console.log("Stock transferred successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Stock transferred successfully")},onError:d=>{console.error("Stock transfer error:",d),It.error(d.message||"Failed to transfer stock")}})},fC=()=>{const c=_t.useContext();return _t.inventory.create.useMutation({onSuccess:d=>{console.log("Inventory balance created successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),It.success("Inventory balance created successfully")},onError:d=>{console.error("Create inventory error:",d),It.error(d.message||"Failed to create inventory balance")}})},cf={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_URL:"/api/v1/trpc",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRyY3JqaW5yZGpnaXpxaGpkZ3ZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNDE2NTAsImV4cCI6MjA2NDYxNzY1MH0.2-y5r5UzIfcGoHc6BPkRy5rnxWxl4SJwxUehPWBxAao",VITE_SUPABASE_URL:"https://trcrjinrdjgizqhjdgvc.supabase.co"},gC=()=>{var K,ue;const{id:c}=nc(),d=Qr(),[f,g]=le.useState(!1),w=le.useRef(null),[N,T]=le.useState(null),{data:A,isLoading:n,error:M}=rC(c),{data:z=[],isLoading:V}=Sb(c),U=jb(),G=async re=>{if(A)try{await U.mutateAsync({id:A.id,...re}),g(!1)}catch{}},W=re=>new Date(re).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),$=re=>re?re.toLocaleString()+" cylinders":"Not specified";return le.useEffect(()=>{var te,je;if(!((te=A==null?void 0:A.address)!=null&&te.latitude)||!((je=A==null?void 0:A.address)!=null&&je.longitude)||!w.current)return;const re=cf==null?void 0:cf.VITE_MAPBOX_API_KEY;if(!re){console.warn("Mapbox access token not found");return}if(N){try{N.remove()}catch(me){console.warn("Error removing existing map:",me)}T(null)}try{fi.accessToken=re;const me=new fi.Map({container:w.current,style:"mapbox://styles/mapbox/streets-v11",center:[A.address.longitude,A.address.latitude],zoom:14});me.addControl(new fi.NavigationControl,"top-right"),new fi.Marker({anchor:"center"}).setLngLat([A.address.longitude,A.address.latitude]).addTo(me),me.on("load",()=>{try{me.resize()}catch(Ce){console.warn("Error resizing map:",Ce)}}),T(me)}catch(me){console.error("Error initializing map:",me)}},[(K=A==null?void 0:A.address)==null?void 0:K.latitude,(ue=A==null?void 0:A.address)==null?void 0:ue.longitude]),le.useEffect(()=>()=>{if(N){try{N.remove()}catch(re){console.warn("Error cleaning up map:",re)}T(null)}},[N]),n?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]}):M||!A?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Warehouse not found or error loading warehouse details."})})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:A.name})]}),t.jsxs("button",{onClick:()=>g(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ci,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Warehouse"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Warehouse Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Warehouse Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:A.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Storage Capacity"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:$(A.capacity_cylinders)})]})]})]})]}),A.address&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Location"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Physical Address"}),t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Tn,{className:"h-4 w-4 text-gray-400 mt-0.5"}),t.jsxs("div",{className:"text-gray-900",children:[t.jsx("div",{children:A.address.line1}),A.address.line2&&t.jsx("div",{children:A.address.line2}),t.jsxs("div",{children:[A.address.city,A.address.state&&`, ${A.address.state}`,A.address.postal_code&&` ${A.address.postal_code}`]}),t.jsx("div",{children:A.address.country})]})]})]}),A.address.latitude&&A.address.longitude&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-2",children:"Map Location"}),t.jsx("div",{ref:w,className:"w-full h-64 rounded-lg border border-gray-300",style:{minHeight:"256px"}})]}),A.address.instructions&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Access Instructions"}),t.jsx("p",{className:"text-gray-900",children:A.address.instructions})]})]})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Details"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:W(A.created_at)})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Inventory"}),V?t.jsx("div",{className:"flex justify-center py-4",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):z.length>0?t.jsx("div",{className:"space-y-3",children:z.map(re=>{var te,je,me;return t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-900",children:(te=re.product)==null?void 0:te.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",(je=re.product)==null?void 0:je.sku]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm font-medium text-gray-600",children:(me=re.product)==null?void 0:me.unit_of_measure})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center border border-green-200",children:[t.jsx("div",{className:"text-2xl font-bold text-green-700",children:re.qty_full}),t.jsx("div",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Full"})]}),t.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 text-center border border-gray-300",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-700",children:re.qty_empty}),t.jsx("div",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Empty"})]}),t.jsxs("div",{className:`rounded-lg p-3 text-center border ${re.qty_reserved>0?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}`,children:[t.jsx("div",{className:`text-2xl font-bold ${re.qty_reserved>0?"text-yellow-700":"text-blue-700"}`,children:re.qty_reserved}),t.jsx("div",{className:`text-xs font-medium uppercase tracking-wide ${re.qty_reserved>0?"text-yellow-600":"text-blue-600"}`,children:"Reserved"})]})]}),t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-gray-500",children:"Available:"}),t.jsxs("span",{className:"font-semibold text-gray-900",children:[re.qty_full-re.qty_reserved," units"]})]})})]},re.id)})}):t.jsxs("div",{className:"text-center py-4",children:[t.jsx(hs,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"This warehouse has no inventory yet."})]})]})]})]}),t.jsx(Nb,{isOpen:f,onClose:()=>g(!1),onSubmit:G,warehouse:A,loading:U.isPending,title:"Edit Warehouse"})]})},xC=({inventory:c,loading:d=!1,onAdjustStock:f,onTransferStock:g})=>{const w=A=>new Date(A).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=A=>A===0?"text-red-600 bg-red-50":A<=10?"text-yellow-600 bg-yellow-50":"text-green-600 bg-green-50",T=A=>A===0?t.jsx(Us,{className:"h-4 w-4"}):A<=10?t.jsx(Us,{className:"h-4 w-4"}):null;return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading inventory..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No inventory found"}),t.jsx("p",{className:"text-gray-500",children:"No inventory records found for the selected filters."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Inventory (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reserved"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Available"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(A=>{var V,U,G;const n=A.qty_full-A.qty_reserved,M=N(n),z=T(n);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((V=A.product)==null?void 0:V.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((U=A.product)==null?void 0:U.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:((G=A.warehouse)==null?void 0:G.name)||"Unknown Warehouse"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_reserved})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-sm font-medium ${M}`,children:[z,t.jsx("span",{children:n})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:w(A.updated_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>f(A),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Adjust stock",children:t.jsx(ci,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>g(A),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors",title:"Transfer stock",children:t.jsx(x_,{className:"h-4 w-4"})})]})})]},A.id)})})]})})]})},Qh=({value:c,onChange:d,placeholder:f="Select warehouse...",className:g="",required:w=!1})=>{const{data:N,isLoading:T}=tg();return T?t.jsx("div",{className:`relative ${g}`,children:t.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:[t.jsx(Gn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-500",children:"Loading warehouses..."})]})}):t.jsx("div",{className:`relative ${g}`,children:t.jsxs("div",{className:"relative",children:[t.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c||"",onChange:A=>d(A.target.value),required:w,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:f}),N==null?void 0:N.map(A=>t.jsx("option",{value:A.id,children:A.city&&A.state?`${A.name} (${A.city}, ${A.state})`:A.name},A.id))]}),t.jsx(nm,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"})]})})},yC=({filters:c,onFiltersChange:d})=>{const f=T=>{d({...c,search:T.target.value||void 0,page:1})},g=T=>{d({...c,warehouse_id:T||void 0,page:1})},w=()=>{d({...c,low_stock_only:!c.low_stock_only,page:1})},N=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by product SKU or name...",value:c.search||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-64",children:t.jsx(Qh,{value:c.warehouse_id,onChange:g,placeholder:"All Warehouses"})}),t.jsxs("button",{onClick:w,className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${c.low_stock_only?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,title:"Show items with intelligent low stock detection",children:[t.jsx(Us,{className:"h-4 w-4"}),t.jsx("span",{children:"Smart Low Stock"})]}),t.jsxs("button",{onClick:N,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},_C=()=>{const{data:c,isLoading:d}=hC();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[...Array(6)].map((g,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const f=[{name:"Total Cylinders",value:c.total_cylinders.toLocaleString(),icon:hs,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Full Cylinders",value:c.total_full.toLocaleString(),icon:$n,color:"text-green-600",bgColor:"bg-green-50"},{name:"Empty Cylinders",value:c.total_empty.toLocaleString(),icon:ZN,color:"text-gray-600",bgColor:"bg-gray-50"},{name:"Reserved",value:c.total_reserved.toLocaleString(),icon:JN,color:"text-orange-600",bgColor:"bg-orange-50"},{name:"Available",value:c.total_available.toLocaleString(),icon:Ji,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"Low Stock Items",value:c.low_stock_products.toLocaleString(),icon:Us,color:"text-red-600",bgColor:"bg-red-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Inventory Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:f.map(g=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${g.bgColor} mb-2`,children:t.jsx(g.icon,{className:`h-6 w-6 ${g.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.value}),t.jsx("div",{className:"text-sm text-gray-600",children:g.name})]},g.name))})]})},bC=({isOpen:c,onClose:d,onSubmit:f,inventory:g,loading:w=!1})=>{var K,ue;const{register:N,handleSubmit:T,reset:A,watch:n,formState:{errors:M}}=En({defaultValues:{inventory_id:g.id,adjustment_type:"physical_count",qty_full_change:0,qty_empty_change:0,reason:""}}),z=n("qty_full_change")||0,V=n("qty_empty_change")||0,U=async re=>{try{const te=await _t.inventory.validateAdjustment.mutate({inventory_id:re.inventory_id,qty_full_change:re.qty_full_change,qty_empty_change:re.qty_empty_change,adjustment_type:re.adjustment_type});return te.valid?(te.warnings.length>0&&console.warn("Stock adjustment warnings:",te.warnings),!0):te.errors[0]||"Stock adjustment validation failed"}catch(te){return console.error("Stock adjustment validation error:",te),"Failed to validate stock adjustment"}};le.useEffect(()=>{g&&A({inventory_id:g.id,adjustment_type:"physical_count",qty_full_change:0,qty_empty_change:0,reason:""})},[g,A]);const G=async re=>{try{if(await U({inventory_id:re.inventory_id,qty_full_change:re.qty_full_change,qty_empty_change:re.qty_empty_change,adjustment_type:re.adjustment_type})!==!0)return;f(re)}catch(te){console.error("Form validation error:",te)}},W=g.qty_full+z,$=g.qty_empty+V;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:T(G),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Adjust Stock"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Current Stock Levels"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.qty_full}),t.jsx("div",{className:"text-sm text-gray-600",children:"Full Cylinders"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-600",children:g.qty_empty}),t.jsx("div",{className:"text-sm text-gray-600",children:"Empty Cylinders"})]})]}),t.jsxs("div",{className:"mt-3 text-center",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Product: ",t.jsx("span",{className:"font-medium",children:(K=g.product)==null?void 0:K.name})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Warehouse: ",t.jsx("span",{className:"font-medium",children:(ue=g.warehouse)==null?void 0:ue.name})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"adjustment_type",className:"block text-sm font-medium text-gray-700",children:"Adjustment Type *"}),t.jsxs("select",{id:"adjustment_type",...N("adjustment_type",{required:"Adjustment type is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"received_full",children:"Received Full Cylinders"}),t.jsx("option",{value:"received_empty",children:"Received Empty Cylinders"}),t.jsx("option",{value:"physical_count",children:"Physical Count Adjustment"}),t.jsx("option",{value:"damage_loss",children:"Damage/Loss"}),t.jsx("option",{value:"other",children:"Other"})]}),M.adjustment_type&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.adjustment_type.message})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_full_change",className:"block text-sm font-medium text-gray-700",children:"Full Cylinders Change"}),t.jsx("input",{type:"number",id:"qty_full_change",...N("qty_full_change",{valueAsNumber:!0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),M.qty_full_change&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.qty_full_change.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_empty_change",className:"block text-sm font-medium text-gray-700",children:"Empty Cylinders Change"}),t.jsx("input",{type:"number",id:"qty_empty_change",...N("qty_empty_change",{valueAsNumber:!0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),M.qty_empty_change&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.qty_empty_change.message})]})]}),(z!==0||V!==0)&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"Resulting Stock Levels"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:W}),z>0&&t.jsx(Ji,{className:"h-4 w-4 text-green-600"}),z<0&&t.jsx(Wy,{className:"h-4 w-4 text-red-600"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Full Cylinders"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:$}),V>0&&t.jsx(Ji,{className:"h-4 w-4 text-green-600"}),V<0&&t.jsx(Wy,{className:"h-4 w-4 text-red-600"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Empty Cylinders"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700",children:"Reason/Notes *"}),t.jsx("textarea",{id:"reason",rows:3,...N("reason",{required:"Reason is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Explain the reason for this stock adjustment..."}),M.reason&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.reason.message})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Adjusting..."})]}):"Adjust Stock"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},vC=({isOpen:c,onClose:d,onSubmit:f,inventory:g,loading:w=!1})=>{var K,ue,re;const{register:N,handleSubmit:T,reset:A,watch:n,setValue:M,formState:{errors:z}}=En({defaultValues:{from_warehouse_id:g.warehouse_id,to_warehouse_id:"",product_id:g.product_id,qty_full:0,qty_empty:0,notes:""}}),V=n("qty_full")||0,U=n("qty_empty")||0,G=n("to_warehouse_id");le.useEffect(()=>{g&&A({from_warehouse_id:g.warehouse_id,to_warehouse_id:"",product_id:g.product_id,qty_full:0,qty_empty:0,notes:""})},[g,A]);const W=te=>{f(te)},$=te=>{M("to_warehouse_id",te)};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:T(W),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Transfer Stock"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Product Information"}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Product:"})," ",(K=g.product)==null?void 0:K.name]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"SKU:"})," ",(ue=g.product)==null?void 0:ue.sku]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"From Warehouse"}),t.jsx("div",{className:"text-sm text-blue-800 font-medium",children:(re=g.warehouse)==null?void 0:re.name}),t.jsxs("div",{className:"mt-2 space-y-1 text-xs text-blue-700",children:[t.jsxs("div",{children:["Full: ",g.qty_full]}),t.jsxs("div",{children:["Empty: ",g.qty_empty]})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(VN,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"To Warehouse"}),t.jsx(Qh,{value:G,onChange:$,placeholder:"Select destination...",className:"w-full",required:!0}),z.to_warehouse_id&&t.jsx("p",{className:"mt-1 text-xs text-red-600",children:"Destination warehouse is required"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Transfer Quantities"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_full",className:"block text-sm font-medium text-gray-700",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",max:g.qty_full,id:"qty_full",...N("qty_full",{valueAsNumber:!0,min:{value:0,message:"Quantity must be positive"},max:{value:g.qty_full,message:`Cannot exceed available quantity (${g.qty_full})`}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Available: ",g.qty_full]}),z.qty_full&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.qty_full.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_empty",className:"block text-sm font-medium text-gray-700",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",max:g.qty_empty,id:"qty_empty",...N("qty_empty",{valueAsNumber:!0,min:{value:0,message:"Quantity must be positive"},max:{value:g.qty_empty,message:`Cannot exceed available quantity (${g.qty_empty})`}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Available: ",g.qty_empty]}),z.qty_empty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.qty_empty.message})]})]}),(V>0||U>0)&&t.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsxs("div",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Transfer Summary:"})," ",V," full + ",U," empty cylinders"]})})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Transfer Notes"}),t.jsx("textarea",{id:"notes",rows:3,...N("notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional notes about this transfer..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w||!G||V===0&&U===0,className:"inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Transferring..."})]}):"Transfer Stock"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},wC=()=>{const[c,d]=le.useState({page:1}),[f,g]=le.useState(null),[w,N]=le.useState(null),[T,A]=le.useState(!1),{data:n,isLoading:M,error:z,refetch:V}=dC(c),{data:U}=cc({limit:1e3}),{data:G}=eg({limit:1e3}),W=mC(),$=pC(),K=fC(),ue=(U==null?void 0:U.products)||[],re=(G==null?void 0:G.warehouses)||[];le.useEffect(()=>{console.log("InventoryPage state:",{filters:c,data:n,isLoading:M,error:z,adjustingInventory:f,transferringInventory:w})},[c,n,M,z,f,w]);const te=tt=>{console.log("Adjusting stock for:",tt),g(tt)},je=tt=>{console.log("Transferring stock for:",tt),N(tt)},me=()=>{console.log("Adding new stock"),A(!0)},Ce=async tt=>{console.log("Adjustment submit:",tt);try{await W.mutateAsync(tt),g(null)}catch(Pe){console.error("Adjustment error:",Pe)}},Ae=async tt=>{console.log("Transfer submit:",tt);try{await $.mutateAsync(tt),N(null)}catch(Pe){console.error("Transfer error:",Pe)}},fe=async tt=>{console.log("Add stock submit:",tt);try{await K.mutateAsync(tt),A(!1)}catch(Pe){console.error("Add stock error:",Pe)}},Ie=tt=>{console.log("Page change:",tt),d(Pe=>({...Pe,page:tt}))},Ee=()=>{console.log("Refreshing inventory"),V()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),t.jsx("p",{className:"text-gray-600",children:"Track stock levels across all warehouses"}),z&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",z.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Ee,disabled:M,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${M?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:me,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",title:"Add new inventory record",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Stock"})]})]})]}),t.jsx(_C,{}),t.jsx(yC,{filters:c,onFiltersChange:d}),t.jsx(xC,{inventory:(n==null?void 0:n.inventory)||[],loading:M,onAdjustStock:te,onTransferStock:je}),n&&n.totalPages>1&&t.jsx(ac,{currentPage:n.currentPage,totalPages:n.totalPages,totalCount:n.totalCount,onPageChange:Ie}),f&&t.jsx(bC,{isOpen:!!f,onClose:()=>g(null),onSubmit:Ce,inventory:f,loading:W.isPending}),w&&t.jsx(vC,{isOpen:!!w,onClose:()=>N(null),onSubmit:Ae,inventory:w,loading:$.isPending}),T&&t.jsx(jC,{isOpen:T,onClose:()=>A(!1),onSubmit:fe,products:ue,warehouses:re,loading:K.isPending})]})},jC=({isOpen:c,onClose:d,onSubmit:f,products:g,warehouses:w,loading:N=!1})=>{const[T,A]=le.useState({warehouse_id:"",product_id:"",qty_full:0,qty_empty:0,qty_reserved:0}),n=z=>{z.preventDefault(),T.warehouse_id&&T.product_id&&f(T)},M=(z,V)=>{A(U=>({...U,[z]:V}))};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:n,children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Add New Stock Record"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(wr,{className:"h-6 w-6 rotate-45"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warehouse *"}),t.jsxs("select",{value:T.warehouse_id,onChange:z=>M("warehouse_id",z.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select a warehouse..."}),w.map(z=>t.jsx("option",{value:z.id,children:z.name},z.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product *"}),t.jsxs("select",{value:T.product_id,onChange:z=>M("product_id",z.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select a product..."}),g.filter(z=>z.status==="active").map(z=>t.jsxs("option",{value:z.id,children:[z.name," (",z.sku,")"]},z.id))]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:T.qty_full,onChange:z=>M("qty_full",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:T.qty_empty,onChange:z=>M("qty_empty",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reserved Cylinders"}),t.jsx("input",{type:"number",min:"0",max:T.qty_full,value:T.qty_reserved,onChange:z=>M("qty_reserved",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Cannot exceed full cylinders quantity"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||!T.warehouse_id||!T.product_id,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Adding...":"Add Stock Record"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},NC=({priceLists:c,loading:d=!1,onView:f,onEdit:g,onDuplicate:w,onSetDefault:N,onDelete:T})=>{const A=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading price lists..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(Sn,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No price lists found"}),t.jsx("p",{className:"text-gray-500",children:"Get started by creating your first price list."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Price Lists (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price List"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Currency"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Range"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Products"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(n=>{const M=n.statusInfo||{status:"active",label:"Active",color:"bg-green-100 text-green-800 border-green-200"},z=n.isExpiringSoon||!1;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>f(n),className:"text-sm font-medium text-blue-600 hover:text-blue-900 hover:underline",children:n.name}),n.is_default&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx(Gh,{className:"h-3 w-3 mr-1"}),"Default"]}),z&&t.jsx(Us,{className:"h-4 w-4 text-yellow-500",title:"Expiring soon"})]}),n.description&&t.jsx("div",{className:"text-sm text-gray-500 mt-1 max-w-xs truncate",children:n.description})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900 font-mono",children:n.currency_code})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("div",{className:"text-sm text-gray-900",children:wb(n.start_date,n.end_date)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${M.color}`,children:M.label})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.product_count||0})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:A(n.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(n),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit price list",children:t.jsx(ci,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>w(n),className:"text-purple-600 hover:text-purple-900 p-1 rounded hover:bg-purple-50 transition-colors",title:"Duplicate price list",children:t.jsx(WN,{className:"h-4 w-4"})}),!n.is_default&&t.jsx("button",{onClick:()=>N(n),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors",title:"Set as default",children:t.jsx(Gh,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>T(n),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete price list",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},n.id)})})]})})]})},SC=({filters:c,onFiltersChange:d})=>{const f=N=>{d({...c,search:N.target.value||void 0,page:1})},g=N=>{d({...c,status:N.target.value||void 0,page:1})},w=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name or description...",value:c.search||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-32",children:t.jsxs("div",{className:"relative",children:[t.jsx($s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"future",children:"Future"}),t.jsx("option",{value:"expired",children:"Expired"})]})]})}),t.jsxs("button",{onClick:w,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},Tb=({isOpen:c,onClose:d,onSubmit:f,priceList:g,loading:w=!1,title:N})=>{const{register:T,handleSubmit:A,reset:n,watch:M,formState:{errors:z}}=En({defaultValues:{name:"",description:"",currency_code:"KES",start_date:new Date().toISOString().split("T")[0],end_date:"",is_default:!1}}),V=M("start_date"),U=M("end_date"),G=M("is_default");le.useEffect(()=>{n(g?{name:g.name,description:g.description||"",currency_code:"KES",start_date:g.start_date,end_date:g.end_date||"",is_default:g.is_default}:{name:"",description:"",currency_code:"KES",start_date:new Date().toISOString().split("T")[0],end_date:"",is_default:!1})},[g,n]);const W=K=>{const ue={...K,currency_code:"KES",end_date:K.end_date||void 0,description:K.description||void 0};f(ue)},$=!U||YE(V,U);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(W),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Price List Name *"}),t.jsx("input",{type:"text",id:"name",...T("name",{required:"Price list name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Standard 2025"}),z.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...T("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional description of this price list..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"currency_code",className:"block text-sm font-medium text-gray-700",children:"Currency"}),t.jsx("div",{className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm bg-gray-50",children:t.jsx("span",{className:"text-gray-900",children:"KES - Kenyan Shilling (KSh)"})}),t.jsx("input",{type:"hidden",...T("currency_code"),value:"KES"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:"Start Date *"}),t.jsx("input",{type:"date",id:"start_date",...T("start_date",{required:"Start date is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.start_date&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.start_date.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:"End Date"}),t.jsx("input",{type:"date",id:"end_date",...T("end_date"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave empty for no end date"})]})]}),!$&&t.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:"End date must be after start date"})]})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"is_default",...T("is_default"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"is_default",className:"ml-2 block text-sm text-gray-900",children:"Set as default price list"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Only one price list can be set as default at a time"}),G&&t.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsx("p",{className:"text-xs text-yellow-800",children:"Setting this as default will unset any existing default price list"})})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w||!$,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Price List"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},TC=()=>{const{data:c,isLoading:d}=QE();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[...Array(6)].map((g,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const f=[{name:"Total Price Lists",value:c.total_price_lists,icon:Sn,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Active",value:c.active_price_lists,icon:$n,color:"text-green-600",bgColor:"bg-green-50"},{name:"Future",value:c.future_price_lists,icon:Qi,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Expired",value:c.expired_price_lists,icon:pa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Expiring Soon",value:c.expiring_soon,icon:Us,color:"text-yellow-600",bgColor:"bg-yellow-50"},{name:"No Pricing",value:c.products_without_pricing,icon:hs,color:"text-gray-600",bgColor:"bg-gray-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Pricing Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:f.map(g=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${g.bgColor} mb-2`,children:t.jsx(g.icon,{className:`h-6 w-6 ${g.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.value}),t.jsx("div",{className:"text-sm text-gray-600",children:g.name})]},g.name))})]})},EC=()=>{const c=Qr(),[d,f]=le.useState({page:1}),[g,w]=le.useState(!1),[N,T]=le.useState(null),[A,n]=le.useState(null),{data:M,isLoading:z,error:V,refetch:U}=Yf(d),G=KE(),W=_b();le.useEffect(()=>{console.log("PricingPage state:",{filters:d,data:M,isLoading:z,error:V,isFormOpen:g,editingPriceList:N})},[d,M,z,V,g,N]);const $=()=>{console.log("Adding new price list"),T(null),w(!0)},K=Ie=>{console.log("Editing price list:",Ie),T(Ie),w(!0)},ue=Ie=>{console.log("Viewing price list:",Ie),c(`/pricing/${Ie.id}`)},re=Ie=>{console.log("Duplicating price list:",Ie),T({...Ie,id:"",name:`Copy of ${Ie.name}`,is_default:!1}),w(!0)},te=async Ie=>{console.log("Setting default price list:",Ie),alert("Set default price list functionality is temporarily disabled")},je=Ie=>{console.log("Deleting price list:",Ie),n(Ie)},me=async Ie=>{console.log("Form submit:",Ie);try{N!=null&&N.id?await W.mutateAsync({id:N.id,...Ie}):await G.mutateAsync(Ie),w(!1),T(null)}catch(Ee){console.error("Form submit error:",Ee)}},Ce=async()=>{A&&(console.log("Confirming delete:",A),alert("Delete price list functionality is temporarily disabled"),n(null))},Ae=Ie=>{console.log("Page change:",Ie),f(Ee=>({...Ee,page:Ie}))},fe=()=>{console.log("Refreshing price lists"),U()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Price Catalog"}),t.jsx("p",{className:"text-gray-600",children:"Manage pricing for your products across different markets"}),V&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",V.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:fe,disabled:z,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${z?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:$,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Create Price List"})]})]})]}),t.jsx(TC,{}),t.jsx(SC,{filters:d,onFiltersChange:f}),t.jsx(NC,{priceLists:(M==null?void 0:M.priceLists)||[],loading:z,onView:ue,onEdit:K,onDuplicate:re,onSetDefault:te,onDelete:je}),M&&M.totalPages>1&&t.jsx(ac,{currentPage:M.currentPage,totalPages:M.totalPages,totalCount:M.totalCount,onPageChange:Ae}),t.jsx(Tb,{isOpen:g,onClose:()=>{console.log("Closing form"),w(!1),T(null)},onSubmit:me,priceList:N||void 0,loading:G.isPending||W.isPending,title:N!=null&&N.id?"Edit Price List":"Create New Price List"}),t.jsx(so,{isOpen:!!A,onClose:()=>n(null),onConfirm:Ce,title:"Delete Price List",message:`Are you sure you want to delete "${A==null?void 0:A.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:!1})]})},CC=({isOpen:c,onClose:d,onSubmit:f,priceList:g,loading:w=!1})=>{const[N,T]=le.useState([]),[A,n]=le.useState({}),[M,z]=le.useState(""),{data:V}=cc({limit:1e3}),{data:U=[]}=bb(g.id),G=(V==null?void 0:V.products)||[],W=U.map(je=>je.product_id),$=G.filter(je=>je.status==="active"&&!W.includes(je.id)&&(M===""||je.name.toLowerCase().includes(M.toLowerCase())||je.sku.toLowerCase().includes(M.toLowerCase())));le.useEffect(()=>{c||(T([]),n({}),z(""))},[c]);const K=(je,me)=>{if(me){const Ce=$.find(Ae=>Ae.id===je);Ce&&(T(Ae=>[...Ae,je]),n(Ae=>({...Ae,[je]:{productId:je,productName:Ce.name,productSku:Ce.sku,unitPrice:0,minQty:1,surchargeRate:void 0}})))}else T(Ce=>Ce.filter(Ae=>Ae!==je)),n(Ce=>{const Ae={...Ce};return delete Ae[je],Ae})},ue=(je,me,Ce)=>{n(Ae=>({...Ae,[je]:{...Ae[je],[me]:Ce}}))},re=()=>{const je=Object.values(A).filter(me=>me.unitPrice>0);je.length!==0&&f(je)},te=N.length>0&&N.every(je=>{var me;return((me=A[je])==null?void 0:me.unitPrice)>0});return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:["Add Products to: ",g.name]}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search products by name or SKU...",value:M,onChange:je=>z(je.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:["Select Products (",$.length," available)"]}),t.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:$.length>0?t.jsx("div",{className:"divide-y divide-gray-200",children:$.map(je=>t.jsx("div",{className:"p-3 hover:bg-gray-50",children:t.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:N.includes(je.id),onChange:me=>K(je.id,me.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:je.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",je.sku,"  ",je.unit_of_measure,je.capacity_kg&&`  ${je.capacity_kg}kg`]})]})]})},je.id))}):t.jsxs("div",{className:"p-8 text-center",children:[t.jsx(hs,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500",children:M?"No products found matching your search.":"All products are already in this price list."})]})})]}),N.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Set Prices for Selected Products"}),t.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:N.map(je=>{const me=A[je];return me?t.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gray-50",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("h5",{className:"font-medium text-gray-900",children:me.productName}),t.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",me.productSku]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Unit Price (",g.currency_code,") *"]}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:me.unitPrice||"",onChange:Ce=>ue(je,"unitPrice",parseFloat(Ce.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Quantity"}),t.jsx("input",{type:"number",min:"1",value:me.minQty,onChange:Ce=>ue(je,"minQty",parseInt(Ce.target.value)||1),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Surcharge (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:me.surchargeRate||"",onChange:Ce=>ue(je,"surchargeRate",parseFloat(Ce.target.value)||void 0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"})]})]}),me.unitPrice>0&&t.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded",children:t.jsxs("span",{className:"text-sm text-blue-800",children:["Final Price: ",ls(id(me.unitPrice,me.surchargeRate),g.currency_code)]})})]},je):null})})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:re,disabled:w||!te,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Adding..."})]}):`Add ${N.length} Product${N.length!==1?"s":""}`}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]})}):null},kC=({isOpen:c,onClose:d,onSubmit:f,item:g,currencyCode:w,loading:N=!1})=>{var $,K;const{register:T,handleSubmit:A,reset:n,watch:M,formState:{errors:z}}=En({defaultValues:{unit_price:g.unit_price,min_qty:g.min_qty,surcharge_pct:g.surcharge_pct||void 0}}),V=M("unit_price"),U=M("surcharge_pct");le.useEffect(()=>{g&&n({unit_price:g.unit_price,min_qty:g.min_qty,surcharge_pct:g.surcharge_pct||void 0})},[g,n]);const G=ue=>{f({unit_price:ue.unit_price,min_qty:ue.min_qty,surcharge_pct:ue.surcharge_pct||null})},W=()=>id(V||0);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(G),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Edit Product Price"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:($=g.product)==null?void 0:$.name}),t.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",(K=g.product)==null?void 0:K.sku]})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700",children:["Unit Price (",w,") *"]}),t.jsx("input",{type:"number",min:"0",step:"0.01",id:"unit_price",...T("unit_price",{required:"Unit price is required",min:{value:.01,message:"Price must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.unit_price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.unit_price.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"min_qty",className:"block text-sm font-medium text-gray-700",children:"Minimum Quantity"}),t.jsx("input",{type:"number",min:"1",id:"min_qty",...T("min_qty",{required:"Minimum quantity is required",min:{value:1,message:"Minimum quantity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.min_qty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.min_qty.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"surcharge_pct",className:"block text-sm font-medium text-gray-700",children:"Surcharge Percentage (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",id:"surcharge_pct",...T("surcharge_pct",{min:{value:0,message:"Surcharge cannot be negative"},max:{value:100,message:"Surcharge cannot exceed 100%"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"}),z.surcharge_pct&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.surcharge_pct.message})]}),V>0&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Final Price:"}),t.jsx("span",{className:"text-lg font-bold text-blue-900",children:ls(W(),w)})]}),U&&U>0&&t.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Base: ",ls(V,w)," + ",U,"% surcharge"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Changes"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},AC=()=>{var Ee;const{id:c}=nc(),d=Qr(),[f,g]=le.useState(!1),[w,N]=le.useState(!1),[T,A]=le.useState(null),[n,M]=le.useState(null),{data:z,isLoading:V,error:U}=XE(c),{data:G=[],refetch:W}=bb(c),$=_b(),K=vb(),ue=async tt=>{if(z)try{await $.mutateAsync({id:z.id,...tt}),g(!1)}catch{}},re=async tt=>{try{for(const Pe of tt)await K.mutateAsync({price_list_id:c,product_id:Pe.productId,unit_price:Pe.unitPrice,min_qty:Pe.minQty||1,surcharge_pct:Pe.surchargeRate||void 0});N(!1),W()}catch{}},te=tt=>{A(tt)},je=async tt=>{T&&(alert("Update price list item functionality is temporarily disabled"),A(null))},me=tt=>{M(tt)},Ce=async()=>{n&&(alert("Delete price list item functionality is temporarily disabled"),M(null))},Ae=tt=>new Date(tt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),fe=(tt,Pe)=>id(tt);if(V)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(U||!z)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Price list not found or error loading details."})})})]});const Ie=Pf(z.start_date,z.end_date);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:z.name})]}),t.jsxs("button",{onClick:()=>g(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ci,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Price List"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Price List Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Sn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:z.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Currency"}),t.jsx("span",{className:"text-gray-900 font-mono",children:z.currency_code})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Ie.color}`,children:Ie.label})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Date Range"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:wb(z.start_date,z.end_date)})]})]}),z.description&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),t.jsx("p",{className:"text-gray-900",children:z.description})]})]})]})}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:Ae(z.created_at)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Products"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsxs("span",{className:"text-sm text-gray-900",children:[G.length," products"]})]})]})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Products in this Price List (",G.length,")"]}),t.jsxs("button",{onClick:()=>N(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Products"})]})]}),G.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Min Qty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Surcharge"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:G.map(tt=>{var Pe,Te;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((Pe=tt.product)==null?void 0:Pe.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((Te=tt.product)==null?void 0:Te.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(tt.unit_price,z.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:tt.min_qty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:tt.surcharge_pct?`${tt.surcharge_pct}%`:"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(fe(tt.unit_price,tt.surcharge_pct),z.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>te(tt),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit price",children:t.jsx(ci,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>me(tt),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Remove from list",children:t.jsx(to,{className:"h-4 w-4"})})]})})]},tt.id)})})]})}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products added yet"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"Add products to this price list to set their pricing."}),t.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Products"})]})]})]}),t.jsx(Tb,{isOpen:f,onClose:()=>g(!1),onSubmit:ue,priceList:z,loading:$.isPending,title:"Edit Price List"}),t.jsx(CC,{isOpen:w,onClose:()=>N(!1),onSubmit:re,priceList:z,loading:K.isPending}),T&&t.jsx(kC,{isOpen:!!T,onClose:()=>A(null),onSubmit:je,item:T,currencyCode:z.currency_code,loading:!1}),t.jsx(so,{isOpen:!!n,onClose:()=>M(null),onConfirm:Ce,title:"Remove Product",message:`Are you sure you want to remove "${(Ee=n==null?void 0:n.product)==null?void 0:Ee.name}" from this price list?`,confirmText:"Remove",type:"danger",loading:!1})]})},Eb=(c={})=>_t.orders.list.useQuery({status:c.status,customer_id:c.customer_id,search:c.search,order_date_from:c.order_date_from,order_date_to:c.order_date_to,scheduled_date_from:c.scheduled_date_from,scheduled_date_to:c.scheduled_date_to,include_analytics:c.include_analytics||!1,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Orders fetch error:",d),It.error("Failed to load orders")}}),MC=c=>_t.orders.getById.useQuery({order_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Order fetch error:",d),It.error("Failed to load order details")}}),PC=()=>{const c=_t.useContext();return _t.orders.create.useMutation({onSuccess:d=>{console.log("Order created successfully:",d),c.orders.list.invalidate(),It.success("Order created successfully")},onError:d=>{console.error("Create order error:",d),It.error(d.message||"Failed to create order")}})},Cb=()=>{const c=_t.useContext();return _t.orders.updateStatus.useMutation({onSuccess:d=>{console.log("Order status updated successfully:",d),c.orders.list.invalidate(),c.orders.getById.invalidate({order_id:d.id}),It.success("Order status updated successfully")},onError:d=>{console.error("Update order status error:",d),It.error(d.message||"Failed to update order status")}})},IC=()=>{const c=_t.useContext();return _t.orders.updateTax.useMutation({onSuccess:(d,f)=>{console.log("Order tax updated:",d),c.orders.getById.invalidate({order_id:f.order_id}),c.orders.list.invalidate(),It.success("Order tax updated successfully")},onError:d=>{console.error("Update tax error:",d),It.error(d.message||"Failed to update order tax")}})},DC=({orders:c,loading:d=!1,onView:f,onEdit:g,onChangeStatus:w,selectedOrders:N=[],onSelectionChange:T})=>{const[A,n]=le.useState(!1),M=$=>new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),z=$=>{switch($){case"draft":return"bg-gray-100 text-gray-800 border-gray-300";case"confirmed":return"bg-blue-100 text-blue-800 border-blue-300";case"scheduled":return"bg-purple-100 text-purple-800 border-purple-300";case"en_route":return"bg-orange-100 text-orange-800 border-orange-300";case"delivered":return"bg-green-100 text-green-800 border-green-300";case"invoiced":return"bg-teal-100 text-teal-800 border-teal-300";case"cancelled":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},V=$=>`ORD-${$.substring(0,8).toUpperCase()}`,U=$=>{const K=[];switch($.status){case"draft":K.push({label:"Confirm",action:()=>w($,"confirmed"),icon:hs,color:"text-blue-600 hover:text-blue-900"});break;case"confirmed":K.push({label:"Schedule",action:()=>w($,"scheduled"),icon:$s,color:"text-purple-600 hover:text-purple-900"});break;case"scheduled":K.push({label:"En Route",action:()=>w($,"en_route"),icon:yr,color:"text-orange-600 hover:text-orange-900"});break;case"en_route":K.push({label:"Delivered",action:()=>w($,"delivered"),icon:hs,color:"text-green-600 hover:text-green-900"});break;case"delivered":K.push({label:"Invoice",action:()=>w($,"invoiced"),icon:S_,color:"text-teal-600 hover:text-teal-900"});break}return["draft","confirmed","scheduled"].includes($.status)&&K.push({label:"Cancel",action:()=>w($,"cancelled"),icon:pa,color:"text-red-600 hover:text-red-900"}),K},G=$=>{n($),T&&T($?c.map(K=>K.id):[])},W=($,K)=>{if(T){const ue=K?[...N,$]:N.filter(re=>re!==$);T(ue),n(ue.length===c.length)}};return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading orders..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(sc,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No orders found"}),t.jsx("p",{className:"text-gray-500",children:"Get started by creating your first order."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Orders (",c.length,")"]}),N.length>0&&t.jsxs("span",{className:"text-sm text-blue-600",children:[N.length," selected"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[T&&t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:A,onChange:$=>G($.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delivery Address"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dates"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map($=>{var ue,re,te,je;const K=U($);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[T&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",checked:N.includes($.id),onChange:me=>W($.id,me.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("button",{onClick:()=>f($),className:"text-sm font-medium text-blue-600 hover:text-blue-900",children:V($.id)}),t.jsxs("div",{className:"text-sm text-gray-500",children:[((ue=$.order_lines)==null?void 0:ue.length)||0," item",(((re=$.order_lines)==null?void 0:re.length)||0)!==1?"s":""]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((te=$.customer)==null?void 0:te.name)||"Unknown Customer"}),((je=$.customer)==null?void 0:je.email)&&t.jsx("div",{className:"text-sm text-gray-500",children:$.customer.email})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:$.delivery_address?t.jsxs(t.Fragment,{children:[t.jsx("div",{children:$.delivery_address.city}),$.delivery_address.state&&t.jsx("div",{className:"text-gray-500",children:$.delivery_address.state})]}):"No address"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsxs("div",{children:["Order: ",M($.order_date)]}),$.scheduled_date&&t.jsxs("div",{className:"text-gray-500",children:["Scheduled: ",M($.scheduled_date)]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${z($.status)}`,children:$.status.replace("_"," ").toUpperCase()})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:$.total_amount?ls($.total_amount):"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>f($),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View order",children:t.jsx(am,{className:"h-4 w-4"})}),["draft","confirmed"].includes($.status)&&t.jsx("button",{onClick:()=>g($),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit order",children:t.jsx(ci,{className:"h-4 w-4"})}),K.slice(0,2).map((me,Ce)=>t.jsx("button",{onClick:me.action,className:`p-1 rounded hover:bg-gray-50 transition-colors ${me.color}`,title:me.label,children:t.jsx(me.icon,{className:"h-4 w-4"})},Ce))]})})]},$.id)})})]})})]})},LC=({filters:c,onFiltersChange:d,savedFilters:f=[],onSaveFilter:g,onLoadFilter:w})=>{const[N,T]=le.useState(!1),[A,n]=le.useState(!1),[M,z]=le.useState(""),V=te=>{d({...c,search:te.target.value||void 0,page:1})},U=te=>{d({...c,status:te.target.value||void 0,page:1})},G=(te,je)=>{d({...c,[te]:je||void 0,page:1})},W=(te,je)=>{d({...c,[te]:je?parseFloat(je):void 0,page:1})},$=te=>{d({...c,delivery_area:te.target.value||void 0,page:1})},K=()=>{d({page:1})},ue=()=>{M.trim()&&g&&(g(M.trim(),c),n(!1),z(""))},re=[{name:"Today's Deliveries",filters:{scheduled_date_from:new Date().toISOString().split("T")[0],scheduled_date_to:new Date().toISOString().split("T")[0]}},{name:"Overdue Orders",filters:{is_overdue:!0}},{name:"Draft Orders",filters:{status:"draft"}},{name:"High Value Orders",filters:{amount_min:1e3}},{name:"This Week",filters:{order_date_from:new Date(Date.now()-7*864e5).toISOString().split("T")[0]}},{name:"Payment Overdue",filters:{payment_status:"overdue"}}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6 space-y-4",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by order ID, customer name, or product SKU...",value:c.search||"",onChange:V,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:U,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"confirmed",children:"Confirmed"}),t.jsx("option",{value:"scheduled",children:"Scheduled"}),t.jsx("option",{value:"en_route",children:"En Route"}),t.jsx("option",{value:"delivered",children:"Delivered"}),t.jsx("option",{value:"invoiced",children:"Invoiced"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})}),t.jsxs("button",{onClick:()=>T(!N),className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${N?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[t.jsx(Qu,{className:"h-4 w-4"}),t.jsx("span",{children:"Advanced"})]}),t.jsxs("button",{onClick:K,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(Ya,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:re.map(te=>t.jsx("button",{onClick:()=>d({...te.filters,page:1}),className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors",children:te.name},te.name))}),f.length>0&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gh,{className:"h-4 w-4 text-yellow-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Saved Filters:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(te=>t.jsx("button",{onClick:()=>w==null?void 0:w(te),className:"px-3 py-1 text-sm bg-yellow-100 text-yellow-800 rounded-full hover:bg-yellow-200 transition-colors",children:te.name},te.id))})]}),N&&t.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Date From"}),t.jsxs("div",{className:"relative",children:[t.jsx($s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:c.order_date_from||"",onChange:te=>G("order_date_from",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Date To"}),t.jsx("input",{type:"date",value:c.order_date_to||"",onChange:te=>G("order_date_to",te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled From"}),t.jsxs("div",{className:"relative",children:[t.jsx($s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:c.scheduled_date_from||"",onChange:te=>G("scheduled_date_from",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled To"}),t.jsx("input",{type:"date",value:c.scheduled_date_to||"",onChange:te=>G("scheduled_date_to",te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx(Sn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:c.amount_min||"",onChange:te=>W("amount_min",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx(Sn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:c.amount_max||"",onChange:te=>W("amount_max",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Area"}),t.jsxs("div",{className:"relative",children:[t.jsx(Tn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:c.delivery_area||"",onChange:$,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"City or region"})]})]})]}),g&&t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{onClick:()=>n(!0),className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(T_,{className:"h-4 w-4"}),t.jsx("span",{children:"Save Filter"})]})})]}),A&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>n(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Save Filter"}),t.jsx("button",{onClick:()=>n(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(Ya,{className:"h-6 w-6"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter Name"}),t.jsx("input",{type:"text",value:M,onChange:te=>z(te.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter a name for this filter..."})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:ue,disabled:!M.trim(),className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Save Filter"}),t.jsx("button",{onClick:()=>n(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})})]})},RC=(c,d)=>_t.analytics.getComprehensiveOrderAnalytics.useQuery({start_date:c,end_date:d},{enabled:!!c&&!!d,staleTime:6e4,retry:1,onError:f=>{console.error("Comprehensive order analytics error:",f),It.error("Failed to load order analytics")}}),zC=(c="month")=>_t.analytics.getOrderStats.useQuery({period:c},{staleTime:6e4,retry:1,refetchInterval:5*60*1e3,onError:d=>{console.error("Order stats error:",d),It.error("Failed to load order statistics")}}),OC=()=>{const{data:c,isLoading:d}=zC();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[...Array(10)].map((g,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const f=[{name:"Total Orders",value:c.total_orders,icon:sc,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Draft",value:c.draft_orders,icon:sc,color:"text-gray-600",bgColor:"bg-gray-50"},{name:"Confirmed",value:c.confirmed_orders,icon:$n,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Scheduled",value:c.scheduled_orders,icon:$s,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"En Route",value:c.en_route_orders,icon:yr,color:"text-orange-600",bgColor:"bg-orange-50"},{name:"Delivered",value:c.delivered_orders,icon:hs,color:"text-green-600",bgColor:"bg-green-50"},{name:"Invoiced",value:c.invoiced_orders,icon:S_,color:"text-teal-600",bgColor:"bg-teal-50"},{name:"Cancelled",value:c.cancelled_orders,icon:pa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Today's Deliveries",value:c.todays_deliveries,icon:$s,color:"text-indigo-600",bgColor:"bg-indigo-50"},{name:"Overdue",value:c.overdue_orders,icon:Us,color:"text-red-600",bgColor:"bg-red-50"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:f.map(g=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${g.bgColor} mb-2`,children:t.jsx(g.icon,{className:`h-6 w-6 ${g.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.value}),t.jsx("div",{className:"text-sm text-gray-600",children:g.name})]},g.name))})]}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Revenue"}),t.jsx("p",{className:"text-sm text-gray-600",children:"From invoiced orders"})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-green-50 rounded-full",children:t.jsx(Ji,{className:"h-6 w-6 text-green-600"})}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"text-3xl font-bold text-gray-900",children:c.total_revenue?ls(c.total_revenue):"Ksh 0.00"})})]})]})}),(c.overdue_orders>0||c.todays_deliveries>0)&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.todays_deliveries>0&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-5 w-5 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Today's Deliveries"}),t.jsxs("p",{className:"text-sm text-blue-700",children:[c.todays_deliveries," order",c.todays_deliveries>1?"s":""," scheduled for delivery today"]})]})]})}),c.overdue_orders>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Overdue Orders"}),t.jsxs("p",{className:"text-sm text-red-700",children:[c.overdue_orders," order",c.overdue_orders>1?"s are":" is"," past scheduled delivery date"]})]})]})})]})]})},kb=({isOpen:c,onClose:d,onSubmit:f,order:g,newStatus:w,loading:N=!1})=>{const{register:T,handleSubmit:A,reset:n,formState:{errors:M},watch:z}=En({defaultValues:{order_id:g.id,new_status:w,notes:"",scheduled_date:""}}),V=z("scheduled_date");le.useEffect(()=>{n({order_id:g.id,new_status:w,notes:"",scheduled_date:w==="scheduled"?new Date().toISOString().split("T")[0]:""})},[g.id,w,n]);const U=re=>{f(re)},G=ic(w),W=w==="scheduled",K=(()=>{const re=[];if(w==="confirmed"){const te=PE(g);re.push(...te.errors)}else w==="scheduled"&&(V||re.push("Scheduled date is required"),g.delivery_address||re.push("Delivery address is required"));return re})(),ue=K.length===0;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(U),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Change Order Status"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current Status:"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${ic(g.status).color}`,children:g.status.replace("_"," ").toUpperCase()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"New Status:"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${G.color}`,children:w.replace("_"," ").toUpperCase()})]}),t.jsx("div",{className:"mt-2 text-sm text-gray-600",children:G.description})]}),K.length>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Cannot proceed:"}),t.jsx("ul",{className:"mt-1 text-sm text-red-700 list-disc list-inside",children:K.map((re,te)=>t.jsx("li",{children:re},te))})]})]})}),W&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"scheduled_date",className:"block text-sm font-medium text-gray-700",children:"Scheduled Delivery Date *"}),t.jsx("input",{type:"date",id:"scheduled_date",...T("scheduled_date",{required:W?"Scheduled date is required":!1,validate:re=>{if(W&&re){const te=new Date(re),je=new Date;if(je.setHours(0,0,0,0),te<je)return"Scheduled date cannot be in the past"}return!0}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]}),M.scheduled_date&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:M.scheduled_date.message})]}),w==="confirmed"&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Note:"})," Confirming this order will reserve inventory for all products."]})}),w==="delivered"&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Note:"})," Marking as delivered will deduct inventory and release reserved stock."]})}),w==="cancelled"&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-red-800",children:[t.jsx("strong",{children:"Warning:"})," Cancelling this order will release any reserved inventory."]})})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||!ue,className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed ${w==="cancelled"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}`,children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tr,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Updating..."})]}):`Change to ${G.label}`}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},FC=({selectedOrders:c,onClearSelection:d,onBulkOperation:f})=>{const[g,w]=le.useState(!1),[N,T]=le.useState(!1),[A,n]=le.useState(!1),[M,z]=le.useState(""),[V,U]=le.useState(""),[G,W]=le.useState("");if(c.length===0)return null;const $=me=>c.every(Ce=>{switch(me){case"confirmed":return Ce.status==="draft";case"scheduled":return Ce.status==="confirmed";case"cancelled":return["draft","confirmed","scheduled"].includes(Ce.status);default:return!1}}),K=()=>{M&&(f({order_ids:c.map(me=>me.id),operation:"schedule",scheduled_date:M,notes:G}),T(!1),z(""),W(""))},ue=()=>{V&&(f({order_ids:c.map(me=>me.id),operation:"status_change",new_status:V,notes:G}),n(!1),U(""),W(""))},re=()=>{f({order_ids:c.map(me=>me.id),operation:"export"}),w(!1)},te=()=>{f({order_ids:c.map(me=>me.id),operation:"print"}),w(!1)},je=c.reduce((me,Ce)=>me+(Ce.total_amount||0),0);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[c.length," order",c.length>1?"s":""," selected"]}),t.jsxs("span",{className:"text-sm text-blue-700",children:["Total value: $",je.toLocaleString()]}),t.jsxs("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center space-x-1",children:[t.jsx(er,{className:"h-3 w-3"}),t.jsx("span",{children:"Clear selection"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>w(!g),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx("span",{children:"Bulk Actions"}),t.jsx(nm,{className:"h-4 w-4"})]}),g&&t.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg border border-gray-200 z-10",children:t.jsxs("div",{className:"py-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Status Changes"}),$("confirmed")&&t.jsxs("button",{onClick:()=>{U("confirmed"),n(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx($n,{className:"h-4 w-4 text-blue-600"}),t.jsx("span",{children:"Confirm Orders"})]}),$("scheduled")&&t.jsxs("button",{onClick:()=>{T(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx($s,{className:"h-4 w-4 text-purple-600"}),t.jsx("span",{children:"Schedule Deliveries"})]}),$("cancelled")&&t.jsxs("button",{onClick:()=>{U("cancelled"),n(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(er,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{children:"Cancel Orders"})]}),t.jsxs("div",{className:"border-t border-gray-100 mt-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Export & Print"}),t.jsxs("button",{onClick:re,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(qf,{className:"h-4 w-4 text-green-600"}),t.jsx("span",{children:"Export to CSV"})]}),t.jsxs("button",{onClick:te,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(v_,{className:"h-4 w-4 text-gray-600"}),t.jsx("span",{children:"Print Manifests"})]})]})]})})]})]})}),N&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>T(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:["Schedule ",c.length," Orders"]}),t.jsx("button",{onClick:()=>T(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Delivery Date *"}),t.jsx("input",{type:"date",value:M,onChange:me=>z(me.target.value),min:new Date().toISOString().split("T")[0],className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),t.jsx("textarea",{value:G,onChange:me=>W(me.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Add notes for this bulk scheduling..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:K,disabled:!M,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Schedule Orders"}),t.jsx("button",{onClick:()=>T(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})}),A&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>n(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:[V==="confirmed"&&"Confirm Orders",V==="cancelled"&&"Cancel Orders"]}),t.jsx("button",{onClick:()=>n(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(er,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-gray-700",children:["This will change the status of ",c.length," selected orders to"," ",t.jsx("span",{className:"font-medium",children:V}),"."]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:V==="cancelled"?"Cancellation Reason *":"Notes (Optional)"}),t.jsx("textarea",{value:G,onChange:me=>W(me.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:V==="cancelled"?"Please provide a reason for cancellation...":"Add notes for this status change..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsxs("button",{onClick:ue,disabled:V==="cancelled"&&!G.trim(),className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed ${V==="cancelled"?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"}`,children:[V==="confirmed"&&"Confirm Orders",V==="cancelled"&&"Cancel Orders"]}),t.jsx("button",{onClick:()=>n(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})})]})},BC=()=>{const c=Qr(),[d,f]=le.useState({page:1}),[g,w]=le.useState(null),[N,T]=le.useState([]),{data:A,isLoading:n,error:M,refetch:z}=Eb(d),V=Cb();le.useEffect(()=>{console.log("OrdersPage state:",{filters:d,data:A,isLoading:n,error:M,statusChangeOrder:g,selectedOrders:N})},[d,A,n,M,g,N]);const U=()=>{console.log("Creating new order"),c("/orders/new")},G=fe=>{console.log("Viewing order:",fe),c(`/orders/${fe.id}`)},W=fe=>{console.log("Editing order:",fe),c(`/orders/${fe.id}/edit`)},$=(fe,Ie)=>{console.log("Changing order status:",fe,Ie),w({order:fe,newStatus:Ie})},K=async fe=>{console.log("Status change submit:",fe);try{await V.mutateAsync(fe),w(null)}catch(Ie){console.error("Status change error:",Ie)}},ue=async fe=>{switch(console.log("Bulk operation:",fe),fe.operation){case"status_change":if(fe.new_status)for(const Ie of fe.order_ids)(A==null?void 0:A.orders.find(tt=>tt.id===Ie))&&await V.mutateAsync({order_id:Ie,new_status:fe.new_status,notes:fe.notes});break;case"schedule":if(fe.scheduled_date)for(const Ie of fe.order_ids)await V.mutateAsync({order_id:Ie,new_status:"scheduled",scheduled_date:fe.scheduled_date,notes:fe.notes});break;case"export":re(fe.order_ids);break;case"print":te(fe.order_ids);break}T([])},re=fe=>{const Ie=(A==null?void 0:A.orders.filter(rt=>fe.includes(rt.id)))||[],Ee=[["Order ID","Customer","Status","Order Date","Scheduled Date","Total Amount"],...Ie.map(rt=>{var gt,yt;return[rt.id,((gt=rt.customer)==null?void 0:gt.name)||"",rt.status,rt.order_date,rt.scheduled_date||"",((yt=rt.total_amount)==null?void 0:yt.toString())||"0"]})].map(rt=>rt.join(",")).join(`
`),tt=new Blob([Ee],{type:"text/csv"}),Pe=window.URL.createObjectURL(tt),Te=document.createElement("a");Te.href=Pe,Te.download=`orders-export-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Te),Te.click(),document.body.removeChild(Te),window.URL.revokeObjectURL(Pe)},te=fe=>{console.log("Print manifests for orders:",fe)},je=fe=>{console.log("Page change:",fe),f(Ie=>({...Ie,page:fe}))},me=()=>{console.log("Refreshing orders"),z()},Ce=fe=>{T(fe)},Ae=()=>{T([])};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Management"}),t.jsx("p",{className:"text-gray-600",children:"Manage customer orders and deliveries"}),M&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",M.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>c("/orders/reports"),className:"flex items-center space-x-2 bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:[t.jsx(Xo,{className:"h-4 w-4"}),t.jsx("span",{children:"Reports"})]}),t.jsxs("button",{onClick:()=>c("/orders/schedule"),className:"flex items-center space-x-2 bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx($s,{className:"h-4 w-4"}),t.jsx("span",{children:"Schedule"})]}),t.jsxs("button",{onClick:me,disabled:n,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(Yo,{className:`h-4 w-4 ${n?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:U,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Create Order"})]})]})]}),t.jsx(OC,{}),t.jsx(LC,{filters:d,onFiltersChange:f}),t.jsx(FC,{selectedOrders:(A==null?void 0:A.orders.filter(fe=>N.includes(fe.id)))||[],onClearSelection:Ae,onBulkOperation:ue}),t.jsx(DC,{orders:(A==null?void 0:A.orders)||[],loading:n,onView:G,onEdit:W,onChangeStatus:$,selectedOrders:N,onSelectionChange:Ce}),A&&A.totalPages>1&&t.jsx(ac,{currentPage:A.currentPage,totalPages:A.totalPages,totalCount:A.totalCount,onPageChange:je}),g&&t.jsx(kb,{isOpen:!!g,onClose:()=>w(null),onSubmit:K,order:g.order,newStatus:g.newStatus,loading:V.isPending})]})},UC=({value:c,onChange:d,customers:f,placeholder:g="Search customer...",className:w=""})=>{const[N,T]=le.useState(!1),[A,n]=le.useState(""),[M,z]=le.useState([]);le.useEffect(()=>{if(A){const W=f.filter($=>$.name.toLowerCase().includes(A.toLowerCase())||$.external_id&&$.external_id.toLowerCase().includes(A.toLowerCase())||$.tax_id&&$.tax_id.toLowerCase().includes(A.toLowerCase()));z(W)}else z(f)},[A,f]);const V=f.find(W=>W.id===c),U=W=>{d(W),T(!1),n("")},G=()=>{d(""),n("")};return t.jsxs("div",{className:`relative ${w}`,children:[t.jsx("div",{className:"relative",children:t.jsx("div",{onClick:()=>T(!N),className:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 cursor-pointer",children:V?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:V.name}),V.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",V.external_id]})]}),t.jsx("button",{onClick:W=>{W.stopPropagation(),G()},className:"text-gray-400 hover:text-gray-600",children:t.jsx(er,{className:"h-4 w-4"})})]}):t.jsxs("div",{className:"flex items-center justify-between text-gray-500",children:[t.jsx("span",{children:g}),t.jsx(nm,{className:"h-4 w-4"})]})})}),N&&t.jsxs("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:[t.jsx("div",{className:"p-2",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:A,onChange:W=>n(W.target.value),placeholder:"Type to search...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0})]})}),t.jsx("div",{className:"max-h-60 overflow-auto",children:M.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No customers found"}):M.map(W=>t.jsxs("div",{onClick:()=>U(W.id),className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsx("div",{className:"font-medium text-gray-900",children:W.name}),W.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",W.external_id]}),W.tax_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Tax ID: ",W.tax_id]})]},W.id))})]})]})},VC=({orderType:c,serviceType:d,exchangeEmptyQty:f,requiresPickup:g,onOrderTypeChange:w,onServiceTypeChange:N,onExchangeEmptyQtyChange:T,onRequiresPickupChange:A,disabled:n=!1})=>{const M=[{value:"delivery",label:"Standard Delivery",description:"Deliver full cylinders to customer",icon:yr,color:"bg-blue-50 border-blue-200 text-blue-800",selectedColor:"bg-blue-100 border-blue-300"},{value:"refill",label:"Refill Service",description:"Deliver full cylinders and collect empties",icon:Ya,color:"bg-green-50 border-green-200 text-green-800",selectedColor:"bg-green-100 border-green-300"},{value:"exchange",label:"Cylinder Exchange",description:"Exchange empties for full cylinders",icon:x_,color:"bg-orange-50 border-orange-200 text-orange-800",selectedColor:"bg-orange-100 border-orange-300"},{value:"pickup",label:"Empty Pickup",description:"Collect empty cylinders only",icon:N_,color:"bg-purple-50 border-purple-200 text-purple-800",selectedColor:"bg-purple-100 border-purple-300"}],z=[{value:"standard",label:"Standard Service",description:"Regular delivery schedule",icon:Qi},{value:"express",label:"Express Service",description:"Priority delivery",icon:cS},{value:"scheduled",label:"Scheduled Service",description:"Specific delivery time",icon:$s}],V=U=>{w(U),lf(U)?A(!0):U==="delivery"&&A(!1),U==="delivery"&&T(0)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Type"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:M.map(U=>{const G=U.icon,W=c===U.value;return t.jsxs("button",{type:"button",onClick:()=>V(U.value),disabled:n,className:`relative p-4 border-2 rounded-lg text-left transition-all hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${W?U.selectedColor:U.color}`,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(G,{className:"h-6 w-6 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:U.label}),t.jsx("p",{className:"text-sm opacity-80 mt-1",children:U.description})]})]}),W&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("div",{className:"w-3 h-3 bg-current rounded-full"})})]},U.value)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Service Type"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:z.map(U=>{const G=U.icon,W=d===U.value;return t.jsxs("button",{type:"button",onClick:()=>N(U.value),disabled:n,className:`relative p-4 border-2 rounded-lg text-left transition-all hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${W?"bg-gray-100 border-gray-300 text-gray-900":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(G,{className:"h-5 w-5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:U.label}),t.jsx("p",{className:"text-sm opacity-80 mt-1",children:U.description})]})]}),W&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"})})]},U.value)})})]}),(c==="refill"||c==="exchange"||c==="pickup")&&t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:c==="pickup"?"Pickup Details":"Exchange Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"exchange_empty_qty",className:"block text-sm font-medium text-gray-700",children:c==="pickup"?"Empty Cylinders to Collect *":"Empty Cylinders to Exchange *"}),t.jsx("input",{type:"number",id:"exchange_empty_qty",min:"0",value:f,onChange:U=>T(parseInt(U.target.value)||0),disabled:n,className:"mt-1 block w-full sm:w-32 rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50",placeholder:"0"}),t.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[c==="refill"&&"Number of empty cylinders customer will return",c==="exchange"&&"Number of empty cylinders to collect from customer",c==="pickup"&&"Number of empty cylinders to collect"]})]}),c!=="pickup"&&t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"requires_pickup",checked:g,onChange:U=>A(U.target.checked),disabled:n||lf(c),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded disabled:opacity-50"}),t.jsxs("label",{htmlFor:"requires_pickup",className:"ml-2 block text-sm text-gray-700",children:["Requires pickup of empty cylinders",lf(c)&&t.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Required for this order type)"})]})]})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:[qE(c)," - ",$E(d)]}),t.jsxs("div",{className:"text-sm text-blue-800",children:[c==="delivery"&&t.jsx("p",{children:"Standard delivery of full cylinders to the customer's address."}),c==="refill"&&t.jsxs("div",{children:[t.jsx("p",{children:"Delivery of full cylinders with collection of empty cylinders."}),t.jsx("p",{className:"mt-1",children:" Deliver: Full cylinders as per order"}),t.jsxs("p",{children:[" Collect: ",f||0," empty cylinders"]})]}),c==="exchange"&&t.jsxs("div",{children:[t.jsx("p",{children:"Exchange service where empties are swapped for full cylinders."}),t.jsx("p",{className:"mt-1",children:" Deliver: Full cylinders as per order"}),t.jsxs("p",{children:[" Collect: ",f||0," empty cylinders"]})]}),c==="pickup"&&t.jsxs("div",{children:[t.jsx("p",{children:"Collection of empty cylinders only."}),t.jsxs("p",{className:"mt-1",children:[" Collect: ",f||0," empty cylinders"]})]})]})]})]})},qC=(c,d,f=!0)=>i_({queryKey:["productPrices",c.sort().join(","),d],queryFn:async()=>c.length?await _t.pricing.getProductPrices.query({productIds:c,customerId:d}):{},enabled:f&&c.length>0,staleTime:5*60*1e3}),$C=()=>{const c=Qr(),[d,f]=le.useState(1),[g,w]=le.useState(""),[N,T]=le.useState(""),[A,n]=le.useState(new Date().toISOString().split("T")[0]),[M,z]=le.useState([]),[V,U]=le.useState(""),[G,W]=le.useState(0),[$,K]=le.useState(!1),[ue,re]=le.useState("delivery"),[te,je]=le.useState("standard"),[me,Ce]=le.useState(0),[Ae,fe]=le.useState(!1),{data:Ie}=E_({limit:1e3}),{data:Ee=[]}=db(g),{data:tt}=cc({limit:1e3}),{data:Pe}=Yf({limit:1e3}),Te=PC(),rt=hb(),gt=(Ie==null?void 0:Ie.customers)||[],yt=(tt==null?void 0:tt.products)||[],pt=(Pe==null?void 0:Pe.priceLists)||[],ft=yt.map(De=>De.id),{data:wt}=qC(ft,g||void 0),Os=new Date().toISOString().split("T")[0],ns=pt.filter(De=>!(De.end_date&&De.end_date<Os||De.start_date&&De.start_date>Os)),_s=ns.find(De=>De.is_default)||ns[0];yt.filter(De=>De.status==="active").map(De=>De.id);const mr=gt.find(De=>De.id===g),Ut=Ee.find(De=>De.id===N),[pr,Fr]=le.useState({subtotal:0,taxAmount:0,grandTotal:0}),[jr,fr]=le.useState(!1);le.useEffect(()=>{(async()=>{if(M.length===0){Fr({subtotal:0,taxAmount:0,grandTotal:0});return}fr(!0);try{const xt=await gb(M,G);Fr(xt)}catch(xt){console.error("Failed to calculate order totals:",xt)}finally{fr(!1)}})()},[M,G]);const Br=pr.subtotal,_r=pr.taxAmount,Jr=pr.grandTotal,Qt=De=>{w(De),T("")};le.useEffect(()=>{if(g&&Ee.length>0&&!N){const De=Ee.find(xt=>xt.is_primary);De&&T(De.id)}},[g,Ee,N]);const gi=async De=>{try{const xt=await _t.pricing.getProductPrice.query({productId:De,customerId:g||void 0});return(xt==null?void 0:xt.finalPrice)||0}catch(xt){return console.error("Failed to fetch product price:",xt),0}},br=De=>wt&&wt[De]?wt[De].finalPrice:0,Mi=async De=>{const xt=yt.find(sr=>sr.id===De);if(!xt)return;const Jt=M.find(sr=>sr.product_id===De),qt=await gi(De),bs=Ge();if(Jt){if(Jt.quantity>=bs){alert(`Cannot add more items. Only ${bs} units available in stock.`);return}z(sr=>sr.map(Ls=>Ls.product_id===De?{...Ls,quantity:Ls.quantity+1,subtotal:(Ls.quantity+1)*Ls.unit_price}:Ls))}else{const sr={product_id:De,product_name:xt.name,product_sku:xt.sku,quantity:1,unit_price:qt,subtotal:qt};z(Ls=>[...Ls,sr])}},As=(De,xt)=>{if(xt<=0){Ir(De);return}const Jt=Ge();if(xt>Jt){alert(`Cannot set quantity to ${xt}. Only ${Jt} units available in stock.`);return}z(qt=>qt.map(bs=>bs.product_id===De?{...bs,quantity:xt,subtotal:xt*bs.unit_price}:bs))},Ir=De=>{z(xt=>xt.filter(Jt=>Jt.product_id!==De))},Zn=async()=>{if(!(!g||!N||M.length===0))try{const De={customer_id:g,delivery_address_id:N,order_date:A,status:"draft",notes:V,tax_percent:G,tax_amount:_r,total_amount:Jr,order_type:ue,service_type:te,exchange_empty_qty:me,requires_pickup:Ae},xt=await Te.mutateAsync(De);c(`/orders/${xt.id}`)}catch(De){console.error("Error creating order:",De)}},Zr=g&&N,we=Zr&&M.length>0,Ge=De=>999,et=De=>(console.log("Stock status for quantity",De),"text-green-600"),kt=()=>{g&&K(!0)},Nt=async De=>{try{const xt=await rt.mutateAsync(De);T(xt.id),K(!1)}catch{}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create New Order"})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("div",{className:"flex items-center justify-between mb-6",children:t.jsxs("div",{className:"flex items-center space-x-8",children:[t.jsxs("div",{className:`flex items-center space-x-2 ${d>=1?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=1?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),t.jsx("span",{className:"font-medium",children:"Customer & Delivery"})]}),t.jsx("div",{className:`w-16 h-0.5 ${d>=2?"bg-blue-600":"bg-gray-200"}`}),t.jsxs("div",{className:`flex items-center space-x-2 ${d>=2?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=2?"bg-blue-600 text-white":"bg-gray-200"}`,children:"2"}),t.jsx("span",{className:"font-medium",children:"Add Products"})]}),t.jsx("div",{className:`w-16 h-0.5 ${d>=3?"bg-blue-600":"bg-gray-200"}`}),t.jsxs("div",{className:`flex items-center space-x-2 ${d>=3?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=3?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),t.jsx("span",{className:"font-medium",children:"Review & Create"})]})]})}),d===1&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"mb-6",children:t.jsx(VC,{selectedOrderType:ue,selectedServiceType:te,exchangeEmptyQty:me,requiresPickup:Ae,onOrderTypeChange:re,onServiceTypeChange:je,onExchangeEmptyQtyChange:Ce,onRequiresPickupChange:fe})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(om,{className:"inline h-4 w-4 mr-1"}),"Select Customer *"]}),t.jsx(UC,{value:g,onChange:Qt,customers:gt,placeholder:"Search for a customer..."})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx($s,{className:"inline h-4 w-4 mr-1"}),"Order Date *"]}),t.jsx("input",{type:"date",value:A,onChange:De=>n(De.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),g&&t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Tn,{className:"inline h-4 w-4 mr-1"}),"Delivery Address *"]}),Ee.length>0?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("select",{value:N,onChange:De=>T(De.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Choose a delivery address..."}),Ee.map(De=>t.jsx("option",{value:De.id,children:SE(De)},De.id))]}),Ut&&t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Selected Address:"}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("div",{children:Ut.line1}),Ut.line2&&t.jsx("div",{children:Ut.line2}),t.jsxs("div",{children:[Ut.city,", ",Ut.state," ",Ut.postal_code]}),Ut.instructions&&t.jsxs("div",{className:"mt-2 text-gray-600",children:[t.jsx("strong",{children:"Instructions:"})," ",Ut.instructions]})]})]})]}):t.jsxs("div",{className:"text-center py-8 border border-gray-200 rounded-lg bg-yellow-50",children:[t.jsx(Us,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No delivery addresses found"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"This customer doesn't have any delivery addresses yet."}),t.jsxs("button",{onClick:kt,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Address for Customer"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Notes"}),t.jsx("textarea",{value:V,onChange:De=>U(De.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional notes about this order..."})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>f(2),disabled:!Zr,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Add Products"})})]}),d===2&&t.jsxs("div",{className:"space-y-6",children:[!_s&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Us,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("span",{className:"text-sm text-yellow-800",children:["No active price list found. Product prices may not be available.",pt.length>0?`Found ${pt.length} price list(s) but none are currently active.`:"No price lists exist yet."]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Available Products"}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:yt.filter(De=>De.status==="active").map(De=>{const xt=Ge(De.id),Jt=br(De.id),qt=M.find(yi=>yi.product_id===De.id),bs=!!qt,sr=(qt==null?void 0:qt.quantity)||0;et(xt);const Ls=sr<xt,xi=xt===0,Wr=Jt===0,Dr=Wr||!Ls;return t.jsx("div",{className:`p-3 border rounded-lg transition-all ${bs?"bg-blue-50 border-blue-200":Dr?"bg-gray-50 border-gray-200 opacity-75":"border-gray-200 hover:border-gray-300"}`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"font-medium text-gray-900",children:De.name}),bs&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"In Order"})]}),t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["SKU: ",De.sku]}),t.jsx("div",{className:"flex items-center space-x-2 mb-2",children:t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(GN,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:[xt," available",bs?` (${sr} in order)`:""]})]})}),t.jsx("div",{className:"flex items-center space-x-2 mb-3",children:Wr?t.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[t.jsx(Sn,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm font-medium",children:["No price set",_s?` in ${_s.name}`:""]})]}):t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(Sn,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:ls(Jt)}),_s&&t.jsxs("span",{className:"text-xs text-gray-500",children:["(",_s.name,")"]})]})}),Dr&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-2 mt-2",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(KN,{className:"h-4 w-4 text-yellow-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-yellow-800",children:[xi,Wr&&!xi&&t.jsxs(t.Fragment,{children:["No pricing configured for this product.",t.jsx("button",{onClick:()=>window.open("/pricing","_blank"),className:"ml-1 text-blue-600 hover:text-blue-800 underline",children:"Set up pricing"})]}),!Ls&&!xi&&!Wr&&`Maximum quantity (${xt}) already in order.`]})]})})]}),t.jsx("div",{className:"ml-4 flex-shrink-0",children:t.jsx("button",{onClick:()=>Mi(De.id),disabled:Dr,title:Dr?Wr?"No price set":"Maximum quantity reached":"Add to order",className:`
                                flex items-center justify-center w-10 h-10 rounded-lg text-sm font-medium transition-all
                                ${Dr?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm hover:shadow"}
                              `,children:t.jsx(wr,{className:"h-4 w-4"})})})]})},De.id)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Items"}),M.length>0?t.jsxs("div",{className:"space-y-3",children:[M.map(De=>{const xt=Ge(De.product_id);return t.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:De.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",De.product_sku]})]}),t.jsx("button",{onClick:()=>Ir(De.product_id),className:"text-red-600 hover:text-red-800",children:t.jsx(to,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("label",{className:"text-sm text-gray-600",children:"Qty:"}),t.jsx("input",{type:"number",min:"1",max:xt,value:De.quantity,onChange:Jt=>As(De.product_id,parseInt(Jt.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(max: ",xt,")"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(De.unit_price)," each"]}),t.jsx("div",{className:"font-medium text-gray-900",children:ls(De.subtotal)})]})]})]},De.product_id)}),t.jsxs("div",{className:"border-t pt-3",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Subtotal:"}),t.jsx("span",{className:"text-xl font-bold text-gray-900",children:ls(Br)})]}),t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tax (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",value:G,onChange:De=>W(Number(De.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm text-right"})]}),t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Tax:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:ls(_r)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:ls(Jr)})]})]})]}):t.jsxs("div",{className:"text-center py-8 border border-gray-200 rounded-lg",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No products added yet."}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Select products from the left to add them to the order."})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("button",{onClick:()=>f(1),className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200",children:"Back"}),t.jsx("button",{onClick:()=>f(3),disabled:M.length===0,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Review"})]})]}),d===3&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Customer:"}),t.jsx("div",{className:"text-gray-900",children:mr==null?void 0:mr.name})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Delivery Address:"}),t.jsxs("div",{className:"text-gray-900",children:[Ut==null?void 0:Ut.line1,(Ut==null?void 0:Ut.line2)&&t.jsx("div",{children:Ut.line2}),t.jsxs("div",{children:[Ut==null?void 0:Ut.city,", ",Ut==null?void 0:Ut.state," ",Ut==null?void 0:Ut.postal_code]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Order Date:"}),t.jsx("div",{className:"text-gray-900",children:new Date(A).toLocaleDateString()})]}),V&&t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notes:"}),t.jsx("div",{className:"text-gray-900",children:V})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tax (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",value:G,onChange:De=>W(Number(De.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm text-right"})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Items"}),t.jsxs("div",{className:"space-y-2",children:[M.map(De=>t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-200",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:De.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:[De.quantity,"  ",ls(De.unit_price)]})]}),t.jsx("div",{className:"font-medium text-gray-900",children:ls(De.subtotal)})]},De.product_id)),t.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-300",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Subtotal:"}),t.jsx("span",{className:"text-xl font-bold text-gray-900",children:ls(Br)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Tax:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:ls(_r)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:ls(Jr)})]})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("button",{onClick:()=>f(2),className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200",children:"Back"}),t.jsxs("button",{onClick:Zn,disabled:!we||Te.isPending,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(sc,{className:"h-4 w-4"}),t.jsx("span",{children:Te.isPending?"Creating...":"Create Order"})]})]})]})]}),t.jsx(fb,{isOpen:$,onClose:()=>K(!1),onSubmit:Nt,customerId:g,loading:rt.isPending,title:"Add New Address",isFirstAddress:Ee.length===0})]})},GC=({statusHistory:c,currentStatus:d,estimatedDates:f={}})=>{const g=n=>new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=(n,M)=>(ic(n),M?t.jsx($n,{className:"h-5 w-5 text-green-600"}):n===d?t.jsx(Qi,{className:"h-5 w-5 text-blue-600"}):t.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-gray-300 bg-white"})),N=(n,M)=>M?"border-green-200 bg-green-50":n===d?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50",T=["draft","confirmed","scheduled","en_route","delivered","invoiced"],A=T.indexOf(d);return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Order Timeline"}),t.jsx("div",{className:"space-y-4",children:T.map((n,M)=>{const z=M<A||n===d&&d!=="cancelled",V=n===d,U=ic(n),G=c.find($=>$.status===n),W=f[n];return n==="cancelled"&&d!=="cancelled"?null:t.jsxs("div",{className:`relative flex items-start space-x-4 p-4 rounded-lg border ${N(n,z)}`,children:[M<T.length-1&&n!=="cancelled"&&t.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-8 bg-gray-200"}),t.jsx("div",{className:"flex-shrink-0 mt-1",children:w(n,z)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:`text-sm font-medium ${z||V?"text-gray-900":"text-gray-500"}`,children:U.label}),G&&t.jsx("span",{className:"text-xs text-gray-500",children:g(G.changed_at)})]}),t.jsx("p",{className:`text-sm mt-1 ${z||V?"text-gray-600":"text-gray-400"}`,children:U.description}),(G||W)&&t.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs",children:[G&&t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx($n,{className:"h-3 w-3"}),t.jsxs("span",{children:["Completed: ",g(G.changed_at)]})]}),W&&!G&&t.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[t.jsx($s,{className:"h-3 w-3"}),t.jsxs("span",{children:["Estimated: ",g(W)]})]})]}),G&&t.jsxs("div",{className:"mt-3 space-y-2",children:[G.user_name&&t.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[t.jsx(om,{className:"h-3 w-3"}),t.jsxs("span",{children:["Changed by: ",G.user_name]})]}),G.notes&&t.jsxs("div",{className:"flex items-start space-x-1 text-xs text-gray-600",children:[t.jsx(sS,{className:"h-3 w-3 mt-0.5"}),t.jsx("span",{children:G.notes})]})]}),V&&t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Current Status"})})]})]},n)})}),c.length>1&&t.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Performance Metrics"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Order Processing Time:"}),t.jsx("div",{className:"font-medium text-gray-900",children:(()=>{var z,V;const n=(z=c.find(U=>U.status==="draft"))==null?void 0:z.changed_at,M=(V=c.find(U=>U.status==="confirmed"))==null?void 0:V.changed_at;return n&&M?`${Math.round((new Date(M).getTime()-new Date(n).getTime())/36e5)} hours`:"N/A"})()})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Fulfillment Time:"}),t.jsx("div",{className:"font-medium text-gray-900",children:(()=>{var z,V;const n=(z=c.find(U=>U.status==="confirmed"))==null?void 0:z.changed_at,M=(V=c.find(U=>U.status==="delivered"))==null?void 0:V.changed_at;return n&&M?`${Math.round((new Date(M).getTime()-new Date(n).getTime())/864e5)} days`:"N/A"})()})]})]})]})]})},ZC=({isOpen:c,onClose:d,order:f})=>{const[g,w]=le.useState(0),[N,T]=le.useState(""),[A,n]=le.useState({subtotal:0,taxAmount:0,grandTotal:0}),[M,z]=le.useState(!1),V=IC();if(le.useEffect(()=>{f&&(w(f.tax_percent||0),T(f.notes||""))},[f]),le.useEffect(()=>{(async()=>{if(!(f!=null&&f.order_lines)||f.order_lines.length===0){n({subtotal:0,taxAmount:0,grandTotal:0});return}z(!0);try{const ue=f.order_lines.map(te=>({quantity:te.quantity,unit_price:te.unit_price,subtotal:te.subtotal||te.quantity*te.unit_price})),re=await gb(ue,g);n(re)}catch(ue){console.error("Failed to calculate order totals:",ue)}finally{z(!1)}})()},[f,g]),!c||!f)return null;const U=A.subtotal,G=A.taxAmount,W=A.grandTotal,$=async K=>{K.preventDefault();try{await V.mutateAsync({id:f.id,tax_percent:g,tax_amount:G,total_amount:W,notes:N}),d()}catch(ue){console.error("Error updating order:",ue)}};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Edit Order"}),t.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(er,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:$,className:"p-6 space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Order Summary"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),t.jsx("span",{className:"font-medium text-gray-900",children:ls(U)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600",children:["Tax (",g,"%):"]}),t.jsx("span",{className:"font-medium text-gray-900",children:ls(G)})]}),t.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-2",children:[t.jsx("span",{className:"font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"font-bold text-gray-900",children:ls(W)})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"taxPercent",className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Percentage (%)"}),t.jsx("input",{type:"number",id:"taxPercent",min:"0",max:"100",step:"0.01",value:g,onChange:K=>w(Number(K.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),t.jsx("textarea",{id:"notes",rows:3,value:N,onChange:K=>T(K.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Add any additional notes..."})]}),t.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{type:"button",onClick:async()=>{try{await V(f.id,g),Kr.success("Total amount recalculated")}catch(K){console.error("Error recalculating total:",K),Kr.error("Failed to recalculate total")}},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Recalculate Total"}),t.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:updateOrder.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(T_,{className:"h-4 w-4"}),t.jsx("span",{children:updateOrder.isPending?"Saving...":"Save Changes"})]})]})]})]})})},WC=()=>{var re,te,je,me,Ce,Ae,fe,Ie,Ee,tt;const{id:c}=nc(),d=Qr(),[f,g]=le.useState(null),[w,N]=le.useState(!1),[T,A]=le.useState(!1),{data:n,isLoading:M,error:z}=MC(c),V=Cb(),U=Pe=>{n&&g({order:n,newStatus:Pe})},G=async Pe=>{try{await V.mutateAsync(Pe),g(null)}catch(Te){console.error("Status change error:",Te)}},W=Pe=>new Date(Pe).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(M)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(z||!n)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Order not found or error loading order details."})})})]});const $=ic(n.status),K=of(n.status),ue=[{id:"1",order_id:n.id,status:"draft",changed_by:"system",changed_at:n.created_at,user_name:"System",notes:"Order created"},...n.status!=="draft"?[{id:"2",order_id:n.id,status:"confirmed",changed_by:"admin",changed_at:new Date(new Date(n.created_at).getTime()+36e5).toISOString(),user_name:"Admin User",notes:"Order confirmed and inventory reserved"}]:[]];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Order ",formatOrderIdSync(n.id)]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>N(!w),className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(Qi,{className:"h-4 w-4"}),t.jsxs("span",{children:[w?"Hide":"Show"," Timeline"]})]}),["draft","confirmed"].includes(n.status)&&t.jsxs("button",{onClick:()=>A(!0),className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(ci,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Order"})]}),K.map(Pe=>t.jsxs("button",{onClick:()=>U(Pe),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[Pe==="confirmed"&&"Confirm Order",Pe==="scheduled"&&"Schedule Delivery",Pe==="en_route"&&"Mark En Route",Pe==="delivered"&&"Mark Delivered",Pe==="invoiced"&&"Generate Invoice",Pe==="cancelled"&&"Cancel Order"]},Pe))]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Order ",formatOrderIdSync(n.id)]}),t.jsxs("p",{className:"text-gray-600",children:["Created on ",W(n.created_at)]})]}),t.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${$.color}`,children:n.status.replace("_"," ").toUpperCase()})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:t.jsx(om,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Customer"}),t.jsx("p",{className:"text-gray-600",children:(re=n.customer)==null?void 0:re.name}),((te=n.customer)==null?void 0:te.email)&&t.jsx("p",{className:"text-sm text-gray-500",children:n.customer.email}),((je=n.customer)==null?void 0:je.phone)&&t.jsx("p",{className:"text-sm text-gray-500",children:n.customer.phone})]})]}),t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:t.jsx(Tn,{className:"h-5 w-5 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Delivery Address"}),n.delivery_address?t.jsxs("div",{className:"text-gray-600",children:[t.jsx("p",{children:n.delivery_address.line1}),n.delivery_address.line2&&t.jsx("p",{children:n.delivery_address.line2}),t.jsxs("p",{children:[n.delivery_address.city,", ",n.delivery_address.state," ",n.delivery_address.postal_code]}),n.delivery_address.instructions&&t.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Note: ",n.delivery_address.instructions]})]}):t.jsx("p",{className:"text-gray-500",children:"No address specified"})]})]}),t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:t.jsx($s,{className:"h-5 w-5 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Important Dates"}),t.jsxs("div",{className:"text-gray-600 space-y-1",children:[t.jsxs("p",{children:["Order: ",new Date(n.order_date).toLocaleDateString()]}),n.scheduled_date&&t.jsxs("p",{children:["Scheduled: ",new Date(n.scheduled_date).toLocaleDateString()]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Updated: ",W(n.updated_at)]})]})]})]})]}),n.notes&&t.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Order Notes"}),t.jsx("p",{className:"text-gray-700",children:n.notes})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Order Items"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-5 w-5 text-gray-400"}),t.jsxs("span",{className:"text-gray-600",children:[((me=n.order_lines)==null?void 0:me.length)||0," item",(((Ce=n.order_lines)==null?void 0:Ce.length)||0)!==1?"s":""]})]})]}),n.order_lines&&n.order_lines.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subtotal"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.order_lines.map(Pe=>{var Te,rt;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((Te=Pe.product)==null?void 0:Te.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((rt=Pe.product)==null?void 0:rt.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:Pe.quantity})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm text-gray-900",children:ls(Pe.unit_price)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(Pe.subtotal||Pe.quantity*Pe.unit_price)})})]},Pe.id)})}),t.jsx("tfoot",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"Total:"}),t.jsx("td",{className:"px-6 py-4 text-right text-lg font-bold text-gray-900",children:n.total_amount?ls(n.total_amount):ls(n.order_lines.reduce((Pe,Te)=>Pe+(Te.subtotal||Te.quantity*Te.unit_price),0))})]})})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No items in this order"})]})]}),w&&t.jsx(GC,{statusHistory:ue,currentStatus:n.status})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Summary"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),t.jsx("span",{className:"font-medium text-gray-900",children:ls(((Ae=n.order_lines)==null?void 0:Ae.reduce((Pe,Te)=>Pe+(Te.subtotal||Te.quantity*Te.unit_price),0))||0)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600",children:["Tax",n.tax_percent!=null?` (${n.tax_percent}%)`:"",":"]}),t.jsx("span",{className:"font-medium text-gray-900",children:ls(n.tax_amount!=null?n.tax_amount:0)})]}),t.jsx("div",{className:"border-t border-gray-200 pt-4",children:t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:ls((((fe=n.order_lines)==null?void 0:fe.reduce((Pe,Te)=>Pe+(Te.subtotal||Te.quantity*Te.unit_price),0))||0)+(n.tax_amount!=null?n.tax_amount:0))})]})})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Details"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Account Status:"}),t.jsx("div",{className:"mt-1",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${((Ie=n.customer)==null?void 0:Ie.account_status)==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:((Ee=n.customer)==null?void 0:Ee.account_status)||"Unknown"})})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Credit Terms:"}),t.jsxs("div",{className:"mt-1 text-sm text-gray-900",children:[((tt=n.customer)==null?void 0:tt.credit_terms_days)||0," days"]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"space-y-3",children:[["draft","confirmed"].includes(n.status)&&t.jsxs("button",{onClick:()=>A(!0),className:"w-full flex items-center justify-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(ci,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Order"})]}),t.jsxs("button",{onClick:()=>U(of(n.status)[0]),disabled:of(n.status).length===0,className:"w-full flex items-center justify-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(Qi,{className:"h-4 w-4"}),t.jsx("span",{children:"Change Status"})]}),t.jsxs("button",{onClick:()=>N(!w),className:"w-full flex items-center justify-center space-x-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:[t.jsx(Qi,{className:"h-4 w-4"}),t.jsxs("span",{children:[w?"Hide":"Show"," Timeline"]})]})]})]})]})]}),f&&t.jsx(kb,{isOpen:!!f,onClose:()=>g(null),onSubmit:G,order:f.order,newStatus:f.newStatus,loading:V.isPending}),T&&t.jsx(ZC,{isOpen:T,onClose:()=>A(!1),order:n})]})},HC=({orders:c,onOrderClick:d,onDateChange:f,onReschedule:g})=>{const[w,N]=le.useState(new Date),[T,A]=le.useState(null),n=te=>te.toISOString().split("T")[0],M=te=>te.toLocaleDateString("en-US",{month:"long",year:"numeric"}),z=te=>{const je=te.getFullYear(),me=te.getMonth(),Ce=new Date(je,me,1),fe=new Date(je,me+1,0).getDate(),Ie=Ce.getDay(),Ee=[];for(let tt=0;tt<Ie;tt++)Ee.push(null);for(let tt=1;tt<=fe;tt++)Ee.push(new Date(je,me,tt));return Ee},V=te=>{const je=n(te);return c.filter(me=>me.scheduled_date===je)},U=te=>{N(je=>{const me=new Date(je);return te==="prev"?me.setMonth(je.getMonth()-1):me.setMonth(je.getMonth()+1),me})},G=te=>{const je=n(te),me=V(te);A(je),f(je,me)},W=te=>{const je=V(te),me=new Date;return me.setHours(0,0,0,0),je.length===0?"empty":te<me?"past":n(te)===n(me)?"today":"scheduled"},$=te=>{const je=W(te),me=T===n(te),Ce="min-h-[80px] p-2 border border-gray-200 cursor-pointer transition-colors relative";if(me)return`${Ce} bg-blue-100 border-blue-300`;switch(je){case"today":return`${Ce} bg-yellow-50 border-yellow-300 hover:bg-yellow-100`;case"scheduled":return`${Ce} bg-green-50 border-green-200 hover:bg-green-100`;case"past":return`${Ce} bg-gray-50 text-gray-500 hover:bg-gray-100`;default:return`${Ce} hover:bg-gray-50`}},K=z(w),ue=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],re=le.useMemo(()=>{if(!T)return[];const te=new Date(T+"T00:00:00");return V(te)},[T,c]);return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Delivery Schedule"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:()=>U("prev"),className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:t.jsx(__,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-lg font-medium text-gray-900 min-w-[200px] text-center",children:M(w)}),t.jsx("button",{onClick:()=>U("next"),className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:t.jsx(b_,{className:"h-4 w-4"})})]})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-4",children:ue.map(te=>t.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500 border-b border-gray-200",children:te},te))}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-6",children:K.map((te,je)=>t.jsx("div",{children:te?t.jsxs("div",{className:$(te),onClick:()=>G(te),children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:te.getDate()}),V(te).length>0&&t.jsxs("div",{className:"space-y-1",children:[V(te).slice(0,2).map(me=>{var Ce,Ae;return t.jsx("div",{className:"text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded truncate",title:`${(Ce=me.customer)==null?void 0:Ce.name} - ${ls(me.total_amount||0)}`,children:(Ae=me.customer)==null?void 0:Ae.name},me.id)}),V(te).length>2&&t.jsxs("div",{className:"text-xs text-gray-500",children:["+",V(te).length-2," more"]})]})]}):t.jsx("div",{className:"min-h-[80px] p-2"})},je))}),T&&re.length>0&&t.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Deliveries for ",new Date(T).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})]}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(yr,{className:"h-4 w-4"}),t.jsxs("span",{children:[re.length," deliveries"]})]})]}),t.jsx("div",{className:"space-y-3",children:re.map(te=>{var je,me,Ce,Ae;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",onClick:()=>d(te),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(hs,{className:"h-4 w-4 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:(je=te.customer)==null?void 0:je.name}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(Tn,{className:"h-3 w-3"}),t.jsxs("span",{children:[(me=te.delivery_address)==null?void 0:me.city,", ",(Ce=te.delivery_address)==null?void 0:Ce.state]})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(te.total_amount||0)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[((Ae=te.order_lines)==null?void 0:Ae.length)||0," items"]})]})]},te.id)})}),t.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"h-4 w-4 text-blue-600"}),t.jsx("span",{className:"text-blue-800",children:"Estimated Route Time:"})]}),t.jsxs("span",{className:"font-medium text-blue-900",children:[Math.ceil(re.length*.5)," hours"]})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[t.jsx("span",{className:"text-blue-800",children:"Total Revenue:"}),t.jsx("span",{className:"font-medium text-blue-900",children:ls(re.reduce((te,je)=>te+(je.total_amount||0),0))})]})]})]})]})},XC=()=>{const c=Qr(),[d,f]=le.useState(null),[g,w]=le.useState([]),{data:N}=Eb({status:"scheduled",limit:1e3}),T=(N==null?void 0:N.orders)||[],A=W=>{c(`/orders/${W.id}`)},n=(W,$)=>{f(W),w($)},M=async(W,$)=>{console.log("Reschedule order",W,"to",$)},z=()=>{const W=new Date().toISOString().split("T")[0];return T.filter($=>$.scheduled_date===W)},V=()=>{const W=new Date().toISOString().split("T")[0];return T.filter($=>$.scheduled_date&&$.scheduled_date>W)},U=z(),G=V();return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Delivery Schedule"})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:t.jsx($s,{className:"h-6 w-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Deliveries"}),t.jsx("p",{className:"text-3xl font-bold text-blue-600",children:U.length}),t.jsxs("p",{className:"text-sm text-gray-600",children:[U.reduce((W,$)=>W+($.total_amount||0),0).toLocaleString("en-US",{style:"currency",currency:"USD"})," total value"]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:t.jsx(yr,{className:"h-6 w-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Deliveries"}),t.jsx("p",{className:"text-3xl font-bold text-green-600",children:G.length}),t.jsx("p",{className:"text-sm text-gray-600",children:"Next 30 days"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:t.jsx(hs,{className:"h-6 w-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Scheduled"}),t.jsx("p",{className:"text-3xl font-bold text-purple-600",children:T.length}),t.jsx("p",{className:"text-sm text-gray-600",children:"All scheduled orders"})]})]})})]}),t.jsx(HC,{orders:T,onOrderClick:A,onDateChange:n,onReschedule:M}),U.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Today's Delivery Route"}),t.jsx("div",{className:"space-y-3",children:U.map((W,$)=>{var K,ue,re,te;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>A(W),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:$+1}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:(K=W.customer)==null?void 0:K.name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[(ue=W.delivery_address)==null?void 0:ue.city,", ",(re=W.delivery_address)==null?void 0:re.state]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:(W.total_amount||0).toLocaleString("en-US",{style:"currency",currency:"USD"})}),t.jsxs("div",{className:"text-sm text-gray-600",children:[((te=W.order_lines)==null?void 0:te.length)||0," items"]})]})]},W.id)})}),t.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Estimated Route Time:"}),t.jsxs("span",{className:"font-medium text-gray-900",children:[Math.ceil(U.length*.5)," hours"]})]}),t.jsxs("div",{className:"flex justify-between text-sm mt-1",children:[t.jsx("span",{className:"text-gray-600",children:"Total Stops:"}),t.jsx("span",{className:"font-medium text-gray-900",children:U.length})]})]})]})]})},KC=({analytics:c,dateRange:d,onDateRangeChange:f})=>{const[g,w]=le.useState("overview"),N=n=>`${n.toFixed(1)}%`,T=n=>({draft:"bg-gray-500",confirmed:"bg-blue-500",scheduled:"bg-purple-500",en_route:"bg-orange-500",delivered:"bg-green-500",invoiced:"bg-teal-500",cancelled:"bg-red-500"})[n]||"bg-gray-500",A=[{id:"overview",label:"Overview",icon:Xo},{id:"trends",label:"Trends",icon:Ji},{id:"customers",label:"Customers",icon:rc},{id:"products",label:"Products",icon:hs},{id:"delivery",label:"Delivery",icon:Qi}];return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Order Analytics"}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:d.start,onChange:n=>f({...d,start:n.target.value}),className:"text-sm border border-gray-300 rounded px-2 py-1"}),t.jsx("span",{className:"text-gray-500",children:"to"}),t.jsx("input",{type:"date",value:d.end,onChange:n=>f({...d,end:n.target.value}),className:"text-sm border border-gray-300 rounded px-2 py-1"})]})})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"flex space-x-8 px-6",children:A.map(n=>t.jsxs("button",{onClick:()=>w(n.id),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${g===n.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(n.icon,{className:"h-4 w-4"}),t.jsx("span",{children:n.label})]},n.id))})}),t.jsxs("div",{className:"p-6",children:[g==="overview"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Orders by Status"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx("div",{className:"space-y-3",children:c.orders_by_status.map(n=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${T(n.status)}`}),t.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:n.status.replace("_"," ")})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm text-gray-600",children:n.count}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",N(n.percentage),")"]})]})]},n.status))}),t.jsx("div",{className:"relative",children:t.jsx("div",{className:"w-48 h-48 mx-auto relative",children:t.jsx("div",{className:"w-full h-full rounded-full bg-gray-200 relative overflow-hidden",children:c.orders_by_status.map((n,M)=>{const z=c.orders_by_status.slice(0,M).reduce((U,G)=>U+G.percentage,0)*3.6,V=n.percentage*3.6;return t.jsx("div",{className:`absolute inset-0 ${T(n.status)} opacity-80`,style:{clipPath:`polygon(50% 50%, ${50+50*Math.cos((z-90)*Math.PI/180)}% ${50+50*Math.sin((z-90)*Math.PI/180)}%, ${50+50*Math.cos((z+V-90)*Math.PI/180)}% ${50+50*Math.sin((z+V-90)*Math.PI/180)}%)`}},n.status)})})})})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Delivery Performance"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"h-5 w-5 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-900",children:"On-Time Deliveries"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-2xl font-bold text-green-900",children:c.delivery_performance.on_time_deliveries}),t.jsxs("div",{className:"text-sm text-green-700",children:[N(c.delivery_performance.on_time_deliveries+c.delivery_performance.late_deliveries>0?c.delivery_performance.on_time_deliveries/(c.delivery_performance.on_time_deliveries+c.delivery_performance.late_deliveries)*100:0)," success rate"]})]})]}),t.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"h-5 w-5 text-red-600"}),t.jsx("span",{className:"text-sm font-medium text-red-900",children:"Late Deliveries"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-2xl font-bold text-red-900",children:c.delivery_performance.late_deliveries}),t.jsx("div",{className:"text-sm text-red-700",children:"Need attention"})]})]}),t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ji,{className:"h-5 w-5 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Avg Fulfillment"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[c.delivery_performance.avg_fulfillment_time,"h"]}),t.jsx("div",{className:"text-sm text-blue-700",children:"Average time"})]})]})]})]})]}),g==="trends"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Daily Order Trends"}),t.jsx("div",{className:"space-y-4",children:c.daily_trends.slice(-7).map(n=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:new Date(n.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.orders," orders"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(n.orders>0?n.revenue/n.orders:0)," avg"]})]})]},n.date))})]}),g==="customers"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Top Customers"}),t.jsx("div",{className:"space-y-3",children:c.top_customers.map((n,M)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["#",M+1]})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.customer_name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.order_count," orders"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(n.total_revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(n.order_count>0?n.total_revenue/n.order_count:0)," avg"]})]})]},n.customer_id))})]}),g==="products"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Top Products"}),t.jsx("div",{className:"space-y-3",children:c.top_products.map((n,M)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-green-600",children:["#",M+1]})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.product_name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.quantity_sold," units sold"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(n.quantity_sold>0?n.revenue/n.quantity_sold:0)," per unit"]})]})]},n.product_id))})]}),g==="delivery"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Regional Breakdown"}),t.jsx("div",{className:"space-y-3",children:c.regional_breakdown.map((n,M)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Tn,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.region}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.order_count," orders"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:ls(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[ls(n.order_count>0?n.revenue/n.order_count:0)," avg"]})]})]},n.region))})]})]})]})]})},QC=()=>{const c=Qr(),[d,f]=le.useState({start:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),{data:g,isLoading:w}=RC(d.start,d.end),N=g||{orders_by_status:[],daily_trends:[],top_customers:[],top_products:[],delivery_performance:{on_time_deliveries:0,late_deliveries:0,avg_fulfillment_time:0},regional_breakdown:[]},T=()=>{if(!g)return;const A=[["Date Range",`${d.start} to ${d.end}`],["Total Orders",g.summary.totalOrders.toString()],["Total Revenue",g.summary.totalRevenue.toString()],["Average Order Value",g.summary.avgOrderValue.toString()],["Completion Rate",`${g.summary.completionRate.toFixed(1)}%`],[],["Status","Count","Percentage"],...N.orders_by_status.map(V=>[V.status,V.count.toString(),`${V.percentage.toFixed(1)}%`]),[],["Top Customers","Orders","Revenue"],...N.top_customers.map(V=>[V.customer_name,V.order_count.toString(),V.total_revenue.toString()])].map(V=>V.join(",")).join(`
`),n=new Blob([A],{type:"text/csv"}),M=window.URL.createObjectURL(n),z=document.createElement("a");z.href=M,z.download=`order-report-${d.start}-to-${d.end}.csv`,document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(M)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Mr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Reports & Analytics"})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("button",{onClick:T,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(qf,{className:"h-4 w-4"}),t.jsx("span",{children:"Export Report"})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Xo,{className:"h-8 w-8 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Orders"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((g==null?void 0:g.summary.totalOrders)||0).toLocaleString()})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($s,{className:"h-8 w-8 text-green-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((g==null?void 0:g.summary.totalRevenue)||0).toLocaleString("en-US",{style:"currency",currency:"USD"})})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Xo,{className:"h-8 w-8 text-purple-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Avg Order Value"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((g==null?void 0:g.summary.avgOrderValue)||0).toLocaleString("en-US",{style:"currency",currency:"USD"})})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($s,{className:"h-8 w-8 text-orange-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Completion Rate"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":`${((g==null?void 0:g.summary.completionRate)||0).toFixed(1)}%`})]})]})})]}),t.jsx(KC,{analytics:N,dateRange:d,onDateRangeChange:f})]})},JC=({warehouseId:c})=>{const{data:d=[],isLoading:f,error:g}=Sb(c);return c?f?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(tr,{className:"h-8 w-8 animate-spin text-blue-500"})}):g?t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:g.message||"Failed to load warehouse inventory"})})})}):d.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Inventory"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This warehouse has no inventory yet."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(w=>{var N,T;return t.jsxs("tr",{children:[" ",t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((N=w.product)==null?void 0:N.name)||w.product_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:((T=w.product)==null?void 0:T.sku)||w.product_sku})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:w.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:w.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:new Date(w.updated_at).toLocaleString()})})]},w.id||`${w.product_id}`)})})]})}):null},Ab=({isOpen:c,onClose:d,onSelect:f})=>{const[g,w]=le.useState(""),{data:N}=cc({search:g,limit:1e3}),T=(N==null?void 0:N.products)||[];return c?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Select Product"}),t.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",children:t.jsx(er,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"p-4 border-b",children:t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:g,onChange:A=>w(A.target.value),placeholder:"Search by product name or SKU...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:T.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No products found"})]}):t.jsx("div",{className:"space-y-2",children:T.map(A=>t.jsx("button",{onClick:()=>{f(A),d()},className:"w-full text-left p-3 hover:bg-blue-50 rounded-lg transition-colors",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:A.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",A.sku,"  ",A.unit_of_measure]})]}),t.jsx("div",{className:"text-sm text-gray-500",children:A.unit_of_measure})]})},A.id))})})]})}):null},YC=({onSuccess:c})=>{var tt,Pe;const[d,f]=le.useState(""),[g,w]=le.useState(""),[N,T]=le.useState([]),[A,n]=le.useState(!1),[M,z]=le.useState(!1),[V,U]=le.useState(null),[G,W]=le.useState(""),{data:$=[]}=tg(),[K,ue]=le.useState(!1),[re,te]=le.useState(null),{data:je}=_t.trucks.list.useQuery({active:!0}),me=(je==null?void 0:je.trucks)||[],Ce=_t.transfers.create.useMutation(),Ae=async Te=>{Te.preventDefault(),n(!0),U(null);try{if(!d)throw new Error("Please select a truck");if(!g)throw new Error("Please select a warehouse");if(N.length===0)throw new Error("Please add at least one product");if(N.filter(ft=>(!ft.qty_full||ft.qty_full<0)&&(!ft.qty_empty||ft.qty_empty<0)).length>0)throw new Error("Please enter valid quantities for all products");if(N.filter(ft=>(ft.qty_full||0)===0&&(ft.qty_empty||0)===0).length>0)throw new Error("Each line must have at least one full or empty cylinder");const yt={truck_id:d,warehouse_id:g,lines:N.map(ft=>({product_id:ft.product_id,qty_full:ft.qty_full||0,qty_empty:ft.qty_empty||0}))};console.log("Creating transfer with data:",yt);const pt=await Ce.mutateAsync({source_warehouse_id:yt.warehouse_id,destination_warehouse_id:"",transfer_date:new Date().toISOString().split("T")[0],items:yt.lines.map(ft=>({product_id:ft.product_id,quantity_to_transfer:(ft.qty_full||0)+(ft.qty_empty||0)}))});console.log("Transfer created successfully:",pt),f(""),w(""),T([]),z(!1),c&&c()}catch(rt){console.error("Transfer creation error:",rt),U(rt.message||"Failed to create transfer")}finally{n(!1)}},fe=()=>{te(N.length),ue(!0)},Ie=Te=>{if(re!==null){const rt=[...N];re<N.length?rt[re]={...rt[re],product_id:Te.id,product_name:Te.name,product_sku:Te.sku,unit_of_measure:Te.unit_of_measure}:rt.push({product_id:Te.id,product_name:Te.name,product_sku:Te.sku,unit_of_measure:Te.unit_of_measure,qty_full:"",qty_empty:""}),T(rt)}ue(!1),te(null)},Ee=me.filter(Te=>{var rt,gt;return((rt=Te.fleet_number)==null?void 0:rt.toLowerCase().includes(G.toLowerCase()))||((gt=Te.license_plate)==null?void 0:gt.toLowerCase().includes(G.toLowerCase()))});return t.jsxs("div",{className:"space-y-6",children:[V&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:V})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Source Warehouse"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:g,onChange:Te=>w(Te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select a warehouse..."}),$.map(Te=>t.jsx("option",{value:Te.id,children:Te.name},Te.id))]}),t.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Truck"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:G,onChange:Te=>W(Te.target.value),placeholder:"Search by fleet number or license plate...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),G&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:t.jsx("div",{className:"max-h-60 overflow-auto",children:Ee.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No trucks found"}):Ee.map(Te=>t.jsxs("div",{onClick:()=>{f(Te.id),W("")},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(yr,{className:"inline h-4 w-4 mr-1"}),Te.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",Te.license_plate]})]},Te.id))})})]}),d&&t.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(yr,{className:"inline h-4 w-4 mr-1"}),(tt=me.find(Te=>Te.id===d))==null?void 0:tt.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",(Pe=me.find(Te=>Te.id===d))==null?void 0:Pe.license_plate]})]}),t.jsx("button",{onClick:()=>f(""),className:"text-gray-400 hover:text-gray-600",children:t.jsx(er,{className:"h-4 w-4"})})]})})]})]}),g&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Source Warehouse Inventory"}),t.jsx(JC,{warehouseId:g})]}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transfer Lines"}),t.jsxs("button",{type:"button",onClick:fe,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]}),t.jsx("div",{className:"space-y-4",children:N.map((Te,rt)=>t.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:Te.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Te.product_sku]})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Te.qty_full,onChange:gt=>{const yt=[...N];yt[rt].qty_full=gt.target.value===""?"":parseInt(gt.target.value),T(yt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Te.qty_empty,onChange:gt=>{const yt=[...N];yt[rt].qty_empty=gt.target.value===""?"":parseInt(gt.target.value),T(yt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx("button",{type:"button",onClick:()=>{const gt=[...N];gt.splice(rt,1),T(gt)},className:"text-red-600 hover:text-red-800",children:t.jsx(er,{className:"h-5 w-5"})})]},rt))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>z(!0),disabled:A||!d||!g||N.length===0,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Transfer"})}),t.jsx(so,{isOpen:M,onClose:()=>z(!1),onConfirm:Ae,title:"Confirm Transfer",message:"Are you sure you want to create this transfer? This will move inventory from the warehouse to the truck.",confirmText:"Create Transfer",type:"info",loading:A}),t.jsx(Ab,{isOpen:K,onClose:()=>{ue(!1),te(null)},onSelect:Ie})]})},ek=({truckId:c})=>{const{data:d,isLoading:f,error:g}=_t.trucks.get.useQuery({id:c}),w=(g==null?void 0:g.message)||null,N=(d==null?void 0:d.inventory)||[];return f?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(tr,{className:"h-8 w-8 animate-spin text-blue-500"})}):w?t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:w})})})}):N.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Inventory"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This truck has no inventory yet."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(T=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:T.product_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:T.product_sku})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:T.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:T.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:new Date(T.updated_at).toLocaleString()})})]},T.product_id))})]})})},tk=({onSuccess:c})=>{var tt,Pe;const[d,f]=le.useState(""),[g,w]=le.useState(""),[N,T]=le.useState([]),[A,n]=le.useState(!1),[M,z]=le.useState(!1),[V,U]=le.useState(null),[G,W]=le.useState(""),{data:$=[]}=tg(),[K,ue]=le.useState(!1),[re,te]=le.useState(null),{data:je}=_t.trucks.list.useQuery({active:!0}),me=(je==null?void 0:je.trucks)||[],Ce=_t.transfers.create.useMutation(),Ae=async Te=>{Te.preventDefault(),n(!0),U(null);try{if(!d)throw new Error("Please select a truck");if(!g)throw new Error("Please select a warehouse");if(N.length===0)throw new Error("Please add at least one product");if(N.filter(ft=>(!ft.qty_full||ft.qty_full<0)&&(!ft.qty_empty||ft.qty_empty<0)).length>0)throw new Error("Please enter valid quantities for all products");if(N.filter(ft=>(ft.qty_full||0)===0&&(ft.qty_empty||0)===0).length>0)throw new Error("Each line must have at least one full or empty cylinder");const yt={truck_id:d,warehouse_id:g,lines:N.map(ft=>({product_id:ft.product_id,qty_full:ft.qty_full||0,qty_empty:ft.qty_empty||0}))};console.log("Creating transfer with data:",yt);const pt=await Ce.mutateAsync({source_warehouse_id:"",destination_warehouse_id:yt.warehouse_id,transfer_date:new Date().toISOString().split("T")[0],items:yt.lines.map(ft=>({product_id:ft.product_id,quantity_to_transfer:(ft.qty_full||0)+(ft.qty_empty||0)}))});console.log("Transfer created successfully:",pt),f(""),w(""),T([]),z(!1),c&&c()}catch(rt){console.error("Transfer creation error:",rt),U(rt.message||"Failed to create transfer")}finally{n(!1)}},fe=()=>{te(N.length),ue(!0)},Ie=Te=>{if(re!==null){const rt=[...N];re<N.length?rt[re]={...rt[re],product_id:Te.id,product_name:Te.name,product_sku:Te.sku,unit_of_measure:Te.unit_of_measure}:rt.push({product_id:Te.id,product_name:Te.name,product_sku:Te.sku,unit_of_measure:Te.unit_of_measure,qty_full:"",qty_empty:""}),T(rt)}ue(!1),te(null)},Ee=me.filter(Te=>{var rt,gt;return((rt=Te.fleet_number)==null?void 0:rt.toLowerCase().includes(G.toLowerCase()))||((gt=Te.license_plate)==null?void 0:gt.toLowerCase().includes(G.toLowerCase()))});return t.jsxs("div",{className:"space-y-6",children:[V&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:V})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Truck"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Yi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:G,onChange:Te=>W(Te.target.value),placeholder:"Search by fleet number or license plate...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),G&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:t.jsx("div",{className:"max-h-60 overflow-auto",children:Ee.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No trucks found"}):Ee.map(Te=>t.jsxs("div",{onClick:()=>{f(Te.id),W("")},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(yr,{className:"inline h-4 w-4 mr-1"}),Te.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",Te.license_plate]})]},Te.id))})})]}),d&&t.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(yr,{className:"inline h-4 w-4 mr-1"}),(tt=me.find(Te=>Te.id===d))==null?void 0:tt.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",(Pe=me.find(Te=>Te.id===d))==null?void 0:Pe.license_plate]})]}),t.jsx("button",{onClick:()=>f(""),className:"text-gray-400 hover:text-gray-600",children:t.jsx(er,{className:"h-4 w-4"})})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Destination Warehouse"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:g,onChange:Te=>w(Te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select a warehouse..."}),$.map(Te=>t.jsx("option",{value:Te.id,children:Te.name},Te.id))]}),t.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]})]}),d&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Truck Inventory"}),t.jsx(ek,{truckId:d})]}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transfer Lines"}),t.jsxs("button",{type:"button",onClick:fe,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]}),t.jsx("div",{className:"space-y-4",children:N.map((Te,rt)=>t.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:Te.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Te.product_sku]})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Te.qty_full,onChange:gt=>{const yt=[...N];yt[rt].qty_full=gt.target.value===""?"":parseInt(gt.target.value),T(yt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Te.qty_empty,onChange:gt=>{const yt=[...N];yt[rt].qty_empty=gt.target.value===""?"":parseInt(gt.target.value),T(yt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx("button",{type:"button",onClick:()=>{const gt=[...N];gt.splice(rt,1),T(gt)},className:"text-red-600 hover:text-red-800",children:t.jsx(er,{className:"h-5 w-5"})})]},rt))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>z(!0),disabled:A||!d||!g||N.length===0,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Transfer"})}),t.jsx(so,{isOpen:M,onClose:()=>z(!1),onConfirm:Ae,title:"Confirm Transfer",message:"Are you sure you want to create this transfer? This will move inventory from the truck to the warehouse.",confirmText:"Create Transfer",type:"info",loading:A}),t.jsx(Ab,{isOpen:K,onClose:()=>{ue(!1),te(null)},onSelect:Ie})]})},sk=c=>{const[d,f]=le.useState(null),{data:g,isLoading:w,refetch:N}=_t.transfers.list.useQuery({source_warehouse_id:c==null?void 0:c.source_warehouse_id,destination_warehouse_id:c==null?void 0:c.destination_warehouse_id,status:c==null?void 0:c.status,transfer_type:c==null?void 0:c.transfer_type,date_from:c==null?void 0:c.date_from,date_to:c==null?void 0:c.date_to,created_by_user_id:c==null?void 0:c.created_by_user_id,search_text:c==null?void 0:c.search_text,page:1,limit:20,sort_by:"created_at",sort_order:"desc"},{retry:1,staleTime:3e4,onError:re=>{f(re.message),It.error("Failed to fetch transfers")}}),T=(g==null?void 0:g.transfers)||[],A=(g==null?void 0:g.totalCount)||0,n=le.useCallback(async re=>{try{return await _t.transfers.getWarehouseStock.query({warehouse_id:re})}catch(te){return console.error("Error fetching warehouse stock:",te),f("Failed to fetch warehouse stock"),null}},[]),{data:M,isLoading:z}=_t.transfers.searchProducts.useQuery({search:"",warehouse_id:c==null?void 0:c.source_warehouse_id,include_variants:!0,limit:50},{enabled:!1}),V=_t.transfers.validate.useMutation({onError:re=>{f(re.message),It.error("Transfer validation failed")}}),U=_t.transfers.create.useMutation({onSuccess:()=>{It.success("Transfer created successfully"),N()},onError:re=>{f(re.message),It.error("Failed to create transfer")}}),G=_t.transfers.updateStatus.useMutation({onSuccess:()=>{It.success("Transfer status updated"),N()},onError:re=>{f(re.message),It.error("Failed to update transfer status")}}),W=le.useCallback(async re=>{try{return f(null),await V.mutateAsync(re)}catch(te){return console.error("Transfer validation error:",te),{isValid:!1,errors:[te.message||"Validation failed"],warnings:[]}}},[V]),$=le.useCallback(async re=>{try{return f(null),await U.mutateAsync(re)}catch(te){return console.error("Create transfer error:",te),null}},[U]),K=le.useCallback(async(re,te,je)=>{try{f(null),await G.mutateAsync({transfer_id:re,status:te,notes:je})}catch(me){console.error("Update transfer status error:",me)}},[G]),{data:ue}=_t.transfers.getCostAnalysis.useQuery({transfer_id:""},{enabled:!1});return{transfers:T,totalCount:A,loading:w,error:d,products:(M==null?void 0:M.products)||[],productsLoading:z,fetchTransfers:N,fetchWarehouseStock:n,validateTransfer:W,createTransfer:$,updateTransferStatus:K,costAnalysis:ue,isValidating:V.isLoading,isCreating:U.isLoading,isUpdating:G.isLoading}},rk=c=>{const{data:d,isLoading:f,refetch:g}=_t.transfers.searchProducts.useQuery({search:"",warehouse_id:c,include_variants:!0,limit:100},{enabled:!!c,retry:1,staleTime:6e4});return{products:(d==null?void 0:d.products)||[],isLoading:f,refetch:g}},Mb=c=>{const{data:d,isLoading:f,refetch:g}=_t.transfers.getWarehouseStock.useQuery({warehouse_id:c||""},{enabled:!!c,retry:1,staleTime:6e4});return{stockInfo:(d==null?void 0:d.stock)||[],isLoading:f,refetch:()=>g(),fetchStockInfo:g}},ik=()=>{const[c,d]=le.useState([]),[f,g]=le.useState([]),[w,N]=le.useState({is_valid:!0,errors:[],warnings:[]}),[T,A]=le.useState(null),n=le.useCallback((V,U,G)=>{const W={product_id:V.id,product_sku:V.sku,product_name:V.name,variant_name:V.variant_name,quantity_to_transfer:U,unit_weight_kg:V.weight_kg||0,total_weight_kg:(V.weight_kg||0)*U,unit_cost:G.unit_cost||0,total_cost:(G.unit_cost||0)*U,available_stock:G.available_quantity||0};d($=>{const K=$.findIndex(ue=>ue.product_id===V.id&&ue.variant_name===V.variant_name);if(K>=0){const ue=[...$];return ue[K]={...ue[K],quantity_to_transfer:U},ue}else return[...$,W]})},[]),M=le.useCallback((V,U)=>{d(G=>G.filter(W=>!(W.product_id===V&&W.variant_name===U)))},[]),z=le.useCallback((V,U,G)=>{const W=[],$=[];(!V||!U)&&W.push("Source and destination warehouses are required"),V===U&&W.push("Source and destination warehouses must be different"),c.length===0&&W.push("At least one item must be selected for transfer"),c.forEach(ue=>{ue.quantity_to_transfer>ue.available_stock&&W.push(`Insufficient stock for ${ue.product_name}: requested ${ue.quantity_to_transfer}, available ${ue.available_stock}`)});const K={is_valid:W.length===0,errors:W,warnings:$};if(N(K),K.is_valid){const ue={total_items:c.length,total_quantity:c.reduce((re,te)=>re+te.quantity_to_transfer,0),total_weight:c.reduce((re,te)=>re+te.total_weight_kg,0),total_cost:c.reduce((re,te)=>re+te.total_cost,0)};A(ue)}return K},[c]);return{selectedItems:c,validationResult:w,transferSummary:T,warehouseStockData:f,setWarehouseStockData:g,addItem:n,removeItem:M,validateTransfer:z}},nk=({warehouseId:c,onProductSelect:d,selectedProductIds:f,disabled:g=!1})=>{const[w,N]=le.useState({warehouse_id:c,has_stock:!0,search_text:"",variant_type:void 0,variant_name:void 0}),[T,A]=le.useState(!1),[n,M]=le.useState({}),{products:z,loading:V,searchProducts:U}=rk(),{stockInfo:G,loading:W,fetchStockInfo:$}=Mb(c);le.useEffect(()=>{w.warehouse_id&&(U(w),$(w))},[w,U,$]);const K=fe=>{N(Ie=>({...Ie,search_text:fe}))},ue=(fe,Ie)=>{N(Ee=>({...Ee,[fe]:Ie}))},re=(fe,Ie)=>{M(Ee=>({...Ee,[fe]:Ie}))},te=fe=>{const Ie=`${fe.id}-${fe.variant_name||"default"}`,Ee=n[Ie]||1,tt=G.find(Pe=>Pe.product_id===fe.id&&Pe.variant_name===fe.variant_name);if(!tt){alert("Stock information not found for this product");return}if(Ee>tt.qty_available){alert(`Quantity exceeds available stock (${tt.qty_available})`);return}d(fe,Ee,tt),M(Pe=>({...Pe,[Ie]:1}))},je=(fe,Ie)=>G.find(Ee=>Ee.product_id===fe&&Ee.variant_name===Ie),me=(fe,Ie)=>{const Ee=`${fe}-${Ie||"default"}`;return f.includes(Ee)},Ce=fe=>!fe||fe.qty_available===0?{status:"out-of-stock",color:"text-red-600 bg-red-100",text:"Out of Stock"}:fe.qty_available<=10?{status:"low-stock",color:"text-yellow-600 bg-yellow-100",text:"Low Stock"}:{status:"in-stock",color:"text-green-600 bg-green-100",text:"In Stock"},Ae=V||W;return t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Products"}),t.jsxs("button",{onClick:()=>A(!T),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-800",children:[t.jsx(Qu,{className:"h-4 w-4"}),t.jsx("span",{children:"Filters"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(Yi,{className:"h-5 w-5 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search products by name or SKU...",value:w.search_text||"",onChange:fe=>K(fe.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),T&&t.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg space-y-4",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Type"}),t.jsxs("select",{value:w.variant_type||"",onChange:fe=>ue("variant_type",fe.target.value||void 0),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"cylinder",children:"Cylinders"}),t.jsx("option",{value:"refillable",children:"Refillable"}),t.jsx("option",{value:"disposable",children:"Disposable"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Variant"}),t.jsxs("select",{value:w.variant_name||"",onChange:fe=>ue("variant_name",fe.target.value||void 0),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"",children:"All Variants"}),t.jsx("option",{value:"full",children:"Full"}),t.jsx("option",{value:"empty",children:"Empty"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Status"}),t.jsxs("select",{value:w.has_stock?"in-stock":"all",onChange:fe=>ue("has_stock",fe.target.value==="in-stock"),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"all",children:"All Products"}),t.jsx("option",{value:"in-stock",children:"In Stock Only"})]})]})]})})]}),t.jsx("div",{className:"p-4",children:Ae?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),t.jsx("span",{className:"ml-2 text-gray-600",children:"Loading products..."})]}):z.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(hs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 mb-2",children:"No products found"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your search criteria or filters"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:z.map(fe=>{const Ie=je(fe.id,fe.variant_name),Ee=Ce(Ie),tt=`${fe.id}-${fe.variant_name||"default"}`,Pe=me(fe.id,fe.variant_name),Te=n[tt]||1;return t.jsxs("div",{className:`border rounded-lg p-4 transition-all duration-200 ${Pe?"border-blue-500 bg-blue-50":g||Ee.status==="out-of-stock"?"border-gray-200 bg-gray-50 opacity-75":"border-gray-300 hover:border-blue-300 hover:shadow-sm"}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:fe.name}),t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["SKU: ",fe.sku]}),fe.variant_name&&t.jsx("span",{className:"inline-block bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded mt-1",children:fe.variant_name})]}),t.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ee.color}`,children:Ee.text})]}),Ie&&t.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Available:"}),t.jsx("span",{className:"font-medium",children:Ie.qty_available})]}),Ie.qty_reserved>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Reserved:"}),t.jsx("span",{children:Ie.qty_reserved})]}),fe.capacity_kg&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Weight:"}),t.jsxs("span",{children:[fe.capacity_kg,"kg"]})]})]}),Ee.status!=="out-of-stock"&&!g&&t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"number",min:"1",max:(Ie==null?void 0:Ie.qty_available)||999,value:Te,onChange:rt=>re(tt,parseInt(rt.target.value)||1),className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["max ",(Ie==null?void 0:Ie.qty_available)||0]})]})]}),t.jsx("div",{children:Pe?t.jsxs("div",{className:"flex items-center justify-center py-2 text-sm text-blue-600",children:[t.jsx($N,{className:"h-4 w-4 mr-1"}),"Selected"]}):Ee.status==="out-of-stock"?t.jsxs("div",{className:"flex items-center justify-center py-2 text-sm text-gray-500",children:[t.jsx(im,{className:"h-4 w-4 mr-1"}),"Out of Stock"]}):t.jsxs("button",{onClick:()=>te(fe),disabled:g||Te>((Ie==null?void 0:Ie.qty_available)||0),className:`w-full flex items-center justify-center py-2 px-3 text-sm font-medium rounded-md ${g||Te>((Ie==null?void 0:Ie.qty_available)||0)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[t.jsx(wr,{className:"h-4 w-4 mr-1"}),"Add to Transfer"]})})]},tt)})})}),z.length>0&&t.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50 text-sm text-gray-600",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{children:["Showing ",z.length," product",z.length!==1?"s":""]}),t.jsxs("span",{children:[f.length," selected for transfer"]})]})})]})};async function ak(c){try{return await _t.transfers.formatValidationErrors.mutate({validation_result:c})}catch(d){throw console.error("Failed to format validation errors via API:",d),new Error("Validation error formatting failed. Please try again.")}}function ok(c,d,f){const g=f?new Date(f):new Date,w=g.toISOString().slice(0,10).replace(/-/g,""),N=g.toISOString().slice(11,19).replace(/:/g,""),T=c.slice(-4).toUpperCase(),A=d.slice(-4).toUpperCase();return`TRF-${w}-${N}-${T}-${A}`}const j0=({summary:c,validationResult:d,selectedItems:f,onRemoveItem:g,showItemDetails:w=!0})=>{var n,M;if(!c||f.length===0)return t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:t.jsxs("div",{className:"text-center text-gray-500",children:[t.jsx(hs,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{children:"No items selected for transfer"})]})});const N=d?ak(d):[],T=d&&!d.is_valid,A=d&&d.warnings.length>0;return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(hs,{className:"h-5 w-5 text-blue-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Items"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_products})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ji,{className:"h-5 w-5 text-green-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Quantity"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_quantity})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Nf,{className:"h-5 w-5 text-purple-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Weight"}),t.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[c.total_weight_kg.toFixed(1),"kg"]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(yr,{className:"h-5 w-5 text-orange-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Variants"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.unique_variants})]})]})})]}),d&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center mb-3",children:[T?t.jsx(pa,{className:"h-5 w-5 text-red-500 mr-2"}):A?t.jsx(Us,{className:"h-5 w-5 text-yellow-500 mr-2"}):t.jsx($n,{className:"h-5 w-5 text-green-500 mr-2"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Validation Status"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.validation_summary.valid_items}),t.jsx("p",{className:"text-sm text-gray-600",children:"Valid Items"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.validation_summary.invalid_items}),t.jsx("p",{className:"text-sm text-gray-600",children:"Invalid Items"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.validation_summary.items_with_warnings}),t.jsx("p",{className:"text-sm text-gray-600",children:"Warnings"})]})]}),N.length>0&&t.jsx("div",{className:"space-y-2",children:N.map((z,V)=>t.jsxs("div",{className:`flex items-start p-3 rounded-md ${z.severity==="error"?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[z.severity==="error"?t.jsx(pa,{className:"h-4 w-4 text-red-500 mr-2 mt-0.5 flex-shrink-0"}):t.jsx(Us,{className:"h-4 w-4 text-yellow-500 mr-2 mt-0.5 flex-shrink-0"}),t.jsx("span",{className:`text-sm ${z.severity==="error"?"text-red-700":"text-yellow-700"}`,children:z.message})]},V))})]}),w&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Selected Items"})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"space-y-3",children:f.map((z,V)=>t.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${z.is_valid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center mb-1",children:[t.jsx("h4",{className:"font-medium text-gray-900 mr-2",children:z.product_name}),z.variant_name&&t.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:z.variant_name}),!z.is_valid&&t.jsx(pa,{className:"h-4 w-4 text-red-500 ml-2"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("span",{children:["SKU: ",z.product_sku]}),t.jsx("span",{className:"mx-2",children:""}),t.jsxs("span",{children:["Qty: ",z.quantity_to_transfer]}),z.total_weight_kg&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mx-2",children:""}),t.jsxs("span",{children:["Weight: ",z.total_weight_kg.toFixed(1),"kg"]})]})]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Available: ",z.available_stock,z.reserved_stock&&z.reserved_stock>0&&t.jsxs("span",{children:["  Reserved: ",z.reserved_stock]})]}),(z.validation_errors.length>0||z.validation_warnings.length>0)&&t.jsxs("div",{className:"mt-2 space-y-1",children:[z.validation_errors.map((U,G)=>t.jsxs("div",{className:"text-xs text-red-600 flex items-center",children:[t.jsx(pa,{className:"h-3 w-3 mr-1"}),U]},G)),z.validation_warnings.map((U,G)=>t.jsxs("div",{className:"text-xs text-yellow-600 flex items-center",children:[t.jsx(Us,{className:"h-3 w-3 mr-1"}),U]},G))]})]}),g&&t.jsx("button",{onClick:()=>g(z.product_id,z.variant_name),className:"ml-4 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full",title:"Remove item",children:t.jsx(pa,{className:"h-4 w-4"})})]},`${z.product_id}-${z.variant_name||"default"}`))})})]}),(c.heaviest_item||c.most_expensive_item)&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Additional Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.heaviest_item&&t.jsxs("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(Nf,{className:"h-4 w-4 text-purple-500 mr-2"}),t.jsx("span",{className:"font-medium text-purple-700",children:"Heaviest Item"})]}),t.jsxs("p",{className:"text-sm text-purple-600",children:[c.heaviest_item.product_name," - ",(n=c.heaviest_item.total_weight_kg)==null?void 0:n.toFixed(1),"kg"]})]}),c.most_expensive_item&&c.total_cost&&t.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(Ji,{className:"h-4 w-4 text-green-500 mr-2"}),t.jsx("span",{className:"font-medium text-green-700",children:"Most Expensive Item"})]}),t.jsxs("p",{className:"text-sm text-green-600",children:[c.most_expensive_item.product_name," - $",(M=c.most_expensive_item.total_cost)==null?void 0:M.toFixed(2)]})]})]}),c.total_cost&&t.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-blue-700",children:"Estimated Total Cost"}),t.jsxs("span",{className:"text-lg font-bold text-blue-900",children:["$",c.total_cost.toFixed(2)]})]})})]})]})},lk=({onTransferCreated:c,onCancel:d,initialSourceWarehouseId:f,initialDestinationWarehouseId:g})=>{var Te,rt;const[w,N]=le.useState({source_warehouse_id:f||"",destination_warehouse_id:g||"",transfer_date:new Date().toISOString().split("T")[0],priority:"normal",transfer_reference:"",reason:"",notes:"",instructions:"",selected_items:[]}),[T,A]=le.useState("setup"),{data:n}=eg(),M=(n==null?void 0:n.warehouses)||[],{createTransfer:z,loading:V}=sk(),{selectedItems:U,validationResult:G,transferSummary:W,setWarehouseStockData:$,addItem:K,removeItem:ue,validateTransfer:re}=ik(),{stockInfo:te,fetchStockInfo:je}=Mb();le.useEffect(()=>{if(w.source_warehouse_id&&w.destination_warehouse_id&&!w.transfer_reference&&M.length>0){const gt=M.find(pt=>pt.id===w.source_warehouse_id),yt=M.find(pt=>pt.id===w.destination_warehouse_id);if(gt&&yt){const pt=ok(gt.name.substring(0,3).toUpperCase(),yt.name.substring(0,3).toUpperCase(),w.transfer_date);N(ft=>({...ft,transfer_reference:pt}))}}},[w.source_warehouse_id,w.destination_warehouse_id,w.transfer_date,M]),le.useEffect(()=>{w.source_warehouse_id&&je({warehouse_id:w.source_warehouse_id,has_stock:!0})},[w.source_warehouse_id,je]),le.useEffect(()=>{$(te)},[te,$]),le.useEffect(()=>{U.length>0&&w.source_warehouse_id&&w.destination_warehouse_id&&re(w.source_warehouse_id,w.destination_warehouse_id,w.transfer_date)},[U,w,re]);const me=(gt,yt)=>{N(pt=>({...pt,[gt]:yt}))},Ce=(gt,yt,pt)=>{K(gt,yt,pt)},Ae=(gt,yt)=>{ue(gt,yt)},fe=()=>{if(T==="setup"){if(!w.source_warehouse_id||!w.destination_warehouse_id){alert("Please select both source and destination warehouses");return}if(w.source_warehouse_id===w.destination_warehouse_id){alert("Source and destination warehouses must be different");return}A("products")}else if(T==="products"){if(U.length===0){alert("Please select at least one product for transfer");return}A("review")}},Ie=()=>{T==="products"?A("setup"):T==="review"&&A("products")},Ee=async()=>{if(!(G!=null&&G.is_valid)){alert("Please fix validation errors before submitting");return}try{const gt={source_warehouse_id:w.source_warehouse_id,destination_warehouse_id:w.destination_warehouse_id,transfer_date:w.transfer_date,items:U.map(pt=>({product_id:pt.product_id,product_sku:pt.product_sku,product_name:pt.product_name,variant_name:pt.variant_name,quantity_to_transfer:pt.quantity_to_transfer,unit_weight_kg:pt.unit_weight_kg,total_weight_kg:pt.total_weight_kg,unit_cost:pt.unit_cost,total_cost:pt.total_cost})),notes:w.notes,reason:w.reason,priority:w.priority,transfer_reference:w.transfer_reference},yt=await z(gt);yt&&c&&c(yt.id)}catch(gt){console.error("Error submitting transfer:",gt)}},tt=()=>T==="setup"?w.source_warehouse_id&&w.destination_warehouse_id&&w.source_warehouse_id!==w.destination_warehouse_id:T==="products"?U.length>0:!0,Pe=U.map(gt=>`${gt.product_id}-${gt.variant_name||"default"}`);return t.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Multi-SKU Transfer"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${T==="setup"?"bg-blue-500 text-white":"bg-blue-100 text-blue-600"}`,children:"1"}),t.jsx("div",{className:"w-8 h-1 bg-gray-200"}),t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${T==="products"?"bg-blue-500 text-white":T==="review"?"bg-blue-100 text-blue-600":"bg-gray-200 text-gray-500"}`,children:"2"}),t.jsx("div",{className:"w-8 h-1 bg-gray-200"}),t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${T==="review"?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:"3"})]})]}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{className:T==="setup"?"font-medium text-blue-600":"",children:"Setup Transfer"}),t.jsx("span",{className:T==="products"?"font-medium text-blue-600":"",children:"Select Products"}),t.jsx("span",{className:T==="review"?"font-medium text-blue-600":"",children:"Review & Submit"})]})]}),T==="setup"&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transfer Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(y_,{className:"h-4 w-4 inline mr-1"}),"Source Warehouse"]}),t.jsx(Qh,{value:w.source_warehouse_id,onChange:gt=>me("source_warehouse_id",gt),placeholder:"Select source warehouse"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Uf,{className:"h-4 w-4 inline mr-1"}),"Destination Warehouse"]}),t.jsx(Qh,{value:w.destination_warehouse_id,onChange:gt=>me("destination_warehouse_id",gt),placeholder:"Select destination warehouse",excludeIds:w.source_warehouse_id?[w.source_warehouse_id]:[]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx($s,{className:"h-4 w-4 inline mr-1"}),"Transfer Date"]}),t.jsx("input",{type:"date",value:w.transfer_date,onChange:gt=>me("transfer_date",gt.target.value),min:new Date().toISOString().split("T")[0],className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),t.jsxs("select",{value:w.priority,onChange:gt=>me("priority",gt.target.value),className:"block w-full border border-gray-300 rounded-md py-2 px-3",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"normal",children:"Normal"}),t.jsx("option",{value:"high",children:"High"}),t.jsx("option",{value:"urgent",children:"Urgent"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Transfer"}),t.jsxs("select",{value:w.reason,onChange:gt=>me("reason",gt.target.value),className:"block w-full border border-gray-300 rounded-md py-2 px-3",children:[t.jsx("option",{value:"",children:"Select reason"}),t.jsx("option",{value:"restock",children:"Restock"}),t.jsx("option",{value:"redistribution",children:"Redistribution"}),t.jsx("option",{value:"shortage",children:"Stock Shortage"}),t.jsx("option",{value:"maintenance",children:"Maintenance"}),t.jsx("option",{value:"optimization",children:"Inventory Optimization"}),t.jsx("option",{value:"other",children:"Other"})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Reference"}),t.jsx("input",{type:"text",value:w.transfer_reference,onChange:gt=>me("transfer_reference",gt.target.value),placeholder:"Auto-generated",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),t.jsx("textarea",{value:w.notes,onChange:gt=>me("notes",gt.target.value),rows:4,placeholder:"Add any additional notes about this transfer...",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions"}),t.jsx("textarea",{value:w.instructions,onChange:gt=>me("instructions",gt.target.value),rows:3,placeholder:"Any special handling instructions...",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]})]})]})]}),T==="products"&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[t.jsx("div",{children:t.jsx(nk,{warehouseId:w.source_warehouse_id,onProductSelect:Ce,selectedProductIds:Pe})}),t.jsx("div",{children:t.jsx(j0,{summary:W,validationResult:G,selectedItems:U,onRemoveItem:Ae,showItemDetails:!0})})]}),T==="review"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transfer Overview"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Source"}),t.jsx("p",{className:"font-medium",children:(Te=M.find(gt=>gt.id===w.source_warehouse_id))==null?void 0:Te.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Destination"}),t.jsx("p",{className:"font-medium",children:(rt=M.find(gt=>gt.id===w.destination_warehouse_id))==null?void 0:rt.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Transfer Date"}),t.jsx("p",{className:"font-medium",children:w.transfer_date})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Priority"}),t.jsx("p",{className:"font-medium capitalize",children:w.priority})]})]})]}),G&&!G.is_valid&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(Us,{className:"h-5 w-5 text-red-500 mr-2"}),t.jsx("h3",{className:"font-semibold text-red-800",children:"Validation Errors"})]}),t.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:G.errors.map((gt,yt)=>t.jsxs("li",{children:[" ",gt]},yt))})]}),t.jsx(j0,{summary:W,validationResult:G,selectedItems:U,onRemoveItem:Ae,showItemDetails:!0})]}),t.jsxs("div",{className:"flex justify-between items-center bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("div",{children:T!=="setup"&&t.jsx("button",{onClick:Ie,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Previous"})}),t.jsxs("div",{className:"flex space-x-3",children:[d&&t.jsx("button",{onClick:d,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),T!=="review"?t.jsx("button",{onClick:fe,disabled:!tt(),className:`px-4 py-2 rounded-md font-medium ${tt()?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"}):t.jsxs("button",{onClick:Ee,disabled:!(G!=null&&G.is_valid)||V,className:`flex items-center px-6 py-2 rounded-md font-medium ${G!=null&&G.is_valid&&!V?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[t.jsx(nS,{className:"h-4 w-4 mr-2"}),V?"Creating...":"Submit Transfer"]})]})]})]})};function Pb(c){var d,f,g="";if(typeof c=="string"||typeof c=="number")g+=c;else if(typeof c=="object")if(Array.isArray(c)){var w=c.length;for(d=0;d<w;d++)c[d]&&(f=Pb(c[d]))&&(g&&(g+=" "),g+=f)}else for(f in c)c[f]&&(g&&(g+=" "),g+=f);return g}function ck(){for(var c,d,f=0,g="",w=arguments.length;f<w;f++)(c=arguments[f])&&(d=Pb(c))&&(g&&(g+=" "),g+=d);return g}const sg="-",uk=c=>{const d=hk(c),{conflictingClassGroups:f,conflictingClassGroupModifiers:g}=c;return{getClassGroupId:T=>{const A=T.split(sg);return A[0]===""&&A.length!==1&&A.shift(),Ib(A,d)||dk(T)},getConflictingClassGroupIds:(T,A)=>{const n=f[T]||[];return A&&g[T]?[...n,...g[T]]:n}}},Ib=(c,d)=>{var T;if(c.length===0)return d.classGroupId;const f=c[0],g=d.nextPart.get(f),w=g?Ib(c.slice(1),g):void 0;if(w)return w;if(d.validators.length===0)return;const N=c.join(sg);return(T=d.validators.find(({validator:A})=>A(N)))==null?void 0:T.classGroupId},N0=/^\[(.+)\]$/,dk=c=>{if(N0.test(c)){const d=N0.exec(c)[1],f=d==null?void 0:d.substring(0,d.indexOf(":"));if(f)return"arbitrary.."+f}},hk=c=>{const{theme:d,prefix:f}=c,g={nextPart:new Map,validators:[]};return pk(Object.entries(c.classGroups),f).forEach(([N,T])=>{If(T,g,N,d)}),g},If=(c,d,f,g)=>{c.forEach(w=>{if(typeof w=="string"){const N=w===""?d:S0(d,w);N.classGroupId=f;return}if(typeof w=="function"){if(mk(w)){If(w(g),d,f,g);return}d.validators.push({validator:w,classGroupId:f});return}Object.entries(w).forEach(([N,T])=>{If(T,S0(d,N),f,g)})})},S0=(c,d)=>{let f=c;return d.split(sg).forEach(g=>{f.nextPart.has(g)||f.nextPart.set(g,{nextPart:new Map,validators:[]}),f=f.nextPart.get(g)}),f},mk=c=>c.isThemeGetter,pk=(c,d)=>d?c.map(([f,g])=>{const w=g.map(N=>typeof N=="string"?d+N:typeof N=="object"?Object.fromEntries(Object.entries(N).map(([T,A])=>[d+T,A])):N);return[f,w]}):c,fk=c=>{if(c<1)return{get:()=>{},set:()=>{}};let d=0,f=new Map,g=new Map;const w=(N,T)=>{f.set(N,T),d++,d>c&&(d=0,g=f,f=new Map)};return{get(N){let T=f.get(N);if(T!==void 0)return T;if((T=g.get(N))!==void 0)return w(N,T),T},set(N,T){f.has(N)?f.set(N,T):w(N,T)}}},Db="!",gk=c=>{const{separator:d,experimentalParseClassName:f}=c,g=d.length===1,w=d[0],N=d.length,T=A=>{const n=[];let M=0,z=0,V;for(let K=0;K<A.length;K++){let ue=A[K];if(M===0){if(ue===w&&(g||A.slice(K,K+N)===d)){n.push(A.slice(z,K)),z=K+N;continue}if(ue==="/"){V=K;continue}}ue==="["?M++:ue==="]"&&M--}const U=n.length===0?A:A.substring(z),G=U.startsWith(Db),W=G?U.substring(1):U,$=V&&V>z?V-z:void 0;return{modifiers:n,hasImportantModifier:G,baseClassName:W,maybePostfixModifierPosition:$}};return f?A=>f({className:A,parseClassName:T}):T},xk=c=>{if(c.length<=1)return c;const d=[];let f=[];return c.forEach(g=>{g[0]==="["?(d.push(...f.sort(),g),f=[]):f.push(g)}),d.push(...f.sort()),d},yk=c=>({cache:fk(c.cacheSize),parseClassName:gk(c),...uk(c)}),_k=/\s+/,bk=(c,d)=>{const{parseClassName:f,getClassGroupId:g,getConflictingClassGroupIds:w}=d,N=[],T=c.trim().split(_k);let A="";for(let n=T.length-1;n>=0;n-=1){const M=T[n],{modifiers:z,hasImportantModifier:V,baseClassName:U,maybePostfixModifierPosition:G}=f(M);let W=!!G,$=g(W?U.substring(0,G):U);if(!$){if(!W){A=M+(A.length>0?" "+A:A);continue}if($=g(U),!$){A=M+(A.length>0?" "+A:A);continue}W=!1}const K=xk(z).join(":"),ue=V?K+Db:K,re=ue+$;if(N.includes(re))continue;N.push(re);const te=w($,W);for(let je=0;je<te.length;++je){const me=te[je];N.push(ue+me)}A=M+(A.length>0?" "+A:A)}return A};function vk(){let c=0,d,f,g="";for(;c<arguments.length;)(d=arguments[c++])&&(f=Lb(d))&&(g&&(g+=" "),g+=f);return g}const Lb=c=>{if(typeof c=="string")return c;let d,f="";for(let g=0;g<c.length;g++)c[g]&&(d=Lb(c[g]))&&(f&&(f+=" "),f+=d);return f};function wk(c,...d){let f,g,w,N=T;function T(n){const M=d.reduce((z,V)=>V(z),c());return f=yk(M),g=f.cache.get,w=f.cache.set,N=A,A(n)}function A(n){const M=g(n);if(M)return M;const z=bk(n,f);return w(n,z),z}return function(){return N(vk.apply(null,arguments))}}const Xs=c=>{const d=f=>f[c]||[];return d.isThemeGetter=!0,d},Rb=/^\[(?:([a-z-]+):)?(.+)\]$/i,jk=/^\d+\/\d+$/,Nk=new Set(["px","full","screen"]),Sk=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Tk=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Ek=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ck=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kk=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ma=c=>ec(c)||Nk.has(c)||jk.test(c),Wa=c=>uc(c,"length",zk),ec=c=>!!c&&!Number.isNaN(Number(c)),uf=c=>uc(c,"number",ec),Gu=c=>!!c&&Number.isInteger(Number(c)),Ak=c=>c.endsWith("%")&&ec(c.slice(0,-1)),us=c=>Rb.test(c),Ha=c=>Sk.test(c),Mk=new Set(["length","size","percentage"]),Pk=c=>uc(c,Mk,zb),Ik=c=>uc(c,"position",zb),Dk=new Set(["image","url"]),Lk=c=>uc(c,Dk,Fk),Rk=c=>uc(c,"",Ok),Zu=()=>!0,uc=(c,d,f)=>{const g=Rb.exec(c);return g?g[1]?typeof d=="string"?g[1]===d:d.has(g[1]):f(g[2]):!1},zk=c=>Tk.test(c)&&!Ek.test(c),zb=()=>!1,Ok=c=>Ck.test(c),Fk=c=>kk.test(c),Bk=()=>{const c=Xs("colors"),d=Xs("spacing"),f=Xs("blur"),g=Xs("brightness"),w=Xs("borderColor"),N=Xs("borderRadius"),T=Xs("borderSpacing"),A=Xs("borderWidth"),n=Xs("contrast"),M=Xs("grayscale"),z=Xs("hueRotate"),V=Xs("invert"),U=Xs("gap"),G=Xs("gradientColorStops"),W=Xs("gradientColorStopPositions"),$=Xs("inset"),K=Xs("margin"),ue=Xs("opacity"),re=Xs("padding"),te=Xs("saturate"),je=Xs("scale"),me=Xs("sepia"),Ce=Xs("skew"),Ae=Xs("space"),fe=Xs("translate"),Ie=()=>["auto","contain","none"],Ee=()=>["auto","hidden","clip","visible","scroll"],tt=()=>["auto",us,d],Pe=()=>[us,d],Te=()=>["",ma,Wa],rt=()=>["auto",ec,us],gt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],yt=()=>["solid","dashed","dotted","double","none"],pt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ft=()=>["start","end","center","between","around","evenly","stretch"],wt=()=>["","0",us],Os=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ns=()=>[ec,us];return{cacheSize:500,separator:":",theme:{colors:[Zu],spacing:[ma,Wa],blur:["none","",Ha,us],brightness:ns(),borderColor:[c],borderRadius:["none","","full",Ha,us],borderSpacing:Pe(),borderWidth:Te(),contrast:ns(),grayscale:wt(),hueRotate:ns(),invert:wt(),gap:Pe(),gradientColorStops:[c],gradientColorStopPositions:[Ak,Wa],inset:tt(),margin:tt(),opacity:ns(),padding:Pe(),saturate:ns(),scale:ns(),sepia:wt(),skew:ns(),space:Pe(),translate:Pe()},classGroups:{aspect:[{aspect:["auto","square","video",us]}],container:["container"],columns:[{columns:[Ha]}],"break-after":[{"break-after":Os()}],"break-before":[{"break-before":Os()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...gt(),us]}],overflow:[{overflow:Ee()}],"overflow-x":[{"overflow-x":Ee()}],"overflow-y":[{"overflow-y":Ee()}],overscroll:[{overscroll:Ie()}],"overscroll-x":[{"overscroll-x":Ie()}],"overscroll-y":[{"overscroll-y":Ie()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[$]}],"inset-x":[{"inset-x":[$]}],"inset-y":[{"inset-y":[$]}],start:[{start:[$]}],end:[{end:[$]}],top:[{top:[$]}],right:[{right:[$]}],bottom:[{bottom:[$]}],left:[{left:[$]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Gu,us]}],basis:[{basis:tt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",us]}],grow:[{grow:wt()}],shrink:[{shrink:wt()}],order:[{order:["first","last","none",Gu,us]}],"grid-cols":[{"grid-cols":[Zu]}],"col-start-end":[{col:["auto",{span:["full",Gu,us]},us]}],"col-start":[{"col-start":rt()}],"col-end":[{"col-end":rt()}],"grid-rows":[{"grid-rows":[Zu]}],"row-start-end":[{row:["auto",{span:[Gu,us]},us]}],"row-start":[{"row-start":rt()}],"row-end":[{"row-end":rt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",us]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",us]}],gap:[{gap:[U]}],"gap-x":[{"gap-x":[U]}],"gap-y":[{"gap-y":[U]}],"justify-content":[{justify:["normal",...ft()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ft(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ft(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[re]}],px:[{px:[re]}],py:[{py:[re]}],ps:[{ps:[re]}],pe:[{pe:[re]}],pt:[{pt:[re]}],pr:[{pr:[re]}],pb:[{pb:[re]}],pl:[{pl:[re]}],m:[{m:[K]}],mx:[{mx:[K]}],my:[{my:[K]}],ms:[{ms:[K]}],me:[{me:[K]}],mt:[{mt:[K]}],mr:[{mr:[K]}],mb:[{mb:[K]}],ml:[{ml:[K]}],"space-x":[{"space-x":[Ae]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ae]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",us,d]}],"min-w":[{"min-w":[us,d,"min","max","fit"]}],"max-w":[{"max-w":[us,d,"none","full","min","max","fit","prose",{screen:[Ha]},Ha]}],h:[{h:[us,d,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[us,d,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[us,d,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[us,d,"auto","min","max","fit"]}],"font-size":[{text:["base",Ha,Wa]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",uf]}],"font-family":[{font:[Zu]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",us]}],"line-clamp":[{"line-clamp":["none",ec,uf]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ma,us]}],"list-image":[{"list-image":["none",us]}],"list-style-type":[{list:["none","disc","decimal",us]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[c]}],"placeholder-opacity":[{"placeholder-opacity":[ue]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[c]}],"text-opacity":[{"text-opacity":[ue]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...yt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ma,Wa]}],"underline-offset":[{"underline-offset":["auto",ma,us]}],"text-decoration-color":[{decoration:[c]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Pe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",us]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",us]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ue]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...gt(),Ik]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Pk]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Lk]}],"bg-color":[{bg:[c]}],"gradient-from-pos":[{from:[W]}],"gradient-via-pos":[{via:[W]}],"gradient-to-pos":[{to:[W]}],"gradient-from":[{from:[G]}],"gradient-via":[{via:[G]}],"gradient-to":[{to:[G]}],rounded:[{rounded:[N]}],"rounded-s":[{"rounded-s":[N]}],"rounded-e":[{"rounded-e":[N]}],"rounded-t":[{"rounded-t":[N]}],"rounded-r":[{"rounded-r":[N]}],"rounded-b":[{"rounded-b":[N]}],"rounded-l":[{"rounded-l":[N]}],"rounded-ss":[{"rounded-ss":[N]}],"rounded-se":[{"rounded-se":[N]}],"rounded-ee":[{"rounded-ee":[N]}],"rounded-es":[{"rounded-es":[N]}],"rounded-tl":[{"rounded-tl":[N]}],"rounded-tr":[{"rounded-tr":[N]}],"rounded-br":[{"rounded-br":[N]}],"rounded-bl":[{"rounded-bl":[N]}],"border-w":[{border:[A]}],"border-w-x":[{"border-x":[A]}],"border-w-y":[{"border-y":[A]}],"border-w-s":[{"border-s":[A]}],"border-w-e":[{"border-e":[A]}],"border-w-t":[{"border-t":[A]}],"border-w-r":[{"border-r":[A]}],"border-w-b":[{"border-b":[A]}],"border-w-l":[{"border-l":[A]}],"border-opacity":[{"border-opacity":[ue]}],"border-style":[{border:[...yt(),"hidden"]}],"divide-x":[{"divide-x":[A]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[A]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ue]}],"divide-style":[{divide:yt()}],"border-color":[{border:[w]}],"border-color-x":[{"border-x":[w]}],"border-color-y":[{"border-y":[w]}],"border-color-s":[{"border-s":[w]}],"border-color-e":[{"border-e":[w]}],"border-color-t":[{"border-t":[w]}],"border-color-r":[{"border-r":[w]}],"border-color-b":[{"border-b":[w]}],"border-color-l":[{"border-l":[w]}],"divide-color":[{divide:[w]}],"outline-style":[{outline:["",...yt()]}],"outline-offset":[{"outline-offset":[ma,us]}],"outline-w":[{outline:[ma,Wa]}],"outline-color":[{outline:[c]}],"ring-w":[{ring:Te()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[c]}],"ring-opacity":[{"ring-opacity":[ue]}],"ring-offset-w":[{"ring-offset":[ma,Wa]}],"ring-offset-color":[{"ring-offset":[c]}],shadow:[{shadow:["","inner","none",Ha,Rk]}],"shadow-color":[{shadow:[Zu]}],opacity:[{opacity:[ue]}],"mix-blend":[{"mix-blend":[...pt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":pt()}],filter:[{filter:["","none"]}],blur:[{blur:[f]}],brightness:[{brightness:[g]}],contrast:[{contrast:[n]}],"drop-shadow":[{"drop-shadow":["","none",Ha,us]}],grayscale:[{grayscale:[M]}],"hue-rotate":[{"hue-rotate":[z]}],invert:[{invert:[V]}],saturate:[{saturate:[te]}],sepia:[{sepia:[me]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[f]}],"backdrop-brightness":[{"backdrop-brightness":[g]}],"backdrop-contrast":[{"backdrop-contrast":[n]}],"backdrop-grayscale":[{"backdrop-grayscale":[M]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[z]}],"backdrop-invert":[{"backdrop-invert":[V]}],"backdrop-opacity":[{"backdrop-opacity":[ue]}],"backdrop-saturate":[{"backdrop-saturate":[te]}],"backdrop-sepia":[{"backdrop-sepia":[me]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[T]}],"border-spacing-x":[{"border-spacing-x":[T]}],"border-spacing-y":[{"border-spacing-y":[T]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",us]}],duration:[{duration:ns()}],ease:[{ease:["linear","in","out","in-out",us]}],delay:[{delay:ns()}],animate:[{animate:["none","spin","ping","pulse","bounce",us]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[je]}],"scale-x":[{"scale-x":[je]}],"scale-y":[{"scale-y":[je]}],rotate:[{rotate:[Gu,us]}],"translate-x":[{"translate-x":[fe]}],"translate-y":[{"translate-y":[fe]}],"skew-x":[{"skew-x":[Ce]}],"skew-y":[{"skew-y":[Ce]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",us]}],accent:[{accent:["auto",c]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",us]}],"caret-color":[{caret:[c]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Pe()}],"scroll-mx":[{"scroll-mx":Pe()}],"scroll-my":[{"scroll-my":Pe()}],"scroll-ms":[{"scroll-ms":Pe()}],"scroll-me":[{"scroll-me":Pe()}],"scroll-mt":[{"scroll-mt":Pe()}],"scroll-mr":[{"scroll-mr":Pe()}],"scroll-mb":[{"scroll-mb":Pe()}],"scroll-ml":[{"scroll-ml":Pe()}],"scroll-p":[{"scroll-p":Pe()}],"scroll-px":[{"scroll-px":Pe()}],"scroll-py":[{"scroll-py":Pe()}],"scroll-ps":[{"scroll-ps":Pe()}],"scroll-pe":[{"scroll-pe":Pe()}],"scroll-pt":[{"scroll-pt":Pe()}],"scroll-pr":[{"scroll-pr":Pe()}],"scroll-pb":[{"scroll-pb":Pe()}],"scroll-pl":[{"scroll-pl":Pe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",us]}],fill:[{fill:[c,"none"]}],"stroke-w":[{stroke:[ma,Wa,uf]}],stroke:[{stroke:[c,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Uk=wk(Bk);function nd(...c){return Uk(ck(c))}const Vk=({value:c,onValueChange:d,children:f,className:g})=>t.jsx("div",{className:nd("w-full",g),"data-state":c,children:f}),qk=({children:c,className:d})=>t.jsx("div",{className:nd("inline-flex h-10 items-center justify-center rounded-lg bg-gray-100 p-1 text-gray-500",d),children:c}),df=({value:c,children:d,className:f})=>t.jsx("button",{role:"tab","data-state":c,className:nd("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=true]:bg-white data-[state=true]:text-gray-950 data-[state=true]:shadow-sm",f),children:d}),hf=({value:c,children:d,className:f})=>t.jsx("div",{role:"tabpanel","data-state":c,className:nd("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2",f),children:d}),T0=({children:c,className:d})=>t.jsx("div",{className:nd("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm",d),children:c}),$k=()=>{const[c,d]=le.useState("load");return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Transfers"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage inventory transfers between warehouses and trucks"})]}),t.jsxs(Vk,{value:c,onValueChange:d,className:"space-y-6",children:[t.jsxs(qk,{className:"grid w-full grid-cols-3",children:[t.jsxs(df,{value:"load",className:"flex items-center space-x-2",children:[t.jsx(yr,{className:"h-4 w-4"}),t.jsx("span",{children:"Load Truck"})]}),t.jsxs(df,{value:"return",className:"flex items-center space-x-2",children:[t.jsx(Uf,{className:"h-4 w-4"}),t.jsx("span",{children:"Return to Warehouse"})]}),t.jsxs(df,{value:"multi-sku",className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4"}),t.jsx("span",{children:"Multi-SKU Transfer"})]})]}),t.jsx(hf,{value:"load",children:t.jsx(T0,{children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Load Truck"}),t.jsx(YC,{})]})})}),t.jsx(hf,{value:"return",children:t.jsx(T0,{children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Return to Warehouse"}),t.jsx(tk,{})]})})}),t.jsx(hf,{value:"multi-sku",children:t.jsx(lk,{onTransferCreated:f=>{console.log("Transfer created:",f)}})})]})]})},Gk=()=>t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),t.jsx("p",{className:"text-gray-600",children:"System configuration and preferences"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx(aS,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"System Settings"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"This page will contain system configuration options, user preferences, and administrative settings."}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-500",children:[t.jsx("p",{children:" User account management"}),t.jsx("p",{children:" System preferences and configuration"}),t.jsx("p",{children:" Security settings and permissions"}),t.jsx("p",{children:" Backup and maintenance options"})]})]})})]}),Zk=({trucks:c,loading:d,onStatusChange:f})=>d?t.jsx("div",{className:"flex justify-center items-center h-32",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):c.length?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Truck Details"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Load"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"relative px-6 py-3",children:t.jsx("span",{className:"sr-only",children:"Actions"})})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(g=>{const w=(g.inventory||[]).reduce((A,n)=>A+(n.qty_full||0)+(n.qty_empty||0),0),N=w/g.capacity_cylinders*100,T=N>100;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(yr,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:g.fleet_number}),t.jsx("div",{className:"text-sm text-gray-500",children:g.license_plate})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:g.driver_name||"Unassigned"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("div",{className:"text-sm text-gray-900",children:g.capacity_cylinders})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("div",{className:"w-48",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("span",{className:"text-xs font-medium text-gray-500",children:[w," / ",g.capacity_cylinders]}),T&&t.jsx(im,{className:"h-4 w-4 text-red-500",title:"Overloaded"})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full ${T?"bg-red-500":"bg-blue-500"}`,style:{width:`${Math.min(N,100)}%`}})})]})})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("select",{value:g.active?"active":"inactive",onChange:A=>f(g,A.target.value==="active"),className:`block w-full pl-3 pr-10 py-2 text-sm border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${g.active?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx(mf,{to:`/trucks/${g.id}`,className:"text-blue-600 hover:text-blue-900",children:"View Details"})})]},g.id)})})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(yr,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No trucks"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new truck."}),t.jsx("div",{className:"mt-6",children:t.jsx(mf,{to:"/trucks/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"Add Truck"})})]}),Wk=(c={})=>_t.trucks.list.useQuery(c,{retry:1,staleTime:3e4,select:d=>({trucks:d.trucks,isLoading:!1,error:null,totalCount:d.totalCount,totalPages:d.totalPages,currentPage:d.currentPage})}),Hk=c=>_t.trucks.get.useQuery({id:c},{enabled:!!c}),Xk=()=>_t.trucks.create.useMutation({onSuccess:c=>{console.log("Truck created successfully:",c),It.success("Truck created successfully")},onError:c=>{console.error("Create truck mutation error:",c),It.error(c.message||"Failed to create truck")}}),Ob=()=>_t.trucks.update.useMutation({onSuccess:c=>{console.log("Truck updated successfully:",c),It.success("Truck updated successfully")},onError:c=>{console.error("Update truck mutation error:",c),It.error(c.message||"Failed to update truck")}}),Kk=()=>{const{data:c,isLoading:d,error:f}=Wk(),g=Ob(),w=(c==null?void 0:c.trucks)||[],N=async(T,A)=>{try{await g.mutateAsync({id:T.id,active:A})}catch(n){console.error("Error updating truck status:",n),alert("Failed to update truck status. Please try again.")}};return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Trucks"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage your fleet and monitor truck inventory"})]}),t.jsxs(mf,{to:"/trucks/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[t.jsx(wr,{className:"-ml-1 mr-2 h-5 w-5"}),"Add Truck"]})]}),f&&t.jsx("div",{className:"rounded-md bg-red-50 p-4 mb-8",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:f.message})})})}),t.jsx(Zk,{trucks:w,loading:d,onStatusChange:N})]})},Fb=({initialData:c,onSuccess:d})=>{const f=Qr(),g=Xk(),w=Ob(),[N,T]=le.useState(null),[A,n]=le.useState({fleet_number:(c==null?void 0:c.fleet_number)||"",license_plate:(c==null?void 0:c.license_plate)||"",capacity_cylinders:(c==null?void 0:c.capacity_cylinders)||"",driver_name:(c==null?void 0:c.driver_name)||"",active:(c==null?void 0:c.active)??!0}),M=g.isLoading||w.isLoading,z=async V=>{if(V.preventDefault(),!M){T(null);try{if(!A.fleet_number)throw new Error("Fleet number is required");if(!A.license_plate)throw new Error("License plate is required");const U=parseInt(String(A.capacity_cylinders));if(isNaN(U)||U<=0)throw new Error("Capacity must be a valid number greater than 0");const G={fleet_number:A.fleet_number,license_plate:A.license_plate,capacity_cylinders:U,driver_name:A.driver_name||null,active:A.active};let W;c!=null&&c.id?W=await w.mutateAsync({id:c.id,...G}):W=await g.mutateAsync(G),console.log("Operation successful, result:",W),d?d():(console.log("Navigating to:",`/trucks/${W.id}`),f(`/trucks/${W.id}`))}catch(U){console.error("Form submission error:",U),T(U.message||"Failed to save truck")}}};return t.jsxs("form",{onSubmit:z,className:"space-y-6",children:[N&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:N})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(yr,{className:"h-6 w-6 text-gray-400"}),t.jsx("h3",{className:"ml-2 text-lg font-medium text-gray-900",children:c?"Edit Truck":"New Truck"})]})}),t.jsxs("div",{className:"px-6 py-5 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"fleet_number",className:"block text-sm font-medium text-gray-700",children:"Fleet Number"}),t.jsx("input",{type:"text",id:"fleet_number",value:A.fleet_number,onChange:V=>n({...A,fleet_number:V.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"license_plate",className:"block text-sm font-medium text-gray-700",children:"License Plate"}),t.jsx("input",{type:"text",id:"license_plate",value:A.license_plate,onChange:V=>n({...A,license_plate:V.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_cylinders",className:"block text-sm font-medium text-gray-700",children:"Capacity (Cylinders)"}),t.jsx("input",{type:"number",id:"capacity_cylinders",min:"1",placeholder:"Enter capacity",value:A.capacity_cylinders||"",onChange:V=>{const U=V.target.value;n(G=>({...G,capacity_cylinders:U===""?"":parseInt(U)}))},className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"driver_name",className:"block text-sm font-medium text-gray-700",children:"Driver Name"}),t.jsx("input",{type:"text",id:"driver_name",value:A.driver_name,onChange:V=>n({...A,driver_name:V.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"active",checked:A.active,onChange:V=>n({...A,active:V.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"active",className:"ml-2 block text-sm text-gray-900",children:"Active"})]})]}),t.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>f("/trucks"),className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:M,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:M?t.jsxs("div",{className:"flex items-center",children:[t.jsx(tr,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Saving..."]}):"Save Truck"})]})})]})]})},Qk=()=>{const{id:c}=nc(),d=Qr(),[f,g]=le.useState(!1),{data:w,isLoading:N,error:T}=Hk(c||"");if(N)return t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})});if(T||!w)return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:(T==null?void 0:T.message)||"Truck not found"})})})})});if(f)return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("button",{onClick:()=>g(!1),className:"mb-6 inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t.jsx(Mr,{className:"h-4 w-4 mr-1"}),"Back to Details"]}),t.jsx(Fb,{initialData:w,onSuccess:()=>{g(!1),loadTruckDetails()}})]});const A=w.inventory.reduce((n,M)=>n+(M.qty_full||0)+(M.qty_empty||0),0);return A/w.capacity_cylinders*100,t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("button",{onClick:()=>d("/trucks"),className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t.jsx(Mr,{className:"h-4 w-4 mr-1"}),"Back to Trucks"]})}),t.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(yr,{className:"h-6 w-6 text-gray-400"}),t.jsx("h1",{className:"ml-2 text-xl font-semibold text-gray-900",children:w.fleet_number}),t.jsx("span",{className:`ml-4 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${w.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:w.active?"Active":"Inactive"})]}),t.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[t.jsx(ci,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),t.jsxs("div",{className:"px-6 py-5 grid grid-cols-1 gap-6 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Truck Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"License Plate"}),t.jsx("p",{className:"mt-1",children:w.license_plate})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Driver"}),t.jsx("p",{className:"mt-1",children:w.driver_name||"Not assigned"})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Capacity"}),t.jsxs("p",{className:"mt-1",children:[w.capacity_cylinders," cylinders"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Current Load"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("p",{className:"text-lg font-medium",children:[A," / ",w.capacity_cylinders," cylinders"]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:t.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${A/(w.capacity_cylinders||1)*100}%`}})})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Inventory Breakdown"}),w.inventory.length===0?t.jsx("p",{className:"text-sm text-gray-500",children:"No inventory items"}):t.jsx("div",{className:"space-y-3",children:w.inventory.map(n=>t.jsxs("div",{className:"flex items-start",children:[t.jsx(hs,{className:"h-5 w-5 text-gray-400 mt-0.5"}),t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.product_name}),t.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",n.product_sku]}),t.jsxs("div",{className:"mt-1 flex space-x-4",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:["Full: ",n.qty_full||0]}),t.jsxs("span",{className:"text-xs text-gray-500",children:["Empty: ",n.qty_empty||0]})]})]})]},n.product_id))})]})]})]})]})]})},Jk=()=>{const c=Qr();return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Add New Truck"}),t.jsx(Fb,{onSuccess:()=>c("/trucks")})]})},Yk=({schedule:c,onClick:d})=>{const{truck:f,capacity_info:g,allocations:w,maintenance_due:N,fuel_sufficient:T}=c,A=V=>{switch(V){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-gray-600 bg-gray-100";case"maintenance":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}},n=(V,U)=>U?"bg-red-500":V>85?"bg-orange-500":V>60?"bg-yellow-500":"bg-green-500",M=V=>V>=1e3?`${(V/1e3).toFixed(1)}t`:`${V}kg`,z=[];return N&&z.push("Maintenance Due"),T||z.push("Low Fuel"),g.is_overallocated&&z.push("Overallocated"),t.jsxs("div",{className:`bg-white rounded-lg shadow border-2 transition-all duration-200 hover:shadow-md ${d?"cursor-pointer hover:border-blue-300":"border-gray-200"} ${g.is_overallocated?"border-red-300":"border-gray-200"}`,onClick:d,children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(yr,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:f.fleet_number}),t.jsx("p",{className:"text-sm text-gray-600",children:f.license_plate})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(gm,{status:f.status,className:A(f.status)}),z.length>0&&t.jsxs("div",{className:"flex items-center text-red-600",children:[t.jsx(Us,{className:"h-4 w-4"}),t.jsx("span",{className:"text-xs ml-1",children:z.length})]})]})]})}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Capacity"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[M(g.allocated_weight_kg)," / ",M(g.total_capacity_kg)]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:t.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${n(g.utilization_percentage,g.is_overallocated)}`,style:{width:`${Math.min(g.utilization_percentage,100)}%`}})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[t.jsx("span",{children:"0%"}),t.jsxs("span",{className:"font-medium",children:[g.utilization_percentage.toFixed(1),"%"]}),t.jsx("span",{children:"100%"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(hs,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Orders"}),t.jsx("p",{className:"font-semibold",children:g.orders_count})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(yr,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Available"}),t.jsx("p",{className:"font-semibold",children:M(g.available_weight_kg)})]})]}),f.driver_name&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"h-4 w-4 bg-gray-400 rounded-full"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Driver"}),t.jsx("p",{className:"font-semibold text-sm",children:f.driver_name})]})]}),c.route&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Qi,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Route"}),t.jsx("p",{className:"font-semibold",children:c.route.route_status})]})]})]}),z.length>0&&t.jsxs("div",{className:"space-y-1",children:[N&&t.jsxs("div",{className:"flex items-center space-x-2 text-yellow-700 bg-yellow-50 p-2 rounded",children:[t.jsx(lS,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Maintenance due"})]}),!T&&t.jsxs("div",{className:"flex items-center space-x-2 text-orange-700 bg-orange-50 p-2 rounded",children:[t.jsx(w_,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Check fuel level"})]}),g.is_overallocated&&t.jsxs("div",{className:"flex items-center space-x-2 text-red-700 bg-red-50 p-2 rounded",children:[t.jsx(Us,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:["Capacity exceeded by ",M(g.allocated_weight_kg-g.total_capacity_kg)]})]})]}),w.length>0&&t.jsxs("div",{className:"border-t pt-3 mt-3",children:[t.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-2",children:["Today's Orders (",w.length,")"]}),t.jsxs("div",{className:"space-y-1",children:[w.slice(0,3).map((V,U)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-gray-600",children:["Order #",V.order_id.slice(-6)]}),t.jsx("span",{className:"font-medium",children:M(V.estimated_weight_kg)})]},V.id)),w.length>3&&t.jsxs("p",{className:"text-xs text-gray-500",children:["+",w.length-3," more orders"]})]})]})]})})]})},eA=({order:c,orderWeight:d,recommendations:f,selectedTruckId:g,onTruckSelect:w,onCancel:N,onConfirm:T,isLoading:A=!1})=>{const[n,M]=le.useState(!1),z=$=>$>=1e3?`${($/1e3).toFixed(1)}t`:`${$}kg`,V=f.filter($=>$.can_accommodate),U=f.filter($=>!$.can_accommodate),G=f.find($=>$.truck.id===g),W=g&&(G==null?void 0:G.can_accommodate);return t.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 max-w-4xl w-full",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Assign Truck for Order #",c.id.slice(-6)]}),t.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(hs,{className:"h-4 w-4"}),t.jsxs("span",{children:["Order Weight: ",z(d)]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(Nf,{className:"h-4 w-4"}),t.jsxs("span",{children:["Delivery Date: ",c.scheduled_date||"Today"]})]})]})]}),t.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600",children:""})]})}),t.jsxs("div",{className:"px-6 py-4",children:[V.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center",children:[t.jsx($n,{className:"h-5 w-5 text-green-500 mr-2"}),"Available Trucks (",V.length,")"]}),t.jsx("div",{className:"grid gap-3",children:V.map($=>t.jsx(E0,{recommendation:$,orderWeight:d,isSelected:g===$.truck.id,onClick:()=>w($.truck.id)},$.truck.id))})]}),U.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-700 flex items-center",children:[t.jsx(Us,{className:"h-5 w-5 text-red-500 mr-2"}),"Unavailable Trucks (",U.length,")"]}),t.jsxs("button",{onClick:()=>M(!n),className:"text-sm text-blue-600 hover:text-blue-800",children:[n?"Hide":"Show"," unavailable trucks"]})]}),n&&t.jsx("div",{className:"grid gap-3 opacity-75",children:U.map($=>t.jsx(E0,{recommendation:$,orderWeight:d,isSelected:!1,onClick:()=>{},disabled:!0},$.truck.id))})]}),f.length===0&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(yr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"No trucks available for this order"})]})]}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-gray-600",children:G&&t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{children:["Selected: ",G.truck.fleet_number]}),t.jsxs("span",{children:["Utilization after: ",((G.capacity_info.allocated_weight_kg+d)/G.capacity_info.total_capacity_kg*100).toFixed(1),"%"]})]})}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:N,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:T,disabled:!W||A,className:`px-4 py-2 rounded-md font-medium ${W&&!A?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:A?"Assigning...":"Assign Truck"})]})]})})]})},E0=({recommendation:c,orderWeight:d,isSelected:f,onClick:g,disabled:w=!1})=>{const{truck:N,capacity_info:T,warnings:A,errors:n}=c,M=V=>V>=1e3?`${(V/1e3).toFixed(1)}t`:`${V}kg`,z=(T.allocated_weight_kg+d)/T.total_capacity_kg*100;return t.jsxs("div",{className:`border-2 rounded-lg p-4 transition-all duration-200 ${w?"cursor-not-allowed opacity-75":"cursor-pointer"} ${f?"border-blue-500 bg-blue-50":n.length>0?"border-red-300 hover:border-red-400":A.length>0?"border-yellow-300 hover:border-yellow-400":"border-gray-200 hover:border-blue-300"}`,onClick:w?void 0:g,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${f?"bg-blue-200":"bg-gray-100"}`,children:t.jsx(yr,{className:`h-5 w-5 ${f?"text-blue-600":"text-gray-600"}`})}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900",children:N.fleet_number}),t.jsx("p",{className:"text-sm text-gray-600",children:N.license_plate}),N.driver_name&&t.jsxs("p",{className:"text-xs text-gray-500",children:["Driver: ",N.driver_name]})]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:n.length>0?t.jsx(Us,{className:"h-5 w-5 text-red-500"}):A.length>0?t.jsx(Us,{className:"h-5 w-5 text-yellow-500"}):t.jsx($n,{className:"h-5 w-5 text-green-500"})})]}),t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[t.jsxs("span",{children:["Current: ",T.utilization_percentage.toFixed(1),"%"]}),t.jsxs("span",{children:["After: ",z.toFixed(1),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsxs("div",{className:"flex h-2 rounded-full overflow-hidden",children:[t.jsx("div",{className:"bg-blue-500",style:{width:`${Math.min(T.utilization_percentage,100)}%`}}),t.jsx("div",{className:`${z>100?"bg-red-500":z>85?"bg-orange-500":"bg-blue-300"}`,style:{width:`${Math.min(Math.max(0,z-T.utilization_percentage),100-T.utilization_percentage)}%`}})]})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[t.jsxs("span",{children:[M(T.allocated_weight_kg)," / ",M(T.total_capacity_kg)]}),t.jsxs("span",{children:["Available: ",M(T.available_weight_kg)]})]})]}),(n.length>0||A.length>0)&&t.jsxs("div",{className:"mt-3 space-y-1",children:[n.map((V,U)=>t.jsx("div",{className:"text-xs text-red-700 bg-red-50 p-2 rounded",children:V},U)),A.map((V,U)=>t.jsx("div",{className:"text-xs text-yellow-700 bg-yellow-50 p-2 rounded",children:V},U))]})]})},tA=()=>{const[c,d]=le.useState(new Date().toISOString().split("T")[0]),[f,g]=le.useState(!1),w={total_capacity_kg:5400,total_allocated_kg:3780,overall_utilization:70,active_trucks:8,overallocated_trucks:1,maintenance_due_trucks:2},N=[],T=M=>M>=1e3?`${(M/1e3).toFixed(1)}t`:`${M}kg`,A=M=>new Date(M).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),n=M=>"text-yellow-600 bg-yellow-100";return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsx("div",{className:"py-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Fleet Capacity Dashboard"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Monitor truck capacity and optimize delivery allocations"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($s,{className:"h-5 w-5 text-gray-400"}),t.jsx("input",{type:"date",value:c,onChange:M=>d(M.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),t.jsxs("button",{onClick:()=>g(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center space-x-2",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsx("span",{children:"Allocate Order"})]})]})]})})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Ji,{className:`h-8 w-8 ${n()}`})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Fleet Utilization"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[w.overall_utilization.toFixed(1),"%"]}),t.jsxs("p",{className:"text-xs text-gray-500",children:[T(w.total_allocated_kg)," / ",T(w.total_capacity_kg)]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(yr,{className:"h-8 w-8 text-blue-600 bg-blue-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Trucks"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.active_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Available for delivery"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Us,{className:"h-8 w-8 text-red-600 bg-red-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overallocated"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.overallocated_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Need attention"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(hs,{className:"h-8 w-8 text-yellow-600 bg-yellow-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Maintenance Due"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.maintenance_due_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Schedule soon"})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Fleet Capacity for ",A(c)]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[T(w.total_allocated_kg)," allocated of ",T(w.total_capacity_kg)," total capacity"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-2",children:t.jsx("div",{className:"h-4 rounded-full transition-all duration-500 bg-yellow-500",style:{width:`${Math.min(w.overall_utilization,100)}%`}})}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{children:"0%"}),t.jsxs("span",{className:"font-medium",children:[w.overall_utilization.toFixed(1),"% Utilized"]}),t.jsx("span",{children:"100%"})]})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Truck Capacity Details"}),t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),t.jsx("span",{children:"Good utilization"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),t.jsx("span",{children:"High utilization"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),t.jsx("span",{children:"Overallocated"})]})]})]}),N.length>0?t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:N.map(M=>t.jsx(Yk,{schedule:M,onClick:()=>{console.log("Truck clicked:",M.truck_id)}},M.truck_id))}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(yr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsxs("p",{className:"text-gray-600 mb-2",children:["No truck schedules for ",A(c)]}),t.jsx("p",{className:"text-sm text-gray-500",children:"Try selecting a different date or ensure trucks are properly configured"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(wr,{className:"h-6 w-6 text-blue-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Allocate Orders"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Assign pending orders to trucks"})]})]})}),t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-green-400 hover:bg-green-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ji,{className:"h-6 w-6 text-green-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Optimize Routes"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Auto-optimize truck allocations"})]})]})}),t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-yellow-400 hover:bg-yellow-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Us,{className:"h-6 w-6 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Maintenance"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Schedule truck maintenance"})]})]})})]})]})]}),f&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsx(eA,{order:{id:"sample-order",scheduled_date:c},orderWeight:150,recommendations:[],onTruckSelect:M=>console.log("Selected:",M),onCancel:()=>g(!1),onConfirm:()=>{g(!1)}})})]})},sA=new V0({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1}}});function rA(){return t.jsx(W0,{client:sA,children:t.jsxs(FN,{children:[t.jsx(b1,{children:t.jsxs(v1,{children:[t.jsx(Hs,{path:"/login",element:t.jsx(fS,{})}),t.jsxs(Hs,{path:"/*",element:t.jsx(uS,{children:t.jsx(pS,{})}),children:[t.jsx(Hs,{index:!0,element:t.jsx(Hy,{})}),t.jsx(Hs,{path:"dashboard",element:t.jsx(Hy,{})}),t.jsx(Hs,{path:"customers",element:t.jsx(_E,{})}),t.jsx(Hs,{path:"customers/:id",element:t.jsx(DE,{})}),t.jsx(Hs,{path:"products",element:t.jsx(HE,{})}),t.jsx(Hs,{path:"products/:id",element:t.jsx(sC,{})}),t.jsx(Hs,{path:"warehouses",element:t.jsx(uC,{})}),t.jsx(Hs,{path:"warehouses/:id",element:t.jsx(gC,{})}),t.jsx(Hs,{path:"inventory",element:t.jsx(wC,{})}),t.jsx(Hs,{path:"pricing",element:t.jsx(EC,{})}),t.jsx(Hs,{path:"pricing/:id",element:t.jsx(AC,{})}),t.jsx(Hs,{path:"orders",element:t.jsx(BC,{})}),t.jsx(Hs,{path:"orders/new",element:t.jsx($C,{})}),t.jsx(Hs,{path:"orders/schedule",element:t.jsx(XC,{})}),t.jsx(Hs,{path:"orders/reports",element:t.jsx(QC,{})}),t.jsx(Hs,{path:"orders/:id",element:t.jsx(WC,{})}),t.jsx(Hs,{path:"transfers",element:t.jsx($k,{})}),t.jsx(Hs,{path:"settings",element:t.jsx(Gk,{})}),t.jsxs(Hs,{path:"trucks",children:[t.jsx(Hs,{index:!0,element:t.jsx(Kk,{})}),t.jsx(Hs,{path:"new",element:t.jsx(Jk,{})}),t.jsx(Hs,{path:"capacity",element:t.jsx(tA,{})}),t.jsx(Hs,{path:":id",element:t.jsx(Qk,{})})]})]})]})}),t.jsx(Yj,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})}const C0=new V0({defaultOptions:{queries:{retry:1,staleTime:3e4,refetchOnWindowFocus:!1}}});window.addEventListener("error",c=>{console.error("Global error:",c.error)});window.addEventListener("unhandledrejection",c=>{console.error("Unhandled promise rejection:",c.reason)});const Bb=document.getElementById("root");if(!Bb)throw new Error("Failed to find the root element");try{P0(Bb).render(t.jsx(le.StrictMode,{children:t.jsx(_t.Provider,{client:ON,queryClient:C0,children:t.jsx(W0,{client:C0,children:t.jsx(rA,{})})})}))}catch(c){console.error("Error rendering app:",c)}
//# sourceMappingURL=index-KG9VSQ0v.js.map
