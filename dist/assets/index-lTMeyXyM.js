import{r as oe,a as m1,R as ei,N as k0,b as p1,O as f1,c as g1,g as x1,u as si,d as nc,L as hf,B as y1,e as _1,f as Qs}from"./vendor-BeIN97dW.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))f(w);new MutationObserver(w=>{for(const N of w)if(N.type==="childList")for(const T of N.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&f(T)}).observe(document,{childList:!0,subtree:!0});function g(w){const N={};return w.integrity&&(N.integrity=w.integrity),w.referrerPolicy&&(N.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?N.credentials="include":w.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function f(w){if(w.ep)return;w.ep=!0;const N=g(w);fetch(w.href,N)}})();var A0={exports:{}},tm={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b1=oe,v1=Symbol.for("react.element"),w1=Symbol.for("react.fragment"),j1=Object.prototype.hasOwnProperty,N1=b1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,S1={key:!0,ref:!0,__self:!0,__source:!0};function M0(c,d,g){var f,w={},N=null,T=null;g!==void 0&&(N=""+g),d.key!==void 0&&(N=""+d.key),d.ref!==void 0&&(T=d.ref);for(f in d)j1.call(d,f)&&!S1.hasOwnProperty(f)&&(w[f]=d[f]);if(c&&c.defaultProps)for(f in d=c.defaultProps,d)w[f]===void 0&&(w[f]=d[f]);return{$$typeof:v1,type:c,key:N,ref:T,props:w,_owner:N1.current}}tm.Fragment=w1;tm.jsx=M0;tm.jsxs=M0;A0.exports=tm;var t=A0.exports,P0,Iy=m1;P0=Iy.createRoot,Iy.hydrateRoot;class Jo{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(d){const g={listener:d};return this.listeners.add(g),this.onSubscribe(),()=>{this.listeners.delete(g),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const Kd=typeof window>"u"||"Deno"in window;function Yi(){}function T1(c,d){return typeof c=="function"?c(d):c}function mf(c){return typeof c=="number"&&c>=0&&c!==1/0}function Dy(c,d){return c.filter(g=>!d.includes(g))}function E1(c,d,g){const f=c.slice(0);return f[d]=g,f}function I0(c,d){return Math.max(c+(d||0)-Date.now(),0)}function Yl(c,d,g){return Yd(c)?typeof d=="function"?{...g,queryKey:c,queryFn:d}:{...d,queryKey:c}:c}function C1(c,d,g){return Yd(c)?{...d,mutationKey:c}:typeof c=="function"?{...d,mutationFn:c}:{...c}}function Ka(c,d,g){return Yd(c)?[{...d,queryKey:c},g]:[c||{},d]}function Ly(c,d){const{type:g="all",exact:f,fetchStatus:w,predicate:N,queryKey:T,stale:A}=c;if(Yd(T)){if(f){if(d.queryHash!==If(T,d.options))return!1}else if(!Uh(d.queryKey,T))return!1}if(g!=="all"){const n=d.isActive();if(g==="active"&&!n||g==="inactive"&&n)return!1}return!(typeof A=="boolean"&&d.isStale()!==A||typeof w<"u"&&w!==d.state.fetchStatus||N&&!N(d))}function Ry(c,d){const{exact:g,fetching:f,predicate:w,mutationKey:N}=c;if(Yd(N)){if(!d.options.mutationKey)return!1;if(g){if(Ya(d.options.mutationKey)!==Ya(N))return!1}else if(!Uh(d.options.mutationKey,N))return!1}return!(typeof f=="boolean"&&d.state.status==="loading"!==f||w&&!w(d))}function If(c,d){return((d==null?void 0:d.queryKeyHashFn)||Ya)(c)}function Ya(c){return JSON.stringify(c,(d,g)=>pf(g)?Object.keys(g).sort().reduce((f,w)=>(f[w]=g[w],f),{}):g)}function Uh(c,d){return D0(c,d)}function D0(c,d){return c===d?!0:typeof c!=typeof d?!1:c&&d&&typeof c=="object"&&typeof d=="object"?!Object.keys(d).some(g=>!D0(c[g],d[g])):!1}function L0(c,d){if(c===d)return c;const g=zy(c)&&zy(d);if(g||pf(c)&&pf(d)){const f=g?c.length:Object.keys(c).length,w=g?d:Object.keys(d),N=w.length,T=g?[]:{};let A=0;for(let n=0;n<N;n++){const P=g?n:w[n];T[P]=L0(c[P],d[P]),T[P]===c[P]&&A++}return f===N&&A===f?c:T}return d}function Vh(c,d){if(c&&!d||d&&!c)return!1;for(const g in c)if(c[g]!==d[g])return!1;return!0}function zy(c){return Array.isArray(c)&&c.length===Object.keys(c).length}function pf(c){if(!Oy(c))return!1;const d=c.constructor;if(typeof d>"u")return!0;const g=d.prototype;return!(!Oy(g)||!g.hasOwnProperty("isPrototypeOf"))}function Oy(c){return Object.prototype.toString.call(c)==="[object Object]"}function Yd(c){return Array.isArray(c)}function R0(c){return new Promise(d=>{setTimeout(d,c)})}function Fy(c){R0(0).then(c)}function k1(){if(typeof AbortController=="function")return new AbortController}function ff(c,d,g){return g.isDataEqual!=null&&g.isDataEqual(c,d)?c:typeof g.structuralSharing=="function"?g.structuralSharing(c,d):g.structuralSharing!==!1?L0(c,d):d}class A1 extends Jo{constructor(){super(),this.setup=d=>{if(!Kd&&window.addEventListener){const g=()=>d();return window.addEventListener("visibilitychange",g,!1),window.addEventListener("focus",g,!1),()=>{window.removeEventListener("visibilitychange",g),window.removeEventListener("focus",g)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.cleanup)==null||d.call(this),this.cleanup=void 0}}setEventListener(d){var g;this.setup=d,(g=this.cleanup)==null||g.call(this),this.cleanup=d(f=>{typeof f=="boolean"?this.setFocused(f):this.onFocus()})}setFocused(d){this.focused!==d&&(this.focused=d,this.onFocus())}onFocus(){this.listeners.forEach(({listener:d})=>{d()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const qh=new A1,By=["online","offline"];class M1 extends Jo{constructor(){super(),this.setup=d=>{if(!Kd&&window.addEventListener){const g=()=>d();return By.forEach(f=>{window.addEventListener(f,g,!1)}),()=>{By.forEach(f=>{window.removeEventListener(f,g)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.cleanup)==null||d.call(this),this.cleanup=void 0}}setEventListener(d){var g;this.setup=d,(g=this.cleanup)==null||g.call(this),this.cleanup=d(f=>{typeof f=="boolean"?this.setOnline(f):this.onOnline()})}setOnline(d){this.online!==d&&(this.online=d,this.onOnline())}onOnline(){this.listeners.forEach(({listener:d})=>{d()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const $h=new M1;function P1(c){return Math.min(1e3*2**c,3e4)}function sm(c){return(c??"online")==="online"?$h.isOnline():!0}class z0{constructor(d){this.revert=d==null?void 0:d.revert,this.silent=d==null?void 0:d.silent}}function Lh(c){return c instanceof z0}function O0(c){let d=!1,g=0,f=!1,w,N,T;const A=new Promise((J,de)=>{N=J,T=de}),n=J=>{f||(W(new z0(J)),c.abort==null||c.abort())},P=()=>{d=!0},z=()=>{d=!1},q=()=>!qh.isFocused()||c.networkMode!=="always"&&!$h.isOnline(),U=J=>{f||(f=!0,c.onSuccess==null||c.onSuccess(J),w==null||w(),N(J))},W=J=>{f||(f=!0,c.onError==null||c.onError(J),w==null||w(),T(J))},H=()=>new Promise(J=>{w=de=>{const ne=f||!q();return ne&&J(de),ne},c.onPause==null||c.onPause()}).then(()=>{w=void 0,f||c.onContinue==null||c.onContinue()}),G=()=>{if(f)return;let J;try{J=c.fn()}catch(de){J=Promise.reject(de)}Promise.resolve(J).then(U).catch(de=>{var ne,te;if(f)return;const Ne=(ne=c.retry)!=null?ne:3,me=(te=c.retryDelay)!=null?te:P1,Pe=typeof me=="function"?me(g,de):me,Se=Ne===!0||typeof Ne=="number"&&g<Ne||typeof Ne=="function"&&Ne(g,de);if(d||!Se){W(de);return}g++,c.onFail==null||c.onFail(g,de),R0(Pe).then(()=>{if(q())return H()}).then(()=>{d?W(de):G()})})};return sm(c.networkMode)?G():H().then(G),{promise:A,cancel:n,continue:()=>(w==null?void 0:w())?A:Promise.resolve(),cancelRetry:P,continueRetry:z}}const Df=console;function I1(){let c=[],d=0,g=z=>{z()},f=z=>{z()};const w=z=>{let q;d++;try{q=z()}finally{d--,d||A()}return q},N=z=>{d?c.push(z):Fy(()=>{g(z)})},T=z=>(...q)=>{N(()=>{z(...q)})},A=()=>{const z=c;c=[],z.length&&Fy(()=>{f(()=>{z.forEach(q=>{g(q)})})})};return{batch:w,batchCalls:T,schedule:N,setNotifyFunction:z=>{g=z},setBatchNotifyFunction:z=>{f=z}}}const er=I1();class F0{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),mf(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(d){this.cacheTime=Math.max(this.cacheTime||0,d??(Kd?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class D1 extends F0{constructor(d){super(),this.abortSignalConsumed=!1,this.defaultOptions=d.defaultOptions,this.setOptions(d.options),this.observers=[],this.cache=d.cache,this.logger=d.logger||Df,this.queryKey=d.queryKey,this.queryHash=d.queryHash,this.initialState=d.state||L1(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(d){this.options={...this.defaultOptions,...d},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(d,g){const f=ff(this.state.data,d,this.options);return this.dispatch({data:f,type:"success",dataUpdatedAt:g==null?void 0:g.updatedAt,manual:g==null?void 0:g.manual}),f}setState(d,g){this.dispatch({type:"setState",state:d,setStateOptions:g})}cancel(d){var g;const f=this.promise;return(g=this.retryer)==null||g.cancel(d),f?f.then(Yi).catch(Yi):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(d=>d.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(d=>d.getCurrentResult().isStale)}isStaleByTime(d=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!I0(this.state.dataUpdatedAt,d)}onFocus(){var d;const g=this.observers.find(f=>f.shouldFetchOnWindowFocus());g&&g.refetch({cancelRefetch:!1}),(d=this.retryer)==null||d.continue()}onOnline(){var d;const g=this.observers.find(f=>f.shouldFetchOnReconnect());g&&g.refetch({cancelRefetch:!1}),(d=this.retryer)==null||d.continue()}addObserver(d){this.observers.includes(d)||(this.observers.push(d),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:d}))}removeObserver(d){this.observers.includes(d)&&(this.observers=this.observers.filter(g=>g!==d),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:d}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(d,g){var f,w;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&g!=null&&g.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var N;return(N=this.retryer)==null||N.continueRetry(),this.promise}}if(d&&this.setOptions(d),!this.options.queryFn){const W=this.observers.find(H=>H.options.queryFn);W&&this.setOptions(W.options)}const T=k1(),A={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},n=W=>{Object.defineProperty(W,"signal",{enumerable:!0,get:()=>{if(T)return this.abortSignalConsumed=!0,T.signal}})};n(A);const P=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(A)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'"),z={fetchOptions:g,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:P};if(n(z),(f=this.options.behavior)==null||f.onFetch(z),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==((w=z.fetchOptions)==null?void 0:w.meta)){var q;this.dispatch({type:"fetch",meta:(q=z.fetchOptions)==null?void 0:q.meta})}const U=W=>{if(Lh(W)&&W.silent||this.dispatch({type:"error",error:W}),!Lh(W)){var H,G,J,de;(H=(G=this.cache.config).onError)==null||H.call(G,W,this),(J=(de=this.cache.config).onSettled)==null||J.call(de,this.state.data,W,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=O0({fn:z.fetchFn,abort:T==null?void 0:T.abort.bind(T),onSuccess:W=>{var H,G,J,de;if(typeof W>"u"){U(new Error(this.queryHash+" data is undefined"));return}this.setData(W),(H=(G=this.cache.config).onSuccess)==null||H.call(G,W,this),(J=(de=this.cache.config).onSettled)==null||J.call(de,W,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:U,onFail:(W,H)=>{this.dispatch({type:"failed",failureCount:W,error:H})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:z.options.retry,retryDelay:z.options.retryDelay,networkMode:z.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(d){const g=f=>{var w,N;switch(d.type){case"failed":return{...f,fetchFailureCount:d.failureCount,fetchFailureReason:d.error};case"pause":return{...f,fetchStatus:"paused"};case"continue":return{...f,fetchStatus:"fetching"};case"fetch":return{...f,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:(w=d.meta)!=null?w:null,fetchStatus:sm(this.options.networkMode)?"fetching":"paused",...!f.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...f,data:d.data,dataUpdateCount:f.dataUpdateCount+1,dataUpdatedAt:(N=d.dataUpdatedAt)!=null?N:Date.now(),error:null,isInvalidated:!1,status:"success",...!d.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const T=d.error;return Lh(T)&&T.revert&&this.revertState?{...this.revertState,fetchStatus:"idle"}:{...f,error:T,errorUpdateCount:f.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:f.fetchFailureCount+1,fetchFailureReason:T,fetchStatus:"idle",status:"error"};case"invalidate":return{...f,isInvalidated:!0};case"setState":return{...f,...d.state}}};this.state=g(this.state),er.batch(()=>{this.observers.forEach(f=>{f.onQueryUpdate(d)}),this.cache.notify({query:this,type:"updated",action:d})})}}function L1(c){const d=typeof c.initialData=="function"?c.initialData():c.initialData,g=typeof d<"u",f=g?typeof c.initialDataUpdatedAt=="function"?c.initialDataUpdatedAt():c.initialDataUpdatedAt:0;return{data:d,dataUpdateCount:0,dataUpdatedAt:g?f??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:g?"success":"loading",fetchStatus:"idle"}}class R1 extends Jo{constructor(d){super(),this.config=d||{},this.queries=[],this.queriesMap={}}build(d,g,f){var w;const N=g.queryKey,T=(w=g.queryHash)!=null?w:If(N,g);let A=this.get(T);return A||(A=new D1({cache:this,logger:d.getLogger(),queryKey:N,queryHash:T,options:d.defaultQueryOptions(g),state:f,defaultOptions:d.getQueryDefaults(N)}),this.add(A)),A}add(d){this.queriesMap[d.queryHash]||(this.queriesMap[d.queryHash]=d,this.queries.push(d),this.notify({type:"added",query:d}))}remove(d){const g=this.queriesMap[d.queryHash];g&&(d.destroy(),this.queries=this.queries.filter(f=>f!==d),g===d&&delete this.queriesMap[d.queryHash],this.notify({type:"removed",query:d}))}clear(){er.batch(()=>{this.queries.forEach(d=>{this.remove(d)})})}get(d){return this.queriesMap[d]}getAll(){return this.queries}find(d,g){const[f]=Ka(d,g);return typeof f.exact>"u"&&(f.exact=!0),this.queries.find(w=>Ly(f,w))}findAll(d,g){const[f]=Ka(d,g);return Object.keys(f).length>0?this.queries.filter(w=>Ly(f,w)):this.queries}notify(d){er.batch(()=>{this.listeners.forEach(({listener:g})=>{g(d)})})}onFocus(){er.batch(()=>{this.queries.forEach(d=>{d.onFocus()})})}onOnline(){er.batch(()=>{this.queries.forEach(d=>{d.onOnline()})})}}class z1 extends F0{constructor(d){super(),this.defaultOptions=d.defaultOptions,this.mutationId=d.mutationId,this.mutationCache=d.mutationCache,this.logger=d.logger||Df,this.observers=[],this.state=d.state||B0(),this.setOptions(d.options),this.scheduleGc()}setOptions(d){this.options={...this.defaultOptions,...d},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(d){this.dispatch({type:"setState",state:d})}addObserver(d){this.observers.includes(d)||(this.observers.push(d),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:d}))}removeObserver(d){this.observers=this.observers.filter(g=>g!==d),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:d})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var d,g;return(d=(g=this.retryer)==null?void 0:g.continue())!=null?d:this.execute()}async execute(){const d=()=>{var Se;return this.retryer=O0({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(fe,Be)=>{this.dispatch({type:"failed",failureCount:fe,error:Be})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(Se=this.options.retry)!=null?Se:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},g=this.state.status==="loading";try{var f,w,N,T,A,n,P,z;if(!g){var q,U,W,H;this.dispatch({type:"loading",variables:this.options.variables}),await((q=(U=this.mutationCache.config).onMutate)==null?void 0:q.call(U,this.state.variables,this));const fe=await((W=(H=this.options).onMutate)==null?void 0:W.call(H,this.state.variables));fe!==this.state.context&&this.dispatch({type:"loading",context:fe,variables:this.state.variables})}const Se=await d();return await((f=(w=this.mutationCache.config).onSuccess)==null?void 0:f.call(w,Se,this.state.variables,this.state.context,this)),await((N=(T=this.options).onSuccess)==null?void 0:N.call(T,Se,this.state.variables,this.state.context)),await((A=(n=this.mutationCache.config).onSettled)==null?void 0:A.call(n,Se,null,this.state.variables,this.state.context,this)),await((P=(z=this.options).onSettled)==null?void 0:P.call(z,Se,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:Se}),Se}catch(Se){try{var G,J,de,ne,te,Ne,me,Pe;throw await((G=(J=this.mutationCache.config).onError)==null?void 0:G.call(J,Se,this.state.variables,this.state.context,this)),await((de=(ne=this.options).onError)==null?void 0:de.call(ne,Se,this.state.variables,this.state.context)),await((te=(Ne=this.mutationCache.config).onSettled)==null?void 0:te.call(Ne,void 0,Se,this.state.variables,this.state.context,this)),await((me=(Pe=this.options).onSettled)==null?void 0:me.call(Pe,void 0,Se,this.state.variables,this.state.context)),Se}finally{this.dispatch({type:"error",error:Se})}}}dispatch(d){const g=f=>{switch(d.type){case"failed":return{...f,failureCount:d.failureCount,failureReason:d.error};case"pause":return{...f,isPaused:!0};case"continue":return{...f,isPaused:!1};case"loading":return{...f,context:d.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!sm(this.options.networkMode),status:"loading",variables:d.variables};case"success":return{...f,data:d.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...f,data:void 0,error:d.error,failureCount:f.failureCount+1,failureReason:d.error,isPaused:!1,status:"error"};case"setState":return{...f,...d.state}}};this.state=g(this.state),er.batch(()=>{this.observers.forEach(f=>{f.onMutationUpdate(d)}),this.mutationCache.notify({mutation:this,type:"updated",action:d})})}}function B0(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class O1 extends Jo{constructor(d){super(),this.config=d||{},this.mutations=[],this.mutationId=0}build(d,g,f){const w=new z1({mutationCache:this,logger:d.getLogger(),mutationId:++this.mutationId,options:d.defaultMutationOptions(g),state:f,defaultOptions:g.mutationKey?d.getMutationDefaults(g.mutationKey):void 0});return this.add(w),w}add(d){this.mutations.push(d),this.notify({type:"added",mutation:d})}remove(d){this.mutations=this.mutations.filter(g=>g!==d),this.notify({type:"removed",mutation:d})}clear(){er.batch(()=>{this.mutations.forEach(d=>{this.remove(d)})})}getAll(){return this.mutations}find(d){return typeof d.exact>"u"&&(d.exact=!0),this.mutations.find(g=>Ry(d,g))}findAll(d){return this.mutations.filter(g=>Ry(d,g))}notify(d){er.batch(()=>{this.listeners.forEach(({listener:g})=>{g(d)})})}resumePausedMutations(){var d;return this.resuming=((d=this.resuming)!=null?d:Promise.resolve()).then(()=>{const g=this.mutations.filter(f=>f.state.isPaused);return er.batch(()=>g.reduce((f,w)=>f.then(()=>w.continue().catch(Yi)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function gf(){return{onFetch:c=>{c.fetchFn=()=>{var d,g,f,w,N,T;const A=(d=c.fetchOptions)==null||(g=d.meta)==null?void 0:g.refetchPage,n=(f=c.fetchOptions)==null||(w=f.meta)==null?void 0:w.fetchMore,P=n==null?void 0:n.pageParam,z=(n==null?void 0:n.direction)==="forward",q=(n==null?void 0:n.direction)==="backward",U=((N=c.state.data)==null?void 0:N.pages)||[],W=((T=c.state.data)==null?void 0:T.pageParams)||[];let H=W,G=!1;const J=Pe=>{Object.defineProperty(Pe,"signal",{enumerable:!0,get:()=>{var Se;if((Se=c.signal)!=null&&Se.aborted)G=!0;else{var fe;(fe=c.signal)==null||fe.addEventListener("abort",()=>{G=!0})}return c.signal}})},de=c.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+c.options.queryHash+"'")),ne=(Pe,Se,fe,Be)=>(H=Be?[Se,...H]:[...H,Se],Be?[fe,...Pe]:[...Pe,fe]),te=(Pe,Se,fe,Be)=>{if(G)return Promise.reject("Cancelled");if(typeof fe>"u"&&!Se&&Pe.length)return Promise.resolve(Pe);const ke={queryKey:c.queryKey,pageParam:fe,meta:c.options.meta};J(ke);const Ge=de(ke);return Promise.resolve(Ge).then(Me=>ne(Pe,fe,Me,Be))};let Ne;if(!U.length)Ne=te([]);else if(z){const Pe=typeof P<"u",Se=Pe?P:xf(c.options,U);Ne=te(U,Pe,Se)}else if(q){const Pe=typeof P<"u",Se=Pe?P:U0(c.options,U);Ne=te(U,Pe,Se,!0)}else{H=[];const Pe=typeof c.options.getNextPageParam>"u";Ne=(A&&U[0]?A(U[0],0,U):!0)?te([],Pe,W[0]):Promise.resolve(ne([],W[0],U[0]));for(let fe=1;fe<U.length;fe++)Ne=Ne.then(Be=>{if(A&&U[fe]?A(U[fe],fe,U):!0){const Ge=Pe?W[fe]:xf(c.options,Be);return te(Be,Pe,Ge)}return Promise.resolve(ne(Be,W[fe],U[fe]))})}return Ne.then(Pe=>({pages:Pe,pageParams:H}))}}}}function xf(c,d){return c.getNextPageParam==null?void 0:c.getNextPageParam(d[d.length-1],d)}function U0(c,d){return c.getPreviousPageParam==null?void 0:c.getPreviousPageParam(d[0],d)}function F1(c,d){if(c.getNextPageParam&&Array.isArray(d)){const g=xf(c,d);return typeof g<"u"&&g!==null&&g!==!1}}function B1(c,d){if(c.getPreviousPageParam&&Array.isArray(d)){const g=U0(c,d);return typeof g<"u"&&g!==null&&g!==!1}}class U1{constructor(d={}){this.queryCache=d.queryCache||new R1,this.mutationCache=d.mutationCache||new O1,this.logger=d.logger||Df,this.defaultOptions=d.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=qh.subscribe(()=>{qh.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=$h.subscribe(()=>{$h.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var d,g;this.mountCount--,this.mountCount===0&&((d=this.unsubscribeFocus)==null||d.call(this),this.unsubscribeFocus=void 0,(g=this.unsubscribeOnline)==null||g.call(this),this.unsubscribeOnline=void 0)}isFetching(d,g){const[f]=Ka(d,g);return f.fetchStatus="fetching",this.queryCache.findAll(f).length}isMutating(d){return this.mutationCache.findAll({...d,fetching:!0}).length}getQueryData(d,g){var f;return(f=this.queryCache.find(d,g))==null?void 0:f.state.data}ensureQueryData(d,g,f){const w=Yl(d,g,f),N=this.getQueryData(w.queryKey);return N?Promise.resolve(N):this.fetchQuery(w)}getQueriesData(d){return this.getQueryCache().findAll(d).map(({queryKey:g,state:f})=>{const w=f.data;return[g,w]})}setQueryData(d,g,f){const w=this.queryCache.find(d),N=w==null?void 0:w.state.data,T=T1(g,N);if(typeof T>"u")return;const A=Yl(d),n=this.defaultQueryOptions(A);return this.queryCache.build(this,n).setData(T,{...f,manual:!0})}setQueriesData(d,g,f){return er.batch(()=>this.getQueryCache().findAll(d).map(({queryKey:w})=>[w,this.setQueryData(w,g,f)]))}getQueryState(d,g){var f;return(f=this.queryCache.find(d,g))==null?void 0:f.state}removeQueries(d,g){const[f]=Ka(d,g),w=this.queryCache;er.batch(()=>{w.findAll(f).forEach(N=>{w.remove(N)})})}resetQueries(d,g,f){const[w,N]=Ka(d,g,f),T=this.queryCache,A={type:"active",...w};return er.batch(()=>(T.findAll(w).forEach(n=>{n.reset()}),this.refetchQueries(A,N)))}cancelQueries(d,g,f){const[w,N={}]=Ka(d,g,f);typeof N.revert>"u"&&(N.revert=!0);const T=er.batch(()=>this.queryCache.findAll(w).map(A=>A.cancel(N)));return Promise.all(T).then(Yi).catch(Yi)}invalidateQueries(d,g,f){const[w,N]=Ka(d,g,f);return er.batch(()=>{var T,A;if(this.queryCache.findAll(w).forEach(P=>{P.invalidate()}),w.refetchType==="none")return Promise.resolve();const n={...w,type:(T=(A=w.refetchType)!=null?A:w.type)!=null?T:"active"};return this.refetchQueries(n,N)})}refetchQueries(d,g,f){const[w,N]=Ka(d,g,f),T=er.batch(()=>this.queryCache.findAll(w).filter(n=>!n.isDisabled()).map(n=>{var P;return n.fetch(void 0,{...N,cancelRefetch:(P=N==null?void 0:N.cancelRefetch)!=null?P:!0,meta:{refetchPage:w.refetchPage}})}));let A=Promise.all(T).then(Yi);return N!=null&&N.throwOnError||(A=A.catch(Yi)),A}fetchQuery(d,g,f){const w=Yl(d,g,f),N=this.defaultQueryOptions(w);typeof N.retry>"u"&&(N.retry=!1);const T=this.queryCache.build(this,N);return T.isStaleByTime(N.staleTime)?T.fetch(N):Promise.resolve(T.state.data)}prefetchQuery(d,g,f){return this.fetchQuery(d,g,f).then(Yi).catch(Yi)}fetchInfiniteQuery(d,g,f){const w=Yl(d,g,f);return w.behavior=gf(),this.fetchQuery(w)}prefetchInfiniteQuery(d,g,f){return this.fetchInfiniteQuery(d,g,f).then(Yi).catch(Yi)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(d){this.defaultOptions=d}setQueryDefaults(d,g){const f=this.queryDefaults.find(w=>Ya(d)===Ya(w.queryKey));f?f.defaultOptions=g:this.queryDefaults.push({queryKey:d,defaultOptions:g})}getQueryDefaults(d){if(!d)return;const g=this.queryDefaults.find(f=>Uh(d,f.queryKey));return g==null?void 0:g.defaultOptions}setMutationDefaults(d,g){const f=this.mutationDefaults.find(w=>Ya(d)===Ya(w.mutationKey));f?f.defaultOptions=g:this.mutationDefaults.push({mutationKey:d,defaultOptions:g})}getMutationDefaults(d){if(!d)return;const g=this.mutationDefaults.find(f=>Uh(d,f.mutationKey));return g==null?void 0:g.defaultOptions}defaultQueryOptions(d){if(d!=null&&d._defaulted)return d;const g={...this.defaultOptions.queries,...this.getQueryDefaults(d==null?void 0:d.queryKey),...d,_defaulted:!0};return!g.queryHash&&g.queryKey&&(g.queryHash=If(g.queryKey,g)),typeof g.refetchOnReconnect>"u"&&(g.refetchOnReconnect=g.networkMode!=="always"),typeof g.useErrorBoundary>"u"&&(g.useErrorBoundary=!!g.suspense),g}defaultMutationOptions(d){return d!=null&&d._defaulted?d:{...this.defaultOptions.mutations,...this.getMutationDefaults(d==null?void 0:d.mutationKey),...d,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}class Lf extends Jo{constructor(d,g){super(),this.client=d,this.options=g,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(g)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),Uy(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return yf(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return yf(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(d,g){const f=this.options,w=this.currentQuery;if(this.options=this.client.defaultQueryOptions(d),Vh(f,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=f.queryKey),this.updateQuery();const N=this.hasListeners();N&&Vy(this.currentQuery,w,this.options,f)&&this.executeFetch(),this.updateResult(g),N&&(this.currentQuery!==w||this.options.enabled!==f.enabled||this.options.staleTime!==f.staleTime)&&this.updateStaleTimeout();const T=this.computeRefetchInterval();N&&(this.currentQuery!==w||this.options.enabled!==f.enabled||T!==this.currentRefetchInterval)&&this.updateRefetchInterval(T)}getOptimisticResult(d){const g=this.client.getQueryCache().build(this.client,d),f=this.createResult(g,d);return q1(this,f,d)&&(this.currentResult=f,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),f}getCurrentResult(){return this.currentResult}trackResult(d){const g={};return Object.keys(d).forEach(f=>{Object.defineProperty(g,f,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(f),d[f])})}),g}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:d,...g}={}){return this.fetch({...g,meta:{refetchPage:d}})}fetchOptimistic(d){const g=this.client.defaultQueryOptions(d),f=this.client.getQueryCache().build(this.client,g);return f.isFetchingOptimistic=!0,f.fetch().then(()=>this.createResult(f,g))}fetch(d){var g;return this.executeFetch({...d,cancelRefetch:(g=d.cancelRefetch)!=null?g:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(d){this.updateQuery();let g=this.currentQuery.fetch(this.options,d);return d!=null&&d.throwOnError||(g=g.catch(Yi)),g}updateStaleTimeout(){if(this.clearStaleTimeout(),Kd||this.currentResult.isStale||!mf(this.options.staleTime))return;const g=I0(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},g)}computeRefetchInterval(){var d;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(d=this.options.refetchInterval)!=null?d:!1}updateRefetchInterval(d){this.clearRefetchInterval(),this.currentRefetchInterval=d,!(Kd||this.options.enabled===!1||!mf(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||qh.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(d,g){const f=this.currentQuery,w=this.options,N=this.currentResult,T=this.currentResultState,A=this.currentResultOptions,n=d!==f,P=n?d.state:this.currentQueryInitialState,z=n?this.currentResult:this.previousQueryResult,{state:q}=d;let{dataUpdatedAt:U,error:W,errorUpdatedAt:H,fetchStatus:G,status:J}=q,de=!1,ne=!1,te;if(g._optimisticResults){const fe=this.hasListeners(),Be=!fe&&Uy(d,g),ke=fe&&Vy(d,f,g,w);(Be||ke)&&(G=sm(d.options.networkMode)?"fetching":"paused",U||(J="loading")),g._optimisticResults==="isRestoring"&&(G="idle")}if(g.keepPreviousData&&!q.dataUpdatedAt&&z!=null&&z.isSuccess&&J!=="error")te=z.data,U=z.dataUpdatedAt,J=z.status,de=!0;else if(g.select&&typeof q.data<"u")if(N&&q.data===(T==null?void 0:T.data)&&g.select===this.selectFn)te=this.selectResult;else try{this.selectFn=g.select,te=g.select(q.data),te=ff(N==null?void 0:N.data,te,g),this.selectResult=te,this.selectError=null}catch(fe){this.selectError=fe}else te=q.data;if(typeof g.placeholderData<"u"&&typeof te>"u"&&J==="loading"){let fe;if(N!=null&&N.isPlaceholderData&&g.placeholderData===(A==null?void 0:A.placeholderData))fe=N.data;else if(fe=typeof g.placeholderData=="function"?g.placeholderData():g.placeholderData,g.select&&typeof fe<"u")try{fe=g.select(fe),this.selectError=null}catch(Be){this.selectError=Be}typeof fe<"u"&&(J="success",te=ff(N==null?void 0:N.data,fe,g),ne=!0)}this.selectError&&(W=this.selectError,te=this.selectResult,H=Date.now(),J="error");const Ne=G==="fetching",me=J==="loading",Pe=J==="error";return{status:J,fetchStatus:G,isLoading:me,isSuccess:J==="success",isError:Pe,isInitialLoading:me&&Ne,data:te,dataUpdatedAt:U,error:W,errorUpdatedAt:H,failureCount:q.fetchFailureCount,failureReason:q.fetchFailureReason,errorUpdateCount:q.errorUpdateCount,isFetched:q.dataUpdateCount>0||q.errorUpdateCount>0,isFetchedAfterMount:q.dataUpdateCount>P.dataUpdateCount||q.errorUpdateCount>P.errorUpdateCount,isFetching:Ne,isRefetching:Ne&&!me,isLoadingError:Pe&&q.dataUpdatedAt===0,isPaused:G==="paused",isPlaceholderData:ne,isPreviousData:de,isRefetchError:Pe&&q.dataUpdatedAt!==0,isStale:Rf(d,g),refetch:this.refetch,remove:this.remove}}updateResult(d){const g=this.currentResult,f=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,Vh(f,g))return;this.currentResult=f;const w={cache:!0},N=()=>{if(!g)return!0;const{notifyOnChangeProps:T}=this.options,A=typeof T=="function"?T():T;if(A==="all"||!A&&!this.trackedProps.size)return!0;const n=new Set(A??this.trackedProps);return this.options.useErrorBoundary&&n.add("error"),Object.keys(this.currentResult).some(P=>{const z=P;return this.currentResult[z]!==g[z]&&n.has(z)})};(d==null?void 0:d.listeners)!==!1&&N()&&(w.listeners=!0),this.notify({...w,...d})}updateQuery(){const d=this.client.getQueryCache().build(this.client,this.options);if(d===this.currentQuery)return;const g=this.currentQuery;this.currentQuery=d,this.currentQueryInitialState=d.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(g==null||g.removeObserver(this),d.addObserver(this))}onQueryUpdate(d){const g={};d.type==="success"?g.onSuccess=!d.manual:d.type==="error"&&!Lh(d.error)&&(g.onError=!0),this.updateResult(g),this.hasListeners()&&this.updateTimers()}notify(d){er.batch(()=>{if(d.onSuccess){var g,f,w,N;(g=(f=this.options).onSuccess)==null||g.call(f,this.currentResult.data),(w=(N=this.options).onSettled)==null||w.call(N,this.currentResult.data,null)}else if(d.onError){var T,A,n,P;(T=(A=this.options).onError)==null||T.call(A,this.currentResult.error),(n=(P=this.options).onSettled)==null||n.call(P,void 0,this.currentResult.error)}d.listeners&&this.listeners.forEach(({listener:z})=>{z(this.currentResult)}),d.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function V1(c,d){return d.enabled!==!1&&!c.state.dataUpdatedAt&&!(c.state.status==="error"&&d.retryOnMount===!1)}function Uy(c,d){return V1(c,d)||c.state.dataUpdatedAt>0&&yf(c,d,d.refetchOnMount)}function yf(c,d,g){if(d.enabled!==!1){const f=typeof g=="function"?g(c):g;return f==="always"||f!==!1&&Rf(c,d)}return!1}function Vy(c,d,g,f){return g.enabled!==!1&&(c!==d||f.enabled===!1)&&(!g.suspense||c.state.status!=="error")&&Rf(c,g)}function Rf(c,d){return c.isStaleByTime(d.staleTime)}function q1(c,d,g){return g.keepPreviousData?!1:g.placeholderData!==void 0?d.isPlaceholderData:!Vh(c.getCurrentResult(),d)}class $1 extends Jo{constructor(d,g){super(),this.client=d,this.queries=[],this.result=[],this.observers=[],this.observersMap={},g&&this.setQueries(g)}onSubscribe(){this.listeners.size===1&&this.observers.forEach(d=>{d.subscribe(g=>{this.onUpdate(d,g)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.observers.forEach(d=>{d.destroy()})}setQueries(d,g){this.queries=d,er.batch(()=>{const f=this.observers,w=this.findMatchingObservers(this.queries);w.forEach(P=>P.observer.setOptions(P.defaultedQueryOptions,g));const N=w.map(P=>P.observer),T=Object.fromEntries(N.map(P=>[P.options.queryHash,P])),A=N.map(P=>P.getCurrentResult()),n=N.some((P,z)=>P!==f[z]);f.length===N.length&&!n||(this.observers=N,this.observersMap=T,this.result=A,this.hasListeners()&&(Dy(f,N).forEach(P=>{P.destroy()}),Dy(N,f).forEach(P=>{P.subscribe(z=>{this.onUpdate(P,z)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(d=>d.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(d){return this.findMatchingObservers(d).map(g=>g.observer.getOptimisticResult(g.defaultedQueryOptions))}findMatchingObservers(d){const g=this.observers,f=new Map(g.map(W=>[W.options.queryHash,W])),w=d.map(W=>this.client.defaultQueryOptions(W)),N=w.flatMap(W=>{const H=f.get(W.queryHash);return H!=null?[{defaultedQueryOptions:W,observer:H}]:[]}),T=new Set(N.map(W=>W.defaultedQueryOptions.queryHash)),A=w.filter(W=>!T.has(W.queryHash)),n=new Set(N.map(W=>W.observer)),P=g.filter(W=>!n.has(W)),z=W=>{const H=this.client.defaultQueryOptions(W),G=this.observersMap[H.queryHash];return G??new Lf(this.client,H)},q=A.map((W,H)=>{if(W.keepPreviousData){const G=P[H];if(G!==void 0)return{defaultedQueryOptions:W,observer:G}}return{defaultedQueryOptions:W,observer:z(W)}}),U=(W,H)=>w.indexOf(W.defaultedQueryOptions)-w.indexOf(H.defaultedQueryOptions);return N.concat(q).sort(U)}onUpdate(d,g){const f=this.observers.indexOf(d);f!==-1&&(this.result=E1(this.result,f,g),this.notify())}notify(){er.batch(()=>{this.listeners.forEach(({listener:d})=>{d(this.result)})})}}class G1 extends Lf{constructor(d,g){super(d,g)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(d,g){super.setOptions({...d,behavior:gf()},g)}getOptimisticResult(d){return d.behavior=gf(),super.getOptimisticResult(d)}fetchNextPage({pageParam:d,...g}={}){return this.fetch({...g,meta:{fetchMore:{direction:"forward",pageParam:d}}})}fetchPreviousPage({pageParam:d,...g}={}){return this.fetch({...g,meta:{fetchMore:{direction:"backward",pageParam:d}}})}createResult(d,g){var f,w,N,T,A,n;const{state:P}=d,z=super.createResult(d,g),{isFetching:q,isRefetching:U}=z,W=q&&((f=P.fetchMeta)==null||(w=f.fetchMore)==null?void 0:w.direction)==="forward",H=q&&((N=P.fetchMeta)==null||(T=N.fetchMore)==null?void 0:T.direction)==="backward";return{...z,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:F1(g,(A=P.data)==null?void 0:A.pages),hasPreviousPage:B1(g,(n=P.data)==null?void 0:n.pages),isFetchingNextPage:W,isFetchingPreviousPage:H,isRefetching:U&&!W&&!H}}}let Z1=class extends Jo{constructor(d,g){super(),this.client=d,this.setOptions(g),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(d){var g;const f=this.options;this.options=this.client.defaultMutationOptions(d),Vh(f,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(g=this.currentMutation)==null||g.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var d;(d=this.currentMutation)==null||d.removeObserver(this)}}onMutationUpdate(d){this.updateResult();const g={listeners:!0};d.type==="success"?g.onSuccess=!0:d.type==="error"&&(g.onError=!0),this.notify(g)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(d,g){return this.mutateOptions=g,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof d<"u"?d:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const d=this.currentMutation?this.currentMutation.state:B0(),g=d.status==="loading",f={...d,isLoading:g,isPending:g,isSuccess:d.status==="success",isError:d.status==="error",isIdle:d.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=f}notify(d){er.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(d.onSuccess){var g,f,w,N;(g=(f=this.mutateOptions).onSuccess)==null||g.call(f,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(w=(N=this.mutateOptions).onSettled)==null||w.call(N,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(d.onError){var T,A,n,P;(T=(A=this.mutateOptions).onError)==null||T.call(A,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(n=(P=this.mutateOptions).onSettled)==null||n.call(P,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}d.listeners&&this.listeners.forEach(({listener:z})=>{z(this.currentResult)})})}};var V0={exports:{}},q0={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tc=oe;function W1(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var H1=typeof Object.is=="function"?Object.is:W1,X1=tc.useState,K1=tc.useEffect,Q1=tc.useLayoutEffect,J1=tc.useDebugValue;function Y1(c,d){var g=d(),f=X1({inst:{value:g,getSnapshot:d}}),w=f[0].inst,N=f[1];return Q1(function(){w.value=g,w.getSnapshot=d,Qp(w)&&N({inst:w})},[c,g,d]),K1(function(){return Qp(w)&&N({inst:w}),c(function(){Qp(w)&&N({inst:w})})},[c]),J1(g),g}function Qp(c){var d=c.getSnapshot;c=c.value;try{var g=d();return!H1(c,g)}catch{return!0}}function ej(c,d){return d()}var tj=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ej:Y1;q0.useSyncExternalStore=tc.useSyncExternalStore!==void 0?tc.useSyncExternalStore:tj;V0.exports=q0;var sj=V0.exports;const zf=sj.useSyncExternalStore,qy=oe.createContext(void 0),$0=oe.createContext(!1);function G0(c,d){return c||(d&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=qy),window.ReactQueryClientContext):qy)}const rm=({context:c}={})=>{const d=oe.useContext(G0(c,oe.useContext($0)));if(!d)throw new Error("No QueryClient set, use QueryClientProvider to set one");return d},rj=({client:c,children:d,context:g,contextSharing:f=!1})=>{oe.useEffect(()=>(c.mount(),()=>{c.unmount()}),[c]);const w=G0(g,f);return oe.createElement($0.Provider,{value:!g&&f},oe.createElement(w.Provider,{value:c},d))},Z0=oe.createContext(!1),W0=()=>oe.useContext(Z0);Z0.Provider;function ij(){let c=!1;return{clearReset:()=>{c=!1},reset:()=>{c=!0},isReset:()=>c}}const nj=oe.createContext(ij()),H0=()=>oe.useContext(nj);function X0(c,d){return typeof c=="function"?c(...d):!!c}const K0=(c,d)=>{(c.suspense||c.useErrorBoundary)&&(d.isReset()||(c.retryOnMount=!1))},Q0=c=>{oe.useEffect(()=>{c.clearReset()},[c])},J0=({result:c,errorResetBoundary:d,useErrorBoundary:g,query:f})=>c.isError&&!d.isReset()&&!c.isFetching&&X0(g,[c.error,f]),Y0=c=>{c.suspense&&typeof c.staleTime!="number"&&(c.staleTime=1e3)},e_=(c,d)=>c.isLoading&&c.isFetching&&!d,_f=(c,d,g)=>(c==null?void 0:c.suspense)&&e_(d,g),bf=(c,d,g)=>d.fetchOptimistic(c).then(({data:f})=>{c.onSuccess==null||c.onSuccess(f),c.onSettled==null||c.onSettled(f,null)}).catch(f=>{g.clearReset(),c.onError==null||c.onError(f),c.onSettled==null||c.onSettled(void 0,f)});function aj({queries:c,context:d}){const g=rm({context:d}),f=W0(),w=H0(),N=oe.useMemo(()=>c.map(U=>{const W=g.defaultQueryOptions(U);return W._optimisticResults=f?"isRestoring":"optimistic",W}),[c,g,f]);N.forEach(U=>{Y0(U),K0(U,w)}),Q0(w);const[T]=oe.useState(()=>new $1(g,N)),A=T.getOptimisticResult(N);zf(oe.useCallback(U=>f?()=>{}:T.subscribe(er.batchCalls(U)),[T,f]),()=>T.getCurrentResult(),()=>T.getCurrentResult()),oe.useEffect(()=>{T.setQueries(N,{listeners:!1})},[N,T]);const P=A.some((U,W)=>_f(N[W],U,f))?A.flatMap((U,W)=>{const H=N[W],G=T.getObservers()[W];if(H&&G){if(_f(H,U,f))return bf(H,G,w);e_(U,f)&&bf(H,G,w)}return[]}):[];if(P.length>0)throw Promise.all(P);const z=T.getQueries(),q=A.find((U,W)=>{var H,G;return J0({result:U,errorResetBoundary:w,useErrorBoundary:(H=(G=N[W])==null?void 0:G.useErrorBoundary)!=null?H:!1,query:z[W]})});if(q!=null&&q.error)throw q.error;return A}function t_(c,d){const g=rm({context:c.context}),f=W0(),w=H0(),N=g.defaultQueryOptions(c);N._optimisticResults=f?"isRestoring":"optimistic",N.onError&&(N.onError=er.batchCalls(N.onError)),N.onSuccess&&(N.onSuccess=er.batchCalls(N.onSuccess)),N.onSettled&&(N.onSettled=er.batchCalls(N.onSettled)),Y0(N),K0(N,w),Q0(w);const[T]=oe.useState(()=>new d(g,N)),A=T.getOptimisticResult(N);if(zf(oe.useCallback(n=>{const P=f?()=>{}:T.subscribe(er.batchCalls(n));return T.updateResult(),P},[T,f]),()=>T.getCurrentResult(),()=>T.getCurrentResult()),oe.useEffect(()=>{T.setOptions(N,{listeners:!1})},[N,T]),_f(N,A,f))throw bf(N,T,w);if(J0({result:A,errorResetBoundary:w,useErrorBoundary:N.useErrorBoundary,query:T.getCurrentQuery()}))throw A.error;return N.notifyOnChangeProps?A:T.trackResult(A)}function s_(c,d,g){const f=Yl(c,d,g);return t_(f,Lf)}function oj(c,d,g){const f=C1(c,d),w=rm({context:f.context}),[N]=oe.useState(()=>new Z1(w,f));oe.useEffect(()=>{N.setOptions(f)},[N,f]);const T=zf(oe.useCallback(n=>N.subscribe(er.batchCalls(n)),[N]),()=>N.getCurrentResult(),()=>N.getCurrentResult()),A=oe.useCallback((n,P)=>{N.mutate(n,P).catch(lj)},[N]);if(T.error&&X0(N.options.useErrorBoundary,[T.error]))throw T.error;return{...T,mutate:A,mutateAsync:T.mutate}}function lj(){}function cj(c,d,g){const f=Yl(c,d,g);return t_(f,G1)}let dj={data:""},uj=c=>typeof window=="object"?((c?c.querySelector("#_goober"):window._goober)||Object.assign((c||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:c||dj,hj=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,mj=/\/\*[^]*?\*\/|  +/g,$y=/\n+/g,Qa=(c,d)=>{let g="",f="",w="";for(let N in c){let T=c[N];N[0]=="@"?N[1]=="i"?g=N+" "+T+";":f+=N[1]=="f"?Qa(T,N):N+"{"+Qa(T,N[1]=="k"?"":d)+"}":typeof T=="object"?f+=Qa(T,d?d.replace(/([^,])+/g,A=>N.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,n=>/&/.test(n)?n.replace(/&/g,A):A?A+" "+n:n)):N):T!=null&&(N=/^--/.test(N)?N:N.replace(/[A-Z]/g,"-$&").toLowerCase(),w+=Qa.p?Qa.p(N,T):N+":"+T+";")}return g+(d&&w?d+"{"+w+"}":w)+f},ha={},r_=c=>{if(typeof c=="object"){let d="";for(let g in c)d+=g+r_(c[g]);return d}return c},pj=(c,d,g,f,w)=>{let N=r_(c),T=ha[N]||(ha[N]=(n=>{let P=0,z=11;for(;P<n.length;)z=101*z+n.charCodeAt(P++)>>>0;return"go"+z})(N));if(!ha[T]){let n=N!==c?c:(P=>{let z,q,U=[{}];for(;z=hj.exec(P.replace(mj,""));)z[4]?U.shift():z[3]?(q=z[3].replace($y," ").trim(),U.unshift(U[0][q]=U[0][q]||{})):U[0][z[1]]=z[2].replace($y," ").trim();return U[0]})(c);ha[T]=Qa(w?{["@keyframes "+T]:n}:n,g?"":"."+T)}let A=g&&ha.g?ha.g:null;return g&&(ha.g=ha[T]),((n,P,z,q)=>{q?P.data=P.data.replace(q,n):P.data.indexOf(n)===-1&&(P.data=z?n+P.data:P.data+n)})(ha[T],d,f,A),T},fj=(c,d,g)=>c.reduce((f,w,N)=>{let T=d[N];if(T&&T.call){let A=T(g),n=A&&A.props&&A.props.className||/^go/.test(A)&&A;T=n?"."+n:A&&typeof A=="object"?A.props?"":Qa(A,""):A===!1?"":A}return f+w+(T??"")},"");function im(c){let d=this||{},g=c.call?c(d.p):c;return pj(g.unshift?g.raw?fj(g,[].slice.call(arguments,1),d.p):g.reduce((f,w)=>Object.assign(f,w&&w.call?w(d.p):w),{}):g,uj(d.target),d.g,d.o,d.k)}let i_,vf,wf;im.bind({g:1});let ga=im.bind({k:1});function gj(c,d,g,f){Qa.p=d,i_=c,vf=g,wf=f}function to(c,d){let g=this||{};return function(){let f=arguments;function w(N,T){let A=Object.assign({},N),n=A.className||w.className;g.p=Object.assign({theme:vf&&vf()},A),g.o=/ *go\d+/.test(n),A.className=im.apply(g,f)+(n?" "+n:"");let P=c;return c[0]&&(P=A.as||c,delete A.as),wf&&P[0]&&wf(A),i_(P,A)}return w}}var xj=c=>typeof c=="function",Gh=(c,d)=>xj(c)?c(d):c,yj=(()=>{let c=0;return()=>(++c).toString()})(),n_=(()=>{let c;return()=>{if(c===void 0&&typeof window<"u"){let d=matchMedia("(prefers-reduced-motion: reduce)");c=!d||d.matches}return c}})(),_j=20,a_=(c,d)=>{switch(d.type){case 0:return{...c,toasts:[d.toast,...c.toasts].slice(0,_j)};case 1:return{...c,toasts:c.toasts.map(N=>N.id===d.toast.id?{...N,...d.toast}:N)};case 2:let{toast:g}=d;return a_(c,{type:c.toasts.find(N=>N.id===g.id)?1:0,toast:g});case 3:let{toastId:f}=d;return{...c,toasts:c.toasts.map(N=>N.id===f||f===void 0?{...N,dismissed:!0,visible:!1}:N)};case 4:return d.toastId===void 0?{...c,toasts:[]}:{...c,toasts:c.toasts.filter(N=>N.id!==d.toastId)};case 5:return{...c,pausedAt:d.time};case 6:let w=d.time-(c.pausedAt||0);return{...c,pausedAt:void 0,toasts:c.toasts.map(N=>({...N,pauseDuration:N.pauseDuration+w}))}}},Rh=[],Zo={toasts:[],pausedAt:void 0},Yo=c=>{Zo=a_(Zo,c),Rh.forEach(d=>{d(Zo)})},bj={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},vj=(c={})=>{let[d,g]=oe.useState(Zo),f=oe.useRef(Zo);oe.useEffect(()=>(f.current!==Zo&&g(Zo),Rh.push(g),()=>{let N=Rh.indexOf(g);N>-1&&Rh.splice(N,1)}),[]);let w=d.toasts.map(N=>{var T,A,n;return{...c,...c[N.type],...N,removeDelay:N.removeDelay||((T=c[N.type])==null?void 0:T.removeDelay)||(c==null?void 0:c.removeDelay),duration:N.duration||((A=c[N.type])==null?void 0:A.duration)||(c==null?void 0:c.duration)||bj[N.type],style:{...c.style,...(n=c[N.type])==null?void 0:n.style,...N.style}}});return{...d,toasts:w}},wj=(c,d="blank",g)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:d,ariaProps:{role:"status","aria-live":"polite"},message:c,pauseDuration:0,...g,id:(g==null?void 0:g.id)||yj()}),eu=c=>(d,g)=>{let f=wj(d,c,g);return Yo({type:2,toast:f}),f.id},ti=(c,d)=>eu("blank")(c,d);ti.error=eu("error");ti.success=eu("success");ti.loading=eu("loading");ti.custom=eu("custom");ti.dismiss=c=>{Yo({type:3,toastId:c})};ti.remove=c=>Yo({type:4,toastId:c});ti.promise=(c,d,g)=>{let f=ti.loading(d.loading,{...g,...g==null?void 0:g.loading});return typeof c=="function"&&(c=c()),c.then(w=>{let N=d.success?Gh(d.success,w):void 0;return N?ti.success(N,{id:f,...g,...g==null?void 0:g.success}):ti.dismiss(f),w}).catch(w=>{let N=d.error?Gh(d.error,w):void 0;N?ti.error(N,{id:f,...g,...g==null?void 0:g.error}):ti.dismiss(f)}),c};var jj=(c,d)=>{Yo({type:1,toast:{id:c,height:d}})},Nj=()=>{Yo({type:5,time:Date.now()})},Wd=new Map,Sj=1e3,Tj=(c,d=Sj)=>{if(Wd.has(c))return;let g=setTimeout(()=>{Wd.delete(c),Yo({type:4,toastId:c})},d);Wd.set(c,g)},Ej=c=>{let{toasts:d,pausedAt:g}=vj(c);oe.useEffect(()=>{if(g)return;let N=Date.now(),T=d.map(A=>{if(A.duration===1/0)return;let n=(A.duration||0)+A.pauseDuration-(N-A.createdAt);if(n<0){A.visible&&ti.dismiss(A.id);return}return setTimeout(()=>ti.dismiss(A.id),n)});return()=>{T.forEach(A=>A&&clearTimeout(A))}},[d,g]);let f=oe.useCallback(()=>{g&&Yo({type:6,time:Date.now()})},[g]),w=oe.useCallback((N,T)=>{let{reverseOrder:A=!1,gutter:n=8,defaultPosition:P}=T||{},z=d.filter(W=>(W.position||P)===(N.position||P)&&W.height),q=z.findIndex(W=>W.id===N.id),U=z.filter((W,H)=>H<q&&W.visible).length;return z.filter(W=>W.visible).slice(...A?[U+1]:[0,U]).reduce((W,H)=>W+(H.height||0)+n,0)},[d]);return oe.useEffect(()=>{d.forEach(N=>{if(N.dismissed)Tj(N.id,N.removeDelay);else{let T=Wd.get(N.id);T&&(clearTimeout(T),Wd.delete(N.id))}})},[d]),{toasts:d,handlers:{updateHeight:jj,startPause:Nj,endPause:f,calculateOffset:w}}},Cj=ga`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,kj=ga`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Aj=ga`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Mj=to("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Cj} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${kj} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${c=>c.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Aj} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Pj=ga`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ij=to("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${c=>c.secondary||"#e0e0e0"};
  border-right-color: ${c=>c.primary||"#616161"};
  animation: ${Pj} 1s linear infinite;
`,Dj=ga`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Lj=ga`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Rj=to("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${c=>c.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Dj} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Lj} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${c=>c.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,zj=to("div")`
  position: absolute;
`,Oj=to("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Fj=ga`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Bj=to("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Fj} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Uj=({toast:c})=>{let{icon:d,type:g,iconTheme:f}=c;return d!==void 0?typeof d=="string"?oe.createElement(Bj,null,d):d:g==="blank"?null:oe.createElement(Oj,null,oe.createElement(Ij,{...f}),g!=="loading"&&oe.createElement(zj,null,g==="error"?oe.createElement(Mj,{...f}):oe.createElement(Rj,{...f})))},Vj=c=>`
0% {transform: translate3d(0,${c*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,qj=c=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${c*-150}%,-1px) scale(.6); opacity:0;}
`,$j="0%{opacity:0;} 100%{opacity:1;}",Gj="0%{opacity:1;} 100%{opacity:0;}",Zj=to("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Wj=to("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Hj=(c,d)=>{let g=c.includes("top")?1:-1,[f,w]=n_()?[$j,Gj]:[Vj(g),qj(g)];return{animation:d?`${ga(f)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${ga(w)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Xj=oe.memo(({toast:c,position:d,style:g,children:f})=>{let w=c.height?Hj(c.position||d||"top-center",c.visible):{opacity:0},N=oe.createElement(Uj,{toast:c}),T=oe.createElement(Wj,{...c.ariaProps},Gh(c.message,c));return oe.createElement(Zj,{className:c.className,style:{...w,...g,...c.style}},typeof f=="function"?f({icon:N,message:T}):oe.createElement(oe.Fragment,null,N,T))});gj(oe.createElement);var Kj=({id:c,className:d,style:g,onHeightUpdate:f,children:w})=>{let N=oe.useCallback(T=>{if(T){let A=()=>{let n=T.getBoundingClientRect().height;f(c,n)};A(),new MutationObserver(A).observe(T,{subtree:!0,childList:!0,characterData:!0})}},[c,f]);return oe.createElement("div",{ref:N,className:d,style:g},w)},Qj=(c,d)=>{let g=c.includes("top"),f=g?{top:0}:{bottom:0},w=c.includes("center")?{justifyContent:"center"}:c.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:n_()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${d*(g?1:-1)}px)`,...f,...w}},Jj=im`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Ih=16,Yj=({reverseOrder:c,position:d="top-center",toastOptions:g,gutter:f,children:w,containerStyle:N,containerClassName:T})=>{let{toasts:A,handlers:n}=Ej(g);return oe.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Ih,left:Ih,right:Ih,bottom:Ih,pointerEvents:"none",...N},className:T,onMouseEnter:n.startPause,onMouseLeave:n.endPause},A.map(P=>{let z=P.position||d,q=n.calculateOffset(P,{reverseOrder:c,gutter:f,defaultPosition:d}),U=Qj(z,q);return oe.createElement(Kj,{id:P.id,key:P.id,onHeightUpdate:n.updateHeight,className:P.visible?Jj:"",style:U},P.type==="custom"?Gh(P.message,P):w?w(P):oe.createElement(Xj,{toast:P,position:z}))}))},Pt=ti;function eN(c){return c}function tN(c){return c.length===0?eN:c.length===1?c[0]:function(g){return c.reduce((f,w)=>w(f),g)}}function o_(c){const d={subscribe(g){let f=null,w=!1,N=!1,T=!1;function A(){if(f===null){T=!0;return}N||(N=!0,typeof f=="function"?f():f&&f.unsubscribe())}return f=c({next(n){var P;w||(P=g.next)==null||P.call(g,n)},error(n){var P;w||(w=!0,(P=g.error)==null||P.call(g,n),A())},complete(){var n;w||(w=!0,(n=g.complete)==null||n.call(g),A())}}),T&&A(),{unsubscribe:A}},pipe(...g){return tN(g)(d)}};return d}function sN(c){return d=>{let g=0,f=null;const w=[];function N(){f||(f=d.subscribe({next(A){var n;for(const P of w)(n=P.next)==null||n.call(P,A)},error(A){var n;for(const P of w)(n=P.error)==null||n.call(P,A)},complete(){var A;for(const n of w)(A=n.complete)==null||A.call(n)}}))}function T(){if(g===0&&f){const A=f;f=null,A.unsubscribe()}}return{subscribe(A){return g++,w.push(A),N(),{unsubscribe(){g--,T();const n=w.findIndex(P=>P===A);n>-1&&w.splice(n,1)}}}}}}class Of extends Error{constructor(d){super(d),this.name="ObservableAbortError",Object.setPrototypeOf(this,Of.prototype)}}function rN(c){let d;return{promise:new Promise((f,w)=>{let N=!1;function T(){N||(N=!0,w(new Of("This operation was aborted.")),A.unsubscribe())}const A=c.subscribe({next(n){N=!0,f(n),T()},error(n){N=!0,w(n),T()},complete(){N=!0,T()}});d=T}),abort:d}}function iN(c){return o_(d=>{function g(w=0,N=c.op){const T=c.links[w];if(!T)throw new Error("No more links to execute - did you forget to add an ending link?");return T({op:N,next(n){return g(w+1,n)}})}return g().subscribe(d)})}function l_(c){const d=Object.create(null);for(const g in c){const f=c[g];d[f]=g}return d}const c_={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};l_(c_);l_(c_);const d_=()=>{};function u_(c,d){return new Proxy(d_,{get(f,w){if(!(typeof w!="string"||w==="then"))return u_(c,[...d,w])},apply(f,w,N){const T=d[d.length-1]==="apply";return c({args:T?N.length>=2?N[1]:[]:N,path:T?d.slice(0,-1):d})}})}const nm=c=>u_(c,[]),Ff=c=>new Proxy(d_,{get(d,g){if(!(typeof g!="string"||g==="then"))return c(g)}});function nN(c){return!!c&&!Array.isArray(c)&&typeof c=="object"}class aN extends Error{}function oN(c){if(c instanceof Error)return c;const d=typeof c;if(!(d==="undefined"||d==="function"||c===null)){if(d!=="object")return new Error(String(c));if(nN(c)){const g=new aN;for(const f in c)g[f]=c[f];return g}}}function Zh(c){return!!c&&!Array.isArray(c)&&typeof c=="object"}function lN(c,d){if("error"in c){const f=d.transformer.deserialize(c.error);return{ok:!1,error:{...c,error:f}}}return{ok:!0,result:{...c.result,...(!c.result.type||c.result.type==="data")&&{type:"data",data:d.transformer.deserialize(c.result.data)}}}}class Jp extends Error{constructor(){super("Unable to transform response from server")}}function cN(c,d){let g;try{g=lN(c,d)}catch{throw new Jp}if(!g.ok&&(!Zh(g.error.error)||typeof g.error.error.code!="number"))throw new Jp;if(g.ok&&!Zh(g.result))throw new Jp;return g}function dN(c){return c instanceof $n||c instanceof Error&&c.name==="TRPCClientError"}function uN(c){return Zh(c)&&Zh(c.error)&&typeof c.error.code=="number"&&typeof c.error.message=="string"}class $n extends Error{static from(d,g={}){const f=d;return dN(f)?(g.meta&&(f.meta={...f.meta,...g.meta}),f):uN(f)?new $n(f.error.message,{...g,result:f}):f instanceof Error?new $n(f.message,{...g,cause:oN(f)}):new $n("Unknown error",{...g,cause:f})}constructor(d,g){var w,N;const f=g==null?void 0:g.cause;super(d,{cause:f}),this.meta=g==null?void 0:g.meta,this.cause=f,this.shape=(w=g==null?void 0:g.result)==null?void 0:w.error,this.data=(N=g==null?void 0:g.result)==null?void 0:N.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,$n.prototype)}}const Gy=c=>typeof c=="function";function hN(c){if(c)return c;if(typeof window<"u"&&Gy(window.fetch))return window.fetch;if(typeof globalThis<"u"&&Gy(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}function mN(c){return c||(typeof window<"u"&&window.AbortController?window.AbortController:typeof globalThis<"u"&&globalThis.AbortController?globalThis.AbortController:null)}function pN(c){return{url:c.url.toString().replace(/\/$/,""),fetch:c.fetch,AbortController:mN(c.AbortController)}}function fN(c){const d={};for(let g=0;g<c.length;g++){const f=c[g];d[g]=f}return d}const gN={query:"GET",mutation:"POST"};function h_(c){return"input"in c?c.runtime.transformer.serialize(c.input):fN(c.inputs.map(d=>c.runtime.transformer.serialize(d)))}const xN=c=>{let d=c.url+"/"+c.path;const g=[];if("inputs"in c&&g.push("batch=1"),c.type==="query"){const f=h_(c);f!==void 0&&g.push(`input=${encodeURIComponent(JSON.stringify(f))}`)}return g.length&&(d+="?"+g.join("&")),d},yN=c=>{if(c.type==="query")return;const d=h_(c);return d!==void 0?JSON.stringify(d):void 0},_N=c=>vN({...c,contentTypeHeader:"application/json",getUrl:xN,getBody:yN});async function bN(c,d){const g=c.getUrl(c),f=c.getBody(c),{type:w}=c,N=await c.headers();/* istanbul ignore if -- @preserve */if(w==="subscription")throw new Error("Subscriptions should use wsLink");const T={...c.contentTypeHeader?{"content-type":c.contentTypeHeader}:{},...c.batchModeHeader?{"trpc-batch-mode":c.batchModeHeader}:{},...N};return hN(c.fetch)(g,{method:gN[w],signal:d==null?void 0:d.signal,body:f,headers:T})}function vN(c){const d=c.AbortController?new c.AbortController:null,g={};let f=!1;return{promise:new Promise((T,A)=>{bN(c,d).then(n=>(g.response=n,f=!0,n.json())).then(n=>{g.responseJSON=n,T({json:n,meta:g})}).catch(n=>{f=!0,A($n.from(n,{meta:g}))})}),cancel:()=>{f||d==null||d.abort()}}}function wN(c){return d=>{const g=pN(d);return f=>({op:w})=>o_(N=>{const{path:T,input:A,type:n}=w,{promise:P,cancel:z}=c.requester({...g,runtime:f,type:n,path:T,input:A,headers(){return d.headers?typeof d.headers=="function"?d.headers({op:w}):d.headers:{}}});let q;return P.then(U=>{q=U.meta;const W=cN(U.json,f);if(!W.ok){N.error($n.from(W.error,{meta:q}));return}N.next({context:U.meta,result:W.result}),N.complete()}).catch(U=>{N.error($n.from(U,{meta:q}))}),()=>{z()}})}}const jN=wN({requester:_N});class NN{$request({type:d,input:g,path:f,context:w={}}){return iN({links:this.links,op:{id:++this.requestId,type:d,path:f,input:g,context:w}}).pipe(sN())}requestAsPromise(d){const g=this.$request(d),{promise:f,abort:w}=rN(g);return new Promise((T,A)=>{var n;(n=d.signal)==null||n.addEventListener("abort",w),f.then(P=>{T(P.result.data)}).catch(P=>{A($n.from(P))})})}query(d,g,f){return this.requestAsPromise({type:"query",path:d,input:g,context:f==null?void 0:f.context,signal:f==null?void 0:f.signal})}mutation(d,g,f){return this.requestAsPromise({type:"mutation",path:d,input:g,context:f==null?void 0:f.context,signal:f==null?void 0:f.signal})}subscription(d,g,f){return this.$request({type:"subscription",path:d,input:g,context:f==null?void 0:f.context}).subscribe({next(N){var T,A,n;N.result.type==="started"?(T=f.onStarted)==null||T.call(f):N.result.type==="stopped"?(A=f.onStopped)==null||A.call(f):(n=f.onData)==null||n.call(f,N.result.data)},error(N){var T;(T=f.onError)==null||T.call(f,N)},complete(){var N;(N=f.onComplete)==null||N.call(f)}})}constructor(d){this.requestId=0;const g=(()=>{const f=d.transformer;return f?"input"in f?d.transformer:{input:f,output:f}:{input:{serialize:w=>w,deserialize:w=>w},output:{serialize:w=>w,deserialize:w=>w}}})();this.runtime={transformer:{serialize:f=>g.input.serialize(f),deserialize:f=>g.output.deserialize(f)},combinedTransformer:g},this.links=d.links.map(f=>f(this.runtime))}}function SN(c){return new NN(c)}const TN={query:"query",mutate:"mutation",subscribe:"subscription"},EN=c=>TN[c];function CN(c){return Ff(d=>c.hasOwnProperty(d)?c[d]:d==="__untypedClient"?c:nm(({path:g,args:f})=>{const w=[d,...g],N=EN(w.pop()),T=w.join(".");return c[N](T,...f)}))}function _r(c,d){const g=Array.isArray(c)?c:[c],[f,w]=g,N=typeof f!="string"||f===""?[]:f.split(".");return!w&&(!d||d==="any")?N.length?[N]:[]:[N,{...typeof w<"u"&&{input:w},...d&&d!=="any"&&{type:d}}]}function Wh(c,d){return c.length?d===void 0?[c]:[c,d]:[]}function kN(c,d){return nm(g=>{const f=g.args,w=[c,...g.path],N=w.pop(),T=w.join(".");if(N==="useMutation")return d[N](T,...f);const[A,...n]=f,P=Wh(T,A);if(N==="getQueryKey")return _r(P,n[0]??"any");if(N==="_def")return{path:w};if(N.startsWith("useSuspense")){const z=n[0]||{},U=d[N==="useSuspenseQuery"?"useQuery":"useInfiniteQuery"](P,{...z,suspense:!0,enabled:!0});return[U.data,U]}return d[N](P,...n)})}const AN=["client","ssrContext","ssrState","abortOnUnmount"],MN=oe.createContext(null);function PN(c){return Ff(d=>{const g=d;return g==="client"?CN(c.client):AN.includes(g)?c[g]:nm(({path:f,args:w})=>{const N=[d,...f],T=N.pop(),A=N.join("."),n=W=>{if(["setData","setInfiniteData"].includes(W)){const[de,ne,...te]=w;return{queryKey:Wh(A,de),updater:ne,rest:te}}const[H,...G]=w;return{queryKey:Wh(A,H),rest:G}},{queryKey:P,rest:z,updater:q}=n(T);return{fetch:()=>c.fetchQuery(P,...z),fetchInfinite:()=>c.fetchInfiniteQuery(P,...z),prefetch:()=>c.prefetchQuery(P,...z),prefetchInfinite:()=>c.prefetchInfiniteQuery(P,...z),ensureData:()=>c.ensureQueryData(P,...z),invalidate:()=>c.invalidateQueries(P,...z),reset:()=>c.resetQueries(P,...z),refetch:()=>c.refetchQueries(P,...z),cancel:()=>c.cancelQuery(P,...z),setData:()=>{c.setQueryData(P,q,...z)},setInfiniteData:()=>{c.setInfiniteQueryData(P,q,...z)},getData:()=>c.getQueryData(P),getInfiniteData:()=>c.getInfiniteQueryData(P)}[T]()})})}function IN(c){return nm(d=>{const g=d.path.join("."),[f,w]=d.args;return{queryKey:Wh(g,f),queryFn:()=>c.query(g,f,w==null?void 0:w.trpc),...w}})}function Wa(c,d){const[g,f]=c;return[g,f,d==null?void 0:d.trpc]}function Yp(c){const{path:d}=c;return oe.useMemo(()=>({path:d}),[d])}function DN(c){const d=H=>H.originalFn(),g=MN,f=c==null?void 0:c.reactQueryContext,w=H=>SN(H),N=H=>{const{abortOnUnmount:G=!1,client:J,queryClient:de,ssrContext:ne}=H,[te,Ne]=oe.useState(H.ssrState??!1);return oe.useEffect(()=>{Ne(me=>me?"mounted":!1)},[]),ei.createElement(g.Provider,{value:{abortOnUnmount:G,queryClient:de,client:J,ssrContext:ne??null,ssrState:te,fetchQuery:oe.useCallback((me,Pe)=>de.fetchQuery({...Pe,queryKey:_r(me,"query"),queryFn:()=>J.query(...Wa(me,Pe))}),[J,de]),fetchInfiniteQuery:oe.useCallback((me,Pe)=>de.fetchInfiniteQuery({...Pe,queryKey:_r(me,"infinite"),queryFn:({pageParam:Se})=>{const[fe,Be]=me,ke={...Be,cursor:Se};return J.query(...Wa([fe,ke],Pe))}}),[J,de]),prefetchQuery:oe.useCallback((me,Pe)=>de.prefetchQuery({...Pe,queryKey:_r(me,"query"),queryFn:()=>J.query(...Wa(me,Pe))}),[J,de]),prefetchInfiniteQuery:oe.useCallback((me,Pe)=>de.prefetchInfiniteQuery({...Pe,queryKey:_r(me,"infinite"),queryFn:({pageParam:Se})=>{const[fe,Be]=me,ke={...Be,cursor:Se};return J.query(...Wa([fe,ke],Pe))}}),[J,de]),ensureQueryData:oe.useCallback((me,Pe)=>de.ensureQueryData({...Pe,queryKey:_r(me,"query"),queryFn:()=>J.query(...Wa(me,Pe))}),[J,de]),invalidateQueries:oe.useCallback((me,Pe,Se)=>de.invalidateQueries({...Pe,queryKey:_r(me,"any")},Se),[de]),resetQueries:oe.useCallback((...me)=>{const[Pe,Se,fe]=me;return de.resetQueries({...Se,queryKey:_r(Pe,"any")},fe)},[de]),refetchQueries:oe.useCallback((...me)=>{const[Pe,Se,fe]=me;return de.refetchQueries({...Se,queryKey:_r(Pe,"any")},fe)},[de]),cancelQuery:oe.useCallback(me=>de.cancelQueries({queryKey:_r(me,"any")}),[de]),setQueryData:oe.useCallback((...me)=>{const[Pe,...Se]=me;return de.setQueryData(_r(Pe,"query"),...Se)},[de]),getQueryData:oe.useCallback((...me)=>{const[Pe,...Se]=me;return de.getQueryData(_r(Pe,"query"),...Se)},[de]),setInfiniteQueryData:oe.useCallback((...me)=>{const[Pe,...Se]=me;return de.setQueryData(_r(Pe,"infinite"),...Se)},[de]),getInfiniteQueryData:oe.useCallback((...me)=>{const[Pe,...Se]=me;return de.getQueryData(_r(Pe,"infinite"),...Se)},[de])}},H.children)};function T(){return ei.useContext(g)}function A(H,G,J){var te;const{queryClient:de,ssrState:ne}=T();return ne&&ne!=="mounted"&&((te=de.getQueryCache().find(_r(H,G)))==null?void 0:te.state.status)==="error"?{retryOnMount:!1,...J}:J}function n(H,G){var ke,Ge;const J=T();if(!J)throw new Error("Unable to retrieve application context. Did you forget to wrap your App inside `withTRPC` HoC?");const{abortOnUnmount:de,client:ne,ssrState:te,queryClient:Ne,prefetchQuery:me}=J,Pe=Ne.getQueryDefaults(_r(H,"query"));typeof window>"u"&&te==="prepass"&&((ke=G==null?void 0:G.trpc)==null?void 0:ke.ssr)!==!1&&((G==null?void 0:G.enabled)??(Pe==null?void 0:Pe.enabled))!==!1&&!Ne.getQueryCache().find(_r(H,"query"))&&me(H,G);const Se=A(H,"query",{...Pe,...G}),fe=((Ge=G==null?void 0:G.trpc)==null?void 0:Ge.abortOnUnmount)??(c==null?void 0:c.abortOnUnmount)??de,Be=s_({...Se,queryKey:_r(H,"query"),queryFn:we=>{const Me={...Se,trpc:{...Se==null?void 0:Se.trpc,...fe?{signal:we.signal}:{}}};return ne.query(...Wa(H,Me))},context:f});return Be.trpc=Yp({path:H[0]}),Be}function P(H,G){const{client:J}=T(),de=rm({context:f}),ne=Array.isArray(H)?H[0]:H,te=de.getMutationDefaults([ne.split(".")]),Ne=oj({...G,mutationKey:[ne.split(".")],mutationFn:me=>J.mutation(...Wa([ne,me],G)),context:f,onSuccess(...me){return d({originalFn:()=>{var Se,fe;return((Se=G==null?void 0:G.onSuccess)==null?void 0:Se.call(G,...me))??((fe=te==null?void 0:te.onSuccess)==null?void 0:fe.call(te,...me))},queryClient:de,meta:(G==null?void 0:G.meta)??(te==null?void 0:te.meta)??{}})}});return Ne.trpc=Yp({path:ne}),Ne}/* istanbul ignore next -- @preserve */function z(H,G){const J=(G==null?void 0:G.enabled)??!0,de=Ya(H),{client:ne}=T(),te=oe.useRef(G);te.current=G,oe.useEffect(()=>{if(!J)return;const[Ne,me]=H;let Pe=!1;const Se=ne.subscription(Ne,me??void 0,{onStarted:()=>{var fe,Be;Pe||(Be=(fe=te.current).onStarted)==null||Be.call(fe)},onData:fe=>{Pe||te.current.onData(fe)},onError:fe=>{var Be,ke;Pe||(ke=(Be=te.current).onError)==null||ke.call(Be,fe)}});return()=>{Pe=!0,Se.unsubscribe()}},[de,J])}function q(H,G){var Ge,we;const[J,de]=H,{client:ne,ssrState:te,prefetchInfiniteQuery:Ne,queryClient:me,abortOnUnmount:Pe}=T(),Se=me.getQueryDefaults(_r(H,"infinite"));typeof window>"u"&&te==="prepass"&&((Ge=G==null?void 0:G.trpc)==null?void 0:Ge.ssr)!==!1&&((G==null?void 0:G.enabled)??(Se==null?void 0:Se.enabled))!==!1&&!me.getQueryCache().find(_r(H,"infinite"))&&Ne(H,{...Se,...G});const fe=A(H,"infinite",{...Se,...G}),Be=((we=G==null?void 0:G.trpc)==null?void 0:we.abortOnUnmount)??Pe,ke=cj({...fe,queryKey:_r(H,"infinite"),queryFn:Me=>{const st={...fe,trpc:{...fe==null?void 0:fe.trpc,...Be?{signal:Me.signal}:{}}},lt={...de??{},cursor:Me.pageParam??(G==null?void 0:G.initialCursor)};return ne.query(...Wa([J,lt],st))},context:f});return ke.trpc=Yp({path:J}),ke}return{Provider:N,createClient:w,useContext:T,useUtils:T,useQuery:n,useQueries:(H,G)=>{var Pe;const{ssrState:J,queryClient:de,prefetchQuery:ne,client:te}=T(),Ne=IN(te),me=H(Ne);if(typeof window>"u"&&J==="prepass")for(const Se of me){const fe=Se;((Pe=fe.trpc)==null?void 0:Pe.ssr)!==!1&&!de.getQueryCache().find(_r(fe.queryKey,"query"))&&ne(fe.queryKey,fe)}return aj({queries:me.map(Se=>({...Se,queryKey:_r(Se.queryKey,"query")})),context:G})},useMutation:P,useSubscription:z,useDehydratedState:(H,G)=>oe.useMemo(()=>G&&H.runtime.transformer.deserialize(G),[G,H]),useInfiniteQuery:q}}function LN(c){return DN(c)}function RN(c){return Ff(d=>d==="useContext"||d==="useUtils"?()=>{const g=c.useUtils();return oe.useMemo(()=>PN(g),[g])}:c.hasOwnProperty(d)?c[d]:kN(d,c))}function zN(c){const d=LN(c);return RN(d)}const xt=zN(),ON=xt.createClient({links:[jN({url:"/api/v1/trpc",headers:async()=>{try{let c=localStorage.getItem("auth_token");if(!c){const d=Object.keys(localStorage);for(const g of d)if(g.includes("auth-token")){const f=localStorage.getItem(g);try{const w=JSON.parse(f);if(w&&w.access_token){c=w.access_token;break}}catch{}}}return c?{Authorization:`Bearer ${c}`}:{}}catch(c){return console.warn("Failed to get auth token for tRPC:",c),{}}}})]}),m_=oe.createContext(void 0),am=()=>{const c=oe.useContext(m_);if(c===void 0)throw new Error("useAuth must be used within an AuthProvider");return c},FN=({children:c})=>{const[d,g]=oe.useState({user:null,adminUser:null,loading:!0,error:null}),f=xt.auth.login.useMutation(),w=xt.auth.register.useMutation(),N=xt.auth.logout.useMutation(),T=async(z,q)=>{g(U=>({...U,loading:!0,error:null}));try{const U=await f.mutateAsync({email:z,password:q});localStorage.setItem("auth_token",U.session.access_token),localStorage.setItem("refresh_token",U.session.refresh_token),g({user:U.user,adminUser:U.user,loading:!1,error:null}),window.location.href="/dashboard"}catch(U){throw console.error("Login error:",U),g(W=>({...W,loading:!1,error:U.message||"Authentication failed"})),U}},A=async(z,q,U)=>{g(W=>({...W,loading:!0,error:null}));try{const W=await w.mutateAsync({email:z,password:q,name:U});g(H=>({...H,loading:!1,error:null}))}catch(W){throw g(H=>({...H,loading:!1,error:W.message||"Registration failed"})),W}},n=async()=>{g(z=>({...z,loading:!0}));try{await N.mutateAsync()}catch{}localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),g({user:null,adminUser:null,loading:!1,error:null})};oe.useEffect(()=>{(async()=>{let q=localStorage.getItem("auth_token");if(!q){const W=Object.keys(localStorage);for(const H of W){const G=localStorage.getItem(H);try{const J=JSON.parse(G);if(J&&J.access_token){q=J.access_token;break}}catch{}}}const U=window.location.pathname==="/login"||window.location.pathname==="/";if(!q){g(W=>({...W,user:null,adminUser:null,loading:!1})),U||(window.location.href="/login");return}try{const G=await(await fetch("https://ordermanagementsystem-production-3ed7.up.railway.app/api/v1/trpc/auth.me",{method:"GET",headers:{Authorization:`Bearer ${q}`}})).json();if(G&&G.result&&G.result.data){const J=G.result.data;g({user:J.user,adminUser:J.user,loading:!1,error:null})}else throw new Error("Invalid response format from auth.me")}catch(W){console.error("Auth initialization failed:",W==null?void 0:W.message),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),g({user:null,adminUser:null,loading:!1,error:null}),U||(window.location.href="/login")}})()},[]);const P={...d,signIn:T,signOut:n,register:A};return t.jsx(m_.Provider,{value:P,children:c})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var BN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Lt=(c,d)=>{const g=oe.forwardRef(({color:f="currentColor",size:w=24,strokeWidth:N=2,absoluteStrokeWidth:T,className:A="",children:n,...P},z)=>oe.createElement("svg",{ref:z,...BN,width:w,height:w,stroke:f,strokeWidth:T?Number(N)*24/Number(w):N,className:["lucide",`lucide-${UN(c)}`,A].join(" "),...P},[...d.map(([q,U])=>oe.createElement(q,U)),...Array.isArray(n)?n:[n]]));return g.displayName=`${c}`,g};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zy=Lt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tu=Lt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=Lt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bf=Lt("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=Lt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_=Lt("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VN=Lt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=Lt("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qN=Lt("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f_=Lt("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=Lt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $N=Lt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=Lt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GN=Lt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const om=Lt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_=Lt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=Lt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZN=Lt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=Lt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WN=Lt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=Lt("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uf=Lt("Cylinder",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5v14a9 3 0 0 0 18 0V5",key:"aqi0yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=Lt("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=Lt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XN=Lt("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lm=Lt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=Lt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qd=Lt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=Lt("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"8ur5zv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=Lt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QN=Lt("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=Lt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JN=Lt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=Lt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eS=Lt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=Lt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tS=Lt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=Lt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_=Lt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_=Lt("Package2",[["path",{d:"M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z",key:"1ront0"}],["path",{d:"m3 9 2.45-4.9A2 2 0 0 1 7.24 3h9.52a2 2 0 0 1 1.8 1.1L21 9",key:"19h2x1"}],["path",{d:"M12 3v6",key:"1holv5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=Lt("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rS=Lt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iS=Lt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=Lt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=Lt("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const el=Lt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=Lt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_=Lt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jf=Lt("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=Lt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nS=Lt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=Lt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sc=Lt("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fi=Lt("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hh=Lt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oS=Lt("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=Lt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wy=Lt("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=Lt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=Lt("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cm=Lt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rc=Lt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=Lt("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qf=Lt("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lS=Lt("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=Lt("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=Lt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cS=Lt("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),dS=({children:c})=>{const{user:d,adminUser:g,loading:f}=am();return f?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}):!d||!g?t.jsx(k0,{to:"/login",replace:!0}):t.jsx(t.Fragment,{children:c})},uS=({onMenuClick:c})=>{const{adminUser:d,signOut:g}=am(),f=async()=>{try{await g()}catch(w){console.error("Error signing out:",w)}};return t.jsxs("header",{className:"bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:c,className:"lg:hidden p-2 rounded-md hover:bg-gray-100 transition-colors",children:t.jsx(tS,{className:"h-6 w-6 text-gray-600"})}),t.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"LPG Order Management"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(cm,{className:"h-4 w-4"}),t.jsxs("div",{className:"flex flex-col items-end",children:[t.jsx("span",{className:"font-medium text-gray-900",children:d==null?void 0:d.name}),t.jsx("span",{className:"text-xs text-gray-500",children:d==null?void 0:d.email})]})]})}),t.jsxs("button",{onClick:f,className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:[t.jsx(YN,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Sign Out"})]})]})]})},hS=[{name:"Dashboard",href:"/",icon:QN},{name:"Customers",href:"/customers",icon:rc},{name:"Products",href:"/products",icon:ps},{name:"Warehouses",href:"/warehouses",icon:Cn},{name:"Inventory",href:"/inventory",icon:Ko},{name:"Trucks",href:"/trucks",icon:br},{name:"Fleet Capacity",href:"/trucks/capacity",icon:sn},{name:"Pricing",href:"/pricing",icon:tn},{name:"Orders",href:"/orders",icon:sc},{name:"Transfers",href:"/transfers",icon:Bf}],mS=({isOpen:c,onClose:d})=>t.jsxs(t.Fragment,{children:[c&&t.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden",onClick:d}),t.jsxs("aside",{className:`
          fixed top-0 left-0 z-50 h-full w-64 bg-gray-900 transform transition-transform duration-300 ease-in-out
          ${c?"translate-x-0":"-translate-x-full"}
          lg:translate-x-0 lg:static lg:z-auto lg:flex-shrink-0
        `,children:[t.jsxs("div",{className:"flex items-center justify-between p-4 lg:hidden border-b border-gray-700",children:[t.jsx("span",{className:"text-lg font-semibold text-white",children:"Menu"}),t.jsx("button",{onClick:d,className:"p-2 rounded-md hover:bg-gray-800 transition-colors",children:t.jsx(ar,{className:"h-5 w-5 text-gray-300"})})]}),t.jsx("div",{className:"hidden lg:flex items-center justify-center h-16 bg-gray-800 border-b border-gray-700",children:t.jsx("span",{className:"text-lg font-semibold text-white",children:"LPG Admin"})}),t.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-y-auto",children:hS.map(g=>t.jsxs(p1,{to:g.href,onClick:d,className:({isActive:f})=>`flex items-center space-x-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${f?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-800"}`,children:[t.jsx(g.icon,{className:"h-5 w-5"}),t.jsx("span",{children:g.name})]},g.name))})]})]}),pS=()=>{const[c,d]=oe.useState(!1);return t.jsxs("div",{className:"h-screen flex overflow-hidden bg-gray-50",children:[t.jsx(mS,{isOpen:c,onClose:()=>d(!1)}),t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[t.jsx(uS,{onMenuClick:()=>d(!c)}),t.jsx("main",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"p-6",children:t.jsx(f1,{})})})]})]})},fS=()=>{const{user:c,signIn:d,loading:g,error:f}=am(),[w,N]=oe.useState({email:"",password:""}),[T,A]=oe.useState(!1);if(c)return t.jsx(k0,{to:"/",replace:!0});const n=async z=>{z.preventDefault(),A(!0);try{await d(w.email,w.password)}catch{}finally{A(!1)}},P=z=>{N(q=>({...q,[z.target.name]:z.target.value}))};return g?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"max-w-md w-full space-y-8",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mx-auto h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center",children:t.jsx(__,{className:"h-8 w-8 text-white"})}),t.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Admin Portal"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"LPG Order Management System"})]}),t.jsxs("form",{className:"mt-8 space-y-6",onSubmit:n,children:[f&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tu,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-600",children:f})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),t.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:w.email,onChange:P,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter your email"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),t.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:w.password,onChange:P,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter your password"})]})]}),t.jsx("button",{type:"submit",disabled:T,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:T?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Signing in..."})]}):"Sign In"})]}),t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-xs text-gray-500",children:"Authorized personnel only. Please contact your administrator if you need access."})})]})})},gS=(c="month")=>xt.analytics.getDashboardStats.useQuery({period:c},{retry:1,staleTime:6e4,refetchInterval:5*60*1e3}),Hy=()=>{const{adminUser:c}=am(),{data:d,isLoading:g,refetch:f}=gS(),w=[{name:"Active Customers",value:g?"...":((d==null?void 0:d.activeCustomers)||0).toLocaleString(),total:g?"...":((d==null?void 0:d.totalCustomers)||0).toLocaleString(),change:g?"...":`${(d==null?void 0:d.totalCustomers)||0} total`,changeType:"neutral",icon:rc},{name:"Active Products",value:g?"...":((d==null?void 0:d.activeProducts)||0).toLocaleString(),total:g?"...":((d==null?void 0:d.totalProducts)||0).toLocaleString(),change:g?"...":`${(d==null?void 0:d.totalProducts)||0} total`,changeType:"neutral",icon:ps},{name:"Total Cylinders",value:g?"...":((d==null?void 0:d.totalCylinders)||0).toLocaleString(),change:g?"...":"across all warehouses",changeType:"positive",icon:sn},{name:"Warehouses",value:g?"...":((d==null?void 0:d.totalWarehouses)||0).toLocaleString(),change:g?"...":"storage locations",changeType:"neutral",icon:Cn}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),t.jsxs("p",{className:"text-gray-600",children:["Welcome ",c==null?void 0:c.name,"!"]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>f(),disabled:g,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(el,{className:`h-4 w-4 ${g?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsx(Ko,{className:"h-8 w-8 text-blue-600"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:w.map(N=>t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:N.name}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.value})]}),t.jsx("div",{className:"p-3 bg-blue-50 rounded-full",children:t.jsx(N.icon,{className:"h-6 w-6 text-blue-600"})})]}),t.jsx("div",{className:"mt-4 flex items-center",children:t.jsx("span",{className:"text-sm text-gray-500",children:N.change})})]},N.name))}),!g&&d&&d.lowStockProducts>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vs,{className:"h-5 w-5 text-red-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Low Stock Alert"}),t.jsxs("p",{className:"text-sm text-red-700",children:[d.lowStockProducts," product",d.lowStockProducts>1?"s have":" has"," low stock levels (10 available)"]})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("button",{onClick:()=>window.location.href="/orders",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(sc,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"New Order"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Create a new customer order"})]}),t.jsxs("button",{onClick:()=>window.location.href="/customers",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(rc,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"Add Customer"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Register a new customer"})]}),t.jsxs("button",{onClick:()=>window.location.href="/inventory",className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[t.jsx(ps,{className:"h-8 w-8 text-blue-600 mb-2"}),t.jsx("h3",{className:"font-medium text-gray-900",children:"Manage Inventory"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Update product stock levels"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),t.jsx(Zy,{className:"h-5 w-5 text-gray-400"})]}),t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Zy,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"Recent activity tracking coming soon"})]})]})]})},N_=(c={})=>xt.customers.list.useQuery({search:c.search,status:c.status,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Customers fetch error:",d),Pt.error("Failed to load customers")}}),xS=c=>xt.customers.getById.useQuery({customer_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Customer fetch error:",d),Pt.error("Failed to load customer details")}}),yS=()=>{const c=xt.useContext();return xt.customers.create.useMutation({onSuccess:d=>{console.log("Customer created successfully:",d),c.customers.list.invalidate(),Pt.success("Customer created successfully")},onError:d=>{console.error("Create customer error:",d),Pt.error(d.message||"Failed to create customer")}})},S_=()=>{const c=xt.useContext();return xt.customers.update.useMutation({onSuccess:d=>{console.log("Customer updated successfully:",d),c.customers.list.invalidate(),c.customers.getById.invalidate({customer_id:d.id}),Pt.success("Customer updated successfully")},onError:d=>{console.error("Update customer error:",d),Pt.error(d.message||"Failed to update customer")}})},_S=()=>{const c=xt.useContext();return xt.customers.delete.useMutation({onSuccess:()=>{console.log("Customer deleted successfully"),c.customers.list.invalidate(),Pt.success("Customer deleted successfully")},onError:d=>{console.error("Delete customer error:",d),Pt.error(d.message||"Failed to delete customer")}})},su=({status:c,className:d="",children:g,size:f="md"})=>{const w=()=>{switch(c){case"active":return"bg-green-100 text-green-800 border-green-200";case"credit_hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"closed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},N=()=>{if(g)return g;switch(c){case"active":return"Active";case"credit_hold":return"Credit Hold";case"closed":return"Closed";default:return c}},T=()=>{switch(f){case"sm":return"px-1.5 py-0.5 text-xs";case"lg":return"px-3 py-1 text-sm";default:return"px-2.5 py-0.5 text-xs"}};return t.jsx("span",{className:`inline-flex items-center rounded-full font-medium border ${w()} ${T()} ${d}`,children:N()})},bS=({customers:c,loading:d=!1,onView:g,onDelete:f,onStatusChange:w})=>{const N=T=>new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return console.log("CustomerTable render:",{customers:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading customers..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(rc,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No customers found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load customers. Please check your connection.":"Get started by adding your first customer."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Customers (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credit Terms"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(T=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:T.name}),T.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",T.external_id]}),T.tax_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Tax ID: ",T.tax_id]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[T.email&&t.jsx("div",{className:"mb-1",children:T.email}),T.phone&&t.jsx("div",{className:"text-gray-500",children:T.phone}),!T.email&&!T.phone&&t.jsx("span",{className:"text-gray-400",children:"No contact info"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(su,{status:T.account_status,size:"sm"}),t.jsxs("select",{value:T.account_status,onChange:A=>w(T,A.target.value),className:"block w-20 text-xs border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",title:"Change account status",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[T.credit_terms_days," days"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(T.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(T),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View/Edit customer",children:t.jsx(fi,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>f(T),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete customer",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},T.id))})]})})]})},vS=({filters:c,onFiltersChange:d})=>{const g=w=>{d({...c,search:w.target.value||void 0,page:1})},f=w=>{d({...c,account_status:w.target.value||void 0,page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name, email, or tax ID...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.account_status||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]})})]})})},ac=({currentPage:c,totalPages:d,totalCount:g,onPageChange:f})=>{if(d<=1)return null;const N=(()=>{const A=[],n=[];for(let P=Math.max(2,c-2);P<=Math.min(d-1,c+2);P++)A.push(P);return c-2>2?n.push(1,"..."):n.push(1),n.push(...A),c+2<d-1?n.push("...",d):n.push(d),n})();return t.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[t.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[t.jsx("button",{onClick:()=>f(c-1),disabled:c===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),t.jsx("button",{onClick:()=>f(c+1),disabled:c===d,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),t.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[t.jsx("div",{children:t.jsxs("p",{className:"text-sm text-gray-700",children:["Showing"," ",t.jsx("span",{className:"font-medium",children:Math.min((c-1)*50+1,g)})," ","to"," ",t.jsx("span",{className:"font-medium",children:Math.min(c*50,g)})," ","of ",t.jsx("span",{className:"font-medium",children:g})," results"]})}),t.jsx("div",{children:t.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[t.jsx("button",{onClick:()=>f(c-1),disabled:c===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(g_,{className:"h-5 w-5"})}),N.map((T,A)=>t.jsx(ei.Fragment,{children:T==="..."?t.jsx("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:"..."}):t.jsx("button",{onClick:()=>f(T),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${c===T?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:T})},A)),t.jsx("button",{onClick:()=>f(c+1),disabled:c===d,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(x_,{className:"h-5 w-5"})})]})})]})]})};var ru=c=>c.type==="checkbox",Wo=c=>c instanceof Date,bi=c=>c==null;const T_=c=>typeof c=="object";var Er=c=>!bi(c)&&!Array.isArray(c)&&T_(c)&&!Wo(c),wS=c=>Er(c)&&c.target?ru(c.target)?c.target.checked:c.target.value:c,jS=c=>c.substring(0,c.search(/\.\d+(\.|$)/))||c,NS=(c,d)=>c.has(jS(d)),SS=c=>{const d=c.constructor&&c.constructor.prototype;return Er(d)&&d.hasOwnProperty("isPrototypeOf")},$f=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function mi(c){let d;const g=Array.isArray(c),f=typeof FileList<"u"?c instanceof FileList:!1;if(c instanceof Date)d=new Date(c);else if(c instanceof Set)d=new Set(c);else if(!($f&&(c instanceof Blob||f))&&(g||Er(c)))if(d=g?[]:{},!g&&!SS(c))d=c;else for(const w in c)c.hasOwnProperty(w)&&(d[w]=mi(c[w]));else return c;return d}var dm=c=>Array.isArray(c)?c.filter(Boolean):[],Lr=c=>c===void 0,Ut=(c,d,g)=>{if(!d||!Er(c))return g;const f=dm(d.split(/[,[\].]+?/)).reduce((w,N)=>bi(w)?w:w[N],c);return Lr(f)||f===c?Lr(c[d])?g:c[d]:f},qn=c=>typeof c=="boolean",Gf=c=>/^\w*$/.test(c),E_=c=>dm(c.replace(/["|']|\]/g,"").split(/\.|\[/)),Ys=(c,d,g)=>{let f=-1;const w=Gf(d)?[d]:E_(d),N=w.length,T=N-1;for(;++f<N;){const A=w[f];let n=g;if(f!==T){const P=c[A];n=Er(P)||Array.isArray(P)?P:isNaN(+w[f+1])?{}:[]}if(A==="__proto__"||A==="constructor"||A==="prototype")return;c[A]=n,c=c[A]}};const Xy={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Sn={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ma={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ei.createContext(null);var TS=(c,d,g,f=!0)=>{const w={defaultValues:d._defaultValues};for(const N in c)Object.defineProperty(w,N,{get:()=>{const T=N;return d._proxyFormState[T]!==Sn.all&&(d._proxyFormState[T]=!f||Sn.all),c[T]}});return w};const ES=typeof window<"u"?oe.useLayoutEffect:oe.useEffect;var Gn=c=>typeof c=="string",CS=(c,d,g,f,w)=>Gn(c)?(f&&d.watch.add(c),Ut(g,c,w)):Array.isArray(c)?c.map(N=>(f&&d.watch.add(N),Ut(g,N))):(f&&(d.watchAll=!0),g),kS=(c,d,g,f,w)=>d?{...g[c],types:{...g[c]&&g[c].types?g[c].types:{},[f]:w||!0}}:{},Hd=c=>Array.isArray(c)?c:[c],Ky=()=>{let c=[];return{get observers(){return c},next:w=>{for(const N of c)N.next&&N.next(w)},subscribe:w=>(c.push(w),{unsubscribe:()=>{c=c.filter(N=>N!==w)}}),unsubscribe:()=>{c=[]}}},Nf=c=>bi(c)||!T_(c);function Ja(c,d){if(Nf(c)||Nf(d))return c===d;if(Wo(c)&&Wo(d))return c.getTime()===d.getTime();const g=Object.keys(c),f=Object.keys(d);if(g.length!==f.length)return!1;for(const w of g){const N=c[w];if(!f.includes(w))return!1;if(w!=="ref"){const T=d[w];if(Wo(N)&&Wo(T)||Er(N)&&Er(T)||Array.isArray(N)&&Array.isArray(T)?!Ja(N,T):N!==T)return!1}}return!0}var Pi=c=>Er(c)&&!Object.keys(c).length,Zf=c=>c.type==="file",Tn=c=>typeof c=="function",Xh=c=>{if(!$f)return!1;const d=c?c.ownerDocument:0;return c instanceof(d&&d.defaultView?d.defaultView.HTMLElement:HTMLElement)},C_=c=>c.type==="select-multiple",Wf=c=>c.type==="radio",AS=c=>Wf(c)||ru(c),ef=c=>Xh(c)&&c.isConnected;function MS(c,d){const g=d.slice(0,-1).length;let f=0;for(;f<g;)c=Lr(c)?f++:c[d[f++]];return c}function PS(c){for(const d in c)if(c.hasOwnProperty(d)&&!Lr(c[d]))return!1;return!0}function qr(c,d){const g=Array.isArray(d)?d:Gf(d)?[d]:E_(d),f=g.length===1?c:MS(c,g),w=g.length-1,N=g[w];return f&&delete f[N],w!==0&&(Er(f)&&Pi(f)||Array.isArray(f)&&PS(f))&&qr(c,g.slice(0,-1)),c}var k_=c=>{for(const d in c)if(Tn(c[d]))return!0;return!1};function Kh(c,d={}){const g=Array.isArray(c);if(Er(c)||g)for(const f in c)Array.isArray(c[f])||Er(c[f])&&!k_(c[f])?(d[f]=Array.isArray(c[f])?[]:{},Kh(c[f],d[f])):bi(c[f])||(d[f]=!0);return d}function A_(c,d,g){const f=Array.isArray(c);if(Er(c)||f)for(const w in c)Array.isArray(c[w])||Er(c[w])&&!k_(c[w])?Lr(d)||Nf(g[w])?g[w]=Array.isArray(c[w])?Kh(c[w],[]):{...Kh(c[w])}:A_(c[w],bi(d)?{}:d[w],g[w]):g[w]=!Ja(c[w],d[w]);return g}var Vd=(c,d)=>A_(c,d,Kh(d));const Qy={value:!1,isValid:!1},Jy={value:!0,isValid:!0};var M_=c=>{if(Array.isArray(c)){if(c.length>1){const d=c.filter(g=>g&&g.checked&&!g.disabled).map(g=>g.value);return{value:d,isValid:!!d.length}}return c[0].checked&&!c[0].disabled?c[0].attributes&&!Lr(c[0].attributes.value)?Lr(c[0].value)||c[0].value===""?Jy:{value:c[0].value,isValid:!0}:Jy:Qy}return Qy},P_=(c,{valueAsNumber:d,valueAsDate:g,setValueAs:f})=>Lr(c)?c:d?c===""?NaN:c&&+c:g&&Gn(c)?new Date(c):f?f(c):c;const Yy={isValid:!1,value:null};var I_=c=>Array.isArray(c)?c.reduce((d,g)=>g&&g.checked&&!g.disabled?{isValid:!0,value:g.value}:d,Yy):Yy;function e0(c){const d=c.ref;return Zf(d)?d.files:Wf(d)?I_(c.refs).value:C_(d)?[...d.selectedOptions].map(({value:g})=>g):ru(d)?M_(c.refs).value:P_(Lr(d.value)?c.ref.value:d.value,c)}var IS=(c,d,g,f)=>{const w={};for(const N of c){const T=Ut(d,N);T&&Ys(w,N,T._f)}return{criteriaMode:g,names:[...c],fields:w,shouldUseNativeValidation:f}},Qh=c=>c instanceof RegExp,qd=c=>Lr(c)?c:Qh(c)?c.source:Er(c)?Qh(c.value)?c.value.source:c.value:c,t0=c=>({isOnSubmit:!c||c===Sn.onSubmit,isOnBlur:c===Sn.onBlur,isOnChange:c===Sn.onChange,isOnAll:c===Sn.all,isOnTouch:c===Sn.onTouched});const s0="AsyncFunction";var DS=c=>!!c&&!!c.validate&&!!(Tn(c.validate)&&c.validate.constructor.name===s0||Er(c.validate)&&Object.values(c.validate).find(d=>d.constructor.name===s0)),LS=c=>c.mount&&(c.required||c.min||c.max||c.maxLength||c.minLength||c.pattern||c.validate),r0=(c,d,g)=>!g&&(d.watchAll||d.watch.has(c)||[...d.watch].some(f=>c.startsWith(f)&&/^\.\w+/.test(c.slice(f.length))));const Xd=(c,d,g,f)=>{for(const w of g||Object.keys(c)){const N=Ut(c,w);if(N){const{_f:T,...A}=N;if(T){if(T.refs&&T.refs[0]&&d(T.refs[0],w)&&!f)return!0;if(T.ref&&d(T.ref,T.name)&&!f)return!0;if(Xd(A,d))break}else if(Er(A)&&Xd(A,d))break}}};function i0(c,d,g){const f=Ut(c,g);if(f||Gf(g))return{error:f,name:g};const w=g.split(".");for(;w.length;){const N=w.join("."),T=Ut(d,N),A=Ut(c,N);if(T&&!Array.isArray(T)&&g!==N)return{name:g};if(A&&A.type)return{name:N,error:A};if(A&&A.root&&A.root.type)return{name:`${N}.root`,error:A.root};w.pop()}return{name:g}}var RS=(c,d,g,f)=>{g(c);const{name:w,...N}=c;return Pi(N)||Object.keys(N).length>=Object.keys(d).length||Object.keys(N).find(T=>d[T]===(!f||Sn.all))},zS=(c,d,g)=>!c||!d||c===d||Hd(c).some(f=>f&&(g?f===d:f.startsWith(d)||d.startsWith(f))),OS=(c,d,g,f,w)=>w.isOnAll?!1:!g&&w.isOnTouch?!(d||c):(g?f.isOnBlur:w.isOnBlur)?!c:(g?f.isOnChange:w.isOnChange)?c:!0,FS=(c,d)=>!dm(Ut(c,d)).length&&qr(c,d),BS=(c,d,g)=>{const f=Hd(Ut(c,g));return Ys(f,"root",d[g]),Ys(c,g,f),c},zh=c=>Gn(c);function n0(c,d,g="validate"){if(zh(c)||Array.isArray(c)&&c.every(zh)||qn(c)&&!c)return{type:g,message:zh(c)?c:"",ref:d}}var Jl=c=>Er(c)&&!Qh(c)?c:{value:c,message:""},a0=async(c,d,g,f,w,N)=>{const{ref:T,refs:A,required:n,maxLength:P,minLength:z,min:q,max:U,pattern:W,validate:H,name:G,valueAsNumber:J,mount:de}=c._f,ne=Ut(g,G);if(!de||d.has(G))return{};const te=A?A[0]:T,Ne=we=>{w&&te.reportValidity&&(te.setCustomValidity(qn(we)?"":we||""),te.reportValidity())},me={},Pe=Wf(T),Se=ru(T),fe=Pe||Se,Be=(J||Zf(T))&&Lr(T.value)&&Lr(ne)||Xh(T)&&T.value===""||ne===""||Array.isArray(ne)&&!ne.length,ke=kS.bind(null,G,f,me),Ge=(we,Me,st,lt=ma.maxLength,St=ma.minLength)=>{const ft=we?Me:st;me[G]={type:we?lt:St,message:ft,ref:T,...ke(we?lt:St,ft)}};if(N?!Array.isArray(ne)||!ne.length:n&&(!fe&&(Be||bi(ne))||qn(ne)&&!ne||Se&&!M_(A).isValid||Pe&&!I_(A).isValid)){const{value:we,message:Me}=zh(n)?{value:!!n,message:n}:Jl(n);if(we&&(me[G]={type:ma.required,message:Me,ref:te,...ke(ma.required,Me)},!f))return Ne(Me),me}if(!Be&&(!bi(q)||!bi(U))){let we,Me;const st=Jl(U),lt=Jl(q);if(!bi(ne)&&!isNaN(ne)){const St=T.valueAsNumber||ne&&+ne;bi(st.value)||(we=St>st.value),bi(lt.value)||(Me=St<lt.value)}else{const St=T.valueAsDate||new Date(ne),ft=Fs=>new Date(new Date().toDateString()+" "+Fs),Mt=T.type=="time",mt=T.type=="week";Gn(st.value)&&ne&&(we=Mt?ft(ne)>ft(st.value):mt?ne>st.value:St>new Date(st.value)),Gn(lt.value)&&ne&&(Me=Mt?ft(ne)<ft(lt.value):mt?ne<lt.value:St<new Date(lt.value))}if((we||Me)&&(Ge(!!we,st.message,lt.message,ma.max,ma.min),!f))return Ne(me[G].message),me}if((P||z)&&!Be&&(Gn(ne)||N&&Array.isArray(ne))){const we=Jl(P),Me=Jl(z),st=!bi(we.value)&&ne.length>+we.value,lt=!bi(Me.value)&&ne.length<+Me.value;if((st||lt)&&(Ge(st,we.message,Me.message),!f))return Ne(me[G].message),me}if(W&&!Be&&Gn(ne)){const{value:we,message:Me}=Jl(W);if(Qh(we)&&!ne.match(we)&&(me[G]={type:ma.pattern,message:Me,ref:T,...ke(ma.pattern,Me)},!f))return Ne(Me),me}if(H){if(Tn(H)){const we=await H(ne,g),Me=n0(we,te);if(Me&&(me[G]={...Me,...ke(ma.validate,Me.message)},!f))return Ne(Me.message),me}else if(Er(H)){let we={};for(const Me in H){if(!Pi(we)&&!f)break;const st=n0(await H[Me](ne,g),te,Me);st&&(we={...st,...ke(Me,st.message)},Ne(st.message),f&&(me[G]=we))}if(!Pi(we)&&(me[G]={ref:te,...we},!f))return me}}return Ne(!0),me};const US={mode:Sn.onSubmit,reValidateMode:Sn.onChange,shouldFocusError:!0};function VS(c={}){let d={...US,...c},g={submitCount:0,isDirty:!1,isReady:!1,isLoading:Tn(d.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:d.errors||{},disabled:d.disabled||!1};const f={};let w=Er(d.defaultValues)||Er(d.values)?mi(d.defaultValues||d.values)||{}:{},N=d.shouldUnregister?{}:mi(w),T={action:!1,mount:!1,watch:!1},A={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},n,P=0;const z={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let q={...z};const U={array:Ky(),state:Ky()},W=d.criteriaMode===Sn.all,H=je=>$e=>{clearTimeout(P),P=setTimeout(je,$e)},G=async je=>{if(!d.disabled&&(z.isValid||q.isValid||je)){const $e=d.resolver?Pi((await Se()).errors):await Be(f,!0);$e!==g.isValid&&U.state.next({isValid:$e})}},J=(je,$e)=>{!d.disabled&&(z.isValidating||z.validatingFields||q.isValidating||q.validatingFields)&&((je||Array.from(A.mount)).forEach(et=>{et&&($e?Ys(g.validatingFields,et,$e):qr(g.validatingFields,et))}),U.state.next({validatingFields:g.validatingFields,isValidating:!Pi(g.validatingFields)}))},de=(je,$e=[],et,Ct,wt=!0,yt=!0)=>{if(Ct&&et&&!d.disabled){if(T.action=!0,yt&&Array.isArray(Ut(f,je))){const Ot=et(Ut(f,je),Ct.argA,Ct.argB);wt&&Ys(f,je,Ot)}if(yt&&Array.isArray(Ut(g.errors,je))){const Ot=et(Ut(g.errors,je),Ct.argA,Ct.argB);wt&&Ys(g.errors,je,Ot),FS(g.errors,je)}if((z.touchedFields||q.touchedFields)&&yt&&Array.isArray(Ut(g.touchedFields,je))){const Ot=et(Ut(g.touchedFields,je),Ct.argA,Ct.argB);wt&&Ys(g.touchedFields,je,Ot)}(z.dirtyFields||q.dirtyFields)&&(g.dirtyFields=Vd(w,N)),U.state.next({name:je,isDirty:Ge(je,$e),dirtyFields:g.dirtyFields,errors:g.errors,isValid:g.isValid})}else Ys(N,je,$e)},ne=(je,$e)=>{Ys(g.errors,je,$e),U.state.next({errors:g.errors})},te=je=>{g.errors=je,U.state.next({errors:g.errors,isValid:!1})},Ne=(je,$e,et,Ct)=>{const wt=Ut(f,je);if(wt){const yt=Ut(N,je,Lr(et)?Ut(w,je):et);Lr(yt)||Ct&&Ct.defaultChecked||$e?Ys(N,je,$e?yt:e0(wt._f)):st(je,yt),T.mount&&G()}},me=(je,$e,et,Ct,wt)=>{let yt=!1,Ot=!1;const hs={name:je};if(!d.disabled){if(!et||Ct){(z.isDirty||q.isDirty)&&(Ot=g.isDirty,g.isDirty=hs.isDirty=Ge(),yt=Ot!==hs.isDirty);const as=Ja(Ut(w,je),$e);Ot=!!Ut(g.dirtyFields,je),as?qr(g.dirtyFields,je):Ys(g.dirtyFields,je,!0),hs.dirtyFields=g.dirtyFields,yt=yt||(z.dirtyFields||q.dirtyFields)&&Ot!==!as}if(et){const as=Ut(g.touchedFields,je);as||(Ys(g.touchedFields,je,et),hs.touchedFields=g.touchedFields,yt=yt||(z.touchedFields||q.touchedFields)&&as!==et)}yt&&wt&&U.state.next(hs)}return yt?hs:{}},Pe=(je,$e,et,Ct)=>{const wt=Ut(g.errors,je),yt=(z.isValid||q.isValid)&&qn($e)&&g.isValid!==$e;if(d.delayError&&et?(n=H(()=>ne(je,et)),n(d.delayError)):(clearTimeout(P),n=null,et?Ys(g.errors,je,et):qr(g.errors,je)),(et?!Ja(wt,et):wt)||!Pi(Ct)||yt){const Ot={...Ct,...yt&&qn($e)?{isValid:$e}:{},errors:g.errors,name:je};g={...g,...Ot},U.state.next(Ot)}},Se=async je=>{J(je,!0);const $e=await d.resolver(N,d.context,IS(je||A.mount,f,d.criteriaMode,d.shouldUseNativeValidation));return J(je),$e},fe=async je=>{const{errors:$e}=await Se(je);if(je)for(const et of je){const Ct=Ut($e,et);Ct?Ys(g.errors,et,Ct):qr(g.errors,et)}else g.errors=$e;return $e},Be=async(je,$e,et={valid:!0})=>{for(const Ct in je){const wt=je[Ct];if(wt){const{_f:yt,...Ot}=wt;if(yt){const hs=A.array.has(yt.name),as=wt._f&&DS(wt._f);as&&z.validatingFields&&J([Ct],!0);const it=await a0(wt,A.disabled,N,W,d.shouldUseNativeValidation&&!$e,hs);if(as&&z.validatingFields&&J([Ct]),it[yt.name]&&(et.valid=!1,$e))break;!$e&&(Ut(it,yt.name)?hs?BS(g.errors,it,yt.name):Ys(g.errors,yt.name,it[yt.name]):qr(g.errors,yt.name))}!Pi(Ot)&&await Be(Ot,$e,et)}}return et.valid},ke=()=>{for(const je of A.unMount){const $e=Ut(f,je);$e&&($e._f.refs?$e._f.refs.every(et=>!ef(et)):!ef($e._f.ref))&&vs(je)}A.unMount=new Set},Ge=(je,$e)=>!d.disabled&&(je&&$e&&Ys(N,je,$e),!Ja(Fs(),w)),we=(je,$e,et)=>CS(je,A,{...T.mount?N:Lr($e)?w:Gn(je)?{[je]:$e}:$e},et,$e),Me=je=>dm(Ut(T.mount?N:w,je,d.shouldUnregister?Ut(w,je,[]):[])),st=(je,$e,et={})=>{const Ct=Ut(f,je);let wt=$e;if(Ct){const yt=Ct._f;yt&&(!yt.disabled&&Ys(N,je,P_($e,yt)),wt=Xh(yt.ref)&&bi($e)?"":$e,C_(yt.ref)?[...yt.ref.options].forEach(Ot=>Ot.selected=wt.includes(Ot.value)):yt.refs?ru(yt.ref)?yt.refs.forEach(Ot=>{(!Ot.defaultChecked||!Ot.disabled)&&(Array.isArray(wt)?Ot.checked=!!wt.find(hs=>hs===Ot.value):Ot.checked=wt===Ot.value||!!wt)}):yt.refs.forEach(Ot=>Ot.checked=Ot.value===wt):Zf(yt.ref)?yt.ref.value="":(yt.ref.value=wt,yt.ref.type||U.state.next({name:je,values:mi(N)})))}(et.shouldDirty||et.shouldTouch)&&me(je,wt,et.shouldTouch,et.shouldDirty,!0),et.shouldValidate&&mt(je)},lt=(je,$e,et)=>{for(const Ct in $e){if(!$e.hasOwnProperty(Ct))return;const wt=$e[Ct],yt=je+"."+Ct,Ot=Ut(f,yt);(A.array.has(je)||Er(wt)||Ot&&!Ot._f)&&!Wo(wt)?lt(yt,wt,et):st(yt,wt,et)}},St=(je,$e,et={})=>{const Ct=Ut(f,je),wt=A.array.has(je),yt=mi($e);Ys(N,je,yt),wt?(U.array.next({name:je,values:mi(N)}),(z.isDirty||z.dirtyFields||q.isDirty||q.dirtyFields)&&et.shouldDirty&&U.state.next({name:je,dirtyFields:Vd(w,N),isDirty:Ge(je,yt)})):Ct&&!Ct._f&&!bi(yt)?lt(je,yt,et):st(je,yt,et),r0(je,A)&&U.state.next({...g}),U.state.next({name:T.mount?je:void 0,values:mi(N)})},ft=async je=>{T.mount=!0;const $e=je.target;let et=$e.name,Ct=!0;const wt=Ut(f,et),yt=as=>{Ct=Number.isNaN(as)||Wo(as)&&isNaN(as.getTime())||Ja(as,Ut(N,et,as))},Ot=t0(d.mode),hs=t0(d.reValidateMode);if(wt){let as,it;const qt=$e.type?e0(wt._f):wS(je),Ns=je.type===Xy.BLUR||je.type===Xy.FOCUS_OUT,tr=!LS(wt._f)&&!d.resolver&&!Ut(g.errors,et)&&!wt._f.deps||OS(Ns,Ut(g.touchedFields,et),g.isSubmitted,hs,Ot),cr=r0(et,A,Ns);Ys(N,et,qt),Ns?(wt._f.onBlur&&wt._f.onBlur(je),n&&n(0)):wt._f.onChange&&wt._f.onChange(je);const sr=me(et,qt,Ns),rr=!Pi(sr)||cr;if(!Ns&&U.state.next({name:et,type:je.type,values:mi(N)}),tr)return(z.isValid||q.isValid)&&(d.mode==="onBlur"?Ns&&G():Ns||G()),rr&&U.state.next({name:et,...cr?{}:sr});if(!Ns&&cr&&U.state.next({...g}),d.resolver){const{errors:ii}=await Se([et]);if(yt(qt),Ct){const Kr=i0(g.errors,f,et),Qr=i0(ii,f,Kr.name||et);as=Qr.error,et=Qr.name,it=Pi(ii)}}else J([et],!0),as=(await a0(wt,A.disabled,N,W,d.shouldUseNativeValidation))[et],J([et]),yt(qt),Ct&&(as?it=!1:(z.isValid||q.isValid)&&(it=await Be(f,!0)));Ct&&(wt._f.deps&&mt(wt._f.deps),Pe(et,it,as,sr))}},Mt=(je,$e)=>{if(Ut(g.errors,$e)&&je.focus)return je.focus(),1},mt=async(je,$e={})=>{let et,Ct;const wt=Hd(je);if(d.resolver){const yt=await fe(Lr(je)?je:wt);et=Pi(yt),Ct=je?!wt.some(Ot=>Ut(yt,Ot)):et}else je?(Ct=(await Promise.all(wt.map(async yt=>{const Ot=Ut(f,yt);return await Be(Ot&&Ot._f?{[yt]:Ot}:Ot)}))).every(Boolean),!(!Ct&&!g.isValid)&&G()):Ct=et=await Be(f);return U.state.next({...!Gn(je)||(z.isValid||q.isValid)&&et!==g.isValid?{}:{name:je},...d.resolver||!je?{isValid:et}:{},errors:g.errors}),$e.shouldFocus&&!Ct&&Xd(f,Mt,je?wt:A.mount),Ct},Fs=je=>{const $e={...T.mount?N:w};return Lr(je)?$e:Gn(je)?Ut($e,je):je.map(et=>Ut($e,et))},ts=(je,$e)=>({invalid:!!Ut(($e||g).errors,je),isDirty:!!Ut(($e||g).dirtyFields,je),error:Ut(($e||g).errors,je),isValidating:!!Ut(g.validatingFields,je),isTouched:!!Ut(($e||g).touchedFields,je)}),Is=je=>{je&&Hd(je).forEach($e=>qr(g.errors,$e)),U.state.next({errors:je?g.errors:{}})},lr=(je,$e,et)=>{const Ct=(Ut(f,je,{_f:{}})._f||{}).ref,wt=Ut(g.errors,je)||{},{ref:yt,message:Ot,type:hs,...as}=wt;Ys(g.errors,je,{...as,...$e,ref:Ct}),U.state.next({name:je,errors:g.errors,isValid:!1}),et&&et.shouldFocus&&Ct&&Ct.focus&&Ct.focus()},js=(je,$e)=>Tn(je)?U.state.subscribe({next:et=>je(we(void 0,$e),et)}):we(je,$e,!0),Sr=je=>U.state.subscribe({next:$e=>{zS(je.name,$e.name,je.exact)&&RS($e,je.formState||z,$r,je.reRenderRoot)&&je.callback({values:{...N},...g,...$e})}}).unsubscribe,Tr=je=>(T.mount=!0,q={...q,...je.formState},Sr({...je,formState:q})),vs=(je,$e={})=>{for(const et of je?Hd(je):A.mount)A.mount.delete(et),A.array.delete(et),$e.keepValue||(qr(f,et),qr(N,et)),!$e.keepError&&qr(g.errors,et),!$e.keepDirty&&qr(g.dirtyFields,et),!$e.keepTouched&&qr(g.touchedFields,et),!$e.keepIsValidating&&qr(g.validatingFields,et),!d.shouldUnregister&&!$e.keepDefaultValue&&qr(w,et);U.state.next({values:mi(N)}),U.state.next({...g,...$e.keepDirty?{isDirty:Ge()}:{}}),!$e.keepIsValid&&G()},ss=({disabled:je,name:$e})=>{(qn(je)&&T.mount||je||A.disabled.has($e))&&(je?A.disabled.add($e):A.disabled.delete($e))},Or=(je,$e={})=>{let et=Ut(f,je);const Ct=qn($e.disabled)||qn(d.disabled);return Ys(f,je,{...et||{},_f:{...et&&et._f?et._f:{ref:{name:je}},name:je,mount:!0,...$e}}),A.mount.add(je),et?ss({disabled:qn($e.disabled)?$e.disabled:d.disabled,name:je}):Ne(je,!0,$e.value),{...Ct?{disabled:$e.disabled||d.disabled}:{},...d.progressive?{required:!!$e.required,min:qd($e.min),max:qd($e.max),minLength:qd($e.minLength),maxLength:qd($e.maxLength),pattern:qd($e.pattern)}:{},name:je,onChange:ft,onBlur:ft,ref:wt=>{if(wt){Or(je,$e),et=Ut(f,je);const yt=Lr(wt.value)&&wt.querySelectorAll&&wt.querySelectorAll("input,select,textarea")[0]||wt,Ot=AS(yt),hs=et._f.refs||[];if(Ot?hs.find(as=>as===yt):yt===et._f.ref)return;Ys(f,je,{_f:{...et._f,...Ot?{refs:[...hs.filter(ef),yt,...Array.isArray(Ut(w,je))?[{}]:[]],ref:{type:yt.type,name:je}}:{ref:yt}}}),Ne(je,!1,void 0,yt)}else et=Ut(f,je,{}),et._f&&(et._f.mount=!1),(d.shouldUnregister||$e.shouldUnregister)&&!(NS(A.array,je)&&T.action)&&A.unMount.add(je)}}},Cr=()=>d.shouldFocusError&&Xd(f,Mt,A.mount),Li=je=>{qn(je)&&(U.state.next({disabled:je}),Xd(f,($e,et)=>{const Ct=Ut(f,et);Ct&&($e.disabled=Ct._f.disabled||je,Array.isArray(Ct._f.refs)&&Ct._f.refs.forEach(wt=>{wt.disabled=Ct._f.disabled||je}))},0,!1))},Wt=(je,$e)=>async et=>{let Ct;et&&(et.preventDefault&&et.preventDefault(),et.persist&&et.persist());let wt=mi(N);if(U.state.next({isSubmitting:!0}),d.resolver){const{errors:yt,values:Ot}=await Se();g.errors=yt,wt=Ot}else await Be(f);if(A.disabled.size)for(const yt of A.disabled)Ys(wt,yt,void 0);if(qr(g.errors,"root"),Pi(g.errors)){U.state.next({errors:{}});try{await je(wt,et)}catch(yt){Ct=yt}}else $e&&await $e({...g.errors},et),Cr(),setTimeout(Cr);if(U.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Pi(g.errors)&&!Ct,submitCount:g.submitCount+1,errors:g.errors}),Ct)throw Ct},gi=(je,$e={})=>{Ut(f,je)&&(Lr($e.defaultValue)?St(je,mi(Ut(w,je))):(St(je,$e.defaultValue),Ys(w,je,mi($e.defaultValue))),$e.keepTouched||qr(g.touchedFields,je),$e.keepDirty||(qr(g.dirtyFields,je),g.isDirty=$e.defaultValue?Ge(je,mi(Ut(w,je))):Ge()),$e.keepError||(qr(g.errors,je),z.isValid&&G()),U.state.next({...g}))},vr=(je,$e={})=>{const et=je?mi(je):w,Ct=mi(et),wt=Pi(je),yt=wt?w:Ct;if($e.keepDefaultValues||(w=et),!$e.keepValues){if($e.keepDirtyValues){const Ot=new Set([...A.mount,...Object.keys(Vd(w,N))]);for(const hs of Array.from(Ot))Ut(g.dirtyFields,hs)?Ys(yt,hs,Ut(N,hs)):St(hs,Ut(yt,hs))}else{if($f&&Lr(je))for(const Ot of A.mount){const hs=Ut(f,Ot);if(hs&&hs._f){const as=Array.isArray(hs._f.refs)?hs._f.refs[0]:hs._f.ref;if(Xh(as)){const it=as.closest("form");if(it){it.reset();break}}}}for(const Ot of A.mount)St(Ot,Ut(yt,Ot))}N=mi(yt),U.array.next({values:{...yt}}),U.state.next({values:{...yt}})}A={mount:$e.keepDirtyValues?A.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},T.mount=!z.isValid||!!$e.keepIsValid||!!$e.keepDirtyValues,T.watch=!!d.shouldUnregister,U.state.next({submitCount:$e.keepSubmitCount?g.submitCount:0,isDirty:wt?!1:$e.keepDirty?g.isDirty:!!($e.keepDefaultValues&&!Ja(je,w)),isSubmitted:$e.keepIsSubmitted?g.isSubmitted:!1,dirtyFields:wt?{}:$e.keepDirtyValues?$e.keepDefaultValues&&N?Vd(w,N):g.dirtyFields:$e.keepDefaultValues&&je?Vd(w,je):$e.keepDirty?g.dirtyFields:{},touchedFields:$e.keepTouched?g.touchedFields:{},errors:$e.keepErrors?g.errors:{},isSubmitSuccessful:$e.keepIsSubmitSuccessful?g.isSubmitSuccessful:!1,isSubmitting:!1})},wi=(je,$e)=>vr(Tn(je)?je(N):je,$e),Ds=(je,$e={})=>{const et=Ut(f,je),Ct=et&&et._f;if(Ct){const wt=Ct.refs?Ct.refs[0]:Ct.ref;wt.focus&&(wt.focus(),$e.shouldSelect&&Tn(wt.select)&&wt.select())}},$r=je=>{g={...g,...je}},ri={control:{register:Or,unregister:vs,getFieldState:ts,handleSubmit:Wt,setError:lr,_subscribe:Sr,_runSchema:Se,_focusError:Cr,_getWatch:we,_getDirty:Ge,_setValid:G,_setFieldArray:de,_setDisabledField:ss,_setErrors:te,_getFieldArray:Me,_reset:vr,_resetDefaultValues:()=>Tn(d.defaultValues)&&d.defaultValues().then(je=>{wi(je,d.resetOptions),U.state.next({isLoading:!1})}),_removeUnmounted:ke,_disableForm:Li,_subjects:U,_proxyFormState:z,get _fields(){return f},get _formValues(){return N},get _state(){return T},set _state(je){T=je},get _defaultValues(){return w},get _names(){return A},set _names(je){A=je},get _formState(){return g},get _options(){return d},set _options(je){d={...d,...je}}},subscribe:Tr,trigger:mt,register:Or,handleSubmit:Wt,watch:js,setValue:St,getValues:Fs,reset:wi,resetField:gi,clearErrors:Is,unregister:vs,setError:lr,setFocus:Ds,getFieldState:ts};return{...ri,formControl:ri}}function kn(c={}){const d=ei.useRef(void 0),g=ei.useRef(void 0),[f,w]=ei.useState({isDirty:!1,isValidating:!1,isLoading:Tn(c.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:c.errors||{},disabled:c.disabled||!1,isReady:!1,defaultValues:Tn(c.defaultValues)?void 0:c.defaultValues});d.current||(d.current={...c.formControl?c.formControl:VS(c),formState:f},c.formControl&&c.defaultValues&&!Tn(c.defaultValues)&&c.formControl.reset(c.defaultValues,c.resetOptions));const N=d.current.control;return N._options=c,ES(()=>{const T=N._subscribe({formState:N._proxyFormState,callback:()=>w({...N._formState}),reRenderRoot:!0});return w(A=>({...A,isReady:!0})),N._formState.isReady=!0,T},[N]),ei.useEffect(()=>N._disableForm(c.disabled),[N,c.disabled]),ei.useEffect(()=>{c.mode&&(N._options.mode=c.mode),c.reValidateMode&&(N._options.reValidateMode=c.reValidateMode)},[N,c.mode,c.reValidateMode]),ei.useEffect(()=>{c.errors&&(N._setErrors(c.errors),N._focusError())},[N,c.errors]),ei.useEffect(()=>{c.shouldUnregister&&N._subjects.state.next({values:N._getWatch()})},[N,c.shouldUnregister]),ei.useEffect(()=>{if(N._proxyFormState.isDirty){const T=N._getDirty();T!==f.isDirty&&N._subjects.state.next({isDirty:T})}},[N,f.isDirty]),ei.useEffect(()=>{c.values&&!Ja(c.values,g.current)?(N._reset(c.values,N._options.resetOptions),g.current=c.values,w(T=>({...T}))):N._resetDefaultValues()},[N,c.values]),ei.useEffect(()=>{N._state.mount||(N._setValid(),N._state.mount=!0),N._state.watch&&(N._state.watch=!1,N._subjects.state.next({...N._formState})),N._removeUnmounted()}),d.current.formState=TS(f,N),d.current}function D_(c,d){return function(){return c.apply(d,arguments)}}const{toString:qS}=Object.prototype,{getPrototypeOf:Hf}=Object,{iterator:um,toStringTag:L_}=Symbol,hm=(c=>d=>{const g=qS.call(d);return c[g]||(c[g]=g.slice(8,-1).toLowerCase())})(Object.create(null)),An=c=>(c=c.toLowerCase(),d=>hm(d)===c),mm=c=>d=>typeof d===c,{isArray:oc}=Array,Jd=mm("undefined");function $S(c){return c!==null&&!Jd(c)&&c.constructor!==null&&!Jd(c.constructor)&&Ii(c.constructor.isBuffer)&&c.constructor.isBuffer(c)}const R_=An("ArrayBuffer");function GS(c){let d;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?d=ArrayBuffer.isView(c):d=c&&c.buffer&&R_(c.buffer),d}const ZS=mm("string"),Ii=mm("function"),z_=mm("number"),pm=c=>c!==null&&typeof c=="object",WS=c=>c===!0||c===!1,Oh=c=>{if(hm(c)!=="object")return!1;const d=Hf(c);return(d===null||d===Object.prototype||Object.getPrototypeOf(d)===null)&&!(L_ in c)&&!(um in c)},HS=An("Date"),XS=An("File"),KS=An("Blob"),QS=An("FileList"),JS=c=>pm(c)&&Ii(c.pipe),YS=c=>{let d;return c&&(typeof FormData=="function"&&c instanceof FormData||Ii(c.append)&&((d=hm(c))==="formdata"||d==="object"&&Ii(c.toString)&&c.toString()==="[object FormData]"))},eT=An("URLSearchParams"),[tT,sT,rT,iT]=["ReadableStream","Request","Response","Headers"].map(An),nT=c=>c.trim?c.trim():c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function iu(c,d,{allOwnKeys:g=!1}={}){if(c===null||typeof c>"u")return;let f,w;if(typeof c!="object"&&(c=[c]),oc(c))for(f=0,w=c.length;f<w;f++)d.call(null,c[f],f,c);else{const N=g?Object.getOwnPropertyNames(c):Object.keys(c),T=N.length;let A;for(f=0;f<T;f++)A=N[f],d.call(null,c[A],A,c)}}function O_(c,d){d=d.toLowerCase();const g=Object.keys(c);let f=g.length,w;for(;f-- >0;)if(w=g[f],d===w.toLowerCase())return w;return null}const Ho=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,F_=c=>!Jd(c)&&c!==Ho;function Sf(){const{caseless:c}=F_(this)&&this||{},d={},g=(f,w)=>{const N=c&&O_(d,w)||w;Oh(d[N])&&Oh(f)?d[N]=Sf(d[N],f):Oh(f)?d[N]=Sf({},f):oc(f)?d[N]=f.slice():d[N]=f};for(let f=0,w=arguments.length;f<w;f++)arguments[f]&&iu(arguments[f],g);return d}const aT=(c,d,g,{allOwnKeys:f}={})=>(iu(d,(w,N)=>{g&&Ii(w)?c[N]=D_(w,g):c[N]=w},{allOwnKeys:f}),c),oT=c=>(c.charCodeAt(0)===65279&&(c=c.slice(1)),c),lT=(c,d,g,f)=>{c.prototype=Object.create(d.prototype,f),c.prototype.constructor=c,Object.defineProperty(c,"super",{value:d.prototype}),g&&Object.assign(c.prototype,g)},cT=(c,d,g,f)=>{let w,N,T;const A={};if(d=d||{},c==null)return d;do{for(w=Object.getOwnPropertyNames(c),N=w.length;N-- >0;)T=w[N],(!f||f(T,c,d))&&!A[T]&&(d[T]=c[T],A[T]=!0);c=g!==!1&&Hf(c)}while(c&&(!g||g(c,d))&&c!==Object.prototype);return d},dT=(c,d,g)=>{c=String(c),(g===void 0||g>c.length)&&(g=c.length),g-=d.length;const f=c.indexOf(d,g);return f!==-1&&f===g},uT=c=>{if(!c)return null;if(oc(c))return c;let d=c.length;if(!z_(d))return null;const g=new Array(d);for(;d-- >0;)g[d]=c[d];return g},hT=(c=>d=>c&&d instanceof c)(typeof Uint8Array<"u"&&Hf(Uint8Array)),mT=(c,d)=>{const f=(c&&c[um]).call(c);let w;for(;(w=f.next())&&!w.done;){const N=w.value;d.call(c,N[0],N[1])}},pT=(c,d)=>{let g;const f=[];for(;(g=c.exec(d))!==null;)f.push(g);return f},fT=An("HTMLFormElement"),gT=c=>c.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(g,f,w){return f.toUpperCase()+w}),o0=(({hasOwnProperty:c})=>(d,g)=>c.call(d,g))(Object.prototype),xT=An("RegExp"),B_=(c,d)=>{const g=Object.getOwnPropertyDescriptors(c),f={};iu(g,(w,N)=>{let T;(T=d(w,N,c))!==!1&&(f[N]=T||w)}),Object.defineProperties(c,f)},yT=c=>{B_(c,(d,g)=>{if(Ii(c)&&["arguments","caller","callee"].indexOf(g)!==-1)return!1;const f=c[g];if(Ii(f)){if(d.enumerable=!1,"writable"in d){d.writable=!1;return}d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+g+"'")})}})},_T=(c,d)=>{const g={},f=w=>{w.forEach(N=>{g[N]=!0})};return oc(c)?f(c):f(String(c).split(d)),g},bT=()=>{},vT=(c,d)=>c!=null&&Number.isFinite(c=+c)?c:d;function wT(c){return!!(c&&Ii(c.append)&&c[L_]==="FormData"&&c[um])}const jT=c=>{const d=new Array(10),g=(f,w)=>{if(pm(f)){if(d.indexOf(f)>=0)return;if(!("toJSON"in f)){d[w]=f;const N=oc(f)?[]:{};return iu(f,(T,A)=>{const n=g(T,w+1);!Jd(n)&&(N[A]=n)}),d[w]=void 0,N}}return f};return g(c,0)},NT=An("AsyncFunction"),ST=c=>c&&(pm(c)||Ii(c))&&Ii(c.then)&&Ii(c.catch),U_=((c,d)=>c?setImmediate:d?((g,f)=>(Ho.addEventListener("message",({source:w,data:N})=>{w===Ho&&N===g&&f.length&&f.shift()()},!1),w=>{f.push(w),Ho.postMessage(g,"*")}))(`axios@${Math.random()}`,[]):g=>setTimeout(g))(typeof setImmediate=="function",Ii(Ho.postMessage)),TT=typeof queueMicrotask<"u"?queueMicrotask.bind(Ho):typeof process<"u"&&process.nextTick||U_,ET=c=>c!=null&&Ii(c[um]),Ke={isArray:oc,isArrayBuffer:R_,isBuffer:$S,isFormData:YS,isArrayBufferView:GS,isString:ZS,isNumber:z_,isBoolean:WS,isObject:pm,isPlainObject:Oh,isReadableStream:tT,isRequest:sT,isResponse:rT,isHeaders:iT,isUndefined:Jd,isDate:HS,isFile:XS,isBlob:KS,isRegExp:xT,isFunction:Ii,isStream:JS,isURLSearchParams:eT,isTypedArray:hT,isFileList:QS,forEach:iu,merge:Sf,extend:aT,trim:nT,stripBOM:oT,inherits:lT,toFlatObject:cT,kindOf:hm,kindOfTest:An,endsWith:dT,toArray:uT,forEachEntry:mT,matchAll:pT,isHTMLForm:fT,hasOwnProperty:o0,hasOwnProp:o0,reduceDescriptors:B_,freezeMethods:yT,toObjectSet:_T,toCamelCase:gT,noop:bT,toFiniteNumber:vT,findKey:O_,global:Ho,isContextDefined:F_,isSpecCompliantForm:wT,toJSONObject:jT,isAsyncFn:NT,isThenable:ST,setImmediate:U_,asap:TT,isIterable:ET};function ds(c,d,g,f,w){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=c,this.name="AxiosError",d&&(this.code=d),g&&(this.config=g),f&&(this.request=f),w&&(this.response=w,this.status=w.status?w.status:null)}Ke.inherits(ds,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ke.toJSONObject(this.config),code:this.code,status:this.status}}});const V_=ds.prototype,q_={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(c=>{q_[c]={value:c}});Object.defineProperties(ds,q_);Object.defineProperty(V_,"isAxiosError",{value:!0});ds.from=(c,d,g,f,w,N)=>{const T=Object.create(V_);return Ke.toFlatObject(c,T,function(n){return n!==Error.prototype},A=>A!=="isAxiosError"),ds.call(T,c.message,d,g,f,w),T.cause=c,T.name=c.name,N&&Object.assign(T,N),T};const CT=null;function Tf(c){return Ke.isPlainObject(c)||Ke.isArray(c)}function $_(c){return Ke.endsWith(c,"[]")?c.slice(0,-2):c}function l0(c,d,g){return c?c.concat(d).map(function(w,N){return w=$_(w),!g&&N?"["+w+"]":w}).join(g?".":""):d}function kT(c){return Ke.isArray(c)&&!c.some(Tf)}const AT=Ke.toFlatObject(Ke,{},null,function(d){return/^is[A-Z]/.test(d)});function fm(c,d,g){if(!Ke.isObject(c))throw new TypeError("target must be an object");d=d||new FormData,g=Ke.toFlatObject(g,{metaTokens:!0,dots:!1,indexes:!1},!1,function(G,J){return!Ke.isUndefined(J[G])});const f=g.metaTokens,w=g.visitor||z,N=g.dots,T=g.indexes,n=(g.Blob||typeof Blob<"u"&&Blob)&&Ke.isSpecCompliantForm(d);if(!Ke.isFunction(w))throw new TypeError("visitor must be a function");function P(H){if(H===null)return"";if(Ke.isDate(H))return H.toISOString();if(Ke.isBoolean(H))return H.toString();if(!n&&Ke.isBlob(H))throw new ds("Blob is not supported. Use a Buffer instead.");return Ke.isArrayBuffer(H)||Ke.isTypedArray(H)?n&&typeof Blob=="function"?new Blob([H]):Buffer.from(H):H}function z(H,G,J){let de=H;if(H&&!J&&typeof H=="object"){if(Ke.endsWith(G,"{}"))G=f?G:G.slice(0,-2),H=JSON.stringify(H);else if(Ke.isArray(H)&&kT(H)||(Ke.isFileList(H)||Ke.endsWith(G,"[]"))&&(de=Ke.toArray(H)))return G=$_(G),de.forEach(function(te,Ne){!(Ke.isUndefined(te)||te===null)&&d.append(T===!0?l0([G],Ne,N):T===null?G:G+"[]",P(te))}),!1}return Tf(H)?!0:(d.append(l0(J,G,N),P(H)),!1)}const q=[],U=Object.assign(AT,{defaultVisitor:z,convertValue:P,isVisitable:Tf});function W(H,G){if(!Ke.isUndefined(H)){if(q.indexOf(H)!==-1)throw Error("Circular reference detected in "+G.join("."));q.push(H),Ke.forEach(H,function(de,ne){(!(Ke.isUndefined(de)||de===null)&&w.call(d,de,Ke.isString(ne)?ne.trim():ne,G,U))===!0&&W(de,G?G.concat(ne):[ne])}),q.pop()}}if(!Ke.isObject(c))throw new TypeError("data must be an object");return W(c),d}function c0(c){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(c).replace(/[!'()~]|%20|%00/g,function(f){return d[f]})}function Xf(c,d){this._pairs=[],c&&fm(c,this,d)}const G_=Xf.prototype;G_.append=function(d,g){this._pairs.push([d,g])};G_.toString=function(d){const g=d?function(f){return d.call(this,f,c0)}:c0;return this._pairs.map(function(w){return g(w[0])+"="+g(w[1])},"").join("&")};function MT(c){return encodeURIComponent(c).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Z_(c,d,g){if(!d)return c;const f=g&&g.encode||MT;Ke.isFunction(g)&&(g={serialize:g});const w=g&&g.serialize;let N;if(w?N=w(d,g):N=Ke.isURLSearchParams(d)?d.toString():new Xf(d,g).toString(f),N){const T=c.indexOf("#");T!==-1&&(c=c.slice(0,T)),c+=(c.indexOf("?")===-1?"?":"&")+N}return c}class d0{constructor(){this.handlers=[]}use(d,g,f){return this.handlers.push({fulfilled:d,rejected:g,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(d){this.handlers[d]&&(this.handlers[d]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(d){Ke.forEach(this.handlers,function(f){f!==null&&d(f)})}}const W_={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},PT=typeof URLSearchParams<"u"?URLSearchParams:Xf,IT=typeof FormData<"u"?FormData:null,DT=typeof Blob<"u"?Blob:null,LT={isBrowser:!0,classes:{URLSearchParams:PT,FormData:IT,Blob:DT},protocols:["http","https","file","blob","url","data"]},Kf=typeof window<"u"&&typeof document<"u",Ef=typeof navigator=="object"&&navigator||void 0,RT=Kf&&(!Ef||["ReactNative","NativeScript","NS"].indexOf(Ef.product)<0),zT=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",OT=Kf&&window.location.href||"http://localhost",FT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Kf,hasStandardBrowserEnv:RT,hasStandardBrowserWebWorkerEnv:zT,navigator:Ef,origin:OT},Symbol.toStringTag,{value:"Module"})),pi={...FT,...LT};function BT(c,d){return fm(c,new pi.classes.URLSearchParams,Object.assign({visitor:function(g,f,w,N){return pi.isNode&&Ke.isBuffer(g)?(this.append(f,g.toString("base64")),!1):N.defaultVisitor.apply(this,arguments)}},d))}function UT(c){return Ke.matchAll(/\w+|\[(\w*)]/g,c).map(d=>d[0]==="[]"?"":d[1]||d[0])}function VT(c){const d={},g=Object.keys(c);let f;const w=g.length;let N;for(f=0;f<w;f++)N=g[f],d[N]=c[N];return d}function H_(c){function d(g,f,w,N){let T=g[N++];if(T==="__proto__")return!0;const A=Number.isFinite(+T),n=N>=g.length;return T=!T&&Ke.isArray(w)?w.length:T,n?(Ke.hasOwnProp(w,T)?w[T]=[w[T],f]:w[T]=f,!A):((!w[T]||!Ke.isObject(w[T]))&&(w[T]=[]),d(g,f,w[T],N)&&Ke.isArray(w[T])&&(w[T]=VT(w[T])),!A)}if(Ke.isFormData(c)&&Ke.isFunction(c.entries)){const g={};return Ke.forEachEntry(c,(f,w)=>{d(UT(f),w,g,0)}),g}return null}function qT(c,d,g){if(Ke.isString(c))try{return(d||JSON.parse)(c),Ke.trim(c)}catch(f){if(f.name!=="SyntaxError")throw f}return(0,JSON.stringify)(c)}const nu={transitional:W_,adapter:["xhr","http","fetch"],transformRequest:[function(d,g){const f=g.getContentType()||"",w=f.indexOf("application/json")>-1,N=Ke.isObject(d);if(N&&Ke.isHTMLForm(d)&&(d=new FormData(d)),Ke.isFormData(d))return w?JSON.stringify(H_(d)):d;if(Ke.isArrayBuffer(d)||Ke.isBuffer(d)||Ke.isStream(d)||Ke.isFile(d)||Ke.isBlob(d)||Ke.isReadableStream(d))return d;if(Ke.isArrayBufferView(d))return d.buffer;if(Ke.isURLSearchParams(d))return g.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),d.toString();let A;if(N){if(f.indexOf("application/x-www-form-urlencoded")>-1)return BT(d,this.formSerializer).toString();if((A=Ke.isFileList(d))||f.indexOf("multipart/form-data")>-1){const n=this.env&&this.env.FormData;return fm(A?{"files[]":d}:d,n&&new n,this.formSerializer)}}return N||w?(g.setContentType("application/json",!1),qT(d)):d}],transformResponse:[function(d){const g=this.transitional||nu.transitional,f=g&&g.forcedJSONParsing,w=this.responseType==="json";if(Ke.isResponse(d)||Ke.isReadableStream(d))return d;if(d&&Ke.isString(d)&&(f&&!this.responseType||w)){const T=!(g&&g.silentJSONParsing)&&w;try{return JSON.parse(d)}catch(A){if(T)throw A.name==="SyntaxError"?ds.from(A,ds.ERR_BAD_RESPONSE,this,null,this.response):A}}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:pi.classes.FormData,Blob:pi.classes.Blob},validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ke.forEach(["delete","get","head","post","put","patch"],c=>{nu.headers[c]={}});const $T=Ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),GT=c=>{const d={};let g,f,w;return c&&c.split(`
`).forEach(function(T){w=T.indexOf(":"),g=T.substring(0,w).trim().toLowerCase(),f=T.substring(w+1).trim(),!(!g||d[g]&&$T[g])&&(g==="set-cookie"?d[g]?d[g].push(f):d[g]=[f]:d[g]=d[g]?d[g]+", "+f:f)}),d},u0=Symbol("internals");function $d(c){return c&&String(c).trim().toLowerCase()}function Fh(c){return c===!1||c==null?c:Ke.isArray(c)?c.map(Fh):String(c)}function ZT(c){const d=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=g.exec(c);)d[f[1]]=f[2];return d}const WT=c=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(c.trim());function tf(c,d,g,f,w){if(Ke.isFunction(f))return f.call(this,d,g);if(w&&(d=g),!!Ke.isString(d)){if(Ke.isString(f))return d.indexOf(f)!==-1;if(Ke.isRegExp(f))return f.test(d)}}function HT(c){return c.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(d,g,f)=>g.toUpperCase()+f)}function XT(c,d){const g=Ke.toCamelCase(" "+d);["get","set","has"].forEach(f=>{Object.defineProperty(c,f+g,{value:function(w,N,T){return this[f].call(this,d,w,N,T)},configurable:!0})})}class Di{constructor(d){d&&this.set(d)}set(d,g,f){const w=this;function N(A,n,P){const z=$d(n);if(!z)throw new Error("header name must be a non-empty string");const q=Ke.findKey(w,z);(!q||w[q]===void 0||P===!0||P===void 0&&w[q]!==!1)&&(w[q||n]=Fh(A))}const T=(A,n)=>Ke.forEach(A,(P,z)=>N(P,z,n));if(Ke.isPlainObject(d)||d instanceof this.constructor)T(d,g);else if(Ke.isString(d)&&(d=d.trim())&&!WT(d))T(GT(d),g);else if(Ke.isObject(d)&&Ke.isIterable(d)){let A={},n,P;for(const z of d){if(!Ke.isArray(z))throw TypeError("Object iterator must return a key-value pair");A[P=z[0]]=(n=A[P])?Ke.isArray(n)?[...n,z[1]]:[n,z[1]]:z[1]}T(A,g)}else d!=null&&N(g,d,f);return this}get(d,g){if(d=$d(d),d){const f=Ke.findKey(this,d);if(f){const w=this[f];if(!g)return w;if(g===!0)return ZT(w);if(Ke.isFunction(g))return g.call(this,w,f);if(Ke.isRegExp(g))return g.exec(w);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,g){if(d=$d(d),d){const f=Ke.findKey(this,d);return!!(f&&this[f]!==void 0&&(!g||tf(this,this[f],f,g)))}return!1}delete(d,g){const f=this;let w=!1;function N(T){if(T=$d(T),T){const A=Ke.findKey(f,T);A&&(!g||tf(f,f[A],A,g))&&(delete f[A],w=!0)}}return Ke.isArray(d)?d.forEach(N):N(d),w}clear(d){const g=Object.keys(this);let f=g.length,w=!1;for(;f--;){const N=g[f];(!d||tf(this,this[N],N,d,!0))&&(delete this[N],w=!0)}return w}normalize(d){const g=this,f={};return Ke.forEach(this,(w,N)=>{const T=Ke.findKey(f,N);if(T){g[T]=Fh(w),delete g[N];return}const A=d?HT(N):String(N).trim();A!==N&&delete g[N],g[A]=Fh(w),f[A]=!0}),this}concat(...d){return this.constructor.concat(this,...d)}toJSON(d){const g=Object.create(null);return Ke.forEach(this,(f,w)=>{f!=null&&f!==!1&&(g[w]=d&&Ke.isArray(f)?f.join(", "):f)}),g}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([d,g])=>d+": "+g).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d,...g){const f=new this(d);return g.forEach(w=>f.set(w)),f}static accessor(d){const f=(this[u0]=this[u0]={accessors:{}}).accessors,w=this.prototype;function N(T){const A=$d(T);f[A]||(XT(w,T),f[A]=!0)}return Ke.isArray(d)?d.forEach(N):N(d),this}}Di.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ke.reduceDescriptors(Di.prototype,({value:c},d)=>{let g=d[0].toUpperCase()+d.slice(1);return{get:()=>c,set(f){this[g]=f}}});Ke.freezeMethods(Di);function sf(c,d){const g=this||nu,f=d||g,w=Di.from(f.headers);let N=f.data;return Ke.forEach(c,function(A){N=A.call(g,N,w.normalize(),d?d.status:void 0)}),w.normalize(),N}function X_(c){return!!(c&&c.__CANCEL__)}function lc(c,d,g){ds.call(this,c??"canceled",ds.ERR_CANCELED,d,g),this.name="CanceledError"}Ke.inherits(lc,ds,{__CANCEL__:!0});function K_(c,d,g){const f=g.config.validateStatus;!g.status||!f||f(g.status)?c(g):d(new ds("Request failed with status code "+g.status,[ds.ERR_BAD_REQUEST,ds.ERR_BAD_RESPONSE][Math.floor(g.status/100)-4],g.config,g.request,g))}function KT(c){const d=/^([-+\w]{1,25})(:?\/\/|:)/.exec(c);return d&&d[1]||""}function QT(c,d){c=c||10;const g=new Array(c),f=new Array(c);let w=0,N=0,T;return d=d!==void 0?d:1e3,function(n){const P=Date.now(),z=f[N];T||(T=P),g[w]=n,f[w]=P;let q=N,U=0;for(;q!==w;)U+=g[q++],q=q%c;if(w=(w+1)%c,w===N&&(N=(N+1)%c),P-T<d)return;const W=z&&P-z;return W?Math.round(U*1e3/W):void 0}}function JT(c,d){let g=0,f=1e3/d,w,N;const T=(P,z=Date.now())=>{g=z,w=null,N&&(clearTimeout(N),N=null),c.apply(null,P)};return[(...P)=>{const z=Date.now(),q=z-g;q>=f?T(P,z):(w=P,N||(N=setTimeout(()=>{N=null,T(w)},f-q)))},()=>w&&T(w)]}const Jh=(c,d,g=3)=>{let f=0;const w=QT(50,250);return JT(N=>{const T=N.loaded,A=N.lengthComputable?N.total:void 0,n=T-f,P=w(n),z=T<=A;f=T;const q={loaded:T,total:A,progress:A?T/A:void 0,bytes:n,rate:P||void 0,estimated:P&&A&&z?(A-T)/P:void 0,event:N,lengthComputable:A!=null,[d?"download":"upload"]:!0};c(q)},g)},h0=(c,d)=>{const g=c!=null;return[f=>d[0]({lengthComputable:g,total:c,loaded:f}),d[1]]},m0=c=>(...d)=>Ke.asap(()=>c(...d)),YT=pi.hasStandardBrowserEnv?((c,d)=>g=>(g=new URL(g,pi.origin),c.protocol===g.protocol&&c.host===g.host&&(d||c.port===g.port)))(new URL(pi.origin),pi.navigator&&/(msie|trident)/i.test(pi.navigator.userAgent)):()=>!0,eE=pi.hasStandardBrowserEnv?{write(c,d,g,f,w,N){const T=[c+"="+encodeURIComponent(d)];Ke.isNumber(g)&&T.push("expires="+new Date(g).toGMTString()),Ke.isString(f)&&T.push("path="+f),Ke.isString(w)&&T.push("domain="+w),N===!0&&T.push("secure"),document.cookie=T.join("; ")},read(c){const d=document.cookie.match(new RegExp("(^|;\\s*)("+c+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove(c){this.write(c,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function tE(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}function sE(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}function Q_(c,d,g){let f=!tE(d);return c&&(f||g==!1)?sE(c,d):d}const p0=c=>c instanceof Di?{...c}:c;function Qo(c,d){d=d||{};const g={};function f(P,z,q,U){return Ke.isPlainObject(P)&&Ke.isPlainObject(z)?Ke.merge.call({caseless:U},P,z):Ke.isPlainObject(z)?Ke.merge({},z):Ke.isArray(z)?z.slice():z}function w(P,z,q,U){if(Ke.isUndefined(z)){if(!Ke.isUndefined(P))return f(void 0,P,q,U)}else return f(P,z,q,U)}function N(P,z){if(!Ke.isUndefined(z))return f(void 0,z)}function T(P,z){if(Ke.isUndefined(z)){if(!Ke.isUndefined(P))return f(void 0,P)}else return f(void 0,z)}function A(P,z,q){if(q in d)return f(P,z);if(q in c)return f(void 0,P)}const n={url:N,method:N,data:N,baseURL:T,transformRequest:T,transformResponse:T,paramsSerializer:T,timeout:T,timeoutMessage:T,withCredentials:T,withXSRFToken:T,adapter:T,responseType:T,xsrfCookieName:T,xsrfHeaderName:T,onUploadProgress:T,onDownloadProgress:T,decompress:T,maxContentLength:T,maxBodyLength:T,beforeRedirect:T,transport:T,httpAgent:T,httpsAgent:T,cancelToken:T,socketPath:T,responseEncoding:T,validateStatus:A,headers:(P,z,q)=>w(p0(P),p0(z),q,!0)};return Ke.forEach(Object.keys(Object.assign({},c,d)),function(z){const q=n[z]||w,U=q(c[z],d[z],z);Ke.isUndefined(U)&&q!==A||(g[z]=U)}),g}const J_=c=>{const d=Qo({},c);let{data:g,withXSRFToken:f,xsrfHeaderName:w,xsrfCookieName:N,headers:T,auth:A}=d;d.headers=T=Di.from(T),d.url=Z_(Q_(d.baseURL,d.url,d.allowAbsoluteUrls),c.params,c.paramsSerializer),A&&T.set("Authorization","Basic "+btoa((A.username||"")+":"+(A.password?unescape(encodeURIComponent(A.password)):"")));let n;if(Ke.isFormData(g)){if(pi.hasStandardBrowserEnv||pi.hasStandardBrowserWebWorkerEnv)T.setContentType(void 0);else if((n=T.getContentType())!==!1){const[P,...z]=n?n.split(";").map(q=>q.trim()).filter(Boolean):[];T.setContentType([P||"multipart/form-data",...z].join("; "))}}if(pi.hasStandardBrowserEnv&&(f&&Ke.isFunction(f)&&(f=f(d)),f||f!==!1&&YT(d.url))){const P=w&&N&&eE.read(N);P&&T.set(w,P)}return d},rE=typeof XMLHttpRequest<"u",iE=rE&&function(c){return new Promise(function(g,f){const w=J_(c);let N=w.data;const T=Di.from(w.headers).normalize();let{responseType:A,onUploadProgress:n,onDownloadProgress:P}=w,z,q,U,W,H;function G(){W&&W(),H&&H(),w.cancelToken&&w.cancelToken.unsubscribe(z),w.signal&&w.signal.removeEventListener("abort",z)}let J=new XMLHttpRequest;J.open(w.method.toUpperCase(),w.url,!0),J.timeout=w.timeout;function de(){if(!J)return;const te=Di.from("getAllResponseHeaders"in J&&J.getAllResponseHeaders()),me={data:!A||A==="text"||A==="json"?J.responseText:J.response,status:J.status,statusText:J.statusText,headers:te,config:c,request:J};K_(function(Se){g(Se),G()},function(Se){f(Se),G()},me),J=null}"onloadend"in J?J.onloadend=de:J.onreadystatechange=function(){!J||J.readyState!==4||J.status===0&&!(J.responseURL&&J.responseURL.indexOf("file:")===0)||setTimeout(de)},J.onabort=function(){J&&(f(new ds("Request aborted",ds.ECONNABORTED,c,J)),J=null)},J.onerror=function(){f(new ds("Network Error",ds.ERR_NETWORK,c,J)),J=null},J.ontimeout=function(){let Ne=w.timeout?"timeout of "+w.timeout+"ms exceeded":"timeout exceeded";const me=w.transitional||W_;w.timeoutErrorMessage&&(Ne=w.timeoutErrorMessage),f(new ds(Ne,me.clarifyTimeoutError?ds.ETIMEDOUT:ds.ECONNABORTED,c,J)),J=null},N===void 0&&T.setContentType(null),"setRequestHeader"in J&&Ke.forEach(T.toJSON(),function(Ne,me){J.setRequestHeader(me,Ne)}),Ke.isUndefined(w.withCredentials)||(J.withCredentials=!!w.withCredentials),A&&A!=="json"&&(J.responseType=w.responseType),P&&([U,H]=Jh(P,!0),J.addEventListener("progress",U)),n&&J.upload&&([q,W]=Jh(n),J.upload.addEventListener("progress",q),J.upload.addEventListener("loadend",W)),(w.cancelToken||w.signal)&&(z=te=>{J&&(f(!te||te.type?new lc(null,c,J):te),J.abort(),J=null)},w.cancelToken&&w.cancelToken.subscribe(z),w.signal&&(w.signal.aborted?z():w.signal.addEventListener("abort",z)));const ne=KT(w.url);if(ne&&pi.protocols.indexOf(ne)===-1){f(new ds("Unsupported protocol "+ne+":",ds.ERR_BAD_REQUEST,c));return}J.send(N||null)})},nE=(c,d)=>{const{length:g}=c=c?c.filter(Boolean):[];if(d||g){let f=new AbortController,w;const N=function(P){if(!w){w=!0,A();const z=P instanceof Error?P:this.reason;f.abort(z instanceof ds?z:new lc(z instanceof Error?z.message:z))}};let T=d&&setTimeout(()=>{T=null,N(new ds(`timeout ${d} of ms exceeded`,ds.ETIMEDOUT))},d);const A=()=>{c&&(T&&clearTimeout(T),T=null,c.forEach(P=>{P.unsubscribe?P.unsubscribe(N):P.removeEventListener("abort",N)}),c=null)};c.forEach(P=>P.addEventListener("abort",N));const{signal:n}=f;return n.unsubscribe=()=>Ke.asap(A),n}},aE=function*(c,d){let g=c.byteLength;if(g<d){yield c;return}let f=0,w;for(;f<g;)w=f+d,yield c.slice(f,w),f=w},oE=async function*(c,d){for await(const g of lE(c))yield*aE(g,d)},lE=async function*(c){if(c[Symbol.asyncIterator]){yield*c;return}const d=c.getReader();try{for(;;){const{done:g,value:f}=await d.read();if(g)break;yield f}}finally{await d.cancel()}},f0=(c,d,g,f)=>{const w=oE(c,d);let N=0,T,A=n=>{T||(T=!0,f&&f(n))};return new ReadableStream({async pull(n){try{const{done:P,value:z}=await w.next();if(P){A(),n.close();return}let q=z.byteLength;if(g){let U=N+=q;g(U)}n.enqueue(new Uint8Array(z))}catch(P){throw A(P),P}},cancel(n){return A(n),w.return()}},{highWaterMark:2})},gm=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Y_=gm&&typeof ReadableStream=="function",cE=gm&&(typeof TextEncoder=="function"?(c=>d=>c.encode(d))(new TextEncoder):async c=>new Uint8Array(await new Response(c).arrayBuffer())),eb=(c,...d)=>{try{return!!c(...d)}catch{return!1}},dE=Y_&&eb(()=>{let c=!1;const d=new Request(pi.origin,{body:new ReadableStream,method:"POST",get duplex(){return c=!0,"half"}}).headers.has("Content-Type");return c&&!d}),g0=64*1024,Cf=Y_&&eb(()=>Ke.isReadableStream(new Response("").body)),Yh={stream:Cf&&(c=>c.body)};gm&&(c=>{["text","arrayBuffer","blob","formData","stream"].forEach(d=>{!Yh[d]&&(Yh[d]=Ke.isFunction(c[d])?g=>g[d]():(g,f)=>{throw new ds(`Response type '${d}' is not supported`,ds.ERR_NOT_SUPPORT,f)})})})(new Response);const uE=async c=>{if(c==null)return 0;if(Ke.isBlob(c))return c.size;if(Ke.isSpecCompliantForm(c))return(await new Request(pi.origin,{method:"POST",body:c}).arrayBuffer()).byteLength;if(Ke.isArrayBufferView(c)||Ke.isArrayBuffer(c))return c.byteLength;if(Ke.isURLSearchParams(c)&&(c=c+""),Ke.isString(c))return(await cE(c)).byteLength},hE=async(c,d)=>{const g=Ke.toFiniteNumber(c.getContentLength());return g??uE(d)},mE=gm&&(async c=>{let{url:d,method:g,data:f,signal:w,cancelToken:N,timeout:T,onDownloadProgress:A,onUploadProgress:n,responseType:P,headers:z,withCredentials:q="same-origin",fetchOptions:U}=J_(c);P=P?(P+"").toLowerCase():"text";let W=nE([w,N&&N.toAbortSignal()],T),H;const G=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let J;try{if(n&&dE&&g!=="get"&&g!=="head"&&(J=await hE(z,f))!==0){let me=new Request(d,{method:"POST",body:f,duplex:"half"}),Pe;if(Ke.isFormData(f)&&(Pe=me.headers.get("content-type"))&&z.setContentType(Pe),me.body){const[Se,fe]=h0(J,Jh(m0(n)));f=f0(me.body,g0,Se,fe)}}Ke.isString(q)||(q=q?"include":"omit");const de="credentials"in Request.prototype;H=new Request(d,{...U,signal:W,method:g.toUpperCase(),headers:z.normalize().toJSON(),body:f,duplex:"half",credentials:de?q:void 0});let ne=await fetch(H,U);const te=Cf&&(P==="stream"||P==="response");if(Cf&&(A||te&&G)){const me={};["status","statusText","headers"].forEach(Be=>{me[Be]=ne[Be]});const Pe=Ke.toFiniteNumber(ne.headers.get("content-length")),[Se,fe]=A&&h0(Pe,Jh(m0(A),!0))||[];ne=new Response(f0(ne.body,g0,Se,()=>{fe&&fe(),G&&G()}),me)}P=P||"text";let Ne=await Yh[Ke.findKey(Yh,P)||"text"](ne,c);return!te&&G&&G(),await new Promise((me,Pe)=>{K_(me,Pe,{data:Ne,headers:Di.from(ne.headers),status:ne.status,statusText:ne.statusText,config:c,request:H})})}catch(de){throw G&&G(),de&&de.name==="TypeError"&&/Load failed|fetch/i.test(de.message)?Object.assign(new ds("Network Error",ds.ERR_NETWORK,c,H),{cause:de.cause||de}):ds.from(de,de&&de.code,c,H)}}),kf={http:CT,xhr:iE,fetch:mE};Ke.forEach(kf,(c,d)=>{if(c){try{Object.defineProperty(c,"name",{value:d})}catch{}Object.defineProperty(c,"adapterName",{value:d})}});const x0=c=>`- ${c}`,pE=c=>Ke.isFunction(c)||c===null||c===!1,tb={getAdapter:c=>{c=Ke.isArray(c)?c:[c];const{length:d}=c;let g,f;const w={};for(let N=0;N<d;N++){g=c[N];let T;if(f=g,!pE(g)&&(f=kf[(T=String(g)).toLowerCase()],f===void 0))throw new ds(`Unknown adapter '${T}'`);if(f)break;w[T||"#"+N]=f}if(!f){const N=Object.entries(w).map(([A,n])=>`adapter ${A} `+(n===!1?"is not supported by the environment":"is not available in the build"));let T=d?N.length>1?`since :
`+N.map(x0).join(`
`):" "+x0(N[0]):"as no adapter specified";throw new ds("There is no suitable adapter to dispatch the request "+T,"ERR_NOT_SUPPORT")}return f},adapters:kf};function rf(c){if(c.cancelToken&&c.cancelToken.throwIfRequested(),c.signal&&c.signal.aborted)throw new lc(null,c)}function y0(c){return rf(c),c.headers=Di.from(c.headers),c.data=sf.call(c,c.transformRequest),["post","put","patch"].indexOf(c.method)!==-1&&c.headers.setContentType("application/x-www-form-urlencoded",!1),tb.getAdapter(c.adapter||nu.adapter)(c).then(function(f){return rf(c),f.data=sf.call(c,c.transformResponse,f),f.headers=Di.from(f.headers),f},function(f){return X_(f)||(rf(c),f&&f.response&&(f.response.data=sf.call(c,c.transformResponse,f.response),f.response.headers=Di.from(f.response.headers))),Promise.reject(f)})}const sb="1.10.0",xm={};["object","boolean","number","function","string","symbol"].forEach((c,d)=>{xm[c]=function(f){return typeof f===c||"a"+(d<1?"n ":" ")+c}});const _0={};xm.transitional=function(d,g,f){function w(N,T){return"[Axios v"+sb+"] Transitional option '"+N+"'"+T+(f?". "+f:"")}return(N,T,A)=>{if(d===!1)throw new ds(w(T," has been removed"+(g?" in "+g:"")),ds.ERR_DEPRECATED);return g&&!_0[T]&&(_0[T]=!0,console.warn(w(T," has been deprecated since v"+g+" and will be removed in the near future"))),d?d(N,T,A):!0}};xm.spelling=function(d){return(g,f)=>(console.warn(`${f} is likely a misspelling of ${d}`),!0)};function fE(c,d,g){if(typeof c!="object")throw new ds("options must be an object",ds.ERR_BAD_OPTION_VALUE);const f=Object.keys(c);let w=f.length;for(;w-- >0;){const N=f[w],T=d[N];if(T){const A=c[N],n=A===void 0||T(A,N,c);if(n!==!0)throw new ds("option "+N+" must be "+n,ds.ERR_BAD_OPTION_VALUE);continue}if(g!==!0)throw new ds("Unknown option "+N,ds.ERR_BAD_OPTION)}}const Bh={assertOptions:fE,validators:xm},Vn=Bh.validators;class Xo{constructor(d){this.defaults=d||{},this.interceptors={request:new d0,response:new d0}}async request(d,g){try{return await this._request(d,g)}catch(f){if(f instanceof Error){let w={};Error.captureStackTrace?Error.captureStackTrace(w):w=new Error;const N=w.stack?w.stack.replace(/^.+\n/,""):"";try{f.stack?N&&!String(f.stack).endsWith(N.replace(/^.+\n.+\n/,""))&&(f.stack+=`
`+N):f.stack=N}catch{}}throw f}}_request(d,g){typeof d=="string"?(g=g||{},g.url=d):g=d||{},g=Qo(this.defaults,g);const{transitional:f,paramsSerializer:w,headers:N}=g;f!==void 0&&Bh.assertOptions(f,{silentJSONParsing:Vn.transitional(Vn.boolean),forcedJSONParsing:Vn.transitional(Vn.boolean),clarifyTimeoutError:Vn.transitional(Vn.boolean)},!1),w!=null&&(Ke.isFunction(w)?g.paramsSerializer={serialize:w}:Bh.assertOptions(w,{encode:Vn.function,serialize:Vn.function},!0)),g.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?g.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:g.allowAbsoluteUrls=!0),Bh.assertOptions(g,{baseUrl:Vn.spelling("baseURL"),withXsrfToken:Vn.spelling("withXSRFToken")},!0),g.method=(g.method||this.defaults.method||"get").toLowerCase();let T=N&&Ke.merge(N.common,N[g.method]);N&&Ke.forEach(["delete","get","head","post","put","patch","common"],H=>{delete N[H]}),g.headers=Di.concat(T,N);const A=[];let n=!0;this.interceptors.request.forEach(function(G){typeof G.runWhen=="function"&&G.runWhen(g)===!1||(n=n&&G.synchronous,A.unshift(G.fulfilled,G.rejected))});const P=[];this.interceptors.response.forEach(function(G){P.push(G.fulfilled,G.rejected)});let z,q=0,U;if(!n){const H=[y0.bind(this),void 0];for(H.unshift.apply(H,A),H.push.apply(H,P),U=H.length,z=Promise.resolve(g);q<U;)z=z.then(H[q++],H[q++]);return z}U=A.length;let W=g;for(q=0;q<U;){const H=A[q++],G=A[q++];try{W=H(W)}catch(J){G.call(this,J);break}}try{z=y0.call(this,W)}catch(H){return Promise.reject(H)}for(q=0,U=P.length;q<U;)z=z.then(P[q++],P[q++]);return z}getUri(d){d=Qo(this.defaults,d);const g=Q_(d.baseURL,d.url,d.allowAbsoluteUrls);return Z_(g,d.params,d.paramsSerializer)}}Ke.forEach(["delete","get","head","options"],function(d){Xo.prototype[d]=function(g,f){return this.request(Qo(f||{},{method:d,url:g,data:(f||{}).data}))}});Ke.forEach(["post","put","patch"],function(d){function g(f){return function(N,T,A){return this.request(Qo(A||{},{method:d,headers:f?{"Content-Type":"multipart/form-data"}:{},url:N,data:T}))}}Xo.prototype[d]=g(),Xo.prototype[d+"Form"]=g(!0)});class Qf{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let g;this.promise=new Promise(function(N){g=N});const f=this;this.promise.then(w=>{if(!f._listeners)return;let N=f._listeners.length;for(;N-- >0;)f._listeners[N](w);f._listeners=null}),this.promise.then=w=>{let N;const T=new Promise(A=>{f.subscribe(A),N=A}).then(w);return T.cancel=function(){f.unsubscribe(N)},T},d(function(N,T,A){f.reason||(f.reason=new lc(N,T,A),g(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const g=this._listeners.indexOf(d);g!==-1&&this._listeners.splice(g,1)}toAbortSignal(){const d=new AbortController,g=f=>{d.abort(f)};return this.subscribe(g),d.signal.unsubscribe=()=>this.unsubscribe(g),d.signal}static source(){let d;return{token:new Qf(function(w){d=w}),cancel:d}}}function gE(c){return function(g){return c.apply(null,g)}}function xE(c){return Ke.isObject(c)&&c.isAxiosError===!0}const Af={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Af).forEach(([c,d])=>{Af[d]=c});function rb(c){const d=new Xo(c),g=D_(Xo.prototype.request,d);return Ke.extend(g,Xo.prototype,d,{allOwnKeys:!0}),Ke.extend(g,d,null,{allOwnKeys:!0}),g.create=function(w){return rb(Qo(c,w))},g}const zr=rb(nu);zr.Axios=Xo;zr.CanceledError=lc;zr.CancelToken=Qf;zr.isCancel=X_;zr.VERSION=sb;zr.toFormData=fm;zr.AxiosError=ds;zr.Cancel=zr.CanceledError;zr.all=function(d){return Promise.all(d)};zr.spread=gE;zr.isAxiosError=xE;zr.mergeConfig=Qo;zr.AxiosHeaders=Di;zr.formToJSON=c=>H_(Ke.isHTMLForm(c)?new FormData(c):c);zr.getAdapter=tb.getAdapter;zr.HttpStatusCode=Af;zr.default=zr;var ib={exports:{}};(function(c,d){var g={};(function(f,w){c.exports=w()})(g1,function(){var f,w,N;function T(n,P){if(!f)f=P;else if(!w)w=P;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+f+")(sharedChunk); ("+w+")(sharedChunk); self.onerror = null;",q={};f(q),N=P(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(N.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}T(["exports"],function(n){var P=typeof self<"u"?self:{},z="2.15.0";let q;const U={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(q==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{q=g.API_URL_REGEX!=null?new RegExp(g.API_URL_REGEX):s}catch{q=s}}return q},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!U.API_URL)return null;try{const s=new URL(U.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},W={supported:!1,testSupport:function(s){!J&&G&&(de?ne(s):H=s)}};let H,G,J=!1,de=!1;function ne(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,G),s.isContextLost())return;W.supported=!0}catch{}s.deleteTexture(e),J=!0}P.document&&(G=P.document.createElement("img"),G.onload=function(){H&&ne(H),H=null,de=!0},G.onerror=function(){J=!0,H=null},G.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const te="01";function Ne(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var me=Pe;function Pe(s,e,r,a){this.cx=3*s,this.bx=3*(r-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=e,this.p2x=r,this.p2y=a}Pe.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,e){if(e===void 0&&(e=1e-6),s<0)return 0;if(s>1)return 1;for(var r=s,a=0;a<8;a++){var l=this.sampleCurveX(r)-s;if(Math.abs(l)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var p=0,y=1;for(r=s,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-s)<e));a++)s>l?p=r:y=r,r=.5*(y-p)+p;return r},solve:function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))}};var Se=Ne(me),fe=Be;function Be(s,e){this.x=s,this.y=e}Be.prototype={clone:function(){return new Be(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,e){return this.clone()._rotateAround(s,e)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var e=s.x-this.x,r=s.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult:function(s){var e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var e=Math.cos(s),r=Math.sin(s),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(s,e){var r=Math.cos(s),a=Math.sin(s),l=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Be.convert=function(s){return s instanceof Be?s:Array.isArray(s)?new Be(s[0],s[1]):s};var ke=Ne(fe);const Ge=Math.PI/180,we=180/Math.PI;function Me(s){return s*Ge}function st(s){return s*we}const lt=[[0,0],[1,0],[1,1],[0,1]];function St(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,r=e*s;return 4*(s<.5?r:3*(s-e)+r-.75)}function ft(s,e,r,a){const l=new Se(s,e,r,a);return function(h){return l.solve(h)}}const Mt=ft(.25,.1,.25,1);function mt(s,e,r){return Math.min(r,Math.max(e,s))}function Fs(s,e,r){return(r=mt((r-s)/(e-s),0,1))*r*(3-2*r)}function ts(s,e,r){const a=r-e,l=((s-e)%a+a)%a+e;return l===e?r:l}function Is(s,e,r){if(!s.length)return r(null,[]);let a=s.length;const l=new Array(s.length);let h=null;s.forEach((p,y)=>{e(p,(b,v)=>{b&&(h=b),l[y]=v,--a==0&&r(h,l)})})}function lr(s){const e=[];for(const r in s)e.push(s[r]);return e}function js(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}let Sr=1;function Tr(){return Sr++}function vs(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function ss(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Or(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Cr(s,e){s.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Li(s,e){return s.indexOf(e,s.length-e.length)!==-1}function Wt(s,e,r){const a={};for(const l in s)a[l]=e.call(this,s[l],l,s);return a}function gi(s,e,r){const a={};for(const l in s)e.call(r||this,s[l],l,s)&&(a[l]=s[l]);return a}function vr(s){return Array.isArray(s)?s.map(vr):typeof s=="object"&&s?Wt(s,vr):s}const wi={};function Ds(s){wi[s]||(typeof console<"u"&&console.warn(s),wi[s]=!0)}function $r(s,e,r){return(r.y-s.y)*(e.x-s.x)>(e.y-s.y)*(r.x-s.x)}function Wn(s){let e=0;for(let r,a,l=0,h=s.length,p=h-1;l<h;p=l++)r=s[l],a=s[p],e+=(a.x-r.x)*(r.y+a.y);return e}function ri(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function je(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,h)=>{const p=l||h;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let $e=null;function et(s){if($e==null){const e=s.navigator?s.navigator.userAgent:null;$e=!!s.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return $e}function Ct(s){try{const e=P[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function wt(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}const yt="mapbox-tiles";let Ot=500,hs=50,as,it;function qt(){try{return P.caches}catch{}}function Ns(){qt()&&!as&&(as=P.caches.open(yt))}function tr(s){const e=s.indexOf("?");if(e<0)return s;const r=function(l){const h=l.indexOf("?");return h>0?l.slice(h+1).split("&"):[]}(s),a=r.filter(l=>{const h=l.split("=");return h[0]==="language"||h[0]==="worldview"});return a.length?`${s.slice(0,e)}?${a.join("&")}`:s.slice(0,e)}let cr=1/0;const sr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(sr);class rr extends Error{constructor(e,r,a){r===401&&De(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ii=ri()?()=>self.worker&&self.worker.referrer:()=>(P.location.protocol==="blob:"?P.parent:P).location.href,Kr=function(s,e){if(!(/^file:/.test(r=s.url)||/^file:/.test(ii())&&!/^\w+:/.test(r))){if(P.fetch&&P.Request&&P.AbortController&&P.Request.prototype.hasOwnProperty("signal"))return function(a,l){const h=new P.AbortController,p=new P.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:ii(),referrerPolicy:a.referrerPolicy,signal:h.signal});let y=!1,b=!1;const v=(E=p.url).indexOf("sku=")>0&&De(E);var E;a.type==="json"&&p.headers.set("Accept","application/json");const k=(L,R,B)=>{if(b)return;if(L&&L.message!=="SecurityError"&&Ds(L.toString()),R&&B)return M(R);const X=Date.now();P.fetch(p).then(re=>{if(re.ok){const pe=v?re.clone():null;return M(re,pe,X)}return l(new rr(re.statusText,re.status,a.url))}).catch(re=>{re.name!=="AbortError"&&l(new Error(`${re.message} ${a.url}`))})},M=(L,R,B)=>{(a.type==="arrayBuffer"?L.arrayBuffer():a.type==="json"?L.json():L.text()).then(X=>{b||(R&&B&&function(re,pe,ie){if(Ns(),!as)return;const ue={status:pe.status,statusText:pe.statusText,headers:new P.Headers};pe.headers.forEach((Fe,Re)=>ue.headers.set(Re,Fe));const xe=je(pe.headers.get("Cache-Control")||"");if(xe["no-store"])return;xe["max-age"]&&ue.headers.set("Expires",new Date(ie+1e3*xe["max-age"]).toUTCString());const ge=ue.headers.get("Expires");ge&&(new Date(ge).getTime()-ie<42e4||function(Fe,Re){if(it===void 0)try{new Response(new ReadableStream),it=!0}catch{it=!1}it?Re(Fe.body):Fe.blob().then(Re)}(pe,Fe=>{const Re=new P.Response(Fe,ue);Ns(),as&&as.then(He=>He.put(tr(re.url),Re)).catch(He=>Ds(He.message))}))}(p,R,B),y=!0,l(null,X,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(X=>{b||l(new Error(X.message))})};return v?function(L,R){if(Ns(),!as)return R(null);const B=tr(L.url);as.then(X=>{X.match(B).then(re=>{const pe=function(ie){if(!ie)return!1;const ue=new Date(ie.headers.get("Expires")||0),xe=je(ie.headers.get("Cache-Control")||"");return ue>Date.now()&&!xe["no-cache"]}(re);X.delete(B),pe&&X.put(B,re.clone()),R(null,re,pe)}).catch(R)}).catch(R)}(p,k):k(null,null),{cancel:()=>{b=!0,y||h.abort()}}}(s,e);if(ri()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var r;return function(a,l){const h=new P.XMLHttpRequest;h.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in a.headers)h.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=a.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(a.type==="json")try{p=JSON.parse(h.response)}catch(y){return l(y)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else l(new rr(h.statusText,h.status,a.url))},h.send(a.body),{cancel:()=>h.abort()}}(s,e)},Qr=function(s,e){return Kr(js(s,{type:"arrayBuffer"}),e)};function Fr(s){const e=P.document.createElement("a");return e.href=s,e.protocol===P.document.location.protocol&&e.host===P.document.location.host}const he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let V,$;V=[],$=0;const ce=function(s,e){if(W.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),$>=U.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return V.push(h),h}$++;let r=!1;const a=()=>{if(!r)for(r=!0,$--;V.length&&$<U.MAX_PARALLEL_IMAGE_REQUESTS;){const h=V.shift(),{requestParameters:p,callback:y,cancelled:b}=h;b||(h.cancel=ce(p,y).cancel)}},l=Qr(s,(h,p,y,b)=>{a(),h?e(h):p&&(P.createImageBitmap?function(v,E){const k=new P.Blob([new Uint8Array(v)],{type:"image/png"});P.createImageBitmap(k).then(M=>{E(null,M)}).catch(M=>{E(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(v,E)=>e(v,E,y,b)):function(v,E){const k=new P.Image,M=P.URL;k.onload=()=>{E(null,k),M.revokeObjectURL(k.src),k.onload=null,P.requestAnimationFrame(()=>{k.src=he})},k.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new P.Blob([new Uint8Array(v)],{type:"image/png"});k.src=v.byteLength?M.createObjectURL(L):he}(p,(v,E)=>e(v,E,y,b)))});return{cancel:()=>{l.cancel(),a()}}},ye="NO_ACCESS_TOKEN";function Ee(s){return s.indexOf("mapbox:")===0}function De(s){return U.API_URL_REGEX.test(s)}function Ie(s){return U.API_CDN_URL_REGEX.test(s)}function Te(s){return U.API_STYLE_REGEX.test(s)&&!qe(s)}function qe(s){return U.API_SPRITE_REGEX.test(s)}const gt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _t(s){const e=s.match(gt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ut(s){const e=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${e}`}const Ht="mapbox.eventData";function Jt(s){if(!s)return null;const e=s.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(P.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Xt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Jt(U.ACCESS_TOKEN);let a="";return a=r&&r.u?P.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,h)=>String.fromCharCode(+("0x"+h)))):U.ACCESS_TOKEN||"",e?`${Ht}.${e}:${a}`:`${Ht}:${a}`}fetchEventData(){const e=Ct("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const l=P.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const h=P.localStorage.getItem(a);h&&(this.anonId=h)}catch{Ds("Unable to read from LocalStorage")}}saveEventData(){const e=Ct("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{P.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&P.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Ds("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,l){if(!U.EVENTS_URL)return;const h=_t(U.EVENTS_URL);h.params.push(`access_token=${l||U.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},y=r?js(p,r):p,b={url:ut(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(v,E){return Kr(js(v,{method:"POST"}),E)}(b,v=>{this.pendingRequest=null,a(v),this.saveEventData(),this.processRequests(l)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Yt=new class extends Xt{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,e){U.EVENTS_URL&&U.ACCESS_TOKEN&&Array.isArray(s)&&s.some(r=>Ee(r)||De(r))&&this.queueRequest(Date.now(),e)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Jt(U.ACCESS_TOKEN),r=e?e.u:U.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;Or(this.anonId)||(this.anonId=vs(),a=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),p=new Date(l),y=(l-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||h.getDate()!==p.getDate()}else a=!0;a?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:te,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},s):this.processRequests()}},ls=Yt.postTurnstileEvent.bind(Yt),Zs=new class extends Xt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,e,r,a){this.skuToken=e,this.errorCb=a,U.EVENTS_URL&&(r||U.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},r):this.errorCb(new Error(ye)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Or(this.anonId)||(this.anonId=vs()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:te,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},s))}},dr=Zs.postMapLoadEvent.bind(Zs),Gr=new class extends Xt{constructor(){super("gljs.performance")}postPerformanceEvent(s,e){U.EVENTS_URL&&(s||U.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),a=function(l){const h=P.performance.getEntriesByType("resource"),p=P.performance.getEntriesByType("mark"),y=function(M){const L={};if(M){for(const R in M)if(R!=="other")for(const B of M[R]){const X=`${R}ResolveRangeMin`,re=`${R}ResolveRangeMax`,pe=`${R}RequestCount`,ie=`${R}RequestCachedCount`;L[X]=Math.min(L[X]||1/0,B.startTime),L[re]=Math.max(L[re]||-1/0,B.responseEnd);const ue=xe=>{L[xe]===void 0&&(L[xe]=0),++L[xe]};B.transferSize!==void 0&&B.transferSize===0&&ue(ie),ue(pe)}}return L}(function(M,L){const R={};if(M)for(const B of M){const X=L(B);R[X]===void 0&&(R[X]=[]),R[X].push(B)}return R}(h,lu)),b=P.devicePixelRatio,v=P.navigator.connection||P.navigator.mozConnection||P.navigator.webkitConnection,E={counters:[],metadata:[],attributes:[]},k=(M,L,R)=>{R!=null&&M.push({name:L,value:R.toString()})};for(const M in y)k(E.counters,M,y[M]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(k(E.counters,"interactionRangeMin",l.interactionRange[0]),k(E.counters,"interactionRangeMax",l.interactionRange[1])),p)for(const M of Object.keys(xa)){const L=xa[M],R=p.find(B=>B.name===L);R&&k(E.counters,L,R.startTime)}return k(E.counters,"visibilityHidden",l.visibilityHidden),k(E.attributes,"style",function(M){if(M)for(const L of M){const R=L.name.split("?")[0];if(Te(R)){const B=R.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(h)),k(E.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),k(E.attributes,"fogEnabled",l.fogEnabled?"true":"false"),k(E.attributes,"projection",l.projection),k(E.attributes,"zoom",l.zoom),k(E.metadata,"devicePixelRatio",b),k(E.metadata,"connectionEffectiveType",v?v.effectiveType:void 0),k(E.metadata,"navigatorUserAgent",P.navigator.userAgent),k(E.metadata,"screenWidth",P.screen.width),k(E.metadata,"screenHeight",P.screen.height),k(E.metadata,"windowWidth",P.innerWidth),k(E.metadata,"windowHeight",P.innerHeight),k(E.metadata,"mapWidth",l.width/b),k(E.metadata,"mapHeight",l.height/b),k(E.metadata,"webglRenderer",l.renderer),k(E.metadata,"webglVendor",l.vendor),k(E.metadata,"sdkVersion",z),k(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(r);for(const l of a.metadata);for(const l of a.counters);for(const l of a.attributes);this.postEvent(e,a,()=>{},s)}},wr=Gr.postPerformanceEvent.bind(Gr),Vi=new class extends Xt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,e,r,a){if(!U.API_URL||!U.SESSION_PATH)return;const l=_t(U.API_URL+U.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${a||U.ACCESS_TOKEN||""}`);const h={url:ut(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,y){return Kr(js(p,{method:"GET"}),y)}(h,p=>{this.pendingRequest=null,r(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(s,e,r,a){this.skuToken=e,this.errorCb=a,U.SESSION_PATH&&U.API_URL&&(r||U.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},r):this.errorCb(new Error(ye)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},s)}},kr=Vi.getSessionAPI.bind(Vi),Jr=new Set,xa={create:"create",load:"load",fullLoad:"fullLoad"},ym={mark(s){P.performance.mark(s)},measure(s,e,r){P.performance.measure(s,e,r)}};function lu(s){const e=s.name.split("?")[0];return Ie(e)&&e.includes("mapbox-gl.js")?"javascript":Ie(e)&&e.includes("mapbox-gl.css")?"css":function(r){return U.API_FONTS_REGEX.test(r)}(e)?"fontRange":qe(e)?"sprite":Te(e)?"style":function(r){return U.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}const _s=P.performance;function uc(s){const e=s?s.url.toString():void 0;return _s.getEntriesByName(e)}let io,hc,tl,qi;const nn={now:()=>tl!==void 0?tl:P.performance.now(),setNow(s){tl=s},restoreNow(){tl=void 0},frame(s){const e=P.requestAnimationFrame(s);return{cancel:()=>P.cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:r,height:a}=s;qi||(qi=P.document.createElement("canvas"));const l=qi.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>qi.width||a>qi.height)&&(qi.width=r,qi.height=a),l.clearRect(-e,-e,r+2*e,a+2*e),l.drawImage(s,0,0,r,a),l.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:s=>(io||(io=P.document.createElement("a")),io.href=s,io.href),get devicePixelRatio(){return P.devicePixelRatio},get prefersReducedMotion(){return!!P.matchMedia&&(hc==null&&(hc=P.matchMedia("(prefers-reduced-motion: reduce)")),hc.matches)}};function mc(s,e,r){r[s]&&r[s].indexOf(e)!==-1||(r[s]=r[s]||[],r[s].push(e))}function pc(s,e,r){if(r&&r[s]){const a=r[s].indexOf(e);a!==-1&&r[s].splice(a,1)}}class Hn{constructor(e,r={}){js(this,r),this.type=e}}class an extends Hn{constructor(e,r={}){super("error",js({error:e},r))}}class no{on(e,r){return this._listeners=this._listeners||{},mc(e,r,this._listeners),this}off(e,r){return pc(e,r,this._listeners),pc(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},mc(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Hn(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of l)y.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of h)pc(a,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(js(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof an&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function on(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}function ur(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Ar(s){if(Array.isArray(s))return s.map(Ar);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const r in s)e[r]=Ar(s[r]);return e}return ur(s)}class cu extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var $i=cu;class fc{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,l]of r)this.bindings[a]=l}concat(e){return new fc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var du=fc;const ya={kind:"null"},Nt={kind:"number"},os={kind:"string"},rs={kind:"boolean"},xi={kind:"color"},Ri={kind:"object"},is={kind:"value"},yi={kind:"collator"},ao={kind:"formatted"},Xn={kind:"resolvedImage"};function ji(s,e){return{kind:"array",itemType:s,N:e}}function qs(s){if(s.kind==="array"){const e=qs(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const uu=[ya,Nt,os,rs,xi,ao,Ri,ji(is),Xn];function ln(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ln(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const r of uu)if(!ln(r,e))return null}}return`Expected ${qs(s)} but found ${qs(e)} instead.`}function oo(s,e){return e.some(r=>r.kind===s.kind)}function lo(s,e){return e.some(r=>r==="null"?s===null:r==="array"?Array.isArray(s):r==="object"?s&&!Array.isArray(s)&&typeof s=="object":r===typeof s)}var gc,hu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function co(s){return(s=Math.round(s))<0?0:s>255?255:s}function uo(s){return co(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function sl(s){return(e=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:e>1?1:e;var e}function _a(s,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?s+(e-s)*r*6:2*r<1?e:3*r<2?s+(e-s)*(2/3-r)*6:s}try{gc={}.parseCSSColor=function(s){var e,r=s.replace(/ /g,"").toLowerCase();if(r in hu)return hu[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),l=r.indexOf(")");if(a!==-1&&l+1===r.length){var h=r.substr(0,a),p=r.substr(a+1,l-(a+1)).split(","),y=1;switch(h){case"rgba":if(p.length!==4)return null;y=sl(p.pop());case"rgb":return p.length!==3?null:[uo(p[0]),uo(p[1]),uo(p[2]),y];case"hsla":if(p.length!==4)return null;y=sl(p.pop());case"hsl":if(p.length!==3)return null;var b=(parseFloat(p[0])%360+360)%360/360,v=sl(p[1]),E=sl(p[2]),k=E<=.5?E*(v+1):E+v-E*v,M=2*E-k;return[co(255*_a(M,k,b+1/3)),co(255*_a(M,k,b)),co(255*_a(M,k,b-1/3)),y];default:return null}}return null}}catch{}class ni{constructor(e,r,a,l=1){this.r=e,this.g=r,this.b=a,this.a=l}static parse(e){if(!e)return;if(e instanceof ni)return e;if(typeof e!="string")return;const r=gc(e);return r?new ni(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${l})`}toArray(){const{r:e,g:r,b:a,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*a/l,l]}toArray01(){const{r:e,g:r,b:a,a:l}=this;return l===0?[0,0,0,0]:[e/l,r/l,a/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:l}=this;return[e,r,a,l]}}ni.black=new ni(0,0,0,1),ni.white=new ni(1,1,1,1),ni.transparent=new ni(0,0,0,0),ni.red=new ni(1,0,0,1),ni.blue=new ni(0,0,1,1);var ir=ni;class xc{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yc{constructor(e,r,a,l,h){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=l,this.textColor=h}}class ai{constructor(e){this.sections=e}static fromString(e){return new ai([new yc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ai?e:ai.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class Ni{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ni({name:e,available:!1}):null}serialize(){return["image",this.name]}}function mu(s,e,r,a){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[s,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[s,e,r,a]:[s,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ho(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof ir||s instanceof xc||s instanceof ai||s instanceof Ni)return!0;if(Array.isArray(s)){for(const e of s)if(!ho(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!ho(s[e]))return!1;return!0}return!1}function Xs(s){if(s===null)return ya;if(typeof s=="string")return os;if(typeof s=="boolean")return rs;if(typeof s=="number")return Nt;if(s instanceof ir)return xi;if(s instanceof xc)return yi;if(s instanceof ai)return ao;if(s instanceof Ni)return Xn;if(Array.isArray(s)){const e=s.length;let r;for(const a of s){const l=Xs(a);if(r){if(r===l)continue;r=is;break}r=l}return ji(r||is,e)}return Ri}function mo(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof ir||s instanceof ai||s instanceof Ni?s.toString():JSON.stringify(s)}class _c{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ho(e[1]))return r.error("invalid value");const a=e[1];let l=Xs(a);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new _c(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ir?["rgba"].concat(this.value.toArray()):this.value instanceof ai?this.value.serialize():this.value}}var Kn=_c,Br=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const bc={string:os,number:Nt,boolean:rs,object:Ri};class vc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,l=1;const h=e[0];if(h==="array"){let y,b;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in bc)||v==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=bc[v],l++}else y=is;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],l++}a=ji(y,b)}else a=bc[h];const p=[];for(;l<e.length;l++){const y=r.parse(e[l],l,is);if(!y)return null;p.push(y)}return new vc(a,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!ln(this.type,Xs(a)))return a;if(r===this.args.length-1)throw new Br(`Expected value to be of type ${qs(this.type)}, but found ${qs(Xs(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(a=>a.serialize()))}}var cn=vc;class Mn{constructor(e){this.type=ao,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,Nt),!b))return null;let v=null;if(y["text-font"]&&(v=r.parse(y["text-font"],1,ji(os)),!v))return null;let E=null;if(y["text-color"]&&(E=r.parse(y["text-color"],1,xi),!E))return null;const k=l[l.length-1];k.scale=b,k.font=v,k.textColor=E}else{const b=r.parse(e[p],1,is);if(!b)return null;const v=b.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:b,scale:null,font:null,textColor:null})}}return new Mn(l)}evaluate(e){return new ai(this.sections.map(r=>{const a=r.content.evaluate(e);return Xs(a)===Xn?new yc("",a,null,null,null):new yc(mo(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class rl{constructor(e){this.type=Xn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,os);return a?new rl(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=Ni.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const _m={"to-boolean":rs,"to-color":xi,"to-number":Nt,"to-string":os};class wc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=_m[a],h=[];for(let p=1;p<e.length;p++){const y=r.parse(e[p],p,is);if(!y)return null;h.push(y)}return new wc(l,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const l of this.args){if(r=l.evaluate(e),a=null,r instanceof ir)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:mu(r[0],r[1],r[2],r[3]),!a))return new ir(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Br(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Br(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ai.fromString(mo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ni.fromString(mo(this.args[0].evaluate(e))):mo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Mn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var ba=wc;const Gi=["Unknown","Point","LineString","Polygon"];var jc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-s[0])+this.featureDistanceData.bearing[1]*(a*e-s[1])}return 0}parseColor(s){let e=this._parseColorCache[s];return e||(e=this._parseColorCache[s]=ir.parse(s)),e}};class Qn{constructor(e,r,a,l){this.name=e,this.type=r,this._evaluate=a,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],l=Qn.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=p.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let b=null;for(const[v,E]of y){b=new kc(r.registry,r.path,null,r.scope);const k=[];let M=!1;for(let L=1;L<e.length;L++){const R=e[L],B=Array.isArray(v)?v[L-1]:v.type,X=b.parse(R,1+k.length,B);if(!X){M=!0;break}k.push(X)}if(!M)if(Array.isArray(v)&&v.length!==k.length)b.error(`Expected ${v.length} arguments, but found ${k.length} instead.`);else{for(let L=0;L<k.length;L++){const R=Array.isArray(v)?v[L]:v.type,B=k[L];b.concat(L+1).checkSubtype(R,B.type)}if(b.errors.length===0)return new Qn(a,h,E,k)}}if(y.length===1)r.errors.push(...b.errors);else{const v=(y.length?y:p).map(([k])=>{return M=k,Array.isArray(M)?`(${M.map(qs).join(", ")})`:`(${qs(M.type)}...)`;var M}).join(" | "),E=[];for(let k=1;k<e.length;k++){const M=r.parse(e[k],1+E.length);if(!M)return null;E.push(qs(M.type))}r.error(`Expected arguments of type ${v}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){Qn.definitions=r;for(const a in r)e[a]=Qn}}var dn=Qn;class po{constructor(e,r,a){this.type=yi,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const l=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,rs);if(!l)return null;const h=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,rs);if(!h)return null;let p=null;return a.locale&&(p=r.parse(a.locale,1,os),!p)?null:new po(l,h,p)}evaluate(e){return new xc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const un=8192;function il(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function va(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function fo(s,e){const r=(180+s[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*un),Math.round(a*l*un)]}function pu(s,e,r){const a=s[0]-e[0],l=s[1]-e[1],h=s[0]-r[0],p=s[1]-r[1];return a*p-h*l==0&&a*h<=0&&l*p<=0}function nl(s,e){let r=!1;for(let p=0,y=e.length;p<y;p++){const b=e[p];for(let v=0,E=b.length;v<E-1;v++){if(pu(s,b[v],b[v+1]))return!1;(l=b[v])[1]>(a=s)[1]!=(h=b[v+1])[1]>a[1]&&a[0]<(h[0]-l[0])*(a[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var a,l,h;return r}function Nc(s,e){for(let r=0;r<e.length;r++)if(nl(s,e[r]))return!0;return!1}function Sc(s,e,r,a){const l=a[0]-r[0],h=a[1]-r[1],p=(s[0]-r[0])*h-l*(s[1]-r[1]),y=(e[0]-r[0])*h-l*(e[1]-r[1]);return p>0&&y<0||p<0&&y>0}function wa(s,e,r){for(const v of r)for(let E=0;E<v.length-1;++E)if((y=[(p=v[E+1])[0]-(h=v[E])[0],p[1]-h[1]])[0]*(b=[(l=e)[0]-(a=s)[0],l[1]-a[1]])[1]-y[1]*b[0]!=0&&Sc(a,l,h,p)&&Sc(h,p,a,l))return!0;var a,l,h,p,y,b;return!1}function bs(s,e){for(let r=0;r<s.length;++r)if(!nl(s[r],e))return!1;for(let r=0;r<s.length-1;++r)if(wa(s[r],s[r+1],e))return!1;return!0}function bm(s,e){for(let r=0;r<e.length;r++)if(bs(s,e[r]))return!0;return!1}function Tc(s,e,r){const a=[];for(let l=0;l<s.length;l++){const h=[];for(let p=0;p<s[l].length;p++){const y=fo(s[l][p],r);il(e,y),h.push(y)}a.push(h)}return a}function fu(s,e,r){const a=[];for(let l=0;l<s.length;l++){const h=Tc(s[l],e,r);a.push(h)}return a}function Ec(s,e,r,a){if(s[0]<r[0]||s[0]>r[2]){const l=.5*a;let h=s[0]-r[0]>l?-a:r[0]-s[0]>l?a:0;h===0&&(h=s[0]-r[2]>l?-a:r[2]-s[0]>l?a:0),s[0]+=h}il(e,s)}function gu(s,e,r,a){const l=Math.pow(2,a.z)*un,h=[a.x*un,a.y*un],p=[];if(!s)return p;for(const y of s)for(const b of y){const v=[b.x+h[0],b.y+h[1]];Ec(v,e,r,l),p.push(v)}return p}function Cc(s,e,r,a){const l=Math.pow(2,a.z)*un,h=[a.x*un,a.y*un],p=[];if(!s)return p;for(const b of s){const v=[];for(const E of b){const k=[E.x+h[0],E.y+h[1]];il(e,k),v.push(k)}p.push(v)}if(e[2]-e[0]<=l/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of p)for(const v of b)Ec(v,e,r,l)}var y;return p}class ja{constructor(e,r){this.type=rs,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ho(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let l=0;l<a.features.length;++l){const h=a.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ja(a,a.features[l].geometry)}else if(a.type==="Feature"){const l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new ja(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ja(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=Tc(a.coordinates,h,p),b=gu(r.geometry(),l,h,p);if(!va(l,h))return!1;for(const v of b)if(!nl(v,y))return!1}if(a.type==="MultiPolygon"){const y=fu(a.coordinates,h,p),b=gu(r.geometry(),l,h,p);if(!va(l,h))return!1;for(const v of b)if(!Nc(v,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=Tc(a.coordinates,h,p),b=Cc(r.geometry(),l,h,p);if(!va(l,h))return!1;for(const v of b)if(!bs(v,y))return!1}if(a.type==="MultiPolygon"){const y=fu(a.coordinates,h,p),b=Cc(r.geometry(),l,h,p);if(!va(l,h))return!1;for(const v of b)if(!bm(v,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var al=ja;function Na(s){if(s instanceof dn&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof al)return!1;let e=!0;return s.eachChild(r=>{e&&!Na(r)&&(e=!1)}),e}function hn(s){if(s instanceof dn&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(r=>{e&&!hn(r)&&(e=!1)}),e}function Jn(s,e){if(s instanceof dn&&e.indexOf(s.name)>=0)return!1;let r=!0;return s.eachChild(a=>{r&&!Jn(a,e)&&(r=!1)}),r}class ol{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new ol(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var xu=ol;class go{constructor(e,r=[],a,l=new du,h=[]){this.registry=e,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=h,this.expectedType=a}parse(e,r,a,l,h={}){return r?this.concat(r,a,l)._parse(e,h):this._parse(e,h)}_parse(e,r){function a(l,h,p){return p==="assert"?new cn(h,[l]):p==="coerce"?new ba(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,b=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else p=a(p,y,r.typeAnnotation||"coerce");else p=a(p,y,r.typeAnnotation||"assert")}if(!(p instanceof Kn)&&p.type.kind!=="resolvedImage"&&Ac(p)){const y=new jc;try{p=new Kn(p.type,p.evaluate(y))}catch(b){return this.error(b.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const l=typeof e=="number"?this.path.concat(e):this.path,h=a?this.scope.concat(a):this.scope;return new go(this.registry,l,r||null,h,this.errors)}error(e,...r){const a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new $i(a,e))}checkSubtype(e,r){const a=ln(e,r);return a&&this.error(a),a}}var kc=go;function Ac(s){if(s instanceof xu)return Ac(s.boundExpression);if(s instanceof dn&&s.name==="error"||s instanceof po||s instanceof al)return!1;const e=s instanceof ba||s instanceof cn;let r=!0;return s.eachChild(a=>{r=e?r&&Ac(a):r&&a instanceof Kn}),!!r&&Na(s)&&Jn(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ll(s,e){const r=s.length-1;let a,l,h=0,p=r,y=0;for(;h<=p;)if(y=Math.floor((h+p)/2),a=s[y],l=s[y+1],a<=e){if(y===r||e<l)return y;h=y+1}else{if(!(a>e))throw new Br("Input is not a number.");p=y-1}return 0}class cl{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of a)this.labels.push(l),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Nt);if(!a)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],b=e[p+1],v=p,E=p+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(l.length&&l[l.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const k=r.parse(b,E,h);if(!k)return null;h=h||k.type,l.push([y,k])}return new cl(h,a,l)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const h=r.length;return l>=r[h-1]?a[h-1].evaluate(e):a[ll(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var Mc=cl;function ms(s,e,r){return s*(1-r)+e*r}var xo=Object.freeze({__proto__:null,array:function(s,e,r){return s.map((a,l)=>ms(a,e[l],r))},color:function(s,e,r){return new ir(ms(s.r,e.r,r),ms(s.g,e.g,r),ms(s.b,e.b,r),ms(s.a,e.a,r))},number:ms});const yu=.95047,Pc=1.08883,_u=4/29,Yn=6/29,Ic=3*Yn*Yn,vm=Yn*Yn*Yn,wm=Math.PI/180,jm=180/Math.PI;function Dc(s){return s>vm?Math.pow(s,1/3):s/Ic+_u}function Lc(s){return s>Yn?s*s*s:Ic*(s-_u)}function Rc(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function dl(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function bu(s){const e=dl(s.r),r=dl(s.g),a=dl(s.b),l=Dc((.4124564*e+.3575761*r+.1804375*a)/yu),h=Dc((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*h-16,a:500*(l-h),b:200*(h-Dc((.0193339*e+.119192*r+.9503041*a)/Pc)),alpha:s.a}}function vu(s){let e=(s.l+16)/116,r=isNaN(s.a)?e:e+s.a/500,a=isNaN(s.b)?e:e-s.b/200;return e=1*Lc(e),r=yu*Lc(r),a=Pc*Lc(a),new ir(Rc(3.2404542*r-1.5371385*e-.4985314*a),Rc(-.969266*r+1.8760108*e+.041556*a),Rc(.0556434*r-.2040259*e+1.0572252*a),s.alpha)}function Nm(s,e,r){const a=e-s;return s+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const yo={forward:bu,reverse:vu,interpolate:function(s,e,r){return{l:ms(s.l,e.l,r),a:ms(s.a,e.a,r),b:ms(s.b,e.b,r),alpha:ms(s.alpha,e.alpha,r)}}},Sa={forward:function(s){const{l:e,a:r,b:a}=bu(s),l=Math.atan2(a,r)*jm;return{h:l<0?l+360:l,c:Math.sqrt(r*r+a*a),l:e,alpha:s.a}},reverse:function(s){const e=s.h*wm,r=s.c;return vu({l:s.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:s.alpha})},interpolate:function(s,e,r){return{h:Nm(s.h,e.h,r),c:ms(s.c,e.c,r),l:ms(s.l,e.l,r),alpha:ms(s.alpha,e.alpha,r)}}};var zc=Object.freeze({__proto__:null,hcl:Sa,lab:yo});class _o{constructor(e,r,a,l,h){this.type=e,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of h)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,r,a,l){let h=0;if(e.name==="exponential")h=Oc(r,e.base,a,l);else if(e.name==="linear")h=Oc(r,1,a,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new Se(p[0],p[1],p[2],p[3]).solve(Oc(r,1,a,l))}return h}static parse(e,r){let[a,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const v=l[1];if(typeof v!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:v}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const v=l.slice(1);if(v.length!==4||v.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,Nt),!h)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=xi:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let v=0;v<p.length;v+=2){const E=p[v],k=p[v+1],M=v+3,L=v+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(y.length&&y[y.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const R=r.parse(k,L,b);if(!R)return null;b=b||R.type,y.push([E,R])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new _o(b,a,l,h,y):r.error(`Type ${qs(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return a[0].evaluate(e);const h=r.length;if(l>=r[h-1])return a[h-1].evaluate(e);const p=ll(r,l),y=_o.interpolationFactor(this.interpolation,l,r[p],r[p+1]),b=a[p].evaluate(e),v=a[p+1].evaluate(e);return this.operator==="interpolate"?xo[this.type.kind.toLowerCase()](b,v,y):this.operator==="interpolate-hcl"?Sa.reverse(Sa.interpolate(Sa.forward(b),Sa.forward(v),y)):yo.reverse(yo.interpolate(yo.forward(b),yo.forward(v),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function Oc(s,e,r,a){const l=a-r,h=s-r;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}var Zi=_o;class ul{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const l=r.expectedType;l&&l.kind!=="value"&&(a=l);const h=[];for(const y of e.slice(1)){const b=r.parse(y,1+h.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,h.push(b)}const p=l&&h.some(y=>ln(l,y.type));return new ul(p?is:a,h)}evaluate(e){let r,a=null,l=0;for(const h of this.args){if(l++,a=h.evaluate(e),a&&a instanceof Ni&&!a.available&&(r||(r=a),a=null,l===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Fc=ul;class hl{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const y=r.parse(e[h+1],h+1);if(!y)return null;a.push([p,y])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return l?new hl(a,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}var wu=hl;class Bc{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Nt),l=r.parse(e[2],2,ji(r.expectedType||is));return a&&l?new Bc(l.type.itemType,a,l):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Br(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Br(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Br(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Sm=Bc;class Uc{constructor(e,r){this.type=rs,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,is),l=r.parse(e[2],2,is);return a&&l?oo(a.type,[rs,os,Nt,ya,is])?new Uc(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${qs(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!lo(r,["boolean","string","number","null"]))throw new Br(`Expected first argument to be of type boolean, string, number or null, but found ${qs(Xs(r))} instead.`);if(!lo(a,["string","array"]))throw new Br(`Expected second argument to be of type array or string, but found ${qs(Xs(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ml=Uc;class bo{constructor(e,r,a){this.type=Nt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,is),l=r.parse(e[2],2,is);if(!a||!l)return null;if(!oo(a.type,[rs,os,Nt,ya,is]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${qs(a.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Nt);return h?new bo(a,l,h):null}return new bo(a,l)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!lo(r,["boolean","string","number","null"]))throw new Br(`Expected first argument to be of type boolean, string, number or null, but found ${qs(Xs(r))} instead.`);if(!lo(a,["string","array"]))throw new Br(`Expected second argument to be of type array or string, but found ${qs(Xs(a))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return a.indexOf(r,l)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ju=bo;class Vc{constructor(e,r,a,l,h,p){this.inputType=e,this.type=r,this.input=a,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},p=[];for(let v=2;v<e.length-1;v+=2){let E=e[v];const k=e[v+1];Array.isArray(E)||(E=[E]);const M=r.concat(v);if(E.length===0)return M.error("Expected at least one branch label.");for(const R of E){if(typeof R!="number"&&typeof R!="string")return M.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return M.error("Numeric branch labels must be integer values.");if(a){if(M.checkSubtype(a,Xs(R)))return null}else a=Xs(R);if(h[String(R)]!==void 0)return M.error("Branch labels must be unique.");h[String(R)]=p.length}const L=r.parse(k,v,l);if(!L)return null;l=l||L.type,p.push(L)}const y=r.parse(e[1],1,is);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,l);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new Vc(a,l,y,h,p,b):null}evaluate(e){const r=this.input.evaluate(e);return(Xs(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],l={};for(const p of r){const y=l[this.cases[p]];y===void 0?(l[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[y][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of a)e.push(y.length===1?h(y[0]):y.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Tm=Vc;class qc{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const y=r.parse(e[p],p,rs);if(!y)return null;const b=r.parse(e[p+1],p+1,a);if(!b)return null;l.push([y,b]),a=a||b.type}const h=r.parse(e[e.length-1],e.length-1,a);return h?new qc(a,l,h):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Nu=qc;class vo{constructor(e,r,a,l){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,is),l=r.parse(e[2],2,Nt);if(!a||!l)return null;if(!oo(a.type,[ji(is),os,is]))return r.error(`Expected first argument to be of type array or string, but found ${qs(a.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Nt);return h?new vo(a.type,a,l,h):null}return new vo(a.type,a,l)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!lo(r,["string","array"]))throw new Br(`Expected first argument to be of type array or string, but found ${qs(Xs(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(a,l)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Su=vo;function pl(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Tu(s,e,r,a){return a.compare(e,r)===0}function Ta(s,e,r){const a=s!=="=="&&s!=="!=";return class nb{constructor(h,p,y){this.type=rs,this.lhs=h,this.rhs=p,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const y=h[0];let b=p.parse(h[1],1,is);if(!b)return null;if(!pl(y,b.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${qs(b.type)}'.`);let v=p.parse(h[2],2,is);if(!v)return null;if(!pl(y,v.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${qs(v.type)}'.`);if(b.type.kind!==v.type.kind&&b.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${qs(b.type)}' and '${qs(v.type)}'.`);a&&(b.type.kind==="value"&&v.type.kind!=="value"?b=new cn(v.type,[b]):b.type.kind!=="value"&&v.type.kind==="value"&&(v=new cn(b.type,[v])));let E=null;if(h.length===4){if(b.type.kind!=="string"&&v.type.kind!=="string"&&b.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(h[3],3,yi),!E)return null}return new nb(b,v,E)}evaluate(h){const p=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(a&&this.hasUntypedArgument){const b=Xs(p),v=Xs(y);if(b.kind!==v.kind||b.kind!=="string"&&b.kind!=="number")throw new Br(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${b.kind}, ${v.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Xs(p),v=Xs(y);if(b.kind!=="string"||v.kind!=="string")return e(h,p,y)}return this.collator?r(h,p,y,this.collator.evaluate(h)):e(h,p,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[s];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const Em=Ta("==",function(s,e,r){return e===r},Tu),Cm=Ta("!=",function(s,e,r){return e!==r},function(s,e,r,a){return!Tu(0,e,r,a)}),km=Ta("<",function(s,e,r){return e<r},function(s,e,r,a){return a.compare(e,r)<0}),Am=Ta(">",function(s,e,r){return e>r},function(s,e,r,a){return a.compare(e,r)>0}),Mm=Ta("<=",function(s,e,r){return e<=r},function(s,e,r,a){return a.compare(e,r)<=0}),Eu=Ta(">=",function(s,e,r){return e>=r},function(s,e,r,a){return a.compare(e,r)>=0});class fl{constructor(e,r,a,l,h,p){this.type=os,this.number=e,this.locale=r,this.currency=a,this.unit=l,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Nt);if(!a)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,os),!h))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,os),!p))return null;let y=null;if(l.unit&&(y=r.parse(l.unit,1,os),!y))return null;let b=null;if(l["min-fraction-digits"]&&(b=r.parse(l["min-fraction-digits"],1,Nt),!b))return null;let v=null;return l["max-fraction-digits"]&&(v=r.parse(l["max-fraction-digits"],1,Nt),!v)?null:new fl(a,h,p,y,b,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ea{constructor(e){this.type=Nt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${qs(a.type)} instead.`):new Ea(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Br(`Expected value to be of type string or array, but found ${qs(Xs(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Cu={"==":Em,"!=":Cm,">":Am,"<":km,">=":Eu,"<=":Mm,array:cn,at:Sm,boolean:cn,case:Nu,coalesce:Fc,collator:po,format:Mn,image:rl,in:ml,"index-of":ju,interpolate:Zi,"interpolate-hcl":Zi,"interpolate-lab":Zi,length:Ea,let:wu,literal:Kn,match:Tm,number:cn,"number-format":fl,object:cn,slice:Su,step:Mc,string:cn,"to-boolean":ba,"to-color":ba,"to-number":ba,"to-string":ba,var:xu,within:al};function ku(s,[e,r,a,l]){e=e.evaluate(s),r=r.evaluate(s),a=a.evaluate(s);const h=l?l.evaluate(s):1,p=mu(e,r,a,h);if(p)throw new Br(p);return new ir(e/255*h,r/255*h,a/255*h,h)}function mn(s,e){return s in e}function gl(s,e){const r=e[s];return r===void 0?null:r}function Si(s){return{type:s}}dn.register(Cu,{error:[{kind:"error"},[os],(s,[e])=>{throw new Br(e.evaluate(s))}],typeof:[os,[is],(s,[e])=>qs(Xs(e.evaluate(s)))],"to-rgba":[ji(Nt,4),[xi],(s,[e])=>e.evaluate(s).toArray()],rgb:[xi,[Nt,Nt,Nt],ku],rgba:[xi,[Nt,Nt,Nt,Nt],ku],has:{type:rs,overloads:[[[os],(s,[e])=>mn(e.evaluate(s),s.properties())],[[os,Ri],(s,[e,r])=>mn(e.evaluate(s),r.evaluate(s))]]},get:{type:is,overloads:[[[os],(s,[e])=>gl(e.evaluate(s),s.properties())],[[os,Ri],(s,[e,r])=>gl(e.evaluate(s),r.evaluate(s))]]},"feature-state":[is,[os],(s,[e])=>gl(e.evaluate(s),s.featureState||{})],properties:[Ri,[],s=>s.properties()],"geometry-type":[os,[],s=>s.geometryType()],id:[is,[],s=>s.id()],zoom:[Nt,[],s=>s.globals.zoom],pitch:[Nt,[],s=>s.globals.pitch||0],"distance-from-center":[Nt,[],s=>s.distanceFromCenter()],"heatmap-density":[Nt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Nt,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[Nt,[],s=>s.globals.skyRadialProgress||0],accumulated:[is,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Nt,Si(Nt),(s,e)=>{let r=0;for(const a of e)r+=a.evaluate(s);return r}],"*":[Nt,Si(Nt),(s,e)=>{let r=1;for(const a of e)r*=a.evaluate(s);return r}],"-":{type:Nt,overloads:[[[Nt,Nt],(s,[e,r])=>e.evaluate(s)-r.evaluate(s)],[[Nt],(s,[e])=>-e.evaluate(s)]]},"/":[Nt,[Nt,Nt],(s,[e,r])=>e.evaluate(s)/r.evaluate(s)],"%":[Nt,[Nt,Nt],(s,[e,r])=>e.evaluate(s)%r.evaluate(s)],ln2:[Nt,[],()=>Math.LN2],pi:[Nt,[],()=>Math.PI],e:[Nt,[],()=>Math.E],"^":[Nt,[Nt,Nt],(s,[e,r])=>Math.pow(e.evaluate(s),r.evaluate(s))],sqrt:[Nt,[Nt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Nt,[Nt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Nt,[Nt],(s,[e])=>Math.log(e.evaluate(s))],log2:[Nt,[Nt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[Nt,[Nt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Nt,[Nt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Nt,[Nt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Nt,[Nt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Nt,[Nt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Nt,[Nt],(s,[e])=>Math.atan(e.evaluate(s))],min:[Nt,Si(Nt),(s,e)=>Math.min(...e.map(r=>r.evaluate(s)))],max:[Nt,Si(Nt),(s,e)=>Math.max(...e.map(r=>r.evaluate(s)))],abs:[Nt,[Nt],(s,[e])=>Math.abs(e.evaluate(s))],round:[Nt,[Nt],(s,[e])=>{const r=e.evaluate(s);return r<0?-Math.round(-r):Math.round(r)}],floor:[Nt,[Nt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Nt,[Nt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[rs,[os,is],(s,[e,r])=>s.properties()[e.value]===r.value],"filter-id-==":[rs,[is],(s,[e])=>s.id()===e.value],"filter-type-==":[rs,[os],(s,[e])=>s.geometryType()===e.value],"filter-<":[rs,[os,is],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[rs,[is],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[rs,[os,is],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[rs,[is],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[rs,[os,is],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[rs,[is],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[rs,[os,is],(s,[e,r])=>{const a=s.properties()[e.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[rs,[is],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[rs,[is],(s,[e])=>e.value in s.properties()],"filter-has-id":[rs,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[rs,[ji(os)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[rs,[ji(is)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[rs,[os,ji(is)],(s,[e,r])=>r.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[rs,[os,ji(is)],(s,[e,r])=>function(a,l,h,p){for(;h<=p;){const y=h+p>>1;if(l[y]===a)return!0;l[y]>a?p=y-1:h=y+1}return!1}(s.properties()[e.value],r.value,0,r.value.length-1)],all:{type:rs,overloads:[[[rs,rs],(s,[e,r])=>e.evaluate(s)&&r.evaluate(s)],[Si(rs),(s,e)=>{for(const r of e)if(!r.evaluate(s))return!1;return!0}]]},any:{type:rs,overloads:[[[rs,rs],(s,[e,r])=>e.evaluate(s)||r.evaluate(s)],[Si(rs),(s,e)=>{for(const r of e)if(r.evaluate(s))return!0;return!1}]]},"!":[rs,[rs],(s,[e])=>!e.evaluate(s)],"is-supported-script":[rs,[os],(s,[e])=>{const r=s.globals&&s.globals.isSupportedScript;return!r||r(e.evaluate(s))}],upcase:[os,[os],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[os,[os],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[os,Si(is),(s,e)=>e.map(r=>mo(r.evaluate(s))).join("")],"resolved-locale":[os,[yi],(s,[e])=>e.evaluate(s).resolvedLocale()]});var wo=Cu;function Au(s){return{result:"success",value:s}}function ea(s){return{result:"error",value:s}}function Ca(s){return s["property-type"]==="data-driven"}function xl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function yl(s){return!!s.expression&&s.expression.interpolated}function fs(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function jo(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Mu(s){return s}function _l(s,e){const r=e.type==="color",a=s.stops&&typeof s.stops[0][0]=="object",l=a||!(a||s.property!==void 0),h=s.type||(yl(e)?"exponential":"interval");if(r&&((s=on({},s)).stops&&(s.stops=s.stops.map(v=>[v[0],ir.parse(v[1])])),s.default=ir.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!zc[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let p,y,b;if(h==="exponential")p=pn;else if(h==="interval")p=bl;else if(h==="categorical"){p=Pu,y=Object.create(null);for(const v of s.stops)y[v[0]]=v[1];b=typeof s.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=Iu}if(a){const v={},E=[];for(let L=0;L<s.stops.length;L++){const R=s.stops[L],B=R[0].zoom;v[B]===void 0&&(v[B]={zoom:B,type:s.type,property:s.property,default:s.default,stops:[]},E.push(B)),v[B].stops.push([R[0].value,R[1]])}const k=[];for(const L of E)k.push([v[L].zoom,_l(v[L],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Zi.interpolationFactor.bind(void 0,M),zoomStops:k.map(L=>L[0]),evaluate:({zoom:L},R)=>pn({stops:k,base:s.base},e,L).evaluate(L,R)}}if(l){const v=h==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:Zi.interpolationFactor.bind(void 0,v),zoomStops:s.stops.map(E=>E[0]),evaluate:({zoom:E})=>p(s,e,E,y,b)}}return{kind:"source",evaluate(v,E){const k=E&&E.properties?E.properties[s.property]:void 0;return k===void 0?ka(s.default,e.default):p(s,e,k,y,b)}}}function ka(s,e,r){return s!==void 0?s:e!==void 0?e:r!==void 0?r:void 0}function Pu(s,e,r,a,l){return ka(typeof r===l?a[r]:void 0,s.default,e.default)}function bl(s,e,r){if(fs(r)!=="number")return ka(s.default,e.default);const a=s.stops.length;if(a===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[a-1][0])return s.stops[a-1][1];const l=ll(s.stops.map(h=>h[0]),r);return s.stops[l][1]}function pn(s,e,r){const a=s.base!==void 0?s.base:1;if(fs(r)!=="number")return ka(s.default,e.default);const l=s.stops.length;if(l===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[l-1][0])return s.stops[l-1][1];const h=ll(s.stops.map(E=>E[0]),r),p=function(E,k,M,L){const R=L-M,B=E-M;return R===0?0:k===1?B/R:(Math.pow(k,B)-1)/(Math.pow(k,R)-1)}(r,a,s.stops[h][0],s.stops[h+1][0]),y=s.stops[h][1],b=s.stops[h+1][1];let v=xo[e.type]||Mu;if(s.colorSpace&&s.colorSpace!=="rgb"){const E=zc[s.colorSpace];v=(k,M)=>E.reverse(E.interpolate(E.forward(k),E.forward(M),p))}return typeof y.evaluate=="function"?{evaluate(...E){const k=y.evaluate.apply(void 0,E),M=b.evaluate.apply(void 0,E);if(k!==void 0&&M!==void 0)return v(k,M,p)}}:v(y,b,p)}function Iu(s,e,r){return e.type==="color"?r=ir.parse(r):e.type==="formatted"?r=ai.fromString(r.toString()):e.type==="resolvedImage"?r=Ni.fromString(r.toString()):fs(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ka(r,s.default,e.default)}class vl{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new jc,this._defaultValue=r?function(a){return a.type==="color"&&(jo(a.default)||Array.isArray(a.default))?new ir(0,0,0,0):a.type==="color"?ir.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,l,h,p,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,l,h,p,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Br(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Aa(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in wo}function Ma(s,e){const r=new kc(wo,[],e?function(l){const h={color:xi,string:os,number:Nt,enum:os,boolean:rs,formatted:ao,resolvedImage:Xn};return l.type==="array"?ji(h[l.value]||is,l.length):h[l.type]}(e):void 0),a=r.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Au(new vl(a,e)):ea(r.errors)}class $c{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!hn(r.expression)}evaluateWithoutErrorHandling(e,r,a,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,h,p)}evaluate(e,r,a,l,h,p){return this._styleExpression.evaluate(e,r,a,l,h,p)}}class No{constructor(e,r,a,l){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!hn(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,a,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,l,h,p)}evaluate(e,r,a,l,h,p){return this._styleExpression.evaluate(e,r,a,l,h,p)}interpolationFactor(e,r,a){return this.interpolationType?Zi.interpolationFactor(this.interpolationType,e,r,a):0}}function So(s,e){if((s=Ma(s,e)).result==="error")return s;const r=s.value.expression,a=Na(r);if(!a&&!Ca(e))return ea([new $i("","data expressions not supported")]);const l=Jn(r,["zoom","pitch","distance-from-center"]);if(!l&&!xl(e))return ea([new $i("","zoom expressions not supported")]);const h=jl(r);return h||l?h instanceof $i?ea([h]):h instanceof Zi&&!yl(e)?ea([new $i("",'"interpolate" expressions cannot be used with this property')]):Au(h?new No(a?"camera":"composite",s.value,h.labels,h instanceof Zi?h.interpolation:void 0):new $c(a?"constant":"source",s.value)):ea([new $i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class wl{constructor(e,r){this._parameters=e,this._specification=r,on(this,_l(this._parameters,this._specification))}static deserialize(e){return new wl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function jl(s){let e=null;if(s instanceof wu)e=jl(s.result);else if(s instanceof Fc){for(const r of s.args)if(e=jl(r),e)break}else(s instanceof Mc||s instanceof Zi)&&s.input instanceof dn&&s.input.name==="zoom"&&(e=s);return e instanceof $i||s.eachChild(r=>{const a=jl(r);a instanceof $i?e=a:!e&&a?e=new $i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new $i("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Tt{constructor(e,r,a,l){this.message=(e?`${e}: `:"")+a,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function zi(s){const e=s.key,r=s.value,a=s.valueSpec||{},l=s.objectElementValidators||{},h=s.style,p=s.styleSpec;let y=[];const b=fs(r);if(b!=="object")return[new Tt(e,r,`object expected, ${b} found`)];for(const v in r){const E=v.split(".")[0];let k;l[E]?k=l[E]:a[E]?k=Zr:l["*"]?k=l["*"]:a["*"]&&(k=Zr),k?y=y.concat(k({key:(e&&`${e}.`)+v,value:r[v],valueSpec:a[E]||a["*"],style:h,styleSpec:p,object:r,objectKey:v},r)):y.push(new Tt(e,r[v],`unknown property "${v}"`))}for(const v in a)l[v]||a[v].required&&a[v].default===void 0&&r[v]===void 0&&y.push(new Tt(e,r,`missing required property "${v}"`));return y}function Du(s){const e=s.value,r=s.valueSpec,a=s.style,l=s.styleSpec,h=s.key,p=s.arrayElementValidator||Zr;if(fs(e)!=="array")return[new Tt(h,e,`array expected, ${fs(e)} found`)];if(r.length&&e.length!==r.length)return[new Tt(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Tt(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(y.function=r.function),fs(r.value)==="object"&&(y=r.value);let b=[];for(let v=0;v<e.length;v++)b=b.concat(p({array:e,arrayIndex:v,value:e[v],valueSpec:y,style:a,styleSpec:l,key:`${h}[${v}]`}));return b}function To(s){const e=s.key,r=s.value,a=s.valueSpec;let l=fs(r);if(l==="number"&&r!=r&&(l="NaN"),l!=="number")return[new Tt(e,r,`number expected, ${l} found`)];if("minimum"in a){let h=a.minimum;if(fs(a.minimum)==="array"&&(h=a.minimum[s.arrayIndex]),r<h)return[new Tt(e,r,`${r} is less than the minimum value ${h}`)]}if("maximum"in a){let h=a.maximum;if(fs(a.maximum)==="array"&&(h=a.maximum[s.arrayIndex]),r>h)return[new Tt(e,r,`${r} is greater than the maximum value ${h}`)]}return[]}function Eo(s){const e=s.valueSpec,r=ur(s.value.type);let a,l,h,p={};const y=r!=="categorical"&&s.value.property===void 0,b=!y,v=fs(s.value.stops)==="array"&&fs(s.value.stops[0])==="array"&&fs(s.value.stops[0][0])==="object",E=zi({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new Tt(L.key,L.value,'identity function may not have a "stops" property')];let R=[];const B=L.value;return R=R.concat(Du({key:L.key,value:B,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:k})),fs(B)==="array"&&B.length===0&&R.push(new Tt(L.key,B,"array must have at least one stop")),R},default:function(L){return Zr({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&y&&E.push(new Tt(s.key,s.value,'missing required property "property"')),r==="identity"||s.value.stops||E.push(new Tt(s.key,s.value,'missing required property "stops"')),r==="exponential"&&s.valueSpec.expression&&!yl(s.valueSpec)&&E.push(new Tt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(b&&!Ca(s.valueSpec)?E.push(new Tt(s.key,s.value,"property functions not supported")):y&&!xl(s.valueSpec)&&E.push(new Tt(s.key,s.value,"zoom functions not supported"))),r!=="categorical"&&!v||s.value.property!==void 0||E.push(new Tt(s.key,s.value,'"property" property is required')),E;function k(L){let R=[];const B=L.value,X=L.key;if(fs(B)!=="array")return[new Tt(X,B,`array expected, ${fs(B)} found`)];if(B.length!==2)return[new Tt(X,B,`array length 2 expected, length ${B.length} found`)];if(v){if(fs(B[0])!=="object")return[new Tt(X,B,`object expected, ${fs(B[0])} found`)];if(B[0].zoom===void 0)return[new Tt(X,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new Tt(X,B,"object stop key must have value")];const re=ur(B[0].zoom);if(typeof re!="number")return[new Tt(X,B[0].zoom,"stop zoom values must be numbers")];if(h&&h>re)return[new Tt(X,B[0].zoom,"stop zoom values must appear in ascending order")];re!==h&&(h=re,l=void 0,p={}),R=R.concat(zi({key:`${X}[0]`,value:B[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:To,value:M}}))}else R=R.concat(M({key:`${X}[0]`,value:B[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},B));return Aa(Ar(B[1]))?R.concat([new Tt(`${X}[1]`,B[1],"expressions are not allowed in function stops.")]):R.concat(Zr({key:`${X}[1]`,value:B[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function M(L,R){const B=fs(L.value),X=ur(L.value),re=L.value!==null?L.value:R;if(a){if(B!==a)return[new Tt(L.key,re,`${B} stop domain type must match previous stop domain type ${a}`)]}else a=B;if(B!=="number"&&B!=="string"&&B!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new Tt(L.key,re,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&r!=="categorical"){let pe=`number expected, ${B} found`;return Ca(e)&&r===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tt(L.key,re,pe)]}return r!=="categorical"||B!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&B==="number"&&typeof X=="number"&&typeof l=="number"&&l!==void 0&&X<l?[new Tt(L.key,re,"stop domain values must appear in ascending order")]:(l=X,r==="categorical"&&X in p?[new Tt(L.key,re,"stop domain values must be unique")]:(p[X]=!0,[])):[new Tt(L.key,re,`integer expected, found ${String(X)}`)]}}function Mr(s){const e=(s.expressionContext==="property"?So:Ma)(Ar(s.value),s.valueSpec);if(e.result==="error")return e.value.map(a=>new Tt(`${s.key}${a.key}`,s.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!r.outputDefined())return[new Tt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!hn(r))return[new Tt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return Co(r,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Jn(r,["zoom","feature-state"]))return[new Tt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Na(r))return[new Tt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Co(s,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)r.delete(l);if(r.size===0)return[];const a=[];return s instanceof dn&&r.has(s.name)?[new Tt(e.key,e.value,`["${s.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(s.eachChild(l=>{a.push(...Co(l,e))}),a)}function Nl(s){const e=s.key,r=s.value,a=s.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(ur(r))===-1&&l.push(new Tt(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ur(r))===-1&&l.push(new Tt(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Gc(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Gc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Sl(s,e="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gc(s)||(s=Ia(s));const r=s;let a=!0;try{a=function(v){if(!Pa(v))return v;let E=Ar(v);return Tl(E),E=Lu(E),E}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=We[`filter_${e}`],h=Ma(a,l);let p=null;if(h.result==="error")throw new Error(h.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,E,k)=>h.value.evaluate(v,E,{},k);let y=null,b=null;if(a!==r){const v=Ma(r,l);if(v.result==="error")throw new Error(v.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,k,M,L,R)=>v.value.evaluate(E,k,{},M,void 0,void 0,L,R),b=!Na(v.value.expression)}return{filter:p,dynamicFilter:y||void 0,needGeometry:Ru(a),needFeature:!!b}}function Lu(s){if(!Array.isArray(s))return s;const e=function(r){if(Zc.has(r[0])){for(let a=1;a<r.length;a++)if(Pa(r[a]))return!0}return r}(s);return e===!0?e:e.map(r=>Lu(r))}function Tl(s){let e=!1;const r=[];if(s[0]==="case"){for(let a=1;a<s.length-1;a+=2)e=e||Pa(s[a]),r.push(s[a+1]);r.push(s[s.length-1])}else if(s[0]==="match"){e=e||Pa(s[1]);for(let a=2;a<s.length-1;a+=2)r.push(s[a+1]);r.push(s[s.length-1])}else if(s[0]==="step"){e=e||Pa(s[1]);for(let a=1;a<s.length-1;a+=2)r.push(s[a+1])}e&&(s.length=0,s.push("any",...r));for(let a=1;a<s.length;a++)Tl(s[a])}function Pa(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<s.length;r++)if(Pa(s[r]))return!0;return!1}const Zc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Pm(s,e){return s<e?-1:s>e?1:0}function Ru(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let e=1;e<s.length;e++)if(Ru(s[e]))return!0;return!1}function Ia(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Wc(s[1],s[2],"=="):e==="!="?El(Wc(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Wc(s[1],s[2],e):e==="any"?(r=s.slice(1),["any"].concat(r.map(Ia))):e==="all"?["all"].concat(s.slice(1).map(Ia)):e==="none"?["all"].concat(s.slice(1).map(Ia).map(El)):e==="in"?Hc(s[1],s.slice(2)):e==="!in"?El(Hc(s[1],s.slice(2))):e==="has"?Xc(s[1]):e==="!has"?El(Xc(s[1])):e!=="within"||s;var r}function Wc(s,e,r){switch(s){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,s,e]}}function Hc(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",s,["literal",e.sort(Pm)]]:["filter-in-small",s,["literal",e]]}}function Xc(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function El(s){return["!",s]}function ko(s){return Gc(Ar(s.value))?Mr(on({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Ao(s)}function Ao(s){const e=s.value,r=s.key;if(fs(e)!=="array")return[new Tt(r,e,`array expected, ${fs(e)} found`)];const a=s.styleSpec;let l,h=[];if(e.length<1)return[new Tt(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Nl({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:s.style,styleSpec:s.styleSpec})),ur(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ur(e[1])==="$type"&&h.push(new Tt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Tt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=fs(e[1]),l!=="string"&&h.push(new Tt(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=fs(e[p]),ur(e[1])==="$type"?h=h.concat(Nl({key:`${r}[${p}]`,value:e[p],valueSpec:a.geometry_type,style:s.style,styleSpec:s.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Tt(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Ao({key:`${r}[${p}]`,value:e[p],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":l=fs(e[1]),e.length!==2?h.push(new Tt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Tt(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=fs(e[1]),e.length!==2?h.push(new Tt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new Tt(`${r}[1]`,e[1],`object expected, ${l} found`))}return h}function Kc(s,e){const r=s.key,a=s.style,l=s.styleSpec,h=s.value,p=s.objectKey,y=l[`${e}_${s.layerType}`];if(!y)return[];const b=p.match(/^(.*)-transition$/);if(e==="paint"&&b&&y[b[1]]&&y[b[1]].transition)return Zr({key:r,value:h,valueSpec:l.transition,style:a,styleSpec:l});const v=s.valueSpec||y[p];if(!v)return[new Tt(r,h,`unknown property "${p}"`)];let E;if(fs(h)==="string"&&Ca(v)&&!v.tokens&&(E=/^{([^}]+)}$/.exec(h))){const M=`\`{ "type": "identity", "property": ${E?JSON.stringify(E[1]):'"_"'} }\``;return[new Tt(r,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: ${M}.`)]}const k=[];return s.layerType==="symbol"&&(p==="text-field"&&a&&!a.glyphs&&k.push(new Tt(r,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&jo(Ar(h))&&ur(h.type)==="identity"&&k.push(new Tt(r,h,'"text-font" does not support identity functions'))),k.concat(Zr({key:s.key,value:h,valueSpec:v,style:a,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function zu(s){return Kc(s,"paint")}function Qc(s){return Kc(s,"layout")}function Ou(s){let e=[];const r=s.value,a=s.key,l=s.style,h=s.styleSpec;r.type||r.ref||e.push(new Tt(a,r,'either "type" or "ref" is required'));let p=ur(r.type);const y=ur(r.ref);if(r.id){const b=ur(r.id);for(let v=0;v<s.arrayIndex;v++){const E=l.layers[v];ur(E.id)===b&&e.push(new Tt(a,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(v=>{v in r&&e.push(new Tt(a,r[v],`"${v}" is prohibited for ref layers`))}),l.layers.forEach(v=>{ur(v.id)===y&&(b=v)}),b?b.ref?e.push(new Tt(a,r.ref,"ref cannot reference another ref layer")):p=ur(b.type):typeof y=="string"&&e.push(new Tt(a,r.ref,`ref layer "${y}" not found`))}else if(p!=="background"&&p!=="sky")if(r.source){const b=l.sources&&l.sources[r.source],v=b&&ur(b.type);b?v==="vector"&&p==="raster"?e.push(new Tt(a,r.source,`layer "${r.id}" requires a raster source`)):v==="raster"&&p!=="raster"?e.push(new Tt(a,r.source,`layer "${r.id}" requires a vector source`)):v!=="vector"||r["source-layer"]?v==="raster-dem"&&p!=="hillshade"?e.push(new Tt(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||v==="geojson"&&b.lineMetrics||e.push(new Tt(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Tt(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Tt(a,r.source,`source "${r.source}" not found`))}else e.push(new Tt(a,r,'missing required property "source"'));return e=e.concat(zi({key:a,value:r,valueSpec:h.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Zr({key:`${a}.type`,value:r.type,valueSpec:h.layer.type,style:s.style,styleSpec:s.styleSpec,object:r,objectKey:"type"}),filter:b=>ko(on({layerType:p},b)),layout:b=>zi({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":v=>Qc(on({layerType:p},v))}}),paint:b=>zi({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":v=>zu(on({layerType:p},v))}})}})),e}function Pn(s){const e=s.value,r=s.key,a=fs(e);return a!=="string"?[new Tt(r,e,`string expected, ${a} found`)]:[]}const Fu={promoteId:function({key:s,value:e}){if(fs(e)==="string")return Pn({key:s,value:e});{const r=[];for(const a in e)r.push(...Pn({key:`${s}.${a}`,value:e[a]}));return r}}};function Bu(s){const e=s.value,r=s.key,a=s.styleSpec,l=s.style;if(!e.type)return[new Tt(r,e,'"type" is required')];const h=ur(e.type);let p;switch(h){case"vector":case"raster":case"raster-dem":return p=zi({key:r,value:e,valueSpec:a[`source_${h.replace("-","_")}`],style:s.style,styleSpec:a,objectElementValidators:Fu}),p;case"geojson":if(p=zi({key:r,value:e,valueSpec:a.source_geojson,style:l,styleSpec:a,objectElementValidators:Fu}),e.cluster)for(const y in e.clusterProperties){const[b,v]=e.clusterProperties[y],E=typeof b=="string"?[b,["accumulated"],["get",y]]:b;p.push(...Mr({key:`${r}.${y}.map`,value:v,expressionContext:"cluster-map"})),p.push(...Mr({key:`${r}.${y}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return p;case"video":return zi({key:r,value:e,valueSpec:a.source_video,style:l,styleSpec:a});case"image":return zi({key:r,value:e,valueSpec:a.source_image,style:l,styleSpec:a});case"canvas":return[new Tt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nl({key:`${r}.type`,value:e.type,valueSpec:{values:Im(a)},style:l,styleSpec:a})}}function Im(s){return s.source.reduce((e,r)=>{const a=s[r];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Uu(s){const e=s.value,r=s.styleSpec,a=r.light,l=s.style;let h=[];const p=fs(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Tt("light",e,`object expected, ${p} found`)]),h;for(const y in e){const b=y.match(/^(.*)-transition$/);h=h.concat(b&&a[b[1]]&&a[b[1]].transition?Zr({key:y,value:e[y],valueSpec:r.transition,style:l,styleSpec:r}):a[y]?Zr({key:y,value:e[y],valueSpec:a[y],style:l,styleSpec:r}):[new Tt(y,e[y],`unknown property "${y}"`)])}return h}function Jc(s){const e=s.value,r=s.key,a=s.style,l=s.styleSpec,h=l.terrain;let p=[];const y=fs(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new Tt("terrain",e,`object expected, ${y} found`)]),p;for(const b in e){const v=b.match(/^(.*)-transition$/);p=p.concat(v&&h[v[1]]&&h[v[1]].transition?Zr({key:b,value:e[b],valueSpec:l.transition,style:a,styleSpec:l}):h[b]?Zr({key:b,value:e[b],valueSpec:h[b],style:a,styleSpec:l}):[new Tt(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],v=b&&ur(b.type);b?v!=="raster-dem"&&p.push(new Tt(r,e.source,`terrain cannot be used with a source of type ${String(v)}, it only be used with a "raster-dem" source type`)):p.push(new Tt(r,e.source,`source "${e.source}" not found`))}else p.push(new Tt(r,e,'terrain is missing required property "source"'));return p}function Vu(s){const e=s.value,r=s.style,a=s.styleSpec,l=a.fog;let h=[];const p=fs(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Tt("fog",e,`object expected, ${p} found`)]),h;for(const y in e){const b=y.match(/^(.*)-transition$/);h=h.concat(b&&l[b[1]]&&l[b[1]].transition?Zr({key:y,value:e[y],valueSpec:a.transition,style:r,styleSpec:a}):l[y]?Zr({key:y,value:e[y],valueSpec:l[y],style:r,styleSpec:a}):[new Tt(y,e[y],`unknown property "${y}"`)])}return h}const qu={"*":()=>[],array:Du,boolean:function(s){const e=s.value,r=s.key,a=fs(e);return a!=="boolean"?[new Tt(r,e,`boolean expected, ${a} found`)]:[]},number:To,color:function(s){const e=s.key,r=s.value,a=fs(r);return a!=="string"?[new Tt(e,r,`color expected, ${a} found`)]:gc(r)===null?[new Tt(e,r,`color expected, "${r}" found`)]:[]},enum:Nl,filter:ko,function:Eo,layer:Ou,object:zi,source:Bu,light:Uu,terrain:Jc,fog:Vu,string:Pn,formatted:function(s){return Pn(s).length===0?[]:Mr(s)},resolvedImage:function(s){return Pn(s).length===0?[]:Mr(s)},projection:function(s){const e=s.value,r=s.styleSpec,a=r.projection,l=s.style;let h=[];const p=fs(e);if(p==="object")for(const y in e)h=h.concat(Zr({key:y,value:e[y],valueSpec:a[y],style:l,styleSpec:r}));else p!=="string"&&(h=h.concat([new Tt("projection",e,`object or string expected, ${p} found`)]));return h}};function Zr(s){const e=s.value,r=s.valueSpec,a=s.styleSpec;return r.expression&&jo(ur(e))?Eo(s):r.expression&&Aa(Ar(e))?Mr(s):r.type&&qu[r.type]?qu[r.type](s):zi(on({},s,{valueSpec:r.type?a[r.type]:r}))}function Dm(s){const e=s.value,r=s.key,a=Pn(s);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Tt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Tt(r,e,'"glyphs" url must include a "{range}" token'))),a}function $u(s,e=We){return Ti(Zr({key:"",value:s,valueSpec:e.$root,styleSpec:e,style:s,objectElementValidators:{glyphs:Dm,"*":()=>[]}}))}const Lm=s=>Ti(zu(s)),Rm=s=>Ti(Qc(s));function Ti(s){return s.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Gu(s,e){let r=!1;if(e&&e.length)for(const a of e)s.fire(new an(new Error(a.message))),r=!0;return r}var zm=Wi,Oi=3;function Wi(s,e,r){var a=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var l=new Int32Array(this.arrayBuffer);s=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var h=0;h<this.d*this.d;h++){var p=l[Oi+h],y=l[Oi+h+1];a.push(p===y?null:l.subarray(p,y))}var b=l[Oi+a.length+1];this.keys=l.subarray(l[Oi+a.length],b),this.bboxes=l.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var v=0;v<this.d*this.d;v++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=s,this.padding=r,this.scale=e/s,this.uid=0;var E=r/e*s;this.min=-E,this.max=s+E}Wi.prototype.insert=function(s,e,r,a,l){this._forEachCell(e,r,a,l,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l)},Wi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Wi.prototype._insertCell=function(s,e,r,a,l,h){this.cells[l].push(h)},Wi.prototype.query=function(s,e,r,a,l){var h=this.min,p=this.max;if(s<=h&&e<=h&&p<=r&&p<=a&&!l)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(s,e,r,a,this._queryCell,y,{},l),y},Wi.prototype._queryCell=function(s,e,r,a,l,h,p,y){var b=this.cells[l];if(b!==null)for(var v=this.keys,E=this.bboxes,k=0;k<b.length;k++){var M=b[k];if(p[M]===void 0){var L=4*M;(y?y(E[L+0],E[L+1],E[L+2],E[L+3]):s<=E[L+2]&&e<=E[L+3]&&r>=E[L+0]&&a>=E[L+1])?(p[M]=!0,h.push(v[M])):p[M]=!1}}},Wi.prototype._forEachCell=function(s,e,r,a,l,h,p,y){for(var b=this._convertToCellCoord(s),v=this._convertToCellCoord(e),E=this._convertToCellCoord(r),k=this._convertToCellCoord(a),M=b;M<=E;M++)for(var L=v;L<=k;L++){var R=this.d*L+M;if((!y||y(this._convertFromCellCoord(M),this._convertFromCellCoord(L),this._convertFromCellCoord(M+1),this._convertFromCellCoord(L+1)))&&l.call(this,s,e,r,a,R,h,p,y))return}},Wi.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Wi.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Wi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,e=Oi+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var h=e,p=0;p<s.length;p++){var y=s[p];l[Oi+p]=h,l.set(y,h),h+=y.length}return l[Oi+s.length]=h,l.set(this.keys,h),l[Oi+s.length+1]=h+=this.keys.length,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer};var ta=Ne(zm);const Cl={};function Et(s,e,r={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writeable:!1}),Cl[e]={klass:s,omit:r.omit||[]}}Et(Object,"Object"),ta.serialize=function(s,e){const r=s.toArrayBuffer();return e&&e.push(r),{buffer:r}},ta.deserialize=function(s){return new ta(s.buffer)},Object.defineProperty(ta,"name",{value:"Grid"}),Et(ta,"Grid"),Et(ir,"Color"),Et(Error,"Error"),Et(rr,"AJAXError"),Et(Ni,"ResolvedImage"),Et(wl,"StylePropertyFunction"),Et(vl,"StyleExpression",{omit:["_evaluator"]}),Et(No,"ZoomDependentExpression"),Et($c,"ZoomConstantExpression"),Et(dn,"CompoundExpression",{omit:["_evaluate"]});for(const s in wo)Cl[wo[s]._classRegistryKey]||Et(wo[s],`Expression${s}`);function Yc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function ed(s){return P.ImageBitmap&&s instanceof P.ImageBitmap}function Da(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Yc(s)||ed(s))return e&&e.push(s),s;if(ArrayBuffer.isView(s)){const r=s;return e&&e.push(r.buffer),r}if(s instanceof P.ImageData)return e&&e.push(s.data.buffer),s;if(Array.isArray(s)){const r=[];for(const a of s)r.push(Da(a,e));return r}if(typeof s=="object"){const r=s.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const l=r.serialize?r.serialize(s,e):{};if(!r.serialize){for(const h in s)s.hasOwnProperty(h)&&(Cl[a].omit.indexOf(h)>=0||(l[h]=Da(s[h],e)));s instanceof Error&&(l.message=s.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(l.$name=a),l}throw new Error("can't serialize object of type "+typeof s)}function sa(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Yc(s)||ed(s)||ArrayBuffer.isView(s)||s instanceof P.ImageData)return s;if(Array.isArray(s))return s.map(sa);if(typeof s=="object"){const e=s.$name||"Object",{klass:r}=Cl[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(s);const a=Object.create(r.prototype);for(const l of Object.keys(s))l!=="$name"&&(a[l]=sa(s[l]));return a}throw new Error("can't deserialize object of type "+typeof s)}const jt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function td(s){for(const e of s)if(sd(e.charCodeAt(0)))return!0;return!1}function Om(s){for(const e of s)if(!Zu(e.charCodeAt(0)))return!1;return!0}function Zu(s){return!(jt.Arabic(s)||jt["Arabic Supplement"](s)||jt["Arabic Extended-A"](s)||jt["Arabic Presentation Forms-A"](s)||jt["Arabic Presentation Forms-B"](s))}function sd(s){return!(s!==746&&s!==747&&(s<4352||!(jt["Bopomofo Extended"](s)||jt.Bopomofo(s)||jt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||jt["CJK Compatibility Ideographs"](s)||jt["CJK Compatibility"](s)||jt["CJK Radicals Supplement"](s)||jt["CJK Strokes"](s)||!(!jt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||jt["CJK Unified Ideographs Extension A"](s)||jt["CJK Unified Ideographs"](s)||jt["Enclosed CJK Letters and Months"](s)||jt["Hangul Compatibility Jamo"](s)||jt["Hangul Jamo Extended-A"](s)||jt["Hangul Jamo Extended-B"](s)||jt["Hangul Jamo"](s)||jt["Hangul Syllables"](s)||jt.Hiragana(s)||jt["Ideographic Description Characters"](s)||jt.Kanbun(s)||jt["Kangxi Radicals"](s)||jt["Katakana Phonetic Extensions"](s)||jt.Katakana(s)&&s!==12540||!(!jt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!jt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||jt["Unified Canadian Aboriginal Syllabics"](s)||jt["Unified Canadian Aboriginal Syllabics Extended"](s)||jt["Vertical Forms"](s)||jt["Yijing Hexagram Symbols"](s)||jt["Yi Syllables"](s)||jt["Yi Radicals"](s))))}function Wu(s){return!(sd(s)||function(e){return!!(jt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||jt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||jt["Letterlike Symbols"](e)||jt["Number Forms"](e)||jt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||jt["Control Pictures"](e)&&e!==9251||jt["Optical Character Recognition"](e)||jt["Enclosed Alphanumerics"](e)||jt["Geometric Shapes"](e)||jt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||jt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||jt["CJK Symbols and Punctuation"](e)||jt.Katakana(e)||jt["Private Use Area"](e)||jt["CJK Compatibility Forms"](e)||jt["Small Form Variants"](e)||jt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Hu(s){return s>=1424&&s<=2303||jt["Arabic Presentation Forms-A"](s)||jt["Arabic Presentation Forms-B"](s)}function Fm(s,e){return!(!e&&Hu(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||jt.Khmer(s))}function Bm(s){for(const e of s)if(Hu(e.charCodeAt(0)))return!0;return!1}const rd="deferred",id="loading",nd="loaded";let La=null,u="unavailable",i=null;const o=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(u="error"),La&&La(s)};function m(){x.fire(new Hn("pluginStateChange",{pluginStatus:u,pluginURL:i}))}const x=new no,_=function(){return u},j=function(){if(u!==rd||!i)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");u=id,m(),i&&Qr({url:i},s=>{s?o(s):(u=nd,m())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>u===nd||S.applyArabicShaping!=null,isLoading:()=>u===id,setState(s){u=s.pluginStatus,i=s.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>i};class C{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,a){for(const l of r)if(!Fm(l.charCodeAt(0),a))return!1;return!0}(e,S.isLoaded())}}class D{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,l){if(jo(a))return new wl(a,l);if(Aa(a)){const h=So(a,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=a;return typeof a=="string"&&l.type==="color"&&(h=ir.parse(a)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class I{constructor(e){this.property=e,this.value=new D(e,void 0)}transitioned(e,r){return new Z(this.property,this.value,r,js({},e.transition,this.transition),e.now)}untransitioned(){return new Z(this.property,this.value,null,{},0)}}class O{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return vr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].value=new D(this._values[e].property,r===null?void 0:vr(r))}getTransition(e){return vr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].transition=vr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const a=new Q(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(e,r._values[l]);return a}untransitioned(){const e=new Q(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Z{constructor(e,r,a,l,h){const p=l.delay||0,y=l.duration||0;h=h||0,this.property=e,this.value=r,this.begin=h+p,this.end=this.begin+y,e.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const l=e.now||0,h=this.value.possiblyEvaluate(e,r,a),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,r,a);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,a),h,St(y))}}return h}}class Q{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const l=new se(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,a);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return vr(this._values[e].value)}setValue(e,r){this._values[e]=new D(this._values[e].property,r===null?void 0:vr(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const l=new se(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,a);return l}}class Y{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,l){return this.property.evaluate(this.value,this.parameters,e,r,a,l)}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class F{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const l=xo[this.specification.type];return l?l(e,r,a):e}}class K{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,l){return new Y(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,l)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Y(this,{kind:"constant",value:void 0},e.parameters);const l=xo[this.specification.type];return l?new Y(this,{kind:"constant",value:l(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,l,h,p){return e.kind==="constant"?e.value:e.evaluate(r,a,l,h,p)}}class ae{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,l){return!!e.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class le{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new C(0,{});for(const a in e){const l=e[a];l.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new D(l,void 0),p=this.defaultTransitionablePropertyValues[a]=new I(l);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate(r)}}}function _e(s,e){return 256*(s=mt(Math.floor(s),0,255))+mt(Math.floor(e),0,255)}Et(K,"DataDrivenProperty"),Et(F,"DataConstantProperty"),Et(ae,"ColorRampProperty");const ve={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class be{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ae{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ce(s,e=1){let r=0,a=0;return{members:s.map(l=>{const h=ve[l.type].BYTES_PER_ELEMENT,p=r=Oe(r,Math.max(e,h)),y=l.components||1;return a=Math.max(a,h),r+=h*y,{name:l.name,type:l.type,components:y,offset:p}}),size:Oe(r,Math.max(a,e)),alignment:e}}function Oe(s,e){return Math.ceil(s/e)*e}class at extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=a,e}}at.prototype.bytesPerElement=4,Et(at,"StructArrayLayout2i4");class Le extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=a,this.int16[h+2]=l,e}}Le.prototype.bytesPerElement=6,Et(Le,"StructArrayLayout3i6");class Qe extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=l,this.int16[p+3]=h,e}}Qe.prototype.bytesPerElement=8,Et(Qe,"StructArrayLayout4i8");class Ue extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,l,h,p,y)}emplace(e,r,a,l,h,p,y,b){const v=6*e,E=12*e,k=3*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.uint8[E+4]=l,this.uint8[E+5]=h,this.uint8[E+6]=p,this.uint8[E+7]=y,this.float32[k+2]=b,e}}Ue.prototype.bytesPerElement=12,Et(Ue,"StructArrayLayout2i4ub1f12");class nt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=l,this.float32[p+3]=h,e}}nt.prototype.bytesPerElement=16,Et(nt,"StructArrayLayout4f16");class ze extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=6*e,b=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=a,this.uint16[y+2]=l,this.uint16[y+3]=h,this.float32[b+2]=p,e}}ze.prototype.bytesPerElement=12,Et(ze,"StructArrayLayout4ui1f12");class Xe extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=4*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=l,this.uint16[p+3]=h,e}}Xe.prototype.bytesPerElement=8,Et(Xe,"StructArrayLayout4ui8");class ct extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,l,h,p)}emplace(e,r,a,l,h,p,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+3]=h,this.int16[b+4]=p,this.int16[b+5]=y,e}}ct.prototype.bytesPerElement=12,Et(ct,"StructArrayLayout6i12");class tt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,v,E,k,M){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,l,h,p,y,b,v,E,k,M)}emplace(e,r,a,l,h,p,y,b,v,E,k,M,L){const R=12*e;return this.int16[R+0]=r,this.int16[R+1]=a,this.int16[R+2]=l,this.int16[R+3]=h,this.uint16[R+4]=p,this.uint16[R+5]=y,this.uint16[R+6]=b,this.uint16[R+7]=v,this.int16[R+8]=E,this.int16[R+9]=k,this.int16[R+10]=M,this.int16[R+11]=L,e}}tt.prototype.bytesPerElement=24,Et(tt,"StructArrayLayout4i4ui4i24");class dt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,l,h,p)}emplace(e,r,a,l,h,p,y){const b=10*e,v=5*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=l,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=y,e}}dt.prototype.bytesPerElement=20,Et(dt,"StructArrayLayout3i3f20");class Dt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Dt.prototype.bytesPerElement=4,Et(Dt,"StructArrayLayout1ul4");class Vt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,v,E,k,M,L){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,a,l,h,p,y,b,v,E,k,M,L)}emplace(e,r,a,l,h,p,y,b,v,E,k,M,L,R){const B=20*e,X=10*e;return this.int16[B+0]=r,this.int16[B+1]=a,this.int16[B+2]=l,this.int16[B+3]=h,this.int16[B+4]=p,this.float32[X+3]=y,this.float32[X+4]=b,this.float32[X+5]=v,this.float32[X+6]=E,this.int16[B+14]=k,this.uint32[X+8]=M,this.uint16[B+18]=L,this.uint16[B+19]=R,e}}Vt.prototype.bytesPerElement=40,Et(Vt,"StructArrayLayout5i4f1i1ul2ui40");class kt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,l,h,p,y)}emplace(e,r,a,l,h,p,y,b){const v=8*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=l,this.int16[v+4]=h,this.int16[v+5]=p,this.int16[v+6]=y,this.int16[v+7]=b,e}}kt.prototype.bytesPerElement=16,Et(kt,"StructArrayLayout3i2i2i16");class Ft extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=l,this.int16[b+6]=h,this.int16[b+7]=p,e}}Ft.prototype.bytesPerElement=16,Et(Ft,"StructArrayLayout2f1f2i16");class ns extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=12*e,y=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=a,this.float32[y+1]=l,this.float32[y+2]=h,e}}ns.prototype.bytesPerElement=12,Et(ns,"StructArrayLayout2ub2f12");class es extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=a,this.float32[h+2]=l,e}}es.prototype.bytesPerElement=12,Et(es,"StructArrayLayout3f12");class It extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a)}emplace(e,r,a,l){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=a,this.uint16[h+2]=l,e}}It.prototype.bytesPerElement=6,Et(It,"StructArrayLayout3ui6");class ws extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,v,E,k,M,L,R,B,X,re,pe,ie,ue,xe){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,r,a,l,h,p,y,b,v,E,k,M,L,R,B,X,re,pe,ie,ue,xe)}emplace(e,r,a,l,h,p,y,b,v,E,k,M,L,R,B,X,re,pe,ie,ue,xe,ge){const Fe=30*e,Re=15*e,He=60*e;return this.int16[Fe+0]=r,this.int16[Fe+1]=a,this.int16[Fe+2]=l,this.float32[Re+2]=h,this.float32[Re+3]=p,this.uint16[Fe+8]=y,this.uint16[Fe+9]=b,this.uint32[Re+5]=v,this.uint32[Re+6]=E,this.uint32[Re+7]=k,this.uint16[Fe+16]=M,this.uint16[Fe+17]=L,this.uint16[Fe+18]=R,this.float32[Re+10]=B,this.float32[Re+11]=X,this.uint8[He+48]=re,this.uint8[He+49]=pe,this.uint8[He+50]=ie,this.uint32[Re+13]=ue,this.int16[Fe+28]=xe,this.uint8[He+58]=ge,e}}ws.prototype.bytesPerElement=60,Et(ws,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ss extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h,p,y,b,v,E,k,M,L,R,B,X,re,pe,ie,ue,xe,ge,Fe,Re,He,ot,Ve,Je,Ye,rt){const ht=this.length;return this.resize(ht+1),this.emplace(ht,e,r,a,l,h,p,y,b,v,E,k,M,L,R,B,X,re,pe,ie,ue,xe,ge,Fe,Re,He,ot,Ve,Je,Ye,rt)}emplace(e,r,a,l,h,p,y,b,v,E,k,M,L,R,B,X,re,pe,ie,ue,xe,ge,Fe,Re,He,ot,Ve,Je,Ye,rt,ht){const Ze=38*e,bt=19*e;return this.int16[Ze+0]=r,this.int16[Ze+1]=a,this.int16[Ze+2]=l,this.float32[bt+2]=h,this.float32[bt+3]=p,this.int16[Ze+8]=y,this.int16[Ze+9]=b,this.int16[Ze+10]=v,this.int16[Ze+11]=E,this.int16[Ze+12]=k,this.int16[Ze+13]=M,this.uint16[Ze+14]=L,this.uint16[Ze+15]=R,this.uint16[Ze+16]=B,this.uint16[Ze+17]=X,this.uint16[Ze+18]=re,this.uint16[Ze+19]=pe,this.uint16[Ze+20]=ie,this.uint16[Ze+21]=ue,this.uint16[Ze+22]=xe,this.uint16[Ze+23]=ge,this.uint16[Ze+24]=Fe,this.uint16[Ze+25]=Re,this.uint16[Ze+26]=He,this.uint16[Ze+27]=ot,this.uint16[Ze+28]=Ve,this.uint32[bt+15]=Je,this.float32[bt+16]=Ye,this.float32[bt+17]=rt,this.float32[bt+18]=ht,e}}Ss.prototype.bytesPerElement=76,Et(Ss,"StructArrayLayout3i2f6i15ui1ul3f76");class Ts extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Ts.prototype.bytesPerElement=4,Et(Ts,"StructArrayLayout1f4");class Es extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,l,h)}emplace(e,r,a,l,h,p){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=l,this.float32[y+3]=h,this.float32[y+4]=p,e}}Es.prototype.bytesPerElement=20,Et(Es,"StructArrayLayout5f20");class Wr extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a,l)}emplace(e,r,a,l,h){const p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=l,this.uint16[p+4]=h,e}}Wr.prototype.bytesPerElement=12,Et(Wr,"StructArrayLayout1ul3ui12");class Pr extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=a,e}}Pr.prototype.bytesPerElement=4,Et(Pr,"StructArrayLayout2ui4");class Ei extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Ei.prototype.bytesPerElement=2,Et(Ei,"StructArrayLayout1ui2");class Hi extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=a,e}}Hi.prototype.bytesPerElement=8,Et(Hi,"StructArrayLayout2f8");class $s extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$s.prototype.size=40;class Cs extends Vt{get(e){return new $s(this,e)}}Et(Cs,"CollisionBoxArray");class xs extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xs.prototype.size=60;class hr extends ws{get(e){return new xs(this,e)}}Et(hr,"PlacedSymbolArray");class Yr extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Yr.prototype.size=76;class Us extends Ss{get(e){return new Yr(this,e)}}Et(Us,"SymbolInstanceArray");class oi extends Ts{getoffsetX(e){return this.float32[1*e+0]}}Et(oi,"GlyphOffsetArray");class kl extends at{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Et(kl,"SymbolLineVertexArray");class ra extends be{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ra.prototype.size=12;class Mo extends Wr{get(e){return new ra(this,e)}}Et(Mo,"FeatureIndexArray");class fn extends Pr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Et(fn,"FillExtrusionCentroidArray");const In=Ce([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ia=Ce([{name:"a_dash",components:4,type:"Uint16"}]);var Al={exports:{}},Po={exports:{}};Po.exports=function(s,e){var r,a,l,h,p,y,b,v;for(a=s.length-(r=3&s.length),l=e,p=3432918353,y=461845907,v=0;v<a;)b=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24,++v,l=27492+(65535&(h=5*(65535&(l=(l^=b=(65535&(b=(b=(65535&b)*p+(((b>>>16)*p&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&s.charCodeAt(v+2))<<16;case 2:b^=(255&s.charCodeAt(v+1))<<8;case 1:l^=b=(65535&(b=(b=(65535&(b^=255&s.charCodeAt(v)))*p+(((b>>>16)*p&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return l^=s.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var ad=Po.exports,rg={exports:{}};rg.exports=function(s,e){for(var r,a=s.length,l=e^a,h=0;a>=4;)r=1540483477*(65535&(r=255&s.charCodeAt(h)|(255&s.charCodeAt(++h))<<8|(255&s.charCodeAt(++h))<<16|(255&s.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++h;switch(a){case 3:l^=(255&s.charCodeAt(h+2))<<16;case 2:l^=(255&s.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&s.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var ig=ad,Fb=rg.exports;Al.exports=ig,Al.exports.murmur3=ig,Al.exports.murmur2=Fb;var Um=Ne(Al.exports);class Xu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,l){this.ids.push(ng(e)),this.positions.push(r,a,l)}getPositions(e){const r=ng(e);let a=0,l=this.ids.length-1;for(;a<l;){const p=a+l>>1;this.ids[p]>=r?l=p:a=p+1}const h=[];for(;this.ids[a]===r;)h.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return h}static serialize(e,r){const a=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Vm(a,l,0,a.length-1),r&&r.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(e){const r=new Xu;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ng(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Um(String(s))}function Vm(s,e,r,a){for(;r<a;){const l=s[r+a>>1];let h=r-1,p=a+1;for(;;){do h++;while(s[h]<l);do p--;while(s[p]>l);if(h>=p)break;Ku(s,h,p),Ku(e,3*h,3*p),Ku(e,3*h+1,3*p+1),Ku(e,3*h+2,3*p+2)}p-r<a-p?(Vm(s,e,r,p),r=p+1):(Vm(s,e,p+1,a),a=p)}}function Ku(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}Et(Xu,"FeaturePositionMap");class na{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class Qu extends na{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ag extends na{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class og extends na{constructor(e){super(e),this.current=ir.transparent}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Bb=new Float32Array(16),Ub=new Float32Array(9),Vb=new Float32Array(4);function qm(s){return[_e(255*s.r,255*s.g),_e(255*s.b,255*s.a)]}class od{constructor(e,r,a){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(e,r,a,l,h){r.set(e,h,l.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new og(e):new Qu(e)}}class Ml{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,l,h){const p=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;p&&r.set(e,h,p)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new ag(e):new Qu(e)}}class aa{constructor(e,r,a,l){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,a,l,h,p){const y=this.paintVertexArray.length,b=this.expression.evaluate(new C(0),r,{},h,l,p);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,a,l,h){const p=this.expression.evaluate({zoom:0},a,l,void 0,h);this._setPaintValue(e,r,p)}_setPaintValue(e,r,a){if(this.type==="color"){const l=qm(a);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class gn{constructor(e,r,a,l,h,p){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,a,l,h,p){const y=this.expression.evaluate(new C(this.zoom),r,{},h,l,p),b=this.expression.evaluate(new C(this.zoom+1),r,{},h,l,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,y,b)}updatePaintArray(e,r,a,l,h){const p=this.expression.evaluate({zoom:this.zoom},a,l,void 0,h),y=this.expression.evaluate({zoom:this.zoom+1},a,l,void 0,h);this._setPaintValue(e,r,p,y)}_setPaintValue(e,r,a,l){if(this.type==="color"){const h=qm(a),p=qm(l);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,l,h){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=mt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(e,h,y)}getBinding(e,r){return new Qu(e)}}class Ra{constructor(e,r,a,l,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(a==="array"?ia:In).members;for(let p=0;p<r.length;++p);this.paintVertexArray=new l}populatePaintArray(e,r,a){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,l,h,p){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,r,a,l){if(!l||!a)return;const h=l[a];if(!h)return;const{tl:p,br:y,pixelRatio:b}=h;for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,p[0],p[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class za{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!a(h))continue;const p=e.paint.get(h);if(!(p instanceof Y&&Ca(p.property.specification)))continue;const y=$b(h,e.type),b=p.value,v=p.property.specification.type,E=!!p.property.useIntegerZoom,k=h==="line-dasharray"||h.endsWith("pattern"),M=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||M)if(b.kind==="source"||M||k){const L=lg(h,v,"source");this.binders[h]=k?new Ra(b,y,v,L,e.id):new aa(b,y,v,L),l.push(`/a_${h}`)}else{const L=lg(h,v,"composite");this.binders[h]=new gn(b,y,v,E,r,L),l.push(`/z_${h}`)}else this.binders[h]=k?new Ml(b.value,y):new od(b.value,y,v),l.push(`/u_${h}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof aa||r instanceof gn?r.maxValue:0}populatePaintArrays(e,r,a,l,h,p){for(const y in this.binders){const b=this.binders[y];(b instanceof aa||b instanceof gn||b instanceof Ra)&&b.populatePaintArray(e,r,a,l,h,p)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof Ml&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,l,h,p){let y=!1;for(const b in e){const v=r.getPositions(b);for(const E of v){const k=a.feature(E.index);for(const M in this.binders){const L=this.binders[M];if((L instanceof aa||L instanceof gn||L instanceof Ra)&&L.expression.isStateDependent===!0){const R=l.paint.get(M);L.expression=R.value,L.updatePaintArray(E.start,E.end,k,e[b],h,p),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof od||a instanceof Ml)&&e.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof aa||a instanceof gn||a instanceof Ra)for(let l=0;l<a.paintVertexAttributes.length;l++)e.push(a.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof od||a instanceof Ml||a instanceof gn)for(const l of a.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof od||l instanceof Ml||l instanceof gn)for(const h of l.uniformNames)r.push({name:h,property:a,binding:l.getBinding(e,h)})}return r}setUniforms(e,r,a,l,h){for(const{name:p,property:y,binding:b}of a)this.binders[y].setUniform(e,b,h,l.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof aa||r instanceof gn||r instanceof Ra)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof aa||a instanceof gn||a instanceof Ra)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof aa||r instanceof gn||r instanceof Ra)&&r.destroy()}}}class Io{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new za(l,r,a);this.needsUpload=!1,this._featureMap=new Xu,this._bufferOffset=0}populatePaintArrays(e,r,a,l,h,p,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,l,h,p,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,l,h){for(const p of a)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,l,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function $b(s,e){return qb[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const Gb={"line-pattern":{source:ze,composite:ze},"fill-pattern":{source:ze,composite:ze},"fill-extrusion-pattern":{source:ze,composite:ze},"line-dasharray":{source:Xe,composite:Xe}},Zb={color:{source:Hi,composite:nt},number:{source:Ts,composite:Hi}};function lg(s,e,r){const a=Gb[s];return a&&a[r]||Zb[e][r]}Et(od,"ConstantBinder"),Et(Ml,"PatternConstantBinder"),Et(aa,"SourceExpressionBinder"),Et(Ra,"PatternCompositeBinder"),Et(gn,"CompositeExpressionBinder"),Et(za,"ProgramConfiguration",{omit:["_buffers"]}),Et(Io,"ProgramConfigurationSet");const cg="-transition";class xn extends no{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ee(r.layout)),r.paint)){this._transitionablePaint=new O(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Rm,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Li(e,cg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Lm,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(Li(e,cg))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.value.isDataDriven(),p=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,b=y.isDataDriven(),v=Li(e,"pattern")||e==="line-dasharray";return b||h||v||this._handleOverridablePaintPropertyUpdate(e,p,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),gi(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,l,h={}){return(!h||h.validate!==!1)&&Gu(this,e.call($u,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:We,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Y&&Ca(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wb=Ce([{name:"a_pos",components:2,type:"Int16"}],4),Hb=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mr{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,l){let h=this.segments[this.segments.length-1];return e>mr.MAX_VERTEX_ARRAY_LENGTH&&Ds(`Max vertices per segment is ${mr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>mr.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,l){return new mr([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et(mr,"SegmentVector");var zt=8192;class Oa{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ks?new ks(e.lng,e.lat):ks.convert(e),this}setSouthWest(e){return this._sw=e instanceof ks?new ks(e.lng,e.lat):ks.convert(e),this}extend(e){const r=this._sw,a=this._ne;let l,h;if(e instanceof ks)l=e,h=e;else{if(!(e instanceof Oa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Oa.convert(e)):this.extend(ks.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ks.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return r||a?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new ks(l.lng,l.lat),this._ne=new ks(h.lng,h.lat)),this}getCenter(){return new ks((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ks(this.getWest(),this.getNorth())}getSouthEast(){return new ks(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=ks.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return!e||e instanceof Oa?e:new Oa(e)}}var Ju=1e-6,Ci=typeof Float32Array<"u"?Float32Array:Array;function dg(){var s=new Ci(9);return Ci!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function ug(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],v=e[6],E=e[7],k=e[8],M=r[0],L=r[1],R=r[2],B=r[3],X=r[4],re=r[5],pe=r[6],ie=r[7],ue=r[8];return s[0]=M*a+L*p+R*v,s[1]=M*l+L*y+R*E,s[2]=M*h+L*b+R*k,s[3]=B*a+X*p+re*v,s[4]=B*l+X*y+re*E,s[5]=B*h+X*b+re*k,s[6]=pe*a+ie*p+ue*v,s[7]=pe*l+ie*y+ue*E,s[8]=pe*h+ie*b+ue*k,s}function yn(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function $m(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=e[4],y=e[5],b=e[6],v=e[7],E=e[8],k=e[9],M=e[10],L=e[11],R=e[12],B=e[13],X=e[14],re=e[15],pe=r*y-a*p,ie=r*b-l*p,ue=r*v-h*p,xe=a*b-l*y,ge=a*v-h*y,Fe=l*v-h*b,Re=E*B-k*R,He=E*X-M*R,ot=E*re-L*R,Ve=k*X-M*B,Je=k*re-L*B,Ye=M*re-L*X,rt=pe*Ye-ie*Je+ue*Ve+xe*ot-ge*He+Fe*Re;return rt?(s[0]=(y*Ye-b*Je+v*Ve)*(rt=1/rt),s[1]=(l*Je-a*Ye-h*Ve)*rt,s[2]=(B*Fe-X*ge+re*xe)*rt,s[3]=(M*ge-k*Fe-L*xe)*rt,s[4]=(b*ot-p*Ye-v*He)*rt,s[5]=(r*Ye-l*ot+h*He)*rt,s[6]=(X*ue-R*Fe-re*ie)*rt,s[7]=(E*Fe-M*ue+L*ie)*rt,s[8]=(p*Je-y*ot+v*Re)*rt,s[9]=(a*ot-r*Je-h*Re)*rt,s[10]=(R*ge-B*ue+re*pe)*rt,s[11]=(k*ue-E*ge-L*pe)*rt,s[12]=(y*He-p*Ve-b*Re)*rt,s[13]=(r*Ve-a*He+l*Re)*rt,s[14]=(B*ie-R*xe-X*pe)*rt,s[15]=(E*xe-k*ie+M*pe)*rt,s):null}function Do(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],v=e[6],E=e[7],k=e[8],M=e[9],L=e[10],R=e[11],B=e[12],X=e[13],re=e[14],pe=e[15],ie=r[0],ue=r[1],xe=r[2],ge=r[3];return s[0]=ie*a+ue*y+xe*k+ge*B,s[1]=ie*l+ue*b+xe*M+ge*X,s[2]=ie*h+ue*v+xe*L+ge*re,s[3]=ie*p+ue*E+xe*R+ge*pe,s[4]=(ie=r[4])*a+(ue=r[5])*y+(xe=r[6])*k+(ge=r[7])*B,s[5]=ie*l+ue*b+xe*M+ge*X,s[6]=ie*h+ue*v+xe*L+ge*re,s[7]=ie*p+ue*E+xe*R+ge*pe,s[8]=(ie=r[8])*a+(ue=r[9])*y+(xe=r[10])*k+(ge=r[11])*B,s[9]=ie*l+ue*b+xe*M+ge*X,s[10]=ie*h+ue*v+xe*L+ge*re,s[11]=ie*p+ue*E+xe*R+ge*pe,s[12]=(ie=r[12])*a+(ue=r[13])*y+(xe=r[14])*k+(ge=r[15])*B,s[13]=ie*l+ue*b+xe*M+ge*X,s[14]=ie*h+ue*v+xe*L+ge*re,s[15]=ie*p+ue*E+xe*R+ge*pe,s}function ld(s,e,r){var a,l,h,p,y,b,v,E,k,M,L,R,B=r[0],X=r[1],re=r[2];return e===s?(s[12]=e[0]*B+e[4]*X+e[8]*re+e[12],s[13]=e[1]*B+e[5]*X+e[9]*re+e[13],s[14]=e[2]*B+e[6]*X+e[10]*re+e[14],s[15]=e[3]*B+e[7]*X+e[11]*re+e[15]):(l=e[1],h=e[2],p=e[3],y=e[4],b=e[5],v=e[6],E=e[7],k=e[8],M=e[9],L=e[10],R=e[11],s[0]=a=e[0],s[1]=l,s[2]=h,s[3]=p,s[4]=y,s[5]=b,s[6]=v,s[7]=E,s[8]=k,s[9]=M,s[10]=L,s[11]=R,s[12]=a*B+y*X+k*re+e[12],s[13]=l*B+b*X+M*re+e[13],s[14]=h*B+v*X+L*re+e[14],s[15]=p*B+E*X+R*re+e[15]),s}function Lo(s,e,r){var a=r[0],l=r[1],h=r[2];return s[0]=e[0]*a,s[1]=e[1]*a,s[2]=e[2]*a,s[3]=e[3]*a,s[4]=e[4]*l,s[5]=e[5]*l,s[6]=e[6]*l,s[7]=e[7]*l,s[8]=e[8]*h,s[9]=e[9]*h,s[10]=e[10]*h,s[11]=e[11]*h,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function Gm(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[4],p=e[5],y=e[6],b=e[7],v=e[8],E=e[9],k=e[10],M=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=h*l+v*a,s[5]=p*l+E*a,s[6]=y*l+k*a,s[7]=b*l+M*a,s[8]=v*l-h*a,s[9]=E*l-p*a,s[10]=k*l-y*a,s[11]=M*l-b*a,s}function Yu(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],y=e[2],b=e[3],v=e[8],E=e[9],k=e[10],M=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=h*l-v*a,s[1]=p*l-E*a,s[2]=y*l-k*a,s[3]=b*l-M*a,s[8]=h*a+v*l,s[9]=p*a+E*l,s[10]=y*a+k*l,s[11]=b*a+M*l,s}function hg(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function mg(s,e,r){var a,l,h,p=r[0],y=r[1],b=r[2],v=Math.hypot(p,y,b);return v<Ju?null:(p*=v=1/v,y*=v,b*=v,a=Math.sin(e),l=Math.cos(e),s[0]=p*p*(h=1-l)+l,s[1]=y*p*h+b*a,s[2]=b*p*h-y*a,s[3]=0,s[4]=p*y*h-b*a,s[5]=y*y*h+l,s[6]=b*y*h+p*a,s[7]=0,s[8]=p*b*h+y*a,s[9]=y*b*h-p*a,s[10]=b*b*h+l,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});var Xb=Do;function Zm(){var s=new Ci(3);return Ci!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function pg(s){var e=new Ci(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function cd(s){return Math.hypot(s[0],s[1],s[2])}function Pl(s,e,r){var a=new Ci(3);return a[0]=s,a[1]=e,a[2]=r,a}function oa(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s[2]=e[2]+r[2],s}function Wm(s,e,r){return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],s}function fg(s,e,r){return s[0]=e[0]*r[0],s[1]=e[1]*r[1],s[2]=e[2]*r[2],s}function dd(s,e,r){return s[0]=Math.min(e[0],r[0]),s[1]=Math.min(e[1],r[1]),s[2]=Math.min(e[2],r[2]),s}function ud(s,e,r){return s[0]=Math.max(e[0],r[0]),s[1]=Math.max(e[1],r[1]),s[2]=Math.max(e[2],r[2]),s}function Fi(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s}function hd(s,e,r,a){return s[0]=e[0]+r[0]*a,s[1]=e[1]+r[1]*a,s[2]=e[2]+r[2]*a,s}function li(s,e){var r=e[0],a=e[1],l=e[2],h=r*r+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),s[0]=e[0]*h,s[1]=e[1]*h,s[2]=e[2]*h,s}function Xi(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Hm(s,e,r){var a=e[0],l=e[1],h=e[2],p=r[0],y=r[1],b=r[2];return s[0]=l*b-h*y,s[1]=h*p-a*b,s[2]=a*y-l*p,s}function nr(s,e,r){var a=e[0],l=e[1],h=e[2],p=r[3]*a+r[7]*l+r[11]*h+r[15];return s[0]=(r[0]*a+r[4]*l+r[8]*h+r[12])/(p=p||1),s[1]=(r[1]*a+r[5]*l+r[9]*h+r[13])/p,s[2]=(r[2]*a+r[6]*l+r[10]*h+r[14])/p,s}function gg(s,e,r){var a=r[0],l=r[1],h=r[2],p=e[0],y=e[1],b=e[2],v=l*b-h*y,E=h*p-a*b,k=a*y-l*p,M=l*k-h*E,L=h*v-a*k,R=a*E-l*v,B=2*r[3];return E*=B,k*=B,L*=2,R*=2,s[0]=p+(v*=B)+(M*=2),s[1]=y+E+L,s[2]=b+k+R,s}var md,_n=Wm,Kb=fg,Qb=cd;function xg(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s[3]=e[3]*r,s}function yg(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=r*r+a*a+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),s[0]=r*p,s[1]=a*p,s[2]=l*p,s[3]=h*p,s}function Ro(s,e,r){var a=e[0],l=e[1],h=e[2],p=e[3];return s[0]=r[0]*a+r[4]*l+r[8]*h+r[12]*p,s[1]=r[1]*a+r[5]*l+r[9]*h+r[13]*p,s[2]=r[2]*a+r[6]*l+r[10]*h+r[14]*p,s[3]=r[3]*a+r[7]*l+r[11]*h+r[15]*p,s}function _g(){var s=new Ci(4);return Ci!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function bg(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function vg(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b+p*y,s[1]=l*b+h*y,s[2]=h*b-l*y,s[3]=p*b-a*y,s}function wg(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b-h*y,s[1]=l*b+p*y,s[2]=h*b+a*y,s[3]=p*b-l*y,s}Zm(),md=new Ci(4),Ci!=Float32Array&&(md[0]=0,md[1]=0,md[2]=0,md[3]=0);var Jb=yg;Zm(),Pl(1,0,0),Pl(0,1,0),_g(),_g(),dg();const Yb=Ce([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jg}=Yb,Ng=Ce([{name:"a_pos_3",components:3,type:"Int16"}]);var pd=Ce([{name:"a_pos",type:"Int16",components:2}]);class Xm{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const l=Xi(r,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/l;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,r,a){if(function(L,R){var B=L[0],X=L[1],re=L[2],pe=R[0],ie=R[1],ue=R[2];return Math.abs(B-pe)<=Ju*Math.max(1,Math.abs(B),Math.abs(pe))&&Math.abs(X-ie)<=Ju*Math.max(1,Math.abs(X),Math.abs(ie))&&Math.abs(re-ue)<=Ju*Math.max(1,Math.abs(re),Math.abs(ue))}(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[l,h,p]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],v=this.pos[2]-e[2],E=l*l+h*h+p*p,k=2*(y*l+b*h+v*p),M=k*k-4*E*(y*y+b*b+v*v-r*r);if(M<0){const L=Math.max(-k/2,0),R=y+l*L,B=b+h*L,X=v+p*L,re=Math.hypot(R,B,X);return a[0]=R*r/re,a[1]=B*r/re,a[2]=X*r/re,!1}{const L=(-k-Math.sqrt(M))/(2*E);if(L<0){const R=Math.hypot(y,b,v);return a[0]=y*r/R,a[1]=b*r/R,a[2]=v*r/R,!1}return a[0]=y+l*L,a[1]=b+h*L,a[2]=v+p*L,!0}}}class Km{constructor(e,r,a,l,h){this.TL=e,this.TR=r,this.BR=a,this.BL=l,this.horizon=h}static fromInvProjectionMatrix(e,r,a){const l=[-1,1,1],h=[1,1,1],p=[1,-1,1],y=[-1,-1,1],b=nr(l,l,e),v=nr(h,h,e),E=nr(p,p,e),k=nr(y,y,e);return new Km(b,v,E,k,r/a)}}class Qm{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a,l){const h=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const v=Ro([],b,e),E=1/v[3]/r*h;return function(k,M,L){return k[0]=M[0]*L[0],k[1]=M[1]*L[1],k[2]=M[2]*L[2],k[3]=M[3]*L[3],k}(v,v,[E,E,l?1/v[3]:E,E])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const v=li([],Hm([],_n([],p[b[0]],p[b[1]]),_n([],p[b[2]],p[b[1]]))),E=-Xi(v,p[b[1]]);return v.concat(E)});return new Qm(p,y)}}class ci{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const l of e)dd(r,r,l),ud(a,a,l);return new ci(r,a)}static applyTransform(e,r){const a=e.getCorners();for(let l=0;l<a.length;++l)nr(a[l],a[l],r);return ci.fromPoints(a)}constructor(e,r){this.min=e,this.max=r,this.center=Fi([],oa([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=pg(this.min),l=pg(this.max);for(let h=0;h<r.length;h++)a[h]=r[h]?this.min[h]:this.center[h],l[h]=r[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new ci(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let a=!0;for(let l=0;l<e.planes.length;l++){const h=e.planes[l];let p=0;for(let y=0;y<r.length;y++)p+=Xi(h,r[y])+h[3]>=0;if(p===0)return 0;p!==r.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let h=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][l]-this.min[l];h=Math.min(h,b),p=Math.max(p,b)}if(p<0||h>this.max[l]-this.min[l])return 0}return 1}}const Jm=5,Sg=6,Dn=zt/Math.PI/2,ev=16383,zo=64,fd=[zo,32,16],Ki=-Dn,Qi=Dn,tv=[new ci([Ki,Ki,Ki],[Qi,Qi,Qi]),new ci([Ki,Ki,Ki],[0,0,Qi]),new ci([0,Ki,Ki],[Qi,0,Qi]),new ci([Ki,0,Ki],[0,Qi,Qi]),new ci([0,0,Ki],[Qi,Qi,Qi])];function eh(s){return s*Dn/yd}function Tg(s,e,r,a=!0){const l=Fi([],s._camera.position,s.worldSize),h=[e,r,1,1];Ro(h,h,s.pixelMatrixInverse),xg(h,h,1/h[3]);const p=li([],_n([],h,l)),y=s.globeMatrix,b=[y[12],y[13],y[14]],v=_n([],b,l),E=cd(v),k=li([],v),M=s.worldSize/(2*Math.PI),L=Xi(k,p),R=Math.asin(M/E);if(R<Math.acos(L)){if(!a)return null;const ot=[],Ve=[];Fi(ot,p,E/L),li(Ve,_n(Ve,ot,v)),li(p,oa(p,v,Fi(p,Ve,Math.tan(R)*E)))}const B=[];new Xm(l,p).closestPointOnSphere(b,M,B);const X=li([],wt(y,0)),re=li([],wt(y,1)),pe=li([],wt(y,2)),ie=Xi(X,B),ue=Xi(re,B),xe=Xi(pe,B),ge=st(Math.asin(-ue/M));let Fe=st(Math.atan2(ie,xe));Fe=s.center.lng+function(ot,Ve){const Je=(Ve-ot+180)%360-180;return Je<-180?Je+360:Je}(s.center.lng,Fe);const Re=Rn(Fe),He=mt(zn(ge),0,1);return new Rl(Re,He)}class sv{constructor(e,r,a){this.a=_n([],e,a),this.b=_n([],r,a),this.center=a;const l=li([],this.a),h=li([],this.b);this.angle=Math.acos(Xi(l,h))}}function Ym(s,e){if(s.angle===0)return null;let r;return r=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),r<0||r>1?null:function(a,l,h,p){const y=Math.sin(h);return a*(Math.sin((1-p)*h)/y)+l*(Math.sin(p*h)/y)}(s.a[e],s.b[e],s.angle,mt(r,0,1))+s.center[e]}function Ln(s){if(s.z<=1)return tv[s.z+2*s.y+s.x];const e=ep(th(s));return ci.fromPoints(e)}function Oo(s,e,r){return Fi(s,s,1-r),hd(s,s,e,r)}function Eg(s,e){const r=Ll(e.zoom);if(r===0)return Ln(s);const a=th(s),l=ep(a),h=Rn(a.getWest())*e.worldSize,p=Rn(a.getEast())*e.worldSize,y=zn(a.getNorth())*e.worldSize,b=zn(a.getSouth())*e.worldSize,v=[h,y,0],E=[p,y,0],k=[h,b,0],M=[p,b,0],L=$m([],e.globeMatrix);return nr(v,v,L),nr(E,E,L),nr(k,k,L),nr(M,M,L),l[0]=Oo(l[0],k,r),l[1]=Oo(l[1],M,r),l[2]=Oo(l[2],E,r),l[3]=Oo(l[3],v,r),ci.fromPoints(l)}function Cg(s,e,r){for(const a of s)nr(a,a,e),Fi(a,a,r)}function rv(s,e,r){const a=e/s.worldSize,l=s.globeMatrix;if(r.z<=1){const Re=Ln(r).getCorners();return Cg(Re,l,a),ci.fromPoints(Re)}const h=th(r),p=ep(h);Cg(p,l,a);const y=Number.MAX_VALUE,b=[-y,-y,-y],v=[y,y,y];if(h.contains(s.center)){for(const ot of p)dd(v,v,ot),ud(b,b,ot);b[2]=0;const Re=s.point,He=[Re.x*a,Re.y*a,0];return dd(v,v,He),ud(b,b,He),new ci(v,b)}const E=[l[12]*a,l[13]*a,l[14]*a],k=h.getCenter(),M=mt(s.center.lat,-Xr,Xr),L=mt(k.lat,-Xr,Xr),R=Rn(s.center.lng),B=zn(M);let X=R-Rn(k.lng);const re=B-zn(L);X>.5?X-=1:X<-.5&&(X+=1);let pe=0;Math.abs(X)>Math.abs(re)?pe=X>=0?1:3:(pe=re>=0?0:2,hd(E,E,[l[4]*a,l[5]*a,l[6]*a],-Math.sin(Me(re>=0?h.getSouth():h.getNorth()))*Dn));const ie=p[pe],ue=p[(pe+1)%4],xe=new sv(ie,ue,E),ge=[Ym(xe,0)||ie[0],Ym(xe,1)||ie[1],Ym(xe,2)||ie[2]],Fe=Ll(s.zoom);if(Fe>0){const Re=function({x:ot,y:Ve,z:Je},Ye,rt,ht,Ze){const bt=1/(1<<Je);let At=ot*bt,vt=At+bt,$t=Ve*bt,pt=$t+bt,Rt=0;const Gt=(At+vt)/2-ht;return Gt>.5?Rt=-1:Gt<-.5&&(Rt=1),At=((At+Rt)*Ye-(ht*=Ye))*rt+ht,vt=((vt+Rt)*Ye-ht)*rt+ht,$t=($t*Ye-(Ze*=Ye))*rt+Ze,pt=(pt*Ye-Ze)*rt+Ze,[[At,pt,0],[vt,pt,0],[vt,$t,0],[At,$t,0]]}(r,e,s._pixelsPerMercatorPixel,R,B);for(let ot=0;ot<p.length;ot++)Oo(p[ot],Re[ot],Fe);const He=oa([],Re[pe],Re[(pe+1)%4]);Fi(He,He,.5),Oo(ge,He,Fe)}for(const Re of p)dd(v,v,Re),ud(b,b,Re);return v[2]=Math.min(ie[2],ue[2]),dd(v,v,ge),ud(b,b,ge),new ci(v,b)}function th({x:s,y:e,z:r}){const a=1/(1<<r),l=new ks(Bi(s*a),Hr((e+1)*a)),h=new ks(Bi((s+1)*a),Hr(e*a));return new Oa(l,h)}function ep(s){const e=Me(s.getNorth()),r=Me(s.getSouth()),a=Math.cos(e),l=Math.cos(r),h=Math.sin(e),p=Math.sin(r),y=s.getWest(),b=s.getEast();return[Il(l,p,y),Il(l,p,b),Il(a,h,b),Il(a,h,y)]}function Il(s,e,r,a=Dn){return r=Me(r),[s*Math.sin(r)*a,-e*a,s*Math.cos(r)*a]}function Dl(s,e,r){return Il(Math.cos(Me(s)),Math.sin(Me(s)),e,r)}function gd(s,e,r,a){const l=1<<r.z,h=(s/zt+r.x)/l;return Dl(Hr((e/zt+r.y)/l),Bi(h),a)}function sh({min:s,max:e}){return ev/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const kg=new Float64Array(16);function xd(s){const e=sh(s),r=hg(kg,[e,e,e]);return ld(r,r,((a=[])[0]=-(l=s.min)[0],a[1]=-l[1],a[2]=-l[2],a));var a,l}function tp(s){const e=(a=s.min,(r=kg)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r);var r,a;const l=1/sh(s);return Lo(e,e,[l,l,l])}function Ag(s,e,r,a,l){const h=function(b){const v=zt/(2*Math.PI);return b/(2*Math.PI)/v}(r),p=[s,e,-r/(2*Math.PI)],y=yn(new Float64Array(16));return ld(y,y,p),Lo(y,y,[h,h,h]),Gm(y,y,Me(-l)),Yu(y,y,Me(-a)),y}function Ll(s){return Fs(Jm,Sg,s)}function Mg(s,e){const r=Dl(e.lat,e.lng),a=function(R){const B=Dl(R._center.lat,R._center.lng);let X=Hm([],Pl(0,1,0),B);const re=mg([],-R.angle,B);X=nr(X,X,re),mg(re,-R._pitch,X);const pe=li([],B);return Fi(pe,pe,eh(R.cameraToCenterDistance/R.pixelsPerMeter)),nr(pe,pe,re),oa([],B,pe)}(s);return p=(l=Wm([],a,r))[0],y=l[1],b=l[2],v=(h=r)[0],E=h[1],k=h[2],L=(M=Math.sqrt(p*p+y*y+b*b)*Math.sqrt(v*v+E*E+k*k))&&Xi(l,h)/M,Math.acos(Math.min(Math.max(L,-1),1));var l,h,p,y,b,v,E,k,M,L}function sp(s,e){return Mg(s,e)>Math.PI/2*1.01}const Pg=Me(85),iv=Math.cos(Pg),nv=Math.sin(Pg),yd=63710088e-1,Ig=2*Math.PI*yd;class Fa{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fa(ts(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,l=e.lat*r,h=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return yd*Math.acos(Math.min(h,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Oa(new Fa(this.lng-a,this.lat-r),new Fa(this.lng+a,this.lat+r))}toEcef(e){const r=eh(e);return Dl(this.lat,this.lng,Dn+r)}static convert(e){if(e instanceof Fa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Fa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Fa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var ks=Fa;function rp(s){return Ig*Math.cos(s*Math.PI/180)}function Rn(s){return(180+s)/360}function zn(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function bn(s,e){return s/rp(e)}function Bi(s){return 360*s-180}function Hr(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Dg(s,e){return s*rp(Hr(e))}const Xr=85.051129;function Lg(s){return 1/Math.cos(s*Math.PI/180)}class Rl{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=ks.convert(e);return new Rl(Rn(a.lng),zn(a.lat),bn(r,a.lat))}toLngLat(){return new ks(Bi(this.x),Hr(this.y))}toAltitude(){return Dg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ig*Lg(Hr(this.y))}}function ip(s,e,r,a,l,h,p,y,b){const v=(e+a)/2,E=(r+l)/2,k=new ke(v,E);y(k),function(M,L,R,B,X,re){const pe=R-X,ie=B-re;return Math.abs((B-L)*pe-(R-M)*ie)/Math.hypot(pe,ie)}(k.x,k.y,h.x,h.y,p.x,p.y)>=b?(ip(s,e,r,v,E,h,k,y,b),ip(s,v,E,a,l,k,p,y,b)):s.push(p)}function Rg(s,e,r){let a=s[0],l=a.x,h=a.y;e(a);const p=[a];for(let y=1;y<s.length;y++){const b=s[y],{x:v,y:E}=b;e(b),ip(p,l,h,v,E,a,b,e,r),l=v,h=E,a=b}return p}function np(s,e,r,a){if(a(e,r)){const l=e.add(r)._mult(.5);np(s,e,l,a),np(s,l,r,a)}else s.push(r)}function av(s,e){let r=s[0];const a=[r];for(let l=1;l<s.length;l++){const h=s[l];np(a,r,h,e),r=h}return a}const ap=Math.pow(2,14)-1,zg=-ap-1;function ov(s,e){const r=Math.round(s.x*e),a=Math.round(s.y*e);return s.x=mt(r,zg,ap),s.y=mt(a,zg,ap),(r<s.x||r>s.x+1||a<s.y||a>s.y+1)&&Ds("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function la(s,e,r){const a=s.loadGeometry(),l=s.extent,h=zt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:b,y:v,projection:E}=r,k=M=>{const L=Bi((e.x+M.x/l)/p),R=Hr((e.y+M.y/l)/p),B=E.project(L,R);M.x=(B.x*y-b)*l,M.y=(B.y*y-v)*l};for(let M=0;M<a.length;M++)if(s.type!==1)a[M]=Rg(a[M],k,1);else{const L=[];for(const R of a[M])R.x<0||R.x>=l||R.y<0||R.y>=l||(k(R),L.push(R));a[M]=L}}for(const p of a)for(const y of p)ov(y,h);return a}function Fo(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?la(s):[]}}function rh(s,e,r,a,l){s.emplaceBack(2*e+(a+1)/2,2*r+(l+1)/2)}function ih(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class op{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new at,this.indexArray=new It,this.segments=new mr,this.programConfigurations=new Io(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,l){const h=this.layers[0],p=[];let y=null;h.type==="circle"&&(y=h.layout.get("circle-sort-key"));for(const{feature:v,id:E,index:k,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,R=Fo(v,L);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),R,a))continue;const B=y?y.evaluate(R,{},a):void 0,X={id:E,properties:v.properties,type:v.type,sourceLayerIndex:M,index:k,geometry:L?R.geometry:la(v,a,l),patterns:{},sortKey:B};p.push(X)}y&&p.sort((v,E)=>v.sortKey-E.sortKey);let b=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new ct,b=l.projection);for(const v of p){const{geometry:E,index:k,sourceLayerIndex:M}=v,L=e[k].feature;this.addFeature(v,E,k,r.availableImages,a,b),r.featureIndex.insert(L,E,k,M,this.index)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Hb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,l,h,p){for(const y of r)for(const b of y){const v=b.x,E=b.y;if(v<0||v>=zt||E<0||E>=zt)continue;if(p){const L=p.projectTilePoint(v,E,h),R=p.upVector(h,v,E),B=this.globeExtVertexArray;ih(B,L,R),ih(B,L,R),ih(B,L,R),ih(B,L,R)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=k.vertexLength;rh(this.layoutVertexArray,v,E,-1,-1),rh(this.layoutVertexArray,v,E,1,-1),rh(this.layoutVertexArray,v,E,1,1),rh(this.layoutVertexArray,v,E,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},l,h)}}function Og(s,e){for(let r=0;r<s.length;r++)if(Bo(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(Bo(s,e[r]))return!0;return!!lp(s,e)}function lv(s,e,r){return!!Bo(s,e)||!!cp(e,s,r)}function Fg(s,e){if(s.length===1)return Ug(e,s[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let l=0;l<a.length;l++)if(Bo(s,a[l]))return!0}for(let r=0;r<s.length;r++)if(Ug(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(lp(s,e[r]))return!0;return!1}function cv(s,e,r){if(s.length>1){if(lp(s,e))return!0;for(let a=0;a<e.length;a++)if(cp(e[a],s,r))return!0}for(let a=0;a<s.length;a++)if(cp(s[a],e,r))return!0;return!1}function lp(s,e){if(s.length===0||e.length===0)return!1;for(let r=0;r<s.length-1;r++){const a=s[r],l=s[r+1];for(let h=0;h<e.length-1;h++)if(dv(a,l,e[h],e[h+1]))return!0}return!1}function dv(s,e,r,a){return $r(s,r,a)!==$r(e,r,a)&&$r(s,e,r)!==$r(s,e,a)}function cp(s,e,r){const a=r*r;if(e.length===1)return s.distSqr(e[0])<a;for(let l=1;l<e.length;l++)if(Bg(s,e[l-1],e[l])<a)return!0;return!1}function Bg(s,e,r){const a=e.distSqr(r);if(a===0)return s.distSqr(e);const l=((s.x-e.x)*(r.x-e.x)+(s.y-e.y)*(r.y-e.y))/a;return s.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function Ug(s,e){let r,a,l,h=!1;for(let p=0;p<s.length;p++){r=s[p];for(let y=0,b=r.length-1;y<r.length;b=y++)a=r[y],l=r[b],a.y>e.y!=l.y>e.y&&e.x<(l.x-a.x)*(e.y-a.y)/(l.y-a.y)+a.x&&(h=!h)}return h}function Bo(s,e){let r=!1;for(let a=0,l=s.length-1;a<s.length;l=a++){const h=s[a],p=s[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(r=!r)}return r}function Vg(s,e,r,a,l){for(const p of s)if(e<=p.x&&r<=p.y&&a>=p.x&&l>=p.y)return!0;const h=[new ke(e,r),new ke(e,l),new ke(a,l),new ke(a,r)];if(s.length>2){for(const p of h)if(Bo(s,p))return!0}for(let p=0;p<s.length-1;p++)if(uv(s[p],s[p+1],h))return!0;return!1}function uv(s,e,r){const a=r[0],l=r[2];if(s.x<a.x&&e.x<a.x||s.x>l.x&&e.x>l.x||s.y<a.y&&e.y<a.y||s.y>l.y&&e.y>l.y)return!1;const h=$r(s,e,r[0]);return h!==$r(s,e,r[1])||h!==$r(s,e,r[2])||h!==$r(s,e,r[3])}function zl(s,e,r){const a=e.paint.get(s).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(s)}function nh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function qg(s,e,r,a,l){if(!e[0]&&!e[1])return s;const h=ke.convert(e)._mult(l);r==="viewport"&&h._rotate(-a);const p=[];for(let y=0;y<s.length;y++)p.push(s[y].sub(h));return p}function $g(s,e,r,a){const l=ke.convert(s)._mult(a);return e==="viewport"&&l._rotate(-r),l}Et(op,"CircleBucket",{omit:["layers"]});const hv=new le({"circle-sort-key":new K(We.layout_circle["circle-sort-key"])});var mv={paint:new le({"circle-radius":new K(We.paint_circle["circle-radius"]),"circle-color":new K(We.paint_circle["circle-color"]),"circle-blur":new K(We.paint_circle["circle-blur"]),"circle-opacity":new K(We.paint_circle["circle-opacity"]),"circle-translate":new F(We.paint_circle["circle-translate"]),"circle-translate-anchor":new F(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new F(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new F(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new K(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new K(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new K(We.paint_circle["circle-stroke-opacity"])}),layout:hv};function Gg(s,e,r,a,l,h,p,y,b){if(h&&s.queryGeometry.isAboveHorizon)return!1;h&&(b*=s.pixelToTileUnitsFactor);const v=s.tileID.canonical,E=r.projection.upVectorScale(v,r.center.lat,r.worldSize).metersToTile;for(const k of e)for(const M of k){const L=M.add(y),R=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(L.x,L.y,!0):0,B=r.projection.projectTilePoint(L.x,L.y,v);if(R>0){const ie=r.projection.upVector(v,L.x,L.y);B.x+=ie[0]*E*R,B.y+=ie[1]*E*R,B.z+=ie[2]*E*R}const X=h?L:pv(B.x,B.y,B.z,a),re=h?s.tilespaceRays.map(ie=>gv(ie,R)):s.queryGeometry.screenGeometry,pe=Ro([],[B.x,B.y,B.z,1],a);if(!p&&h?b*=pe[3]/r.cameraToCenterDistance:p&&!h&&(b*=r.cameraToCenterDistance/pe[3]),h){const ie=Hr((M.y/zt+v.y)/(1<<v.z));b/=r.projection.pixelsPerMeter(ie,1)/bn(1,ie)}if(lv(re,X,b))return!0}return!1}function pv(s,e,r,a){const l=Ro([],[s,e,r,1],a);return new ke(l[0]/l[3],l[1]/l[3])}const Zg=Pl(0,0,0),fv=Pl(0,0,1);function gv(s,e){const r=Zm();return Zg[2]=e,s.intersectsPlane(Zg,fv,r),new ke(r[0],r[1])}class Wg extends op{}function Hg(s,{width:e,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*a)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*a);return s.width=e,s.height=r,s.data=l,s}function Xg(s,e,r){const{width:a,height:l}=e;a===s.width&&l===s.height||(dp(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,a),height:Math.min(s.height,l)},r),s.width=a,s.height=l,s.data=e.data)}function dp(s,e,r,a,l,h){if(l.width===0||l.height===0)return e;if(l.width>s.width||l.height>s.height||r.x>s.width-l.width||r.y>s.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||a.x>e.width-l.width||a.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=s.data,y=e.data;for(let b=0;b<l.height;b++){const v=((r.y+b)*s.width+r.x)*h,E=((a.y+b)*e.width+a.x)*h;for(let k=0;k<l.width*h;k++)y[E+k]=p[v+k]}return e}Et(Wg,"HeatmapBucket",{omit:["layers"]});class ca{constructor(e,r){Hg(this,e,1,r)}resize(e){Xg(this,new ca(e),1)}clone(){return new ca({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,h){dp(e,r,a,l,h,1)}}class ki{constructor(e,r){Hg(this,e,4,r)}resize(e){Xg(this,new ki(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ki({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,l,h){dp(e,r,a,l,h,4)}}Et(ca,"AlphaImage"),Et(ki,"RGBAImage");var xv={paint:new le({"heatmap-radius":new K(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new K(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new F(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ae(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new F(We.paint_heatmap["heatmap-opacity"])})};function up(s){const e={},r=s.resolution||256,a=s.clips?s.clips.length:1,l=s.image||new ki({width:r,height:a}),h=(p,y,b)=>{e[s.evaluationKey]=b;const v=s.expression.evaluate(e);l.data[p+y+0]=Math.floor(255*v.r/v.a),l.data[p+y+1]=Math.floor(255*v.g/v.a),l.data[p+y+2]=Math.floor(255*v.b/v.a),l.data[p+y+3]=Math.floor(255*v.a)};if(s.clips)for(let p=0,y=0;p<a;++p,y+=4*r)for(let b=0,v=0;b<r;b++,v+=4){const E=b/(r-1),{start:k,end:M}=s.clips[p];h(y,v,k*(1-E)+M*E)}else for(let p=0,y=0;p<r;p++,y+=4)h(0,y,p/(r-1));return l}var yv={paint:new le({"hillshade-illumination-direction":new F(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new F(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new F(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new F(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new F(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new F(We.paint_hillshade["hillshade-accent-color"])})};const _v=Ce([{name:"a_pos",components:2,type:"Int16"}],4),{members:bv}=_v;var hp={exports:{}};function ah(s,e,r){r=r||2;var a,l,h,p,y,b,v,E=e&&e.length,k=E?e[0]*r:s.length,M=Kg(s,0,k,r,!0),L=[];if(!M||M.next===M.prev)return L;if(E&&(M=function(B,X,re,pe){var ie,ue,xe,ge=[];for(ie=0,ue=X.length;ie<ue;ie++)(xe=Kg(B,X[ie]*pe,ie<ue-1?X[ie+1]*pe:B.length,pe,!1))===xe.next&&(xe.steiner=!0),ge.push(Cv(xe));for(ge.sort(Sv),ie=0;ie<ge.length;ie++)re=Tv(ge[ie],re);return re}(s,e,M,r)),s.length>80*r){a=h=s[0],l=p=s[1];for(var R=r;R<k;R+=r)(y=s[R])<a&&(a=y),(b=s[R+1])<l&&(l=b),y>h&&(h=y),b>p&&(p=b);v=(v=Math.max(h-a,p-l))!==0?32767/v:0}return _d(M,L,r,a,l,v,0),L}function Kg(s,e,r,a,l){var h,p;if(l===fp(s,e,r,a)>0)for(h=e;h<r;h+=a)p=Yg(h,s[h],s[h+1],p);else for(h=r-a;h>=e;h-=a)p=Yg(h,s[h],s[h+1],p);return p&&oh(p,p.next)&&(vd(p),p=p.next),p}function Uo(s,e){if(!s)return s;e||(e=s);var r,a=s;do if(r=!1,a.steiner||!oh(a,a.next)&&pr(a.prev,a,a.next)!==0)a=a.next;else{if(vd(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function _d(s,e,r,a,l,h,p){if(s){!p&&h&&function(E,k,M,L){var R=E;do R.z===0&&(R.z=mp(R.x,R.y,k,M,L)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==E);R.prevZ.nextZ=null,R.prevZ=null,function(B){var X,re,pe,ie,ue,xe,ge,Fe,Re=1;do{for(re=B,B=null,ue=null,xe=0;re;){for(xe++,pe=re,ge=0,X=0;X<Re&&(ge++,pe=pe.nextZ);X++);for(Fe=Re;ge>0||Fe>0&&pe;)ge!==0&&(Fe===0||!pe||re.z<=pe.z)?(ie=re,re=re.nextZ,ge--):(ie=pe,pe=pe.nextZ,Fe--),ue?ue.nextZ=ie:B=ie,ie.prevZ=ue,ue=ie;re=pe}ue.nextZ=null,Re*=2}while(xe>1)}(R)}(s,a,l,h);for(var y,b,v=s;s.prev!==s.next;)if(y=s.prev,b=s.next,h?wv(s,a,l,h):vv(s))e.push(y.i/r|0),e.push(s.i/r|0),e.push(b.i/r|0),vd(s),s=b.next,v=b.next;else if((s=b)===v){p?p===1?_d(s=jv(Uo(s),e,r),e,r,a,l,h,2):p===2&&Nv(s,e,r,a,l,h):_d(Uo(s),e,r,a,l,h,1);break}}}function vv(s){var e=s.prev,r=s,a=s.next;if(pr(e,r,a)>=0)return!1;for(var l=e.x,h=r.x,p=a.x,y=e.y,b=r.y,v=a.y,E=l<h?l<p?l:p:h<p?h:p,k=y<b?y<v?y:v:b<v?b:v,M=l>h?l>p?l:p:h>p?h:p,L=y>b?y>v?y:v:b>v?b:v,R=a.next;R!==e;){if(R.x>=E&&R.x<=M&&R.y>=k&&R.y<=L&&Ol(l,y,h,b,p,v,R.x,R.y)&&pr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function wv(s,e,r,a){var l=s.prev,h=s,p=s.next;if(pr(l,h,p)>=0)return!1;for(var y=l.x,b=h.x,v=p.x,E=l.y,k=h.y,M=p.y,L=y<b?y<v?y:v:b<v?b:v,R=E<k?E<M?E:M:k<M?k:M,B=y>b?y>v?y:v:b>v?b:v,X=E>k?E>M?E:M:k>M?k:M,re=mp(L,R,e,r,a),pe=mp(B,X,e,r,a),ie=s.prevZ,ue=s.nextZ;ie&&ie.z>=re&&ue&&ue.z<=pe;){if(ie.x>=L&&ie.x<=B&&ie.y>=R&&ie.y<=X&&ie!==l&&ie!==p&&Ol(y,E,b,k,v,M,ie.x,ie.y)&&pr(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ue.x>=L&&ue.x<=B&&ue.y>=R&&ue.y<=X&&ue!==l&&ue!==p&&Ol(y,E,b,k,v,M,ue.x,ue.y)&&pr(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ie&&ie.z>=re;){if(ie.x>=L&&ie.x<=B&&ie.y>=R&&ie.y<=X&&ie!==l&&ie!==p&&Ol(y,E,b,k,v,M,ie.x,ie.y)&&pr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ue&&ue.z<=pe;){if(ue.x>=L&&ue.x<=B&&ue.y>=R&&ue.y<=X&&ue!==l&&ue!==p&&Ol(y,E,b,k,v,M,ue.x,ue.y)&&pr(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function jv(s,e,r){var a=s;do{var l=a.prev,h=a.next.next;!oh(l,h)&&Qg(l,a,a.next,h)&&bd(l,h)&&bd(h,l)&&(e.push(l.i/r|0),e.push(a.i/r|0),e.push(h.i/r|0),vd(a),vd(a.next),a=s=h),a=a.next}while(a!==s);return Uo(a)}function Nv(s,e,r,a,l,h){var p=s;do{for(var y=p.next.next;y!==p.prev;){if(p.i!==y.i&&kv(p,y)){var b=Jg(p,y);return p=Uo(p,p.next),b=Uo(b,b.next),_d(p,e,r,a,l,h,0),void _d(b,e,r,a,l,h,0)}y=y.next}p=p.next}while(p!==s)}function Sv(s,e){return s.x-e.x}function Tv(s,e){var r=function(l,h){var p,y=h,b=l.x,v=l.y,E=-1/0;do{if(v<=y.y&&v>=y.next.y&&y.next.y!==y.y){var k=y.x+(v-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(k<=b&&k>E&&(E=k,p=y.x<y.next.x?y:y.next,k===b))return p}y=y.next}while(y!==h);if(!p)return null;var M,L=p,R=p.x,B=p.y,X=1/0;y=p;do b>=y.x&&y.x>=R&&b!==y.x&&Ol(v<B?b:E,v,R,B,v<B?E:b,v,y.x,y.y)&&(M=Math.abs(v-y.y)/(b-y.x),bd(y,l)&&(M<X||M===X&&(y.x>p.x||y.x===p.x&&Ev(p,y)))&&(p=y,X=M)),y=y.next;while(y!==L);return p}(s,e);if(!r)return e;var a=Jg(r,s);return Uo(a,a.next),Uo(r,r.next)}function Ev(s,e){return pr(s.prev,s,e.prev)<0&&pr(e.next,s,s.next)<0}function mp(s,e,r,a,l){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-r)*l|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Cv(s){var e=s,r=s;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==s);return r}function Ol(s,e,r,a,l,h,p,y){return(l-p)*(e-y)>=(s-p)*(h-y)&&(s-p)*(a-y)>=(r-p)*(e-y)&&(r-p)*(h-y)>=(l-p)*(a-y)}function kv(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(r,a){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&Qg(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(s,e)&&(bd(s,e)&&bd(e,s)&&function(r,a){var l=r,h=!1,p=(r.x+a.x)/2,y=(r.y+a.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&p<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(s,e)&&(pr(s.prev,s,e.prev)||pr(s,e.prev,e))||oh(s,e)&&pr(s.prev,s,s.next)>0&&pr(e.prev,e,e.next)>0)}function pr(s,e,r){return(e.y-s.y)*(r.x-e.x)-(e.x-s.x)*(r.y-e.y)}function oh(s,e){return s.x===e.x&&s.y===e.y}function Qg(s,e,r,a){var l=ch(pr(s,e,r)),h=ch(pr(s,e,a)),p=ch(pr(r,a,s)),y=ch(pr(r,a,e));return l!==h&&p!==y||!(l!==0||!lh(s,r,e))||!(h!==0||!lh(s,a,e))||!(p!==0||!lh(r,s,a))||!(y!==0||!lh(r,e,a))}function lh(s,e,r){return e.x<=Math.max(s.x,r.x)&&e.x>=Math.min(s.x,r.x)&&e.y<=Math.max(s.y,r.y)&&e.y>=Math.min(s.y,r.y)}function ch(s){return s>0?1:s<0?-1:0}function bd(s,e){return pr(s.prev,s,s.next)<0?pr(s,e,s.next)>=0&&pr(s,s.prev,e)>=0:pr(s,e,s.prev)<0||pr(s,s.next,e)<0}function Jg(s,e){var r=new pp(s.i,s.x,s.y),a=new pp(e.i,e.x,e.y),l=s.next,h=e.prev;return s.next=e,e.prev=s,r.next=l,l.prev=r,a.next=r,r.prev=a,h.next=a,a.prev=h,a}function Yg(s,e,r,a){var l=new pp(s,e,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function vd(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function pp(s,e,r){this.i=s,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fp(s,e,r,a){for(var l=0,h=e,p=r-a;h<r;h+=a)l+=(s[p]-s[h])*(s[h+1]+s[p+1]),p=h;return l}hp.exports=ah,hp.exports.default=ah,ah.deviation=function(s,e,r,a){var l=e&&e.length,h=Math.abs(fp(s,0,l?e[0]*r:s.length,r));if(l)for(var p=0,y=e.length;p<y;p++)h-=Math.abs(fp(s,e[p]*r,p<y-1?e[p+1]*r:s.length,r));var b=0;for(p=0;p<a.length;p+=3){var v=a[p]*r,E=a[p+1]*r,k=a[p+2]*r;b+=Math.abs((s[v]-s[k])*(s[E+1]-s[v+1])-(s[v]-s[E])*(s[k+1]-s[v+1]))}return h===0&&b===0?0:Math.abs((b-h)/h)},ah.flatten=function(s){for(var e=s[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,l=0;l<s.length;l++){for(var h=0;h<s[l].length;h++)for(var p=0;p<e;p++)r.vertices.push(s[l][h][p]);l>0&&r.holes.push(a+=s[l-1].length)}return r};var gp=Ne(hp.exports);function Av(s,e,r,a,l){ex(s,e,r,a||s.length-1,l||Mv)}function ex(s,e,r,a,l){for(;a>r;){if(a-r>600){var h=a-r+1,p=e-r+1,y=Math.log(h),b=.5*Math.exp(2*y/3),v=.5*Math.sqrt(y*b*(h-b)/h)*(p-h/2<0?-1:1);ex(s,e,Math.max(r,Math.floor(e-p*b/h+v)),Math.min(a,Math.floor(e+(h-p)*b/h+v)),l)}var E=s[e],k=r,M=a;for(wd(s,r,e),l(s[a],E)>0&&wd(s,r,a);k<M;){for(wd(s,k,M),k++,M--;l(s[k],E)<0;)k++;for(;l(s[M],E)>0;)M--}l(s[r],E)===0?wd(s,r,M):wd(s,++M,a),M<=e&&(r=M+1),e<=M&&(a=M-1)}}function wd(s,e,r){var a=s[e];s[e]=s[r],s[r]=a}function Mv(s,e){return s<e?-1:s>e?1:0}function xp(s,e){const r=s.length;if(r<=1)return[s];const a=[];let l,h;for(let p=0;p<r;p++){const y=Wn(s[p]);y!==0&&(s[p].area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(l&&a.push(l),l=[s[p]]):l.push(s[p]))}if(l&&a.push(l),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(Av(a[p],e,1,a[p].length-1,Pv),a[p]=a[p].slice(0,e));return a}function Pv(s,e){return e.area-s.area}function yp(s,e,r){const a=r.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${s}-pattern`);p.isConstant()||(l=!0);const y=p.constantOr(null);y&&(l=!0,a[y]=!0)}return l}function _p(s,e,r,a,l){const h=l.patternDependencies;for(const p of e){const y=p.paint.get(`${s}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:a},r,{},l.availableImages);b=b&&b.name?b.name:b,h[b]=!0,r.patterns[p.id]=b}}return r}class dh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new at,this.indexArray=new It,this.indexArray2=new Pr,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new mr,this.segments2=new mr,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,a,l){this.hasPattern=yp("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:b,index:v,sourceLayerIndex:E}of e){const k=this.layers[0]._featureFilter.needGeometry,M=Fo(y,k);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),M,a))continue;const L=h?h.evaluate(M,{},a,r.availableImages):void 0,R={id:b,properties:y.properties,type:y.type,sourceLayerIndex:E,index:v,geometry:k?M.geometry:la(y,a,l),patterns:{},sortKey:L};p.push(R)}h&&p.sort((y,b)=>y.sortKey-b.sortKey);for(const y of p){const{geometry:b,index:v,sourceLayerIndex:E}=y;if(this.hasPattern){const k=_p("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(y,b,v,a,{},r.availableImages);r.featureIndex.insert(e[v].feature,b,v,E,this.index)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}addFeatures(e,r,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,l,h,p=[]){for(const y of xp(r,500)){let b=0;for(const R of y)b+=R.length;const v=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),E=v.vertexLength,k=[],M=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&M.push(k.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),X=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(X+R.length-1,X),k.push(R[0].x),k.push(R[0].y);for(let re=1;re<R.length;re++)this.layoutVertexArray.emplaceBack(R[re].x,R[re].y),this.indexArray2.emplaceBack(X+re-1,X+re),k.push(R[re].x),k.push(R[re].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const L=gp(k,M);for(let R=0;R<L.length;R+=3)this.indexArray.emplaceBack(E+L[R],E+L[R+1],E+L[R+2]);v.vertexLength+=b,v.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}}Et(dh,"FillBucket",{omit:["layers","patternFeatures"]});const Iv=new le({"fill-sort-key":new K(We.layout_fill["fill-sort-key"])});var Dv={paint:new le({"fill-antialias":new F(We.paint_fill["fill-antialias"]),"fill-opacity":new K(We.paint_fill["fill-opacity"]),"fill-color":new K(We.paint_fill["fill-color"]),"fill-outline-color":new K(We.paint_fill["fill-outline-color"]),"fill-translate":new F(We.paint_fill["fill-translate"]),"fill-translate-anchor":new F(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new K(We.paint_fill["fill-pattern"])}),layout:Iv};const Lv=Ce([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Rv=Ce([{name:"a_centroid_pos",components:2,type:"Uint16"}]),zv=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ov}=Lv;var uh={},Fv=fe,tx=Fl;function Fl(s,e,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=s,this._geometry=-1,this._keys=a,this._values=l,s.readFields(Bv,this,e)}function Bv(s,e,r){s==1?e.id=r.readVarint():s==2?function(a,l){for(var h=a.readVarint()+a.pos;a.pos<h;){var p=l._keys[a.readVarint()],y=l._values[a.readVarint()];l.properties[p]=y}}(r,e):s==3?e.type=r.readVarint():s==4&&(e._geometry=r.pos)}function Uv(s){for(var e,r,a=0,l=0,h=s.length,p=h-1;l<h;p=l++)a+=((r=s[p]).x-(e=s[l]).x)*(e.y+r.y);return a}Fl.types=["Unknown","Point","LineString","Polygon"],Fl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var e,r=s.readVarint()+s.pos,a=1,l=0,h=0,p=0,y=[];s.pos<r;){if(l<=0){var b=s.readVarint();a=7&b,l=b>>3}if(l--,a===1||a===2)h+=s.readSVarint(),p+=s.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new Fv(h,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Fl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var e=s.readVarint()+s.pos,r=1,a=0,l=0,h=0,p=1/0,y=-1/0,b=1/0,v=-1/0;s.pos<e;){if(a<=0){var E=s.readVarint();r=7&E,a=E>>3}if(a--,r===1||r===2)(l+=s.readSVarint())<p&&(p=l),l>y&&(y=l),(h+=s.readSVarint())<b&&(b=h),h>v&&(v=h);else if(r!==7)throw new Error("unknown command "+r)}return[p,b,y,v]},Fl.prototype.toGeoJSON=function(s,e,r){var a,l,h=this.extent*Math.pow(2,r),p=this.extent*s,y=this.extent*e,b=this.loadGeometry(),v=Fl.types[this.type];function E(L){for(var R=0;R<L.length;R++){var B=L[R];L[R]=[360*(B.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(a=0;a<b.length;a++)k[a]=b[a][0];E(b=k);break;case 2:for(a=0;a<b.length;a++)E(b[a]);break;case 3:for(b=function(L){var R=L.length;if(R<=1)return[L];for(var B,X,re=[],pe=0;pe<R;pe++){var ie=Uv(L[pe]);ie!==0&&(X===void 0&&(X=ie<0),X===ie<0?(B&&re.push(B),B=[L[pe]]):B.push(L[pe]))}return B&&re.push(B),re}(b),a=0;a<b.length;a++)for(l=0;l<b[a].length;l++)E(b[a][l])}b.length===1?b=b[0]:v="Multi"+v;var M={type:"Feature",geometry:{type:v,coordinates:b},properties:this.properties};return"id"in this&&(M.id=this.id),M};var Vv=tx,sx=rx;function rx(s,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(qv,this,e),this.length=this._features.length}function qv(s,e,r){s===15?e.version=r.readVarint():s===1?e.name=r.readString():s===5?e.extent=r.readVarint():s===2?e._features.push(r.pos):s===3?e._keys.push(r.readString()):s===4&&e._values.push(function(a){for(var l=null,h=a.readVarint()+a.pos;a.pos<h;){var p=a.readVarint()>>3;l=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return l}(r))}rx.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var e=this._pbf.readVarint()+this._pbf.pos;return new Vv(this._pbf,e,this.extent,this._keys,this._values)};var $v=sx;function Gv(s,e,r){if(s===3){var a=new $v(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var bp=uh.VectorTile=function(s,e){this.layers=s.readFields(Gv,{},e)},hh=uh.VectorTileFeature=tx;function mh(s,e,r,a){const l=[],h=a===0?(p,y,b,v,E,k)=>{p.push(new ke(k,b+(k-y)/(v-y)*(E-b)))}:(p,y,b,v,E,k)=>{p.push(new ke(y+(k-b)/(E-b)*(v-y),k))};for(const p of s){const y=[];for(const b of p){if(b.length<=2)continue;const v=[];for(let M=0;M<b.length-1;M++){const L=b[M].x,R=b[M].y,B=b[M+1].x,X=b[M+1].y,re=a===0?L:R,pe=a===0?B:X;re<e?pe>e&&h(v,L,R,B,X,e):re>r?pe<r&&h(v,L,R,B,X,r):v.push(b[M]),pe<e&&re>=e&&h(v,L,R,B,X,e),pe>r&&re<=r&&h(v,L,R,B,X,r)}let E=b[b.length-1];const k=a===0?E.x:E.y;k>=e&&k<=r&&v.push(E),v.length&&(E=v[v.length-1],v[0].x===E.x&&v[0].y===E.y||v.push(v[0]),y.push(v))}y.length&&l.push(y)}return l}uh.VectorTileLayer=sx;const Zv=hh.types,Wv=Math.pow(2,13);function jd(s,e,r,a,l,h,p,y){s.emplaceBack((e<<1)+p,(r<<1)+h,(Math.floor(a*Wv)<<1)+l,Math.round(y))}function Nd(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class ix{constructor(){this.acc=new ke(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ke(e.x,e.y),this.max=new ke(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,l=this.max;e.x<a.x?a.x=e.x:e.x>l.x&&(l.x=e.x),e.y<a.y?a.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===zt)&&e.x===r.x)!=((e.y===0||e.y===zt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,ms(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>zt!=e.x>zt&&this.addBorderIntersection(1,ms(r.y,e.y,(zt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,ms(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>zt!=e.y>zt&&this.addBorderIntersection(3,ms(r.x,e.x,(zt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((r,a)=>r+a.edges,0);return e!==0?this.acc.div(e)._round():new ke(0,0)}span(){return new ke(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Sd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Qe,this.centroidVertexArray=new fn,this.indexArray=new It,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new mr,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,a,l){this.features=[],this.hasPattern=yp("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(h){const p=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*p/(p*p+1)/zt/(1<<h.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:h,id:p,index:y,sourceLayerIndex:b}of e){const v=this.layers[0]._featureFilter.needGeometry,E=Fo(h,v);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),E,a))continue;const k={id:p,sourceLayerIndex:b,index:y,geometry:v?E.geometry:la(h,a,l),properties:h.properties,type:h.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(_p("fill-extrusion",this.layers,k,this.zoom,r)):this.addFeature(k,k.geometry,y,a,{},r.availableImages,l),r.featureIndex.insert(h,k.geometry,y,b,this.index,M)}this.sortBorders()}addFeatures(e,r,a,l,h){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,r,a,l,h)}this.sortBorders()}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ov),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,zv.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,l,h,p,y){const b=[new ke(0,0),new ke(zt,zt)],v=y.projection,E=v.name==="globe",k=this.enableTerrain&&!E?new ix:null,M=Zv[e.type]==="Polygon";E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ct);const L=xp(r,500);for(let re=L.length-1;re>=0;re--){const pe=L[re];(pe.length===0||(R=pe[0]).every(ie=>ie.x<=0)||R.every(ie=>ie.x>=zt)||R.every(ie=>ie.y<=0)||R.every(ie=>ie.y>=zt))&&L.splice(re,1)}var R;let B;if(E)B=ux(L,b,l);else{B=[];for(const re of L)B.push({polygon:re,bounds:b})}const X=M?this.edgeRadius:0;for(const{polygon:re,bounds:pe}of B){let ie=0,ue=0;for(const ge of re)M&&!ge[0].equals(ge[ge.length-1])&&ge.push(ge[0]),ue+=M?ge.length-1:ge.length;const xe=this.segments.prepareSegment((M?5:4)*ue,this.layoutVertexArray,this.indexArray);if(M){const ge=[],Fe=[];ie=xe.vertexLength;for(const He of re){let ot,Ve;He.length&&He!==re[0]&&Fe.push(ge.length/2),ot=He[1].sub(He[0])._perp()._unit();for(let Je=1;Je<He.length;Je++){const Ye=He[Je],rt=He[Je===He.length-1?1:Je+1];let{x:ht,y:Ze}=Ye;if(X){Ve=rt.sub(Ye)._perp()._unit();const bt=ot.add(Ve)._unit(),At=X*Math.min(4,1/(ot.x*bt.x+ot.y*bt.y));ht+=At*bt.x,Ze+=At*bt.y,ot=Ve}jd(this.layoutVertexArray,ht,Ze,0,0,1,1,0),xe.vertexLength++,ge.push(Ye.x,Ye.y),E&&Nd(this.layoutVertexExtArray,v.projectTilePoint(ht,Ze,l),v.upVector(l,ht,Ze))}}const Re=gp(ge,Fe);for(let He=0;He<Re.length;He+=3)this.indexArray.emplaceBack(ie+Re[He],ie+Re[He+2],ie+Re[He+1]),xe.primitiveLength++}for(const ge of re){k&&ge.length&&k.startRing(ge[0]);let Fe,Re,He,ot=ge.length>4&&lx(ge[ge.length-2],ge[0],ge[1]),Ve=X?Hv(ge[ge.length-2],ge[0],ge[1],X):0;Re=ge[1].sub(ge[0])._perp()._unit();let Je=!0;for(let Ye=1,rt=0;Ye<ge.length;Ye++){let ht=ge[Ye-1],Ze=ge[Ye];const bt=ge[Ye===ge.length-1?1:Ye+1];if(k&&M&&k.currentPolyCount.top++,ox(Ze,ht,pe)){X&&(Re=bt.sub(Ze)._perp()._unit(),Je=!Je);continue}k&&k.append(Ze,ht);const At=Ze.sub(ht)._perp(),vt=At.x/(Math.abs(At.x)+Math.abs(At.y)),$t=At.y>0?1:0,pt=ht.dist(Ze);if(rt+pt>32768&&(rt=0),X){He=bt.sub(Ze)._perp()._unit();let Zt=ax(ht,Ze,bt,nx(Re,He),X);isNaN(Zt)&&(Zt=0);const Bt=Ze.sub(ht)._unit();ht=ht.add(Bt.mult(Ve))._round(),Ze=Ze.add(Bt.mult(-Zt))._round(),Ve=Zt,Re=He}const Rt=xe.vertexLength,Gt=ge.length>4&&lx(ht,Ze,bt);let gs=cx(rt,ot,Je);if(jd(this.layoutVertexArray,ht.x,ht.y,vt,$t,0,0,gs),jd(this.layoutVertexArray,ht.x,ht.y,vt,$t,0,1,gs),rt+=pt,gs=cx(rt,Gt,!Je),ot=Gt,jd(this.layoutVertexArray,Ze.x,Ze.y,vt,$t,0,0,gs),jd(this.layoutVertexArray,Ze.x,Ze.y,vt,$t,0,1,gs),xe.vertexLength+=4,this.indexArray.emplaceBack(Rt+0,Rt+1,Rt+2),this.indexArray.emplaceBack(Rt+1,Rt+3,Rt+2),xe.primitiveLength+=2,X){const Zt=ie+(Ye===1?ge.length-2:Ye-2),Bt=Ye===1?ie:Zt+1;if(this.indexArray.emplaceBack(Rt+1,Zt,Rt+3),this.indexArray.emplaceBack(Zt,Bt,Rt+3),xe.primitiveLength+=2,Fe===void 0&&(Fe=Rt),!ox(bt,ge[Ye],pe)){const Bs=Ye===ge.length-1?Fe:xe.vertexLength;this.indexArray.emplaceBack(Rt+2,Rt+3,Bs),this.indexArray.emplaceBack(Rt+3,Bs+1,Bs),this.indexArray.emplaceBack(Rt+3,Bt,Bs+1),xe.primitiveLength+=3}Je=!Je}if(E){const Zt=this.layoutVertexExtArray,Bt=v.projectTilePoint(ht.x,ht.y,l),Bs=v.projectTilePoint(Ze.x,Ze.y,l),Kt=v.upVector(l,ht.x,ht.y),Qt=v.upVector(l,Ze.x,Ze.y);Nd(Zt,Bt,Kt),Nd(Zt,Bt,Kt),Nd(Zt,Bs,Qt),Nd(Zt,Bs,Qt)}}M&&(ie+=ge.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const re=k.borders,pe=this.featuresOnBorder.push(k)-1;for(let ie=0;ie<4;ie++)re[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(pe)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,r,a=!0){let l,h;if(e)if(e.y!==0){const y=r.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else l=Math.ceil(7*(e.x+450)),h=0;else l=0,h=+a;let p=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(p++,l,h);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(p++,0,h),this.centroidVertexArray.emplace(p++,l,h)}}}function nx(s,e){const r=s.add(e)._unit();return s.x*r.x+s.y*r.y}function Hv(s,e,r,a){const l=e.sub(s)._perp()._unit(),h=r.sub(e)._perp()._unit();return ax(s,e,r,nx(l,h),a)}function ax(s,e,r,a,l){const h=Math.sqrt(1-a*a);return Math.min(s.dist(e)/3,e.dist(r)/3,l*h/a)}function ox(s,e,r){return s.x<r[0].x&&e.x<r[0].x||s.x>r[1].x&&e.x>r[1].x||s.y<r[0].y&&e.y<r[0].y||s.y>r[1].y&&e.y>r[1].y}function lx(s,e,r){if(s.x<0||s.x>=zt||e.x<0||e.x>=zt||r.x<0||r.x>=zt)return!1;const a=r.sub(e),l=a.perp(),h=s.sub(e);return(a.x*h.x+a.y*h.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(h.x*h.x+h.y*h.y))>-.866&&l.x*h.x+l.y*h.y<0}function cx(s,e,r){const a=e?2|s:-3&s;return r?1|a:-2&a}function dx(){const s=Math.PI/32,e=Math.tan(s),r=yd;return r*Math.sqrt(1+2*e*e)-r}function ux(s,e,r){const a=1<<r.z,l=Bi(r.x/a),h=Bi((r.x+1)/a),p=Hr(r.y/a),y=Hr((r.y+1)/a);return function(b,v,E,k,M=0,L){const R=[];if(!b.length||!E||!k)return R;const B=(ge,Fe)=>{for(const Re of ge)R.push({polygon:Re,bounds:Fe})},X=Math.ceil(Math.log2(E)),re=Math.ceil(Math.log2(k)),pe=X-re,ie=[];for(let ge=0;ge<Math.abs(pe);ge++)ie.push(pe>0?0:1);for(let ge=0;ge<Math.min(X,re);ge++)ie.push(0),ie.push(1);let ue=b;if(ue=mh(ue,v[0].y-M,v[1].y+M,1),ue=mh(ue,v[0].x-M,v[1].x+M,0),!ue.length)return R;const xe=[];for(ie.length?xe.push({polygons:ue,bounds:v,depth:0}):B(ue,v);xe.length;){const ge=xe.pop(),Fe=ge.depth,Re=ie[Fe],He=ge.bounds[0],ot=ge.bounds[1],Ve=Re===0?He.x:He.y,Je=Re===0?ot.x:ot.y,Ye=L?L(Re,Ve,Je):.5*(Ve+Je),rt=mh(ge.polygons,Ve-M,Ye+M,Re),ht=mh(ge.polygons,Ye-M,Je+M,Re);if(rt.length){const Ze=[He,new ke(Re===0?Ye:ot.x,Re===1?Ye:ot.y)];ie.length>Fe+1?xe.push({polygons:rt,bounds:Ze,depth:Fe+1}):B(rt,Ze)}if(ht.length){const Ze=[new ke(Re===0?Ye:He.x,Re===1?Ye:He.y),ot];ie.length>Fe+1?xe.push({polygons:ht,bounds:Ze,depth:Fe+1}):B(ht,Ze)}}return R}(s,e,Math.ceil((h-l)/11.25),Math.ceil((p-y)/11.25),1,(b,v,E)=>{if(b===0)return .5*(v+E);{const k=Hr((r.y+v/zt)/a);return(zn(.5*(Hr((r.y+E/zt)/a)+k))*a-r.y)*zt}})}Et(Sd,"FillExtrusionBucket",{omit:["layers","features"]}),Et(ix,"PartMetadata");const Xv=new le({"fill-extrusion-edge-radius":new F(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Kv={paint:new le({"fill-extrusion-opacity":new F(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new K(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new F(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new F(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new K(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new K(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new K(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new F(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new F(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new F(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new F(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Xv};function hx(s,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[s*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class ph{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Td(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=function(h,p,y){var b=hx(256*h,256*(p=Math.pow(2,y)-p-1),y),v=hx(256*(h+1),256*(p+1),y);return b[0]+","+b[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),l=function(h,p,y){let b,v="";for(let E=h;E>0;E--)b=1<<E-1,v+=(p&b?1:0)+(y&b?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mx{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Td(e,r.z,r.z,r.x,r.y)}}class di{constructor(e,r,a,l,h){this.overscaledZ=e,this.wrap=r,this.canonical=new ph(a,+l,+h),this.key=r===0&&e===a?this.canonical.key:Td(r,e,a,l,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new di(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new di(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Td(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Td(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new di(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new di(r,this.wrap,r,a,l),new di(r,this.wrap,r,a+1,l),new di(r,this.wrap,r,a,l+1),new di(r,this.wrap,r,a+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new di(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new di(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Td(s,e,r,a,l){const h=1<<Math.min(r,22);let p=h*(l%h)+a%h;return s&&r<22&&(p+=h*h*((s<0?-2*s-1:2*s)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}Et(ph,"CanonicalTileID"),Et(di,"OverscaledTileID",{omit:["projMatrix"]});class Bl extends ke{constructor(e,r,a){super(e,r),this.z=a}}function Ed(s,e){return s.x*e.x+s.y*e.y}function px(s,e){if(s.length===1){let r=0;const a=e[r++];let l;for(;!l||a.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const h=e[r],p=s[0],y=l.sub(a),b=h.sub(a),v=p.sub(a),E=Ed(y,y),k=Ed(y,b),M=Ed(b,b),L=Ed(v,y),R=Ed(v,b),B=E*M-k*k,X=(M*L-k*R)/B,re=(E*R-k*L)/B,pe=a.z*(1-X-re)+l.z*X+h.z*re;if(isFinite(pe))return pe}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function fx(s,e,r,a,l,h,p,y){const b=p*l.getElevationAt(s,e,!0,!0),v=h[0]!==0,E=v?h[1]===0?p*(h[0]/7-450):p*function(k,M,L){const R=Math.floor(M[0]/8),B=Math.floor(M[1]/8),X=10*(M[0]-8*R),re=10*(M[1]-8*B),pe=k.getElevationAt(R,B,!0,!0),ie=k.getMeterToDEM(L),ue=Math.floor(.5*(X*ie-1)),xe=Math.floor(.5*(re*ie-1)),ge=k.tileCoordToPixel(R,B),Fe=2*ue+1,Re=2*xe+1,He=function(ht,Ze,bt,At,vt){return[ht.getElevationAtPixel(Ze,bt,!0),ht.getElevationAtPixel(Ze+vt,bt,!0),ht.getElevationAtPixel(Ze,bt+vt,!0),ht.getElevationAtPixel(Ze+At,bt+vt,!0)]}(k,ge.x-ue,ge.y-xe,Fe,Re),ot=Math.abs(He[0]-He[1]),Ve=Math.abs(He[2]-He[3]),Je=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),Ye=Math.min(.25,.5*ie*(ot+Ve)/Fe),rt=Math.min(.25,.5*ie*Je/Re);return pe+Math.max(Ye*X,rt*re)}(l,h,y):b;return{base:b+(r===0)?-1:r,top:v?Math.max(E+a,b+r+2):b+a}}const Qv=Ce([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Jv}=Qv,Yv=Ce([{name:"a_packed",components:4,type:"Float32"}]),{members:ew}=Yv,tw=hh.types,sw=Math.cos(Math.PI/180*37.5);class fh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ue,this.layoutVertexArray2=new nt,this.indexArray=new It,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new mr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,l){this.hasPattern=yp("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:E,id:k,index:M,sourceLayerIndex:L}of e){const R=this.layers[0]._featureFilter.needGeometry,B=Fo(E,R);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),B,a))continue;const X=h?h.evaluate(B,{},a):void 0,re={id:k,properties:E.properties,type:E.type,sourceLayerIndex:L,index:M,geometry:R?B.geometry:la(E,a,l),patterns:{},sortKey:X};p.push(re)}h&&p.sort((E,k)=>E.sortKey-k.sortKey);const{lineAtlas:y,featureIndex:b}=r,v=this.addConstantDashes(y);for(const E of p){const{geometry:k,index:M,sourceLayerIndex:L}=E;if(v&&this.addFeatureDashes(E,y),this.hasPattern){const R=_p("line",this.layers,E,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(E,k,M,a,y.positions,r.availableImages);b.insert(e[M].feature,k,M,L,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind!=="constant"||h.kind!=="constant")r=!0;else{const p=h.value,y=l.value;if(!y)continue;e.addDash(y,p)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(h.kind==="constant"&&p.kind==="constant")continue;let y,b;if(h.kind==="constant"){if(y=h.value,!y)continue}else y=h.evaluate({zoom:a},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),r.addDash(y,b),e.patterns[l.id]=r.getKey(y,b)}}update(e,r,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,l)}addFeatures(e,r,a,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ew)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,l,h,p){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),v=y.get("line-cap").evaluate(e,{}),E=y.get("line-miter-limit"),k=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of r)this.addLine(M,e,b,v,E,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,p,l)}addLine(e,r,a,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<e.length-1;re++)this.totalDistance+=e[re].dist(e[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=tw[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let v=0;for(;v<b-1&&e[v].equals(e[v+1]);)v++;if(b<(y?3:2))return;a==="bevel"&&(h=1.05);const E=this.overscaling<=16?15*zt/(512*this.overscaling):0,k=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let M,L,R,B,X;this.e1=this.e2=-1,y&&(M=e[b-2],X=e[v].sub(M)._unit()._perp());for(let re=v;re<b;re++){if(R=re===b-1?y?e[v+1]:void 0:e[re+1],R&&e[re].equals(R))continue;X&&(B=X),M&&(L=M),M=e[re],X=R?R.sub(M)._unit()._perp():B,B=B||X;let pe=B.add(X);pe.x===0&&pe.y===0||pe._unit();const ie=B.x*X.x+B.y*X.y,ue=pe.x*X.x+pe.y*X.y,xe=ue!==0?1/ue:1/0,ge=2*Math.sqrt(2-2*ue),Fe=ue<sw&&L&&R,Re=B.x*X.y-B.y*X.x>0;if(Fe&&re>v){const Ve=M.dist(L);if(Ve>2*E){const Je=M.sub(M.sub(L)._mult(E/Ve)._round());this.updateDistance(L,Je),this.addCurrentVertex(Je,B,0,0,k),L=Je}}const He=L&&R;let ot=He?a:y?"butt":l;if(He&&ot==="round"&&(xe<p?ot="miter":xe<=2&&(ot="fakeround")),ot==="miter"&&xe>h&&(ot="bevel"),ot==="bevel"&&(xe>2&&(ot="flipbevel"),xe<h&&(ot="miter")),L&&this.updateDistance(L,M),ot==="miter")pe._mult(xe),this.addCurrentVertex(M,pe,0,0,k);else if(ot==="flipbevel"){if(xe>100)pe=X.mult(-1);else{const Ve=xe*B.add(X).mag()/B.sub(X).mag();pe._perp()._mult(Ve*(Re?-1:1))}this.addCurrentVertex(M,pe,0,0,k),this.addCurrentVertex(M,pe.mult(-1),0,0,k)}else if(ot==="bevel"||ot==="fakeround"){const Ve=-Math.sqrt(xe*xe-1),Je=Re?Ve:0,Ye=Re?0:Ve;if(L&&this.addCurrentVertex(M,B,Je,Ye,k),ot==="fakeround"){const rt=Math.round(180*ge/Math.PI/20);for(let ht=1;ht<rt;ht++){let Ze=ht/rt;if(Ze!==.5){const At=Ze-.5;Ze+=Ze*At*(Ze-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*At*At+(.848013+ie*(.215638*ie-1.06021)))}const bt=X.sub(B)._mult(Ze)._add(B)._unit()._mult(Re?-1:1);this.addHalfVertex(M,bt.x,bt.y,!1,Re,0,k)}}R&&this.addCurrentVertex(M,X,-Je,-Ye,k)}else if(ot==="butt")this.addCurrentVertex(M,pe,0,0,k);else if(ot==="square"){const Ve=L?1:-1;L||this.addCurrentVertex(M,pe,Ve,Ve,k),this.addCurrentVertex(M,pe,0,0,k),L&&this.addCurrentVertex(M,pe,Ve,Ve,k)}else ot==="round"&&(L&&(this.addCurrentVertex(M,B,0,0,k),this.addCurrentVertex(M,B,1,1,k,!0)),R&&(this.addCurrentVertex(M,X,-1,-1,k,!0),this.addCurrentVertex(M,X,0,0,k)));if(Fe&&re<b-1){const Ve=M.dist(R);if(Ve>2*E){const Je=M.add(R.sub(M)._mult(E/Ve)._round());this.updateDistance(M,Je),this.addCurrentVertex(Je,X,0,0,k),M=Je}}}}addCurrentVertex(e,r,a,l,h,p=!1){const y=r.y*l-r.x,b=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,p,!1,a,h),this.addHalfVertex(e,y,b,p,!0,-l,h)}addHalfVertex({x:e,y:r},a,l,h,p,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),b.primitiveLength++),p?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Et(fh,"LineBucket",{omit:["layers","patternFeatures"]});const rw=new le({"line-cap":new K(We.layout_line["line-cap"]),"line-join":new K(We.layout_line["line-join"]),"line-miter-limit":new F(We.layout_line["line-miter-limit"]),"line-round-limit":new F(We.layout_line["line-round-limit"]),"line-sort-key":new K(We.layout_line["line-sort-key"])});var gx={paint:new le({"line-opacity":new K(We.paint_line["line-opacity"]),"line-color":new K(We.paint_line["line-color"]),"line-translate":new F(We.paint_line["line-translate"]),"line-translate-anchor":new F(We.paint_line["line-translate-anchor"]),"line-width":new K(We.paint_line["line-width"]),"line-gap-width":new K(We.paint_line["line-gap-width"]),"line-offset":new K(We.paint_line["line-offset"]),"line-blur":new K(We.paint_line["line-blur"]),"line-dasharray":new K(We.paint_line["line-dasharray"]),"line-pattern":new K(We.paint_line["line-pattern"]),"line-gradient":new ae(We.paint_line["line-gradient"]),"line-trim-offset":new F(We.paint_line["line-trim-offset"])}),layout:rw};const xx=new class extends K{possiblyEvaluate(s,e){return e=new C(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(s,e)}evaluate(s,e,r,a){return e=js({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(s,e,r,a)}}(gx.paint.properties["line-width"].specification);function yx(s,e){return e>0?e+2*s:s}xx.useIntegerZoom=!0;const iw=Ce([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nw=Ce([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),aw=Ce([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ce([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ow=Ce([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),lw=Ce([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _x=Ce([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cw=Ce([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ce([{name:"triangle",components:3,type:"Uint16"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ce([{type:"Float32",name:"offsetX"}]),Ce([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ur=24;const vn=128;function vp(s,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new C(s+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:l}=r;let h=0;for(;h<a.length&&a[h]<=s;)h++;h=Math.max(0,h-1);let p=h;for(;p<a.length&&a[p]<s+1;)p++;p=Math.min(a.length-1,p);const y=a[h],b=a[p];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new C(y)),maxSize:r.evaluate(new C(b)),interpolationType:l}}}function gh(s,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:l}){return s.kind==="source"?a/vn:s.kind==="composite"?ms(a/vn,l/vn,r):e}function Ul(s,e){let r=0,a=0;if(s.kind==="constant")a=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=s,y=l?mt(Zi.interpolationFactor(l,e,h,p),0,1):0;s.kind==="camera"?a=ms(s.minSize,s.maxSize,y):r=y}return{uSizeT:r,uSize:a}}var dw=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:vn,evaluateSizeForFeature:gh,evaluateSizeForZoom:Ul,getSizeData:vp});function uw(s,e,r){return s.sections.forEach(a=>{a.text=function(l,h,p){const y=h.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),S.applyArabicShaping&&(l=S.applyArabicShaping(l)),l}(a.text,e,r)}),s}const Cd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function hw(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function mw(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var bx=Ls,vx=function(s,e,r,a,l){var h,p,y=8*l-a-1,b=(1<<y)-1,v=b>>1,E=-7,k=l-1,M=-1,L=s[e+k];for(k+=M,h=L&(1<<-E)-1,L>>=-E,E+=y;E>0;h=256*h+s[e+k],k+=M,E-=8);for(p=h&(1<<-E)-1,h>>=-E,E+=a;E>0;p=256*p+s[e+k],k+=M,E-=8);if(h===0)h=1-v;else{if(h===b)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,a),h-=v}return(L?-1:1)*p*Math.pow(2,h-a)},wx=function(s,e,r,a,l,h){var p,y,b,v=8*h-l-1,E=(1<<v)-1,k=E>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=0,R=1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,p=E):(p=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-p))<1&&(p--,b*=2),(e+=p+k>=1?M/b:M*Math.pow(2,1-k))*b>=2&&(p++,b/=2),p+k>=E?(y=0,p=E):p+k>=1?(y=(e*b-1)*Math.pow(2,l),p+=k):(y=e*Math.pow(2,k-1)*Math.pow(2,l),p=0));l>=8;s[r+L]=255&y,L+=R,y/=256,l-=8);for(p=p<<l|y,v+=l;v>0;s[r+L]=255&p,L+=R,p/=256,v-=8);s[r+L-R]|=128*B};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Ls(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Ls.Varint=0,Ls.Fixed64=1,Ls.Bytes=2,Ls.Fixed32=5;var wp=4294967296,jx=1/wp,Nx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function da(s){return s.type===Ls.Bytes?s.readVarint()+s.pos:s.pos+1}function Vl(s,e,r){return r?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function Sx(s,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=s;l--)r.buf[l+a]=r.buf[l]}function pw(s,e){for(var r=0;r<s.length;r++)e.writeVarint(s[r])}function fw(s,e){for(var r=0;r<s.length;r++)e.writeSVarint(s[r])}function gw(s,e){for(var r=0;r<s.length;r++)e.writeFloat(s[r])}function xw(s,e){for(var r=0;r<s.length;r++)e.writeDouble(s[r])}function yw(s,e){for(var r=0;r<s.length;r++)e.writeBoolean(s[r])}function _w(s,e){for(var r=0;r<s.length;r++)e.writeFixed32(s[r])}function bw(s,e){for(var r=0;r<s.length;r++)e.writeSFixed32(s[r])}function vw(s,e){for(var r=0;r<s.length;r++)e.writeFixed64(s[r])}function ww(s,e){for(var r=0;r<s.length;r++)e.writeSFixed64(s[r])}function xh(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+16777216*s[e+3]}function ql(s,e,r){s[r]=e,s[r+1]=e>>>8,s[r+2]=e>>>16,s[r+3]=e>>>24}function Tx(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+(s[e+3]<<24)}Ls.prototype={destroy:function(){this.buf=null},readFields:function(s,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,h=this.pos;this.type=7&a,s(l,e,this),this.pos===h&&this.skip(a)}return e},readMessage:function(s,e){return this.readFields(s,e,this.readVarint()+this.pos)},readFixed32:function(){var s=xh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Tx(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=xh(this.buf,this.pos)+xh(this.buf,this.pos+4)*wp;return this.pos+=8,s},readSFixed64:function(){var s=xh(this.buf,this.pos)+Tx(this.buf,this.pos+4)*wp;return this.pos+=8,s},readFloat:function(){var s=vx(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=vx(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(l,h,p){var y,b,v=p.buf;if(y=(112&(b=v[p.pos++]))>>4,b<128||(y|=(127&(b=v[p.pos++]))<<3,b<128)||(y|=(127&(b=v[p.pos++]))<<10,b<128)||(y|=(127&(b=v[p.pos++]))<<17,b<128)||(y|=(127&(b=v[p.pos++]))<<24,b<128)||(y|=(1&(b=v[p.pos++]))<<31,b<128))return Vl(l,y,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&Nx?function(r,a,l){return Nx.decode(r.subarray(a,l))}(this.buf,e,s):function(r,a,l){for(var h="",p=a;p<l;){var y,b,v,E=r[p],k=null,M=E>239?4:E>223?3:E>191?2:1;if(p+M>l)break;M===1?E<128&&(k=E):M===2?(192&(y=r[p+1]))==128&&(k=(31&E)<<6|63&y)<=127&&(k=null):M===3?(b=r[p+2],(192&(y=r[p+1]))==128&&(192&b)==128&&((k=(15&E)<<12|(63&y)<<6|63&b)<=2047||k>=55296&&k<=57343)&&(k=null)):M===4&&(b=r[p+2],v=r[p+3],(192&(y=r[p+1]))==128&&(192&b)==128&&(192&v)==128&&((k=(15&E)<<18|(63&y)<<12|(63&b)<<6|63&v)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,M=1):k>65535&&(k-=65536,h+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),h+=String.fromCharCode(k),p+=M}return h}(this.buf,e,s)},readBytes:function(){var s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e},readPackedVarint:function(s,e){if(this.type!==Ls.Bytes)return s.push(this.readVarint(e));var r=da(this);for(s=s||[];this.pos<r;)s.push(this.readVarint(e));return s},readPackedSVarint:function(s){if(this.type!==Ls.Bytes)return s.push(this.readSVarint());var e=da(this);for(s=s||[];this.pos<e;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Ls.Bytes)return s.push(this.readBoolean());var e=da(this);for(s=s||[];this.pos<e;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Ls.Bytes)return s.push(this.readFloat());var e=da(this);for(s=s||[];this.pos<e;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Ls.Bytes)return s.push(this.readDouble());var e=da(this);for(s=s||[];this.pos<e;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Ls.Bytes)return s.push(this.readFixed32());var e=da(this);for(s=s||[];this.pos<e;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Ls.Bytes)return s.push(this.readSFixed32());var e=da(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Ls.Bytes)return s.push(this.readFixed64());var e=da(this);for(s=s||[];this.pos<e;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Ls.Bytes)return s.push(this.readSFixed64());var e=da(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed64());return s},skip:function(s){var e=7&s;if(e===Ls.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ls.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ls.Fixed32)this.pos+=4;else{if(e!==Ls.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(s,e){this.writeVarint(s<<3|e)},realloc:function(s){for(var e=this.length||16;e<this.pos+s;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),ql(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),ql(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),ql(this.buf,-1&s,this.pos),ql(this.buf,Math.floor(s*jx),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),ql(this.buf,-1&s,this.pos),ql(this.buf,Math.floor(s*jx),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(e,r){var a,l;if(e>=0?(a=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,p,y){y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,y.buf[y.pos]=127&(h>>>=7)}(a,0,r),function(h,p){var y=(7&h)<<4;p.buf[p.pos++]|=y|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,r)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var e=this.pos;this.pos=function(a,l,h){for(var p,y,b=0;b<l.length;b++){if((p=l.charCodeAt(b))>55295&&p<57344){if(!y){p>56319||b+1===l.length?(a[h++]=239,a[h++]=191,a[h++]=189):y=p;continue}if(p<56320){a[h++]=239,a[h++]=191,a[h++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(a[h++]=239,a[h++]=191,a[h++]=189,y=null);p<128?a[h++]=p:(p<2048?a[h++]=p>>6|192:(p<65536?a[h++]=p>>12|224:(a[h++]=p>>18|240,a[h++]=p>>12&63|128),a[h++]=p>>6&63|128),a[h++]=63&p|128)}return h}(this.buf,s,this.pos);var r=this.pos-e;r>=128&&Sx(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(s){this.realloc(4),wx(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),wx(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var e=s.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=s[r]},writeRawMessage:function(s,e){this.pos++;var r=this.pos;s(e,this);var a=this.pos-r;a>=128&&Sx(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(s,e,r){this.writeTag(s,Ls.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(s,e){e.length&&this.writeMessage(s,pw,e)},writePackedSVarint:function(s,e){e.length&&this.writeMessage(s,fw,e)},writePackedBoolean:function(s,e){e.length&&this.writeMessage(s,yw,e)},writePackedFloat:function(s,e){e.length&&this.writeMessage(s,gw,e)},writePackedDouble:function(s,e){e.length&&this.writeMessage(s,xw,e)},writePackedFixed32:function(s,e){e.length&&this.writeMessage(s,_w,e)},writePackedSFixed32:function(s,e){e.length&&this.writeMessage(s,bw,e)},writePackedFixed64:function(s,e){e.length&&this.writeMessage(s,vw,e)},writePackedSFixed64:function(s,e){e.length&&this.writeMessage(s,ww,e)},writeBytesField:function(s,e){this.writeTag(s,Ls.Bytes),this.writeBytes(e)},writeFixed32Field:function(s,e){this.writeTag(s,Ls.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(s,e){this.writeTag(s,Ls.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(s,e){this.writeTag(s,Ls.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(s,e){this.writeTag(s,Ls.Fixed64),this.writeSFixed64(e)},writeVarintField:function(s,e){this.writeTag(s,Ls.Varint),this.writeVarint(e)},writeSVarintField:function(s,e){this.writeTag(s,Ls.Varint),this.writeSVarint(e)},writeStringField:function(s,e){this.writeTag(s,Ls.Bytes),this.writeString(e)},writeFloatField:function(s,e){this.writeTag(s,Ls.Fixed32),this.writeFloat(e)},writeDoubleField:function(s,e){this.writeTag(s,Ls.Fixed64),this.writeDouble(e)},writeBooleanField:function(s,e){this.writeVarintField(s,!!e)}};var yh=Ne(bx);const jp=3;function jw(s,e,r){e.glyphs=[],s===1&&r.readMessage(Nw,e)}function Nw(s,e,r){if(s===3){const{id:a,bitmap:l,width:h,height:p,left:y,top:b,advance:v}=r.readMessage(Sw,{});e.glyphs.push({id:a,bitmap:new ca({width:h+2*jp,height:p+2*jp},l),metrics:{width:h,height:p,left:y,top:b,advance:v}})}else s===4?e.ascender=r.readSVarint():s===5&&(e.descender=r.readSVarint())}function Sw(s,e,r){s===1?e.id=r.readVarint():s===2?e.bitmap=r.readBytes():s===3?e.width=r.readVarint():s===4?e.height=r.readVarint():s===5?e.left=r.readSVarint():s===6?e.top=r.readSVarint():s===7&&(e.advance=r.readVarint())}const Ex=jp;function Np(s){let e=0,r=0;for(const p of s)e+=p.w*p.h,r=Math.max(r,p.w);s.sort((p,y)=>y.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,h=0;for(const p of s)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===b.w&&p.h===b.h){const v=a.pop();y<a.length&&(a[y]=v)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(a.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}const _i=1;class Sp{constructor(e,{pixelRatio:r,version:a,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+_i,this.paddedRect.y+_i]}get br(){return[this.paddedRect.x+this.paddedRect.w-_i,this.paddedRect.y+this.paddedRect.h-_i]}get displaySize(){return[(this.paddedRect.w-2*_i)/this.pixelRatio,(this.paddedRect.h-2*_i)/this.pixelRatio]}}class Cx{constructor(e,r){const a={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,a,h),this.addImages(r,l,h);const{w:p,h:y}=Np(h),b=new ki({width:p||1,height:y||1});for(const v in e){const E=e[v],k=a[v].paddedRect;ki.copy(E.data,b,{x:0,y:0},{x:k.x+_i,y:k.y+_i},E.data)}for(const v in r){const E=r[v],k=l[v].paddedRect,M=k.x+_i,L=k.y+_i,R=E.data.width,B=E.data.height;ki.copy(E.data,b,{x:0,y:0},{x:M,y:L},E.data),ki.copy(E.data,b,{x:0,y:B-1},{x:M,y:L-1},{width:R,height:1}),ki.copy(E.data,b,{x:0,y:0},{x:M,y:L+B},{width:R,height:1}),ki.copy(E.data,b,{x:R-1,y:0},{x:M-1,y:L},{width:1,height:B}),ki.copy(E.data,b,{x:0,y:0},{x:M+R,y:L},{width:1,height:B})}this.image=b,this.iconPositions=a,this.patternPositions=l}addImages(e,r,a){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2*_i,h:h.data.height+2*_i};a.push(p),r[l]=new Sp(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,h]=e.tl;a.update(r.data,void 0,{x:l,y:h})}}Et(Sp,"ImagePosition"),Et(Cx,"ImageAtlas");const Ui={horizontal:1,vertical:2,horizontalOnly:3},kx=-17;class kd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new kd;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new kd;return r.imageName=e,r}}class $l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new $l;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?a.addImageSection(h):a.addTextSection(h,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,a){let l="";for(let h=0;h<r.length;h++){const p=r.charCodeAt(h+1)||null,y=r.charCodeAt(h-1)||null;l+=!a&&(p&&Wu(p)&&!Cd[r[h+1]]||y&&Wu(y)&&!Cd[r[h-1]])||!Cd[r[h]]?r[h]:Cd[r[h]]}return l}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&_h[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&_h[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new $l;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(kd.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ds("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(kd.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ds("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tp(s,e,r,a,l,h,p,y,b,v,E,k,M,L,R){const B=$l.fromFeature(s,l);k===Ui.vertical&&B.verticalizePunctuation(M);let X=[];const re=function(ge,Fe,Re,He,ot,Ve){if(!ge)return[];const Je=[],Ye=function(bt,At,vt,$t,pt,Rt){let Gt=0;for(let gs=0;gs<bt.length();gs++){const Zt=bt.getSection(gs);Gt+=Ax(bt.getCharCode(gs),Zt,$t,pt,At,Rt)}return Gt/Math.max(1,Math.ceil(Gt/vt))}(ge,Fe,Re,He,ot,Ve),rt=ge.text.indexOf("")>=0;let ht=0;for(let bt=0;bt<ge.length();bt++){const At=ge.getSection(bt),vt=ge.getCharCode(bt);if(_h[vt]||(ht+=Ax(vt,At,He,ot,Fe,Ve)),bt<ge.length()-1){const $t=!((Ze=vt)<11904||!(jt["Bopomofo Extended"](Ze)||jt.Bopomofo(Ze)||jt["CJK Compatibility Forms"](Ze)||jt["CJK Compatibility Ideographs"](Ze)||jt["CJK Compatibility"](Ze)||jt["CJK Radicals Supplement"](Ze)||jt["CJK Strokes"](Ze)||jt["CJK Symbols and Punctuation"](Ze)||jt["CJK Unified Ideographs Extension A"](Ze)||jt["CJK Unified Ideographs"](Ze)||jt["Enclosed CJK Letters and Months"](Ze)||jt["Halfwidth and Fullwidth Forms"](Ze)||jt.Hiragana(Ze)||jt["Ideographic Description Characters"](Ze)||jt["Kangxi Radicals"](Ze)||jt["Katakana Phonetic Extensions"](Ze)||jt.Katakana(Ze)||jt["Vertical Forms"](Ze)||jt["Yi Radicals"](Ze)||jt["Yi Syllables"](Ze)));(Tw[vt]||$t||At.imageName)&&Je.push(Px(bt+1,ht,Ye,Je,Ew(vt,ge.getCharCode(bt+1),$t&&rt),!1))}}var Ze;return Ix(Px(ge.length(),ht,Ye,Je,0,!0))}(B,v,h,e,a,L),{processBidirectionalText:pe,processStyledBidirectionalText:ie}=S;if(pe&&B.sections.length===1){const ge=pe(B.toString(),re);for(const Fe of ge){const Re=new $l;Re.text=Fe,Re.sections=B.sections;for(let He=0;He<Fe.length;He++)Re.sectionIndex.push(0);X.push(Re)}}else if(ie){const ge=ie(B.text,B.sectionIndex,re);for(const Fe of ge){const Re=new $l;Re.text=Fe[0],Re.sectionIndex=Fe[1],Re.sections=B.sections,X.push(Re)}}else X=function(ge,Fe){const Re=[],He=ge.text;let ot=0;for(const Ve of Fe)Re.push(ge.substring(ot,Ve)),ot=Ve;return ot<He.length&&Re.push(ge.substring(ot,He.length)),Re}(B,re);const ue=[],xe={positionedLines:ue,text:B.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Fe,Re,He,ot,Ve,Je,Ye,rt,ht,Ze,bt){let At=0,vt=0,$t=0;const pt=Ye==="right"?1:Ye==="left"?0:.5;let Rt=!1;for(const Kt of ot){const Qt=Kt.getSections();for(const As of Qt){if(As.imageName)continue;const Rs=Fe[As.fontStack];if(Rs&&(Rt=Rs.ascender!==void 0&&Rs.descender!==void 0,!Rt))break}if(!Rt)break}let Gt=0;for(const Kt of ot){Kt.trim();const Qt=Kt.getMaxScale(),As=(Qt-1)*Ur,Rs={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Gt]=Rs;const zs=Rs.positionedGlyphs;let Ms=0;if(!Kt.length()){vt+=Ve,++Gt;continue}let Ws=0,Ks=0;for(let Ps=0;Ps<Kt.length();Ps++){const jr=Kt.getSection(Ps),gr=Kt.getSectionIndex(Ps),Hs=Kt.getCharCode(Ps);let ys=jr.scale,xr=null,Os=null,ui=null,yr=Ur,Vr=0;const Ir=!(rt===Ui.horizontal||!Ze&&!sd(Hs)||Ze&&(_h[Hs]||(gs=Hs,jt.Arabic(gs)||jt["Arabic Supplement"](gs)||jt["Arabic Extended-A"](gs)||jt["Arabic Presentation Forms-A"](gs)||jt["Arabic Presentation Forms-B"](gs))));if(jr.imageName){const hi=He[jr.imageName];if(!hi)continue;ui=jr.imageName,ge.iconsInText=ge.iconsInText||!0,Os=hi.paddedRect;const Dr=hi.displaySize;ys=ys*Ur/bt,xr={width:Dr[0],height:Dr[1],left:_i,top:-Ex,advance:Ir?Dr[1]:Dr[0],localGlyph:!1},Vr=Rt?-xr.height*ys:kx+Qt*Ur-Dr[1]*ys,yr=xr.advance;const Nn=(Ir?Dr[0]:Dr[1])*ys-Ur*Qt;Nn>0&&Nn>Ms&&(Ms=Nn)}else{const hi=Re[jr.fontStack];if(!hi)continue;hi[Hs]&&(Os=hi[Hs]);const Dr=Fe[jr.fontStack];if(!Dr)continue;const Nn=Dr.glyphs[Hs];if(!Nn)continue;if(xr=Nn.metrics,yr=Hs!==8203?Ur:0,Rt){const Ql=Dr.ascender!==void 0?Math.abs(Dr.ascender):0,Fd=Dr.descender!==void 0?Math.abs(Dr.descender):0,Bd=(Ql+Fd)*ys;Ws<Bd&&(Ws=Bd,Ks=(Ql-Fd)/2*ys),Vr=-Ql*ys}else Vr=kx+(Qt-ys)*Ur}Ir?(ge.verticalizable=!0,zs.push({glyph:Hs,imageName:ui,x:At,y:vt+Vr,vertical:Ir,scale:ys,localGlyph:xr.localGlyph,fontStack:jr.fontStack,sectionIndex:gr,metrics:xr,rect:Os}),At+=yr*ys+ht):(zs.push({glyph:Hs,imageName:ui,x:At,y:vt+Vr,vertical:Ir,scale:ys,localGlyph:xr.localGlyph,fontStack:jr.fontStack,sectionIndex:gr,metrics:xr,rect:Os}),At+=xr.advance*ys+ht)}zs.length!==0&&($t=Math.max(At-ht,$t),Rt?Dx(zs,pt,Ms,Ks,Ve*Qt/2):Dx(zs,pt,Ms,0,Ve/2)),At=0;const fr=Ve*Qt+Ms;Rs.lineOffset=Math.max(Ms,As),vt+=fr,++Gt}var gs;const Zt=vt,{horizontalAlign:Bt,verticalAlign:Bs}=Ep(Je);(function(Kt,Qt,As,Rs,zs,Ms){const Ws=(Qt-As)*zs,Ks=-Ms*Rs;for(const fr of Kt)for(const Ps of fr.positionedGlyphs)Ps.x+=Ws,Ps.y+=Ks})(ge.positionedLines,pt,Bt,Bs,$t,Zt),ge.top+=-Bs*Zt,ge.bottom=ge.top+Zt,ge.left+=-Bt*$t,ge.right=ge.left+$t,ge.hasBaseline=Rt}(xe,e,r,a,X,p,y,b,k,v,M,R),!function(ge){for(const Fe of ge)if(Fe.positionedGlyphs.length!==0)return!1;return!0}(ue)&&xe}const _h={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Tw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ax(s,e,r,a,l,h){if(e.imageName){const p=a[e.imageName];return p?p.displaySize[0]*e.scale*Ur/h+l:0}{const p=r[e.fontStack],y=p&&p.glyphs[s];return y?y.metrics.advance*e.scale+l:0}}function Mx(s,e,r,a){const l=Math.pow(s-e,2);return a?s<e?l/2:2*l:l+Math.abs(r)*r}function Ew(s,e,r){let a=0;return s===10&&(a-=1e4),r&&(a+=150),s!==40&&s!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Px(s,e,r,a,l,h){let p=null,y=Mx(e,r,l,h);for(const b of a){const v=Mx(e-b.x,r,l,h)+b.badness;v<=y&&(p=b,y=v)}return{index:s,x:e,priorBreak:p,badness:y}}function Ix(s){return s?Ix(s.priorBreak).concat(s.index):[]}function Ep(s){let e=.5,r=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Dx(s,e,r,a,l){if(!(e||r||a||l))return;const h=s.length-1,p=s[h],y=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=h;b++)s[b].x-=y,s[b].y+=r+a+l}function Cw(s,e,r){const{horizontalAlign:a,verticalAlign:l}=Ep(r),h=e[0]-s.displaySize[0]*a,p=e[1]-s.displaySize[1]*l;return{image:s,top:p,bottom:p+s.displaySize[1],left:h,right:h+s.displaySize[0]}}function Lx(s,e,r,a,l,h){const p=s.image;let y;if(p.content){const X=p.content,re=p.pixelRatio||1;y=[X[0]/re,X[1]/re,p.displaySize[0]-X[2]/re,p.displaySize[1]-X[3]/re]}const b=e.left*h,v=e.right*h;let E,k,M,L;r==="width"||r==="both"?(L=l[0]+b-a[3],k=l[0]+v+a[1]):(L=l[0]+(b+v-p.displaySize[0])/2,k=L+p.displaySize[0]);const R=e.top*h,B=e.bottom*h;return r==="height"||r==="both"?(E=l[1]+R-a[0],M=l[1]+B+a[2]):(E=l[1]+(R+B-p.displaySize[1])/2,M=E+p.displaySize[1]),{image:p,top:E,right:k,bottom:M,left:L,collisionPadding:y}}class ua extends ke{constructor(e,r,a,l,h){super(e,r),this.angle=l,this.z=a,h!==void 0&&(this.segment=h)}clone(){return new ua(this.x,this.y,this.z,this.angle,this.segment)}}function Rx(s,e,r,a,l){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,y=0;for(;y>-r/2;){if(p--,p<0)return!1;y-=s[p].dist(h),h=s[p]}y+=s[p].dist(s[p+1]),p++;const b=[];let v=0;for(;y<r/2;){const E=s[p],k=s[p+1];if(!k)return!1;let M=s[p-1].angleTo(E)-E.angleTo(k);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:M}),v+=M;y-b[0].distance>a;)v-=b.shift().angleDelta;if(v>l)return!1;p++,y+=E.dist(k)}return!0}function zx(s){let e=0;for(let r=0;r<s.length-1;r++)e+=s[r].dist(s[r+1]);return e}function Ox(s,e,r){return s?.6*e*r:0}function Fx(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function kw(s,e,r,a,l,h){const p=Ox(r,l,h),y=Fx(r,a)*h;let b=0;const v=zx(s)/2;for(let E=0;E<s.length-1;E++){const k=s[E],M=s[E+1],L=k.dist(M);if(b+L>v){const R=(v-b)/L,B=ms(k.x,M.x,R),X=ms(k.y,M.y,R),re=new ua(B,X,0,M.angleTo(k),E);return!p||Rx(s,re,y,p,e)?re:void 0}b+=L}}function Aw(s,e,r,a,l,h,p,y,b){const v=Ox(a,h,p),E=Fx(a,l),k=E*p,M=s[0].x===0||s[0].x===b||s[0].y===0||s[0].y===b;return e-k<e/4&&(e=k+e/4),Bx(s,M?e/2*y%e:(E/2+2*h)*p*y%e,e,v,r,k,M,!1,b)}function Bx(s,e,r,a,l,h,p,y,b){const v=h/2,E=zx(s);let k=0,M=e-r,L=[];for(let R=0;R<s.length-1;R++){const B=s[R],X=s[R+1],re=B.dist(X),pe=X.angleTo(B);for(;M+r<k+re;){M+=r;const ie=(M-k)/re,ue=ms(B.x,X.x,ie),xe=ms(B.y,X.y,ie);if(ue>=0&&ue<b&&xe>=0&&xe<b&&M-v>=0&&M+v<=E){const ge=new ua(ue,xe,0,pe,R);ge._round(),a&&!Rx(s,ge,h,a,l)||L.push(ge)}}k+=re}return y||L.length||p||(L=Bx(s,k/2,r,a,l,h,p,!0,b)),L}function Ux(s,e,r,a,l){const h=[];for(let p=0;p<s.length;p++){const y=s[p];let b;for(let v=0;v<y.length-1;v++){let E=y[v],k=y[v+1];E.x<e&&k.x<e||(E.x<e?E=new ke(e,E.y+(e-E.x)/(k.x-E.x)*(k.y-E.y))._round():k.x<e&&(k=new ke(e,E.y+(e-E.x)/(k.x-E.x)*(k.y-E.y))._round()),E.y<r&&k.y<r||(E.y<r?E=new ke(E.x+(r-E.y)/(k.y-E.y)*(k.x-E.x),r)._round():k.y<r&&(k=new ke(E.x+(r-E.y)/(k.y-E.y)*(k.x-E.x),r)._round()),E.x>=a&&k.x>=a||(E.x>=a?E=new ke(a,E.y+(a-E.x)/(k.x-E.x)*(k.y-E.y))._round():k.x>=a&&(k=new ke(a,E.y+(a-E.x)/(k.x-E.x)*(k.y-E.y))._round()),E.y>=l&&k.y>=l||(E.y>=l?E=new ke(E.x+(l-E.y)/(k.y-E.y)*(k.x-E.x),l)._round():k.y>=l&&(k=new ke(E.x+(l-E.y)/(k.y-E.y)*(k.x-E.x),l)._round()),b&&E.equals(b[b.length-1])||(b=[E],h.push(b)),b.push(k)))))}}return h}Et(ua,"Anchor");const Ad=1e20;function Vx(s,e,r,a,l,h,p,y,b){for(let v=e;v<e+a;v++)qx(s,r*h+v,h,l,p,y,b);for(let v=r;v<r+l;v++)qx(s,v*h+e,1,a,p,y,b)}function qx(s,e,r,a,l,h,p){h[0]=0,p[0]=-Ad,p[1]=Ad,l[0]=s[e];for(let y=1,b=0,v=0;y<a;y++){l[y]=s[e+y*r];const E=y*y;do{const k=h[b];v=(l[y]-l[k]+E-k*k)/(y-k)/2}while(v<=p[b]&&--b>-1);b++,h[b]=y,p[b]=v,p[b+1]=Ad}for(let y=0,b=0;y<a;y++){for(;p[b+1]<y;)b++;const v=h[b],E=y-v;s[e+y*r]=l[v]+E*E}}const wn=2,Cp={none:0,ideographs:1,all:2};class Gl{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const a=[];for(const l in e)for(const h of e[l])a.push({stack:l,id:h});Is(a,({stack:l,id:h},p)=>{let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[h];if(b!==void 0)return void p(null,{stack:l,id:h,glyph:b});if(b=this._tinySDF(y,l,h),b)return y.glyphs[h]=b,void p(null,{stack:l,id:h,glyph:b});const v=Math.floor(h/256);if(256*v>65535)return void p(new Error("glyphs > 65535 not supported"));if(y.ranges[v])return void p(null,{stack:l,id:h,glyph:b});let E=y.requests[v];E||(E=y.requests[v]=[],Gl.loadGlyphRange(l,v,this.url,this.requestManager,(k,M)=>{if(M){y.ascender=M.ascender,y.descender=M.descender;for(const L in M.glyphs)this._doesCharSupportLocalGlyph(+L)||(y.glyphs[+L]=M.glyphs[+L]);y.ranges[v]=!0}for(const L of E)L(k,M);delete y.requests[v]})),E.push((k,M)=>{k?p(k):M&&p(null,{stack:l,id:h,glyph:M.glyphs[h]||null})})},(l,h)=>{if(l)r(l);else if(h){const p={};for(const{stack:y,id:b,glyph:v}of h)p[y]===void 0&&(p[y]={}),p[y].glyphs===void 0&&(p[y].glyphs={}),p[y].glyphs[b]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},p[y].ascender=this.entries[y].ascender,p[y].descender=this.entries[y].descender;r(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Cp.none&&(this.localGlyphMode===Cp.all?!!this.localFontFamily:!!this.localFontFamily&&(jt["CJK Unified Ideographs"](e)||jt["Hangul Syllables"](e)||jt.Hiragana(e)||jt.Katakana(e)||jt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,a){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let B="400";/bold/i.test(r)?B="900":/medium/i.test(r)?B="500":/light/i.test(r)&&(B="200"),h=e.tinySDF=new Gl.TinySDF({fontFamily:l,fontWeight:B,fontSize:24*wn,buffer:3*wn,radius:8*wn}),h.fontWeight=B}if(this.localGlyphs[h.fontWeight][a])return this.localGlyphs[h.fontWeight][a];const p=String.fromCharCode(a),{data:y,width:b,height:v,glyphWidth:E,glyphHeight:k,glyphLeft:M,glyphTop:L,glyphAdvance:R}=h.draw(p);return this.localGlyphs[h.fontWeight][a]={id:a,bitmap:new ca({width:b,height:v},y),metrics:{width:E/wn,height:k/wn,left:M/wn,top:L/wn-27,advance:R/wn,localGlyph:!0}}}}Gl.loadGlyphRange=function(s,e,r,a,l){const h=256*e,p=h+255,y=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",s).replace("{range}",`${h}-${p}`),sr.Glyphs);Qr(y,(b,v)=>{if(b)l(b);else if(v){const E={},k=function(M){return new yh(M).readFields(jw,{})}(v);for(const M of k.glyphs)E[M.id]=M;l(null,{glyphs:E,ascender:k.ascender,descender:k.descender})}})},Gl.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const y=this.size=s+4*e,b=this._createCanvas(y),v=this.ctx=b.getContext("2d",{willReadFrequently:!0});v.font=`${p} ${h} ${s}px ${l}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(s),p=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),b=Math.min(this.size-this.buffer,p+Math.ceil(a)),v=y+2*this.buffer,E=b+2*this.buffer,k=Math.max(v*E,0),M=new Uint8ClampedArray(k),L={data:M,width:v,height:E,glyphWidth:y,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return L;const{ctx:R,buffer:B,gridInner:X,gridOuter:re}=this;R.clearRect(B,B,y,b),R.fillText(s,B,B+p);const pe=R.getImageData(B,B,y,b);re.fill(Ad,0,k),X.fill(0,0,k);for(let ie=0;ie<b;ie++)for(let ue=0;ue<y;ue++){const xe=pe.data[4*(ie*y+ue)+3]/255;if(xe===0)continue;const ge=(ie+B)*v+ue+B;if(xe===1)re[ge]=0,X[ge]=Ad;else{const Fe=.5-xe;re[ge]=Fe>0?Fe*Fe:0,X[ge]=Fe<0?Fe*Fe:0}}Vx(re,0,0,v,E,v,this.f,this.v,this.z),Vx(X,B,B,y,b,v,this.f,this.v,this.z);for(let ie=0;ie<k;ie++){const ue=Math.sqrt(re[ie])-Math.sqrt(X[ie]);M[ie]=Math.round(255-255*(ue/this.radius+this.cutoff))}return L}};const Zl=_i;function $x(s,e,r,a){const l=[],h=s.image,p=h.pixelRatio,y=h.paddedRect.w-2*Zl,b=h.paddedRect.h-2*Zl,v=s.right-s.left,E=s.bottom-s.top,k=h.stretchX||[[0,y]],M=h.stretchY||[[0,b]],L=(Ve,Je)=>Ve+Je[1]-Je[0],R=k.reduce(L,0),B=M.reduce(L,0),X=y-R,re=b-B;let pe=0,ie=R,ue=0,xe=B,ge=0,Fe=X,Re=0,He=re;if(h.content&&a){const Ve=h.content;pe=bh(k,0,Ve[0]),ue=bh(M,0,Ve[1]),ie=bh(k,Ve[0],Ve[2]),xe=bh(M,Ve[1],Ve[3]),ge=Ve[0]-pe,Re=Ve[1]-ue,Fe=Ve[2]-Ve[0]-ie,He=Ve[3]-Ve[1]-xe}const ot=(Ve,Je,Ye,rt)=>{const ht=vh(Ve.stretch-pe,ie,v,s.left),Ze=wh(Ve.fixed-ge,Fe,Ve.stretch,R),bt=vh(Je.stretch-ue,xe,E,s.top),At=wh(Je.fixed-Re,He,Je.stretch,B),vt=vh(Ye.stretch-pe,ie,v,s.left),$t=wh(Ye.fixed-ge,Fe,Ye.stretch,R),pt=vh(rt.stretch-ue,xe,E,s.top),Rt=wh(rt.fixed-Re,He,rt.stretch,B),Gt=new ke(ht,bt),gs=new ke(vt,bt),Zt=new ke(vt,pt),Bt=new ke(ht,pt),Bs=new ke(Ze/p,At/p),Kt=new ke($t/p,Rt/p),Qt=e*Math.PI/180;if(Qt){const zs=Math.sin(Qt),Ms=Math.cos(Qt),Ws=[Ms,-zs,zs,Ms];Gt._matMult(Ws),gs._matMult(Ws),Bt._matMult(Ws),Zt._matMult(Ws)}const As=Ve.stretch+Ve.fixed,Rs=Je.stretch+Je.fixed;return{tl:Gt,tr:gs,bl:Bt,br:Zt,tex:{x:h.paddedRect.x+Zl+As,y:h.paddedRect.y+Zl+Rs,w:Ye.stretch+Ye.fixed-As,h:rt.stretch+rt.fixed-Rs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bs,pixelOffsetBR:Kt,minFontScaleX:Fe/p/v,minFontScaleY:He/p/E,isSDF:r}};if(a&&(h.stretchX||h.stretchY)){const Ve=Gx(k,X,R),Je=Gx(M,re,B);for(let Ye=0;Ye<Ve.length-1;Ye++){const rt=Ve[Ye],ht=Ve[Ye+1];for(let Ze=0;Ze<Je.length-1;Ze++)l.push(ot(rt,Je[Ze],ht,Je[Ze+1]))}}else l.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return l}function bh(s,e,r){let a=0;for(const l of s)a+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return a}function Gx(s,e,r){const a=[{fixed:-Zl,stretch:0}];for(const[l,h]of s){const p=a[a.length-1];a.push({fixed:l-p.stretch,stretch:p.stretch}),a.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return a.push({fixed:e+Zl,stretch:r}),a}function vh(s,e,r,a){return s/e*r+a}function wh(s,e,r,a){return s-e*r/a}function Mw(s,e,r,a){const l=e+s.positionedLines[a].lineOffset;return a===0?r+l/2:r+(l+(e+s.positionedLines[a-1].lineOffset))/2}class Pw{constructor(e=[],r=Iw){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,l=r[e];for(;e>0;){const h=e-1>>1,p=r[h];if(a(l,p)>=0)break;r[e]=p,e=h}r[e]=l}_down(e){const{data:r,compare:a}=this,l=this.length>>1,h=r[e];for(;e<l;){let p=1+(e<<1),y=r[p];const b=p+1;if(b<this.length&&a(r[b],y)<0&&(p=b,y=r[b]),a(y,h)>=0)break;r[e]=y,e=p}r[e]=h}}function Iw(s,e){return s<e?-1:s>e?1:0}function Dw(s,e=1,r=!1){let a=1/0,l=1/0,h=-1/0,p=-1/0;const y=s[0];for(let L=0;L<y.length;L++){const R=y[L];(!L||R.x<a)&&(a=R.x),(!L||R.y<l)&&(l=R.y),(!L||R.x>h)&&(h=R.x),(!L||R.y>p)&&(p=R.y)}const b=Math.min(h-a,p-l);let v=b/2;const E=new Pw([],Lw);if(b===0)return new ke(a,l);for(let L=a;L<h;L+=b)for(let R=l;R<p;R+=b)E.push(new Wl(L+v,R+v,v,s));let k=function(L){let R=0,B=0,X=0;const re=L[0];for(let pe=0,ie=re.length,ue=ie-1;pe<ie;ue=pe++){const xe=re[pe],ge=re[ue],Fe=xe.x*ge.y-ge.x*xe.y;B+=(xe.x+ge.x)*Fe,X+=(xe.y+ge.y)*Fe,R+=3*Fe}return new Wl(B/R,X/R,0,L)}(s),M=E.length;for(;E.length;){const L=E.pop();(L.d>k.d||!k.d)&&(k=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-k.d<=e||(v=L.h/2,E.push(new Wl(L.p.x-v,L.p.y-v,v,s)),E.push(new Wl(L.p.x+v,L.p.y-v,v,s)),E.push(new Wl(L.p.x-v,L.p.y+v,v,s)),E.push(new Wl(L.p.x+v,L.p.y+v,v,s)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${k.d}`)),k.p}function Lw(s,e){return e.max-s.max}class Wl{constructor(e,r,a,l){this.p=new ke(e,r),this.h=a,this.d=function(h,p){let y=!1,b=1/0;for(let v=0;v<p.length;v++){const E=p[v];for(let k=0,M=E.length,L=M-1;k<M;L=k++){const R=E[k],B=E[L];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(y=!y),b=Math.min(b,Bg(h,R,B))}}return(y?1:-1)*Math.sqrt(b)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Hl=7,kp=Number.POSITIVE_INFINITY,Rw=Math.sqrt(2);function Zx(s,[e,r]){let a=0,l=0;if(r===kp){e<0&&(e=0);const h=e/Rw;switch(s){case"top-right":case"top-left":l=h-Hl;break;case"bottom-right":case"bottom-left":l=-h+Hl;break;case"bottom":l=-e+Hl;break;case"top":l=e-Hl}switch(s){case"top-right":case"bottom-right":a=-h;break;case"top-left":case"bottom-left":a=h;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),s){case"top-right":case"top-left":case"top":l=r-Hl;break;case"bottom-right":case"bottom-left":case"bottom":l=-r+Hl}switch(s){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,l]}function zw(s,e,r,a,l,h,p,y,b,v){s.createArrays(),s.tilePixelRatio=zt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const E=s.layers[0].layout,k=s.layers[0]._unevaluatedLayout._values,M={};if(s.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:X}=s.textSizeData;M.compositeTextSizes=[k["text-size"].possiblyEvaluate(new C(B),y),k["text-size"].possiblyEvaluate(new C(X),y)]}if(s.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:X}=s.iconSizeData;M.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new C(B),y),k["icon-size"].possiblyEvaluate(new C(X),y)]}M.layoutTextSize=k["text-size"].possiblyEvaluate(new C(b+1),y),M.layoutIconSize=k["icon-size"].possiblyEvaluate(new C(b+1),y),M.textMaxSize=k["text-size"].possiblyEvaluate(new C(18),y);const L=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",R=E.get("text-size");for(const B of s.features){const X=E.get("text-font").evaluate(B,{},y).join(","),re=R.evaluate(B,{},y),pe=M.layoutTextSize.evaluate(B,{},y),ie=(M.layoutIconSize.evaluate(B,{},y),{horizontal:{},vertical:void 0}),ue=B.text;let xe,ge=[0,0];if(ue){const He=ue.toString(),ot=E.get("text-letter-spacing").evaluate(B,{},y)*Ur,Ve=E.get("text-line-height").evaluate(B,{},y)*Ur,Je=Om(He)?ot:0,Ye=E.get("text-anchor").evaluate(B,{},y),rt=E.get("text-variable-anchor");if(!rt){const vt=E.get("text-radial-offset").evaluate(B,{},y);ge=vt?Zx(Ye,[vt*Ur,kp]):E.get("text-offset").evaluate(B,{},y).map($t=>$t*Ur)}let ht=L?"center":E.get("text-justify").evaluate(B,{},y);const Ze=E.get("symbol-placement")==="point",bt=Ze?E.get("text-max-width").evaluate(B,{},y)*Ur:1/0,At=vt=>{s.allowVerticalPlacement&&td(He)&&(ie.vertical=Tp(ue,e,r,l,X,bt,Ve,Ye,vt,Je,ge,Ui.vertical,!0,pe,re))};if(!L&&rt){const vt=ht==="auto"?rt.map(pt=>Ap(pt)):[ht];let $t=!1;for(let pt=0;pt<vt.length;pt++){const Rt=vt[pt];if(!ie.horizontal[Rt])if($t)ie.horizontal[Rt]=ie.horizontal[0];else{const Gt=Tp(ue,e,r,l,X,bt,Ve,"center",Rt,Je,ge,Ui.horizontal,!1,pe,re);Gt&&(ie.horizontal[Rt]=Gt,$t=Gt.positionedLines.length===1)}}At("left")}else{if(ht==="auto"&&(ht=Ap(Ye)),Ze||E.get("text-writing-mode").indexOf("horizontal")>=0||!td(He)){const vt=Tp(ue,e,r,l,X,bt,Ve,Ye,ht,Je,ge,Ui.horizontal,!1,pe,re);vt&&(ie.horizontal[ht]=vt)}At(Ze?"left":ht)}}let Fe=!1;if(B.icon&&B.icon.name){const He=a[B.icon.name];He&&(xe=Cw(l[B.icon.name],E.get("icon-offset").evaluate(B,{},y),E.get("icon-anchor").evaluate(B,{},y)),Fe=He.sdf,s.sdfIcons===void 0?s.sdfIcons=He.sdf:s.sdfIcons!==He.sdf&&Ds("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==s.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const Re=Hx(ie.horizontal)||ie.vertical;s.iconsInText||(s.iconsInText=!!Re&&Re.iconsInText),(Re||xe)&&Ow(s,B,ie,xe,a,M,pe,0,ge,Fe,p,y,v)}h&&s.generateCollisionDebugBuffers(b,s.collisionBoxArray)}function Ap(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ow(s,e,r,a,l,h,p,y,b,v,E,k,M){let L=h.textMaxSize.evaluate(e,{},k);L===void 0&&(L=p);const R=s.layers[0].layout,B=R.get("icon-offset").evaluate(e,{},k),X=Hx(r.horizontal)||r.vertical,re=M.name==="globe",pe=Ur,ie=p/pe,ue=s.tilePixelRatio*L/pe,xe=(Ye=s.overscaling,s.zoom>18&&Ye>2&&(Ye>>=1),Math.max(zt/(512*Ye),1)*R.get("symbol-spacing")),ge=R.get("text-padding")*s.tilePixelRatio,Fe=R.get("icon-padding")*s.tilePixelRatio,Re=Me(R.get("text-max-angle")),He=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ot=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",Ve=R.get("symbol-placement"),Je=xe/2;var Ye;const rt=R.get("icon-text-fit");let ht;a&&rt!=="none"&&(s.allowVerticalPlacement&&r.vertical&&(ht=Lx(a,r.vertical,rt,R.get("icon-text-fit-padding"),B,ie)),X&&(a=Lx(a,X,rt,R.get("icon-text-fit-padding"),B,ie)));const Ze=(bt,At,vt)=>{if(At.x<0||At.x>=zt||At.y<0||At.y>=zt)return;let $t=null;if(re){const{x:pt,y:Rt,z:Gt}=M.projectTilePoint(At.x,At.y,vt);$t={anchor:new ua(pt,Rt,Gt,0,void 0),up:M.upVector(vt,At.x,At.y)}}(function(pt,Rt,Gt,gs,Zt,Bt,Bs,Kt,Qt,As,Rs,zs,Ms,Ws,Ks,fr,Ps,jr,gr,Hs,ys,xr,Os,ui,yr){const Vr=pt.addToLineVertexArray(Rt,gs);let Ir,hi,Dr,Nn,Ql,Fd,Bd,Ey=0,Cy=0,ky=0,Ay=0,Gp=-1,Zp=-1;const Un={};let My=Um("");const $o=Gt?Gt.anchor:Rt;let Wp=0,Hp=0;if(Qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Wp,Hp]=Qt.layout.get("text-offset").evaluate(ys,{},yr).map(Ai=>Ai*Ur):(Wp=Qt.layout.get("text-radial-offset").evaluate(ys,{},yr)*Ur,Hp=kp),pt.allowVerticalPlacement&&Zt.vertical){const Ai=Zt.vertical;if(Ks)Fd=Mp(Ai),Kt&&(Bd=Mp(Kt));else{const Mi=Qt.layout.get("text-rotate").evaluate(ys,{},yr)+90;Dr=jh(As,$o,Rt,Rs,zs,Ms,Ai,Ws,Mi,fr),Kt&&(Nn=jh(As,$o,Rt,Rs,zs,Ms,Kt,jr,Mi))}}if(Bt){const Ai=Qt.layout.get("icon-rotate").evaluate(ys,{},yr),Mi=Qt.layout.get("icon-text-fit")!=="none",Ud=$x(Bt,Ai,Os,Mi),Kp=Kt?$x(Kt,Ai,Os,Mi):void 0;hi=jh(As,$o,Rt,Rs,zs,Ms,Bt,jr,Ai),Ey=4*Ud.length;const Py=pt.iconSizeData;let Go=null;Py.kind==="source"?(Go=[vn*Qt.layout.get("icon-size").evaluate(ys,{},yr)],Go[0]>Ba&&Ds(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Md}. Reduce your "icon-size".`)):Py.kind==="composite"&&(Go=[vn*xr.compositeIconSizes[0].evaluate(ys,{},yr),vn*xr.compositeIconSizes[1].evaluate(ys,{},yr)],(Go[0]>Ba||Go[1]>Ba)&&Ds(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Md}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,Ud,Go,Hs,gr,ys,!1,Gt,Rt,Vr.lineStartIndex,Vr.lineLength,-1,ui,yr),Gp=pt.icon.placedSymbolArray.length-1,Kp&&(Cy=4*Kp.length,pt.addSymbols(pt.icon,Kp,Go,Hs,gr,ys,Ui.vertical,Gt,Rt,Vr.lineStartIndex,Vr.lineLength,-1,ui,yr),Zp=pt.icon.placedSymbolArray.length-1)}for(const Ai in Zt.horizontal){const Mi=Zt.horizontal[Ai];Ir||(My=Um(Mi.text),Ks?Ql=Mp(Mi):Ir=jh(As,$o,Rt,Rs,zs,Ms,Mi,Ws,Qt.layout.get("text-rotate").evaluate(ys,{},yr),fr));const Ud=Mi.positionedLines.length===1;if(ky+=Wx(pt,Gt,Rt,Mi,Bs,Qt,Ks,ys,fr,Vr,Zt.vertical?Ui.horizontal:Ui.horizontalOnly,Ud?Object.keys(Zt.horizontal):[Ai],Un,Gp,xr,ui,yr),Ud)break}Zt.vertical&&(Ay+=Wx(pt,Gt,Rt,Zt.vertical,Bs,Qt,Ks,ys,fr,Vr,Ui.vertical,["vertical"],Un,Zp,xr,ui,yr));let Za=-1;const Xp=(Ai,Mi)=>Ai?Math.max(Ai,Mi):Mi;Za=Xp(Ql,Za),Za=Xp(Fd,Za),Za=Xp(Bd,Za);const h1=Za>-1?1:0;pt.glyphOffsetArray.length>=Va.MAX_GLYPHS&&Ds("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ys.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,ys.sortKey),pt.symbolInstances.emplaceBack($o.x,$o.y,$o.z,Rt.x,Rt.y,Un.right>=0?Un.right:-1,Un.center>=0?Un.center:-1,Un.left>=0?Un.left:-1,Un.vertical>=0?Un.vertical:-1,Gp,Zp,My,Ir!==void 0?Ir:pt.collisionBoxArray.length,Ir!==void 0?Ir+1:pt.collisionBoxArray.length,Dr!==void 0?Dr:pt.collisionBoxArray.length,Dr!==void 0?Dr+1:pt.collisionBoxArray.length,hi!==void 0?hi:pt.collisionBoxArray.length,hi!==void 0?hi+1:pt.collisionBoxArray.length,Nn||pt.collisionBoxArray.length,Nn?Nn+1:pt.collisionBoxArray.length,Rs,ky,Ay,Ey,Cy,h1,0,Wp,Hp,Za)})(s,At,$t,bt,r,a,l,ht,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,ge,He,b,0,Fe,ot,B,e,h,v,E,k)};if(Ve==="line")for(const bt of Ux(e.geometry,0,0,zt,zt)){const At=Aw(bt,xe,Re,r.vertical||X,a,pe,ue,s.overscaling,zt);for(const vt of At)X&&Fw(s,X.text,Je,vt)||Ze(bt,vt,k)}else if(Ve==="line-center"){for(const bt of e.geometry)if(bt.length>1){const At=kw(bt,Re,r.vertical||X,a,pe,ue);At&&Ze(bt,At,k)}}else if(e.type==="Polygon")for(const bt of xp(e.geometry,0)){const At=Dw(bt,16);Ze(bt[0],new ua(At.x,At.y,0,0,void 0),k)}else if(e.type==="LineString")for(const bt of e.geometry)Ze(bt,new ua(bt[0].x,bt[0].y,0,0,void 0),k);else if(e.type==="Point")for(const bt of e.geometry)for(const At of bt)Ze([At],new ua(At.x,At.y,0,0,void 0),k)}const Md=255,Ba=Md*vn;function Wx(s,e,r,a,l,h,p,y,b,v,E,k,M,L,R,B,X){const re=function(ue,xe,ge,Fe,Re,He,ot,Ve){const Je=[];if(xe.positionedLines.length===0)return Je;const Ye=Fe.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,rt=function(vt){const $t=vt[0],pt=vt[1],Rt=$t*pt;return Rt>0?[$t,-pt]:Rt<0?[-$t,pt]:$t===0?[pt,$t]:[pt,-$t]}(ge);let ht=Math.abs(xe.top-xe.bottom);for(const vt of xe.positionedLines)ht-=vt.lineOffset;const Ze=xe.positionedLines.length,bt=ht/Ze;let At=xe.top-ge[1];for(let vt=0;vt<Ze;++vt){const $t=xe.positionedLines[vt];At=Mw(xe,bt,At,vt);for(const pt of $t.positionedGlyphs){if(!pt.rect)continue;const Rt=pt.rect||{};let Gt=Ex+1,gs=!0,Zt=1,Bt=0;if(pt.imageName){const Os=ot[pt.imageName];if(!Os)continue;if(Os.sdf){Ds("SDF images are not supported in formatted text and will be ignored.");continue}gs=!1,Zt=Os.pixelRatio,Gt=_i/Zt}const Bs=(Re||Ve)&&pt.vertical,Kt=pt.metrics.advance*pt.scale/2,Qt=pt.metrics,As=pt.rect;if(As===null)continue;Ve&&xe.verticalizable&&(Bt=pt.imageName?Kt-pt.metrics.width*pt.scale/2:0);const Rs=Re?[pt.x+Kt,pt.y]:[0,0];let zs=[0,0],Ms=[0,0],Ws=!1;Re||(Bs?(Ms=[pt.x+Kt+rt[0],pt.y+rt[1]-Bt],Ws=!0):zs=[pt.x+Kt+ge[0],pt.y+ge[1]-Bt]);const Ks=As.w*pt.scale/(Zt*(pt.localGlyph?wn:1)),fr=As.h*pt.scale/(Zt*(pt.localGlyph?wn:1));let Ps,jr,gr,Hs;if(Bs){const Os=pt.y-At,ui=new ke(-Kt,Kt-Os),yr=-Math.PI/2,Vr=new ke(...Ms);Ps=new ke(-Kt+zs[0],zs[1]),Ps._rotateAround(yr,ui)._add(Vr),Ps.x+=-Os+Kt,Ps.y-=(Qt.left-Gt)*pt.scale;const Ir=pt.imageName?Qt.advance*pt.scale:Ur*pt.scale,hi=String.fromCharCode(pt.glyph);hw(hi)?Ps.x+=(1-Gt)*pt.scale:mw(hi)?Ps.x+=Ir-Qt.height*pt.scale+(-Gt-1)*pt.scale:Ps.x+=pt.imageName||Qt.width+2*Gt===As.w&&Qt.height+2*Gt===As.h?(Ir-fr)/2:(Ir-(Qt.height+2*Gt)*pt.scale)/2,jr=new ke(Ps.x,Ps.y-Ks),gr=new ke(Ps.x+fr,Ps.y),Hs=new ke(Ps.x+fr,Ps.y-Ks)}else{const Os=(Qt.left-Gt)*pt.scale-Kt+zs[0],ui=(-Qt.top-Gt)*pt.scale+zs[1],yr=Os+Ks,Vr=ui+fr;Ps=new ke(Os,ui),jr=new ke(yr,ui),gr=new ke(Os,Vr),Hs=new ke(yr,Vr)}if(Ye){let Os;Os=Re?new ke(0,0):Ws?new ke(rt[0],rt[1]):new ke(ge[0],ge[1]),Ps._rotateAround(Ye,Os),jr._rotateAround(Ye,Os),gr._rotateAround(Ye,Os),Hs._rotateAround(Ye,Os)}const ys=new ke(0,0),xr=new ke(0,0);Je.push({tl:Ps,tr:jr,bl:gr,br:Hs,tex:Rt,writingMode:xe.writingMode,glyphOffset:Rs,sectionIndex:pt.sectionIndex,isSDF:gs,pixelOffsetTL:ys,pixelOffsetBR:xr,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,a,b,h,p,y,l,s.allowVerticalPlacement),pe=s.textSizeData;let ie=null;pe.kind==="source"?(ie=[vn*h.layout.get("text-size").evaluate(y,{},X)],ie[0]>Ba&&Ds(`${s.layerIds[0]}: Value for "text-size" is >= ${Md}. Reduce your "text-size".`)):pe.kind==="composite"&&(ie=[vn*R.compositeTextSizes[0].evaluate(y,{},X),vn*R.compositeTextSizes[1].evaluate(y,{},X)],(ie[0]>Ba||ie[1]>Ba)&&Ds(`${s.layerIds[0]}: Value for "text-size" is >= ${Md}. Reduce your "text-size".`)),s.addSymbols(s.text,re,ie,b,p,y,E,e,r,v.lineStartIndex,v.lineLength,L,B,X);for(const ue of k)M[ue]=s.text.placedSymbolArray.length-1;return 4*re.length}function Hx(s){for(const e in s)return s[e];return null}function jh(s,e,r,a,l,h,p,y,b,v){let E=p.top,k=p.bottom,M=p.left,L=p.right;const R=p.collisionPadding;if(R&&(M-=R[0],E-=R[1],L+=R[2],k+=R[3]),b){const B=new ke(M,E),X=new ke(L,E),re=new ke(M,k),pe=new ke(L,k),ie=Me(b);let ue=new ke(0,0);v&&(ue=new ke(v[0],v[1])),B._rotateAround(ie,ue),X._rotateAround(ie,ue),re._rotateAround(ie,ue),pe._rotateAround(ie,ue),M=Math.min(B.x,X.x,re.x,pe.x),L=Math.max(B.x,X.x,re.x,pe.x),E=Math.min(B.y,X.y,re.y,pe.y),k=Math.max(B.y,X.y,re.y,pe.y)}return s.emplaceBack(e.x,e.y,e.z,r.x,r.y,M,E,L,k,y,a,l,h),s.length-1}function Mp(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function Fw(s,e,r,a){const l=s.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(a.dist(h[p])<r)return!0}else l[e]=[];return l[e].push(a),!1}function Xx(s,e){const r=s.fovAboveCenter,a=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,l=(s._camera.position[2]*s.worldSize-a)/Math.cos(s._pitch),h=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-s._pitch-r,.01)),p=Math.sin(s._pitch)*h+l;return Math.min(1.01*p,l*(1/s._horizonShift))}function Vo(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const r=Math.pow(2,-s.z),a=s.x*r,l=(s.x+1)*r,h=s.y*r,p=(s.y+1)*r,y=Bi(a),b=Bi(l),v=Hr(h),E=Hr(p),k=e.project(y,v),M=e.project(b,v),L=e.project(b,E),R=e.project(y,E);let B=Math.min(k.x,M.x,L.x,R.x),X=Math.min(k.y,M.y,L.y,R.y),re=Math.max(k.x,M.x,L.x,R.x),pe=Math.max(k.y,M.y,L.y,R.y);const ie=r/16;function ue(ge,Fe,Re,He,ot,Ve){const Je=(Re+ot)/2,Ye=(He+Ve)/2,rt=e.project(Bi(Je),Hr(Ye)),ht=Math.max(0,B-rt.x,X-rt.y,rt.x-re,rt.y-pe);B=Math.min(B,rt.x),re=Math.max(re,rt.x),X=Math.min(X,rt.y),pe=Math.max(pe,rt.y),ht>ie&&(ue(ge,rt,Re,He,Je,Ye),ue(rt,Fe,Je,Ye,ot,Ve))}ue(k,M,a,h,l,h),ue(M,L,l,h,l,p),ue(L,R,l,p,a,p),ue(R,k,a,p,a,h),B-=ie,X-=ie,re+=ie,pe+=ie;const xe=1/Math.max(re-B,pe-X);return{scale:xe,x:B*xe,y:X*xe,x2:re*xe,y2:pe*xe,projection:e}}const Bw=yn(new Float32Array(16));class Ua{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new ks(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return bn(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return Xx(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,l){const h=e.horizonLineFromTop(!1),p=new ke(r,Math.max(h,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}pointCoordinate3D(e,r,a){const l=new ke(r,a);if(e.elevation)return e.elevation.pointCoordinate(l);{const h=this.pointCoordinate(e,l.x,l.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return Bw}createTileMatrix(e,r,a){let l,h,p;const y=a.canonical,b=yn(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=Vo(y,this);l=1,h=v.x+a.wrap*v.scale,p=v.y,Lo(b,b,[l/v.scale,l/v.scale,e.pixelsPerMeter/r])}else l=r/e.zoomScale(y.z),h=(y.x+Math.pow(2,y.z)*a.wrap)*l,p=y.y*l;return ld(b,b,[h,p,0]),Lo(b,b,[l/zt,l/zt,1]),b}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class Uw extends Ua{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Me(r));this.n=(l+Math.sin(Me(a)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:l,r0:h}=this,p=Me(e-this.center[0]),y=Me(r),b=Math.sqrt(l-2*a*Math.sin(y))/a;return{x:b*Math.sin(p*a),y:b*Math.cos(p*a)-h,z:0}}unproject(e,r){const{n:a,c:l,r0:h}=this,p=h+r;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const b=Me(this.center[0])*a;y=ts(y,-Math.PI-b,Math.PI-b);const v=mt(st(y/a)+this.center[0],-180,180),E=Math.asin(mt((l-(e*e+p*p)*a*a)/(2*a),-1,1)),k=mt(st(E),-Xr,Xr);return new ks(v,k)}}const Pd=1.340264,Id=-.081106,Dd=893e-6,Ld=.003796,Nh=Math.sqrt(3)/2;class Vw extends Ua{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Nh*Math.sin(r)),l=a*a,h=l*l*l;return{x:.5*(e*Math.cos(a)/(Nh*(Pd+3*Id*l+h*(7*Dd+9*Ld*l)))/Math.PI+.5),y:1-.5*(a*(Pd+Id*l+h*(Dd+Ld*l))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=a*a,h=l*l*l;for(let E,k,M,L=0;L<12&&(k=a*(Pd+Id*l+h*(Dd+Ld*l))-r,M=Pd+3*Id*l+h*(7*Dd+9*Ld*l),E=k/M,a=mt(a-E,-Math.PI/3,Math.PI/3),l=a*a,h=l*l*l,!(Math.abs(E)<1e-12));++L);const p=Nh*e*(Pd+3*Id*l+h*(7*Dd+9*Ld*l))/Math.cos(a),y=Math.asin(Math.sin(a)/Nh),b=mt(180*p/Math.PI,-180,180),v=mt(180*y/Math.PI,-Xr,Xr);return new ks(b,v)}}class qw extends Ua{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),l=mt(360*(.5-r),-Xr,Xr);return new ks(a,l)}}const Xl=Math.PI/2;function Sh(s){return Math.tan((Xl+s)/2)}class $w extends Ua{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let l=Me(r),h=Me(a);this.southernCenter=l+h<0,this.southernCenter&&(l=-l,h=-h);const p=Math.cos(l),y=Sh(l);this.n=l===h?Math.sin(l):Math.log(p/Math.cos(h))/Math.log(Sh(h)/y),this.f=p*Math.pow(Sh(l),this.n)/this.n}project(e,r){r=Me(r),this.southernCenter&&(r=-r),e=Me(e-this.center[0]);const a=1e-6,{n:l,f:h}=this;h>0?r<-Xl+a&&(r=-Xl+a):r>Xl-a&&(r=Xl-a);const p=h/Math.pow(Sh(r),l);let y=p*Math.sin(l*e),b=h-p*Math.cos(l*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:l}=this,h=l-r,p=Math.sign(h),y=Math.sign(a)*Math.sqrt(e*e+h*h);let b=Math.atan2(e,Math.abs(h))*p;h*a<0&&(b-=Math.PI*Math.sign(e)*p);const v=mt(st(b/a)+this.center[0],-180,180),E=mt(st(2*Math.atan(Math.pow(l/y,1/a))-Xl),-Xr,Xr);return new ks(v,this.southernCenter?-E:E)}}class Kx extends Ua{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Rn(e),y:zn(r),z:0}}unproject(e,r){const a=Bi(e),l=Hr(r);return new ks(a,l)}}const Qx=Me(Xr);class Gw extends Ua{project(e,r){const a=(r=Me(r))*r,l=a*a;return{x:.5*((e=Me(e))*(.8707-.131979*a+l*(l*(.003971*a-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+l*(.028874*a-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=25,h=0,p=a*a;do{p=a*a;const v=p*p;h=(a*(1.007226+p*(.015085+v*(.028874*p-.044475-.005916*v)))-r)/(1.007226+p*(.045255+v*(.259866*p-.311325-.005916*11*v))),a=mt(a-h,-Qx,Qx)}while(Math.abs(h)>1e-6&&--l>0);p=a*a;const y=mt(st(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=st(a);return new ks(y,b)}}const Jx=Me(Xr);class Zw extends Ua{project(e,r){r=Me(r),e=Me(e);const a=Math.cos(r),l=2/Math.PI,h=Math.acos(a*Math.cos(e/2)),p=Math.sin(h)/h,y=.5*(e*l+2*a*Math.sin(e/2)/p)||0,b=.5*(r+Math.sin(r)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,h=25;const p=1e-6;let y=0,b=0;do{const v=Math.cos(l),E=Math.sin(l),k=2*E*v,M=E*E,L=v*v,R=Math.cos(a/2),B=Math.sin(a/2),X=2*R*B,re=B*B,pe=1-L*R*R,ie=pe?1/pe:0,ue=pe?Math.acos(v*R)*Math.sqrt(1/pe):0,xe=.5*(2*ue*v*B+2*a/Math.PI)-e,ge=.5*(ue*E+l)-r,Fe=.5*ie*(L*re+ue*v*R*M)+1/Math.PI,Re=ie*(X*k/4-ue*E*B),He=.125*ie*(k*B-ue*E*L*X),ot=.5*ie*(M*R+ue*re*v)+.5,Ve=Re*He-ot*Fe;y=(ge*Re-xe*ot)/Ve,b=(xe*He-ge*Fe)/Ve,a=mt(a-y,-Math.PI,Math.PI),l=mt(l-b,-Jx,Jx)}while((Math.abs(y)>p||Math.abs(b)>p)&&--h>0);return new ks(st(a),st(l))}}class Yx extends Ua{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Me(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:l}=this;return{x:Me(e)*l*a+.5,y:-Math.sin(Me(r))/l*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:l}=this,h=-(r-.5)/a,p=mt(st((e-.5)/a)/l,-180,180),y=Math.asin(mt(h*l,-1,1)),b=mt(st(y),-Xr,Xr);return new ks(p,b)}}class Ww extends Kx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const l=gd(e,r,a);return nr(l,l,xd(Ln(a))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,r){const a=Dl(r.lat,r.lng),l=li([],a),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;hd(a,a,l,bn(1,0)*zt*h);const p=yn(new Float64Array(16));return Do(p,e.pixelMatrix,e.globeMatrix),nr(a,a,p),new ke(a[0],a[1])}pixelsPerMeter(e,r){return bn(1,0)*r}pixelSpaceConversion(e,r,a){const l=bn(1,e)*r,h=ms(bn(1,45)*r,l,a);return this.pixelsPerMeter(e,r)/h}createTileMatrix(e,r,a){const l=tp(Ln(a.canonical));return Do(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,r){const{center:a}=e,l=xd(Ln(r));return Yu(l,l,Me(a.lng)),Gm(l,l,Me(a.lat)),Lo(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,r,a,l){return Tg(e,r,a,!0)||new Rl(0,0)}pointCoordinate3D(e,r,a){const l=this.pointCoordinate(e,r,a,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,r){return!Tg(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(l,h){const p=l.cameraToCenterDistance,y=l._centerAltitude*h,b=l._camera,v=l._camera.forward(),E=oa([],Fi([],v,-p),[0,0,y]),k=l.worldSize/(2*Math.PI),M=[0,0,-k],L=l.width/l.height,R=Math.tan(l.fovAboveCenter),B=Fi([],b.up(),R),X=Fi([],b.right(),R*L),re=li([],oa([],oa([],v,B),X)),pe=[];let ie;if(new Xm(E,re).closestPointOnSphere(M,k,pe)){const ue=oa([],pe,M),xe=_n([],ue,E);ie=Math.cos(l.fovAboveCenter)*cd(xe)}else{const ue=_n([],E,M),xe=_n([],M,E);li(xe,xe);const ge=cd(ue)-k;ie=Math.sqrt(ge*(ge+2*k));const Fe=Math.acos(ie/(k+ge))-Math.acos(Xi(v,xe));ie*=Math.cos(Fe)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Ll(e.zoom);if(a>0){const l=Xx(e,bn(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ms(r,l+h*(1-Math.cos(p)),Math.pow(a,10))}return r}upVector(e,r,a){return gd(r,a,e,1)}upVectorScale(e){return{metersToTile:eh(sh(Ln(e)))}}}function ey(s){const e=s.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new Kx(s);case"equirectangular":return new qw(s);case"naturalEarth":return new Gw(s);case"equalEarth":return new Vw(s);case"winkelTripel":return new Zw(s);case"albers":return r?new Yx(s):new Uw(s);case"lambertConformalConic":return r?new Yx(s):new $w(s);case"globe":return new Ww(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Hw=hh.types,Xw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Th(s,e,r,a,l,h,p,y,b,v,E,k,M){const L=y?Math.min(Ba,Math.round(y[0])):0,R=y?Math.min(Ba,Math.round(y[1])):0;s.emplaceBack(e,r,Math.round(32*a),Math.round(32*l),h,p,(L<<1)+(b?1:0),R,16*v,16*E,256*k,256*M)}function Eh(s,e,r,a,l,h,p){s.emplaceBack(e,r,a,l,h,p)}function Ch(s,e,r,a,l){s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l),s.emplaceBack(e,r,a,l)}function Kw(s){for(const e of s.sections)if(Bm(e.text))return!0;return!1}class Pp{constructor(e){this.layoutVertexArray=new tt,this.indexArray=new It,this.programConfigurations=e,this.segments=new mr,this.dynamicLayoutVertexArray=new nt,this.opacityVertexArray=new Dt,this.placedSymbolArray=new hr,this.globeExtVertexArray=new dt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,aw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Xw,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,nw.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Et(Pp,"SymbolBuffers");class Ip{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new mr,this.collisionVertexArray=new ns,this.collisionVertexArrayExt=new es}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ow.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,lw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Et(Ip,"CollisionBuffers");class Va{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yn([]),this.placementViewportMatrix=yn([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vp(this.zoom,r["text-size"]),this.iconSizeData=vp(this.zoom,r["icon-size"]);const a=this.layers[0].layout,l=a.get("symbol-sort-key"),h=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>Ui[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Pp(new Io(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Pp(new Io(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new oi,this.lineVertexArray=new kl,this.symbolInstances=new Us}calculateGlyphDependencies(e,r,a,l,h){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,l&&h){const y=Cd[e.charAt(p)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,a,l){const h=this.layers[0],p=h.layout,y=this.projection.name==="globe",b=p.get("text-font"),v=p.get("text-field"),E=p.get("icon-image"),k=(v.value.kind!=="constant"||v.value.value instanceof ai&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),M=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!k&&!M)return;const R=r.iconDependencies,B=r.glyphDependencies,X=r.availableImages,re=new C(this.zoom);for(const{feature:pe,id:ie,index:ue,sourceLayerIndex:xe}of e){const ge=h._featureFilter.needGeometry,Fe=Fo(pe,ge);if(!h._featureFilter.filter(re,Fe,a))continue;if(ge||(Fe.geometry=la(pe,a,l)),y&&pe.type!==1&&a.z<=5){const Ve=Fe.geometry,Je=.98078528056,Ye=(rt,ht)=>Xi(gd(rt.x,rt.y,a,1),gd(ht.x,ht.y,a,1))<Je;for(let rt=0;rt<Ve.length;rt++)Ve[rt]=av(Ve[rt],Ye)}let Re,He;if(k){const Ve=h.getValueAndResolveTokens("text-field",Fe,a,X),Je=ai.factory(Ve);Kw(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||_()==="unavailable"||this.hasRTLText&&S.isParsed())&&(Re=uw(Je,h,Fe))}if(M){const Ve=h.getValueAndResolveTokens("icon-image",Fe,a,X);He=Ve instanceof Ni?Ve:Ni.fromString(Ve)}if(!Re&&!He)continue;const ot=this.sortFeaturesByKey?L.evaluate(Fe,{},a):void 0;if(this.features.push({id:ie,text:Re,icon:He,index:ue,sourceLayerIndex:xe,geometry:Fe.geometry,properties:pe.properties,type:Hw[pe.type],sortKey:ot}),He&&(R[He.name]=!0),Re){const Ve=b.evaluate(Fe,{},a).join(","),Je=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ui.vertical)>=0;for(const Ye of Re.sections)if(Ye.image)R[Ye.image.name]=!0;else{const rt=td(Re.toString()),ht=Ye.fontStack||Ve,Ze=B[ht]=B[ht]||{};this.calculateGlyphDependencies(Ye.text,Ze,Je,this.allowVerticalPlacement,rt)}}}p.get("symbol-placement")==="line"&&(this.features=function(pe){const ie={},ue={},xe=[];let ge=0;function Fe(Ve){xe.push(pe[Ve]),ge++}function Re(Ve,Je,Ye){const rt=ue[Ve];return delete ue[Ve],ue[Je]=rt,xe[rt].geometry[0].pop(),xe[rt].geometry[0]=xe[rt].geometry[0].concat(Ye[0]),rt}function He(Ve,Je,Ye){const rt=ie[Je];return delete ie[Je],ie[Ve]=rt,xe[rt].geometry[0].shift(),xe[rt].geometry[0]=Ye[0].concat(xe[rt].geometry[0]),rt}function ot(Ve,Je,Ye){const rt=Ye?Je[0][Je[0].length-1]:Je[0][0];return`${Ve}:${rt.x}:${rt.y}`}for(let Ve=0;Ve<pe.length;Ve++){const Je=pe[Ve],Ye=Je.geometry,rt=Je.text?Je.text.toString():null;if(!rt){Fe(Ve);continue}const ht=ot(rt,Ye),Ze=ot(rt,Ye,!0);if(ht in ue&&Ze in ie&&ue[ht]!==ie[Ze]){const bt=He(ht,Ze,Ye),At=Re(ht,Ze,xe[bt].geometry);delete ie[ht],delete ue[Ze],ue[ot(rt,xe[At].geometry,!0)]=At,xe[bt].geometry=null}else ht in ue?Re(ht,Ze,Ye):Ze in ie?He(ht,Ze,Ye):(Fe(Ve),ie[ht]=ge-1,ue[Ze]=ge-1)}return xe.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,ie)=>pe.sortKey-ie.sortKey)}update(e,r,a,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ey(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:h}of r)this.lineVertexArray.emplaceBack(l,h);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,l,h,p,y,b,v,E,k,M,L,R){const B=e.indexArray,X=e.layoutVertexArray,re=e.globeExtVertexArray,pe=e.segments.prepareSegment(4*r.length,X,B,this.canOverlap?p.sortKey:void 0),ie=this.glyphOffsetArray.length,ue=pe.vertexLength,xe=this.allowVerticalPlacement&&y===Ui.vertical?Math.PI/2:0,ge=p.text&&p.text.sections;for(let Re=0;Re<r.length;Re++){const{tl:He,tr:ot,bl:Ve,br:Je,tex:Ye,pixelOffsetTL:rt,pixelOffsetBR:ht,minFontScaleX:Ze,minFontScaleY:bt,glyphOffset:At,isSDF:vt,sectionIndex:$t}=r[Re],pt=pe.vertexLength,Rt=At[1];if(Th(X,v.x,v.y,He.x,Rt+He.y,Ye.x,Ye.y,a,vt,rt.x,rt.y,Ze,bt),Th(X,v.x,v.y,ot.x,Rt+ot.y,Ye.x+Ye.w,Ye.y,a,vt,ht.x,rt.y,Ze,bt),Th(X,v.x,v.y,Ve.x,Rt+Ve.y,Ye.x,Ye.y+Ye.h,a,vt,rt.x,ht.y,Ze,bt),Th(X,v.x,v.y,Je.x,Rt+Je.y,Ye.x+Ye.w,Ye.y+Ye.h,a,vt,ht.x,ht.y,Ze,bt),b){const{x:Gt,y:gs,z:Zt}=b.anchor,[Bt,Bs,Kt]=b.up;Eh(re,Gt,gs,Zt,Bt,Bs,Kt),Eh(re,Gt,gs,Zt,Bt,Bs,Kt),Eh(re,Gt,gs,Zt,Bt,Bs,Kt),Eh(re,Gt,gs,Zt,Bt,Bs,Kt),Ch(e.dynamicLayoutVertexArray,Gt,gs,Zt,xe)}else Ch(e.dynamicLayoutVertexArray,v.x,v.y,v.z,xe);B.emplaceBack(pt,pt+1,pt+2),B.emplaceBack(pt+1,pt+2,pt+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(At[0]),Re!==r.length-1&&$t===r[Re+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,p,p.index,{},L,R,ge&&ge[$t])}const Fe=b?b.anchor:v;e.placedSymbolArray.emplaceBack(Fe.x,Fe.y,Fe.z,v.x,v.y,ie,this.glyphOffsetArray.length-ie,ue,E,k,v.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],y,0,!1,0,M,0)}_commitLayoutVertex(e,r,a,l,h,p,y){e.emplaceBack(r,a,l,h,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,a,l,h,p,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),v=b.vertexLength,E=y.tileAnchorX,k=y.tileAnchorY;for(let L=0;L<4;L++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,E,k,new ke(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,E,k,new ke(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,E,k,new ke(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,l,h,p,E,k,new ke(e.x1,e.y2)),b.vertexLength+=4;const M=a.indexArray;M.emplaceBack(v,v+1),M.emplaceBack(v+1,v+2),M.emplaceBack(v+2,v+3),M.emplaceBack(v+3,v),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),v=this.getSymbolInstanceTextSize(e,p,r,y);this._addCollisionDebugVertices(b,v,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),v=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,v,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ip(kt,_x.members,Pr),this.iconCollisionBox=new Ip(kt,_x.members,Pr);const a=Ul(this.iconSizeData,e),l=Ul(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,r,a,l){const h=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),p=gh(this.textSizeData,e,h)/Ur;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,a){const l=this.icon.placedSymbolArray.get(a),h=gh(this.iconSizeData,e,l);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,r,a){e.emplaceBack(r,-a,-a),e.emplaceBack(r,a,-a),e.emplaceBack(r,a,a),e.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),v=this.getSymbolInstanceTextSize(e,p,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,b.padding)}}_updateIconDebugCollisionBoxes(e,r,a,l,h,p){for(let y=l;y<h;y++){const b=a.get(y),v=this.getSymbolInstanceIconSize(e,r,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,b.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Ul(this.iconSizeData,e),l=Ul(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,l,h,p,y,b,v){const E={};if(r<a){const{x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue,featureIndex:xe}=e.get(r);E.textBox={x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue},E.textFeatureIndex=xe}if(l<h){const{x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue,featureIndex:xe}=e.get(l);E.verticalTextBox={x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue},E.verticalTextFeatureIndex=xe}if(p<y){const{x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue,featureIndex:xe}=e.get(p);E.iconBox={x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue},E.iconFeatureIndex=xe}if(b<v){const{x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue,featureIndex:xe}=e.get(b);E.verticalIconBox={x1:k,y1:M,x2:L,y2:R,padding:B,projectedAnchorX:X,projectedAnchorY:re,projectedAnchorZ:pe,tileAnchorX:ie,tileAnchorY:ue},E.verticalIconFeatureIndex=xe}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let h=a.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),l=[],h=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const b=this.symbolInstances.get(y);l.push(0|Math.round(r*b.tileAnchorX+a*b.tileAnchorY)),h.push(b.featureIndex)}return p.sort((y,b)=>l[y]-l[b]||h[b]-h[y]),p}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:v}=a;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&p!==l&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Et(Va,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Va.MAX_GLYPHS=65535,Va.addDynamicAttributes=Ch;const Qw=new le({"symbol-placement":new F(We.layout_symbol["symbol-placement"]),"symbol-spacing":new F(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new F(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new K(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new F(We.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new F(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new F(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new F(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new F(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new K(We.layout_symbol["icon-size"]),"icon-text-fit":new F(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new F(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new K(We.layout_symbol["icon-image"]),"icon-rotate":new K(We.layout_symbol["icon-rotate"]),"icon-padding":new F(We.layout_symbol["icon-padding"]),"icon-keep-upright":new F(We.layout_symbol["icon-keep-upright"]),"icon-offset":new K(We.layout_symbol["icon-offset"]),"icon-anchor":new K(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new F(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new F(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new F(We.layout_symbol["text-rotation-alignment"]),"text-field":new K(We.layout_symbol["text-field"]),"text-font":new K(We.layout_symbol["text-font"]),"text-size":new K(We.layout_symbol["text-size"]),"text-max-width":new K(We.layout_symbol["text-max-width"]),"text-line-height":new K(We.layout_symbol["text-line-height"]),"text-letter-spacing":new K(We.layout_symbol["text-letter-spacing"]),"text-justify":new K(We.layout_symbol["text-justify"]),"text-radial-offset":new K(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new F(We.layout_symbol["text-variable-anchor"]),"text-anchor":new K(We.layout_symbol["text-anchor"]),"text-max-angle":new F(We.layout_symbol["text-max-angle"]),"text-writing-mode":new F(We.layout_symbol["text-writing-mode"]),"text-rotate":new K(We.layout_symbol["text-rotate"]),"text-padding":new F(We.layout_symbol["text-padding"]),"text-keep-upright":new F(We.layout_symbol["text-keep-upright"]),"text-transform":new K(We.layout_symbol["text-transform"]),"text-offset":new K(We.layout_symbol["text-offset"]),"text-allow-overlap":new F(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new F(We.layout_symbol["text-ignore-placement"]),"text-optional":new F(We.layout_symbol["text-optional"])});var Dp={paint:new le({"icon-opacity":new K(We.paint_symbol["icon-opacity"]),"icon-color":new K(We.paint_symbol["icon-color"]),"icon-halo-color":new K(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new K(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new K(We.paint_symbol["icon-halo-blur"]),"icon-translate":new F(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new F(We.paint_symbol["icon-translate-anchor"]),"text-opacity":new K(We.paint_symbol["text-opacity"]),"text-color":new K(We.paint_symbol["text-color"],{runtimeType:xi,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new K(We.paint_symbol["text-halo-color"]),"text-halo-width":new K(We.paint_symbol["text-halo-width"]),"text-halo-blur":new K(We.paint_symbol["text-halo-blur"]),"text-translate":new F(We.paint_symbol["text-translate"]),"text-translate-anchor":new F(We.paint_symbol["text-translate-anchor"])}),layout:Qw};class ty{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ya,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et(ty,"FormatSectionOverride",{omit:["defaultValue"]});class kh extends xn{constructor(e){super(e,Dp)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const l=[];for(const h of a)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,l){const h=this.layout.get(e).evaluate(r,{},a,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Aa(p.value)||!h?h:function(y,b){return b.replace(/{([^{}]+)}/g,(v,E)=>E in y?String(y[E]):"")}(r.properties,h)}createBucket(e){return new Va(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Dp.paint.overridableProperties){if(!kh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new ty(r),l=new vl(a,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new $c("source",l):new No("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Y(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&kh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),l=Dp.paint.properties[r];let h=!1;const p=y=>{for(const b of y)if(l.overrides&&l.overrides.hasOverride(b))return void(h=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ai)p(a.value.value.sections);else if(a.value.kind==="source"){const y=v=>{h||(v instanceof Kn&&Xs(v.value)===ao?p(v.value.sections):v instanceof Mn?p(v.sections):v.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return h}getProgramConfiguration(e){return new za(this,e)}}var Jw={paint:new le({"background-color":new F(We.paint_background["background-color"]),"background-pattern":new F(We.paint_background["background-pattern"]),"background-opacity":new F(We.paint_background["background-opacity"])})},Yw={paint:new le({"raster-opacity":new F(We.paint_raster["raster-opacity"]),"raster-hue-rotate":new F(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new F(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new F(We.paint_raster["raster-brightness-max"]),"raster-saturation":new F(We.paint_raster["raster-saturation"]),"raster-contrast":new F(We.paint_raster["raster-contrast"]),"raster-resampling":new F(We.paint_raster["raster-resampling"]),"raster-fade-duration":new F(We.paint_raster["raster-fade-duration"])})};class e1 extends xn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var t1={paint:new le({"sky-type":new F(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new F(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new F(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new F(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new F(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new ae(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new F(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new F(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new F(We.paint_sky["sky-opacity"])})};function Lp(s,e,r){const a=[0,0,1],l=bg([]);return wg(l,l,r?-Me(s)+Math.PI:Me(s)),vg(l,l,-Me(e)),gg(a,a,l),li(a,a)}const s1={circle:class extends xn{constructor(s){super(s,mv)}createBucket(s){return new op(s)}queryRadius(s){const e=s;return zl("circle-radius",this,e)+zl("circle-stroke-width",this,e)+nh(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,r,a,l,h,p,y){const b=$g(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Gg(s,a,h,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,v)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new za(this,s)}},heatmap:class extends xn{createBucket(s){return new Wg(s)}constructor(s){super(s,xv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=up({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return zl("heatmap-radius",this,s)}queryIntersectsFeature(s,e,r,a,l,h,p,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return Gg(s,a,h,p,y,!0,!0,new ke(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new za(this,s)}},hillshade:class extends xn{constructor(s){super(s,yv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends xn{constructor(s){super(s,Dv)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(s){return new za(this,s)}recalculate(s,e){super.recalculate(s,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new dh(s)}queryRadius(){return nh(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,r,a,l,h){return!s.queryGeometry.isAboveHorizon&&Fg(qg(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends xn{constructor(s){super(s,Kv)}createBucket(s){return new Sd(s)}queryRadius(){return nh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new za(this,s)}queryIntersectsFeature(s,e,r,a,l,h,p,y,b){const v=$g(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,r),k=this.paint.get("fill-extrusion-base").evaluate(e,r),M=[0,0],L=y&&h.elevation,R=h.elevation?h.elevation.exaggeration():1,B=s.tile.getBucket(this);if(L&&B instanceof Sd){const ue=B.centroidVertexArray,xe=b+1;xe<ue.length&&(M[0]=ue.geta_centroid_pos0(xe),M[1]=ue.geta_centroid_pos1(xe))}if(M[0]===0&&M[1]===1)return!1;h.projection.name==="globe"&&(a=ux([a],[new ke(0,0),new ke(zt,zt)],s.tileID.canonical).map(ue=>ue.polygon).flat());const X=L?y:null,[re,pe]=function(ue,xe,ge,Fe,Re,He,ot,Ve,Je,Ye,rt){return ue.projection.name==="globe"?function(ht,Ze,bt,At,vt,$t,pt,Rt,Gt,gs,Zt){const Bt=[],Bs=[],Kt=ht.projection.upVectorScale(Zt,ht.center.lat,ht.worldSize).metersToTile,Qt=[0,0,0,1],As=[0,0,0,1],Rs=(Ms,Ws,Ks,fr)=>{Ms[0]=Ws,Ms[1]=Ks,Ms[2]=fr,Ms[3]=1},zs=dx();bt>0&&(bt+=zs),At+=zs;for(const Ms of Ze){const Ws=[],Ks=[];for(const fr of Ms){const Ps=fr.x+vt.x,jr=fr.y+vt.y,gr=ht.projection.projectTilePoint(Ps,jr,Zt),Hs=ht.projection.upVector(Zt,fr.x,fr.y);let ys=bt,xr=At;if(pt){const Os=fx(Ps,jr,bt,At,pt,Rt,Gt,gs);ys+=Os.base,xr+=Os.top}bt!==0?Rs(Qt,gr.x+Hs[0]*Kt*ys,gr.y+Hs[1]*Kt*ys,gr.z+Hs[2]*Kt*ys):Rs(Qt,gr.x,gr.y,gr.z),Rs(As,gr.x+Hs[0]*Kt*xr,gr.y+Hs[1]*Kt*xr,gr.z+Hs[2]*Kt*xr),nr(Qt,Qt,$t),nr(As,As,$t),Ws.push(new Bl(Qt[0],Qt[1],Qt[2])),Ks.push(new Bl(As[0],As[1],As[2]))}Bt.push(Ws),Bs.push(Ks)}return[Bt,Bs]}(ue,xe,ge,Fe,Re,He,ot,Ve,Je,Ye,rt):ot?function(ht,Ze,bt,At,vt,$t,pt,Rt,Gt){const gs=[],Zt=[],Bt=[0,0,0,1];for(const Bs of ht){const Kt=[],Qt=[];for(const As of Bs){const Rs=As.x+At.x,zs=As.y+At.y,Ms=fx(Rs,zs,Ze,bt,$t,pt,Rt,Gt);Bt[0]=Rs,Bt[1]=zs,Bt[2]=Ms.base,Bt[3]=1,Ro(Bt,Bt,vt),Bt[3]=Math.max(Bt[3],1e-5);const Ws=new Bl(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Bt[0]=Rs,Bt[1]=zs,Bt[2]=Ms.top,Bt[3]=1,Ro(Bt,Bt,vt),Bt[3]=Math.max(Bt[3],1e-5);const Ks=new Bl(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Kt.push(Ws),Qt.push(Ks)}gs.push(Kt),Zt.push(Qt)}return[gs,Zt]}(xe,ge,Fe,Re,He,ot,Ve,Je,Ye):function(ht,Ze,bt,At,vt){const $t=[],pt=[],Rt=vt[8]*Ze,Gt=vt[9]*Ze,gs=vt[10]*Ze,Zt=vt[11]*Ze,Bt=vt[8]*bt,Bs=vt[9]*bt,Kt=vt[10]*bt,Qt=vt[11]*bt;for(const As of ht){const Rs=[],zs=[];for(const Ms of As){const Ws=Ms.x+At.x,Ks=Ms.y+At.y,fr=vt[0]*Ws+vt[4]*Ks+vt[12],Ps=vt[1]*Ws+vt[5]*Ks+vt[13],jr=vt[2]*Ws+vt[6]*Ks+vt[14],gr=vt[3]*Ws+vt[7]*Ks+vt[15],Hs=fr+Rt,ys=Ps+Gt,xr=jr+gs,Os=Math.max(gr+Zt,1e-5),ui=fr+Bt,yr=Ps+Bs,Vr=jr+Kt,Ir=Math.max(gr+Qt,1e-5);Rs.push(new Bl(Hs/Os,ys/Os,xr/Os)),zs.push(new Bl(ui/Ir,yr/Ir,Vr/Ir))}$t.push(Rs),pt.push(zs)}return[$t,pt]}(xe,ge,Fe,Re,He)}(h,a,k,E,v,p,X,M,R,h.center.lat,s.tileID.canonical),ie=s.queryGeometry;return function(ue,xe,ge){let Fe=1/0;Fg(ge,xe)&&(Fe=px(ge,xe[0]));for(let Re=0;Re<xe.length;Re++){const He=xe[Re],ot=ue[Re];for(let Ve=0;Ve<He.length-1;Ve++){const Je=He[Ve],Ye=[Je,He[Ve+1],ot[Ve+1],ot[Ve],Je];Og(ge,Ye)&&(Fe=Math.min(Fe,px(ge,Ye)))}}return Fe!==1/0&&Fe}(re,pe,ie.isPointQuery()?ie.screenBounds:ie.screenGeometry)}},line:class extends xn{constructor(s){super(s,gx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Mc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=xx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new fh(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new za(this,s)}queryRadius(s){const e=s,r=yx(zl("line-width",this,e),zl("line-gap-width",this,e)),a=zl("line-offset",this,e);return r/2+Math.abs(a)+nh(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,r,a,l,h){if(s.queryGeometry.isAboveHorizon)return!1;const p=qg(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),y=s.pixelToTileUnitsFactor/2*yx(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(a=function(v,E){const k=[],M=new ke(0,0);for(let L=0;L<v.length;L++){const R=v[L],B=[];for(let X=0;X<R.length;X++){const re=R[X],pe=R[X+1],ie=X===0?M:re.sub(R[X-1])._unit()._perp(),ue=X===R.length-1?M:pe.sub(re)._unit()._perp(),xe=ie._add(ue)._unit();xe._mult(1/(xe.x*ue.x+xe.y*ue.y)),B.push(xe._mult(E)._add(re))}k.push(B)}return k}(a,b*s.pixelToTileUnitsFactor)),function(v,E,k){for(let M=0;M<E.length;M++){const L=E[M];if(v.length>=3){for(let R=0;R<L.length;R++)if(Bo(v,L[R]))return!0}if(cv(v,L,k))return!0}return!1}(p,a,y)}isTileClipped(){return!0}},symbol:kh,background:class extends xn{constructor(s){super(s,Jw)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends xn{constructor(s){super(s,Yw)}getProgramIds(){return["raster"]}},sky:class extends xn{constructor(s){super(s,t1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=up({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),l=!a,h=s.style.light,p=h.properties.get("position");return l&&h.properties.get("anchor")==="viewport"&&Ds("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Lp(p.azimuthal,90-p.polar,e):Lp(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Lp(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class Rd{constructor(e,r,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,a){const{width:l,height:h}=e,{context:p}=this,{gl:y}=p,{HTMLImageElement:b,HTMLCanvasElement:v,HTMLVideoElement:E,ImageData:k,ImageBitmap:M}=P;if(y.bindTexture(y.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===l&&this.size[1]===h){const{x:L,y:R}=a||{x:0,y:0};e instanceof b||e instanceof v||e instanceof E||e instanceof k||M&&e instanceof M?y.texSubImage2D(y.TEXTURE_2D,0,L,R,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,L,R,l,h,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[l,h],e instanceof b||e instanceof v||e instanceof E||e instanceof k||M&&e instanceof M?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,l,h,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class r1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class i1{constructor(){this.tasks={},this.taskQueue=[],Cr(["process"],this),this.invoker=new r1(this.process),this.nextId=0}add(e,r){const a=this.nextId++,l=function({type:h,isSymbolTile:p,zoom:y}){return y=y||0,h==="message"?0:h!=="maybePrepare"||p?h!=="parseTile"||p?h==="parseTile"&&p?300-y:h==="maybePrepare"&&p?400-y:500:200-y:100-y}(r);if(l===0){ri();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:r,priority:l,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){ri();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const h=this.tasks[this.taskQueue[l]];h.priority<r&&(r=h.priority,e=l)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class sy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const n1=["tile","layer","source","sourceLayer","state"];class ry{constructor(e,r,a,l,h){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of n1)this[r]!==void 0&&(e[r]=this[r]);return e}}const Ji=32,On=33,qa=new Uint16Array(8184);for(let s=0;s<2046;s++){let e=s+2,r=0,a=0,l=0,h=0,p=0,y=0;for(1&e?l=h=p=Ji:r=a=y=Ji;(e>>=1)>1;){const v=r+l>>1,E=a+h>>1;1&e?(l=r,h=a,r=p,a=y):(r=l,a=h,l=p,h=y),p=v,y=E}const b=4*s;qa[b+0]=r,qa[b+1]=a,qa[b+2]=l,qa[b+3]=h}const Fn=new Uint16Array(2178),$a=new Uint8Array(1089),Ah=new Uint16Array(1089);function iy(s){return s===0?-.03125:s===32?.03125:0}var ny=Ce([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ay={type:2,extent:zt,loadGeometry:()=>[[new ke(0,0),new ke(zt+1,0),new ke(zt+1,zt+1),new ke(0,zt+1),new ke(0,0)]]};class Rp{constructor(e,r,a,l,h){this.tileID=e,this.uid=Tr(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<nn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Vo(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const p={};if(!h)return p;for(const y of l){const b=y.layerIds.map(v=>h.getLayer(v)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(v=>b.filter(E=>E.id===v)[0]));for(const v of b)p[v.id]=y}}return p}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Va){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Va&&h.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||_()!=="deferred"||j();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Cs}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Rd(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Rd(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Rd(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,l,h,p,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:y,transform:p,params:h,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),h=r?r.sourceLayer:"",p=l._geojsonTileLayer||l[h];if(!p)return;const y=Sl(r&&r.filter),{z:b,x:v,y:E}=this.tileID.canonical,k={z:b,x:v,y:E};for(let M=0;M<p.length;M++){const L=p.feature(M);if(y.needGeometry){const X=Fo(L,!0);if(!y.filter(new C(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!y.filter(new C(this.tileID.overscaledZ),L))continue;const R=a.getId(L,h),B=new ry(L,b,v,E,R);B.tile=k,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=je(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const h=this.expirationTime-r;h?this.expirationTime=a+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const a=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const p=this.buckets[h],y=p.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],v=e[y];if(!b||!v||Object.keys(v).length===0)continue;if(p.update(v,b,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof fh||p instanceof dh){const k=r.style._getSourceCache(p.layers[0].source);r._terrain&&r._terrain.enabled&&k&&p.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(k.id,this.tileID)}const E=r&&r.style&&r.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<nn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=nn.now()+e}setTexture(e,r){const a=r.context,l=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Rd(a,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,r){const a={};for(const l of r)a[l]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const l=this.dependencies[a];if(l){for(const h of r)if(l[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const a=la(ay,this.tileID.canonical,this.tileTransform)[0],l=new at,h=new Ei;for(let p=0;p<a.length;p++){const{x:y,y:b}=a[p];l.emplaceBack(y,b),h.emplaceBack(p)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(l,pd.members),this._tileDebugSegments=mr.simpleSegment(0,0,l.length,h.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const a=la(ay,this.tileID.canonical,this.tileTransform)[0];let l,h;if(this.isRaster){const p=function(y,b){const v=Vo(y,b),E=Math.pow(2,y.z);for(let X=0;X<On;X++)for(let re=0;re<On;re++){const pe=Bi((y.x+(re+iy(re))/Ji)/E),ie=Hr((y.y+(X+iy(X))/Ji)/E),ue=b.project(pe,ie),xe=X*On+re;Fn[2*xe+0]=Math.round((ue.x*v.scale-v.x)*zt),Fn[2*xe+1]=Math.round((ue.y*v.scale-v.y)*zt)}$a.fill(0),Ah.fill(0);for(let X=2045;X>=0;X--){const re=4*X,pe=qa[re+0],ie=qa[re+1],ue=qa[re+2],xe=qa[re+3],ge=pe+ue>>1,Fe=ie+xe>>1,Re=ge+Fe-ie,He=Fe+pe-ge,ot=ie*On+pe,Ve=xe*On+ue,Je=Fe*On+ge,Ye=Math.hypot((Fn[2*ot+0]+Fn[2*Ve+0])/2-Fn[2*Je+0],(Fn[2*ot+1]+Fn[2*Ve+1])/2-Fn[2*Je+1])>=16;$a[Je]=$a[Je]||(Ye?1:0),X<1022&&($a[Je]=$a[Je]||$a[(ie+He>>1)*On+(pe+Re>>1)]||$a[(xe+He>>1)*On+(ue+Re>>1)])}const k=new Qe,M=new It;let L=0;function R(X,re){const pe=re*On+X;return Ah[pe]===0&&(k.emplaceBack(Fn[2*pe+0],Fn[2*pe+1],X*zt/Ji,re*zt/Ji),Ah[pe]=++L),Ah[pe]-1}function B(X,re,pe,ie,ue,xe){const ge=X+pe>>1,Fe=re+ie>>1;if(Math.abs(X-ue)+Math.abs(re-xe)>1&&$a[Fe*On+ge])B(ue,xe,X,re,ge,Fe),B(pe,ie,ue,xe,ge,Fe);else{const Re=R(X,re),He=R(pe,ie),ot=R(ue,xe);M.emplaceBack(Re,He,ot)}}return B(0,0,Ji,Ji,Ji,0),B(Ji,Ji,0,0,0,Ji),{vertices:k,indices:M}}(this.tileID.canonical,r);l=p.vertices,h=p.indices}else{l=new Qe,h=new It;for(const{x:y,y:b}of a)l.emplaceBack(y,b,0,0);const p=gp(l.int16,void 0,4);for(let y=0;y<p.length;y+=3)h.emplaceBack(p[y],p[y+1],p[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,ny.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=mr.simpleSegment(0,0,l.length,h.length)}_makeGlobeTileDebugBuffers(e,r){const a=r.projection;if(!a||a.name!=="globe"||r.freezeTileCoverage)return;const l=this.tileID.canonical,h=xd(Eg(l,r)),p=Ll(r.zoom);let y;p>0&&(y=$m(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,r,h,y,p),this._makeGlobeTileDebugTextBuffer(e,l,r,h,y,p)}_globePoint(e,r,a,l,h,p,y){let b=gd(e,r,a);if(p){const v=1<<a.z,E=Rn(l.center.lng),k=zn(l.center.lat),M=(a.x+.5)/v-E;let L=0;M>.5?L=-1:M<-.5&&(L=1);let R=(e/zt+a.x)/v+L,B=(r/zt+a.y)/v;R=(R-E)*l._pixelsPerMercatorPixel+E,B=(B-k)*l._pixelsPerMercatorPixel+k;const X=[R*l.worldSize,B*l.worldSize,0];nr(X,X,p),b=Oo(b,X,y)}return nr(b,b,h)}_makeGlobeTileDebugBorderBuffer(e,r,a,l,h,p){const y=new at,b=new Ei,v=new Le,E=(M,L,R,B,X)=>{const re=(R-M)/(X-1),pe=(B-L)/(X-1),ie=y.length;for(let ue=0;ue<X;ue++){const xe=M+ue*re,ge=L+ue*pe;y.emplaceBack(xe,ge);const Fe=this._globePoint(xe,ge,r,a,l,h,p);v.emplaceBack(Fe[0],Fe[1],Fe[2]),b.emplaceBack(ie+ue)}},k=zt;E(0,0,k,0,16),E(k,0,k,k,16),E(k,k,0,k,16),E(0,k,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,pd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(v,Ng.members),this._tileDebugSegments=mr.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,r,a,l,h,p){const y=zt/4,b=new at,v=new It,E=new Le,k=25;v.reserve(32),b.reserve(k),E.reserve(k);const M=(L,R)=>k*L+R;for(let L=0;L<k;L++){const R=L*y;for(let B=0;B<k;B++){const X=B*y;b.emplaceBack(X,R);const re=this._globePoint(X,R,r,a,l,h,p);E.emplaceBack(re[0],re[1],re[2])}}for(let L=0;L<4;L++)for(let R=0;R<4;R++){const B=M(L,R),X=M(L,R+1),re=M(L+1,R),pe=M(L+1,R+1);v.emplaceBack(B,X,re),v.emplaceBack(re,X,pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(v),this._tileDebugTextBuffer=e.createVertexBuffer(b,pd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,Ng.members),this._tileDebugTextSegments=mr.simpleSegment(0,0,k,32)}}class a1{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},js(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])a[h]||(this.deletedStates[e][l][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),l=js({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][r];if(h===null)return{};for(const p in h)delete l[p]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const p in this.stateChanges[l])this.state[l][p]||(this.state[l][p]={}),js(this.state[l][p],this.stateChanges[l][p]),h[p]=this.state[l][p];a[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const p in this.state[l])h[p]={},this.state[l][p]={};else for(const p in this.deletedStates[l]){if(this.deletedStates[l][p]===null)this.state[l][p]={};else if(this.state[l][p])for(const y of Object.keys(this.deletedStates[l][p]))delete this.state[l][p][y];h[p]=this.state[l][p]}a[l]=a[l]||{},js(a[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,r)}}class oy{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function ly(s,e,r,a){let l=0,h=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(r[p]<s[p]||r[p]>e[p])return null}else{const y=1/a[p];let b=(s[p]-r[p])*y,v=(e[p]-r[p])*y;if(b>v){const E=b;b=v,v=E}if(b>l&&(l=b),v<h&&(h=v),l>h)return null}return l}function cy(s,e,r,a,l,h,p,y,b,v,E){const k=a-s,M=l-e,L=h-r,R=p-s,B=y-e,X=b-r,re=E[1]*X-E[2]*B,pe=E[2]*R-E[0]*X,ie=E[0]*B-E[1]*R,ue=k*re+M*pe+L*ie;if(Math.abs(ue)<1e-15)return null;const xe=1/ue,ge=v[0]-s,Fe=v[1]-e,Re=v[2]-r,He=(ge*re+Fe*pe+Re*ie)*xe;if(He<0||He>1)return null;const ot=Fe*L-Re*M,Ve=Re*k-ge*L,Je=ge*M-Fe*k,Ye=(E[0]*ot+E[1]*Ve+E[2]*Je)*xe;return Ye<0||He+Ye>1?null:(R*ot+B*Ve+X*Je)*xe}function dy(s,e,r){return(s-e)/(r-e)}function uy(s,e,r,a,l,h,p,y,b){const v=1<<r,E=h-a,k=p-l,M=(s+1)/v*E+a,L=(e+0)/v*k+l,R=(e+1)/v*k+l;y[0]=(s+0)/v*E+a,y[1]=L,b[0]=M,b[1]=R}class hy{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(h){const p=Math.ceil(Math.log2(h.dim/8)),y=[];let b=Math.ceil(Math.pow(2,p));const v=1/b,E=(L,R,B,X,re)=>{const pe=X?1:0,ie=(L+1)*B-pe,ue=R*B,xe=(R+1)*B-pe;re[0]=L*B,re[1]=ue,re[2]=ie,re[3]=xe};let k=new oy(b);const M=[];for(let L=0;L<b*b;L++){E(L%b,Math.floor(L/b),v,!1,M);const R=Ga(M[0],M[1],h),B=Ga(M[2],M[1],h),X=Ga(M[2],M[3],h),re=Ga(M[0],M[3],h);k.minimums.push(Math.min(R,B,X,re)),k.maximums.push(Math.max(R,B,X,re)),k.leaves.push(1)}for(y.push(k),b/=2;b>=1;b/=2){const L=y[y.length-1];k=new oy(b);for(let R=0;R<b*b;R++){E(R%b,Math.floor(R/b),2,!0,M);const B=L.getElevation(M[0],M[1]),X=L.getElevation(M[2],M[1]),re=L.getElevation(M[2],M[3]),pe=L.getElevation(M[0],M[3]),ie=L.isLeaf(M[0],M[1]),ue=L.isLeaf(M[2],M[1]),xe=L.isLeaf(M[2],M[3]),ge=L.isLeaf(M[0],M[3]),Fe=Math.min(B.min,X.min,re.min,pe.min),Re=Math.max(B.max,X.max,re.max,pe.max),He=ie&&ue&&xe&&ge;k.maximums.push(Re),k.minimums.push(Fe),k.leaves.push(Re-Fe<=5&&He?1:0)}y.push(k)}return y}(this.dem),a=r.length-1,l=r[a];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,l,h,p,y=1){return ly([e,r,-100],[a,l,this.maximums[0]*y],h,p)}raycast(e,r,a,l,h,p,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,a,l,h,p,y);if(b==null)return null;const v=[],E=[],k=[],M=[],L=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:R,t:B,nodex:X,nodey:re,depth:pe}=L.pop();if(this.leaves[R]){uy(X,re,pe,e,r,a,l,k,M);const ue=1<<pe,xe=(X+0)/ue,ge=(X+1)/ue,Fe=(re+0)/ue,Re=(re+1)/ue,He=Ga(xe,Fe,this.dem)*y,ot=Ga(ge,Fe,this.dem)*y,Ve=Ga(ge,Re,this.dem)*y,Je=Ga(xe,Re,this.dem)*y,Ye=cy(k[0],k[1],He,M[0],k[1],ot,M[0],M[1],Ve,h,p),rt=cy(M[0],M[1],Ve,k[0],M[1],Je,k[0],k[1],He,h,p),ht=Math.min(Ye!==null?Ye:Number.MAX_VALUE,rt!==null?rt:Number.MAX_VALUE);if(ht!==Number.MAX_VALUE)return ht;{const Ze=hd([],h,p,B);if(my(He,ot,Je,Ve,dy(Ze[0],k[0],M[0]),dy(Ze[1],k[1],M[1]))>=Ze[2])return B}continue}let ie=0;for(let ue=0;ue<this._siblingOffset.length;ue++){uy((X<<1)+this._siblingOffset[ue][0],(re<<1)+this._siblingOffset[ue][1],pe+1,e,r,a,l,k,M),k[2]=-100,M[2]=this.maximums[this.childOffsets[R]+ue]*y;const xe=ly(k,M,h,p);if(xe!=null){const ge=xe;v[ue]=ge;let Fe=!1;for(let Re=0;Re<ie&&!Fe;Re++)ge>=v[E[Re]]&&(E.splice(Re,0,ue),Fe=!0);Fe||(E[ie]=ue),ie++}}for(let ue=0;ue<ie;ue++){const xe=E[ue];L.push({idx:this.childOffsets[R]+xe,t:v[xe],nodex:(X<<1)+this._siblingOffset[xe][0],nodey:(re<<1)+this._siblingOffset[xe][1],depth:pe+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,l,h){if(e[l].isLeaf(r,a)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const p=l-1,y=e[p];let b=0,v=0;for(let E=0;E<this._siblingOffset.length;E++){const k=2*r+this._siblingOffset[E][0],M=2*a+this._siblingOffset[E][1],L=y.getElevation(k,M),R=y.isLeaf(k,M),B=this._addNode(L.min,L.max,R);R&&(b|=1<<E),v||(v=B)}for(let E=0;E<this._siblingOffset.length;E++)b&1<<E||this._construct(e,2*r+this._siblingOffset[E][0],2*a+this._siblingOffset[E][1],p,v+E)}}function my(s,e,r,a,l,h){return ms(ms(s,r,h),ms(e,a,h),l)}function Ga(s,e,r){const a=r.dim,l=mt(s*a-.5,0,a-1),h=mt(e*a-.5,0,a-1),p=Math.floor(l),y=Math.floor(h),b=Math.min(p+1,a-1),v=Math.min(y+1,a-1);return my(r.get(p,y),r.get(b,y),r.get(p,v),r.get(b,v),l-p,h-y)}const py={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function o1(s,e,r){return(256*s*256+256*e+r)/10-1e4}function l1(s,e,r){return 256*s+e+r/256-32768}class Mh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,l=!1,h=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Ds(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2,y=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=l,!l){for(let b=0;b<p;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(p,b)]=y[this._idx(p-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,p)]=y[this._idx(b,p-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(p,-1)]=y[this._idx(p-1,0)],y[this._idx(-1,p)]=y[this._idx(0,p-1)],y[this._idx(p,p)]=y[this._idx(p-1,p-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new hy(this)}get(e,r,a=!1){a&&(e=mt(e,-1,this.dim),r=mt(r,-1,this.dim));const l=4*this._idx(e,r);return(this.encoding==="terrarium"?l1:o1)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return py[e]}get unpackVector(){return py[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],l=Mh.getUnpackVector(r);let h=Math.floor((e+l[3])/l[2]);return a[2]=h%256,h=Math.floor(h/256),a[1]=h%256,h=Math.floor(h/256),a[0]=h,a}getPixels(){return new ki({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,p=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(a){case-1:p=y-1;break;case 1:y=p+1}const b=-r*this.dim,v=-a*this.dim;for(let E=p;E<y;E++)for(let k=l;k<h;k++){const M=4*this._idx(k,E),L=4*this._idx(k+b,E+v);this.pixels[M+0]=e.pixels[L+0],this.pixels[M+1]=e.pixels[L+1],this.pixels[M+2]=e.pixels[L+2],this.pixels[M+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Et(Mh,"DEMData"),Et(hy,"DemMinMaxQuadTree",{omit:["dem"]});class c1{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:r,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,l=r===void 0?0:this.data[a].indexOf(r),h=this.data[a][l];return this.data[a].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||r.push(l);for(const a of r)this.remove(a.value.tileID,a)}}class Kl{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}Kl.ReadOnly=!1,Kl.ReadWrite=!0,Kl.disabled=new Kl(519,Kl.ReadOnly,[0,1]);const zp=7680;class Op{constructor(e,r,a,l,h,p){this.test=e,this.ref=r,this.mask=a,this.fail=l,this.depthFail=h,this.pass=p}}Op.disabled=new Op({func:519,mask:0},0,0,zp,zp,zp);class Bn{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}Bn.Replace=[1,0],Bn.disabled=new Bn(Bn.Replace,ir.transparent,[!1,!1,!1,!1]),Bn.unblended=new Bn(Bn.Replace,ir.transparent,[!0,!0,!0,!0]),Bn.alphaBlended=new Bn([1,771],ir.transparent,[!0,!0,!0,!0]);const Fp=1029,Bp=2305;class jn{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}jn.disabled=new jn(!1,Fp,Bp),jn.backCCW=new jn(!0,Fp,Bp),jn.backCW=new jn(!0,Fp,2304),jn.frontCW=new jn(!0,1028,2304),jn.frontCCW=new jn(!0,1028,Bp);class qo extends no{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new c1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new a1,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return lr(this._tiles).map(e=>e.tileID).sort(fy).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&r.push(this._tiles[a]);return e?r.sort((a,l)=>{const h=a.tileID,p=l.tileID,y=new ke(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),b=new ke(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-p.overscaledZ||b.y-y.y||b.x-y.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(fy).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new an(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=nn.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Hn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const h=r[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const p=this.getTileByID(h);a(e,p),a(p,e)}}function a(l,h){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let p=h.tileID.canonical.x-l.tileID.canonical.x;const y=h.tileID.canonical.y-l.tileID.canonical.y,b=Math.pow(2,l.tileID.canonical.z),v=h.tileID.key;p===0&&y===0||Math.abs(y)>1||(Math.abs(p)>1&&(Math.abs(p+b)===1?p+=b:Math.abs(p-b)===1&&(p-=b)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,p,y),l.neighboringTiles&&l.neighboringTiles[v]&&(l.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,l){for(const h in this._tiles){let p=this._tiles[h];if(l[h]||!p.hasData()||p.tileID.overscaledZ<=r||p.tileID.overscaledZ>a)continue;let y=p.tileID;for(;p&&p.tileID.overscaledZ>r+1;){const v=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[v.key],p&&p.hasData()&&(y=v)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){l[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const l=e.scaledTo(a),h=this._getLoadedTile(l);if(h)return h}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,l=Math.ceil(e.height/r)+1,h=Math.floor(a*l*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+r),a[h.tileID.key]=h}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,r,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let l;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new di(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(l=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(y=>this._source.hasTile(y)))):l=[];const h=this._updateRetainedTiles(l);if(gy(this._source.type)&&l.length!==0){const y={},b={},v=Object.keys(h);for(const k of v){const M=h[k],L=this._tiles[k];if(!L||L.fadeEndTime&&L.fadeEndTime<=nn.now())continue;const R=this.findLoadedParent(M,Math.max(M.overscaledZ-qo.maxOverzooming,this._source.minzoom));R&&(this._addTile(R.tileID),y[R.tileID.key]=R.tileID),b[k]=M}const E=l[l.length-1].overscaledZ;for(const k in this._tiles){const M=this._tiles[k];if(h[k]||!M.hasData())continue;let L=M.tileID;for(;L.overscaledZ>E;){L=L.scaledTo(L.overscaledZ-1);const R=this._tiles[L.key];if(R&&R.hasData()&&b[L.key]){h[k]=M.tileID;break}}}for(const k in y)h[k]||(this._coveredTiles[k]=!0,h[k]=y[k])}for(const y in h)this._tiles[y].clearFadeHold();const p=function(y,b){const v=[];for(const E in y)E in b||v.push(E);return v}(this._tiles,h);for(const y of p){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const a={},l=e.reduce((v,E)=>Math.min(v,E.overscaledZ),1/0),h=e[0].overscaledZ,p=Math.max(h-qo.maxOverzooming,this._source.minzoom),y=Math.max(h+qo.maxUnderzooming,this._source.minzoom),b={};for(const v of e){const E=this._addTile(v);r[v.key]=v,E.hasData()||l<this._source.maxzoom&&(b[v.key]=v)}this._retainLoadedChildren(b,l,y,r);for(const v of e){let E=this._tiles[v.key];if(E.hasData())continue;if(v.canonical.z>=this._source.maxzoom){const M=v.children(this._source.maxzoom)[0],L=this.getTile(M);if(L&&L.hasData()){r[M.key]=M;continue}}else{const M=v.children(this._source.maxzoom);if(r[M[0].key]&&r[M[1].key]&&r[M[2].key]&&r[M[3].key])continue}let k=E.wasRequested();for(let M=v.overscaledZ-1;M>=p;--M){const L=v.scaledTo(M);if(a[L.key]||(a[L.key]=!0,E=this.getTile(L),!E&&k&&(E=this._addTile(L)),E&&(r[L.key]=L,k=E.wasRequested(),E.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}r.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;l=h}for(const h of r)this._loadedParentTiles[h]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=!!r;if(!a){const l=this.map?this.map.painter:null;r=new Rp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new Hn("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){const l=[],h=this.transform;if(!h)return l;const p=h.projection.name==="globe",y=Rn(h.center.lng);for(const b in this._tiles){const v=this._tiles[b];if(a&&v.clearQueryDebugViz(),v.holdingForFade())continue;let E;if(p){const k=v.tileID.canonical;if(k.z===0){const M=[Math.abs(mt(y,...zd(k,-1))-y),Math.abs(mt(y,...zd(k,1))-y)];E=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(mt(y,...zd(k,-1))-y),Math.abs(mt(y,...zd(k,0))-y),Math.abs(mt(y,...zd(k,1))-y)];E=[M.indexOf(Math.min(...M))-1]}}else E=[0];for(const k of E){const M=e.containsTile(v,h,r,k);M&&l.push(M)}}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(gy(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=nn.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const l=this._tiles[e];l&&l.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,r))};return void this._source.on("data",y)}const a=new Map,l=Array.isArray(e)?e:[e],h=this.map.painter.terrain,p=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const y of l){const b=y.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const v of b)a.set(v.key,v);this.usedForTerrain&&y.updateElevation(!1)}Is(Array.from(a.values()),(y,b)=>{const v=new Rp(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(v,E=>{this._source.type==="raster-dem"&&v.dem&&this._backfillDEM(v),b(E,v)})},r)}}function fy(s,e){const r=Math.abs(2*s.wrap)-+(s.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return s.overscaledZ-e.overscaledZ||a-r||e.canonical.y-s.canonical.y||e.canonical.x-s.canonical.x}function gy(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function zd(s,e){const r=1<<s.z;return[s.x/r+e,(s.x+1)/r+e]}qo.maxOverzooming=10,qo.maxUnderzooming=3;class Ph{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const l=a||e.findDEMTileFor(r);if(!l||!l.dem)return;const h=l.dem,p=l.tileID,y=1<<r.canonical.z-p.canonical.z;return new Ph(l,l.tileSize/zt/y,[(r.canonical.x/y-p.canonical.x)*h.dim,(r.canonical.y/y-p.canonical.y)*h.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(a);return new ke(l,h)}getElevationAt(e,r,a,l){const h=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],y=Math.floor(h),b=Math.floor(p),v=this._dem;return l=!!l,a?ms(ms(v.get(y,b,l),v.get(y,b+1,l),p-b),ms(v.get(y+1,b,l),v.get(y+1,b+1,l),p-b),h-y):v.get(y,b,l)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*bn(1,e)*this._dem.stride}}class xy{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ta(zt,16,0),this.featureIndexArray=new Mo,this.promoteId=r}insert(e,r,a,l,h,p=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,h,p);const b=this.grid;for(let v=0;v<r.length;v++){const E=r[v],k=[1/0,1/0,-1/0,-1/0];for(let M=0;M<E.length;M++){const L=E[M];k[0]=Math.min(k[0],L.x),k[1]=Math.min(k[1],L.y),k[2]=Math.max(k[2],L.x),k[3]=Math.max(k[3],L.y)}k[0]<zt&&k[1]<zt&&k[2]>=0&&k[3]>=0&&b.insert(y,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new bp(new yh(this.rawTileData)).layers,this.sourceLayerCoder=new sy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,l){this.loadVTLayers();const h=e.params||{},p=Sl(h.filter),y=e.tileResult,b=e.transform,v=y.bufferedTilespaceBounds,E=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(R,B,X,re)=>Vg(y.bufferedTilespaceGeometry,R,B,X,re));E.sort(d1);let k=null;b.elevation&&E.length>0&&(k=Ph.create(b.elevation,this.tileID));const M={};let L;for(let R=0;R<E.length;R++){const B=E[R];if(B===L)continue;L=B;const X=this.featureIndexArray.get(B);let re=null;this.loadMatchingFeature(M,X,p,h.layers,h.availableImages,r,a,l,(pe,ie,ue,xe=0)=>(re||(re=la(pe,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(y,pe,ue,re,this.z,e.transform,e.pixelPosMatrix,k,xe)))}return M}loadMatchingFeature(e,r,a,l,h,p,y,b,v){const{featureIndex:E,bucketIndex:k,sourceLayerIndex:M,layoutVertexArrayOffset:L}=r,R=this.bucketLayerIDs[k];if(l&&!function(pe,ie){for(let ue=0;ue<pe.length;ue++)if(ie.indexOf(pe[ue])>=0)return!0;return!1}(l,R))return;const B=this.sourceLayerCoder.decode(M),X=this.vtLayers[B].feature(E);if(a.needGeometry){const pe=Fo(X,!0);if(!a.filter(new C(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!a.filter(new C(this.tileID.overscaledZ),X))return;const re=this.getId(X,B);for(let pe=0;pe<R.length;pe++){const ie=R[pe];if(l&&l.indexOf(ie)<0)continue;const ue=p[ie];if(!ue)continue;let xe={};re!==void 0&&b&&(xe=b.getState(ue.sourceLayer||"_geojsonTileLayer",re));const ge=js({},y[ie]);ge.paint=yy(ge.paint,ue.paint,X,xe,h),ge.layout=yy(ge.layout,ue.layout,X,xe,h);const Fe=!v||v(X,ue,xe,L);if(!Fe)continue;const Re=new ry(X,this.z,this.x,this.y,re);Re.layer=ge;let He=e[ie];He===void 0&&(He=e[ie]=[]),He.push({featureIndex:E,feature:Re,intersectionZ:Fe})}}lookupSymbolFeatures(e,r,a,l,h,p,y,b){const v={};this.loadVTLayers();const E=Sl(h);for(const k of e)this.loadMatchingFeature(v,{bucketIndex:a,sourceLayerIndex:l,featureIndex:k,layoutVertexArrayOffset:0},E,p,y,b,r);return v}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(a),h=this.vtFeatures[l];if(h[r])return h[r];const p=this.vtLayers[l].feature(r);return h[r]=p,p}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];l!=null&&(a=e.properties[l]),typeof a=="boolean"&&(a=Number(a))}return a}}function yy(s,e,r,a,l){return Wt(s,(h,p)=>{const y=e instanceof se?e.get(p):null;return y&&y.evaluate?y.evaluate(r,a,l):y})}function d1(s,e){return e-s}Et(xy,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class _y{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ca({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=ss(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,y=!0;l.push({left:h,right:p,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let v=1;v<e.length;v++){y=!y;const E=e[v];h=b*a,b+=E,p=b*a,l.push({left:h,right:p,isDash:y,zeroLength:E===0})}return l}addRoundDash(e,r,a){const l=r/2;for(let h=-a;h<=a;h++){const p=this.width*(this.nextRow+a+h);let y=0,b=e[y];for(let v=0;v<this.width;v++){v/b.right>1&&(b=e[++y]);const E=Math.abs(v-b.left),k=Math.abs(v-b.right),M=Math.min(E,k);let L;const R=h/a*(l+1);if(b.isDash){const B=l-Math.abs(R);L=Math.sqrt(M*M+B*B)}else L=l-Math.sqrt(M*M+R*R);this.image.data[p+v]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const v=e[b],E=e[b+1];v.zeroLength?e.splice(b,1):E&&E.isDash===v.isDash&&(E.left=v.left,e.splice(b,1))}const a=e[0],l=e[e.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let p=0,y=e[p];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++p]);const v=Math.abs(b-y.left),E=Math.abs(b-y.right),k=Math.min(v,E);this.image.data[h+b]=Math.max(0,Math.min(255,(y.isDash?k:-k)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const l=r==="round",h=l?7:0,p=2*h+1;if(this.nextRow+p>this.height)return Ds("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let E=0;E<e.length;E++)e[E]<0&&(Ds("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),y+=e[E];if(y!==0){const E=this.width/y,k=this.getDashRanges(e,this.width,E);l?this.addRoundDash(k,E,h):this.addRegularDash(k,r==="square"?.5*E:0)}const b=this.nextRow+h;this.nextRow+=p;const v={tl:[b,h],br:[y,0]};return this.positions[a]=v,v}}Et(_y,"LineAtlas");const by=1*wn;class vy{constructor(e){const r={},a=[];for(const y in e){const b=e[y],v=r[y]={};for(const E in b.glyphs){const k=b.glyphs[+E];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const M=k.metrics.localGlyph?by:1,L={x:0,y:0,w:k.bitmap.width+2*M,h:k.bitmap.height+2*M};a.push(L),v[E]=L}}const{w:l,h}=Np(a),p=new ca({width:l||1,height:h||1});for(const y in e){const b=e[y];for(const v in b.glyphs){const E=b.glyphs[+v];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const k=r[y][v],M=E.metrics.localGlyph?by:1;ca.copy(E.bitmap,p,{x:0,y:0},{x:k.x+M,y:k.y+M},E.bitmap)}}this.image=p,this.positions=r}}Et(vy,"GlyphAtlas");class u1{constructor(e){this.tileID=new di(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Vo(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,a,l,h){this.status="parsing",this.data=e,this.collisionBoxArray=new Cs;const p=new sy(Object.keys(e.layers).sort()),y=new xy(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},v=new _y(256,256),E={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:v,availableImages:a},k=r.familiesBySource[this.source];for(const xe in k){const ge=e.layers[xe];if(!ge)continue;let Fe=!1,Re=!1;for(const Ve of k[xe])Ve[0].type==="symbol"?Fe=!0:Re=!0;if(this.isSymbolTile===!0&&!Fe||this.isSymbolTile===!1&&!Re)continue;ge.version===1&&Ds(`Vector tile source "${this.source}" layer "${xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const He=p.encode(xe),ot=[];for(let Ve=0;Ve<ge.length;Ve++){const Je=ge.feature(Ve),Ye=y.getId(Je,xe);ot.push({feature:Je,id:Ye,index:Ve,sourceLayerIndex:He})}for(const Ve of k[xe]){const Je=Ve[0];this.isSymbolTile!==void 0&&Je.type==="symbol"!==this.isSymbolTile||Je.minzoom&&this.zoom<Math.floor(Je.minzoom)||Je.maxzoom&&this.zoom>=Je.maxzoom||Je.visibility!=="none"&&(Up(Ve,this.zoom,a),(b[Je.id]=Je.createBucket({index:y.bucketLayerIDs.length,layers:Ve,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:He,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(ot,E,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Ve.map(Ye=>Ye.id)))}}let M,L,R,B;v.trim();const X={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},re=()=>{if(M)return h(M);if(L&&R&&B){const xe=new vy(L),ge=new Cx(R,B);for(const Fe in b){const Re=b[Fe];Re instanceof Va?(Up(Re.layers,this.zoom,a),zw(Re,L,xe.positions,R,ge.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Re.hasPattern&&(Re instanceof fh||Re instanceof dh||Re instanceof Sd)&&(Up(Re.layers,this.zoom,a),Re.addFeatures(E,this.tileID.canonical,ge.patternPositions,a,this.tileTransform))}this.status="done",h(null,{buckets:lr(b).filter(Fe=>!Fe.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,lineAtlas:v,imageAtlas:ge,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?R:null,glyphPositions:this.returnDependencies?xe.positions:null})}},pe=Wt(E.glyphDependencies,xe=>Object.keys(xe).map(Number));Object.keys(pe).length?l.send("getGlyphs",{uid:this.uid,stacks:pe},(xe,ge)=>{M||(M=xe,L=ge,re())},void 0,!1,X):L={};const ie=Object.keys(E.iconDependencies);ie.length?l.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(xe,ge)=>{M||(M=xe,R=ge,re())},void 0,!1,X):R={};const ue=Object.keys(E.patternDependencies);ue.length?l.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"patterns"},(xe,ge)=>{M||(M=xe,B=ge,re())},void 0,!1,X):B={},re()}}function Up(s,e,r){const a=new C(e);for(const l of s)l.recalculate(a,r)}class wy{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,l){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[p,y]=h.result;return this.scheduler?this.scheduler.add(()=>{l(p,y)},r):l(p,y),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=a((p,y)=>{h.result=[p,y];for(const b of h.callbacks)this.scheduler?this.scheduler.add(()=>{b(p,y)},r):b(p,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==l),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function jy(s,e,r){const a=JSON.stringify(s.request);return s.data&&(this.deduped.entries[a]={result:[null,s.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},l=>{const h=Qr(s.request,(p,y,b,v)=>{p?l(p):y&&l(null,{vectorTile:r?void 0:new bp(new yh(y)),rawData:y,cacheControl:b,expires:v})});return()=>{h.cancel(),l()}},e)}const Ny=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=Ny[15&a];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Vp(y,p,h,e)}constructor(e,r=64,a=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=Ny.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return qp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:y}=this,b=[0,h.length-1,0],v=[];for(;b.length;){const E=b.pop()||0,k=b.pop()||0,M=b.pop()||0;if(k-M<=y){for(let X=M;X<=k;X++){const re=p[2*X],pe=p[2*X+1];re>=e&&re<=a&&pe>=r&&pe<=l&&v.push(h[X])}continue}const L=M+k>>1,R=p[2*L],B=p[2*L+1];R>=e&&R<=a&&B>=r&&B<=l&&v.push(h[L]),(E===0?e<=R:r<=B)&&(b.push(M),b.push(L-1),b.push(1-E)),(E===0?a>=R:l>=B)&&(b.push(L+1),b.push(k),b.push(1-E))}return v}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,y=[0,l.length-1,0],b=[],v=a*a;for(;y.length;){const E=y.pop()||0,k=y.pop()||0,M=y.pop()||0;if(k-M<=p){for(let X=M;X<=k;X++)Ty(h[2*X],h[2*X+1],e,r)<=v&&b.push(l[X]);continue}const L=M+k>>1,R=h[2*L],B=h[2*L+1];Ty(R,B,e,r)<=v&&b.push(l[L]),(E===0?e-a<=R:r-a<=B)&&(y.push(M),y.push(L-1),y.push(1-E)),(E===0?e+a>=R:r+a>=B)&&(y.push(L+1),y.push(k),y.push(1-E))}return b}}function qp(s,e,r,a,l,h){if(l-a<=r)return;const p=a+l>>1;Sy(s,e,p,a,l,h),qp(s,e,r,a,p-1,1-h),qp(s,e,r,p+1,l,1-h)}function Sy(s,e,r,a,l,h){for(;l>a;){if(l-a>600){const v=l-a+1,E=r-a+1,k=Math.log(v),M=.5*Math.exp(2*k/3),L=.5*Math.sqrt(k*M*(v-M)/v)*(E-v/2<0?-1:1);Sy(s,e,r,Math.max(a,Math.floor(r-E*M/v+L)),Math.min(l,Math.floor(r+(v-E)*M/v+L)),h)}const p=e[2*r+h];let y=a,b=l;for(Od(s,e,a,r),e[2*l+h]>p&&Od(s,e,a,l);y<b;){for(Od(s,e,y,b),y++,b--;e[2*y+h]<p;)y++;for(;e[2*b+h]>p;)b--}e[2*a+h]===p?Od(s,e,a,b):(b++,Od(s,e,b,l)),b<=r&&(a=b+1),r<=b&&(l=b-1)}}function Od(s,e,r,a){$p(s,r,a),$p(e,2*r,2*a),$p(e,2*r+1,2*a+1)}function $p(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}function Ty(s,e,r,a){const l=s-r,h=e-a;return l*l+h*h}n.ARRAY_TYPE=Ci,n.AUTH_ERR_MSG=ye,n.Aabb=ci,n.Actor=class{constructor(s,e,r){this.target=s,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Cr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ri()?s:P,this.scheduler=new i1}send(s,e,r,a,l=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=h,this.callbacks[p]=r);const y=et(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:s,hasCallback:!!r,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:Da(e,y)},y),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(s){const e=s.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(e.mustQueue||ri()){const a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),a&&a.metadata||{type:"message"})}else this.processTask(r,e)}processTask(s,e){if(e.type==="<response>"){const r=this.callbacks[s];delete this.callbacks[s],r&&(e.error?r(sa(e.error)):r(null,sa(e.data)))}else{const r=et(this.globalScope)?void 0:[],a=e.hasCallback?(h,p)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:h?Da(h):null,data:Da(p,r)},r)}:h=>{},l=sa(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,a);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],l.source)[h[1]](l,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.CanonicalTileID=ph,n.Color=ir,n.ColorMode=Bn,n.CullFaceMode=jn,n.DEMData=Mh,n.DataConstantProperty=F,n.DedupedRequest=wy,n.DepthMode=Kl,n.EXTENT=zt,n.Elevation=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,l=Math.floor(s.x),h=Math.floor((s.x-l)*a),p=Math.floor(s.y*a),y=this.findDEMTileFor(new di(r,l,r,h,p));return!(!y||!y.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||s.y<0||s.y>1)return e;const l=a.getSource().maxzoom,h=1<<l,p=Math.floor(s.x),y=s.x-p,b=new di(l,p,l,Math.floor(y*h),Math.floor(s.y*h)),v=this.findDEMTileFor(b);if(!v||!v.dem)return e;const E=v.dem,k=1<<v.tileID.canonical.z,M=(y*k-v.tileID.canonical.x)*E.dim,L=(s.y*k-v.tileID.canonical.y)*E.dim,R=Math.floor(M),B=Math.floor(L);return(r?this.exaggeration():1)*ms(ms(E.get(R,B),E.get(R,B+1),L-B),ms(E.get(R+1,B),E.get(R+1,B+1),L-B),M-R)}getAtTileOffset(s,e,r){const a=1<<s.canonical.z;return this.getAtPointOrZero(new Rl(s.wrap+(s.canonical.x+e/zt)/a,(s.canonical.y+r/zt)/a))}getAtTileOffsetFunc(s,e,r,a){return l=>{const h=this.getAtTileOffset(s,l.x,l.y),p=a.upVector(s.canonical,l.x,l.y);return Fi(p,p,h*a.upVectorScale(s.canonical,e,r).metersToTile),p}}getForTilePoints(s,e,r,a){if(this.isUsingMockSource())return!1;const l=Ph.create(this,s,a);return!!l&&(e.forEach(h=>{h[2]=this.exaggeration()*l.getElevationAt(h[0],h[1],r)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,l=1<<s.canonical.z-a.canonical.z;let h=s.canonical.x/l-a.canonical.x,p=s.canonical.y/l-a.canonical.y,y=0;for(let b=0;b<s.canonical.z-a.canonical.z&&!r.leaves[y];b++){h*=2,p*=2;const v=2*Math.floor(p)+Math.floor(h);y=r.childOffsets[y]+v,h%=1,p%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},n.ErrorEvent=an,n.EvaluationParameters=C,n.Event=Hn,n.Evented=no,n.FillExtrusionBucket=Sd,n.Frustum=Qm,n.FrustumCorners=Km,n.GLOBE_RADIUS=Dn,n.GLOBE_SCALE_MATCH_LATITUDE=45,n.GLOBE_ZOOM_THRESHOLD_MAX=Sg,n.GLOBE_ZOOM_THRESHOLD_MIN=Jm,n.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,e){const r=new at,a=new It,l=[],h=s+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),b=(v,E,k)=>{let M=v===h-1?v-2:v===0?v:v-1;return M+=k?24575:0,[M,E]};for(let v=0;v<h;++v)r.emplaceBack(...b(v,0,!0));for(let v=0;v<p;++v)for(let E=0;E<h;++E)r.emplaceBack(...b(E,v,(E===0||E===h-1)&&!0));for(let v=0;v<e.length;++v){const E=e[v];for(let k=0;k<h;++k)r.emplaceBack(...b(k,E,!0))}for(let v=0;v<e.length;++v){const E=a.length,k=e[v]+1+2,M=new It;for(let B=0;B<k-1;B++){const X=B===k-2,re=X?h*(y-e.length+v-B):h;for(let pe=0;pe<h-1;pe++){const ie=B*h+pe;B===0||X||pe===0||pe===h-2?(M.emplaceBack(ie+1,ie,ie+re),M.emplaceBack(ie+re,ie+re+1,ie+1)):(a.emplaceBack(ie+1,ie,ie+re),a.emplaceBack(ie+re,ie+re+1,ie+1))}}const L=mr.simpleSegment(0,E,r.length,a.length-E);for(let B=0;B<M.uint16.length;B+=3)a.emplaceBack(M.uint16[B],M.uint16[B+1],M.uint16[B+2]);const R=mr.simpleSegment(0,E,r.length,a.length-E);l.push({withoutSkirts:L,withSkirts:R})}return{vertices:r,indices:a,segments:l}}_createGrid(s){const e=this._fillGridMeshWithLods(zo,fd);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,pd.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new It;for(let l=0;l<=zo;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const r=new Es,a=new Es;this._poleSegments=[];for(let l=0,h=0;l<Jm;l++){const p=360/(1<<l);r.emplaceBack(0,-Dn,0,.5,0),a.emplaceBack(0,-Dn,0,.5,1);for(let y=0;y<=zo;y++){const b=y/zo,v=ms(0,p,b),[E,k,M]=Il(iv,nv,v,Dn);r.emplaceBack(E,k,M,b,0),a.emplaceBack(E,k,M,b,1)}this._poleSegments.push(mr.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(r,jg,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(a,jg,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,e){if(!this._wireframeSegments){const r=new Pr,a=zo,l=a+1+2,h=1;this._wireframeSegments=[];for(let p=0,y=0;p<fd.length;p++){const b=fd[p];for(let E=h;E<b+h;E++)for(let k=h;k<a+h;k++){const M=E*l+k;r.emplaceBack(M,M+1),r.emplaceBack(M,M+l),r.emplaceBack(M,M+l+1)}const v=b*a*3;this._wireframeSegments.push(mr.simpleSegment(0,y,(b+1)*l,v)),y+=v}this._wireframeIndexBuffer=s.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},n.GlyphManager=Gl,n.ImagePosition=Sp,n.KDBush=Vp,n.LivePerformanceUtils=ym,n.LngLat=ks,n.LngLatBounds=Oa,n.LocalGlyphMode=Cp,n.MAX_MERCATOR_LATITUDE=Xr,n.MercatorCoordinate=Rl,n.ONE_EM=Ur,n.OverscaledTileID=di,n.PerformanceMarkers=xa,n.Point=ke,n.Properties=le,n.RGBAImage=ki,n.Ray=Xm,n.RequestManager=class{constructor(s,e,r){this._transformRequestFn=s,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const s=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",te,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,e){return this._transformRequestFn&&this._transformRequestFn(s,e)||{url:s}}normalizeStyleURL(s,e){if(!Ee(s))return s;const r=_t(s);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(s,e){if(!Ee(s))return s;const r=_t(s);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(s,e,r,a){if(!Ee(s))return s;const l=_t(s);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),r&&l.params.push(`language=${r}`),a&&l.params.push(`worldview=${a}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(s,e,r,a){const l=_t(s);return Ee(s)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=`${e}${r}`,ut(l))}normalizeTileURL(s,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ee(s))return s;const a=_t(s);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${W.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${U.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${U.TILE_URL_VERSION}${a.path}`);const l=this._customAccessToken||function(h){for(const p of h){const y=p.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||U.ACCESS_TOKEN;return U.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,l)}canonicalizeTileURL(s,e){const r=_t(s);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return s;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${U.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${U.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter(h=>!h.match(/^access_token=/))),l.length&&(a+=`?${l.join("&")}`),a}canonicalizeTileset(s,e){const r=!!e&&Ee(e),a=[];for(const l of s.tiles||[])De(l)?a.push(this.canonicalizeTileURL(l,r)):a.push(l);return a}_makeAPIURL(s,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=_t(U.API_URL);if(s.protocol=a.protocol,s.authority=a.authority,s.protocol==="http"){const l=s.params.indexOf("secure");l>=0&&s.params.splice(l,1)}if(a.path!=="/"&&(s.path=`${a.path}${s.path}`),!U.REQUIRE_ACCESS_TOKEN)return ut(s);if(e=e||U.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return s.params=s.params.filter(l=>l.indexOf("access_token")===-1),s.params.push(`access_token=${e||""}`),ut(s)}},n.ResourceType=sr,n.SegmentVector=mr,n.SourceCache=qo,n.StencilMode=Op,n.StructArrayLayout1ui2=Ei,n.StructArrayLayout2f1f2i16=Ft,n.StructArrayLayout2i4=at,n.StructArrayLayout2ui4=Pr,n.StructArrayLayout3f12=es,n.StructArrayLayout3ui6=It,n.StructArrayLayout4i8=Qe,n.StructArrayLayout5f20=Es,n.Texture=Rd,n.Tile=Rp,n.Transitionable=O,n.Uniform1f=Qu,n.Uniform1i=class extends na{constructor(s){super(s),this.current=0}set(s,e,r){this.fetchUniformLocation(s,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},n.Uniform2f=class extends na{constructor(s){super(s),this.current=[0,0]}set(s,e,r){this.fetchUniformLocation(s,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},n.Uniform3f=class extends na{constructor(s){super(s),this.current=[0,0,0]}set(s,e,r){this.fetchUniformLocation(s,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},n.Uniform4f=ag,n.UniformColor=og,n.UniformMatrix2f=class extends na{constructor(s){super(s),this.current=Vb}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let a=0;a<4;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},n.UniformMatrix3f=class extends na{constructor(s){super(s),this.current=Ub}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.UniformMatrix4f=class extends na{constructor(s){super(s),this.current=Bb}set(s,e,r){if(this.fetchUniformLocation(s,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},n.UnwrappedTileID=mx,n.ValidationError=Tt,n.VectorTileFeature=hh,n.VectorTileWorkerSource=class extends no{constructor(s,e,r,a,l){super(),this.actor=s,this.layerIndex=e,this.availableImages=r,this.loadVectorData=l||jy,this.loading={},this.loaded={},this.deduped=new wy(s.scheduler),this.isSpriteLoaded=a,this.scheduler=s.scheduler}loadTile(s,e){const r=s.uid,a=s&&s.request,l=a&&a.collectResourceTiming,h=this.loading[r]=new u1(s);h.abort=this.loadVectorData(s,(p,y)=>{const b=!this.loading[r];if(delete this.loading[r],b||p||!y)return h.status="done",b||(this.loaded[r]=h),e(p);const v=y.rawData,E={};y.expires&&(E.expires=y.expires),y.cacheControl&&(E.cacheControl=y.cacheControl),h.vectorTile=y.vectorTile||new bp(new yh(v));const k=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,L)=>{if(M||!L)return e(M);const R={};if(l){const B=uc(a);B.length>0&&(R.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,js({rawTileData:v.slice(0)},L,E,R))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[r]=h})}reloadTile(s,e){const r=this.loaded,a=s.uid,l=this;if(r&&r[a]){const h=r[a];h.showCollisionBoxes=s.showCollisionBoxes,h.enableTerrain=!!s.enableTerrain,h.projection=s.projection,h.tileTransform=Vo(s.tileID.canonical,s.projection);const p=(y,b)=>{const v=h.reloadCallback;v&&(delete h.reloadCallback,h.parse(h.vectorTile,l.layerIndex,this.availableImages,l.actor,v)),e(y,b)};h.status==="parsing"?h.reloadCallback=p:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(s,e){const r=s.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(s,e){const r=this.loaded,a=s.uid;r&&r[a]&&delete r[a],e()}},n.WritingMode=Ui,n.ZoomDependentExpression=No,n.add=oa,n.addDynamicAttributes=Ch,n.adjoint=function(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=e[4],y=e[5],b=e[6],v=e[7],E=e[8];return s[0]=p*E-y*v,s[1]=l*v-a*E,s[2]=a*y-l*p,s[3]=y*b-h*E,s[4]=r*E-l*b,s[5]=l*h-r*y,s[6]=h*v-p*b,s[7]=a*b-r*v,s[8]=r*p-a*h,s},n.asyncAll=Is,n.bezier=ft,n.bindAll=Cr,n.boundsAttributes=ny,n.bufferConvexPolygon=function(s,e){const r=[];for(let a=0;a<s.length;a++){const l=ts(a-1,-1,s.length-1),h=ts(a+1,-1,s.length-1),p=s[a],y=s[h],b=s[l].sub(p).unit(),v=y.sub(p).unit(),E=v.angleWithSep(b.x,b.y),k=b.add(v).unit().mult(-1*e/Math.sin(E/2));r.push(p.add(k))}return r},n.cacheEntryPossiblyAdded=function(s){cr++,cr>hs&&(s.getActor().send("enforceCacheSizeLimit",Ot),cr=0)},n.calculateGlobeLabelMatrix=function(s,e){const{x:r,y:a}=s.point,l=Ag(r,a,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Do(l,l,tp(Ln(e)))},n.calculateGlobeMatrix=function(s){const{x:e,y:r}=s.point,{lng:a,lat:l}=s._center;return Ag(e,r,s.worldSize,a,l)},n.calculateGlobeMercatorMatrix=function(s){const e=s.pixelsPerMeter,r=e/bn(1,s.center.lat),a=yn(new Float64Array(16));return ld(a,a,[s.point.x,s.point.y,0]),Lo(a,a,[r,r,e]),Float32Array.from(a)},n.circumferenceAtLatitude=rp,n.clamp=mt,n.clearTileCache=function(s){if(!qt())return;const e=P.caches.delete(yt);s&&e.catch(s).then(()=>s())},n.clipLine=Ux,n.clone=function(s){var e=new Ci(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},n.clone$1=vr,n.collisionCircleLayout=cw,n.config=U,n.conjugate=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},n.create=function(){var s=new Ci(16);return Ci!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},n.create$1=dg,n.createExpression=Ma,n.createLayout=Ce,n.createStyleLayer=function(s){return s.type==="custom"?new e1(s):new s1[s.type](s)},n.cross=Hm,n.degToRad=Me,n.distance=function(s,e){return Math.hypot(e[0]-s[0],e[1]-s[1],e[2]-s[2])},n.div=function(s,e,r){return s[0]=e[0]/r[0],s[1]=e[1]/r[1],s[2]=e[2]/r[2],s},n.dot=Xi,n.earthRadius=yd,n.ease=Mt,n.easeCubicInOut=St,n.ecefToLatLng=function([s,e,r]){const a=Math.hypot(s,e,r),l=Math.atan2(s,r),h=.5*Math.PI-Math.acos(-e/a);return new ks(st(l),st(h))},n.emitValidationErrors=Gu,n.endsWith=Li,n.enforceCacheSizeLimit=function(s){Ns(),as&&as.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-s;a++)e.delete(r[a])})})},n.evaluateSizeForFeature=gh,n.evaluateSizeForZoom=Ul,n.evaluateVariableOffset=Zx,n.evented=x,n.exactEquals=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},n.exactEquals$1=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]},n.exported=nn,n.exported$1=W,n.extend=js,n.extend$1=on,n.fillExtrusionHeightLift=dx,n.filterObject=gi,n.fromMat4=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},n.fromQuat=function(s,e){var r=e[0],a=e[1],l=e[2],h=e[3],p=r+r,y=a+a,b=l+l,v=r*p,E=a*p,k=a*y,M=l*p,L=l*y,R=l*b,B=h*p,X=h*y,re=h*b;return s[0]=1-k-R,s[1]=E+re,s[2]=M-X,s[3]=0,s[4]=E-re,s[5]=1-v-R,s[6]=L+B,s[7]=0,s[8]=M+X,s[9]=L-B,s[10]=1-v-k,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},n.fromRotation=function(s,e){var r=Math.sin(e),a=Math.cos(e);return s[0]=a,s[1]=r,s[2]=0,s[3]=-r,s[4]=a,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},n.fromScaling=hg,n.furthestTileCorner=function(s){const e=Math.round((s+45+360)%360/90)%4;return lt[e]},n.getAABBPointSquareDist=function(s,e,r){let a=0;for(let l=0;l<2;++l){const h=r?r[l]:0;s[l]>h&&(a+=(s[l]-h)*(s[l]-h)),e[l]<h&&(a+=(h-e[l])*(h-e[l]))}return a},n.getAnchorAlignment=Ep,n.getAnchorJustification=Ap,n.getBounds=function(s){let e=1/0,r=1/0,a=-1/0,l=-1/0;for(const h of s)e=Math.min(e,h.x),r=Math.min(r,h.y),a=Math.max(a,h.x),l=Math.max(l,h.y);return{min:new ke(e,r),max:new ke(a,l)}},n.getColumn=wt,n.getDefaultExportFromCjs=Ne,n.getGridMatrix=function(s,e,r,a){const l=e.getNorth(),h=e.getSouth(),p=e.getWest(),y=e.getEast(),b=1<<s.z,v=y-p,E=l-h,k=v/zo,M=-E/fd[r],L=[0,k,0,M,0,0,l,p,0];if(s.z>0){const R=180/a;ug(L,L,[R/v+1,0,0,0,R/E+1,0,-.5*R/k,.5*R/M,1])}return L[2]=b,L[5]=s.x,L[8]=s.y,L},n.getImage=ce,n.getJSON=function(s,e){return Kr(js(s,{type:"json"}),e)},n.getLatitudinalLod=function(s){const e=Xr-5;s=mt(s,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Me(s))),3);return Math.round(r*(fd.length-1))},n.getMapSessionAPI=kr,n.getPerformanceMeasurement=uc,n.getProjection=ey,n.getRTLTextPluginStatus=_,n.getReferrer=ii,n.getTilePoint=function(s,{x:e,y:r},a=0){return new ke(((e-a)*s.scale-s.x)*zt,(r*s.scale-s.y)*zt)},n.getTileVec3=function(s,e,r=0){return Pl(((e.x-r)*s.scale-s.x)*zt,(e.y*s.scale-s.y)*zt,Dg(e.z,e.y))},n.getVideo=function(s,e){const r=P.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<s.length;a++){const l=P.document.createElement("source");Fr(s[a])||(r.crossOrigin="Anonymous"),l.src=s[a],r.appendChild(l)}return{cancel:()=>{}}},n.globeCenterToScreenPoint=function(s){const e=[0,0,0],r=yn(new Float64Array(16));return Do(r,s.pixelMatrix,s.globeMatrix),nr(e,e,r),new ke(e[0],e[1])},n.globeDenormalizeECEF=tp,n.globeECEFOrigin=function(s,e){const r=[0,0,0];return nr(r,r,xd(Ln(e.canonical))),nr(r,r,s),r},n.globeMetersToEcef=eh,n.globeNormalizeECEF=xd,n.globePixelsToTileUnits=function(s,e){return zt/(512*Math.pow(2,s))*sh(Ln(e))},n.globePoleMatrixForTile=function(s,e,r){const a=yn(new Float64Array(16)),l=(e/(1<<s)-.5)*Math.PI*2;return Yu(a,r.globeMatrix,l),Float32Array.from(a)},n.globeTileBounds=Ln,n.globeTiltAtLngLat=Mg,n.globeToMercatorTransition=Ll,n.globeUseCustomAntiAliasing=function(s,e,r){const a=Ll(r.zoom),l=s.style.map._antialias,h=!!e.extStandardDerivatives,p=e.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return a===0&&!l&&!p&&h},n.identity=yn,n.identity$1=bg,n.invert=$m,n.isFullscreen=function(){return!!P.document.fullscreenElement||!!P.document.webkitFullscreenElement},n.isLngLatBehindGlobe=sp,n.isMapAuthenticated=function(s){return Jr.has(s)},n.isMapboxURL=Ee,n.isSafariWithAntialiasingBug=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!et(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.latFromMercatorY=Hr,n.latLngToECEF=Dl,n.len=Qb,n.length=cd,n.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},n.lngFromMercatorX=Bi,n.loadVectorTile=jy,n.makeRequest=Kr,n.mapValue=function(s,e,r,a,l){return mt((s-e)/(r-e)*(l-a)+a,a,l)},n.mercatorScale=Lg,n.mercatorXfromLng=Rn,n.mercatorYfromLat=zn,n.mercatorZfromAltitude=bn,n.mul=Xb,n.mul$1=Kb,n.multiply=Do,n.multiply$1=ug,n.multiply$2=fg,n.nextPowerOfTwo=ss,n.normalize=li,n.normalize$1=Jb,n.normalize$2=yg,n.number=ms,n.ortho=function(s,e,r,a,l,h,p){var y=1/(e-r),b=1/(a-l),v=1/(h-p);return s[0]=-2*y,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*v,s[11]=0,s[12]=(e+r)*y,s[13]=(l+a)*b,s[14]=(p+h)*v,s[15]=1,s},n.pbf=bx,n.perspective=function(s,e,r,a,l){var h,p=1/Math.tan(e/2);return s[0]=p/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,l!=null&&l!==1/0?(s[10]=(l+a)*(h=1/(a-l)),s[14]=2*l*a*h):(s[10]=-1,s[14]=-2*a),s},n.pick=function(s,e){const r={};for(let a=0;a<e.length;a++){const l=e[a];l in s&&(r[l]=s[l])}return r},n.plugin=S,n.pointGeometry=fe,n.polesInViewport=function(s){const e=yn(new Float64Array(16));Do(e,s.pixelMatrix,s.globeMatrix);const r=[0,Ki,0],a=[0,Qi,0];return nr(r,r,e),nr(a,a,e),[r[0]>0&&r[0]<=s.width&&r[1]>0&&r[1]<=s.height&&!sp(s,new ks(s.center.lat,90)),a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!sp(s,new ks(s.center.lat,-90))]},n.polygonContainsPoint=Bo,n.polygonIntersectsBox=Vg,n.polygonIntersectsPolygon=Og,n.polygonizeBounds=function(s,e,r=0,a=!0){const l=new ke(r,r),h=s.sub(l),p=e.add(l),y=[h,new ke(p.x,h.y),p,new ke(h.x,p.y)];return a&&y.push(h.clone()),y},n.posAttributes=pd,n.postMapLoadEvent=dr,n.postPerformanceEvent=wr,n.postTurnstileEvent=ls,n.potpack=Np,n.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},n.radToDeg=st,n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.registerForPluginStateChange=function(s){return s({pluginStatus:u,pluginURL:i}),x.on("pluginStateChange",s),s},n.removeAuthState=function(s){Jr.delete(s)},n.renderColorRamp=up,n.resample=Rg,n.rotateX=Gm,n.rotateX$1=vg,n.rotateY=Yu,n.rotateY$1=wg,n.rotateZ=function(s,e,r){var a=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],y=e[2],b=e[3],v=e[4],E=e[5],k=e[6],M=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=h*l+v*a,s[1]=p*l+E*a,s[2]=y*l+k*a,s[3]=b*l+M*a,s[4]=v*l-h*a,s[5]=E*l-p*a,s[6]=k*l-y*a,s[7]=M*l-b*a,s},n.rotateZ$1=function(s,e,r){r*=.5;var a=e[0],l=e[1],h=e[2],p=e[3],y=Math.sin(r),b=Math.cos(r);return s[0]=a*b+l*y,s[1]=l*b-a*y,s[2]=h*b+p*y,s[3]=p*b-h*y,s},n.scale=Lo,n.scale$1=xg,n.scale$2=Fi,n.scaleAndAdd=hd,n.set=function(s,e,r,a){return s[0]=e,s[1]=r,s[2]=a,s},n.setCacheLimits=function(s,e){Ot=s,hs=e},n.setColumn=function(s,e,r){s[4*e+0]=r[0],s[4*e+1]=r[1],s[4*e+2]=r[2],s[4*e+3]=r[3]},n.setRTLTextPlugin=function(s,e,r=!1){if(u===rd||u===id||u===nd)throw new Error("setRTLTextPlugin cannot be called multiple times.");i=nn.resolveURL(s),u=rd,La=e,m(),r||j()},n.smoothstep=Fs,n.spec=We,n.squaredLength=function(s){var e=s[0],r=s[1],a=s[2];return e*e+r*r+a*a},n.storeAuthState=function(s,e){e?Jr.add(s):Jr.delete(s)},n.sub=_n,n.subtract=Wm,n.symbolSize=dw,n.tileAABB=function(s,e,r,a,l,h,p,y,b){if(b.name==="globe")return rv(s,e,new ph(r,a,l));const v=Vo({z:r,x:a,y:l},b);return new ci([(h+v.x/v.scale)*e,e*(v.y/v.scale),p],[(h+v.x2/v.scale)*e,e*(v.y2/v.scale),y])},n.tileCornersToBounds=th,n.tileTransform=Vo,n.transformMat3=function(s,e,r){var a=e[0],l=e[1],h=e[2];return s[0]=a*r[0]+l*r[3]+h*r[6],s[1]=a*r[1]+l*r[4]+h*r[7],s[2]=a*r[2]+l*r[5]+h*r[8],s},n.transformMat4=nr,n.transformMat4$1=Ro,n.transformQuat=gg,n.transitionTileAABBinECEF=Eg,n.translate=ld,n.transpose=function(s,e){if(s===e){var r=e[1],a=e[2],l=e[5];s[1]=e[3],s[2]=e[6],s[3]=r,s[5]=e[7],s[6]=a,s[7]=l}else s[0]=e[0],s[1]=e[3],s[2]=e[6],s[3]=e[1],s[4]=e[4],s[5]=e[7],s[6]=e[2],s[7]=e[5],s[8]=e[8];return s},n.triggerPluginCompletionEvent=o,n.uniqueId=Tr,n.updateGlobeVertexNormal=function(s,e,r,a,l){const h=5*e+2;s.float32[h+0]=r,s.float32[h+1]=a,s.float32[h+2]=l},n.validateCustomStyleLayer=function(s){const e=[],r=s.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateFilter=s=>Ti(ko(s)),n.validateFog=s=>Ti(Vu(s)),n.validateLayer=s=>Ti(Ou(s)),n.validateLight=s=>Ti(Uu(s)),n.validateSource=s=>Ti(Bu(s)),n.validateStyle=$u,n.validateTerrain=s=>Ti(Jc(s)),n.values=lr,n.vectorTile=uh,n.version=z,n.warnOnce=Ds,n.window=P,n.wrap=ts}),T(["./shared"],function(n){function P(he){if(typeof he=="number"||typeof he=="boolean"||typeof he=="string"||he==null)return JSON.stringify(he);if(Array.isArray(he)){let $="[";for(const ce of he)$+=`${P(ce)},`;return`${$}]`}let V="{";for(const $ of Object.keys(he).sort())V+=`${$}:${P(he[$])},`;return`${V}}`}function z(he){let V="";for(const $ of n.refProperties)V+=`/${P(he[$])}`;return V}class q{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(const ye of V)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=n.createStyleLayer(ye)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of $)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ce=function(ye,Ee){const De={};for(let Te=0;Te<ye.length;Te++){const qe=Ee&&Ee[ye[Te].id]||z(ye[Te]);Ee&&(Ee[ye[Te].id]=qe);let gt=De[qe];gt||(gt=De[qe]=[]),gt.push(ye[Te])}const Ie=[];for(const Te in De)Ie.push(De[Te]);return Ie}(n.values(this._layerConfigs),this.keyCache);for(const ye of ce){const Ee=ye.map(_t=>this._layers[_t.id]),De=Ee[0];if(De.visibility==="none")continue;const Ie=De.source||"";let Te=this.familiesBySource[Ie];Te||(Te=this.familiesBySource[Ie]={});const qe=De.sourceLayer||"_geojsonTileLayer";let gt=Te[qe];gt||(gt=Te[qe]=[]),gt.push(Ee)}}}class U{loadTile(V,$){const{uid:ce,encoding:ye,rawImageData:Ee,padding:De,buildQuadTree:Ie}=V,Te=n.window.ImageBitmap&&Ee instanceof n.window.ImageBitmap?this.getImageData(Ee,De):Ee;$(null,new n.DEMData(ce,Te,ye,De<1,Ie))}getImageData(V,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const ce=this.offscreenCanvasContext.getImageData(-$,-$,V.width+2*$,V.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}function W(he,V){if(he.length!==0){H(he[0],V);for(var $=1;$<he.length;$++)H(he[$],!V)}}function H(he,V){for(var $=0,ce=0,ye=0,Ee=he.length,De=Ee-1;ye<Ee;De=ye++){var Ie=(he[ye][0]-he[De][0])*(he[De][1]+he[ye][1]),Te=$+Ie;ce+=Math.abs($)>=Math.abs(Ie)?$-Te+Ie:Ie-Te+$,$=Te}$+ce>=0!=!!V&&he.reverse()}var G=n.getDefaultExportFromCjs(function he(V,$){var ce,ye=V&&V.type;if(ye==="FeatureCollection")for(ce=0;ce<V.features.length;ce++)he(V.features[ce],$);else if(ye==="GeometryCollection")for(ce=0;ce<V.geometries.length;ce++)he(V.geometries[ce],$);else if(ye==="Feature")he(V.geometry,$);else if(ye==="Polygon")W(V.coordinates,$);else if(ye==="MultiPolygon")for(ce=0;ce<V.coordinates.length;ce++)W(V.coordinates[ce],$);return V});const J=n.VectorTileFeature.prototype.toGeoJSON;var de={exports:{}},ne=n.pointGeometry,te=n.vectorTile.VectorTileFeature,Ne=me;function me(he,V){this.options=V||{},this.features=he,this.length=he.length}function Pe(he,V){this.id=typeof he.id=="number"?he.id:void 0,this.type=he.type,this.rawGeometry=he.type===1?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=V||4096}me.prototype.feature=function(he){return new Pe(this.features[he],this.options.extent)},Pe.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var V=0;V<he.length;V++){for(var $=he[V],ce=[],ye=0;ye<$.length;ye++)ce.push(new ne($[ye][0],$[ye][1]));this.geometry.push(ce)}return this.geometry},Pe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,V=1/0,$=-1/0,ce=1/0,ye=-1/0,Ee=0;Ee<he.length;Ee++)for(var De=he[Ee],Ie=0;Ie<De.length;Ie++){var Te=De[Ie];V=Math.min(V,Te.x),$=Math.max($,Te.x),ce=Math.min(ce,Te.y),ye=Math.max(ye,Te.y)}return[V,ce,$,ye]},Pe.prototype.toGeoJSON=te.prototype.toGeoJSON;var Se=n.pbf,fe=Ne;function Be(he){var V=new Se;return function($,ce){for(var ye in $.layers)ce.writeMessage(3,ke,$.layers[ye])}(he,V),V.finish()}function ke(he,V){var $;V.writeVarintField(15,he.version||1),V.writeStringField(1,he.name||""),V.writeVarintField(5,he.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<he.length;$++)ce.feature=he.feature($),V.writeMessage(2,Ge,ce);var ye=ce.keys;for($=0;$<ye.length;$++)V.writeStringField(3,ye[$]);var Ee=ce.values;for($=0;$<Ee.length;$++)V.writeMessage(4,St,Ee[$])}function Ge(he,V){var $=he.feature;$.id!==void 0&&V.writeVarintField(1,$.id),V.writeMessage(2,we,he),V.writeVarintField(3,$.type),V.writeMessage(4,lt,$)}function we(he,V){var $=he.feature,ce=he.keys,ye=he.values,Ee=he.keycache,De=he.valuecache;for(var Ie in $.properties){var Te=$.properties[Ie],qe=Ee[Ie];if(Te!==null){qe===void 0&&(ce.push(Ie),Ee[Ie]=qe=ce.length-1),V.writeVarint(qe);var gt=typeof Te;gt!=="string"&&gt!=="boolean"&&gt!=="number"&&(Te=JSON.stringify(Te));var _t=gt+":"+Te,ut=De[_t];ut===void 0&&(ye.push(Te),De[_t]=ut=ye.length-1),V.writeVarint(ut)}}}function Me(he,V){return(V<<3)+(7&he)}function st(he){return he<<1^he>>31}function lt(he,V){for(var $=he.loadGeometry(),ce=he.type,ye=0,Ee=0,De=$.length,Ie=0;Ie<De;Ie++){var Te=$[Ie],qe=1;ce===1&&(qe=Te.length),V.writeVarint(Me(1,qe));for(var gt=ce===3?Te.length-1:Te.length,_t=0;_t<gt;_t++){_t===1&&ce!==1&&V.writeVarint(Me(2,gt-1));var ut=Te[_t].x-ye,Ht=Te[_t].y-Ee;V.writeVarint(st(ut)),V.writeVarint(st(Ht)),ye+=ut,Ee+=Ht}ce===3&&V.writeVarint(Me(7,1))}}function St(he,V){var $=typeof he;$==="string"?V.writeStringField(1,he):$==="boolean"?V.writeBooleanField(7,he):$==="number"&&(he%1!=0?V.writeDoubleField(3,he):he<0?V.writeSVarintField(6,he):V.writeVarintField(5,he))}de.exports=Be,de.exports.fromVectorTileJs=Be,de.exports.fromGeojsonVt=function(he,V){V=V||{};var $={};for(var ce in he)$[ce]=new fe(he[ce].features,V),$[ce].name=ce,$[ce].version=V.version,$[ce].extent=V.extent;return Be({layers:$})},de.exports.GeoJSONWrapper=fe;var ft=n.getDefaultExportFromCjs(de.exports);const Mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},mt=Math.fround||(Fs=new Float32Array(1),he=>(Fs[0]=+he,Fs[0]));var Fs;const ts=3,Is=5,lr=6;class js{constructor(V){this.options=Object.assign(Object.create(Mt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:$,minZoom:ce,maxZoom:ye}=this.options;$&&console.time("total time");const Ee=`prepare ${V.length} points`;$&&console.time(Ee),this.points=V;const De=[];for(let Te=0;Te<V.length;Te++){const qe=V[Te];if(!qe.geometry)continue;const[gt,_t]=qe.geometry.coordinates,ut=mt(vs(gt)),Ht=mt(ss(_t));De.push(ut,Ht,1/0,Te,-1,1),this.options.reduce&&De.push(0)}let Ie=this.trees[ye+1]=this._createTree(De);$&&console.timeEnd(Ee);for(let Te=ye;Te>=ce;Te--){const qe=+Date.now();Ie=this.trees[Te]=this._createTree(this._cluster(Ie,Te)),$&&console.log("z%d: %d clusters in %dms",Te,Ie.numItems,+Date.now()-qe)}return $&&console.timeEnd("total time"),this}getClusters(V,$){let ce=((V[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,V[1]));let Ee=V[2]===180?180:((V[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ce=-180,Ee=180;else if(ce>Ee){const _t=this.getClusters([ce,ye,180,De],$),ut=this.getClusters([-180,ye,Ee,De],$);return _t.concat(ut)}const Ie=this.trees[this._limitZoom($)],Te=Ie.range(vs(ce),ss(De),vs(Ee),ss(ye)),qe=Ie.data,gt=[];for(const _t of Te){const ut=this.stride*_t;gt.push(qe[ut+Is]>1?Sr(qe,ut,this.clusterProps):this.points[qe[ut+ts]])}return gt}getChildren(V){const $=this._getOriginId(V),ce=this._getOriginZoom(V),ye="No cluster with the specified id.",Ee=this.trees[ce];if(!Ee)throw new Error(ye);const De=Ee.data;if($*this.stride>=De.length)throw new Error(ye);const Ie=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Te=Ee.within(De[$*this.stride],De[$*this.stride+1],Ie),qe=[];for(const gt of Te){const _t=gt*this.stride;De[_t+4]===V&&qe.push(De[_t+Is]>1?Sr(De,_t,this.clusterProps):this.points[De[_t+ts]])}if(qe.length===0)throw new Error(ye);return qe}getLeaves(V,$,ce){const ye=[];return this._appendLeaves(ye,V,$=$||10,ce=ce||0,0),ye}getTile(V,$,ce){const ye=this.trees[this._limitZoom(V)],Ee=Math.pow(2,V),{extent:De,radius:Ie}=this.options,Te=Ie/De,qe=(ce-Te)/Ee,gt=(ce+1+Te)/Ee,_t={features:[]};return this._addTileFeatures(ye.range(($-Te)/Ee,qe,($+1+Te)/Ee,gt),ye.data,$,ce,Ee,_t),$===0&&this._addTileFeatures(ye.range(1-Te/Ee,qe,1,gt),ye.data,Ee,ce,Ee,_t),$===Ee-1&&this._addTileFeatures(ye.range(0,qe,Te/Ee,gt),ye.data,-1,ce,Ee,_t),_t.features.length?_t:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){const ce=this.getChildren(V);if($++,ce.length!==1)break;V=ce[0].properties.cluster_id}return $}_appendLeaves(V,$,ce,ye,Ee){const De=this.getChildren($);for(const Ie of De){const Te=Ie.properties;if(Te&&Te.cluster?Ee+Te.point_count<=ye?Ee+=Te.point_count:Ee=this._appendLeaves(V,Te.cluster_id,ce,ye,Ee):Ee<ye?Ee++:V.push(Ie),V.length===ce)break}return Ee}_createTree(V){const $=new n.KDBush(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<V.length;ce+=this.stride)$.add(V[ce],V[ce+1]);return $.finish(),$.data=V,$}_addTileFeatures(V,$,ce,ye,Ee,De){for(const Ie of V){const Te=Ie*this.stride,qe=$[Te+Is]>1;let gt,_t,ut;if(qe)gt=Tr($,Te,this.clusterProps),_t=$[Te],ut=$[Te+1];else{const Xt=this.points[$[Te+ts]];gt=Xt.properties;const[Yt,ls]=Xt.geometry.coordinates;_t=vs(Yt),ut=ss(ls)}const Ht={type:1,geometry:[[Math.round(this.options.extent*(_t*Ee-ce)),Math.round(this.options.extent*(ut*Ee-ye))]],tags:gt};let Jt;Jt=qe||this.options.generateId?$[Te+ts]:this.points[$[Te+ts]].id,Jt!==void 0&&(Ht.id=Jt),De.features.push(Ht)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,$){const{radius:ce,extent:ye,reduce:Ee,minPoints:De}=this.options,Ie=ce/(ye*Math.pow(2,$)),Te=V.data,qe=[],gt=this.stride;for(let _t=0;_t<Te.length;_t+=gt){if(Te[_t+2]<=$)continue;Te[_t+2]=$;const ut=Te[_t],Ht=Te[_t+1],Jt=V.within(Te[_t],Te[_t+1],Ie),Xt=Te[_t+Is];let Yt=Xt;for(const ls of Jt){const Zs=ls*gt;Te[Zs+2]>$&&(Yt+=Te[Zs+Is])}if(Yt>Xt&&Yt>=De){let ls,Zs=ut*Xt,dr=Ht*Xt,Gr=-1;const wr=((_t/gt|0)<<5)+($+1)+this.points.length;for(const Vi of Jt){const kr=Vi*gt;if(Te[kr+2]<=$)continue;Te[kr+2]=$;const Jr=Te[kr+Is];Zs+=Te[kr]*Jr,dr+=Te[kr+1]*Jr,Te[kr+4]=wr,Ee&&(ls||(ls=this._map(Te,_t,!0),Gr=this.clusterProps.length,this.clusterProps.push(ls)),Ee(ls,this._map(Te,kr)))}Te[_t+4]=wr,qe.push(Zs/Yt,dr/Yt,1/0,wr,-1,Yt),Ee&&qe.push(Gr)}else{for(let ls=0;ls<gt;ls++)qe.push(Te[_t+ls]);if(Yt>1)for(const ls of Jt){const Zs=ls*gt;if(!(Te[Zs+2]<=$)){Te[Zs+2]=$;for(let dr=0;dr<gt;dr++)qe.push(Te[Zs+dr])}}}}return qe}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$,ce){if(V[$+Is]>1){const De=this.clusterProps[V[$+lr]];return ce?Object.assign({},De):De}const ye=this.points[V[$+ts]].properties,Ee=this.options.map(ye);return ce&&Ee===ye?Object.assign({},Ee):Ee}}function Sr(he,V,$){return{type:"Feature",id:he[V+ts],properties:Tr(he,V,$),geometry:{type:"Point",coordinates:[(ce=he[V],360*(ce-.5)),Or(he[V+1])]}};var ce}function Tr(he,V,$){const ce=he[V+Is],ye=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,Ee=he[V+lr],De=Ee===-1?{}:Object.assign({},$[Ee]);return Object.assign(De,{cluster:!0,cluster_id:he[V+ts],point_count:ce,point_count_abbreviated:ye})}function vs(he){return he/360+.5}function ss(he){const V=Math.sin(he*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function Or(he){const V=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Cr(he,V,$,ce){for(var ye,Ee=ce,De=$-V>>1,Ie=$-V,Te=he[V],qe=he[V+1],gt=he[$],_t=he[$+1],ut=V+3;ut<$;ut+=3){var Ht=Li(he[ut],he[ut+1],Te,qe,gt,_t);if(Ht>Ee)ye=ut,Ee=Ht;else if(Ht===Ee){var Jt=Math.abs(ut-De);Jt<Ie&&(ye=ut,Ie=Jt)}}Ee>ce&&(ye-V>3&&Cr(he,V,ye,ce),he[ye+2]=Ee,$-ye>3&&Cr(he,ye,$,ce))}function Li(he,V,$,ce,ye,Ee){var De=ye-$,Ie=Ee-ce;if(De!==0||Ie!==0){var Te=((he-$)*De+(V-ce)*Ie)/(De*De+Ie*Ie);Te>1?($=ye,ce=Ee):Te>0&&($+=De*Te,ce+=Ie*Te)}return(De=he-$)*De+(Ie=V-ce)*Ie}function Wt(he,V,$,ce){var ye={id:he===void 0?null:he,type:V,geometry:$,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var De=Ee.geometry,Ie=Ee.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")gi(Ee,De);else if(Ie==="Polygon"||Ie==="MultiLineString")for(var Te=0;Te<De.length;Te++)gi(Ee,De[Te]);else if(Ie==="MultiPolygon")for(Te=0;Te<De.length;Te++)for(var qe=0;qe<De[Te].length;qe++)gi(Ee,De[Te][qe])}(ye),ye}function gi(he,V){for(var $=0;$<V.length;$+=3)he.minX=Math.min(he.minX,V[$]),he.minY=Math.min(he.minY,V[$+1]),he.maxX=Math.max(he.maxX,V[$]),he.maxY=Math.max(he.maxY,V[$+1])}function vr(he,V,$,ce){if(V.geometry){var ye=V.geometry.coordinates,Ee=V.geometry.type,De=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),Ie=[],Te=V.id;if($.promoteId?Te=V.properties[$.promoteId]:$.generateId&&(Te=ce||0),Ee==="Point")wi(ye,Ie);else if(Ee==="MultiPoint")for(var qe=0;qe<ye.length;qe++)wi(ye[qe],Ie);else if(Ee==="LineString")Ds(ye,Ie,De,!1);else if(Ee==="MultiLineString"){if($.lineMetrics){for(qe=0;qe<ye.length;qe++)Ds(ye[qe],Ie=[],De,!1),he.push(Wt(Te,"LineString",Ie,V.properties));return}$r(ye,Ie,De,!1)}else if(Ee==="Polygon")$r(ye,Ie,De,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(qe=0;qe<V.geometry.geometries.length;qe++)vr(he,{id:Te,geometry:V.geometry.geometries[qe],properties:V.properties},$,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(qe=0;qe<ye.length;qe++){var gt=[];$r(ye[qe],gt,De,!0),Ie.push(gt)}}he.push(Wt(Te,Ee,Ie,V.properties))}}function wi(he,V){V.push(Wn(he[0])),V.push(ri(he[1])),V.push(0)}function Ds(he,V,$,ce){for(var ye,Ee,De=0,Ie=0;Ie<he.length;Ie++){var Te=Wn(he[Ie][0]),qe=ri(he[Ie][1]);V.push(Te),V.push(qe),V.push(0),Ie>0&&(De+=ce?(ye*qe-Te*Ee)/2:Math.sqrt(Math.pow(Te-ye,2)+Math.pow(qe-Ee,2))),ye=Te,Ee=qe}var gt=V.length-3;V[2]=1,Cr(V,0,gt,$),V[gt+2]=1,V.size=Math.abs(De),V.start=0,V.end=V.size}function $r(he,V,$,ce){for(var ye=0;ye<he.length;ye++){var Ee=[];Ds(he[ye],Ee,$,ce),V.push(Ee)}}function Wn(he){return he/360+.5}function ri(he){var V=Math.sin(he*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function je(he,V,$,ce,ye,Ee,De,Ie){if(ce/=V,Ee>=($/=V)&&De<ce)return he;if(De<$||Ee>=ce)return null;for(var Te=[],qe=0;qe<he.length;qe++){var gt=he[qe],_t=gt.geometry,ut=gt.type,Ht=ye===0?gt.minX:gt.minY,Jt=ye===0?gt.maxX:gt.maxY;if(Ht>=$&&Jt<ce)Te.push(gt);else if(!(Jt<$||Ht>=ce)){var Xt=[];if(ut==="Point"||ut==="MultiPoint")$e(_t,Xt,$,ce,ye);else if(ut==="LineString")et(_t,Xt,$,ce,ye,!1,Ie.lineMetrics);else if(ut==="MultiLineString")wt(_t,Xt,$,ce,ye,!1);else if(ut==="Polygon")wt(_t,Xt,$,ce,ye,!0);else if(ut==="MultiPolygon")for(var Yt=0;Yt<_t.length;Yt++){var ls=[];wt(_t[Yt],ls,$,ce,ye,!0),ls.length&&Xt.push(ls)}if(Xt.length){if(Ie.lineMetrics&&ut==="LineString"){for(Yt=0;Yt<Xt.length;Yt++)Te.push(Wt(gt.id,ut,Xt[Yt],gt.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(Xt.length===1?(ut="LineString",Xt=Xt[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=Xt.length===3?"Point":"MultiPoint"),Te.push(Wt(gt.id,ut,Xt,gt.tags))}}}return Te.length?Te:null}function $e(he,V,$,ce,ye){for(var Ee=0;Ee<he.length;Ee+=3){var De=he[Ee+ye];De>=$&&De<=ce&&(V.push(he[Ee]),V.push(he[Ee+1]),V.push(he[Ee+2]))}}function et(he,V,$,ce,ye,Ee,De){for(var Ie,Te,qe=Ct(he),gt=ye===0?Ot:hs,_t=he.start,ut=0;ut<he.length-3;ut+=3){var Ht=he[ut],Jt=he[ut+1],Xt=he[ut+2],Yt=he[ut+3],ls=he[ut+4],Zs=ye===0?Ht:Jt,dr=ye===0?Yt:ls,Gr=!1;De&&(Ie=Math.sqrt(Math.pow(Ht-Yt,2)+Math.pow(Jt-ls,2))),Zs<$?dr>$&&(Te=gt(qe,Ht,Jt,Yt,ls,$),De&&(qe.start=_t+Ie*Te)):Zs>ce?dr<ce&&(Te=gt(qe,Ht,Jt,Yt,ls,ce),De&&(qe.start=_t+Ie*Te)):yt(qe,Ht,Jt,Xt),dr<$&&Zs>=$&&(Te=gt(qe,Ht,Jt,Yt,ls,$),Gr=!0),dr>ce&&Zs<=ce&&(Te=gt(qe,Ht,Jt,Yt,ls,ce),Gr=!0),!Ee&&Gr&&(De&&(qe.end=_t+Ie*Te),V.push(qe),qe=Ct(he)),De&&(_t+=Ie)}var wr=he.length-3;Ht=he[wr],Jt=he[wr+1],Xt=he[wr+2],(Zs=ye===0?Ht:Jt)>=$&&Zs<=ce&&yt(qe,Ht,Jt,Xt),wr=qe.length-3,Ee&&wr>=3&&(qe[wr]!==qe[0]||qe[wr+1]!==qe[1])&&yt(qe,qe[0],qe[1],qe[2]),qe.length&&V.push(qe)}function Ct(he){var V=[];return V.size=he.size,V.start=he.start,V.end=he.end,V}function wt(he,V,$,ce,ye,Ee){for(var De=0;De<he.length;De++)et(he[De],V,$,ce,ye,Ee,!1)}function yt(he,V,$,ce){he.push(V),he.push($),he.push(ce)}function Ot(he,V,$,ce,ye,Ee){var De=(Ee-V)/(ce-V);return he.push(Ee),he.push($+(ye-$)*De),he.push(1),De}function hs(he,V,$,ce,ye,Ee){var De=(Ee-$)/(ye-$);return he.push(V+(ce-V)*De),he.push(Ee),he.push(1),De}function as(he,V){for(var $=[],ce=0;ce<he.length;ce++){var ye,Ee=he[ce],De=Ee.type;if(De==="Point"||De==="MultiPoint"||De==="LineString")ye=it(Ee.geometry,V);else if(De==="MultiLineString"||De==="Polygon"){ye=[];for(var Ie=0;Ie<Ee.geometry.length;Ie++)ye.push(it(Ee.geometry[Ie],V))}else if(De==="MultiPolygon")for(ye=[],Ie=0;Ie<Ee.geometry.length;Ie++){for(var Te=[],qe=0;qe<Ee.geometry[Ie].length;qe++)Te.push(it(Ee.geometry[Ie][qe],V));ye.push(Te)}$.push(Wt(Ee.id,De,ye,Ee.tags))}return $}function it(he,V){var $=[];$.size=he.size,he.start!==void 0&&($.start=he.start,$.end=he.end);for(var ce=0;ce<he.length;ce+=3)$.push(he[ce]+V,he[ce+1],he[ce+2]);return $}function qt(he,V){if(he.transformed)return he;var $,ce,ye,Ee=1<<he.z,De=he.x,Ie=he.y;for($=0;$<he.features.length;$++){var Te=he.features[$],qe=Te.geometry,gt=Te.type;if(Te.geometry=[],gt===1)for(ce=0;ce<qe.length;ce+=2)Te.geometry.push(Ns(qe[ce],qe[ce+1],V,Ee,De,Ie));else for(ce=0;ce<qe.length;ce++){var _t=[];for(ye=0;ye<qe[ce].length;ye+=2)_t.push(Ns(qe[ce][ye],qe[ce][ye+1],V,Ee,De,Ie));Te.geometry.push(_t)}}return he.transformed=!0,he}function Ns(he,V,$,ce,ye,Ee){return[Math.round($*(he*ce-ye)),Math.round($*(V*ce-Ee))]}function tr(he,V,$,ce,ye){for(var Ee=V===ye.maxZoom?0:ye.tolerance/((1<<V)*ye.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:ce,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ie=0;Ie<he.length;Ie++){De.numFeatures++,cr(De,he[Ie],Ee,ye);var Te=he[Ie].minX,qe=he[Ie].minY,gt=he[Ie].maxX,_t=he[Ie].maxY;Te<De.minX&&(De.minX=Te),qe<De.minY&&(De.minY=qe),gt>De.maxX&&(De.maxX=gt),_t>De.maxY&&(De.maxY=_t)}return De}function cr(he,V,$,ce){var ye=V.geometry,Ee=V.type,De=[];if(Ee==="Point"||Ee==="MultiPoint")for(var Ie=0;Ie<ye.length;Ie+=3)De.push(ye[Ie]),De.push(ye[Ie+1]),he.numPoints++,he.numSimplified++;else if(Ee==="LineString")sr(De,ye,he,$,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(Ie=0;Ie<ye.length;Ie++)sr(De,ye[Ie],he,$,Ee==="Polygon",Ie===0);else if(Ee==="MultiPolygon")for(var Te=0;Te<ye.length;Te++){var qe=ye[Te];for(Ie=0;Ie<qe.length;Ie++)sr(De,qe[Ie],he,$,!0,Ie===0)}if(De.length){var gt=V.tags||null;if(Ee==="LineString"&&ce.lineMetrics){for(var _t in gt={},V.tags)gt[_t]=V.tags[_t];gt.mapbox_clip_start=ye.start/ye.size,gt.mapbox_clip_end=ye.end/ye.size}var ut={geometry:De,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:gt};V.id!==null&&(ut.id=V.id),he.features.push(ut)}}function sr(he,V,$,ce,ye,Ee){var De=ce*ce;if(ce>0&&V.size<(ye?De:ce))$.numPoints+=V.length/3;else{for(var Ie=[],Te=0;Te<V.length;Te+=3)(ce===0||V[Te+2]>De)&&($.numSimplified++,Ie.push(V[Te]),Ie.push(V[Te+1])),$.numPoints++;ye&&function(qe,gt){for(var _t=0,ut=0,Ht=qe.length,Jt=Ht-2;ut<Ht;Jt=ut,ut+=2)_t+=(qe[ut]-qe[Jt])*(qe[ut+1]+qe[Jt+1]);if(_t>0===gt)for(ut=0,Ht=qe.length;ut<Ht/2;ut+=2){var Xt=qe[ut],Yt=qe[ut+1];qe[ut]=qe[Ht-2-ut],qe[ut+1]=qe[Ht-1-ut],qe[Ht-2-ut]=Xt,qe[Ht-1-ut]=Yt}}(Ie,Ee),he.push(Ie)}}function rr(he,V){var $=(V=this.options=function(ye,Ee){for(var De in Ee)ye[De]=Ee[De];return ye}(Object.create(this.options),V)).debug;if($&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var ce=function(ye,Ee){var De=[];if(ye.type==="FeatureCollection")for(var Ie=0;Ie<ye.features.length;Ie++)vr(De,ye.features[Ie],Ee,Ie);else vr(De,ye.type==="Feature"?ye:{geometry:ye},Ee);return De}(he,V);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(ye,Ee){var De=Ee.buffer/Ee.extent,Ie=ye,Te=je(ye,1,-1-De,De,0,-1,2,Ee),qe=je(ye,1,1-De,2+De,0,-1,2,Ee);return(Te||qe)&&(Ie=je(ye,1,-De,1+De,0,-1,2,Ee)||[],Te&&(Ie=as(Te,1).concat(Ie)),qe&&(Ie=Ie.concat(as(qe,-1)))),Ie}(ce,V),ce.length&&this.splitTile(ce,0,0,0),$&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ii(he,V,$){return 32*((1<<he)*$+V)+he}function Kr(he,V){const $=he.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const ce=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ce)return V(null,null);const ye=new class{constructor(De){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=De.length,this._features=De}feature(De){return new class{constructor(Ie){this._feature=Ie,this.extent=n.EXTENT,this.type=Ie.type,this.properties=Ie.tags,"id"in Ie&&!isNaN(Ie.id)&&(this.id=parseInt(Ie.id,10))}loadGeometry(){if(this._feature.type===1){const Ie=[];for(const Te of this._feature.geometry)Ie.push([new n.Point(Te[0],Te[1])]);return Ie}{const Ie=[];for(const Te of this._feature.geometry){const qe=[];for(const gt of Te)qe.push(new n.Point(gt[0],gt[1]));Ie.push(qe)}return Ie}}toGeoJSON(Ie,Te,qe){return J.call(this,Ie,Te,qe)}}(this._features[De])}}(ce.features);let Ee=ft(ye);Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),V(null,{vectorTile:ye,rawData:Ee.buffer})}rr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rr.prototype.splitTile=function(he,V,$,ce,ye,Ee,De){for(var Ie=[he,V,$,ce],Te=this.options,qe=Te.debug;Ie.length;){ce=Ie.pop(),$=Ie.pop(),V=Ie.pop(),he=Ie.pop();var gt=1<<V,_t=ii(V,$,ce),ut=this.tiles[_t];if(!ut&&(qe>1&&console.time("creation"),ut=this.tiles[_t]=tr(he,V,$,ce,Te),this.tileCoords.push({z:V,x:$,y:ce}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,$,ce,ut.numFeatures,ut.numPoints,ut.numSimplified),console.timeEnd("creation"));var Ht="z"+V;this.stats[Ht]=(this.stats[Ht]||0)+1,this.total++}if(ut.source=he,ye){if(V===Te.maxZoom||V===ye)continue;var Jt=1<<ye-V;if($!==Math.floor(Ee/Jt)||ce!==Math.floor(De/Jt))continue}else if(V===Te.indexMaxZoom||ut.numPoints<=Te.indexMaxPoints)continue;if(ut.source=null,he.length!==0){qe>1&&console.time("clipping");var Xt,Yt,ls,Zs,dr,Gr,wr=.5*Te.buffer/Te.extent,Vi=.5-wr,kr=.5+wr,Jr=1+wr;Xt=Yt=ls=Zs=null,dr=je(he,gt,$-wr,$+kr,0,ut.minX,ut.maxX,Te),Gr=je(he,gt,$+Vi,$+Jr,0,ut.minX,ut.maxX,Te),he=null,dr&&(Xt=je(dr,gt,ce-wr,ce+kr,1,ut.minY,ut.maxY,Te),Yt=je(dr,gt,ce+Vi,ce+Jr,1,ut.minY,ut.maxY,Te),dr=null),Gr&&(ls=je(Gr,gt,ce-wr,ce+kr,1,ut.minY,ut.maxY,Te),Zs=je(Gr,gt,ce+Vi,ce+Jr,1,ut.minY,ut.maxY,Te),Gr=null),qe>1&&console.timeEnd("clipping"),Ie.push(Xt||[],V+1,2*$,2*ce),Ie.push(Yt||[],V+1,2*$,2*ce+1),Ie.push(ls||[],V+1,2*$+1,2*ce),Ie.push(Zs||[],V+1,2*$+1,2*ce+1)}}},rr.prototype.getTile=function(he,V,$){var ce=this.options,ye=ce.extent,Ee=ce.debug;if(he<0||he>24)return null;var De=1<<he,Ie=ii(he,V=(V%De+De)%De,$);if(this.tiles[Ie])return qt(this.tiles[Ie],ye);Ee>1&&console.log("drilling down to z%d-%d-%d",he,V,$);for(var Te,qe=he,gt=V,_t=$;!Te&&qe>0;)qe--,gt=Math.floor(gt/2),_t=Math.floor(_t/2),Te=this.tiles[ii(qe,gt,_t)];return Te&&Te.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",qe,gt,_t),Ee>1&&console.time("drilling down"),this.splitTile(Te.source,qe,gt,_t,he,V,$),Ee>1&&console.timeEnd("drilling down"),this.tiles[Ie]?qt(this.tiles[Ie],ye):null):null};class Qr extends n.VectorTileWorkerSource{constructor(V,$,ce,ye,Ee){super(V,$,ce,ye,Kr),Ee&&(this.loadGeoJSON=Ee)}loadData(V,$){const ce=V&&V.request,ye=ce&&ce.collectResourceTiming;this.loadGeoJSON(V,(Ee,De)=>{if(Ee||!De)return $(Ee);if(typeof De!="object")return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{G(De,!0);try{if(V.filter){const Te=n.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(gt=>`${gt.key}: ${gt.message}`).join(", "));De={type:"FeatureCollection",features:De.features.filter(gt=>Te.value.evaluate({zoom:0},gt))}}this._geoJSONIndex=V.cluster?new js(function({superclusterOptions:Te,clusterProperties:qe}){if(!qe||!Te)return Te;const gt={},_t={},ut={accumulated:null,zoom:0},Ht={properties:null},Jt=Object.keys(qe);for(const Xt of Jt){const[Yt,ls]=qe[Xt],Zs=n.createExpression(ls),dr=n.createExpression(typeof Yt=="string"?[Yt,["accumulated"],["get",Xt]]:Yt);gt[Xt]=Zs.value,_t[Xt]=dr.value}return Te.map=Xt=>{Ht.properties=Xt;const Yt={};for(const ls of Jt)Yt[ls]=gt[ls].evaluate(ut,Ht);return Yt},Te.reduce=(Xt,Yt)=>{Ht.properties=Yt;for(const ls of Jt)ut.accumulated=Xt[ls],Xt[ls]=_t[ls].evaluate(ut,Ht)},Te}(V)).load(De.features):function(Te,qe){return new rr(Te,qe)}(De,V.geojsonVtOptions)}catch(Te){return $(Te)}this.loaded={};const Ie={};if(ye){const Te=n.getPerformanceMeasurement(ce);Te&&(Ie.resourceTiming={},Ie.resourceTiming[V.source]=JSON.parse(JSON.stringify(Te)))}$(null,Ie)}})}reloadTile(V,$){const ce=this.loaded;return ce&&ce[V.uid]?super.reloadTile(V,$):this.loadTile(V,$)}loadGeoJSON(V,$){if(V.request)n.getJSON(V.request,$);else{if(typeof V.data!="string")return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(V.data))}catch{return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ce){$(ce)}}getClusterChildren(V,$){try{$(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ce){$(ce)}}getClusterLeaves(V,$){try{$(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ce){$(ce)}}}class Fr{constructor(V){this.self=V,this.actor=new n.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.getProjection({name:"mercator"}),this.workerSourceTypes={vector:n.VectorTileWorkerSource,geojson:Qr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,ce)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=ce},this.self.registerRTLTextPlugin=$=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=$.applyArabicShaping,n.plugin.processBidirectionalText=$.processBidirectionalText,n.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(V,$,ce){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],ce()}checkIfReady(V,$,ce){ce()}setReferrer(V,$){this.referrer=$}spriteLoaded(V,$){this.isSpriteLoaded[V]=$;for(const ce in this.workerSources[V]){const ye=this.workerSources[V][ce];for(const Ee in ye)ye[Ee]instanceof n.VectorTileWorkerSource&&(ye[Ee].isSpriteLoaded=$,ye[Ee].fire(new n.Event("isSpriteLoaded")))}}setImages(V,$,ce){this.availableImages[V]=$;for(const ye in this.workerSources[V]){const Ee=this.workerSources[V][ye];for(const De in Ee)Ee[De].availableImages=$}ce()}enableTerrain(V,$,ce){this.terrain=$,ce()}setProjection(V,$){this.projections[V]=n.getProjection($)}setLayers(V,$,ce){this.getLayerIndex(V).replace($),ce()}updateLayers(V,$,ce){this.getLayerIndex(V).update($.layers,$.removedIds),ce()}loadTile(V,$,ce){const ye=this.enableTerrain?n.extend({enableTerrain:this.terrain},$):$;ye.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,$.type,$.source).loadTile(ye,ce)}loadDEMTile(V,$,ce){const ye=this.enableTerrain?n.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(V,$.source).loadTile(ye,ce)}reloadTile(V,$,ce){const ye=this.enableTerrain?n.extend({enableTerrain:this.terrain},$):$;ye.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,$.type,$.source).reloadTile(ye,ce)}abortTile(V,$,ce){this.getWorkerSource(V,$.type,$.source).abortTile($,ce)}removeTile(V,$,ce){this.getWorkerSource(V,$.type,$.source).removeTile($,ce)}removeSource(V,$,ce){if(!this.workerSources[V]||!this.workerSources[V][$.type]||!this.workerSources[V][$.type][$.source])return;const ye=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],ye.removeSource!==void 0?ye.removeSource($,ce):ce()}loadWorkerSource(V,$,ce){try{this.self.importScripts($.url),ce()}catch(ye){ce(ye.toString())}}syncRTLPluginState(V,$,ce){try{n.plugin.setState($);const ye=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);const Ee=n.plugin.isParsed();ce(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),Ee)}}catch(ye){ce(ye.toString())}}getAvailableImages(V){let $=this.availableImages[V];return $||($=[]),$}getLayerIndex(V){let $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new q),$}getWorkerSource(V,$,ce){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),!this.workerSources[V][$][ce]){const ye={send:(Ee,De,Ie,Te,qe,gt)=>{this.actor.send(Ee,De,Ie,V,qe,gt)},scheduler:this.actor.scheduler};this.workerSources[V][$][ce]=new this.workerSourceTypes[$](ye,this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])}return this.workerSources[V][$][ce]}getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new U),this.demWorkerSources[V][$]}enforceCacheSizeLimit(V,$){n.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(V,$,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Fr(self)),Fr}),T(["./shared"],function(n){function P(u,i){if(Array.isArray(u)){if(!Array.isArray(i)||u.length!==i.length)return!1;for(let o=0;o<u.length;o++)if(!P(u[o],i[o]))return!1;return!0}if(typeof u=="object"&&u!==null&&i!==null){if(typeof i!="object"||Object.keys(u).length!==Object.keys(i).length)return!1;for(const o in u)if(!P(u[o],i[o]))return!1;return!0}return u===i}var z=q;function q(u){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,x,_=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(_);try{x=new Worker(j),m=!0}catch{m=!1}return x&&x.terminate(),URL.revokeObjectURL(j),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var x=m.getContext("2d");if(!x)return!1;var _=x.getImageData(0,0,1,1);return _&&_.width===m.width}()?(U[o=i&&i.failIfMajorPerformanceCaveat]===void 0&&(U[o]=function(m){var x,_=function(j){var S=document.createElement("canvas"),C=Object.create(q.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=j,S.getContext("webgl",C)||S.getContext("experimental-webgl",C)}(m);if(!_)return!1;try{x=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!x||_.isContextLost())&&(_.shaderSource(x,"void main() {}"),_.compileShader(x),_.getShaderParameter(x,_.COMPILE_STATUS)===!0)}(o)),U[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o}(u)}var U={};function W(u,i,o){const m=n.window.document.createElement(u);return i!==void 0&&(m.className=i),o&&o.appendChild(m),m}function H(u,i,o){const m=n.window.document.createElementNS("http://www.w3.org/2000/svg",u);for(const x of Object.keys(i))m.setAttributeNS(null,x,i[x]);return o&&o.appendChild(m),m}q.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const G=n.window.document&&n.window.document.documentElement.style,J=G&&G.userSelect!==void 0?"userSelect":"WebkitUserSelect";let de;function ne(){G&&J&&(de=G[J],G[J]="none")}function te(){G&&J&&(G[J]=de)}function Ne(u){u.preventDefault(),u.stopPropagation(),n.window.removeEventListener("click",Ne,!0)}function me(){n.window.addEventListener("click",Ne,!0),n.window.setTimeout(()=>{n.window.removeEventListener("click",Ne,!0)},0)}function Pe(u,i){const o=u.getBoundingClientRect();return Be(u,o,i)}function Se(u,i){const o=u.getBoundingClientRect(),m=[];for(let x=0;x<i.length;x++)m.push(Be(u,o,i[x]));return m}function fe(u){return n.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&n.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function Be(u,i,o){const m=u.offsetWidth===i.width?1:u.offsetWidth/i.width;return new n.Point((o.clientX-i.left)*m,(o.clientY-i.top)*m)}function ke(u,i){var o=i[0],m=i[1],x=i[2],_=i[3],j=o*_-x*m;return j?(u[0]=_*(j=1/j),u[1]=-m*j,u[2]=-x*j,u[3]=o*j,u):null}function Ge(u){const{userImage:i}=u;return!!(i&&i.render&&i.render())&&(u.data.replace(new Uint8Array(i.data.buffer)),!0)}class we extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,callback:m}of this.requestors)this._notify(o,m);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,o){this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let m=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(o.content,o)||(this.fire(new n.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,o){if(!i)return!0;let m=0;for(const x of i){if(x[0]<m||x[1]<x[0]||o<x[1])return!1;m=x[1]}return!0}_validateContent(i,o){return!(i&&(i.length!==4||i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,o){o.version=this.images[i].version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,o){let m=!0;if(!this.isLoaded())for(const x of i)this.images[x]||(m=!1);this.isLoaded()||m?this._notify(i,o):this.requestors.push({ids:i,callback:o})}_notify(i,o){const m={};for(const x of i){this.images[x]||this.fire(new n.Event("styleimagemissing",{id:x}));const _=this.images[x];_?m[x]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:n.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,m)}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],m=this.getImage(i);if(!m)return null;if(o&&o.position.version===m.version)return o.position;if(o)o.position.version=m.version;else{const x={w:m.data.width+2,h:m.data.height+2,x:0,y:0},_=new n.ImagePosition(x,m);this.patterns[i]={bin:x,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new n.Texture(i,this.atlasImage,o.RGBA),this.atlasTexture&&this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:o,h:m}=n.potpack(i),x=this.atlasImage;x.resize({width:o||1,height:m||1});for(const _ in this.patterns){const{bin:j}=this.patterns[_],S=j.x+1,C=j.y+1,D=this.images[_].data,I=D.width,O=D.height;n.RGBAImage.copy(D,x,{x:0,y:0},{x:S,y:C},{width:I,height:O}),n.RGBAImage.copy(D,x,{x:0,y:O-1},{x:S,y:C-1},{width:I,height:1}),n.RGBAImage.copy(D,x,{x:0,y:0},{x:S,y:C+O},{width:I,height:1}),n.RGBAImage.copy(D,x,{x:I-1,y:0},{x:S-1,y:C},{width:1,height:O}),n.RGBAImage.copy(D,x,{x:0,y:0},{x:S+I,y:C},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const m=this.images[o];Ge(m)&&this.updateImage(o,m)}}}const Me=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(u,i){return function([o,m,x]){const _=n.degToRad(m+90),j=n.degToRad(x);return{x:o*Math.cos(_)*Math.sin(j),y:o*Math.sin(_)*Math.sin(j),z:o*Math.cos(j),azimuthal:m,polar:x}}(u.expression.evaluate(i))}interpolate(u,i,o){return{x:n.number(u.x,i.x,o),y:n.number(u.y,i.y,o),z:n.number(u.z,i.z,o),azimuthal:n.number(u.azimuthal,i.azimuthal,o),polar:n.number(u.polar,i.polar,o)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)});class st extends n.Evented{constructor(i){super(),this._transitionable=new n.Transitionable(Me),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(n.validateLight,i,o))for(const m in i){const x=i[m];n.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),x):this._transitionable.setValue(m,x)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,i.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}const lt=new n.Properties({source:new n.DataConstantProperty(n.spec.terrain.source),exaggeration:new n.DataConstantProperty(n.spec.terrain.exaggeration)});let St=class extends n.Evented{constructor(u,i){super(),this._transitionable=new n.Transitionable(lt),this.set(u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(u){for(const i in u){const o=u[i];n.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),o):this._transitionable.setValue(i,o)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}};function ft(u,i,o,m){const x=n.smoothstep(45,65,o),[_,j]=Mt(u,m),S=n.length(i);let C=1-Math.min(1,Math.exp((S-_)/(j-_)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*x*u.alpha}function Mt(u,i){const o=.5/Math.tan(.5*i);return[u.range[0]+o,u.range[1]+o]}const mt=new n.Properties({range:new n.DataConstantProperty(n.spec.fog.range),color:new n.DataConstantProperty(n.spec.fog.color),"high-color":new n.DataConstantProperty(n.spec.fog["high-color"]),"space-color":new n.DataConstantProperty(n.spec.fog["space-color"]),"horizon-blend":new n.DataConstantProperty(n.spec.fog["horizon-blend"]),"star-intensity":new n.DataConstantProperty(n.spec.fog["star-intensity"])});class Fs extends n.Evented{constructor(i,o){super(),this._transitionable=new n.Transitionable(mt),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const i=this._transform,o=i.projection.name==="globe",m=n.globeToMercatorTransition(i.zoom),x=this.properties.get("range"),_=[.5,3];return{range:o?[n.number(_[0],x[0],m),n.number(_[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o={}){if(!this._validate(n.validateFog,i,o)){for(const m of Object.keys(n.spec.fog))i&&i[m]===void 0&&(i[m]=n.spec.fog[m].default);for(const m in i){const x=i[m];n.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),x):this._transitionable.setValue(m,x)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.smoothstep(45,65,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(m,x,_){const j=n.MercatorCoordinate.fromLngLat(x),S=_.elevation?_.elevation.getAtPointOrZero(j):0,C=[j.x,j.y,S];return n.transformMat4(C,C,_.mercatorFogMatrix),ft(m,C,_.pitch,_._fov)}(this.state,i,o):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Mt(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,m){return(!m||m.validate!==!1)&&n.emitValidationErrors(this,i.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class ts{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=n.uniqueId();const m=this.workerPool.acquire(this.id);for(let x=0;x<m.length;x++){const _=new ts.Actor(m[x],o,this.id);_.name=`Worker ${x}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,m){n.asyncAll(this.actors,(x,_)=>{x.send(i,o,_)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Is(u,i,o){return i*(n.EXTENT/(u.tileSize*Math.pow(2,o-u.tileID.overscaledZ)))}ts.Actor=n.Actor;class lr{constructor(i,o,m,x){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,o){let m,x;if(i instanceof n.Point||typeof i[0]=="number"){const _=n.Point.convert(i);m=[_],x=o.isPointAboveHorizon(_)}else{const _=n.Point.convert(i[0]),j=n.Point.convert(i[1]);m=[_,j],x=n.polygonizeBounds(_,j).every(S=>o.isPointAboveHorizon(S))}return new lr(m,o.getCameraPoint(),x,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return n.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.Point(1,1)):this.screenBounds[1],x=n.polygonizeBounds(o,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(x[3]=this.cameraPoint)),n.bufferConvexPolygon(x,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.Point(1,1)):this.screenBounds[1],x=n.polygonizeBounds(o,m,i),_=this.cameraPoint.clone();switch(3*((_.y>o.y)+(_.y>m.y))+((_.x>o.x)+(_.x>m.x))){case 0:x[0]=_,x[4]=_.clone();break;case 1:x.splice(1,0,_);break;case 2:x[1]=_;break;case 3:x.splice(4,0,_);break;case 5:x.splice(2,0,_);break;case 6:x[3]=_;break;case 7:x.splice(3,0,_);break;case 8:x[2]=_}return x}containsTile(i,o,m,x=0){const _=i.queryPadding/o._pixelsPerMercatorPixel+1,j=m?this._bufferedCameraMercator(_,o):this._bufferedScreenMercator(_,o);let S=i.tileID.wrap+(j.unwrapped?x:0);const C=j.polygon.map(se=>n.getTilePoint(i.tileTransform,se,S));if(!n.polygonIntersectsBox(C,0,0,n.EXTENT,n.EXTENT))return;S=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const D=this.screenGeometryMercator.polygon.map(se=>n.getTileVec3(i.tileTransform,se,S)),I=D.map(se=>new n.Point(se[0],se[1])),O=o.getFreeCameraOptions().position||new n.MercatorCoordinate(0,0,0),Z=n.getTileVec3(i.tileTransform,O,S),Q=D.map(se=>{const F=n.sub(se,se,Z);return n.normalize(F,F),new n.Ray(Z,F)}),ee=Is(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:Q,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Y=n.getBounds(C),Y.min.x=n.clamp(Y.min.x,0,n.EXTENT),Y.min.y=n.clamp(Y.min.y,0,n.EXTENT),Y.max.x=n.clamp(Y.max.x,0,n.EXTENT),Y.max.y=n.clamp(Y.max.y,0,n.EXTENT),Y),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:ee};var Y}_bufferedScreenMercator(i,o){const m=Tr(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(i,o){const m=Tr(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(i,o){const m=function(_,j){const S=n.multiply([],j.pixelMatrix,j.globeMatrix),C=[0,-n.GLOBE_RADIUS,0,1],D=[0,n.GLOBE_RADIUS,0,1],I=[0,0,0,1];n.transformMat4$1(C,C,S),n.transformMat4$1(D,D,S),n.transformMat4$1(I,I,S);const O=new n.Point(C[0]/C[3],C[1]/C[3]),Z=new n.Point(D[0]/D[3],D[1]/D[3]),Q=n.polygonContainsPoint(_,O)&&C[3]<I[3],ee=n.polygonContainsPoint(_,Z)&&D[3]<I[3];if(!Q&&!ee)return null;const Y=function(be,Ae,Ce){for(let Oe=1;Oe<be.length;Oe++){const at=Sr(Ae.pointCoordinate3D(be[Oe-1]).x),Le=Sr(Ae.pointCoordinate3D(be[Oe]).x);if(Ce<0){if(at<Le)return{idx:Oe,t:-at/(Le-1-at)}}else if(Le<at)return{idx:Oe,t:(1-at)/(Le+1-at)}}return null}(_,j,Q?-1:1);if(!Y)return null;const{idx:se,t:F}=Y;let K=se>1?js(_.slice(0,se),j):[],ae=se<_.length?js(_.slice(se),j):[];K=K.map(be=>new n.Point(Sr(be.x),be.y)),ae=ae.map(be=>new n.Point(Sr(be.x),be.y));const le=[...K];le.length===0&&le.push(ae[ae.length-1]);const _e=n.number(le[le.length-1].y,(ae.length===0?K[0]:ae[0]).y,F);let ve;return ve=Q?[new n.Point(0,_e),new n.Point(0,0),new n.Point(1,0),new n.Point(1,_e)]:[new n.Point(1,_e),new n.Point(1,1),new n.Point(0,1),new n.Point(0,_e)],le.push(...ve),ae.length===0?le.push(K[0]):le.push(...ae),{polygon:le.map(be=>new n.MercatorCoordinate(be.x,be.y)),unwrapped:!1}}(i,o);if(m)return m;const x=function(_,j){let S=!1,C=-1/0,D=0;for(let O=0;O<_.length-1;O++)_[O].x>C&&(C=_[O].x,D=O);for(let O=0;O<_.length-1;O++){const Z=(D+O)%(_.length-1),Q=_[Z],ee=_[Z+1];Math.abs(Q.x-ee.x)>.5&&(Q.x<ee.x?(Q.x+=1,Z===0&&(_[_.length-1].x+=1)):(ee.x+=1,Z+1===_.length-1&&(_[0].x+=1)),S=!0)}const I=n.mercatorXfromLng(j.center.lng);return S&&I<Math.abs(I-1)&&_.forEach(O=>{O.x-=1}),{polygon:_,unwrapped:S}}(js(i,o).map(_=>new n.Point(Sr(_.x),_.y)),o);return{polygon:x.polygon.map(_=>new n.MercatorCoordinate(_.x,_.y)),unwrapped:x.unwrapped}}}function js(u,i){return n.resample(u,o=>{const m=i.pointCoordinate3D(o);o.x=m.x,o.y=m.y},1/256)}function Sr(u){return u<0?1+u%1:u%1}function Tr(u){return 100*u|0}function vs(u,i,o,m,x){const _=function(j,S){if(j)return x(j);if(S){u.url&&S.tiles&&u.tiles&&delete u.tiles;const C=n.pick(n.extend(S,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(C.vectorLayers=S.vector_layers,C.vectorLayerIds=C.vectorLayers.map(D=>D.id)),C.tiles=i.canonicalizeTileset(C,u.url),x(null,C)}};return u.url?n.getJSON(i.transformRequest(i.normalizeSourceURL(u.url,null,o,m),n.ResourceType.Source),_):n.exported.frame(()=>_(null,u))}class ss{constructor(i,o,m){this.bounds=n.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),m=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*o),x=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*o),_=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*o),j=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*o);return i.x>=m&&i.x<_&&i.y>=x&&i.y<j}}class Or{constructor(i,o,m){this.context=i;const x=i.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Cr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Li{constructor(i,o,m,x){this.length=o.length,this.attributes=m,this.itemSize=o.bytesPerElement,this.dynamicDraw=x,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let m=0;m<this.attributes.length;m++){const x=o.attributes[this.attributes[m].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,o,m){for(let x=0;x<this.attributes.length;x++){const _=this.attributes[x],j=o.attributes[_.name];j!==void 0&&i.vertexAttribPointer(j,_.components,i[Cr[_.type]],!1,this.itemSize,_.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gi extends Wt{getDefault(){return n.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class vr extends Wt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class wi extends Wt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Ds extends Wt{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class $r extends Wt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Wn extends Wt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class ri extends Wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class je extends Wt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class $e extends Wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class et extends Wt{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ct extends Wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class wt extends Wt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class yt extends Wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class Ot extends Wt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class hs extends Wt{getDefault(){return n.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class as extends Wt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class it extends Wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class qt extends Wt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Ns extends Wt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let tr,cr=class extends Wt{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class sr extends Wt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class rr extends Wt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class ii extends Wt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Kr extends Wt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Qr extends Wt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Fr extends Wt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class he extends Wt{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class V extends Wt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class $ extends Wt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class ce extends Wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class ye extends Wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Ee extends Wt{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class De extends Ee{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ie extends Ee{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Te extends Ie{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class qe{constructor(i,o,m,x){this.context=i,this.width=o,this.height=m;const _=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new De(i,_),x&&(this.depthAttachment=new Ie(i,_))}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class gt{constructor(i,o=!1){if(this.gl=i,this.isWebGL2=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),o){const m=i;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(i),deleteVertexArrayOES:m.deleteVertexArray.bind(i),bindVertexArrayOES:m.bindVertexArray.bind(i)}}this.clearColor=new gi(this),this.clearDepth=new vr(this),this.clearStencil=new wi(this),this.colorMask=new Ds(this),this.depthMask=new $r(this),this.stencilMask=new Wn(this),this.stencilFunc=new ri(this),this.stencilOp=new je(this),this.stencilTest=new $e(this),this.depthRange=new et(this),this.depthTest=new Ct(this),this.depthFunc=new wt(this),this.blend=new yt(this),this.blendFunc=new Ot(this),this.blendColor=new hs(this),this.blendEquation=new as(this),this.cullFace=new it(this),this.cullFaceSide=new qt(this),this.frontFace=new Ns(this),this.program=new cr(this),this.activeTexture=new sr(this),this.viewport=new rr(this),this.bindFramebuffer=new ii(this),this.bindRenderbuffer=new Kr(this),this.bindTexture=new Qr(this),this.bindVertexBuffer=new Fr(this),this.bindElementBuffer=new he(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new V(this),this.pixelStoreUnpack=new $(this),this.pixelStoreUnpackPremultiplyAlpha=new ce(this),this.pixelStoreUnpackFlipY=new ye(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),o||(this.extTextureHalfFloat=i.getExtension("OES_texture_half_float")),(o||this.extTextureHalfFloat&&i.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o||i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new Or(this,i,o)}createVertexBuffer(i,o,m){return new Li(this,i,o,m)}createRenderbuffer(i,o,m){const x=this.gl,_=x.createRenderbuffer();return this.bindRenderbuffer.set(_),x.renderbufferStorage(x.RENDERBUFFER,i,o,m),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,m){return new qe(this,i,o,m)}clear({color:i,depth:o,stencil:m}){const x=this.gl;let _=0;i&&(_|=x.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),m!==void 0&&(_|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){P(i.blendFunction,n.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class _t extends n.Evented{constructor(i,o,m,x){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(o,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new n.DedupedRequest}load(i){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=vs(this._options,this.map._requestManager,o,m,(x,_)=>{this._tileJSONRequest=null,this._loaded=!0,x?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new n.ErrorEvent(x))):_&&(n.extend(this,_),_.bounds&&(this.tileBounds=new ss(_.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(x)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return n.extend({},this._options)}loadTile(i,o){const m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(m,n.ResourceType.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=o:i.request=i.actor.send("reloadTile",x,_.bind(this));else if(i.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",x,_.bind(this),void 0,!0);else{const j=n.loadVectorTile.call({deduped:this._deduped},x,(S,C)=>{S||!C?_.call(this,S):(x.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},i.actor&&i.actor.send("loadTile",x,_.bind(this),void 0,!0))},!0);i.request={cancel:j}}function _(j,S){return delete i.request,i.aborted?o(null):j&&j.status!==404?o(j):(S&&S.resourceTiming&&(i.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&i.setExpiryData(S),i.loadVectorData(S,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id})}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ut extends n.Evented{constructor(i,o,m,x){super(),this.id=i,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},o),n.extend(this,n.pick(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vs(this._options,this.map._requestManager,null,null,(o,m)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new n.ErrorEvent(o)):m&&(n.extend(this,m),m.bounds&&(this.tileBounds=new ss(m.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(m.tiles),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return n.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const m=n.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=n.getImage(this.map._requestManager.transformRequest(x,n.ResourceType.Tile),(_,j,S,C)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):_?(i.state="errored",o(_)):j?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:C}),i.setTexture(j,this.map.painter),i.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(i,o,m){i.setTexture(o,m)}static unloadTileData(i,o){i.texture&&o.saveTileTexture(i.texture)}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o()}unloadTile(i,o){i.texture&&this.map.painter.saveTileTexture(i.texture),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ht(u,i,o,m,x,_,j,S){const C=[u,o,x,i,m,_,1,1,1],D=[j,S,1],I=n.adjoint([],C),[O,Z,Q]=n.transformMat3(D,D,n.transpose(I,I));return n.multiply$1(C,[O,0,0,0,Z,0,0,0,Q],C)}class Jt extends n.Evented{constructor(i,o,m,x){super(),this.id=i,this.dispatcher=m,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=o,this._dirty=!1}load(i,o){this._loaded=o||!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(m,x)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new n.ErrorEvent(m));else if(x){const{HTMLImageElement:_}=n.window;this.image=x instanceof _?n.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const o=i.map(n.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let x=1/0,_=1/0,j=-1/0,S=-1/0;for(const O of m)x=Math.min(x,O.x),_=Math.min(_,O.y),j=Math.max(j,O.x),S=Math.max(S,O.y);const C=Math.max(j-x,S-_),D=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),I=Math.pow(2,D);return new n.CanonicalTileID(D,Math.floor((x+j)/2*I),Math.floor((_+S)/2*I))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const C in this.tiles){const D=this.tiles[C];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const o=n.tileTransform(this.tileID,this.map.transform.projection),[m,x,_,j]=this.coordinates.map(C=>{const D=o.projection.project(C[0],C[1]);return n.getTilePoint(o,D)._round()});this.perspectiveTransform=function(C,D,I,O,Z,Q,ee,Y,se,F){const K=Ht(0,0,C,0,0,D,C,D),ae=Ht(I,O,Z,Q,ee,Y,se,F);return n.multiply$1(ae,n.adjoint(K,K),ae),[ae[6]/ae[8]*C/n.EXTENT,ae[7]/ae[8]*D/n.EXTENT]}(this.width,this.height,m.x,m.y,x.x,x.y,j.x,j.y,_.x,_.y);const S=this._boundsArray=new n.StructArrayLayout4i8;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(x.x,x.y,n.EXTENT,0),S.emplaceBack(j.x,j.y,0,n.EXTENT),S.emplaceBack(_.x,_.y,n.EXTENT,n.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(S,n.boundsAttributes.members),this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new n.Texture(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,o){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},o(null)):(i.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Xt={vector:_t,raster:ut,"raster-dem":class extends ut{constructor(u,i,o,m){super(u,i,o,m),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(u,i){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,_){x&&(u.state="errored",i(x)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",i(null))}u.request=n.getImage(this.map._requestManager.transformRequest(o,n.ResourceType.Tile),(function(x,_,j,S){if(delete u.request,u.aborted)u.state="unloaded",i(null);else if(x)u.state="errored",i(x);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:j,expires:S});const C=n.window.ImageBitmap&&_ instanceof n.window.ImageBitmap&&(tr==null&&(tr=n.window.OffscreenCanvas&&new n.window.OffscreenCanvas(1,1).getContext("2d")&&typeof n.window.createImageBitmap=="function"),tr),D=1-(_.width-n.prevPowerOfTwo(_.width))/2;D<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const I=C?_:n.exported.getImageData(_,D),O={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:D};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",O,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const i=u.canonical,o=Math.pow(2,i.z),m=(i.x-1+o)%o,x=i.x===0?u.wrap-1:u.wrap,_=(i.x+1+o)%o,j=i.x+1===o?u.wrap+1:u.wrap,S={};return S[new n.OverscaledTileID(u.overscaledZ,x,i.z,m,i.y).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y).key]={backfilled:!1},i.y>0&&(S[new n.OverscaledTileID(u.overscaledZ,x,i.z,m,i.y-1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,u.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y-1).key]={backfilled:!1}),i.y+1<o&&(S[new n.OverscaledTileID(u.overscaledZ,x,i.z,m,i.y+1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,u.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new n.OverscaledTileID(u.overscaledZ,j,i.z,_,i.y+1).key]={backfilled:!1}),S}unloadTile(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded"}},geojson:class extends n.Evented{constructor(u,i,o,m){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(m),this._data=i.data,this._options=n.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:n.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},i),this}getClusterChildren(u,i){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},i),this}getClusterLeaves(u,i,o,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:i,offset:o},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.Event("dataloading",{dataType:"source"})),this._loaded=!1;const u=n.extend({},this.workerOptions),i=this._data;typeof i=="string"?(u.request=this.map._requestManager.transformRequest(n.exported.resolveURL(i),n.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(o,m)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new n.ErrorEvent(o));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x.resourceTiming=m.resourceTiming[this.id]),this.fire(new n.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,i){const o=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(o,{type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,x)=>(delete u.request,u.unloadVectorData(),u.aborted?i(null):m?i(m):(u.loadVectorData(x,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Jt{constructor(u,i,o,m){super(u,i,o,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const i of u.urls)this.urls.push(this.map._requestManager.transformRequest(i,n.ResourceType.Source).url);n.getVideo(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new n.ErrorEvent(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const i=this.video.seekable;u<i.start(0)||u>i.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,i=u.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new n.Texture(u,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Jt,canvas:class extends Jt{constructor(u,i,o,m){super(u,i,o,m),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(_=>typeof _!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof n.window.HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${u}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof n.window.HTMLCanvasElement?this.options.canvas:n.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends n.Evented{constructor(u,i,o,m){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ss(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),n.extend(this,n.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:i,y:o,z:m}=u.canonical;return this._implementation.hasTile({x:i,y:o,z:m})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,i){const{x:o,y:m,z:x}=u.tileID.canonical,_=new n.window.AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:o,y:m,z:x},{signal:_.signal})).then((function(j){return delete u.request,u.aborted?(u.state="unloaded",i(null)):j===void 0?(u.state="errored",i(null)):j===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",i(null)):function(S){return S instanceof n.window.ImageData||S instanceof n.window.HTMLCanvasElement||S instanceof n.window.ImageBitmap||S instanceof n.window.HTMLImageElement}(j)?(this.loadTileData(u,j),u.state="loaded",void i(null)):(u.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(j=>{j.code!==20&&(u.state="errored",i(j))}),u.request.cancel=()=>_.abort()}loadTileData(u,i){ut.loadTileData(u,i,this._map.painter)}unloadTileData(u){ut.unloadTileData(u,this._map.painter)}unloadTile(u,i){if(this.unloadTileData(u),this._implementation.unloadTile){const{x:o,y:m,z:x}=u.tileID.canonical;this._implementation.unloadTile({x:o,y:m,z:x})}i()}abortTile(u,i){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Yt=function(u,i,o,m){const x=new Xt[i.type](u,i,o,m);if(x.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${x.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],x),x};function ls(u,i){const o=n.identity([]);return n.scale(o,o,[.5*u.width,.5*-u.height,1]),n.translate(o,o,[1,-1,0]),n.multiply(o,o,u.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(o)}function Zs(u,i,o,m,x,_,j,S=!1){const C=u.tilesIn(m,j,S);C.sort(Gr);const D=[];for(const O of C)D.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(i,o,u._state,O,x,_,ls(u.transform,O.tile.tileID),S)});const I=function(O){const Z={},Q={};for(const ee of O){const Y=ee.queryResults,se=ee.wrappedTileID,F=Q[se]=Q[se]||{};for(const K in Y){const ae=Y[K],le=F[K]=F[K]||{},_e=Z[K]=Z[K]||[];for(const ve of ae)le[ve.featureIndex]||(le[ve.featureIndex]=!0,_e.push(ve))}}return Z}(D);for(const O in I)I[O].forEach(Z=>{const Q=Z.feature,ee=Q.layer;ee&&ee.type!=="background"&&ee.type!=="sky"&&(Q.source=ee.source,ee["source-layer"]&&(Q.sourceLayer=ee["source-layer"]),Q.state=Q.id!==void 0?u.getFeatureState(ee["source-layer"],Q.id):{})});return I}function dr(u,i){const o=u.getRenderableIds().map(_=>u.getTileByID(_)),m=[],x={};for(let _=0;_<o.length;_++){const j=o[_],S=j.tileID.canonical.key;x[S]||(x[S]=!0,j.querySourceFeatures(m,i))}return m}function Gr(u,i){const o=u.tileID,m=i.tileID;return o.overscaledZ-m.overscaledZ||o.canonical.y-m.canonical.y||o.wrap-m.wrap||o.canonical.x-m.canonical.x}function wr(){return La.workerClass!=null?new La.workerClass:new n.window.Worker(La.workerUrl)}const Vi="mapboxgl_preloaded_worker_pool";class kr{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<kr.workerCount;)this.workers.push(new wr);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Vi]}numActive(){return Object.keys(this.active).length}}let Jr;function xa(){return Jr||(Jr=new kr),Jr}function ym(u,i){const o={};for(const m in u)m!=="ref"&&(o[m]=u[m]);return n.refProperties.forEach(m=>{m in i&&(o[m]=i[m])}),o}function lu(u){u=u.slice();const i=Object.create(null);for(let o=0;o<u.length;o++)i[u[o].id]=u[o];for(let o=0;o<u.length;o++)"ref"in u[o]&&(u[o]=ym(u[o],i[u[o].ref]));return u}kr.workerCount=2;const _s={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function uc(u,i,o){o.push({command:_s.addSource,args:[u,i[u]]})}function io(u,i,o){i.push({command:_s.removeSource,args:[u]}),o[u]=!0}function hc(u,i,o,m){io(u,o,m),uc(u,i,o)}function tl(u,i,o){let m;for(m in u[o])if(u[o].hasOwnProperty(m)&&m!=="data"&&!P(u[o][m],i[o][m]))return!1;for(m in i[o])if(i[o].hasOwnProperty(m)&&m!=="data"&&!P(u[o][m],i[o][m]))return!1;return!0}function qi(u,i,o,m,x,_){let j;for(j in i=i||{},u=u||{})u.hasOwnProperty(j)&&(P(u[j],i[j])||o.push({command:_,args:[m,j,i[j],x]}));for(j in i)i.hasOwnProperty(j)&&!u.hasOwnProperty(j)&&(P(u[j],i[j])||o.push({command:_,args:[m,j,i[j],x]}))}function nn(u){return u.id}function mc(u,i){return u[i.id]=i,u}class pc{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=n.clamp(i,0,1);let o=1,m=this._distances[o];const x=i*this.paddedLength+this.padding;for(;m<x&&o<this._distances.length;)m=this._distances[++o];const _=o-1,j=this._distances[_],S=m-j,C=S>0?(x-j)/S:0;return this.points[_].mult(1-C).add(this.points[o].mult(C))}}class Hn{constructor(i,o,m){const x=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(o/m);for(let j=0;j<this.xCellCount*this.yCellCount;j++)x.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,m,x,_){this._forEachCell(o,m,x,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(_)}insertCircle(i,o,m,x){this._forEachCell(o-x,m-x,o+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(m),this.circles.push(x)}_insertBoxCell(i,o,m,x,_,j){this.boxCells[_].push(j)}_insertCircleCell(i,o,m,x,_,j){this.circleCells[_].push(j)}_query(i,o,m,x,_,j){if(m<0||i>this.width||x<0||o>this.height)return!_&&[];const S=[];if(i<=0&&o<=0&&this.width<=m&&this.height<=x){if(_)return!0;for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const D=this.circles[3*C],I=this.circles[3*C+1],O=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:D-O,y1:I-O,x2:D+O,y2:I+O})}return j?S.filter(j):S}return this._forEachCell(i,o,m,x,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},j),_?S.length>0:S}_queryCircle(i,o,m,x,_){const j=i-m,S=i+m,C=o-m,D=o+m;if(S<0||j>this.width||D<0||C>this.height)return!x&&[];const I=[];return this._forEachCell(j,C,S,D,this._queryCellCircle,I,{hitTest:x,circle:{x:i,y:o,radius:m},seenUids:{box:{},circle:{}}},_),x?I.length>0:I}query(i,o,m,x,_){return this._query(i,o,m,x,!1,_)}hitTest(i,o,m,x,_){return this._query(i,o,m,x,!0,_)}hitTestCircle(i,o,m,x){return this._queryCircle(i,o,m,!0,x)}_queryCell(i,o,m,x,_,j,S,C){const D=S.seenUids,I=this.boxCells[_];if(I!==null){const Z=this.bboxes;for(const Q of I)if(!D.box[Q]){D.box[Q]=!0;const ee=4*Q;if(i<=Z[ee+2]&&o<=Z[ee+3]&&m>=Z[ee+0]&&x>=Z[ee+1]&&(!C||C(this.boxKeys[Q]))){if(S.hitTest)return j.push(!0),!0;j.push({key:this.boxKeys[Q],x1:Z[ee],y1:Z[ee+1],x2:Z[ee+2],y2:Z[ee+3]})}}}const O=this.circleCells[_];if(O!==null){const Z=this.circles;for(const Q of O)if(!D.circle[Q]){D.circle[Q]=!0;const ee=3*Q;if(this._circleAndRectCollide(Z[ee],Z[ee+1],Z[ee+2],i,o,m,x)&&(!C||C(this.circleKeys[Q]))){if(S.hitTest)return j.push(!0),!0;{const Y=Z[ee],se=Z[ee+1],F=Z[ee+2];j.push({key:this.circleKeys[Q],x1:Y-F,y1:se-F,x2:Y+F,y2:se+F})}}}}}_queryCellCircle(i,o,m,x,_,j,S,C){const D=S.circle,I=S.seenUids,O=this.boxCells[_];if(O!==null){const Q=this.bboxes;for(const ee of O)if(!I.box[ee]){I.box[ee]=!0;const Y=4*ee;if(this._circleAndRectCollide(D.x,D.y,D.radius,Q[Y+0],Q[Y+1],Q[Y+2],Q[Y+3])&&(!C||C(this.boxKeys[ee])))return j.push(!0),!0}}const Z=this.circleCells[_];if(Z!==null){const Q=this.circles;for(const ee of Z)if(!I.circle[ee]){I.circle[ee]=!0;const Y=3*ee;if(this._circlesCollide(Q[Y],Q[Y+1],Q[Y+2],D.x,D.y,D.radius)&&(!C||C(this.circleKeys[ee])))return j.push(!0),!0}}}_forEachCell(i,o,m,x,_,j,S,C){const D=this._convertToXCellCoord(i),I=this._convertToYCellCoord(o),O=this._convertToXCellCoord(m),Z=this._convertToYCellCoord(x);for(let Q=D;Q<=O;Q++)for(let ee=I;ee<=Z;ee++)if(_.call(this,i,o,m,x,this.xCellCount*ee+Q,j,S,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,m,x,_,j){const S=x-i,C=_-o,D=m+j;return D*D>S*S+C*C}_circleAndRectCollide(i,o,m,x,_,j,S){const C=(j-x)/2,D=Math.abs(i-(x+C));if(D>C+m)return!1;const I=(S-_)/2,O=Math.abs(o-(_+I));if(O>I+m)return!1;if(D<=C||O<=I)return!0;const Z=D-C,Q=O-I;return Z*Z+Q*Q<=m*m}}const an={unknown:0,flipRequired:1,flipNotRequired:2},no=Math.tan(85*Math.PI/180);function We(u,i,o,m,x,_,j){const S=n.create();if(o)if(_.name==="globe"){const C=n.calculateGlobeLabelMatrix(x,i);n.multiply(S,S,C)}else{const C=ke([],j);S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],m||n.rotateZ(S,S,x.angle)}else n.multiply(S,x.labelPlaneMatrix,u);return S}function on(u,i,o,m,x,_,j){const S=We(u,i,o,m,x,_,j);return _.name==="globe"&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function ur(u,i,o,m,x,_,j){if(o){if(_.name==="globe"){const S=We(u,i,o,m,x,_,j);return n.invert(S,S),n.multiply(S,u,S),S}{const S=n.clone(u),C=n.identity([]);return C[0]=j[0],C[1]=j[1],C[4]=j[2],C[5]=j[3],n.multiply(S,S,C),m||n.rotateZ(S,S,-x.angle),S}}return x.glCoordMatrix}function Ar(u,i,o,m){const x=[u,i,o,1];o?n.transformMat4$1(x,x,m):is(x,x,m);const _=x[3];return x[0]/=_,x[1]/=_,x[2]/=_,x}function cu(u,i){return Math.min(.5+u/i*.5,1.5)}function $i(u,i){const o=u[0]/u[3],m=u[1]/u[3];return o>=-i[0]&&o<=i[0]&&m>=-i[1]&&m<=i[1]}function fc(u,i,o,m,x,_,j,S,C,D){const I=o.transform,O=m?u.textSizeData:u.iconSizeData,Z=n.evaluateSizeForZoom(O,o.transform.zoom),Q=I.projection.name==="globe",ee=[256/o.width*2+1,256/o.height*2+1],Y=m?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;Y.clear();let se=null;Q&&(se=m?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const F=u.lineVertexArray,K=m?u.text.placedSymbolArray:u.icon.placedSymbolArray,ae=o.transform.width/o.transform.height;let le,_e=!1;for(let ve=0;ve<K.length;ve++){const be=K.get(ve),{numGlyphs:Ae,writingMode:Ce}=be;if(Ce!==n.WritingMode.vertical||_e||le===n.WritingMode.horizontal||(_e=!0),le=Ce,(be.hidden||Ce===n.WritingMode.vertical)&&!_e){Ri(Ae,Y);continue}_e=!1;const Oe=new n.Point(be.tileAnchorX,be.tileAnchorY);let{x:at,y:Le,z:Qe}=I.projection.projectTilePoint(Oe.x,Oe.y,D.canonical);if(C){const[Vt,kt,Ft]=C(Oe);at+=Vt,Le+=kt,Qe+=Ft}const Ue=[at,Le,Qe,1];if(n.transformMat4$1(Ue,Ue,i),!$i(Ue,ee)){Ri(Ae,Y);continue}const nt=cu(o.transform.cameraToCenterDistance,Ue[3]),ze=n.evaluateSizeForFeature(O,Z,be),Xe=j?ze/nt:ze*nt,ct=Ar(at,Le,Qe,x);if(ct[3]<=0){Ri(Ae,Y);continue}let tt={};const dt=j?null:C,Dt=Nt(be,Xe,!1,S,i,x,_,u.glyphOffsetArray,F,Y,se,ct,Oe,tt,ae,dt,I.projection,D,j);_e=Dt.useVertical,dt&&Dt.needsFlipping&&(tt={}),(Dt.notEnoughRoom||_e||Dt.needsFlipping&&Nt(be,Xe,!0,S,i,x,_,u.glyphOffsetArray,F,Y,se,ct,Oe,tt,ae,dt,I.projection,D,j).notEnoughRoom)&&Ri(Ae,Y)}m?(u.text.dynamicLayoutVertexBuffer.updateData(Y),se&&u.text.globeExtVertexBuffer.updateData(se)):(u.icon.dynamicLayoutVertexBuffer.updateData(Y),se&&u.icon.globeExtVertexBuffer.updateData(se))}function du(u,i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y){const{lineStartIndex:se,glyphStartIndex:F,segment:K}=S,ae=F+S.numGlyphs,le=se+S.lineLength,_e=i.getoffsetX(F),ve=i.getoffsetX(ae-1),be=xi(u*_e,o,m,x,_,j,K,se,le,C,D,I,O,Z,!0,Q,ee,Y);if(!be)return null;const Ae=xi(u*ve,o,m,x,_,j,K,se,le,C,D,I,O,Z,!0,Q,ee,Y);return Ae?{first:be,last:Ae}:null}function ya(u,i,o,m){return u===n.WritingMode.horizontal&&Math.abs(m)>Math.abs(o)?{useVertical:!0}:u===n.WritingMode.vertical?m>0?{needsFlipping:!0}:null:i!==an.unknown&&function(x,_){return x===0||Math.abs(_/x)>no}(o,m)?i===an.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Nt(u,i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y,se,F,K){const ae=i/24,le=u.lineOffsetX*ae,_e=u.lineOffsetY*ae,{lineStartIndex:ve,glyphStartIndex:be,numGlyphs:Ae,segment:Ce,writingMode:Oe,flipState:at}=u,Le=ve+u.lineLength,Qe=Ue=>{if(I){const[ct,tt,dt]=Ue.up,Dt=D.length;n.updateGlobeVertexNormal(I,Dt+0,ct,tt,dt),n.updateGlobeVertexNormal(I,Dt+1,ct,tt,dt),n.updateGlobeVertexNormal(I,Dt+2,ct,tt,dt),n.updateGlobeVertexNormal(I,Dt+3,ct,tt,dt)}const[nt,ze,Xe]=Ue.point;n.addDynamicAttributes(D,nt,ze,Xe,Ue.angle)};if(Ae>1){const Ue=du(ae,S,le,_e,o,O,Z,u,C,_,Q,Y,!1,se,F,K);if(!Ue)return{notEnoughRoom:!0};if(m&&!o){let[nt,ze,Xe]=Ue.first.point,[ct,tt,dt]=Ue.last.point;[nt,ze]=Ar(nt,ze,Xe,j),[ct,tt]=Ar(ct,tt,dt,j);const Dt=ya(Oe,at,(ct-nt)*ee,tt-ze);if(u.flipState=Dt&&Dt.needsFlipping?an.flipRequired:an.flipNotRequired,Dt)return Dt}Qe(Ue.first);for(let nt=be+1;nt<be+Ae-1;nt++){const ze=xi(ae*S.getoffsetX(nt),le,_e,o,O,Z,Ce,ve,Le,C,_,Q,Y,!1,!1,se,F,K);if(!ze)return D.length-=4*(nt-be),{notEnoughRoom:!0};Qe(ze)}Qe(Ue.last)}else{if(m&&!o){const nt=Ar(Z.x,Z.y,0,x),ze=ve+Ce+1,Xe=new n.Point(C.getx(ze),C.gety(ze)),ct=Ar(Xe.x,Xe.y,0,x),tt=ct[3]>0?ct:rs(Z,Xe,nt,1,x,void 0,se,F.canonical),dt=ya(Oe,at,(tt[0]-nt[0])*ee,tt[1]-nt[1]);if(u.flipState=dt&&dt.needsFlipping?an.flipRequired:an.flipNotRequired,dt)return dt}const Ue=xi(ae*S.getoffsetX(be),le,_e,o,O,Z,Ce,ve,Le,C,_,Q,Y,!1,!1,se,F,K);if(!Ue)return{notEnoughRoom:!0};Qe(Ue)}return{}}function os(u,i,o,m,x){const{x:_,y:j,z:S}=m.projectTilePoint(u.x,u.y,i);if(!x)return Ar(_,j,S,o);const[C,D,I]=x(u);return Ar(_+C,j+D,S+I,o)}function rs(u,i,o,m,x,_,j,S){const C=os(u.sub(i)._unit()._add(u),S,x,j,_);return n.sub(C,o,C),n.normalize(C,C),n.scaleAndAdd(C,o,C,m)}function xi(u,i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y,se,F){const K=m?u-i:u+i;let ae=K>0?1:-1,le=0;m&&(ae*=-1,le=Math.PI),ae<0&&(le+=Math.PI);let _e=S+j+(ae>0?0:1)|0,ve=x,be=x,Ae=0,Ce=0;const Oe=Math.abs(K),at=[],Le=[];let Qe=_,Ue=Qe;const nt=()=>rs(Ue,Qe,be,Oe-Ae+1,I,Z,Y,se.canonical);for(;Ae+Ce<=Oe;){if(_e+=ae,_e<S||_e>=C)return null;if(be=ve,Ue=Qe,at.push(be),Q&&Le.push(Ue),Qe=new n.Point(D.getx(_e),D.gety(_e)),ve=O[_e],!ve){const Ft=os(Qe,se.canonical,I,Y,Z);ve=Ft[3]>0?O[_e]=Ft:nt()}Ae+=Ce,Ce=n.distance(be,ve)}ee&&Z&&(O[_e]&&(ve=nt(),Ce=n.distance(be,ve)),O[_e]=ve);const ze=(Oe-Ae)/Ce,Xe=Qe.sub(Ue)._mult(ze)._add(Ue),ct=n.sub([],ve,be),tt=n.scaleAndAdd([],be,ct,ze);let dt=[0,0,1],Dt=ct[0],Vt=ct[1];if(F&&(dt=Y.upVector(se.canonical,Xe.x,Xe.y),dt[0]!==0||dt[1]!==0||dt[2]!==1)){const Ft=[dt[2],0,-dt[0]],ns=n.cross([],dt,Ft);n.normalize(Ft,Ft),n.normalize(ns,ns),Dt=n.dot(ct,Ft),Vt=n.dot(ct,ns)}if(o){const Ft=n.cross([],dt,ct);n.normalize(Ft,Ft),n.scaleAndAdd(tt,tt,Ft,o*ae)}const kt=le+Math.atan2(Vt,Dt);return at.push(tt),Q&&Le.push(Xe),{point:tt,angle:kt,path:at,tilePath:Le,up:dt}}function Ri(u,i){const o=i.length,m=o+4*u;i.resize(m),i.float32.fill(-1/0,4*o,4*m)}function is(u,i,o){const m=i[0],x=i[1];return u[0]=o[0]*m+o[4]*x+o[12],u[1]=o[1]*m+o[5]*x+o[13],u[3]=o[3]*m+o[7]*x+o[15],u}const yi=100;class ao{constructor(i,o,m=new Hn(i.width+200,i.height+200,25),x=new Hn(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+yi,this.screenBottomBoundary=i.height+yi,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,m,x,_,j,S,C){let D=m.projectedAnchorX,I=m.projectedAnchorY,O=m.projectedAnchorZ;const Z=m.elevation,Q=m.tileID,ee=i.getProjection();if(Z&&Q){const[ve,be,Ae]=ee.upVector(Q.canonical,m.tileAnchorX,m.tileAnchorY),Ce=ee.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ve*Z*Ce,I+=be*Z*Ce,O+=Ae*Z*Ce}const Y=this.projectAndGetPerspectiveRatio(S,D,I,O,m.tileID,ee.name==="globe"||!!Z||this.transform.pitch>0,ee),se=j*Y.perspectiveRatio,F=(m.x1*o+x.x-m.padding)*se+Y.point.x,K=(m.y1*o+x.y-m.padding)*se+Y.point.y,ae=(m.x2*o+x.x+m.padding)*se+Y.point.x,le=(m.y2*o+x.y+m.padding)*se+Y.point.y,_e=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(F,K,ae,le)||!_&&this.grid.hitTest(F,K,ae,le,C)||_e?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[F,K,ae,le],offscreen:this.isOffscreen(F,K,ae,le),occluded:!1}}placeCollisionCircles(i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y){const se=[],F=this.transform.elevation,K=i.getProjection(),ae=F?F.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,K):null,le=new n.Point(m.tileAnchorX,m.tileAnchorY);let{x:_e,y:ve,z:be}=K.projectTilePoint(le.x,le.y,Y.canonical);if(ae){const[Xe,ct,tt]=ae(le);_e+=Xe,ve+=ct,be+=tt}const Ae=K.name==="globe",Ce=this.projectAndGetPerspectiveRatio(S,_e,ve,be,Y,Ae||!!F||this.transform.pitch>0,K),{perspectiveRatio:Oe}=Ce,at=(O?j/Oe:j*Oe)/n.ONE_EM,Le=Ar(_e,ve,be,C),Qe=Ce.signedDistanceFromCamera>0?du(at,_,m.lineOffsetX*at,m.lineOffsetY*at,!1,Le,le,m,x,C,{},F&&!O?ae:null,O&&!!F,K,Y,O):null;let Ue=!1,nt=!1,ze=!0;if(Qe&&!Ce.occluded){const Xe=.5*Q*Oe+ee,ct=new n.Point(-100,-100),tt=new n.Point(this.screenRightBoundary,this.screenBottomBoundary),dt=new pc,{first:Dt,last:Vt}=Qe,kt=Dt.path.length;let Ft=[];for(let It=kt-1;It>=1;It--)Ft.push(Dt.path[It]);for(let It=1;It<Vt.path.length;It++)Ft.push(Vt.path[It]);const ns=2.5*Xe;D&&(Ft=Ft.map(([It,ws,Ss],Ts)=>(ae&&!Ae&&(Ss=ae(Ts<kt-1?Dt.tilePath[kt-1-Ts]:Vt.tilePath[Ts-kt+2])[2]),Ar(It,ws,Ss,D))),Ft.some(It=>It[3]<=0)&&(Ft=[]));let es=[];if(Ft.length>0){let It=1/0,ws=-1/0,Ss=1/0,Ts=-1/0;for(const Es of Ft)It=Math.min(It,Es[0]),Ss=Math.min(Ss,Es[1]),ws=Math.max(ws,Es[0]),Ts=Math.max(Ts,Es[1]);ws>=ct.x&&It<=tt.x&&Ts>=ct.y&&Ss<=tt.y&&(es=[Ft.map(Es=>new n.Point(Es[0],Es[1]))],(It<ct.x||ws>tt.x||Ss<ct.y||Ts>tt.y)&&(es=n.clipLine(es,ct.x,ct.y,tt.x,tt.y)))}for(const It of es){dt.reset(It,.25*Xe);let ws=0;ws=dt.length<=.5*Xe?1:Math.ceil(dt.paddedLength/ns)+1;for(let Ss=0;Ss<ws;Ss++){const Ts=Ss/Math.max(ws-1,1),Es=dt.lerp(Ts),Wr=Es.x+yi,Pr=Es.y+yi;se.push(Wr,Pr,Xe,0);const Ei=Wr-Xe,Hi=Pr-Xe,$s=Wr+Xe,Cs=Pr+Xe;if(ze=ze&&this.isOffscreen(Ei,Hi,$s,Cs),nt=nt||this.isInsideGrid(Ei,Hi,$s,Cs),!o&&this.grid.hitTestCircle(Wr,Pr,Xe,Z)&&(Ue=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ue,occluded:!1}}}}return{circles:!I&&Ue||!nt?[]:se,offscreen:ze,collisionDetected:Ue,occluded:Ce.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let m=1/0,x=1/0,_=-1/0,j=-1/0;for(const I of i){const O=new n.Point(I.x+yi,I.y+yi);m=Math.min(m,O.x),x=Math.min(x,O.y),_=Math.max(_,O.x),j=Math.max(j,O.y),o.push(O)}const S=this.grid.query(m,x,_,j).concat(this.ignoredGrid.query(m,x,_,j)),C={},D={};for(const I of S){const O=I.key;if(C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]={}),C[O.bucketInstanceId][O.featureIndex])continue;const Z=[new n.Point(I.x1,I.y1),new n.Point(I.x2,I.y1),new n.Point(I.x2,I.y2),new n.Point(I.x1,I.y2)];n.polygonIntersectsPolygon(o,Z)&&(C[O.bucketInstanceId][O.featureIndex]=!0,D[O.bucketInstanceId]===void 0&&(D[O.bucketInstanceId]=[]),D[O.bucketInstanceId].push(O.featureIndex))}return D}insertCollisionBox(i,o,m,x,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:_},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,m,x,_){const j=o?this.ignoredGrid:this.grid,S={bucketInstanceId:m,featureIndex:x,collisionGroupID:_};for(let C=0;C<i.length;C+=4)j.insertCircle(S,i[C],i[C+1],i[C+2])}projectAndGetPerspectiveRatio(i,o,m,x,_,j,S){const C=[o,m,x,1];let D=!1;x||this.transform.pitch>0?(n.transformMat4$1(C,C,i),this.fogState&&_&&S.name!=="globe"&&(D=function(Z,Q,ee,Y,se,F){const K=F.calculateFogTileMatrix(se),ae=[Q,ee,Y];return n.transformMat4(ae,ae,K),ft(Z,ae,F.pitch,F._fov)}(this.fogState,o,m,x,_.toUnwrapped(),this.transform)>.9)):is(C,C,i);const I=C[3];return{point:new n.Point((C[0]/I+1)/2*this.transform.width+yi,(-C[1]/I+1)/2*this.transform.height+yi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/I*.5,1.5),signedDistanceFromCamera:I,occluded:j&&C[2]>I||D}}isOffscreen(i,o,m,x){return m<yi||i>=this.screenRightBoundary||x<yi||o>this.screenBottomBoundary}isInsideGrid(i,o,m,x){return m>=0&&i<this.gridRightBoundary&&x>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=n.identity([]);return n.translate(i,i,[-100,-100,0]),i}}function Xn(u,i,o){const m=i.createTileMatrix(u,u.worldSize,o.toUnwrapped());return n.multiply(new Float32Array(16),u.projMatrix,m)}function ji(u,i,o){if(i.projection.name===o.projection.name)return u.projMatrix;const m=o.clone();return m.setProjection(i.projection),Xn(m,i.getProjection(),u)}function qs(u,i,o){return i.name===o.projection.name?u.projMatrix:Xn(o,i,u)}class uu{constructor(i,o,m,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):x&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class ln{constructor(i,o,m,x,_,j=!1){this.text=new uu(i?i.text:null,o,m,_),this.icon=new uu(i?i.icon:null,o,x,_),this.clipped=j}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class oo{constructor(i,o,m,x=!1){this.text=i,this.icon=o,this.skipFade=m,this.clipped=x}}class lo{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class gc{constructor(i,o,m,x,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=_}}class hu{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:m=>m.collisionGroupID===o}}return this.collisionGroups[i]}}function co(u,i,o,m,x){const{horizontalAlign:_,verticalAlign:j}=n.getAnchorAlignment(u),S=-(_-.5)*i,C=-(j-.5)*o,D=n.evaluateVariableOffset(u,m);return new n.Point(S+D[0]*x,C+D[1]*x)}function uo(u,i,o,m,x){const _=new n.Point(u,i);return o&&_._rotate(m?x:-x),_}class sl{constructor(i,o,m,x,_){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new ao(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new hu(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,m,x){const _=m.getBucket(o),j=m.latestFeatureIndex;if(!_||!j||o.id!==_.layerIds[0])return;const S=_.layers[0].layout,C=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),I=m.tileSize/n.EXTENT,O=m.tileID.toUnwrapped();this.transform.setProjection(_.projection);const Z=(Q=m.tileID,ee=_.getProjection(),Y=this.transform,ee.name===this.projection?Y.calculateProjMatrix(Q.toUnwrapped()):Xn(Y,ee,Q));var Q,ee,Y;const se=S.get("text-pitch-alignment")==="map",F=S.get("text-rotation-alignment")==="map";o.compileFilter();const K=o.dynamicFilter(),ae=o.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(m),_e=on(Z,m.tileID.canonical,se,F,this.transform,_.getProjection(),le);let ve=null;if(se){const Ce=ur(Z,m.tileID.canonical,se,F,this.transform,_.getProjection(),le);ve=n.multiply([],this.transform.labelPlaneMatrix,Ce)}let be=null;K&&m.latestFeatureIndex&&(be={unwrappedTileID:O,dynamicFilter:K,dynamicFilterNeedsFeature:ae,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new gc(_.bucketInstanceId,j,_.sourceLayerIndex,_.index,m.tileID);const Ae={bucket:_,layout:S,posMatrix:Z,textLabelPlaneMatrix:_e,labelToScreenMatrix:ve,clippingData:be,scale:D,textPixelRatio:I,holdingForFade:m.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(x)for(const Ce of _.sortKeyRanges){const{sortKey:Oe,symbolInstanceStart:at,symbolInstanceEnd:Le}=Ce;i.push({sortKey:Oe,symbolInstanceStart:at,symbolInstanceEnd:Le,parameters:Ae})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y,se,F,K){const{textOffset0:ae,textOffset1:le,crossTileID:_e}=Z,ve=[ae,le],be=co(i,m,x,ve,_),Ae=this.collisionIndex.placeCollisionBox(ee,_,o,uo(be.x,be.y,j,S,this.transform.angle),O,C,D,I.predicate);if(se){const Ce=ee.getSymbolInstanceIconSize(K,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,Ce,se,uo(be.x,be.y,j,S,this.transform.angle),O,C,D,I.predicate).box.length===0)return}if(Ae.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(Ce=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:ve,width:m,height:x,anchor:i,textScale:_,prevAnchor:Ce},this.markUsedJustification(ee,i,Z,Y),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,Y,Z),this.placedOrientations[_e]=Y),{shift:be,placedGlyphBoxes:Ae}}}placeLayerBucketPart(i,o,m,x){const{bucket:_,layout:j,posMatrix:S,textLabelPlaneMatrix:C,labelToScreenMatrix:D,clippingData:I,textPixelRatio:O,holdingForFade:Z,collisionBoxArray:Q,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:Y,collisionGroup:se}=i.parameters,F=j.get("text-optional"),K=j.get("icon-optional"),ae=j.get("text-allow-overlap"),le=j.get("icon-allow-overlap"),_e=j.get("text-rotation-alignment")==="map",ve=j.get("text-pitch-alignment")==="map",be=j.get("icon-text-fit")!=="none",Ae=j.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let Ce=ae&&(le||!_.hasIconData()||K),Oe=le&&(ae||!_.hasTextData()||F);!_.collisionArrays&&Q&&_.deserializeCollisionBoxes(Q),m&&x&&_.updateCollisionDebugBuffers(this.transform.zoom,Q);const at=(Le,Qe,Ue)=>{const{crossTileID:nt,numVerticalGlyphVertices:ze}=Le;if(I){const $s={zoom:this.transform.zoom,pitch:this.transform.pitch};let Cs=null;if(I.dynamicFilterNeedsFeature){const xs=this.retainedQueryData[_.bucketInstanceId];Cs=I.featureIndex.loadFeature({featureIndex:Le.featureIndex,bucketIndex:xs.bucketIndex,sourceLayerIndex:xs.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)($s,Cs,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new n.Point(Le.tileAnchorX,Le.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[nt]=new oo(!1,!1,!1,!0),void o.add(nt)}if(o.has(nt))return;if(Z)return void(this.placements[nt]=new oo(!1,!1,!1));let Xe=!1,ct=!1,tt=!0,dt=!1,Dt=!1,Vt=null,kt={box:null,offscreen:null,occluded:null},Ft={box:null,offscreen:null,occluded:null},ns=null,es=null,It=null,ws=0,Ss=0,Ts=0;Ue.textFeatureIndex?ws=Ue.textFeatureIndex:Le.useRuntimeCollisionCircles&&(ws=Le.featureIndex),Ue.verticalTextFeatureIndex&&(Ss=Ue.verticalTextFeatureIndex);const Es=$s=>{$s.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const Cs=this.transform.elevation;(Cs||$s.elevation)&&($s.elevation=Cs?Cs.getAtTileOffset($s.tileID,$s.tileAnchorX,$s.tileAnchorY):0)},Wr=Ue.textBox;if(Wr){Es(Wr);const $s=xs=>{let hr=n.WritingMode.horizontal;if(_.allowVerticalPlacement&&!xs&&this.prevPlacement){const Yr=this.prevPlacement.placedOrientations[nt];Yr&&(this.placedOrientations[nt]=Yr,hr=Yr,this.markUsedOrientation(_,hr,Le))}return hr},Cs=(xs,hr)=>{if(_.allowVerticalPlacement&&ze>0&&Ue.verticalTextBox){for(const Yr of _.writingModes)if(Yr===n.WritingMode.vertical?(kt=hr(),Ft=kt):kt=xs(),kt&&kt.box&&kt.box.length)break}else kt=xs()};if(j.get("text-variable-anchor")){let xs=j.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt]){const Us=this.prevPlacement.variableOffsets[nt];xs.indexOf(Us.anchor)>0&&(xs=xs.filter(oi=>oi!==Us.anchor),xs.unshift(Us.anchor))}const hr=(Us,oi,kl)=>{const ra=_.getSymbolInstanceTextSize(ee,Le,this.transform.zoom,Qe),Mo=(Us.x2-Us.x1)*ra+2*Us.padding,fn=(Us.y2-Us.y1)*ra+2*Us.padding,In=be&&!le?oi:null;In&&Es(In);let ia={box:[],offscreen:!1,occluded:!1};const Al=ae?2*xs.length:xs.length;for(let Po=0;Po<Al;++Po){const ad=this.attemptAnchorPlacement(xs[Po%xs.length],Us,Mo,fn,ra,_e,ve,O,S,se,Po>=xs.length,Le,Qe,_,kl,In,ee,Y);if(ad&&(ia=ad.placedGlyphBoxes,ia&&ia.box&&ia.box.length)){Xe=!0,Vt=ad.shift;break}}return ia};Cs(()=>hr(Wr,Ue.iconBox,n.WritingMode.horizontal),()=>{const Us=Ue.verticalTextBox;return Us&&Es(Us),_.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&ze>0&&Us?hr(Us,Ue.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),kt&&(Xe=kt.box,tt=kt.offscreen,dt=kt.occluded);const Yr=$s(!(!kt||!kt.box));if(!Xe&&this.prevPlacement){const Us=this.prevPlacement.variableOffsets[nt];Us&&(this.variableOffsets[nt]=Us,this.markUsedJustification(_,Us.anchor,Le,Yr))}}else{const xs=(hr,Yr)=>{const Us=_.getSymbolInstanceTextSize(ee,Le,this.transform.zoom,Qe),oi=this.collisionIndex.placeCollisionBox(_,Us,hr,new n.Point(0,0),ae,O,S,se.predicate);return oi&&oi.box&&oi.box.length&&(this.markUsedOrientation(_,Yr,Le),this.placedOrientations[nt]=Yr),oi};Cs(()=>xs(Wr,n.WritingMode.horizontal),()=>{const hr=Ue.verticalTextBox;return _.allowVerticalPlacement&&ze>0&&hr?(Es(hr),xs(hr,n.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),$s(!!(kt&&kt.box&&kt.box.length))}}if(ns=kt,Xe=ns&&ns.box&&ns.box.length>0,tt=ns&&ns.offscreen,dt=ns&&ns.occluded,Le.useRuntimeCollisionCircles){const $s=_.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex>=0?Le.centerJustifiedTextSymbolIndex:Le.verticalPlacedTextSymbolIndex),Cs=n.evaluateSizeForFeature(_.textSizeData,ee,$s),xs=j.get("text-padding");es=this.collisionIndex.placeCollisionCircles(_,ae,$s,_.lineVertexArray,_.glyphOffsetArray,Cs,S,C,D,m,ve,se.predicate,Le.collisionCircleDiameter*Cs/n.ONE_EM,xs,this.retainedQueryData[_.bucketInstanceId].tileID),Xe=ae||es.circles.length>0&&!es.collisionDetected,tt=tt&&es.offscreen,dt=es.occluded}if(Ue.iconFeatureIndex&&(Ts=Ue.iconFeatureIndex),Ue.iconBox){const $s=Cs=>{Es(Cs);const xs=be&&Vt?uo(Vt.x,Vt.y,_e,ve,this.transform.angle):new n.Point(0,0),hr=_.getSymbolInstanceIconSize(Y,this.transform.zoom,Le.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,hr,Cs,xs,le,O,S,se.predicate)};Ft&&Ft.box&&Ft.box.length&&Ue.verticalIconBox?(It=$s(Ue.verticalIconBox),ct=It.box.length>0):(It=$s(Ue.iconBox),ct=It.box.length>0),tt=tt&&It.offscreen,Dt=It.occluded}const Pr=F||Le.numHorizontalGlyphVertices===0&&ze===0,Ei=K||Le.numIconVertices===0;if(Pr||Ei?Ei?Pr||(ct=ct&&Xe):Xe=ct&&Xe:ct=Xe=ct&&Xe,Xe&&ns&&ns.box&&this.collisionIndex.insertCollisionBox(ns.box,j.get("text-ignore-placement"),_.bucketInstanceId,Ft&&Ft.box&&Ss?Ss:ws,se.ID),ct&&It&&this.collisionIndex.insertCollisionBox(It.box,j.get("icon-ignore-placement"),_.bucketInstanceId,Ts,se.ID),es&&(Xe&&this.collisionIndex.insertCollisionCircles(es.circles,j.get("text-ignore-placement"),_.bucketInstanceId,ws,se.ID),m)){const $s=_.bucketInstanceId;let Cs=this.collisionCircleArrays[$s];Cs===void 0&&(Cs=this.collisionCircleArrays[$s]=new lo);for(let xs=0;xs<es.circles.length;xs+=4)Cs.circles.push(es.circles[xs+0]),Cs.circles.push(es.circles[xs+1]),Cs.circles.push(es.circles[xs+2]),Cs.circles.push(es.collisionDetected?1:0)}const Hi=_.projection.name!=="globe";Ce=Ce&&(Hi||!dt),Oe=Oe&&(Hi||!Dt),this.placements[nt]=new oo(Xe||Ce,ct||Oe,tt||_.justReloaded),o.add(nt)};if(Ae){const Le=_.getSortedSymbolIndexes(this.transform.angle);for(let Qe=Le.length-1;Qe>=0;--Qe){const Ue=Le[Qe];at(_.symbolInstances.get(Ue),Ue,_.collisionArrays[Ue])}}else for(let Le=i.symbolInstanceStart;Le<i.symbolInstanceEnd;Le++)at(_.symbolInstances.get(Le),Le,_.collisionArrays[Le]);if(m&&_.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[_.bucketInstanceId];n.invert(Le.invProjMatrix,S),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(i,o,m,x){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:C,crossTileID:D}=m,I=n.getAnchorJustification(o),O=x===n.WritingMode.vertical?C:I==="left"?_:I==="center"?j:I==="right"?S:-1;_>=0&&(i.text.placedSymbolArray.get(_).crossTileID=O>=0&&_!==O?0:D),j>=0&&(i.text.placedSymbolArray.get(j).crossTileID=O>=0&&j!==O?0:D),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=O>=0&&S!==O?0:D),C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=O>=0&&C!==O?0:D)}markUsedOrientation(i,o,m){const x=o===n.WritingMode.horizontal||o===n.WritingMode.horizontalOnly?o:0,_=o===n.WritingMode.vertical?o:0,{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D}=m,I=i.text.placedSymbolArray;j>=0&&(I.get(j).placedOrientation=x),S>=0&&(I.get(S).placedOrientation=x),C>=0&&(I.get(C).placedOrientation=x),D>=0&&(I.get(D).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let m=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const x=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},j=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const C in this.placements){const D=this.placements[C],I=_[C];I?(this.opacities[C]=new ln(I,x,D.text,D.icon,null,D.clipped),m=m||D.text!==I.text.placed||D.icon!==I.icon.placed):(this.opacities[C]=new ln(null,x,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const C in _){const D=_[C];if(!this.opacities[C]){const I=new ln(D,x,!1,!1);I.isHidden()||(this.opacities[C]=I,m=m||D.text.placed||D.icon.placed)}}for(const C in j)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=j[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const m=new Set;for(const x of o){const _=x.getBucket(i);_&&x.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,m,x.collisionBoxArray)}}updateBucketOpacities(i,o,m){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const x=i.layers[0].layout,_=!!i.layers[0].dynamicFilter(),j=new ln(null,0,!1,!1,!0),S=x.get("text-allow-overlap"),C=x.get("icon-allow-overlap"),D=x.get("text-variable-anchor"),I=x.get("text-rotation-alignment")==="map",O=x.get("text-pitch-alignment")==="map",Z=x.get("icon-text-fit")!=="none",Q=new ln(null,0,S&&(C||!i.hasIconData()||x.get("icon-optional")),C&&(S||!i.hasTextData()||x.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const ee=(se,F,K)=>{for(let ae=0;ae<F/4;ae++)se.opacityVertexArray.emplaceBack(K)};let Y=0;for(let se=0;se<i.symbolInstances.length;se++){const F=i.symbolInstances.get(se),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:ae,crossTileID:le,numIconVertices:_e}=F,ve=o.has(le);let be=this.opacities[le];ve?be=j:be||(be=Q,this.opacities[le]=be),o.add(le);const Ae=K>0||ae>0,Ce=_e>0,Oe=this.placedOrientations[le],at=Oe===n.WritingMode.vertical,Le=Oe===n.WritingMode.horizontal||Oe===n.WritingMode.horizontalOnly;if(!Ae&&!Ce||be.isHidden()||Y++,Ae){const Qe=ho(be.text);ee(i.text,K,at?Xs:Qe),ee(i.text,ae,Le?Xs:Qe);const Ue=be.text.isHidden(),{leftJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:ze,rightJustifiedTextSymbolIndex:Xe,verticalPlacedTextSymbolIndex:ct}=F,tt=i.text.placedSymbolArray,dt=Ue||at?1:0;nt>=0&&(tt.get(nt).hidden=dt),ze>=0&&(tt.get(ze).hidden=dt),Xe>=0&&(tt.get(Xe).hidden=dt),ct>=0&&(tt.get(ct).hidden=Ue||Le?1:0);const Dt=this.variableOffsets[le];Dt&&this.markUsedJustification(i,Dt.anchor,F,Oe);const Vt=this.placedOrientations[le];Vt&&(this.markUsedJustification(i,"left",F,Vt),this.markUsedOrientation(i,Vt,F))}if(Ce){const Qe=ho(be.icon),{placedIconSymbolIndex:Ue,verticalPlacedIconSymbolIndex:nt}=F,ze=i.icon.placedSymbolArray,Xe=be.icon.isHidden()?1:0;Ue>=0&&(ee(i.icon,_e,at?Xs:Qe),ze.get(Ue).hidden=Xe),nt>=0&&(ee(i.icon,F.numVerticalIconVertices,Le?Xs:Qe),ze.get(nt).hidden=Xe)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Qe=i.collisionArrays[se];if(Qe){let Ue=new n.Point(0,0),nt=!0;if(Qe.textBox||Qe.verticalTextBox){if(D){const Xe=this.variableOffsets[le];Xe?(Ue=co(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textScale),I&&Ue._rotate(O?this.transform.angle:-this.transform.angle)):nt=!1}_&&(nt=!be.clipped),Qe.textBox&&_a(i.textCollisionBox.collisionVertexArray,be.text.placed,!nt||at,Ue.x,Ue.y),Qe.verticalTextBox&&_a(i.textCollisionBox.collisionVertexArray,be.text.placed,!nt||Le,Ue.x,Ue.y)}const ze=nt&&!!(!Le&&Qe.verticalIconBox);Qe.iconBox&&_a(i.iconCollisionBox.collisionVertexArray,be.icon.placed,ze,Z?Ue.x:0,Z?Ue.y:0),Qe.verticalIconBox&&_a(i.iconCollisionBox.collisionVertexArray,be.icon.placed,!ze,Z?Ue.x:0,Z?Ue.y:0)}}}if(i.fullyClipped=Y===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=se.invProjMatrix,i.placementViewportMatrix=se.viewportMatrix,i.collisionCircleArray=se.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const m=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function _a(u,i,o,m,x){u.emplaceBack(i?1:0,o?1:0,m||0,x||0),u.emplaceBack(i?1:0,o?1:0,m||0,x||0),u.emplaceBack(i?1:0,o?1:0,m||0,x||0),u.emplaceBack(i?1:0,o?1:0,m||0,x||0)}const ni=Math.pow(2,25),ir=Math.pow(2,24),xc=Math.pow(2,17),yc=Math.pow(2,16),ai=Math.pow(2,9),Ni=Math.pow(2,8),mu=Math.pow(2,1);function ho(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const i=u.placed?1:0,o=Math.floor(127*u.opacity);return o*ni+i*ir+o*xc+i*yc+o*ai+i*Ni+o*mu+i}const Xs=0;class mo{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,m,x,_){const j=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(j,x,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<j.length;){const S=j[this._currentPartIndex];if(o.placeLayerBucketPart(S,this._seenCrossTileIDs,m,S.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class _c{constructor(i,o,m,x,_,j,S,C){this.placement=new sl(i,_,j,S,C),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,o,m){const x=n.exported.now(),_=()=>{const j=n.exported.now()-x;return!this._forceFullPlacement&&j>2};for(;this._currentPlacementIndex>=0;){const j=o[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=S)&&(!j.maxzoom||j.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new mo(j)),this._inProgressLayer.continuePlacement(m[j.source],this.placement,this._showCollisionBoxes,j,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Kn=512/n.EXTENT/2;class Br{constructor(i,o,m){this.tileID=i,this.bucketInstanceId=m,this.index=new n.KDBush(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*n.EXTENT,_=i.canonical.y*n.EXTENT;for(let j=0;j<o.length;j++){const{key:S,crossTileID:C,tileAnchorX:D,tileAnchorY:I}=o.get(j),O=Math.floor((x+D)*Kn),Z=Math.floor((_+I)*Kn);this.index.add(O,Z),this.keys.push(S),this.crossTileIDs.push(C)}this.index.finish()}findMatches(i,o,m){const x=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),_=Kn/Math.pow(2,o.canonical.z-this.tileID.canonical.z),j=o.canonical.x*n.EXTENT,S=o.canonical.y*n.EXTENT;for(let C=0;C<i.length;C++){const D=i.get(C);if(D.crossTileID)continue;const{key:I,tileAnchorX:O,tileAnchorY:Z}=D,Q=Math.floor((j+O)*_),ee=Math.floor((S+Z)*_),Y=this.index.range(Q-x,ee-x,Q+x,ee+x);for(const se of Y){const F=this.crossTileIDs[se];if(this.keys[se]===I&&!m.has(F)){m.add(F),D.crossTileID=F;break}}}}}class bc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const m in this.indexes){const x=this.indexes[m],_={};for(const j in x){const S=x[j];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),_[S.tileID.key]=S}this.indexes[m]=_}this.lng=i}addBucket(i,o,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const j=this.indexes[_];if(Number(_)>i.overscaledZ)for(const S in j){const C=j[S];C.tileID.isChildOf(i)&&C.findMatches(o.symbolInstances,i,x)}else{const S=j[i.scaledTo(Number(_)).key];S&&S.findMatches(o.symbolInstances,i,x)}}for(let _=0;_<o.symbolInstances.length;_++){const j=o.symbolInstances.get(_);j.crossTileID||(j.crossTileID=m.generate(),x.add(j.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Br(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const m of o.crossTileIDs)this.usedCrossTileIDs[i].delete(m)}removeStaleBuckets(i){let o=!1;for(const m in this.indexes){const x=this.indexes[m];for(const _ in x)i[x[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[_]),delete x[_],o=!0)}return o}}class cn{constructor(){this.layerIndexes={},this.crossTileIDs=new bc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,m,x){let _=this.layerIndexes[i.id];_===void 0&&(_=this.layerIndexes[i.id]=new vc);let j=!1;const S={};x.name!=="globe"&&_.handleWrapJump(m);for(const C of o){const D=C.getBucket(i);D&&i.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,D,this.crossTileIDs)&&(j=!0),S[D.bucketInstanceId]=!0)}return _.removeStaleBuckets(S)&&(j=!0),j}pruneUnusedLayers(i){const o={};i.forEach(m=>{o[m]=!0});for(const m in this.layerIndexes)o[m]||delete this.layerIndexes[m]}}const Mn=(u,i)=>n.emitValidationErrors(u,i&&i.filter(o=>o.identifier!=="source.canvas")),rl=n.pick(_s,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),_m=n.pick(_s,["setCenter","setZoom","setBearing","setPitch"]),wc={version:8,layers:[],sources:{}},ba={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Gi extends n.Evented{constructor(i,o={}){super(),this.map=i,this.dispatcher=new ts(xa(),this),this.imageManager=new we,this.imageManager.setEventedParent(this),this.glyphManager=new n.GlyphManager(i._requestManager,o.localFontFamily?n.LocalGlyphMode.all:o.localIdeographFontFamily?n.LocalGlyphMode.ideographs:n.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new cn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const m=this;this._rtlTextPluginCallback=Gi.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(_,j)=>{if(n.triggerPluginCompletionEvent(_),j&&j.every(S=>S))for(const S in m._sourceCaches){const C=m._sourceCaches[S],D=C.getSource().type;D!=="vector"&&D!=="geojson"||C.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const _=this.getSource(x.sourceId);if(_&&_.vectorLayerIds)for(const j in this._layers){const S=this._layers[j];S.source===_.id&&this._validateLayer(S)}})}loadURL(i,o={}){this.fire(new n.Event("dataloading",{dataType:"style"}));const m=typeof o.validate=="boolean"?o.validate:!n.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,o.accessToken);const x=this.map._requestManager.transformRequest(i,n.ResourceType.Style);this._request=n.getJSON(x,(_,j)=>{this._request=null,_?this.fire(new n.ErrorEvent(_)):j&&this._load(j,m)})}loadJSON(i,o={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(wc,!1)}_updateLayerCount(i,o){const m=o?1:-1;i.is3D()&&(this._num3DLayers+=m),i.type==="circle"&&(this._numCircleLayers+=m),i.type==="symbol"&&(this._numSymbolLayers+=m)}_load(i,o){if(o&&Mn(this,n.validateStyle(i)))return;this._loaded=!0,this.stylesheet=n.clone$1(i),this._updateMapProjection();for(const x in i.sources)this.addSource(x,i.sources[x],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const m=lu(this.stylesheet.layers);this._order=m.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of m){const _=n.createStyleLayer(x);_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new st(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(o,m,x){let _,j,S;const C=n.exported.devicePixelRatio>1?"@2x":"";let D=n.getJSON(m.transformRequest(m.normalizeSpriteURL(o,C,".json"),n.ResourceType.SpriteJSON),(Z,Q)=>{D=null,S||(S=Z,_=Q,O())}),I=n.getImage(m.transformRequest(m.normalizeSpriteURL(o,C,".png"),n.ResourceType.SpriteImage),(Z,Q)=>{I=null,S||(S=Z,j=Q,O())});function O(){if(S)x(S);else if(_&&j){const Z=n.exported.getImageData(j),Q={};for(const ee in _){const{width:Y,height:se,x:F,y:K,sdf:ae,pixelRatio:le,stretchX:_e,stretchY:ve,content:be}=_[ee],Ae=new n.RGBAImage({width:Y,height:se});n.RGBAImage.copy(Z,Ae,{x:F,y:K},{x:0,y:0},{width:Y,height:se}),Q[ee]={data:Ae,pixelRatio:le,sdf:ae,stretchX:_e,stretchY:ve,content:be}}x(null,Q)}}return{cancel(){D&&(D.cancel(),D=null),I&&(I.cancel(),I=null)}}}(i,this.map._requestManager,(o,m)=>{if(this._spriteRequest=null,o)this.fire(new n.ErrorEvent(o));else if(m)for(const x in m)this.imageManager.addImage(x,m[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(i){const o=this.getSource(i.source);if(!o)return;const m=i.sourceLayer;m&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(m)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const o=[];for(const m of i){const x=this._layers[m];x.type!=="custom"&&o.push(x.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&(typeof i.isLayerDraped=="function"?i.isLayerDraped():ba[i.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const o=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(x.length||_.length)&&this._updateWorkerLayers(x,_);for(const j in this._updatedSources){const S=this._updatedSources[j];S==="reload"?this._reloadSource(j):S==="clear"&&this._clearSource(j)}this._updateTilesForChangedImages();for(const j in this._updatedPaintProps)this._layers[j].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const m={};for(const x in this._sourceCaches){const _=this._sourceCaches[x];m[x]=_.used,_.used=!1}for(const x of this._order){const _=this._layers[x];if(_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)){const S=this._getLayerSourceCache(_);S&&(S.used=!0)}const j=this.map.painter;if(j){const S=_.getProgramIds();if(!S)continue;const C=_.getProgramConfiguration(i.zoom);for(const D of S)j.useProgram(D,C)}}for(const x in m){const _=this._sourceCaches[x];m[x]!==_.used&&_.getSource().fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Mn(this,n.validateStyle(i)))return!1;(i=n.clone$1(i)).layers=lu(i.layers);const o=function(x,_){if(!x)return[{command:_s.setStyle,args:[_]}];let j=[];try{if(!P(x.version,_.version))return[{command:_s.setStyle,args:[_]}];P(x.center,_.center)||j.push({command:_s.setCenter,args:[_.center]}),P(x.zoom,_.zoom)||j.push({command:_s.setZoom,args:[_.zoom]}),P(x.bearing,_.bearing)||j.push({command:_s.setBearing,args:[_.bearing]}),P(x.pitch,_.pitch)||j.push({command:_s.setPitch,args:[_.pitch]}),P(x.sprite,_.sprite)||j.push({command:_s.setSprite,args:[_.sprite]}),P(x.glyphs,_.glyphs)||j.push({command:_s.setGlyphs,args:[_.glyphs]}),P(x.transition,_.transition)||j.push({command:_s.setTransition,args:[_.transition]}),P(x.light,_.light)||j.push({command:_s.setLight,args:[_.light]}),P(x.fog,_.fog)||j.push({command:_s.setFog,args:[_.fog]}),P(x.projection,_.projection)||j.push({command:_s.setProjection,args:[_.projection]});const S={},C=[];(function(O,Z,Q,ee){let Y;for(Y in Z=Z||{},O=O||{})O.hasOwnProperty(Y)&&(Z.hasOwnProperty(Y)||io(Y,Q,ee));for(Y in Z){if(!Z.hasOwnProperty(Y))continue;const se=Z[Y];O.hasOwnProperty(Y)?P(O[Y],se)||(O[Y].type==="geojson"&&se.type==="geojson"&&tl(O,Z,Y)?Q.push({command:_s.setGeoJSONSourceData,args:[Y,se.data]}):hc(Y,Z,Q,ee)):uc(Y,Z,Q)}})(x.sources,_.sources,C,S);const D=[];x.layers&&x.layers.forEach(O=>{O.source&&S[O.source]?j.push({command:_s.removeLayer,args:[O.id]}):D.push(O)});let I=x.terrain;I&&S[I.source]&&(j.push({command:_s.setTerrain,args:[void 0]}),I=void 0),j=j.concat(C),P(I,_.terrain)||j.push({command:_s.setTerrain,args:[_.terrain]}),function(O,Z,Q){Z=Z||[];const ee=(O=O||[]).map(nn),Y=Z.map(nn),se=O.reduce(mc,{}),F=Z.reduce(mc,{}),K=ee.slice(),ae=Object.create(null);let le,_e,ve,be,Ae,Ce,Oe;for(le=0,_e=0;le<ee.length;le++)ve=ee[le],F.hasOwnProperty(ve)?_e++:(Q.push({command:_s.removeLayer,args:[ve]}),K.splice(K.indexOf(ve,_e),1));for(le=0,_e=0;le<Y.length;le++)ve=Y[Y.length-1-le],K[K.length-1-le]!==ve&&(se.hasOwnProperty(ve)?(Q.push({command:_s.removeLayer,args:[ve]}),K.splice(K.lastIndexOf(ve,K.length-_e),1)):_e++,Ce=K[K.length-le],Q.push({command:_s.addLayer,args:[F[ve],Ce]}),K.splice(K.length-le,0,ve),ae[ve]=!0);for(le=0;le<Y.length;le++)if(ve=Y[le],be=se[ve],Ae=F[ve],!ae[ve]&&!P(be,Ae))if(P(be.source,Ae.source)&&P(be["source-layer"],Ae["source-layer"])&&P(be.type,Ae.type)){for(Oe in qi(be.layout,Ae.layout,Q,ve,null,_s.setLayoutProperty),qi(be.paint,Ae.paint,Q,ve,null,_s.setPaintProperty),P(be.filter,Ae.filter)||Q.push({command:_s.setFilter,args:[ve,Ae.filter]}),P(be.minzoom,Ae.minzoom)&&P(be.maxzoom,Ae.maxzoom)||Q.push({command:_s.setLayerZoomRange,args:[ve,Ae.minzoom,Ae.maxzoom]}),be)be.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&(Oe.indexOf("paint.")===0?qi(be[Oe],Ae[Oe],Q,ve,Oe.slice(6),_s.setPaintProperty):P(be[Oe],Ae[Oe])||Q.push({command:_s.setLayerProperty,args:[ve,Oe,Ae[Oe]]}));for(Oe in Ae)Ae.hasOwnProperty(Oe)&&!be.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&(Oe.indexOf("paint.")===0?qi(be[Oe],Ae[Oe],Q,ve,Oe.slice(6),_s.setPaintProperty):P(be[Oe],Ae[Oe])||Q.push({command:_s.setLayerProperty,args:[ve,Oe,Ae[Oe]]}))}else Q.push({command:_s.removeLayer,args:[ve]}),Ce=K[K.lastIndexOf(ve)+1],Q.push({command:_s.addLayer,args:[Ae,Ce]})}(D,_.layers,j)}catch(S){console.warn("Unable to compute style diff:",S),j=[{command:_s.setStyle,args:[_]}]}return j}(this.serialize(),i).filter(x=>!(x.command in _m));if(o.length===0)return!1;const m=o.filter(x=>!(x.command in rl));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);return o.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,o){return this.getImage(i)?this.fire(new n.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,o),this._afterImageUpdated(i),this)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new n.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,o,m={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(n.validateSource,`sources.${i}`,o,null,m))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const x=Yt(i,o,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:x.serialize(),sourceId:i}));const _=j=>{const S=(j?"symbol:":"other:")+i,C=this._sourceCaches[S]=new n.SourceCache(S,x,j);(j?this._symbolSourceCaches:this._otherSourceCaches)[i]=C,C.style=this,C.onAdd(this.map)};_(!1),o.type!=="vector"&&o.type!=="geojson"||_(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const o=this.getSource(i);if(!o)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new n.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new n.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(i);for(const x of m)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getSource(i).setData(o),this._changed=!0}getSource(i){const o=this._getSourceCache(i);return o&&o.getSource()}_getSources(){const i=[];for(const o in this._otherSourceCaches){const m=this._getSourceCache(o);m&&i.push(m.getSource())}return i}addLayer(i,o,m={}){this._checkLoaded();const x=i.id;if(this.getLayer(x))return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let _;if(i.type==="custom"){if(Mn(this,n.validateCustomStyleLayer(i)))return;_=n.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=n.clone$1(i),i=n.extend(i,{source:x})),this._validate(n.validateLayer,`layers.${x}`,i,{arrayIndex:-1},m))return;_=n.createStyleLayer(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const j=o?this._order.indexOf(o):this._order.length;if(o&&j===-1)return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(j,0,x),this._layerOrderChanged=!0,this._layers[x]=_;const S=this._getLayerSourceCache(_);if(this._removedLayers[x]&&_.source&&S&&_.type!=="custom"){const C=this._removedLayers[x];delete this._removedLayers[x],C.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",S.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const m=this._order.indexOf(i);this._order.splice(m,1);const x=o?this._order.indexOf(o):this._order.length;o&&x===-1?this.fire(new n.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(x,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,m){this._checkLoaded();const x=this.getLayer(i);x?x.minzoom===o&&x.maxzoom===m||(o!=null&&(x.minzoom=o),m!=null&&(x.maxzoom=m),this._updateLayer(x)):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,o,m={}){this._checkLoaded();const x=this.getLayer(i);if(x){if(!P(x.filter,o))return o==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(n.validateFilter,`layers.${x.id}.filter`,o,{layerType:x.type},m)||(x.filter=n.clone$1(o),this._updateLayer(x)))}else this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const o=this.getLayer(i);return o&&n.clone$1(o.filter)}setLayoutProperty(i,o,m,x={}){this._checkLoaded();const _=this.getLayer(i);_?P(_.getLayoutProperty(o),m)||(_.setLayoutProperty(o,m,x),this._updateLayer(_)):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,o){const m=this.getLayer(i);if(m)return m.getLayoutProperty(o);this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,o,m,x={}){this._checkLoaded();const _=this.getLayer(i);_?P(_.getPaintProperty(o),m)||(_.setPaintProperty(o,m,x)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new n.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,o){const m=this.getLayer(i);return m&&m.getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const m=i.source,x=i.sourceLayer,_=this.getSource(m);if(!_)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const j=_.type;if(j==="geojson"&&x)return void this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(j==="vector"&&!x)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(m);for(const C of S)C.setFeatureState(x,i.id,o)}removeFeatureState(i,o){this._checkLoaded();const m=i.source,x=this.getSource(m);if(!x)return void this.fire(new n.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const _=x.type,j=_==="vector"?i.sourceLayer:void 0;if(_==="vector"&&!j)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(m);for(const C of S)C.removeFeatureState(j,i.id,o)}getFeatureState(i){this._checkLoaded();const o=i.source,m=i.sourceLayer,x=this.getSource(o);if(x){if(x.type!=="vector"||m)return i.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(m,i.id);this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new n.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const o in this._sourceCaches){const m=this._sourceCaches[o].getSource();i[m.id]||(i[m.id]=m.serialize())}return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const o=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",o.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=j=>this._layers[j].type==="fill-extrusion",m={},x=[];for(let j=this._order.length-1;j>=0;j--){const S=this._order[j];if(o(S)){m[S]=j;for(const C of i){const D=C[S];if(D)for(const I of D)x.push(I)}}}x.sort((j,S)=>S.intersectionZ-j.intersectionZ);const _=[];for(let j=this._order.length-1;j>=0;j--){const S=this._order[j];if(o(S))for(let C=x.length-1;C>=0;C--){const D=x[C].feature;if(m[D.layer.id]<j)break;_.push(D),x.pop()}else for(const C of i){const D=C[S];if(D)for(const I of D)_.push(I.feature)}}return _}queryRenderedFeatures(i,o,m){o&&o.filter&&this._validate(n.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const x={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of o.layers){const D=this._layers[C];if(!D)return this.fire(new n.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];x[D.source]=!0}}const _=[];o.availableImages=this._availableImages;const j=o&&o.layers?o.layers.some(C=>{const D=this.getLayer(C);return D&&D.is3D()}):this.has3DLayers(),S=lr.createFromScreenPoints(i,m);for(const C in this._sourceCaches){const D=this._sourceCaches[C].getSource().id;o.layers&&!x[D]||_.push(Zs(this._sourceCaches[C],this._layers,this._serializedLayers,S,o,m,j,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(C,D,I,O,Z,Q,ee){const Y={},se=Q.queryRenderedSymbols(O),F=[];for(const K of Object.keys(se).map(Number))F.push(ee[K]);F.sort(Gr);for(const K of F){const ae=K.featureIndex.lookupSymbolFeatures(se[K.bucketInstanceId],D,K.bucketIndex,K.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,C);for(const le in ae){const _e=Y[le]=Y[le]||[],ve=ae[le];ve.sort((be,Ae)=>{const Ce=K.featureSortOrder;if(Ce){const Oe=Ce.indexOf(be.featureIndex);return Ce.indexOf(Ae.featureIndex)-Oe}return Ae.featureIndex-be.featureIndex});for(const be of ve)_e.push(be)}}for(const K in Y)Y[K].forEach(ae=>{const le=ae.feature,_e=I(C[K]);if(!_e)return;const ve=_e.getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ve});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(n.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const m=this._getSourceCaches(i);let x=[];for(const _ of m)x=x.concat(dr(_,o));return x}addSourceType(i,o,m){return Gi.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(Gi.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const m=this.light.getLight();let x=!1;for(const j in i)if(!P(i[j],m[j])){x=!0;break}if(!x)return;const _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,o),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,o=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=i;if(o===1){if(typeof m.source=="object"){const x="terrain-dem-src";this.addSource(x,m.source),m=n.clone$1(m),m=n.extend(m,{source:x})}if(this._validate(n.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,o)}else{const x=this.terrain,_=x.get();for(const j of Object.keys(n.spec.terrain))!m.hasOwnProperty(j)&&n.spec.terrain[j].default&&(m[j]=n.spec.terrain[j].default);for(const j in m)if(!P(m[j],_[j])){x.set(m),this.stylesheet.terrain=m;const S=this._setTransitionParameters({duration:0});x.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new Fs(i,this.map.transform);this.stylesheet.fog=i;const m=this._setTransitionParameters({duration:0});o.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,m=o.get();Object.keys(i).length===0&&o.set(i);for(const x in i)if(!P(i[x],m[x])){o.set(i),this.stylesheet.fog=i;const _=this._setTransitionParameters({duration:0});o.updateTransitions(_);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:n.exported.now(),transition:n.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(m=>this.isLayerDraped(this._layers[m])),o=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const m=this.terrain=new St(i,o);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,m,x,_={}){return(!_||_.validate!==!1)&&Mn(this,i.call(n.validateStyle,n.extend({key:o,style:this.serialize(),value:m,styleSpec:n.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const o=this._getSourceCaches(i);for(const m of o)m.clearTiles()}_reloadSource(i){const o=this._getSourceCaches(i);for(const m of o)m.resume(),m.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const o in this._sourceCaches)this._sourceCaches[o].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,m,x,_=!1){let j=!1,S=!1;const C={};for(const D of this._order){const I=this._layers[D];if(I.type!=="symbol")continue;if(!C[I.source]){const Z=this._getLayerSourceCache(I);if(!Z)continue;C[I.source]=Z.getRenderableIds(!0).map(Q=>Z.getTileByID(Q)).sort((Q,ee)=>ee.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(ee.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(I,C[I.source],i.center.lng,i.projection);j=j||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new n.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),i.zoom))&&(this.pauseablePlacement=new _c(i,this._order,_,o,m,x,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),S=!0),j&&this.pauseablePlacement.placement.setStale()),S||j)for(const D of this._order){const I=this._layers[D];I.type==="symbol"&&this.placement.updateLayerOpacities(I,C[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o,m){this.imageManager.getImages(o.icons,m),this._updateTilesForChangedImages();const x=_=>{_&&_.setDependencies(o.tileID.key,o.type,o.icons)};x(this._otherSourceCaches[o.source]),x(this._symbolSourceCaches[o.source])}getGlyphs(i,o,m){this.glyphManager.getGlyphs(o.stacks,m)}getResource(i,o,m){return n.makeRequest(o,m)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this._getSourceCaches(i);return o.length===0?(this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):o.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Gi.getSourceType=function(u){return Xt[u]},Gi.setSourceType=function(u,i){Xt[u]=i},Gi.registerForPluginStateChange=n.registerForPluginStateChange;var jc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Qn="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",dn=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,po=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,un=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let il={},va={};const fo=[];wa(jc,fo),wa(dn,fo),wa(po,fo),wa(un,fo),il=bs("",dn),va=bs(un,po);const pu=bs(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),nl=jc,Nc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Sc={background:bs(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:bs(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:bs(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:bs("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:bs(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:bs(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:bs("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:bs("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:bs("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:bs(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:bs(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:bs(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:bs(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:bs(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:bs(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:bs(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bs(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:bs(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:bs(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:bs(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:bs(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:bs(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:bs(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:bs(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:bs(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:bs(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Qn),skyboxGradient:bs(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Qn),skyboxCapture:bs(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:bs(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:bs(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function wa(u,i){const o=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of o)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const _ of x)i.includes(_)||i.push(_)}}function bs(u,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},_=[...fo];return wa(u,_),wa(i,_),{fragmentSource:u=u.replace(o,(j,S,C,D,I)=>(x[I]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${C} ${D} ${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = u_${I};
#endif
`)),vertexSource:i=i.replace(o,(j,S,C,D,I)=>{const O=D==="float"?"vec2":"vec4",Z=I.match(/color/)?"color":O;return x[I]?S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${C} ${O} a_${I};
varying ${C} ${D} ${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${Z}(a_${I}, u_${I}_t);
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${C} ${O} a_${I};
#else
uniform ${C} ${D} u_${I};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = a_${I};
#else
    ${C} ${D} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${C} ${D} ${I} = unpack_mix_${Z}(a_${I}, u_${I}_t);
#else
    ${C} ${D} ${I} = u_${I};
#endif
`}),staticAttributes:m,usedDefines:_}}class bm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,m,x,_,j,S){this.context=i;let C=this.boundPaintVertexBuffers.length!==x.length;for(let I=0;!C&&I<x.length;I++)this.boundPaintVertexBuffers[I]!==x[I]&&(C=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let I=0;!D&&I<S.length;I++)this.boundDynamicVertexBuffers[I]!==S[I]&&(D=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==m||C||D||this.boundIndexBuffer!==_||this.boundVertexOffset!==j)this.freshBind(o,m,x,_,j,S);else{i.bindVertexArrayOES.set(this.vao);for(const I of S)I&&I.bind();_&&_.dynamicDraw&&_.bind()}}freshBind(i,o,m,x,_,j){let S;const C=i.numAttributes,D=this.context,I=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=j;else{S=D.currentNumAttributes||0;for(let O=C;O<S;O++)I.disableVertexAttribArray(O)}o.enableAttributes(I,i),o.bind(),o.setVertexAttribPointers(I,i,_);for(const O of m)O.enableAttributes(I,i),O.bind(),O.setVertexAttribPointers(I,i,_);for(const O of j)O&&(O.enableAttributes(I,i),O.bind(),O.setVertexAttribPointers(I,i,_));x&&x.bind(),D.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Tc(u,i){const o=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new n.MercatorCoordinate(0,m/o).toLngLat().lat,new n.MercatorCoordinate(0,(m+1)/o).toLngLat().lat]}function fu(u,i,o,m,x,_,j){const S=u.context,C=S.gl,D=o.fbo;if(!D)return;u.prepareDrawTile();const I=u.useProgram("hillshade");S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get());const O=((Y,se,F,K)=>{const ae=F.paint.get("hillshade-shadow-color"),le=F.paint.get("hillshade-highlight-color"),_e=F.paint.get("hillshade-accent-color");let ve=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=Y.transform.angle);const be=!Y.options.moving;return{u_matrix:K||Y.transform.calculateProjMatrix(se.tileID.toUnwrapped(),be),u_image:0,u_latrange:Tc(0,se.tileID),u_light:[F.paint.get("hillshade-exaggeration"),ve],u_shadow:ae,u_highlight:le,u_accent:_e}})(u,o,m,u.terrain?i.projMatrix:null);u.prepareDrawProgram(S,I,i.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:Q,tileBoundsSegments:ee}=u.getTileBoundsBuffers(o);I.draw(S,C.TRIANGLES,x,_,j,n.CullFaceMode.disabled,O,m.id,Z,Q,ee)}function Ec(u,i,o){if(!i.needsDEMTextureUpload)return;const m=u.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||u.getTileTexture(o.stride);const _=o.getPixels();i.demTexture?i.demTexture.update(_,{premultiply:!1}):i.demTexture=new n.Texture(m,_,x.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function gu(u,i,o,m,x,_){const j=u.context,S=j.gl;if(!i.dem)return;const C=i.dem;if(j.activeTexture.set(S.TEXTURE1),Ec(u,i,C),!i.demTexture)return;i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const D=C.dim;j.activeTexture.set(S.TEXTURE0);let I=i.fbo;if(!I){const ee=new n.Texture(j,{width:D,height:D,data:null},S.RGBA);ee.bind(S.LINEAR,S.CLAMP_TO_EDGE),I=i.fbo=j.createFramebuffer(D,D,!0),I.colorAttachment.set(ee.texture)}j.bindFramebuffer.set(I.framebuffer),j.viewport.set([0,0,D,D]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:Z,tileBoundsSegments:Q}=u.getMercatorTileBoundsBuffers();u.useProgram("hillshadePrepare").draw(j,S.TRIANGLES,m,x,_,n.CullFaceMode.disabled,((ee,Y)=>{const se=Y.stride,F=n.create();return n.ortho(F,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(F,F,[0,-n.EXTENT,0]),{u_matrix:F,u_image:1,u_dimension:[se,se],u_zoom:ee.overscaledZ,u_unpack:Y.unpackVector}})(i.tileID,C),o.id,O,Z,Q),i.needsHillshadePrepare=!1}const Cc=u=>({u_matrix:new n.UniformMatrix4f(u),u_image0:new n.Uniform1i(u),u_skirt_height:new n.Uniform1f(u)}),ja=(u,i)=>({u_matrix:u,u_image0:0,u_skirt_height:i}),al=(u,i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:o,u_zoom_transition:x,u_merc_center:_,u_image0:0,u_frustum_tl:j,u_frustum_tr:S,u_frustum_br:C,u_frustum_bl:D,u_globe_pos:I,u_globe_radius:O,u_viewport:Z,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:Q});function Na(u,i){return u!=null&&i!=null&&!(!u.hasData()||!i.hasData())&&u.demTexture!=null&&i.demTexture!=null&&u.tileID.key!==i.tileID.key}const hn=new class{constructor(){this.operations={}}newMorphing(u,i,o,m,x){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==o.tileID.key&&(_.queued=o)}else this.operations[u]={startTime:m,phase:0,duration:x,from:i,to:o,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const i=this.operations[u];return{from:i.from,to:i.to,phase:i.phase}}update(u){for(const i in this.operations){const o=this.operations[i];for(o.phase=(u-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,u)){delete this.operations[i];break}}}_nextOp(u,i){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=i,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Jn={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ol(u){return 6*Math.pow(1.5,22-u)}function xu(u,i){const o=1<<u.z;return!i&&(u.x===0||u.x===o-1)||u.y===0||u.y===o-1}const go=u=>({u_matrix:u});function kc(u,i,o,m,x){if(x>0){const _=n.exported.now(),j=(_-u.timeAdded)/x,S=i?(_-i.timeAdded)/x:-1,C=o.getSource(),D=m.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),I=!i||Math.abs(i.tileID.overscaledZ-D)>Math.abs(u.tileID.overscaledZ-D),O=I&&u.refreshedUponExpiration?1:n.clamp(I?j:1-S,0,1);return u.refreshedUponExpiration&&j>=1&&(u.refreshedUponExpiration=!1),i?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class Ac extends n.SourceCache{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new ts(xa(),null),x=Yt("mock-dem",o,m,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class ll extends n.SourceCache{constructor(i){const o=Yt("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new ts(xa(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,m){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,j)=>{if(_[j.key]="",!this._tiles[j.key]){const S=new n.Tile(j,this._source.tileSize*j.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[j.key]=S}return _},{});for(const _ in this._tiles)_ in x||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const m=Object.values(o);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cl extends n.OverscaledTileID{constructor(i,o,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=m}}class Mc extends n.Elevation{constructor(i,o){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,_]=function(C){const D=new n.StructArrayLayout2i4,I=new n.StructArrayLayout3ui6,O=131;D.reserve(17161),I.reserve(33800);const Z=n.EXTENT/128,Q=n.EXTENT+Z/2,ee=Q+Z;for(let se=-Z;se<ee;se+=Z)for(let F=-Z;F<ee;F+=Z){const K=F<0||F>Q||se<0||se>Q?24575:0,ae=n.clamp(Math.round(F),0,n.EXTENT),le=n.clamp(Math.round(se),0,n.EXTENT);D.emplaceBack(ae+K,le)}const Y=(se,F)=>{const K=F*O+se;I.emplaceBack(K+1,K,K+O),I.emplaceBack(K+O,K+O+1,K+1)};for(let se=1;se<129;se++)for(let F=1;F<129;F++)Y(F,se);return[0,129].forEach(se=>{for(let F=0;F<130;F++)Y(F,se),Y(se,F)}),[D,I,32768]}(),j=i.context;this.gridBuffer=j.createVertexBuffer(m,n.posAttributes.members),this.gridIndexBuffer=j.createIndexBuffer(x),this.gridSegments=n.SegmentVector.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=n.SegmentVector.simpleSegment(0,0,m.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ll(o.map),this.orthoMatrix=n.create(),n.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.EXTENT,0,n.EXTENT,0,1);const S=j.gl;this._overlapStencilMode=new n.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ac(o.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,m){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const x=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const _=()=>{this.sourceCache.used&&n.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(o,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),o.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&n.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=o.getIds().map(C=>{const D=o.getTileByID(C).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(C,D){const I=D.transform.pointCoordinate(D.transform.getCameraPoint()),O=new n.Point(I.x,I.y);C.sort((Z,Q)=>{if(Q.overscaledZ-Z.overscaledZ)return Q.overscaledZ-Z.overscaledZ;const ee=new n.Point(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),Y=new n.Point(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),se=O.mult(1<<Z.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(ee)-se.distSqr(Y)})})(x,this.painter),this._previousZoom=m.zoom;const _=this.proxyToSource||{};this.proxyToSource={},x.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const j=this._style._sourceCaches;for(const C in j){const D=j[C];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,i[C],_),D.usedForTerrain))continue;const I=i[C];D.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[o.id]=x.map(C=>new cl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=n.exported.now();const S={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const D=this.terrainTileForTile[C.key];if(!D)continue;const I=D.tileID.key;I in S||(this._visibleDemTiles.push(D),S[I]=I)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const m=this._findTileCoveringTileID(o,this.sourceCache);m&&(this.terrainTileForTile[o.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],_=x.dem;!_||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),Ec(this.painter,x,_))}}_prepareDemTileUniforms(i,o,m,x){if(!o||o.demTexture==null)return!1;const _=i.tileID.canonical,j=Math.pow(2,o.tileID.canonical.z-_.z),S=x||"";return m[`u_dem_tl${S}`]=[_.x*j%1,_.y*j%1],m[`u_dem_scale${S}`]=j,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,o=i.gl;if(!this._emptyDepthBufferTexture){const m=new n.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new n.Texture(i,m,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const o=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const _=x.dem.tree.minimums[0];return _>0&&i++,m+_},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new n.RGBAImage({width:1,height:1},new Uint8Array(n.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(x,{premultiply:!1}):_=this._emptyDEMTexture=new n.Texture(i,x,o.RGBA,{premultiply:!1}),_}setupElevationDraw(i,o,m){const x=this.painter.context,_=x.gl,j=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:n.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;j.u_dem_size=this.sourceCache.getSource().tileSize,j.u_exaggeration=this.exaggeration();let C=null,D=null,I=1;if(m&&m.morphing&&this._useVertexMorphing){const O=m.morphing.srcDemTile,Z=m.morphing.dstDemTile;I=m.morphing.phase,O&&Z&&(this._prepareDemTileUniforms(i,O,j,"_prev")&&(D=O),this._prepareDemTileUniforms(i,Z,j)&&(C=Z))}if(D&&C?(x.activeTexture.set(_.TEXTURE2),C.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),x.activeTexture.set(_.TEXTURE4),D.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),j.u_dem_lerp=I):(C=this.terrainTileForTile[i.tileID.key],x.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(i,C,j)?C.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),x.activeTexture.set(_.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(j.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),j.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&C){const O=(1<<C.tileID.canonical.z)*n.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;j.u_meter_to_dem=O}if(m&&m.labelPlaneMatrixInv&&(j.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),o.setTerrainUniformValues(x,j),this.painter.transform.projection.name==="globe"){const O=this.globeUniformValues(this.painter.transform,i.tileID.canonical,m&&m.useDenormalizedUpVectorScale);o.setGlobeUniformValues(x,O)}}globeUniformValues(i,o,m){const x=i.projection;return{u_tile_tl_up:x.upVector(o,0,0),u_tile_tr_up:x.upVector(o,n.EXTENT,0),u_tile_br_up:x.upVector(o,n.EXTENT,n.EXTENT),u_tile_bl_up:x.upVector(o,0,n.EXTENT),u_tile_up_scale:m?n.globeMetersToEcef(1):x.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,m=this.painter.context;i.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,_,j,S,C){if(x.transform.projection.name==="globe")(function(D,I,O,Z,Q){const ee=D.context,Y=ee.gl;let se,F;const K=D.options.showTerrainWireframe?2:0,ae=D.transform,le=n.globeUseCustomAntiAliasing(D,ee,ae),_e=(nt,ze)=>{if(F===nt)return;const Xe=[Jn[nt],"PROJECTION_GLOBE_VIEW"];le&&Xe.push("CUSTOM_ANTIALIASING"),ze&&Xe.push(Jn[K]),se=D.useProgram("globeRaster",null,Xe),F=nt},ve=D.colorModeForRenderPass(),be=new n.DepthMode(Y.LEQUAL,n.DepthMode.ReadWrite,D.depthRangeFor3D);hn.update(Q);const Ae=n.calculateGlobeMercatorMatrix(ae),Ce=[n.mercatorXfromLng(ae.center.lng),n.mercatorYfromLat(ae.center.lat)],Oe=K?[!1,!0]:[!1],at=D.globeSharedBuffers,Le=[ae.width*n.exported.devicePixelRatio,ae.height*n.exported.devicePixelRatio],Qe=Float32Array.from(ae.globeMatrix),Ue={useDenormalizedUpVectorScale:!0};if(Oe.forEach(nt=>{const ze=D.transform,Xe=ol(ze.zoom)*I.exaggeration();F=-1;const ct=nt?Y.LINES:Y.TRIANGLES;for(const tt of Z){const dt=O.getTile(tt),Dt=n.StencilMode.disabled,Vt=I.prevTerrainTileForTile[tt.key],kt=I.terrainTileForTile[tt.key];Na(Vt,kt)&&hn.newMorphing(tt.key,Vt,kt,Q,250),ee.activeTexture.set(Y.TEXTURE0),dt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const Ft=hn.getMorphValuesForProxy(tt.key),ns=Ft?1:0;Ft&&n.extend$1(Ue,{morphing:{srcDemTile:Ft.from,dstDemTile:Ft.to,phase:n.easeCubicInOut(Ft.phase)}});const es=n.tileCornersToBounds(tt.canonical),It=n.getLatitudinalLod(es.getCenter().lat),ws=n.getGridMatrix(tt.canonical,es,It,ze.worldSize/ze._pixelsPerMercatorPixel),Ss=n.globeNormalizeECEF(n.globeTileBounds(tt.canonical)),Ts=al(ze.projMatrix,Qe,Ae,Ss,n.globeToMercatorTransition(ze.zoom),Ce,ze.frustumCorners.TL,ze.frustumCorners.TR,ze.frustumCorners.BR,ze.frustumCorners.BL,ze.globeCenterInViewSpace,ze.globeRadius,Le,Xe,ws);if(_e(ns,nt),I.setupElevationDraw(dt,se,Ue),D.prepareDrawProgram(ee,se,tt.toUnwrapped()),at){const[Es,Wr,Pr]=nt?at.getWirefameBuffers(D.context,It):at.getGridBuffers(It,Xe!==0);se.draw(ee,ct,be,Dt,ve,n.CullFaceMode.backCCW,Ts,"globe_raster",Es,Wr,Pr)}}}),at){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];le&&nt.push("CUSTOM_ANTIALIASING"),se=D.useProgram("globeRaster",null,nt);for(const ze of Z){const{x:Xe,y:ct,z:tt}=ze.canonical,dt=ct===0,Dt=ct===(1<<tt)-1,[Vt,kt,Ft,ns]=at.getPoleBuffers(tt);if(ns&&(dt||Dt)){const es=O.getTile(ze);ee.activeTexture.set(Y.TEXTURE0),es.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let It=n.globePoleMatrixForTile(tt,Xe,ae);const ws=n.globeNormalizeECEF(n.globeTileBounds(ze.canonical)),Ss=(Ts,Es)=>Ts.draw(ee,Y.TRIANGLES,be,n.StencilMode.disabled,ve,n.CullFaceMode.disabled,al(ae.projMatrix,It,It,ws,0,Ce,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,Le,0),"globe_pole_raster",Es,Ft,ns);I.setupElevationDraw(es,se,Ue),D.prepareDrawProgram(ee,se,ze.toUnwrapped()),dt&&Ss(se,Vt),Dt&&(It=n.scale(n.create(),It,[1,-1,1]),Ss(se,kt))}}}})(x,_,j,S,C);else{const D=x.context,I=D.gl;let O,Z;const Q=x.options.showTerrainWireframe?2:0,ee=(ae,le)=>{if(Z===ae)return;const _e=[Jn[ae]];le&&_e.push(Jn[Q]),O=x.useProgram("terrainRaster",null,_e),Z=ae},Y=x.colorModeForRenderPass(),se=new n.DepthMode(I.LEQUAL,n.DepthMode.ReadWrite,x.depthRangeFor3D);hn.update(C);const F=x.transform,K=ol(F.zoom)*_.exaggeration();(Q?[!1,!0]:[!1]).forEach(ae=>{Z=-1;const le=ae?I.LINES:I.TRIANGLES,[_e,ve]=ae?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const be of S){const Ae=j.getTile(be),Ce=n.StencilMode.disabled,Oe=_.prevTerrainTileForTile[be.key],at=_.terrainTileForTile[be.key];Na(Oe,at)&&hn.newMorphing(be.key,Oe,at,C,250),D.activeTexture.set(I.TEXTURE0),Ae.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const Le=hn.getMorphValuesForProxy(be.key),Qe=Le?1:0;let Ue;Le&&(Ue={morphing:{srcDemTile:Le.from,dstDemTile:Le.to,phase:n.easeCubicInOut(Le.phase)}});const nt=ja(be.projMatrix,xu(be.canonical,F.renderWorldCopies)?K/10:K);ee(Qe,ae),_.setupElevationDraw(Ae,O,Ue),x.prepareDrawProgram(D,O,be.toUnwrapped()),O.draw(D,le,se,Ce,Y,n.CullFaceMode.backCCW,nt,"terrain_raster",_.gridBuffer,_e,ve)}})}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,m=this.painter.context,x=this.proxySourceCache,_=this.proxiedCoords[x.id],j=this._drapedRenderBatches.shift(),S=[],C=o.style.order;let D=0;for(const I of _){const O=x.getTileByID(I.proxyTileKey),Z=x.proxyCachedFBO[I.key]?x.proxyCachedFBO[I.key][i]:void 0,Q=Z!==void 0?x.renderCache[Z]:this.pool[D++],ee=Z!==void 0;if(O.texture=Q.tex,ee&&!Q.dirty){S.push(O.tileID);continue}let Y;m.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(m.clear({color:n.Color.transparent,stencil:0}),Q.dirty=!1);for(let se=j.start;se<=j.end;++se){const F=o.style._layers[C[se]];if(F.isHidden(o.transform.zoom))continue;const K=o.style._getLayerSourceCache(F),ae=K?this.proxyToSource[I.key][K.id]:[I];if(!ae)continue;const le=ae;m.viewport.set([0,0,Q.fb.width,Q.fb.height]),Y!==(K?K.id:null)&&(this._setupStencil(Q,ae,F,K),Y=K?K.id:null),o.renderLayer(o,K,F,le)}this.renderedToTile?(Q.dirty=!0,S.push(O.tileID)):ee||--D,D===5&&(D=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,o.width,o.height]),j.end+1}postRender(){}renderCacheEfficiency(i){const o=i.order.length;if(o===0)return{efficiency:100};let m,x=0,_=0,j=!1;for(let S=0;S<o;++S){const C=i._layers[i.order[S]];this._style.isLayerDraped(C)?(j&&++x,++_):j||(j=!0,m=C.id)}return _===0?{efficiency:100}:{efficiency:100*(1-x/_),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const j=_.tileID,S=1<<j.overscaledZ,{x:C,y:D}=j.canonical,I=C/S,O=(C+1)/S,Z=D/S,Q=(D+1)/S;return{minx:I,miny:Z,maxx:O,maxy:Q,t:_.dem.tree.raycastRoot(I,Z,O,Q,i,o,m),tile:_}});x.sort((_,j)=>(_.t!==null?_.t:Number.MAX_VALUE)-(j.t!==null?j.t:Number.MAX_VALUE));for(const _ of x){if(_.t==null)return null;const j=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,i,o,m);if(j!=null)return j}return null}_createFBO(){const i=this.painter.context,o=i.gl,m=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const x=new n.Texture(i,{width:m[0],height:m[1],data:null},o.RGBA);x.bind(o.LINEAR,o.CLAMP_TO_EDGE);const _=i.createFramebuffer(m[0],m[1],!1);return _.colorAttachment.set(x.texture),_.depthAttachment=new Te(i,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:_,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._layers[i],m=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!m&&o.shouldRedrape():!m&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const m of this._style._getSources())if(m instanceof _t){i=!0;break}if(!i)return;const o={};for(let m=0;m<this._style.order.length;++m){const x=this._style._layers[this._style.order[m]],_=this._style._getLayerSourceCache(x);if(_&&!o[_.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof n.ZoomDependentExpression){o[_.id]=!0;for(const j of this.proxyCoords){const S=this.proxyToSource[j.key][_.id];if(S)for(const C of S)this._clearRenderCacheForTile(_.id,C)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof ut){i=!0;break}if(!i)return;const o={};for(let m=0;m<this._style.order.length;++m){const x=this._style._layers[this._style.order[m]],_=this._style._getLayerSourceCache(x);if(!_||o[_.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const j=x.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][_.id];if(C)for(const D of C){const I=kc(_.getTile(D),_.findLoadedParent(D,0),_,this.painter.transform,j);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(_.id,D)}}}}_setupDrapedRenderBatches(){const i=this._style.order,o=i.length;if(o===0)return;const m=[];let x,_=0,j=this._style._layers[i[_]];for(;!this._style.isLayerDraped(j)&&j.isHidden(this.painter.transform.zoom)&&++_<o;)j=this._style._layers[i[_]];for(;_<o;++_){const S=this._style._layers[i[_]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?x===void 0&&(x=_):x!==void 0&&(m.push({start:x,end:_-1}),x=void 0))}x!==void 0&&m.push({start:x,end:_-1}),this._drapedRenderBatches=m}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const j=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<j.length;++S){const C=Object.values(j[S]);o.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let j=m.length-1;j>=0;j--){const S=m[j];if(o.getTileByID(S.key),o.proxyCachedFBO[S.key]!==void 0){const C=i[S.key],D=this.proxyToSource[S.key];let I=0;for(const O in D){const Z=D[O],Q=C[O];if(!Q||Q.length!==Z.length||Z.some((ee,Y)=>ee!==Q[Y]||x[O]&&x[O].hasOwnProperty(ee.key))){I=-1;break}++I}for(const O in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][O]].dirty=I<0||I!==Object.values(C).length}}const _=[...this._drapedRenderBatches];_.sort((j,S)=>S.end-S.start-(j.end-j.start));for(const j of _)for(const S of m){if(o.proxyCachedFBO[S.key])continue;let C=o.renderCachePool.pop();C===void 0&&o.renderCache.length<50&&(C=o.renderCache.length,o.renderCache.push(this._createFBO())),C!==void 0&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][j.start]=C,o.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,j=_.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(m.isTileClipped())S=o.length,this._overlapStencilMode.test={func:j.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:j.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):n.StencilMode.disabled}_renderTileClippingMasks(i,o){const m=this.painter,x=this.painter.context,_=x.gl;m._tileClippingMaskIDs={},x.setColorMode(n.ColorMode.disabled),x.setDepthMode(n.DepthMode.disabled);const j=m.useProgram("clippingMask");for(const S of i){const C=m._tileClippingMaskIDs[S.key]=--o;j.draw(x,_.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,go(S.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const m=[i.x,i.y,1,1];n.transformMat4$1(m,m,o.pixelMatrixInverse),n.scale$1(m,m,1/m[3]),m[0]/=o.worldSize,m[1]/=o.worldSize;const x=o._camera.position,_=n.mercatorZfromAltitude(1,o.center.lat),j=[x[0],x[1],x[2]/_,0],S=n.subtract([],m.slice(0,3),j);n.normalize(S,S);const C=this.raycast(j,S,this._exaggeration);return C!==null&&C?(n.scaleAndAdd(j,j,S,C),j[3]=j[2],j[2]*=_,j):null}drawDepth(){const i=this.painter,o=i.context,m=this.proxySourceCache,x=Math.ceil(i.width),_=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const j=o.gl,S=o.createFramebuffer(x,_,!0);o.activeTexture.set(j.TEXTURE0);const C=new n.Texture(o,{width:x,height:_,data:null},j.RGBA);C.bind(j.NEAREST,j.CLAMP_TO_EDGE),S.colorAttachment.set(C.texture);const D=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,x,_);S.depthAttachment.set(D),this._depthFBO=S,this._depthTexture=C}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,x,_]),function(j,S,C,D){if(j.transform.projection.name==="globe")return;const I=j.context,O=I.gl;I.clear({depth:1});const Z=j.useProgram("terrainDepth"),Q=new n.DepthMode(O.LESS,n.DepthMode.ReadWrite,j.depthRangeFor3D);for(const ee of D){const Y=C.getTile(ee),se=ja(ee.projMatrix,0);S.setupElevationDraw(Y,Z),Z.draw(I,O.TRIANGLES,Q,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.backCCW,se,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,o,m){if(i.getSource()instanceof Jt)return this._setupProxiedCoordsForImageSource(i,o,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],_=this.proxyCoords;for(let S=0;S<_.length;S++){const C=_[S],D=this._findTileCoveringTileID(C,i);if(D){const I=this._createProxiedId(C,D,m[C.key]&&m[C.key][i.id]);x.push(I),this.proxyToSource[C.key][i.id]=[I]}}let j=!1;for(let S=0;S<o.length;S++){const C=i.getTile(o[S]);if(!C||!C.hasData())continue;const D=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==C.tileID.canonical.z){const I=this.proxyToSource[D.tileID.key][i.id],O=this._createProxiedId(D.tileID,C,m[D.tileID.key]&&m[D.tileID.key][i.id]);I?I.splice(I.length-1,0,O):this.proxyToSource[D.tileID.key][i.id]=[O],x.push(O),j=!0}}this._sourceTilesOverlap[i.id]=j}_setupProxiedCoordsForImageSource(i,o,m){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],_=this.proxyCoords,j=i.getSource(),S=new n.Point(j.tileID.x,j.tileID.y)._div(1<<j.tileID.z),C=j.coordinates.map(n.MercatorCoordinate.fromLngLat).reduce((I,O)=>(I.min.x=Math.min(I.min.x,O.x-S.x),I.min.y=Math.min(I.min.y,O.y-S.y),I.max.x=Math.max(I.max.x,O.x-S.x),I.max.y=Math.max(I.max.y,O.y-S.y),I),{min:new n.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(I,O)=>{const Z=I.wrap+I.canonical.x/(1<<I.canonical.z),Q=I.canonical.y/(1<<I.canonical.z),ee=n.EXTENT/(1<<I.canonical.z),Y=O.wrap+O.canonical.x/(1<<O.canonical.z),se=O.canonical.y/(1<<O.canonical.z);return Z+ee<Y+C.min.x||Z>Y+C.max.x||Q+ee<se+C.min.y||Q>se+C.max.y};for(let I=0;I<_.length;I++){const O=_[I];for(let Z=0;Z<o.length;Z++){const Q=i.getTile(o[Z]);if(!Q||!Q.hasData()||D(O,Q.tileID))continue;const ee=this._createProxiedId(O,Q,m[O.key]&&m[O.key][i.id]),Y=this.proxyToSource[O.key][i.id];Y?Y.push(ee):this.proxyToSource[O.key][i.id]=[ee],x.push(ee)}}}_createProxiedId(i,o,m){let x=this.orthoMatrix;if(m){const _=m.find(j=>j.key===o.tileID.key);if(_)return _}if(o.tileID.key!==i.key){const _=i.canonical.z-o.tileID.canonical.z;let j,S,C;x=n.create();const D=o.tileID.wrap-i.wrap<<i.overscaledZ;_>0?(j=n.EXTENT>>_,S=j*((o.tileID.canonical.x<<_)-i.canonical.x+D),C=j*((o.tileID.canonical.y<<_)-i.canonical.y)):(j=n.EXTENT<<-_,S=n.EXTENT*(o.tileID.canonical.x-(i.canonical.x+D<<-_)),C=n.EXTENT*(o.tileID.canonical.y-(i.canonical.y<<-_))),n.ortho(x,0,j,0,j,0,1),n.translate(x,x,[S,C,0])}return new cl(o.tileID,i.key,x)}_findTileCoveringTileID(i,o){let m=o.getTile(i);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[o.id],_=x[i.key];if(m=_?o.getTileByID(_):null,m&&m.hasData()||_===null)return m;let j=m?m.tileID:i,S=j.overscaledZ;const C=o.getSource().minzoom,D=[];if(!_){const O=o.getSource().maxzoom;if(i.canonical.z>=O){const Z=i.canonical.z-O;o.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,o.transform.tileZoom),j=new n.OverscaledTileID(S,i.wrap,O,i.canonical.x>>Z,i.canonical.y>>Z)):Z!==0&&(S=O,j=new n.OverscaledTileID(S,i.wrap,O,i.canonical.x>>Z,i.canonical.y>>Z))}j.key!==i.key&&(D.push(j.key),m=o.getTile(j))}const I=O=>{D.forEach(Z=>{x[Z]=O}),D.length=0};for(S-=1;S>=C&&(!m||!m.hasData());S--){m&&I(m.tileID.key);const O=j.calculateScaledKey(S);if(m=o.getTileByID(O),m&&m.hasData())break;const Z=x[O];if(Z===null)break;Z===void 0?D.push(O):m=o.getTileByID(Z)}return I(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(o){let m=0;const x=new n.StructArrayLayout2ui4,_=131;for(let j=1;j<129;j++){for(let S=1;S<129;S++)m=j*_+S,x.emplaceBack(m,m+1),x.emplaceBack(m,m+_),x.emplaceBack(m+1,m+_),j===128&&x.emplaceBack(m+_,m+_+1);x.emplaceBack(m+1,m+1+_)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=n.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ms{static cacheKey(i,o,m,x){let _=`${o}${x?x.cacheKey:""}`;for(const j of m)i.usedDefines.includes(j)&&(_+=`/${j}`);return _}constructor(i,o,m,x,_,j){const S=i.gl;this.program=S.createProgram();const C=function(F){const K=[];for(let ae=0;ae<F.length;ae++){if(F[ae]===null)continue;const le=F[ae].split(" ");K.push(le.pop())}return K}(m.staticAttributes),D=x?x.getBinderAttributes():[],I=C.concat(D);let O=x?x.defines():[];O=O.concat(j.map(F=>`#define ${F}`));const Z=i.isWebGL2?`#version 300 es
`:"",Q=Z+O.concat(i.extStandardDerivatives&&Z.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Nc):Nc,Nc,nl,pu.fragmentSource,va.fragmentSource,m.fragmentSource).join(`
`),ee=Z+O.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,nl,pu.vertexSource,va.vertexSource,il.vertexSource,m.vertexSource).join(`
`),Y=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(Y,Q),S.compileShader(Y),S.attachShader(this.program,Y);const se=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(se,ee),S.compileShader(se),S.attachShader(this.program,se),this.attributes={},this.numAttributes=I.length;for(let F=0;F<this.numAttributes;F++)I[F]&&(S.bindAttribLocation(this.program,F,I[F]),this.attributes[I[F]]=F);S.linkProgram(this.program),S.deleteShader(se),S.deleteShader(Y),this.fixedUniforms=_(i),this.binderUniforms=x?x.getUniforms(i):[],j.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new n.Uniform1i(F),u_dem_prev:new n.Uniform1i(F),u_dem_unpack:new n.Uniform4f(F),u_dem_tl:new n.Uniform2f(F),u_dem_scale:new n.Uniform1f(F),u_dem_tl_prev:new n.Uniform2f(F),u_dem_scale_prev:new n.Uniform1f(F),u_dem_size:new n.Uniform1f(F),u_dem_lerp:new n.Uniform1f(F),u_exaggeration:new n.Uniform1f(F),u_depth:new n.Uniform1i(F),u_depth_size_inv:new n.Uniform2f(F),u_meter_to_dem:new n.Uniform1f(F),u_label_plane_matrix_inv:new n.UniformMatrix4f(F)}))(i)),j.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new n.Uniform3f(F),u_tile_tr_up:new n.Uniform3f(F),u_tile_br_up:new n.Uniform3f(F),u_tile_bl_up:new n.Uniform3f(F),u_tile_up_scale:new n.Uniform1f(F)}))(i)),j.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new n.UniformMatrix4f(F),u_fog_range:new n.Uniform2f(F),u_fog_color:new n.Uniform4f(F),u_fog_horizon_blend:new n.Uniform1f(F),u_fog_temporal_offset:new n.Uniform1f(F),u_frustum_tl:new n.Uniform3f(F),u_frustum_tr:new n.Uniform3f(F),u_frustum_br:new n.Uniform3f(F),u_frustum_bl:new n.Uniform3f(F),u_globe_pos:new n.Uniform3f(F),u_globe_radius:new n.Uniform1f(F),u_globe_transition:new n.Uniform1f(F),u_is_globe:new n.Uniform1i(F),u_viewport:new n.Uniform2f(F)}))(i))}}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in o)m[x]&&m[x].set(this.program,x,o[x])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in o)m[x]&&m[x].set(this.program,x,o[x])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in o)m[x].set(this.program,x,o[x])}}draw(i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y){const se=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(x),i.setColorMode(_),i.setCullFace(j);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(this.program,K,S[K]);ee&&ee.setUniforms(this.program,i,this.binderUniforms,Z,{zoom:Q});const F={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[o];for(const K of O.get()){const ae=K.vaos||(K.vaos={});(ae[C]||(ae[C]=new bm)).bind(i,this,D,ee?ee.getPaintVertexBuffers():[],I,K.vertexOffset,Y||[]),se.drawElements(o,K.primitiveLength*F,se.UNSIGNED_SHORT,K.primitiveOffset*F*2)}}}function xo(u,i){const o=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,u.transform.tileZoom)/o,x=m*(i.tileID.canonical.x+i.tileID.wrap*o),_=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/Is(i,1,u.transform.tileZoom),u_pixel_coord_upper:[x>>16,_>>16],u_pixel_coord_lower:[65535&x,65535&_]}}const yu=n.create(),Pc=(u,i,o,m,x,_,j,S,C,D,I)=>{const O=i.style.light,Z=O.properties.get("position"),Q=[Z.x,Z.y,Z.z],ee=n.create$1();O.properties.get("anchor")==="viewport"&&(n.fromRotation(ee,-i.transform.angle),n.transformMat3(Q,Q,ee));const Y=O.properties.get("color"),se=i.transform,F={u_matrix:u,u_lightpos:Q,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+o,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:_};return se.projection.name==="globe"&&(F.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],F.u_zoom_transition=C,F.u_inv_rot_matrix=I,F.u_merc_center=D,F.u_up_dir=se.projection.upVector(new n.CanonicalTileID(0,0,0),D[0]*n.EXTENT,D[1]*n.EXTENT),F.u_height_lift=S),F},_u=(u,i,o,m,x,_,j,S,C,D,I,O)=>{const Z=Pc(u,i,o,m,x,_,j,C,D,I,O),Q={u_height_factor:-Math.pow(2,j.overscaledZ)/S.tileSize/8};return n.extend(Z,xo(i,S),Q)},Yn=u=>({u_matrix:u}),Ic=(u,i,o)=>n.extend(Yn(u),xo(i,o)),vm=(u,i)=>({u_matrix:u,u_world:i}),wm=(u,i,o,m)=>n.extend(Ic(u,i,o),{u_world:m}),jm=n.create(),Dc=(u,i,o,m,x,_)=>{const j=u.transform,S=j.projection.name==="globe";let C;if(_.paint.get("circle-pitch-alignment")==="map")if(S){const I=n.globePixelsToTileUnits(j.zoom,i.canonical)*j._pixelsPerMercatorPixel;C=Float32Array.from([I,0,0,I])}else C=j.calculatePixelsToTileUnitsMatrix(o);else C=new Float32Array([j.pixelsToGLUnits[0],0,0,j.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:j.cameraToCenterDistance,u_matrix:u.translatePosMatrix(i.projMatrix,o,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:n.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:jm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){D.u_inv_rot_matrix=m,D.u_merc_center=x,D.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],D.u_zoom_transition=n.globeToMercatorTransition(j.zoom);const I=x[0]*n.EXTENT,O=x[1]*n.EXTENT;D.u_up_dir=j.projection.upVector(new n.CanonicalTileID(0,0,0),I,O)}return D},Lc=u=>{const i=[];return u.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},Rc=(u,i,o,m)=>{const x=n.EXTENT/o.tileSize;return{u_matrix:u,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},dl=(u,i,o=1)=>({u_matrix:u,u_color:i,u_overlay:0,u_overlay_scale:o}),bu=n.create(),vu=(u,i,o,m,x,_,j)=>{const S=u.transform,C=S.projection.name==="globe",D=C?n.globePixelsToTileUnits(S.zoom,i.canonical)*S._pixelsPerMercatorPixel:Is(o,1,_),I={u_matrix:i.projMatrix,u_extrude_scale:D,u_intensity:j,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){I.u_inv_rot_matrix=m,I.u_merc_center=x,I.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],I.u_zoom_transition=n.globeToMercatorTransition(S.zoom);const O=x[0]*n.EXTENT,Z=x[1]*n.EXTENT;I.u_up_dir=S.projection.upVector(new n.CanonicalTileID(0,0,0),O,Z)}return I},Nm=(u,i,o,m,x,_,j)=>{const S=u.transform,C=S.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:zc(u,i,o,m),u_pixels_to_tile_units:C,u_device_pixel_ratio:_,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:_o(o)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Sa(i,u.transform),u_alpha_discard_threshold:0,u_trim_offset:j}},yo=(u,i,o,m,x)=>{const _=u.transform;return{u_matrix:zc(u,i,o,m),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Sa(i,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Sa(u,i){return 1/Is(u,1,i.tileZoom)}function zc(u,i,o,m){return u.translatePosMatrix(m||i.tileID.projMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function _o(u){const i=u.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const Oc=(u,i,o,m,x,_)=>{return{u_matrix:u,u_tl_parent:i,u_scale_parent:o,u_fade_t:m.mix,u_opacity:m.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(S=x.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(j=x.paint.get("raster-contrast"),j>0?1/(1-j):1+j),u_spin_weights:Zi(x.paint.get("raster-hue-rotate")),u_perspective_transform:_};var j,S};function Zi(u){u*=Math.PI/180;const i=Math.sin(u),o=Math.cos(u);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const ul=n.create(),Fc=(u,i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y)=>{const se=x.transform,F={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:se.width/se.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:j,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ul,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ul,u_up_vector:[0,-1,0]};return Y.name==="globe"&&(F.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],F.u_zoom_transition=O,F.u_inv_rot_matrix=Q,F.u_merc_center=Z,F.u_camera_forward=se._camera.forward(),F.u_ecef_origin=n.globeECEFOrigin(se.globeMatrix,I.toUnwrapped()),F.u_tile_matrix=Float32Array.from(se.globeMatrix),F.u_up_vector=ee),F},hl=(u,i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y,se)=>n.extend(Fc(u,i,o,m,x,_,j,S,C,D,O,Z,Q,ee,Y,se),{u_gamma_scale:m?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:n.exported.devicePixelRatio,u_is_halo:+I}),wu=(u,i,o,m,x,_,j,S,C,D,I,O,Z,Q,ee,Y)=>n.extend(hl(u,i,o,m,x,_,j,S,!0,C,!0,I,O,Z,Q,ee,Y),{u_texsize_icon:D,u_texture_icon:1}),Bc=(u,i,o)=>({u_matrix:u,u_opacity:i,u_color:o}),Sm=(u,i,o,m,x)=>n.extend(function(_,j,S){const C=j.imageManager.getPattern(_.toString()),{width:D,height:I}=j.imageManager.getPixelSize(),O=Math.pow(2,S.tileID.overscaledZ),Z=S.tileSize*Math.pow(2,j.transform.tileZoom)/O,Q=Z*(S.tileID.canonical.x+S.tileID.wrap*O),ee=Z*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:C.tl,u_pattern_br:C.br,u_texsize:[D,I],u_pattern_size:C.displaySize,u_tile_units_to_pixels:1/Is(S,1,j.transform.tileZoom),u_pixel_coord_upper:[Q>>16,ee>>16],u_pixel_coord_lower:[65535&Q,65535&ee]}}(m,o,x),{u_matrix:u,u_opacity:i}),Uc={fillExtrusion:u=>({u_matrix:new n.UniformMatrix4f(u),u_lightpos:new n.Uniform3f(u),u_lightintensity:new n.Uniform1f(u),u_lightcolor:new n.Uniform3f(u),u_vertical_gradient:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_edge_radius:new n.Uniform1f(u),u_ao:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_up_dir:new n.Uniform3f(u),u_height_lift:new n.Uniform1f(u)}),fillExtrusionPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_lightpos:new n.Uniform3f(u),u_lightintensity:new n.Uniform1f(u),u_lightcolor:new n.Uniform3f(u),u_vertical_gradient:new n.Uniform1f(u),u_height_factor:new n.Uniform1f(u),u_edge_radius:new n.Uniform1f(u),u_ao:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_up_dir:new n.Uniform3f(u),u_height_lift:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u)}),fill:u=>({u_matrix:new n.UniformMatrix4f(u)}),fillPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),fillOutline:u=>({u_matrix:new n.UniformMatrix4f(u),u_world:new n.Uniform2f(u)}),fillOutlinePattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_world:new n.Uniform2f(u),u_image:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),circle:u=>({u_camera_to_center_distance:new n.Uniform1f(u),u_extrude_scale:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_up_dir:new n.Uniform3f(u)}),collisionBox:u=>({u_matrix:new n.UniformMatrix4f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_extrude_scale:new n.Uniform2f(u)}),collisionCircle:u=>({u_matrix:new n.UniformMatrix4f(u),u_inv_matrix:new n.UniformMatrix4f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_viewport_size:new n.Uniform2f(u)}),debug:u=>({u_color:new n.UniformColor(u),u_matrix:new n.UniformMatrix4f(u),u_overlay:new n.Uniform1i(u),u_overlay_scale:new n.Uniform1f(u)}),clippingMask:u=>({u_matrix:new n.UniformMatrix4f(u)}),heatmap:u=>({u_extrude_scale:new n.Uniform1f(u),u_intensity:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_up_dir:new n.Uniform3f(u)}),heatmapTexture:u=>({u_image:new n.Uniform1i(u),u_color_ramp:new n.Uniform1i(u),u_opacity:new n.Uniform1f(u)}),hillshade:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_latrange:new n.Uniform2f(u),u_light:new n.Uniform2f(u),u_shadow:new n.UniformColor(u),u_highlight:new n.UniformColor(u),u_accent:new n.UniformColor(u)}),hillshadePrepare:u=>({u_matrix:new n.UniformMatrix4f(u),u_image:new n.Uniform1i(u),u_dimension:new n.Uniform2f(u),u_zoom:new n.Uniform1f(u),u_unpack:new n.Uniform4f(u)}),line:u=>({u_matrix:new n.UniformMatrix4f(u),u_pixels_to_tile_units:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_units_to_pixels:new n.Uniform2f(u),u_dash_image:new n.Uniform1i(u),u_gradient_image:new n.Uniform1i(u),u_image_height:new n.Uniform1f(u),u_texsize:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_alpha_discard_threshold:new n.Uniform1f(u),u_trim_offset:new n.Uniform2f(u)}),linePattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_texsize:new n.Uniform2f(u),u_pixels_to_tile_units:new n.UniformMatrix2f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_units_to_pixels:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u),u_alpha_discard_threshold:new n.Uniform1f(u)}),raster:u=>({u_matrix:new n.UniformMatrix4f(u),u_tl_parent:new n.Uniform2f(u),u_scale_parent:new n.Uniform1f(u),u_fade_t:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_image0:new n.Uniform1i(u),u_image1:new n.Uniform1i(u),u_brightness_low:new n.Uniform1f(u),u_brightness_high:new n.Uniform1f(u),u_saturation_factor:new n.Uniform1f(u),u_contrast_factor:new n.Uniform1f(u),u_spin_weights:new n.Uniform3f(u),u_perspective_transform:new n.Uniform2f(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_camera_forward:new n.Uniform3f(u),u_tile_matrix:new n.UniformMatrix4f(u),u_up_vector:new n.Uniform3f(u),u_ecef_origin:new n.Uniform3f(u),u_texture:new n.Uniform1i(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_texture:new n.Uniform1i(u),u_gamma_scale:new n.Uniform1f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_tile_id:new n.Uniform3f(u),u_zoom_transition:new n.Uniform1f(u),u_inv_rot_matrix:new n.UniformMatrix4f(u),u_merc_center:new n.Uniform2f(u),u_camera_forward:new n.Uniform3f(u),u_tile_matrix:new n.UniformMatrix4f(u),u_up_vector:new n.Uniform3f(u),u_ecef_origin:new n.Uniform3f(u),u_is_halo:new n.Uniform1i(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new n.Uniform1i(u),u_is_size_feature_constant:new n.Uniform1i(u),u_size_t:new n.Uniform1f(u),u_size:new n.Uniform1f(u),u_camera_to_center_distance:new n.Uniform1f(u),u_rotate_symbol:new n.Uniform1i(u),u_aspect_ratio:new n.Uniform1f(u),u_fade_change:new n.Uniform1f(u),u_matrix:new n.UniformMatrix4f(u),u_label_plane_matrix:new n.UniformMatrix4f(u),u_coord_matrix:new n.UniformMatrix4f(u),u_is_text:new n.Uniform1i(u),u_pitch_with_map:new n.Uniform1i(u),u_texsize:new n.Uniform2f(u),u_texsize_icon:new n.Uniform2f(u),u_texture:new n.Uniform1i(u),u_texture_icon:new n.Uniform1i(u),u_gamma_scale:new n.Uniform1f(u),u_device_pixel_ratio:new n.Uniform1f(u),u_is_halo:new n.Uniform1i(u)}),background:u=>({u_matrix:new n.UniformMatrix4f(u),u_opacity:new n.Uniform1f(u),u_color:new n.UniformColor(u)}),backgroundPattern:u=>({u_matrix:new n.UniformMatrix4f(u),u_opacity:new n.Uniform1f(u),u_image:new n.Uniform1i(u),u_pattern_tl:new n.Uniform2f(u),u_pattern_br:new n.Uniform2f(u),u_texsize:new n.Uniform2f(u),u_pattern_size:new n.Uniform2f(u),u_pixel_coord_upper:new n.Uniform2f(u),u_pixel_coord_lower:new n.Uniform2f(u),u_tile_units_to_pixels:new n.Uniform1f(u)}),terrainRaster:Cc,terrainDepth:Cc,skybox:u=>({u_matrix:new n.UniformMatrix4f(u),u_sun_direction:new n.Uniform3f(u),u_cubemap:new n.Uniform1i(u),u_opacity:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u)}),skyboxGradient:u=>({u_matrix:new n.UniformMatrix4f(u),u_color_ramp:new n.Uniform1i(u),u_center_direction:new n.Uniform3f(u),u_radius:new n.Uniform1f(u),u_opacity:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u)}),skyboxCapture:u=>({u_matrix_3f:new n.UniformMatrix3f(u),u_sun_direction:new n.Uniform3f(u),u_sun_intensity:new n.Uniform1f(u),u_color_tint_r:new n.Uniform4f(u),u_color_tint_m:new n.Uniform4f(u),u_luminance:new n.Uniform1f(u)}),globeRaster:u=>({u_proj_matrix:new n.UniformMatrix4f(u),u_globe_matrix:new n.UniformMatrix4f(u),u_normalize_matrix:new n.UniformMatrix4f(u),u_merc_matrix:new n.UniformMatrix4f(u),u_zoom_transition:new n.Uniform1f(u),u_merc_center:new n.Uniform2f(u),u_image0:new n.Uniform1i(u),u_grid_matrix:new n.UniformMatrix3f(u),u_skirt_height:new n.Uniform1f(u),u_frustum_tl:new n.Uniform3f(u),u_frustum_tr:new n.Uniform3f(u),u_frustum_br:new n.Uniform3f(u),u_frustum_bl:new n.Uniform3f(u),u_globe_pos:new n.Uniform3f(u),u_globe_radius:new n.Uniform1f(u),u_viewport:new n.Uniform2f(u)}),globeAtmosphere:u=>({u_frustum_tl:new n.Uniform3f(u),u_frustum_tr:new n.Uniform3f(u),u_frustum_br:new n.Uniform3f(u),u_frustum_bl:new n.Uniform3f(u),u_horizon:new n.Uniform1f(u),u_transition:new n.Uniform1f(u),u_fadeout_range:new n.Uniform1f(u),u_color:new n.Uniform4f(u),u_high_color:new n.Uniform4f(u),u_space_color:new n.Uniform4f(u),u_star_intensity:new n.Uniform1f(u),u_star_density:new n.Uniform1f(u),u_star_size:new n.Uniform1f(u),u_temporal_offset:new n.Uniform1f(u),u_horizon_angle:new n.Uniform1f(u),u_rotation_matrix:new n.UniformMatrix4f(u)})};let ml;function bo(u,i,o,m,x,_,j){const S=u.context,C=S.gl,D=u.transform,I=u.useProgram("collisionBox"),O=[];let Z=0,Q=0;for(let le=0;le<m.length;le++){const _e=m[le],ve=i.getTile(_e),be=ve.getBucket(o);if(!be)continue;const Ae=ji(_e,be,D);let Ce=Ae;x[0]===0&&x[1]===0||(Ce=u.translatePosMatrix(Ae,ve,x,_));const Oe=j?be.textCollisionBox:be.iconCollisionBox,at=be.collisionCircleArray;if(at.length>0){const Le=n.create(),Qe=Ce;n.mul(Le,be.placementInvProjMatrix,D.glCoordMatrix),n.mul(Le,Le,be.placementViewportMatrix),O.push({circleArray:at,circleOffset:Q,transform:Qe,invTransform:Le,projection:be.getProjection()}),Z+=at.length/4,Q=Z}Oe&&(u.terrain&&u.terrain.setupElevationDraw(ve,I),I.draw(S,C.LINES,n.DepthMode.disabled,n.StencilMode.disabled,u.colorModeForRenderPass(),n.CullFaceMode.disabled,Rc(Ce,D,ve,be.getProjection()),o.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,D.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!j||!O.length)return;const ee=u.useProgram("collisionCircle"),Y=new n.StructArrayLayout2f1f2i16;Y.resize(4*Z),Y._trim();let se=0;for(const le of O)for(let _e=0;_e<le.circleArray.length/4;_e++){const ve=4*_e,be=le.circleArray[ve+0],Ae=le.circleArray[ve+1],Ce=le.circleArray[ve+2],Oe=le.circleArray[ve+3];Y.emplace(se++,be,Ae,Ce,Oe,0),Y.emplace(se++,be,Ae,Ce,Oe,1),Y.emplace(se++,be,Ae,Ce,Oe,2),Y.emplace(se++,be,Ae,Ce,Oe,3)}(!ml||ml.length<2*Z)&&(ml=function(le){const _e=2*le,ve=new n.StructArrayLayout3ui6;ve.resize(_e),ve._trim();for(let be=0;be<_e;be++){const Ae=6*be;ve.uint16[Ae+0]=4*be+0,ve.uint16[Ae+1]=4*be+1,ve.uint16[Ae+2]=4*be+2,ve.uint16[Ae+3]=4*be+2,ve.uint16[Ae+4]=4*be+3,ve.uint16[Ae+5]=4*be+0}return ve}(Z));const F=S.createIndexBuffer(ml,!0),K=S.createVertexBuffer(Y,n.collisionCircleLayout.members,!0);for(const le of O){const _e={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(ae=D).getCameraToCenterDistance(le.projection),u_viewport_size:[ae.width,ae.height]};ee.draw(S,C.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,u.colorModeForRenderPass(),n.CullFaceMode.disabled,_e,o.id,K,F,n.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,D.zoom)}var ae;K.destroy(),F.destroy()}const ju=n.create();function Vc({width:u,height:i,anchor:o,textOffset:m,textScale:x},_){const{horizontalAlign:j,verticalAlign:S}=n.getAnchorAlignment(o),C=-(j-.5)*u,D=-(S-.5)*i,I=n.evaluateVariableOffset(o,m);return new n.Point((C/x+I[0])*_,(D/x+I[1])*_)}function Tm(u,i,o,m,x,_,j,S,C,D,I){const O=u.text.placedSymbolArray,Z=u.text.dynamicLayoutVertexArray,Q=u.icon.dynamicLayoutVertexArray,ee={},Y=u.getProjection(),se=qs(S,Y,_),F=_.elevation,K=Y.upVectorScale(S.canonical,_.center.lat,_.worldSize).metersToTile;Z.clear();for(let ae=0;ae<O.length;ae++){const le=O.get(ae),{tileAnchorX:_e,tileAnchorY:ve,numGlyphs:be}=le,Ae=le.hidden||!le.crossTileID||u.allowVerticalPlacement&&!le.placedOrientation?null:m[le.crossTileID];if(Ae){let Ce=0,Oe=0,at=0;if(F){const dt=F?F.getAtTileOffset(S,_e,ve):0,[Dt,Vt,kt]=Y.upVector(S.canonical,_e,ve);Ce=dt*Dt*K,Oe=dt*Vt*K,at=dt*kt*K}let[Le,Qe,Ue,nt]=Ar(le.projectedAnchorX+Ce,le.projectedAnchorY+Oe,le.projectedAnchorZ+at,o?se:j);const ze=cu(_.getCameraToCenterDistance(Y),nt);let Xe=x.evaluateSizeForFeature(u.textSizeData,D,le)*ze/n.ONE_EM;o&&(Xe*=u.tilePixelRatio/C);const ct=Vc(Ae,Xe);o?({x:Le,y:Qe,z:Ue}=Y.projectTilePoint(_e+ct.x,ve+ct.y,S.canonical),[Le,Qe,Ue]=Ar(Le+Ce,Qe+Oe,Ue+at,j)):(i&&ct._rotate(-_.angle),Le+=ct.x,Qe+=ct.y,Ue=0);const tt=u.allowVerticalPlacement&&le.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let dt=0;dt<be;dt++)n.addDynamicAttributes(Z,Le,Qe,Ue,tt);I&&le.associatedIconIndex>=0&&(ee[le.associatedIconIndex]={x:Le,y:Qe,z:Ue,angle:tt})}else Ri(be,Z)}if(I){Q.clear();const ae=u.icon.placedSymbolArray;for(let le=0;le<ae.length;le++){const _e=ae.get(le),{numGlyphs:ve}=_e,be=ee[le];if(_e.hidden||!be)Ri(ve,Q);else{const{x:Ae,y:Ce,z:Oe,angle:at}=be;for(let Le=0;Le<ve;Le++)n.addDynamicAttributes(Q,Ae,Ce,Oe,at)}}u.icon.dynamicLayoutVertexBuffer.updateData(Q)}u.text.dynamicLayoutVertexBuffer.updateData(Z)}function qc(u,i,o){return o.iconsInText&&i?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Nu(u,i,o,m,x,_,j,S,C,D,I,O){const Z=u.context,Q=Z.gl,ee=u.transform,Y=S==="map",se=C==="map",F=Y&&o.layout.get("symbol-placement")!=="point",K=Y&&!se&&!F,ae=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let le=!1;const _e=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),ve=[n.mercatorXfromLng(ee.center.lng),n.mercatorYfromLat(ee.center.lat)],be=o.layout.get("text-variable-anchor"),Ae=ee.projection.name==="globe",Ce=[],Oe=[0,-1,0];let at=Oe;!Ae&&!ee.mercatorFromTransition||Y||(at=function(Le){const Qe=Le._camera.getWorldToCamera(Le.worldSize,1),Ue=n.multiply([],Qe,Le.globeMatrix);n.invert(Ue,Ue);const nt=[0,0,0],ze=[0,1,0,0];return n.transformMat4$1(ze,ze,Ue),nt[0]=ze[0],nt[1]=ze[1],nt[2]=ze[2],n.normalize(nt,nt),nt}(ee));for(const Le of m){const Qe=i.getTile(Le),Ue=Qe.getBucket(o);if(!Ue||Ue.projection.name==="mercator"&&Ae)continue;const nt=x?Ue.text:Ue.icon;if(!nt||Ue.fullyClipped||!nt.segments.get().length)continue;const ze=nt.programConfigurations.get(o.id),Xe=x||Ue.sdfIcons,ct=x?Ue.textSizeData:Ue.iconSizeData,tt=se||ee.pitch!==0,dt=n.evaluateSizeForZoom(ct,ee.zoom);let Dt,Vt,kt,Ft,ns=[0,0],es=null;if(x)Vt=Qe.glyphAtlasTexture,kt=Q.LINEAR,Dt=Qe.glyphAtlasTexture.size,Ue.iconsInText&&(ns=Qe.imageAtlasTexture.size,es=Qe.imageAtlasTexture,Ft=tt||u.options.rotating||u.options.zooming||ct.kind==="composite"||ct.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const fn=o.layout.get("icon-size").constantOr(0)!==1||Ue.iconsNeedLinear;Vt=Qe.imageAtlasTexture,kt=Xe||u.options.rotating||u.options.zooming||fn||tt?Q.LINEAR:Q.NEAREST,Dt=Qe.imageAtlasTexture.size}const It=Ue.projection.name==="globe",ws=It?at:Oe,Ss=It?n.globeToMercatorTransition(ee.zoom):0,Ts=qs(Le,Ue.getProjection(),ee),Es=ee.calculatePixelsToTileUnitsMatrix(Qe),Wr=We(Ts,Qe.tileID.canonical,se,Y,ee,Ue.getProjection(),Es),Pr=u.terrain&&se&&F?n.invert(n.create(),Wr):ju,Ei=ur(Ts,Qe.tileID.canonical,se,Y,ee,Ue.getProjection(),Es),Hi=be&&Ue.hasTextData(),$s=o.layout.get("icon-text-fit")!=="none"&&Hi&&Ue.hasIconData();if(F){const fn=ee.elevation,In=fn?fn.getAtTileOffsetFunc(Le,ee.center.lat,ee.worldSize,Ue.getProjection()):null,ia=on(Ts,Qe.tileID.canonical,se,Y,ee,Ue.getProjection(),Es);fc(Ue,Ts,u,x,ia,Ei,se,D,In,Le)}const Cs=F||x&&be||$s,xs=u.translatePosMatrix(Ts,Qe,_,j),hr=Cs?ju:Wr,Yr=u.translatePosMatrix(Ei,Qe,_,j,!0),Us=Ue.getProjection().createInversionMatrix(ee,Le.canonical),oi=[];u.terrainRenderModeElevated()&&se&&oi.push("PITCH_WITH_MAP_TERRAIN"),It&&oi.push("PROJECTION_GLOBE_VIEW"),Cs&&oi.push("PROJECTED_POS_ON_VIEWPORT");const kl=Xe&&o.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ra;ra=Xe?Ue.iconsInText?wu(ct.kind,dt,K,se,u,xs,hr,Yr,Dt,ns,Le,Ss,ve,Us,ws,Ue.getProjection()):hl(ct.kind,dt,K,se,u,xs,hr,Yr,x,Dt,!0,Le,Ss,ve,Us,ws,Ue.getProjection()):Fc(ct.kind,dt,K,se,u,xs,hr,Yr,x,Dt,Le,Ss,ve,Us,ws,Ue.getProjection());const Mo={program:u.useProgram(qc(Xe,x,Ue),ze,oi),buffers:nt,uniformValues:ra,atlasTexture:Vt,atlasTextureIcon:es,atlasInterpolation:kt,atlasInterpolationIcon:Ft,isSDF:Xe,hasHalo:kl,tile:Qe,labelPlaneMatrixInv:Pr};if(ae&&Ue.canOverlap){le=!0;const fn=nt.segments.get();for(const In of fn)Ce.push({segments:new n.SegmentVector([In]),sortKey:In.sortKey,state:Mo})}else Ce.push({segments:nt.segments,sortKey:0,state:Mo})}le&&Ce.sort((Le,Qe)=>Le.sortKey-Qe.sortKey);for(const Le of Ce){const Qe=Le.state;if(u.terrain&&u.terrain.setupElevationDraw(Qe.tile,Qe.program,{useDepthForOcclusion:!Ae,labelPlaneMatrixInv:Qe.labelPlaneMatrixInv}),Z.activeTexture.set(Q.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,Q.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(Z.activeTexture.set(Q.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Qe.isSDF){const Ue=Qe.uniformValues;Qe.hasHalo&&(Ue.u_is_halo=1,vo(Qe.buffers,Le.segments,o,u,Qe.program,_e,I,O,Ue)),Ue.u_is_halo=0}vo(Qe.buffers,Le.segments,o,u,Qe.program,_e,I,O,Qe.uniformValues)}}function vo(u,i,o,m,x,_,j,S,C){const D=m.context,I=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.globeExtVertexBuffer];x.draw(D,D.gl.TRIANGLES,_,j,S,n.CullFaceMode.disabled,C,o.id,u.layoutVertexBuffer,u.indexBuffer,i,o.paint,m.transform.zoom,u.programConfigurations.get(o.id),I)}function Su(u,i,o,m,x,_,j){const S=u.context.gl,C=o.paint.get("fill-pattern"),D=C&&C.constantOr(1);let I,O,Z,Q,ee;j?(O=D&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=S.LINES):(O=D?"fillPattern":"fill",I=S.TRIANGLES);for(const Y of m){const se=i.getTile(Y);if(D&&!se.patternsLoaded())continue;const F=se.getBucket(o);if(!F)continue;u.prepareDrawTile();const K=F.programConfigurations.get(o.id),ae=u.useProgram(O,K);D&&(u.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),K.updatePaintBuffers());const le=C.constantOr(null);if(le&&se.imageAtlas){const ve=se.imageAtlas.patternPositions[le.toString()];ve&&K.setConstantPatternPositions(ve)}const _e=u.translatePosMatrix(Y.projMatrix,se,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(j){Q=F.indexBuffer2,ee=F.segments2;const ve=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];Z=O==="fillOutlinePattern"&&D?wm(_e,u,se,ve):vm(_e,ve)}else Q=F.indexBuffer,ee=F.segments,Z=D?Ic(_e,u,se):Yn(_e);u.prepareDrawProgram(u.context,ae,Y.toUnwrapped()),ae.draw(u.context,I,x,u.stencilModeForClipping(Y),_,n.CullFaceMode.disabled,Z,o.id,F.layoutVertexBuffer,Q,ee,o.paint,u.transform.zoom,K)}}function pl(u,i,o,m,x,_,j){const S=u.context,C=S.gl,D=u.transform,I=o.paint.get("fill-extrusion-pattern"),O=I.constantOr(1),Z=o.paint.get("fill-extrusion-opacity"),Q=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],ee=o.layout.get("fill-extrusion-edge-radius"),Y=ee>0&&!o.paint.get("fill-extrusion-rounded-roof"),se=Y?0:ee,F=D.projection.name==="globe"?n.fillExtrusionHeightLift():0,K=D.projection.name==="globe",ae=K?n.globeToMercatorTransition(D.zoom):0,le=[n.mercatorXfromLng(D.center.lng),n.mercatorYfromLat(D.center.lat)],_e=[];K&&_e.push("PROJECTION_GLOBE_VIEW"),Q[0]>0&&_e.push("FAUX_AO"),Y&&_e.push("ZERO_ROOF_RADIUS");for(const ve of m){const be=i.getTile(ve),Ae=be.getBucket(o);if(!Ae||Ae.projection.name!==D.projection.name)continue;const Ce=Ae.programConfigurations.get(o.id),Oe=u.useProgram(O?"fillExtrusionPattern":"fillExtrusion",Ce,_e);if(u.terrain){const Xe=u.terrain;if(u.style.terrainSetForDrapingOnly())Xe.setupElevationDraw(be,Oe,{useMeterToDem:!0});else{if(!Ae.enableTerrain)continue;if(Xe.setupElevationDraw(be,Oe,{useMeterToDem:!0}),Tu(S,i,ve,Ae,o,Xe),!Ae.centroidVertexBuffer){const ct=Oe.attributes.a_centroid_pos;ct!==void 0&&C.vertexAttrib2f(ct,0,0)}}}O&&(u.context.activeTexture.set(C.TEXTURE0),be.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ce.updatePaintBuffers());const at=I.constantOr(null);if(at&&be.imageAtlas){const Xe=be.imageAtlas.patternPositions[at.toString()];Xe&&Ce.setConstantPatternPositions(Xe)}const Le=u.translatePosMatrix(ve.projMatrix,be,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Qe=D.projection.createInversionMatrix(D,ve.canonical),Ue=o.paint.get("fill-extrusion-vertical-gradient"),nt=O?_u(Le,u,Ue,Z,Q,se,ve,be,F,ae,le,Qe):Pc(Le,u,Ue,Z,Q,se,ve,F,ae,le,Qe);u.prepareDrawProgram(S,Oe,ve.toUnwrapped());const ze=[];u.terrain&&ze.push(Ae.centroidVertexBuffer),K&&ze.push(Ae.layoutVertexExtBuffer),Oe.draw(S,S.gl.TRIANGLES,x,_,j,n.CullFaceMode.backCCW,nt,o.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,o.paint,u.transform.zoom,Ce,ze)}}function Tu(u,i,o,m,x,_){const j=[F=>{let K=F.canonical.x-1,ae=F.wrap;return K<0&&(K=(1<<F.canonical.z)-1,ae--),new n.OverscaledTileID(F.overscaledZ,ae,F.canonical.z,K,F.canonical.y)},F=>{let K=F.canonical.x+1,ae=F.wrap;return K===1<<F.canonical.z&&(K=0,ae++),new n.OverscaledTileID(F.overscaledZ,ae,F.canonical.z,K,F.canonical.y)},F=>new n.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,(F.canonical.y===0?1<<F.canonical.z:F.canonical.y)-1),F=>new n.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y===(1<<F.canonical.z)-1?0:F.canonical.y+1)],S=F=>{const K=i.getSource().minzoom,ae=_e=>{const ve=i.getTileByID(_e);if(ve&&ve.hasData())return ve.getBucket(x)},le=[0,-1,1];for(const _e of le){if(F.overscaledZ+_e<K)continue;const ve=ae(F.calculateScaledKey(F.overscaledZ+_e));if(ve)return ve}},C=[0,0,0],D=(F,K)=>(C[0]=Math.min(F.min.y,K.min.y),C[1]=Math.max(F.max.y,K.max.y),C[2]=n.EXTENT-K.min.x>F.max.x?K.min.x-n.EXTENT:F.max.x,C),I=(F,K)=>(C[0]=Math.min(F.min.x,K.min.x),C[1]=Math.max(F.max.x,K.max.x),C[2]=n.EXTENT-K.min.y>F.max.y?K.min.y-n.EXTENT:F.max.y,C),O=[(F,K)=>D(F,K),(F,K)=>D(K,F),(F,K)=>I(F,K),(F,K)=>I(K,F)],Z=new n.Point(0,0);let Q,ee,Y;const se=(F,K,ae,le,_e)=>{const ve=[[le?ae:F,le?F:ae,0],[le?ae:K,le?K:ae,0]],be=_e<0?n.EXTENT+_e:_e,Ae=[le?be:(F+K)/2,le?(F+K)/2:be,0];return ae===0&&_e<0||ae!==0&&_e>0?_.getForTilePoints(Y,[Ae],!0,ee):ve.push(Ae),_.getForTilePoints(o,ve,!0,Q),Math.max(ve[0][2],ve[1][2],Ae[2])/_.exaggeration()};for(let F=0;F<4;F++){const K=(F<2?1:5)-F,ae=m.borders[F];if(ae.length===0)continue;const le=Y=j[F](o),_e=S(le);if(!(_e&&_e instanceof n.FillExtrusionBucket&&_e.enableTerrain)||m.borderDoneWithNeighborZ[F]===_e.canonical.z&&_e.borderDoneWithNeighborZ[K]===m.canonical.z||(ee=_.findDEMTileFor(le),!ee||!ee.dem))continue;if(!Q){const Ce=_.findDEMTileFor(o);if(!Ce||!Ce.dem)return;Q=Ce}const ve=_e.borders[K];let be=0;const Ae=_e.borderDoneWithNeighborZ[K]!==m.canonical.z;if(m.canonical.z===_e.canonical.z){for(let Ce=0;Ce<ae.length;Ce++){const Oe=m.featuresOnBorder[ae[Ce]],at=Oe.borders[F];let Le;for(;be<ve.length&&(Le=_e.featuresOnBorder[ve[be]],!(Le.borders[K][1]>at[0]+3));)Ae&&_e.encodeCentroid(void 0,Le,!1),be++;if(Le&&be<ve.length){const Qe=be;let Ue=0;for(;!(Le.borders[K][0]>at[1]-3)&&(Ue++,++be!==ve.length);)Le=_e.featuresOnBorder[ve[be]];if(Le=_e.featuresOnBorder[ve[Qe]],Oe.intersectsCount()>1||Le.intersectsCount()>1||Ue!==1){Ue!==1&&(be=Qe),m.encodeCentroid(void 0,Oe,!1),Ae&&_e.encodeCentroid(void 0,Le,!1);continue}const nt=O[F](Oe,Le),ze=F%2?n.EXTENT-1:0;Z.x=se(nt[0],Math.min(n.EXTENT-1,nt[1]),ze,F<2,nt[2]),Z.y=0,m.encodeCentroid(Z,Oe,!1),Ae&&_e.encodeCentroid(Z,Le,!1)}else m.encodeCentroid(void 0,Oe,!1)}m.borderDoneWithNeighborZ[F]=_e.canonical.z,m.needsCentroidUpdate=!0,Ae&&(_e.borderDoneWithNeighborZ[K]=m.canonical.z,_e.needsCentroidUpdate=!0)}else{for(const Ce of ae)m.encodeCentroid(void 0,m.featuresOnBorder[Ce],!1);if(Ae){for(const Ce of ve)_e.encodeCentroid(void 0,_e.featuresOnBorder[Ce],!1);_e.borderDoneWithNeighborZ[K]=m.canonical.z,_e.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[F]=_e.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(u)}const Ta=new n.Color(1,0,0,1),Em=new n.Color(0,1,0,1),Cm=new n.Color(0,0,1,1),km=new n.Color(1,0,1,1),Am=new n.Color(0,1,1,1);function Mm(u,i,o){const m=u.context,x=u.transform,_=m.gl,j=x.projection.name==="globe",S=j?["PROJECTION_GLOBE_VIEW"]:null;let C=o.projMatrix;if(j&&n.globeToMercatorTransition(x.zoom)>0){const Oe=n.transitionTileAABBinECEF(o.canonical,x),at=n.globeDenormalizeECEF(Oe);C=n.multiply(new Float32Array(16),x.globeMatrix,at),n.multiply(C,x.projMatrix,C)}const D=u.useProgram("debug",null,S),I=i.getTileByID(o.key);u.terrain&&u.terrain.setupElevationDraw(I,D);const O=n.DepthMode.disabled,Z=n.StencilMode.disabled,Q=u.colorModeForRenderPass(),ee="$debug";m.activeTexture.set(_.TEXTURE0),u.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),j?I._makeGlobeTileDebugBuffers(u.context,x):I._makeDebugTileBoundsBuffers(u.context,x.projection);const Y=I._tileDebugBuffer||u.debugBuffer,se=I._tileDebugIndexBuffer||u.debugIndexBuffer,F=I._tileDebugSegments||u.debugSegments;D.draw(m,_.LINE_STRIP,O,Z,Q,n.CullFaceMode.disabled,dl(C,n.Color.red),ee,Y,se,F,null,null,null,[I._globeTileDebugBorderBuffer]);const K=I.latestRawTileData,ae=Math.floor((K&&K.byteLength||0)/1024),le=i.getTile(o).tileSize,_e=512/Math.min(le,512)*(o.overscaledZ/x.zoom)*.5;let ve=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(ve+=` => ${o.overscaledZ}`),ve+=` ${ae}kb`,function(Oe,at){Oe.initDebugOverlayCanvas();const Le=Oe.debugOverlayCanvas,Qe=Oe.context.gl,Ue=Oe.debugOverlayCanvas.getContext("2d");Ue.clearRect(0,0,Le.width,Le.height),Ue.shadowColor="white",Ue.shadowBlur=2,Ue.lineWidth=1.5,Ue.strokeStyle="white",Ue.textBaseline="top",Ue.font="bold 36px Open Sans, sans-serif",Ue.fillText(at,5,5),Ue.strokeText(at,5,5),Oe.debugOverlayTexture.update(Le),Oe.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(u,ve);const be=I._tileDebugTextBuffer||u.debugBuffer,Ae=I._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Ce=I._tileDebugTextSegments||u.debugSegments;D.draw(m,_.TRIANGLES,O,Z,n.ColorMode.alphaBlended,n.CullFaceMode.disabled,dl(C,n.Color.transparent,_e),ee,be,Ae,Ce,null,null,null,[I._globeTileDebugTextBuffer])}function Eu(u,i,o,m){Ea(u,0,i+o/2,u.transform.width,o,m)}function fl(u,i,o,m){Ea(u,i-o/2,0,o,u.transform.height,m)}function Ea(u,i,o,m,x,_){const j=u.context,S=j.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*n.exported.devicePixelRatio,o*n.exported.devicePixelRatio,m*n.exported.devicePixelRatio,x*n.exported.devicePixelRatio),j.clear({color:_}),S.disable(S.SCISSOR_TEST)}const Cu=n.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ku}=Cu;function mn(u,i,o,m){u.emplaceBack(i,o,m)}class gl{constructor(i){this.vertexArray=new n.StructArrayLayout3f12,this.indices=new n.StructArrayLayout3ui6,mn(this.vertexArray,-1,-1,1),mn(this.vertexArray,1,-1,1),mn(this.vertexArray,-1,1,1),mn(this.vertexArray,1,1,1),mn(this.vertexArray,-1,-1,-1),mn(this.vertexArray,1,-1,-1),mn(this.vertexArray,-1,1,-1),mn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,ku),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=n.SegmentVector.simpleSegment(0,0,36,12)}}function Si(u,i,o,m,x,_){const j=u.gl,S=i.paint.get("sky-atmosphere-color"),C=i.paint.get("sky-atmosphere-halo-color"),D=i.paint.get("sky-atmosphere-sun-intensity"),I=((O,Z,Q,ee,Y)=>({u_matrix_3f:O,u_sun_direction:Z,u_sun_intensity:Q,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(n.fromMat4(n.create$1(),m),x,D,S,C);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+_,i.skyboxTexture,0),o.draw(u,j.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.frontCW,I,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const wo=n.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Au{constructor(i){const o=new n.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const m=new n.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,wo.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=n.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ea={symbol:function(u,i,o,m,x){if(u.renderPass!=="translucent")return;const _=n.StencilMode.disabled,j=u.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(S,C,D,I,O,Z,Q){const ee=C.transform,Y=O==="map",se=Z==="map";for(const F of S){const K=I.getTile(F),ae=K.getBucket(D);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const le=n.evaluateSizeForZoom(ae.textSizeData,ee.zoom),_e=qs(F,ae.getProjection(),ee),ve=ee.calculatePixelsToTileUnitsMatrix(K),be=We(_e,K.tileID.canonical,se,Y,ee,ae.getProjection(),ve),Ae=D.layout.get("icon-text-fit")!=="none"&&ae.hasIconData();if(le){const Ce=Math.pow(2,ee.zoom-K.tileID.overscaledZ);Tm(ae,Y,se,Q,n.symbolSize,ee,be,F,Ce,le,Ae)}}}(m,u,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),x),o.paint.get("icon-opacity").constantOr(1)!==0&&Nu(u,i,o,m,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),_,j),o.paint.get("text-opacity").constantOr(1)!==0&&Nu(u,i,o,m,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),_,j),i.map.showCollisionBoxes&&(bo(u,i,o,m,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),bo(u,i,o,m,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(u,i,o,m){if(u.renderPass!=="translucent")return;const x=o.paint.get("circle-opacity"),_=o.paint.get("circle-stroke-width"),j=o.paint.get("circle-stroke-opacity"),S=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(_.constantOr(1)===0||j.constantOr(1)===0))return;const C=u.context,D=C.gl,I=u.transform,O=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),Z=n.StencilMode.disabled,Q=u.colorModeForRenderPass(),ee=I.projection.name==="globe",Y=[n.mercatorXfromLng(I.center.lng),n.mercatorYfromLat(I.center.lat)],se=[];for(let K=0;K<m.length;K++){const ae=m[K],le=i.getTile(ae),_e=le.getBucket(o);if(!_e||_e.projection.name!==I.projection.name)continue;const ve=_e.programConfigurations.get(o.id),be=Lc(o);ee&&be.push("PROJECTION_GLOBE_VIEW");const Ae=u.useProgram("circle",ve,be),Ce=_e.layoutVertexBuffer,Oe=_e.globeExtVertexBuffer,at=_e.indexBuffer,Le=I.projection.createInversionMatrix(I,ae.canonical),Qe={programConfiguration:ve,program:Ae,layoutVertexBuffer:Ce,globeExtVertexBuffer:Oe,indexBuffer:at,uniformValues:Dc(u,ae,le,Le,Y,o),tile:le};if(S){const Ue=_e.segments.get();for(const nt of Ue)se.push({segments:new n.SegmentVector([nt]),sortKey:nt.sortKey,state:Qe})}else se.push({segments:_e.segments,sortKey:0,state:Qe})}S&&se.sort((K,ae)=>K.sortKey-ae.sortKey);const F={useDepthForOcclusion:!ee};for(const K of se){const{programConfiguration:ae,program:le,layoutVertexBuffer:_e,globeExtVertexBuffer:ve,indexBuffer:be,uniformValues:Ae,tile:Ce}=K.state,Oe=K.segments;u.terrain&&u.terrain.setupElevationDraw(Ce,le,F),u.prepareDrawProgram(C,le,Ce.tileID.toUnwrapped()),le.draw(C,D.TRIANGLES,O,Z,Q,n.CullFaceMode.disabled,Ae,o.id,_e,be,Oe,o.paint,I.zoom,ae,[ve])}},heatmap:function(u,i,o,m){if(o.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const x=u.context,_=x.gl,j=n.StencilMode.disabled,S=new n.ColorMode([_.ONE,_.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(Q,ee,Y,se){const F=Q.gl,K=ee.width*se,ae=ee.height*se;Q.activeTexture.set(F.TEXTURE1),Q.viewport.set([0,0,K,ae]);let le=Y.heatmapFbo;if(!le||le&&(le.width!==K||le.height!==ae)){le&&le.destroy();const _e=F.createTexture();F.bindTexture(F.TEXTURE_2D,_e),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),le=Y.heatmapFbo=Q.createFramebuffer(K,ae,!1),function(ve,be,Ae,Ce,Oe,at){const Le=ve.gl;Le.texImage2D(Le.TEXTURE_2D,0,ve.isWebGL2&&ve.extRenderToTextureHalfFloat?Le.RGBA16F:Le.RGBA,Oe,at,0,Le.RGBA,ve.extRenderToTextureHalfFloat?ve.isWebGL2?Le.HALF_FLOAT:ve.extTextureHalfFloat.HALF_FLOAT_OES:Le.UNSIGNED_BYTE,null),Ce.colorAttachment.set(Ae)}(Q,0,_e,le,K,ae)}else F.bindTexture(F.TEXTURE_2D,le.colorAttachment.get()),Q.bindFramebuffer.set(le.framebuffer)})(x,u,o,u.transform.projection.name==="globe"?.5:.25),x.clear({color:n.Color.transparent});const C=u.transform,D=C.projection.name==="globe",I=D?["PROJECTION_GLOBE_VIEW"]:null,O=D?n.CullFaceMode.frontCCW:n.CullFaceMode.disabled,Z=[n.mercatorXfromLng(C.center.lng),n.mercatorYfromLat(C.center.lat)];for(let Q=0;Q<m.length;Q++){const ee=m[Q];if(i.hasRenderableParent(ee))continue;const Y=i.getTile(ee),se=Y.getBucket(o);if(!se||se.projection.name!==C.projection.name)continue;const F=se.programConfigurations.get(o.id),K=u.useProgram("heatmap",F,I),{zoom:ae}=u.transform;u.terrain&&u.terrain.setupElevationDraw(Y,K),u.prepareDrawProgram(x,K,ee.toUnwrapped());const le=C.projection.createInversionMatrix(C,ee.canonical);K.draw(x,_.TRIANGLES,n.DepthMode.disabled,j,S,O,vu(u,ee,Y,le,Z,ae,o.paint.get("heatmap-intensity")),o.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,o.paint,u.transform.zoom,F,D?[se.globeExtVertexBuffer]:null)}x.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(x,_){const j=x.context,S=j.gl,C=_.heatmapFbo;if(!C)return;j.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),j.activeTexture.set(S.TEXTURE1);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new n.Texture(j,_.colorRamp,S.RGBA)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(j,S.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,x.colorModeForRenderPass(),n.CullFaceMode.disabled,((I,O,Z,Q)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,_),_.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,_.paint,x.transform.zoom)}(u,o))},line:function(u,i,o,m){if(u.renderPass!=="translucent")return;const x=o.paint.get("line-opacity"),_=o.paint.get("line-width");if(x.constantOr(1)===0||_.constantOr(1)===0)return;const j=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),S=u.colorModeForRenderPass(),C=u.terrain&&u.terrain.renderingToTexture?1:n.exported.devicePixelRatio,D=o.paint.get("line-dasharray"),I=D.constantOr(1),O=o.layout.get("line-cap"),Z=o.paint.get("line-pattern"),Q=Z.constantOr(1),ee=o.paint.get("line-gradient"),Y=Q?"linePattern":"line",se=u.context,F=se.gl,K=(le=>{const _e=[];_o(le)&&_e.push("RENDER_LINE_DASH"),le.paint.get("line-gradient")&&_e.push("RENDER_LINE_GRADIENT");const ve=le.paint.get("line-trim-offset");ve[0]===0&&ve[1]===0||_e.push("RENDER_LINE_TRIM_OFFSET");const be=le.paint.get("line-pattern").constantOr(1),Ae=le.paint.get("line-opacity").constantOr(1)!==1;return!be&&Ae&&_e.push("RENDER_LINE_ALPHA_DISCARD"),_e})(o);let ae=K.includes("RENDER_LINE_ALPHA_DISCARD");u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(ae=!1);for(const le of m){const _e=i.getTile(le);if(Q&&!_e.patternsLoaded())continue;const ve=_e.getBucket(o);if(!ve)continue;u.prepareDrawTile();const be=ve.programConfigurations.get(o.id),Ae=u.useProgram(Y,be,K),Ce=Z.constantOr(null);if(Ce&&_e.imageAtlas){const Xe=_e.imageAtlas.patternPositions[Ce.toString()];Xe&&be.setConstantPatternPositions(Xe)}const Oe=D.constantOr(null),at=O.constantOr(null);if(!Q&&Oe&&at&&_e.lineAtlas){const Xe=_e.lineAtlas.getDash(Oe,at);Xe&&be.setConstantPatternPositions(Xe)}let[Le,Qe]=o.paint.get("line-trim-offset");(at==="round"||at==="square")&&Le!==Qe&&(Le===0&&(Le-=1),Qe===1&&(Qe+=1));const Ue=u.terrain?le.projMatrix:null,nt=Q?yo(u,_e,o,Ue,C):Nm(u,_e,o,Ue,ve.lineClipsArray.length,C,[Le,Qe]);if(ee){const Xe=ve.gradients[o.id];let ct=Xe.texture;if(o.gradientVersion!==Xe.version){let tt=256;if(o.stepInterpolant){const dt=i.getSource().maxzoom,Dt=le.canonical.z===dt?Math.ceil(1<<u.transform.maxZoom-le.canonical.z):1;tt=n.clamp(n.nextPowerOfTwo(ve.maxLineLength/n.EXTENT*1024*Dt),256,se.maxTextureSize)}Xe.gradient=n.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:tt,image:Xe.gradient||void 0,clips:ve.lineClipsArray}),Xe.texture?Xe.texture.update(Xe.gradient):Xe.texture=new n.Texture(se,Xe.gradient,F.RGBA),Xe.version=o.gradientVersion,ct=Xe.texture}se.activeTexture.set(F.TEXTURE1),ct.bind(o.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}I&&(se.activeTexture.set(F.TEXTURE0),_e.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),be.updatePaintBuffers()),Q&&(se.activeTexture.set(F.TEXTURE0),_e.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),be.updatePaintBuffers()),u.prepareDrawProgram(se,Ae,le.toUnwrapped());const ze=Xe=>{Ae.draw(se,F.TRIANGLES,j,Xe,S,n.CullFaceMode.disabled,nt,o.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,o.paint,u.transform.zoom,be,[ve.layoutVertexBuffer2])};if(ae){const Xe=u.stencilModeForClipping(le).ref;Xe===0&&u.terrain&&se.clear({stencil:0});const ct={func:F.EQUAL,mask:255};nt.u_alpha_discard_threshold=.8,ze(new n.StencilMode(ct,Xe,255,F.KEEP,F.KEEP,F.INVERT)),nt.u_alpha_discard_threshold=0,ze(new n.StencilMode(ct,Xe,255,F.KEEP,F.KEEP,F.KEEP))}else ze(u.stencilModeForClipping(le))}ae&&(u.resetStencilClippingMasks(),u.terrain&&se.clear({stencil:0}))},fill:function(u,i,o,m){const x=o.paint.get("fill-color"),_=o.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const j=u.colorModeForRenderPass(),S=o.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!S.constantOr(1)&&x.constantOr(n.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===C){const D=u.depthModeForSublayer(1,u.renderPass==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly);Su(u,i,o,m,D,j,!1)}if(u.renderPass==="translucent"&&o.paint.get("fill-antialias")){const D=u.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,n.DepthMode.ReadOnly);Su(u,i,o,m,D,j,!0)}},"fill-extrusion":function(u,i,o,m){const x=o.paint.get("fill-extrusion-opacity");if(x!==0&&u.renderPass==="translucent"){const _=new n.DepthMode(u.context.gl.LEQUAL,n.DepthMode.ReadWrite,u.depthRangeFor3D);if(x!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))pl(u,i,o,m,_,n.StencilMode.disabled,n.ColorMode.disabled),pl(u,i,o,m,_,u.stencilModeFor3D(),u.colorModeForRenderPass()),u.resetStencilClippingMasks();else{const j=u.colorModeForRenderPass();pl(u,i,o,m,_,n.StencilMode.disabled,j)}}},hillshade:function(u,i,o,m){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const x=u.context,_=u.depthModeForSublayer(0,n.DepthMode.ReadOnly),j=u.colorModeForRenderPass(),S=u.terrain&&u.terrain.renderingToTexture,[C,D]=u.renderPass!=="translucent"||S?[{},m]:u.stencilConfigForOverlap(m);for(const I of D){const O=i.getTile(I);if(O.needsHillshadePrepare&&u.renderPass==="offscreen")gu(u,O,o,_,n.StencilMode.disabled,j);else if(u.renderPass==="translucent"){const Z=S&&u.terrain?u.terrain.stencilModeForRTTOverlap(I):C[I.overscaledZ];fu(u,I,O,o,_,Z,j)}}x.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,i,o,m,x,_){if(u.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!m.length)return;const j=u.context,S=j.gl,C=i.getSource(),D=u.useProgram("raster"),I=u.colorModeForRenderPass(),O=u.terrain&&u.terrain.renderingToTexture,[Z,Q]=C instanceof Jt||O?[{},m]:u.stencilConfigForOverlap(m),ee=Q[Q.length-1].overscaledZ,Y=!u.options.moving;for(const se of Q){const F=O?n.DepthMode.disabled:u.depthModeForSublayer(se.overscaledZ-ee,o.paint.get("raster-opacity")===1?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly,S.LESS),K=se.toUnwrapped(),ae=i.getTile(se);if(O&&(!ae||!ae.hasData()))continue;const le=O?se.projMatrix:u.transform.calculateProjMatrix(K,Y),_e=u.terrain&&O?u.terrain.stencilModeForRTTOverlap(se):Z[se.overscaledZ],ve=_?0:o.paint.get("raster-fade-duration");ae.registerFadeDuration(ve);const be=i.findLoadedParent(se,0),Ae=kc(ae,be,i,u.transform,ve);let Ce,Oe;u.terrain&&u.terrain.prepareDrawTile();const at=o.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;j.activeTexture.set(S.TEXTURE0),ae.texture.bind(at,S.CLAMP_TO_EDGE),j.activeTexture.set(S.TEXTURE1),be?(be.texture.bind(at,S.CLAMP_TO_EDGE),Ce=Math.pow(2,be.tileID.overscaledZ-ae.tileID.overscaledZ),Oe=[ae.tileID.canonical.x*Ce%1,ae.tileID.canonical.y*Ce%1]):ae.texture.bind(at,S.CLAMP_TO_EDGE),ae.texture.useMipmap&&j.extTextureFilterAnisotropic&&u.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const Le=Oc(le,Oe||[0,0],Ce||1,Ae,o,C instanceof Jt?C.perspectiveTransform:[0,0]);if(u.prepareDrawProgram(j,D,K),C instanceof Jt)C.boundsBuffer&&C.boundsSegments&&D.draw(j,S.TRIANGLES,F,n.StencilMode.disabled,I,n.CullFaceMode.disabled,Le,o.id,C.boundsBuffer,u.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Qe,tileBoundsIndexBuffer:Ue,tileBoundsSegments:nt}=u.getTileBoundsBuffers(ae);D.draw(j,S.TRIANGLES,F,_e,I,n.CullFaceMode.disabled,Le,o.id,Qe,Ue,nt)}}u.resetStencilClippingMasks()},background:function(u,i,o,m){const x=o.paint.get("background-color"),_=o.paint.get("background-opacity");if(_===0)return;const j=u.context,S=j.gl,C=u.transform,D=C.tileSize,I=o.paint.get("background-pattern");if(u.isPatternMissing(I))return;const O=!I&&x.a===1&&_===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==O)return;const Z=n.StencilMode.disabled,Q=u.depthModeForSublayer(0,O==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly),ee=u.colorModeForRenderPass(),Y=u.useProgram(I?"backgroundPattern":"background");let se,F=m;F||(se=u.getBackgroundTiles(),F=Object.values(se).map(K=>K.tileID)),I&&(j.activeTexture.set(S.TEXTURE0),u.imageManager.bind(u.context));for(const K of F){const ae=K.toUnwrapped(),le=m?K.projMatrix:u.transform.calculateProjMatrix(ae);u.prepareDrawTile();const _e=i?i.getTile(K):se?se[K.key]:new n.Tile(K,D,C.zoom,u),ve=I?Sm(le,_,u,I,{tileID:K,tileSize:D}):Bc(le,_,x);u.prepareDrawProgram(j,Y,ae);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Ce}=u.getTileBoundsBuffers(_e);Y.draw(j,S.TRIANGLES,Q,Z,ee,n.CullFaceMode.disabled,ve,o.id,be,Ae,Ce)}},sky:function(u,i,o){const m=u.transform,x=m.projection.name==="mercator"||m.projection.name==="globe"?1:n.smoothstep(7,8,m.zoom),_=o.paint.get("sky-opacity")*x;if(_===0)return;const j=u.context,S=o.paint.get("sky-type"),C=new n.DepthMode(j.gl.LEQUAL,n.DepthMode.ReadOnly,[0,1]),D=u.frameCounter/1e3%1;S==="atmosphere"?u.renderPass==="offscreen"?o.needsSkyboxCapture(u)&&(function(I,O,Z,Q){const ee=I.context,Y=ee.gl;let se=O.skyboxFbo;if(!se){se=O.skyboxFbo=ee.createFramebuffer(32,32,!1),O.skyboxGeometry=new gl(ee),O.skyboxTexture=ee.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,O.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let le=0;le<6;++le)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(se.framebuffer),ee.viewport.set([0,0,32,32]);const F=O.getCenter(I,!0),K=I.useProgram("skyboxCapture"),ae=new Float64Array(16);n.identity(ae),n.rotateY(ae,ae,.5*-Math.PI),Si(ee,O,K,ae,F,0),n.identity(ae),n.rotateY(ae,ae,.5*Math.PI),Si(ee,O,K,ae,F,1),n.identity(ae),n.rotateX(ae,ae,.5*-Math.PI),Si(ee,O,K,ae,F,2),n.identity(ae),n.rotateX(ae,ae,.5*Math.PI),Si(ee,O,K,ae,F,3),n.identity(ae),Si(ee,O,K,ae,F,4),n.identity(ae),n.rotateY(ae,ae,Math.PI),Si(ee,O,K,ae,F,5),ee.viewport.set([0,0,I.width,I.height])}(u,o),o.markSkyboxValid(u)):u.renderPass==="sky"&&function(I,O,Z,Q,ee){const Y=I.context,se=Y.gl,F=I.transform,K=I.useProgram("skybox");Y.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,O.skyboxTexture);const ae=((le,_e,ve,be,Ae)=>({u_matrix:le,u_sun_direction:_e,u_cubemap:0,u_opacity:be,u_temporal_offset:Ae}))(F.skyboxMatrix,O.getCenter(I,!1),0,Q,ee);I.prepareDrawProgram(Y,K),K.draw(Y,se.TRIANGLES,Z,n.StencilMode.disabled,I.colorModeForRenderPass(),n.CullFaceMode.backCW,ae,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(u,o,C,_,D):S==="gradient"&&u.renderPass==="sky"&&function(I,O,Z,Q,ee){const Y=I.context,se=Y.gl,F=I.transform,K=I.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new gl(Y)),Y.activeTexture.set(se.TEXTURE0);let ae=O.colorRampTexture;ae||(ae=O.colorRampTexture=new n.Texture(Y,O.colorRamp,se.RGBA)),ae.bind(se.LINEAR,se.CLAMP_TO_EDGE);const le=((_e,ve,be,Ae,Ce)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:ve,u_radius:n.degToRad(be),u_opacity:Ae,u_temporal_offset:Ce}))(F.skyboxMatrix,O.getCenter(I,!1),O.paint.get("sky-gradient-radius"),Q,ee);I.prepareDrawProgram(Y,K),K.draw(Y,se.TRIANGLES,Z,n.StencilMode.disabled,I.colorModeForRenderPass(),n.CullFaceMode.backCW,le,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(u,o,C,_,D)},debug:function(u,i,o){for(let m=0;m<o.length;m++)Mm(u,i,o[m])},custom:function(u,i,o,m){const x=u.context,_=o.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&o.isLayerDraped()){if(u.renderPass==="offscreen"){const j=_.prerender;if(j){if(u.setCustomLayerDefaults(),x.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const S=u.transform.pointMerc;j.call(_,x.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.globeToMercatorTransition(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else j.call(_,x.gl,u.transform.customLayerMatrix());x.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const S=_.renderToTile;if(S){const C=m[0].canonical,D=new n.MercatorCoordinate(C.x+m[0].wrap*(1<<C.z),C.y,C.z);x.setDepthMode(n.DepthMode.disabled),x.setStencilMode(n.StencilMode.disabled),x.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),S.call(_,x.gl,D),x.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),x.setColorMode(u.colorModeForRenderPass()),x.setStencilMode(n.StencilMode.disabled);const j=_.renderingMode==="3d"?new n.DepthMode(u.context.gl.LEQUAL,n.DepthMode.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,n.DepthMode.ReadOnly);if(x.setDepthMode(j),u.transform.projection.name==="globe"){const S=u.transform.pointMerc;_.render(x.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.globeToMercatorTransition(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else _.render(x.gl,u.transform.customLayerMatrix());x.setDirty(),u.setBaseState(),x.bindFramebuffer.set(null)}}else n.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ca{constructor(i,o,m=!1){this.context=new gt(i,m),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=n.SourceCache.maxUnderzooming+n.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,o){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Mc(this,i));const x=this._terrain;this.transform.elevation=m?x:null,x.update(i,this.transform,o)}_updateFog(i){const o=i.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=o.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const _=m+.78*(x-m);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,o){if(this.width=i*n.exported.devicePixelRatio,this.height=o*n.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const i=this.context,o=new n.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(n.EXTENT,0),o.emplaceBack(0,n.EXTENT),o.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(o,n.posAttributes.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const m=new n.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(n.EXTENT,0),m.emplaceBack(0,n.EXTENT),m.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=i.createVertexBuffer(m,n.posAttributes.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const x=new n.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,n.posAttributes.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const _=new n.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(n.EXTENT,0,n.EXTENT,0),_.emplaceBack(0,n.EXTENT,0,n.EXTENT),_.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(_,n.boundsAttributes.members),this.mercatorBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const j=new n.StructArrayLayout3ui6;j.emplaceBack(0,1,2),j.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(j);const S=new n.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])S.emplaceBack(D);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new n.Texture(i,new n.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=n.create();const C=this.context.gl;this.stencilClearMode=new n.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(n.window.performance.now()),this.atmosphereBuffer=new Au(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,o.TRIANGLES,n.DepthMode.disabled,this.stencilClearMode,n.ColorMode.disabled,n.CullFaceMode.disabled,go(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,m){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const C of m)if(this._tileClippingMaskIDs[C.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=o.id;const x=this.context,_=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(n.ColorMode.disabled),x.setDepthMode(n.DepthMode.disabled);const j=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of m){const C=o.getTile(S),D=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:O,tileBoundsSegments:Z}=this.getTileBoundsBuffers(C);j.draw(x,_.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:_.ALWAYS,mask:0},D,255,_.KEEP,_.KEEP,_.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,go(S.projMatrix),"$clipping",I,O,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new n.StencilMode({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new n.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,m=i.sort((j,S)=>S.overscaledZ-j.overscaledZ),x=m[m.length-1].overscaledZ,_=m[0].overscaledZ-x+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const j={};for(let S=0;S<_;S++)j[S+x]=new n.StencilMode({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[j,m]}return[{[x]:n.StencilMode.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new n.ColorMode([i.CONSTANT_COLOR,i.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?n.ColorMode.unblended:n.ColorMode.alphaBlended}depthModeForSublayer(i,o,m){if(!this.opaquePassEnabledForLayer())return n.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new n.DepthMode(m||this.context.gl.LEQUAL,o,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();const m=this.style.order,x=this.style._sourceCaches;for(const D in x){const I=x[D];I.used&&I.prepare(this.context)}const _={},j={},S={};for(const D in x){const I=x[D];_[D]=I.getVisibleCoordinates(),j[D]=_[D].slice().reverse(),S[D]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<m.length;D++)if(this.style._layers[m[D]].is3D()){this.opaquePassCutoff=D;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.GlobeSharedBuffers(this.context)),!n.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const D of m){const I=this.style._layers[D],O=i._getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const Z=O?j[O.id]:void 0;(I.type==="custom"||I.isSky()||Z&&Z.length)&&this.renderLayer(this,O,I,Z)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon];const C=this.terrain;if(C&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&C.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);if(D.isSky())continue;const O=I?j[I.id]:void 0;this._renderTileClippingMasks(D,I,O),this.renderLayer(this,I,D,O)}if(this.style.fog&&this.transform.projection.supportsFog&&function(D,I){const O=D.context,Z=O.gl,Q=D.transform,ee=new n.DepthMode(Z.LEQUAL,n.DepthMode.ReadOnly,[0,1]),Y=D.useProgram("globeAtmosphere",null,Q.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),se=n.globeToMercatorTransition(Q.zoom),F=I.properties.get("color").toArray01(),K=I.properties.get("high-color").toArray01(),ae=I.properties.get("space-color").toArray01PremultipliedAlpha(),le=n.identity$1([]);n.rotateY$1(le,le,-n.degToRad(Q._center.lng)),n.rotateX$1(le,le,n.degToRad(Q._center.lat)),n.rotateZ$1(le,le,Q.angle),n.rotateX$1(le,le,-Q._pitch);const _e=n.fromQuat(new Float32Array(16),le),ve=n.mapValue(I.properties.get("star-intensity"),0,1,0,.25),be=5e-4,Ae=n.mapValue(I.properties.get("horizon-blend"),0,1,be,.25),Ce=n.globeUseCustomAntiAliasing(D,O,Q)&&Ae===be?Q.worldSize/(2*Math.PI*1.025)-1:Q.globeRadius,Oe=D.frameCounter/1e3%1,at=n.length(Q.globeCenterInViewSpace),Le=Math.sqrt(Math.pow(at,2)-Math.pow(Ce,2)),Qe=Math.acos(Le/at),Ue=((ze,Xe,ct,tt,dt,Dt,Vt,kt,Ft,ns,es,It,ws,Ss)=>({u_frustum_tl:ze,u_frustum_tr:Xe,u_frustum_br:ct,u_frustum_bl:tt,u_horizon:dt,u_transition:Dt,u_fadeout_range:Vt,u_color:kt,u_high_color:Ft,u_space_color:ns,u_star_intensity:es,u_star_size:5*n.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:It,u_horizon_angle:ws,u_rotation_matrix:Ss}))(Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.frustumCorners.horizon,se,Ae,F,K,ae,ve,Oe,Qe,_e);D.prepareDrawProgram(O,Y);const nt=D.atmosphereBuffer;nt&&Y.draw(O,Z.TRIANGLES,ee,n.StencilMode.disabled,n.ColorMode.alphaBlended,n.CullFaceMode.backCW,Ue,"skybox",nt.vertexBuffer,nt.indexBuffer,nt.segments)}(this,this.style.fog),this.renderPass="sky",(n.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);D.isSky()&&this.renderLayer(this,I,D,I?j[I.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const D=this.style._layers[m[this.currentLayer]],I=i._getLayerSourceCache(D);if(D.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(D)){if(D.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=I?(D.type==="symbol"?S:j)[I.id]:void 0;this._renderTileClippingMasks(D,I,I?_[I.id]:void 0),this.renderLayer(this,I,D,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let D=null;n.values(this.style._layers).forEach(I=>{const O=i._getLayerSourceCache(I);O&&!I.isHidden(this.transform.zoom)&&(!D||D.getSource().maxzoom<O.getSource().maxzoom)&&(D=O)}),D&&this.options.showTileBoundaries&&ea.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const I=D.transform.padding;Eu(D,D.transform.height-(I.top||0),3,Ta),Eu(D,I.bottom||0,3,Em),fl(D,I.left||0,3,Cm),fl(D,D.transform.width-(I.right||0),3,km);const O=D.transform.centerPoint;(function(Z,Q,ee,Y){Ea(Z,Q-1,ee-10,2,20,Y),Ea(Z,Q-10,ee-1,20,2,Y)})(D,O.x,D.transform.height-O.y,Am)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(n.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,o,m,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(m.type)||i.terrain&&m.type==="custom")&&ea[m.type](i,o,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),m.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),i.beginQueryEXT(i.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const m in i){const x=i[m],_=this.context.extTimerQuery,j=_.getQueryObjectEXT(x.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(x.query),o[m]=j}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let m=0;for(const x of i)m+=o.getQueryObjectEXT(x,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(x);return m}translatePosMatrix(i,o,m,x,_){if(!m[0]&&!m[1])return i;const j=_?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(j){const D=Math.sin(j),I=Math.cos(j);m=[m[0]*I-m[1]*D,m[0]*D+m[1]*I]}const S=[_?m[0]:Is(o,m[0],this.transform.zoom),_?m[1]:Is(o,m[1],this.transform.zoom),0],C=new Float32Array(16);return n.translate(C,i,S),C}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){return i===null||i!==void 0&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,o=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),o&&x.push("ZERO_EXAGGERATION"),m&&!i&&m.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),i&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(i,o,m){this.cache=this.cache||{};const x=m||[],_=this.currentGlobalDefines().concat(x),j=ms.cacheKey(Sc[i],i,_,o);return this.cache[j]||(this.cache[j]=new ms(this.context,i,Sc[i],o,Uc[i],_)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=n.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,o,m){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const _=x.getOpacity(this.transform.pitch),j=((S,C,D,I,O,Z,Q,ee,Y,se,F)=>{const K=S.transform,ae=C.properties.get("color").toArray01();ae[3]=I;const le=S.frameCounter/1e3%1;return{u_fog_matrix:D?K.calculateFogTileMatrix(D):S.identityMat,u_fog_range:C.getFovAdjustedRange(K._fov),u_fog_color:ae,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:le,u_frustum_tl:O,u_frustum_tr:Z,u_frustum_br:Q,u_frustum_bl:ee,u_globe_pos:Y,u_globe_radius:se,u_viewport:F,u_globe_transition:n.globeToMercatorTransition(K.zoom),u_is_globe:+(K.projection.name==="globe")}})(this,x,m,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.exported.devicePixelRatio,this.transform.height*n.exported.devicePixelRatio]);o.setFogUniformValues(i,j)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)o[x.key]=i[x.key]||new n.Tile(x,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class xl{constructor(i=0,o=0,m=0,x=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=m,this.right=x}interpolate(i,o,m){return o.top!=null&&i.top!=null&&(this.top=n.number(i.top,o.top,m)),o.bottom!=null&&i.bottom!=null&&(this.bottom=n.number(i.bottom,o.bottom,m)),o.left!=null&&i.left!=null&&(this.left=n.number(i.left,o.left,m)),o.right!=null&&i.right!=null&&(this.right=n.number(i.right,o.right,m)),this}getCenter(i,o){const m=n.clamp((this.left+i-this.right)/2,0,i),x=n.clamp((this.top+o-this.bottom)/2,0,o);return new n.Point(m,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new xl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yl(u,i){const o=n.getColumn(u,3);n.fromQuat(u,i),n.setColumn(u,3,o)}function fs(u,i){const o=n.identity$1([]);return n.rotateZ$1(o,o,-i),n.rotateX$1(o,o,-u),o}function jo(u,i){const o=[u[0],u[1],0],m=[i[0],i[1],0];if(n.length(o)>=1e-15){const j=n.normalize([],o);n.scale$2(m,j,n.dot(m,j)),i[0]=m[0],i[1]=m[1]}const x=n.cross([],i,u);if(n.len(x)<1e-15)return null;const _=Math.atan2(-x[1],x[0]);return fs(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}class Mu{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof n.MercatorCoordinate?i:new n.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=n.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const m=this.position,x=this._elevation?this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(i)):0,_=n.MercatorCoordinate.fromLngLat(i,x),j=[_.x-m.x,_.y-m.y,_.z-m.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=jo(j,o)}setPitchBearing(i,o){this.orientation=fs(n.degToRad(i),n.degToRad(-o))}}class _l{constructor(i,o){this._transform=n.identity([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new n.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=n.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&n.setColumn(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||n.identity$1([]),i&&yl(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=fs(i,o),yl(this._transform,this._orientation)}forward(){const i=n.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=n.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=n.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const m=new Float64Array(16);return n.invert(m,this.getWorldToCamera(i,o)),m}getWorldToCameraPosition(i,o,m){const x=this.position;n.scale$2(x,x,-i);const _=new Float64Array(16);return n.fromScaling(_,[m,m,m]),n.translate(_,_,x),_[10]*=o,_}getWorldToCamera(i,o){const m=new Float64Array(16),x=new Float64Array(4),_=this.position;return n.conjugate(x,this._orientation),n.scale$2(_,_,-i),n.fromQuat(m,x),n.translate(m,m,_),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=o,m[9]*=o,m[10]*=o,m[11]*=o,m}getCameraToClipPerspective(i,o,m,x){const _=new Float64Array(16);return n.perspective(_,i,o,m,x),_}getDistanceToElevation(i,o=!1){const m=i===0?0:n.mercatorZfromAltitude(i,o?n.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(m-this.position[2])/x[2]}clone(){return new _l([...this.position],[...this.orientation])}}function ka(u,i){const o=bl(u.projection,u.zoom,u.width,u.height),m=function(_,j,S,C,D){const I=new n.LngLat(S.lng-180*pn,S.lat),O=new n.LngLat(S.lng+180*pn,S.lat),Z=_.project(I.lng,I.lat),Q=_.project(O.lng,O.lat),ee=-Math.atan2(Q.y-Z.y,Q.x-Z.x),Y=n.MercatorCoordinate.fromLngLat(S);Y.y=n.clamp(Y.y,-1+pn,1-pn);const se=Y.toLngLat(),F=_.project(se.lng,se.lat),K=n.MercatorCoordinate.fromLngLat(se);K.x+=pn;const ae=K.toLngLat(),le=_.project(ae.lng,ae.lat),_e=vl(le.x-F.x,le.y-F.y,ee),ve=n.MercatorCoordinate.fromLngLat(se);ve.y+=pn;const be=ve.toLngLat(),Ae=_.project(be.lng,be.lat),Ce=vl(Ae.x-F.x,Ae.y-F.y,ee),Oe=Math.abs(_e.x)/Math.abs(Ce.y),at=n.identity([]);n.rotateZ(at,at,-ee*(1-(D?0:C)));const Le=n.identity([]);return n.scale(Le,Le,[1,1-(1-Oe)*C,1]),Le[4]=-Ce.x/Ce.y*C,n.rotateZ(Le,Le,ee),n.multiply(Le,at,Le),Le}(u.projection,0,u.center,o,i),x=Pu(u);return n.scale(m,m,[x,x,1]),m}function Pu(u){const i=u.projection,o=bl(u.projection,u.zoom,u.width,u.height),m=Iu(i,u.center),x=Iu(i,n.LngLat.convert(i.center));return Math.pow(2,m*o+(1-o)*x)}function bl(u,i,o,m,x=1/0){const _=u.range;if(!_)return 0;const j=Math.min(x,Math.max(o,m)),S=Math.log(j/1024)/Math.LN2;return n.smoothstep(_[0]+S,_[1]+S,i)}const pn=1/4e4;function Iu(u,i){const o=n.clamp(i.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=new n.LngLat(i.lng-180*pn,o),x=new n.LngLat(i.lng+180*pn,o),_=u.project(m.lng,o),j=u.project(x.lng,o),S=n.MercatorCoordinate.fromLngLat(m),C=n.MercatorCoordinate.fromLngLat(x),D=j.x-_.x,I=j.y-_.y,O=C.x-S.x,Z=C.y-S.y,Q=Math.sqrt((O*O+Z*Z)/(D*D+I*I));return Math.log(Q)/Math.LN2}function vl(u,i,o){const m=Math.cos(o),x=Math.sin(o);return{x:u*m-i*x,y:u*x+i*m}}class Aa{constructor(i,o,m,x,_,j,S){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(j),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new _l,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new Aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,o=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(i||m)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=n.getProjection(this.projectionOptions);const m=!P(o,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.getProjection({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.Point(this.width,this.height)}get bearing(){return n.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;var m;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(m=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(x,_,j){var S=_[0],C=_[1],D=_[2],I=_[3],O=Math.sin(j),Z=Math.cos(j);x[0]=S*Z+D*O,x[1]=C*Z+I*O,x[2]=S*-O+D*Z,x[3]=C*-O+I*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=n.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=n.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,_=0;for(let j=0;j<o.length;j++){const S=new n.Point(o[j][0]*this.width,m+o[j][1]*(this.height-m)),C=i.pointCoordinate(S);if(!C)continue;const D=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);x+=C[3]*D,_+=D}return _===0?NaN:x/_}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*o,x=this._mercatorZfromZoom(i),_=this._mercatorZfromZoom(this._maxZoom),j=Math.max(x-m,_);this._setZoom(this._zoomFromMercatorZ(j))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const x=n.length(n.sub([],this._camera.position,m));return n.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!n.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];n.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new Mu;return o.position=new n.MercatorCoordinate(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!n.length$1(i))return!1;n.normalize$1(i,i);const o=n.transformQuat([],[0,0,-1],i),m=n.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const x=jo(o,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=n.clamp(i[2],x/m,x/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,m){this._unmodified=!1,this._edgeInsets.interpolate(i,o,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new n.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new n.Point(0,0)),x=this.pointCoordinate(new n.Point(this.width,0)),_=this.pointCoordinate(new n.Point(this.width,this.height)),j=this.pointCoordinate(new n.Point(0,this.height)),S=Math.floor(Math.min(m.x,x.x,_.x,j.x)),C=Math.floor(Math.max(m.x,x.x,_.x,j.x)),D=1;for(let I=S-D;I<=C+D;I++)I!==0&&o.push(new n.UnwrappedTileID(I,i))}return o}coveringTiles(i){let o=this.coveringZoomLevel(i);const m=o,x=this.elevation&&!i.isTerrainDEM,_=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const j=this.locationCoordinate(this.center),S=this.center.lat,C=1<<o,D=[C*j.x,C*j.y,0],I=this.projection.name==="globe",O=!I,Z=n.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,O),Q=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=C*n.mercatorZfromAltitude(1,this.center.lat),Y=this._camera.position[2]/n.mercatorZfromAltitude(1,this.center.lat),se=[C*Q.x,C*Q.y,Y*(O?1:ee)],F=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,ae=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=i.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,_e=this.projection.isReprojectedInTileSpace?Pu(this):1,ve=ze=>{const ct=new n.MercatorCoordinate(ze.x+25e-6,ze.y,ze.z),tt=new n.MercatorCoordinate(ze.x,ze.y+25e-6,ze.z),dt=ze.toLngLat(),Dt=ct.toLngLat(),Vt=tt.toLngLat(),kt=this.locationCoordinate(dt),Ft=this.locationCoordinate(Dt),ns=this.locationCoordinate(Vt),es=Math.hypot(Ft.x-kt.x,Ft.y-kt.y),It=Math.hypot(ns.x-kt.x,ns.y-kt.y);return Math.sqrt(es*It)*_e/25e-6},be=ze=>{const Xe=ae,ct=le;return{aabb:n.tileAABB(this,C,0,0,0,ze,ct,Xe,this.projection),zoom:0,x:0,y:0,minZ:ct,maxZ:Xe,wrap:ze,fullyVisible:!1}},Ae=[];let Ce=[];const Oe=o,at=i.reparseOverscaled?m:o,Le=ze=>ze*ze,Qe=Le((Y-this._centerAltitude)*ee),Ue=ze=>{if(!this._elevation||!ze.tileID||!_)return;const Xe=this._elevation.getMinMaxForTile(ze.tileID),ct=ze.aabb;Xe?(ct.min[2]=Xe.min,ct.max[2]=Xe.max,ct.center[2]=(ct.min[2]+ct.max[2])/2):(ze.shouldSplit=nt(ze),ze.shouldSplit||(ct.min[2]=ct.max[2]=ct.center[2]=this._centerAltitude))},nt=ze=>{if(ze.zoom<K)return!0;if(ze.zoom===Oe)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const Xe=ze.aabb.distanceX(se),ct=ze.aabb.distanceY(se);let tt=Qe,dt=1;if(I){tt=Le(ze.aabb.distanceZ(se));const kt=Math.pow(2,ze.zoom),Ft=n.latFromMercatorY((ze.y+1)/kt),ns=n.latFromMercatorY(ze.y/kt),es=Math.min(Math.max(S,Ft),ns),It=n.circumferenceAtLatitude(es)/n.circumferenceAtLatitude(S);if(dt=es===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,It/this._mercatorScaleRatio),this.zoom<=n.GLOBE_ZOOM_THRESHOLD_MIN&&ze.zoom===Oe-1&&It>=.9)return!0}else if(x&&(tt=Le(ze.aabb.distanceZ(se)*ee)),this.projection.isReprojectedInTileSpace&&m<=5){const kt=Math.pow(2,ze.zoom),Ft=ve(new n.MercatorCoordinate((ze.x+.5)/kt,(ze.y+.5)/kt));dt=Ft>.85?1:Ft}const Dt=Xe*Xe+ct*ct+tt,Vt=Le((1<<Oe-ze.zoom)*F*dt*((kt,Ft)=>{if(Ft*Le(.707)<kt)return 1;const ns=Math.sqrt(Ft/kt);return ns/(1.4144271570014144+(Math.pow(1.1,ns-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(tt,Qe),Dt));return Dt<Vt};if(this.renderWorldCopies)for(let ze=1;ze<=3;ze++)Ae.push(be(-ze)),Ae.push(be(ze));for(Ae.push(be(0));Ae.length>0;){const ze=Ae.pop(),Xe=ze.x,ct=ze.y;let tt=ze.fullyVisible;if(!tt){const dt=ze.aabb.intersects(Z);if(dt===0)continue;tt=dt===2}if(ze.zoom!==Oe&&nt(ze))for(let dt=0;dt<4;dt++){const Dt=(Xe<<1)+dt%2,Vt=(ct<<1)+(dt>>1),kt={aabb:_?ze.aabb.quadrant(dt):n.tileAABB(this,C,ze.zoom+1,Dt,Vt,ze.wrap,ze.minZ,ze.maxZ,this.projection),zoom:ze.zoom+1,x:Dt,y:Vt,wrap:ze.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:ze.minZ,maxZ:ze.maxZ};x&&!I&&(kt.tileID=new n.OverscaledTileID(ze.zoom+1===Oe?at:ze.zoom+1,ze.wrap,ze.zoom+1,Dt,Vt),Ue(kt)),Ae.push(kt)}else{const dt=ze.zoom===Oe?at:ze.zoom;if(i.minzoom&&i.minzoom>dt)continue;const Dt=D[0]-(.5+Xe+(ze.wrap<<ze.zoom))*(1<<o-ze.zoom),Vt=D[1]-.5-ct,kt=ze.tileID?ze.tileID:new n.OverscaledTileID(dt,ze.wrap,ze.zoom,Xe,ct);Ce.push({tileID:kt,distanceSq:Dt*Dt+Vt*Vt})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq,Xe=this.horizonLineFromTop();Ce=Ce.filter(ct=>{const tt=[0,0,0,1],dt=[n.EXTENT,n.EXTENT,0,1],Dt=this.calculateFogTileMatrix(ct.tileID.toUnwrapped());n.transformMat4$1(tt,tt,Dt),n.transformMat4$1(dt,dt,Dt);const Vt=n.getAABBPointSquareDist(tt,dt);if(Vt===0)return!0;let kt=!1;const Ft=this._elevation;if(Ft&&Vt>ze&&Xe!==0){const ns=this.calculateProjMatrix(ct.tileID.toUnwrapped());let es;i.isTerrainDEM||(es=Ft.getMinMaxForTile(ct.tileID)),es||(es={min:le,max:ae});const It=n.furthestTileCorner(this.rotation),ws=[It[0]*n.EXTENT,It[1]*n.EXTENT,es.max];n.transformMat4(ws,ws,ns),kt=(1-ws[1])*this.height*.5<Xe}return Vt<ze||kt})}return Ce.sort((ze,Xe)=>ze.distanceSq-Xe.distanceSq).map(ze=>ze.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=n.clamp(i.lat,-n.MAX_MERCATOR_LATITUDE,n.MAX_MERCATOR_LATITUDE),m=this.projection.project(i.lng,o);return new n.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let m,x;const _=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;m=(o.x-_.x)/S,x=(o.y-_.y)/S}else{const S=this.pointCoordinate(o),C=this.pointCoordinate(_);m=S.x-C.x,x=S.y-C.y}const j=this.locationCoordinate(i);this.setLocation(new n.MercatorCoordinate(j.x-m,j.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const m=o?n.mercatorZfromAltitude(o,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new n.MercatorCoordinate(x.x,x.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const m=o??this._centerAltitude,x=[i.x,i.y,0,1],_=[i.x,i.y,1,1];n.transformMat4$1(x,x,this.pixelMatrixInverse),n.transformMat4$1(_,_,this.pixelMatrixInverse);const j=_[3];n.scale$1(x,x,1/x[3]),n.scale$1(_,_,1/j);const S=x[2],C=_[2];return{p0:x,p1:_,t:S===C?0:(m-S)/(C-S)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return n.transformMat4$1(o,o,this.pixelMatrixInverse),n.transformMat4$1(m,m,this.pixelMatrixInverse),n.scale$1(o,o,1/o[3]),n.scale$1(m,m,1/m[3]),o[2]=n.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,m[2]=n.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,n.scale$1(o,o,1/this.worldSize),n.scale$1(m,m,1/this.worldSize),new n.Ray([o[0],o[1],o[2]],n.normalize([],n.sub([],m,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:m,t:x}=i,_=n.mercatorZfromAltitude(o[2],this._center.lat),j=n.mercatorZfromAltitude(m[2],this._center.lat);return new n.MercatorCoordinate(n.number(o[0],m[0],x)/this.worldSize,n.number(o[1],m[1],x)/this.worldSize,n.number(_,j,x))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let o=this.projection.pointCoordinate3D(this,i.x,i.y);if(o)return new n.MercatorCoordinate(o[0],o[1],o[2]);let m=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const _=.02*x,j=i.clone();for(let S=0;S<10&&x-m>_;S++){j.y=n.number(m,x,.66);const C=this.projection.pointCoordinate3D(this,j.x,j.y);C?(x=j.y,o=C):m=j.y}return o?new n.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const m=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return n.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new n.Point(x[0]/x[3],x[1]/x[3]):new n.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,_=this.pointLocation3D(new n.Point(o,i)),j=this.pointLocation3D(new n.Point(x,i)),S=this.pointLocation3D(new n.Point(x,m)),C=this.pointLocation3D(new n.Point(o,m));let D=Math.min(_.lng,j.lng,S.lng,C.lng),I=Math.max(_.lng,j.lng,S.lng,C.lng),O=Math.min(_.lat,j.lat,S.lat,C.lat),Z=Math.max(_.lat,j.lat,S.lat,C.lat);const Q=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,Y=(se,F,K,ae,le)=>{const _e=(se+K)/2,ve=(F+ae)/2,be=new n.Point(_e,ve),{lng:Ae,lat:Ce}=this.pointLocation3D(be),Oe=Math.max(0,D-Ae,O-Ce,Ae-I,Ce-Z);D=Math.min(D,Ae),I=Math.max(I,Ae),O=Math.min(O,Ce),Z=Math.max(Z,Ce),(le<ee||Oe>Q)&&(Y(se,F,_e,ve,le+1),Y(_e,ve,K,ae,le+1))};if(Y(o,i,x,i,1),Y(x,i,x,m,1),Y(x,m,o,m,1),Y(o,m,o,i,1),this.projection.name==="globe"){const[se,F]=n.polesInViewport(this);se?(Z=90,I=180,D=-180):F&&(O=-90,I=180,D=-180)}return new n.LngLatBounds(new n.LngLat(D,O),new n.LngLat(I,Z))}_getBoundsRectangular(i,o){const{top:m,left:x}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,j=this.width-this._edgeInsets.right,S=new n.Point(x,m),C=new n.Point(j,m),D=new n.Point(j,_),I=new n.Point(x,_);let O=this.pointCoordinate(S,i),Z=this.pointCoordinate(C,i);const Q=this.pointCoordinate(D,o),ee=this.pointCoordinate(I,o),Y=(se,F)=>(F.y-se.y)/(F.x-se.x);return O.y>1&&Z.y>=0?O=new n.MercatorCoordinate((1-ee.y)/Y(ee,O)+ee.x,1):O.y<0&&Z.y<=1&&(O=new n.MercatorCoordinate(-ee.y/Y(ee,O)+ee.x,0)),Z.y>1&&O.y>=0?Z=new n.MercatorCoordinate((1-Q.y)/Y(Q,Z)+Q.x,1):Z.y<0&&O.y<=1&&(Z=new n.MercatorCoordinate(-Q.y/Y(Q,Z)+Q.x,0)),new n.LngLatBounds().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((m,x)=>{if(x.dem){const _=x.dem.tree;m.min=Math.min(m.min,_.minimums[0]),m.max=Math.max(m.max,_.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-n.MAX_MERCATOR_LATITUDE,this.maxLat=n.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=n.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=n.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=n.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,m=this._distanceTileDataCache;if(m[o])return m[o];const x=i.canonical,_=1/this.height,j=this.cameraWorldSize,S=j/this.zoomScale(x.z),C=(x.x+Math.pow(2,x.z)*i.wrap)*S,D=x.y*S,I=this.point;I.x*=j/this.worldSize,I.y*=j/this.worldSize;const O=this.angle,Z=Math.sin(-O),Q=-Math.cos(-O);return m[o]={bearing:[Z,Q],center:[(I.x-C)*_,(I.y-D)*_],scale:S/n.EXTENT*_},m[o]}calculateFogTileMatrix(i){const o=i.key,m=this._fogTileMatrixCache;if(m[o])return m[o];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return n.multiply(x,this.worldToFogMatrix,x),m[o]=new Float32Array(x),m[o]}calculateProjMatrix(i,o=!1){const m=i.key,x=o?this._alignedProjMatrixCache:this._projMatrixCache;if(x[m])return x[m];const _=this.calculatePosMatrix(i,this.worldSize);return n.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,_),x[m]=new Float32Array(_),x[m]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[o])return m[o];const x=function(_,j){const{scale:S}=_.tileTransform,C=S*n.EXTENT/(_.tileSize*Math.pow(2,j.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return D=new Float32Array(4),Z=(I=j.inverseAdjustmentMatrix)[1],Q=I[2],ee=I[3],se=(O=[C,C])[1],D[0]=I[0]*(Y=O[0]),D[1]=Z*Y,D[2]=Q*se,D[3]=ee*se,D;var D,I,O,Z,Q,ee,Y,se}(i,this);return m[o]=x,m[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,o=n.fromScaling([],[i,i,i]);return n.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const o=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(o),x=this._camera.forward(),_=n.mercatorZfromAltitude(1,this._center.lat);m[2]/=_,x[2]/=_,n.normalize(x,x);const j=i.raycast(m,x,i.exaggeration());if(j){const S=n.scaleAndAdd([],m,x,j),C=new n.MercatorCoordinate(S[0],S[1],n.mercatorZfromAltitude(S[2],n.latFromMercatorY(S[1]))),D=(C.z+n.length([C.x-m[0],C.y-m[1],C.z-m[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,m=n.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(m),_=o.getAtPointOrZero(new n.MercatorCoordinate(...x)),j=this.pixelsPerMeter/this.worldSize*_,S=this._minimumHeightOverTerrain(),C=x[2]-j;if(C<=S)if(C<0||i){const D=this.locationCoordinate(this._center,this._centerAltitude),I=[x[0],x[1],D.z-x[2]],O=n.length(I);I[2]-=(S-C)/this._pixelsPerMercatorPixel;const Z=n.length(I);if(Z===0)return;n.scale$2(I,I,O/Z*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],D.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const Z=this.center;return Z.lat=n.clamp(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(Z.lng=n.clamp(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const o=this._unmodified,{x:m,y:x}=this.point;let _=0,j=m,S=x;const C=this.width/2,D=this.height/2,I=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(x-D<I&&(S=I+D),x+D>O&&(S=O-D),O-I<this.height&&(_=Math.max(_,this.height/(O-I)),S=(O+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,ee=this.worldSize/2-(Z+Q)/2;j=(m+ee+this.worldSize)%this.worldSize-ee,j-C<Z&&(j=Z+C),j+C>Q&&(j=Q-C),Q-Z<this.width&&(_=Math.max(_,this.width/(Q-Z)),j=(Q+Z)/2)}j===m&&S===x||(this.center=this.unproject(new n.Point(j,S))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.mercatorZfromAltitude(1,this.center.lat)/n.mercatorZfromAltitude(1,n.GLOBE_SCALE_MATCH_LATITUDE));const m=bl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?o:1,_=this._camera.getWorldToCamera(this.worldSize,x),j=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);j[8]=2*-i.x/this.width,j[9]=2*i.y/this.height;let S=n.mul([],j,_);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),be=n.identity([]);n.translate(be,be,[ve.x*this.worldSize,ve.y*this.worldSize,0]),n.multiply(be,be,ka(this)),n.translate(be,be,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),n.multiply(S,S,be),this.inverseAdjustmentMatrix=function(Ae){const Ce=ka(Ae,!0);return ke([],[Ce[0],Ce[1],Ce[4],Ce[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=n.scale([],S,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=S,this.invProjMatrix=n.invert(new Float64Array(16),this.projMatrix);const C=n.invert([],j);this.frustumCorners=n.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);n.identity(D),n.scale(D,D,[1,-1,1]),n.rotateX(D,D,this._pitch),n.rotateZ(D,D,this.angle);const I=n.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;I[8]=2*-i.x/this.width,I[9]=2*(i.y+O)/this.height,this.skyboxMatrix=n.multiply(D,I,D);const Z=this.point,Q=Z.x,ee=Z.y,Y=this.width%2/2,se=this.height%2/2,F=Math.cos(this.angle),K=Math.sin(this.angle),ae=Q-Math.round(Q)+F*Y+K*se,le=ee-Math.round(ee)+F*se+K*Y,_e=new Float64Array(S);if(n.translate(_e,_e,[ae>.5?ae-1:ae,le>.5?le-1:le,0]),this.alignedProjMatrix=_e,S=n.create(),n.scale(S,S,[this.width/2,-this.height/2,1]),n.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=n.create(),n.scale(S,S,[1,-1,1]),n.translate(S,S,[-1,-1,0]),n.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=n.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.calculateGlobeMatrix(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.transformMat4(ve,ve,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,_=[i,i,o];n.scale$2(_,_,x),n.scale$2(m,m,-1),n.multiply$2(m,m,_);const j=n.create();n.translate(j,j,m),n.scale(j,j,_),this.mercatorFogMatrix=j,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,x)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*_,x.y/this.worldSize-m[1]*_,i/this.worldSize*this._centerAltitude-m[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],x=i[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(_=Math.min((o-m)/x,1)),this._camera.position=n.scaleAndAdd([],this._camera.position,i,_),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),_=n.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,j=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.degToRad(this._maxPitch)),S=Math.max((i[2]-_)/Math.cos(m),j),C=this._zoomFromMercatorZ(S);n.scaleAndAdd(i,i,o,S),this._pitch=n.clamp(m,n.degToRad(this.minPitch),n.degToRad(this.maxPitch)),this.angle=n.wrap(x,-Math.PI,Math.PI),this._setZoom(n.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,m=n.GLOBE_ZOOM_THRESHOLD_MAX,x=0,_=1/0;for(;m-o>1e-6&&m>o;){const j=o+.5*(m-o),S=this.tileSize*Math.pow(2,j),C=this.getCameraToCenterDistance(this.projection,j,S),D=this.scaleZoom(C/(i*this.tileSize)),I=Math.abs(j-D);I<_&&(_=I,x=j),j<D?o=j:m=j}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const m=Math.min(i.x,o.x),x=Math.max(i.x,o.x),_=Math.min(i.y,o.y),j=Math.max(i.y,o.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new n.Point(m,_),new n.Point(x,j),new n.Point(m,j),new n.Point(x,_)],C=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const I of S){const O=this.pointRayIntersection(I);if(O.t<0)return!0;const Z=this.rayIntersectionCoordinate(O);if(Z.x<C||Z.y<0||Z.x>D||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.Point(0,0),new n.Point(this.width,this.height))}zoomDeltaToMovement(i,o){const m=n.length(n.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(m)+o;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([o,m,x],_){const j=[o,m,x,1];n.transformMat4$1(j,j,_);const S=j[3]=Math.max(j[3],1e-6);return j[0]/=S,j[1]/=S,j[2]/=S,j}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.Point(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.Point(0,i))}}getCameraToCenterDistance(i,o=this.zoom,m=this.worldSize){const x=bl(i,o,this.width,this.height,1024),_=i.pixelSpaceConversion(this.center.lat,m,x);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.multiply(i,i,this.globeMatrix),i}}function Ma(u,i){let o=!1,m=null;const x=()=>{m=null,o&&(u(),m=setTimeout(x,i),o=!1)};return()=>(o=!0,m||x(),m)}class $c{constructor(i){this._hashName=i&&encodeURIComponent(i),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ma(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,n.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),n.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=No(i);if(this._hashName){const m=this._hashName;let x=!1;const _=n.window.location.hash.slice(1).split("&").map(j=>{const S=j.split("=")[0];return S===m?(x=!0,`${S}=${o}`):j}).filter(j=>j);return x||_.push(`${m}=${o}`),`#${_.join("&")}`}return`#${o}`}_getCurrentHash(){const i=n.window.location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(o=m)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(m=>isNaN(m))){const m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:m,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=n.window.location.href.replace(/(#.+)?$/,this.getHashString());n.window.history.replaceState(n.window.history.state,null,i)}}function No(u,i){const o=u.getCenter(),m=Math.round(100*u.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,x),j=Math.round(o.lng*_)/_,S=Math.round(o.lat*_)/_,C=u.getBearing(),D=u.getPitch();let I=i?`/${j}/${S}/${m}`:`${m}/${S}/${j}`;return(C||D)&&(I+="/"+Math.round(10*C)/10),D&&(I+=`/${Math.round(D)}`),I}const So={linearity:.3,easing:n.bezier(0,0,.3,1)},wl=n.extend({deceleration:2500,maxSpeed:1400},So),jl=n.extend({deceleration:20,maxSpeed:1400},So),Tt=n.extend({deceleration:1e3,maxSpeed:360},So),zi=n.extend({deceleration:1e3,maxSpeed:90},So);class Du{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=n.exported.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new n.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(o.pan.mag()){const _=Eo(o.pan.mag(),m,n.extend({},wl,i||{}));x.offset=o.pan.mult(_.amount/o.pan.mag()),x.center=this._map.transform.center,To(x,_)}if(o.zoom){const _=Eo(o.zoom,m,jl);x.zoom=this._map.transform.zoom+_.amount,To(x,_)}if(o.bearing){const _=Eo(o.bearing,m,Tt);x.bearing=this._map.transform.bearing+n.clamp(_.amount,-179,179),To(x,_)}if(o.pitch){const _=Eo(o.pitch,m,zi);x.pitch=this._map.transform.pitch+_.amount,To(x,_)}if(x.zoom||x.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;x.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function To(u,i){(!u.duration||u.duration<i.duration)&&(u.duration=i.duration,u.easing=i.easing)}function Eo(u,i,o){const{maxSpeed:m,linearity:x,deceleration:_}=o,j=n.clamp(u*x/(i/1e3),-m,m),S=Math.abs(j)/(_*x);return{easing:o.easing,duration:1e3*S,amount:j*(S/2)}}class Mr extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m,x={}){const _=Pe(o.getCanvasContainer(),m),j=o.unproject(_);super(i,n.extend({point:_,lngLat:j,originalEvent:m},x)),this._defaultPrevented=!1,this.target=o}}class Co extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m){const x=i==="touchend"?m.changedTouches:m.touches,_=Se(o.getCanvasContainer(),x),j=_.map(C=>o.unproject(C)),S=_.reduce((C,D,I,O)=>C.add(D.div(O.length)),new n.Point(0,0));super(i,{points:_,point:S,lngLats:j,lngLat:o.unproject(S),originalEvent:m}),this._defaultPrevented=!1}}class Nl extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class Gc{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Nl(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Mr(i.type,this._map,i))}mouseup(i){this._map.fire(new Mr(i.type,this._map,i))}preclick(i){const o=n.extend({},i);o.type="preclick",this._map.fire(new Mr(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Mr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Mr(i.type,this._map,i))}mouseover(i){this._map.fire(new Mr(i.type,this._map,i))}mouseout(i){this._map.fire(new Mr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Co(i.type,this._map,i))}touchmove(i){this._map.fire(new Co(i.type,this._map,i))}touchend(i){this._map.fire(new Co(i.type,this._map,i))}touchcancel(i){this._map.fire(new Co(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sl{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Mr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Mr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lu{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(ne(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const m=o,x=this._startPos,_=this._lastPos;if(!x||!_||_.equals(m)||!this._box&&m.dist(x)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=W("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const j=Math.min(x.x,m.x),S=Math.max(x.x,m.x),C=Math.min(x.y,m.y),D=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${j}px,${C}px)`,this._box.style.width=S-j+"px",this._box.style.height=D-C+"px")})}mouseupWindow(i,o){if(!this._active)return;const m=this._startPos,x=o;if(m&&i.button===0){if(this.reset(),me(),m.x!==x.x||m.y!==x.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),te(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new n.Event(i,{originalEvent:o}))}}function Tl(u,i){const o={};for(let m=0;m<u.length;m++)o[u[m].identifier]=i[m];return o}class Pa{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const _=new n.Point(0,0);for(const j of x)_._add(j);return _.div(x.length)}(o),this.touches=Tl(m,o)))}touchmove(i,o,m){if(this.aborted||!this.centroid)return;const x=Tl(m,o);for(const _ in this.touches){const j=x[_];(!j||j.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Zc{constructor(i){this.singleTap=new Pa(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,m){this.singleTap.touchstart(i,o,m)}touchmove(i,o,m){this.singleTap.touchmove(i,o,m)}touchend(i,o,m){const x=this.singleTap.touchend(i,o,m);if(x){const _=i.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(x)<30;if(_&&j||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Pm{constructor(){this._zoomIn=new Zc({numTouches:1,numTaps:2}),this._zoomOut=new Zc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,m){this._zoomIn.touchstart(i,o,m),this._zoomOut.touchstart(i,o,m)}touchmove(i,o,m){this._zoomIn.touchmove(i,o,m),this._zoomOut.touchmove(i,o,m)}touchend(i,o,m){const x=this._zoomIn.touchend(i,o,m),_=this._zoomOut.touchend(i,o,m);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()+1,around:j.unproject(x)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()-1,around:j.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ru={0:1,2:2};class Ia{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const m=fe(i);this._correctButton(i,m)&&(this._lastPoint=o,this._eventButton=m)}mousemoveWindow(i,o){const m=this._lastPoint;if(m){if(i.preventDefault(),this._eventButton!=null&&function(x,_){const j=Ru[_];return x.buttons===void 0||(x.buttons&j)!==j}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(m,o)}}mouseupWindow(i){this._lastPoint&&fe(i)===this._eventButton&&(this._moved&&me(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wc extends Ia{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class Hc extends Ia{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const m=.8*(o.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class Xc extends Ia{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const m=-.5*(o.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class El{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.Point(0,0)}touchstart(i,o,m){return this._calculateTransform(i,o,m)}touchmove(i,o,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!n.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,m)}}touchend(i,o,m){this._calculateTransform(i,o,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,m){m.length>0&&(this._active=!0);const x=Tl(m,o),_=new n.Point(0,0),j=new n.Point(0,0);let S=0;for(const D in x){const I=x[D],O=this._touches[D];O&&(_._add(I),j._add(I.sub(O)),S++,x[D]=I)}if(this._touches=x,S<this._minTouches||!j.mag())return;const C=j.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ko{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,m){return{}}touchstart(i,o,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,m){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[_,j]=x,S=Ao(m,o,_),C=Ao(m,o,j);if(!S||!C)return;const D=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],D,i)}touchend(i,o,m){if(!this._firstTwoTouches)return;const[x,_]=this._firstTwoTouches,j=Ao(m,o,x),S=Ao(m,o,_);j&&S||(this._active&&me(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ao(u,i,o){for(let m=0;m<u.length;m++)if(u[m].identifier===o)return i[m]}function Kc(u,i){return Math.log(u/i)/Math.LN2}class zu extends ko{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,m),pinchAround:o}}}function Qc(u,i){return 180*u.angleWith(i)/Math.PI}class Ou extends ko{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const m=this._vector;if(this._vector=i[0].sub(i[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Qc(this._vector,m),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const x=Qc(i,m);return Math.abs(x)<o}}function Pn(u){return Math.abs(u.y)>Math.abs(u.x)}class Fu extends ko{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Pn(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,m){const x=this._lastPoints;if(!x)return;const _=i[0].sub(x[0]),j=i[1].sub(x[1]);return this._map._cooperativeGestures&&!n.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(_,j,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+j.y)/2*-.5})}gestureBeginsVertically(i,o,m){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,_=o.mag()>=2;if(!x&&!_)return;if(!x||!_)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const j=i.y>0==o.y>0;return Pn(i)&&Pn(o)&&j}}const Bu={panStep:100,bearingStep:15,pitchStep:10};class Im{constructor(){const i=Bu;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,m=0,x=0,_=0,j=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),j=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:S=>{const C=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Uu,zoom:o?Math.round(C)+o*(i.shiftKey?2:1):C,bearing:S.getBearing()+m*this._bearingStep,pitch:S.getPitch()+x*this._pitchStep,offset:[-_*this._panStep,-j*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Uu(u){return u*(2-u)}const Jc=4.000244140625;class Vu{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||n.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===n.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=n.exported.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,o!==0&&o%Jc==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Pe(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Jc?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&D!==0&&(D=1/D);const I=o(),O=Math.pow(2,I),Z=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(Z*D))),this._type==="wheel"&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:o(),x=this._startZoom,_=this._easing;let j,S=!1;if(this._type==="wheel"&&x&&_){const C=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),D=_(C);j=n.number(x,m,D),C<1?this._frameId||(this._frameId=!0):S=!0}else j=m,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:j-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=n.ease;if(this._prevEase){const m=this._prevEase,x=(n.exported.now()-m.start)/m.duration,_=m.easing(x+.01)-m.easing(x),j=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-j*j);o=n.bezier(j,S,.25,1)}return this._prevEase={start:n.exported.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(n.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class qu{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dm{constructor(){this._tap=new Zc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=o[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,o,m))}touchmove(i,o,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=o[0],_=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,m)}touchend(i,o,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(i,o,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $u{constructor(i,o,m){this._el=i,this._mousePan=o,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Lm{constructor(i,o,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rm{constructor(i,o,m,x){this._el=i,this._touchZoom=o,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ti=u=>u.zoom||u.drag||u.pitch||u.rotate;class Gu extends n.Event{}class zm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const m=n.sub([],o,i);this.radius=n.length(m[2]<0?n.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){n.div(i,i,this.constants),n.normalize(i,i),n.mul$1(i,i,this.constants);const o=n.scale$2([],i,this.radius);if(o[2]>0){const m=n.scale$2([],[0,0,1],n.dot(o,[0,0,1])),x=n.scale$2([],n.normalize([],[o[0],o[1],0]),this.radius),_=n.add([],o,n.scale$2([],n.sub([],n.add([],x,m),o),2));o[0]=_[0],o[1]=_[1]}return o}}function Oi(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Wi{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Du(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[n.window.document,"mousemove",{capture:!0}],[n.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[n.window,"blur",void 0]];for(const[x,_,j]of this._listeners)x.addEventListener(_,x===n.window.document?this.handleWindowEvent:this.handleEvent,j)}destroy(){for(const[i,o,m]of this._listeners)i.removeEventListener(o,i===n.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const o=this._map,m=o.getCanvasContainer();this._add("mapEvent",new Gc(o,i));const x=o.boxZoom=new Lu(o,i);this._add("boxZoom",x);const _=new Pm,j=new Zr;o.doubleClickZoom=new qu(j,_),this._add("tapZoom",_),this._add("clickZoom",j);const S=new Dm;this._add("tapDragZoom",S);const C=o.touchPitch=new Fu(o);this._add("touchPitch",C);const D=new Hc(i),I=new Xc(i);o.dragRotate=new Lm(i,D,I),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const O=new Wc(i),Z=new El(o,i);o.dragPan=new $u(m,O,Z),this._add("mousePan",O),this._add("touchPan",Z,["touchZoom","touchRotate"]);const Q=new Ou,ee=new zu;o.touchZoomRotate=new Rm(m,ee,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sl(o));const Y=o.scrollZoom=new Vu(o,this);this._add("scrollZoom",Y,["mousePan"]);const se=o.keyboard=new Im;this._add("keyboard",se);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[F]&&o[F].enable(i[F])}_add(i,o,m){this._handlers.push({handlerName:i,handler:o,allowed:m}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ti(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,m){for(const x in i)if(x!==m&&(!o||o.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const m of i)this._el.contains(m.target)&&o.push(m);return o}handleEvent(i,o){this._updatingCamera=!0;const m=i.type==="renderFrame",x=m?void 0:i,_={needsRenderFrame:!1},j={},S={},C=i.touches?this._getMapTouches(i.touches):void 0,D=C?Se(this._el,C):m?void 0:Pe(this._el,i);for(const{handlerName:Z,handler:Q,allowed:ee}of this._handlers){if(!Q.isEnabled())continue;let Y;this._blockedByActive(S,ee,Z)?Q.reset():Q[o||i.type]&&(Y=Q[o||i.type](i,D,C),this.mergeHandlerResult(_,j,Y,Z,x),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||Q.isActive())&&(S[Z]=Q)}const I={};for(const Z in this._previousActiveHandlers)S[Z]||(I[Z]=x);this._previousActiveHandlers=S,(Object.keys(I).length||Oi(_))&&(this._changes.push([_,j,I]),this._triggerRenderFrame()),(Object.keys(S).length||Oi(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=_;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(i,o,m,x,_){if(!m)return;n.extend(i,m);const j={handlerName:x,originalEvent:m.originalEvent||_};m.zoomDelta!==void 0&&(o.zoom=j),m.panDelta!==void 0&&(o.drag=j),m.pitchDelta!==void 0&&(o.pitch=j),m.bearingDelta!==void 0&&(o.rotate=j)}_applyChanges(){const i={},o={},m={};for(const[x,_,j]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new n.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),n.extend(o,_),n.extend(m,j);this._updateMapTransform(i,o,m),this._changes=[]}_updateMapTransform(i,o,m){const x=this._map,_=x.transform,j=K=>[K.x,K.y,K.z];if((K=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!Oi(i)){const K=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",K!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&x._stop(!0),!Oi(i))return void this._fireEvents(o,m,!0);let{panDelta:S,zoomDelta:C,bearingDelta:D,pitchDelta:I,around:O,aroundCoord:Z,pinchAround:Q}=i;_._isCameraConstrained&&(C>0&&(C=0),_._isCameraConstrained=!1),Q!==void 0&&(O=Q),(C||(K=>o[K]&&!this._eventsInProgress[K])("drag"))&&O&&(this._dragOrigin=j(_.pointCoordinate3D(O)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",x._stop(!0),O=O||x.transform.centerPoint,D&&(_.bearing+=D),I&&(_.pitch+=I),_._updateCameraState();const ee=[0,0,0];if(S)if(_.projection.name==="mercator"){const K=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O).dir),ae=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O.sub(S)).dir);ee[0]=ae[0]-K[0],ee[1]=ae[1]-K[1]}else{const K=_.pointCoordinate(O);if(_.projection.name==="globe"){S=S.rotate(-_.angle);const ae=_._pixelsPerMercatorPixel/_.worldSize;ee[0]=-S.x*n.mercatorScale(n.latFromMercatorY(K.y))*ae,ee[1]=-S.y*n.mercatorScale(_.center.lat)*ae}else{const ae=_.pointCoordinate(O.sub(S));K&&ae&&(ee[0]=ae.x-K.x,ee[1]=ae.y-K.y)}}const Y=_.zoom,se=[0,0,0];if(C){const K=j(Z||_.pointCoordinate3D(O)),ae={dir:n.normalize([],n.sub([],K,_._camera.position))};if(ae.dir[2]<0){const le=_.zoomDeltaToMovement(K,C);n.scale$2(se,ae.dir,le)}}const F=n.add(ee,ee,se);_._translateCameraConstrained(F),C&&Math.abs(_.zoom-Y)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,m,!0)}_fireEvents(i,o,m){const x=Ti(this._eventsInProgress),_=Ti(i),j={};for(const I in i){const{originalEvent:O}=i[I];this._eventsInProgress[I]||(j[`${I}start`]=O),this._eventsInProgress[I]=i[I]}!x&&_&&this._fireEvent("movestart",_.originalEvent);for(const I in j)this._fireEvent(I,j[I]);_&&this._fireEvent("move",_.originalEvent);for(const I in i){const{originalEvent:O}=i[I];this._fireEvent(I,O)}const S={};let C;for(const I in this._eventsInProgress){const{handlerName:O,originalEvent:Z}=this._eventsInProgress[I];this._handlersById[O].isActive()||(delete this._eventsInProgress[I],C=o[O]||Z,S[`${I}end`]=C)}for(const I in S)this._fireEvent(I,S[I]);const D=Ti(this._eventsInProgress);if(m&&(x||_)&&!D){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;I?(O(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:C})):(this._map.fire(new n.Event("moveend",{originalEvent:C})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new n.Event(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Gu("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ta="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Cl extends n.Evented{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,m){return i=n.Point.convert(i).mult(-1),this.panTo(this.transform.center,n.extend({offset:i},o),m)}panTo(i,o,m){return this.easeTo(n.extend({center:i},o),m)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,m){return this.easeTo(n.extend({zoom:i},o),m)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,m){return this.easeTo(n.extend({bearing:i},o),m)}resetNorth(i,o){return this.rotateTo(0,n.extend({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=n.LngLatBounds.convert(i);const m=o&&o.bearing||0,x=o&&o.pitch||0,_=i.getNorthWest(),j=i.getSouthEast();return this._cameraForBounds(this.transform,_,j,m,x,o)}_extendCameraOptions(i){const o={top:0,bottom:0,right:0,left:0};if(typeof(i=n.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const m=i.padding;i.padding={top:m,bottom:m,right:m,left:m}}return i.padding=n.extend(o,i.padding),i}_minimumAABBFrustumDistance(i,o){const m=o.max[0]-o.min[0],x=o.max[1]-o.min[1];return m/x>i.aspect?m/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,m,x,_,j){const S=i.clone(),C=this._extendCameraOptions(j);S.bearing=x,S.pitch=_;const D=n.LngLat.convert(o),I=n.LngLat.convert(m),O=.5*(D.lat+I.lat),Z=.5*(D.lng+I.lng),Q=n.latLngToECEF(O,Z),ee=n.normalize([],Q),Y=n.normalize([],n.cross([],ee,[0,1,0])),se=n.cross([],Y,ee),F=[Y[0],Y[1],Y[2],0,se[0],se[1],se[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],K=[Q,n.latLngToECEF(D.lat,D.lng),n.latLngToECEF(I.lat,D.lng),n.latLngToECEF(I.lat,I.lng),n.latLngToECEF(D.lat,I.lng),n.latLngToECEF(O,D.lng),n.latLngToECEF(O,I.lng),n.latLngToECEF(D.lat,Z),n.latLngToECEF(I.lat,Z)];let ae=n.Aabb.fromPoints(K.map(tt=>[n.dot(Y,tt),n.dot(se,tt),n.dot(ee,tt)]));const le=n.transformMat4([],ae.center,F);n.squaredLength(le)===0&&n.set(le,0,0,1),n.normalize(le,le),n.scale$2(le,le,n.GLOBE_RADIUS),S.center=n.ecefToLatLng(le);const _e=S.getWorldToCameraMatrix(),ve=n.invert(new Float64Array(16),_e);ae=n.Aabb.applyTransform(ae,n.multiply([],_e,F)),n.transformMat4(le,le,_e);const be=.5*(ae.max[2]-ae.min[2]),Ae=this._minimumAABBFrustumDistance(S,ae),Ce=n.scale$2([],[0,0,1],be),Oe=n.add(Ce,le,Ce),at=Ae+(S.pitch===0?0:n.distance(le,Oe)),Le=S.globeCenterInViewSpace,Qe=n.sub([],le,[Le[0],Le[1],Le[2]]);n.normalize(Qe,Qe),n.scale$2(Qe,Qe,at);const Ue=n.add([],le,Qe);n.transformMat4(Ue,Ue,ve);const nt=n.earthRadius/n.GLOBE_RADIUS,ze=n.length(Ue),Xe=n.mercatorZfromAltitude(Math.max(ze*nt-n.earthRadius,Number.EPSILON),0),ct=Math.min(S.zoomFromMercatorZAdjusted(Xe),C.maxZoom);return ct>.5*(n.GLOBE_ZOOM_THRESHOLD_MIN+n.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=ct,this._cameraForBounds(S,o,m,x,_,j)):{center:S.center,zoom:ct,bearing:x,pitch:_}}queryTerrainElevation(i,o){const m=this.transform.elevation;return m?(o=n.extend({},{exaggerated:!0},o),m.getAtPoint(n.MercatorCoordinate.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,m,x,_,j){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,o,m,x,_,j);const S=i.clone(),C=this._extendCameraOptions(j),D=S.padding;S.bearing=x,S.pitch=_;const I=n.LngLat.convert(o),O=n.LngLat.convert(m),Z=new n.LngLat(I.lng,O.lat),Q=new n.LngLat(O.lng,I.lat),ee=S.project(I),Y=S.project(O),se=this.queryTerrainElevation(I),F=this.queryTerrainElevation(O),K=this.queryTerrainElevation(Z),ae=this.queryTerrainElevation(Q),le=[[ee.x,ee.y,Math.min(se||0,F||0,K||0,ae||0)],[Y.x,Y.y,Math.max(se||0,F||0,K||0,ae||0)]];let _e=n.Aabb.fromPoints(le);const ve=S.getWorldToCameraMatrix(),be=n.invert(new Float64Array(16),ve);_e=n.Aabb.applyTransform(_e,ve);const Ae=n.sub([],_e.max,_e.min),Ce=D.left||0,Oe=D.right||0,at=D.bottom||0,Le=D.top||0,{left:Qe,right:Ue,top:nt,bottom:ze}=C.padding,Xe=.5*(Ce+Oe),ct=.5*(Le+at),tt=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(Ce+Oe+Qe+Ue))/Ae[0],(S.height-(at+Le+ze+nt))/Ae[1])),C.maxZoom),dt=S.scale/S.zoomScale(tt);_e=new n.Aabb([_e.min[0]-(Qe+Xe)*dt,_e.min[1]-(ze+ct)*dt,_e.min[2]],[_e.max[0]+(Ue+Xe)*dt,_e.max[1]+(nt+ct)*dt,_e.max[2]]);const Dt=.5*Ae[2],Vt=this._minimumAABBFrustumDistance(S,_e),kt=[0,0,1,0];n.transformMat4$1(kt,kt,ve),n.normalize$2(kt,kt);const Ft=n.scale$2([],kt,Vt+Dt),ns=n.add([],_e.center,Ft),es=(typeof C.offset.x=="number"&&typeof C.offset.y=="number"?new n.Point(C.offset.x,C.offset.y):n.Point.convert(C.offset)).rotate(-n.degToRad(x));_e.center[0]-=es.x*dt,_e.center[1]+=es.y*dt,n.transformMat4(_e.center,_e.center,be),n.transformMat4(ns,ns,be);const It=[_e.center[0],_e.center[1],ns[2]*S.pixelsPerMeter];n.scale$2(It,It,1/S.worldSize);const ws=n.lngFromMercatorX(It[0]),Ss=n.latFromMercatorY(It[1]),Ts=Math.min(S._zoomFromMercatorZ(It[2]),C.maxZoom),Es=new n.LngLat(ws,Ss);return S.mercatorFromTransition&&Ts<.5*(n.GLOBE_ZOOM_THRESHOLD_MIN+n.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=Ts,this._cameraForBounds(S,o,m,x,_,j)):{center:Es,zoom:Ts,bearing:x,pitch:_}}fitBounds(i,o,m){const x=this.cameraForBounds(i,o);return this._fitInternal(x,o,m)}fitScreenCoordinates(i,o,m,x,_){const j=n.Point.convert(i),S=n.Point.convert(o),C=new n.Point(Math.min(j.x,S.x),Math.min(j.y,S.y)),D=new n.Point(Math.max(j.x,S.x),Math.max(j.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(j,S))return this;const I=this.transform.pointLocation3D(C),O=this.transform.pointLocation3D(D),Z=this.transform.pointLocation3D(new n.Point(C.x,D.y)),Q=this.transform.pointLocation3D(new n.Point(D.x,C.y)),ee=[Math.min(I.lng,O.lng,Z.lng,Q.lng),Math.min(I.lat,O.lat,Z.lat,Q.lat)],Y=[Math.max(I.lng,O.lng,Z.lng,Q.lng),Math.max(I.lat,O.lat,Z.lat,Q.lat)],se=x&&x.pitch?x.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,ee,Y,m,se,x);return this._fitInternal(F,x,_)}_fitInternal(i,o,m){return i?(delete(o=n.extend(i,o)).padding,o.linear?this.easeTo(o,m):this.flyTo(o,m)):this}jumpTo(i,o){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let x=!1,_=!1,j=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(x=!0,m.zoom=+i.zoom),i.center!==void 0&&(m.center=n.LngLat.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(_=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(j=!0,m.pitch=+i.pitch),i.padding==null||m.isPaddingEqual(i.padding)||(m.padding=i.padding),i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),x&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),_&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),j&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.warnOnce(ta),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const m=this.transform;if(!m.projection.supportsFreeCamera)return n.warnOnce(ta),this;this.stop();const x=m.zoom,_=m.pitch,j=m.bearing;m.setFreeCameraOptions(i);const S=x!==m.zoom,C=_!==m.pitch,D=j!==m.bearing;return this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),S&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),D&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),C&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=n.extend({offset:[0,0],duration:500,easing:n.ease},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const m=this.transform,x=this.getZoom(),_=this.getBearing(),j=this.getPitch(),S=this.getPadding(),C="zoom"in i?+i.zoom:x,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:j,O="padding"in i?i.padding:m.padding,Z=n.Point.convert(i.offset);let Q,ee,Y;if(m.projection.name==="globe"){const Ce=n.MercatorCoordinate.fromLngLat(m.center),Oe=Z.rotate(-m.angle);Ce.x+=Oe.x/m.worldSize,Ce.y+=Oe.y/m.worldSize;const at=Ce.toLngLat(),Le=n.LngLat.convert(i.center||at);this._normalizeCenter(Le),Q=m.centerPoint.add(Oe),ee=new n.Point(Ce.x,Ce.y).mult(m.worldSize),Y=new n.Point(n.mercatorXfromLng(Le.lng),n.mercatorYfromLat(Le.lat)).mult(m.worldSize).sub(ee)}else{Q=m.centerPoint.add(Z);const Ce=m.pointLocation(Q),Oe=n.LngLat.convert(i.center||Ce);this._normalizeCenter(Oe),ee=m.project(Ce),Y=m.project(Oe).sub(ee)}const se=m.zoomScale(C-x);let F,K;i.around&&(F=n.LngLat.convert(i.around),K=m.locationPoint(F));const ae=this._zooming||C!==x,le=this._rotating||_!==D,_e=this._pitching||I!==j,ve=!m.isPaddingEqual(O),be=Ce=>Oe=>{if(ae&&(Ce.zoom=n.number(x,C,Oe)),le&&(Ce.bearing=n.number(_,D,Oe)),_e&&(Ce.pitch=n.number(j,I,Oe)),ve&&(Ce.interpolatePadding(S,O,Oe),Q=Ce.centerPoint.add(Z)),F)Ce.setLocationAtPoint(F,K);else{const at=Ce.zoomScale(Ce.zoom-x),Le=C>x?Math.min(2,se):Math.max(.5,se),Qe=Math.pow(Le,1-Oe),Ue=Ce.unproject(ee.add(Y.mult(Oe*Qe)).mult(at));Ce.setLocationAtPoint(Ce.renderWorldCopies?Ue.wrap():Ue,Q)}return i.preloadOnly||this._fireMoveEvents(o),Ce};if(i.preloadOnly){const Ce=this._emulate(be,i.duration,m);return this._preloadTiles(Ce),this}const Ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=le,this._pitching=_e,this._padding=ve,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,Ae),this._ease(be(m),Ce=>{m.recenterOnTerrain(),this._afterEase(o,Ce)},i),this}_prepareEase(i,o,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||m.moving||this.fire(new n.Event("movestart",i)),this._zooming&&!m.zooming&&this.fire(new n.Event("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new n.Event("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new n.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new n.Event("move",i)),this._zooming&&this.fire(new n.Event("zoom",i)),this._rotating&&this.fire(new n.Event("rotate",i)),this._pitching&&this.fire(new n.Event("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new n.Event("zoomend",i)),x&&this.fire(new n.Event("rotateend",i)),_&&this.fire(new n.Event("pitchend",i)),this.fire(new n.Event("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const tt=n.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tt,o)}this.stop(),i=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},i);const m=this.transform,x=this.getZoom(),_=this.getBearing(),j=this.getPitch(),S=this.getPadding(),C="zoom"in i?n.clamp(+i.zoom,m.minZoom,m.maxZoom):x,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:j,O="padding"in i?i.padding:m.padding,Z=m.zoomScale(C-x),Q=n.Point.convert(i.offset);let ee=m.centerPoint.add(Q);const Y=m.pointLocation(ee),se=n.LngLat.convert(i.center||Y);this._normalizeCenter(se);const F=m.project(Y),K=m.project(se).sub(F);let ae=i.curve;const le=Math.max(m.width,m.height),_e=le/Z,ve=K.mag();if("minZoom"in i){const tt=n.clamp(Math.min(i.minZoom,x,C),m.minZoom,m.maxZoom),dt=le/m.zoomScale(tt-x);ae=Math.sqrt(dt/ve*2)}const be=ae*ae;function Ae(tt){const dt=(_e*_e-le*le+(tt?-1:1)*be*be*ve*ve)/(2*(tt?_e:le)*be*ve);return Math.log(Math.sqrt(dt*dt+1)-dt)}function Ce(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function Oe(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const at=Ae(0);let Le=function(tt){return Oe(at)/Oe(at+ae*tt)},Qe=function(tt){return le*((Oe(at)*(Ce(dt=at+ae*tt)/Oe(dt))-Ce(at))/be)/ve;var dt},Ue=(Ae(1)-at)/ae;if(Math.abs(ve)<1e-6||!isFinite(Ue)){if(Math.abs(le-_e)<1e-6)return this.easeTo(i,o);const tt=_e<le?-1:1;Ue=Math.abs(Math.log(_e/le))/ae,Qe=function(){return 0},Le=function(dt){return Math.exp(tt*ae*dt)}}i.duration="duration"in i?+i.duration:1e3*Ue/("screenSpeed"in i?+i.screenSpeed/ae:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const nt=_!==D,ze=I!==j,Xe=!m.isPaddingEqual(O),ct=tt=>dt=>{const Dt=dt*Ue,Vt=1/Le(Dt);tt.zoom=dt===1?C:x+tt.scaleZoom(Vt),nt&&(tt.bearing=n.number(_,D,dt)),ze&&(tt.pitch=n.number(j,I,dt)),Xe&&(tt.interpolatePadding(S,O,dt),ee=tt.centerPoint.add(Q));const kt=dt===1?se:tt.unproject(F.add(K.mult(Qe(Dt))).mult(Vt));return tt.setLocationAtPoint(tt.renderWorldCopies?kt.wrap():kt,ee),tt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),tt};if(i.preloadOnly){const tt=this._emulate(ct,i.duration,m);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=nt,this._pitching=ze,this._padding=Xe,this._prepareEase(o,!1),this._ease(ct(m),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,o)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,o,m){m.animate===!1||m.duration===0?(i(1),o()):(this._easeStart=n.exported.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=n.wrap(i,-180,180);const m=Math.abs(i-o);return Math.abs(i-360-o)<m&&(i-=360),Math.abs(i+360-o)<m&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const m=i.lng-o.center.lng;i.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&n.exported.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,m){const x=Math.ceil(15*o/1e3),_=[],j=i(m.clone());for(let S=0;S<=x;S++){const C=j(S/x);_.push(C.clone())}return _}}class Et{constructor(i={}){this.options=i,n.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact;return this._map=i,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W("button","mapboxgl-ctrl-attrib-button",this._container),W("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const m=this._map._getUIString(`AttributionControl.${o}`);i.setAttribute("aria-label",m),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.config.ACCESS_TOKEN}];if(i){const m=o.reduce((x,_,j)=>(_.value&&(x+=`${_.key}=${_.value}${j<o.length-1?"&":""}`),x),"?");i.href=`${n.config.FEEDBACK_URL}/${m}#${No(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const o=this._map.style._sourceCaches;for(const x in o){const _=o[x];if(_.used){const j=_.getSource();j.attribution&&i.indexOf(j.attribution)<0&&i.push(j.attribution)}}i.sort((x,_)=>x.length-_.length),i=i.filter((x,_)=>{for(let j=_+1;j<i.length;j++)if(i[j].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yc{constructor(){n.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=W("div","mapboxgl-ctrl");const o=W("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const m=i[o].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class ed{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,m=o?this._queue.concat(o):this._queue;for(const x of m)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const m of o)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Da(u,i,o){if(u=new n.LngLat(u.lng,u.lat),i){const m=new n.LngLat(u.lng-360,u.lat),x=new n.LngLat(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-o.center.lng)/360),j=o.locationPoint(u).distSqr(i),S=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(m).distSqr(i)<j&&(S||Math.abs(m.lng-o.center.lng)<_)?u=m:o.locationPoint(x).distSqr(i)<j&&(S||Math.abs(x.lng-o.center.lng)<_)&&(u=x)}for(;Math.abs(u.lng-o.center.lng)>180;){const m=o.locationPoint(u);if(m.x>=0&&m.y>=0&&m.x<=o.width&&m.y<=o.height)break;u.lng>o.center.lng?u.lng-=360:u.lng+=360}return u}const sa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class jt extends n.Evented{constructor(i,o){if(super(),(i instanceof n.window.HTMLElement||o)&&(i=n.extend({element:i},o)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=n.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=W("div");const x=41,_=27,j=H("svg",{display:"block",height:x*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${x}`},this._element),S=H("radialGradient",{id:"shadowGradient"},H("defs",{},j));H("stop",{offset:"10%","stop-opacity":.4},S),H("stop",{offset:"100%","stop-opacity":.05},S),H("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},j),H("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},j),H("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},j),H("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},j),this._offset=n.Point.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const m=this._element.classList;for(const x in sa)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=n.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,m=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,m=this._element;this._popup&&(o===m||m.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const m=i.unproject(o),x=i.getFreeCameraOptions();if(!x.position)return!1;const _=x.position.toLngLat();return _.distanceTo(m)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const m=i.unproject(o);let x;i._showingGlobe()&&n.isLngLatBehindGlobe(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${sa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const i=this._pos,o=this._map,m=this.getPitchAlignment();if(!o||!i||m!=="map")return"";if(!o._showingGlobe()){const C=o.getPitch();return C?`rotateX(${C}deg)`:""}const x=n.radToDeg(n.globeTiltAtLngLat(o.transform,this._lngLat)),_=i.sub(n.globeCenterToScreenPoint(o.transform)),j=Math.abs(_.x)+Math.abs(_.y);if(j===0)return"";const S=x/j;return`rotateX(${-_.y*S}deg) rotateY(${_.x*S}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let m=0;const x=this.getRotationAlignment();if(x==="map")if(o._showingGlobe()){const _=o.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),j=o.project(new n.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);m=n.radToDeg(Math.atan2(j.y,j.x))-90}else m=-o.getBearing();else if(x==="horizon"){const _=n.smoothstep(4,6,o.getZoom()),j=n.globeCenterToScreenPoint(o.transform);j.y+=_*o.transform.height;const S=i.sub(j),C=n.radToDeg(Math.atan2(S.y,S.x));m=(C>90?C-270:C+90)*(1-_)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){n.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Da(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),i===!0?this._updateFrameId=n.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=n.Point.convert(i),this._update(),this}_onMove(i){const o=this._map;if(!o)return;const m=this._pointerdownPos,x=this._positionDelta;if(m&&x){if(!this._isDragging){const _=this._clickTolerance||o._clickTolerance;if(i.point.dist(m)<_)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,m=this._pos;o&&m&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(m),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const td={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Om=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zu(u=new n.Point(0,0),i="bottom"){if(typeof u=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(i){case"top":return new n.Point(0,u);case"top-left":return new n.Point(o,o);case"top-right":return new n.Point(-o,o);case"bottom":return new n.Point(0,-u);case"bottom-left":return new n.Point(o,-o);case"bottom-right":return new n.Point(-o,-o);case"left":return new n.Point(u,0);case"right":return new n.Point(-u,0)}return new n.Point(0,0)}return u instanceof n.Point||Array.isArray(u)?n.Point.convert(u):n.Point.convert(u[i]||[0,0])}class sd{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=n.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,m){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+m}}const Wu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Hu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Fm={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bm{constructor(i,o,m=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Hc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new Xc({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),ne()}move(i,o){const m=this.map,x=this.mouseRotate.mousemoveWindow(i,o),_=x&&x.bearingDelta;if(_&&m.setBearing(m.getBearing()+_),this.mousePitch){const j=this.mousePitch.mousemoveWindow(i,o),S=j&&j.pitchDelta;S&&m.setPitch(m.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){te(),n.window.removeEventListener("mousemove",this.mousemove),n.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(n.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Pe(this.element,i)),n.window.addEventListener("mousemove",this.mousemove),n.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Pe(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Se(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Se(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const rd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},id={maxWidth:100,unit:"metric"},nd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},La={version:n.version,supported:z,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends Cl{constructor(u){if(n.LivePerformanceUtils.mark(n.PerformanceMarkers.create),(u=n.extend({},Hu,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&n.isSafariWithAntialiasingBug(n.window)&&(u.antialias=!1,n.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Aa(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._useWebGL2=u.useWebGL2,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._optimizeForTerrain=u.optimizeForTerrain,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new ed,this._domRenderTaskQueue=new ed,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.uniqueId(),this._locale=n.extend({},Wu,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new n.RequestManager(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,typeof u.container=="string"){if(this._container=n.window.document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof n.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&n.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),n.window!==void 0&&(n.window.addEventListener("online",this._onWindowOnline,!1),n.window.addEventListener("resize",this._onWindowResize,!1),n.window.addEventListener("orientationchange",this._onWindowResize,!1),n.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Wi(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this._hash=u.hash&&new $c(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,n.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),u.attributionControl&&this.addControl(new Et({customAttribution:u.customAttribution})),this._logoControl=new Yc,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new n.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new n.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(u,i){if(i===void 0&&(i=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=u.onAdd(this);this._controls.push(u);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(o,m.firstChild):m.appendChild(o),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(u);return i>-1&&this._controls.splice(i,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new n.Event("movestart",u)).fire(new n.Event("move",u)),this.fire(new n.Event("resize",u)),i&&this.fire(new n.Event("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(n.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new n.Event("zoomstart")).fire(new n.Event("zoom")).fire(new n.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new n.Event("pitchstart")).fire(new n.Event("pitch")).fire(new n.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?n.window.navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(i=>i==="auto"?n.window.navigator.language:i):u}setLanguage(u){const i=this._parseLanguage(u);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,i=u.projection.name;let o;i==="globe"&&u.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?(u.setMercatorFromTransition(),o=!0):i==="mercator"&&u.zoom<n.GLOBE_ZOOM_THRESHOLD_MAX&&(u.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,i){return this._updateProjection(u||i||{name:"mercator"})}_updateProjection(u){let i;if(i=u.name==="globe"&&this.transform.zoom>=n.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(u){return this.transform.locationPoint3D(n.LngLat.convert(u))}unproject(u){return this.transform.pointLocation3D(n.Point.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,i,o){if(u==="mouseenter"||u==="mouseover"){let m=!1;const x=j=>{const S=i.filter(D=>this.getLayer(D)),C=S.length?this.queryRenderedFeatures(j.point,{layers:S}):[];C.length?m||(m=!0,o.call(this,new Mr(u,this,j.originalEvent,{features:C}))):m=!1},_=()=>{m=!1};return{layers:new Set(i),listener:o,delegates:{mousemove:x,mouseout:_}}}if(u==="mouseleave"||u==="mouseout"){let m=!1;const x=j=>{const S=i.filter(C=>this.getLayer(C));(S.length?this.queryRenderedFeatures(j.point,{layers:S}):[]).length?m=!0:m&&(m=!1,o.call(this,new Mr(u,this,j.originalEvent)))},_=j=>{m&&(m=!1,o.call(this,new Mr(u,this,j.originalEvent)))};return{layers:new Set(i),listener:o,delegates:{mousemove:x,mouseout:_}}}{const m=x=>{const _=i.filter(S=>this.getLayer(S)),j=_.length?this.queryRenderedFeatures(x.point,{layers:_}):[];j.length&&(x.features=j,o.call(this,x),delete x.features)};return{layers:new Set(i),listener:o,delegates:{[u]:m}}}}on(u,i,o){if(o===void 0)return super.on(u,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(u,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(u,i,o){if(o===void 0)return super.once(u,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(u,i,o);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(u,i,o){if(o===void 0)return super.off(u,i);i=new Set(Array.isArray(i)?i:[i]);const m=(_,j)=>{if(_.size!==j.size)return!1;for(const S of _)if(!j.has(S))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[u]:void 0;return x&&(_=>{for(let j=0;j<_.length;j++){const S=_[j];if(S.listener===o&&m(S.layers,i)){for(const C in S.delegates)this.off(C,S.delegates[C]);return _.splice(j,1),this}}})(x),this}queryRenderedFeatures(u,i){return this.style?(i!==void 0||u===void 0||u instanceof n.Point||Array.isArray(u)||(i=u,u=void 0),this.style.queryRenderedFeatures(u=u||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(u,i){return this.style.querySourceFeatures(u,i)}isPointOnSurface(u){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&n.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.Point.convert(u))}setStyle(u,i){return(i=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(u,i))}_getUIString(u){const i=this._locale[u];if(i==null)throw new Error(`Missing UI string '${u}'`);return i}_updateStyle(u,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new Gi(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Gi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,i){if(typeof u=="string"){const o=this._requestManager.normalizeStyleURL(u),m=this._requestManager.transformRequest(o,n.ResourceType.Style);n.getJSON(m,(x,_)=>{x?this.fire(new n.ErrorEvent(x)):_&&this._updateDiff(_,i)})}else typeof u=="object"&&this._updateDiff(u,i)}_updateDiff(u,i){try{this.style.setState(u)&&this._update(!0)}catch(o){n.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(u,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.warnOnce("There is no style added to the map."),!1)}addSource(u,i){return this._lazyInitEmptyStyle(),this.style.addSource(u,i),this._update(!0)}isSourceLoaded(u){return!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){const u=this.style&&this.style._sourceCaches;for(const i in u){const o=u[i]._tiles;for(const m in o){const x=o[m];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(u,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(u,i,o)}removeSource(u){return this.style.removeSource(u),this._updateTerrain(),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,i,{pixelRatio:o=1,sdf:m=!1,stretchX:x,stretchY:_,content:j}={}){if(this._lazyInitEmptyStyle(),i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap){const{width:S,height:C,data:D}=n.exported.getImageData(i);this.style.addImage(u,{data:new n.RGBAImage({width:S,height:C},D),pixelRatio:o,stretchX:x,stretchY:_,content:j,sdf:m,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:C}=i,D=i;this.style.addImage(u,{data:new n.RGBAImage({width:S,height:C},new Uint8Array(D.data)),pixelRatio:o,stretchX:x,stretchY:_,content:j,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,u)}}updateImage(u,i){const o=this.style.getImage(u);if(!o)return void this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap?n.exported.getImageData(i):i,{width:x,height:_}=m;x!==void 0&&_!==void 0?x===o.data.width&&_===o.data.height?(o.data.replace(m.data,!(i instanceof n.window.HTMLImageElement||n.window.ImageBitmap&&i instanceof n.window.ImageBitmap)),this.style.updateImage(u,o)):this.fire(new n.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${_})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`))):this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,i){n.getImage(this._requestManager.transformRequest(u,n.ResourceType.Image),(o,m)=>{i(o,m instanceof n.window.HTMLImageElement?n.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(u,i){return this._lazyInitEmptyStyle(),this.style.addLayer(u,i),this._update(!0)}moveLayer(u,i){return this.style.moveLayer(u,i),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,i,o){return this.style.setLayerZoomRange(u,i,o),this._update(!0)}setFilter(u,i,o={}){return this.style.setFilter(u,i,o),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,i,o,m={}){return this.style.setPaintProperty(u,i,o,m),this._update(!0)}getPaintProperty(u,i){return this.style.getPaintProperty(u,i)}setLayoutProperty(u,i,o,m={}){return this.style.setLayoutProperty(u,i,o,m),this._update(!0)}getLayoutProperty(u,i){return this.style.getLayoutProperty(u,i)}setLight(u,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.LngLat.convert(u),this.transform):0}setFeatureState(u,i){return this.style.setFeatureState(u,i),this._update()}removeFeatureState(u,i){return this.style.removeFeatureState(u,i),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,m,x,_=this._container;for(;_&&(!m||!x);){const j=n.window.getComputedStyle(_).transform;j&&j!=="none"&&(o=j.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(m=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(x=o[3])),_=_.parentElement}this._containerWidth=m?Math.abs(u/m):u,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){n.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=W("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=W("div","mapboxgl-canvas-container",u);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=W("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=W("div","mapboxgl-control-container",u),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=W("div",`mapboxgl-ctrl-${x}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,i){const o=n.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(u),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${i}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const i=this._markers.indexOf(u);i!==-1&&this._markers.splice(i,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const i=this._popups.indexOf(u);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const u=n.extend({},z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._useWebGL2&&this._canvas.getContext("webgl2",u),o=i||this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);o?(this._useWebGL2&&!i&&n.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),n.storeAuthState(o,!0),this.painter=new Ca(o,this.transform,!!i),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.exported$1.testSupport(o)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let i;const o=this.painter.context.extTimerQuery,m=n.exported.now();if(this.listens("gpu-timing-frame")&&(i=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],n.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],n.window.performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,C=this.transform.pitch,D=n.exported.now(),I=new n.EvaluationParameters(S,{now:D,fadeDuration:x,pitch:C,transition:this.style.getTransition()});this.style.update(I)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new n.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const S=n.exported.now()-m;o.endQueryEXT(o.TIME_ELAPSED_EXT,i),setTimeout(()=>{const C=o.getQueryObjectEXT(i,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(i),this.fire(new n.Event("gpu-timing-frame",{cpuTime:S,gpuTime:C})),n.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:C}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const C=this.painter.queryGpuTimers(S);this.fire(new n.Event("gpu-timing-layer",{layerTimes:C}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const C=this.painter.queryGpuTimeDeferredRender(S);this.fire(new n.Event("gpu-timing-deferred-render",{gpuTime:C}))},50)}const j=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(j||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(_=this._updateAverageElevation(m,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new n.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const C=this._calculateSpeedIndex();this.fire(new n.Event("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,n.LivePerformanceUtils.mark(n.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&n.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const i of this._markers)u&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!u||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(u,i=!1){const o=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((i||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const m=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=u;const j=Math.abs(m-x);if(j>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(x),o(x);this._averageElevation.easeTo(x,u,300)}else if(j>1e-4)return this._averageElevation.jumpTo(x),o(x)}return!!this._averageElevation.isEasing(u)&&o(this._averageElevation.getValue(u))}_authenticate(){n.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===n.AUTH_ERR_MSG||u.status===401)){const i=this.painter.context.gl;n.storeAuthState(i,!1),this._logoControl instanceof Yc&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),n.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,m=o.createFramebuffer();function x(_){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,_,0);const j=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,j),j}return o.bindFramebuffer(o.FRAMEBUFFER,m),this._canvasPixelComparison(x(u),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(u,i,o){let m=o[1]-o[0];const x=u.length/4;for(let _=0;_<i.length;_++){const j=i[_];let S=0;for(let C=0;C<j.length;C+=4)j[C]===u[C]&&j[C+1]===u[C+1]&&j[C+2]===u[C+2]&&j[C+3]===u[C+3]&&(S+=1);m+=(o[_+2]-o[_+1])*(1-S/x)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),n.window!==void 0&&(n.window.removeEventListener("resize",this._onWindowResize,!1),n.window.removeEventListener("orientationchange",this._onWindowResize,!1),n.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),n.window.removeEventListener("online",this._onWindowOnline,!1),n.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),n.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=n.exported.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(u){const i=this.style?Object.values(this.style._sourceCaches):[];return n.asyncAll(i,(o,m)=>o._preloadTiles(u,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){n.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,i){n.setCacheLimits(u,i)}get version(){return n.version}},NavigationControl:class{constructor(u){this.options=n.extend({},Fm,u),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),W("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),W("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=W("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const i=u.getZoom(),o=i===u.getMaxZoom(),m=i===u.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bm(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,i){const o=W("button",u,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(u,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);u.setAttribute("aria-label",o),u.firstElementChild&&u.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.Evented{constructor(u){super(),this.options=n.extend({geolocation:n.window.navigator.geolocation},rd,u),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ma(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,u(o)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):n.window.navigator.permissions!==void 0?n.window.navigator.permissions.query({name:"geolocation"}).then(o=>i(o.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(u){const i=this._map.getMaxBounds(),o=u.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("geolocate",u)),this._finish()}}_updateCamera(u){const i=new n.LngLat(u.coords.longitude,u.coords.latitude),o=u.coords.accuracy,m=this._map.getBearing(),x=n.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),x,{geolocateSource:!0})}_updateMarker(u){if(u){const i=new n.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,i=n.mercatorZfromAltitude(1,u._center.lat)*u.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new n.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=W("button","mapboxgl-ctrl-geolocate",this._container),W("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W("div","mapboxgl-user-location"),this._dotElement.appendChild(W("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(W("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new jt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=W("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{n.window.addEventListener("ondeviceorientationabsolute"in n.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};n.window.DeviceMotionEvent!==void 0&&typeof n.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),n.window.removeEventListener("deviceorientation",this._onDeviceOrientation),n.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Et,ScaleControl:class{constructor(u){this.options=n.extend({},id,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,m=i._containerWidth/2-u/2,x=i.unproject([m,o]),_=i.unproject([m+u,o]),j=x.distanceTo(_);if(this.options.unit==="imperial"){const S=3.2808*j;S>5280?this._setScale(u,S/5280,"mile"):this._setScale(u,S,"foot")}else this.options.unit==="nautical"?this._setScale(u,j/1852,"nautical-mile"):j>=1e3?this._setScale(u,j/1e3,"kilometer"):this._setScale(u,j,"meter")}_setScale(u,i,o){this._map._requestDomTask(()=>{const m=function(_){const j=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/j;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const D=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*D)/D}(S),j*S}(i),x=m/i;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(m):`${m}&nbsp;${nd[o]}`,this._container.style.width=u*x+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof n.window.HTMLElement?this._container=u.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in n.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in n.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,n.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!n.window.document.fullscreenEnabled&&!n.window.document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=W("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),n.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(n.window.document.fullscreenElement||n.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?n.window.document.exitFullscreen?n.window.document.exitFullscreen():n.window.document.webkitCancelFullScreen&&n.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.Evented{constructor(u){super(),this.options=n.extend(Object.create(td),u),n.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=n.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(n.window.document.createTextNode(u))}setHTML(u){const i=n.window.document.createDocumentFragment(),o=n.window.document.createElement("body");let m;for(o.innerHTML=u;m=o.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=W("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(u),this.options.closeButton){const o=this._closeButton=W("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let i;return this._classList.delete(u)?i=!1:(this._classList.add(u),i=!0),this._updateClassList(),i}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,m=this._pos;if(!i||!o||!m)return"bottom";const x=o.offsetWidth,_=o.offsetHeight,j=m.x<x/2,S=m.x>i.transform.width-x/2;if(m.y+u<_)return j?"top-left":S?"top-right":"top";if(m.y>i.transform.height-_){if(j)return"bottom-left";if(S)return"bottom-right"}return j?"left":S?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),u.className=i.join(" ")}_update(u){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let m=this._container;if(m||(m=this._container=W("div","mapboxgl-popup",i.getContainer()),this._tip=W("div","mapboxgl-popup-tip",m),m.appendChild(o)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Da(this._lngLat,this._pos,i.transform)),!this._trackPointer||u){const x=this._pos=this._trackPointer&&u?u:i.project(this._lngLat),_=Zu(this.options.offset),j=this._anchor=this._getAnchor(_.y),S=Zu(this.options.offset,j),C=x.add(S).round();i._requestDomTask(()=>{this._container&&j&&(this._container.style.transform=`${sa[j]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=n.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Om);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:jt,Style:Gi,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.Point,MercatorCoordinate:n.MercatorCoordinate,FreeCameraOptions:Mu,Evented:n.Evented,config:n.config,prewarm:function(){xa().acquire(Vi)},clearPrewarmedResources:function(){const u=Jr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Vi),Jr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return n.config.ACCESS_TOKEN},set accessToken(u){n.config.ACCESS_TOKEN=u},get baseApiUrl(){return n.config.API_URL},set baseApiUrl(u){n.config.API_URL=u},get workerCount(){return kr.workerCount},set workerCount(u){kr.workerCount=u},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){n.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){n.clearTileCache(u)},workerUrl:"",workerClass:null,setNow:n.exported.setNow,restoreNow:n.exported.restoreNow};return La});var A=N;return A})})(ib);var yE=ib.exports;const vi=x1(yE);async function ab(c,d){var g,f;if(!c||c.trim().length<3)return d(!1),[];d(!0);try{const w=await zr.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(c)}.json`,{params:{access_token:void 0,autocomplete:"true",language:"en",limit:5}});return(f=(g=w==null?void 0:w.data)==null?void 0:g.features)==null?void 0:f.map(N=>{const T=N.context||[],A=P=>T.find(z=>z.id.startsWith(P))||{};let n=A("country").short_code||"";return n=n?n.toUpperCase():"",{display_name:N.place_name,address_line1:N.text||"",address_line2:"",city:A("place").text||"",state:A("region").text||"",postal_code:A("postcode").text||"",country:n,lat:N.geometry.coordinates[1],lng:N.geometry.coordinates[0]}})}finally{d(!1)}}const ob=({isOpen:c,onClose:d,onSubmit:g,customer:f,loading:w=!1,title:N})=>{const{register:T,handleSubmit:A,reset:n,formState:{errors:P},setValue:z,watch:q}=kn({defaultValues:{name:"",external_id:"",tax_id:"",phone:"",email:"",account_status:"active",credit_terms_days:30}}),[U,W]=oe.useState(""),[H,G]=oe.useState(!1),[J,de]=oe.useState(null),[ne,te]=oe.useState([]),Ne=oe.useRef(null),[me,Pe]=oe.useState(null),[Se,fe]=oe.useState(null),[Be,ke]=oe.useState(!1),Ge=q("latitude"),we=q("longitude");q("delivery_window_start"),q("delivery_window_end");const Me=async ft=>{try{const Mt=await xt.customers.validate.mutate({...ft,exclude_id:f==null?void 0:f.id});return Mt.valid?(Mt.warnings.length>0&&console.warn("Customer warnings:",Mt.warnings),!0):Mt.errors[0]||"Customer validation failed"}catch(Mt){return console.error("Customer validation error:",Mt),"Failed to validate customer data"}},st=async(ft,Mt)=>{try{const mt=await xt.customers.validateCreditTerms.mutate({credit_terms_days:ft,account_status:Mt,customer_id:f==null?void 0:f.id});return mt.valid?(mt.warnings.length>0&&console.warn("Credit terms warnings:",mt.warnings),!0):mt.errors[0]||"Credit terms validation failed"}catch(mt){return console.error("Credit terms validation error:",mt),"Failed to validate credit terms"}},lt=async(ft,Mt)=>{try{const mt=await xt.customers.validateDeliveryWindow.mutate({delivery_window_start:ft,delivery_window_end:Mt});return mt.valid?(mt.warnings.length>0&&console.warn("Delivery window warnings:",mt.warnings),!0):mt.errors[0]||"Delivery window validation failed"}catch(mt){return console.error("Delivery window validation error:",mt),"Failed to validate delivery window"}};oe.useEffect(()=>{var ft,Mt,mt,Fs,ts,Is,lr,js,Sr,Tr,vs,ss,Or;if(f){if(n({name:f.name,external_id:f.external_id||"",tax_id:f.tax_id||"",phone:f.phone||"",email:f.email||"",account_status:f.account_status,credit_terms_days:f.credit_terms_days,address_label:((ft=f.primary_address)==null?void 0:ft.label)||"",line1:((Mt=f.primary_address)==null?void 0:Mt.line1)||"",line2:((mt=f.primary_address)==null?void 0:mt.line2)||"",city:((Fs=f.primary_address)==null?void 0:Fs.city)||"",state:((ts=f.primary_address)==null?void 0:ts.state)||"",postal_code:((Is=f.primary_address)==null?void 0:Is.postal_code)||"",country:((lr=f.primary_address)==null?void 0:lr.country)||"US",delivery_window_start:((js=f.primary_address)==null?void 0:js.delivery_window_start)||"",delivery_window_end:((Sr=f.primary_address)==null?void 0:Sr.delivery_window_end)||"",is_primary:((Tr=f.primary_address)==null?void 0:Tr.is_primary)||!0,instructions:((vs=f.primary_address)==null?void 0:vs.instructions)||"",latitude:(ss=f.primary_address)==null?void 0:ss.latitude,longitude:(Or=f.primary_address)==null?void 0:Or.longitude}),f.primary_address){const Cr=[f.primary_address.line1,f.primary_address.line2,f.primary_address.city,f.primary_address.state,f.primary_address.postal_code].filter(Boolean);W(Cr.join(", "))}}else n({name:"",external_id:"",tax_id:"",phone:"",email:"",account_status:"active",credit_terms_days:30,address_label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:!0,instructions:"",latitude:void 0,longitude:void 0}),W("")},[f,n]),oe.useEffect(()=>{let ft=!0;return U&&U.length>=3?(G(!0),ab(U,G).then(Mt=>{ft&&te(Mt||[])})):(te([]),G(!1)),()=>{ft=!1}},[U]),oe.useEffect(()=>{if(!me&&Ne.current&&Ge&&we){vi.accessToken=void 0;const ft=new vi.Map({container:Ne.current,style:"mapbox://styles/mapbox/streets-v11",center:[we,Ge],zoom:14});ft.addControl(new vi.NavigationControl,"top-right"),Pe(ft);const Mt=new vi.Marker({anchor:"center",draggable:Be}).setLngLat([we,Ge]).addTo(ft);fe(Mt),Mt.on("dragend",()=>{const mt=Mt.getLngLat();z("latitude",mt.lat),z("longitude",mt.lng)}),ft.on("load",()=>{ft.resize()})}},[Ne,Ge,we]),oe.useEffect(()=>{me&&Se&&Ge&&we&&(Se.setLngLat([we,Ge]),Se.setDraggable(Be),me.setCenter([we,Ge]),me.setZoom(14),me.resize())},[Ge,we,Be,me,Se]),oe.useEffect(()=>()=>{Se&&Se.remove(),me&&me.remove()},[]);const St=async ft=>{try{if(await Me({name:ft.name,email:ft.email||void 0,phone:ft.phone||void 0,external_id:ft.external_id||void 0,tax_id:ft.tax_id||void 0})!==!0||await st(ft.credit_terms_days,ft.account_status)!==!0||ft.delivery_window_start&&ft.delivery_window_end&&await lt(ft.delivery_window_start,ft.delivery_window_end)!==!0)return;const{address_label:Fs,line1:ts,line2:Is,city:lr,state:js,postal_code:Sr,country:Tr,delivery_window_start:vs,delivery_window_end:ss,is_primary:Or,instructions:Cr,latitude:Li,longitude:Wt,...gi}=ft;g({...gi,address:{label:Fs,line1:ts,line2:Is,city:lr,state:js,postal_code:Sr,country:Tr,delivery_window_start:vs||void 0,delivery_window_end:ss||void 0,is_primary:Or,instructions:Cr,latitude:Li,longitude:Wt}})}catch(Mt){console.error("Form validation error:",Mt)}};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(St),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Business Name *"}),t.jsx("input",{type:"text",id:"name",...T("name",{required:"Business name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),P.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"external_id",className:"block text-sm font-medium text-gray-700",children:"External ID"}),t.jsx("input",{type:"text",id:"external_id",...T("external_id"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"QuickBooks ID"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tax_id",className:"block text-sm font-medium text-gray-700",children:"Tax ID (VAT/EIN)"}),t.jsx("input",{type:"text",id:"tax_id",...T("tax_id"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone"}),t.jsx("input",{type:"tel",id:"phone",...T("phone"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),t.jsx("input",{type:"email",id:"email",...T("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),P.email&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.email.message})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"account_status",className:"block text-sm font-medium text-gray-700",children:"Account Status"}),t.jsxs("select",{id:"account_status",...T("account_status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"credit_hold",children:"Credit Hold"}),t.jsx("option",{value:"closed",children:"Closed"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"credit_terms_days",className:"block text-sm font-medium text-gray-700",children:"Credit Terms (Days)"}),t.jsx("input",{type:"number",id:"credit_terms_days",min:"0",...T("credit_terms_days",{required:"Credit terms is required",min:{value:0,message:"Credit terms must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),P.credit_terms_days&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.credit_terms_days.message})]})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200 mt-4",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Address"}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"address_autosuggest",className:"block text-sm font-medium text-gray-700",children:"Address *"}),t.jsx("input",{type:"text",id:"address_autosuggest",value:U,onChange:ft=>{W(ft.target.value),de(null)},className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",autoComplete:"off",placeholder:"Start typing address..."}),H&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Searching..."}),ne.length>0&&!J&&t.jsx("ul",{className:"border border-gray-200 rounded bg-white mt-1 max-h-48 overflow-y-auto z-10 relative",children:ne.map((ft,Mt)=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-50",onClick:()=>{de(ft),W(ft.display_name),z("line1",ft.address_line1||""),z("line2",ft.address_line2||""),z("city",ft.city||""),z("state",ft.state||""),z("postal_code",ft.postal_code||""),z("country",ft.country||""),z("latitude",ft.lat),z("longitude",ft.lng)},children:ft.display_name},Mt))}),J&&t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Address selected"})]})]}),Ge&&we&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{ref:Ne,style:{width:"100%",height:200,borderRadius:8,overflow:"hidden",position:"relative"}}),t.jsx("div",{className:"flex justify-end mt-2",children:Be?t.jsx("button",{type:"button",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",onClick:()=>ke(!1),children:"Save Pin Location"}):t.jsx("button",{type:"button",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs",onClick:()=>ke(!0),children:"Adjust Pin"})})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200 mt-4",children:[t.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Delivery Preferences"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_start",className:"block text-sm font-medium text-gray-700",children:"Delivery Window Start"}),t.jsx("input",{type:"time",id:"delivery_window_start",...T("delivery_window_start"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_end",className:"block text-sm font-medium text-gray-700",children:"Delivery Window End"}),t.jsx("input",{type:"time",id:"delivery_window_end",...T("delivery_window_end"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]})]}),t.jsx("div",{className:"pt-4 border-t border-gray-200 mt-4",children:t.jsxs("div",{children:[t.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-gray-700",children:"Delivery Instructions"}),t.jsx("textarea",{id:"instructions",rows:3,...T("instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate codes, special access requirements, loading dock information..."})]})})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Customer"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},ro=({isOpen:c,onClose:d,onConfirm:g,title:f,message:w,confirmText:N="Confirm",cancelText:T="Cancel",type:A="danger",loading:n=!1})=>{if(!c)return null;const z=(()=>{switch(A){case"danger":return{icon:"text-red-600",button:"bg-red-600 hover:bg-red-700 focus:ring-red-500"};case"warning":return{icon:"text-yellow-600",button:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"};default:return{icon:"text-blue-600",button:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}}})();return t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsx("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:t.jsxs("div",{className:"sm:flex sm:items-start",children:[t.jsx("div",{className:`mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full ${A==="danger"?"bg-red-100":A==="warning"?"bg-yellow-100":"bg-blue-100"} sm:mx-0 sm:h-10 sm:w-10`,children:t.jsx(Vs,{className:`h-6 w-6 ${z.icon}`})}),t.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[t.jsx("h3",{className:"text-base font-semibold leading-6 text-gray-900",children:f}),t.jsx("div",{className:"mt-2",children:t.jsx("p",{className:"text-sm text-gray-500",children:w})})]})]})}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"button",onClick:g,disabled:n,className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto ${z.button} disabled:opacity-50 disabled:cursor-not-allowed`,children:n?"Processing...":N}),t.jsx("button",{type:"button",onClick:d,disabled:n,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:T})]})]})]})})};class _E extends ei.Component{constructor(d){super(d),this.resetError=()=>{this.setState({hasError:!1,error:void 0})},this.state={hasError:!1}}static getDerivedStateFromError(d){return{hasError:!0,error:d}}componentDidCatch(d,g){console.error("Error boundary caught an error:",d,g)}render(){if(this.state.hasError){if(this.props.fallback){const d=this.props.fallback;return t.jsx(d,{error:this.state.error,resetError:this.resetError})}return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx(Vs,{className:"h-8 w-8 text-red-500"}),t.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Something went wrong"})]}),t.jsx("p",{className:"text-gray-600 mb-4",children:"An unexpected error occurred. Please try refreshing the page."}),this.state.error&&t.jsxs("details",{className:"mb-4",children:[t.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer",children:"Error details"}),t.jsx("pre",{className:"mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto",children:this.state.error.message})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:this.resetError,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Try again"}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Refresh page"})]})]})})}return this.props.children}}const bE=()=>(c,d)=>{console.error("Component error:",c,d)},vE=()=>{const c=si(),[d,g]=oe.useState({page:1}),[f,w]=oe.useState(!1),[N,T]=oe.useState(null),A=bE(),{data:n,isLoading:P,error:z,refetch:q}=N_(d),U=yS(),W=S_(),H=_S();oe.useEffect(()=>{console.log("CustomersPage state:",{filters:d,data:n,isLoading:P,error:z,isFormOpen:f})},[d,n,P,z,f]);const G=()=>{console.log("Adding new customer"),w(!0)},J=Se=>{console.log("Viewing customer:",Se),c(`/customers/${Se.id}`)},de=Se=>{console.log("Initiating customer deletion:",Se),T(Se)},ne=async(Se,fe)=>{try{console.log("Updating customer status:",{customerId:Se.id,newStatus:fe}),await W.mutateAsync({id:Se.id,account_status:fe})}catch(Be){console.error("Error updating customer status:",Be),A(Be,{customerId:Se.id,newStatus:fe})}},te=async Se=>{console.log("Form submit:",Se);try{await U.mutateAsync(Se),w(!1)}catch(fe){console.error("Form submit error:",fe),A(fe,{formData:Se})}},Ne=async()=>{if(N){console.log("Confirming delete:",N);try{await H.mutateAsync({customer_id:N.id}),T(null)}catch(Se){console.error("Delete error:",Se),A(Se,{customerId:N.id})}}},me=Se=>{console.log("Page change:",Se),g(fe=>({...fe,page:Se}))},Pe=()=>{console.log("Refreshing customers"),q()};return t.jsx(_E,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),t.jsx("p",{className:"text-gray-600",children:"Manage your customer database"}),z&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",z.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Pe,disabled:P,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(el,{className:`h-4 w-4 ${P?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:G,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Customer"})]})]})]}),t.jsx(vS,{filters:d,onFiltersChange:g}),t.jsx(bS,{customers:(n==null?void 0:n.customers)||[],loading:P,onView:J,onDelete:de,onStatusChange:ne}),n&&n.totalPages>1&&t.jsx(ac,{currentPage:n.currentPage,totalPages:n.totalPages,totalCount:n.totalCount,onPageChange:me}),t.jsx(ob,{isOpen:f,onClose:()=>{console.log("Closing form"),w(!1)},onSubmit:te,customer:void 0,loading:U.isPending,title:"Add New Customer"}),t.jsx(ro,{isOpen:!!N,onClose:()=>T(null),onConfirm:Ne,title:"Delete Customer",message:`Are you sure you want to delete "${N==null?void 0:N.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:H.isPending})]})})},wE=(c,d=5)=>xt.customers.getOrderHistory.useQuery({customer_id:c,limit:d,offset:0},{enabled:!!c&&c!=="null"&&c!=="undefined",retry:1,staleTime:3e4,select:g=>g.orders}),lb=c=>xt.customers.getAddresses.useQuery({customer_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",retry:1,staleTime:3e4,refetchOnMount:!0,refetchOnWindowFocus:!1}),cb=()=>{const c=xt.useContext();return xt.customers.createAddress.useMutation({onSuccess:d=>{console.log("Address created successfully:",d),c.customers.getAddresses.invalidate({customer_id:d.customer_id}),Pt.success("Address created successfully")},onError:d=>{console.error("Create address mutation error:",d),Pt.error(d.message||"Failed to create address")}})},jE=()=>{const c=xt.useContext();return xt.customers.updateAddress.useMutation({onSuccess:d=>{console.log("Address updated successfully:",d),c.customers.getAddresses.invalidate({customer_id:d.customer_id}),Pt.success("Address updated successfully")},onError:d=>{console.error("Update address mutation error:",d),Pt.error(d.message||"Failed to update address")}})},NE=()=>{const c=xt.useContext();return xt.customers.deleteAddress.useMutation({onSuccess:(d,g)=>{console.log("Address deleted successfully:",g.address_id),c.customers.getAddresses.invalidate(),Pt.success("Address deleted successfully")},onError:d=>{console.error("Delete address mutation error:",d),Pt.error(d.message||"Failed to delete address")}})},SE=()=>{const c=xt.useContext();return xt.customers.setPrimaryAddress.useMutation({onSuccess:(d,g)=>{console.log("Primary address set successfully:",g.address_id),d!=null&&d.customer_id?c.customers.getAddresses.invalidate({customer_id:d.customer_id}):c.customers.getAddresses.invalidate(),Pt.success("Primary address updated successfully")},onError:d=>{console.error("Set primary address mutation error:",d),Pt.error(d.message||"Failed to set primary address")}})},TE=[{code:"AF",name:"Afghanistan",flag:""},{code:"AL",name:"Albania",flag:""},{code:"DZ",name:"Algeria",flag:""},{code:"AD",name:"Andorra",flag:""},{code:"AO",name:"Angola",flag:""},{code:"AG",name:"Antigua and Barbuda",flag:""},{code:"AR",name:"Argentina",flag:""},{code:"AM",name:"Armenia",flag:""},{code:"AU",name:"Australia",flag:""},{code:"AT",name:"Austria",flag:""},{code:"AZ",name:"Azerbaijan",flag:""},{code:"BS",name:"Bahamas",flag:""},{code:"BH",name:"Bahrain",flag:""},{code:"BD",name:"Bangladesh",flag:""},{code:"BB",name:"Barbados",flag:""},{code:"BY",name:"Belarus",flag:""},{code:"BE",name:"Belgium",flag:""},{code:"BZ",name:"Belize",flag:""},{code:"BJ",name:"Benin",flag:""},{code:"BT",name:"Bhutan",flag:""},{code:"BO",name:"Bolivia",flag:""},{code:"BA",name:"Bosnia and Herzegovina",flag:""},{code:"BW",name:"Botswana",flag:""},{code:"BR",name:"Brazil",flag:""},{code:"BN",name:"Brunei",flag:""},{code:"BG",name:"Bulgaria",flag:""},{code:"BF",name:"Burkina Faso",flag:""},{code:"BI",name:"Burundi",flag:""},{code:"CV",name:"Cabo Verde",flag:""},{code:"KH",name:"Cambodia",flag:""},{code:"CM",name:"Cameroon",flag:""},{code:"CA",name:"Canada",flag:""},{code:"CF",name:"Central African Republic",flag:""},{code:"TD",name:"Chad",flag:""},{code:"CL",name:"Chile",flag:""},{code:"CN",name:"China",flag:""},{code:"CO",name:"Colombia",flag:""},{code:"KM",name:"Comoros",flag:""},{code:"CG",name:"Congo",flag:""},{code:"CD",name:"Congo (Democratic Republic)",flag:""},{code:"CR",name:"Costa Rica",flag:""},{code:"CI",name:"Cte d'Ivoire",flag:""},{code:"HR",name:"Croatia",flag:""},{code:"CU",name:"Cuba",flag:""},{code:"CY",name:"Cyprus",flag:""},{code:"CZ",name:"Czech Republic",flag:""},{code:"DK",name:"Denmark",flag:""},{code:"DJ",name:"Djibouti",flag:""},{code:"DM",name:"Dominica",flag:""},{code:"DO",name:"Dominican Republic",flag:""},{code:"EC",name:"Ecuador",flag:""},{code:"EG",name:"Egypt",flag:""},{code:"SV",name:"El Salvador",flag:""},{code:"GQ",name:"Equatorial Guinea",flag:""},{code:"ER",name:"Eritrea",flag:""},{code:"EE",name:"Estonia",flag:""},{code:"SZ",name:"Eswatini",flag:""},{code:"ET",name:"Ethiopia",flag:""},{code:"FJ",name:"Fiji",flag:""},{code:"FI",name:"Finland",flag:""},{code:"FR",name:"France",flag:""},{code:"GA",name:"Gabon",flag:""},{code:"GM",name:"Gambia",flag:""},{code:"GE",name:"Georgia",flag:""},{code:"DE",name:"Germany",flag:""},{code:"GH",name:"Ghana",flag:""},{code:"GR",name:"Greece",flag:""},{code:"GD",name:"Grenada",flag:""},{code:"GT",name:"Guatemala",flag:""},{code:"GN",name:"Guinea",flag:""},{code:"GW",name:"Guinea-Bissau",flag:""},{code:"GY",name:"Guyana",flag:""},{code:"HT",name:"Haiti",flag:""},{code:"HN",name:"Honduras",flag:""},{code:"HU",name:"Hungary",flag:""},{code:"IS",name:"Iceland",flag:""},{code:"IN",name:"India",flag:""},{code:"ID",name:"Indonesia",flag:""},{code:"IR",name:"Iran",flag:""},{code:"IQ",name:"Iraq",flag:""},{code:"IE",name:"Ireland",flag:""},{code:"IL",name:"Israel",flag:""},{code:"IT",name:"Italy",flag:""},{code:"JM",name:"Jamaica",flag:""},{code:"JP",name:"Japan",flag:""},{code:"JO",name:"Jordan",flag:""},{code:"KZ",name:"Kazakhstan",flag:""},{code:"KE",name:"Kenya",flag:""},{code:"KI",name:"Kiribati",flag:""},{code:"KP",name:"Korea (North)",flag:""},{code:"KR",name:"Korea (South)",flag:""},{code:"KW",name:"Kuwait",flag:""},{code:"KG",name:"Kyrgyzstan",flag:""},{code:"LA",name:"Laos",flag:""},{code:"LV",name:"Latvia",flag:""},{code:"LB",name:"Lebanon",flag:""},{code:"LS",name:"Lesotho",flag:""},{code:"LR",name:"Liberia",flag:""},{code:"LY",name:"Libya",flag:""},{code:"LI",name:"Liechtenstein",flag:""},{code:"LT",name:"Lithuania",flag:""},{code:"LU",name:"Luxembourg",flag:""},{code:"MG",name:"Madagascar",flag:""},{code:"MW",name:"Malawi",flag:""},{code:"MY",name:"Malaysia",flag:""},{code:"MV",name:"Maldives",flag:""},{code:"ML",name:"Mali",flag:""},{code:"MT",name:"Malta",flag:""},{code:"MH",name:"Marshall Islands",flag:""},{code:"MR",name:"Mauritania",flag:""},{code:"MU",name:"Mauritius",flag:""},{code:"MX",name:"Mexico",flag:""},{code:"FM",name:"Micronesia",flag:""},{code:"MD",name:"Moldova",flag:""},{code:"MC",name:"Monaco",flag:""},{code:"MN",name:"Mongolia",flag:""},{code:"ME",name:"Montenegro",flag:""},{code:"MA",name:"Morocco",flag:""},{code:"MZ",name:"Mozambique",flag:""},{code:"MM",name:"Myanmar",flag:""},{code:"NA",name:"Namibia",flag:""},{code:"NR",name:"Nauru",flag:""},{code:"NP",name:"Nepal",flag:""},{code:"NL",name:"Netherlands",flag:""},{code:"NZ",name:"New Zealand",flag:""},{code:"NI",name:"Nicaragua",flag:""},{code:"NE",name:"Niger",flag:""},{code:"NG",name:"Nigeria",flag:""},{code:"MK",name:"North Macedonia",flag:""},{code:"NO",name:"Norway",flag:""},{code:"OM",name:"Oman",flag:""},{code:"PK",name:"Pakistan",flag:""},{code:"PW",name:"Palau",flag:""},{code:"PA",name:"Panama",flag:""},{code:"PG",name:"Papua New Guinea",flag:""},{code:"PY",name:"Paraguay",flag:""},{code:"PE",name:"Peru",flag:""},{code:"PH",name:"Philippines",flag:""},{code:"PL",name:"Poland",flag:""},{code:"PT",name:"Portugal",flag:""},{code:"QA",name:"Qatar",flag:""},{code:"RO",name:"Romania",flag:""},{code:"RU",name:"Russia",flag:""},{code:"RW",name:"Rwanda",flag:""},{code:"KN",name:"Saint Kitts and Nevis",flag:""},{code:"LC",name:"Saint Lucia",flag:""},{code:"VC",name:"Saint Vincent and the Grenadines",flag:""},{code:"WS",name:"Samoa",flag:""},{code:"SM",name:"San Marino",flag:""},{code:"ST",name:"So Tom and Prncipe",flag:""},{code:"SA",name:"Saudi Arabia",flag:""},{code:"SN",name:"Senegal",flag:""},{code:"RS",name:"Serbia",flag:""},{code:"SC",name:"Seychelles",flag:""},{code:"SL",name:"Sierra Leone",flag:""},{code:"SG",name:"Singapore",flag:""},{code:"SK",name:"Slovakia",flag:""},{code:"SI",name:"Slovenia",flag:""},{code:"SB",name:"Solomon Islands",flag:""},{code:"SO",name:"Somalia",flag:""},{code:"ZA",name:"South Africa",flag:""},{code:"SS",name:"South Sudan",flag:""},{code:"ES",name:"Spain",flag:""},{code:"LK",name:"Sri Lanka",flag:""},{code:"SD",name:"Sudan",flag:""},{code:"SR",name:"Suriname",flag:""},{code:"SE",name:"Sweden",flag:""},{code:"CH",name:"Switzerland",flag:""},{code:"SY",name:"Syria",flag:""},{code:"TJ",name:"Tajikistan",flag:""},{code:"TZ",name:"Tanzania",flag:""},{code:"TH",name:"Thailand",flag:""},{code:"TL",name:"Timor-Leste",flag:""},{code:"TG",name:"Togo",flag:""},{code:"TO",name:"Tonga",flag:""},{code:"TT",name:"Trinidad and Tobago",flag:""},{code:"TN",name:"Tunisia",flag:""},{code:"TR",name:"Turkey",flag:""},{code:"TM",name:"Turkmenistan",flag:""},{code:"TV",name:"Tuvalu",flag:""},{code:"UG",name:"Uganda",flag:""},{code:"UA",name:"Ukraine",flag:""},{code:"AE",name:"United Arab Emirates",flag:""},{code:"GB",name:"United Kingdom",flag:""},{code:"US",name:"United States",flag:""},{code:"UY",name:"Uruguay",flag:""},{code:"UZ",name:"Uzbekistan",flag:""},{code:"VU",name:"Vanuatu",flag:""},{code:"VA",name:"Vatican City",flag:""},{code:"VE",name:"Venezuela",flag:""},{code:"VN",name:"Vietnam",flag:""},{code:"YE",name:"Yemen",flag:""},{code:"ZM",name:"Zambia",flag:""},{code:"ZW",name:"Zimbabwe",flag:""}],db=()=>TE.map(c=>({value:c.code,label:`${c.flag} ${c.name}`,name:c.name,flag:c.flag})),ub=c=>[c.line1,c.line2,c.city,c.state,c.postal_code].filter(Boolean).join(", "),EE=c=>{const d=c.label||`Address #${c.id.slice(-4)}`,g=ub(c);return`${d} - ${g}`},CE=(c,d)=>{if(!c||!d)return"";const g=f=>{const[w,N]=f.split(":"),T=parseInt(w,10),A=T>=12?"PM":"AM";return`${T===0?12:T>12?T-12:T}:${N} ${A}`};return`${g(c)} - ${g(d)}`},b0=(c,d)=>{if(!c||!d)return!0;try{const[g,f]=c.split(":").map(Number),[w,N]=d.split(":").map(Number),T=g*60+f;return w*60+N>T}catch(g){return console.error("Error validating delivery window:",g),!1}},kE=async c=>{try{const d=[c.line1,c.line2,c.city,c.state,c.postal_code].filter(Boolean).join(", "),f=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d)}&limit=1`)).json();return f&&f.length>0?{latitude:parseFloat(f[0].lat),longitude:parseFloat(f[0].lon)}:null}catch(d){return console.error("Geocoding error:",d),null}},AE=({address:c,onEdit:d,onDelete:g,onSetPrimary:f})=>{const w=oe.useRef(null),[N,T]=oe.useState(null),[A,n]=oe.useState(null),P=CE(c.delivery_window_start,c.delivery_window_end);return oe.useEffect(()=>{if(!N&&w.current&&c.latitude&&c.longitude){vi.accessToken=void 0;const z=new vi.Map({container:w.current,style:"mapbox://styles/mapbox/streets-v11",center:[c.longitude,c.latitude],zoom:14,interactive:!1}),q=new vi.Marker().setLngLat([c.longitude,c.latitude]).addTo(z);T(z),n(q),z.on("load",()=>{z.resize()})}},[w,c.latitude,c.longitude]),oe.useEffect(()=>()=>{A&&A.remove(),N&&N.remove()},[]),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(En,{className:"h-4 w-4 text-gray-400 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900",children:c.label||`Address #${c.id.slice(-4)}`}),c.is_primary&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx(Hh,{className:"h-3 w-3 mr-1"}),"Primary"]})]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[c.latitude&&c.longitude&&t.jsx("div",{className:"p-1 text-green-600",title:"Geocoded",children:t.jsx(b_,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>d(c),className:"p-1 text-gray-400 hover:text-blue-600 rounded hover:bg-blue-50 transition-colors",title:"Edit address",children:t.jsx(fi,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>g(c),className:"p-1 text-gray-400 hover:text-red-600 rounded hover:bg-red-50 transition-colors",title:"Delete address",children:t.jsx(so,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-gray-900",children:ub(c)}),P&&t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(en,{className:"h-4 w-4"}),t.jsxs("span",{children:["Delivery: ",P]})]}),c.instructions&&t.jsxs("div",{className:"flex items-start space-x-2 text-sm text-gray-600",children:[t.jsx(y_,{className:"h-4 w-4 mt-0.5"}),t.jsx("p",{className:"line-clamp-2",children:c.instructions})]}),c.latitude&&c.longitude&&t.jsx("div",{className:"mt-3 h-32 rounded-md overflow-hidden border border-gray-200",children:t.jsx("div",{ref:w,className:"w-full h-full"})}),!c.is_primary&&t.jsx("button",{onClick:()=>f(c),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Set as Primary"})]})]})},hb=({isOpen:c,onClose:d,onSubmit:g,address:f,customerId:w,loading:N=!1,title:T,isFirstAddress:A=!1})=>{const[n,P]=oe.useState(!1),[z,q]=oe.useState(!1),{register:U,handleSubmit:W,reset:H,watch:G,setValue:J,formState:{errors:de}}=kn({defaultValues:{customer_id:w,label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:A,instructions:""}}),ne=G(["line1","city","state","postal_code"]),te=G("delivery_window_start"),Ne=G("delivery_window_end");oe.useEffect(()=>{f?(H({customer_id:f.customer_id,label:f.label||"",line1:f.line1,line2:f.line2||"",city:f.city,state:f.state||"",postal_code:f.postal_code||"",country:f.country,delivery_window_start:f.delivery_window_start||"",delivery_window_end:f.delivery_window_end||"",is_primary:f.is_primary,instructions:f.instructions||"",latitude:f.latitude,longitude:f.longitude}),q(!!(f.latitude&&f.longitude))):(H({customer_id:w,label:"",line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",delivery_window_start:"",delivery_window_end:"",is_primary:A,instructions:""}),q(!1))},[f,w,A,H]);const me=async()=>{const[fe,Be,ke,Ge]=ne;if(!(!fe||!Be)){P(!0);try{const we=await kE({line1:fe,city:Be,state:ke,postal_code:Ge});we&&(J("latitude",we.latitude),J("longitude",we.longitude),q(!0))}catch(we){console.error("Geocoding failed:",we)}finally{P(!1)}}},Pe=fe=>{if(fe.delivery_window_start&&fe.delivery_window_end&&!b0(fe.delivery_window_start,fe.delivery_window_end)){const Be="End time must be after start time";console.error("Delivery window validation error:",Be),alert(Be);return}fe.delivery_window_start&&!fe.delivery_window_end&&(fe.delivery_window_end=void 0),fe.delivery_window_end&&!fe.delivery_window_start&&(fe.delivery_window_start=void 0),console.log("Submitting address form:",fe),g(fe)},Se=db();return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:W(Pe),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:T}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Address Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"label",className:"block text-sm font-medium text-gray-700",children:"Address Label"}),t.jsx("input",{type:"text",id:"label",...U("label"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Main Location, Loading Dock, etc."})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"line1",className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),t.jsx("input",{type:"text",id:"line1",...U("line1",{required:"Address line 1 is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),de.line1&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:de.line1.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"line2",className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),t.jsx("input",{type:"text",id:"line2",...U("line2"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Apartment, suite, unit, etc."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700",children:"City *"}),t.jsx("input",{type:"text",id:"city",...U("city",{required:"City is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),de.city&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:de.city.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700",children:"State/Province"}),t.jsx("input",{type:"text",id:"state",...U("state"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postal_code",className:"block text-sm font-medium text-gray-700",children:"Postal Code"}),t.jsx("input",{type:"text",id:"postal_code",...U("postal_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700",children:"Country"}),t.jsx("select",{id:"country",...U("country"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:Se.map(fe=>t.jsx("option",{value:fe.value,children:fe.label},fe.value))})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Geocoding"}),t.jsxs("button",{type:"button",onClick:me,disabled:n||!ne[0]||!ne[1],className:"flex items-center space-x-2 text-sm text-blue-600 hover:text-blue-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:[n?t.jsx(or,{className:"h-4 w-4 animate-spin"}):z?t.jsx(b_,{className:"h-4 w-4 text-green-600"}):t.jsx(En,{className:"h-4 w-4"}),t.jsx("span",{children:n?"Geocoding...":z?"Geocoded":"Geocode Address"})]})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Geocoding helps with delivery route optimization"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Delivery Preferences"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_start",className:"block text-sm font-medium text-gray-700",children:"Delivery Window Start"}),t.jsx("input",{type:"time",id:"delivery_window_start",...U("delivery_window_start"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_window_end",className:"block text-sm font-medium text-gray-700",children:"Delivery Window End"}),t.jsx("input",{type:"time",id:"delivery_window_end",...U("delivery_window_end"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),te&&Ne&&!b0(te,Ne)&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:"End time must be after start time"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"is_primary",...U("is_primary"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"is_primary",className:"ml-2 block text-sm text-gray-900",children:"Set as primary address"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Primary address will be used as the default for orders"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Access & Security"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"access_code",className:"block text-sm font-medium text-gray-700",children:"Access Code"}),t.jsx("input",{type:"text",id:"access_code",...U("access_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Building access code"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"gate_code",className:"block text-sm font-medium text-gray-700",children:"Gate Code"}),t.jsx("input",{type:"text",id:"gate_code",...U("gate_code"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate or entrance code"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"building_type",className:"block text-sm font-medium text-gray-700",children:"Building Type"}),t.jsxs("select",{id:"building_type",...U("building_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select type..."}),t.jsx("option",{value:"residential",children:"Residential"}),t.jsx("option",{value:"commercial",children:"Commercial"}),t.jsx("option",{value:"industrial",children:"Industrial"}),t.jsx("option",{value:"other",children:"Other"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"preferred_delivery_time",className:"block text-sm font-medium text-gray-700",children:"Preferred Time"}),t.jsx("input",{type:"time",id:"preferred_delivery_time",...U("preferred_delivery_time"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Preferred time within delivery window"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"security_requirements",className:"block text-sm font-medium text-gray-700",children:"Security Requirements"}),t.jsx("textarea",{id:"security_requirements",rows:2,...U("security_requirements"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Security checkpoints, ID requirements, visitor procedures..."})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"On-Site Contact"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"contact_person",className:"block text-sm font-medium text-gray-700",children:"Contact Person"}),t.jsx("input",{type:"text",id:"contact_person",...U("contact_person"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"On-site contact name"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"contact_phone",className:"block text-sm font-medium text-gray-700",children:"Contact Phone"}),t.jsx("input",{type:"tel",id:"contact_phone",...U("contact_phone"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Phone number for delivery"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Logistics & Access"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"parking_instructions",className:"block text-sm font-medium text-gray-700",children:"Parking Instructions"}),t.jsx("textarea",{id:"parking_instructions",rows:2,...U("parking_instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Where to park, parking restrictions, loading zones..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"loading_dock_info",className:"block text-sm font-medium text-gray-700",children:"Loading Dock Information"}),t.jsx("textarea",{id:"loading_dock_info",rows:2,...U("loading_dock_info"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Loading dock location, height restrictions, equipment availability..."})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Delivery Instructions"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"delivery_notes",className:"block text-sm font-medium text-gray-700",children:"Delivery Notes"}),t.jsx("textarea",{id:"delivery_notes",rows:3,...U("delivery_notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Specific delivery instructions, handling requirements..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"special_instructions",className:"block text-sm font-medium text-gray-700",children:"Special Instructions"}),t.jsx("textarea",{id:"special_instructions",rows:3,...U("special_instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Special handling, fragile items, temperature requirements..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-gray-700",children:"General Instructions"}),t.jsx("textarea",{id:"instructions",rows:2,...U("instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"General delivery notes and instructions..."})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Address"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},ME=({customerId:c})=>{const[d,g]=oe.useState(!1),[f,w]=oe.useState(null),[N,T]=oe.useState(null),{data:A=[],isLoading:n}=lb(c),P=cb(),z=jE(),q=NE(),U=SE(),W=()=>{w(null),g(!0)},H=te=>{w(te),g(!0)},G=te=>{T(te)},J=async te=>{if(!te.is_primary)try{await U.mutateAsync(te)}catch{}},de=async te=>{try{f?await z.mutateAsync({id:f.id,...te}):await P.mutateAsync(te),g(!1),w(null)}catch{}},ne=async()=>{if(N)try{await q.mutateAsync(N),T(null)}catch{}};return n?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-20 bg-gray-200 rounded"}),t.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(En,{className:"h-5 w-5 text-gray-400"}),t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Delivery Addresses (",A.length,")"]})]}),t.jsxs("button",{onClick:W,className:"flex items-center space-x-2 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Address"})]})]}),A.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(En,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"No delivery addresses added yet"}),t.jsx("button",{onClick:W,className:"text-blue-600 hover:text-blue-800 font-medium",children:"Add the first address"})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:A.map(te=>t.jsx(AE,{address:te,onEdit:H,onDelete:G,onSetPrimary:J},te.id))}),t.jsx(hb,{isOpen:d,onClose:()=>{g(!1),w(null)},onSubmit:de,address:f||void 0,customerId:c,loading:P.isPending||z.isPending,title:f?"Edit Address":"Add New Address",isFirstAddress:A.length===0}),t.jsx(ro,{isOpen:!!N,onClose:()=>T(null),onConfirm:ne,title:"Delete Address",message:`Are you sure you want to delete this address? ${N!=null&&N.is_primary?"This is the primary address for this customer.":""}`,confirmText:"Delete",type:"danger",loading:q.isPending})]})};let nf=null;const PE=async()=>{if(nf)return nf;try{const c=await xt.orders.getWorkflow.query();return nf=c,c}catch(c){throw console.error("Failed to fetch workflow from backend:",c),new Error("Order workflow fetch failed. Please try again.")}},ic=async c=>{const d=await PE();return d.find(g=>g.status===c)||d[0]},mb=async(c,d=0)=>{try{return await xt.orders.calculateTotals.mutate({lines:c,tax_percent:d})}catch(g){throw console.error("Failed to calculate totals via API:",g),new Error("Order total calculation failed. Please try again.")}},IE=async c=>{try{return(await xt.orders.formatDate.mutate({date:c})).formatted_date}catch(d){throw console.error("Failed to format date via API:",d),new Error("Date formatting failed. Please try again.")}},af=async c=>(await ic(c)).allowedTransitions,DE=async c=>{try{return await xt.orders.validateForConfirmation.mutate({order:c})}catch(d){throw console.error("Failed to validate order for confirmation via API:",d),new Error("Order confirmation validation failed. Please try again.")}},LE=({orders:c,loading:d})=>{const g=si();return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"})]})]})}):c.length?t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Orders"}),t.jsx("div",{className:"space-y-4",children:c.map(f=>{var w;return t.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>g(`/orders/${f.id}`),children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:["Order #",f.id]}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[t.jsx(Gs,{className:"h-4 w-4"}),t.jsx("span",{children:IE(f.order_date)})]})]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${f.status==="completed"?"bg-green-100 text-green-800":f.status==="cancelled"?"bg-red-100 text-red-800":f.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:f.status.charAt(0).toUpperCase()+f.status.slice(1)})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(ps,{className:"h-4 w-4"}),t.jsxs("span",{children:[((w=f.order_lines)==null?void 0:w.length)||0," items"]})]}),f.total_amount!==void 0&&t.jsxs("p",{className:"text-sm font-medium text-gray-900 mt-1",children:["Total: $",f.total_amount.toFixed(2)]})]})]},f.id)})})]}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Orders"}),t.jsx("p",{className:"text-gray-500 text-center py-4",children:"No orders found"})]})},RE=()=>{const{id:c}=nc(),d=si(),[g,f]=oe.useState(!1),{data:w,isLoading:N,error:T}=xS(c),A=S_(),{data:n,isLoading:P}=wE((w==null?void 0:w.id)||"",5),z=async U=>{if(w)try{await A.mutateAsync({id:w.id,...U}),f(!1)}catch{}},q=U=>new Date(U).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return N?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]}):T||!w?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Customer not found or error loading customer details."})})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/customers"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Customers"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:w.name})]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(fi,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Customer"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Business Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(f_,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:w.name})]})]}),w.external_id&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"External ID"}),t.jsx("span",{className:"text-gray-900",children:w.external_id})]}),w.tax_id&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Tax ID (VAT/EIN)"}),t.jsx("span",{className:"text-gray-900",children:w.tax_id})]}),w.email&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Email"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(eS,{className:"h-4 w-4 text-gray-400"}),t.jsx("a",{href:`mailto:${w.email}`,className:"text-blue-600 hover:text-blue-800",children:w.email})]})]}),w.phone&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Phone"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(iS,{className:"h-4 w-4 text-gray-400"}),t.jsx("a",{href:`tel:${w.phone}`,className:"text-blue-600 hover:text-blue-800",children:w.phone})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Account Status"}),t.jsx(su,{status:w.account_status})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Credit Terms"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(HN,{className:"h-4 w-4 text-gray-400"}),t.jsxs("span",{className:"text-gray-900",children:[w.credit_terms_days," days"]})]})]})]})]})}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(w.created_at)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Last Updated"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(w.updated_at)})]})]})]})]})})]}),t.jsx(ME,{customerId:w.id}),t.jsx(LE,{orders:n||[],loading:P}),t.jsx(ob,{isOpen:g,onClose:()=>f(!1),onSubmit:z,customer:w,loading:A.isPending,title:"Edit Customer"})]})},cc=(c={})=>xt.products.list.useQuery({search:c.search,status:c.status,unit_of_measure:c.unit_of_measure,page:c.page||1,limit:c.limit||50,sort_by:c.sort_by||"created_at",sort_order:c.sort_order||"desc",show_obsolete:c.show_obsolete||!1},{retry:1,staleTime:3e4}),zE=c=>xt.products.getById.useQuery({id:c},{enabled:!!c}),OE=()=>xt.products.getStats.useQuery(void 0,{staleTime:6e4}),FE=()=>xt.products.create.useMutation({onSuccess:c=>{console.log("Product created successfully:",c),Pt.success("Product created successfully")},onError:c=>{console.error("Create product mutation error:",c),Pt.error(c.message||"Failed to create product")}}),pb=()=>xt.products.update.useMutation({onSuccess:c=>{console.log("Product updated successfully:",c),Pt.success("Product updated successfully")},onError:c=>{console.error("Update product mutation error:",c),Pt.error(c.message||"Failed to update product")}}),BE=()=>xt.products.delete.useMutation({onSuccess:(c,d)=>{console.log("Product deleted successfully:",d.id),Pt.success("Product status set to obsolete")},onError:c=>{console.error("Delete product mutation error:",c),Pt.error(c.message||"Failed to delete product")}}),UE=()=>xt.products.bulkUpdateStatus.useMutation({onSuccess:c=>{console.log("Bulk product status update successful:",c),Pt.success(`Updated ${c.updated_count} products successfully`)},onError:c=>{console.error("Bulk update status mutation error:",c),Pt.error(c.message||"Failed to update product status")}}),VE=()=>xt.products.reactivate.useMutation({onSuccess:c=>{console.log("Product reactivated successfully:",c),Pt.success("Product reactivated successfully")},onError:c=>{console.error("Reactivate product mutation error:",c),Pt.error(c.message||"Failed to reactivate product")}}),qE=({products:c,loading:d=!1,onView:g,onEdit:f,onDelete:w,selectedProducts:N=[],onSelectionChange:T})=>{const[A,n]=oe.useState(!1),P=VE(),z=J=>new Date(J).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),q=J=>J==="cylinder"?Uf:qf,U=J=>{switch(J){case"active":return"active";case"end_of_sale":return"credit_hold";case"obsolete":return"closed";default:return"active"}},W=J=>{n(J),T&&T(J?c.map(de=>de.id):[])},H=(J,de)=>{if(T){const ne=de?[...N,J]:N.filter(te=>te!==J);T(ne),n(ne.length===c.length)}},G=async J=>{try{await P.mutateAsync(J.id)}catch{}};return console.log("ProductTable render:",{products:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading products..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(ps,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load products. Please check your connection.":"Get started by adding your first product."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Products (",c.length,")"]}),N.length>0&&t.jsxs("span",{className:"text-sm text-blue-600",children:[N.length," selected"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[T&&t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:A,onChange:J=>W(J.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type & Specs"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(J=>{const de=q(J.unit_of_measure),ne=J.status==="obsolete";return t.jsxs("tr",{className:`hover:bg-gray-50 ${ne?"opacity-60":""}`,children:[T&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",checked:N.includes(J.id),onChange:te=>H(J.id,te.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[J.name,ne&&t.jsx("span",{className:"ml-2 text-xs text-red-600",children:"(Obsolete)"})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",J.sku]}),J.description&&t.jsx("div",{className:"text-xs text-gray-400 mt-1 max-w-xs truncate",children:J.description})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(de,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsx("div",{className:"capitalize",children:J.unit_of_measure}),J.unit_of_measure==="cylinder"&&t.jsxs("div",{className:"text-xs text-gray-500",children:[J.capacity_kg&&`${J.capacity_kg} kg capacity`,J.tare_weight_kg&&`  ${J.tare_weight_kg} kg tare`]}),J.valve_type&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Valve: ",J.valve_type]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(su,{status:U(J.status),className:"capitalize",children:J.status.replace("_"," ")})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:z(J.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(J),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View product",children:t.jsx(lm,{className:"h-4 w-4"})}),!ne&&t.jsx("button",{onClick:()=>f(J),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit product",children:t.jsx(fi,{className:"h-4 w-4"})}),ne?t.jsx("button",{onClick:()=>G(J),disabled:P.isPending,className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors disabled:opacity-50",title:"Reactivate product",children:t.jsx(eo,{className:"h-4 w-4"})}):t.jsx("button",{onClick:()=>w(J),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Mark as obsolete",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},J.id)})})]})})]})},$E=({filters:c,onFiltersChange:d})=>{const g=n=>{d({...c,search:n.target.value||void 0,page:1})},f=n=>{d({...c,status:n.target.value||void 0,page:1})},w=n=>{d({...c,unit_of_measure:n.target.value||void 0,page:1})},N=n=>{const[P,z]=n.target.value.split(":");d({...c,sort_by:P||"created_at",sort_order:z||"desc",page:1})},T=()=>{d({...c,show_obsolete:!c.show_obsolete,page:1})},A=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by SKU, name, or description...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]})}),t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.unit_of_measure||"",onChange:w,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"cylinder",children:"Cylinders"}),t.jsx("option",{value:"kg",children:"By Weight (kg)"})]})]})}),t.jsx("div",{className:"sm:w-48",children:t.jsxs("select",{value:`${c.sort_by||"created_at"}:${c.sort_order||"desc"}`,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"created_at:desc",children:"Newest First"}),t.jsx("option",{value:"created_at:asc",children:"Oldest First"}),t.jsx("option",{value:"name:asc",children:"Name A-Z"}),t.jsx("option",{value:"name:desc",children:"Name Z-A"}),t.jsx("option",{value:"sku:asc",children:"SKU A-Z"}),t.jsx("option",{value:"sku:desc",children:"SKU Z-A"}),t.jsx("option",{value:"capacity_kg:desc",children:"Capacity High-Low"}),t.jsx("option",{value:"capacity_kg:asc",children:"Capacity Low-High"})]})}),t.jsxs("button",{onClick:T,className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${c.show_obsolete?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,title:c.show_obsolete?"Hide obsolete products":"Show obsolete products",children:[c.show_obsolete?t.jsx(XN,{className:"h-4 w-4"}):t.jsx(lm,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:c.show_obsolete?"Hide Obsolete":"Show Obsolete"})]}),t.jsxs("button",{onClick:A,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},fb=({isOpen:c,onClose:d,onSubmit:g,product:f,loading:w=!1,title:N})=>{const[T,A]=oe.useState(!1),{register:n,handleSubmit:P,reset:z,watch:q,formState:{errors:U}}=kn({defaultValues:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:void 0,tare_weight_kg:void 0,valve_type:"",status:"active",barcode_uid:""}}),W=q("unit_of_measure"),H=q("status");oe.useEffect(()=>{z(f?{sku:f.sku,name:f.name,description:f.description||"",unit_of_measure:f.unit_of_measure,capacity_kg:f.capacity_kg,tare_weight_kg:f.tare_weight_kg,valve_type:f.valve_type||"",status:f.status,barcode_uid:f.barcode_uid||""}:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:void 0,tare_weight_kg:void 0,valve_type:"",status:"active",barcode_uid:""})},[f,z]),oe.useEffect(()=>{A(H==="obsolete")},[H]);const G=async de=>{try{const ne=await xt.products.validateSku.mutate({sku:de.sku,exclude_id:f==null?void 0:f.id});if(!ne.valid)return console.error("SKU validation failed:",ne.errors),!1;ne.warnings.length>0&&console.warn("SKU warnings:",ne.warnings)}catch(ne){return console.error("SKU validation error:",ne),!1}if(de.unit_of_measure==="cylinder"&&(de.capacity_kg||de.tare_weight_kg))try{const ne=await xt.products.validateWeight.mutate({capacity_kg:de.capacity_kg,tare_weight_kg:de.tare_weight_kg,unit_of_measure:de.unit_of_measure});if(!ne.valid)return console.error("Weight validation failed:",ne.errors),!1;ne.warnings.length>0&&console.warn("Weight warnings:",ne.warnings)}catch(ne){return console.error("Weight validation error:",ne),!1}return!0},J=async de=>{try{if(!await G(de))return;const te={...de};de.unit_of_measure!=="cylinder"&&(te.capacity_kg=void 0,te.tare_weight_kg=void 0,te.valve_type=void 0),Object.keys(te).forEach(Ne=>{te[Ne]===""&&(te[Ne]=void 0)}),g(te)}catch(ne){console.error("Form validation error:",ne)}};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:P(J),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU *"}),t.jsx("input",{type:"text",id:"sku",...n("sku",{required:"SKU is required",pattern:{value:/^[A-Z0-9-]+$/,message:"SKU must contain only uppercase letters, numbers, and hyphens"},minLength:{value:3,message:"SKU must be at least 3 characters long"},maxLength:{value:50,message:"SKU must be 50 characters or less"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 uppercase",placeholder:"CYL-50KG-S"}),U.sku&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.sku.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",...n("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),t.jsx("input",{type:"text",id:"name",...n("name",{required:"Product name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"LPG Cylinder 50kg"}),U.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.name.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...n("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Detailed product description..."})]})]}),T&&t.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vs,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:'Warning: Setting status to "Obsolete" will make this product unavailable for future orders.'})]})})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Physical Properties"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_of_measure",className:"block text-sm font-medium text-gray-700",children:"Unit of Measure"}),t.jsxs("select",{id:"unit_of_measure",...n("unit_of_measure"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"kg",children:"By Weight (kg)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"barcode_uid",className:"block text-sm font-medium text-gray-700",children:"Barcode/RFID UID"}),t.jsx("input",{type:"text",id:"barcode_uid",...n("barcode_uid"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional unique identifier"})]}),W==="cylinder"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_kg",className:"block text-sm font-medium text-gray-700",children:"Capacity (kg)"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"500",id:"capacity_kg",...n("capacity_kg",{valueAsNumber:!0,min:{value:.1,message:"Capacity must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"50.0"}),U.capacity_kg&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.capacity_kg.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tare_weight_kg",className:"block text-sm font-medium text-gray-700",children:"Tare Weight (kg)"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"500",id:"tare_weight_kg",...n("tare_weight_kg",{valueAsNumber:!0,min:{value:.1,message:"Tare weight must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"15.0"}),U.tare_weight_kg&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:U.tare_weight_kg.message})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{htmlFor:"valve_type",className:"block text-sm font-medium text-gray-700",children:"Valve Type"}),t.jsx("input",{type:"text",id:"valve_type",...n("valve_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Standard valve specifications"})]})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Product"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},v0=async(c,d)=>{try{return(await xt.products.generateVariantSku.mutate({parent_sku:c,variant_name:d})).variant_sku}catch(g){throw console.error("Failed to generate variant SKU via API:",g),new Error("Variant SKU generation failed. Please try again.")}},w0=[{name:"Loading...",description:"Please use getStandardCylinderVariants() API"}],GE=c=>({delivery:"Delivery",refill:"Refill",exchange:"Exchange",pickup:"Pickup"})[c]||c,ZE=c=>({standard:"Standard",express:"Express",emergency:"Emergency",scheduled:"Scheduled"})[c]||c,of=async c=>{try{return(await xt.products.shouldRequirePickup.mutate({order_type:c})).requires_pickup}catch(d){throw console.error("Failed to check pickup requirement via API:",d),new Error("Pickup requirement check failed. Please try again.")}},WE=({isOpen:c,onClose:d,onSubmit:g,product:f,loading:w=!1,title:N})=>{const[T,A]=oe.useState(!1),[n,P]=oe.useState([]),{register:z,handleSubmit:q,reset:U,watch:W,setValue:H,formState:{errors:G}}=kn({defaultValues:{sku:"",name:"",description:"",unit_of_measure:"cylinder",capacity_kg:0,tare_weight_kg:0,valve_type:"",status:"active",barcode_uid:"",requires_tag:!1,variant_type:"cylinder",parent_product_id:void 0,variant_name:void 0,is_variant:!1}}),J=W("variant_type"),de=W("sku");oe.useEffect(()=>{f&&U({sku:f.sku,name:f.name,description:f.description||"",unit_of_measure:f.unit_of_measure,capacity_kg:f.capacity_kg||0,tare_weight_kg:f.tare_weight_kg||0,valve_type:f.valve_type||"",status:f.status,barcode_uid:f.barcode_uid||"",requires_tag:f.requires_tag,variant_type:f.variant_type,parent_product_id:f.parent_product_id,variant_name:f.variant_name,is_variant:f.is_variant})},[f,U]),oe.useEffect(()=>{J==="cylinder"&&n.length===0&&T&&P(w0.map(Se=>({name:Se.name,description:Se.description,status:"active"})))},[J,T,n.length]);const ne=()=>{P([...n,{name:"",description:"",status:"active"}])},te=Se=>{P(n.filter((fe,Be)=>Be!==Se))},Ne=(Se,fe,Be)=>{const ke=[...n];ke[Se]={...ke[Se],[fe]:Be},P(ke)},me=Se=>{const fe={...Se,is_variant:!1,parent_product_id:void 0,variant_name:void 0};let Be;T&&n.length>0&&(Be=n.map(ke=>({parent_product_id:"",variant_name:ke.name,sku:v0(Se.sku,ke.name),name:`${Se.name} (${ke.name})`,description:ke.description||`${ke.name} variant of ${Se.name}`,status:ke.status,barcode_uid:void 0}))),g(fe,Be)},Pe=()=>{P(w0.map(Se=>({name:Se.name,description:Se.description,status:"active"})))};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:t.jsxs("form",{onSubmit:q(me),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h4",{className:"text-md font-semibold text-gray-900 flex items-center space-x-2",children:[t.jsx(ps,{className:"h-5 w-5"}),t.jsx("span",{children:"Product Information"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-gray-700",children:"SKU *"}),t.jsx("input",{type:"text",id:"sku",...z("sku",{required:"SKU is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., PROGAS-13KG"}),G.sku&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:G.sku.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),t.jsx("input",{type:"text",id:"name",...z("name",{required:"Product name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., ProGas 13kg Cylinder"}),G.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:G.name.message})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...z("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Product description..."})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"variant_type",className:"block text-sm font-medium text-gray-700",children:"Variant Type *"}),t.jsxs("select",{id:"variant_type",...z("variant_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"refillable",children:"Refillable"}),t.jsx("option",{value:"disposable",children:"Disposable"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_of_measure",className:"block text-sm font-medium text-gray-700",children:"Unit of Measure"}),t.jsxs("select",{id:"unit_of_measure",...z("unit_of_measure"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"cylinder",children:"Cylinder"}),t.jsx("option",{value:"kg",children:"Kilogram"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_kg",className:"block text-sm font-medium text-gray-700",children:"Capacity (kg)"}),t.jsx("input",{type:"number",step:"0.1",id:"capacity_kg",...z("capacity_kg",{min:0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tare_weight_kg",className:"block text-sm font-medium text-gray-700",children:"Tare Weight (kg)"}),t.jsx("input",{type:"number",step:"0.1",id:"tare_weight_kg",...z("tare_weight_kg",{min:0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"valve_type",className:"block text-sm font-medium text-gray-700",children:"Valve Type"}),t.jsx("input",{type:"text",id:"valve_type",...z("valve_type"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., POL, ACME"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),t.jsxs("select",{id:"status",...z("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"end_of_sale",children:"End of Sale"}),t.jsx("option",{value:"obsolete",children:"Obsolete"})]})]})]}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"requires_tag",...z("requires_tag"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"requires_tag",className:"ml-2 block text-sm text-gray-700",children:"Requires Tag"})]})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"text-md font-semibold text-gray-900 flex items-center space-x-2",children:[t.jsx(oS,{className:"h-5 w-5"}),t.jsx("span",{children:"Product Variants"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"create_variants",checked:T,onChange:Se=>A(Se.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"create_variants",className:"block text-sm text-gray-700",children:"Create Variants"})]})]}),T&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(tu,{className:"h-5 w-5 text-blue-600 mt-0.5"}),t.jsx("div",{children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Product Variants:"})," Create different variants of this product (e.g., full vs empty cylinders). Each variant will have its own SKU and inventory tracking."]})})]})}),J==="cylinder"&&n.length===0&&t.jsx("div",{className:"text-center py-4",children:t.jsxs("button",{type:"button",onClick:Pe,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Standard Cylinder Variants"})]})}),n.map((Se,fe)=>t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h5",{className:"text-sm font-medium text-gray-900",children:["Variant ",fe+1]}),t.jsx("button",{type:"button",onClick:()=>te(fe),className:"text-red-600 hover:text-red-800",children:t.jsx(so,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Variant Name *"}),t.jsx("input",{type:"text",value:Se.name,onChange:Be=>Ne(fe,"name",Be.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., full, empty"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("input",{type:"text",value:Se.description||"",onChange:Be=>Ne(fe,"description",Be.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Variant description"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsx("strong",{children:"Generated SKU:"})," ",de?v0(de,Se.name):"Enter parent SKU first"]})]})]},fe)),t.jsxs("button",{type:"button",onClick:ne,className:"w-full flex items-center justify-center space-x-2 border border-gray-300 rounded-lg px-4 py-3 text-gray-600 hover:bg-gray-50 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Another Variant"})]})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Creating...":"Create Product"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},HE=()=>{const{data:c,isLoading:d}=OE();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const g=[{name:"Total Products",value:c.total,icon:ps,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Active",value:c.active,icon:Zn,color:"text-green-600",bgColor:"bg-green-50"},{name:"End of Sale",value:c.end_of_sale,icon:Vs,color:"text-yellow-600",bgColor:"bg-yellow-50"},{name:"Obsolete",value:c.obsolete,icon:fa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Cylinders",value:c.cylinders,icon:Uf,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"By Weight",value:c.kg_products,icon:qf,color:"text-indigo-600",bgColor:"bg-indigo-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:g.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]})},XE=({selectedProducts:c,onClearSelection:d})=>{const[g,f]=oe.useState(!1),w=UE(),N=async A=>{try{await w.mutateAsync({productIds:c,status:A}),d(),f(!1)}catch{}},T=()=>{console.log("Exporting products:",c),f(!1)};return c.length===0?null:t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[c.length," product",c.length>1?"s":""," selected"]}),t.jsx("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear selection"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>f(!g),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(rS,{className:"h-4 w-4"}),t.jsx("span",{children:"Bulk Actions"}),t.jsx(om,{className:"h-4 w-4"})]}),g&&t.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-10",children:t.jsxs("div",{className:"py-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Change Status"}),t.jsx("button",{onClick:()=>N("active"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as Active"}),t.jsx("button",{onClick:()=>N("end_of_sale"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as End of Sale"}),t.jsx("button",{onClick:()=>N("obsolete"),disabled:w.isPending,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Set as Obsolete"}),t.jsx("div",{className:"border-t border-gray-100 mt-1",children:t.jsxs("button",{onClick:T,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Vf,{className:"h-4 w-4"}),t.jsx("span",{children:"Export Selected"})]})})]})})]})]})})},KE=()=>{const c=si(),[d,g]=oe.useState({page:1}),[f,w]=oe.useState(!1),[N,T]=oe.useState(!1),[A,n]=oe.useState(null),[P,z]=oe.useState(null),[q,U]=oe.useState([]),{data:W,isLoading:H,error:G,refetch:J}=cc(d),de=FE(),ne=pb(),te=BE();oe.useEffect(()=>{console.log("ProductsPage state:",{filters:d,data:W,isLoading:H,error:G,isFormOpen:f,editingProduct:A,selectedProducts:q})},[d,W,H,G,f,A,q]);const Ne=()=>{console.log("Adding new product"),n(null),w(!0)},me=()=>{console.log("Adding product with variants"),T(!0)},Pe=Mt=>{console.log("Editing product:",Mt),n(Mt),w(!0)},Se=Mt=>{console.log("Viewing product:",Mt),c(`/products/${Mt.id}`)},fe=Mt=>{console.log("Marking product as obsolete:",Mt),z(Mt)},Be=async Mt=>{console.log("Form submit:",Mt);try{A?await ne.mutateAsync({id:A.id,...Mt}):await de.mutateAsync(Mt),w(!1),n(null)}catch(mt){console.error("Form submit error:",mt)}},ke=async(Mt,mt)=>{console.log("Variant form submit:",Mt,mt);try{const Fs=await de.mutateAsync(Mt);if(mt&&mt.length>0)for(const ts of mt){const Is={...ts,parent_product_id:Fs.id};await de.mutateAsync(Is)}T(!1),J()}catch(Fs){console.error("Variant form submit error:",Fs)}},Ge=async()=>{if(P){console.log("Confirming mark as obsolete:",P);try{await te.mutateAsync(P.id),z(null)}catch(Mt){console.error("Mark obsolete error:",Mt)}}},we=Mt=>{console.log("Page change:",Mt),g(mt=>({...mt,page:Mt}))},Me=()=>{console.log("Refreshing products"),J()},st=Mt=>{U(Mt)},lt=()=>{U([])},ft=P?P.status==="obsolete"?{title:"Product Already Obsolete",message:`"${P.name}" is already marked as obsolete and hidden from active lists.`}:{title:"Mark Product as Obsolete",message:`Are you sure you want to mark "${P.name}" as obsolete? This will hide it from active product lists but preserve all historical data including price lists, inventory records, and order history. The product can be reactivated later if needed.`}:{title:"",message:""};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Products"}),t.jsx("p",{className:"text-gray-600",children:"Manage your LPG product catalog"}),G&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",G.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Me,disabled:H,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(el,{className:`h-4 w-4 ${H?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:me,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(v_,{className:"h-4 w-4"}),t.jsx("span",{children:"Create with Variants"})]}),t.jsxs("button",{onClick:Ne,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]})]}),t.jsx(HE,{}),t.jsx($E,{filters:d,onFiltersChange:g}),t.jsx(XE,{selectedProducts:q,onClearSelection:lt}),t.jsx(qE,{products:(W==null?void 0:W.products)||[],loading:H,onView:Se,onEdit:Pe,onDelete:fe,selectedProducts:q,onSelectionChange:st}),W&&W.totalPages>1&&t.jsx(ac,{currentPage:W.currentPage,totalPages:W.totalPages,totalCount:W.totalCount,onPageChange:we}),t.jsx(fb,{isOpen:f,onClose:()=>{console.log("Closing form"),w(!1),n(null)},onSubmit:Be,product:A||void 0,loading:de.isPending||ne.isPending,title:A?"Edit Product":"Add New Product"}),t.jsx(WE,{isOpen:N,onClose:()=>T(!1),onSubmit:ke,loading:de.isPending,title:"Create Product with Variants"}),t.jsx(ro,{isOpen:!!P,onClose:()=>z(null),onConfirm:Ge,title:ft.title,message:ft.message,confirmText:(P==null?void 0:P.status)==="obsolete"?"OK":"Mark as Obsolete",type:(P==null?void 0:P.status)==="obsolete"?"info":"warning",loading:te.isPending})]})},Jf=(c={})=>xt.pricing.listPriceLists.useQuery({search:c.search,currency:c.currency,status:c.status,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Price lists fetch error:",d),Pt.error("Failed to load price lists")}}),QE=c=>xt.pricing.getPriceList.useQuery({price_list_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Price list fetch error:",d),Pt.error("Failed to load price list details")}}),JE=()=>{const c=xt.useContext();return xt.pricing.createPriceList.useMutation({onSuccess:d=>{console.log("Price list created successfully:",d),c.pricing.listPriceLists.invalidate(),c.pricing.getStats.invalidate(),Pt.success("Price list created successfully")},onError:d=>{console.error("Create price list error:",d),Pt.error(d.message||"Failed to create price list")}})},gb=()=>{const c=xt.useContext();return xt.pricing.updatePriceList.useMutation({onSuccess:d=>{console.log("Price list updated successfully:",d),c.pricing.listPriceLists.invalidate(),c.pricing.getPriceList.invalidate({price_list_id:d.id}),c.pricing.getStats.invalidate(),Pt.success("Price list updated successfully")},onError:d=>{console.error("Update price list error:",d),Pt.error(d.message||"Failed to update price list")}})},YE=()=>xt.pricing.getStats.useQuery(void 0,{enabled:!0,staleTime:6e4,retry:1,onError:c=>{console.error("Pricing stats fetch error:",c),Pt.error("Failed to load pricing statistics")}}),xb=(c,d={})=>xt.pricing.getPriceListItems.useQuery({price_list_id:c,search:d.search,page:d.page||1,limit:d.limit||50},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:g=>{console.error("Price list items fetch error:",g),Pt.error("Failed to load price list items")}}),yb=()=>{const c=xt.useContext();return xt.pricing.createPriceListItem.useMutation({onSuccess:d=>{console.log("Price list item created successfully:",d),c.pricing.getPriceListItems.invalidate({price_list_id:d.price_list_id}),c.pricing.getPriceList.invalidate({price_list_id:d.price_list_id}),Pt.success("Price list item created successfully")},onError:d=>{console.error("Create price list item error:",d),Pt.error(d.message||"Failed to create price list item")}})},eC=()=>{const c=xt.useContext();return xt.pricing.delete.useMutation({onSuccess:()=>{console.log("Price list deleted successfully"),c.pricing.listPriceLists.invalidate(),c.pricing.getStats.invalidate(),Pt.success("Price list deleted successfully")},onError:d=>{console.error("Delete price list error:",d),Pt.error(d.message||"Failed to delete price list")}})},tC=()=>{const c=xt.useContext();return xt.pricing.setDefault.useMutation({onSuccess:d=>{console.log("Default price list set successfully:",d),c.pricing.listPriceLists.invalidate(),c.pricing.getPriceList.invalidate({price_list_id:d.id}),c.pricing.getStats.invalidate(),Pt.success("Default price list set successfully")},onError:d=>{console.error("Set default price list error:",d),Pt.error(d.message||"Failed to set default price list")}})},sC=()=>[{code:"KES",name:"Kenyan Shilling",symbol:"Ksh"}],cs=(c,d="KES")=>{const g=sC().find(w=>w.code===d);return`${(g==null?void 0:g.symbol)||"Ksh"} ${c.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`},au=(c,d)=>(console.warn("calculateFinalPriceSync is deprecated - use calculateFinalPrice() API instead"),c),_b=(c,d)=>{const g=new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});if(!d)return`${g} - Ongoing`;const f=new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return`${g} - ${f}`},Mf=(c,d)=>{const g=new Date().toISOString().split("T")[0];return c>g?{status:"future",label:"Future",color:"bg-blue-100 text-blue-800 border-blue-200"}:d&&d<g?{status:"expired",label:"Expired",color:"bg-red-100 text-red-800 border-red-200"}:{status:"active",label:"Active",color:"bg-green-100 text-green-800 border-green-200"}},rC=(c,d)=>d?new Date(c)<=new Date(d):!0,iC=({isOpen:c,onClose:d,onSubmit:g,priceListId:f,item:w,loading:N=!1,title:T,existingProductIds:A=[]})=>{const[n,P]=oe.useState([]),[z,q]=oe.useState(0),[U,W]=oe.useState(!1),{register:H,handleSubmit:G,reset:J,watch:de,setValue:ne,formState:{errors:te}}=kn({defaultValues:{price_list_id:f,product_id:"",unit_price:0,min_qty:1,surcharge_pct:0}}),{data:Ne}=cc({limit:1e3}),Pe=((Ne==null?void 0:Ne.products)||[]).filter(we=>we.status==="active"&&!A.includes(we.id)),Se=de("unit_price"),fe=de("surcharge_pct");oe.useEffect(()=>{J(w?{price_list_id:w.price_list_id,product_id:w.product_id,unit_price:w.unit_price,min_qty:w.min_qty,surcharge_pct:w.surcharge_pct||0}:{price_list_id:f,product_id:"",unit_price:0,min_qty:1,surcharge_pct:0})},[w,f,J]);const Be=we=>{w?g(we):n.length>0?n.forEach(Me=>{g({...we,product_id:Me,unit_price:U?z:we.unit_price})}):g(we)},ke=we=>{P(Me=>Me.includes(we)?Me.filter(st=>st!==we):[...Me,we])},Ge=(we,Me)=>au(we);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:G(Be),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:T}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[!w&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Products"}),t.jsx("div",{className:"border border-gray-300 rounded-md p-2 max-h-60 overflow-y-auto",children:Pe.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500",children:"No available products to add"}):t.jsx("div",{className:"space-y-2",children:Pe.map(we=>t.jsxs("div",{className:`flex items-center p-2 rounded-md ${n.includes(we.id)?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:[t.jsx("input",{type:"checkbox",id:`product-${we.id}`,checked:n.includes(we.id),onChange:()=>ke(we.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsxs("label",{htmlFor:`product-${we.id}`,className:"ml-2 block text-sm text-gray-900 cursor-pointer flex-1",children:[t.jsx("div",{className:"font-medium",children:we.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",we.sku]})]})]},we.id))})}),n.length>0&&t.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:[n.length," product",n.length!==1?"s":""," selected"]})]}),!w&&n.length>0&&t.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("input",{type:"checkbox",id:"use-bulk-price",checked:U,onChange:()=>W(!U),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"use-bulk-price",className:"ml-2 block text-sm font-medium text-blue-800",children:"Apply same price to all selected products"})]}),U&&t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"block text-sm font-medium text-blue-800 mb-1",children:"Bulk Price (KSh)"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:z,onChange:we=>q(parseFloat(we.target.value)||0),className:"w-full rounded-md border border-blue-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"})]})]}),(w||!U)&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700",children:"Unit Price (KSh) *"}),t.jsx("input",{type:"number",id:"unit_price",min:"0",step:"0.01",...H("unit_price",{required:"Unit price is required",min:{value:0,message:"Price must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"}),te.unit_price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.unit_price.message})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"min_qty",className:"block text-sm font-medium text-gray-700",children:"Minimum Quantity"}),t.jsx("input",{type:"number",id:"min_qty",min:"1",...H("min_qty",{required:"Minimum quantity is required",min:{value:1,message:"Minimum quantity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),te.min_qty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.min_qty.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"surcharge_pct",className:"block text-sm font-medium text-gray-700",children:"Surcharge %"}),t.jsx("input",{type:"number",id:"surcharge_pct",min:"0",step:"0.1",...H("surcharge_pct",{min:{value:0,message:"Surcharge must be positive"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"}),te.surcharge_pct&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:te.surcharge_pct.message})]})]}),(Se>0||z>0)&&fe>0&&t.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:t.jsxs("div",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Final Price:"})," ",cs(Ge(U?z:Se)),t.jsxs("div",{className:"text-xs mt-1",children:["(Base price + ",fe,"% surcharge)"]})]})}),w&&t.jsx("input",{type:"hidden",...H("product_id"),value:w.product_id}),t.jsx("input",{type:"hidden",...H("price_list_id"),value:f})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||n.length===0&&!w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):w?"Update Price":"Add Products"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},nC=({productId:c})=>{const[d,g]=oe.useState(null),[f,w]=oe.useState(!1),[N,T]=oe.useState(null),{data:A={priceLists:[]}}=Jf(),n=A.priceLists||[],P={},z=yb(),q=ne=>{g(ne),T(null),w(!0)},U=ne=>{g(ne.price_list_id),T(ne),w(!0)},W=async ne=>{try{if(N){alert("Edit functionality is temporarily disabled");return}else await z.mutateAsync({...ne,product_id:c});w(!1),T(null)}catch{}},H=n.filter(ne=>!Object.keys(P).includes(ne.id));new Date().toISOString().split("T")[0];const G=n.filter(ne=>Mf(ne.start_date,ne.end_date).status==="active"),J=Object.keys(P).length===0,de=!G.some(ne=>Object.keys(P).includes(ne.id));return t.jsxs("div",{className:"space-y-6",children:[(J||de)&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tn,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:J?"No Pricing Defined":"No Active Pricing"}),t.jsx("p",{className:"text-sm text-yellow-700",children:J?"This product has no pricing defined in any price list.":"This product has pricing defined, but not in any active price list."})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Current Pricing"}),H.length>0&&t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:"",onChange:ne=>{ne.target.value&&q(ne.target.value)},className:"appearance-none bg-blue-600 text-white px-3 py-1 pr-8 rounded text-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[t.jsx("option",{value:"",children:"Add to Price List..."}),H.map(ne=>t.jsx("option",{value:ne.id,children:ne.name},ne.id))]}),t.jsx(Nr,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white pointer-events-none"})]})]}),Object.keys(P).length===0?t.jsxs("div",{className:"p-8 text-center",children:[t.jsx(tn,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"No pricing defined for this product"}),H.length>0&&t.jsx("button",{onClick:()=>q(H[0].id),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Add pricing to a price list"})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price List"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Min Qty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Surcharge"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(P).map(([ne,te])=>{const Ne=n.find(fe=>fe.id===ne);if(!Ne||!te.length)return null;const me=te[0],Pe=Mf(Ne.start_date,Ne.end_date),Se=au(me.unit_price,me.surcharge_pct);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:Ne.name}),Ne.is_default&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Default"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Pe.color}`,children:Pe.label})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:cs(me.unit_price)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:me.min_qty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:me.surcharge_pct?`${me.surcharge_pct}%`:"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-green-600",children:cs(Se)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx("button",{onClick:()=>U(me),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit price",children:t.jsx(fi,{className:"h-4 w-4"})})})]},ne)})})]})})]}),f&&d&&t.jsx(iC,{isOpen:f,onClose:()=>{w(!1),T(null)},onSubmit:W,priceListId:d,item:N||void 0,loading:z.isPending,title:N?"Edit Product Price":"Add Product to Price List"})]})},aC=()=>{const{id:c}=nc(),d=si(),[g,f]=oe.useState(!1),[w,N]=oe.useState("details"),{data:T,isLoading:A,error:n}=zE(c),P=pb(),z=async H=>{if(T)try{await P.mutateAsync({id:T.id,...H}),f(!1)}catch{}},q=H=>new Date(H).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=H=>{switch(H){case"active":return"active";case"end_of_sale":return"credit_hold";case"obsolete":return"closed";default:return"active"}};if(A)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(n||!T)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Product not found or error loading product details."})})})]});const W=T.unit_of_measure==="cylinder"?Uf:qf;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/products"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Products"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:T.name})]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(fi,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Product"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"flex space-x-8 px-6",children:[t.jsxs("button",{onClick:()=>N("details"),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${w==="details"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(ps,{className:"h-4 w-4"}),t.jsx("span",{children:"Product Details"})]}),t.jsxs("button",{onClick:()=>N("pricing"),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${w==="pricing"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(tn,{className:"h-4 w-4"}),t.jsx("span",{children:"Pricing"})]})]})}),t.jsxs("div",{className:"p-6",children:[w==="details"&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Product Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ps,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:T.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"SKU"}),t.jsx("span",{className:"text-gray-900 font-mono",children:T.sku})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Unit of Measure"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(W,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900 capitalize",children:T.unit_of_measure})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),t.jsx(su,{status:U(T.status),className:"capitalize",children:T.status.replace("_"," ")})]}),T.unit_of_measure==="cylinder"&&t.jsxs(t.Fragment,{children:[T.capacity_kg&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Capacity"}),t.jsxs("span",{className:"text-gray-900",children:[T.capacity_kg," kg"]})]}),T.tare_weight_kg&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Tare Weight"}),t.jsxs("span",{className:"text-gray-900",children:[T.tare_weight_kg," kg"]})]}),T.valve_type&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Valve Type"}),t.jsx("span",{className:"text-gray-900",children:T.valve_type})]})]}),T.barcode_uid&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Barcode/RFID UID"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(qN,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900 font-mono",children:T.barcode_uid})]})]}),T.description&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),t.jsx("p",{className:"text-gray-900",children:T.description})]})]}),T.status==="obsolete"&&t.jsx("div",{className:"mt-6 p-4 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vs,{className:"h-5 w-5 text-red-600"}),t.jsx("span",{className:"text-sm font-medium text-red-800",children:"This product is marked as obsolete and is no longer available for new orders."})]})})]}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Details"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:q(T.created_at)})]})]})})]})})]}),w==="pricing"&&t.jsx(nC,{productId:T.id})]})]}),t.jsx(fb,{isOpen:g,onClose:()=>f(!1),onSubmit:z,product:T,loading:P.isPending,title:"Edit Product"})]})},Yf=(c={})=>xt.warehouses.list.useQuery(c,{retry:1,staleTime:3e4}),oC=c=>xt.warehouses.get.useQuery({id:c},{enabled:!!c}),lC=()=>xt.warehouses.getStats.useQuery(void 0,{staleTime:6e4}),eg=()=>xt.warehouses.getOptions.useQuery(void 0,{staleTime:3e5}),cC=()=>xt.warehouses.create.useMutation({onSuccess:c=>{console.log("Warehouse created successfully:",c),Pt.success("Warehouse created successfully")},onError:c=>{console.error("Create warehouse mutation error:",c),Pt.error(c.message||"Failed to create warehouse")}}),bb=()=>xt.warehouses.update.useMutation({onSuccess:c=>{console.log("Warehouse updated successfully:",c),Pt.success("Warehouse updated successfully")},onError:c=>{console.error("Update warehouse mutation error:",c),Pt.error(c.message||"Failed to update warehouse")}}),dC=()=>xt.warehouses.delete.useMutation({onSuccess:(c,d)=>{console.log("Warehouse deleted successfully:",d.id),Pt.success("Warehouse deleted successfully")},onError:c=>{console.error("Delete warehouse mutation error:",c),Pt.error(c.message||"Failed to delete warehouse")}}),uC=({warehouses:c,loading:d=!1,onView:g,onEdit:f,onDelete:w})=>{const N=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),T=n=>n?n.toLocaleString()+" cylinders":"-",A=n=>n?[n.city,n.state].filter(Boolean).join(", ")||"Address incomplete":"No address";return console.log("WarehouseTable render:",{warehouses:c,loading:d}),d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading warehouses..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(Cn,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No warehouses found"}),t.jsx("p",{className:"text-gray-500",children:c===null?"Failed to load warehouses. Please check your connection.":"Get started by adding your first warehouse."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Warehouses (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(n=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx(Cn,{className:"h-5 w-5 text-blue-600"})})}),t.jsx("div",{children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.name})})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(En,{className:"h-4 w-4 text-gray-400"}),t.jsx("div",{className:"text-sm text-gray-900",children:A(n.address)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:T(n.capacity_cylinders)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(n.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(n),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View warehouse",children:t.jsx(lm,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>f(n),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit warehouse",children:t.jsx(fi,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>w(n),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete warehouse",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},n.id))})]})})]})},hC=({filters:c,onFiltersChange:d})=>{const g=w=>{d({...c,search:w.target.value||void 0,page:1})},f=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by warehouse name...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("button",{onClick:f,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{children:"Reset"})]})]})})},vb=({isOpen:c,onClose:d,onSubmit:g,warehouse:f,loading:w=!1,title:N})=>{const[T,A]=oe.useState(!0),[n,P]=oe.useState(""),[z,q]=oe.useState(!1),[U,W]=oe.useState(null),[H,G]=oe.useState([]),J=ei.useRef(null),[de,ne]=oe.useState(null),[te,Ne]=oe.useState(null),[me,Pe]=oe.useState(!1),{register:Se,handleSubmit:fe,reset:Be,setValue:ke,watch:Ge,formState:{errors:we}}=kn({defaultValues:{name:"",capacity_cylinders:void 0,address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}}),Me=Ge("address.latitude"),st=Ge("address.longitude");oe.useEffect(()=>{if(f){const St=!!f.address;A(St),Be({name:f.name,capacity_cylinders:f.capacity_cylinders,address:f.address?{line1:f.address.line1,line2:f.address.line2||"",city:f.address.city,state:f.address.state||"",postal_code:f.address.postal_code||"",country:f.address.country,instructions:f.address.instructions||"",latitude:f.address.latitude,longitude:f.address.longitude}:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}),P(f.address?[f.address.line1,f.address.city,f.address.state,f.address.postal_code,f.address.country].filter(Boolean).join(", "):"")}else A(!0),Be({name:"",capacity_cylinders:void 0,address:{line1:"",line2:"",city:"",state:"",postal_code:"",country:"US",instructions:"",latitude:void 0,longitude:void 0}}),P("")},[f,Be]),oe.useEffect(()=>{let St=!0;return n&&n.length>=3?(q(!0),ab(n,q).then(ft=>{St&&G(ft||[])})):(G([]),q(!1)),()=>{St=!1}},[n]),oe.useEffect(()=>{if(!de&&J.current&&Me&&st){vi.accessToken=void 0;const St=new vi.Map({container:J.current,style:"mapbox://styles/mapbox/streets-v11",center:[st,Me],zoom:14});St.addControl(new vi.NavigationControl,"top-right"),ne(St);const ft=new vi.Marker({anchor:"center",draggable:me}).setLngLat([st,Me]).addTo(St);Ne(ft),ft.on("dragend",()=>{const Mt=ft.getLngLat();ke("address.latitude",Mt.lat),ke("address.longitude",Mt.lng)}),St.on("load",()=>{St.resize()})}},[J,Me,st]),oe.useEffect(()=>{de&&te&&Me&&st&&(te.setLngLat([st,Me]),te.setDraggable(me),de.setCenter([st,Me]),de.setZoom(14),de.resize())},[Me,st,me,de,te]),oe.useEffect(()=>()=>{te&&te.remove(),de&&de.remove()},[]);const lt=St=>{g(St)};return db(),c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:fe(lt),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Warehouse Name *"}),t.jsx("input",{type:"text",id:"name",...Se("name",{required:"Warehouse name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Main Depot"}),we.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:we.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_cylinders",className:"block text-sm font-medium text-gray-700",children:"Storage Capacity (cylinders)"}),t.jsx("input",{type:"number",min:"1",id:"capacity_cylinders",...Se("capacity_cylinders",{valueAsNumber:!0,min:{value:1,message:"Capacity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"1000"}),we.capacity_cylinders&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:we.capacity_cylinders.message})]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Location"})}),T&&t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("label",{htmlFor:"addressInput",className:"block text-sm font-medium text-gray-700",children:"Address *"}),t.jsx("input",{type:"text",id:"addressInput",value:n,onChange:St=>{P(St.target.value),W(null)},className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Start typing address..."}),z&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Searching..."}),H.length>0&&!U&&t.jsx("ul",{className:"border border-gray-200 rounded bg-white mt-1 max-h-48 overflow-y-auto z-10 relative",children:H.map((St,ft)=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-50",onClick:()=>{W(St),P(St.display_name),ke("address.line1",St.address_line1||""),ke("address.line2",St.address_line2||""),ke("address.city",St.city||""),ke("address.state",St.state||""),ke("address.postal_code",St.postal_code||""),ke("address.country",St.country||""),ke("address.latitude",St.lat),ke("address.longitude",St.lng)},children:St.display_name},ft))}),U&&t.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Address selected"}),Me&&st&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{ref:J,style:{width:"100%",height:200,borderRadius:8,overflow:"hidden",position:"relative"}}),t.jsx("div",{className:"flex justify-end mt-2",children:me?t.jsx("button",{type:"button",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",onClick:()=>Pe(!1),children:"Save Pin Location"}):t.jsx("button",{type:"button",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs",onClick:()=>Pe(!0),children:"Adjust Pin"})})]}),t.jsx("label",{htmlFor:"address.instructions",className:"block text-sm font-medium text-gray-700 mt-4",children:"Access Instructions"}),t.jsx("textarea",{rows:2,...Se("address.instructions"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Gate codes, special access requirements, loading dock information..."})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse",children:[t.jsxs("button",{type:"submit",className:"inline-flex w-full justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",disabled:w,children:[w?t.jsx(or,{className:"animate-spin h-5 w-5 mr-2"}):null,"Save"]}),t.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:d,children:"Cancel"})]})]})})]})}):null},mC=()=>{const{data:c,isLoading:d}=lC();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(3)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const g=[{name:"Total Warehouses",value:c.total,icon:Cn,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Total Capacity",value:c.total_capacity.toLocaleString()+" cylinders",icon:Ko,color:"text-green-600",bgColor:"bg-green-50"},{name:"Average Capacity",value:c.average_capacity.toLocaleString()+" cylinders",icon:rc,color:"text-purple-600",bgColor:"bg-purple-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Warehouse Overview"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:g.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-lg font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]})},pC=()=>{const c=si(),[d,g]=oe.useState({page:1}),[f,w]=oe.useState(!1),[N,T]=oe.useState(null),[A,n]=oe.useState(null),{data:P,isLoading:z,error:q,refetch:U}=Yf(d),W=cC(),H=bb(),G=dC();oe.useEffect(()=>{console.log("WarehousesPage state:",{filters:d,data:P,isLoading:z,error:q,isFormOpen:f,editingWarehouse:N})},[d,P,z,q,f,N]);const J=()=>{console.log("Adding new warehouse"),T(null),w(!0)},de=fe=>{console.log("Editing warehouse:",fe),T(fe),w(!0)},ne=fe=>{console.log("Viewing warehouse:",fe),c(`/warehouses/${fe.id}`)},te=fe=>{console.log("Deleting warehouse:",fe),n(fe)},Ne=async fe=>{console.log("Form submit:",fe);try{N?await H.mutateAsync({id:N.id,...fe}):await W.mutateAsync(fe),w(!1),T(null)}catch(Be){console.error("Form submit error:",Be)}},me=async()=>{if(A){console.log("Confirming delete:",A);try{await G.mutateAsync(A.id),n(null)}catch(fe){console.error("Delete error:",fe)}}},Pe=fe=>{console.log("Page change:",fe),g(Be=>({...Be,page:fe}))},Se=()=>{console.log("Refreshing warehouses"),U()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Warehouses"}),t.jsx("p",{className:"text-gray-600",children:"Manage storage facilities and inventory locations"}),q&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",q.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:Se,disabled:z,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(el,{className:`h-4 w-4 ${z?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:J,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Warehouse"})]})]})]}),t.jsx(mC,{}),t.jsx(hC,{filters:d,onFiltersChange:g}),t.jsx(uC,{warehouses:(P==null?void 0:P.warehouses)||[],loading:z,onView:ne,onEdit:de,onDelete:te}),P&&P.totalPages>1&&t.jsx(ac,{currentPage:P.currentPage,totalPages:P.totalPages,totalCount:P.totalCount,onPageChange:Pe}),t.jsx(vb,{isOpen:f,onClose:()=>{console.log("Closing form"),w(!1),T(null)},onSubmit:Ne,warehouse:N||void 0,loading:W.isPending||H.isPending,title:N?"Edit Warehouse":"Add New Warehouse"}),t.jsx(ro,{isOpen:!!A,onClose:()=>n(null),onConfirm:me,title:"Delete Warehouse",message:`Are you sure you want to delete "${A==null?void 0:A.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:G.isPending})]})},fC=(c={})=>xt.inventory.list.useQuery({warehouse_id:c.warehouse_id,product_id:c.product_id,low_stock_only:c.low_stock_only||!1},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Inventory fetch error:",d),Pt.error("Failed to load inventory")}}),wb=c=>xt.inventory.getByWarehouse.useQuery({warehouse_id:c},{enabled:!!c,staleTime:3e4,retry:1,onError:d=>{console.error("Warehouse inventory fetch error:",d),Pt.error("Failed to load warehouse inventory")}}),gC=c=>xt.inventory.getStats.useQuery({warehouse_id:c},{enabled:!0,staleTime:6e4,retry:1,onError:d=>{console.error("Inventory stats fetch error:",d),Pt.error("Failed to load inventory statistics")}}),xC=()=>{const c=xt.useContext();return xt.inventory.adjustStock.useMutation({onSuccess:d=>{console.log("Stock adjusted successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),Pt.success("Stock levels updated successfully")},onError:d=>{console.error("Stock adjustment error:",d),Pt.error(d.message||"Failed to adjust stock levels")}})},yC=()=>{const c=xt.useContext();return xt.inventory.transferStock.useMutation({onSuccess:d=>{console.log("Stock transferred successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),Pt.success("Stock transferred successfully")},onError:d=>{console.error("Stock transfer error:",d),Pt.error(d.message||"Failed to transfer stock")}})},_C=()=>{const c=xt.useContext();return xt.inventory.create.useMutation({onSuccess:d=>{console.log("Inventory balance created successfully:",d),c.inventory.list.invalidate(),c.inventory.getByWarehouse.invalidate(),c.inventory.getStats.invalidate(),Pt.success("Inventory balance created successfully")},onError:d=>{console.error("Create inventory error:",d),Pt.error(d.message||"Failed to create inventory balance")}})},lf={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_URL:"/api/v1/trpc",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRyY3JqaW5yZGpnaXpxaGpkZ3ZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNDE2NTAsImV4cCI6MjA2NDYxNzY1MH0.2-y5r5UzIfcGoHc6BPkRy5rnxWxl4SJwxUehPWBxAao",VITE_SUPABASE_URL:"https://trcrjinrdjgizqhjdgvc.supabase.co"},bC=()=>{var J,de;const{id:c}=nc(),d=si(),[g,f]=oe.useState(!1),w=oe.useRef(null),[N,T]=oe.useState(null),{data:A,isLoading:n,error:P}=oC(c),{data:z=[],isLoading:q}=wb(c),U=bb(),W=async ne=>{if(A)try{await U.mutateAsync({id:A.id,...ne}),f(!1)}catch{}},H=ne=>new Date(ne).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),G=ne=>ne?ne.toLocaleString()+" cylinders":"Not specified";return oe.useEffect(()=>{var te,Ne;if(!((te=A==null?void 0:A.address)!=null&&te.latitude)||!((Ne=A==null?void 0:A.address)!=null&&Ne.longitude)||!w.current)return;const ne=lf==null?void 0:lf.VITE_MAPBOX_API_KEY;if(!ne){console.warn("Mapbox access token not found");return}if(N){try{N.remove()}catch(me){console.warn("Error removing existing map:",me)}T(null)}try{vi.accessToken=ne;const me=new vi.Map({container:w.current,style:"mapbox://styles/mapbox/streets-v11",center:[A.address.longitude,A.address.latitude],zoom:14});me.addControl(new vi.NavigationControl,"top-right"),new vi.Marker({anchor:"center"}).setLngLat([A.address.longitude,A.address.latitude]).addTo(me),me.on("load",()=>{try{me.resize()}catch(Pe){console.warn("Error resizing map:",Pe)}}),T(me)}catch(me){console.error("Error initializing map:",me)}},[(J=A==null?void 0:A.address)==null?void 0:J.latitude,(de=A==null?void 0:A.address)==null?void 0:de.longitude]),oe.useEffect(()=>()=>{if(N){try{N.remove()}catch(ne){console.warn("Error cleaning up map:",ne)}T(null)}},[N]),n?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]}):P||!A?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Warehouse not found or error loading warehouse details."})})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/warehouses"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Warehouses"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:A.name})]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(fi,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Warehouse"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Warehouse Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Warehouse Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Cn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:A.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Storage Capacity"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ps,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:G(A.capacity_cylinders)})]})]})]})]}),A.address&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Location"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Physical Address"}),t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(En,{className:"h-4 w-4 text-gray-400 mt-0.5"}),t.jsxs("div",{className:"text-gray-900",children:[t.jsx("div",{children:A.address.line1}),A.address.line2&&t.jsx("div",{children:A.address.line2}),t.jsxs("div",{children:[A.address.city,A.address.state&&`, ${A.address.state}`,A.address.postal_code&&` ${A.address.postal_code}`]}),t.jsx("div",{children:A.address.country})]})]})]}),A.address.latitude&&A.address.longitude&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-2",children:"Map Location"}),t.jsx("div",{ref:w,className:"w-full h-64 rounded-lg border border-gray-300",style:{minHeight:"256px"}})]}),A.address.instructions&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Access Instructions"}),t.jsx("p",{className:"text-gray-900",children:A.address.instructions})]})]})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Details"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:H(A.created_at)})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Inventory"}),q?t.jsx("div",{className:"flex justify-center py-4",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):z.length>0?t.jsx("div",{className:"space-y-3",children:z.map(ne=>{var te,Ne,me;return t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-900",children:(te=ne.product)==null?void 0:te.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",(Ne=ne.product)==null?void 0:Ne.sku]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ps,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm font-medium text-gray-600",children:(me=ne.product)==null?void 0:me.unit_of_measure})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center border border-green-200",children:[t.jsx("div",{className:"text-2xl font-bold text-green-700",children:ne.qty_full}),t.jsx("div",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Full"})]}),t.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 text-center border border-gray-300",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-700",children:ne.qty_empty}),t.jsx("div",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Empty"})]}),t.jsxs("div",{className:`rounded-lg p-3 text-center border ${ne.qty_reserved>0?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}`,children:[t.jsx("div",{className:`text-2xl font-bold ${ne.qty_reserved>0?"text-yellow-700":"text-blue-700"}`,children:ne.qty_reserved}),t.jsx("div",{className:`text-xs font-medium uppercase tracking-wide ${ne.qty_reserved>0?"text-yellow-600":"text-blue-600"}`,children:"Reserved"})]})]}),t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-gray-500",children:"Available:"}),t.jsxs("span",{className:"font-semibold text-gray-900",children:[ne.qty_full-ne.qty_reserved," units"]})]})})]},ne.id)})}):t.jsxs("div",{className:"text-center py-4",children:[t.jsx(ps,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"This warehouse has no inventory yet."})]})]})]})]}),t.jsx(vb,{isOpen:g,onClose:()=>f(!1),onSubmit:W,warehouse:A,loading:U.isPending,title:"Edit Warehouse"})]})},vC=({inventory:c,loading:d=!1,onAdjustStock:g,onTransferStock:f})=>{const w=A=>new Date(A).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=A=>A===0?"text-red-600 bg-red-50":A<=10?"text-yellow-600 bg-yellow-50":"text-green-600 bg-green-50",T=A=>A===0?t.jsx(Vs,{className:"h-4 w-4"}):A<=10?t.jsx(Vs,{className:"h-4 w-4"}):null;return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading inventory..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(ps,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No inventory found"}),t.jsx("p",{className:"text-gray-500",children:"No inventory records found for the selected filters."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Inventory (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reserved"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Available"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(A=>{var q,U,W;const n=A.qty_full-A.qty_reserved,P=N(n),z=T(n);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((q=A.product)==null?void 0:q.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((U=A.product)==null?void 0:U.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:((W=A.warehouse)==null?void 0:W.name)||"Unknown Warehouse"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:A.qty_reserved})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-sm font-medium ${P}`,children:[z,t.jsx("span",{children:n})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:w(A.updated_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(A),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Adjust stock",children:t.jsx(fi,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>f(A),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors",title:"Transfer stock",children:t.jsx(p_,{className:"h-4 w-4"})})]})})]},A.id)})})]})})]})},em=({value:c,onChange:d,placeholder:g="Select warehouse...",className:f="",required:w=!1})=>{const{data:N,isLoading:T}=eg();return T?t.jsx("div",{className:`relative ${f}`,children:t.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:[t.jsx(Cn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-500",children:"Loading warehouses..."})]})}):t.jsx("div",{className:`relative ${f}`,children:t.jsxs("div",{className:"relative",children:[t.jsx(Cn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c||"",onChange:A=>d(A.target.value),required:w,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:g}),N==null?void 0:N.map(A=>t.jsx("option",{value:A.id,children:A.city&&A.state?`${A.name} (${A.city}, ${A.state})`:A.name},A.id))]}),t.jsx(om,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"})]})})},wC=({filters:c,onFiltersChange:d})=>{const g=T=>{d({...c,search:T.target.value||void 0,page:1})},f=T=>{d({...c,warehouse_id:T||void 0,page:1})},w=()=>{d({...c,low_stock_only:!c.low_stock_only,page:1})},N=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by product SKU or name...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-64",children:t.jsx(em,{value:c.warehouse_id,onChange:f,placeholder:"All Warehouses"})}),t.jsxs("button",{onClick:w,className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${c.low_stock_only?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,title:"Show items with intelligent low stock detection",children:[t.jsx(Vs,{className:"h-4 w-4"}),t.jsx("span",{children:"Smart Low Stock"})]}),t.jsxs("button",{onClick:N,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},jC=()=>{const{data:c,isLoading:d}=gC();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[...Array(6)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const g=[{name:"Total Cylinders",value:c.total_cylinders.toLocaleString(),icon:ps,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Full Cylinders",value:c.total_full.toLocaleString(),icon:Zn,color:"text-green-600",bgColor:"bg-green-50"},{name:"Empty Cylinders",value:c.total_empty.toLocaleString(),icon:ZN,color:"text-gray-600",bgColor:"bg-gray-50"},{name:"Reserved",value:c.total_reserved.toLocaleString(),icon:JN,color:"text-orange-600",bgColor:"bg-orange-50"},{name:"Available",value:c.total_available.toLocaleString(),icon:sn,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"Low Stock Items",value:c.low_stock_products.toLocaleString(),icon:Vs,color:"text-red-600",bgColor:"bg-red-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Inventory Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:g.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]})},NC=({isOpen:c,onClose:d,onSubmit:g,inventory:f,loading:w=!1})=>{var J,de;const{register:N,handleSubmit:T,reset:A,watch:n,formState:{errors:P}}=kn({defaultValues:{inventory_id:f.id,adjustment_type:"physical_count",qty_full_change:0,qty_empty_change:0,reason:""}}),z=n("qty_full_change")||0,q=n("qty_empty_change")||0,U=async ne=>{try{const te=await xt.inventory.validateAdjustment.mutate({inventory_id:ne.inventory_id,qty_full_change:ne.qty_full_change,qty_empty_change:ne.qty_empty_change,adjustment_type:ne.adjustment_type});return te.valid?(te.warnings.length>0&&console.warn("Stock adjustment warnings:",te.warnings),!0):te.errors[0]||"Stock adjustment validation failed"}catch(te){return console.error("Stock adjustment validation error:",te),"Failed to validate stock adjustment"}};oe.useEffect(()=>{f&&A({inventory_id:f.id,adjustment_type:"physical_count",qty_full_change:0,qty_empty_change:0,reason:""})},[f,A]);const W=async ne=>{try{if(await U({inventory_id:ne.inventory_id,qty_full_change:ne.qty_full_change,qty_empty_change:ne.qty_empty_change,adjustment_type:ne.adjustment_type})!==!0)return;g(ne)}catch(te){console.error("Form validation error:",te)}},H=f.qty_full+z,G=f.qty_empty+q;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:T(W),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Adjust Stock"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Current Stock Levels"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.qty_full}),t.jsx("div",{className:"text-sm text-gray-600",children:"Full Cylinders"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-600",children:f.qty_empty}),t.jsx("div",{className:"text-sm text-gray-600",children:"Empty Cylinders"})]})]}),t.jsxs("div",{className:"mt-3 text-center",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Product: ",t.jsx("span",{className:"font-medium",children:(J=f.product)==null?void 0:J.name})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Warehouse: ",t.jsx("span",{className:"font-medium",children:(de=f.warehouse)==null?void 0:de.name})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"adjustment_type",className:"block text-sm font-medium text-gray-700",children:"Adjustment Type *"}),t.jsxs("select",{id:"adjustment_type",...N("adjustment_type",{required:"Adjustment type is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"received_full",children:"Received Full Cylinders"}),t.jsx("option",{value:"received_empty",children:"Received Empty Cylinders"}),t.jsx("option",{value:"physical_count",children:"Physical Count Adjustment"}),t.jsx("option",{value:"damage_loss",children:"Damage/Loss"}),t.jsx("option",{value:"other",children:"Other"})]}),P.adjustment_type&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.adjustment_type.message})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_full_change",className:"block text-sm font-medium text-gray-700",children:"Full Cylinders Change"}),t.jsx("input",{type:"number",id:"qty_full_change",...N("qty_full_change",{valueAsNumber:!0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),P.qty_full_change&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.qty_full_change.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_empty_change",className:"block text-sm font-medium text-gray-700",children:"Empty Cylinders Change"}),t.jsx("input",{type:"number",id:"qty_empty_change",...N("qty_empty_change",{valueAsNumber:!0}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),P.qty_empty_change&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.qty_empty_change.message})]})]}),(z!==0||q!==0)&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"Resulting Stock Levels"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:H}),z>0&&t.jsx(sn,{className:"h-4 w-4 text-green-600"}),z<0&&t.jsx(Wy,{className:"h-4 w-4 text-red-600"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Full Cylinders"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:G}),q>0&&t.jsx(sn,{className:"h-4 w-4 text-green-600"}),q<0&&t.jsx(Wy,{className:"h-4 w-4 text-red-600"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Empty Cylinders"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700",children:"Reason/Notes *"}),t.jsx("textarea",{id:"reason",rows:3,...N("reason",{required:"Reason is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Explain the reason for this stock adjustment..."}),P.reason&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.reason.message})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Adjusting..."})]}):"Adjust Stock"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},SC=({isOpen:c,onClose:d,onSubmit:g,inventory:f,loading:w=!1})=>{var J,de,ne;const{register:N,handleSubmit:T,reset:A,watch:n,setValue:P,formState:{errors:z}}=kn({defaultValues:{from_warehouse_id:f.warehouse_id,to_warehouse_id:"",product_id:f.product_id,qty_full:0,qty_empty:0,notes:""}}),q=n("qty_full")||0,U=n("qty_empty")||0,W=n("to_warehouse_id");oe.useEffect(()=>{f&&A({from_warehouse_id:f.warehouse_id,to_warehouse_id:"",product_id:f.product_id,qty_full:0,qty_empty:0,notes:""})},[f,A]);const H=te=>{g(te)},G=te=>{P("to_warehouse_id",te)};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:t.jsxs("form",{onSubmit:T(H),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Transfer Stock"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Product Information"}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"Product:"})," ",(J=f.product)==null?void 0:J.name]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"SKU:"})," ",(de=f.product)==null?void 0:de.sku]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"From Warehouse"}),t.jsx("div",{className:"text-sm text-blue-800 font-medium",children:(ne=f.warehouse)==null?void 0:ne.name}),t.jsxs("div",{className:"mt-2 space-y-1 text-xs text-blue-700",children:[t.jsxs("div",{children:["Full: ",f.qty_full]}),t.jsxs("div",{children:["Empty: ",f.qty_empty]})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(VN,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"To Warehouse"}),t.jsx(em,{value:W,onChange:G,placeholder:"Select destination...",className:"w-full",required:!0}),z.to_warehouse_id&&t.jsx("p",{className:"mt-1 text-xs text-red-600",children:"Destination warehouse is required"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Transfer Quantities"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_full",className:"block text-sm font-medium text-gray-700",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",max:f.qty_full,id:"qty_full",...N("qty_full",{valueAsNumber:!0,min:{value:0,message:"Quantity must be positive"},max:{value:f.qty_full,message:`Cannot exceed available quantity (${f.qty_full})`}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Available: ",f.qty_full]}),z.qty_full&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.qty_full.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"qty_empty",className:"block text-sm font-medium text-gray-700",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",max:f.qty_empty,id:"qty_empty",...N("qty_empty",{valueAsNumber:!0,min:{value:0,message:"Quantity must be positive"},max:{value:f.qty_empty,message:`Cannot exceed available quantity (${f.qty_empty})`}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0"}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Available: ",f.qty_empty]}),z.qty_empty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.qty_empty.message})]})]}),(q>0||U>0)&&t.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsxs("div",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Transfer Summary:"})," ",q," full + ",U," empty cylinders"]})})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Transfer Notes"}),t.jsx("textarea",{id:"notes",rows:3,...N("notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional notes about this transfer..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w||!W||q===0&&U===0,className:"inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Transferring..."})]}):"Transfer Stock"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},TC=()=>{const[c,d]=oe.useState({page:1}),[g,f]=oe.useState(null),[w,N]=oe.useState(null),[T,A]=oe.useState(!1),{data:n,isLoading:P,error:z,refetch:q}=fC(c),{data:U}=cc({limit:1e3}),{data:W}=Yf({limit:1e3}),H=xC(),G=yC(),J=_C(),de=(U==null?void 0:U.products)||[],ne=(W==null?void 0:W.warehouses)||[];oe.useEffect(()=>{console.log("InventoryPage state:",{filters:c,data:n,isLoading:P,error:z,adjustingInventory:g,transferringInventory:w})},[c,n,P,z,g,w]);const te=Ge=>{console.log("Adjusting stock for:",Ge),f(Ge)},Ne=Ge=>{console.log("Transferring stock for:",Ge),N(Ge)},me=()=>{console.log("Adding new stock"),A(!0)},Pe=async Ge=>{console.log("Adjustment submit:",Ge);try{await H.mutateAsync(Ge),f(null)}catch(we){console.error("Adjustment error:",we)}},Se=async Ge=>{console.log("Transfer submit:",Ge);try{await G.mutateAsync(Ge),N(null)}catch(we){console.error("Transfer error:",we)}},fe=async Ge=>{console.log("Add stock submit:",Ge);try{await J.mutateAsync(Ge),A(!1)}catch(we){console.error("Add stock error:",we)}},Be=Ge=>{console.log("Page change:",Ge),d(we=>({...we,page:Ge}))},ke=()=>{console.log("Refreshing inventory"),q()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),t.jsx("p",{className:"text-gray-600",children:"Track stock levels across all warehouses"}),z&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",z.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:ke,disabled:P,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(el,{className:`h-4 w-4 ${P?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:me,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",title:"Add new inventory record",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Stock"})]})]})]}),t.jsx(jC,{}),t.jsx(wC,{filters:c,onFiltersChange:d}),t.jsx(vC,{inventory:(n==null?void 0:n.inventory)||[],loading:P,onAdjustStock:te,onTransferStock:Ne}),n&&n.totalPages>1&&t.jsx(ac,{currentPage:n.currentPage,totalPages:n.totalPages,totalCount:n.totalCount,onPageChange:Be}),g&&t.jsx(NC,{isOpen:!!g,onClose:()=>f(null),onSubmit:Pe,inventory:g,loading:H.isPending}),w&&t.jsx(SC,{isOpen:!!w,onClose:()=>N(null),onSubmit:Se,inventory:w,loading:G.isPending}),T&&t.jsx(EC,{isOpen:T,onClose:()=>A(!1),onSubmit:fe,products:de,warehouses:ne,loading:J.isPending})]})},EC=({isOpen:c,onClose:d,onSubmit:g,products:f,warehouses:w,loading:N=!1})=>{const[T,A]=oe.useState({warehouse_id:"",product_id:"",qty_full:0,qty_empty:0,qty_reserved:0}),n=z=>{z.preventDefault(),T.warehouse_id&&T.product_id&&g(T)},P=(z,q)=>{A(U=>({...U,[z]:q}))};return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:n,children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Add New Stock Record"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(Nr,{className:"h-6 w-6 rotate-45"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warehouse *"}),t.jsxs("select",{value:T.warehouse_id,onChange:z=>P("warehouse_id",z.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select a warehouse..."}),w.map(z=>t.jsx("option",{value:z.id,children:z.name},z.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product *"}),t.jsxs("select",{value:T.product_id,onChange:z=>P("product_id",z.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select a product..."}),f.filter(z=>z.status==="active").map(z=>t.jsxs("option",{value:z.id,children:[z.name," (",z.sku,")"]},z.id))]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:T.qty_full,onChange:z=>P("qty_full",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:T.qty_empty,onChange:z=>P("qty_empty",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reserved Cylinders"}),t.jsx("input",{type:"number",min:"0",max:T.qty_full,value:T.qty_reserved,onChange:z=>P("qty_reserved",parseInt(z.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Cannot exceed full cylinders quantity"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||!T.warehouse_id||!T.product_id,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Adding...":"Add Stock Record"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},CC=({priceLists:c,loading:d=!1,onView:g,onEdit:f,onDuplicate:w,onSetDefault:N,onDelete:T})=>{const A=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading price lists..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(tn,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No price lists found"}),t.jsx("p",{className:"text-gray-500",children:"Get started by creating your first price list."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Price Lists (",c.length,")"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price List"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Currency"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Range"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Products"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(n=>{const P=n.statusInfo||{status:"active",label:"Active",color:"bg-green-100 text-green-800 border-green-200"},z=n.isExpiringSoon||!1;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>g(n),className:"text-sm font-medium text-blue-600 hover:text-blue-900 hover:underline",children:n.name}),n.is_default&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx(Hh,{className:"h-3 w-3 mr-1"}),"Default"]}),z&&t.jsx(Vs,{className:"h-4 w-4 text-yellow-500",title:"Expiring soon"})]}),n.description&&t.jsx("div",{className:"text-sm text-gray-500 mt-1 max-w-xs truncate",children:n.description})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900 font-mono",children:n.currency_code})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-4 w-4 text-gray-400"}),t.jsx("div",{className:"text-sm text-gray-900",children:_b(n.start_date,n.end_date)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${P.color}`,children:P.label})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.product_count||0})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:A(n.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>f(n),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit price list",children:t.jsx(fi,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>w(n),className:"text-purple-600 hover:text-purple-900 p-1 rounded hover:bg-purple-50 transition-colors",title:"Duplicate price list",children:t.jsx(WN,{className:"h-4 w-4"})}),!n.is_default&&t.jsx("button",{onClick:()=>N(n),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50 transition-colors",title:"Set as default",children:t.jsx(Hh,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>T(n),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete price list",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},n.id)})})]})})]})},kC=({filters:c,onFiltersChange:d})=>{const g=N=>{d({...c,search:N.target.value||void 0,page:1})},f=N=>{d({...c,status:N.target.value||void 0,page:1})},w=()=>{d({page:1})};return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name or description...",value:c.search||"",onChange:g,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-32",children:t.jsxs("div",{className:"relative",children:[t.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"future",children:"Future"}),t.jsx("option",{value:"expired",children:"Expired"})]})]})}),t.jsxs("button",{onClick:w,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]})})},jb=({isOpen:c,onClose:d,onSubmit:g,priceList:f,loading:w=!1,title:N})=>{const{register:T,handleSubmit:A,reset:n,watch:P,formState:{errors:z}}=kn({defaultValues:{name:"",description:"",currency_code:"KES",start_date:new Date().toISOString().split("T")[0],end_date:"",is_default:!1}}),q=P("start_date"),U=P("end_date"),W=P("is_default");oe.useEffect(()=>{n(f?{name:f.name,description:f.description||"",currency_code:"KES",start_date:f.start_date,end_date:f.end_date||"",is_default:f.is_default}:{name:"",description:"",currency_code:"KES",start_date:new Date().toISOString().split("T")[0],end_date:"",is_default:!1})},[f,n]);const H=J=>{const de={...J,currency_code:"KES",end_date:J.end_date||void 0,description:J.description||void 0};g(de)},G=!U||rC(q,U);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(H),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:N}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Price List Name *"}),t.jsx("input",{type:"text",id:"name",...T("name",{required:"Price list name is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Standard 2025"}),z.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx("textarea",{id:"description",rows:3,...T("description"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional description of this price list..."})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"currency_code",className:"block text-sm font-medium text-gray-700",children:"Currency"}),t.jsx("div",{className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm bg-gray-50",children:t.jsx("span",{className:"text-gray-900",children:"KES - Kenyan Shilling (KSh)"})}),t.jsx("input",{type:"hidden",...T("currency_code"),value:"KES"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:"Start Date *"}),t.jsx("input",{type:"date",id:"start_date",...T("start_date",{required:"Start date is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.start_date&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.start_date.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:"End Date"}),t.jsx("input",{type:"date",id:"end_date",...T("end_date"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave empty for no end date"})]})]}),!G&&t.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vs,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:"End date must be after start date"})]})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"is_default",...T("is_default"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"is_default",className:"ml-2 block text-sm text-gray-900",children:"Set as default price list"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Only one price list can be set as default at a time"}),W&&t.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsx("p",{className:"text-xs text-yellow-800",children:"Setting this as default will unset any existing default price list"})})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:w||!G,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Price List"}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},AC=()=>{const{data:c,isLoading:d}=YE();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[...Array(6)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const g=[{name:"Total Price Lists",value:c.total_price_lists,icon:tn,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Active",value:c.active_price_lists,icon:Zn,color:"text-green-600",bgColor:"bg-green-50"},{name:"Future",value:c.future_price_lists,icon:en,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Expired",value:c.expired_price_lists,icon:fa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Expiring Soon",value:c.expiring_soon,icon:Vs,color:"text-yellow-600",bgColor:"bg-yellow-50"},{name:"No Pricing",value:c.products_without_pricing,icon:ps,color:"text-gray-600",bgColor:"bg-gray-50"}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Pricing Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:g.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]})},MC=()=>{const c=si(),[d,g]=oe.useState({page:1}),[f,w]=oe.useState(!1),[N,T]=oe.useState(null),[A,n]=oe.useState(null),{data:P,isLoading:z,error:q,refetch:U}=Jf(d),W=JE(),H=gb(),G=eC(),J=tC();oe.useEffect(()=>{console.log("PricingPage state:",{filters:d,data:P,isLoading:z,error:q,isFormOpen:f,editingPriceList:N})},[d,P,z,q,f,N]);const de=()=>{console.log("Adding new price list"),T(null),w(!0)},ne=Ge=>{console.log("Editing price list:",Ge),T(Ge),w(!0)},te=Ge=>{console.log("Viewing price list:",Ge),c(`/pricing/${Ge.id}`)},Ne=Ge=>{console.log("Duplicating price list:",Ge),T({...Ge,id:"",name:`Copy of ${Ge.name}`,is_default:!1}),w(!0)},me=async Ge=>{console.log("Setting default price list:",Ge);try{await J.mutateAsync({id:Ge.id})}catch(we){console.error("Set default error:",we)}},Pe=Ge=>{console.log("Deleting price list:",Ge),n(Ge)},Se=async Ge=>{console.log("Form submit:",Ge);try{N!=null&&N.id?await H.mutateAsync({id:N.id,...Ge}):await W.mutateAsync(Ge),w(!1),T(null)}catch(we){console.error("Form submit error:",we)}},fe=async()=>{if(A){console.log("Confirming delete:",A);try{await G.mutateAsync({id:A.id}),n(null)}catch(Ge){console.error("Delete error:",Ge)}}},Be=Ge=>{console.log("Page change:",Ge),g(we=>({...we,page:Ge}))},ke=()=>{console.log("Refreshing price lists"),U()};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Price Catalog"}),t.jsx("p",{className:"text-gray-600",children:"Manage pricing for your products across different markets"}),q&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",q.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:ke,disabled:z,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(el,{className:`h-4 w-4 ${z?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:de,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Create Price List"})]})]})]}),t.jsx(AC,{}),t.jsx(kC,{filters:d,onFiltersChange:g}),t.jsx(CC,{priceLists:(P==null?void 0:P.priceLists)||[],loading:z,onView:te,onEdit:ne,onDuplicate:Ne,onSetDefault:me,onDelete:Pe}),P&&P.totalPages>1&&t.jsx(ac,{currentPage:P.currentPage,totalPages:P.totalPages,totalCount:P.totalCount,onPageChange:Be}),t.jsx(jb,{isOpen:f,onClose:()=>{console.log("Closing form"),w(!1),T(null)},onSubmit:Se,priceList:N||void 0,loading:W.isPending||H.isPending,title:N!=null&&N.id?"Edit Price List":"Create New Price List"}),t.jsx(ro,{isOpen:!!A,onClose:()=>n(null),onConfirm:fe,title:"Delete Price List",message:`Are you sure you want to delete "${A==null?void 0:A.name}"? This action cannot be undone.`,confirmText:"Delete",type:"danger",loading:G.isPending})]})},PC=({isOpen:c,onClose:d,onSubmit:g,priceList:f,loading:w=!1})=>{const[N,T]=oe.useState([]),[A,n]=oe.useState({}),[P,z]=oe.useState(""),{data:q}=cc({limit:1e3}),{data:U=[]}=xb(f.id),W=(q==null?void 0:q.products)||[],H=U.map(Ne=>Ne.product_id),G=W.filter(Ne=>Ne.status==="active"&&!H.includes(Ne.id)&&(P===""||Ne.name.toLowerCase().includes(P.toLowerCase())||Ne.sku.toLowerCase().includes(P.toLowerCase())));oe.useEffect(()=>{c||(T([]),n({}),z(""))},[c]);const J=(Ne,me)=>{if(me){const Pe=G.find(Se=>Se.id===Ne);Pe&&(T(Se=>[...Se,Ne]),n(Se=>({...Se,[Ne]:{productId:Ne,productName:Pe.name,productSku:Pe.sku,unitPrice:0,minQty:1,surchargeRate:void 0}})))}else T(Pe=>Pe.filter(Se=>Se!==Ne)),n(Pe=>{const Se={...Pe};return delete Se[Ne],Se})},de=(Ne,me,Pe)=>{n(Se=>({...Se,[Ne]:{...Se[Ne],[me]:Pe}}))},ne=()=>{const Ne=Object.values(A).filter(me=>me.unitPrice>0);Ne.length!==0&&g(Ne)},te=N.length>0&&N.every(Ne=>{var me;return((me=A[Ne])==null?void 0:me.unitPrice)>0});return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:["Add Products to: ",f.name]}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search products by name or SKU...",value:P,onChange:Ne=>z(Ne.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:["Select Products (",G.length," available)"]}),t.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:G.length>0?t.jsx("div",{className:"divide-y divide-gray-200",children:G.map(Ne=>t.jsx("div",{className:"p-3 hover:bg-gray-50",children:t.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:N.includes(Ne.id),onChange:me=>J(Ne.id,me.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ne.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Ne.sku,"  ",Ne.unit_of_measure,Ne.capacity_kg&&`  ${Ne.capacity_kg}kg`]})]})]})},Ne.id))}):t.jsxs("div",{className:"p-8 text-center",children:[t.jsx(ps,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500",children:P?"No products found matching your search.":"All products are already in this price list."})]})})]}),N.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Set Prices for Selected Products"}),t.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:N.map(Ne=>{const me=A[Ne];return me?t.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gray-50",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("h5",{className:"font-medium text-gray-900",children:me.productName}),t.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",me.productSku]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Unit Price (",f.currency_code,") *"]}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:me.unitPrice||"",onChange:Pe=>de(Ne,"unitPrice",parseFloat(Pe.target.value)||0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Quantity"}),t.jsx("input",{type:"number",min:"1",value:me.minQty,onChange:Pe=>de(Ne,"minQty",parseInt(Pe.target.value)||1),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Surcharge (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:me.surchargeRate||"",onChange:Pe=>de(Ne,"surchargeRate",parseFloat(Pe.target.value)||void 0),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"})]})]}),me.unitPrice>0&&t.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded",children:t.jsxs("span",{className:"text-sm text-blue-800",children:["Final Price: ",cs(au(me.unitPrice,me.surchargeRate),f.currency_code)]})})]},Ne):null})})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:ne,disabled:w||!te,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:w?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Adding..."})]}):`Add ${N.length} Product${N.length!==1?"s":""}`}),t.jsx("button",{type:"button",onClick:d,disabled:w,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]})}):null},IC=({isOpen:c,onClose:d,onSubmit:g,item:f,currencyCode:w,loading:N=!1})=>{var G,J;const{register:T,handleSubmit:A,reset:n,watch:P,formState:{errors:z}}=kn({defaultValues:{unit_price:f.unit_price,min_qty:f.min_qty,surcharge_pct:f.surcharge_pct||void 0}}),q=P("unit_price"),U=P("surcharge_pct");oe.useEffect(()=>{f&&n({unit_price:f.unit_price,min_qty:f.min_qty,surcharge_pct:f.surcharge_pct||void 0})},[f,n]);const W=de=>{g({unit_price:de.unit_price,min_qty:de.min_qty,surcharge_pct:de.surcharge_pct||null})},H=()=>au(q||0);return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(W),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Edit Product Price"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:(G=f.product)==null?void 0:G.name}),t.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",(J=f.product)==null?void 0:J.sku]})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"unit_price",className:"block text-sm font-medium text-gray-700",children:["Unit Price (",w,") *"]}),t.jsx("input",{type:"number",min:"0",step:"0.01",id:"unit_price",...T("unit_price",{required:"Unit price is required",min:{value:.01,message:"Price must be greater than 0"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.unit_price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.unit_price.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"min_qty",className:"block text-sm font-medium text-gray-700",children:"Minimum Quantity"}),t.jsx("input",{type:"number",min:"1",id:"min_qty",...T("min_qty",{required:"Minimum quantity is required",min:{value:1,message:"Minimum quantity must be at least 1"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),z.min_qty&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.min_qty.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"surcharge_pct",className:"block text-sm font-medium text-gray-700",children:"Surcharge Percentage (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",id:"surcharge_pct",...T("surcharge_pct",{min:{value:0,message:"Surcharge cannot be negative"},max:{value:100,message:"Surcharge cannot exceed 100%"}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.0"}),z.surcharge_pct&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:z.surcharge_pct.message})]}),q>0&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Final Price:"}),t.jsx("span",{className:"text-lg font-bold text-blue-900",children:cs(H(),w)})]}),U&&U>0&&t.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Base: ",cs(q,w)," + ",U,"% surcharge"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Changes"}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},DC=()=>{var ke;const{id:c}=nc(),d=si(),[g,f]=oe.useState(!1),[w,N]=oe.useState(!1),[T,A]=oe.useState(null),[n,P]=oe.useState(null),{data:z,isLoading:q,error:U}=QE(c),{data:W=[],refetch:H}=xb(c),G=gb(),J=yb(),de=async Ge=>{if(z)try{await G.mutateAsync({id:z.id,...Ge}),f(!1)}catch{}},ne=async Ge=>{try{for(const we of Ge)await J.mutateAsync({price_list_id:c,product_id:we.productId,unit_price:we.unitPrice,min_qty:we.minQty||1,surcharge_pct:we.surchargeRate||void 0});N(!1),H()}catch{}},te=Ge=>{A(Ge)},Ne=async Ge=>{T&&(alert("Update price list item functionality is temporarily disabled"),A(null))},me=Ge=>{P(Ge)},Pe=async()=>{n&&(alert("Delete price list item functionality is temporarily disabled"),P(null))},Se=Ge=>new Date(Ge).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),fe=(Ge,we)=>au(Ge);if(q)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(U||!z)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Price list not found or error loading details."})})})]});const Be=Mf(z.start_date,z.end_date);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/pricing"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Price Lists"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:z.name})]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(fi,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Price List"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Price List Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Name"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(tn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:z.name})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Currency"}),t.jsx("span",{className:"text-gray-900 font-mono",children:z.currency_code})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Be.color}`,children:Be.label})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Date Range"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-gray-900",children:_b(z.start_date,z.end_date)})]})]}),z.description&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),t.jsx("p",{className:"text-gray-900",children:z.description})]})]})]})}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Created"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:Se(z.created_at)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Products"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ps,{className:"h-4 w-4 text-gray-400"}),t.jsxs("span",{className:"text-sm text-gray-900",children:[W.length," products"]})]})]})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Products in this Price List (",W.length,")"]}),t.jsxs("button",{onClick:()=>N(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Products"})]})]}),W.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Min Qty"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Surcharge"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:W.map(Ge=>{var we,Me;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((we=Ge.product)==null?void 0:we.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((Me=Ge.product)==null?void 0:Me.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:cs(Ge.unit_price,z.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:Ge.min_qty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm text-gray-900",children:Ge.surcharge_pct?`${Ge.surcharge_pct}%`:"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:cs(fe(Ge.unit_price,Ge.surcharge_pct),z.currency_code)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>te(Ge),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit price",children:t.jsx(fi,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>me(Ge),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors",title:"Remove from list",children:t.jsx(so,{className:"h-4 w-4"})})]})})]},Ge.id)})})]})}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(ps,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products added yet"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"Add products to this price list to set their pricing."}),t.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Products"})]})]})]}),t.jsx(jb,{isOpen:g,onClose:()=>f(!1),onSubmit:de,priceList:z,loading:G.isPending,title:"Edit Price List"}),t.jsx(PC,{isOpen:w,onClose:()=>N(!1),onSubmit:ne,priceList:z,loading:J.isPending}),T&&t.jsx(IC,{isOpen:!!T,onClose:()=>A(null),onSubmit:Ne,item:T,currencyCode:z.currency_code,loading:!1}),t.jsx(ro,{isOpen:!!n,onClose:()=>P(null),onConfirm:Pe,title:"Remove Product",message:`Are you sure you want to remove "${(ke=n==null?void 0:n.product)==null?void 0:ke.name}" from this price list?`,confirmText:"Remove",type:"danger",loading:!1})]})},Nb=(c={})=>xt.orders.list.useQuery({status:c.status,customer_id:c.customer_id,search:c.search,order_date_from:c.order_date_from,order_date_to:c.order_date_to,scheduled_date_from:c.scheduled_date_from,scheduled_date_to:c.scheduled_date_to,include_analytics:c.include_analytics||!1,page:c.page||1,limit:c.limit||50},{enabled:!0,staleTime:3e4,retry:1,onError:d=>{console.error("Orders fetch error:",d),Pt.error("Failed to load orders")}}),LC=c=>xt.orders.getById.useQuery({order_id:c},{enabled:!!c&&c!=="null"&&c!=="undefined",staleTime:3e4,retry:1,onError:d=>{console.error("Order fetch error:",d),Pt.error("Failed to load order details")}}),RC=()=>{const c=xt.useContext();return xt.orders.create.useMutation({onSuccess:d=>{console.log("Order created successfully:",d),c.orders.list.invalidate(),Pt.success("Order created successfully")},onError:d=>{console.error("Create order error:",d),Pt.error(d.message||"Failed to create order")}})},Sb=()=>{const c=xt.useContext();return xt.orders.updateStatus.useMutation({onSuccess:d=>{console.log("Order status updated successfully:",d),c.orders.list.invalidate(),c.orders.getById.invalidate({order_id:d.id}),Pt.success("Order status updated successfully")},onError:d=>{console.error("Update order status error:",d),Pt.error(d.message||"Failed to update order status")}})},zC=()=>{const c=xt.useContext();return xt.orders.updateTax.useMutation({onSuccess:(d,g)=>{console.log("Order tax updated:",d),c.orders.getById.invalidate({order_id:g.order_id}),c.orders.list.invalidate(),Pt.success("Order tax updated successfully")},onError:d=>{console.error("Update tax error:",d),Pt.error(d.message||"Failed to update order tax")}})},OC=({orders:c,loading:d=!1,onView:g,onEdit:f,onChangeStatus:w,selectedOrders:N=[],onSelectionChange:T})=>{const[A,n]=oe.useState(!1),P=G=>new Date(G).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),z=G=>{switch(G){case"draft":return"bg-gray-100 text-gray-800 border-gray-300";case"confirmed":return"bg-blue-100 text-blue-800 border-blue-300";case"scheduled":return"bg-purple-100 text-purple-800 border-purple-300";case"en_route":return"bg-orange-100 text-orange-800 border-orange-300";case"delivered":return"bg-green-100 text-green-800 border-green-300";case"invoiced":return"bg-teal-100 text-teal-800 border-teal-300";case"cancelled":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},q=G=>`ORD-${G.substring(0,8).toUpperCase()}`,U=G=>{const J=[];switch(G.status){case"draft":J.push({label:"Confirm",action:()=>w(G,"confirmed"),icon:ps,color:"text-blue-600 hover:text-blue-900"});break;case"confirmed":J.push({label:"Schedule",action:()=>w(G,"scheduled"),icon:Gs,color:"text-purple-600 hover:text-purple-900"});break;case"scheduled":J.push({label:"En Route",action:()=>w(G,"en_route"),icon:br,color:"text-orange-600 hover:text-orange-900"});break;case"en_route":J.push({label:"Delivered",action:()=>w(G,"delivered"),icon:ps,color:"text-green-600 hover:text-green-900"});break;case"delivered":J.push({label:"Invoice",action:()=>w(G,"invoiced"),icon:w_,color:"text-teal-600 hover:text-teal-900"});break}return["draft","confirmed","scheduled"].includes(G.status)&&J.push({label:"Cancel",action:()=>w(G,"cancelled"),icon:fa,color:"text-red-600 hover:text-red-900"}),J},W=G=>{n(G),T&&T(G?c.map(J=>J.id):[])},H=(G,J)=>{if(T){const de=J?[...N,G]:N.filter(ne=>ne!==G);T(de),n(de.length===c.length)}};return d?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-6 w-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-gray-600",children:"Loading orders..."})]})})}):!c||c.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"mb-4",children:t.jsx(sc,{className:"h-12 w-12 text-gray-300 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No orders found"}),t.jsx("p",{className:"text-gray-500",children:"Get started by creating your first order."})]})}):t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Orders (",c.length,")"]}),N.length>0&&t.jsxs("span",{className:"text-sm text-blue-600",children:[N.length," selected"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[T&&t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:A,onChange:G=>W(G.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delivery Address"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dates"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(G=>{var de,ne,te,Ne;const J=U(G);return t.jsxs("tr",{className:"hover:bg-gray-50",children:[T&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",checked:N.includes(G.id),onChange:me=>H(G.id,me.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("button",{onClick:()=>g(G),className:"text-sm font-medium text-blue-600 hover:text-blue-900",children:q(G.id)}),t.jsxs("div",{className:"text-sm text-gray-500",children:[((de=G.order_lines)==null?void 0:de.length)||0," item",(((ne=G.order_lines)==null?void 0:ne.length)||0)!==1?"s":""]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((te=G.customer)==null?void 0:te.name)||"Unknown Customer"}),((Ne=G.customer)==null?void 0:Ne.email)&&t.jsx("div",{className:"text-sm text-gray-500",children:G.customer.email})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:G.delivery_address?t.jsxs(t.Fragment,{children:[t.jsx("div",{children:G.delivery_address.city}),G.delivery_address.state&&t.jsx("div",{className:"text-gray-500",children:G.delivery_address.state})]}):"No address"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsxs("div",{children:["Order: ",P(G.order_date)]}),G.scheduled_date&&t.jsxs("div",{className:"text-gray-500",children:["Scheduled: ",P(G.scheduled_date)]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${z(G.status)}`,children:G.status.replace("_"," ").toUpperCase()})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:G.total_amount?cs(G.total_amount):"-"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>g(G),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"View order",children:t.jsx(lm,{className:"h-4 w-4"})}),["draft","confirmed"].includes(G.status)&&t.jsx("button",{onClick:()=>f(G),className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50 transition-colors",title:"Edit order",children:t.jsx(fi,{className:"h-4 w-4"})}),J.slice(0,2).map((me,Pe)=>t.jsx("button",{onClick:me.action,className:`p-1 rounded hover:bg-gray-50 transition-colors ${me.color}`,title:me.label,children:t.jsx(me.icon,{className:"h-4 w-4"})},Pe))]})})]},G.id)})})]})})]})},FC=({filters:c,onFiltersChange:d,savedFilters:g=[],onSaveFilter:f,onLoadFilter:w})=>{const[N,T]=oe.useState(!1),[A,n]=oe.useState(!1),[P,z]=oe.useState(""),q=te=>{d({...c,search:te.target.value||void 0,page:1})},U=te=>{d({...c,status:te.target.value||void 0,page:1})},W=(te,Ne)=>{d({...c,[te]:Ne||void 0,page:1})},H=(te,Ne)=>{d({...c,[te]:Ne?parseFloat(Ne):void 0,page:1})},G=te=>{d({...c,delivery_area:te.target.value||void 0,page:1})},J=()=>{d({page:1})},de=()=>{P.trim()&&f&&(f(P.trim(),c),n(!1),z(""))},ne=[{name:"Today's Deliveries",filters:{scheduled_date_from:new Date().toISOString().split("T")[0],scheduled_date_to:new Date().toISOString().split("T")[0]}},{name:"Overdue Orders",filters:{is_overdue:!0}},{name:"Draft Orders",filters:{status:"draft"}},{name:"High Value Orders",filters:{amount_min:1e3}},{name:"This Week",filters:{order_date_from:new Date(Date.now()-7*864e5).toISOString().split("T")[0]}},{name:"Payment Overdue",filters:{payment_status:"overdue"}}];return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6 space-y-4",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by order ID, customer name, or product SKU...",value:c.search||"",onChange:q,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"sm:w-40",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsxs("select",{value:c.status||"",onChange:U,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"confirmed",children:"Confirmed"}),t.jsx("option",{value:"scheduled",children:"Scheduled"}),t.jsx("option",{value:"en_route",children:"En Route"}),t.jsx("option",{value:"delivered",children:"Delivered"}),t.jsx("option",{value:"invoiced",children:"Invoiced"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})}),t.jsxs("button",{onClick:()=>T(!N),className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${N?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[t.jsx(Qd,{className:"h-4 w-4"}),t.jsx("span",{children:"Advanced"})]}),t.jsxs("button",{onClick:J,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-md transition-colors",title:"Reset filters",children:[t.jsx(eo,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})]})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(te=>t.jsx("button",{onClick:()=>d({...te.filters,page:1}),className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors",children:te.name},te.name))}),g.length>0&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Hh,{className:"h-4 w-4 text-yellow-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Saved Filters:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(te=>t.jsx("button",{onClick:()=>w==null?void 0:w(te),className:"px-3 py-1 text-sm bg-yellow-100 text-yellow-800 rounded-full hover:bg-yellow-200 transition-colors",children:te.name},te.id))})]}),N&&t.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Date From"}),t.jsxs("div",{className:"relative",children:[t.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:c.order_date_from||"",onChange:te=>W("order_date_from",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Date To"}),t.jsx("input",{type:"date",value:c.order_date_to||"",onChange:te=>W("order_date_to",te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled From"}),t.jsxs("div",{className:"relative",children:[t.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:c.scheduled_date_from||"",onChange:te=>W("scheduled_date_from",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled To"}),t.jsx("input",{type:"date",value:c.scheduled_date_to||"",onChange:te=>W("scheduled_date_to",te.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx(tn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:c.amount_min||"",onChange:te=>H("amount_min",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx(tn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:c.amount_max||"",onChange:te=>H("amount_max",te.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Area"}),t.jsxs("div",{className:"relative",children:[t.jsx(En,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:c.delivery_area||"",onChange:G,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"City or region"})]})]})]}),f&&t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{onClick:()=>n(!0),className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(j_,{className:"h-4 w-4"}),t.jsx("span",{children:"Save Filter"})]})})]}),A&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>n(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Save Filter"}),t.jsx("button",{onClick:()=>n(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(eo,{className:"h-6 w-6"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter Name"}),t.jsx("input",{type:"text",value:P,onChange:te=>z(te.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Enter a name for this filter..."})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:de,disabled:!P.trim(),className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Save Filter"}),t.jsx("button",{onClick:()=>n(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})})]})},BC=(c,d)=>xt.analytics.getComprehensiveOrderAnalytics.useQuery({start_date:c,end_date:d},{enabled:!!(c&&d),staleTime:6e4,retry:1,onError:g=>{console.error("Comprehensive order analytics error:",g),Pt.error("Failed to load order analytics")}}),UC=(c="month")=>xt.analytics.getOrderStats.useQuery({period:c},{staleTime:6e4,retry:1,refetchInterval:5*60*1e3,onError:d=>{console.error("Order stats error:",d),Pt.error("Failed to load order statistics")}}),VC=()=>{const{data:c,isLoading:d}=UC();if(d)return t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[...Array(10)].map((f,w)=>t.jsx("div",{className:"h-16 bg-gray-200 rounded"},w))})]})});if(!c)return null;const g=[{name:"Total Orders",value:c.total_orders,icon:sc,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Draft",value:c.draft_orders,icon:sc,color:"text-gray-600",bgColor:"bg-gray-50"},{name:"Confirmed",value:c.confirmed_orders,icon:Zn,color:"text-blue-600",bgColor:"bg-blue-50"},{name:"Scheduled",value:c.scheduled_orders,icon:Gs,color:"text-purple-600",bgColor:"bg-purple-50"},{name:"En Route",value:c.en_route_orders,icon:br,color:"text-orange-600",bgColor:"bg-orange-50"},{name:"Delivered",value:c.delivered_orders,icon:ps,color:"text-green-600",bgColor:"bg-green-50"},{name:"Invoiced",value:c.invoiced_orders,icon:w_,color:"text-teal-600",bgColor:"bg-teal-50"},{name:"Cancelled",value:c.cancelled_orders,icon:fa,color:"text-red-600",bgColor:"bg-red-50"},{name:"Today's Deliveries",value:c.todays_deliveries,icon:Gs,color:"text-indigo-600",bgColor:"bg-indigo-50"},{name:"Overdue",value:c.overdue_orders,icon:Vs,color:"text-red-600",bgColor:"bg-red-50"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Overview"}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:g.map(f=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full ${f.bgColor} mb-2`,children:t.jsx(f.icon,{className:`h-6 w-6 ${f.color}`})}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.value}),t.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.name))})]}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Revenue"}),t.jsx("p",{className:"text-sm text-gray-600",children:"From invoiced orders"})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-green-50 rounded-full",children:t.jsx(sn,{className:"h-6 w-6 text-green-600"})}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"text-3xl font-bold text-gray-900",children:c.total_revenue?cs(c.total_revenue):"Ksh 0.00"})})]})]})}),(c.overdue_orders>0||c.todays_deliveries>0)&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.todays_deliveries>0&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-5 w-5 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Today's Deliveries"}),t.jsxs("p",{className:"text-sm text-blue-700",children:[c.todays_deliveries," order",c.todays_deliveries>1?"s":""," scheduled for delivery today"]})]})]})}),c.overdue_orders>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vs,{className:"h-5 w-5 text-red-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Overdue Orders"}),t.jsxs("p",{className:"text-sm text-red-700",children:[c.overdue_orders," order",c.overdue_orders>1?"s are":" is"," past scheduled delivery date"]})]})]})})]})]})},Tb=({isOpen:c,onClose:d,onSubmit:g,order:f,newStatus:w,loading:N=!1})=>{const{register:T,handleSubmit:A,reset:n,formState:{errors:P},watch:z}=kn({defaultValues:{order_id:f.id,new_status:w,notes:"",scheduled_date:""}}),q=z("scheduled_date");oe.useEffect(()=>{n({order_id:f.id,new_status:w,notes:"",scheduled_date:w==="scheduled"?new Date().toISOString().split("T")[0]:""})},[f.id,w,n]);const U=ne=>{g(ne)},W=ic(w),H=w==="scheduled",J=(()=>{const ne=[];if(w==="confirmed"){const te=DE(f);ne.push(...te.errors)}else w==="scheduled"&&(q||ne.push("Scheduled date is required"),f.delivery_address||ne.push("Delivery address is required"));return ne})(),de=J.length===0;return c?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),t.jsx("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:t.jsxs("form",{onSubmit:A(U),children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:"Change Order Status"}),t.jsx("button",{type:"button",onClick:d,className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current Status:"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${ic(f.status).color}`,children:f.status.replace("_"," ").toUpperCase()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"New Status:"}),t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${W.color}`,children:w.replace("_"," ").toUpperCase()})]}),t.jsx("div",{className:"mt-2 text-sm text-gray-600",children:W.description})]}),J.length>0&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(Vs,{className:"h-5 w-5 text-red-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Cannot proceed:"}),t.jsx("ul",{className:"mt-1 text-sm text-red-700 list-disc list-inside",children:J.map((ne,te)=>t.jsx("li",{children:ne},te))})]})]})}),H&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"scheduled_date",className:"block text-sm font-medium text-gray-700",children:"Scheduled Delivery Date *"}),t.jsx("input",{type:"date",id:"scheduled_date",...T("scheduled_date",{required:H?"Scheduled date is required":!1,validate:ne=>{if(H&&ne){const te=new Date(ne),Ne=new Date;if(Ne.setHours(0,0,0,0),te<Ne)return"Scheduled date cannot be in the past"}return!0}}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]}),P.scheduled_date&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.scheduled_date.message})]}),w==="confirmed"&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Note:"})," Confirming this order will reserve inventory for all products."]})}),w==="delivered"&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Note:"})," Marking as delivered will deduct inventory and release reserved stock."]})}),w==="cancelled"&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-red-800",children:[t.jsx("strong",{children:"Warning:"})," Cancelling this order will release any reserved inventory."]})})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{type:"submit",disabled:N||!de,className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed ${w==="cancelled"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}`,children:N?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(or,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:"Updating..."})]}):`Change to ${W.label}`}),t.jsx("button",{type:"button",onClick:d,disabled:N,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})})]})}):null},qC=({selectedOrders:c,onClearSelection:d,onBulkOperation:g})=>{const[f,w]=oe.useState(!1),[N,T]=oe.useState(!1),[A,n]=oe.useState(!1),[P,z]=oe.useState(""),[q,U]=oe.useState(""),[W,H]=oe.useState("");if(c.length===0)return null;const G=me=>c.every(Pe=>{switch(me){case"confirmed":return Pe.status==="draft";case"scheduled":return Pe.status==="confirmed";case"cancelled":return["draft","confirmed","scheduled"].includes(Pe.status);default:return!1}}),J=()=>{P&&(g({order_ids:c.map(me=>me.id),operation:"schedule",scheduled_date:P,notes:W}),T(!1),z(""),H(""))},de=()=>{q&&(g({order_ids:c.map(me=>me.id),operation:"status_change",new_status:q,notes:W}),n(!1),U(""),H(""))},ne=()=>{g({order_ids:c.map(me=>me.id),operation:"export"}),w(!1)},te=()=>{g({order_ids:c.map(me=>me.id),operation:"print"}),w(!1)},Ne=c.reduce((me,Pe)=>me+(Pe.total_amount||0),0);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[c.length," order",c.length>1?"s":""," selected"]}),t.jsxs("span",{className:"text-sm text-blue-700",children:["Total value: $",Ne.toLocaleString()]}),t.jsxs("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center space-x-1",children:[t.jsx(ar,{className:"h-3 w-3"}),t.jsx("span",{children:"Clear selection"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>w(!f),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx("span",{children:"Bulk Actions"}),t.jsx(om,{className:"h-4 w-4"})]}),f&&t.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg border border-gray-200 z-10",children:t.jsxs("div",{className:"py-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Status Changes"}),G("confirmed")&&t.jsxs("button",{onClick:()=>{U("confirmed"),n(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Zn,{className:"h-4 w-4 text-blue-600"}),t.jsx("span",{children:"Confirm Orders"})]}),G("scheduled")&&t.jsxs("button",{onClick:()=>{T(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Gs,{className:"h-4 w-4 text-purple-600"}),t.jsx("span",{children:"Schedule Deliveries"})]}),G("cancelled")&&t.jsxs("button",{onClick:()=>{U("cancelled"),n(!0),w(!1)},className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(ar,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{children:"Cancel Orders"})]}),t.jsxs("div",{className:"border-t border-gray-100 mt-1",children:[t.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Export & Print"}),t.jsxs("button",{onClick:ne,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Vf,{className:"h-4 w-4 text-green-600"}),t.jsx("span",{children:"Export to CSV"})]}),t.jsxs("button",{onClick:te,className:"flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(y_,{className:"h-4 w-4 text-gray-600"}),t.jsx("span",{children:"Print Manifests"})]})]})]})})]})]})}),N&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>T(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:["Schedule ",c.length," Orders"]}),t.jsx("button",{onClick:()=>T(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Delivery Date *"}),t.jsx("input",{type:"date",value:P,onChange:me=>z(me.target.value),min:new Date().toISOString().split("T")[0],className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),t.jsx("textarea",{value:W,onChange:me=>H(me.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Add notes for this bulk scheduling..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsx("button",{onClick:J,disabled:!P,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed",children:"Schedule Orders"}),t.jsx("button",{onClick:()=>T(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})}),A&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>n(!1)}),t.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[t.jsxs("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900",children:[q==="confirmed"&&"Confirm Orders",q==="cancelled"&&"Cancel Orders"]}),t.jsx("button",{onClick:()=>n(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500",children:t.jsx(ar,{className:"h-6 w-6"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-gray-700",children:["This will change the status of ",c.length," selected orders to"," ",t.jsx("span",{className:"font-medium",children:q}),"."]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:q==="cancelled"?"Cancellation Reason *":"Notes (Optional)"}),t.jsx("textarea",{value:W,onChange:me=>H(me.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:q==="cancelled"?"Please provide a reason for cancellation...":"Add notes for this status change..."})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[t.jsxs("button",{onClick:de,disabled:q==="cancelled"&&!W.trim(),className:`inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed ${q==="cancelled"?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"}`,children:[q==="confirmed"&&"Confirm Orders",q==="cancelled"&&"Cancel Orders"]}),t.jsx("button",{onClick:()=>n(!1),className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cancel"})]})]})]})})]})},$C=()=>{const c=si(),[d,g]=oe.useState({page:1}),[f,w]=oe.useState(null),[N,T]=oe.useState([]),{data:A,isLoading:n,error:P,refetch:z}=Nb(d),q=Sb();oe.useEffect(()=>{console.log("OrdersPage state:",{filters:d,data:A,isLoading:n,error:P,statusChangeOrder:f,selectedOrders:N})},[d,A,n,P,f,N]);const U=()=>{console.log("Creating new order"),c("/orders/new")},W=fe=>{console.log("Viewing order:",fe),c(`/orders/${fe.id}`)},H=fe=>{console.log("Editing order:",fe),c(`/orders/${fe.id}/edit`)},G=(fe,Be)=>{console.log("Changing order status:",fe,Be),w({order:fe,newStatus:Be})},J=async fe=>{console.log("Status change submit:",fe);try{await q.mutateAsync(fe),w(null)}catch(Be){console.error("Status change error:",Be)}},de=async fe=>{switch(console.log("Bulk operation:",fe),fe.operation){case"status_change":if(fe.new_status)for(const Be of fe.order_ids)(A==null?void 0:A.orders.find(Ge=>Ge.id===Be))&&await q.mutateAsync({order_id:Be,new_status:fe.new_status,notes:fe.notes});break;case"schedule":if(fe.scheduled_date)for(const Be of fe.order_ids)await q.mutateAsync({order_id:Be,new_status:"scheduled",scheduled_date:fe.scheduled_date,notes:fe.notes});break;case"export":ne(fe.order_ids);break;case"print":te(fe.order_ids);break}T([])},ne=fe=>{const Be=(A==null?void 0:A.orders.filter(st=>fe.includes(st.id)))||[],ke=[["Order ID","Customer","Status","Order Date","Scheduled Date","Total Amount"],...Be.map(st=>{var lt,St;return[st.id,((lt=st.customer)==null?void 0:lt.name)||"",st.status,st.order_date,st.scheduled_date||"",((St=st.total_amount)==null?void 0:St.toString())||"0"]})].map(st=>st.join(",")).join(`
`),Ge=new Blob([ke],{type:"text/csv"}),we=window.URL.createObjectURL(Ge),Me=document.createElement("a");Me.href=we,Me.download=`orders-export-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),window.URL.revokeObjectURL(we)},te=fe=>{console.log("Print manifests for orders:",fe)},Ne=fe=>{console.log("Page change:",fe),g(Be=>({...Be,page:fe}))},me=()=>{console.log("Refreshing orders"),z()},Pe=fe=>{T(fe)},Se=()=>{T([])};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Management"}),t.jsx("p",{className:"text-gray-600",children:"Manage customer orders and deliveries"}),P&&t.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",P.message]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>c("/orders/reports"),className:"flex items-center space-x-2 bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:[t.jsx(Ko,{className:"h-4 w-4"}),t.jsx("span",{children:"Reports"})]}),t.jsxs("button",{onClick:()=>c("/orders/schedule"),className:"flex items-center space-x-2 bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(Gs,{className:"h-4 w-4"}),t.jsx("span",{children:"Schedule"})]}),t.jsxs("button",{onClick:me,disabled:n,className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(el,{className:`h-4 w-4 ${n?"animate-spin":""}`}),t.jsx("span",{children:"Refresh"})]}),t.jsxs("button",{onClick:U,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Create Order"})]})]})]}),t.jsx(VC,{}),t.jsx(FC,{filters:d,onFiltersChange:g}),t.jsx(qC,{selectedOrders:(A==null?void 0:A.orders.filter(fe=>N.includes(fe.id)))||[],onClearSelection:Se,onBulkOperation:de}),t.jsx(OC,{orders:(A==null?void 0:A.orders)||[],loading:n,onView:W,onEdit:H,onChangeStatus:G,selectedOrders:N,onSelectionChange:Pe}),A&&A.totalPages>1&&t.jsx(ac,{currentPage:A.currentPage,totalPages:A.totalPages,totalCount:A.totalCount,onPageChange:Ne}),f&&t.jsx(Tb,{isOpen:!!f,onClose:()=>w(null),onSubmit:J,order:f.order,newStatus:f.newStatus,loading:q.isPending})]})},GC=({value:c,onChange:d,customers:g,placeholder:f="Search customer...",className:w=""})=>{const[N,T]=oe.useState(!1),[A,n]=oe.useState(""),[P,z]=oe.useState([]);oe.useEffect(()=>{if(A){const H=g.filter(G=>G.name.toLowerCase().includes(A.toLowerCase())||G.external_id&&G.external_id.toLowerCase().includes(A.toLowerCase())||G.tax_id&&G.tax_id.toLowerCase().includes(A.toLowerCase()));z(H)}else z(g)},[A,g]);const q=g.find(H=>H.id===c),U=H=>{d(H),T(!1),n("")},W=()=>{d(""),n("")};return t.jsxs("div",{className:`relative ${w}`,children:[t.jsx("div",{className:"relative",children:t.jsx("div",{onClick:()=>T(!N),className:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 cursor-pointer",children:q?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:q.name}),q.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",q.external_id]})]}),t.jsx("button",{onClick:H=>{H.stopPropagation(),W()},className:"text-gray-400 hover:text-gray-600",children:t.jsx(ar,{className:"h-4 w-4"})})]}):t.jsxs("div",{className:"flex items-center justify-between text-gray-500",children:[t.jsx("span",{children:f}),t.jsx(om,{className:"h-4 w-4"})]})})}),N&&t.jsxs("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:[t.jsx("div",{className:"p-2",children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:A,onChange:H=>n(H.target.value),placeholder:"Type to search...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0})]})}),t.jsx("div",{className:"max-h-60 overflow-auto",children:P.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No customers found"}):P.map(H=>t.jsxs("div",{onClick:()=>U(H.id),className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsx("div",{className:"font-medium text-gray-900",children:H.name}),H.external_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",H.external_id]}),H.tax_id&&t.jsxs("div",{className:"text-sm text-gray-500",children:["Tax ID: ",H.tax_id]})]},H.id))})]})]})},ZC=({orderType:c,serviceType:d,exchangeEmptyQty:g,requiresPickup:f,onOrderTypeChange:w,onServiceTypeChange:N,onExchangeEmptyQtyChange:T,onRequiresPickupChange:A,disabled:n=!1})=>{const P=[{value:"delivery",label:"Standard Delivery",description:"Deliver full cylinders to customer",icon:br,color:"bg-blue-50 border-blue-200 text-blue-800",selectedColor:"bg-blue-100 border-blue-300"},{value:"refill",label:"Refill Service",description:"Deliver full cylinders and collect empties",icon:eo,color:"bg-green-50 border-green-200 text-green-800",selectedColor:"bg-green-100 border-green-300"},{value:"exchange",label:"Cylinder Exchange",description:"Exchange empties for full cylinders",icon:p_,color:"bg-orange-50 border-orange-200 text-orange-800",selectedColor:"bg-orange-100 border-orange-300"},{value:"pickup",label:"Empty Pickup",description:"Collect empty cylinders only",icon:v_,color:"bg-purple-50 border-purple-200 text-purple-800",selectedColor:"bg-purple-100 border-purple-300"}],z=[{value:"standard",label:"Standard Service",description:"Regular delivery schedule",icon:en},{value:"express",label:"Express Service",description:"Priority delivery",icon:cS},{value:"scheduled",label:"Scheduled Service",description:"Specific delivery time",icon:Gs}],q=U=>{w(U),of(U)?A(!0):U==="delivery"&&A(!1),U==="delivery"&&T(0)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Type"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:P.map(U=>{const W=U.icon,H=c===U.value;return t.jsxs("button",{type:"button",onClick:()=>q(U.value),disabled:n,className:`relative p-4 border-2 rounded-lg text-left transition-all hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${H?U.selectedColor:U.color}`,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(W,{className:"h-6 w-6 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:U.label}),t.jsx("p",{className:"text-sm opacity-80 mt-1",children:U.description})]})]}),H&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("div",{className:"w-3 h-3 bg-current rounded-full"})})]},U.value)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Service Type"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:z.map(U=>{const W=U.icon,H=d===U.value;return t.jsxs("button",{type:"button",onClick:()=>N(U.value),disabled:n,className:`relative p-4 border-2 rounded-lg text-left transition-all hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ${H?"bg-gray-100 border-gray-300 text-gray-900":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(W,{className:"h-5 w-5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:U.label}),t.jsx("p",{className:"text-sm opacity-80 mt-1",children:U.description})]})]}),H&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"})})]},U.value)})})]}),(c==="refill"||c==="exchange"||c==="pickup")&&t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:c==="pickup"?"Pickup Details":"Exchange Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"exchange_empty_qty",className:"block text-sm font-medium text-gray-700",children:c==="pickup"?"Empty Cylinders to Collect *":"Empty Cylinders to Exchange *"}),t.jsx("input",{type:"number",id:"exchange_empty_qty",min:"0",value:g,onChange:U=>T(parseInt(U.target.value)||0),disabled:n,className:"mt-1 block w-full sm:w-32 rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50",placeholder:"0"}),t.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[c==="refill"&&"Number of empty cylinders customer will return",c==="exchange"&&"Number of empty cylinders to collect from customer",c==="pickup"&&"Number of empty cylinders to collect"]})]}),c!=="pickup"&&t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"requires_pickup",checked:f,onChange:U=>A(U.target.checked),disabled:n||of(c),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded disabled:opacity-50"}),t.jsxs("label",{htmlFor:"requires_pickup",className:"ml-2 block text-sm text-gray-700",children:["Requires pickup of empty cylinders",of(c)&&t.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Required for this order type)"})]})]})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:[GE(c)," - ",ZE(d)]}),t.jsxs("div",{className:"text-sm text-blue-800",children:[c==="delivery"&&t.jsx("p",{children:"Standard delivery of full cylinders to the customer's address."}),c==="refill"&&t.jsxs("div",{children:[t.jsx("p",{children:"Delivery of full cylinders with collection of empty cylinders."}),t.jsx("p",{className:"mt-1",children:" Deliver: Full cylinders as per order"}),t.jsxs("p",{children:[" Collect: ",g||0," empty cylinders"]})]}),c==="exchange"&&t.jsxs("div",{children:[t.jsx("p",{children:"Exchange service where empties are swapped for full cylinders."}),t.jsx("p",{className:"mt-1",children:" Deliver: Full cylinders as per order"}),t.jsxs("p",{children:[" Collect: ",g||0," empty cylinders"]})]}),c==="pickup"&&t.jsxs("div",{children:[t.jsx("p",{children:"Collection of empty cylinders only."}),t.jsxs("p",{className:"mt-1",children:[" Collect: ",g||0," empty cylinders"]})]})]})]})]})},WC=(c,d,g=!0)=>s_({queryKey:["productPrices",c.sort().join(","),d],queryFn:async()=>c.length?await xt.pricing.getProductPrices.query({productIds:c,customerId:d}):{},enabled:!!(g&&c.length>0),staleTime:5*60*1e3}),HC=()=>{const c=si(),[d,g]=oe.useState(1),[f,w]=oe.useState(""),[N,T]=oe.useState(""),[A,n]=oe.useState(new Date().toISOString().split("T")[0]),[P,z]=oe.useState(""),[q,U]=oe.useState(""),[W,H]=oe.useState([]),[G,J]=oe.useState(""),[de,ne]=oe.useState(0),[te,Ne]=oe.useState(!1),[me,Pe]=oe.useState("delivery"),[Se,fe]=oe.useState("standard"),[Be,ke]=oe.useState(0),[Ge,we]=oe.useState(!1),{data:Me}=N_({limit:1e3}),{data:st=[]}=lb(f),{data:lt}=cc({limit:1e3}),{data:St}=Jf({limit:1e3}),ft=RC(),Mt=cb(),mt=(Me==null?void 0:Me.customers)||[],Fs=(lt==null?void 0:lt.products)||[],ts=(St==null?void 0:St.priceLists)||[],Is=Fs.map(it=>it.id),{data:lr}=WC(Is,f||void 0),js=new Date().toISOString().split("T")[0],Sr=ts.filter(it=>!(it.end_date&&it.end_date<js||it.start_date&&it.start_date>js)),Tr=Sr.find(it=>it.is_default)||Sr[0];Fs.filter(it=>it.status==="active").map(it=>it.id);const vs=mt.find(it=>it.id===f),ss=st.find(it=>it.id===N),[Or,Cr]=oe.useState({subtotal:0,taxAmount:0,grandTotal:0}),[Li,Wt]=oe.useState(!1);oe.useEffect(()=>{(async()=>{if(W.length===0){Cr({subtotal:0,taxAmount:0,grandTotal:0});return}Wt(!0);try{const qt=await mb(W,de);Cr(qt)}catch(qt){console.error("Failed to calculate order totals:",qt)}finally{Wt(!1)}})()},[W,de]);const gi=Or.subtotal,vr=Or.taxAmount,wi=Or.grandTotal,Ds=it=>{w(it),T(""),H([])};oe.useEffect(()=>{if(f&&st.length>0&&!N){const it=st.find(qt=>qt.is_primary);T(it?it.id:st[0].id)}},[f,st,N]);const $r=async it=>{try{const qt=await xt.pricing.getProductPrice.query({productId:it,customerId:f||void 0});return(qt==null?void 0:qt.finalPrice)||0}catch(qt){return console.error("Failed to fetch product price:",qt),0}},Wn=it=>lr&&lr[it]?lr[it].finalPrice:0,ri=async it=>{const qt=Fs.find(sr=>sr.id===it);if(!qt)return;const Ns=W.find(sr=>sr.product_id===it),tr=await $r(it),cr=yt();if(Ns){if(Ns.quantity>=cr){alert(`Cannot add more items. Only ${cr} units available in stock.`);return}H(sr=>sr.map(rr=>rr.product_id===it?{...rr,quantity:rr.quantity+1,subtotal:(rr.quantity+1)*rr.unit_price}:rr))}else{const sr={product_id:it,product_name:qt.name,product_sku:qt.sku,quantity:1,unit_price:tr,subtotal:tr};H(rr=>[...rr,sr])}},je=(it,qt)=>{if(qt<=0){$e(it);return}const Ns=yt();if(qt>Ns){alert(`Cannot set quantity to ${qt}. Only ${Ns} units available in stock.`);return}H(tr=>tr.map(cr=>cr.product_id===it?{...cr,quantity:qt,subtotal:qt*cr.unit_price}:cr))},$e=it=>{H(qt=>qt.filter(Ns=>Ns.product_id!==it))},et=async()=>{if(!(!f||!N||W.length===0))try{if(Se==="scheduled"&&(!P||!q)){alert("Please select both date and time for scheduled delivery.");return}const it=Se==="scheduled"&&P&&q?new Date(`${P}T${q}`).toISOString():void 0,qt={customer_id:f,delivery_address_id:N,order_date:A,scheduled_date:it,notes:G,order_lines:W.map(tr=>({product_id:tr.product_id,quantity:tr.quantity,unit_price:tr.unit_price})),order_type:me,service_type:Se,exchange_empty_qty:Be,requires_pickup:Ge},Ns=await ft.mutateAsync(qt);c(`/orders/${Ns.id}`)}catch(it){console.error("Error creating order:",it)}},Ct=f&&N,wt=Ct&&W.length>0&&(Se!=="scheduled"||P&&q),yt=it=>999,Ot=it=>(console.log("Stock status for quantity",it),"text-green-600"),hs=()=>{f&&Ne(!0)},as=async it=>{try{console.log("Creating address from order page:",it);const qt=await Mt.mutateAsync(it);console.log("Address created successfully:",qt),T(qt.id),Ne(!1),console.log("Address added and selected for order")}catch(qt){console.error("Failed to create address:",qt)}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create New Order"})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("div",{className:"flex items-center justify-between mb-6",children:t.jsxs("div",{className:"flex items-center space-x-8",children:[t.jsxs("div",{className:`flex items-center space-x-2 ${d>=1?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=1?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),t.jsx("span",{className:"font-medium",children:"Customer & Delivery"})]}),t.jsx("div",{className:`w-16 h-0.5 ${d>=2?"bg-blue-600":"bg-gray-200"}`}),t.jsxs("div",{className:`flex items-center space-x-2 ${d>=2?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=2?"bg-blue-600 text-white":"bg-gray-200"}`,children:"2"}),t.jsx("span",{className:"font-medium",children:"Add Products"})]}),t.jsx("div",{className:`w-16 h-0.5 ${d>=3?"bg-blue-600":"bg-gray-200"}`}),t.jsxs("div",{className:`flex items-center space-x-2 ${d>=3?"text-blue-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d>=3?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),t.jsx("span",{className:"font-medium",children:"Review & Create"})]})]})}),d===1&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"mb-6",children:t.jsx(ZC,{orderType:me,serviceType:Se,exchangeEmptyQty:Be,requiresPickup:Ge,onOrderTypeChange:Pe,onServiceTypeChange:fe,onExchangeEmptyQtyChange:ke,onRequiresPickupChange:we})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(cm,{className:"inline h-4 w-4 mr-1"}),"Select Customer *"]}),t.jsx(GC,{value:f,onChange:Ds,customers:mt,placeholder:"Search for a customer..."})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Gs,{className:"inline h-4 w-4 mr-1"}),"Order Date *"]}),t.jsx("input",{type:"date",value:A,onChange:it=>n(it.target.value),min:new Date().toISOString().split("T")[0],className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),Se==="scheduled"&&t.jsxs("div",{className:"col-span-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Gs,{className:"inline h-4 w-4 mr-1"}),"Scheduled Delivery Date & Time *"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("input",{type:"date",value:P,onChange:it=>z(it.target.value),min:A,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Select date"}),t.jsx("input",{type:"time",value:q,onChange:it=>U(it.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Select time"})]}),P&&q&&t.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Scheduled for: ",new Date(`${P}T${q}`).toLocaleString()]})]})]}),f&&t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(En,{className:"inline h-4 w-4 mr-1"}),"Delivery Address *"]}),vs&&t.jsx("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg",children:t.jsxs("div",{className:"text-sm",children:[t.jsx("div",{className:"font-medium text-blue-900",children:vs.name}),t.jsxs("div",{className:"text-blue-700",children:["Account Status: ",t.jsx("span",{className:`font-medium ${vs.account_status==="active"?"text-green-700":vs.account_status==="credit_hold"?"text-yellow-700":"text-red-700"}`,children:vs.account_status==="active"?"Active":vs.account_status==="credit_hold"?"Credit Hold":vs.account_status==="closed"?"Closed":vs.account_status||"Unknown"})]}),vs.email&&t.jsx("div",{className:"text-blue-600",children:vs.email}),vs.phone&&t.jsx("div",{className:"text-blue-600",children:vs.phone})]})}),st.length>0?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("select",{value:N,onChange:it=>T(it.target.value),className:"flex-1 rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Choose a delivery address..."}),st.map(it=>t.jsx("option",{value:it.id,children:EE(it)},it.id))]}),t.jsx("button",{onClick:hs,className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",title:"Add new address",children:t.jsx(Nr,{className:"h-4 w-4"})})]}),ss&&t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Selected Address:"}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("div",{children:ss.line1}),ss.line2&&t.jsx("div",{children:ss.line2}),t.jsxs("div",{children:[ss.city,", ",ss.state," ",ss.postal_code]}),ss.instructions&&t.jsxs("div",{className:"mt-2 text-gray-600",children:[t.jsx("strong",{children:"Instructions:"})," ",ss.instructions]})]})]})]}):t.jsxs("div",{className:"text-center py-8 border border-gray-200 rounded-lg bg-yellow-50",children:[t.jsx(Vs,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No delivery addresses found"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"This customer doesn't have any delivery addresses yet."}),t.jsxs("button",{onClick:hs,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Address for Customer"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Notes"}),t.jsx("textarea",{value:G,onChange:it=>J(it.target.value),rows:3,className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional notes about this order..."})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>g(2),disabled:!Ct,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Add Products"})})]}),d===2&&t.jsxs("div",{className:"space-y-6",children:[!Tr&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vs,{className:"h-5 w-5 text-yellow-600"}),t.jsxs("span",{className:"text-sm text-yellow-800",children:["No active price list found. Product prices may not be available.",ts.length>0?`Found ${ts.length} price list(s) but none are currently active.`:"No price lists exist yet."]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Available Products"}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:Fs.filter(it=>it.status==="active").map(it=>{const qt=yt(it.id),Ns=Wn(it.id),tr=W.find(he=>he.product_id===it.id),cr=!!tr,sr=(tr==null?void 0:tr.quantity)||0;Ot(qt);const rr=sr<qt,ii=qt===0,Kr=Ns===0,Qr=Kr||!rr,Fr=lr===void 0&&f;return t.jsx("div",{className:`p-3 border rounded-lg transition-all ${cr?"bg-blue-50 border-blue-200":Qr?"bg-gray-50 border-gray-200 opacity-75":"border-gray-200 hover:border-gray-300"}`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"font-medium text-gray-900",children:it.name}),cr&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"In Order"})]}),t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["SKU: ",it.sku]}),t.jsx("div",{className:"flex items-center space-x-2 mb-2",children:t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(GN,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:[qt," available",cr?` (${sr} in order)`:""]})]})}),t.jsx("div",{className:"flex items-center space-x-2 mb-3",children:Fr?t.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[t.jsx(tn,{className:"h-4 w-4 animate-pulse"}),t.jsx("span",{className:"text-sm",children:"Loading price..."})]}):Kr?t.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[t.jsx(tn,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm font-medium",children:["No price set",Tr?` in ${Tr.name}`:""]})]}):t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(tn,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:cs(Ns)}),Tr&&t.jsxs("span",{className:"text-xs text-gray-500",children:["(",Tr.name,")"]})]})}),(Qr||Fr)&&t.jsx("div",{className:`border rounded p-2 mt-2 ${Fr?"bg-blue-50 border-blue-200":"bg-yellow-50 border-yellow-200"}`,children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(KN,{className:`h-4 w-4 flex-shrink-0 mt-0.5 ${Fr?"text-blue-600":"text-yellow-600"}`}),t.jsxs("div",{className:`text-sm ${Fr?"text-blue-800":"text-yellow-800"}`,children:[Fr&&"Loading pricing information...",!Fr&&ii&&"This product is out of stock and cannot be added to orders.",!Fr&&Kr&&!ii&&t.jsxs(t.Fragment,{children:["No pricing configured for this product",f?" for this customer":"",".",t.jsx("button",{onClick:()=>window.open("/pricing","_blank"),className:"ml-1 text-blue-600 hover:text-blue-800 underline",children:"Set up pricing"})]}),!Fr&&!rr&&!ii&&!Kr&&`Maximum quantity (${qt}) already in order.`]})]})})]}),t.jsx("div",{className:"ml-4 flex-shrink-0",children:t.jsx("button",{onClick:()=>ri(it.id),disabled:Qr||Fr,title:Fr?"Loading pricing...":Qr?Kr?"No price set":"Maximum quantity reached":"Add to order",className:`
                                flex items-center justify-center w-10 h-10 rounded-lg text-sm font-medium transition-all
                                ${Qr||Fr?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm hover:shadow"}
                              `,children:t.jsx(Nr,{className:"h-4 w-4"})})})]})},it.id)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Items"}),W.length>0?t.jsxs("div",{className:"space-y-3",children:[W.map(it=>{const qt=yt(it.product_id);return t.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:it.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",it.product_sku]})]}),t.jsx("button",{onClick:()=>$e(it.product_id),className:"text-red-600 hover:text-red-800",children:t.jsx(so,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("label",{className:"text-sm text-gray-600",children:"Qty:"}),t.jsx("input",{type:"number",min:"1",max:qt,value:it.quantity,onChange:Ns=>je(it.product_id,parseInt(Ns.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(max: ",qt,")"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[cs(it.unit_price)," each"]}),t.jsx("div",{className:"font-medium text-gray-900",children:cs(it.subtotal)})]})]})]},it.product_id)}),t.jsxs("div",{className:"border-t pt-3",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Subtotal:"}),t.jsx("span",{className:"text-xl font-bold text-gray-900",children:cs(gi)})]}),t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tax (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",value:de,onChange:it=>ne(Number(it.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm text-right"})]}),t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Tax:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:cs(vr)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:cs(wi)})]})]})]}):t.jsxs("div",{className:"text-center py-8 border border-gray-200 rounded-lg",children:[t.jsx(ps,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No products added yet."}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Select products from the left to add them to the order."})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("button",{onClick:()=>g(1),className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200",children:"Back"}),t.jsx("button",{onClick:()=>g(3),disabled:W.length===0,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Review"})]})]}),d===3&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Customer:"}),t.jsx("div",{className:"text-gray-900",children:vs==null?void 0:vs.name})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Delivery Address:"}),t.jsxs("div",{className:"text-gray-900",children:[ss==null?void 0:ss.line1,(ss==null?void 0:ss.line2)&&t.jsx("div",{children:ss.line2}),t.jsxs("div",{children:[ss==null?void 0:ss.city,", ",ss==null?void 0:ss.state," ",ss==null?void 0:ss.postal_code]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Order Date:"}),t.jsx("div",{className:"text-gray-900",children:new Date(A).toLocaleDateString()})]}),G&&t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Notes:"}),t.jsx("div",{className:"text-gray-900",children:G})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tax (%)"}),t.jsx("input",{type:"number",min:"0",max:"100",value:de,onChange:it=>ne(Number(it.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm text-right"})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Items"}),t.jsxs("div",{className:"space-y-2",children:[W.map(it=>t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-200",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:it.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:[it.quantity,"  ",cs(it.unit_price)]})]}),t.jsx("div",{className:"font-medium text-gray-900",children:cs(it.subtotal)})]},it.product_id)),t.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-300",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Subtotal:"}),t.jsx("span",{className:"text-xl font-bold text-gray-900",children:cs(gi)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Tax:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:cs(vr)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:cs(wi)})]})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("button",{onClick:()=>g(2),className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200",children:"Back"}),t.jsxs("button",{onClick:et,disabled:!wt||ft.isPending,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(sc,{className:"h-4 w-4"}),t.jsx("span",{children:ft.isPending?"Creating...":"Create Order"})]})]})]})]}),t.jsx(hb,{isOpen:te,onClose:()=>Ne(!1),onSubmit:as,customerId:f,loading:Mt.isPending,title:"Add New Address",isFirstAddress:st.length===0})]})},XC=({statusHistory:c,currentStatus:d,estimatedDates:g={}})=>{const f=n=>new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=(n,P)=>(ic(n),P?t.jsx(Zn,{className:"h-5 w-5 text-green-600"}):n===d?t.jsx(en,{className:"h-5 w-5 text-blue-600"}):t.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-gray-300 bg-white"})),N=(n,P)=>P?"border-green-200 bg-green-50":n===d?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50",T=["draft","confirmed","scheduled","en_route","delivered","invoiced"],A=T.indexOf(d);return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Order Timeline"}),t.jsx("div",{className:"space-y-4",children:T.map((n,P)=>{const z=P<A||n===d&&d!=="cancelled",q=n===d,U=ic(n),W=c.find(G=>G.status===n),H=g[n];return n==="cancelled"&&d!=="cancelled"?null:t.jsxs("div",{className:`relative flex items-start space-x-4 p-4 rounded-lg border ${N(n,z)}`,children:[P<T.length-1&&n!=="cancelled"&&t.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-8 bg-gray-200"}),t.jsx("div",{className:"flex-shrink-0 mt-1",children:w(n,z)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:`text-sm font-medium ${z||q?"text-gray-900":"text-gray-500"}`,children:U.label}),W&&t.jsx("span",{className:"text-xs text-gray-500",children:f(W.changed_at)})]}),t.jsx("p",{className:`text-sm mt-1 ${z||q?"text-gray-600":"text-gray-400"}`,children:U.description}),(W||H)&&t.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs",children:[W&&t.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[t.jsx(Zn,{className:"h-3 w-3"}),t.jsxs("span",{children:["Completed: ",f(W.changed_at)]})]}),H&&!W&&t.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[t.jsx(Gs,{className:"h-3 w-3"}),t.jsxs("span",{children:["Estimated: ",f(H)]})]})]}),W&&t.jsxs("div",{className:"mt-3 space-y-2",children:[W.user_name&&t.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[t.jsx(cm,{className:"h-3 w-3"}),t.jsxs("span",{children:["Changed by: ",W.user_name]})]}),W.notes&&t.jsxs("div",{className:"flex items-start space-x-1 text-xs text-gray-600",children:[t.jsx(sS,{className:"h-3 w-3 mt-0.5"}),t.jsx("span",{children:W.notes})]})]}),q&&t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Current Status"})})]})]},n)})}),c.length>1&&t.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Performance Metrics"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Order Processing Time:"}),t.jsx("div",{className:"font-medium text-gray-900",children:(()=>{var z,q;const n=(z=c.find(U=>U.status==="draft"))==null?void 0:z.changed_at,P=(q=c.find(U=>U.status==="confirmed"))==null?void 0:q.changed_at;return n&&P?`${Math.round((new Date(P).getTime()-new Date(n).getTime())/36e5)} hours`:"N/A"})()})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Fulfillment Time:"}),t.jsx("div",{className:"font-medium text-gray-900",children:(()=>{var z,q;const n=(z=c.find(U=>U.status==="confirmed"))==null?void 0:z.changed_at,P=(q=c.find(U=>U.status==="delivered"))==null?void 0:q.changed_at;return n&&P?`${Math.round((new Date(P).getTime()-new Date(n).getTime())/864e5)} days`:"N/A"})()})]})]})]})]})},KC=({isOpen:c,onClose:d,order:g})=>{const[f,w]=oe.useState(0),[N,T]=oe.useState(""),[A,n]=oe.useState({subtotal:0,taxAmount:0,grandTotal:0}),[P,z]=oe.useState(!1),q=zC();if(oe.useEffect(()=>{g&&(w(g.tax_percent||0),T(g.notes||""))},[g]),oe.useEffect(()=>{(async()=>{if(!(g!=null&&g.order_lines)||g.order_lines.length===0){n({subtotal:0,taxAmount:0,grandTotal:0});return}z(!0);try{const de=g.order_lines.map(te=>({quantity:te.quantity,unit_price:te.unit_price,subtotal:te.subtotal||te.quantity*te.unit_price})),ne=await mb(de,f);n(ne)}catch(de){console.error("Failed to calculate order totals:",de)}finally{z(!1)}})()},[g,f]),!c||!g)return null;const U=A.subtotal,W=A.taxAmount,H=A.grandTotal,G=async J=>{J.preventDefault();try{await q.mutateAsync({id:g.id,tax_percent:f,tax_amount:W,total_amount:H,notes:N}),d()}catch(de){console.error("Error updating order:",de)}};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Edit Order"}),t.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(ar,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:G,className:"p-6 space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Order Summary"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),t.jsx("span",{className:"font-medium text-gray-900",children:cs(U)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600",children:["Tax (",f,"%):"]}),t.jsx("span",{className:"font-medium text-gray-900",children:cs(W)})]}),t.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-2",children:[t.jsx("span",{className:"font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"font-bold text-gray-900",children:cs(H)})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"taxPercent",className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Percentage (%)"}),t.jsx("input",{type:"number",id:"taxPercent",min:"0",max:"100",step:"0.01",value:f,onChange:J=>w(Number(J.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),t.jsx("textarea",{id:"notes",rows:3,value:N,onChange:J=>T(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Add any additional notes..."})]}),t.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{type:"button",onClick:async()=>{try{await q(g.id,f),ti.success("Total amount recalculated")}catch(J){console.error("Error recalculating total:",J),ti.error("Failed to recalculate total")}},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Recalculate Total"}),t.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:updateOrder.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[t.jsx(j_,{className:"h-4 w-4"}),t.jsx("span",{children:updateOrder.isPending?"Saving...":"Save Changes"})]})]})]})]})})},QC=()=>{var ne,te,Ne,me,Pe,Se,fe,Be,ke,Ge;const{id:c}=nc(),d=si(),[g,f]=oe.useState(null),[w,N]=oe.useState(!1),[T,A]=oe.useState(!1),{data:n,isLoading:P,error:z}=LC(c),q=Sb(),U=we=>{n&&f({order:n,newStatus:we})},W=async we=>{try{await q.mutateAsync(we),f(null)}catch(Me){console.error("Status change error:",Me)}},H=we=>new Date(we).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(P)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})})]});if(z||!n)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-red-600",children:"Order not found or error loading order details."})})})]});const G=ic(n.status),J=af(n.status),de=[{id:"1",order_id:n.id,status:"draft",changed_by:"system",changed_at:n.created_at,user_name:"System",notes:"Order created"},...n.status!=="draft"?[{id:"2",order_id:n.id,status:"confirmed",changed_by:"admin",changed_at:new Date(new Date(n.created_at).getTime()+36e5).toISOString(),user_name:"Admin User",notes:"Order confirmed and inventory reserved"}]:[]];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>d("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Order ",formatOrderIdSync(n.id)]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("button",{onClick:()=>N(!w),className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(en,{className:"h-4 w-4"}),t.jsxs("span",{children:[w?"Hide":"Show"," Timeline"]})]}),["draft","confirmed"].includes(n.status)&&t.jsxs("button",{onClick:()=>A(!0),className:"flex items-center space-x-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(fi,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Order"})]}),J.map(we=>t.jsxs("button",{onClick:()=>U(we),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[we==="confirmed"&&"Confirm Order",we==="scheduled"&&"Schedule Delivery",we==="en_route"&&"Mark En Route",we==="delivered"&&"Mark Delivered",we==="invoiced"&&"Generate Invoice",we==="cancelled"&&"Cancel Order"]},we))]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Order ",formatOrderIdSync(n.id)]}),t.jsxs("p",{className:"text-gray-600",children:["Created on ",H(n.created_at)]})]}),t.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${G.color}`,children:n.status.replace("_"," ").toUpperCase()})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:t.jsx(cm,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Customer"}),t.jsx("p",{className:"text-gray-600",children:(ne=n.customer)==null?void 0:ne.name}),((te=n.customer)==null?void 0:te.email)&&t.jsx("p",{className:"text-sm text-gray-500",children:n.customer.email}),((Ne=n.customer)==null?void 0:Ne.phone)&&t.jsx("p",{className:"text-sm text-gray-500",children:n.customer.phone})]})]}),t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:t.jsx(En,{className:"h-5 w-5 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Delivery Address"}),n.delivery_address?t.jsxs("div",{className:"text-gray-600",children:[t.jsx("p",{children:n.delivery_address.line1}),n.delivery_address.line2&&t.jsx("p",{children:n.delivery_address.line2}),t.jsxs("p",{children:[n.delivery_address.city,", ",n.delivery_address.state," ",n.delivery_address.postal_code]}),n.delivery_address.instructions&&t.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Note: ",n.delivery_address.instructions]})]}):t.jsx("p",{className:"text-gray-500",children:"No address specified"})]})]}),t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:t.jsx(Gs,{className:"h-5 w-5 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Important Dates"}),t.jsxs("div",{className:"text-gray-600 space-y-1",children:[t.jsxs("p",{children:["Order: ",new Date(n.order_date).toLocaleDateString()]}),n.scheduled_date&&t.jsxs("p",{children:["Scheduled: ",new Date(n.scheduled_date).toLocaleDateString()]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Updated: ",H(n.updated_at)]})]})]})]})]}),n.notes&&t.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Order Notes"}),t.jsx("p",{className:"text-gray-700",children:n.notes})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Order Items"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ps,{className:"h-5 w-5 text-gray-400"}),t.jsxs("span",{className:"text-gray-600",children:[((me=n.order_lines)==null?void 0:me.length)||0," item",(((Pe=n.order_lines)==null?void 0:Pe.length)||0)!==1?"s":""]})]})]}),n.order_lines&&n.order_lines.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subtotal"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.order_lines.map(we=>{var Me,st;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((Me=we.product)==null?void 0:Me.name)||"Unknown Product"}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",((st=we.product)==null?void 0:st.sku)||"N/A"]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:we.quantity})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm text-gray-900",children:cs(we.unit_price)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("span",{className:"text-sm font-medium text-gray-900",children:cs(we.subtotal||we.quantity*we.unit_price)})})]},we.id)})}),t.jsx("tfoot",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"Total:"}),t.jsx("td",{className:"px-6 py-4 text-right text-lg font-bold text-gray-900",children:n.total_amount?cs(n.total_amount):cs(n.order_lines.reduce((we,Me)=>we+(Me.subtotal||Me.quantity*Me.unit_price),0))})]})})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ps,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No items in this order"})]})]}),w&&t.jsx(XC,{statusHistory:de,currentStatus:n.status})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Summary"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),t.jsx("span",{className:"font-medium text-gray-900",children:cs(((Se=n.order_lines)==null?void 0:Se.reduce((we,Me)=>we+(Me.subtotal||Me.quantity*Me.unit_price),0))||0)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-600",children:["Tax",n.tax_percent!=null?` (${n.tax_percent}%)`:"",":"]}),t.jsx("span",{className:"font-medium text-gray-900",children:cs(n.tax_amount!=null?n.tax_amount:0)})]}),t.jsx("div",{className:"border-t border-gray-200 pt-4",children:t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-lg font-bold text-gray-900",children:cs((((fe=n.order_lines)==null?void 0:fe.reduce((we,Me)=>we+(Me.subtotal||Me.quantity*Me.unit_price),0))||0)+(n.tax_amount!=null?n.tax_amount:0))})]})})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Details"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Account Status:"}),t.jsx("div",{className:"mt-1",children:t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${((Be=n.customer)==null?void 0:Be.account_status)==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:((ke=n.customer)==null?void 0:ke.account_status)||"Unknown"})})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Credit Terms:"}),t.jsxs("div",{className:"mt-1 text-sm text-gray-900",children:[((Ge=n.customer)==null?void 0:Ge.credit_terms_days)||0," days"]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"space-y-3",children:[["draft","confirmed"].includes(n.status)&&t.jsxs("button",{onClick:()=>A(!0),className:"w-full flex items-center justify-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(fi,{className:"h-4 w-4"}),t.jsx("span",{children:"Edit Order"})]}),t.jsxs("button",{onClick:()=>U(af(n.status)[0]),disabled:af(n.status).length===0,className:"w-full flex items-center justify-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(en,{className:"h-4 w-4"}),t.jsx("span",{children:"Change Status"})]}),t.jsxs("button",{onClick:()=>N(!w),className:"w-full flex items-center justify-center space-x-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:[t.jsx(en,{className:"h-4 w-4"}),t.jsxs("span",{children:[w?"Hide":"Show"," Timeline"]})]})]})]})]})]}),g&&t.jsx(Tb,{isOpen:!!g,onClose:()=>f(null),onSubmit:W,order:g.order,newStatus:g.newStatus,loading:q.isPending}),T&&t.jsx(KC,{isOpen:T,onClose:()=>A(!1),order:n})]})},JC=({orders:c,onOrderClick:d,onDateChange:g,onReschedule:f})=>{const[w,N]=oe.useState(new Date),[T,A]=oe.useState(null),n=te=>te.toISOString().split("T")[0],P=te=>te.toLocaleDateString("en-US",{month:"long",year:"numeric"}),z=te=>{const Ne=te.getFullYear(),me=te.getMonth(),Pe=new Date(Ne,me,1),fe=new Date(Ne,me+1,0).getDate(),Be=Pe.getDay(),ke=[];for(let Ge=0;Ge<Be;Ge++)ke.push(null);for(let Ge=1;Ge<=fe;Ge++)ke.push(new Date(Ne,me,Ge));return ke},q=te=>{const Ne=n(te);return c.filter(me=>me.scheduled_date===Ne)},U=te=>{N(Ne=>{const me=new Date(Ne);return te==="prev"?me.setMonth(Ne.getMonth()-1):me.setMonth(Ne.getMonth()+1),me})},W=te=>{const Ne=n(te),me=q(te);A(Ne),g(Ne,me)},H=te=>{const Ne=q(te),me=new Date;return me.setHours(0,0,0,0),Ne.length===0?"empty":te<me?"past":n(te)===n(me)?"today":"scheduled"},G=te=>{const Ne=H(te),me=T===n(te),Pe="min-h-[80px] p-2 border border-gray-200 cursor-pointer transition-colors relative";if(me)return`${Pe} bg-blue-100 border-blue-300`;switch(Ne){case"today":return`${Pe} bg-yellow-50 border-yellow-300 hover:bg-yellow-100`;case"scheduled":return`${Pe} bg-green-50 border-green-200 hover:bg-green-100`;case"past":return`${Pe} bg-gray-50 text-gray-500 hover:bg-gray-100`;default:return`${Pe} hover:bg-gray-50`}},J=z(w),de=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ne=oe.useMemo(()=>{if(!T)return[];const te=new Date(T+"T00:00:00");return q(te)},[T,c]);return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Delivery Schedule"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:()=>U("prev"),className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:t.jsx(g_,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-lg font-medium text-gray-900 min-w-[200px] text-center",children:P(w)}),t.jsx("button",{onClick:()=>U("next"),className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:t.jsx(x_,{className:"h-4 w-4"})})]})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-4",children:de.map(te=>t.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500 border-b border-gray-200",children:te},te))}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-6",children:J.map((te,Ne)=>t.jsx("div",{children:te?t.jsxs("div",{className:G(te),onClick:()=>W(te),children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:te.getDate()}),q(te).length>0&&t.jsxs("div",{className:"space-y-1",children:[q(te).slice(0,2).map(me=>{var Pe,Se;return t.jsx("div",{className:"text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded truncate",title:`${(Pe=me.customer)==null?void 0:Pe.name} - ${cs(me.total_amount||0)}`,children:(Se=me.customer)==null?void 0:Se.name},me.id)}),q(te).length>2&&t.jsxs("div",{className:"text-xs text-gray-500",children:["+",q(te).length-2," more"]})]})]}):t.jsx("div",{className:"min-h-[80px] p-2"})},Ne))}),T&&ne.length>0&&t.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Deliveries for ",new Date(T).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})]}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(br,{className:"h-4 w-4"}),t.jsxs("span",{children:[ne.length," deliveries"]})]})]}),t.jsx("div",{className:"space-y-3",children:ne.map(te=>{var Ne,me,Pe,Se;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",onClick:()=>d(te),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(ps,{className:"h-4 w-4 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:(Ne=te.customer)==null?void 0:Ne.name}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx(En,{className:"h-3 w-3"}),t.jsxs("span",{children:[(me=te.delivery_address)==null?void 0:me.city,", ",(Pe=te.delivery_address)==null?void 0:Pe.state]})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:cs(te.total_amount||0)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[((Se=te.order_lines)==null?void 0:Se.length)||0," items"]})]})]},te.id)})}),t.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(en,{className:"h-4 w-4 text-blue-600"}),t.jsx("span",{className:"text-blue-800",children:"Estimated Route Time:"})]}),t.jsxs("span",{className:"font-medium text-blue-900",children:[Math.ceil(ne.length*.5)," hours"]})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[t.jsx("span",{className:"text-blue-800",children:"Total Revenue:"}),t.jsx("span",{className:"font-medium text-blue-900",children:cs(ne.reduce((te,Ne)=>te+(Ne.total_amount||0),0))})]})]})]})]})},YC=()=>{const c=si(),[d,g]=oe.useState(null),[f,w]=oe.useState([]),{data:N}=Nb({status:"scheduled",limit:1e3}),T=(N==null?void 0:N.orders)||[],A=H=>{c(`/orders/${H.id}`)},n=(H,G)=>{g(H),w(G)},P=async(H,G)=>{console.log("Reschedule order",H,"to",G)},z=()=>{const H=new Date().toISOString().split("T")[0];return T.filter(G=>G.scheduled_date===H)},q=()=>{const H=new Date().toISOString().split("T")[0];return T.filter(G=>G.scheduled_date&&G.scheduled_date>H)},U=z(),W=q();return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Delivery Schedule"})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:t.jsx(Gs,{className:"h-6 w-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Deliveries"}),t.jsx("p",{className:"text-3xl font-bold text-blue-600",children:U.length}),t.jsxs("p",{className:"text-sm text-gray-600",children:[U.reduce((H,G)=>H+(G.total_amount||0),0).toLocaleString("en-US",{style:"currency",currency:"USD"})," total value"]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:t.jsx(br,{className:"h-6 w-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Deliveries"}),t.jsx("p",{className:"text-3xl font-bold text-green-600",children:W.length}),t.jsx("p",{className:"text-sm text-gray-600",children:"Next 30 days"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:t.jsx(ps,{className:"h-6 w-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Scheduled"}),t.jsx("p",{className:"text-3xl font-bold text-purple-600",children:T.length}),t.jsx("p",{className:"text-sm text-gray-600",children:"All scheduled orders"})]})]})})]}),t.jsx(JC,{orders:T,onOrderClick:A,onDateChange:n,onReschedule:P}),U.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Today's Delivery Route"}),t.jsx("div",{className:"space-y-3",children:U.map((H,G)=>{var J,de,ne,te;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>A(H),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:G+1}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:(J=H.customer)==null?void 0:J.name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[(de=H.delivery_address)==null?void 0:de.city,", ",(ne=H.delivery_address)==null?void 0:ne.state]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:(H.total_amount||0).toLocaleString("en-US",{style:"currency",currency:"USD"})}),t.jsxs("div",{className:"text-sm text-gray-600",children:[((te=H.order_lines)==null?void 0:te.length)||0," items"]})]})]},H.id)})}),t.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Estimated Route Time:"}),t.jsxs("span",{className:"font-medium text-gray-900",children:[Math.ceil(U.length*.5)," hours"]})]}),t.jsxs("div",{className:"flex justify-between text-sm mt-1",children:[t.jsx("span",{className:"text-gray-600",children:"Total Stops:"}),t.jsx("span",{className:"font-medium text-gray-900",children:U.length})]})]})]})]})},ek=({analytics:c,dateRange:d,onDateRangeChange:g})=>{const[f,w]=oe.useState("overview"),N=n=>`${n.toFixed(1)}%`,T=n=>({draft:"bg-gray-500",confirmed:"bg-blue-500",scheduled:"bg-purple-500",en_route:"bg-orange-500",delivered:"bg-green-500",invoiced:"bg-teal-500",cancelled:"bg-red-500"})[n]||"bg-gray-500",A=[{id:"overview",label:"Overview",icon:Ko},{id:"trends",label:"Trends",icon:sn},{id:"customers",label:"Customers",icon:rc},{id:"products",label:"Products",icon:ps},{id:"delivery",label:"Delivery",icon:en}];return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Order Analytics"}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-4 w-4 text-gray-400"}),t.jsx("input",{type:"date",value:d.start,onChange:n=>g({...d,start:n.target.value}),className:"text-sm border border-gray-300 rounded px-2 py-1"}),t.jsx("span",{className:"text-gray-500",children:"to"}),t.jsx("input",{type:"date",value:d.end,onChange:n=>g({...d,end:n.target.value}),className:"text-sm border border-gray-300 rounded px-2 py-1"})]})})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"flex space-x-8 px-6",children:A.map(n=>t.jsxs("button",{onClick:()=>w(n.id),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm ${f===n.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(n.icon,{className:"h-4 w-4"}),t.jsx("span",{children:n.label})]},n.id))})}),t.jsxs("div",{className:"p-6",children:[f==="overview"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Orders by Status"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx("div",{className:"space-y-3",children:c.orders_by_status.map(n=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${T(n.status)}`}),t.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:n.status.replace("_"," ")})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm text-gray-600",children:n.count}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",N(n.percentage),")"]})]})]},n.status))}),t.jsx("div",{className:"relative",children:t.jsx("div",{className:"w-48 h-48 mx-auto relative",children:t.jsx("div",{className:"w-full h-full rounded-full bg-gray-200 relative overflow-hidden",children:c.orders_by_status.map((n,P)=>{const z=c.orders_by_status.slice(0,P).reduce((U,W)=>U+W.percentage,0)*3.6,q=n.percentage*3.6;return t.jsx("div",{className:`absolute inset-0 ${T(n.status)} opacity-80`,style:{clipPath:`polygon(50% 50%, ${50+50*Math.cos((z-90)*Math.PI/180)}% ${50+50*Math.sin((z-90)*Math.PI/180)}%, ${50+50*Math.cos((z+q-90)*Math.PI/180)}% ${50+50*Math.sin((z+q-90)*Math.PI/180)}%)`}},n.status)})})})})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Delivery Performance"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(en,{className:"h-5 w-5 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-900",children:"On-Time Deliveries"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-2xl font-bold text-green-900",children:c.delivery_performance.on_time_deliveries}),t.jsxs("div",{className:"text-sm text-green-700",children:[N(c.delivery_performance.on_time_deliveries+c.delivery_performance.late_deliveries>0?c.delivery_performance.on_time_deliveries/(c.delivery_performance.on_time_deliveries+c.delivery_performance.late_deliveries)*100:0)," success rate"]})]})]}),t.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(en,{className:"h-5 w-5 text-red-600"}),t.jsx("span",{className:"text-sm font-medium text-red-900",children:"Late Deliveries"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-2xl font-bold text-red-900",children:c.delivery_performance.late_deliveries}),t.jsx("div",{className:"text-sm text-red-700",children:"Need attention"})]})]}),t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(sn,{className:"h-5 w-5 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Avg Fulfillment"})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[c.delivery_performance.avg_fulfillment_time,"h"]}),t.jsx("div",{className:"text-sm text-blue-700",children:"Average time"})]})]})]})]})]}),f==="trends"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Daily Order Trends"}),t.jsx("div",{className:"space-y-4",children:c.daily_trends.slice(-7).map(n=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:new Date(n.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.orders," orders"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:cs(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[cs(n.orders>0?n.revenue/n.orders:0)," avg"]})]})]},n.date))})]}),f==="customers"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Top Customers"}),t.jsx("div",{className:"space-y-3",children:c.top_customers.map((n,P)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["#",P+1]})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.customer_name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.order_count," orders"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:cs(n.total_revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[cs(n.order_count>0?n.total_revenue/n.order_count:0)," avg"]})]})]},n.customer_id))})]}),f==="products"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Top Products"}),t.jsx("div",{className:"space-y-3",children:c.top_products.map((n,P)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-green-600",children:["#",P+1]})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.product_name}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.quantity_sold," units sold"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:cs(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[cs(n.quantity_sold>0?n.revenue/n.quantity_sold:0)," per unit"]})]})]},n.product_id))})]}),f==="delivery"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Regional Breakdown"}),t.jsx("div",{className:"space-y-3",children:c.regional_breakdown.map((n,P)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(En,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:n.region}),t.jsxs("div",{className:"text-sm text-gray-600",children:[n.order_count," orders"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900",children:cs(n.revenue)}),t.jsxs("div",{className:"text-sm text-gray-600",children:[cs(n.order_count>0?n.revenue/n.order_count:0)," avg"]})]})]},n.region))})]})]})]})]})},tk=()=>{const c=si(),[d,g]=oe.useState({start:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),{data:f,isLoading:w}=BC(d.start,d.end),N=f||{orders_by_status:[],daily_trends:[],top_customers:[],top_products:[],delivery_performance:{on_time_deliveries:0,late_deliveries:0,avg_fulfillment_time:0},regional_breakdown:[]},T=()=>{if(!f)return;const A=[["Date Range",`${d.start} to ${d.end}`],["Total Orders",f.summary.totalOrders.toString()],["Total Revenue",f.summary.totalRevenue.toString()],["Average Order Value",f.summary.avgOrderValue.toString()],["Completion Rate",`${f.summary.completionRate.toFixed(1)}%`],[],["Status","Count","Percentage"],...N.orders_by_status.map(q=>[q.status,q.count.toString(),`${q.percentage.toFixed(1)}%`]),[],["Top Customers","Orders","Revenue"],...N.top_customers.map(q=>[q.customer_name,q.order_count.toString(),q.total_revenue.toString()])].map(q=>q.join(",")).join(`
`),n=new Blob([A],{type:"text/csv"}),P=window.URL.createObjectURL(n),z=document.createElement("a");z.href=P,z.download=`order-report-${d.start}-to-${d.end}.csv`,document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(P)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>c("/orders"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[t.jsx(Rr,{className:"h-4 w-4"}),t.jsx("span",{children:"Back to Orders"})]}),t.jsx("div",{className:"text-gray-400",children:"/"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Reports & Analytics"})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("button",{onClick:T,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(Vf,{className:"h-4 w-4"}),t.jsx("span",{children:"Export Report"})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ko,{className:"h-8 w-8 text-blue-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Orders"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((f==null?void 0:f.summary.totalOrders)||0).toLocaleString()})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Gs,{className:"h-8 w-8 text-green-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((f==null?void 0:f.summary.totalRevenue)||0).toLocaleString("en-US",{style:"currency",currency:"USD"})})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ko,{className:"h-8 w-8 text-purple-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Avg Order Value"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":((f==null?void 0:f.summary.avgOrderValue)||0).toLocaleString("en-US",{style:"currency",currency:"USD"})})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Gs,{className:"h-8 w-8 text-orange-600"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Completion Rate"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w?"...":`${((f==null?void 0:f.summary.completionRate)||0).toFixed(1)}%`})]})]})})]}),t.jsx(ek,{analytics:N,dateRange:d,onDateRangeChange:g})]})},sk=({warehouseId:c})=>{const{data:d=[],isLoading:g,error:f}=wb(c);return c?g?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(or,{className:"h-8 w-8 animate-spin text-blue-500"})}):f?t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:f.message||"Failed to load warehouse inventory"})})})}):d.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ps,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Inventory"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This warehouse has no inventory yet."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(w=>{var N,T;return t.jsxs("tr",{children:[" ",t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:((N=w.product)==null?void 0:N.name)||w.product_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:((T=w.product)==null?void 0:T.sku)||w.product_sku})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:w.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:w.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:new Date(w.updated_at).toLocaleString()})})]},w.id||`${w.product_id}`)})})]})}):null},Eb=({isOpen:c,onClose:d,onSelect:g})=>{const[f,w]=oe.useState(""),{data:N}=cc({search:f,limit:1e3}),T=(N==null?void 0:N.products)||[];return c?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Select Product"}),t.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",children:t.jsx(ar,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"p-4 border-b",children:t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:f,onChange:A=>w(A.target.value),placeholder:"Search by product name or SKU...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:T.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ps,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No products found"})]}):t.jsx("div",{className:"space-y-2",children:T.map(A=>t.jsx("button",{onClick:()=>{g(A),d()},className:"w-full text-left p-3 hover:bg-blue-50 rounded-lg transition-colors",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:A.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",A.sku,"  ",A.unit_of_measure]})]}),t.jsx("div",{className:"text-sm text-gray-500",children:A.unit_of_measure})]})},A.id))})})]})}):null},rk=({onSuccess:c})=>{var ke,Ge;const[d,g]=oe.useState(""),[f,w]=oe.useState(""),[N,T]=oe.useState([]),[A,n]=oe.useState(!1),[P,z]=oe.useState(!1),[q,U]=oe.useState(null),[W,H]=oe.useState(""),{data:G=[]}=eg(),[J,de]=oe.useState(!1),[ne,te]=oe.useState(null),{data:Ne}=xt.trucks.list.useQuery({active:!0}),me=(Ne==null?void 0:Ne.trucks)||[],Pe=async we=>{we.preventDefault(),n(!0),U(null);try{if(!d)throw new Error("Please select a truck");if(!f)throw new Error("Please select a source warehouse");if(N.length===0)throw new Error("Please add at least one product");if(N.filter(lt=>(!lt.qty_full||lt.qty_full<0)&&(!lt.qty_empty||lt.qty_empty<0)).length>0)throw new Error("Please enter valid quantities for all products");if(N.filter(lt=>(lt.qty_full||0)===0&&(lt.qty_empty||0)===0).length>0)throw new Error("Each line must have at least one full or empty cylinder");console.log("Loading truck with products from warehouse");for(const lt of N){const St=Number(lt.qty_full)||0,ft=Number(lt.qty_empty)||0;(St>0||ft>0)&&console.log(`Loading ${St} full and ${ft} empty ${lt.product_name} to truck`)}await new Promise(lt=>setTimeout(lt,1e3)),console.log("Truck loading completed successfully"),g(""),w(""),T([]),z(!1),c&&c()}catch(Me){console.error("Transfer creation error:",Me),U(Me.message||"Failed to create transfer")}finally{n(!1)}},Se=()=>{te(N.length),de(!0)},fe=we=>{if(ne!==null){const Me=[...N];ne<N.length?Me[ne]={...Me[ne],product_id:we.id,product_name:we.name,product_sku:we.sku,unit_of_measure:we.unit_of_measure}:Me.push({product_id:we.id,product_name:we.name,product_sku:we.sku,unit_of_measure:we.unit_of_measure,qty_full:"",qty_empty:""}),T(Me)}de(!1),te(null)},Be=me.filter(we=>{var Me,st;return((Me=we.fleet_number)==null?void 0:Me.toLowerCase().includes(W.toLowerCase()))||((st=we.license_plate)==null?void 0:st.toLowerCase().includes(W.toLowerCase()))});return t.jsxs("div",{className:"space-y-6",children:[q&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:q})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Warehouse (Source)"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:f,onChange:we=>{w(we.target.value)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select warehouse to load from..."}),G.map(we=>t.jsx("option",{value:we.id,children:we.name},we.id))]}),t.jsx(Cn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Truck (Destination)"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:W,onChange:we=>H(we.target.value),placeholder:"Search by fleet number or license plate...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),W&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:t.jsx("div",{className:"max-h-60 overflow-auto",children:Be.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No trucks found"}):Be.map(we=>t.jsxs("div",{onClick:()=>{g(we.id),H("")},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(br,{className:"inline h-4 w-4 mr-1"}),we.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",we.license_plate]})]},we.id))})})]}),d&&t.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(br,{className:"inline h-4 w-4 mr-1"}),(ke=me.find(we=>we.id===d))==null?void 0:ke.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",(Ge=me.find(we=>we.id===d))==null?void 0:Ge.license_plate]})]}),t.jsx("button",{onClick:()=>g(""),className:"text-gray-400 hover:text-gray-600",children:t.jsx(ar,{className:"h-4 w-4"})})]})})]})]}),f&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Available Warehouse Inventory"}),t.jsx(sk,{warehouseId:f})]}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Items to Load"}),t.jsxs("button",{type:"button",onClick:Se,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]}),t.jsx("div",{className:"space-y-4",children:N.map((we,Me)=>t.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:we.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",we.product_sku]})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:we.qty_full,onChange:st=>{const lt=[...N];lt[Me].qty_full=st.target.value===""?"":parseInt(st.target.value),T(lt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:we.qty_empty,onChange:st=>{const lt=[...N];lt[Me].qty_empty=st.target.value===""?"":parseInt(st.target.value),T(lt)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx("button",{type:"button",onClick:()=>{const st=[...N];st.splice(Me,1),T(st)},className:"text-red-600 hover:text-red-800",children:t.jsx(ar,{className:"h-5 w-5"})})]},Me))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>z(!0),disabled:A||!d||!f||N.length===0,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Load Truck"})}),t.jsx(ro,{isOpen:P,onClose:()=>z(!1),onConfirm:Pe,title:"Confirm Truck Loading",message:"Are you sure you want to load this truck? This will move inventory from the warehouse to the selected truck.",confirmText:"Load Truck",type:"info",loading:A}),t.jsx(Eb,{isOpen:J,onClose:()=>{de(!1),te(null)},onSelect:fe})]})},ik=({truckId:c})=>{const{data:d,isLoading:g,error:f}=xt.trucks.get.useQuery({id:c}),w=(f==null?void 0:f.message)||null,N=(d==null?void 0:d.inventory)||[];return g?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(or,{className:"h-8 w-8 animate-spin text-blue-500"})}):w?t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:w})})})}):N.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ps,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Inventory"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This truck has no inventory yet."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empty Cylinders"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(T=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:T.product_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:T.product_sku})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:T.qty_full})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:t.jsx("div",{className:"text-sm text-gray-900",children:T.qty_empty})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-500",children:new Date(T.updated_at).toLocaleString()})})]},T.product_id))})]})})},nk=({onSuccess:c})=>{var Ge,we;const[d,g]=oe.useState(""),[f,w]=oe.useState(""),[N,T]=oe.useState([]),[A,n]=oe.useState(!1),[P,z]=oe.useState(!1),[q,U]=oe.useState(null),[W,H]=oe.useState(""),{data:G=[]}=eg(),[J,de]=oe.useState(!1),[ne,te]=oe.useState(null),{data:Ne}=xt.trucks.list.useQuery({active:!0}),me=(Ne==null?void 0:Ne.trucks)||[],Pe=xt.transfers.create.useMutation(),Se=async Me=>{var st;Me.preventDefault(),n(!0),U(null);try{if(!d)throw new Error("Please select a truck");if(!f)throw new Error("Please select a destination warehouse");if(N.length===0)throw new Error("Please add at least one product");if(N.filter(mt=>(!mt.qty_full||mt.qty_full<0)&&(!mt.qty_empty||mt.qty_empty<0)).length>0)throw new Error("Please enter valid quantities for all products");if(N.filter(mt=>(mt.qty_full||0)===0&&(mt.qty_empty||0)===0).length>0)throw new Error("Each line must have at least one full or empty cylinder");const ft={truck_id:d,warehouse_id:f,lines:N.map(mt=>({product_id:mt.product_id,qty_full:mt.qty_full||0,qty_empty:mt.qty_empty||0}))};console.log("Creating return transfer with data:",ft);const Mt=await Pe.mutateAsync({source_warehouse_id:f,destination_warehouse_id:f,transfer_date:new Date().toISOString().split("T")[0],reason:"Return from truck",notes:`Return transfer from truck ${((st=me.find(mt=>mt.id===d))==null?void 0:st.fleet_number)||d}`,items:ft.lines.map(mt=>({product_id:mt.product_id,quantity_to_transfer:(mt.qty_full||0)+(mt.qty_empty||0)}))});console.log("Transfer created successfully:",Mt),g(""),w(""),T([]),z(!1),c&&c()}catch(lt){console.error("Transfer creation error:",lt),U(lt.message||"Failed to create transfer")}finally{n(!1)}},fe=()=>{te(N.length),de(!0)},Be=Me=>{if(ne!==null){const st=[...N];ne<N.length?st[ne]={...st[ne],product_id:Me.id,product_name:Me.name,product_sku:Me.sku,unit_of_measure:Me.unit_of_measure}:st.push({product_id:Me.id,product_name:Me.name,product_sku:Me.sku,unit_of_measure:Me.unit_of_measure,qty_full:"",qty_empty:""}),T(st)}de(!1),te(null)},ke=me.filter(Me=>{var st,lt;return((st=Me.fleet_number)==null?void 0:st.toLowerCase().includes(W.toLowerCase()))||((lt=Me.license_plate)==null?void 0:lt.toLowerCase().includes(W.toLowerCase()))});return t.jsxs("div",{className:"space-y-6",children:[q&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:q})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(br,{className:"inline h-4 w-4 mr-1"}),"Select Truck (Source)"]}),t.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Choose the truck that has products to return"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(rn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:W,onChange:Me=>H(Me.target.value),placeholder:"Search by fleet number or license plate...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),W&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",children:t.jsx("div",{className:"max-h-60 overflow-auto",children:ke.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No trucks found"}):ke.map(Me=>t.jsxs("div",{onClick:()=>{g(Me.id),H("")},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(br,{className:"inline h-4 w-4 mr-1"}),Me.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",Me.license_plate]})]},Me.id))})})]}),d&&t.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[t.jsx(br,{className:"inline h-4 w-4 mr-1"}),(Ge=me.find(Me=>Me.id===d))==null?void 0:Ge.fleet_number]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["License: ",(we=me.find(Me=>Me.id===d))==null?void 0:we.license_plate]})]}),t.jsx("button",{onClick:()=>g(""),className:"text-gray-400 hover:text-gray-600",children:t.jsx(ar,{className:"h-4 w-4"})})]})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Cn,{className:"inline h-4 w-4 mr-1"}),"Select Destination Warehouse"]}),t.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Choose the warehouse to return products to"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:f,onChange:Me=>w(Me.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select destination warehouse..."}),G.map(Me=>t.jsx("option",{value:Me.id,children:Me.name},Me.id))]}),t.jsx(Cn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]})]}),d&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Truck Inventory"}),t.jsx(ik,{truckId:d})]}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transfer Lines"}),t.jsxs("button",{type:"button",onClick:fe,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Add Product"})]})]}),t.jsx("div",{className:"space-y-4",children:N.map((Me,st)=>t.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-gray-900",children:Me.product_name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",Me.product_sku]})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Me.qty_full,onChange:lt=>{const St=[...N];St[st].qty_full=lt.target.value===""?"":parseInt(lt.target.value),T(St)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Empty Cylinders"}),t.jsx("input",{type:"number",min:"0",value:Me.qty_empty,onChange:lt=>{const St=[...N];St[st].qty_empty=lt.target.value===""?"":parseInt(lt.target.value),T(St)},placeholder:"Quantity",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx("button",{type:"button",onClick:()=>{const lt=[...N];lt.splice(st,1),T(lt)},className:"text-red-600 hover:text-red-800",children:t.jsx(ar,{className:"h-5 w-5"})})]},st))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>z(!0),disabled:A||!d||!f||N.length===0,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Return Transfer"})}),t.jsx(ro,{isOpen:P,onClose:()=>z(!1),onConfirm:Se,title:"Confirm Return Transfer",message:"Are you sure you want to create this return transfer? This will move inventory from the selected truck back to the warehouse.",confirmText:"Create Return Transfer",type:"info",loading:A}),t.jsx(Eb,{isOpen:J,onClose:()=>{de(!1),te(null)},onSelect:Be})]})},ak=c=>{const[d,g]=oe.useState(null),{data:f,isLoading:w,refetch:N}=xt.transfers.list.useQuery({source_warehouse_id:c==null?void 0:c.source_warehouse_id,destination_warehouse_id:c==null?void 0:c.destination_warehouse_id,status:c==null?void 0:c.status,transfer_type:c==null?void 0:c.transfer_type,date_from:c==null?void 0:c.date_from,date_to:c==null?void 0:c.date_to,created_by_user_id:c==null?void 0:c.created_by_user_id,search_text:c==null?void 0:c.search_text,page:1,limit:20,sort_by:"created_at",sort_order:"desc"},{retry:1,staleTime:3e4,onError:ne=>{g(ne.message),Pt.error("Failed to fetch transfers")}}),T=(f==null?void 0:f.transfers)||[],A=(f==null?void 0:f.totalCount)||0,n=oe.useCallback(async ne=>{if(!ne||!Cb.test(ne))return console.error("Invalid warehouse ID format:",ne),g("Invalid warehouse ID format"),null;try{return await xt.transfers.getWarehouseStock.query({warehouse_id:ne})}catch(te){return console.error("Error fetching warehouse stock:",te),g("Failed to fetch warehouse stock"),null}},[]),{data:P,isLoading:z}=xt.transfers.searchProducts.useQuery({search:"",warehouse_id:c==null?void 0:c.source_warehouse_id,include_variants:!0,limit:50},{enabled:!1}),q=xt.transfers.validate.useMutation({onError:ne=>{g(ne.message),Pt.error("Transfer validation failed")}}),U=xt.transfers.create.useMutation({onSuccess:()=>{Pt.success("Transfer created successfully"),N()},onError:ne=>{g(ne.message),Pt.error("Failed to create transfer")}}),W=xt.transfers.updateStatus.useMutation({onSuccess:()=>{Pt.success("Transfer status updated"),N()},onError:ne=>{g(ne.message),Pt.error("Failed to update transfer status")}}),H=oe.useCallback(async ne=>{try{return g(null),await q.mutateAsync(ne)}catch(te){return console.error("Transfer validation error:",te),{isValid:!1,errors:[te.message||"Validation failed"],warnings:[]}}},[q]),G=oe.useCallback(async ne=>{try{return g(null),await U.mutateAsync(ne)}catch(te){return console.error("Create transfer error:",te),null}},[U]),J=oe.useCallback(async(ne,te,Ne)=>{try{g(null),await W.mutateAsync({transfer_id:ne,status:te,notes:Ne})}catch(me){console.error("Update transfer status error:",me)}},[W]),{data:de}=xt.transfers.getCostAnalysis.useQuery({transfer_id:""},{enabled:!1});return{transfers:T,totalCount:A,loading:w,error:d,products:(P==null?void 0:P.products)||[],productsLoading:z,fetchTransfers:N,fetchWarehouseStock:n,validateTransfer:H,createTransfer:G,updateTransferStatus:J,costAnalysis:de,isValidating:q.isLoading,isCreating:U.isLoading,isUpdating:W.isLoading}},ok=c=>{const{data:d,isLoading:g,refetch:f}=xt.transfers.searchProducts.useQuery({search:"",warehouse_id:c,include_variants:!0,limit:100},{enabled:!!c,retry:1,staleTime:6e4});return{products:(d==null?void 0:d.products)||[],isLoading:g,refetch:f}},Cb=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,kb=c=>{const d=c&&Cb.test(c),{data:g,isLoading:f,refetch:w}=xt.transfers.getWarehouseStock.useQuery({warehouse_id:c},{enabled:!!d,retry:1,staleTime:6e4});return{stockInfo:g||[],isLoading:f,refetch:()=>w(),fetchStockInfo:w}},lk=()=>{const[c,d]=oe.useState([]),[g,f]=oe.useState([]),[w,N]=oe.useState({is_valid:!0,errors:[],warnings:[]}),[T,A]=oe.useState(null),n=oe.useCallback((q,U,W)=>{const H={product_id:q.id,product_sku:q.sku,product_name:q.name,variant_name:q.variant_name,quantity_to_transfer:U,unit_weight_kg:q.weight_kg||0,total_weight_kg:(q.weight_kg||0)*U,unit_cost:W.unit_cost||0,total_cost:(W.unit_cost||0)*U,available_stock:W.available_quantity||0};d(G=>{const J=G.findIndex(de=>de.product_id===q.id&&de.variant_name===q.variant_name);if(J>=0){const de=[...G];return de[J]={...de[J],quantity_to_transfer:U},de}else return[...G,H]})},[]),P=oe.useCallback((q,U)=>{d(W=>W.filter(H=>!(H.product_id===q&&H.variant_name===U)))},[]),z=oe.useCallback((q,U,W)=>{const H=[],G=[];(!q||!U)&&H.push("Source and destination warehouses are required"),q===U&&H.push("Source and destination warehouses must be different"),c.length===0&&H.push("At least one item must be selected for transfer"),c.forEach(de=>{de.quantity_to_transfer>de.available_stock&&H.push(`Insufficient stock for ${de.product_name}: requested ${de.quantity_to_transfer}, available ${de.available_stock}`)});const J={is_valid:H.length===0,errors:H,warnings:G};if(N(J),J.is_valid){const de={total_items:c.length,total_quantity:c.reduce((ne,te)=>ne+te.quantity_to_transfer,0),total_weight:c.reduce((ne,te)=>ne+te.total_weight_kg,0),total_cost:c.reduce((ne,te)=>ne+te.total_cost,0)};A(de)}return J},[c]);return{selectedItems:c,validationResult:w,transferSummary:T,warehouseStockData:g,setWarehouseStockData:f,addItem:n,removeItem:P,validateTransfer:z}},ck=({warehouseId:c,onProductSelect:d,selectedProductIds:g,disabled:f=!1})=>{const[w,N]=oe.useState({warehouse_id:c,has_stock:!0,search_text:"",variant_type:void 0,variant_name:void 0}),[T,A]=oe.useState(!1),[n,P]=oe.useState({}),{products:z,loading:q,searchProducts:U}=ok(),{stockInfo:W,loading:H,fetchStockInfo:G}=kb(c);oe.useEffect(()=>{w.warehouse_id&&(U(w),G())},[w,U,G]);const J=fe=>{N(Be=>({...Be,search_text:fe}))},de=(fe,Be)=>{N(ke=>({...ke,[fe]:Be}))},ne=(fe,Be)=>{P(ke=>({...ke,[fe]:Be}))},te=fe=>{const Be=`${fe.id}-${fe.variant_name||"default"}`,ke=n[Be]||1,Ge=W.find(we=>we.product_id===fe.id&&we.variant_name===fe.variant_name);if(!Ge){alert("Stock information not found for this product");return}if(ke>Ge.qty_available){alert(`Quantity exceeds available stock (${Ge.qty_available})`);return}d(fe,ke,Ge),P(we=>({...we,[Be]:1}))},Ne=(fe,Be)=>W.find(ke=>ke.product_id===fe&&ke.variant_name===Be),me=(fe,Be)=>{const ke=`${fe}-${Be||"default"}`;return g.includes(ke)},Pe=fe=>!fe||fe.qty_available===0?{status:"out-of-stock",color:"text-red-600 bg-red-100",text:"Out of Stock"}:fe.qty_available<=10?{status:"low-stock",color:"text-yellow-600 bg-yellow-100",text:"Low Stock"}:{status:"in-stock",color:"text-green-600 bg-green-100",text:"In Stock"},Se=q||H;return t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Products"}),t.jsxs("button",{onClick:()=>A(!T),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-800",children:[t.jsx(Qd,{className:"h-4 w-4"}),t.jsx("span",{children:"Filters"})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(rn,{className:"h-5 w-5 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search products by name or SKU...",value:w.search_text||"",onChange:fe=>J(fe.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),T&&t.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg space-y-4",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Type"}),t.jsxs("select",{value:w.variant_type||"",onChange:fe=>de("variant_type",fe.target.value||void 0),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"cylinder",children:"Cylinders"}),t.jsx("option",{value:"refillable",children:"Refillable"}),t.jsx("option",{value:"disposable",children:"Disposable"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Variant"}),t.jsxs("select",{value:w.variant_name||"",onChange:fe=>de("variant_name",fe.target.value||void 0),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"",children:"All Variants"}),t.jsx("option",{value:"full",children:"Full"}),t.jsx("option",{value:"empty",children:"Empty"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Status"}),t.jsxs("select",{value:w.has_stock?"in-stock":"all",onChange:fe=>de("has_stock",fe.target.value==="in-stock"),className:"block w-full border border-gray-300 rounded-md py-2 px-3 text-sm",children:[t.jsx("option",{value:"all",children:"All Products"}),t.jsx("option",{value:"in-stock",children:"In Stock Only"})]})]})]})})]}),t.jsx("div",{className:"p-4",children:Se?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),t.jsx("span",{className:"ml-2 text-gray-600",children:"Loading products..."})]}):z.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ps,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 mb-2",children:"No products found"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your search criteria or filters"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:z.map(fe=>{const Be=Ne(fe.id,fe.variant_name),ke=Pe(Be),Ge=`${fe.id}-${fe.variant_name||"default"}`,we=me(fe.id,fe.variant_name),Me=n[Ge]||1;return t.jsxs("div",{className:`border rounded-lg p-4 transition-all duration-200 ${we?"border-blue-500 bg-blue-50":f||ke.status==="out-of-stock"?"border-gray-200 bg-gray-50 opacity-75":"border-gray-300 hover:border-blue-300 hover:shadow-sm"}`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:fe.name}),t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["SKU: ",fe.sku]}),fe.variant_name&&t.jsx("span",{className:"inline-block bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded mt-1",children:fe.variant_name})]}),t.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${ke.color}`,children:ke.text})]}),Be&&t.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Available:"}),t.jsx("span",{className:"font-medium",children:Be.qty_available})]}),Be.qty_reserved>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Reserved:"}),t.jsx("span",{children:Be.qty_reserved})]}),fe.capacity_kg&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Weight:"}),t.jsxs("span",{children:[fe.capacity_kg,"kg"]})]})]}),ke.status!=="out-of-stock"&&!f&&t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"number",min:"1",max:(Be==null?void 0:Be.qty_available)||999,value:Me,onChange:st=>ne(Ge,parseInt(st.target.value)||1),className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["max ",(Be==null?void 0:Be.qty_available)||0]})]})]}),t.jsx("div",{children:we?t.jsxs("div",{className:"flex items-center justify-center py-2 text-sm text-blue-600",children:[t.jsx($N,{className:"h-4 w-4 mr-1"}),"Selected"]}):ke.status==="out-of-stock"?t.jsxs("div",{className:"flex items-center justify-center py-2 text-sm text-gray-500",children:[t.jsx(tu,{className:"h-4 w-4 mr-1"}),"Out of Stock"]}):t.jsxs("button",{onClick:()=>te(fe),disabled:f||Me>((Be==null?void 0:Be.qty_available)||0),className:`w-full flex items-center justify-center py-2 px-3 text-sm font-medium rounded-md ${f||Me>((Be==null?void 0:Be.qty_available)||0)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[t.jsx(Nr,{className:"h-4 w-4 mr-1"}),"Add to Transfer"]})})]},Ge)})})}),z.length>0&&t.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50 text-sm text-gray-600",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{children:["Showing ",z.length," product",z.length!==1?"s":""]}),t.jsxs("span",{children:[g.length," selected for transfer"]})]})})]})};async function dk(c){try{return await xt.transfers.formatValidationErrors.mutate({validation_result:c})}catch(d){throw console.error("Failed to format validation errors via API:",d),new Error("Validation error formatting failed. Please try again.")}}function uk(c,d,g){const f=g?new Date(g):new Date,w=f.toISOString().slice(0,10).replace(/-/g,""),N=f.toISOString().slice(11,19).replace(/:/g,""),T=c.slice(-4).toUpperCase(),A=d.slice(-4).toUpperCase();return`TRF-${w}-${N}-${T}-${A}`}const j0=({summary:c,validationResult:d,selectedItems:g,onRemoveItem:f,showItemDetails:w=!0})=>{var n,P;if(!c||g.length===0)return t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:t.jsxs("div",{className:"text-center text-gray-500",children:[t.jsx(ps,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{children:"No items selected for transfer"})]})});const N=d?dk(d):[],T=d&&!d.is_valid,A=d&&d.warnings.length>0;return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(ps,{className:"h-5 w-5 text-blue-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Items"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_products})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(sn,{className:"h-5 w-5 text-green-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Quantity"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_quantity})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(jf,{className:"h-5 w-5 text-purple-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Total Weight"}),t.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[c.total_weight_kg.toFixed(1),"kg"]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(br,{className:"h-5 w-5 text-orange-500 mr-2"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Variants"}),t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.unique_variants})]})]})})]}),d&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center mb-3",children:[T?t.jsx(fa,{className:"h-5 w-5 text-red-500 mr-2"}):A?t.jsx(Vs,{className:"h-5 w-5 text-yellow-500 mr-2"}):t.jsx(Zn,{className:"h-5 w-5 text-green-500 mr-2"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Validation Status"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.validation_summary.valid_items}),t.jsx("p",{className:"text-sm text-gray-600",children:"Valid Items"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.validation_summary.invalid_items}),t.jsx("p",{className:"text-sm text-gray-600",children:"Invalid Items"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.validation_summary.items_with_warnings}),t.jsx("p",{className:"text-sm text-gray-600",children:"Warnings"})]})]}),N.length>0&&t.jsx("div",{className:"space-y-2",children:N.map((z,q)=>t.jsxs("div",{className:`flex items-start p-3 rounded-md ${z.severity==="error"?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[z.severity==="error"?t.jsx(fa,{className:"h-4 w-4 text-red-500 mr-2 mt-0.5 flex-shrink-0"}):t.jsx(Vs,{className:"h-4 w-4 text-yellow-500 mr-2 mt-0.5 flex-shrink-0"}),t.jsx("span",{className:`text-sm ${z.severity==="error"?"text-red-700":"text-yellow-700"}`,children:z.message})]},q))})]}),w&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Selected Items"})}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"space-y-3",children:g.map((z,q)=>t.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${z.is_valid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center mb-1",children:[t.jsx("h4",{className:"font-medium text-gray-900 mr-2",children:z.product_name}),z.variant_name&&t.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:z.variant_name}),!z.is_valid&&t.jsx(fa,{className:"h-4 w-4 text-red-500 ml-2"})]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[t.jsxs("span",{children:["SKU: ",z.product_sku]}),t.jsx("span",{className:"mx-2",children:""}),t.jsxs("span",{children:["Qty: ",z.quantity_to_transfer]}),z.total_weight_kg&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mx-2",children:""}),t.jsxs("span",{children:["Weight: ",z.total_weight_kg.toFixed(1),"kg"]})]})]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Available: ",z.available_stock,z.reserved_stock&&z.reserved_stock>0&&t.jsxs("span",{children:["  Reserved: ",z.reserved_stock]})]}),(z.validation_errors.length>0||z.validation_warnings.length>0)&&t.jsxs("div",{className:"mt-2 space-y-1",children:[z.validation_errors.map((U,W)=>t.jsxs("div",{className:"text-xs text-red-600 flex items-center",children:[t.jsx(fa,{className:"h-3 w-3 mr-1"}),U]},W)),z.validation_warnings.map((U,W)=>t.jsxs("div",{className:"text-xs text-yellow-600 flex items-center",children:[t.jsx(Vs,{className:"h-3 w-3 mr-1"}),U]},W))]})]}),f&&t.jsx("button",{onClick:()=>f(z.product_id,z.variant_name),className:"ml-4 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full",title:"Remove item",children:t.jsx(fa,{className:"h-4 w-4"})})]},`${z.product_id}-${z.variant_name||"default"}`))})})]}),(c.heaviest_item||c.most_expensive_item)&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Additional Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.heaviest_item&&t.jsxs("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(jf,{className:"h-4 w-4 text-purple-500 mr-2"}),t.jsx("span",{className:"font-medium text-purple-700",children:"Heaviest Item"})]}),t.jsxs("p",{className:"text-sm text-purple-600",children:[c.heaviest_item.product_name," - ",(n=c.heaviest_item.total_weight_kg)==null?void 0:n.toFixed(1),"kg"]})]}),c.most_expensive_item&&c.total_cost&&t.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(sn,{className:"h-4 w-4 text-green-500 mr-2"}),t.jsx("span",{className:"font-medium text-green-700",children:"Most Expensive Item"})]}),t.jsxs("p",{className:"text-sm text-green-600",children:[c.most_expensive_item.product_name," - $",(P=c.most_expensive_item.total_cost)==null?void 0:P.toFixed(2)]})]})]}),c.total_cost&&t.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-blue-700",children:"Estimated Total Cost"}),t.jsxs("span",{className:"text-lg font-bold text-blue-900",children:["$",c.total_cost.toFixed(2)]})]})})]})]})},hk=({onTransferCreated:c,onCancel:d,initialSourceWarehouseId:g,initialDestinationWarehouseId:f})=>{var Me,st;const[w,N]=oe.useState({source_warehouse_id:g||"",destination_warehouse_id:f||"",transfer_date:new Date().toISOString().split("T")[0],priority:"normal",transfer_reference:"",reason:"",notes:"",instructions:"",selected_items:[]}),[T,A]=oe.useState("setup"),{data:n}=Yf(),P=(n==null?void 0:n.warehouses)||[],{createTransfer:z,loading:q}=ak(),{selectedItems:U,validationResult:W,transferSummary:H,setWarehouseStockData:G,addItem:J,removeItem:de,validateTransfer:ne}=lk(),{stockInfo:te,fetchStockInfo:Ne}=kb(w.source_warehouse_id);oe.useEffect(()=>{if(w.source_warehouse_id&&w.destination_warehouse_id&&!w.transfer_reference&&P.length>0){const lt=P.find(ft=>ft.id===w.source_warehouse_id),St=P.find(ft=>ft.id===w.destination_warehouse_id);if(lt&&St){const ft=uk(lt.name.substring(0,3).toUpperCase(),St.name.substring(0,3).toUpperCase(),w.transfer_date);N(Mt=>({...Mt,transfer_reference:ft}))}}},[w.source_warehouse_id,w.destination_warehouse_id,w.transfer_date,P]),oe.useEffect(()=>{w.source_warehouse_id&&Ne()},[w.source_warehouse_id,Ne]),oe.useEffect(()=>{G(te)},[te,G]),oe.useEffect(()=>{U.length>0&&w.source_warehouse_id&&w.destination_warehouse_id&&ne(w.source_warehouse_id,w.destination_warehouse_id,w.transfer_date)},[U,w,ne]);const me=(lt,St)=>{N(ft=>({...ft,[lt]:St}))},Pe=(lt,St,ft)=>{J(lt,St,ft)},Se=(lt,St)=>{de(lt,St)},fe=()=>{if(T==="setup"){if(!w.source_warehouse_id||!w.destination_warehouse_id){alert("Please select both source and destination warehouses");return}if(w.source_warehouse_id===w.destination_warehouse_id){alert("Source and destination warehouses must be different");return}A("products")}else if(T==="products"){if(U.length===0){alert("Please select at least one product for transfer");return}A("review")}},Be=()=>{T==="products"?A("setup"):T==="review"&&A("products")},ke=async()=>{if(!(W!=null&&W.is_valid)){alert("Please fix validation errors before submitting");return}try{const lt={source_warehouse_id:w.source_warehouse_id,destination_warehouse_id:w.destination_warehouse_id,transfer_date:w.transfer_date,items:U.map(ft=>({product_id:ft.product_id,product_sku:ft.product_sku,product_name:ft.product_name,variant_name:ft.variant_name,quantity_to_transfer:ft.quantity_to_transfer,unit_weight_kg:ft.unit_weight_kg,total_weight_kg:ft.total_weight_kg,unit_cost:ft.unit_cost,total_cost:ft.total_cost})),notes:w.notes,reason:w.reason,priority:w.priority,transfer_reference:w.transfer_reference},St=await z(lt);St&&c&&c(St.id)}catch(lt){console.error("Error submitting transfer:",lt)}},Ge=()=>T==="setup"?w.source_warehouse_id&&w.destination_warehouse_id&&w.source_warehouse_id!==w.destination_warehouse_id:T==="products"?U.length>0:!0,we=U.map(lt=>`${lt.product_id}-${lt.variant_name||"default"}`);return t.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Multi-SKU Transfer"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${T==="setup"?"bg-blue-500 text-white":"bg-blue-100 text-blue-600"}`,children:"1"}),t.jsx("div",{className:"w-8 h-1 bg-gray-200"}),t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${T==="products"?"bg-blue-500 text-white":T==="review"?"bg-blue-100 text-blue-600":"bg-gray-200 text-gray-500"}`,children:"2"}),t.jsx("div",{className:"w-8 h-1 bg-gray-200"}),t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${T==="review"?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:"3"})]})]}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{className:T==="setup"?"font-medium text-blue-600":"",children:"Setup Transfer"}),t.jsx("span",{className:T==="products"?"font-medium text-blue-600":"",children:"Select Products"}),t.jsx("span",{className:T==="review"?"font-medium text-blue-600":"",children:"Review & Submit"})]})]}),T==="setup"&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transfer Details"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(f_,{className:"h-4 w-4 inline mr-1"}),"Source Warehouse"]}),t.jsx(em,{value:w.source_warehouse_id,onChange:lt=>me("source_warehouse_id",lt),placeholder:"Select source warehouse"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Bf,{className:"h-4 w-4 inline mr-1"}),"Destination Warehouse"]}),t.jsx(em,{value:w.destination_warehouse_id,onChange:lt=>me("destination_warehouse_id",lt),placeholder:"Select destination warehouse",excludeIds:w.source_warehouse_id?[w.source_warehouse_id]:[]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Gs,{className:"h-4 w-4 inline mr-1"}),"Transfer Date"]}),t.jsx("input",{type:"date",value:w.transfer_date,onChange:lt=>me("transfer_date",lt.target.value),min:new Date().toISOString().split("T")[0],className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),t.jsxs("select",{value:w.priority,onChange:lt=>me("priority",lt.target.value),className:"block w-full border border-gray-300 rounded-md py-2 px-3",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"normal",children:"Normal"}),t.jsx("option",{value:"high",children:"High"}),t.jsx("option",{value:"urgent",children:"Urgent"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Transfer"}),t.jsxs("select",{value:w.reason,onChange:lt=>me("reason",lt.target.value),className:"block w-full border border-gray-300 rounded-md py-2 px-3",children:[t.jsx("option",{value:"",children:"Select reason"}),t.jsx("option",{value:"restock",children:"Restock"}),t.jsx("option",{value:"redistribution",children:"Redistribution"}),t.jsx("option",{value:"shortage",children:"Stock Shortage"}),t.jsx("option",{value:"maintenance",children:"Maintenance"}),t.jsx("option",{value:"optimization",children:"Inventory Optimization"}),t.jsx("option",{value:"other",children:"Other"})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Reference"}),t.jsx("input",{type:"text",value:w.transfer_reference,onChange:lt=>me("transfer_reference",lt.target.value),placeholder:"Auto-generated",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),t.jsx("textarea",{value:w.notes,onChange:lt=>me("notes",lt.target.value),rows:4,placeholder:"Add any additional notes about this transfer...",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions"}),t.jsx("textarea",{value:w.instructions,onChange:lt=>me("instructions",lt.target.value),rows:3,placeholder:"Any special handling instructions...",className:"block w-full border border-gray-300 rounded-md py-2 px-3"})]})]})]})]}),T==="products"&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[t.jsx("div",{children:t.jsx(ck,{warehouseId:w.source_warehouse_id,onProductSelect:Pe,selectedProductIds:we})}),t.jsx("div",{children:t.jsx(j0,{summary:H,validationResult:W,selectedItems:U,onRemoveItem:Se,showItemDetails:!0})})]}),T==="review"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Transfer Overview"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Source"}),t.jsx("p",{className:"font-medium",children:(Me=P.find(lt=>lt.id===w.source_warehouse_id))==null?void 0:Me.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Destination"}),t.jsx("p",{className:"font-medium",children:(st=P.find(lt=>lt.id===w.destination_warehouse_id))==null?void 0:st.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Transfer Date"}),t.jsx("p",{className:"font-medium",children:w.transfer_date})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Priority"}),t.jsx("p",{className:"font-medium capitalize",children:w.priority})]})]})]}),W&&!W.is_valid&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(Vs,{className:"h-5 w-5 text-red-500 mr-2"}),t.jsx("h3",{className:"font-semibold text-red-800",children:"Validation Errors"})]}),t.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:W.errors.map((lt,St)=>t.jsxs("li",{children:[" ",lt]},St))})]}),t.jsx(j0,{summary:H,validationResult:W,selectedItems:U,onRemoveItem:Se,showItemDetails:!0})]}),t.jsxs("div",{className:"flex justify-between items-center bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("div",{children:T!=="setup"&&t.jsx("button",{onClick:Be,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Previous"})}),t.jsxs("div",{className:"flex space-x-3",children:[d&&t.jsx("button",{onClick:d,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),T!=="review"?t.jsx("button",{onClick:fe,disabled:!Ge(),className:`px-4 py-2 rounded-md font-medium ${Ge()?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"}):t.jsxs("button",{onClick:ke,disabled:!(W!=null&&W.is_valid)||q,className:`flex items-center px-6 py-2 rounded-md font-medium ${W!=null&&W.is_valid&&!q?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[t.jsx(nS,{className:"h-4 w-4 mr-2"}),q?"Creating...":"Submit Transfer"]})]})]})]})};function Ab(c){var d,g,f="";if(typeof c=="string"||typeof c=="number")f+=c;else if(typeof c=="object")if(Array.isArray(c)){var w=c.length;for(d=0;d<w;d++)c[d]&&(g=Ab(c[d]))&&(f&&(f+=" "),f+=g)}else for(g in c)c[g]&&(f&&(f+=" "),f+=g);return f}function mk(){for(var c,d,g=0,f="",w=arguments.length;g<w;g++)(c=arguments[g])&&(d=Ab(c))&&(f&&(f+=" "),f+=d);return f}const tg="-",pk=c=>{const d=gk(c),{conflictingClassGroups:g,conflictingClassGroupModifiers:f}=c;return{getClassGroupId:T=>{const A=T.split(tg);return A[0]===""&&A.length!==1&&A.shift(),Mb(A,d)||fk(T)},getConflictingClassGroupIds:(T,A)=>{const n=g[T]||[];return A&&f[T]?[...n,...f[T]]:n}}},Mb=(c,d)=>{var T;if(c.length===0)return d.classGroupId;const g=c[0],f=d.nextPart.get(g),w=f?Mb(c.slice(1),f):void 0;if(w)return w;if(d.validators.length===0)return;const N=c.join(tg);return(T=d.validators.find(({validator:A})=>A(N)))==null?void 0:T.classGroupId},N0=/^\[(.+)\]$/,fk=c=>{if(N0.test(c)){const d=N0.exec(c)[1],g=d==null?void 0:d.substring(0,d.indexOf(":"));if(g)return"arbitrary.."+g}},gk=c=>{const{theme:d,prefix:g}=c,f={nextPart:new Map,validators:[]};return yk(Object.entries(c.classGroups),g).forEach(([N,T])=>{Pf(T,f,N,d)}),f},Pf=(c,d,g,f)=>{c.forEach(w=>{if(typeof w=="string"){const N=w===""?d:S0(d,w);N.classGroupId=g;return}if(typeof w=="function"){if(xk(w)){Pf(w(f),d,g,f);return}d.validators.push({validator:w,classGroupId:g});return}Object.entries(w).forEach(([N,T])=>{Pf(T,S0(d,N),g,f)})})},S0=(c,d)=>{let g=c;return d.split(tg).forEach(f=>{g.nextPart.has(f)||g.nextPart.set(f,{nextPart:new Map,validators:[]}),g=g.nextPart.get(f)}),g},xk=c=>c.isThemeGetter,yk=(c,d)=>d?c.map(([g,f])=>{const w=f.map(N=>typeof N=="string"?d+N:typeof N=="object"?Object.fromEntries(Object.entries(N).map(([T,A])=>[d+T,A])):N);return[g,w]}):c,_k=c=>{if(c<1)return{get:()=>{},set:()=>{}};let d=0,g=new Map,f=new Map;const w=(N,T)=>{g.set(N,T),d++,d>c&&(d=0,f=g,g=new Map)};return{get(N){let T=g.get(N);if(T!==void 0)return T;if((T=f.get(N))!==void 0)return w(N,T),T},set(N,T){g.has(N)?g.set(N,T):w(N,T)}}},Pb="!",bk=c=>{const{separator:d,experimentalParseClassName:g}=c,f=d.length===1,w=d[0],N=d.length,T=A=>{const n=[];let P=0,z=0,q;for(let J=0;J<A.length;J++){let de=A[J];if(P===0){if(de===w&&(f||A.slice(J,J+N)===d)){n.push(A.slice(z,J)),z=J+N;continue}if(de==="/"){q=J;continue}}de==="["?P++:de==="]"&&P--}const U=n.length===0?A:A.substring(z),W=U.startsWith(Pb),H=W?U.substring(1):U,G=q&&q>z?q-z:void 0;return{modifiers:n,hasImportantModifier:W,baseClassName:H,maybePostfixModifierPosition:G}};return g?A=>g({className:A,parseClassName:T}):T},vk=c=>{if(c.length<=1)return c;const d=[];let g=[];return c.forEach(f=>{f[0]==="["?(d.push(...g.sort(),f),g=[]):g.push(f)}),d.push(...g.sort()),d},wk=c=>({cache:_k(c.cacheSize),parseClassName:bk(c),...pk(c)}),jk=/\s+/,Nk=(c,d)=>{const{parseClassName:g,getClassGroupId:f,getConflictingClassGroupIds:w}=d,N=[],T=c.trim().split(jk);let A="";for(let n=T.length-1;n>=0;n-=1){const P=T[n],{modifiers:z,hasImportantModifier:q,baseClassName:U,maybePostfixModifierPosition:W}=g(P);let H=!!W,G=f(H?U.substring(0,W):U);if(!G){if(!H){A=P+(A.length>0?" "+A:A);continue}if(G=f(U),!G){A=P+(A.length>0?" "+A:A);continue}H=!1}const J=vk(z).join(":"),de=q?J+Pb:J,ne=de+G;if(N.includes(ne))continue;N.push(ne);const te=w(G,H);for(let Ne=0;Ne<te.length;++Ne){const me=te[Ne];N.push(de+me)}A=P+(A.length>0?" "+A:A)}return A};function Sk(){let c=0,d,g,f="";for(;c<arguments.length;)(d=arguments[c++])&&(g=Ib(d))&&(f&&(f+=" "),f+=g);return f}const Ib=c=>{if(typeof c=="string")return c;let d,g="";for(let f=0;f<c.length;f++)c[f]&&(d=Ib(c[f]))&&(g&&(g+=" "),g+=d);return g};function Tk(c,...d){let g,f,w,N=T;function T(n){const P=d.reduce((z,q)=>q(z),c());return g=wk(P),f=g.cache.get,w=g.cache.set,N=A,A(n)}function A(n){const P=f(n);if(P)return P;const z=Nk(n,g);return w(n,z),z}return function(){return N(Sk.apply(null,arguments))}}const Js=c=>{const d=g=>g[c]||[];return d.isThemeGetter=!0,d},Db=/^\[(?:([a-z-]+):)?(.+)\]$/i,Ek=/^\d+\/\d+$/,Ck=new Set(["px","full","screen"]),kk=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ak=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Mk=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Pk=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ik=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,pa=c=>ec(c)||Ck.has(c)||Ek.test(c),Ha=c=>dc(c,"length",Uk),ec=c=>!!c&&!Number.isNaN(Number(c)),cf=c=>dc(c,"number",ec),Gd=c=>!!c&&Number.isInteger(Number(c)),Dk=c=>c.endsWith("%")&&ec(c.slice(0,-1)),us=c=>Db.test(c),Xa=c=>kk.test(c),Lk=new Set(["length","size","percentage"]),Rk=c=>dc(c,Lk,Lb),zk=c=>dc(c,"position",Lb),Ok=new Set(["image","url"]),Fk=c=>dc(c,Ok,qk),Bk=c=>dc(c,"",Vk),Zd=()=>!0,dc=(c,d,g)=>{const f=Db.exec(c);return f?f[1]?typeof d=="string"?f[1]===d:d.has(f[1]):g(f[2]):!1},Uk=c=>Ak.test(c)&&!Mk.test(c),Lb=()=>!1,Vk=c=>Pk.test(c),qk=c=>Ik.test(c),$k=()=>{const c=Js("colors"),d=Js("spacing"),g=Js("blur"),f=Js("brightness"),w=Js("borderColor"),N=Js("borderRadius"),T=Js("borderSpacing"),A=Js("borderWidth"),n=Js("contrast"),P=Js("grayscale"),z=Js("hueRotate"),q=Js("invert"),U=Js("gap"),W=Js("gradientColorStops"),H=Js("gradientColorStopPositions"),G=Js("inset"),J=Js("margin"),de=Js("opacity"),ne=Js("padding"),te=Js("saturate"),Ne=Js("scale"),me=Js("sepia"),Pe=Js("skew"),Se=Js("space"),fe=Js("translate"),Be=()=>["auto","contain","none"],ke=()=>["auto","hidden","clip","visible","scroll"],Ge=()=>["auto",us,d],we=()=>[us,d],Me=()=>["",pa,Ha],st=()=>["auto",ec,us],lt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],St=()=>["solid","dashed","dotted","double","none"],ft=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Mt=()=>["start","end","center","between","around","evenly","stretch"],mt=()=>["","0",us],Fs=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ts=()=>[ec,us];return{cacheSize:500,separator:":",theme:{colors:[Zd],spacing:[pa,Ha],blur:["none","",Xa,us],brightness:ts(),borderColor:[c],borderRadius:["none","","full",Xa,us],borderSpacing:we(),borderWidth:Me(),contrast:ts(),grayscale:mt(),hueRotate:ts(),invert:mt(),gap:we(),gradientColorStops:[c],gradientColorStopPositions:[Dk,Ha],inset:Ge(),margin:Ge(),opacity:ts(),padding:we(),saturate:ts(),scale:ts(),sepia:mt(),skew:ts(),space:we(),translate:we()},classGroups:{aspect:[{aspect:["auto","square","video",us]}],container:["container"],columns:[{columns:[Xa]}],"break-after":[{"break-after":Fs()}],"break-before":[{"break-before":Fs()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...lt(),us]}],overflow:[{overflow:ke()}],"overflow-x":[{"overflow-x":ke()}],"overflow-y":[{"overflow-y":ke()}],overscroll:[{overscroll:Be()}],"overscroll-x":[{"overscroll-x":Be()}],"overscroll-y":[{"overscroll-y":Be()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[G]}],"inset-x":[{"inset-x":[G]}],"inset-y":[{"inset-y":[G]}],start:[{start:[G]}],end:[{end:[G]}],top:[{top:[G]}],right:[{right:[G]}],bottom:[{bottom:[G]}],left:[{left:[G]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Gd,us]}],basis:[{basis:Ge()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",us]}],grow:[{grow:mt()}],shrink:[{shrink:mt()}],order:[{order:["first","last","none",Gd,us]}],"grid-cols":[{"grid-cols":[Zd]}],"col-start-end":[{col:["auto",{span:["full",Gd,us]},us]}],"col-start":[{"col-start":st()}],"col-end":[{"col-end":st()}],"grid-rows":[{"grid-rows":[Zd]}],"row-start-end":[{row:["auto",{span:[Gd,us]},us]}],"row-start":[{"row-start":st()}],"row-end":[{"row-end":st()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",us]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",us]}],gap:[{gap:[U]}],"gap-x":[{"gap-x":[U]}],"gap-y":[{"gap-y":[U]}],"justify-content":[{justify:["normal",...Mt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Mt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Mt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ne]}],px:[{px:[ne]}],py:[{py:[ne]}],ps:[{ps:[ne]}],pe:[{pe:[ne]}],pt:[{pt:[ne]}],pr:[{pr:[ne]}],pb:[{pb:[ne]}],pl:[{pl:[ne]}],m:[{m:[J]}],mx:[{mx:[J]}],my:[{my:[J]}],ms:[{ms:[J]}],me:[{me:[J]}],mt:[{mt:[J]}],mr:[{mr:[J]}],mb:[{mb:[J]}],ml:[{ml:[J]}],"space-x":[{"space-x":[Se]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Se]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",us,d]}],"min-w":[{"min-w":[us,d,"min","max","fit"]}],"max-w":[{"max-w":[us,d,"none","full","min","max","fit","prose",{screen:[Xa]},Xa]}],h:[{h:[us,d,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[us,d,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[us,d,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[us,d,"auto","min","max","fit"]}],"font-size":[{text:["base",Xa,Ha]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",cf]}],"font-family":[{font:[Zd]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",us]}],"line-clamp":[{"line-clamp":["none",ec,cf]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",pa,us]}],"list-image":[{"list-image":["none",us]}],"list-style-type":[{list:["none","disc","decimal",us]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[c]}],"placeholder-opacity":[{"placeholder-opacity":[de]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[c]}],"text-opacity":[{"text-opacity":[de]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...St(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",pa,Ha]}],"underline-offset":[{"underline-offset":["auto",pa,us]}],"text-decoration-color":[{decoration:[c]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:we()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",us]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",us]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[de]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...lt(),zk]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Rk]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Fk]}],"bg-color":[{bg:[c]}],"gradient-from-pos":[{from:[H]}],"gradient-via-pos":[{via:[H]}],"gradient-to-pos":[{to:[H]}],"gradient-from":[{from:[W]}],"gradient-via":[{via:[W]}],"gradient-to":[{to:[W]}],rounded:[{rounded:[N]}],"rounded-s":[{"rounded-s":[N]}],"rounded-e":[{"rounded-e":[N]}],"rounded-t":[{"rounded-t":[N]}],"rounded-r":[{"rounded-r":[N]}],"rounded-b":[{"rounded-b":[N]}],"rounded-l":[{"rounded-l":[N]}],"rounded-ss":[{"rounded-ss":[N]}],"rounded-se":[{"rounded-se":[N]}],"rounded-ee":[{"rounded-ee":[N]}],"rounded-es":[{"rounded-es":[N]}],"rounded-tl":[{"rounded-tl":[N]}],"rounded-tr":[{"rounded-tr":[N]}],"rounded-br":[{"rounded-br":[N]}],"rounded-bl":[{"rounded-bl":[N]}],"border-w":[{border:[A]}],"border-w-x":[{"border-x":[A]}],"border-w-y":[{"border-y":[A]}],"border-w-s":[{"border-s":[A]}],"border-w-e":[{"border-e":[A]}],"border-w-t":[{"border-t":[A]}],"border-w-r":[{"border-r":[A]}],"border-w-b":[{"border-b":[A]}],"border-w-l":[{"border-l":[A]}],"border-opacity":[{"border-opacity":[de]}],"border-style":[{border:[...St(),"hidden"]}],"divide-x":[{"divide-x":[A]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[A]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[de]}],"divide-style":[{divide:St()}],"border-color":[{border:[w]}],"border-color-x":[{"border-x":[w]}],"border-color-y":[{"border-y":[w]}],"border-color-s":[{"border-s":[w]}],"border-color-e":[{"border-e":[w]}],"border-color-t":[{"border-t":[w]}],"border-color-r":[{"border-r":[w]}],"border-color-b":[{"border-b":[w]}],"border-color-l":[{"border-l":[w]}],"divide-color":[{divide:[w]}],"outline-style":[{outline:["",...St()]}],"outline-offset":[{"outline-offset":[pa,us]}],"outline-w":[{outline:[pa,Ha]}],"outline-color":[{outline:[c]}],"ring-w":[{ring:Me()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[c]}],"ring-opacity":[{"ring-opacity":[de]}],"ring-offset-w":[{"ring-offset":[pa,Ha]}],"ring-offset-color":[{"ring-offset":[c]}],shadow:[{shadow:["","inner","none",Xa,Bk]}],"shadow-color":[{shadow:[Zd]}],opacity:[{opacity:[de]}],"mix-blend":[{"mix-blend":[...ft(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ft()}],filter:[{filter:["","none"]}],blur:[{blur:[g]}],brightness:[{brightness:[f]}],contrast:[{contrast:[n]}],"drop-shadow":[{"drop-shadow":["","none",Xa,us]}],grayscale:[{grayscale:[P]}],"hue-rotate":[{"hue-rotate":[z]}],invert:[{invert:[q]}],saturate:[{saturate:[te]}],sepia:[{sepia:[me]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[g]}],"backdrop-brightness":[{"backdrop-brightness":[f]}],"backdrop-contrast":[{"backdrop-contrast":[n]}],"backdrop-grayscale":[{"backdrop-grayscale":[P]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[z]}],"backdrop-invert":[{"backdrop-invert":[q]}],"backdrop-opacity":[{"backdrop-opacity":[de]}],"backdrop-saturate":[{"backdrop-saturate":[te]}],"backdrop-sepia":[{"backdrop-sepia":[me]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[T]}],"border-spacing-x":[{"border-spacing-x":[T]}],"border-spacing-y":[{"border-spacing-y":[T]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",us]}],duration:[{duration:ts()}],ease:[{ease:["linear","in","out","in-out",us]}],delay:[{delay:ts()}],animate:[{animate:["none","spin","ping","pulse","bounce",us]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Ne]}],"scale-x":[{"scale-x":[Ne]}],"scale-y":[{"scale-y":[Ne]}],rotate:[{rotate:[Gd,us]}],"translate-x":[{"translate-x":[fe]}],"translate-y":[{"translate-y":[fe]}],"skew-x":[{"skew-x":[Pe]}],"skew-y":[{"skew-y":[Pe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",us]}],accent:[{accent:["auto",c]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",us]}],"caret-color":[{caret:[c]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":we()}],"scroll-mx":[{"scroll-mx":we()}],"scroll-my":[{"scroll-my":we()}],"scroll-ms":[{"scroll-ms":we()}],"scroll-me":[{"scroll-me":we()}],"scroll-mt":[{"scroll-mt":we()}],"scroll-mr":[{"scroll-mr":we()}],"scroll-mb":[{"scroll-mb":we()}],"scroll-ml":[{"scroll-ml":we()}],"scroll-p":[{"scroll-p":we()}],"scroll-px":[{"scroll-px":we()}],"scroll-py":[{"scroll-py":we()}],"scroll-ps":[{"scroll-ps":we()}],"scroll-pe":[{"scroll-pe":we()}],"scroll-pt":[{"scroll-pt":we()}],"scroll-pr":[{"scroll-pr":we()}],"scroll-pb":[{"scroll-pb":we()}],"scroll-pl":[{"scroll-pl":we()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",us]}],fill:[{fill:[c,"none"]}],"stroke-w":[{stroke:[pa,Ha,cf]}],stroke:[{stroke:[c,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Gk=Tk($k);function ou(...c){return Gk(mk(c))}const sg=oe.createContext(void 0),Zk=({value:c,onValueChange:d,children:g,className:f})=>t.jsx(sg.Provider,{value:{value:c,onValueChange:d},children:t.jsx("div",{className:ou("w-full",f),"data-state":c,children:g})}),Wk=({children:c,className:d})=>t.jsx("div",{className:ou("inline-flex h-10 items-center justify-center rounded-lg bg-gray-100 p-1 text-gray-500",d),children:c}),df=({value:c,children:d,className:g})=>{const f=oe.useContext(sg);if(!f)throw new Error("TabsTrigger must be used within a Tabs component");const{value:w,onValueChange:N}=f,T=w===c;return t.jsx("button",{role:"tab","data-state":T?"active":"inactive",onClick:()=>N(c),className:ou("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",T?"bg-white text-gray-950 shadow-sm":"hover:bg-gray-200",g),children:d})},uf=({value:c,children:d,className:g})=>{const f=oe.useContext(sg);if(!f)throw new Error("TabsContent must be used within a Tabs component");const{value:w}=f,N=w===c;return N?t.jsx("div",{role:"tabpanel","data-state":N?"active":"inactive",className:ou("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2",g),children:d}):null},T0=({children:c,className:d})=>t.jsx("div",{className:ou("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm",d),children:c});class Dh extends ei.Component{constructor(d){super(d),this.state={hasError:!1}}static getDerivedStateFromError(d){return{hasError:!0,error:d}}componentDidCatch(d,g){console.error("Transfer page error:",d,g)}render(){return this.state.hasError?this.props.fallback||t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(tu,{className:"h-5 w-5 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Something went wrong"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"There was an error loading this section. Please refresh the page or try again later."}),this.state.error&&t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"cursor-pointer",children:"Error details"}),t.jsx("pre",{className:"mt-1 text-xs",children:this.state.error.message})]})]})]})]})}):this.props.children}}const Hk=()=>{const[c,d]=oe.useState("load");return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Transfers"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage inventory transfers between warehouses and trucks"})]}),t.jsx(Dh,{children:t.jsxs(Zk,{value:c,onValueChange:d,className:"space-y-6",children:[t.jsxs(Wk,{className:"grid w-full grid-cols-3",children:[t.jsxs(df,{value:"load",className:"flex items-center space-x-2",children:[t.jsx(br,{className:"h-4 w-4"}),t.jsx("span",{children:"Load Truck"})]}),t.jsxs(df,{value:"return",className:"flex items-center space-x-2",children:[t.jsx(Bf,{className:"h-4 w-4"}),t.jsx("span",{children:"Return to Warehouse"})]}),t.jsxs(df,{value:"multi-sku",className:"flex items-center space-x-2",children:[t.jsx(ps,{className:"h-4 w-4"}),t.jsx("span",{children:"Multi-SKU Transfer"})]})]}),t.jsx(uf,{value:"load",children:t.jsx(T0,{children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Load Truck"}),t.jsx(Dh,{children:t.jsx(rk,{})})]})})}),t.jsx(uf,{value:"return",children:t.jsx(T0,{children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Return to Warehouse"}),t.jsx(Dh,{children:t.jsx(nk,{})})]})})}),t.jsx(uf,{value:"multi-sku",children:t.jsx(Dh,{children:t.jsx(hk,{onTransferCreated:g=>{console.log("Transfer created:",g)}})})})]})})]})},Xk=()=>t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),t.jsx("p",{className:"text-gray-600",children:"System configuration and preferences"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx(aS,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"System Settings"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"This page will contain system configuration options, user preferences, and administrative settings."}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-500",children:[t.jsx("p",{children:" User account management"}),t.jsx("p",{children:" System preferences and configuration"}),t.jsx("p",{children:" Security settings and permissions"}),t.jsx("p",{children:" Backup and maintenance options"})]})]})})]}),Kk=({trucks:c,loading:d,onStatusChange:g})=>d?t.jsx("div",{className:"flex justify-center items-center h-32",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):c.length?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Truck Details"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Load"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"relative px-6 py-3",children:t.jsx("span",{className:"sr-only",children:"Actions"})})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(f=>{const w=(f.inventory||[]).reduce((A,n)=>A+(n.qty_full||0)+(n.qty_empty||0),0),N=w/f.capacity_cylinders*100,T=N>100;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(br,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.fleet_number}),t.jsx("div",{className:"text-sm text-gray-500",children:f.license_plate})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:f.driver_name||"Unassigned"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("div",{className:"text-sm text-gray-900",children:f.capacity_cylinders})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("div",{className:"w-48",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("span",{className:"text-xs font-medium text-gray-500",children:[w," / ",f.capacity_cylinders]}),T&&t.jsx(tu,{className:"h-4 w-4 text-red-500",title:"Overloaded"})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full ${T?"bg-red-500":"bg-blue-500"}`,style:{width:`${Math.min(N,100)}%`}})})]})})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("select",{value:f.active?"active":"inactive",onChange:A=>g(f,A.target.value==="active"),className:`block w-full pl-3 pr-10 py-2 text-sm border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${f.active?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx(hf,{to:`/trucks/${f.id}`,className:"text-blue-600 hover:text-blue-900",children:"View Details"})})]},f.id)})})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(br,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No trucks"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new truck."}),t.jsx("div",{className:"mt-6",children:t.jsx(hf,{to:"/trucks/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"Add Truck"})})]}),Qk=(c={})=>xt.trucks.list.useQuery(c,{retry:1,staleTime:3e4,select:d=>({trucks:d.trucks,isLoading:!1,error:null,totalCount:d.totalCount,totalPages:d.totalPages,currentPage:d.currentPage})}),Jk=c=>xt.trucks.get.useQuery({id:c},{enabled:!!c}),Yk=()=>xt.trucks.create.useMutation({onSuccess:c=>{console.log("Truck created successfully:",c),Pt.success("Truck created successfully")},onError:c=>{console.error("Create truck mutation error:",c),Pt.error(c.message||"Failed to create truck")}}),Rb=()=>xt.trucks.update.useMutation({onSuccess:c=>{console.log("Truck updated successfully:",c),Pt.success("Truck updated successfully")},onError:c=>{console.error("Update truck mutation error:",c),Pt.error(c.message||"Failed to update truck")}}),eA=()=>{const{data:c,isLoading:d,error:g}=Qk(),f=Rb(),w=(c==null?void 0:c.trucks)||[],N=async(T,A)=>{try{await f.mutateAsync({id:T.id,active:A})}catch(n){console.error("Error updating truck status:",n),alert("Failed to update truck status. Please try again.")}};return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Trucks"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage your fleet and monitor truck inventory"})]}),t.jsxs(hf,{to:"/trucks/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[t.jsx(Nr,{className:"-ml-1 mr-2 h-5 w-5"}),"Add Truck"]})]}),g&&t.jsx("div",{className:"rounded-md bg-red-50 p-4 mb-8",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:g.message})})})}),t.jsx(Kk,{trucks:w,loading:d,onStatusChange:N})]})},zb=({initialData:c,onSuccess:d})=>{const g=si(),f=Yk(),w=Rb(),[N,T]=oe.useState(null),[A,n]=oe.useState({fleet_number:(c==null?void 0:c.fleet_number)||"",license_plate:(c==null?void 0:c.license_plate)||"",capacity_cylinders:(c==null?void 0:c.capacity_cylinders)||"",driver_name:(c==null?void 0:c.driver_name)||"",active:(c==null?void 0:c.active)??!0}),P=f.isLoading||w.isLoading,z=async q=>{if(q.preventDefault(),!P){T(null);try{if(!A.fleet_number)throw new Error("Fleet number is required");if(!A.license_plate)throw new Error("License plate is required");const U=parseInt(String(A.capacity_cylinders));if(isNaN(U)||U<=0)throw new Error("Capacity must be a valid number greater than 0");const W={fleet_number:A.fleet_number,license_plate:A.license_plate,capacity_cylinders:U,driver_name:A.driver_name||null,active:A.active};let H;c!=null&&c.id?H=await w.mutateAsync({id:c.id,...W}):H=await f.mutateAsync(W),console.log("Operation successful, result:",H),d?d():(console.log("Navigating to:",`/trucks/${H.id}`),g(`/trucks/${H.id}`))}catch(U){console.error("Form submission error:",U),T(U.message||"Failed to save truck")}}};return t.jsxs("form",{onSubmit:z,className:"space-y-6",children:[N&&t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:N})})})}),t.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(br,{className:"h-6 w-6 text-gray-400"}),t.jsx("h3",{className:"ml-2 text-lg font-medium text-gray-900",children:c?"Edit Truck":"New Truck"})]})}),t.jsxs("div",{className:"px-6 py-5 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"fleet_number",className:"block text-sm font-medium text-gray-700",children:"Fleet Number"}),t.jsx("input",{type:"text",id:"fleet_number",value:A.fleet_number,onChange:q=>n({...A,fleet_number:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"license_plate",className:"block text-sm font-medium text-gray-700",children:"License Plate"}),t.jsx("input",{type:"text",id:"license_plate",value:A.license_plate,onChange:q=>n({...A,license_plate:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"capacity_cylinders",className:"block text-sm font-medium text-gray-700",children:"Capacity (Cylinders)"}),t.jsx("input",{type:"number",id:"capacity_cylinders",min:"1",placeholder:"Enter capacity",value:A.capacity_cylinders||"",onChange:q=>{const U=q.target.value;n(W=>({...W,capacity_cylinders:U===""?"":parseInt(U)}))},className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"driver_name",className:"block text-sm font-medium text-gray-700",children:"Driver Name"}),t.jsx("input",{type:"text",id:"driver_name",value:A.driver_name,onChange:q=>n({...A,driver_name:q.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"active",checked:A.active,onChange:q=>n({...A,active:q.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"active",className:"ml-2 block text-sm text-gray-900",children:"Active"})]})]}),t.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>g("/trucks"),className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:P,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:P?t.jsxs("div",{className:"flex items-center",children:[t.jsx(or,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Saving..."]}):"Save Truck"})]})})]})]})},tA=()=>{const{id:c}=nc(),d=si(),[g,f]=oe.useState(!1),{data:w,isLoading:N,error:T}=Jk(c||"");if(N)return t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})});if(T||!w)return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"rounded-md bg-red-50 p-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium text-red-800",children:(T==null?void 0:T.message)||"Truck not found"})})})})});if(g)return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("button",{onClick:()=>f(!1),className:"mb-6 inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t.jsx(Rr,{className:"h-4 w-4 mr-1"}),"Back to Details"]}),t.jsx(zb,{initialData:w,onSuccess:()=>{f(!1),loadTruckDetails()}})]});const A=w.inventory.reduce((n,P)=>n+(P.qty_full||0)+(P.qty_empty||0),0);return A/w.capacity_cylinders*100,t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("button",{onClick:()=>d("/trucks"),className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t.jsx(Rr,{className:"h-4 w-4 mr-1"}),"Back to Trucks"]})}),t.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-5 border-b border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(br,{className:"h-6 w-6 text-gray-400"}),t.jsx("h1",{className:"ml-2 text-xl font-semibold text-gray-900",children:w.fleet_number}),t.jsx("span",{className:`ml-4 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${w.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:w.active?"Active":"Inactive"})]}),t.jsxs("button",{onClick:()=>f(!0),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[t.jsx(fi,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),t.jsxs("div",{className:"px-6 py-5 grid grid-cols-1 gap-6 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Truck Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"License Plate"}),t.jsx("p",{className:"mt-1",children:w.license_plate})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Driver"}),t.jsx("p",{className:"mt-1",children:w.driver_name||"Not assigned"})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Capacity"}),t.jsxs("p",{className:"mt-1",children:[w.capacity_cylinders," cylinders"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Current Load"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("p",{className:"text-lg font-medium",children:[A," / ",w.capacity_cylinders," cylinders"]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:t.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${A/(w.capacity_cylinders||1)*100}%`}})})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Inventory Breakdown"}),w.inventory.length===0?t.jsx("p",{className:"text-sm text-gray-500",children:"No inventory items"}):t.jsx("div",{className:"space-y-3",children:w.inventory.map(n=>t.jsxs("div",{className:"flex items-start",children:[t.jsx(ps,{className:"h-5 w-5 text-gray-400 mt-0.5"}),t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.product_name}),t.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",n.product_sku]}),t.jsxs("div",{className:"mt-1 flex space-x-4",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:["Full: ",n.qty_full||0]}),t.jsxs("span",{className:"text-xs text-gray-500",children:["Empty: ",n.qty_empty||0]})]})]})]},n.product_id))})]})]})]})]})]})},sA=()=>{const c=si();return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Add New Truck"}),t.jsx(zb,{onSuccess:()=>c("/trucks")})]})},rA=({schedule:c,onClick:d})=>{const{truck:g,capacity_info:f,allocations:w,maintenance_due:N,fuel_sufficient:T}=c,A=q=>{switch(q){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-gray-600 bg-gray-100";case"maintenance":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}},n=(q,U)=>U?"bg-red-500":q>85?"bg-orange-500":q>60?"bg-yellow-500":"bg-green-500",P=q=>q>=1e3?`${(q/1e3).toFixed(1)}t`:`${q}kg`,z=[];return N&&z.push("Maintenance Due"),T||z.push("Low Fuel"),f.is_overallocated&&z.push("Overallocated"),t.jsxs("div",{className:`bg-white rounded-lg shadow border-2 transition-all duration-200 hover:shadow-md ${d?"cursor-pointer hover:border-blue-300":"border-gray-200"} ${f.is_overallocated?"border-red-300":"border-gray-200"}`,onClick:d,children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(br,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:g.fleet_number}),t.jsx("p",{className:"text-sm text-gray-600",children:g.license_plate})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(su,{status:g.status,className:A(g.status)}),z.length>0&&t.jsxs("div",{className:"flex items-center text-red-600",children:[t.jsx(Vs,{className:"h-4 w-4"}),t.jsx("span",{className:"text-xs ml-1",children:z.length})]})]})]})}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Capacity"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[P(f.allocated_weight_kg)," / ",P(f.total_capacity_kg)]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:t.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${n(f.utilization_percentage,f.is_overallocated)}`,style:{width:`${Math.min(f.utilization_percentage,100)}%`}})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[t.jsx("span",{children:"0%"}),t.jsxs("span",{className:"font-medium",children:[f.utilization_percentage.toFixed(1),"%"]}),t.jsx("span",{children:"100%"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ps,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Orders"}),t.jsx("p",{className:"font-semibold",children:f.orders_count})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(br,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Available"}),t.jsx("p",{className:"font-semibold",children:P(f.available_weight_kg)})]})]}),g.driver_name&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"h-4 w-4 bg-gray-400 rounded-full"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Driver"}),t.jsx("p",{className:"font-semibold text-sm",children:g.driver_name})]})]}),c.route&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(en,{className:"h-4 w-4 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-600",children:"Route"}),t.jsx("p",{className:"font-semibold",children:c.route.route_status})]})]})]}),z.length>0&&t.jsxs("div",{className:"space-y-1",children:[N&&t.jsxs("div",{className:"flex items-center space-x-2 text-yellow-700 bg-yellow-50 p-2 rounded",children:[t.jsx(lS,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Maintenance due"})]}),!T&&t.jsxs("div",{className:"flex items-center space-x-2 text-orange-700 bg-orange-50 p-2 rounded",children:[t.jsx(__,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Check fuel level"})]}),f.is_overallocated&&t.jsxs("div",{className:"flex items-center space-x-2 text-red-700 bg-red-50 p-2 rounded",children:[t.jsx(Vs,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:["Capacity exceeded by ",P(f.allocated_weight_kg-f.total_capacity_kg)]})]})]}),w.length>0&&t.jsxs("div",{className:"border-t pt-3 mt-3",children:[t.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-2",children:["Today's Orders (",w.length,")"]}),t.jsxs("div",{className:"space-y-1",children:[w.slice(0,3).map((q,U)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-gray-600",children:["Order #",q.order_id.slice(-6)]}),t.jsx("span",{className:"font-medium",children:P(q.estimated_weight_kg)})]},q.id)),w.length>3&&t.jsxs("p",{className:"text-xs text-gray-500",children:["+",w.length-3," more orders"]})]})]})]})})]})},iA=({order:c,orderWeight:d,recommendations:g,selectedTruckId:f,onTruckSelect:w,onCancel:N,onConfirm:T,isLoading:A=!1})=>{const[n,P]=oe.useState(!1),z=G=>G>=1e3?`${(G/1e3).toFixed(1)}t`:`${G}kg`,q=g.filter(G=>G.can_accommodate),U=g.filter(G=>!G.can_accommodate),W=g.find(G=>G.truck.id===f),H=f&&(W==null?void 0:W.can_accommodate);return t.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 max-w-4xl w-full",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Assign Truck for Order #",c.id.slice(-6)]}),t.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(ps,{className:"h-4 w-4"}),t.jsxs("span",{children:["Order Weight: ",z(d)]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(jf,{className:"h-4 w-4"}),t.jsxs("span",{children:["Delivery Date: ",c.scheduled_date||"Today"]})]})]})]}),t.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600",children:""})]})}),t.jsxs("div",{className:"px-6 py-4",children:[q.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center",children:[t.jsx(Zn,{className:"h-5 w-5 text-green-500 mr-2"}),"Available Trucks (",q.length,")"]}),t.jsx("div",{className:"grid gap-3",children:q.map(G=>t.jsx(E0,{recommendation:G,orderWeight:d,isSelected:f===G.truck.id,onClick:()=>w(G.truck.id)},G.truck.id))})]}),U.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-700 flex items-center",children:[t.jsx(Vs,{className:"h-5 w-5 text-red-500 mr-2"}),"Unavailable Trucks (",U.length,")"]}),t.jsxs("button",{onClick:()=>P(!n),className:"text-sm text-blue-600 hover:text-blue-800",children:[n?"Hide":"Show"," unavailable trucks"]})]}),n&&t.jsx("div",{className:"grid gap-3 opacity-75",children:U.map(G=>t.jsx(E0,{recommendation:G,orderWeight:d,isSelected:!1,onClick:()=>{},disabled:!0},G.truck.id))})]}),g.length===0&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(br,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"No trucks available for this order"})]})]}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-gray-600",children:W&&t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{children:["Selected: ",W.truck.fleet_number]}),t.jsxs("span",{children:["Utilization after: ",((W.capacity_info.allocated_weight_kg+d)/W.capacity_info.total_capacity_kg*100).toFixed(1),"%"]})]})}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:N,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:T,disabled:!H||A,className:`px-4 py-2 rounded-md font-medium ${H&&!A?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:A?"Assigning...":"Assign Truck"})]})]})})]})},E0=({recommendation:c,orderWeight:d,isSelected:g,onClick:f,disabled:w=!1})=>{const{truck:N,capacity_info:T,warnings:A,errors:n}=c,P=q=>q>=1e3?`${(q/1e3).toFixed(1)}t`:`${q}kg`,z=(T.allocated_weight_kg+d)/T.total_capacity_kg*100;return t.jsxs("div",{className:`border-2 rounded-lg p-4 transition-all duration-200 ${w?"cursor-not-allowed opacity-75":"cursor-pointer"} ${g?"border-blue-500 bg-blue-50":n.length>0?"border-red-300 hover:border-red-400":A.length>0?"border-yellow-300 hover:border-yellow-400":"border-gray-200 hover:border-blue-300"}`,onClick:w?void 0:f,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${g?"bg-blue-200":"bg-gray-100"}`,children:t.jsx(br,{className:`h-5 w-5 ${g?"text-blue-600":"text-gray-600"}`})}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900",children:N.fleet_number}),t.jsx("p",{className:"text-sm text-gray-600",children:N.license_plate}),N.driver_name&&t.jsxs("p",{className:"text-xs text-gray-500",children:["Driver: ",N.driver_name]})]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:n.length>0?t.jsx(Vs,{className:"h-5 w-5 text-red-500"}):A.length>0?t.jsx(Vs,{className:"h-5 w-5 text-yellow-500"}):t.jsx(Zn,{className:"h-5 w-5 text-green-500"})})]}),t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[t.jsxs("span",{children:["Current: ",T.utilization_percentage.toFixed(1),"%"]}),t.jsxs("span",{children:["After: ",z.toFixed(1),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsxs("div",{className:"flex h-2 rounded-full overflow-hidden",children:[t.jsx("div",{className:"bg-blue-500",style:{width:`${Math.min(T.utilization_percentage,100)}%`}}),t.jsx("div",{className:`${z>100?"bg-red-500":z>85?"bg-orange-500":"bg-blue-300"}`,style:{width:`${Math.min(Math.max(0,z-T.utilization_percentage),100-T.utilization_percentage)}%`}})]})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[t.jsxs("span",{children:[P(T.allocated_weight_kg)," / ",P(T.total_capacity_kg)]}),t.jsxs("span",{children:["Available: ",P(T.available_weight_kg)]})]})]}),(n.length>0||A.length>0)&&t.jsxs("div",{className:"mt-3 space-y-1",children:[n.map((q,U)=>t.jsx("div",{className:"text-xs text-red-700 bg-red-50 p-2 rounded",children:q},U)),A.map((q,U)=>t.jsx("div",{className:"text-xs text-yellow-700 bg-yellow-50 p-2 rounded",children:q},U))]})]})},nA=()=>{const[c,d]=oe.useState(new Date().toISOString().split("T")[0]),[g,f]=oe.useState(!1),w={total_capacity_kg:5400,total_allocated_kg:3780,overall_utilization:70,active_trucks:8,overallocated_trucks:1,maintenance_due_trucks:2},N=[],T=P=>P>=1e3?`${(P/1e3).toFixed(1)}t`:`${P}kg`,A=P=>new Date(P).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),n=P=>"text-yellow-600 bg-yellow-100";return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsx("div",{className:"py-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Fleet Capacity Dashboard"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Monitor truck capacity and optimize delivery allocations"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gs,{className:"h-5 w-5 text-gray-400"}),t.jsx("input",{type:"date",value:c,onChange:P=>d(P.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),t.jsxs("button",{onClick:()=>f(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center space-x-2",children:[t.jsx(Nr,{className:"h-4 w-4"}),t.jsx("span",{children:"Allocate Order"})]})]})]})})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(sn,{className:`h-8 w-8 ${n()}`})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Fleet Utilization"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[w.overall_utilization.toFixed(1),"%"]}),t.jsxs("p",{className:"text-xs text-gray-500",children:[T(w.total_allocated_kg)," / ",T(w.total_capacity_kg)]})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(br,{className:"h-8 w-8 text-blue-600 bg-blue-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Trucks"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.active_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Available for delivery"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Vs,{className:"h-8 w-8 text-red-600 bg-red-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overallocated"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.overallocated_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Need attention"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(ps,{className:"h-8 w-8 text-yellow-600 bg-yellow-100 p-1 rounded"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Maintenance Due"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:w.maintenance_due_trucks}),t.jsx("p",{className:"text-xs text-gray-500",children:"Schedule soon"})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Fleet Capacity for ",A(c)]}),t.jsxs("div",{className:"text-sm text-gray-600",children:[T(w.total_allocated_kg)," allocated of ",T(w.total_capacity_kg)," total capacity"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-2",children:t.jsx("div",{className:"h-4 rounded-full transition-all duration-500 bg-yellow-500",style:{width:`${Math.min(w.overall_utilization,100)}%`}})}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{children:"0%"}),t.jsxs("span",{className:"font-medium",children:[w.overall_utilization.toFixed(1),"% Utilized"]}),t.jsx("span",{children:"100%"})]})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Truck Capacity Details"}),t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),t.jsx("span",{children:"Good utilization"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),t.jsx("span",{children:"High utilization"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),t.jsx("span",{children:"Overallocated"})]})]})]}),N.length>0?t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:N.map(P=>t.jsx(rA,{schedule:P,onClick:()=>{console.log("Truck clicked:",P.truck_id)}},P.truck_id))}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(br,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsxs("p",{className:"text-gray-600 mb-2",children:["No truck schedules for ",A(c)]}),t.jsx("p",{className:"text-sm text-gray-500",children:"Try selecting a different date or ensure trucks are properly configured"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Nr,{className:"h-6 w-6 text-blue-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Allocate Orders"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Assign pending orders to trucks"})]})]})}),t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-green-400 hover:bg-green-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(sn,{className:"h-6 w-6 text-green-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Optimize Routes"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Auto-optimize truck allocations"})]})]})}),t.jsx("button",{className:"p-4 border border-gray-300 rounded-lg hover:border-yellow-400 hover:bg-yellow-50 text-left transition-colors",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Vs,{className:"h-6 w-6 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:"Maintenance"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Schedule truck maintenance"})]})]})})]})]})]}),g&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsx(iA,{order:{id:"sample-order",scheduled_date:c},orderWeight:150,recommendations:[],onTruckSelect:P=>console.log("Selected:",P),onCancel:()=>f(!1),onConfirm:()=>{f(!1)}})})]})};function aA(){return t.jsxs(FN,{children:[t.jsx(y1,{children:t.jsxs(_1,{children:[t.jsx(Qs,{path:"/login",element:t.jsx(fS,{})}),t.jsxs(Qs,{path:"/*",element:t.jsx(dS,{children:t.jsx(pS,{})}),children:[t.jsx(Qs,{index:!0,element:t.jsx(Hy,{})}),t.jsx(Qs,{path:"dashboard",element:t.jsx(Hy,{})}),t.jsx(Qs,{path:"customers",element:t.jsx(vE,{})}),t.jsx(Qs,{path:"customers/:id",element:t.jsx(RE,{})}),t.jsx(Qs,{path:"products",element:t.jsx(KE,{})}),t.jsx(Qs,{path:"products/:id",element:t.jsx(aC,{})}),t.jsx(Qs,{path:"warehouses",element:t.jsx(pC,{})}),t.jsx(Qs,{path:"warehouses/:id",element:t.jsx(bC,{})}),t.jsx(Qs,{path:"inventory",element:t.jsx(TC,{})}),t.jsx(Qs,{path:"pricing",element:t.jsx(MC,{})}),t.jsx(Qs,{path:"pricing/:id",element:t.jsx(DC,{})}),t.jsx(Qs,{path:"orders",element:t.jsx($C,{})}),t.jsx(Qs,{path:"orders/new",element:t.jsx(HC,{})}),t.jsx(Qs,{path:"orders/schedule",element:t.jsx(YC,{})}),t.jsx(Qs,{path:"orders/reports",element:t.jsx(tk,{})}),t.jsx(Qs,{path:"orders/:id",element:t.jsx(QC,{})}),t.jsx(Qs,{path:"transfers",element:t.jsx(Hk,{})}),t.jsx(Qs,{path:"settings",element:t.jsx(Xk,{})}),t.jsxs(Qs,{path:"trucks",children:[t.jsx(Qs,{index:!0,element:t.jsx(eA,{})}),t.jsx(Qs,{path:"new",element:t.jsx(sA,{})}),t.jsx(Qs,{path:"capacity",element:t.jsx(nA,{})}),t.jsx(Qs,{path:":id",element:t.jsx(tA,{})})]})]})]})}),t.jsx(Yj,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})}const C0=new U1({defaultOptions:{queries:{retry:1,staleTime:3e4,refetchOnWindowFocus:!1}}});window.addEventListener("error",c=>{console.error("Global error:",c.error)});window.addEventListener("unhandledrejection",c=>{console.error("Unhandled promise rejection:",c.reason)});const Ob=document.getElementById("root");if(!Ob)throw new Error("Failed to find the root element");try{P0(Ob).render(t.jsx(oe.StrictMode,{children:t.jsx(xt.Provider,{client:ON,queryClient:C0,children:t.jsx(rj,{client:C0,children:t.jsx(aA,{})})})}))}catch(c){console.error("Error rendering app:",c)}
//# sourceMappingURL=index-lTMeyXyM.js.map
