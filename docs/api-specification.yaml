openapi: 3.1.0
info:
  title: Order Management System API
  description: Backend API for LPG Order Management System
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:3001/api/trpc
    description: Development server (tRPC)
  - url: https://ordermanagementsystem-production-3ed7.up.railway.app/api/trpc
    description: Production server (tRPC)

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Error:
      type: object
      required: [message, code]
      properties:
        message:
          type: string
        code:
          type: string
        details:
          type: object

    Order:
      type: object
      required: [id, customer_id, status, total_amount]
      properties:
        id:
          type: string
          format: uuid
        customer_id:
          type: string
          format: uuid
        source_warehouse_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [draft, confirmed, scheduled, en_route, delivered, invoiced, cancelled]
        total_amount:
          type: number
          format: decimal
        tax_amount:
          type: number
          format: decimal
        delivery_date:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    OrderCalculation:
      type: object
      required: [subtotal, tax_amount, total_amount]
      properties:
        subtotal:
          type: number
          format: decimal
        tax_amount:
          type: number
          format: decimal
        total_amount:
          type: number
          format: decimal
        breakdown:
          type: array
          items:
            type: object

    InventoryItem:
      type: object
      required: [product_id, qty_full, qty_reserved]
      properties:
        product_id:
          type: string
          format: uuid
        qty_full:
          type: number
        qty_empty:
          type: number
        qty_reserved:
          type: number
        warehouse_id:
          type: string
          format: uuid

    TransferValidation:
      type: object
      required: [is_valid]
      properties:
        is_valid:
          type: boolean
        errors:
          type: array
          items:
            type: string
        warnings:
          type: array
          items:
            type: string

    Customer:
      type: object
      required: [id, name, email]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        created_at:
          type: string
          format: date-time

    Product:
      type: object
      required: [id, name, sku]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        sku:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [active, end_of_sale, obsolete]

paths:
  # ORDER MANAGEMENT ENDPOINTS
  /orders.list:
    post:
      summary: List orders with analytics
      description: Retrieve orders with optional filtering and analytics data (tRPC query)
      tags: [Orders]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [draft, confirmed, scheduled, en_route, delivered, invoiced, cancelled]
                customer_id:
                  type: string
                  format: uuid
                include_analytics:
                  type: boolean
                  default: false
                page:
                  type: number
                  default: 1
                limit:
                  type: number
                  default: 50
      responses:
        '200':
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: object
                        properties:
                          orders:
                            type: array
                            items:
                              $ref: '#/components/schemas/Order'
                          totalCount:
                            type: number
                          analytics:
                            type: object
                            nullable: true
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /orders.create:
    post:
      summary: Create new order
      description: Create a new order with validation and inventory checks (tRPC mutation)
      tags: [Orders]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [customer_id, order_lines, source_warehouse_id]
              properties:
                customer_id:
                  type: string
                  format: uuid
                source_warehouse_id:
                  type: string
                  format: uuid
                order_lines:
                  type: array
                  items:
                    type: object
                    required: [product_id, quantity]
                    properties:
                      product_id:
                        type: string
                        format: uuid
                      quantity:
                        type: number
                delivery_date:
                  type: string
                  format: date-time
                notes:
                  type: string
                tax_percent:
                  type: number
                  default: 0
      responses:
        '200':
          description: Order created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Order'

  /orders.get:
    post:
      summary: Get order by ID
      description: Retrieve a specific order by ID (tRPC query)
      tags: [Orders]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id]
              properties:
                id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Order'

  /orders.calculateTotals:
    post:
      summary: Calculate order total
      description: Calculate order totals including tax and discounts (tRPC mutation)
      tags: [Orders]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [lines]
              properties:
                lines:
                  type: array
                  items:
                    type: object
                    required: [product_id, quantity, unit_price, subtotal]
                    properties:
                      product_id:
                        type: string
                        format: uuid
                      quantity:
                        type: number
                      unit_price:
                        type: number
                      subtotal:
                        type: number
                tax_percent:
                  type: number
                  default: 0
      responses:
        '200':
          description: Order total calculated
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/OrderCalculation'

  # INVENTORY MANAGEMENT ENDPOINTS
  /inventory.list:
    post:
      summary: Get inventory levels
      description: Retrieve current inventory with filtering options (tRPC query)
      tags: [Inventory]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                warehouse_id:
                  type: string
                  format: uuid
                product_id:
                  type: string
                  format: uuid
                low_stock_only:
                  type: boolean
                  default: false
                page:
                  type: number
                  default: 1
                limit:
                  type: number
                  default: 50
      responses:
        '200':
          description: Inventory retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: object
                        properties:
                          inventory:
                            type: array
                            items:
                              $ref: '#/components/schemas/InventoryItem'
                          totalCount:
                            type: number

  /inventory.getByWarehouse:
    post:
      summary: Get inventory by warehouse
      description: Retrieve inventory for specific warehouse (tRPC query)
      tags: [Inventory]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [warehouse_id]
              properties:
                warehouse_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Warehouse inventory retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/InventoryItem'

  /inventory.adjustStock:
    post:
      summary: Adjust inventory levels
      description: Adjust stock levels with validation and audit trail (tRPC mutation)
      tags: [Inventory]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [inventory_id, adjustment_type, qty_full_change, reason]
              properties:
                inventory_id:
                  type: string
                  format: uuid
                adjustment_type:
                  type: string
                  enum: [received_full, received_empty, physical_count, damage_loss, other]
                qty_full_change:
                  type: number
                qty_empty_change:
                  type: number
                  default: 0
                reason:
                  type: string
      responses:
        '200':
          description: Inventory adjusted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/InventoryItem'

  /inventory.reserve:
    post:
      summary: Reserve inventory
      description: Reserve inventory for orders (tRPC mutation)
      tags: [Inventory]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reservations]
              properties:
                order_id:
                  type: string
                  format: uuid
                reservations:
                  type: array
                  items:
                    type: object
                    required: [product_id, quantity]
                    properties:
                      product_id:
                        type: string
                        format: uuid
                      quantity:
                        type: number
                      warehouse_id:
                        type: string
                        format: uuid
      responses:
        '200':
          description: Inventory reserved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: object
                        properties:
                          success:
                            type: boolean
                          reserved_items:
                            type: array
                            items:
                              $ref: '#/components/schemas/InventoryItem'

  # CUSTOMER MANAGEMENT ENDPOINTS
  /customers.list:
    post:
      summary: List customers
      description: Retrieve customers with optional filtering (tRPC query)
      tags: [Customers]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                search:
                  type: string
                page:
                  type: number
                  default: 1
                limit:
                  type: number
                  default: 50
      responses:
        '200':
          description: Customers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: object
                        properties:
                          customers:
                            type: array
                            items:
                              $ref: '#/components/schemas/Customer'
                          totalCount:
                            type: number

  /customers.get:
    post:
      summary: Get customer by ID
      description: Retrieve a specific customer by ID (tRPC query)
      tags: [Customers]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id]
              properties:
                id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Customer retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Customer'

  /customers.create:
    post:
      summary: Create new customer
      description: Create a new customer (tRPC mutation)
      tags: [Customers]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email]
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                phone:
                  type: string
                company:
                  type: string
      responses:
        '200':
          description: Customer created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Customer'

  # PRODUCT MANAGEMENT ENDPOINTS
  /products.list:
    post:
      summary: List products
      description: Retrieve products with optional filtering (tRPC query)
      tags: [Products]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                search:
                  type: string
                status:
                  type: string
                  enum: [active, end_of_sale, obsolete]
                page:
                  type: number
                  default: 1
                limit:
                  type: number
                  default: 50
      responses:
        '200':
          description: Products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: object
                        properties:
                          products:
                            type: array
                            items:
                              $ref: '#/components/schemas/Product'
                          totalCount:
                            type: number

  /products.get:
    post:
      summary: Get product by ID
      description: Retrieve a specific product by ID (tRPC query)
      tags: [Products]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id]
              properties:
                id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Product retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Product'

  # TRANSFER MANAGEMENT ENDPOINTS
  /transfers.validate:
    post:
      summary: Validate transfer request
      description: Validate multi-SKU transfer with business rules (tRPC mutation)
      tags: [Transfers]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [source_warehouse_id, destination_warehouse_id, items]
              properties:
                source_warehouse_id:
                  type: string
                  format: uuid
                destination_warehouse_id:
                  type: string
                  format: uuid
                transfer_date:
                  type: string
                  format: date-time
                items:
                  type: array
                  items:
                    type: object
                    required: [product_id, quantity_to_transfer]
                    properties:
                      product_id:
                        type: string
                        format: uuid
                      quantity_to_transfer:
                        type: number
      responses:
        '200':
          description: Transfer validation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TransferValidation'

  /transfers.create:
    post:
      summary: Create transfer
      description: Create and execute validated transfer with inventory updates (tRPC mutation)
      tags: [Transfers]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [source_warehouse_id, destination_warehouse_id, items, transfer_type]
              properties:
                source_warehouse_id:
                  type: string
                  format: uuid
                destination_warehouse_id:
                  type: string
                  format: uuid
                transfer_type:
                  type: string
                  enum: [standard, return, load, internal]
                items:
                  type: array
                  items:
                    type: object
                    required: [product_id, quantity_to_transfer]
                    properties:
                      product_id:
                        type: string
                        format: uuid
                      quantity_to_transfer:
                        type: number
                notes:
                  type: string
      responses:
        '200':
          description: Transfer created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          status:
                            type: string
                            enum: [pending, approved, in_transit, completed, cancelled]

  # PRICING MANAGEMENT ENDPOINTS
  /pricing.calculate:
    post:
      summary: Calculate dynamic pricing
      description: Calculate customer-specific pricing with tiers and discounts (tRPC query)
      tags: [Pricing]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [customer_id, items]
              properties:
                customer_id:
                  type: string
                  format: uuid
                items:
                  type: array
                  items:
                    type: object
                    required: [product_id, quantity]
                    properties:
                      product_id:
                        type: string
                        format: uuid
                      quantity:
                        type: number
                pricing_date:
                  type: string
                  format: date-time
      responses:
        '200':
          description: Pricing calculated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: object
                        properties:
                          total_amount:
                            type: number
                            format: decimal
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                product_id:
                                  type: string
                                  format: uuid
                                unit_price:
                                  type: number
                                  format: decimal
                                subtotal:
                                  type: number
                                  format: decimal

  # ANALYTICS & DASHBOARD ENDPOINTS
  /analytics.getDashboardStats:
    post:
      summary: Get dashboard statistics
      description: Retrieve comprehensive business metrics for dashboard (tRPC query)
      tags: [Analytics]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  enum: [today, week, month, quarter, year]
                  default: month
      responses:
        '200':
          description: Dashboard stats retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      data:
                        type: object
                        properties:
                          orders:
                            type: object
                            properties:
                              total_count:
                                type: number
                              total_revenue:
                                type: number
                                format: decimal
                          inventory:
                            type: object
                            properties:
                              total_products:
                                type: number
                              low_stock_alerts:
                                type: number
                          customers:
                            type: object
                            properties:
                              total_count:
                                type: number
                              active_count:
                                type: number

# Global error responses
responses:
  UnauthorizedError:
    description: Access token is missing or invalid
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/Error'
  
  ForbiddenError:
    description: Insufficient permissions
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/Error'
  
  NotFoundError:
    description: Resource not found
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/Error'

tags:
  - name: Orders
    description: Order management operations
  - name: Inventory
    description: Inventory and stock management
  - name: Transfers
    description: Inter-warehouse transfers
  - name: Pricing
    description: Pricing and calculation operations
  - name: Analytics
    description: Business analytics and reporting
  - name: Customers
    description: Customer management operations
  - name: Products
    description: Product management operations